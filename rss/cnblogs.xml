<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>åšå®¢å›­_é¦–é¡µ</title>
<link></link>
<description>ä»£ç æ”¹å˜ä¸–ç•Œ</description>
<item>
<title>åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - Blazor å®æˆ˜ç³»åˆ—ï¼ˆå…«ï¼‰ - é˜¿æ˜ŸPlus</title>
<link>http://www.cnblogs.com/meowv/p/13124967.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/meowv/p/13124967.html</guid>
<description>&lt;h2 id=&quot;ç³»åˆ—æ–‡ç« &quot;&gt;ç³»åˆ—æ–‡ç« &lt;/h2&gt;
&lt;ol&gt;&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12896177.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - ä½¿ç”¨ abp cli æ­å»ºé¡¹ç›®&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12896898.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - ç»™é¡¹ç›®ç˜¦èº«ï¼Œè®©å®ƒè·‘èµ·æ¥&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12909558.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - å®Œå–„ä¸ç¾åŒ–ï¼ŒSwaggerç™»åœº&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12913676.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - æ•°æ®è®¿é—®å’Œä»£ç ä¼˜å…ˆ&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12916613.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - è‡ªå®šä¹‰ä»“å‚¨ä¹‹å¢åˆ æ”¹æŸ¥&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12924409.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - ç»Ÿä¸€è§„èŒƒAPIï¼ŒåŒ…è£…è¿”å›æ¨¡å‹&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12924859.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - å†è¯´Swaggerï¼Œåˆ†ç»„ã€æè¿°ã€å°ç»¿é”&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12935693.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - æ¥å…¥GitHubï¼Œç”¨JWTä¿æŠ¤ä½ çš„API&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12943699.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12956696.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - ä½¿ç”¨Redisç¼“å­˜æ•°æ®&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12961014.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - é›†æˆHangfireå®ç°å®šæ—¶ä»»åŠ¡å¤„ç†&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12966092.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - ç”¨AutoMapperæå®šå¯¹è±¡æ˜ å°„&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12971041.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - å®šæ—¶ä»»åŠ¡æœ€ä½³å®æˆ˜ï¼ˆä¸€ï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12974439.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - å®šæ—¶ä»»åŠ¡æœ€ä½³å®æˆ˜ï¼ˆäºŒï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12980301.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - å®šæ—¶ä»»åŠ¡æœ€ä½³å®æˆ˜ï¼ˆä¸‰ï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12987623.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - åšå®¢æ¥å£å®æˆ˜ç¯‡ï¼ˆä¸€ï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/12994914.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - åšå®¢æ¥å£å®æˆ˜ç¯‡ï¼ˆäºŒï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/13039883.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - åšå®¢æ¥å£å®æˆ˜ç¯‡ï¼ˆä¸‰ï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/13043084.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - åšå®¢æ¥å£å®æˆ˜ç¯‡ï¼ˆå››ï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/13046603.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - åšå®¢æ¥å£å®æˆ˜ç¯‡ï¼ˆäº”ï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/13061975.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - Blazor å®æˆ˜ç³»åˆ—ï¼ˆä¸€ï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/13065295.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - Blazor å®æˆ˜ç³»åˆ—ï¼ˆäºŒï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/13081035.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - Blazor å®æˆ˜ç³»åˆ—ï¼ˆä¸‰ï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/13088303.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - Blazor å®æˆ˜ç³»åˆ—ï¼ˆå››ï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/13096000.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - Blazor å®æˆ˜ç³»åˆ—ï¼ˆäº”ï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/13124303.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - Blazor å®æˆ˜ç³»åˆ—ï¼ˆå…­ï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/meowv/p/13124533.html&quot;&gt;åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - Blazor å®æˆ˜ç³»åˆ—ï¼ˆä¸ƒï¼‰&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;hr/&gt;&lt;p&gt;ä¸Šä¸€ç¯‡å®Œæˆäº†æ ‡ç­¾æ¨¡å—å’Œå‹æƒ…é“¾æ¥æ¨¡å—çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæœ¬ç¯‡æ¥ç»§ç»­å®Œæˆåšå®¢æœ€åçš„æ¨¡å—ï¼Œæ–‡ç« çš„ç®¡ç†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ–‡ç« åˆ—è¡¨--åˆ é™¤&quot;&gt;æ–‡ç« åˆ—è¡¨ &amp;amp; åˆ é™¤&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/891843/202006/891843-20200614200844738-638855159.png&quot; alt=&quot;1&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å…ˆå°†åˆ†é¡µæŸ¥è¯¢çš„åˆ—è¡¨ç»™æ•´å‡ºæ¥ï¼Œè¿™å—å’Œé¦–é¡µçš„åˆ†é¡µåˆ—è¡¨æ˜¯ç±»ä¼¼çš„ï¼Œå°±æ˜¯å¤šäº†ä¸ªIdå­—æ®µã€‚&lt;/p&gt;
&lt;p&gt;å…ˆæ·»åŠ ä¸¤æ¡è·¯ç”±è§„åˆ™ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;@page &quot;/admin/posts&quot;
@page &quot;/admin/posts/{page:int}&quot;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ–°å»ºè¿”å›æ•°æ®é»˜è®¤&lt;code&gt;QueryPostForAdminDto.cs&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;//QueryPostForAdminDto.cs
using System.Collections.Generic;

namespace Meowv.Blog.BlazorApp.Response.Blog
{
    public class QueryPostForAdminDto
    {
        /// &amp;lt;summary&amp;gt;
        /// å¹´ä»½
        /// &amp;lt;/summary&amp;gt;
        public int Year { get; set; }

        /// &amp;lt;summary&amp;gt;
        /// Posts
        /// &amp;lt;/summary&amp;gt;
        public IEnumerable&amp;lt;PostBriefForAdminDto&amp;gt; Posts { get; set; }
    }
}

//PostBriefForAdminDto.cs
namespace Meowv.Blog.BlazorApp.Response.Blog
{
    public class PostBriefForAdminDto : PostBriefDto
    {
        /// &amp;lt;summary&amp;gt;
        /// ä¸»é”®
        /// &amp;lt;/summary&amp;gt;
        public int Id { get; set; }
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç„¶åæ·»åŠ æ‰€éœ€çš„å‚æ•°ï¼šå½“å‰é¡µç ã€é™åˆ¶æ¡æ•°ã€æ€»é¡µç ã€æ–‡ç« åˆ—è¡¨è¿”å›æ•°æ®æ¨¡å‹ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;/// &amp;lt;summary&amp;gt;
/// å½“å‰é¡µç 
/// &amp;lt;/summary&amp;gt;
[Parameter]
public int? page { get; set; }

/// &amp;lt;summary&amp;gt;
/// é™åˆ¶æ¡æ•°
/// &amp;lt;/summary&amp;gt;
private int Limit = 15;

/// &amp;lt;summary&amp;gt;
/// æ€»é¡µç 
/// &amp;lt;/summary&amp;gt;
private int TotalPage;

/// &amp;lt;summary&amp;gt;
/// æ–‡ç« åˆ—è¡¨æ•°æ®
/// &amp;lt;/summary&amp;gt;
private ServiceResult&amp;lt;PagedList&amp;lt;QueryPostForAdminDto&amp;gt;&amp;gt; posts;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç„¶ååœ¨åˆå§‹åŒ–å‡½æ•°&lt;code&gt;OnInitializedAsync()&lt;/code&gt;ä¸­è°ƒç”¨APIè·å–æ–‡ç« æ•°æ®.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;/// &amp;lt;summary&amp;gt;
/// åˆå§‹åŒ–
/// &amp;lt;/summary&amp;gt;
protected override async Task OnInitializedAsync()
{
    var token = await Common.GetStorageAsync(&quot;token&quot;);
    Http.DefaultRequestHeaders.Add(&quot;Authorization&quot;, $&quot;Bearer {token}&quot;);

    // è®¾ç½®é»˜è®¤å€¼
    page = page.HasValue ? page : 1;

    await RenderPage(page);
}

/// &amp;lt;summary&amp;gt;
/// ç‚¹å‡»é¡µç é‡æ–°æ¸²æŸ“æ•°æ®
/// &amp;lt;/summary&amp;gt;
/// &amp;lt;param name=&quot;page&quot;&amp;gt;&amp;lt;/param&amp;gt;
/// &amp;lt;returns&amp;gt;&amp;lt;/returns&amp;gt;
private async Task RenderPage(int? page)
{
    // è·å–æ•°æ®
    posts = await Http.GetFromJsonAsync&amp;lt;ServiceResult&amp;lt;PagedList&amp;lt;QueryPostForAdminDto&amp;gt;&amp;gt;&amp;gt;($&quot;/blog/admin/posts?page={page}&amp;amp;limit={Limit}&quot;);

    // è®¡ç®—æ€»é¡µç 
    TotalPage = (int)Math.Ceiling((posts.Result.Total / (double)Limit));
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨åˆå§‹åŒ–ä¸­åˆ¤æ–­pageå‚æ•°ï¼Œå¦‚æœæ²¡æœ‰å€¼ç»™ä»–è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼1ã€‚&lt;code&gt;RenderPage(int? page)&lt;/code&gt;æ–¹æ³•æ˜¯è°ƒç”¨APIè¿”å›æ•°æ®ï¼Œå¹¶è®¡ç®—å‡ºæ€»é¡µç å€¼ã€‚&lt;/p&gt;
&lt;p&gt;æœ€ååœ¨é¡µé¢ä¸Šè¿›è¡Œæ•°æ®ç»‘å®šã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-html&quot;&gt;&amp;lt;AdminLayout&amp;gt;
    @if (posts == null)
    {
        &amp;lt;Loading /&amp;gt;
    }
    else
    {
        &amp;lt;div class=&quot;post-wrap archive&quot;&amp;gt;
            &amp;lt;NavLink style=&quot;float:right&quot; href=&quot;/admin/post&quot;&amp;gt;&amp;lt;h3&amp;gt;ğŸ“~~~ æ–°å¢æ–‡ç«  ~~~ğŸ“&amp;lt;/h3&amp;gt;&amp;lt;/NavLink&amp;gt;
            @if (posts.Success &amp;amp;&amp;amp; posts.Result.Item.Any())
            {
                @foreach (var item in posts.Result.Item)
                {
                    &amp;lt;h3&amp;gt;@item.Year&amp;lt;/h3&amp;gt;
                    @foreach (var post in item.Posts)
                    {
                        &amp;lt;article class=&quot;archive-item&quot;&amp;gt;
                            &amp;lt;NavLink title=&quot;âŒåˆ é™¤&quot; @onclick=&quot;@(async () =&amp;gt; await DeleteAsync(post.Id))&quot;&amp;gt;âŒ&amp;lt;/NavLink&amp;gt;
                            &amp;lt;NavLink title=&quot;ğŸ“ç¼–è¾‘&quot; @onclick=&quot;@(async () =&amp;gt; await Common.NavigateTo($&quot;/admin/post/{post.Id}&quot;))&quot;&amp;gt;ğŸ“&amp;lt;/NavLink&amp;gt;
                            &amp;lt;NavLink target=&quot;_blank&quot; class=&quot;archive-item-link&quot; href=&quot;@(&quot;/post&quot; + post.Url)&quot;&amp;gt;@post.Title&amp;lt;/NavLink&amp;gt;
                            &amp;lt;span class=&quot;archive-item-date&quot;&amp;gt;@post.CreationTime&amp;lt;/span&amp;gt;
                        &amp;lt;/article&amp;gt;
                    }
                }
                &amp;lt;nav class=&quot;pagination&quot;&amp;gt;
                    @for (int i = 1; i &amp;lt;= TotalPage; i++)
                    {
                        var _page = i;

                        if (page == _page)
                        {
                            &amp;lt;span class=&quot;page-number current&quot;&amp;gt;@_page&amp;lt;/span&amp;gt;
                        }
                        else
                        {
                            &amp;lt;a class=&quot;page-number&quot; @onclick=&quot;@(() =&amp;gt; RenderPage(_page))&quot; href=&quot;/admin/posts/@_page&quot;&amp;gt;@_page&amp;lt;/a&amp;gt;
                        }
                    }
                &amp;lt;/nav&amp;gt;
            }
            else
            {
                &amp;lt;ErrorTip /&amp;gt;
            }
        &amp;lt;/div&amp;gt;
    }
&amp;lt;/AdminLayout&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;HTMLå†…å®¹æ”¾åœ¨ç»„ä»¶&lt;code&gt;AdminLayout&lt;/code&gt;ä¸­ï¼Œå½“ posts æ²¡åŠ è½½å®Œæ•°æ®çš„æ—¶å€™æ˜¾ç¤ºåŠ è½½ç»„ä»¶&lt;code&gt;&amp;lt;Loading /&amp;gt;&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é¡µé¢ä¸Šå¾ªç¯éå†æ–‡ç« æ•°æ®å’Œç¿»é¡µé¡µç ï¼Œæ¯ç¯‡æ–‡ç« æ ‡é¢˜å‰é¢æ·»åŠ ä¸¤ä¸ªæŒ‰é’®åˆ é™¤å’Œç¼–è¾‘ï¼ŒåŒæ—¶å•ç‹¬åŠ äº†ä¸€ä¸ªæ–°å¢æ–‡ç« çš„æŒ‰é’®ã€‚&lt;/p&gt;
&lt;p&gt;åˆ é™¤æ–‡ç« è°ƒç”¨&lt;code&gt;DeleteAsync(int id)&lt;/code&gt;æ–¹æ³•ï¼Œéœ€è¦ä¼ é€’å‚æ•°ï¼Œå½“å‰æ–‡ç« çš„idã€‚&lt;/p&gt;
&lt;p&gt;æ–°å¢å’Œç¼–è¾‘æŒ‰é’®éƒ½è·³è½¬åˆ°&quot;/admin/post&quot;é¡µé¢ï¼Œå½“ç¼–è¾‘çš„æ—¶å€™å°†idä¹Ÿä¼ è¿‡å»å³å¯ï¼Œè·¯ç”±è§„åˆ™ä¸ºï¼š&quot;/admin/post/{id}&quot;ã€‚&lt;/p&gt;
&lt;p&gt;åˆ é™¤æ–‡ç« ``æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;/// &amp;lt;summary&amp;gt;
/// åˆ é™¤æ–‡ç« 
/// &amp;lt;/summary&amp;gt;
/// &amp;lt;param name=&quot;id&quot;&amp;gt;&amp;lt;/param&amp;gt;
/// &amp;lt;returns&amp;gt;&amp;lt;/returns&amp;gt;
private async Task DeleteAsync(int id)
{
    // å¼¹çª—ç¡®è®¤
    bool confirmed = await Common.InvokeAsync&amp;lt;bool&amp;gt;(&quot;confirm&quot;, &quot;\nğŸ’¥ğŸ’¢çœŸçš„è¦å¹²æ‰è¿™ç¯‡è¯¥æ­»çš„æ–‡ç« å—ğŸ’¢ğŸ’¥&quot;);

    if (confirmed)
    {
        var response = await Http.DeleteAsync($&quot;/blog/post?id={id}&quot;);

        var result = await response.Content.ReadFromJsonAsync&amp;lt;ServiceResult&amp;gt;();

        if (result.Success)
        {
            await RenderPage(page);
        }
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åˆ é™¤ä¹‹å‰è¿›è¡ŒäºŒæ¬¡ç¡®è®¤ï¼Œé¿å…è¯¯åˆ ï¼Œå½“ç¡®è®¤åˆ é™¤ä¹‹åè°ƒç”¨åˆ é™¤æ–‡ç« APIï¼Œæœ€åé‡æ–°æ¸²æŸ“æ•°æ®å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/891843/202006/891843-20200614202156563-532339787.gif&quot; alt=&quot;2&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;æ–°å¢--æ›´æ–°æ–‡ç« &quot;&gt;æ–°å¢ &amp;amp; æ›´æ–°æ–‡ç« &lt;/h2&gt;
&lt;p&gt;å®Œæˆäº†åå°æ–‡ç« åˆ—è¡¨çš„æŸ¥è¯¢å’Œåˆ é™¤ï¼Œç°åœ¨æ•´ä¸ªåšå®¢æ¨¡å—åŠŸèƒ½å°±å·®æ–°å¢å’Œæ›´æ–°æ–‡ç« äº†ï¼Œèƒœåˆ©å°±åœ¨å‰æ–¹ï¼Œå†²å•Šã€‚&lt;/p&gt;
&lt;p&gt;è¿™å—çš„å¼€å‘å·¥ä½œè€—è´¹äº†æˆ‘å¤ªå¤šæ—¶é—´ï¼Œå› ä¸ºæƒ³ä½¿ç”¨ markdown æ¥å†™æ–‡ç« ï¼Œæ‰¾äº†ä¸€åœˆä¸‹æ¥æ²¡æœ‰ä¸€ä¸ªåˆé€‚çš„ç»„ä»¶ï¼Œæ‰€ä»¥é€€è€Œæ±‚æ¬¡åªèƒ½é€‰æ‹©ç°æœ‰çš„markdownç¼–è¾‘å™¨æ¥å®ç°äº†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è¿™é‡Œé€‰æ‹©äº†å¼€æºçš„ç¼–è¾‘å™¨&lt;code&gt;Editor.md&lt;/code&gt;ï¼Œæœ‰éœ€è¦çš„å¯ä»¥å» Github è‡ªå·±ä¸‹è½½ï¼Œ&lt;a href=&quot;https://github.com/pandao/editor.md&quot;&gt;https://github.com/pandao/editor.md&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;p&gt;å°†ä¸‹è½½çš„èµ„æºåŒ…è§£å‹æ”¾åœ¨ wwwroot æ–‡ä»¶å¤¹ä¸‹ï¼Œé»˜è®¤æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œè€Œä¸”è¿˜æœ‰å¾ˆå¤šç¤ºä¾‹æ–‡ä»¶ï¼Œæˆ‘å·²ç»å°†å…¶ç²¾ç®€äº†ä¸€ç•ªï¼Œå¯ä»¥å»æˆ‘ Github ä¸‹è½½ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆæ¥çœ‹ä¸‹æœ€ç»ˆçš„æˆå“æ•ˆæœå§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/891843/202006/891843-20200614214938404-633246509.png&quot; alt=&quot;3&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ˜¯ä¸æ˜¯æ„Ÿè§‰è¿˜å¯ä»¥ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œæ¥ä¸‹é‡Œå‘Šè¯‰å¤§å®¶å¦‚ä½•å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Admin æ–‡ä»¶å¤¹ä¸‹æ·»åŠ &lt;code&gt;post.razor&lt;/code&gt;ç»„ä»¶ï¼Œè®¾ç½®è·¯ç”±ï¼Œå¹¶ä¸”å¼•ç”¨ä¸€ä¸ªæ ·å¼æ–‡ä»¶ï¼Œåœ¨é¡µé¢ä¸­å¼•ç”¨æ ·å¼æ–‡ä»¶å¥½åƒä¸å¤ªç¬¦åˆæ ‡å‡†ï¼Œä¸è¿‡æ— æ‰€è°“äº†ï¼Œè¿™ä¸ªåå°å°±è‡ªå·±ç”¨ï¼Œè€Œä¸”è¿˜å°±è¿™ä¸€ä¸ªé¡µé¢ç”¨å¾—åˆ°ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-html&quot;&gt;@page &quot;/admin/post&quot;
@page &quot;/admin/post/{id:int}&quot;

&amp;lt;link href=&quot;./editor.md/css/editormd.css&quot; rel=&quot;stylesheet&quot; /&amp;gt;

&amp;lt;AdminLayout&amp;gt;
    ...
&amp;lt;/AdminLayout&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æŠŠå…·ä½“HTMLå†…å®¹æ”¾åœ¨ç»„ä»¶&lt;code&gt;AdminLayout&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºæ–°å¢å’Œç¼–è¾‘æ”¾åœ¨åŒä¸€ä¸ªé¡µé¢ä¸Šï¼Œæ‰€ä»¥å½“idå‚æ•°ä¸ä¸ºç©ºçš„æ—¶å€™éœ€è¦æ·»åŠ ä¸€ä¸ªidå‚æ•°ï¼ŒåŒæ—¶é»˜è®¤ä¸€è¿›æ¥å°±è®©é¡µé¢æ˜¾ç¤ºåŠ è½½ä¸­çš„ç»„ä»¶ï¼Œå½“é¡µé¢å’Œæ•°æ®åŠ è½½å®Œæˆååœ¨æ˜¾ç¤ºå…·ä½“çš„å†…å®¹ï¼Œæ‰€ä»¥åœ¨æŒ‡å®šä¸€ä¸ªå¸ƒå°”ç±»å‹çš„æ˜¯å¦åŠ è½½å‚æ•°&lt;code&gt;isLoading&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„ç¼–è¾‘å™¨ä¸»è¦ä¾èµ–JavaScriptå®ç°çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¸å¯é¿å…è¦ä½¿ç”¨åˆ°JavaScriptäº†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨&lt;code&gt;app.js&lt;/code&gt;ä¸­æ·»åŠ å‡ ä¸ªå…¨å±€å‡½æ•°ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-javascript&quot;&gt;switchEditorTheme: function () {
    editor.setTheme(localStorage.editorTheme || 'default');
    editor.setEditorTheme(localStorage.editorTheme === 'dark' ? 'pastel-on-dark' : 'default');
    editor.setPreviewTheme(localStorage.editorTheme || 'default');
},
renderEditor: async function () {
        await this._loadScript('./editor.md/lib/zepto.min.js').then(function () {
            func._loadScript('./editor.md/editormd.js').then(function () {
                editor = editormd(&quot;editor&quot;, {
                    width: &quot;100%&quot;,
                    height: 700,
                    path: './editor.md/lib/',
                    codeFold: true,
                    saveHTMLToTextarea: true,
                    emoji: true,
                    atLink: false,
                    emailLink: false,
                    theme: localStorage.editorTheme || 'default',
                    editorTheme: localStorage.editorTheme === 'dark' ? 'pastel-on-dark' : 'default',
                    previewTheme: localStorage.editorTheme || 'default',
                    toolbarIcons: function () {
                        return [&quot;bold&quot;, &quot;del&quot;, &quot;italic&quot;, &quot;quote&quot;, &quot;ucwords&quot;, &quot;uppercase&quot;, &quot;lowercase&quot;, &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;, &quot;h6&quot;, &quot;list-ul&quot;, &quot;list-ol&quot;, &quot;hr&quot;, &quot;link&quot;, &quot;image&quot;, &quot;code&quot;, &quot;preformatted-text&quot;, &quot;code-block&quot;, &quot;table&quot;, &quot;datetime&quot;, &quot;html-entities&quot;, &quot;emoji&quot;, &quot;watch&quot;, &quot;preview&quot;, &quot;fullscreen&quot;, &quot;clear&quot;, &quot;||&quot;, &quot;save&quot;]
                    },
                    toolbarIconsClass: {
                        save: &quot;fa-check&quot;
                    },
                    toolbarHandlers: {
                        save: function () {
                            func._shoowBox();
                        }
                    },
                    onload: function () {
                        this.addKeyMap({
                            &quot;Ctrl-S&quot;: function () {
                                func._shoowBox();
                            }
                        });
                    }
                });
            });
        });
},
_shoowBox: function () {
    DotNet.invokeMethodAsync('Meowv.Blog.BlazorApp', 'showbox');
},
_loadScript: async function (url) {
    let response = await fetch(url);
    var js = await response.text();
    eval(js);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;renderEditor&lt;/code&gt;ä¸»è¦å®ç°äº†åŠ¨æ€åŠ è½½JavaScriptä»£ç ï¼Œå°†markdownç¼–è¾‘å™¨æ¸²æŸ“å‡ºæ¥ã€‚è¿™é‡Œä¸å¤šè¯´ï¼Œéƒ½æ˜¯&lt;code&gt;Editor.md&lt;/code&gt;ç¤ºä¾‹é‡Œé¢çš„ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å…¼å®¹æš—é»‘è‰²ä¸»é¢˜ï¼Œè¿™é‡Œè¿˜åŠ äº†ä¸€ä¸ªåˆ‡æ¢ç¼–è¾‘å™¨ä¸»é¢˜çš„JavaScriptæ–¹æ³•ï¼Œ&lt;code&gt;switchEditorTheme&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;_shoowBox&lt;/code&gt;å°±å‰å®³äº†ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯è°ƒç”¨çš„.NETç»„ä»¶ä¸­çš„æ–¹æ³•ï¼Œå‰é¢æˆ‘ä»¬ç”¨è¿‡äº†åœ¨Blazorä¸­è°ƒç”¨JavaScriptï¼Œè¿™é‡Œæ¼”ç¤ºäº†JavaScriptä¸­è°ƒç”¨Blazorä¸­çš„ç»„ä»¶æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨å°†æ‰€éœ€çš„å‡ ä¸ªå‚æ•°éƒ½æ·»åŠ åˆ°ä»£ç ä¸­ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;/// &amp;lt;summary&amp;gt;
/// å®šä¹‰ä¸€ä¸ªå§”æ‰˜æ–¹æ³•ï¼Œç”¨äºç»„ä»¶å®ä¾‹æ–¹æ³•è°ƒç”¨
/// &amp;lt;/summary&amp;gt;
private static Func&amp;lt;Task&amp;gt; action;

/// &amp;lt;summary&amp;gt;
/// é»˜è®¤éšè—Box
/// &amp;lt;/summary&amp;gt;
private bool Open { get; set; } = false;

/// &amp;lt;summary&amp;gt;
/// ä¿®æ”¹æ—¶çš„æ–‡ç« Id
/// &amp;lt;/summary&amp;gt;
[Parameter]
public int? Id { get; set; }

/// &amp;lt;summary&amp;gt;
/// æ ¼å¼åŒ–çš„æ ‡ç­¾
/// &amp;lt;/summary&amp;gt;
private string tags { get; set; }

/// &amp;lt;summary&amp;gt;
/// é»˜è®¤æ˜¾ç¤ºåŠ è½½ä¸­
/// &amp;lt;/summary&amp;gt;
private bool isLoading = true;

/// &amp;lt;summary&amp;gt;
/// æ–‡ç« æ–°å¢æˆ–è€…ä¿®æ”¹è¾“å…¥å‚æ•°
/// &amp;lt;/summary&amp;gt;
private PostForAdminDto input;

/// &amp;lt;summary&amp;gt;
/// APIè¿”å›çš„åˆ†ç±»åˆ—è¡¨æ•°æ®
/// &amp;lt;/summary&amp;gt;
private ServiceResult&amp;lt;IEnumerable&amp;lt;QueryCategoryForAdminDto&amp;gt;&amp;gt; categories;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¤§å®¶çœ‹çœ‹æ³¨é‡Šå°±çŸ¥é“å‚æ•°æ˜¯åšä»€ä¹ˆçš„äº†ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬åœ¨åˆå§‹åŒ–å‡½æ•°ä¸­å°†æ‰€éœ€çš„æ•°æ®é€šè¿‡APIè·å–åˆ°ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;/// &amp;lt;summary&amp;gt;
/// åˆå§‹åŒ–
/// &amp;lt;/summary&amp;gt;
/// &amp;lt;returns&amp;gt;&amp;lt;/returns&amp;gt;
protected override async Task OnInitializedAsync()
{
    action = ChangeOpenStatus;

    var token = await Common.GetStorageAsync(&quot;token&quot;);
    Http.DefaultRequestHeaders.Add(&quot;Authorization&quot;, $&quot;Bearer {token}&quot;);

    if (Id.HasValue)
    {
        var post = await Http.GetFromJsonAsync&amp;lt;ServiceResult&amp;lt;PostForAdminDto&amp;gt;&amp;gt;($&quot;/blog/admin/post?id={Id}&quot;);

        if (post.Success)
        {
            var _post = post.Result;
            input = new PostForAdminDto
            {
                Title = _post.Title,
                Author = _post.Author,
                Url = _post.Url,
                Html = _post.Html,
                Markdown = _post.Markdown,
                CategoryId = _post.CategoryId,
                Tags = _post.Tags,
                CreationTime = _post.CreationTime
            };

            tags = string.Join(&quot;,&quot;, input.Tags);
        }
    }
    else
    {
        input = new PostForAdminDto()
        {
            Author = &quot;é˜¿æ˜ŸPlus&quot;,
            CreationTime = DateTime.Now
        };
    }

    categories = await Http.GetFromJsonAsync&amp;lt;ServiceResult&amp;lt;IEnumerable&amp;lt;QueryCategoryForAdminDto&amp;gt;&amp;gt;&amp;gt;(&quot;/blog/admin/categories&quot;);

    // æ¸²æŸ“ç¼–è¾‘å™¨
    await Common.InvokeAsync(&quot;window.func.renderEditor&quot;);

    // å…³é—­åŠ è½½
    isLoading = !isLoading;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;actionæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„å§”æ‰˜ï¼Œåœ¨åˆå§‹åŒ–ä¸­æ‰§è¡Œäº†&lt;code&gt;ChangeOpenStatus&lt;/code&gt;æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç­‰ä¼šè¯´ï¼Œç„¶åè·å–&lt;code&gt;localStorage&lt;/code&gt;ä¸­tokençš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡å‚æ•°Idæ˜¯å¦æœ‰å€¼æ¥åˆ¤æ–­å½“å‰æ˜¯æ–°å¢æ–‡ç« è¿˜æ˜¯æ›´æ–°æ–‡ç« ï¼Œå¦‚æœæœ‰å€¼å°±æ˜¯æ›´æ–°æ–‡ç« ï¼Œè¿™æ—¶å€™éœ€è¦æ ¹æ®idå»å°†æ–‡ç« çš„æ•°æ®æ‹¿åˆ°èµ‹å€¼ç»™&lt;code&gt;PostForAdminDto&lt;/code&gt;å¯¹è±¡å±•ç¤ºåœ¨é¡µé¢ä¸Šï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥æ·»åŠ å‡ ä¸ªé»˜è®¤å€¼ç»™&lt;code&gt;PostForAdminDto&lt;/code&gt;å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºæ–‡ç« éœ€è¦åˆ†ç±»å’Œæ ‡ç­¾çš„æ•°æ®ï¼ŒåŒæ—¶è¿™é‡Œå°†åˆ†ç±»çš„æ•°æ®ä¹ŸæŸ¥å‡ºæ¥ï¼Œæ ‡ç­¾é»˜è®¤æ˜¯Liståˆ—è¡¨ï¼Œå°†å…¶è½¬æ¢æˆå­—ç¬¦ä¸²ç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;ä½†å®Œæˆä¸Šé¢æ“ä½œåï¼Œè°ƒç”¨JavaScriptæ–¹æ³•&lt;code&gt;renderEditor&lt;/code&gt;æ¸²æŸ“æ¸²æŸ“ç¼–è¾‘å™¨ï¼Œæœ€åå…³é—­åŠ è½½ï¼Œæ˜¾ç¤ºé¡µé¢ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æ¥çœ‹çœ‹é¡µé¢ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-html&quot;&gt;&amp;lt;AdminLayout&amp;gt;
    @if (isLoading)
    {
        &amp;lt;Loading /&amp;gt;
    }
    else
    {
        &amp;lt;div class=&quot;post-box&quot;&amp;gt;
            &amp;lt;div class=&quot;post-box-item&quot;&amp;gt;
                &amp;lt;input type=&quot;text&quot; placeholder=&quot;æ ‡é¢˜&quot; autocomplete=&quot;off&quot; @bind=&quot;@input.Title&quot; @bind:event=&quot;oninput&quot; @onclick=&quot;@(() =&amp;gt; { Open = false; })&quot; /&amp;gt;
                &amp;lt;input type=&quot;text&quot; placeholder=&quot;ä½œè€…&quot; autocomplete=&quot;off&quot; @bind=&quot;@input.Author&quot; @bind:event=&quot;oninput&quot; @onclick=&quot;@(() =&amp;gt; { Open = false; })&quot; /&amp;gt;
            &amp;lt;/div&amp;gt;
            &amp;lt;div class=&quot;post-box-item&quot;&amp;gt;
                &amp;lt;input type=&quot;text&quot; placeholder=&quot;URL&quot; autocomplete=&quot;off&quot; @bind=&quot;@input.Url&quot; @bind:event=&quot;oninput&quot; @onclick=&quot;@(() =&amp;gt; { Open = false; })&quot; /&amp;gt;
                &amp;lt;input type=&quot;text&quot; placeholder=&quot;æ—¶é—´&quot; autocomplete=&quot;off&quot; @bind=&quot;@input.CreationTime&quot; @bind:format=&quot;yyyy-MM-dd HH:mm:sss&quot; @bind:event=&quot;oninput&quot; @onclick=&quot;@(() =&amp;gt; { Open = false; })&quot; /&amp;gt;
            &amp;lt;/div&amp;gt;
            &amp;lt;div id=&quot;editor&quot;&amp;gt;
                &amp;lt;textarea style=&quot;display:none;&quot;&amp;gt;@input.Markdown&amp;lt;/textarea&amp;gt;
            &amp;lt;/div&amp;gt;

            &amp;lt;Box OnClickCallback=&quot;@SubmitAsync&quot; Open=&quot;@Open&quot; ButtonText=&quot;å‘å¸ƒ&quot;&amp;gt;
                &amp;lt;div class=&quot;box-item&quot;&amp;gt;
                    &amp;lt;b&amp;gt;åˆ†ç±»ï¼š&amp;lt;/b&amp;gt;
                    @if (categories.Success &amp;amp;&amp;amp; categories.Result.Any())
                    {
                        @foreach (var item in categories.Result)
                        {
                            &amp;lt;label&amp;gt;&amp;lt;input type=&quot;radio&quot; name=&quot;category&quot; value=&quot;@item.Id&quot; @onchange=&quot;@(() =&amp;gt; { input.CategoryId = item.Id; })&quot; checked=&quot;@(item.Id == input.CategoryId)&quot; /&amp;gt;@item.CategoryName&amp;lt;/label&amp;gt;
                        }
                    }
                &amp;lt;/div&amp;gt;
                &amp;lt;div class=&quot;box-item&quot;&amp;gt;&amp;lt;/div&amp;gt;
                &amp;lt;div class=&quot;box-item&quot;&amp;gt;
                    &amp;lt;b&amp;gt;æ ‡ç­¾ï¼š&amp;lt;/b&amp;gt;
                    &amp;lt;input type=&quot;text&quot; @bind=&quot;@tags&quot; @bind:event=&quot;oninput&quot; /&amp;gt;
                &amp;lt;/div&amp;gt;
            &amp;lt;/Box&amp;gt;
        &amp;lt;/div&amp;gt;
    }
&amp;lt;/AdminLayout&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ·»åŠ äº†å››ä¸ªinputæ¡†ï¼Œåˆ†åˆ«ç”¨æ¥ç»‘å®šæ ‡é¢˜ã€ä½œè€…ã€URLã€æ—¶é—´ï¼Œ&lt;code&gt;&amp;lt;div id=&quot;editor&quot;&amp;gt;&amp;lt;/div&amp;gt;&lt;/code&gt;ä¸­ä¸ºç¼–è¾‘å™¨æ‰€éœ€ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åæˆ‘è¿™é‡Œè¿˜æ˜¯æŠŠä¹‹å‰çš„å¼¹çª—ç»„ä»¶æå‡ºæ¥äº†ï¼Œæ‰§è¡Œé€»è¾‘ä¸ä»‹ç»äº†ï¼Œåœ¨å¼¹çª—ç»„ä»¶ä¸­è‡ªå®šä¹‰æ˜¾ç¤ºåˆ†ç±»å’Œæ ‡ç­¾çš„å†…å®¹ï¼Œå°†è·å–åˆ°çš„åˆ†ç±»å’Œæ ‡ç­¾ç»‘å®šåˆ°å…·ä½“ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªåˆ†ç±»éƒ½æ˜¯ä¸€ä¸ªradioæ ‡ç­¾ï¼Œå¹¶ä¸”å¯¹åº”ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å“ªä¸ªå°±æŠŠå½“å‰åˆ†ç±»çš„Idèµ‹å€¼ç»™&lt;code&gt;PostForAdminDto&lt;/code&gt;å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰çš„inputæ¡†éƒ½ä½¿ç”¨&lt;code&gt;@bind&lt;/code&gt;å’Œ&lt;code&gt;@bind:event&lt;/code&gt;ç»‘å®šæ•°æ®å’Œè·å–æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Box&lt;/code&gt;å¼¹çª—ç»„ä»¶è¿™é‡Œè‡ªå®šä¹‰äº†æŒ‰é’®æ–‡å­—ï¼Œ&lt;code&gt;ButtonText=&quot;å‘å¸ƒ&quot;&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;/// &amp;lt;summary&amp;gt;
/// æ”¹å˜OpençŠ¶æ€ï¼Œé€šçŸ¥ç»„ä»¶æ¸²æŸ“
/// &amp;lt;/summary&amp;gt;
private async Task ChangeOpenStatus()
{
    Open = true;

    var markdown = await Common.InvokeAsync&amp;lt;string&amp;gt;(&quot;editor.getMarkdown&quot;);
    var html = await Common.InvokeAsync&amp;lt;string&amp;gt;(&quot;editor.getHTML&quot;);

    if (string.IsNullOrEmpty(input.Title) || string.IsNullOrEmpty(input.Url) ||
        string.IsNullOrEmpty(input.Author) || string.IsNullOrEmpty(markdown) ||
        string.IsNullOrEmpty(html))
    {
        await Alert();
    }

    input.Html = html;
    input.Markdown = markdown;

    StateHasChanged();
}

/// &amp;lt;summary&amp;gt;
/// æš´æ¼ç»™JSæ‰§è¡Œï¼Œå¼¹çª—ç¡®è®¤æ¡†
/// &amp;lt;/summary&amp;gt;
[JSInvokable(&quot;showbox&quot;)]
public static void ShowBox()
{
    action.Invoke();
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;/// &amp;lt;summary&amp;gt;
/// alertæç¤º
/// &amp;lt;/summary&amp;gt;
/// &amp;lt;returns&amp;gt;&amp;lt;/returns&amp;gt;
private async Task Alert()
{
    Open = false;

    await Common.InvokeAsync(&quot;alert&quot;, &quot;\nğŸ’¥ğŸ’¢å¥½åƒæ¼äº†ç‚¹ä»€ä¹ˆå§ğŸ’¢ğŸ’¥&quot;);
    return;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç°åœ¨å¯ä»¥æ¥çœ‹çœ‹&lt;code&gt;ChangeOpenStatus&lt;/code&gt;æ–¹æ³•äº†ï¼Œè¿™ä¸ªæ˜¯æ”¹å˜å½“å‰å¼¹çª—çŠ¶æ€çš„ä¸€ä¸ªæ–¹æ³•ã€‚ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªæ–¹æ³•å‘¢?&lt;/p&gt;
&lt;p&gt;å› ä¸ºåœ¨Blazorä¸­JavaScriptæƒ³è¦è°ƒç”¨ç»„ä»¶å†…çš„æ–¹æ³•ï¼Œæ–¹æ³•å¿…é¡»æ˜¯é™æ€çš„ï¼Œé‚£ä¹ˆåªèƒ½é€šè¿‡è¿™ç§æ–¹å¼å»å®ç°äº†ï¼Œåœ¨é™æ€æ–¹æ³•æ˜¯ä¸èƒ½å¤Ÿç›´æ¥æ”¹å˜å¼¹çª—çš„çŠ¶æ€å€¼çš„ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®ä¹Ÿå¯ä»¥ä¸ç”¨è¿™ä¹ˆéº»çƒ¦ï¼Œå› ä¸ºæˆ‘åœ¨ç¼–è¾‘å™¨ä¸Šè‡ªå®šä¹‰äº†ä¸€ä¸ªæŒ‰é’®ï¼Œä¸ºäº†å¥½çœ‹ä¸€äº›æ‰€ä»¥åªèƒ½æ›²æŠ˜ä¸€ç‚¹ï¼Œå«Œéº»çƒ¦çš„å¯ä»¥ç›´æ¥åœ¨é¡µé¢ä¸Šæä¸ªæŒ‰é’®æ‰§è¡Œä¿å­˜æ•°æ®é€»è¾‘ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;JSInvokable&lt;/code&gt;Attributeéœ€è¦åœ¨&lt;code&gt;_Imports.razor&lt;/code&gt;ä¸­æ·»åŠ å‘½åç©ºé—´&lt;code&gt;@using Microsoft.JSInterop&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ChangeOpenStatus&lt;/code&gt;ä¸­è·å–åˆ°æ–‡ç« å†…å®¹ï¼šHTMLå’Œmarkdownï¼Œèµ‹å€¼ç»™&lt;code&gt;PostForAdminDto&lt;/code&gt;å¯¹è±¡ï¼Œè¦å…ˆè¿›è¡Œåˆ¤æ–­é¡µé¢ä¸Šçš„å‡ ä¸ªå‚æ•°æ˜¯å¦æœ‰å€¼ï¼Œæ²¡å€¼çš„è¯ç»™å‡ºæç¤ºæ‰§è¡Œ&lt;code&gt;Alert()&lt;/code&gt;æ–¹æ³•ï¼Œæœ€åä½¿ç”¨&lt;code&gt;StateHasChanged()&lt;/code&gt;é€šçŸ¥ç»„ä»¶å…¶çŠ¶æ€å·²æ›´æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Alert&lt;/code&gt;æ–¹æ³•å°±æ˜¯è°ƒç”¨åŸç”Ÿçš„JavaScript&lt;code&gt;alert&lt;/code&gt;æ–¹æ³•ï¼Œç»™å‡ºä¸€ä¸ªæç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ShowBox&lt;/code&gt;å°±æ˜¯æš´æ¼ç»™JavaScriptçš„æ–¹æ³•ï¼Œä½¿ç”¨&lt;code&gt;DotNet.invokeMethodAsync('Meowv.Blog.BlazorApp', 'showbox');&lt;/code&gt;è¿›è¡Œè°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆç°åœ¨ä¸€åˆ‡éƒ½æ­£å¸¸è¿›è¡Œçš„æƒ…å†µä¸‹ï¼Œç‚¹å‡»ç¼–è¾‘å™¨ä¸Šè‡ªå®šä¹‰çš„ä¿å­˜æŒ‰é’®ï¼Œé¡µé¢ä¸Šå€¼ä¸ä¸ºç©ºçš„æƒ…å†µä¸‹å°±ä¼šå¼¹å‡ºæˆ‘ä»¬çš„å¼¹çª—ç»„ä»¶&lt;code&gt;Box&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ€ååœ¨å¼¹çª—ç»„ä»¶çš„å›è°ƒæ–¹æ³•ä¸­æ‰§è¡Œæ–°å¢æ–‡ç« è¿˜æ˜¯æ›´æ–°æ–‡ç« ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;/// &amp;lt;summary&amp;gt;
/// ç¡®è®¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
/// &amp;lt;/summary&amp;gt;
/// &amp;lt;returns&amp;gt;&amp;lt;/returns&amp;gt;
private async Task SubmitAsync()
{
    if (string.IsNullOrEmpty(tags) || input.CategoryId == 0)
    {
        await Alert();
    }

    input.Tags = tags.Split(&quot;,&quot;);

    var responseMessage = new HttpResponseMessage();

    if (Id.HasValue)
        responseMessage = await Http.PutAsJsonAsync($&quot;/blog/post?id={Id}&quot;, input);
    else
        responseMessage = await Http.PostAsJsonAsync(&quot;/blog/post&quot;, input);

    var result = await responseMessage.Content.ReadFromJsonAsync&amp;lt;ServiceResult&amp;gt;();
    if (result.Success)
    {
        await Common.NavigateTo(&quot;/admin/posts&quot;);
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ‰“å¼€å¼¹çª—åæ‰§è¡Œå›è°ƒäº‹ä»¶ä¹‹å‰è¿˜æ˜¯è¦åˆ¤æ–­å€¼æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºçš„æƒ…å†µä¸‹è¿˜æ˜¯ç»™å‡º&lt;code&gt;alert&lt;/code&gt;æç¤ºï¼Œæ­¤æ—¶å°†tagsæ ‡ç­¾è¿˜æ˜¯è½¬æ¢æˆListåˆ—è¡¨ï¼Œæ ¹æ®Idæ˜¯å¦æœ‰å€¼å»æ‰§è¡Œæ–°å¢æ•°æ®æˆ–è€…æ›´æ–°æ•°æ®ï¼Œæœ€ç»ˆæˆåŠŸåè·³è½¬åˆ°æ–‡ç« åˆ—è¡¨é¡µã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/891843/202006/891843-20200614215750117-640132844.gif&quot; alt=&quot;4&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/891843/202006/891843-20200614215755962-368836717.gif&quot; alt=&quot;5&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ç‰‡åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œä¸»è¦æ”»å…‹äº†åœ¨Blazorä¸­ä½¿ç”¨Markdownç¼–è¾‘å™¨å®ç°æ–°å¢å’Œæ›´æ–°æ–‡ç« ï¼Œè¿™ä¸ªç³»åˆ—å·®ä¸å¤šå°±å¿«ç»“æŸäº†ï¼Œé¢„è®¡è¿˜æœ‰2ç¯‡çš„æ ·å­ï¼Œæ„Ÿè°¢å„ä½çš„æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;å¼€æºåœ°å€ï¼š&lt;a href=&quot;https://github.com/Meowv/Blog/tree/blog_tutorial&quot;&gt;https://github.com/Meowv/Blog/tree/blog_tutorial&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 17 Jun 2020 00:54:00 +0000</pubDate>
<dc:creator>é˜¿æ˜ŸPlus</dc:creator>
<og:description>ç³»åˆ—æ–‡ç«  åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - ä½¿ç”¨ abp cli æ­å»ºé¡¹ç›® åŸºäº abp vNext å’Œ .NET Core å¼€å‘åšå®¢é¡¹ç›® - ç»™é¡¹ç›®ç˜¦èº«ï¼Œè®©å®ƒè·‘èµ·æ¥</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/meowv/p/13124967.html</dc:identifier>
</item>
<item>
<title>Spring Cloud Alibabaç³»åˆ—ï¼ˆå››ï¼‰ä½¿ç”¨gatewayä½œä¸ºæœåŠ¡ç½‘å…³ - Javaæ—…é€”</title>
<link>http://www.cnblogs.com/zhixie/p/13150402.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/zhixie/p/13150402.html</guid>
<description>&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯ç½‘å…³&quot;&gt;ä»€ä¹ˆæ˜¯ç½‘å…³&lt;/h2&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;åœ¨å¾®æœåŠ¡æ¶æ„é‡Œï¼ŒæœåŠ¡çš„ç²’åº¦è¢«è¿›ä¸€æ­¥ç»†åˆ†ï¼Œå„ä¸ªä¸šåŠ¡æœåŠ¡å¯ä»¥è¢«ç‹¬ç«‹çš„è®¾è®¡ã€å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²å’Œç®¡ç†ã€‚è¿™æ—¶ï¼Œå„ä¸ªç‹¬ç«‹éƒ¨ç½²å•å…ƒå¯ä»¥ç”¨ä¸åŒçš„å¼€å‘æµ‹è¯•å›¢é˜Ÿç»´æŠ¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å’ŒæŠ€æœ¯å¹³å°è¿›è¡Œè®¾è®¡ï¼Œè¿™å°±è¦æ±‚å¿…é¡»ä½¿ç”¨ä¸€ç§è¯­è¨€å’Œå¹³å°æ— å…³çš„æœåŠ¡åè®®ä½œä¸ºå„ä¸ªå•å…ƒé—´çš„é€šè®¯æ–¹å¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¢å¥è¯è¯´å°±æ˜¯ç½‘å…³ä¸ºæ‰€æœ‰çš„è¯·æ±‚æä¾›äº†ç»Ÿä¸€çš„å…¥å£ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹æœåŠ¡è¯·æ±‚å’Œå“åº”åšç»Ÿä¸€ç®¡ç†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä¸ºä»€ä¹ˆè¦ç”¨ç½‘å…³&quot;&gt;ä¸ºä»€ä¹ˆè¦ç”¨ç½‘å…³&lt;/h2&gt;
&lt;p&gt;API ç½‘å…³æ˜¯ä¸€ä¸ªå¤„äºåº”ç”¨ç¨‹åºæˆ–æœåŠ¡ï¼ˆæä¾› REST API æ¥å£æœåŠ¡ï¼‰ä¹‹å‰çš„ç³»ç»Ÿï¼Œç”¨æ¥ç®¡ç†æˆæƒã€è®¿é—®æ§åˆ¶å’Œæµé‡é™åˆ¶ç­‰ï¼Œè¿™æ · REST API æ¥å£æœåŠ¡å°±è¢« API ç½‘å…³ä¿æŠ¤èµ·æ¥ï¼Œå¯¹æ‰€æœ‰çš„è°ƒç”¨è€…é€æ˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://i.loli.net/2020/05/06/UkVGCHc68yYTzjO.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯gateway&quot;&gt;ä»€ä¹ˆæ˜¯gateway&lt;/h2&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;Spring Cloud Gatewayæ˜¯Springå®˜æ–¹åŸºäºSpring 5.0ï¼ŒSpring Boot 2.0å’ŒProject Reactorç­‰æŠ€æœ¯å¼€å‘çš„ç½‘å…³ï¼ŒSpring Cloud Gatewayæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„ç»Ÿä¸€çš„APIè·¯ç”±ç®¡ç†æ–¹å¼ã€‚Spring Cloud Gatewayä½œä¸ºSpring Cloudç”Ÿæ€ç³»ä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£ZUULï¼Œå…¶ä¸ä»…æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ï¼Œå¹¶ä¸”åŸºäºFilteré“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ï¼Œç›‘æ§/åŸ‹ç‚¹ï¼Œå’Œé™æµç­‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;gatewayå·¥ä½œåŸç†&quot;&gt;gatewayå·¥ä½œåŸç†&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://i.loli.net/2020/05/06/UXRmb5Cclh9Wjrz.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;å®¢æˆ·ç«¯å‘Spring Cloudç½‘å…³å‘å‡ºè¯·æ±‚ã€‚å¦‚æœç½‘å…³å¤„ç†ç¨‹åºæ˜ å°„ç¡®å®šè¯·æ±‚ä¸è·¯ç”±åŒ¹é…ï¼Œåˆ™å°†å…¶å‘é€åˆ°ç½‘å…³Webå¤„ç†ç¨‹åºã€‚è¯¥å¤„ç†ç¨‹åºè¿è¡Œé€šè¿‡ç‰¹å®šäºè¯·æ±‚çš„è¿‡æ»¤å™¨é“¾å‘é€è¯·æ±‚ã€‚è¿‡æ»¤å™¨ç”±è™šçº¿åˆ†éš”çš„åŸå› æ˜¯ï¼Œè¿‡æ»¤å™¨å¯ä»¥åœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œé€»è¾‘ã€‚æ‰§è¡Œæ‰€æœ‰â€œå‰ç½®â€è¿‡æ»¤å™¨é€»è¾‘ï¼Œç„¶åå‘å‡ºä»£ç†è¯·æ±‚ã€‚å‘å‡ºä»£ç†è¯·æ±‚åï¼Œå°†æ‰§è¡Œâ€œåâ€è¿‡æ»¤å™¨é€»è¾‘ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;è·¯ç”±è§„åˆ™&quot;&gt;è·¯ç”±è§„åˆ™&lt;/h2&gt;
&lt;p&gt;è·¯ç”±å’Œè¿‡æ»¤å™¨æ˜¯gatewayä¸­éå¸¸é‡è¦çš„ä¸¤ä¸ªæ¦‚å¿µï¼Œgatewayæœ¬èº«æä¾›äº†éå¸¸ä¸°å¯Œçš„è·¯ç”±è§„åˆ™å’Œå¤šç§è¿‡æ»¤å™¨æ¥é€‚é…æˆ‘ä»¬çš„éœ€æ±‚ã€‚gatewayæä¾›äº†11ç§è·¯ç”±è§„åˆ™ï¼Œåˆ†åˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ul readability=&quot;8&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;åç½®è·¯ç”±è°“è¯å·¥å‚&lt;/p&gt;
&lt;p&gt;è¯¥è°“è¯åŒ¹é…åœ¨å½“å‰æ—¥æœŸæ—¶é—´ä¹‹åå‘ç”Ÿçš„è¯·æ±‚ã€‚å‚æ•°åä¸º After&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;å‰ç½®è·¯ç”±è°“è¯å·¥å‚&lt;/p&gt;
&lt;p&gt;è¯¥è°“è¯åŒ¹é…å½“å‰æ—¥æœŸæ—¶é—´ä¹‹å‰å‘ç”Ÿçš„è¯·æ±‚ã€‚å‚æ•°åä¸º Before&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;æ—¶é—´æ®µè·¯ç”±è°“è¯å·¥å‚&lt;/p&gt;
&lt;p&gt;è¯¥è°“è¯åŒ¹é…åœ¨datetime1ä¹‹åå’Œdatetime2ä¹‹å‰å‘ç”Ÿçš„è¯·æ±‚ã€‚å‚æ•°åä¸º Between&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;cookieè·¯ç”±è°“è¯å·¥å‚&lt;/p&gt;
&lt;p&gt;è¯¥è°“è¯åŒ¹é…å…·æœ‰ç»™å®šåç§°çš„cookieï¼Œå¹¶ä¸”å€¼åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ã€‚å‚æ•°åä¸º Cookie&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;æ ‡å¤´è·¯ç”±è°“è¯å·¥å‚&lt;/p&gt;
&lt;p&gt;è¯¥è°“è¯ä¸å…·æœ‰ç»™å®šåç§°çš„æ ‡å¤´åŒ¹é…ï¼Œå¹¶ä¸”å€¼ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚å‚æ•°åä¸º Header&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;ä¸»æœºè·¯ç”±è°“è¯å·¥å‚&lt;/p&gt;
&lt;p&gt;è¯¥è°“è¯æ˜¯æŒ‡ç”±è·¯ç”±è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…å¤šä¸ªè·¯ç”±æ—¶ç”¨,éš”å¼€ã€‚å‚æ•°åä¸º Host&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;æ–¹æ³•è·¯ç”±è°“è¯å·¥å‚&lt;/p&gt;
&lt;p&gt;è¯¥å‚æ•°æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªè¦åŒ¹é…çš„HTTPæ–¹æ³•ã€‚å‚æ•°åä¸º Method&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;è·¯å¾„è·¯ç”±è°“è¯å·¥å‚&lt;/p&gt;
&lt;p&gt;è¯¥è°“è¯æ˜¯æŒ‡åœ¨è¯·æ±‚è·¯å¾„ä¸ŠåŠ ä¸€ä¸ªå‰ç¼€ï¼Œä»¥æ­¤æ¥åŒ¹é…ã€‚å‚æ•°åä¸º Path&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æŸ¥è¯¢è·¯ç”±è°“è¯å·¥å‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;RemoteAddrè·¯ç”±è°“è¯å·¥å‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é‡é‡è·¯çº¿è°“è¯å·¥å‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;å…¶ä¸­ï¼Œæˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨çš„å°±æ˜¯&lt;strong&gt;è·¯å¾„è·¯ç”±è°“è¯å·¥å‚&lt;/strong&gt;ï¼Œé…åˆStripPrefix GatewayFilterå·¥å‚ï¼Œå®ç°æˆ‘ä»¬çš„è·¯ç”±åŒ¹é…è½¬å‘ã€‚&lt;/p&gt;
&lt;p&gt;è·¯å¾„è·¯ç”±è°“è¯å·¥å‚é…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;spring:
  cloud:
    gateway:
          discovery:
          locator:
                enabled: true # å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åç§°è¿›è¡Œè·¯ç”±
      routes:
          # è·¯ç”±idï¼Œå»ºè®®é…åˆæœåŠ¡å
        - id: demo_route 
          #åŒ¹é…è·¯ç”±å
          uri: lb://demo-provider 
          predicates:
          # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
          - Path=/demo/** 
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;é…ç½®çš„å«ä¹‰å°±æ˜¯ï¼Œå¦‚æœè¯·æ±‚è·¯å¾„ä¸­æ˜¯/demo/**ï¼Œåˆ™è½¬å‘åˆ°demo-provideræœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç½‘å…³è¿‡æ»¤å™¨&quot;&gt;ç½‘å…³è¿‡æ»¤å™¨&lt;/h2&gt;
&lt;p&gt;åœ¨spring cloud gateway 2.2.2.RELEASEç‰ˆæœ¬ä¸­ï¼Œå·²ç»é»˜è®¤å®ç°äº†30ç§è¿‡æ»¤å™¨ã€‚&lt;/p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;åºå·&lt;/th&gt;
&lt;th&gt;è¿‡æ»¤å™¨å·¥å‚&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;th&gt;å‚æ•°&lt;/th&gt;
&lt;/tr&gt;&lt;/thead&gt;&lt;tbody readability=&quot;49.5&quot;&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;AddRequestHeader&lt;/td&gt;
&lt;td&gt;ä¸ºåŸå§‹è¯·æ±‚æ·»åŠ Header&lt;/td&gt;
&lt;td&gt;Headerçš„åç§°åŠå€¼&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;AddRequestParameter&lt;/td&gt;
&lt;td&gt;ä¸ºåŸå§‹è¯·æ±‚æ·»åŠ è¯·æ±‚å‚æ•°&lt;/td&gt;
&lt;td&gt;å‚æ•°åç§°åŠå€¼&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;AddResponseHeader&lt;/td&gt;
&lt;td&gt;ä¸ºåŸå§‹å“åº”æ·»åŠ Header&lt;/td&gt;
&lt;td&gt;Headerçš„åç§°åŠå€¼&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;DedupeResponseHeader&lt;/td&gt;
&lt;td&gt;å‰”é™¤å“åº”å¤´ä¸­é‡å¤çš„å€¼&lt;/td&gt;
&lt;td&gt;éœ€è¦å»é‡çš„Headeråç§°åŠå»é‡ç­–ç•¥&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;5&lt;/td&gt;
&lt;td&gt;Hystrix&lt;/td&gt;
&lt;td&gt;ä¸ºè·¯ç”±å¼•å…¥Hystrixçš„æ–­è·¯å™¨ä¿æŠ¤&lt;/td&gt;
&lt;td&gt;HystrixCommandçš„åç§°&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;CircuitBreaker&lt;/td&gt;
&lt;td&gt;ä¸ºè·¯ç”±å¼•å…¥Resilience4Jæ–­è·¯å™¨ä¿æŠ¤&lt;/td&gt;
&lt;td&gt;CircuitBreakerçš„åç§°&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;7&lt;/td&gt;
&lt;td&gt;FallbackHeaders&lt;/td&gt;
&lt;td&gt;ä¸ºfallbackUriçš„è¯·æ±‚å¤´ä¸­æ·»åŠ å…·ä½“çš„å¼‚å¸¸ä¿¡æ¯&lt;/td&gt;
&lt;td&gt;Headerçš„åç§°&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td/&gt;
&lt;td&gt;MapRequestHeader&lt;/td&gt;
&lt;td&gt;æ›´æ–°åŸå§‹è¯·æ±‚ä¸­çš„Header&lt;/td&gt;
&lt;td&gt;Headerçš„å€¼&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;9&lt;/td&gt;
&lt;td&gt;PrefixPath&lt;/td&gt;
&lt;td&gt;ä¸ºåŸå§‹è¯·æ±‚å¤´æ·»åŠ å‰ç¼€&lt;/td&gt;
&lt;td&gt;å‰ç¼€è·¯å¾„&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;3&quot;&gt;&lt;td&gt;10&lt;/td&gt;
&lt;td&gt;PreserveHostHeader&lt;/td&gt;
&lt;td&gt;ä¸ºè¯·æ±‚æ·»åŠ preserverHostHeader=trueçš„å±æ€§ï¼Œè·¯ç”±è¿‡æ»¤å™¨ä¼šæ£€æŸ¥è¯¥å±æ€§ä»¥å†³å®šæ˜¯å¦è¦å‘é€åŸå§‹çš„host&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;11&lt;/td&gt;
&lt;td&gt;RequestRateLimiter&lt;/td&gt;
&lt;td&gt;ç”¨äºå¯¹è¯·æ±‚é™æµï¼Œé™æµç®—æ³•ä¸ºä»¤ç‰Œæ¡¶&lt;/td&gt;
&lt;td&gt;keyResolverã€rateLimiterã€statusCodeã€denyEmptyKeyã€emptyKeyStatus&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;RedirectTo&lt;/td&gt;
&lt;td&gt;å°†åŸå§‹è¯·æ±‚é‡å®šå‘åˆ°æŒ‡å®šçš„url&lt;/td&gt;
&lt;td&gt;httpçŠ¶æ€ç åŠé‡å®šå‘çš„url&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;6&quot;&gt;&lt;td&gt;13&lt;/td&gt;
&lt;td&gt;RemoveHopByHopHeadersFilter&lt;/td&gt;
&lt;td&gt;ä¸ºåŸå§‹è¯·æ±‚åˆ é™¤IETFç»„ç»‡è§„å®šçš„ä¸€ç³»åˆ—Header&lt;/td&gt;
&lt;td&gt;é»˜è®¤å°±ä¼šå¯ç”¨ï¼Œå¯ä»¥é€šè¿‡é…ç½®æŒ‡å®šä»…åˆ é™¤å“ªäº›Header&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;14&lt;/td&gt;
&lt;td&gt;RemoveRequestHeader&lt;/td&gt;
&lt;td&gt;ä¸ºåŸå§‹è¯·æ±‚åˆ é™¤æŸä¸ªHeader&lt;/td&gt;
&lt;td&gt;Headeråç§°&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;15&lt;/td&gt;
&lt;td&gt;RemoveResponseHeader&lt;/td&gt;
&lt;td&gt;ä¸ºåŸå§‹å“åº”åˆ é™¤æŸä¸ªHeader&lt;/td&gt;
&lt;td&gt;Headeråç§°&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;16&lt;/td&gt;
&lt;td&gt;RewritePath&lt;/td&gt;
&lt;td&gt;é‡å†™åŸå§‹çš„è¯·æ±‚è·¯å¾„&lt;/td&gt;
&lt;td&gt;åŸå§‹è·¯å¾„æ­£åˆ™è¡¨è¾¾å¼ä»¥åŠé‡å†™åè·¯å¾„çš„æ­£åˆ™è¡¨è¾¾å¼&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td/&gt;
&lt;td&gt;RewriteLocationResponseHeader&lt;/td&gt;
&lt;td&gt;é‡å†™å“åº”å¤´çš„&lt;code&gt;Location&lt;/code&gt; çš„å€¼&lt;/td&gt;
&lt;td/&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;18&lt;/td&gt;
&lt;td&gt;RewriteResponseHeader&lt;/td&gt;
&lt;td&gt;é‡å†™åŸå§‹å“åº”ä¸­çš„æŸä¸ªHeader&lt;/td&gt;
&lt;td&gt;Headeråç§°ï¼Œå€¼çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œé‡å†™åçš„å€¼&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;19&lt;/td&gt;
&lt;td&gt;SaveSession&lt;/td&gt;
&lt;td&gt;åœ¨è½¬å‘è¯·æ±‚ä¹‹å‰ï¼Œå¼ºåˆ¶æ‰§è¡Œ&lt;code&gt;WebSession::save&lt;/code&gt;æ“ä½œ&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;20&lt;/td&gt;
&lt;td&gt;SecureHeaders&lt;/td&gt;
&lt;td&gt;ä¸ºåŸå§‹å“åº”æ·»åŠ ä¸€ç³»åˆ—èµ·å®‰å…¨ä½œç”¨çš„å“åº”å¤´&lt;/td&gt;
&lt;td&gt;æ— ï¼Œæ”¯æŒä¿®æ”¹è¿™äº›å®‰å…¨å“åº”å¤´çš„å€¼&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;21&lt;/td&gt;
&lt;td&gt;SetPath&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹åŸå§‹çš„è¯·æ±‚è·¯å¾„&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹åçš„å€¼&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;22&lt;/td&gt;
&lt;td&gt;SetRequestHeader&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹åŸå§‹è¯·æ±‚ä¸­çš„æŸä¸ªHeaderçš„å€¼&lt;/td&gt;
&lt;td&gt;Headeråç§°ï¼Œä¿®æ”¹åçš„å€¼&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;23&lt;/td&gt;
&lt;td&gt;SetResponseHeader&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹åŸå§‹å“åº”ä¸­æŸä¸ªHeaderçš„å€¼&lt;/td&gt;
&lt;td&gt;Headeråç§°ï¼Œä¿®æ”¹åçš„å€¼&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;24&lt;/td&gt;
&lt;td&gt;SetStatus&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹åŸå§‹å“åº”çš„çŠ¶æ€ç &lt;/td&gt;
&lt;td&gt;HTTP çŠ¶æ€ç ï¼Œå¯ä»¥æ˜¯æ•°å­—ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;25&lt;/td&gt;
&lt;td&gt;StripPrefix&lt;/td&gt;
&lt;td&gt;ç”¨äºæˆªæ–­åŸå§‹è¯·æ±‚çš„è·¯å¾„&lt;/td&gt;
&lt;td&gt;ä½¿ç”¨æ•°å­—è¡¨ç¤ºè¦æˆªæ–­çš„è·¯å¾„çš„æ•°é‡&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;26&lt;/td&gt;
&lt;td&gt;Retry&lt;/td&gt;
&lt;td&gt;é’ˆå¯¹ä¸åŒçš„å“åº”è¿›è¡Œé‡è¯•&lt;/td&gt;
&lt;td&gt;retriesã€statusesã€methodsã€series&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;6&quot;&gt;&lt;td&gt;27&lt;/td&gt;
&lt;td&gt;RequestSize&lt;/td&gt;
&lt;td&gt;è®¾ç½®å…è®¸æ¥æ”¶æœ€å¤§è¯·æ±‚åŒ…çš„å¤§å°ã€‚å¦‚æœè¯·æ±‚åŒ…å¤§å°è¶…è¿‡è®¾ç½®çš„å€¼ï¼Œåˆ™è¿”å› &lt;code&gt;413 Payload Too Large&lt;/code&gt;è®¾ç½®å…è®¸æ¥æ”¶æœ€å¤§è¯·æ±‚åŒ…çš„å¤§å°ã€‚å¦‚æœè¯·æ±‚åŒ…å¤§å°è¶…è¿‡è®¾ç½®çš„å€¼ï¼Œåˆ™è¿”å› &lt;code&gt;413 Payload Too Large&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;è¯·æ±‚åŒ…å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼Œé»˜è®¤å€¼ä¸º5M&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;28&lt;/td&gt;
&lt;td&gt;ModifyRequestBody&lt;/td&gt;
&lt;td&gt;åœ¨è½¬å‘è¯·æ±‚ä¹‹å‰ä¿®æ”¹åŸå§‹è¯·æ±‚ä½“å†…å®¹&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹åçš„è¯·æ±‚ä½“å†…å®¹&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;29&lt;/td&gt;
&lt;td&gt;ModifyResponseBody&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹åŸå§‹å“åº”ä½“çš„å†…å®¹&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹åçš„å“åº”ä½“å†…å®¹&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;4&quot;&gt;&lt;td&gt;30&lt;/td&gt;
&lt;td&gt;Default&lt;/td&gt;
&lt;td&gt;ä¸ºæ‰€æœ‰è·¯ç”±æ·»åŠ è¿‡æ»¤å™¨&lt;/td&gt;
&lt;td&gt;è¿‡æ»¤å™¨å·¥å‚åç§°åŠå€¼&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;è¿™é‡Œæ¯”è¾ƒå¸¸ç”¨çš„å¦‚ç¬¬25ç§ï¼Œé…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;spring:
  cloud:
    gateway:
          discovery:
          locator:
                enabled: true # å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åç§°è¿›è¡Œè·¯ç”±
      routes:
                  # è·¯ç”±idï¼Œå»ºè®®é…åˆæœåŠ¡å
        - id: demo_route 
          #åŒ¹é…è·¯ç”±å
          uri: lb://demo-provider 
          predicates:
                  # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
          - Path=/demo/** 
          filters:
          - StripPrefix=1
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬é…åˆpathè·¯ç”±ä½¿ç”¨ï¼Œè¿™é‡Œçš„æ„æ€æ˜¯å‡å¦‚ï¼Œæˆ‘ä»¬çš„demo-provideræœåŠ¡ç§æœ‰ä¸€ä¸ª/testçš„æ¥å£ï¼Œå®é™…ä¸Šæˆ‘ä»¬çš„è¯·æ±‚è·¯å¾„ç»è¿‡ç½‘å…³æ—¶åº”è¯¥æ—¶/demo/testï¼Œè¿™æ ·å°±èƒ½æŠŠè¿™ä¸ªè·¯ç”±åˆ†å‘åˆ°demo-provideræœåŠ¡ä¸­ï¼Œä½†æ˜¯åˆ†å‘è¿‡å»çš„è·¯ç”±æ˜¯/demo/testï¼Œå’Œæˆ‘ä»¬å®é™…çš„/testæ¥å£ä¸ä¸€æ ·ã€‚è¿™æ—¶å€™æˆ‘ä»¬ç”¨StripPrefix=1ï¼Œæ¥æˆªå–æ‰ä¸€çº§è·¯ç”±ï¼Œè¿™æ ·è½¬å‘è¿‡å»çš„è·¯ç”±å°±æ˜¯/testäº†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;è‡ªå®šä¹‰ç½‘å…³è¿‡æ»¤å™¨&quot;&gt;è‡ªå®šä¹‰ç½‘å…³è¿‡æ»¤å™¨&lt;/h2&gt;
&lt;p&gt;é™¤äº†ä¸Šé¢æä¾›çš„30ç§è¿‡æ»¤å™¨å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å®ç°è‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-å®ç°gatewayfilteræ¥å£å’Œorderedæ¥å£&quot;&gt;1. å®ç°GatewayFilteræ¥å£å’ŒOrderedæ¥å£&lt;/h3&gt;
&lt;p&gt;gatewayFilteræ¥å£æ˜¯ä¸ºäº†å®ç°è¯·æ±‚è¿‡æ»¤ï¼Œorderedæ¥å£æ˜¯ä¸ºäº†ç»™è¿‡æ»¤å™¨è®¾å®šä¼˜å…ˆçº§ï¼Œå€¼è¶Šå¤§çº§åˆ«è¶Šä½ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³è¦å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ï¼Œæ— éå°±æ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼š&lt;strong&gt;1.å®ç°è¿‡æ»¤å™¨ï¼Œ2.å°†è¿‡æ»¤å™¨æ·»åŠ åˆ°å…·ä½“è·¯ç”±ä¸Šã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public class TokenGatewayFilter implements GatewayFilter, Ordered {
    @Override
    public Mono&amp;lt;Void&amp;gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {

        System.out.println(&quot;è¿™é‡Œå¤„ç†è‡ªèº«é€»è¾‘&quot;);

        return chain.filter(exchange);
    }

    @Override
    public int getOrder() {
        return 0;
    }
}

@Configuration
class RouteConfiguration{

    @Bean
    public RouteLocator routeLocator(RouteLocatorBuilder builder){

        return builder.routes().route( r-&amp;gt;
                r.path(&quot;/demo/**&quot;)
                .uri(&quot;lb://demo-provider &quot;)
                .filter(new TokenGatewayFilter())
                .id(&quot;demo_route &quot;))
                .build();
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;2ç»§æ‰¿abstractgatewayfilterfactoryç±»&quot;&gt;2.ç»§æ‰¿AbstractGatewayFilterFactoryç±»&lt;/h3&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;@Component
public class TokenCheckGatewayFilterFactory extends AbstractGatewayFilterFactory&amp;lt;TokenCheckGatewayFilterFactory.Config&amp;gt; {
    public TokenCheckGatewayFilterFactory() {
        super(Config.class);
    }

    @Override
    public List&amp;lt;String&amp;gt; shortcutFieldOrder() {
        return Arrays.asList(&quot;enabled&quot;);
    }
    @Override
    public GatewayFilter apply(Config config) {
        return (exchange, chain) -&amp;gt; {
                system.out.println(&quot;è¿™é‡Œå¤„ç†è‡ªèº«é€»è¾‘&quot;)
            return chain.filter(exchange);
        };

    }

    public static class Config {
        // æ§åˆ¶æ˜¯å¦å¼€å¯è®¤è¯
        private boolean enabled = true;

        public Config() {}

        public boolean isEnabled() {
            return enabled;
        }

        public void setEnabled(boolean enabled) {
            this.enabled = enabled;
        }
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨application.ymlä¸­ä¸ºéœ€è¦è¿‡æ»¤çš„è·¯ç”±æ·»åŠ è¿™ä¸ªè¿‡æ»¤å™¨ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;spring:
  cloud:
    gateway:
      routes:
        - id: demo_route # è·¯ç”±idï¼Œå»ºè®®é…åˆæœåŠ¡å
          uri: lb://demo-provider #åŒ¹é…è·¯ç”±å
          predicates:
          - Path=/demo/** # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
          filters:
          - TokenCheck=true
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªåœ°æ–¹è‡ªå®šä¹‰çš„è¿‡æ»¤å™¨åç§°å¿…é¡»æ˜¯XXGatewayFilterFactoryï¼Œå¹¶ä¸”é…ç½®æ–‡ä»¶ä¸­é…ç½®è¿‡æ»¤å™¨æ—¶åå­—å¿…é¡»æ—¶è¿™ä¸ªXX&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºæ¯ä¸ªè·¯ç”±éƒ½æ·»åŠ è¿™ä¸ªè¿‡æ»¤å™¨ï¼Œå¯ä»¥ç›´æ¥è¿™æ ·å†™é…ç½®ï¼Œè€Œä¸ç”¨åœ¨æ¯ä¸ªè·¯ç”±ä¸Šéƒ½å»å†™ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;spring:
  cloud:
    gateway:
      default-filters:
        - TokenCheck=true
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;3å®ç°globalfilterå’Œordered&quot;&gt;3.å®ç°GlobalFilterå’Œordered&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªGlobalFilterä»åå­—ä¸­å°±å¯ä»¥çœ‹å‡ºï¼Œæ˜¯ä¸€ä¸ªå…¨å±€è¿‡æ»¤å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®ç°è¿™ä¸ªæ¥å£åï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šè¢«è¿‡æ»¤ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦åœ¨å»æ‰¾å¾€æŸä¸ªè·¯ç”±ä¸­åŠ è¿‡æ»¤å™¨äº†ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;@Component
public class TokenGlobalFilter implements GlobalFilter, Ordered {
    @Override
    public Mono&amp;lt;Void&amp;gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        System.out.println(&quot;è¿™é‡Œå¤„ç†è‡ªèº«é€»è¾‘&quot;);
        return chain.filter(exchange);
    }

    @Override
    public int getOrder() {
        return 0;
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä»¥ä¸Šå°±æ˜¯å®ç°è‡ªå®šä¹‰ç½‘å…³è¿‡æ»¤å™¨çš„ä¸‰ç§æ–¹å¼äº†ã€‚å®é™…å¼€å‘ä¸­æ ¹æ®éœ€æ±‚æ¥å®ç°åˆé€‚çš„è¿‡æ»¤å™¨å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
</description>
<pubDate>Wed, 17 Jun 2020 00:43:00 +0000</pubDate>
<dc:creator>Javaæ—…é€”</dc:creator>
<og:description>ä»€ä¹ˆæ˜¯ç½‘å…³ åœ¨å¾®æœåŠ¡æ¶æ„é‡Œï¼ŒæœåŠ¡çš„ç²’åº¦è¢«è¿›ä¸€æ­¥ç»†åˆ†ï¼Œå„ä¸ªä¸šåŠ¡æœåŠ¡å¯ä»¥è¢«ç‹¬ç«‹çš„è®¾è®¡ã€å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²å’Œç®¡ç†ã€‚è¿™æ—¶ï¼Œå„ä¸ªç‹¬ç«‹éƒ¨ç½²å•å…ƒå¯ä»¥ç”¨ä¸åŒçš„å¼€å‘æµ‹è¯•å›¢é˜Ÿç»´æŠ¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å’ŒæŠ€æœ¯å¹³å°è¿›è¡Œè®¾è®¡ï¼Œ</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/zhixie/p/13150402.html</dc:identifier>
</item>
<item>
<title>HashSetæ‰©å®¹æœºåˆ¶åœ¨æ—¶é—´å’Œç©ºé—´ä¸Šçš„æµªè´¹ï¼Œè¿œå¤§äºä½ çš„æƒ³è±¡ - ä¸€çº¿ç å†œ</title>
<link>http://www.cnblogs.com/huangxincheng/p/13150401.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/huangxincheng/p/13150401.html</guid>
<description>&lt;h2 id=&quot;ä¸€ï¼šèƒŒæ™¯&quot;&gt;ä¸€ï¼šèƒŒæ™¯&lt;/h2&gt;
&lt;h3 id=&quot;1-è®²æ•…äº‹&quot;&gt;1. è®²æ•…äº‹&lt;/h3&gt;
&lt;p&gt;è‡ªä»è¿™ä¸ªçº¯å†…å­˜é¡¹ç›®è¿›äº†å¤§å®¢æˆ·ä¹‹åï¼Œæå¾—æˆ‘ç°åœ¨å¯¹å†…å­˜å’ŒCPUç‰¹åˆ«æ•æ„Ÿï¼Œè·‘ä¸€ç‚¹æ•°æ®å†…å­˜å‡ ä¸ªGçš„ä¸Šä¸‹ï¼Œç‰¹åˆ«æ²¡æœ‰å®‰å…¨æ„Ÿï¼Œæ€»æƒ³ç”¨windbgæŠ“å‡ ä¸ªdumpçœ‹çœ‹åˆ°åº•æ˜¯å“ªä¸€å—å¯¼è‡´çš„ï¼Œæ˜¯æˆ‘çš„ä»£ç è¿˜æ˜¯åŒäº‹çš„ä»£ç ï¼Ÿ å¾ˆå¤šçœ‹è¿‡æˆ‘åšå®¢çš„è€æœ‹å‹æ€»æ˜¯ç•™è¨€è®©æˆ‘å‡ºä¸€å¥—windbgçš„ç³»åˆ—æˆ–è€…è§†é¢‘ï¼Œæˆ‘ä¹Ÿä¸ä¼šå‘€ï¼Œæ²¡åŠæ³•ï¼Œäººåœ¨æ±Ÿæ¹–é£˜ï¼Œè¿Ÿæ—©å¾—æŒ¨ä¸Šå‡ åˆ€ï¼Œé€¼ç€ä¹Ÿå¾—ä¼šå‡ ä¸ªèŠ±æ¶å­ğŸ˜„ğŸ˜„ğŸ˜„ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œè¿™ä¸€ç¯‡å°±æ¥çœ‹çœ‹ HashSet æ˜¯å¦‚ä½•æ‰©å®¹çš„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;äºŒï¼šhashsetçš„æ‰©å®¹æœºåˆ¶&quot;&gt;äºŒï¼šHashSetçš„æ‰©å®¹æœºåˆ¶&lt;/h2&gt;
&lt;h3 id=&quot;1-å¦‚ä½•æŸ¥çœ‹&quot;&gt;1. å¦‚ä½•æŸ¥çœ‹&lt;/h3&gt;
&lt;p&gt;äº†è§£å¦‚ä½•æ‰©å®¹ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯ç¿»çœ‹HashSetåº•å±‚æºç ï¼Œæœ€ç²—æš´çš„å…¥å£ç‚¹å°±æ˜¯ &lt;code&gt;HashSet.Add&lt;/code&gt; æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://huangxincheng.oss-cn-hangzhou.aliyuncs.com/img/20200616222221.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°æœ€åçš„åˆå§‹åŒ–æ˜¯ç”¨ &lt;code&gt;Initialize&lt;/code&gt; çš„ï¼Œè€Œä¸”é‡Œé¢æœ‰è¿™ä¹ˆä¸€å¥ç¥å¥‡çš„ä»£ç : &lt;code&gt;int prime = HashHelpers.GetPrime(capacity);&lt;/code&gt;ï¼Œä»å­—é¢æ„æ€çœ‹æ˜¯è·å–ä¸€ä¸ªè´¨æ•°ï¼Œå“ˆå“ˆï¼Œæœ‰ç‚¹æ„æ€ï¼Œä»€ä¹ˆå«è´¨æ•°ï¼Ÿ ç®€å•è¯´å°±æ˜¯åªèƒ½è¢« 1 å’Œ è‡ªèº« æ•´é™¤çš„æ•°å°±å«åšè´¨æ•°ï¼Œé‚£å¥½å¥‡å¿ƒå°±æ¥äº†ï¼Œä¸€èµ·çœ‹çœ‹è´¨æ•°æ˜¯æ€ä¹ˆç®—çš„å§ï¼ å†æ¬¡æˆªå›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://huangxincheng.oss-cn-hangzhou.aliyuncs.com/img/20200616223636.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­çœ‹ï¼ŒHashSetåº•å±‚ä¸ºäº†åŠ é€Ÿé»˜è®¤å®šä¹‰å¥½äº† 72 ä¸ªè´¨æ•°ï¼Œæœ€å¤§çš„ä¸€ä¸ªè´¨æ•°æ˜¯ &lt;code&gt;719w&lt;/code&gt;ï¼Œæ¢å¥è¯å°±æ˜¯è¯´å½“å…ƒç´ ä¸ªæ•°å¤§äº 719w çš„æ—¶å€™ï¼Œå°±åªèƒ½ä½¿ç”¨ &lt;code&gt;IsPrime&lt;/code&gt; æ–¹æ³•åŠ¨æ€è®¡ç®—è´¨æ•°ï¼Œå¦‚ä¸‹ä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C#&quot;&gt;
public static bool IsPrime(int candidate)
{
        if ((candidate &amp;amp; 1) != 0)
        {
                int num = (int)Math.Sqrt(candidate);
                for (int i = 3; i &amp;lt;= num; i += 2)
                {
                        if (candidate % i == 0)
                        {
                                return false;
                        }
                }
                return true;
        }
        return candidate == 2;
}

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;çœ‹å®Œäº†æ•´ä¸ªæµç¨‹ï¼Œæˆ‘æƒ³ä½ åº”è¯¥æ˜ç™½äº†ï¼Œå½“ä½ ç¬¬ä¸€æ¬¡Addçš„æ—¶å€™ï¼Œé»˜è®¤çš„ç©ºé—´å ç”¨æ˜¯ 72 ä¸ªé¢„å®šä¹‰ä¸­æœ€å°çš„ä¸€ä¸ªè´¨æ•° 3ï¼Œçœ‹è¿‡æˆ‘ä¹‹å‰æ–‡ç« çš„æœ‹å‹çŸ¥é“Listçš„é»˜è®¤å¤§å°æ˜¯4ï¼Œåé¢å°±æ˜¯ç®€å•ç²—æš´çš„ &lt;code&gt;* 2&lt;/code&gt; å¤„ç†ï¼Œå¦‚ä¸‹ä»£ç ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C#&quot;&gt;
private void EnsureCapacity(int min)
{
        if (_items.Length &amp;lt; min)
        {
                int num = (_items.Length == 0) ? 4 : (_items.Length * 2);
        }
}

&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;2-hashset-äºŒæ¬¡æ‰©å®¹æ¢ç©¶&quot;&gt;2. HashSet äºŒæ¬¡æ‰©å®¹æ¢ç©¶&lt;/h3&gt;
&lt;p&gt;å½“HashSetçš„ä¸ªæ•°è¾¾åˆ°3ä¹‹åï¼Œå¾ˆæ˜¾ç„¶è¦è¿›è¡ŒäºŒæ¬¡æ‰©å®¹ï¼Œè¿™ä¸€ç‚¹ä¸åƒListç”¨ä¸€ä¸ª &lt;code&gt;EnsureCapacity&lt;/code&gt; æ–¹æ³•æå®šå°±å¯ä»¥äº†ï¼Œç„¶åç»†çœ‹ä¸€ä¸‹æ€ä¹ˆæ‰©å®¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://huangxincheng.oss-cn-hangzhou.aliyuncs.com/img/20200616225642.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C#&quot;&gt;
public static int ExpandPrime(int oldSize)
{
        int num = 2 * oldSize;
        if ((uint)num &amp;gt; 2146435069u &amp;amp;&amp;amp; 2146435069 &amp;gt; oldSize)
        {
                return 2146435069;
        }
        return GetPrime(num);
}

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ€åçš„æ‰©å®¹æ˜¯åœ¨ &lt;code&gt;ExpandPrime&lt;/code&gt; æ–¹æ³•ä¸­å®Œæˆçš„ï¼Œæµç¨‹å°±æ˜¯å…ˆ &lt;code&gt;* 2&lt;/code&gt;ï¼Œ å†å–æœ€æ¥è¿‘ä¸Šé™çš„ä¸€ä¸ªè´¨æ•°ï¼Œä¹Ÿå°±æ˜¯ 7 ï¼Œç„¶åå°† 7 ä½œä¸º HashSet æ–°çš„Sizeï¼Œå¦‚æœä½ éè¦çœ‹æ¼”ç¤ºï¼Œæˆ‘å°±å†™ä¸€å°æ®µä»£ç è¯æ˜ä¸€ä¸‹å§ï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://huangxincheng.oss-cn-hangzhou.aliyuncs.com/img/20200616230347.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-æ‚¨å—…å‡ºé£é™©äº†å—ï¼Ÿ&quot;&gt;2. æ‚¨å—…å‡ºé£é™©äº†å—ï¼Ÿ&lt;/h3&gt;
&lt;h4 id=&quot;1-æ—¶é—´ä¸Šçš„é£é™©&quot;&gt;&amp;lt;1&amp;gt; æ—¶é—´ä¸Šçš„é£é™©&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘æŠŠ 72 ä¸ªé¢„å®šä¹‰çš„æœ€åå‡ ä¸ªè´¨æ•°æ˜¾ç¤ºå‡ºæ¥ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C#&quot;&gt;
public static readonly int[] primes = new int[72]
{
        2009191,
        2411033,
        2893249,
        3471899,
        4166287,
        4999559,
        5999471,
        7199369
};

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“HashSetçš„å…ƒç´ ä¸ªæ•°ä¸º &lt;code&gt;2893249&lt;/code&gt; çš„æ—¶å€™è§¦å‘æ‰©å®¹å˜æˆäº† &lt;code&gt;2893249 * 2 =&amp;gt; 5786498&lt;/code&gt; æœ€æ¥è¿‘çš„ä¸€ä¸ªè´¨æ•°ä¸ºï¼š&lt;code&gt;5999471&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯ &lt;code&gt;289w&lt;/code&gt; æš´å¢åˆ°äº† &lt;code&gt;599w&lt;/code&gt;ï¼Œä¸€ä¸‹å­å°±æ˜¯ &lt;code&gt;599w -289w = 310w&lt;/code&gt; çš„ç©ºé—´è™šå ï¼Œè¿™å¯æ˜¯å¢åŠ äº†ä¸¤å€å¤šå“¦ï¼Œå“äººä¸ï¼Ÿ ä¸‹é¢å†™ä¸ªä»£ç éªŒè¯ä¸‹ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C#&quot;&gt;
        static void Main(string[] args)
        {
            var hashSet = new HashSet&amp;lt;int&amp;gt;(Enumerable.Range(0, 2893249));

            hashSet.Add(int.MaxValue);

            Console.Read();
        }

0:000&amp;gt; !clrstack -l

000000B8F4DBE500 00007ffaf00132ae ConsoleApplication3.Program.Main(System.String[]) [C:\4\ConsoleApp1\ConsoleApp1\Program.cs @ 16]
    LOCALS:
        0x000000B8F4DBE538 = 0x0000020e0b8fcc08
0:000&amp;gt; !DumpObj /d 0000020e0b8fcc08
Name:        System.Collections.Generic.HashSet`1[[System.Int32, System.Private.CoreLib]]
Size:        64(0x40) bytes
File:        C:\Program Files\dotnet\shared\Microsoft.NETCore.App\5.0.0-preview.5.20278.1\System.Collections.dll
Fields:
              MT    Field   Offset                 Type VT     Attr            Value Name
00007ffaf0096d10  4000017        8       System.Int32[]  0 instance 0000020e2025e9f8 _buckets
00007ffaf00f7ad0  4000018       10 ...ivate.CoreLib]][]  0 instance 0000020e2bea1020 _slots
00007ffaeffdf828  4000019       28         System.Int32  1 instance          2893250 _count
0:000&amp;gt; !DumpObj /d 0000020e2025e9f8
Name:        System.Int32[]
Size:        23997908(0x16e2dd4) bytes
Array:       Rank 1, Number of elements 5999471, Type Int32 (Print Array)
Fields:
None


&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://huangxincheng.oss-cn-hangzhou.aliyuncs.com/img/20200617000133.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è€Œä¸”æœ€é‡è¦çš„æ˜¯ï¼Œè¿™é‡Œæ˜¯ä¸€æ¬¡æ€§æ‰©å®¹çš„ï¼Œ&lt;span&gt;è€Œéåƒredisä¸­å®ç°çš„é‚£æ ·æ¸è¿›å¼æ‰©å®¹&lt;/span&gt;ï¼Œæ—¶é—´å¼€é”€ä¹Ÿæ˜¯å¤§å®¶å€¼å¾—æ³¨æ„çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://huangxincheng.oss-cn-hangzhou.aliyuncs.com/img/20200617074603.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-ç©ºé—´ä¸Šçš„é£é™©&quot;&gt;&amp;lt;2&amp;gt; ç©ºé—´ä¸Šçš„é£é™©&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªæœ‰ä»€ä¹ˆé£é™©å‘¢ï¼Ÿå¯ä»¥çœ‹ä¸€ä¸‹ï¼š289w å’Œ 599w ä¸¤ä¸ªHashSetçš„å ç”¨ç©ºé—´å¤§å°ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘æœ€æ•æ„Ÿçš„ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C#&quot;&gt;
        static void Main(string[] args)
        {
            var hashSet1 = new HashSet&amp;lt;int&amp;gt;(Enumerable.Range(0, 2893249));

            var hashSet2 = new HashSet&amp;lt;int&amp;gt;(Enumerable.Range(0, 2893249));
            hashSet2.Add(int.MaxValue);

            Console.Read();
        }

0:000&amp;gt; !clrstack -l
OS Thread Id: 0x4a44 (0)
000000B1B4FEE460 00007ffaf00032ea ConsoleApplication3.Program.Main(System.String[]) [C:\4\ConsoleApp1\ConsoleApp1\Program.cs @ 18]
    LOCALS:
        0x000000B1B4FEE4B8 = 0x000001d13363cc08
        0x000000B1B4FEE4B0 = 0x000001d13363d648

0:000&amp;gt; !objsize 0x000001d13363cc08
sizeof(000001D13363CC08) = 46292104 (0x2c25c88) bytes (System.Collections.Generic.HashSet`1[[System.Int32, System.Private.CoreLib]])
0:000&amp;gt; !objsize 0x000001d13363d648
sizeof(000001D13363D648) = 95991656 (0x5b8b768) bytes (System.Collections.Generic.HashSet`1[[System.Int32, System.Private.CoreLib]])

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œ hashSet1çš„å ç”¨ï¼š &lt;code&gt;46292104 / 1024 / 1024 = 44.1M&lt;/code&gt;ï¼Œ hashSet2 çš„å ç”¨ : &lt;code&gt;95991656 / 1024 / 1024 = 91.5M&lt;/code&gt;,ä¸€ä¸‹å­å°±æµªè´¹äº†ï¼š &lt;code&gt;91.5 - 44.1 = 47.4M&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çœŸä»¥ä¸ºä»…ä»…æµªè´¹äº† 47.4M çš„è¯ï¼Œé‚£ä½ å°±å¤§é”™ç‰¹é”™äº†ï¼Œä¸è¦å¿˜äº†åº•å±‚åœ¨æ‰©å®¹çš„æ—¶å€™ï¼Œä½¿ç”¨æ–°çš„ size è¦†ç›–äº†è€çš„ sizeï¼Œè€Œè¿™ä¸ª è€çš„ size é›†åˆåœ¨GCè¿˜æ²¡æœ‰å›æ”¶çš„æ—¶å€™ä¼šä¸€ç›´å ç”¨å †ä¸Šç©ºé—´çš„ï¼Œè¿™ä¸ªèƒ½å¬å¾—æ‡‚å—ï¼Ÿ å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://huangxincheng.oss-cn-hangzhou.aliyuncs.com/img/20200617001535.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è¦éªŒè¯çš„è¯å¯ä»¥ç”¨ windbg å»æ‰˜ç®¡å †ä¸ŠæŠ“ä¸€ä¸‹ &lt;code&gt;Slot[] m_slots&lt;/code&gt; å’Œ &lt;code&gt;int[] m_buckets&lt;/code&gt; ä¸¤ä¸ªæ•°ç»„ï¼Œæˆ‘æŠŠä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C#&quot;&gt;
    static void Main(string[] args)
    {
        var hashSet2 = new HashSet&amp;lt;int&amp;gt;(Enumerable.Range(0, 2893249));
        hashSet2.Add(int.MaxValue);
        Console.Read();
    }


0:011&amp;gt; !dumpheap -stat
00007ffaf84f7ad0        3    123455868 System.Collections.Generic.HashSet`1+Slot[[System.Int32, System.Private.CoreLib]][]

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://huangxincheng.oss-cn-hangzhou.aliyuncs.com/img/20200617002748.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œå°±æ‹¿ &lt;code&gt;Slot[]&lt;/code&gt; è¯´äº‹ï¼Œä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œæ‰˜ç®¡å †ä¸Šæœ‰ä¸‰ä¸ª &lt;code&gt;Slot[]&lt;/code&gt; æ•°ç»„ï¼Œè¿™å°±æœ‰æ„æ€äº†ï¼Œæ€ä¹ˆæœ‰ä¸‰ä¸ªå“ˆï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹æ‡µé€¼ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å°†ä¸‰ä¸ª Slot[] çš„åœ°å€æ‰¾å‡ºæ¥ï¼Œä¸€ä¸ªä¸€ä¸ªçœ‹ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C#&quot;&gt;
0:011&amp;gt; !DumpHeap /d -mt 00007ffaf84f7ad0
         Address               MT     Size
0000016c91308048 00007ffaf84f7ad0 16743180     
0000016c928524b0 00007ffaf84f7ad0 34719012     
0000016ce9e61020 00007ffaf84f7ad0 71993676  

0:011&amp;gt; !gcroot 0000016c91308048
Found 0 unique roots (run '!gcroot -all' to see all roots).
0:011&amp;gt; !gcroot 0000016c928524b0
Found 0 unique roots (run '!gcroot -all' to see all roots).
0:011&amp;gt; !gcroot 0000016ce9e61020
Thread 2b0c:
    0000006AFAB7E5F0 00007FFAF84132AE ConsoleApplication3.Program.Main(System.String[]) [C:\4\ConsoleApp1\ConsoleApp1\Program.cs @ 15]
        rbp-18: 0000006afab7e618
            -&amp;gt;  0000016C8000CC08 System.Collections.Generic.HashSet`1[[System.Int32, System.Private.CoreLib]]
            -&amp;gt;  0000016CE9E61020 System.Collections.Generic.HashSet`1+Slot[[System.Int32, System.Private.CoreLib]][]

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘é€šè¿‡ gcroot å»æ‰¾è¿™ä¸‰ä¸ªåœ°å€çš„å¼•ç”¨æ ¹ï¼Œæœ‰ä¸¤ä¸ªæ˜¯æ²¡æœ‰çš„ï¼Œæœ€åä¸€ä¸ªæœ‰çš„è‡ªç„¶å°±æ˜¯æ–°çš„ &lt;code&gt;599w&lt;/code&gt; çš„sizeï¼Œå¯¹ä¸å¯¹ï¼Œæ¥ä¸‹æ¥ç”¨ &lt;code&gt;!do&lt;/code&gt; æ‰“å‡ºè¿™ä¸‰ä¸ªåœ°å€çš„å€¼ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C#&quot;&gt;
0:011&amp;gt; !do 0000016c91308048
Name:        System.Collections.Generic.HashSet`1+Slot[[System.Int32, System.Private.CoreLib]][]
Size:        16743180(0xff7b0c) bytes
Array:       Rank 1, Number of elements 1395263, Type VALUETYPE (Print Array)
Fields:
None

0:011&amp;gt; !do 0000016c928524b0
Name:        System.Collections.Generic.HashSet`1+Slot[[System.Int32, System.Private.CoreLib]][]
Size:        34719012(0x211c524) bytes
Array:       Rank 1, Number of elements 2893249, Type VALUETYPE (Print Array)
Fields:
None

0:011&amp;gt; !do 0000016ce9e61020
Name:        System.Collections.Generic.HashSet`1+Slot[[System.Int32, System.Private.CoreLib]][]
Size:        71993676(0x44a894c) bytes
Array:       Rank 1, Number of elements 5999471, Type VALUETYPE (Print Array)
Fields:
None

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä»ä¸Šé¢çš„ &lt;code&gt;Rank 1, Number of elements&lt;/code&gt; ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒåŸæ¥æ‰˜ç®¡å †ä¸ä»…æœ‰æ‰©å®¹å‰çš„Size ï¼š&lt;code&gt;2893249&lt;/code&gt;ï¼Œè¿˜æœ‰æ›´å‰ä¸€æ¬¡çš„æ‰©å®¹Size: &lt;code&gt;1395263&lt;/code&gt;ï¼Œæ‰€ä»¥æŒ‰è¿™ç§æƒ…å†µç®—ï¼š æ‰˜ç®¡å †ä¸Šçš„æ€»å¤§å°è¿‘ä¼¼ä¸ºï¼š &lt;code&gt;23.7M + 47.4M + 91.5M = 162.6M&lt;/code&gt;ï¼Œæˆ‘å»ï¼Œä¸ç®€å•æŠŠã€‚ã€‚ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼šæ‰˜ç®¡å †ä¸Šæœ‰ &lt;code&gt;162.6 - 91.5 =71.1M&lt;/code&gt; çš„æœªå›æ”¶åƒåœ¾ â• åˆšæ‰çš„ 47.4M çš„ç©ºé—´è™šå ç”¨ï¼Œæ€»æµªè´¹ä¸º:&lt;code&gt;118.5M&lt;/code&gt;ï¼Œä½†æ„¿æˆ‘æ²¡æœ‰ç®—é”™ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;h3 id=&quot;3-æœ‰è§£å†³æ–¹æ¡ˆå—ï¼Ÿ&quot;&gt;3. æœ‰è§£å†³æ–¹æ¡ˆå—ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;åœ¨Listä¸­å¤§å®¶å¯ä»¥é€šè¿‡ &lt;code&gt;Capacity&lt;/code&gt; å»æ§åˆ¶Listçš„Sizeï¼Œä½†æ˜¯å¾ˆé—æ†¾ï¼Œåœ¨ HashSet ä¸­å¹¶æ²¡æœ‰ç±»ä¼¼çš„è§£å†³æ–¹æ¡ˆï¼Œåªæœ‰ä¸€ä¸ªå¾ˆç¬¨æ‹™çš„è£å‰ªæ–¹æ³•: &lt;code&gt;TrimExcess&lt;/code&gt;ï¼Œç”¨äºå°†å½“å‰Sizeæ‰©å±•åˆ°æœ€æ¥è¿‘çš„ è´¨æ•° å€¼ï¼Œ å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C#&quot;&gt;
public void TrimExcess()
{
        int prime = HashHelpers.GetPrime(m_count);
        Slot[] array = new Slot[prime];
        int[] array2 = new int[prime];
        int num = 0;
        for (int i = 0; i &amp;lt; m_lastIndex; i++)
        {
                if (m_slots[i].hashCode &amp;gt;= 0)
                {
                        array[num] = m_slots[i];
                        int num2 = array[num].hashCode % prime;
                        array[num].next = array2[num2] - 1;
                        array2[num2] = num + 1;
                        num++;
                }
        }
}

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åº”ç”¨åˆ°æœ¬æ¡ˆä¾‹å°±æ˜¯å°† &lt;code&gt;289w&lt;/code&gt; é™åˆ¶åˆ° &lt;code&gt;347w&lt;/code&gt;ï¼Œä»ç„¶æœ‰ &lt;code&gt;58w&lt;/code&gt;çš„ç©ºé—´å ç”¨ã€‚ å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://huangxincheng.oss-cn-hangzhou.aliyuncs.com/img/20200617004650.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;ä¸‰ï¼š-æ€»ç»“&quot;&gt;ä¸‰ï¼š æ€»ç»“&lt;/h2&gt;
&lt;p&gt;HashSetçš„æ—¶é—´å’Œç©ºé—´ä¸Šè™šå è¿œæ¯”ä½ æƒ³è±¡çš„å¤§å¾ˆå¤šï¼Œè€Œä¸”å®å ä¹Ÿä¸å°ï¼Œå› ä¸ºåº•å±‚ç”¨åˆ°äº†åŒæ•°ç»„ &lt;code&gt;m_slots&lt;/code&gt; å’Œ &lt;code&gt;m_buckets&lt;/code&gt;ï¼Œæ¯ä¸ªSlotè¿˜æœ‰ä¸‰ä¸ªå…ƒç´ : &lt;code&gt;struct Slot { int hashCode;internal int next;internal T value; }&lt;/code&gt;ï¼Œæ‰€ä»¥äº†è§£å®ŒåŸç†ä¹‹åè°¨æ…ç€ç”¨å§ã€‚&lt;/p&gt;
&lt;hr/&gt;&lt;h3 id=&quot;å¦‚æ‚¨æœ‰æ›´å¤šé—®é¢˜ä¸æˆ‘äº’åŠ¨ï¼Œæ‰«æä¸‹æ–¹è¿›æ¥å§&quot;&gt;å¦‚æ‚¨æœ‰æ›´å¤šé—®é¢˜ä¸æˆ‘äº’åŠ¨ï¼Œæ‰«æä¸‹æ–¹è¿›æ¥å§~&lt;/h3&gt;
&lt;hr/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/214741/202005/214741-20200522143723695-575216767.png&quot; width=&quot;600&quot; height=&quot;200&quot; alt=&quot;å›¾ç‰‡åç§°&quot; align=&quot;center&quot;/&gt;</description>
<pubDate>Wed, 17 Jun 2020 00:43:00 +0000</pubDate>
<dc:creator>ä¸€çº¿ç å†œ</dc:creator>
<og:description>ä¸€ï¼šèƒŒæ™¯ 1. è®²æ•…äº‹ è‡ªä»è¿™ä¸ªçº¯å†…å­˜é¡¹ç›®è¿›äº†å¤§å®¢æˆ·ä¹‹åï¼Œæå¾—æˆ‘ç°åœ¨å¯¹å†…å­˜å’ŒCPUç‰¹åˆ«æ•æ„Ÿï¼Œè·‘ä¸€ç‚¹æ•°æ®å†…å­˜å‡ ä¸ªGçš„ä¸Šä¸‹ï¼Œç‰¹åˆ«æ²¡æœ‰å®‰å…¨æ„Ÿï¼Œæ€»æƒ³ç”¨windbgæŠ“å‡ ä¸ªdumpçœ‹çœ‹åˆ°åº•æ˜¯å“ªä¸€å—å¯¼è‡´çš„ï¼Œæ˜¯æˆ‘çš„ä»£</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/huangxincheng/p/13150401.html</dc:identifier>
</item>
<item>
<title>æ·±å…¥ç†è§£ EF Coreï¼šEF Core è¯»å–æ•°æ®æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ - LiamWang</title>
<link>http://www.cnblogs.com/willick/p/13150393.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/willick/p/13150393.html</guid>
<description>&lt;p&gt;é˜…è¯»æœ¬æ–‡å¤§æ¦‚éœ€è¦ 11 åˆ†é’Ÿã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;6.4099616858238&quot;&gt;
&lt;p&gt;åŸæ–‡ï¼š&lt;a href=&quot;https://bit.ly/2UMiDLb&quot;&gt;https://bit.ly/2UMiDLb&lt;/a&gt;&lt;br/&gt;ä½œè€…ï¼šJon P Smith&lt;br/&gt;ç¿»è¯‘ï¼šç‹äº®&lt;br/&gt;å£°æ˜ï¼šæˆ‘ç¿»è¯‘æŠ€æœ¯æ–‡ç« ä¸æ˜¯é€å¥ç¿»è¯‘çš„ï¼Œè€Œæ˜¯æ ¹æ®æˆ‘è‡ªå·±çš„ç†è§£æ¥è¡¨è¿°çš„ã€‚å…¶ä¸­å¯èƒ½ä¼šå»é™¤ä¸€äº›æœ¬äººå®åœ¨ä¸çŸ¥é“å¦‚ä½•ç»„ç»‡ä½†åˆä¸å½±å“ç†è§£çš„å¥å­ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ¬æ–‡å°†ä¸ºä½ è¯¦ç»†æç»˜ EF Core ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®çš„â€œå¹•åâ€è§†å›¾ã€‚æˆ‘å°†æ­å¼€ä¸¤ç§æ•°æ®åº“è¯»å–æ–¹å¼çš„é¢çº±ï¼šä¸€ä¸ªæ˜¯æ™®é€šçš„æŸ¥è¯¢ï¼Œå¦ä¸€ä¸ªæ˜¯ä½¿ç”¨ AsNoTracking æ–¹æ³•çš„éè·Ÿè¸ªæŸ¥è¯¢ã€‚æˆ‘è¿˜å°†é€šè¿‡ä¸€ä¸ªå®éªŒæ¥æ¼”ç¤ºæˆ‘æ˜¯å¦‚ä½•è§£å†³æˆ‘çš„ä¸€ä¸ªå®¢æˆ·é‡åˆ°çš„æ€§èƒ½é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å‡è®¾ä½ å¯¹ EF Core å·²ç»æœ‰äº†ä¸€å®šçš„è®¤è¯†ï¼Œä½†åœ¨æ·±å…¥å­¦ä¹ ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ EF Coreï¼Œä»¥ç¡®ä¿æˆ‘ä»¬å·²ç»æŒæ¡äº†ä¸€äº›åŸºæœ¬çŸ¥è¯†ã€‚è¿™æ˜¯ä¸€ä¸ªâ€œæ·±å…¥ç ”ç©¶â€çš„è¯¾é¢˜ï¼Œæ‰€ä»¥æˆ‘å‡†å¤‡å¤§é‡çš„æŠ€æœ¯ç»†èŠ‚ï¼Œå¸Œæœ›æˆ‘çš„æè¿°æ–¹å¼ä½ èƒ½ç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯â€œæ·±å…¥ç†è§£ EF Coreâ€ç³»åˆ—ä¸­çš„ç¬¬ä¸€ç¯‡ã€‚ä»¥ä¸‹æ˜¯æœ¬ç³»åˆ—æ–‡ç« åˆ—è¡¨ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å½“ EF Core ä»æ•°æ®åº“è¯»å–æ•°æ®æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿï¼ˆæœ¬æ–‡ï¼‰&lt;/li&gt;
&lt;li&gt;å½“ EF Core å†™å…¥æ•°æ®åˆ°æ•°æ®åº“æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿï¼ˆæ•¬è¯·æœŸå¾…ï¼‰&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;æ¦‚è¦&quot;&gt;æ¦‚è¦&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;EF Core æœ‰ä¸¤ç§æ–¹æ³•ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼ˆä¹Ÿç§°ä¸ºæŸ¥è¯¢ï¼‰ï¼šæ™®é€š LINQ æŸ¥è¯¢å’ŒåŒ…å« AsNoTracking æ–¹æ³•çš„éè·Ÿè¸ª LINQ æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;li&gt;è¿™ä¸¤ç§æ–¹æ³•æŸ¥è¯¢çš„è¿”å›ç±»ï¼ˆè¢«ç§°ä¸ºå®ä½“ç±»ï¼‰ï¼Œå®ƒè¿æ¥çš„å…¶å®ƒçš„å®ä½“ç±»ï¼ˆå³æ‰€è°“çš„å¯¼èˆªå±æ€§ï¼‰ä¹Ÿè¢«åŒæ—¶åŠ è½½ï¼Œä½†è¿™ä¸¤ç§æ³•å¦‚ä½•è¿æ¥åŠè¿æ¥çš„å†…å®¹æ˜¯ä¸ä¸€æ ·çš„ã€‚&lt;/li&gt;
&lt;li&gt;æ™®é€šæŸ¥è¯¢æ¥å—çš„æ˜¯ DbContext æ‰§è¡Œè¯»å–æ—¶æ‰€æœ‰æ•°æ®çš„å‰¯æœ¬â€”â€”æ­¤æ—¶çš„å®ä½“ç±»ç§°ä¸ºè¢«è·Ÿè¸ªã€‚è¿™å…è®¸åŠ è½½çš„å®ä½“ç±»å‚ä¸æ•°æ®åº“çš„æ›´æ–°æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;æ™®é€šæŸ¥è¯¢è¿˜ä¼šæœ‰ä¸€äº›å…¶å®ƒçš„å¤æ‚åº•å±‚å®ç°ï¼Œç§°ä¸ºå…³ç³»ä¿®è¡¥(fixup)ï¼Œç”¨äºæè¿°è¯»å…¥çš„å®ä½“ç±»å’Œå…¶ä»–è¢«è·Ÿè¸ªå®ä½“ä¹‹é—´çš„è¿æ¥å…³ç³»ã€‚&lt;/li&gt;
&lt;li&gt;AsNoTracked éè·Ÿè¸ªæŸ¥è¯¢æ²¡æœ‰å‰¯æœ¬ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰è¢«è·Ÿè¸ªâ€”â€”è¿™æ„å‘³ç€å®ƒæ¯”æ™®é€šæŸ¥è¯¢æ›´å¿«ã€‚è¿™ä¹Ÿæ„å‘³ç€å®ƒä¸ä¼šç”¨äºæ•°æ®åº“çš„å†™æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œæˆ‘å°†å±•ç¤º EF Core æ™®é€šæŸ¥è¯¢ä¸­ä¸€ä¸ªé²œä¸ºäººçŸ¥çš„ç‰¹æ€§ï¼Œä»¥æ­¤ä½œä¸ºç¤ºä¾‹ï¼Œè¯´æ˜é€šè¿‡å¯¼èˆªå±æ€§è¿æ¥å®ä½“ç±»çš„å…³ç³»æ˜¯å¤šä¹ˆæ™ºèƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;ef-core-å¦‚ä½•è¯»å–æ•°æ®åº“æ•°æ®&quot;&gt;EF Core å¦‚ä½•è¯»å–æ•°æ®åº“æ•°æ®&lt;/h2&gt;
&lt;p&gt;æç¤ºï¼šå¦‚æœä½ å·²ç»å¯¹ EF Core æœ‰ä¸€å®šçš„è®¤è¯†ï¼Œé‚£ä¹ˆä½ å¯ä»¥è·³è¿‡è¿™ä¸€èŠ‚ï¼Œè¿™éƒ¨åˆ†åªæ˜¯ä¸€ä¸ªå¦‚ä½•è¯»å–æ•°æ®åº“çš„ä¾‹å­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†èƒ½è®©ä½ æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘å…ˆæè¿°ä¸€ä¸ªæ•°æ®åº“ç»“æ„ï¼Œç„¶åå†ç»™å‡ºä¸€ä¸ªç®€å•çš„æ•°æ®åº“è¯»å–ç¤ºä¾‹ã€‚ä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬è¡¨çš„ç»“æ„å’Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://qn-tc.geekgist.com/202006/17085341&quot; alt=&quot; &quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è¿™äº›è¡¨è¢«æ˜ å°„åˆ°å…·æœ‰ç±»ä¼¼åç§°çš„ç±»ï¼Œä¾‹å¦‚ Bookã€BookAuthorã€Authorï¼Œè¿™äº›ç±»çš„å±æ€§åç§°ä¸è¡¨çš„å­—æ®µåç§°ç›¸åŒã€‚ç”±äºç¯‡å¹…æœ‰é™ï¼Œæˆ‘ä¸æ‰“ç®—å±•å¼€æ¥è®²è¿™äº›ç±»ï¼Œä½†æ‚¨å¯ä»¥åœ¨æˆ‘çš„ GitHub ä»“åº“&lt;sup&gt;[1]&lt;/sup&gt;ä¸­æŸ¥çœ‹è¿™äº›ç±»ã€‚&lt;/p&gt;
&lt;p&gt;EF Core è¯»å–æ•°æ®åº“éœ€è¦ä¸‹é¢äº”éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;æ•°æ®åº“æœåŠ¡å™¨ï¼Œå¦‚ SQL server, Sqlite, PostgreSQL ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;å…·æœ‰æ•°æ®çš„æ•°æ®åº“ã€‚&lt;/li&gt;
&lt;li&gt;æ˜ å°„åˆ°æ•°æ®è¡¨çš„ç±»ï¼ˆç§°ä¸ºå®ä½“ç±»ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªç»§æ‰¿ DbContext çš„ç±»ï¼Œè¯¥ç±»åŒ…å« EF Core çš„é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œä»æ•°æ®åº“è¯»å–æ•°æ®çš„å‘½ä»¤ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;ä¸‹é¢çš„å•å…ƒæµ‹è¯•ä»£ç æ¥è‡ªæˆ‘çš„ GitHub åˆ›åº“&lt;sup&gt;[2]&lt;/sup&gt;ï¼Œå±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®ƒä»ç°æœ‰æ•°æ®åº“ä¸­è¯»å– 4 ä¸ª Book å®ä½“åŠå…¶å…³è”çš„ BookAuthor å’Œ Authors å®ä½“ã€‚&lt;/p&gt;
&lt;p&gt;ä»“åº“åœ°å€ï¼š&lt;a href=&quot;https://bit.ly/2Yza7QQ&quot;&gt;https://bit.ly/2Yza7QQ&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;[Fact]
public void TestBookCountAuthorsOk()
{
    //SETUP
    var options = SqliteInMemory.CreateOptions&amp;lt;EfCoreContext&amp;gt;();
    //code to set up the database with four books, two with the same Author
    using (var context = new EfCoreContext(options))
    {
        //ATTEMPT
        var books = context.Books
            .Include(r =&amp;gt; r.AuthorsLink)
            .ThenInclude(r =&amp;gt; r.Author)
            .ToList();

        //VERIFY
        books.Count.ShouldEqual(4);
        books.SelectMany(x =&amp;gt; x.AuthorsLink.Select(y =&amp;gt; y.Author))
            .Distinct().Count().ShouldEqual(3);
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å°†å•å…ƒæµ‹è¯•ä»£ç å¯¹åº”åˆ°ä¸Šé¢çš„ 5 éƒ¨åˆ†ï¼Œç»“æœæ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;&lt;strong&gt;æ•°æ®åº“æœåŠ¡å™¨&lt;/strong&gt;â€”â€”ç¬¬ 5 è¡Œï¼šæˆ‘é€‰æ‹©äº†ä¸€ä¸ª Sqlite æ•°æ®åº“æœåŠ¡å™¨ï¼Œåœ¨æœ¬ä¾‹ä¸­æ˜¯ &lt;code&gt;SqliteInMemory.CreateOptions&lt;/code&gt; æ–¹æ³•ï¼Œå®ƒä½¿ç”¨æˆ‘çš„ä¸€ä¸ª NuGet åŒ… EfCore.TestSupport åˆ›å»ºäº†ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼ˆå†…å­˜ä¸­çš„æ•°æ®åº“å¯¹äºå•å…ƒæµ‹è¯•éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºä½ å¯ä»¥ä¸ºè¿™ä¸ªæµ‹è¯•å»ºç«‹ä¸€ä¸ªæ–°çš„ç©ºæ•°æ®åº“ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…·æœ‰æ•°æ®çš„æ•°æ®åº“&lt;/strong&gt;â€”â€”ç¬¬ 6 è¡Œï¼šæˆ‘å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä»‹ç»æ•°æ®æ˜¯å¦‚ä½•å†™å…¥æ•°æ®åº“çš„ï¼Œç°åœ¨å‡è®¾æœ‰ä¸€ä¸ªæ•°æ®åº“åŒ…å« 4 æœ¬ä¹¦ä¿¡æ¯ï¼Œå…¶ä¸­ä¸¤æœ¬ä¹¦çš„ä½œè€…æ˜¯åŒä¸€ä¸ªäººã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®ä½“ç±»&lt;/strong&gt;â€”â€”ä»£ç é‡Œè¿™é‡Œæ²¡æœ‰å±•ç¤ºï¼Œä½†æ˜¯ä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹è¿™äº›ç±»&lt;sup&gt;[1]&lt;/sup&gt;ã€‚å…¶ä¸­æœ‰ä¸€ä¸ª Books å®ä½“ç±»ï¼Œé€šè¿‡ä¸€ä¸ªåä¸º BookAuhor çš„å®ä½“ç±»å¤šå¯¹å¤šå…³è” Authors å®ä½“ç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸€ä¸ªç»§æ‰¿ DbContext çš„ç±»&lt;/strong&gt;â€”â€”ç¬¬ 7 è¡Œï¼šEfCoreContext ç±»ç»§æ‰¿äº† DbContext ç±»å¹¶é…ç½®äº†ä»ç±»åˆ°æ•°æ®åº“çš„æ˜ å°„å…³ç³»ï¼ˆä½ å¯ä»¥åœ¨æˆ‘çš„ GitHub ä»“åº“&lt;sup&gt;[3]&lt;/sup&gt; ä¸­æŸ¥çœ‹è¯¥ç±»ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»æ•°æ®åº“è¯»å–æ•°æ®çš„å‘½ä»¤&lt;/strong&gt;â€”â€”ç¬¬ 10 åˆ° 13 è¡Œï¼Œè¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢ï¼š
&lt;ul&gt;&lt;li&gt;ç¬¬ 10 è¡Œ â€” context ä¸º EfCoreContext çš„å®ä¾‹ï¼Œé€šè¿‡å®ƒè®¿é—®ä½ çš„æ•°æ®åº“ï¼Œ&lt;code&gt;.Books&lt;/code&gt; è¡¨ç¤ºæ‚¨å¸Œæœ›è®¿é—® Books è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ 11 è¡Œ â€” Include è¢«ç§°ä¸ºè´ªå©ªåŠ è½½ï¼Œå®ƒå‘Šè¯‰ EF Core å½“å®ƒåŠ è½½ Books æ—¶ï¼Œä¹Ÿåº”è¯¥åŠ è½½å…³è”åˆ°çš„æ‰€æœ‰ BookAuthor å®ä½“ç±»ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ 12 è¡Œ â€” ThenInclude æ˜¯ç»§ç»­è´ªå©ªåŠ è½½ï¼Œå®ƒå‘Šè¯‰ EF Core å½“å®ƒåŠ è½½ä¸€ä¸ª BookAuthor æ—¶ï¼Œå®ƒä¹Ÿåº”è¯¥åŠ è½½å…³è”åˆ°è¯¥ BookAuthor çš„ Author å®ä½“ç±»ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;æ‰€æœ‰è¿™ä¸€åˆ‡æŸ¥è¯¢å‡ºæ¥æ˜¯ä¸€ä¸ªç»“æœé›†ï¼Œå…¶ä¸­æœ‰æ™®é€šå±æ€§ï¼Œåƒ Books çš„ Title å±æ€§ï¼›æœ‰å…³è”å®ä½“ç±»çš„å¯¼èˆªå±æ€§ï¼Œåƒ Books çš„ AuthorsLink å±æ€§ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªç¤ºä¾‹ç§°ä¸ºæŸ¥è¯¢æˆ–è¯»å–ï¼Œä¹Ÿæ˜¯å››ç§æ•°æ®åº“è®¿é—®ç±»å‹ä¹‹ä¸€ï¼Œå³ CRUD(æ–°å¢ã€è¯»å–ã€æ›´æ–°å’Œåˆ é™¤)ã€‚æˆ‘å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»æ–°å¢å’Œæ›´æ–°ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ef-core-å¦‚ä½•è¡¨ç¤ºè¯»å–çš„æ•°æ®&quot;&gt;EF Core å¦‚ä½•è¡¨ç¤ºè¯»å–çš„æ•°æ®&lt;/h2&gt;
&lt;p&gt;å½“ä½ æŸ¥è¯¢æ•°æ®åº“æ—¶ï¼ŒEF Core ä¼šå°†æ•°æ®åº“è¿”å›çš„æ•°æ®è½¬æ¢ä¸ºå®ä½“ç±»å¹¶å¡«å……å¯¼èˆªå±æ€§çš„å€¼ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ä¸¤ç§ç±»å‹çš„æŸ¥è¯¢æ­¥éª¤â€”â€”æ™®é€šæŸ¥è¯¢(å³æ²¡æœ‰ AsNoTracking æ–¹æ³•ï¼Œä¹Ÿç§°ä¸ºè¯»å†™æŸ¥è¯¢)å’Œæ·»åŠ äº† AsNoTracking æ–¹æ³•çš„éè·Ÿè¸ªæŸ¥è¯¢(ç§°ä¸ºåªè¯»æŸ¥è¯¢)ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æœ€åˆ LINQ è¯­å¥æ˜¯å¦‚ä½•è½¬æ¢æˆæ•°æ®åº“ç›¸åº”çš„æŸ¥è¯¢å‘½ä»¤ç„¶åè¿”å›æ•°æ®çš„ã€‚å¯¹äºæˆ‘ä»¬å°†è¦çœ‹åˆ°çš„ä¸¤ç§ç±»å‹çš„æŸ¥è¯¢æ¥è¯´ï¼Œè¿™æ˜¯å¾ˆå¸¸è§çš„æ“ä½œã€‚å…³äºæŸ¥è¯¢çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œè¯·å‚è§ä¸‹å›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://qn-tc.geekgist.com/202006/17085458&quot; alt=&quot; &quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æœ‰ä¸€äº›éå¸¸å¤æ‚çš„ä»£ç å°†ä½ çš„ LINQ è½¬æ¢ä¸ºæ•°æ®åº“æŸ¥è¯¢å‘½ä»¤ï¼Œä½†è¿™äº›å†…éƒ¨ç»†èŠ‚æˆ‘ä»¬ä¸å¿…å…³å¿ƒã€‚å¦‚æœä½ çš„ LINQ ä¸èƒ½è¢«ç¿»è¯‘ï¼Œä½ ä¼šä» EF Core å¾—åˆ°ä¸€ä¸ªå¼‚å¸¸æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«ç±»ä¼¼â€œä¸èƒ½è¢«ç¿»è¯‘â€çš„æè¿°è¯è¯­ã€‚æ­¤å¤–ï¼Œå½“æ•°æ®è¿”å›æ—¶ï¼Œåƒ Value Converters&lt;sup&gt;[4]&lt;/sup&gt; è¿™æ ·çš„ç‰¹æ€§å¯èƒ½ä¼šè°ƒæ•´æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬èŠ‚å±•ç¤ºäº†æŸ¥è¯¢çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œå…¶ä¸­ LINQ è¢«è½¬æ¢ä¸ºæ•°æ®åº“å‘½ä»¤å¹¶è¿”å›æ‰€æœ‰æ­£ç¡®çš„å€¼ã€‚ç°åœ¨æˆ‘ä»¬æ¥çœ‹æŸ¥è¯¢çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œåœ¨è¿™é‡Œ EF Core è·å–è¿”å›å€¼å¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºå®ä½“ç±»çš„å®ä¾‹ï¼Œå¹¶å¡«å……å¯¼èˆªå±æ€§ã€‚æˆ‘ä»¬å°†åˆ†åˆ«çœ‹çœ‹ä¸¤ç§ç±»å‹çš„æŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-æ™®é€šæŸ¥è¯¢è¯»å†™æŸ¥è¯¢&quot;&gt;1. æ™®é€šæŸ¥è¯¢(è¯»å†™æŸ¥è¯¢)&lt;/h3&gt;
&lt;p&gt;æ™®é€šæŸ¥è¯¢è¯»å–æ•°æ®çš„æ–¹å¼å¯ä»¥ä¿®æ”¹æ•°æ®å¹¶æ›´æ–°åˆ°æ•°æ®åº“ï¼Œè¿™å°±æ˜¯æˆ‘å°†å…¶ç§°ä¸ºè¯»å†™æŸ¥è¯¢çš„åŸå› ã€‚å®ƒä¸ä¼šè‡ªåŠ¨æ›´æ–°æ•°æ®(è¯·å‚é˜…ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œäº†è§£å¦‚ä½•å†™å…¥æ•°æ®åº“)ã€‚å¦‚æœä½ è¦æ›´æ–°æ•°æ®ï¼Œä½ çš„æŸ¥è¯¢å¿…é¡»æ˜¯è¯»å†™æŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘åœ¨ä»‹ç»ä¸­ç»™å‡ºçš„ç¤ºä¾‹æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªæ™®é€šè¯»å†™æŸ¥è¯¢ï¼Œè¯»å–å¸¦æœ‰ AuthorsLink å®ä¾‹çš„ç¤ºä¾‹ã€‚ä¸‹é¢æ˜¯è¯¥ç¤ºä¾‹çš„æŸ¥è¯¢éƒ¨åˆ†çš„ä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;var books = context.Books
    .Include(r =&amp;gt; r.AuthorsLink)
    .ThenInclude(r =&amp;gt; r.Author)
    .ToList();
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç„¶å EF Core é€šè¿‡ä¸‰ä¸ªæ­¥éª¤å°†è¿™äº›å€¼è½¬æ¢å¹¶å¡«å……å«æœ‰å¯¼èˆªå±æ€§çš„å®ä½“ç±»ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†è¿™ä¸‰ä¸ªæ­¥éª¤ä»¥åŠç”Ÿæˆçš„å®ä½“ç±»åŠå…¶å¯¼èˆªå±æ€§çš„å®ä½“ç±»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://qn-tc.geekgist.com/202006/17085508&quot; alt=&quot; &quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™ä¸‰ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;&lt;strong&gt;åˆ›å»ºç±»å¹¶å¡«å……æ•°æ®&lt;/strong&gt;ã€‚å®ƒæ¥å—æ•°æ®åº“è¿”å›çš„å€¼ï¼Œå¹¶å¡«å……éå¯¼èˆª(ç§°ä¸ºæ ‡é‡)å±æ€§ã€å­—æ®µç­‰ã€‚åœ¨ Book å®ä½“ç±»ä¸­ï¼Œæ˜¯ BookId(ä¸»é”®)ã€Title ç­‰å±æ€§â€”â€”å‚è§ä¸Šå›¾å·¦ä¸‹è§’æµ…è“è‰²çŸ©å½¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¿®è¡¥å…³è”å…³ç³»&lt;/strong&gt;ã€‚é¦–å…ˆæ˜¯å¡«å…¥ä¸»é”®å’Œå¤–é”®çš„ä¿¡æ¯ï¼Œå®ƒä»¬å®šä¹‰å¦‚ä½•ç›¸äº’å…³è”æ•°æ®ã€‚ç„¶åï¼ŒEF Core ä½¿ç”¨è¿™äº›é”®è®¾ç½®å®ä½“ç±»ä¹‹é—´çš„å¯¼èˆªå±æ€§(å¦‚å›¾ä¸­è“è‰²ç²—çº¿æ‰€ç¤º)ã€‚è¿™ä¸ªå…³ç³»çš„ä¿®è¡¥æ‰€éœ€çš„ä¿¡æ¯ä¸ä»…æ˜¯æŸ¥è¯¢è¯»å…¥çš„å®ä½“ç±»ï¼Œå®ƒè¿˜ä¼šæŸ¥çœ‹ DbContext ä¸­è·Ÿè¸ªçš„æ¯ä¸ªå®ä½“ï¼Œå¹¶å¡«å……å¯¼èˆªå±æ€§ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½ï¼Œä½†ä½ çš„è¢«è·Ÿè¸ªå®ä½“è¶Šå¤šï¼Œæ‰€éœ€æ¶ˆè€—æ—¶é—´ä¹Ÿè¶Šå¤šâ€”â€”è¿™å°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦ AsNoTracking æ¥å®ç°æ›´å¿«çš„æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ›å»ºè·Ÿè¸ªå¿«ç…§&lt;/strong&gt;ã€‚è·Ÿè¸ªå¿«ç…§æ˜¯è¿”å›ç»™ç”¨æˆ·çš„å®ä½“ç±»çš„ä¸€ä¸ªå‰¯æœ¬ï¼ŒåŠ ä¸Šå®ƒæ‰€éšè—çš„ä¸æ¯ä¸ªå®ä½“ç±»çš„å…³è”å…³ç³»â€”â€”è‹¥ä¸€ä¸ªå®ä½“å¤„äºè¢«è·Ÿè¸ªçŠ¶æ€ï¼Œè¿™æ„å‘³ç€å®ƒå°†ä¼šå‘ç”Ÿä¿®æ”¹å¹¶ä¼šå†™å…¥åˆ°æ•°æ®åº“ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;2-éè·Ÿè¸ªæŸ¥è¯¢åªè¯»æŸ¥è¯¢&quot;&gt;2. éè·Ÿè¸ªæŸ¥è¯¢(åªè¯»æŸ¥è¯¢)&lt;/h3&gt;
&lt;p&gt;éè·Ÿè¸ªæŸ¥è¯¢ï¼Œå³ä½¿ç”¨ AsNoTracking æ–¹æ³•çš„æŸ¥è¯¢ï¼Œæ˜¯ä¸€ä¸ªåªè¯»æŸ¥è¯¢ã€‚è¿™æ„å‘³ç€ï¼Œå½“ SaveChanges æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä½ è¯»å–çš„ä»»ä½•å†…å®¹éƒ½ä¸ä¼šè¢«å†™å…¥æ•°æ®åº“ã€‚éè·Ÿè¸ªæŸ¥è¯¢çš„æŸ¥è¯¢æ•ˆç‡æ›´é«˜ï¼Œåœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘å°†ä»‹ç»éè·Ÿè¸ªæŸ¥è¯¢ä»¥åŠä¸æ™®é€šæŸ¥è¯¢çš„å…¶ä»–åŒºåˆ«ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å‰æ–‡çš„ç¤ºä¾‹ä¹‹åï¼Œæˆ‘ä¿®æ”¹äº†æŸ¥è¯¢ä»£ç ï¼Œæ·»åŠ äº†ä¸‹é¢çš„ AsNoTracking æ–¹æ³•(è¯·çœ‹ç¬¬ 2 è¡Œ)ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;var books = context.Books
    .AsNoTracking()
    .Include(r =&amp;gt; r.AuthorsLink)
    .ThenInclude(r =&amp;gt; r.Author)
    .ToList();
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œçš„ LINQ æŸ¥è¯¢åªæœ‰ä¸Šé¢çš„æ™®é€šæŸ¥è¯¢çš„å‰ä¸¤ä¸ªæ­¥éª¤ï¼ˆæ²¡æœ‰ç¬¬ä¸‰ä¸ªæ­¥éª¤ï¼‰ã€‚ä¸‹å›¾æ˜¾ç¤ºäº† AsNoTracking æŸ¥è¯¢çš„æ­¥éª¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://qn-tc.geekgist.com/202006/17085532&quot; alt=&quot; &quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;&lt;strong&gt;åˆ›å»ºç±»å¹¶å¡«å……æ•°æ®&lt;/strong&gt;ã€‚å®ƒæ¥å—æ•°æ®åº“è¿”å›çš„å€¼ï¼Œå¹¶å¡«å……éå¯¼èˆª(ç§°ä¸ºæ ‡é‡)å±æ€§ã€å­—æ®µç­‰ã€‚åœ¨ Book å®ä½“ç±»ä¸­ï¼Œæ˜¯ BookId(ä¸»é”®)ã€Title ç­‰å±æ€§â€”â€”å‚è§ä¸Šå›¾å·¦ä¸‹è§’æµ…è“è‰²çŸ©å½¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¿®è¡¥å…³è”å…³ç³»&lt;/strong&gt;ã€‚é¦–å…ˆæ˜¯å¡«å…¥ä¸»é”®å’Œå¤–é”®çš„ä¿¡æ¯ï¼Œå®ƒä»¬å®šä¹‰å¦‚ä½•ç›¸äº’å…³è”æ•°æ®ã€‚ç„¶åï¼ŒEF Core ä½¿ç”¨è¿™äº›é”®è®¾ç½®å®ä½“ç±»ä¹‹é—´çš„å¯¼èˆªå±æ€§(å¦‚å›¾ä¸­è“è‰²ç²—çº¿æ‰€ç¤º)ã€‚è¿™ä¸ªå…³ç³»çš„ä¿®è¡¥æ‰€éœ€çš„ä¿¡æ¯ä¸ä»…æ˜¯æŸ¥è¯¢è¯»å…¥çš„å®ä½“ç±»ï¼Œå®ƒè¿˜ä¼šæŸ¥çœ‹ DbContext ä¸­è·Ÿè¸ªçš„æ¯ä¸ªå®ä½“ï¼Œå¹¶å¡«å……å¯¼èˆªå±æ€§ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½ï¼Œä½†ä½ çš„è¢«è·Ÿè¸ªå®ä½“è¶Šå¤šï¼Œæ‰€éœ€æ¶ˆè€—æ—¶é—´ä¹Ÿè¶Šå¤šâ€”â€”è¿™å°±æ˜¯ä¸ºä»€ä¹ˆéœ€è¦ AsNoTracking æ¥å®ç°æ›´å¿«çš„æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;æ™®é€šæŸ¥è¯¢å’Œéè·Ÿè¸ªæŸ¥è¯¢çš„åŒºåˆ«&quot;&gt;æ™®é€šæŸ¥è¯¢å’Œéè·Ÿè¸ªæŸ¥è¯¢çš„åŒºåˆ«&lt;/h3&gt;
&lt;p&gt;ç°åœ¨è®©æˆ‘ä»¬æ¯”è¾ƒè¿™ä¸¤ç§æŸ¥è¯¢æ¯”è¾ƒæ˜æ˜¾çš„åŒºåˆ«ã€‚&lt;/p&gt;
&lt;ol readability=&quot;3&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;éè·Ÿè¸ªæŸ¥è¯¢æŸ¥è¯¢çš„æ€§èƒ½æ›´å¥½ã€‚ä½¿ç”¨éè·Ÿè¸ªæŸ¥è¯¢æŸ¥è¯¢çš„ä¸»è¦åŸå› æ˜¯æ€§èƒ½ã€‚éè·Ÿè¸ªæŸ¥è¯¢æŸ¥è¯¢è¡¨ç°ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ç¨å¾®å¿«ä¸€ç‚¹ï¼Œä½¿ç”¨çš„å†…å­˜ç¨å¾®å°‘ä¸€ç‚¹ï¼Œå› ä¸ºå®ƒä¸éœ€è¦åˆ›å»ºè·Ÿè¸ªå¿«ç…§ã€‚&lt;/li&gt;
&lt;li&gt;é¿å…æ²¡æœ‰å¿…è¦çš„è·Ÿè¸ªå¿«ç…§å¯ä»¥æé«˜ SaveChanges çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒä¸å¿…æ£€æŸ¥è·Ÿè¸ªå¿«ç…§ä»¥æŸ¥æ‰¾æ›´æ”¹ã€‚&lt;/li&gt;
&lt;li&gt;ç¨å¾®å¿«ä¸€ç‚¹ï¼Œå› ä¸ºä¿®è¡¥å…³è”å…³ç³»æ—¶æ²¡æœ‰æ‰€è°“çš„èº«ä»½è§£æã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ä¼šå¾—åˆ°ä¸¤ä¸ªå…·æœ‰ç›¸åŒæ•°æ®çš„ Author å®ä¾‹ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;éè·Ÿè¸ªæŸ¥è¯¢ä¿®è¡¥å…³è”å…³ç³»æ—¶åªé“¾æ¥æŸ¥è¯¢ä¸­çš„å®ä½“ã€‚åœ¨æ™®é€šæŸ¥è¯¢ä¸­ï¼Œæˆ‘å·²ç»è¯´è¿‡ä¿®è¡¥å…³è”å…³ç³»æ—¶è¿æ¥çš„æ˜¯æŸ¥è¯¢ä¸­çš„å®ä½“å’Œå½“å‰è·Ÿè¸ªçš„å®ä½“ï¼Œä½†æ˜¯éè·Ÿè¸ªæŸ¥è¯¢åªä¿®è¡¥æŸ¥è¯¢ä¸­çš„å®ä½“å…³ç³»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;éè·Ÿè¸ªæŸ¥è¯¢å¹¶ä¸æ€»æ˜¯ä»£è¡¨æ•°æ®åº“å…³ç³»ã€‚è¿™ä¸¤ç§ç±»å‹æŸ¥è¯¢ä¹‹é—´çš„å…³ç³»ä¿®è¡¥çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œéè·Ÿè¸ªæŸ¥è¯¢å…³ç³»ä¿®è¡¥æ›´å¿«ï¼Œå®ƒä¸éœ€è¦æ ‡è¯†çš„è§£æã€‚è¿™å¯ä»¥ä¸ºæ•°æ®åº“ä¸­çš„åŒä¸€è¡Œç”Ÿæˆå¤šä¸ªå®ä¾‹â€”â€”è§ä¸Šå›¾å³ä¸‹è§’è“è‰²çš„ Author å®ä½“å’Œæ³¨é‡Šã€‚å¦‚æœåªæ˜¯å‘ç”¨æˆ·æ˜¾ç¤ºæ•°æ®ï¼Œé‚£ä¹ˆè¿™ç§å·®å¼‚å¹¶ä¸é‡è¦ï¼Œä½†æ˜¯å¦‚æœå…·æœ‰ä¸šåŠ¡é€»è¾‘ï¼Œé‚£ä¹ˆå¤šä¸ªå®ä¾‹ä¸èƒ½æ­£ç¡®åæ˜ æ•°æ®çš„ç»“æ„ï¼Œå°±å¯èƒ½ä¼šæœ‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;h2 id=&quot;å¯¹å±‚çº§æ•°æ®æœ‰ç”¨çš„å…³ç³»ä¿®è¡¥ç‰¹æ€§&quot;&gt;å¯¹å±‚çº§æ•°æ®æœ‰ç”¨çš„å…³ç³»ä¿®è¡¥ç‰¹æ€§&lt;/h2&gt;
&lt;p&gt;å…³è”å…³ç³»ä¿®è¡¥çš„æ­¥éª¤æ˜¯éå¸¸æ™ºèƒ½çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨æ™®é€šæŸ¥è¯¢ä¸­ã€‚ä¸‹é¢æˆ‘æƒ³å‘ä½ å±•ç¤ºæˆ‘æ˜¯å¦‚ä½•åˆ©ç”¨å…³ç³»ä¿®è¡¥çš„ç‰¹æ€§æ¥è§£å†³ä¸€ä¸ªå®¢æˆ·é¡¹ç›®ä¸­çš„æ€§èƒ½é—®é¢˜çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘æ›¾åœ¨ä¸€å®¶å…¬å¸å·¥ä½œï¼Œé‚£é‡Œçš„è®¸å¤šæ•°æ®å¤„ç†éƒ½æ˜¯å±‚æ¬¡åŒ–ç»“æ„çš„ï¼Œå³æ•°æ®å…·æœ‰ä¸€ç³»åˆ—æ·±åº¦ä¸ç¡®å®šçš„å…³è”å…³ç³»ã€‚é—®é¢˜æ˜¯æˆ‘å¿…é¡»å…ˆè§£ææ•´ä¸ªå±‚æ¬¡ç»“æ„ï¼Œç„¶åæ‰èƒ½å‘ˆç°è¿™äº›æ•°æ®ã€‚æˆ‘æœ€åˆæ˜¯é€šè¿‡è´ªå©ªçš„æ–¹å¼åŠ è½½å‰ä¸¤ä¸ªå±‚çº§ï¼Œç„¶åæ˜¾å¼åœ°åŠ è½½æ›´æ·±çš„å±‚çº§æ¥å®ç°è¿™ä¸€ç‚¹çš„ã€‚å®ƒå¯ä»¥å·¥ä½œï¼Œä½†æ˜¯æ€§èƒ½éå¸¸æ…¢ï¼Œå¹¶ä¸”æ•°æ®åº“å› å¤§é‡å•æ•°æ®åº“è®¿é—®è€Œè¶…è½½ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸å¾—ä¸è®©æˆ‘æ€è€ƒè§£å†³åŠæ³•ï¼Œå¦‚æœæ™®é€šæŸ¥è¯¢çš„å…³ç³»ä¿®è¡¥é‚£ä¹ˆæ™ºèƒ½çš„è¯ï¼Œå®ƒèƒ½å¸®åŠ©æˆ‘æé«˜æŸ¥è¯¢çš„æ€§èƒ½å—ï¼Ÿå®ƒå¯ä»¥ï¼è®©æˆ‘ç»™ä½ ä¸¾ä¸€ä¸ªå…¬å¸å‘˜å·¥çš„ä¾‹å­ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†æˆ‘ä»¬æƒ³è¦åŠ è½½çš„å…¬å¸çš„å±‚æ¬¡ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://qn-tc.geekgist.com/202006/17085549&quot; alt=&quot; &quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥æ¥é¾™å¼åœ°ä½¿ç”¨ .Include(x =&amp;gt; x.WorksForMe).ThenInclude(x =&amp;gt; x.WorksForMe)â€¦ ç­‰ç­‰æ¥åŠ è½½æ‰€éœ€çš„å±‚çº§ä¿¡æ¯ï¼Œä½†ç»“æœæ˜¯ä¸€ä¸ª .Include(x =&amp;gt; x.WorksForMe) å°±å¤Ÿäº†ã€‚å› ä¸º EF Core çš„å…³ç³»ä¿®è¡¥ä¸ºä½ åšäº†å‰©ä¸‹çš„äº‹æƒ…ï¼Œè¿™ä¸€ç‚¹å¾ˆæƒŠå¥‡ï¼Œä½†ä¹Ÿå¾ˆæœ‰ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘æƒ³æŸ¥è¯¢è§’è‰²ä¸º Development çš„æ‰€æœ‰å‘˜å·¥(æ¯ä¸ªå‘˜å·¥éƒ½æœ‰ä¸€ä¸ªåä¸º WhatTheyDo çš„å±æ€§å’Œåä¸º Role çš„å±æ€§ï¼Œè¯¥ Role åŒ…å«ä»–ä»¬å·¥ä½œçš„éƒ¨é—¨)ï¼Œæˆ‘å¯ä»¥è¿™æ ·ç¼–å†™ä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;var devDept = context.Employees
    .Include(x =&amp;gt; x.WorksFromMe)
    .Where(x =&amp;gt; x.WhatTheyDo.HasFlag(Roles.Development))
    .ToList();
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™å°†åˆ›å»ºä¸€ä¸ªæŸ¥è¯¢ï¼Œç”¨äºåŠ è½½è§’è‰²ä¸º Development çš„æ‰€æœ‰å‘˜å·¥ï¼Œå¹¶ä¸”åœ¨å‘˜å·¥å®ä½“ç±»ä¸Šä¿®è¡¥ä¸ WorksFoMe å¯¼èˆªå±æ€§(é›†åˆ)å’Œ Manager å¯¼èˆªå±æ€§(å•ä¸ª)çš„å…³ç³»ã€‚é€šè¿‡åªæ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢ï¼Œæ—¢æé«˜äº†æŸ¥è¯¢èŠ±è´¹çš„æ—¶é—´ï¼Œåˆå‡å°‘äº†æ•°æ®åº“æœåŠ¡å™¨ä¸Šçš„è´Ÿè½½ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ€»ç»“&quot;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ä½ å·²ç»çœ‹åˆ°äº†ä¸¤ç§ç±»å‹çš„æŸ¥è¯¢ï¼Œæˆ‘ç§°ä¹‹ä¸º a)æ™®é€šçš„è¯»å†™æŸ¥è¯¢ï¼Œå’Œ b) éè·Ÿè¸ªçš„åªè¯»æŸ¥è¯¢ã€‚å¯¹äºæ¯ä¸€ç§æŸ¥è¯¢ç±»å‹ï¼Œæˆ‘éƒ½å‘ä½ å±•ç¤ºäº† EF Core â€œå¹•åâ€æ˜¯å¦‚ä½•è¯»å–æ•°æ®å¹¶å±•ç¤ºçš„ã€‚ä»–ä»¬å·¥ä½œæ–¹å¼çš„ä¸åŒä¹Ÿè¡¨ç°å‡ºä»–ä»¬çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚&lt;/p&gt;
&lt;p&gt;éè·Ÿè¸ªæŸ¥è¯¢æ˜¯åªè¯»æŸ¥è¯¢çš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºå®ƒæ¯”æ™®é€šè¯»å†™æŸ¥è¯¢æ›´å¿«ã€‚ä½†æ˜¯æ‚¨åº”è¯¥è®°ä½å…³ç³»ä¿®è¡¥çš„æœºåˆ¶ï¼Œå®ƒå¯ä»¥åœ¨æ•°æ®åº“åªæœ‰ä¸€ä¸ªå…³ç³»çš„æƒ…å†µä¸‹åˆ›å»ºç±»çš„å¤šä¸ªå®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;æ™®é€šçš„è¯»å†™æŸ¥è¯¢æ˜¯æŸ¥è¯¢è·Ÿè¸ªå®ä½“çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤æ•°æ®æ—¶ä½¿ç”¨å®ƒä»¬ã€‚æ™®é€šçš„è¯»å†™æŸ¥è¯¢ç¡®å®ä¼šå ç”¨æ›´å¤šçš„æ—¶é—´å’Œå†…å­˜èµ„æºï¼Œä½†æ˜¯æœ‰ä¸€äº›æœ‰ç”¨çš„ç‰¹æ€§ï¼Œæ¯”å¦‚è‡ªåŠ¨é“¾æ¥åˆ°å…¶ä»–è¢«è·Ÿè¸ªçš„å®ä½“ç±»å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ã€‚ç¥ä½ ç¼–ç¨‹å¿«ä¹ï¼&lt;/p&gt;
&lt;p&gt;[1]. &lt;a href=&quot;https://bit.ly/2MXK3ZY&quot;&gt;https://bit.ly/2MXK3ZY&lt;/a&gt;&lt;br/&gt;[2]. &lt;a href=&quot;https://bit.ly/2Yza7QQ&quot;&gt;https://bit.ly/2Yza7QQ&lt;/a&gt;&lt;br/&gt;[3]. &lt;a href=&quot;https://bit.ly/2Y0UORO&quot;&gt;https://bit.ly/2Y0UORO&lt;/a&gt;&lt;br/&gt;[4]. &lt;a href=&quot;https://bit.ly/2YEyg8j&quot;&gt;https://bit.ly/2YEyg8j&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 17 Jun 2020 00:39:00 +0000</pubDate>
<dc:creator>LiamWang</dc:creator>
<og:description>é˜…è¯»æœ¬æ–‡å¤§æ¦‚éœ€è¦ 11 åˆ†é’Ÿã€‚ åŸæ–‡ï¼šhttps://bit.ly/2UMiDLb ä½œè€…ï¼šJon P Smith ç¿»è¯‘ï¼šç‹äº® å£°æ˜ï¼šæˆ‘ç¿»è¯‘æŠ€æœ¯æ–‡ç« ä¸æ˜¯é€å¥ç¿»è¯‘çš„ï¼Œè€Œæ˜¯æ ¹æ®æˆ‘è‡ªå·±çš„ç†è§£æ¥è¡¨è¿°çš„ã€‚å…¶ä¸­å¯èƒ½</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/willick/p/13150393.html</dc:identifier>
</item>
<item>
<title>Nginxå…¥é—¨å­¦ä¹  - Johnsonæœ¨æœ¨</title>
<link>http://www.cnblogs.com/Johnson-lin/p/13150368.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/Johnson-lin/p/13150368.html</guid>
<description>&lt;p&gt;nginx æ˜¯HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œé‚®ä»¶ä»£ç†æœåŠ¡å™¨å’Œé€šç”¨TCP/UDPä»£ç†æœåŠ¡å™¨ã€‚æ€»ä¹‹ä¸€å¥è¯ï¼Œnginxå¾ˆç«å¾ˆç‰›é€¼å°±å¯¹äº†ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹è½½åœ°å€ï¼š&lt;a href=&quot;http://nginx.org/en/download.html&quot;&gt;http://nginx.org/en/download.html&lt;/a&gt;ï¼›&lt;br/&gt;mainline:æœ€æ–°ç‰ˆæœ¬&lt;br/&gt;stable:ç¨³å®šç‰ˆæœ¬&lt;br/&gt;ä¸‹è½½å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;wget [ä¸‹è½½åœ°å€]
tar -zxvf [å‹ç¼©åŒ…]
&lt;/code&gt;
&lt;/pre&gt;

&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;autoï¼šè¾…åŠ©configureæ–‡ä»¶çš„æ‰§è¡Œ&lt;br/&gt;CHANGESï¼šä¸åŒç‰ˆæœ¬çš„ç‰¹æ€§&lt;br/&gt;confï¼šç¤ºä¾‹æ–‡ä»¶&lt;br/&gt;configureï¼šç”¨äºç”Ÿæˆä¸­é—´æ–‡ä»¶ï¼Œæ‰§è¡Œç¼–è¯‘å‰çš„å¿…é¡»åŠ¨ä½œ&lt;br/&gt;contribï¼švim nginxæ–‡ä»¶æ—¶æ˜¾ç¤ºçš„æ ·å¼ï¼Œç”¨æ³• cp contrib/vim/* ~/.vim/&lt;br/&gt;html:ï¼šnginxçš„é»˜è®¤htmlæ–‡ä»¶&lt;br/&gt;manï¼šnginxçš„å¸®åŠ©æ–‡ä»¶&lt;br/&gt;srcï¼šnginxæºä»£ç &lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;.&lt;code&gt;configure --xxx&lt;/code&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;--prefix=PATH nginxå®‰è£…ç›®å½•çš„å‰ç¼€&lt;br/&gt;--with-xxx é»˜è®¤ä¸ä¼šç¼–è¯‘è¿›nginxï¼Œéœ€è¦åˆ™å†™åˆ°å‘½ä»¤è¡Œ&lt;br/&gt;--without-xxx é»˜è®¤ç¼–è¯‘è¿›nginxï¼Œä¸éœ€è¦åˆ™å†™åˆ°å‘½ä»¤è¡Œ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ€æ™®é€šçš„&lt;code&gt;configure&lt;/code&gt;ç¼–è¯‘å‘½ä»¤ä¸º&lt;br/&gt;&lt;code&gt;.configure --prefix=/usr/local/nginx&lt;/code&gt;&lt;br/&gt;æ‰§è¡Œå®Œå‘½ä»¤åˆ™ç”Ÿæˆobjsç›®å½•ï¼Œå­˜æ”¾ä¸­é—´æ–‡ä»¶ï¼Œobjs/ngx_modules.c æ–‡ä»¶å†³å®šå“ªäº›æ¨¡å—å®‰è£…åˆ°nginxã€‚&lt;/p&gt;
&lt;p&gt;makeç¼–è¯‘ï¼š&lt;code&gt;make&lt;/code&gt;ï¼Œæ‰§è¡Œå®Œåç”Ÿæˆå¤§é‡çš„ä¸­é—´æ–‡ä»¶ï¼Œéƒ½ä¼šå­˜æ”¾åˆ°&lt;code&gt;objs/src&lt;/code&gt;ç›®å½•ä¸­ã€‚&lt;br/&gt;å®‰è£…ï¼š&lt;code&gt;make install&lt;/code&gt;&lt;/p&gt;

&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;-c æŒ‡å®šé…ç½®æ–‡ä»¶&lt;br/&gt;-g æŒ‡å®šé…ç½®çš„æŒ‡ä»¤&lt;br/&gt;-p æŒ‡å®šè¿è¡Œç›®å½•&lt;br/&gt;-s stop ç«‹åˆ»åœæ­¢æœåŠ¡ï¼› quit ä¼˜é›…çš„åœæ­¢æœåŠ¡ï¼›reload é‡è½½é…ç½®æ–‡ä»¶ï¼›reopen é‡æ–°å¼€å§‹è®°å½•æ—¥å¿—æ–‡ä»¶&lt;br/&gt;-t æµ‹è¯•é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æœ‰é”™è¯¯&lt;br/&gt;-v ç‰ˆæœ¬ä¿¡æ¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;é‡è½½é…ç½®æ–‡ä»¶&quot;&gt;é‡è½½é…ç½®æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;ä¿®æ”¹nginxé…ç½®æ–‡ä»¶çš„å†…å®¹åï¼Œéœ€è¦nginxé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;nginx -s reload
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;çƒ­éƒ¨ç½²&quot;&gt;çƒ­éƒ¨ç½²&lt;/h2&gt;
&lt;p&gt;nginxæ­£åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œæ­¤æ—¶éœ€è¦å‡çº§nginxç‰ˆæœ¬ã€‚åªéœ€è¦æ›´æ–°nginxäºŒè¿›åˆ¶æ–‡ä»¶ã€‚&lt;br/&gt;å…ˆå¤‡ä»½æ—§çš„nginxï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;cp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.old
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨æœ€æ–°çš„nginxäºŒè¿›åˆ¶æ–‡ä»¶ æ›¿æ¢æ‰æ­£åœ¨ä½¿ç”¨çš„nginxäºŒè¿›åˆ¶æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;cp -r nginx /usr/local/nginx/sbin/ -f
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„nginxçš„masterè¿›ç¨‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;ps -ef | grep nginx
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å‘Šè¯‰æ­£åœ¨è¿è¡Œnginxçš„masterï¼Œéœ€è¦è¿›è¡Œnginxå‡çº§&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;kill -USR2 [æ­£åœ¨è¿è¡Œçš„nginx masterè¿›ç¨‹ID]
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ‰§è¡Œå®Œå‘½ä»¤åä¼šå¯åŠ¨æ–°çš„nginxè¿›ç¨‹ï¼Œç„¶åå‘ŠçŸ¥æ—§çš„nginx masterè¿›ç¨‹ï¼Œè¯·ä¼˜é›…çš„å…³é—­æ‰€æœ‰æ—§çš„workerè¿›ç¨‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;kill -WINCH [æ—§çš„nginx masterè¿›ç¨‹ID]
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç„¶åä¼šå‘ç°æ—§çš„nginx workerè¿›ç¨‹å·²ç»å…¨éƒ¨å…³é—­ï¼Œå‘ç°masterè¿›ç¨‹è¿˜åœ¨ã€‚å¦‚æœæ–°çš„nginxç‰ˆæœ¬å‘ç”Ÿçš„é”™è¯¯ï¼Œå¯ä»¥å›é€€åˆ°æ—§çš„nginx masterè¿›ç¨‹ä¸­ï¼Œæ‰§è¡Œ&lt;code&gt;nginx -s reload&lt;/code&gt;ä¼šå›é€€åˆ°æ—§ç‰ˆæœ¬&lt;/p&gt;
&lt;h2 id=&quot;æ—¥å¿—åˆ‡å‰²&quot;&gt;æ—¥å¿—åˆ‡å‰²&lt;/h2&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;# å…ˆæŠŠæ—¥å¿—æ–‡ä»¶å…ˆå¤‡ä»½
mv access.log access_bak.log

# è¿›è¡Œæ—¥å¿—åˆ‡å‰²,æ‰§è¡Œå®Œå‘½ä»¤ä¼šé‡æ–°ç”Ÿæˆaccess.log æ–‡ä»¶
nginx -s reopen
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ä¼šåå°åšä¸€ä¸ªbashè„šæœ¬ï¼Œå®šæ—¶è¿›è¡Œæ—¥å¿—åˆ‡å‰²ã€‚&lt;/p&gt;

&lt;p&gt;nginx é…ç½®&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;# æ—¥å¿—æ ¼å¼ï¼Œmainä¸ºæ—¥å¿—æ ¼å¼å‘½å
log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
                   '$status $body_bytes_sent &quot;$http_referer&quot; '
                   '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;'; 
        
gzip on; # å¯¹æ–‡ä»¶è¿›è¡Œå‹ç¼©ä¼ é€
gzip_min_length 1; # å°äº 1 å­—èŠ‚åˆ™ä¸è¿›è¡Œå‹ç¼©ã€‚
gzip_comp_level 2; # å‹ç¼©çº§åˆ«
gzip_types image/jpeg image/gif; # å¯¹è¿™äº›æ–‡ä»¶æ‰è¿›è¡Œå‹ç¼©

server {
    listen 80; # ç›‘å¬ç«¯å£
    server_name localhost; # åŸŸå
        
        # è®°å½•access_logæ—¥å¿—ï¼ˆæ¯ä¸€ä¸ªè¯·æ±‚éƒ½ä¼šè®°å½•ï¼‰, ä½¿ç”¨mainçš„log_formatè¿›è¡Œè®°å½•
        access_log /logs/blog.log main; 

    # urlåŒ¹é…çš„è·¯å¾„
    location / { 
            alias  code/; # æŒ‡ nginxçš„å®‰è£…ç›®å½•ä¸‹ egï¼š/usr/local/nginx/code
            # autoindex on; # å…±äº«é™æ€èµ„æº
            # set $limit_rate 10k; # nginxæ¯ç§’ä¼ è¾“ 10kå­—èŠ‚ åˆ°æµè§ˆå™¨å½“ä¸­
    }
}
&lt;/code&gt;
&lt;/pre&gt;

&lt;p&gt;å¯ä»¥å»ºç«‹å¤šä¸ªä¸Šæ¸¸æœåŠ¡ï¼Œå½“æœ‰è¯·æ±‚è¿›æ¥çš„æ—¶å€™ï¼Œnginxå¯ä»¥æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•ä»£ç†ç»™å¤šå°ä¸Šæ¸¸æœåŠ¡å™¨å·¥ä½œã€‚nginxé…ç½®&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;# ä¸Šæ¸¸æœåŠ¡
# local ä¸ºä¸Šæ¸¸æœåŠ¡å™¨å
upstream local {
     # å…¶ä¸­ä¸€å°ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œå¯ä»¥é…ç½®å¤šå°
         # 127.0.0.1:8080 ä»£è¡¨åªæœ‰æœ¬æœºèƒ½è®¿é—®8080ç«¯å£
    server 127.0.0.1:8080; 
}

# åå‘ä»£ç†ç¼“å­˜    ç¼“å­˜è·¯å¾„                   å†…å­˜å…³é”®å­—ï¼Œ10m
proxy_cache_path /tmp/nginxcache levels=1:2 keys_zone=my_cache:10m max_size=10g;
inactive=60m use_temp_path=off;

server {
        listen 80;
    server_name colablog.cn; # åŸŸå
        
        # è®°å½•access_logæ—¥å¿—ï¼ˆæ¯ä¸€ä¸ªè¯·æ±‚éƒ½ä¼šè®°å½•ï¼‰, ä½¿ç”¨mainçš„log_formatè¿›è¡Œè®°å½•
        access_log /logs/blog.log main; 

    # urlåŒ¹é…çš„è·¯å¾„
    location / { 
            # doc http://nginx.org/en/docs/http/ngx_http_proxy_module.html
            # proxy_set_header åå‘ä»£ç†æœåŠ¡å™¨æŠŠå®¢æˆ·ç«¯è¯·æ±‚çš„ä¿¡æ¯ï¼Œè®¾ç½®åˆ°è¯·æ±‚å¤´ä¸­å‘é€åˆ°ä¸Šæ¸¸æœåŠ¡
            proxy_set_header Host $host; # åŸŸå
                proxy_set_header X-Real-IP $remote_addr; # å®¢æˆ·ç«¯åœ°å€
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                
                # ä½¿ç”¨å“ªä¸ªç¼“å­˜ï¼Œå¯¹åº”ä¸Šé¢çš„keys_zone
                proxy_cache my_cache;
                # ç¼“å­˜çš„è·¯å¾„
                proxy_cache_key $hots$uri$is_args$args;
                # å¯¹äºè¿™äº›å“åº”ä¸ç¼“å­˜
                proxy_cache_valid 200 304 302 1d;
        
            # ä»£ç†åˆ°ä¸Šæ¸¸æœåŠ¡
            proxy_pass http://local;
    }
}
&lt;/code&gt;
&lt;/pre&gt;

&lt;h2 id=&quot;å®‰è£…-2&quot;&gt;å®‰è£…&lt;/h2&gt;
&lt;p&gt;ä½ å¯ä»¥å¿«é€Ÿä½¿ç”¨ &lt;code&gt;apt install&lt;/code&gt;æˆ–è€… &lt;code&gt;yum install&lt;/code&gt;ï¼Œä¹Ÿå¯ä»¥åœ¨&lt;a href=&quot;https://www.goaccess.cc/?mod=download&quot;&gt;å®˜ç½‘&lt;/a&gt;ä¸­æŸ¥çœ‹ç¼–è¯‘å®‰è£…çš„æ–¹å¼ã€‚&lt;br/&gt;è¿è¡Œgoaccesså‘½ä»¤&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;# goaccess /usr/local/nginx/logs/access.log -o /usr/local/nginx/html/report.html --real-time-html --time=format='%H:%M:%S' --date-format='%d/%b/%Y' --log-format=COMBINED
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;--real-time-html ä»£è¡¨å®æ—¶æ›´æ–°é¡µé¢&lt;/p&gt;
&lt;p&gt;nginx.confé…ç½®æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;    # æ—¥å¿—æ ¼å¼
    log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
                  '$status $body_bytes_sent &quot;$http_referer&quot; '
                  '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

    server {
        listen 80;
        server_name: localhost;
        # æ—¥å¿—è®°å½•
        access_log logs/access.log main;
        
        # æŒ‡å®šé¡µé¢
        location /report.html {
            alias /usr/local/nginx/html/report.html;
        }
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç„¶åè®¿é—® &lt;code&gt;http://localhost/report.html&lt;/code&gt;ï¼Œå°±å¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™ä¹ˆé«˜å¤§ä¸Šçš„ç•Œé¢äº†ã€‚&lt;br/&gt;&lt;img src=&quot;http://qiniublog.colablog.cn/5165b755-ee18-46e1-9556-227cae5459b7.jpg&quot; alt=&quot;nginxaccesslog.jpg&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ æœ‰åŸŸåçš„è¯ï¼Œåªéœ€è¦ä¸¤è¡Œå‘½ä»¤å¯ä»¥å¿«é€ŸæŠŠä½ çš„ &lt;a href=&quot;http://xn--eqrt2g&quot;&gt;http://åŸŸå&lt;/a&gt; å˜æˆ &lt;a href=&quot;https://xn--eqrt2g&quot;&gt;https://åŸŸå&lt;/a&gt;ã€‚&lt;br/&gt;ubuntuç‰ˆæœ¬ä¸‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;apt install python-certbot-nginx
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;centosç‰ˆæœ¬ä¸‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;yum install python2-certbot-nginx
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;certbot&lt;/code&gt;å‘½ä»¤å¸®æˆ‘ä»¬ä¸‹è½½è¯ä¹¦å’Œè‡ªåŠ¨é…ç½®å¥½nginx.confï¼Œ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;certbot --nginx --nginx-server-root=/usr/local/nginx/conf/ -d [ä½ çš„åŸŸå]
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ‰§è¡Œäº†ä¸Šé¢çš„å‘½ä»¤åä¼šæœ‰ä¸¤ä¸ªé€‰é¡¹ï¼Œç¬¬ä¸€ä¸ªé€‰é¡¹æ˜¯å¯ä»¥è®¿é—®httpæˆ–è€…httpsï¼Œä¸ä¼šè¿›è¡Œé‡å®šå‘ï¼›è€Œç¬¬äºŒä¸ªé€‰é¡¹åˆ™æ˜¯è®¿é—®httpçš„æ—¶å€™é‡å®šå‘åˆ°httpsä¸­ã€‚&lt;br/&gt;å°±è¿™æ ·å°±æå®šäº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ã€‚&lt;/p&gt;

&lt;p&gt;Nginxåˆæ¬¡å…¥é—¨çš„å°ç™½ï¼Œæ–‡ç« è‹¥æœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œè¯·ç”¨åŠ›çš„æŒ‡å‡ºã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒæ–‡ç« ï¼š&lt;a href=&quot;https://time.geekbang.org/course/intro/100020301&quot;&gt;æå®¢æ—¶é—´ï¼šNginxæ ¸å¿ƒçŸ¥è¯†100è®²&lt;/a&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;2.6190476190476&quot;&gt;
&lt;p&gt;ä¸ªäººåšå®¢ç½‘å€ï¼š &lt;a href=&quot;https://colablog.cn/&quot;&gt;https://colablog.cn/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœæˆ‘çš„æ–‡ç« å¸®åŠ©åˆ°æ‚¨ï¼Œå¯ä»¥å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ï¼Œç¬¬ä¸€æ—¶é—´åˆ†äº«æ–‡ç« ç»™æ‚¨&lt;br/&gt;&lt;img src=&quot;http://qiniuyun.colablog.cn/%E4%BA%8C%E7%BB%B4%E7%A0%81.jpg&quot; alt=&quot;å¾®ä¿¡å…¬ä¼—å·&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 17 Jun 2020 00:21:00 +0000</pubDate>
<dc:creator>Johnsonæœ¨æœ¨</dc:creator>
<og:description>ç®€ä»‹ nginx æ˜¯HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œé‚®ä»¶ä»£ç†æœåŠ¡å™¨å’Œé€šç”¨TCP/UDPä»£ç†æœåŠ¡å™¨ã€‚æ€»ä¹‹ä¸€å¥è¯ï¼Œnginxå¾ˆç«å¾ˆç‰›é€¼å°±å¯¹äº†ã€‚ download ä¸‹è½½åœ°å€ï¼šhttp://nginx.org/en</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/Johnson-lin/p/13150368.html</dc:identifier>
</item>
<item>
<title>.Net Coreå¾®æœåŠ¡å…¥é—¨å…¨çºªå½•ï¼ˆå››ï¼‰â€”â€”Ocelot-APIç½‘å…³ï¼ˆä¸Šï¼‰ - xhznl</title>
<link>http://www.cnblogs.com/xhznl/p/13092535.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/xhznl/p/13092535.html</guid>
<description>&lt;p&gt;ä¸Šä¸€ç¯‡ã€&lt;a href=&quot;https://www.cnblogs.com/xhznl/p/13096891.html&quot;&gt;.Net Coreå¾®æœåŠ¡å…¥é—¨å…¨çºªå½•ï¼ˆä¸‰ï¼‰â€”â€”Consul-æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆä¸‹ï¼‰&lt;/a&gt;ã€‘å·²ç»ä½¿ç”¨Consulå®Œæˆäº†æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ï¼Œå®é™…ä¸­å…‰æœ‰æœåŠ¡æ³¨å†Œä¸å‘ç°å¾€å¾€æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£æ¥è¿æ¥å®¢æˆ·ç«¯ä¸æœåŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;å®˜ç½‘ï¼š&lt;a href=&quot;https://ocelot.readthedocs.io/&quot;&gt;https://ocelot.readthedocs.io/&lt;/a&gt;&lt;br/&gt;Ocelotæ­£æ˜¯ä¸º.Netå¾®æœåŠ¡ä½“ç³»æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ç‚¹ï¼Œç§°ä¸ºï¼šGatewayï¼ˆç½‘å…³ï¼‰ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä¸Šæ‰‹Ocelotï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„asp.net core webé¡¹ç›®ã€‚&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200614170112051-1111424782.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;æ³¨æ„ocelot.jsonæ˜¯æˆ‘ä»¬æ·»åŠ çš„Ocelotçš„é…ç½®æ–‡ä»¶ï¼Œè®°å¾—è®¾ç½®ç”Ÿæˆæ—¶å¤åˆ¶åˆ°è¾“å‡ºç›®å½•ã€‚ocelot.jsonçš„æ–‡ä»¶åä¸æ˜¯å›ºå®šçš„ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰ã€‚&lt;/p&gt;
&lt;p&gt;NuGetå®‰è£…ä¸€ä¸‹Ocelotï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200614165355576-719151292.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;åªéœ€ç®€å•çš„ä¿®æ”¹å‡ å¤„é»˜è®¤ä»£ç ï¼š&lt;br/&gt;Program.csï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;    public class Program
    {
        public static void Main(string[] args)
        {
            CreateHostBuilder(args).Build().Run();
        }

        public static IHostBuilder CreateHostBuilder(string[] args) =&amp;gt;
            Host.CreateDefaultBuilder(args)
                .ConfigureAppConfiguration((hostingContext, config) =&amp;gt;
                {
                    config.AddJsonFile(&quot;ocelot.json&quot;);
                })
                .ConfigureWebHostDefaults(webBuilder =&amp;gt;
                {
                    webBuilder.UseStartup&amp;lt;Startup&amp;gt;();
                });
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Startup.csï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;    public class Startup
    {
        // This method gets called by the runtime. Use this method to add services to the container.
        // For more information on how to configure your application, visit https://go.microsoft.com/fwlink/?LinkID=398940
        public void ConfigureServices(IServiceCollection services)
        {
            //æ·»åŠ ocelotæœåŠ¡
            services.AddOcelot();
        }

        // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
        public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
        {
            //è®¾ç½®Ocelotä¸­é—´ä»¶
            app.UseOcelot().Wait();
        }
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ocelot.jsonï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;{
  &quot;Routes&quot;: [
    {
      &quot;DownstreamPathTemplate&quot;: &quot;/products&quot;,
      &quot;DownstreamScheme&quot;: &quot;http&quot;,
      &quot;DownstreamHostAndPorts&quot;: [
        {
          &quot;Host&quot;: &quot;localhost&quot;,
          &quot;Port&quot;: 9050
        },
        {
          &quot;Host&quot;: &quot;localhost&quot;,
          &quot;Port&quot;: 9051
        },
        {
          &quot;Host&quot;: &quot;localhost&quot;,
          &quot;Port&quot;: 9052
        }
      ],
      &quot;UpstreamPathTemplate&quot;: &quot;/products&quot;,
      &quot;UpstreamHttpMethod&quot;: [
        &quot;Get&quot;
      ],
      &quot;LoadBalancerOptions&quot;: {
        &quot;Type&quot;: &quot;RoundRobin&quot; //è´Ÿè½½å‡è¡¡ï¼Œè½®è¯¢æœºåˆ¶ LeastConnection/RoundRobin/NoLoadBalancer/CookieStickySessions
      }
    },
    {
      &quot;DownstreamPathTemplate&quot;: &quot;/orders&quot;,
      &quot;DownstreamScheme&quot;: &quot;http&quot;,
      &quot;DownstreamHostAndPorts&quot;: [
        {
          &quot;Host&quot;: &quot;localhost&quot;,
          &quot;Port&quot;: 9060
        },
        {
          &quot;Host&quot;: &quot;localhost&quot;,
          &quot;Port&quot;: 9061
        },
        {
          &quot;Host&quot;: &quot;localhost&quot;,
          &quot;Port&quot;: 9062
        }
      ],
      &quot;UpstreamPathTemplate&quot;: &quot;/orders&quot;,
      &quot;UpstreamHttpMethod&quot;: [
        &quot;Get&quot;
      ],
      &quot;LoadBalancerOptions&quot;: {
        &quot;Type&quot;: &quot;RoundRobin&quot; //è´Ÿè½½å‡è¡¡ï¼Œè½®è¯¢æœºåˆ¶ LeastConnection/RoundRobin/NoLoadBalancer/CookieStickySessions
      }
    }
  ],
  &quot;GlobalConfiguration&quot;: {
    &quot;BaseUrl&quot;: &quot;http://localhost:9070&quot;
  }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæš‚æ—¶å¿½ç•¥Consulï¼Œå°†æœåŠ¡å®ä¾‹çš„åœ°å€éƒ½å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ã€‚è¦çŸ¥é“Consulã€Ocelotç­‰ç»„ä»¶éƒ½æ˜¯å¯ä»¥ç‹¬ç«‹å­˜åœ¨çš„ã€‚&lt;br/&gt;é…ç½®æ–‡ä»¶ä¸­çš„RoutesèŠ‚ç‚¹ç”¨æ¥é…ç½®è·¯ç”±ï¼ŒDownstreamä»£è¡¨ä¸‹æ¸¸ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡å®ä¾‹ï¼ŒUpstreamä»£è¡¨ä¸Šæ¸¸ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬çš„è·¯å¾„æ¯”è¾ƒç®€å•ï¼Œåªæœ‰/productsã€/ordersï¼Œè·¯å¾„ä¸­å¦‚æœæœ‰ä¸å›ºå®šå‚æ•°åˆ™ä½¿ç”¨{}åŒ¹é…ã€‚æˆ‘ä»¬è¿™ä¸ªé…ç½®çš„æ„æ€å‘¢å°±æ˜¯å®¢æˆ·ç«¯è®¿é—®ç½‘å…³çš„/ordersã€/productsï¼Œç½‘å…³ä¼šè½¬å‘ç»™æœåŠ¡å®ä¾‹çš„/ordersã€/productsï¼Œæ³¨æ„è¿™ä¸ªä¸Šæ¸¸çš„è·¯å¾„ä¸ä¸€å®šè¦å’Œä¸‹æ¸¸ä¸€è‡´ï¼Œæ¯”å¦‚ä¸Šæ¸¸è·¯å¾„å¯ä»¥é…ç½®æˆ/api/ordersï¼Œ/xxxéƒ½å¯ä»¥ã€‚&lt;br/&gt;LoadBalancerOptionsèŠ‚ç‚¹ç”¨æ¥é…ç½®è´Ÿè½½å‡è¡¡ï¼ŒOcelotå†…ç½®äº† LeastConnectionã€RoundRobinã€NoLoadBalancerã€CookieStickySessions 4ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚&lt;br/&gt;BaseUrlèŠ‚ç‚¹å°±æ˜¯é…ç½®æˆ‘ä»¬ocelotç½‘å…³å°†è¦è¿è¡Œçš„åœ°å€ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;è¿è¡Œgatewayï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;ç›®å‰ä¸è€ƒè™‘ç½‘å…³é›†ç¾¤ï¼Œå°±ä¸æ”¾åœ¨dockeré‡Œäº†ã€‚ç›´æ¥æ§åˆ¶å°æ‰§è¡Œï¼š`dotnet Ocelot.APIGateway.dll --urls=&quot;http://*:9070&quot;&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200614184332541-1501130617.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ç”¨æµè§ˆå™¨æµ‹è¯•ä¸€ä¸‹ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200614184855090-549409108.gif&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200614185019340-1915263540.gif&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;æµ‹è¯•æ­£å¸¸ï¼Œæˆ‘ä»¬é€šè¿‡ç½‘å…³å¯ä»¥æ­£å¸¸çš„è®¿é—®åˆ°æœåŠ¡å®ä¾‹ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æ¥ä¸‹æ¥ç»§ç»­æ”¹é€ å®¢æˆ·ç«¯ä»£ç ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200614185314359-771408665.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;å› ä¸ºæ”¹åŠ¨å¤ªå¤šå°±ç›´æ¥æ–°å»ºä¸€ä¸ªGatewayServiceHelperæ¥åšã€‚&lt;br/&gt;GatewayServiceHelperï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;    /// &amp;lt;summary&amp;gt;
    /// é€šè¿‡gatewayè°ƒç”¨æœåŠ¡
    /// &amp;lt;/summary&amp;gt;
    public class GatewayServiceHelper : IServiceHelper
    {
        public async Task&amp;lt;string&amp;gt; GetOrder()
        {
            var Client = new RestClient(&quot;http://localhost:9070&quot;);
            var request = new RestRequest(&quot;/orders&quot;, Method.GET);

            var response = await Client.ExecuteAsync(request);
            return response.Content;
        }

        public async Task&amp;lt;string&amp;gt; GetProduct()
        {
            var Client = new RestClient(&quot;http://localhost:9070&quot;);
            var request = new RestRequest(&quot;/products&quot;, Method.GET);

            var response = await Client.ExecuteAsync(request);
            return response.Content;
        }

        public void GetServices()
        {
            throw new NotImplementedException();
        }
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç„¶ååœ¨Startupä¸­ä¿®æ”¹ä¸€ä¸‹æ³¨å…¥çš„ç±»å‹ï¼Œåˆ«çš„å°±ä¸ç”¨æ”¹äº†ï¼Œè¿™å°±æ˜¯ä¾èµ–æ³¨å…¥çš„å¥½å¤„ä¹‹ä¸€ã€‚ã€‚ã€‚&lt;br/&gt;Startup.ConfigureServices()ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;//æ³¨å…¥IServiceHelper
//services.AddSingleton&amp;lt;IServiceHelper, ServiceHelper&amp;gt;();
            
//æ³¨å…¥IServiceHelper
services.AddSingleton&amp;lt;IServiceHelper, GatewayServiceHelper&amp;gt;();
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Startup.Configure()ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;//ç¨‹åºå¯åŠ¨æ—¶ è·å–æœåŠ¡åˆ—è¡¨
//serviceHelper.GetServices();
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿è¡Œå®¢æˆ·ç«¯æµ‹è¯•ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200614190357965-1065989945.gif&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¥½äº†ï¼Œç°åœ¨å®¢æˆ·ç«¯å¯¹æœåŠ¡çš„è°ƒç”¨éƒ½é€šè¿‡ç½‘å…³è¿›è¡Œä¸­è½¬ï¼Œå®¢æˆ·ç«¯å†ä¹Ÿä¸ç”¨å»å…³å¿ƒé‚£ä¸€å †æœåŠ¡å®ä¾‹çš„åœ°å€ï¼Œåªéœ€è¦çŸ¥é“ç½‘å…³åœ°å€å°±å¯ä»¥äº†ã€‚å¦å¤–ï¼ŒæœåŠ¡ç«¯ä¹Ÿé¿å…äº†æœåŠ¡åœ°å€ç›´æ¥æš´éœ²ç»™å®¢æˆ·ç«¯ã€‚è¿™æ ·åšå¯¹å®¢æˆ·ç«¯ï¼ŒæœåŠ¡éƒ½éå¸¸å‹å¥½ã€‚&lt;/p&gt;
&lt;p&gt;è‡³äºæˆ‘ä»¬çš„apiç½‘å…³å‘¢ï¼Œåˆè¦è¯´åˆ°æœåŠ¡å‘ç°çš„é—®é¢˜äº†ã€‚ç›®å‰æˆ‘ä»¬çš„æœåŠ¡åœ°å€æ˜¯å†™åœ¨ocelot.jsoné…ç½®æ–‡ä»¶é‡Œçš„ï¼Œå½“ç„¶è¿™ç§åšæ³•åœ¨æœåŠ¡å®ä¾‹ä¸ç»å¸¸å˜åŒ–çš„æƒ…å†µä¸‹æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä¸€æ—¦æœåŠ¡å˜åŒ–ï¼Œéœ€è¦äººä¸ºçš„ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè¿™åˆæ˜¾å¾—ä¸å¤ªåˆç†äº†ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œå¼ºå¤§çš„Ocelotä¸ºæˆ‘ä»¬æä¾›äº†æœåŠ¡å‘ç°çš„æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;ä»£ç æ”¾åœ¨ï¼š&lt;a href=&quot;https://github.com/xiajingren/NetCoreMicroserviceDemo&quot;&gt;https://github.com/xiajingren/NetCoreMicroserviceDemo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœªå®Œå¾…ç»­...&lt;/p&gt;
</description>
<pubDate>Wed, 17 Jun 2020 00:17:00 +0000</pubDate>
<dc:creator>xhznl</dc:creator>
<og:description>å‰è¨€ ä¸Šä¸€ç¯‡ã€.Net Coreå¾®æœåŠ¡å…¥é—¨å…¨çºªå½•ï¼ˆä¸‰ï¼‰â€”â€”Consul-æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆä¸‹ï¼‰ã€‘å·²ç»ä½¿ç”¨Consulå®Œæˆäº†æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ï¼Œå®é™…ä¸­å…‰æœ‰æœåŠ¡æ³¨å†Œä¸å‘ç°å¾€å¾€æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£æ¥</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/xhznl/p/13092535.html</dc:identifier>
</item>
<item>
<title>javaå¹¶å‘ç¼–ç¨‹ --å¹¶å‘é—®é¢˜çš„æ ¹æºåŠä¸»è¦è§£å†³æ–¹æ³• - zzzzMing</title>
<link>http://www.cnblogs.com/listenfwind/p/13149718.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/listenfwind/p/13149718.html</guid>
<description>&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬è¦çŸ¥é“å¹¶å‘è¦è§£å†³çš„æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Ÿå¹¶å‘è¦è§£å†³çš„æ˜¯å•è¿›ç¨‹æƒ…å†µä¸‹ç¡¬ä»¶èµ„æºæ— æ³•å……åˆ†åˆ©ç”¨çš„é—®é¢˜ã€‚è€Œé€ æˆè¿™ä¸€é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯CPU-å†…å­˜-ç£ç›˜ä¸‰è€…ä¹‹é—´é€Ÿåº¦å·®å¼‚å®åœ¨å¤ªå¤§ã€‚å¦‚æœå°†CPUçš„é€Ÿåº¦æ¯”ä½œç«ç®­çš„é€Ÿåº¦ï¼Œé‚£ä¹ˆå†…å­˜çš„é€Ÿåº¦å°±åƒç«è½¦ï¼Œè€Œæœ€æƒ¨çš„ç£ç›˜ï¼ŒåŸºæœ¬ä¸Šå°±ç›¸å½“äºäººåŒè…¿èµ°è·¯ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·é€ æˆçš„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯CPUå¿«é€Ÿæ‰§è¡Œå®Œå®ƒçš„ä»»åŠ¡çš„æ—¶å€™ï¼Œå¾ˆé•¿æ—¶é—´éƒ½ä¼šåœ¨ç­‰å¾…ç£ç›˜æˆ–æ˜¯å†…å­˜çš„è¯»å†™ã€‚&lt;/p&gt;
&lt;p&gt;è®¡ç®—æœºçš„å‘å±•æœ‰ä¸€éƒ¨åˆ†å°±æ˜¯å¦‚ä½•é‡å¤åˆ©ç”¨èµ„æºï¼Œè§£å†³ç¡¬ä»¶èµ„æºä¹‹é—´æ•ˆç‡çš„ä¸å¹³è¡¡ï¼Œè€Œåå°±æœ‰äº†å¤šè¿›ç¨‹ï¼Œå¤šçº¿ç¨‹çš„å‘å±•ã€‚å¹¶ä¸”æ¼”åŒ–å‡ºäº†å„ç§ä¸ºå¤šè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰æœåŠ¡çš„ä¸œè¥¿ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;CPUå¢åŠ ç¼“å­˜æœºåˆ¶ï¼Œå¹³è¡¡ä¸å†…å­˜çš„é€Ÿåº¦å·®å¼‚&lt;/li&gt;
&lt;li&gt;å¢åŠ äº†å¤šä¸ªæ¦‚å¿µï¼ŒCPUæ—¶é—´ç‰‡ï¼Œç¨‹åºè®¡æ•°å™¨ï¼Œçº¿ç¨‹åˆ‡æ¢ç­‰ï¼Œç”¨ä»¥æ›´å¥½å¾—æœåŠ¡å¹¶å‘åœºæ™¯&lt;/li&gt;
&lt;li&gt;ç¼–è¯‘å™¨çš„æŒ‡ä»¤ä¼˜åŒ–ï¼Œå¸Œæœ›åœ¨&lt;strong&gt;å†…éƒ¨&lt;/strong&gt;å……åˆ†åˆ©ç”¨ç¡¬ä»¶èµ„æº&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;ä½†æ˜¯è¿™æ ·ä¸€æ¥ï¼Œä¹Ÿä¼šå¸¦æ¥æ–°çš„å¹¶å‘é—®é¢˜ï¼Œå½’ç»“èµ·æ¥ä¸»è¦æœ‰ä¸‰ä¸ªã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ç”±äºç¼“å­˜å¯¼è‡´çš„å¯è§æ€§é—®é¢˜&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„åŸå­æ€§é—®é¢˜&lt;/li&gt;
&lt;li&gt;ç¼–è¯‘å™¨ä¼˜åŒ–å¸¦æ¥çš„æœ‰åºæ€§é—®é¢˜&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;æˆ‘ä»¬åˆ†åˆ«ä»‹ç»è¿™å‡ ä¸ªï¼š&lt;/p&gt;
&lt;h3 id=&quot;ç¼“å­˜å¯¼è‡´çš„å¯è§æ€§&quot;&gt;ç¼“å­˜å¯¼è‡´çš„å¯è§æ€§&lt;/h3&gt;
&lt;p&gt;CPUä¸ºäº†å¹³è¡¡ä¸å†…å­˜ä¹‹é—´çš„æ€§èƒ½å·®å¼‚ï¼Œå¼•å…¥äº†CPUç¼“å­˜ï¼Œè¿™æ ·CPUæ‰§è¡ŒæŒ‡ä»¤ä¿®æ”¹æ•°æ®çš„æ—¶å€™å°±å¯ä»¥æ‰¹é‡ç›´æ¥è¯»å†™CPUç¼“å­˜çš„å†…å­˜ï¼Œä¸€ä¸ªé˜¶æ®µåå†å°†æ•°æ®å†™å›åˆ°å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;ä½†ç”±äºç°åœ¨å¤šæ ¸CPUæŠ€æœ¯çš„å‘å±•ï¼Œå„ä¸ªçº¿ç¨‹å¯èƒ½è¿è¡Œåœ¨ä¸åŒCPUæ ¸ä¸Šé¢ï¼Œæ¯ä¸ªCPUæ ¸å„æœ‰å„è‡ªçš„CPUç¼“å­˜ã€‚å‰é¢è¯´åˆ°å¯¹å˜é‡çš„ä¿®æ”¹é€šå¸¸éƒ½ä¼šå…ˆå†™å…¥CPUç¼“å­˜ï¼Œå†å†™å›å†…å­˜ã€‚è¿™å°±ä¼šå‡ºç°è¿™æ ·ä¸€ç§æƒ…å†µï¼Œçº¿ç¨‹1ä¿®æ”¹äº†å˜é‡Aï¼Œä½†æ­¤æ—¶ä¿®æ”¹åçš„å˜é‡Aåªå­˜å‚¨åœ¨CPUç¼“å­˜ä¸­ã€‚è¿™æ—¶å€™çº¿ç¨‹Bå»å†…å­˜ä¸­è¯»å–å˜é‡Aï¼Œä¾æ—§åªè¯»å–åˆ°æ—§çš„å€¼ï¼Œè¿™å°±æ˜¯å¯è§æ€§é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&quot;çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„åŸå­æ€§&quot;&gt;çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„åŸå­æ€§&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†æ›´å……åˆ†å¾—åˆ©ç”¨CPUï¼Œå¼•å…¥äº†CPUæ—¶é—´ç‰‡æ—¶é—´ç‰‡çš„æ¦‚å¿µã€‚è¿›ç¨‹æˆ–çº¿ç¨‹é€šè¿‡äº‰ç”¨CPUæ—¶é—´ç‰‡ï¼Œè®©CPUå¯ä»¥æ›´åŠ å……åˆ†å¾—åˆ©ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚åœ¨è¿›è¡Œè¯»å†™ç£ç›˜ç­‰è€—æ—¶é«˜çš„ä»»åŠ¡æ—¶ï¼Œå°±å¯ä»¥å°†å®è´µçš„CPUèµ„æºè®©å‡ºæ¥è®©å…¶ä»–çº¿ç¨‹å»è·å–CPUå¹¶æ‰§è¡Œä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ä½†è¿™æ ·çš„åˆ‡æ¢ä¹Ÿä¼šå¯¼è‡´é—®é¢˜ï¼Œé‚£å°±æ˜¯ä¼šç ´åçº¿ç¨‹æŸäº›ä»»åŠ¡çš„åŸå­æ€§ã€‚æ¯”å¦‚javaä¸­ç®€å•çš„ä¸€æ¡è¯­å¥count += 1ã€‚&lt;/p&gt;
&lt;p&gt;æ˜ å°„åˆ°CPUæŒ‡ä»¤æœ‰ä¸‰æ¡ï¼Œè¯»å–countå˜é‡æŒ‡ä»¤ï¼Œå˜é‡åŠ 1æŒ‡ä»¤ï¼Œå˜é‡å†™å›æŒ‡ä»¤ã€‚è™½ç„¶åœ¨é«˜çº§è¯­è¨€ï¼ˆjavaï¼‰çœ‹æ¥å®ƒå°±æ˜¯ä¸€æ¡æŒ‡ä»¤ï¼Œä½†å®é™…ä¸Šç¡®æ˜¯ä¸‰æ¡CPUæŒ‡ä»¤ï¼Œå¹¶ä¸”è¿™ä¸‰æ¡æŒ‡ä»¤çš„åŸå­æ€§æ— æ³•ä¿è¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯èƒ½åœ¨æ‰§è¡Œåˆ°ä»»æ„ä¸€æ¡æŒ‡ä»¤çš„æ—¶å€™è¢«æ‰“æ–­ï¼ŒCPUè¢«å…¶ä»–çº¿ç¨‹æŠ¢å äº†ã€‚è€Œè¿™ä¸ªæœŸé—´å˜é‡å€¼å¯èƒ½ä¼šè¢«ä¿®æ”¹ï¼Œè¿™é‡Œå°±ä¼šå¼•å‘æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µäº†ã€‚æ‰€ä»¥é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¾ˆå¤šæ—¶å€™éƒ½ä¼šé€šè¿‡é”å®ç°åŸå­æ€§ã€‚è€Œè¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯å¾ˆå¤šå¹¶å‘é—®é¢˜çš„æºå¤´ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ç¼–è¯‘å™¨ä¼˜åŒ–å¸¦æ¥çš„æœ‰åºæ€§&quot;&gt;ç¼–è¯‘å™¨ä¼˜åŒ–å¸¦æ¥çš„æœ‰åºæ€§&lt;/h3&gt;
&lt;p&gt;å› ä¸ºç°åœ¨ç¨‹åºå‘˜ç¼–å†™çš„éƒ½æ˜¯é«˜çº§è¯­è¨€ï¼Œç¼–è¯‘å™¨éœ€è¦å°†ç”¨æˆ·çš„ä»£ç è½¬æˆCPUå¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶ï¼Œç”±äºè®¡ç®—æœºé¢†åŸŸçš„ä¸æ–­å‘å±•ï¼Œç¼–è¯‘å™¨ä¹Ÿè¶Šæ¥è¶Šæ™ºèƒ½ï¼Œå®ƒä¼šè‡ªåŠ¨å¯¹ç¨‹åºå‘˜ç¼–å†™çš„ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œè€Œä¼˜åŒ–ä¸­å°±æœ‰å¯èƒ½å‡ºç°å®é™…æ‰§è¡Œä»£ç é¡ºåºå’Œç¼–å†™çš„ä»£ç é¡ºåºä¸ä¸€æ ·çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;è€Œè¿™ç§ç ´åç¨‹åºæœ‰åºæ€§çš„è¡Œä¸ºï¼Œåœ¨æœ‰äº›æ—¶å€™ä¼šå‡ºç°ä¸€äº›éå¸¸å¾®å¦™ä¸”éš¾ä»¥å¯Ÿè§‰çš„å¹¶å‘ç¼–ç¨‹bugã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¸¸è§çš„å•ä¾‹æ¨¡å¼æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public class Singleton {
 
 private Singleton() {}

 private static Singleton sInstance;

 public static Singleton getInstance() {

    if (sInstance == null) {    //ç¬¬ä¸€æ¬¡éªŒè¯æ˜¯å¦ä¸ºnull
      synchronized (Singleton.class) {   //åŠ é”
        if (sInstance == null) {          //ç¬¬äºŒæ¬¡éªŒè¯æ˜¯å¦ä¸ºnull
          sInstance = new Singleton();  //åˆ›å»ºå¯¹è±¡
                 }
             }
         }
    return sInstance;
    }

}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å³é€šè¿‡ä¸¤æ®µåˆ¤æ–­åŠ é”æ¥ä¿è¯å•ä¾‹çš„æˆåŠŸç”Ÿæˆï¼Œä½†åœ¨æå°çš„æ¦‚ç‡ä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°å¼‚å¸¸æƒ…å†µã€‚åŸå› å°±å‡ºç°åœ¨&lt;strong&gt;sInstance = new Singleton()&lt;/strong&gt;;è¿™ä¸€è¡Œä»£ç ä¸Šã€‚è¿™è¡Œä»£ç ï¼Œæˆ‘ä»¬ç†è§£çš„æ‰§è¡Œé¡ºåºåº”è¯¥æ˜¯è¿™æ ·ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ä¸ºSingletonè±¡åˆ†é…ä¸€ä¸ªå†…å­˜ç©ºé—´ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨åˆ†é…çš„å†…å­˜ç©ºé—´å®ä¾‹åŒ–å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;æŠŠInstance å¼•ç”¨åœ°å€æŒ‡å‘å†…å­˜ç©ºé—´ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;ä½†åœ¨å®é™…ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨æœ‰å¯èƒ½ä¼šå¸®æˆ‘ä»¬è¿›è¡Œä¼˜åŒ–ï¼Œä¼˜åŒ–å®Œå®ƒçš„é¡ºåºå¯èƒ½å˜æˆå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ä¸ºSingletonå¯¹è±¡åˆ†é…ä¸€ä¸ªå†…å­˜ç©ºé—´ã€‚&lt;/li&gt;
&lt;li&gt;æŠŠinstance å¼•ç”¨åœ°å€æŒ‡å‘å†…å­˜ç©ºé—´ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨åˆ†é…çš„å†…å­˜ç©ºé—´å®ä¾‹åŒ–å¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;æŒ‰ç…§ä¼˜åŒ–å®Œçš„é¡ºåºï¼Œå½“å¹¶å‘è®¿é—®çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µ&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;Açº¿ç¨‹è¿›å…¥æ–¹æ³•è¿›è¡Œç¬¬1æ¬¡instance == nullåˆ¤æ–­ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤æ—¶Açº¿ç¨‹å‘ç°instance ä¸ºnull æ‰€ä»¥å¯¹Singleton.classåŠ é”ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åAçº¿ç¨‹è¿›å…¥æ–¹æ³•è¿›è¡Œç¬¬2æ¬¡instance == nullåˆ¤æ–­ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åAçº¿ç¨‹å‘ç°instance ä¸ºnullï¼Œå¼€å§‹è¿›è¡Œå¯¹è±¡å®ä¾‹åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºå¯¹è±¡åˆ†é…ä¸€ä¸ªå†…å­˜ç©ºé—´ã€‚&lt;br/&gt;6.æŠŠInstance å¼•ç”¨åœ°å€æŒ‡å‘å†…å­˜ç©ºé—´ï¼ˆè€Œå°±åœ¨è¿™ä¸ªæŒ‡ä»¤å®Œæˆåï¼Œçº¿ç¨‹Bè¿›å…¥äº†æ–¹æ³•ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;Bçº¿ç¨‹é¦–å…ˆè¿›å…¥æ–¹æ³•è¿›è¡Œç¬¬1æ¬¡instance == nullåˆ¤æ–­ã€‚&lt;/li&gt;
&lt;li&gt;Bçº¿ç¨‹æ­¤æ—¶å‘ç°instance ä¸ä¸ºnull ï¼Œæ‰€ä»¥å®ƒä¼šç›´æ¥è¿”å›instance (è€Œæ­¤æ—¶è¿”å›çš„instance æ˜¯Açº¿ç¨‹è¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆçš„å¯¹è±¡)&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;æœ€ç»ˆçº¿ç¨‹Bæ‹¿åˆ°çš„instance æ˜¯ä¸€ä¸ªæ²¡æœ‰å®ä¾‹åŒ–å¯¹è±¡çš„ç©ºå†…å­˜åœ°å€ï¼Œæ‰€ä»¥å¯¼è‡´instanceä½¿ç”¨çš„è¿‡ç¨‹ä¸­é€ æˆç¨‹åºé”™è¯¯ã€‚è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œå¯ä»¥ç»™sInstanceå¯¹è±¡åŠ ä¸Šä¸€ä¸ªå…³é”®å­—ï¼Œvolatileï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±ä¸ä¼šä¹±ä¼˜åŒ–ï¼Œæœ‰å…³volatileçš„å…·ä½“å†…å®¹åç»­å†ç»†è¯´ã€‚&lt;/p&gt;

&lt;p&gt;é€šè¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œå…¶å®å¯ä»¥å½’çº³æ— è®ºæ˜¯CPUç¼“å­˜ï¼Œçº¿ç¨‹åˆ‡æ¢è¿˜æ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–ä¹±åºï¼Œå‡ºç°é—®é¢˜çš„æ ¸å¿ƒéƒ½æ˜¯å› ä¸ºå¤šä¸ªçº¿ç¨‹è¦å¹¶å‘è¯»å†™æŸä¸ªå˜é‡æˆ–å¹¶å‘æ‰§è¡ŒæŸæ®µä»£ç ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ§åˆ¶ï¼Œä¸€æ¬¡åªè®©ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå˜é‡è¯»å†™å°±å¯ä»¥äº†ï¼Œè¿™å°±æ˜¯&lt;strong&gt;äº’æ–¥&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è€Œåœ¨æŸäº›æ—¶å€™ï¼Œäº’æ–¥è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦ä¸€å®šçš„æ¡ä»¶ã€‚æ¯”å¦‚ä¸€ä¸ªç”Ÿäº§è€…ä¸€ä¸ªæ¶ˆè´¹è€…å¹¶å‘ï¼Œç”Ÿäº§è€…å‘é˜Ÿåˆ—å­˜ä¸œè¥¿ï¼Œæ¶ˆè´¹è€…å‘é˜Ÿåˆ—æ‹¿ä¸œè¥¿ã€‚é‚£ä¹ˆç”Ÿäº§è€…å†™çš„æ—¶å€™è¦ä¿è¯å­˜çš„æ—¶å€™é˜Ÿåˆ—ä¸æ˜¯æ»¡çš„ï¼Œæ¶ˆè´¹è€…è¦ä¿è¯æ‹¿çš„æ—¶å€™é˜Ÿåˆ—éç©ºã€‚è¿™ç§çº¿ç¨‹ä¸çº¿ç¨‹é—´éœ€è¦é€šä¿¡åä½œçš„æƒ…å†µï¼Œç§°ä¸º&lt;strong&gt;åŒæ­¥&lt;/strong&gt;ï¼Œ&lt;strong&gt;åŒæ­¥å¯ä»¥è¯´æ˜¯æ›´å¤æ‚çš„äº’æ–¥&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶çŸ¥é“äº†å¹¶å‘ç¼–ç¨‹çš„æ ¹æºä»¥åŠåŒæ­¥å’Œäº’æ–¥ï¼Œé‚£æˆ‘ä»¬æ¥çœ‹çœ‹æœ‰å“ªäº›è§£å†³çš„æ€è·¯ã€‚å…¶å®ä¸€å…±ä¹Ÿå°±ä¸‰ç§ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;é¿å…å…±äº«&lt;/li&gt;
&lt;li&gt;Immutabilityï¼ˆä¸å˜æ€§ï¼‰&lt;/li&gt;
&lt;li&gt;ç®¡ç¨‹åŠå…¶ä»–å·¥å…·&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«è¯´è¯´è¿™ä¸‰ç§æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹&lt;/p&gt;
&lt;h3 id=&quot;é¿å…å…±äº«&quot;&gt;é¿å…å…±äº«&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæ¥è¯´è¯´é¿å…å…±äº«ï¼Œå…¶å®é¿å…å…±äº«è¯´æ˜¯çº¿ç¨‹æœ¬åœ°å­˜å‚¨æŠ€æœ¯ï¼Œåœ¨javaä¸­æŒ‡çš„ä¸€èˆ¬å°±æ˜¯Threadlocalã€‚ThreadLocalä¼šä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ä¸€ä¸ªæœ¬åœ°å‰¯æœ¬ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½åªä¼šä¿®æ”¹è‡ªå·±çš„ThreadLocalå˜é‡ã€‚è¿™æ ·ä¸€æ¥å°±ä¸ä¼šå‡ºç°å…±äº«å˜é‡ï¼Œä¹Ÿå°±ä¸ä¼šå‡ºç°å†²çªäº†ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®ç°åŸç†æ˜¯åœ¨ThreadLocalå†…éƒ¨ç»´æŠ¤ä¸€ä¸ªThreadLocalMapï¼Œæ¯æ¬¡æœ‰çº¿ç¨‹è¦è·å–å¯¹åº”å˜é‡çš„æ—¶å€™ï¼Œå…ˆè·å–å½“å‰çº¿ç¨‹ï¼Œç„¶åæ ¹æ®ä¸åŒçº¿ç¨‹å–ä¸åŒçš„å€¼ï¼Œå…¸å‹çš„ä»¥ç©ºé—´æ¢æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ThreadLocalè¿˜æ˜¯æ¯”è¾ƒé€‚ç”¨äºéœ€è¦å…±äº«èµ„æºï¼Œä¸”èµ„æºå ç”¨ç©ºé—´ä¸å¤§çš„æƒ…å†µã€‚æ¯”å¦‚ä¸€äº›è¿æ¥çš„sessionå•Šç­‰ç­‰ã€‚ä½†æ˜¯è¿™ç§æ¨¡å¼åº”ç”¨åœºæ™¯ä¹Ÿè¾ƒä¸ºæœ‰é™ï¼Œæ¯”å¦‚éœ€è¦åŒæ­¥æƒ…å†µå°±éš¾ä»¥èƒœä»»ã€‚&lt;/p&gt;
&lt;h3 id=&quot;immutabilityï¼ˆä¸å˜æ€§ï¼‰&quot;&gt;Immutabilityï¼ˆä¸å˜æ€§ï¼‰&lt;/h3&gt;
&lt;p&gt;Immutabilityåœ¨å‡½æ•°å¼ä¸­ç”¨å¾—æ¯”è¾ƒå¤šï¼Œå‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ä¸ªä¸»è¦ç›®çš„æ˜¯è¦å†™å‡ºæ— å‰¯ä½œç”¨çš„ä»£ç ï¼Œæœ‰å…³ä»€ä¹ˆæ˜¯æ— å‰¯ä½œç”¨å¯ä»¥å‚è€ƒæˆ‘ä»¥å‰çš„æ–‡ç« &lt;a href=&quot;https://www.cnblogs.com/listenfwind/p/11209383.html&quot;&gt;Scalaå‡½æ•°å¼ç¼–ç¨‹æŒ‡å—ï¼ˆä¸€ï¼‰ å‡½æ•°å¼æ€æƒ³ä»‹ç»&lt;/a&gt;ã€‚è€Œæ— å‰¯ä½œç”¨çš„ä¸€ä¸ªä¸»è¦ç‰¹ç‚¹å°±æ˜¯å˜é‡éƒ½æ˜¯Immutabilityå³ä¸å¯å˜çš„ï¼Œå³åˆ›å»ºå¯¹è±¡åä¸ä¼šå†ä¿®æ”¹å¯¹è±¡ï¼Œæ¯”å¦‚scalaé»˜è®¤çš„å˜é‡å’Œæ•°æ®ç»“æ„éƒ½æ˜¯ä¸å¯å˜çš„ã€‚è€Œåœ¨javaä¸­ï¼Œä¸å˜æ€§å˜é‡å³é€šè¿‡finalä¿®é¥°çš„å˜é‡ï¼Œå¦‚Stringï¼ŒLongï¼ŒDoubleç­‰ç±»å‹éƒ½æ˜¯Immutabilityçš„ï¼Œå®ƒä»¬çš„å†…éƒ¨å®ç°éƒ½æ˜¯åŸºäºfinalå…³é”®å­—çš„ã€‚&lt;/p&gt;
&lt;p&gt;é‚£è¿™åˆå’Œå¹¶å‘ç¼–ç¨‹æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿå…¶å®å•Šï¼Œå¹¶å‘é—®é¢˜å¾ˆå¤§éƒ¨åˆ†åŸå› å°±æ˜¯å› ä¸ºçº¿ç¨‹åˆ‡æ¢ç ´åäº†åŸå­æ€§ï¼Œè¿™åˆå¯¼è‡´çº¿ç¨‹éšæ„å¯¹å˜é‡çš„è¯»å†™ç ´åäº†æ•°æ®çš„ä¸€è‡´æ€§ã€‚è€Œä¸å˜æ€§å°±ä¸å¿…æ‹…å¿ƒè¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå˜é‡éƒ½æ˜¯ä¸å˜ï¼Œä¸å¯å†™åªèƒ½è¯»çš„ã€‚åœ¨è¿™ç§ç¼–ç¨‹æ¨¡å¼ä¸‹ï¼Œä½ è¦ä¿®æ”¹ä¸€ä¸ªå˜é‡ï¼Œé‚£ä¹ˆåªèƒ½æ–°ç”Ÿæˆä¸€ä¸ªã€‚è¿™æ ·åšçš„å¥½å¤„å¾ˆæ˜æ˜¾ï¼Œä½†åå¤„ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§ï¼Œé‚£å°±æ˜¯å¼•å…¥äº†é¢å¤–çš„ç¼–ç¨‹å¤æ‚åº¦ï¼Œä¸§å¤±äº†ä»£ç çš„å¯è¯»æ€§å’Œæ˜“ç”¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºå¦‚æ­¤ï¼Œä¸å˜æ€§çš„å¹¶å‘è§£å†³æ–¹æ¡ˆå…¶å®ç›¸å¯¹è€Œå·²æ²¡é‚£ä¹ˆå¹¿æ³›ï¼Œå…¶ä¸­æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„ç®—æ˜¯Actorå¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼Œæˆ‘ä»¥å‰ä¹Ÿæœ‰è®¨è®ºè¿‡ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹çœ‹&lt;a href=&quot;https://www.cnblogs.com/listenfwind/p/9963489.html&quot;&gt;Actoræ¨¡å‹æµ…æ ä¸€è‡´æ€§å’Œéš”ç¦»æ€§&lt;/a&gt;ï¼Œè¿™ç§ç¼–ç¨‹æ¨¡å‹å’Œå¸¸è§„å¹¶å‘è§£å†³æ–¹æ¡ˆæœ‰å¾ˆæ˜¾è‘—çš„å·®å¼‚ã€‚æŒ‰æˆ‘çš„äº†è§£ï¼ŒAcctoræ¨¡å¼å¤šç”¨åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€äº›åè°ƒåŠŸèƒ½ï¼Œæ¯”å¦‚ç»´æŒé›†ç¾¤ä¸­å¤šä¸ªæœºå™¨çš„å¿ƒè·³é€šä¿¡ç­‰ç­‰ã€‚å¦‚æœåœ¨å•æœºå¹¶å‘ç¯å¢ƒä¸‹ï¼Œè¿˜æ˜¯ä¸‹é¢è¦ä»‹ç»çš„ç®¡ç¨‹ç±»å·¥å…·æ‰æ˜¯åˆ©å™¨ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ç®¡ç¨‹åŠå…¶ä»–å·¥å…·&quot;&gt;ç®¡ç¨‹åŠå…¶ä»–å·¥å…·&lt;/h3&gt;
&lt;p&gt;å…¶å®æœ€æ—©çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œè§£å†³å¹¶å‘é—®é¢˜ç”¨çš„æ˜¯ä¿¡å·é‡ï¼Œä¿¡å·é‡é€šè¿‡ä¸¤ä¸ªåŸå­æ“ä½œwait(S)ï¼Œå’Œsignal(S)ï¼ˆä¿—ç§°Pï¼ŒVæ“ä½œï¼‰æ¥å®ç°è®¿é—®èµ„æºäº’æ–¥å’ŒåŒæ­¥ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªå°ä¾‹å­ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;//æ•´å‹ä¿¡å·é‡å®šä¹‰
int S;

//Pæ“ä½œ
wait(S){
  while(S&amp;lt;=0);
  S--;
}

//Væ“ä½œ
signal(S){
  S++;
}

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è™½ç„¶ä¿¡å·é‡æ–¹ä¾¿æœ‰æ•ˆï¼Œä½†ä¿¡å·é‡è¦å¯¹æ¯ä¸ªå…±äº«èµ„æºéƒ½å®ç°å¯¹åº”çš„På’ŒVæ“ä½œï¼Œè¿™ä½¿å¾—å¹¶å‘ç¼–ç¨‹ä¸­å¯èƒ½è¦å‡ºç°å¤§é‡çš„Pï¼ŒVæ“ä½œï¼Œå¹¶ä¸”è¿™éƒ¨åˆ†å†…å®¹éš¾ä»¥æŠ½è±¡å‡ºæ¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ›´å¥½åœ°å®ç°åŒæ­¥äº’æ–¥ï¼Œäºæ˜¯å°±äº§ç”Ÿäº†ç®¡ç¨‹ï¼ˆå³Monitorï¼Œä¹Ÿæœ‰ç¿»è¯‘ä¸ºç›‘è§†å™¨ï¼‰ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œç®¡ç¨‹ä¹Ÿæœ‰å‡ ç§æ¨¡å‹ï¼Œåˆ†åˆ«æ˜¯ï¼šHasenæ¨¡å‹ï¼ŒHoareæ¨¡å‹å’ŒMESAæ¨¡å‹ã€‚å…¶ä¸­MESAæ¨¡å‹åº”ç”¨æœ€å¹¿æ³›ï¼Œjavaä¹Ÿæ˜¯å‚è€ƒè‡ªMESAæ¨¡å‹ã€‚è¿™é‡Œç®€å•ä»‹ç»ä¸‹ç®¡ç¨‹çš„ç†è®ºçŸ¥è¯†ï¼Œè¿™éƒ¨åˆ†å†…å®¹å‚è€ƒè‡ª&lt;a href=&quot;https://blog.csdn.net/qq_34666857/article/details/102948786&quot;&gt;è¿›ç¨‹åŒæ­¥æœºåˆ¶-----ä¸ºè¿›ç¨‹å¹¶å‘æ‰§è¡Œä¿é©¾æŠ¤èˆª&lt;/a&gt;ï¼Œå¸Œæœ›äº†è§£æ›´å¤šç®¡ç¨‹ç†è®ºçŸ¥è¯†çš„ç«¥é‹å¯ä»¥çœ‹çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥é€šè¿‡ä¸€ä¸ªç»å…¸çš„ç”Ÿäº§-æ¶ˆè´¹é˜Ÿåˆ—æ¥è§£é‡Šï¼Œå¦‚ä¸‹å›¾&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1011838/202004/1011838-20200427155319999-1253618940.jpg&quot; alt=&quot;ç®¡ç¨‹ä»‹ç»&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆè§£é‡Šä¸‹å›¾ä¸­å³åŠéƒ¨åˆ†çš„å†…å®¹ï¼Œå³ä¸Šè§’æœ‰ä¸€ä¸ªç­‰å¾…è°ƒç”¨çš„çº¿ç¨‹é˜Ÿåˆ—ï¼Œç®¡ç¨‹ä¸­æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œæ‰€ä»¥å¤šä¸ªä»»åŠ¡éœ€è¦ç­‰å¾…ã€‚ç„¶åæ˜¯å„ä¸ªåè¯çš„æ„æ€ï¼Œç”Ÿäº§-æ¶ˆè´¹éœ€è¦å¾€é˜Ÿåˆ—å†™å…¥å’Œå–å‡ºä¸œè¥¿ï¼Œ&lt;strong&gt;è¿™é‡Œçš„é˜Ÿåˆ—å°±æ˜¯å…±äº«å˜é‡&lt;/strong&gt;ï¼Œ&lt;strong&gt;å¯¹å…±äº«èµ„æºè¿›è¡Œæ“ä½œç§°ä¹‹ä¸ºè¿‡ç¨‹ï¼ˆå…¥é˜Ÿå’Œå‡ºé˜Ÿä¸¤ä¸ªè¿‡ç¨‹ï¼‰&lt;/strong&gt;ã€‚è€Œå‘é˜Ÿåˆ—å†™å…¥å’Œå–å‡ºæ˜¯æœ‰æ¡ä»¶çš„ï¼Œå†™å…¥çš„æ—¶å€™é˜Ÿåˆ—å¿…é¡»æ˜¯éæ»¡çš„ï¼Œå–å‡ºçš„æ—¶å€™é˜Ÿåˆ—å¿…é¡»æ˜¯éç©ºçš„ï¼Œ&lt;strong&gt;è¿™ä¸¤ä¸ªæ¡ä»¶è¢«ç§°ä¸ºæ¡ä»¶å˜é‡&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åå†æ¥çœ‹çœ‹å·¦åŠéƒ¨åˆ†çš„å†…å®¹ï¼Œå‡è®¾çº¿ç¨‹T1è¯»å–å…±äº«å˜é‡ï¼ˆå³é˜Ÿåˆ—ï¼‰ï¼Œæ­¤æ—¶å‘ç°é˜Ÿåˆ—ä¸ºç©ºï¼ˆæ¡ä»¶å˜é‡ä¹‹ä¸€ï¼‰ï¼Œé‚£ä¹ˆT1æ­¤æ—¶éœ€è¦ç­‰å¾…ï¼Œå»å“ªé‡Œç­‰å‘¢ï¼Ÿå»æ¡ä»¶å˜é‡&lt;strong&gt;é˜Ÿåˆ—ä¸èƒ½ä¸ºç©º&lt;/strong&gt;å¯¹åº”çš„é˜Ÿåˆ—ä¸­å»ç­‰å¾…ã€‚æ­¤æ—¶å¦ä¸€ä¸ªçº¿ç¨‹T2å‘å…±äº«å˜é‡é˜Ÿåˆ—å†™æ•°æ®ï¼Œé€šè¿‡äº†æ¡ä»¶å˜é‡&lt;strong&gt;é˜Ÿåˆ—ä¸èƒ½æ»¡&lt;/strong&gt;ï¼Œé‚£ä¹ˆå†™å®Œåå°±ä¼šé€šçŸ¥çº¿ç¨‹T1ã€‚ä½†å› ä¸ºç®¡ç¨‹çš„é™åˆ¶ï¼Œç®¡ç¨‹ä¸­åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œæ‰€ä»¥T1çº¿ç¨‹ä¸èƒ½ç«‹å³æ‰§è¡Œï¼Œå®ƒä¼šå›åˆ°å³ä¸Šè§’çš„çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—ç­‰å¾…ï¼ˆä¸åŒçš„ç®¡ç¨‹æ¨¡å‹åœ¨è¿™é‡Œæ˜¯æœ‰åˆ†æ­§çš„ï¼Œæ¯”å¦‚Hasenæ¨¡å‹æ˜¯ç«‹å³ä¸­æ–­T2çº¿ç¨‹è®©é˜Ÿåˆ—ä¸­ä¸‹ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è§£é‡Šå®Œè¿™ä¸ªå›¾ï¼Œç®¡ç¨‹çš„æ¦‚å¿µä¹Ÿå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼Œ&lt;/p&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;hansenå¯¹ç®¡ç¨‹çš„å®šä¹‰å¦‚ä¸‹ï¼šä¸€ä¸ªç®¡ç¨‹å®šä¹‰äº†ä¸€ä¸ªæ•°æ®ç»“æ„å’Œèƒ½åŠ›ä¸ºå¹¶å‘è¿›ç¨‹æ‰€æ‰§è¡Œï¼ˆåœ¨è¯¥æ•°æ®ç»“æ„ä¸Šï¼‰çš„ä¸€ç»„æ“ä½œï¼Œè¿™ç»„æ“ä½œèƒ½åŒæ­¥è¿›ç¨‹å’Œæ”¹å˜ç®¡ç¨‹ä¸­çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ¬è´¨ä¸Šï¼Œç®¡ç¨‹æ˜¯å¯¹å…±äº«èµ„æºä»¥åŠå¯¹å…±äº«èµ„æºçš„æ“ä½œæŠ½è±¡æˆå˜é‡å’Œæ–¹æ³•ï¼Œè¦æ“ä½œå…±äº«å˜é‡ä»…èƒ½é€šè¿‡ç®¡ç¨‹æä¾›çš„æ–¹æ³•ï¼ˆæ¯”å¦‚ä¸Šé¢çš„å…¥é˜Ÿå’Œå‡ºé˜Ÿï¼‰é—´æ¥è®¿é—®ã€‚æ‰€ä»¥ä½ ä¼šå‘ç°ç®¡ç¨‹å…¶å®å’Œé¢å‘å¯¹è±¡çš„ç†å¿µæ˜¯ååˆ†ç›¸è¿‘çš„ï¼Œåœ¨javaä¸­ï¼Œä¸»è¦æä¾›äº†ä½å±‚æ¬¡äº†synchronizedå…³é”®å­—å’Œwait()ï¼Œnotify()ç­‰æ–¹æ³•ã€‚åŒæ—¶è¿˜æä¾›äº†é«˜å±‚æ¬¡çš„ReenTrantLockå’ŒConditionæ¥å®ç°ç®¡ç¨‹æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Š~&lt;/p&gt;
</description>
<pubDate>Wed, 17 Jun 2020 00:15:00 +0000</pubDate>
<dc:creator>zzzzMing</dc:creator>
<og:description>å¹¶å‘é—®é¢˜çš„æ ¹æºåœ¨å“ª é¦–å…ˆï¼Œæˆ‘ä»¬è¦çŸ¥é“å¹¶å‘è¦è§£å†³çš„æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Ÿå¹¶å‘è¦è§£å†³çš„æ˜¯å•è¿›ç¨‹æƒ…å†µä¸‹ç¡¬ä»¶èµ„æºæ— æ³•å……åˆ†åˆ©ç”¨çš„é—®é¢˜ã€‚è€Œé€ æˆè¿™ä¸€é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯CPU-å†…å­˜-ç£ç›˜ä¸‰è€…ä¹‹é—´é€Ÿåº¦å·®å¼‚å®åœ¨å¤ªå¤§ã€‚å¦‚æœå°†CPUçš„é€Ÿ</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/listenfwind/p/13149718.html</dc:identifier>
</item>
<item>
<title>ç²¾ç¾å›¾æ–‡è®²è§£Java AQS å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ä»¥åŠSemaphoreçš„åº”ç”¨ - æ—¥æ‹±ä¸€å…µ</title>
<link>http://www.cnblogs.com/FraserYu/p/13150328.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/FraserYu/p/13150328.html</guid>
<description>&lt;p&gt;| &lt;strong&gt;å¥½çœ‹è¯·èµï¼Œå…»æˆä¹ æƒ¯&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul readability=&quot;-0.5&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;ä½ æœ‰ä¸€ä¸ªæ€æƒ³ï¼Œæˆ‘æœ‰ä¸€ä¸ªæ€æƒ³ï¼Œæˆ‘ä»¬äº¤æ¢åï¼Œä¸€ä¸ªäººå°±æœ‰ä¸¤ä¸ªæ€æƒ³&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;If you can NOT explain it simply, you do NOT understand it well enough&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/blockquote&gt;
&lt;p&gt;ç°é™†ç»­å°†Demoä»£ç å’ŒæŠ€æœ¯æ–‡ç« æ•´ç†åœ¨ä¸€èµ· &lt;a href=&quot;https://github.com/FraserYu/learnings&quot;&gt;Githubå®è·µç²¾é€‰&lt;/a&gt; ï¼Œæ–¹ä¾¿å¤§å®¶é˜…è¯»æŸ¥çœ‹ï¼Œæœ¬æ–‡åŒæ ·æ”¶å½•åœ¨æ­¤ï¼Œè§‰å¾—ä¸é”™ï¼Œè¿˜è¯·StarğŸŒŸ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075640968-960783658.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°æœ¬æœŸå†…å®¹è¿™ä¹ˆå°‘ï¼Œæ˜¯ä¸æ˜¯å¿ƒåŠ¨äº†å‘¢ï¼Ÿ&lt;/p&gt;
&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ä¸Šä¸€ç¯‡ä¸‡å­—é•¿æ–‡ &lt;a href=&quot;https://dayarch.top/p/java-aqs-and-reentrantlock.html&quot;&gt;Java AQSé˜Ÿåˆ—åŒæ­¥å™¨ä»¥åŠReentrantLockçš„åº”ç”¨&lt;/a&gt; ä¸ºæˆ‘ä»¬è¯» JUC æºç ä»¥åŠå…¶è®¾è®¡æ€æƒ³åšäº†è¶³å¤Ÿå¤šçš„é“ºå«ï¼Œæ¥ä¸‹æ¥çš„å†…å®¹æˆ‘å°†é‡ç‚¹è¯´æ˜å·®å¼‚åŒ–ï¼Œå¦‚æœæœ‰äº›ç«¥é‹ä¸æ˜¯èƒ½å¾ˆå¥½çš„ç†è§£æ–‡ä¸­çš„ä¸€äº›å†…å®¹ï¼Œå¼ºçƒˆå»ºè®®å›çœ‹ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œææ‡‚åŸºç¡€å†…å®¹ï¼Œæ¥ä¸‹æ¥çš„é˜…è¯»çœŸä¼šè½»æ¾åŠ æ„‰å¿«&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;AQS ä¸­æˆ‘ä»¬ä»‹ç»äº†ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€çš„å¤šç§æƒ…å½¢ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ç‹¬å å¼è·å–é”&lt;/li&gt;
&lt;li&gt;å¯å“åº”ä¸­æ–­çš„ç‹¬å å¼è·å–é”&lt;/li&gt;
&lt;li&gt;æœ‰è¶…æ—¶é™åˆ¶çš„ç‹¬å å¼è·å–é”&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;AQS æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•é‡Œé¢è¿˜å·®å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€æ²¡æœ‰ä»‹ç»ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»Šå¤©æ¥æ­å¼€è¿™ä¸ªçœ‹ä¼¼ç¥ç§˜çš„é¢çº±&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075641283-1771699100.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;aqs-ä¸­çš„å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€&quot;&gt;AQS ä¸­çš„å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€&lt;/h2&gt;
&lt;p&gt;ç‹¬å å¼æ˜¯ä½ ä¸­æ²¡æˆ‘ï¼Œæˆ‘ä¸­æ²¡ä½ çš„çš„ä¸€ç§äº’æ–¥å½¢å¼ï¼Œå…±äº«å¼æ˜¾ç„¶å°±ä¸æ˜¯è¿™æ ·äº†ï¼Œæ‰€ä»¥ä»–ä»¬çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;åŒä¸€æ—¶åˆ»èƒ½å¦æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–åˆ°åŒæ­¥çŠ¶æ€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è¿™æ ·æ»´ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075641836-72943338.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“åŒæ­¥çŠ¶æ€ state æ˜¯ç»´æŠ¤åœ¨ AQS ä¸­çš„ï¼ŒæŠ›å¼€å¯é‡å…¥é”çš„æ¦‚å¿µï¼Œæˆ‘åœ¨ä¸Šç¯‡æ–‡ç« ä¸­ä¹Ÿæåˆ°äº†ï¼Œç‹¬å å¼å’Œå…±äº«å¼æ§åˆ¶åŒæ­¥çŠ¶æ€ state çš„åŒºåˆ«ä»…ä»…æ˜¯è¿™æ ·ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075642177-1747186693.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥è¯´æƒ³äº†è§£ AQS çš„ xxxShared çš„æ¨¡ç‰ˆæ–¹æ³•ï¼Œåªéœ€è¦çŸ¥é“å®ƒæ˜¯æ€ä¹ˆæ§åˆ¶ state çš„å°±å¥½äº†&lt;/p&gt;
&lt;h3 id=&quot;aqså…±äº«å¼è·å–åŒæ­¥çŠ¶æ€æºç åˆ†æ&quot;&gt;AQSå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€æºç åˆ†æ&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†å¸®åŠ©å¤§å®¶æ›´å¥½çš„å›å¿†å†…å®¹ï¼Œæˆ‘å°†ä¸Šä¸€ç¯‡æ–‡ç« çš„ä¸¤ä¸ªå…³é”®å†…å®¹ç²˜è´´åœ¨æ­¤å¤„ï¼Œå¸®åŠ©å¤§å®¶å¿«é€Ÿå›å¿†ï¼Œå…³äºå…±äº«å¼ï¼Œå¤§å®¶åªéœ€è¦å…³æ³¨ã€éªšç´«è‰²ã€‘å°±å¯ä»¥äº†&lt;/p&gt;
&lt;h4 id=&quot;è‡ªå®šä¹‰åŒæ­¥å™¨éœ€è¦é‡å†™çš„æ–¹æ³•&quot;&gt;è‡ªå®šä¹‰åŒæ­¥å™¨éœ€è¦é‡å†™çš„æ–¹æ³•&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075642503-1189568103.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;aqs-æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•&quot;&gt;AQS æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075643513-1400486656.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ•…äº‹å°±ä»è¿™é‡Œè¯´èµ·å§ (ä½ ä¼šå‘ç°å’Œç‹¬å å¼æƒŠäººçš„ç›¸ä¼¼)ï¼Œå…³é”®ä»£ç éƒ½åŠ äº†æ³¨é‡Š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;    public final void acquireShared(int arg) {
        // åŒæ ·è°ƒç”¨è‡ªå®šä¹‰åŒæ­¥å™¨éœ€è¦é‡å†™çš„æ–¹æ³•ï¼Œéé˜»å¡å¼çš„å°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœç»“æœå°äºé›¶ï¼Œåˆ™è·å–åŒæ­¥çŠ¶æ€å¤±è´¥
        if (tryAcquireShared(arg) &amp;lt; 0)
                // è°ƒç”¨ AQS æä¾›çš„æ¨¡ç‰ˆæ–¹æ³•ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—
            doAcquireShared(arg);
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿›å…¥ &lt;code&gt;doAcquireShared&lt;/code&gt; æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;    private void doAcquireShared(int arg) {
        // åˆ›å»ºå…±äº«èŠ‚ç‚¹ã€ŒSHAREDã€ï¼ŒåŠ åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­
        final Node node = addWaiter(Node.SHARED);
        boolean failed = true;
        try {
            boolean interrupted = false;
                // è¿›å…¥â€œè‡ªæ—‹â€ï¼Œè¿™é‡Œå¹¶ä¸æ˜¯çº¯ç²¹æ„ä¹‰ä¸Šçš„æ­»å¾ªç¯ï¼Œåœ¨ç‹¬å å¼å·²ç»è¯´æ˜è¿‡
            for (;;) {
                // åŒæ ·å°è¯•è·å–å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹
                final Node p = node.predecessor();
                // å¦‚æœå‰é©±èŠ‚ç‚¹ä¸ºå¤´èŠ‚ç‚¹ï¼Œå°è¯•å†æ¬¡è·å–åŒæ­¥çŠ¶æ€
                if (p == head) {
                        // åœ¨æ­¤ä»¥éé˜»å¡å¼è·å–åŒæ­¥çŠ¶æ€
                    int r = tryAcquireShared(arg);
                        // å¦‚æœè¿”å›ç»“æœå¤§äºç­‰äºé›¶ï¼Œæ‰èƒ½è·³å‡ºå¤–å±‚å¾ªç¯è¿”å›
                    if (r &amp;gt;= 0) {
                        // è¿™é‡Œæ˜¯å’Œç‹¬å å¼çš„åŒºåˆ«
                        setHeadAndPropagate(node, r);
                        p.next = null; // help GC
                        if (interrupted)
                            selfInterrupt();
                        failed = false;
                        return;
                    }
                }
                if (shouldParkAfterFailedAcquire(p, node) &amp;amp;&amp;amp;
                    parkAndCheckInterrupt())
                    interrupted = true;
            }
        } finally {
            if (failed)
                cancelAcquire(node);
        }
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸Šé¢ä»£ç ç¬¬ 18 è¡Œæˆ‘ä»¬æåˆ°å’Œç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€çš„åŒºåˆ«ï¼Œè´´å¿ƒçš„ç»™å¤§å®¶ä¸€ä¸ªæ›´ç›´è§‚çš„å¯¹æ¯”ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075645135-1387709377.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å·®åˆ«åªåœ¨è¿™é‡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹ &lt;code&gt;setHeadAndPropagate(node, r)&lt;/code&gt; åˆ°åº•å¹²äº†ä»€ä¹ˆï¼Œæˆ‘ä¹‹å‰è¯´è¿‡ JDK æºç ä¸­çš„æ–¹æ³•å‘½åç»å¤§å¤šæ•°è¿˜æ˜¯éå¸¸ç›´è§‚çš„ï¼Œè¯¥æ–¹æ³•ç›´è¯‘è¿‡æ¥å°±æ˜¯ ã€è®¾ç½®å¤´å¹¶ä¸”ä¼ æ’­/ç¹è¡ã€‘ã€‚ç‹¬å å¼åªæ˜¯è®¾ç½®äº†å¤´ï¼Œå…±äº«å¼é™¤äº†è®¾ç½®å¤´è¿˜å¤šäº†ä¸€ä¸ªä¼ æ’­ï¼Œä½ çš„ç–‘é—®åº”è¯¥å·²ç»æ¥äº†ï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;å•¥æ˜¯ä¼ æ’­ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰ä¼ æ’­è¿™ä¸ªè®¾ç½®å‘¢ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æƒ³äº†è§£è¿™ä¸ªé—®é¢˜ï¼Œä½ éœ€è¦å…ˆçŸ¥é“éé˜»å¡å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€è¿”å›å€¼çš„å«ä¹‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075645688-877089215.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œè¯´çš„ä¼ æ’­å…¶å®è¯´çš„æ˜¯ &lt;code&gt;propagate &amp;gt; 0&lt;/code&gt; çš„æƒ…å†µï¼Œé“ç†ä¹Ÿå¾ˆç®€å•ï¼Œå½“å‰çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€æˆåŠŸäº†ï¼Œè¿˜æœ‰å‰©ä½™çš„åŒæ­¥çŠ¶æ€å¯ç”¨äºå…¶ä»–çº¿ç¨‹è·å–ï¼Œ&lt;strong&gt;é‚£å°±è¦é€šçŸ¥åœ¨ç­‰å¾…é˜Ÿåˆ—çš„çº¿ç¨‹ï¼Œè®©ä»–ä»¬å°è¯•è·å–å‰©ä½™çš„åŒæ­¥çŠ¶æ€&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¦‚æœè¦è®©ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹è·å–åˆ°é€šçŸ¥ï¼Œéœ€è¦çº¿ç¨‹è°ƒç”¨ release æ–¹æ³•å®ç°çš„&lt;/strong&gt;ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬èµ°è¿‘ &lt;code&gt;setHeadAndPropagate&lt;/code&gt; ä¸€æ¢ç©¶ç«Ÿï¼ŒéªŒè¯ä¸€ä¸‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;  // å…¥å‚ï¼Œnodeï¼š å½“å‰èŠ‚ç‚¹
        // å…¥å‚ï¼Œpropagateï¼šè·å–åŒæ­¥çŠ¶æ€çš„ç»“æœå€¼ï¼Œå³ä¸Šé¢æ–¹æ³•ä¸­çš„å˜é‡ r
        private void setHeadAndPropagate(Node node, int propagate) {
                // è®°å½•æ—§çš„å¤´éƒ¨èŠ‚ç‚¹ï¼Œç”¨äºä¸‹é¢çš„check
        Node h = head; 
                // å°†å½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºå¤´èŠ‚ç‚¹
        setHead(node);
        
                // é€šè¿‡ propagate çš„å€¼å’Œ waitStatus çš„å€¼æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥è°ƒç”¨ doReleaseShared æ–¹æ³•
        if (propagate &amp;gt; 0 || h == null || h.waitStatus &amp;lt; 0 ||
            (h = head) == null || h.waitStatus &amp;lt; 0) {
            Node s = node.next;
                // å¦‚æœåç»§èŠ‚ç‚¹ä¸ºç©ºæˆ–è€…åç»§èŠ‚ç‚¹ä¸ºå…±äº«ç±»å‹ï¼Œåˆ™è¿›è¡Œå”¤é†’åç»§èŠ‚ç‚¹
                                // è¿™é‡Œåç»§èŠ‚ç‚¹ä¸ºç©ºæ„æ€æ˜¯åªå‰©ä¸‹å½“å‰å¤´èŠ‚ç‚¹äº†ï¼Œå¦å¤–è¿™é‡Œçš„ s == null ä¹Ÿæ˜¯åˆ¤æ–­ç©ºæŒ‡é’ˆçš„æ ‡å‡†å†™æ³•
            if (s == null || s.isShared())
                doReleaseShared();
        }
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸Šé¢æ–¹æ³•çš„å¤§æ–¹å‘ä½œç”¨æˆ‘ä»¬äº†è§£äº†ï¼Œä½†æ˜¯ä»£ç ä¸­ä½•æ—¶è°ƒç”¨ &lt;code&gt;doReleaseShared&lt;/code&gt; çš„åˆ¤æ–­é€»è¾‘è¿˜æ˜¯æŒºè®©äººè´¹è§£çš„ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆä¸€å¤§å †çš„åˆ¤æ–­ï¼Œæˆ‘ä»¬æ¥é€ä¸ªåˆ†æä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;è¿™é‡Œçš„ç©ºåˆ¤æ–­æœ‰ç‚¹è®©äººå¤´å¤§ï¼Œæˆ‘ä»¬å…ˆæŒ‘å‡ºæ¥è¯´æ˜ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075646064-1658952400.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ’é™¤äº†å…¶ä»–åˆ¤æ–­æ¡ä»¶çš„å¹²æ‰°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä¸“æ³¨åˆ†æ propagate å’Œ waitStatus ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶å°±å¯ä»¥äº†ï¼Œè¿™é‡Œå†å°† waitStatus çš„å‡ ç§çŠ¶æ€å±•ç¤ºåœ¨è¿™é‡Œï¼Œå¸®åŠ©å¤§å®¶ç†è§£ï¼Œã€éªšç²‰è‰²ã€‘æ˜¯æˆ‘ä»¬ä¸€ä¼šè¦ç”¨åˆ°çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075646622-43253346.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;propagate &amp;gt; 0&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸Šé¢å·²ç»è¯´è¿‡äº†ï¼Œå¦‚æœæˆç«‹ï¼Œç›´æ¥çŸ­è·¯åç»­åˆ¤æ–­ï¼Œç„¶åæ ¹æ® doReleaseShared çš„åˆ¤æ–­æ¡ä»¶è¿›è¡Œé‡Šæ”¾&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;propagate &amp;gt; 0 ä¸æˆç«‹ï¼Œ h.waitStatus &amp;lt; 0 æˆç«‹ &lt;strong&gt;ï¼ˆæ³¨æ„è¿™é‡Œçš„hæ˜¯æ—§çš„å¤´èŠ‚ç‚¹ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»€ä¹ˆæ—¶å€™ h.waitStatus &amp;lt; 0 å‘¢ï¼ŸæŠ›å¼€ CONDITION çš„ä½¿ç”¨ï¼Œåªå‰©ä¸‹ SIGNAL å’Œ PROPAGATEï¼Œæƒ³çŸ¥é“è¿™ä¸ªç­”æ¡ˆï¼Œéœ€è¦æå‰çœ‹ä¸€ä¸‹ &lt;code&gt;doReleaseShared()&lt;/code&gt; æ–¹æ³•äº†ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;    private void doReleaseShared() {
        for (;;) {
            Node h = head;
            if (h != null &amp;amp;&amp;amp; h != tail) {
                int ws = h.waitStatus;
                if (ws == Node.SIGNAL) {
                        // CAS å°†å¤´èŠ‚ç‚¹çš„çŠ¶æ€è®¾ç½®ä¸º0                
                    if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0))
                        continue;            // loop to recheck cases
                    // è®¾ç½®æˆåŠŸåæ‰èƒ½è·³å‡ºå¾ªç¯å”¤é†’å¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
                        unparkSuccessor(h);
                }
                else if (ws == 0 &amp;amp;&amp;amp;
                         // å°†å¤´èŠ‚ç‚¹çŠ¶æ€CASè®¾ç½®æˆ PROPAGATE çŠ¶æ€
                         !compareAndSetWaitStatus(h, 0, Node.PROPAGATE))
                    continue;                // loop on failed CAS
            }
            if (h == head)                   // loop if head changed
                break;
        }
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä» &lt;code&gt;doReleaseShared()&lt;/code&gt; æ–¹æ³•ä¸­å¯ä»¥çœ‹å‡ºï¼š&lt;/p&gt;
&lt;ul readability=&quot;0&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;å¦‚æœè®© h.waitStatus &amp;lt; 0 æˆç«‹ï¼Œåªèƒ½å°†å…¶è®¾ç½®æˆ PROPAGATE = -3 çš„æƒ…å†µï¼Œè®¾ç½®æˆåŠŸçš„å‰ææ˜¯ h å¤´èŠ‚ç‚¹ expected çš„çŠ¶æ€æ˜¯ 0ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;å¦‚æœ h.waitStatus = 0ï¼Œæ˜¯ä¸Šè¿°ä»£ç ç¬¬ 8 è¡Œ CAS è®¾ç½®æˆåŠŸï¼Œç„¶åå”¤é†’ç­‰å¾…ä¸­çš„çº¿ç¨‹&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;æ‰€ä»¥çŒœæµ‹ï¼Œå½“å‰çº¿ç¨‹æ‰§è¡Œåˆ° h.waitStatus &amp;lt; 0 çš„åˆ¤æ–­å‰ï¼Œæœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹åˆšå¥½æ‰§è¡Œäº† &lt;code&gt;doReleaseShared()&lt;/code&gt; æ–¹æ³•ï¼Œå°† waitStatus åˆè®¾ç½®æˆPROPAGATE = -3&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªç†è§£æœ‰ç‚¹ç»•ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥ç”»ä¸ªå›¾ç†è§£ä¸€ä¸‹å§ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075647530-920585638.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¯èƒ½æœ‰åŒå­¦è¿˜æ˜¯ä¸å¤ªèƒ½ç†è§£è¿™ä¹ˆå†™çš„é“ç†ï¼Œæˆ‘ä»¬ä¸€ç›´è¯´ propagate &amp;lt;&amp;gt; = 0 çš„æƒ…å†µï¼Œpropagate = 0 ä»£è¡¨çš„æ˜¯&lt;strong&gt;å½“æ—¶/å½“æ—¶/å½“æ—¶&lt;/strong&gt; å°è¯•è·å–åŒæ­¥çŠ¶æ€æ²¡æˆåŠŸï¼Œä½†æ˜¯ä¹‹åå¯èƒ½åˆæœ‰å…±äº«çŠ¶æ€è¢«é‡Šæ”¾äº†ï¼Œæ‰€ä»¥ä¸Šé¢çš„é€»è¾‘æ˜¯ä»¥é˜²è¿™ç§ä¸‡ä¸€ï¼Œä½ æ‡‚çš„ï¼Œä¸¥è°¨çš„å¹¶å‘å°±æ˜¯è¦é˜²æ­¢ä¸€åˆ‡ä¸‡ä¸€ï¼Œç°åœ¨ç»“åˆè¿™ä¸ªæƒ…æ™¯å†æ¥ç†è§£ä¸Šé¢çš„åˆ¤æ–­ä½ æ˜¯å¦è±ç„¶å¼€æœ—äº†å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç»§ç»­å‘ä¸‹çœ‹ï¼Œ&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;å‰åºæ¡ä»¶ä¸æˆç«‹ï¼Œ(h = head) == null || h.waitStatus &amp;lt; 0 &lt;strong&gt;æ³¨æ„è¿™é‡Œçš„hæ˜¯æ–°çš„å¤´èŠ‚ç‚¹ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ‰äº†ä¸Šé¢é“ºå«ï¼Œè¿™ä¸ªå°±ç›´æ¥ç”»ä¸ªå›¾å°±æ›´å¥½ç†è§£å•¦ï¼Œå…¶å®å°±æ˜¯æ²¡æœ‰é‚£ä¹ˆå·§æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹æºåˆäº†&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075648315-982613795.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ç›¸ä¿¡åˆ°è¿™é‡Œä½ åº”è¯¥ç†è§£å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€çš„å…¨éƒ¨è¿‡ç¨‹äº†å§ï¼Œè‡³äº&lt;strong&gt;éé˜»å¡å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€&lt;/strong&gt;å’Œ&lt;strong&gt;å¸¦æœ‰è¶…æ—¶æ—¶é—´è·å–åŒæ­¥çŠ¶æ€&lt;/strong&gt;ï¼Œç»“åˆæœ¬æ–‡è®²çš„ setHeadAndPropagate é€»è¾‘å’Œç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€çš„å®ç°è¿‡ç¨‹è¿‡ç¨‹æ¥çœ‹ï¼ŒçœŸæ˜¯ä¸€æ¯›ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å†ç´¯è¿°äº†ï¼Œèµ¶ç´§æ‰“å¼€ä½ çš„ IDE å»éªŒè¯ä¸€ä¸‹å§&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åˆ†æäº†AQS çš„æ¨¡ç‰ˆæ–¹æ³•ï¼Œè¿˜ä¸€ç›´æ²¡è¯´ &lt;code&gt;tryAcquireShared(arg)&lt;/code&gt; è¿™ä¸ªæ–¹æ³•æ˜¯å¦‚ä½•è¢«é‡å†™çš„ï¼Œæƒ³è¦äº†è§£è¿™ä¸ªï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä¸€çœ‹å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€çš„ç»å…¸åº”ç”¨ Semaphore&lt;/p&gt;
&lt;h2 id=&quot;semaphore-çš„åº”ç”¨åŠæºç åˆ†æ&quot;&gt;Semaphore çš„åº”ç”¨åŠæºç åˆ†æ&lt;/h2&gt;
&lt;h3 id=&quot;semaphore-æ¦‚å¿µ&quot;&gt;Semaphore æ¦‚å¿µ&lt;/h3&gt;
&lt;p&gt;Semaphore ä¸­æ–‡å¤šç¿»è¯‘ä¸º ã€ä¿¡å·é‡ã€‘ï¼Œæˆ‘è¿˜ç‰¹æ„æŸ¥äº†ä¸€ä¸‹å‰‘æ¡¥è¾å…¸çš„è‹±æ–‡è§£é‡Šï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075648760-1981102432.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å…¶å®å°±æ˜¯ä¿¡å·æ ‡å¿—ï¼ˆtwo flagsï¼‰ï¼Œæ¯”å¦‚çº¢ç»¿ç¯ï¼Œæ¯ä¸ªäº¤é€šç¯äº§ç”Ÿä¸¤ç§ä¸åŒè¡Œä¸º&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Flag1-çº¢ç¯ï¼šåœè½¦&lt;/li&gt;
&lt;li&gt;Flag2-ç»¿ç¯ï¼šè¡Œè½¦&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;åœ¨ Semaphore é‡Œé¢ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯çº¢ç¯ï¼Œä»€ä¹ˆæ—¶å€™æ˜¯ç»¿ç¯ï¼Œå…¶å®å°±æ˜¯é  &lt;code&gt;tryAcquireShared(arg)&lt;/code&gt; çš„ç»“æœæ¥è¡¨ç¤ºçš„&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;è·å–ä¸åˆ°å…±äº«çŠ¶æ€ï¼Œå³ä¸ºçº¢ç¯&lt;/li&gt;
&lt;li&gt;è·å–åˆ°å…±äº«çŠ¶æ€ï¼Œå³ä¸ºç»¿ç¯&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;æ‰€ä»¥æˆ‘ä»¬èµ°è¿‘ Semaphore ï¼Œæ¥çœ‹çœ‹å®ƒåˆ°åº•æ˜¯æ€ä¹ˆåº”ç”¨ AQS çš„ï¼Œåˆæ˜¯æ€æ ·é‡å†™ &lt;code&gt;tryAcquireShared(arg)&lt;/code&gt; æ–¹æ³•çš„&lt;/p&gt;
&lt;h3 id=&quot;semaphore-æºç åˆ†æ&quot;&gt;Semaphore æºç åˆ†æ&lt;/h3&gt;
&lt;p&gt;å…ˆçœ‹ä¸€ä¸‹ç±»ç»“æ„&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075649288-2140811626.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°è¿™é‡Œä½ æ˜¯å¦æœ‰ç‚¹è·Œçœ¼é•œï¼Œå’Œ ReentrantLock ç›¸ä¼¼çš„å¯æ€•å§ï¼Œå¦‚æœä½ æœ‰äº›é™Œç”Ÿï¼Œå†æ¬¡å¼ºçƒˆå»ºè®®ä½ å›çœ‹ä¸Šä¸€ç¯‡æ–‡ç«  &lt;a href=&quot;https://dayarch.top/p/java-aqs-and-reentrantlock.html&quot;&gt;Java AQSé˜Ÿåˆ—åŒæ­¥å™¨ä»¥åŠReentrantLockçš„åº”ç”¨&lt;/a&gt; ï¼Œè¿™é‡Œç›´æ¥æé€Ÿå¯¹æ¯”çœ‹å…¬å¹³å’Œéå…¬å¹³ä¸¤ç§é‡å†™çš„ &lt;code&gt;tryAcquireShared(arg)&lt;/code&gt; æ–¹æ³•ï¼Œæ²¡æœ‰æ„å¤–ï¼Œå…¬å¹³ä¸å¦ï¼Œå°±æ˜¯åˆ¤æ–­æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075649688-2001832591.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ–¹æ³•å†…éƒ¨åªæ˜¯è®¡ç®— state çš„å‰©ä½™å€¼ï¼Œé‚£ state çš„åˆå§‹å€¼æ˜¯å¤šå°‘æ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿå½“ç„¶ä¹Ÿå°±æ˜¯æ„é€ æ–¹æ³•äº†ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;               public Semaphore(int permits) {
        // é»˜è®¤ä»æ˜¯éå…¬å¹³çš„åŒæ­¥å™¨ï¼Œè‡³äºä¸ºä»€ä¹ˆé»˜è®¤æ˜¯éå…¬å¹³çš„ï¼Œåœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä¹Ÿç‰¹æ„è¯´æ˜è¿‡
        sync = new NonfairSync(permits);
    }
    
    NonfairSync(int permits) {
                super(permits);
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;super æ–¹æ³•ï¼Œå°±ä¼šå°†åˆå§‹å€¼ç»™åˆ° AQS ä¸­çš„ state&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075650088-868296355.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä¹Ÿè®¸ä½ å‘ç°äº†ï¼Œå½“æˆ‘ä»¬æŠŠ permits è®¾ç½®ä¸º1 çš„æ—¶å€™ï¼Œä¸å°±æ˜¯ ReentrantLock çš„äº’æ–¥é”äº†å˜›ï¼Œè¯´çš„ä¸€ç‚¹ä¹Ÿæ²¡é”™ï¼Œæˆ‘ä»¬ç”¨ Semaphore ä¹Ÿèƒ½å®ç°åŸºæœ¬äº’æ–¥é”çš„æ•ˆæœ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;
static int count;
//åˆå§‹åŒ–ä¿¡å·é‡
static final Semaphore s 
    = new Semaphore(1);
//ç”¨ä¿¡å·é‡ä¿è¯äº’æ–¥    
static void addOne() {
  s.acquire();
  try {
    count+=1;
  } finally {
    s.release();
  }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Butï¼ˆè‹±æ–‡å¬åŠ›ä¸­çš„é‡ç‚¹ï¼‰ï¼ŒSemaphore è‚¯å®šä¸æ˜¯ä¸ºè¿™ç§ç‰¹ä¾‹å­˜åœ¨çš„ï¼Œå®ƒæ˜¯å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€çš„ä¸€ç§å®ç°ã€‚å¦‚æœä½¿ç”¨ä¿¡å·é‡ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°† permits è®¾ç½®æˆå¤§äº1çš„å€¼ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦è¿˜è®°å¾—æˆ‘æ›¾åœ¨ &lt;a href=&quot;https://dayarch.top/p/why-we-need-to-use-threadpool.html&quot;&gt;ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çº¿ç¨‹æ± ?&lt;/a&gt; ä¸€æ–‡ä¸­è¯´åˆ°çš„æ± åŒ–æ¦‚å¿µï¼Œåœ¨åŒä¸€æ—¶åˆ»ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹ä½¿ç”¨è¿æ¥æ± ï¼Œæ¯ä¸ªè¿æ¥è¢«é‡Šæ”¾ä¹‹å‰ï¼Œä¸å…è®¸å…¶ä»–çº¿ç¨‹ä½¿ç”¨ã€‚æ‰€ä»¥è¯´ &lt;strong&gt;Semaphore å¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹è®¿é—®ä¸€ä¸ªä¸´ç•ŒåŒº&lt;/strong&gt;ï¼Œæœ€ç»ˆå¾ˆå¥½çš„åšåˆ°ä¸€ä¸ª&lt;strong&gt;é™æµ/é™æµ/é™æµ&lt;/strong&gt; çš„ä½œç”¨&lt;/p&gt;
&lt;p&gt;è™½ç„¶ Semaphore èƒ½å¾ˆå¥½çš„æä¾›é™æµä½œç”¨ï¼Œè¯´å®è¯ï¼ŒSemaphore çš„é™æµä½œç”¨æ¯”è¾ƒå•ä¸€ï¼Œæˆ‘åœ¨å®é™…å·¥ä½œä¸­ä½¿ç”¨ Semaphore å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œå¦‚æœçœŸçš„è¦ç”¨é«˜æ€§èƒ½é™æµå™¨ï¼ŒGuava RateLimiter æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„é€‰æ‹©ï¼Œæˆ‘ä»¬åé¢ä¼šåšåˆ†æï¼Œæœ‰å…´è¶£çš„å¯ä»¥æå‰äº†è§£ä¸€ä¸‹&lt;/p&gt;
&lt;p&gt;å…³äº Semaphore æºç ï¼Œå°±è¿™ä¹ˆä¸‰ä¸‹äº”é™¤äºŒçš„ç»“æŸäº†&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1583165/202006/1583165-20200617075650459-1412391735.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;æ€»ç»“&quot;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ä¸çŸ¥ä½ æœ‰æ²¡æœ‰æ„Ÿè§‰åˆ°ï¼Œæˆ‘ä»¬çš„èŠ‚å¥æ˜æ˜¾åŠ å¿«äº†ï¼Œå¥½å¤šåŸæ¥åˆ†æ•£çš„ç‚¹åœ¨è¢«ç–¯ç‹‚çš„ä¸²è”èµ·æ¥ï¼Œå¦‚æœæŒ‰ç…§è¿™ä¸ªæ–¹å¼æ¥é˜…è¯» JUC æºç ï¼Œç›¸ä¿¡ä½ ä¹Ÿä¸ä¼šä¸€å¤´æ‰è¿›å»è¿·å¤±æ–¹å‘ï¼Œç„¶åæ²®ä¸§çš„é€€å‡º JUC å§ï¼Œç„¶åé¢è¯•èƒŒè¯µç­”æ¡ˆï¼Œç„¶åå¿˜è®°ï¼Œç„¶åå†èƒŒè¯µï¼Ÿ&lt;/p&gt;
&lt;p&gt;è·Ÿä¸ŠèŠ‚å¥ï¼Œå…³äºå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€ï¼ŒSemaphore åªä¸è¿‡æ˜¯éå¸¸ç»å…¸çš„åº”ç”¨ï¼ŒReadWriteLock å’Œ CountDownLatch æ—¥å¸¸åº”ç”¨è¿˜æ˜¯éå¸¸å¹¿æ³›çš„ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±é™†ç»­èŠèŠå®ƒä»¬å§&lt;/p&gt;
&lt;h2 id=&quot;çµé­‚è¿½é—®&quot;&gt;çµé­‚è¿½é—®&lt;/h2&gt;
&lt;ol&gt;&lt;li&gt;Semaphore çš„ permits è®¾ç½®æˆ1 â€œç­‰åŒäºâ€ ç®€å•çš„äº’æ–¥é”å®ç°ï¼Œé‚£å®ƒå’Œ ReentrantLock çš„åŒºåˆ«è¿˜æ˜¯æŒºå¤§çš„ï¼Œéƒ½æœ‰å“ªäº›åŒºåˆ«å‘¢ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä½ åœ¨é¡¹ç›®ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨ Semaphore çš„å‘¢ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;&lt;h2 id=&quot;å‚è€ƒ&quot;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ol&gt;&lt;li&gt;Java å¹¶å‘å®æˆ˜&lt;/li&gt;
&lt;li&gt;Java å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/anlian523/article/details/106319294&quot;&gt;https://blog.csdn.net/anlian523/article/details/106319294&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
<pubDate>Tue, 16 Jun 2020 23:57:00 +0000</pubDate>
<dc:creator>æ—¥æ‹±ä¸€å…µ</dc:creator>
<og:description>| å¥½çœ‹è¯·èµï¼Œå…»æˆä¹ æƒ¯ ä½ æœ‰ä¸€ä¸ªæ€æƒ³ï¼Œæˆ‘æœ‰ä¸€ä¸ªæ€æƒ³ï¼Œæˆ‘ä»¬äº¤æ¢åï¼Œä¸€ä¸ªäººå°±æœ‰ä¸¤ä¸ªæ€æƒ³ If you can NOT explain it simply, you do NOT understand it</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/FraserYu/p/13150328.html</dc:identifier>
</item>
<item>
<title>å°å¸ˆå¦¹å­¦JVMä¹‹:æ·±å…¥ç†è§£JITå’Œç¼–è¯‘ä¼˜åŒ–-ä½ çœ‹ä¸æ‡‚ç³»åˆ— - flydean</title>
<link>http://www.cnblogs.com/flydean/p/jvm-jit-in-detail.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/flydean/p/jvm-jit-in-detail.html</guid>
<description>&lt;p&gt;å°å¸ˆå¦¹å·²ç»å­¦å®ŒJVMçš„ç®€å•éƒ¨åˆ†äº†ï¼Œæ¥ä¸‹æ¥è¦è¿›å…¥çš„æ˜¯JVMä¸­æ¯”è¾ƒæ™¦æ¶©éš¾æ‡‚çš„æ¦‚å¿µï¼Œè¿™äº›æ¦‚å¿µæ˜¯é‚£ä¹ˆçš„æ¯ç‡¥ä¹å‘³ï¼Œç”šè‡³è¿˜æœ‰ç‚¹æƒ¹äººè®¨åŒï¼Œä½†æ˜¯è¦æƒ³æ·±å…¥ç†è§£JVMï¼Œè¿™äº›æ¦‚å¿µæ˜¯å¿…é¡»çš„ï¼Œæˆ‘å°†ä¼šå°½é‡å°è¯•ç”¨ç®€å•çš„ä¾‹å­æ¥è§£é‡Šå®ƒä»¬ï¼Œä½†ä¸€å®šä¼šæœ‰äººçœ‹ä¸æ‡‚ï¼Œæ²¡å…³ç³»ï¼Œè¿™ä¸ªç³»åˆ—æœ¬ä¸æ˜¯ç»™æ‰€æœ‰äººçœ‹çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¤šç²¾å½©å†…å®¹ä¸”çœ‹ï¼š&lt;/p&gt;

&lt;p&gt;å°å¸ˆå¦¹:Få¸ˆå…„ï¼Œæˆ‘çš„åŸºç¡€å·²ç»æ‰“ç‰¢äº†å—ï¼Ÿå¯ä»¥è¿›å…¥è¿™ä¹ˆå¤æ‚çš„å†…å®¹ç¯èŠ‚äº†å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å°å¸ˆå¦¹ä¸è¯•è¯•æ€ä¹ˆçŸ¥é“ä¸è¡Œå‘¢ï¼Ÿäº†è§£ç‚¹æ·±å…¥å†…å®¹å¯ä»¥å¸®åŠ©ä½ æ›´å¥½çš„ç†è§£ä¹‹å‰çš„çŸ¥è¯†ã€‚ç°åœ¨æˆ‘ä»¬å¼€å§‹å§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šæ¬¡æˆ‘ä»¬åœ¨è®²javaç¨‹åºçš„å¤„ç†æµç¨‹çš„æ—¶å€™ï¼Œè¿˜è®°å¾—é‚£é€šç”¨çš„å‡ æ­¥å§ã€‚&lt;/p&gt;
&lt;p&gt;å°å¸ˆå¦¹ï¼šå½“ç„¶è®°å¾—äº†ï¼Œç¼–å†™æºä»£ç ï¼Œjavacç¼–è¯‘æˆå­—èŠ‚ç ï¼ŒåŠ è½½åˆ°JVMä¸­æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20200524212920415.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_0,text_aHR0cDovL3d3dy5mbHlkZWFuLmNvbQ==,size_35,color_8F8F8F,t_70&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¯¹ï¼Œå…¶å®åœ¨JVMçš„æ‰§è¡Œå¼•æ“ä¸­ï¼Œæœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼šè§£é‡Šå™¨ï¼ŒJITç¼–è¯‘å™¨å’Œåƒåœ¾å›æ”¶å™¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20200524221637660.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_0,text_aHR0cDovL3d3dy5mbHlkZWFuLmNvbQ==,size_35,color_8F8F8F,t_70&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è§£é‡Šå™¨ä¼šå°†å‰é¢ç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç ç¿»è¯‘æˆæœºå™¨è¯­è¨€ï¼Œå› ä¸ºæ¯æ¬¡éƒ½è¦ç¿»è¯‘ï¼Œç›¸å½“äºæ¯”ç›´æ¥ç¼–è¯‘æˆæœºå™¨ç è¦å¤šäº†ä¸€æ­¥ï¼Œæ‰€ä»¥javaæ‰§è¡Œèµ·æ¥ä¼šæ¯”è¾ƒæ…¢ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJVMå¼•å…¥äº†JIT(Just-in-Time)ç¼–è¯‘å™¨ï¼Œå°†çƒ­ç‚¹ä»£ç ç¼–è¯‘æˆä¸ºæœºå™¨ç ã€‚&lt;/p&gt;

&lt;p&gt;å°å¸ˆå¦¹ä½ çŸ¥é“å—ï¼Ÿåœ¨JDK8ä¹‹å‰ï¼ŒHotSpot VMåˆåˆ†ä¸ºä¸‰ç§ã€‚åˆ†åˆ«æ˜¯ client VM, server VM, å’Œ minimal VMï¼Œåˆ†åˆ«ç”¨åœ¨å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨ï¼Œå’ŒåµŒå…¥å¼ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯éšç€ç¡¬ä»¶æŠ€æœ¯çš„å‘å±•ï¼Œè¿™äº›ç¡¬ä»¶ä¸Šé¢çš„é™åˆ¶éƒ½ä¸æ˜¯ä»€ä¹ˆå¤§äº‹äº†ã€‚æ‰€ä»¥ä»JDK8ä¹‹åï¼Œå·²ç»ä¸å†åŒºåˆ†è¿™äº›VMäº†ï¼Œç°åœ¨ç»Ÿä¸€ä½¿ç”¨VMçš„å®ç°æ¥æ›¿ä»£ä»–ä»¬ã€‚&lt;/p&gt;
&lt;p&gt;å°å¸ˆå¦¹ï¼Œä½ è§‰å¾—Client VMå’ŒServer VMçš„æœ¬è´¨åŒºåˆ«åœ¨å“ªä¸€éƒ¨åˆ†å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å°å¸ˆå¦¹ï¼Œç¼–è¯‘æˆå­—èŠ‚ç åº”è¯¥éƒ½æ˜¯ä½¿ç”¨javacï¼Œéƒ½æ˜¯åŒæ ·çš„å‘½ä»¤ï¼Œå­—èŠ‚ç ä¸Šé¢è‚¯å®šæ˜¯ä¸€æ ·çš„ã€‚éš¾ç‚¹æ˜¯åœ¨æ‰§è¡Œå¼•æ“ä¸Šé¢çš„ä¸åŒï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¯´çš„å¯¹ï¼Œå› ä¸ºClient VMå’ŒServer VMçš„å‡ºç°ï¼Œæ‰€ä»¥åœ¨JITä¸­å‡ºç°äº†ä¸¤ç§ä¸åŒçš„ç¼–è¯‘å™¨ï¼ŒC1 for Client VMï¼Œ C2 for Server VMã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºjavacçš„ç¼–è¯‘åªèƒ½åšå°‘é‡çš„ä¼˜åŒ–ï¼Œå…¶å®å¤§é‡çš„åŠ¨æ€ä¼˜åŒ–æ˜¯åœ¨JITä¸­åšçš„ã€‚C2ç›¸å¯¹äºC1ï¼Œå…¶ä¼˜åŒ–çš„ç¨‹åº¦æ›´æ·±ï¼Œæ›´åŠ æ¿€è¿›ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ›´å¥½çš„æå‡ç¼–è¯‘æ•ˆç‡ï¼ŒJVMåœ¨JDK7ä¸­å¼•å…¥äº†åˆ†å±‚ç¼–è¯‘Tiered compilationçš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºJITæœ¬èº«æ¥è¯´ï¼ŒåŠ¨æ€ç¼–è¯‘æ˜¯éœ€è¦å ç”¨ç”¨æˆ·å†…å­˜ç©ºé—´çš„ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆè¾ƒé«˜çš„å»¶è¿Ÿã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºServeræœåŠ¡å™¨æ¥è¯´ï¼Œå› ä¸ºä»£ç è¦æœåŠ¡å¾ˆå¤šä¸ªclientï¼Œæ‰€ä»¥ç£¨åˆ€ä¸è¯¯ç æŸ´å·¥ï¼ŒçŸ­æš‚çš„å»¶è¿Ÿå¸¦æ¥æ°¸ä¹…çš„æ”¶ç›Šï¼Œå¬èµ·æ¥æ˜¯å¯ä»¥æ¥å—çš„ã€‚&lt;/p&gt;
&lt;p&gt;Serverç«¯çš„JITç¼–è¯‘ä¹Ÿä¸æ˜¯ç«‹é©¬è¿›è¡Œçš„ï¼Œå®ƒå¯èƒ½éœ€è¦æ”¶é›†åˆ°è¶³å¤Ÿå¤šçš„ä¿¡æ¯ä¹‹åï¼Œæ‰è¿›è¡Œç¼–è¯‘ã€‚&lt;/p&gt;
&lt;p&gt;è€Œå¯¹äºClientæ¥è¯´ï¼Œå»¶è¿Ÿå¸¦æ¥çš„æ€§èƒ½å½±å“å°±éœ€è¦è¿›è¡Œè€ƒè™‘äº†ã€‚å’ŒServerç›¸æ¯”ï¼Œå®ƒåªè¿›è¡Œäº†ç®€å•çš„æœºå™¨ç çš„ç¼–è¯‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ»¡è¶³ä¸åŒå±‚æ¬¡çš„ç¼–è¯‘éœ€æ±‚ï¼Œäºæ˜¯å¼•å…¥äº†åˆ†å±‚ç¼–è¯‘çš„æ¦‚å¿µã€‚&lt;/p&gt;
&lt;p&gt;å¤§æ¦‚æ¥è¯´åˆ†å±‚ç¼–è¯‘å¯ä»¥åˆ†ä¸ºä¸‰å±‚ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ç¬¬ä¸€å±‚å°±æ˜¯ç¦ç”¨C1å’ŒC2ç¼–è¯‘å™¨ï¼Œè¿™ä¸ªæ—¶å€™æ²¡æœ‰JITè¿›è¡Œã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒå±‚å°±æ˜¯åªå¼€å¯C1ç¼–è¯‘å™¨ï¼Œå› ä¸ºC1ç¼–è¯‘å™¨åªä¼šè¿›è¡Œä¸€äº›ç®€å•çš„JITä¼˜åŒ–ï¼Œæ‰€ä»¥è¿™ä¸ªå¯ä»¥åº”å¯¹å¸¸è§„æƒ…å†µã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰å±‚å°±æ˜¯åŒæ—¶å¼€å¯C1å’ŒC2ç¼–è¯‘å™¨ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;åœ¨JDK7ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å¼€å¯åˆ†å±‚ç¼–è¯‘ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;-XX:+TieredCompilation
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è€Œåœ¨JDK8ä¹‹åï¼Œæ­å–œä½ ï¼Œåˆ†å±‚ç¼–è¯‘å·²ç»æ˜¯é»˜è®¤çš„é€‰é¡¹äº†ï¼Œä¸ç”¨å†æ‰‹åŠ¨å¼€å¯ã€‚&lt;/p&gt;

&lt;p&gt;å°å¸ˆå¦¹ï¼šFå¸ˆå…„ï¼Œä½ åˆšåˆšè®²åˆ°Serverçš„JITä¸æ˜¯ç«‹é©¬å°±è¿›è¡Œç¼–è¯‘çš„ï¼Œå®ƒä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´æ¥æœé›†æ‰€éœ€çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆä»£ç ä¸æ˜¯è¦ä»å­—èŠ‚ç è½¬æ¢æˆæœºå™¨ç ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¯¹çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åšOSRï¼ˆOn-Stack Replacementï¼‰ã€‚ä¸ºä»€ä¹ˆå«OSRå‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“JVMçš„åº•å±‚å®ç°æ˜¯ä¸€ä¸ªæ ˆçš„è™šæ‹Ÿæœºï¼Œæ‰€ä»¥è¿™ä¸ªæ›¿æ¢å®é™…ä¸Šæ˜¯ä¸€ç³»åˆ—çš„Stackæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20200528094011924.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_0,text_aHR0cDovL3d3dy5mbHlkZWFuLmNvbQ==,size_35,color_8F8F8F,t_70&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ‰€ç¤ºï¼Œm1æ–¹æ³•ä»æœ€åˆçš„è§£é‡Šframeå˜æˆäº†åé¢çš„compiled frameã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªä¸–ç•Œæ˜¯å¹³è¡¡çš„ï¼Œæœ‰é˜´å°±æœ‰é˜³ï¼Œæœ‰ä¼˜åŒ–å°±æœ‰åä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;å°å¸ˆå¦¹ï¼šFå¸ˆå…„ï¼Œä¸ºä»€ä¹ˆä¼˜åŒ–äº†ä¹‹åè¿˜è¦åä¼˜åŒ–å‘¢ï¼Ÿè¿™æ ·å¯¹æ€§èƒ½ä¸æ˜¯ä¸‹é™äº†å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;é€šå¸¸æ¥è¯´æ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯æœ‰äº›ç‰¹æ®Šçš„æƒ…å†µä¸‹é¢ï¼Œç¡®å®æ˜¯éœ€è¦è¿›è¡Œåä¼˜åŒ–çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æ¯”è¾ƒå¸¸è§çš„æƒ…å†µï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;éœ€è¦è°ƒè¯•çš„æƒ…å†µ&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;å¦‚æœä»£ç æ­£åœ¨è¿›è¡Œå•ä¸ªæ­¥éª¤çš„è°ƒè¯•ï¼Œé‚£ä¹ˆä¹‹å‰è¢«ç¼–è¯‘æˆä¸ºæœºå™¨ç çš„ä»£ç éœ€è¦åä¼˜åŒ–å›æ¥ï¼Œä»è€Œèƒ½å¤Ÿè°ƒè¯•ã€‚&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;&lt;li&gt;ä»£ç åºŸå¼ƒçš„æƒ…å†µ&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;å½“ä¸€ä¸ªè¢«ç¼–è¯‘è¿‡çš„æ–¹æ³•ï¼Œå› ä¸ºç§ç§åŸå› ä¸å¯ç”¨äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å°†å…¶åä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;ol start=&quot;3&quot;&gt;&lt;li&gt;ä¼˜åŒ–ä¹‹å‰ç¼–è¯‘çš„ä»£ç &lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;æœ‰å¯èƒ½å‡ºç°ä¹‹å‰ä¼˜åŒ–è¿‡çš„ä»£ç å¯èƒ½ä¸å¤Ÿå®Œç¾ï¼Œéœ€è¦é‡æ–°ä¼˜åŒ–çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µä¸‹åŒæ ·ä¹Ÿéœ€è¦è¿›è¡Œåä¼˜åŒ–ã€‚&lt;/p&gt;

&lt;p&gt;é™¤äº†JITç¼–è¯‘æˆæœºå™¨ç ä¹‹å¤–ï¼ŒJITè¿˜æœ‰ä¸€ä¸‹å¸¸è§çš„ä»£ç ä¼˜åŒ–æ–¹å¼ï¼Œæˆ‘ä»¬æ¥ä¸€ä¸€ä»‹ç»ã€‚&lt;/p&gt;
&lt;h2 id=&quot;inliningå†…è”&quot;&gt;Inliningå†…è”&lt;/h2&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;int a = 1;
int b = 2;
int result = add(a, b);
...
public int add(int x, int y) { return x + y; }
int result = a + b; //å†…è”æ›¿æ¢
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸Šé¢çš„addæ–¹æ³•å¯ä»¥ç®€å•çš„è¢«æ›¿æ¢æˆä¸ºå†…è”è¡¨è¾¾å¼ã€‚&lt;/p&gt;
&lt;h2 id=&quot;branch-predictionåˆ†æ”¯é¢„æµ‹&quot;&gt;Branch Predictionåˆ†æ”¯é¢„æµ‹&lt;/h2&gt;
&lt;p&gt;é€šå¸¸æ¥è¯´å¯¹äºæ¡ä»¶åˆ†æ”¯ï¼Œå› ä¸ºéœ€è¦æœ‰ä¸€ä¸ªifçš„åˆ¤æ–­æ¡ä»¶ï¼ŒJVMéœ€è¦åœ¨æ‰§è¡Œå®Œæ¯•åˆ¤æ–­æ¡ä»¶ï¼Œå¾—åˆ°è¿”å›ç»“æœä¹‹åï¼Œæ‰èƒ½å¤Ÿç»§ç»­å‡†å¤‡åé¢çš„æ‰§è¡Œä»£ç ï¼Œå¦‚æœæœ‰äº†åˆ†æ”¯é¢„æµ‹ï¼Œé‚£ä¹ˆJVMå¯ä»¥æå‰å‡†å¤‡ç›¸åº”çš„æ‰§è¡Œä»£ç ï¼Œå¦‚æœåˆ†æ”¯æ£€æŸ¥æˆåŠŸå°±ç›´æ¥æ‰§è¡Œï¼Œçœå»äº†ä»£ç å‡†å¤‡çš„æ­¥éª¤ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;// make an array of random doubles 0..1
double[] bigArray = makeBigArray();
for (int i = 0; i &amp;lt; bigArray.length; i++)
{
 double cur = bigArray[i];
 if (cur &amp;gt; 0.5) { doThis();} else { doThat();}
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;loop-unswitching&quot;&gt;Loop unswitching&lt;/h2&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬åœ¨å¾ªç¯è¯­å¥é‡Œé¢æ·»åŠ äº†ifè¯­å¥ï¼Œä¸ºäº†æå‡å¹¶å‘çš„æ‰§è¡Œæ•ˆç‡ï¼Œå¯ä»¥å°†ifè¯­å¥ä»å¾ªç¯ä¸­æå–å‡ºæ¥ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;  int i, w, x[1000], y[1000];
  for (i = 0; i &amp;lt; 1000; i++) {
    x[i] += y[i];
    if (w)
      y[i] = 0;
  }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¯ä»¥æ”¹ä¸ºä¸‹é¢çš„æ–¹å¼ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;  int i, w, x[1000], y[1000];
  if (w) {
    for (i = 0; i &amp;lt; 1000; i++) {
      x[i] += y[i];
      y[i] = 0;
    }
  } else {
    for (i = 0; i &amp;lt; 1000; i++) {
      x[i] += y[i];
    }
  }
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;loop-unrollingå±•å¼€&quot;&gt;Loop unrollingå±•å¼€&lt;/h2&gt;
&lt;p&gt;åœ¨å¾ªç¯è¯­å¥ä¸­ï¼Œå› ä¸ºè¦ä¸æ–­çš„è¿›è¡Œè·³è½¬ï¼Œæ‰€ä»¥é™åˆ¶äº†æ‰§è¡Œçš„é€Ÿåº¦ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å¾ªç¯è¯­å¥ä¸­çš„é€»è¾‘è¿›è¡Œé€‚å½“çš„å±•å¼€ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt; int x;
 for (x = 0; x &amp;lt; 100; x++)
 {
     delete(x);
 }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è½¬å˜ä¸ºï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt; int x; 
 for (x = 0; x &amp;lt; 100; x += 5 )
 {
     delete(x);
     delete(x + 1);
     delete(x + 2);
     delete(x + 3);
     delete(x + 4);
 }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è™½ç„¶å¾ªç¯ä½“å˜é•¿äº†ï¼Œä½†æ˜¯è·³è½¬æ¬¡æ•°å˜å°‘äº†ï¼Œå…¶å®æ˜¯å¯ä»¥æå‡æ‰§è¡Œé€Ÿåº¦çš„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;escape-analysisé€ƒé€¸åˆ†æ&quot;&gt;Escape analysisé€ƒé€¸åˆ†æ&lt;/h2&gt;
&lt;p&gt;ä»€ä¹ˆå«é€ƒé€¸åˆ†æå‘¢ï¼Ÿç®€å•ç‚¹è®²å°±æ˜¯åˆ†æè¿™ä¸ªçº¿ç¨‹ä¸­çš„å¯¹è±¡ï¼Œæœ‰æ²¡æœ‰å¯èƒ½ä¼šè¢«å…¶ä»–å¯¹è±¡æˆ–è€…çº¿ç¨‹æ‰€è®¿é—®ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡åº”è¯¥åœ¨Heapä¸­åˆ†é…ï¼Œè¿™æ ·æ‰èƒ½è®©å¯¹å…¶ä»–çš„å¯¹è±¡å¯è§ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰å…¶ä»–çš„å¯¹è±¡è®¿é—®ï¼Œé‚£ä¹ˆå®Œå…¨å¯ä»¥åœ¨stackä¸­åˆ†é…è¿™ä¸ªå¯¹è±¡ï¼Œæ ˆä¸Šåˆ†é…è‚¯å®šæ¯”å †ä¸Šåˆ†é…è¦å¿«ï¼Œå› ä¸ºä¸ç”¨è€ƒè™‘åŒæ­¥çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;  public static void main(String[] args) {
    example();
  }
  public static void example() {
    Foo foo = new Foo(); //alloc
    Bar bar = new Bar(); //alloc
    bar.setFoo(foo);
  }
}

class Foo {}

class Bar {
  private Foo foo;
  public void setFoo(Foo foo) {
    this.foo = foo;
  }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒsetFooå¼•ç”¨äº†fooå¯¹è±¡ï¼Œå¦‚æœbarå¯¹è±¡æ˜¯åœ¨heapä¸­åˆ†é…çš„è¯ï¼Œé‚£ä¹ˆå¼•ç”¨çš„fooå¯¹è±¡å°±é€ƒé€¸äº†ï¼Œä¹Ÿéœ€è¦è¢«åˆ†é…åœ¨heapç©ºé—´ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å› ä¸ºbarå’Œfooå¯¹è±¡éƒ½åªæ˜¯åœ¨exampleæ–¹æ³•ä¸­è°ƒç”¨çš„ï¼Œæ‰€ä»¥ï¼ŒJVMå¯ä»¥åˆ†æå‡ºæ¥æ²¡æœ‰å…¶ä»–çš„å¯¹è±¡éœ€è¦å¼•ç”¨ä»–ä»¬ï¼Œé‚£ä¹ˆç›´æ¥åœ¨exampleçš„æ–¹æ³•æ ˆä¸­åˆ†é…è¿™ä¸¤ä¸ªå¯¹è±¡å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;é€ƒé€¸åˆ†æè¿˜æœ‰ä¸€ä¸ªä½œç”¨å°±æ˜¯lock coarseningã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä¿è¯èµ„æºçš„æœ‰åºè®¿é—®ï¼ŒJVMå¼•å…¥äº†é”çš„æ¦‚å¿µï¼Œè™½ç„¶é”å¯ä»¥ä¿è¯å¤šçº¿ç¨‹çš„æœ‰åºæ‰§è¡Œï¼Œä½†æ˜¯å¦‚æœå®åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸­å‘¢ï¼Ÿæ˜¯ä¸æ˜¯è¿˜éœ€è¦ä¸€ç›´ä½¿ç”¨é”å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public String getNames() {
     Vector&amp;lt;String&amp;gt; v = new Vector&amp;lt;&amp;gt;();
     v.add(&quot;Me&quot;);
     v.add(&quot;You&quot;);
     v.add(&quot;Her&quot;);
     return v.toString();
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Vectoræ˜¯ä¸€ä¸ªåŒæ­¥å¯¹è±¡ï¼Œå¦‚æœæ˜¯åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªåŒæ­¥é”æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› æ­¤åœ¨JDK6ä¹‹åï¼Œé”åªåœ¨è¢«éœ€è¦çš„æ—¶å€™æ‰ä¼šä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·å°±èƒ½æå‡ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚&lt;/p&gt;

&lt;p&gt;æœ¬æ–‡ä»‹ç»äº†JITçš„åŸç†å’Œä¸€äº›åŸºæœ¬çš„ä¼˜åŒ–æ–¹å¼ã€‚åé¢æˆ‘ä»¬ä¼šç»§ç»­æ¢ç´¢JITå’ŒJVMçš„ç§˜å¯†ï¼Œæ•¬è¯·æœŸå¾…ã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;8.7106598984772&quot;&gt;
&lt;p&gt;æœ¬æ–‡ä½œè€…ï¼šflydeanç¨‹åºé‚£äº›äº‹&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡é“¾æ¥ï¼š&lt;a href=&quot;http://www.flydean.com/jvm-jit-in-detail/&quot;&gt;http://www.flydean.com/jvm-jit-in-detail/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ¥æºï¼šflydeançš„åšå®¢&lt;/p&gt;
&lt;p&gt;æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·:ç¨‹åºé‚£äº›äº‹ï¼Œæ›´å¤šç²¾å½©ç­‰ç€æ‚¨ï¼&lt;/p&gt;
&lt;/blockquote&gt;
</description>
<pubDate>Tue, 16 Jun 2020 22:50:00 +0000</pubDate>
<dc:creator>flydean</dc:creator>
<og:description>ç®€ä»‹ å°å¸ˆå¦¹å·²ç»å­¦å®ŒJVMçš„ç®€å•éƒ¨åˆ†äº†ï¼Œæ¥ä¸‹æ¥è¦è¿›å…¥çš„æ˜¯JVMä¸­æ¯”è¾ƒæ™¦æ¶©éš¾æ‡‚çš„æ¦‚å¿µï¼Œè¿™äº›æ¦‚å¿µæ˜¯é‚£ä¹ˆçš„æ¯ç‡¥ä¹å‘³ï¼Œç”šè‡³è¿˜æœ‰ç‚¹æƒ¹äººè®¨åŒï¼Œä½†æ˜¯è¦æƒ³æ·±å…¥ç†è§£JVMï¼Œè¿™äº›æ¦‚å¿µæ˜¯å¿…é¡»çš„ï¼Œæˆ‘å°†ä¼šå°½é‡å°è¯•ç”¨ç®€å•çš„ä¾‹å­æ¥</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/flydean/p/jvm-jit-in-detail.html</dc:identifier>
</item>
<item>
<title>ä»å­—ç¬¦ä¸²åˆ°å¸¸é‡æ± ï¼Œä¸€æ–‡çœ‹æ‡‚Stringç±»è®¾è®¡ - ç¨‹åºå‘˜DMZ</title>
<link>http://www.cnblogs.com/daimzh/p/13150192.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/daimzh/p/13150192.html</guid>
<description>&lt;p&gt;çœ‹åˆ°è¿™ä¸ªæ ‡é¢˜ï¼Œä½ è‚¯å®šä»¥ä¸ºæˆ‘åˆè¦è®²è¿™é“é¢è¯•é¢˜äº†&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;//  è¿™è¡Œä»£ç åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ
String s3 = new String(&quot;1&quot;);
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ˜¯çš„ï¼Œæ²¡é”™ï¼Œæˆ‘ç¡®å®è¦ä»è¿™é‡Œå¼€å§‹&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNTIyMTQwODUwMC5wbmc?x-oss-process=image/format,png&quot; alt=&quot;image-20200615221408500&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è¿™é“é¢˜å°±ç®—ä½ æ²¡åšè¿‡ä¹Ÿè‚¯å®šçœ‹åˆ°ï¼Œæ€»æ‰€å‘¨çŸ¥ï¼Œå®ƒåˆ›å»ºäº†ä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªä½äºå †ä¸Šï¼Œä¸€ä¸ªä½äºå¸¸é‡æ± ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªç­”æ¡ˆç²—çœ‹èµ·æ¥æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼Œä½†æ˜¯ä»”ç»†æ€è€ƒç¡®ç»ä¸èµ·æ¨æ•²ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ è§‰å¾—æˆ‘è¯´çš„ä¸å¯¹çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥æ€è€ƒä¸‹é¢è¿™ä¸¤ä¸ªé—®é¢˜&lt;/p&gt;
&lt;ol readability=&quot;2&quot;&gt;&lt;li readability=&quot;3&quot;&gt;
&lt;p&gt;ä½ è¯´å®ƒåˆ›å»ºäº†ä¸¤ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå¯¹è±¡åˆ†åˆ«æ˜¯æ€æ ·åˆ›å»ºçš„å‘¢ï¼Ÿæˆ‘ä»¬å›é¡¾ä¸‹Javaåˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œä¸€å…±å°±è¿™ä¹ˆå‡ ç§&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä½¿ç”¨newå…³é”®å­—åˆ›å»ºå¯¹è±¡&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨åå°„åˆ›å»ºå¯¹è±¡ï¼ˆåŒ…æ‹¬Classç±»çš„&lt;code&gt;newInstance&lt;/code&gt;æ–¹æ³•ï¼Œä»¥åŠConstructorç±»çš„&lt;code&gt;newInstance&lt;/code&gt;æ–¹æ³•ï¼‰&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨cloneå¤åˆ¶ä¸€ä¸ªå¯¹è±¡&lt;/li&gt;
&lt;li&gt;ååºåˆ—åŒ–å¾—åˆ°ä¸€ä¸ªå¯¹è±¡&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;ä½ è¯´å®ƒåˆ›å»ºäº†ä¸¤ä¸ªå¯¹è±¡ï¼Œé‚£ä½ å‘Šè¯‰æˆ‘é™¤äº†newå‡ºæ¥é‚£ä¸ªå¯¹è±¡å¤–ï¼Œå¦å¤–ä¸€ä¸ªå¯¹è±¡æ€ä¹ˆåˆ›å»ºå‡ºæ¥çš„ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;å †è·Ÿå¸¸é‡æ± åˆ°åº•ä»€ä¹ˆå…³ç³»ï¼Ÿä¸æ˜¯è¯´åœ¨&lt;code&gt;JDK1.7&lt;/code&gt;ä¹‹åï¼ˆå«1.7ç‰ˆæœ¬ï¼‰å¸¸é‡æ± å·²ç»ç§»åˆ°äº†å †ä¸­äº†å—ï¼Ÿå¦‚æœè¯´å¸¸é‡æ± æœ¬èº«å°±ä½äºå †ä¸­çš„è¯ï¼Œé‚£ä¹ˆè¿™ç§&lt;code&gt;ä¸€ä¸ªå¯¹è±¡åœ¨å †ä¸­ï¼Œä¸€ä¸ªå¯¹è±¡åœ¨å¸¸é‡æ± &lt;/code&gt;çš„è¯´æ³•è¿˜å‡†ç¡®å—ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;å¦‚æœä½ ä¹Ÿäº§ç”Ÿè¿‡è¿™äº›ç–‘é—®çš„è¯ï¼Œé‚£ä¹ˆè¯·è€å¿ƒçœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼è¦è§£é‡Šä¸Šé¢çš„é—®é¢˜é¦–å…ˆæˆ‘ä»¬å¾—å¯¹å¸¸é‡æ± æœ‰ä¸ªå‡†ç¡®çš„è®¤çŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNTIyMTUwMjI2OC5wbmc?x-oss-process=image/format,png&quot; alt=&quot;image-20200615221502268&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;p&gt;é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬æåˆ°çš„å¸¸é‡æ± åˆ†ä¸ºä¸‰ç§&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;classæ–‡ä»¶ä¸­çš„å¸¸é‡æ± &lt;/li&gt;
&lt;li&gt;è¿è¡Œæ—¶å¸¸é‡æ± &lt;/li&gt;
&lt;li&gt;å­—ç¬¦ä¸²å¸¸é‡æ± &lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;å¯¹äºè¿™ä¸‰ç§å¸¸é‡æ± ï¼Œæˆ‘ä»¬éœ€è¦ææ‡‚ä¸‹é¢å‡ ä¸ªé—®é¢˜ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;è¿™ä¸ªå¸¸é‡æ± åœ¨å“ªé‡Œï¼Ÿ&lt;/li&gt;
&lt;li&gt;è¿™ä¸ªå¸¸é‡æ± ç”¨æ¥å¹²ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/li&gt;
&lt;li&gt;è¿™ä¸‰è€…æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸¦ç€è¿™äº›é—®é¢˜å¾€ä¸‹çœ‹&lt;/p&gt;
&lt;h2 id=&quot;classæ–‡ä»¶ä¸­çš„å¸¸é‡æ± &quot;&gt;classæ–‡ä»¶ä¸­çš„å¸¸é‡æ± &lt;/h2&gt;
&lt;h3 id=&quot;ä½ç½®åœ¨å“ªï¼Ÿ&quot;&gt;ä½ç½®åœ¨å“ªï¼Ÿ&lt;/h3&gt;
&lt;p&gt;é¡¾åæ€ä¹‰ï¼Œclassæ–‡ä»¶ä¸­çš„å¸¸é‡æ± å½“ç„¶æ˜¯ä½äºclassæ–‡ä»¶ä¸­ï¼Œè€Œ&lt;strong&gt;classæ–‡ä»¶åˆæ˜¯ä½äºç£ç›˜ä¸Š&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿ&quot;&gt;ç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;åœ¨å­¦ä¹ classæ–‡ä»¶ä¸­çš„å¸¸é‡æ± å‰ï¼Œæˆ‘ä»¬é¦–é€‰éœ€è¦å¯¹classæ–‡ä»¶çš„ç»“æ„æœ‰ä¸€å®šäº†è§£&lt;/p&gt;
&lt;blockquote readability=&quot;13&quot;&gt;
&lt;p&gt;Classæ–‡ä»¶æ˜¯ä¸€ç»„ä»¥8ä¸ªå­—èŠ‚ä¸ºåŸºç¡€å•ä½çš„äºŒè¿›åˆ¶æµï¼Œå„ä¸ªæ•°æ®é¡¹ç›®ä¸¥æ ¼æŒ‰ç…§é¡ºåºç´§å‡‘åœ°æ’åˆ—åœ¨æ–‡&lt;/p&gt;
&lt;p&gt;ä»¶ä¹‹ä¸­ï¼Œä¸­é—´æ²¡æœ‰æ·»åŠ ä»»ä½•åˆ†éš”ç¬¦ï¼Œè¿™ä½¿å¾—æ•´ä¸ªClassæ–‡ä»¶ä¸­å­˜å‚¨çš„å†…å®¹å‡ ä¹å…¨éƒ¨æ˜¯ç¨‹åºè¿è¡Œçš„å¿…è¦æ•°&lt;/p&gt;
&lt;p&gt;æ®ï¼Œæ²¡æœ‰ç©ºéš™å­˜åœ¨ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ ------------ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ•´ä¸ªclassæ–‡ä»¶çš„ç»„æˆå¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤º&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNTIyNTAxNjYwNC5wbmc?x-oss-process=image/format,png&quot; alt=&quot;image-20200615225016604&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¯¹æœ¬æ–‡è€Œè¨€ï¼Œæˆ‘ä»¬åªå…³æ³¨å…¶ä¸­çš„å¸¸é‡æ± éƒ¨åˆ†ï¼Œ&lt;strong&gt;å¸¸é‡æ± å¯ä»¥ç†è§£ä¸ºclassæ–‡ä»¶ä¸­èµ„æºä»“åº“&lt;/strong&gt;ï¼Œå®ƒæ˜¯classæ–‡ä»¶ç»“æ„ä¸­ä¸å…¶å®ƒé¡¹ç›®å…³è”æœ€å¤šçš„æ•°æ®ç±»å‹ï¼Œä¸»è¦ç”¨äºå­˜æ”¾ç¼–è¯‘å™¨ç”Ÿæˆçš„&lt;strong&gt;å„ç§å­—é¢é‡(Literal)å’Œç¬¦å·å¼•ç”¨(Symbolic References)&lt;/strong&gt;ã€‚&lt;br/&gt;&lt;strong&gt;å­—é¢é‡å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å¸¸é‡æ¦‚å¿µï¼Œå¦‚æ–‡æœ¬å­—ç¬¦ä¸²ã€è¢«å£°æ˜ä¸ºfinalçš„å¸¸é‡å€¼ç­‰&lt;/strong&gt;ã€‚&lt;br/&gt;&lt;strong&gt;ç¬¦å·å¼•ç”¨æ˜¯ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡&lt;/strong&gt;ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨æ—¶èƒ½æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ï¼ˆå®ƒä¸ç›´æ¥å¼•ç”¨åŒºåˆ†ä¸€ä¸‹ï¼Œç›´æ¥å¼•ç”¨ä¸€èˆ¬æ˜¯æŒ‡å‘æ–¹æ³•åŒºçš„æœ¬åœ°æŒ‡é’ˆï¼Œç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ï¼‰ã€‚ä¸€èˆ¬åŒ…æ‹¬ä¸‹é¢ä¸‰ç±»å¸¸é‡ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ç±»å’Œæ¥å£çš„å…¨é™å®šå&lt;/li&gt;
&lt;li&gt;å­—æ®µçš„åç§°å’Œæè¿°ç¬¦&lt;/li&gt;
&lt;li&gt;æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†classæ–‡ä»¶ä¸­å¸¸é‡æ± çš„ä½œç”¨ï¼šå­˜æ”¾ç¼–è¯‘å™¨ç”Ÿæˆçš„&lt;strong&gt;å„ç§å­—é¢é‡(Literal)å’Œç¬¦å·å¼•ç”¨(Symbolic References)&lt;/strong&gt;ã€‚å¾ˆå¤šæ—¶å€™çŸ¥é“äº†ä¸€ä¸ªä¸œè¥¿çš„æ¦‚å¿µå¹¶ä¸èƒ½è¯´ä½ ä¼šäº†ï¼Œå¯¹äºç¨‹åºå‘˜è€Œè¨€ï¼Œå¦‚æœä½ è¯´ä½ å·²ç»ä¼šäº†ï¼Œé‚£ä¹ˆæœ€å¥½çš„è¯æ˜æ˜¯ä½ èƒ½å¤Ÿé€šè¿‡ä»£ç å°†å…¶æè¿°å‡ºæ¥ï¼Œæ‰€ä»¥ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘æƒ³ä»¥ä¸€ç§ç›´è§‚çš„æ–¹å¼è®©å¤§å®¶æ„Ÿå—åˆ°å¸¸é‡æ± çš„å­˜åœ¨ã€‚é€šè¿‡åˆ†æä¸€æ®µç®€å•ä»£ç çš„å­—èŠ‚ç ï¼Œè®©å¤§å®¶èƒ½æ›´å¥½æ„ŸçŸ¥å¸¸é‡æ± çš„ä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ &lt;em&gt;talk is cheap ,show me code&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä»¥ä¸‹é¢è¿™æ®µä»£ç ä¸ºä¾‹ï¼Œé€šè¿‡&lt;code&gt;javap&lt;/code&gt;æ¥æŸ¥çœ‹classæ–‡ä»¶ä¸­çš„å…·ä½“å†…å®¹ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;/**
 * @author ç¨‹åºå‘˜DMZ
 * @Date Create in 22:59 2020/6/15
 * @å…¬ä¼—å· å¾®ä¿¡æœç´¢ï¼šç¨‹åºå‘˜DMZ
 */
public class Main {
    public static void main(String[] args) {
        String name = &quot;dmz&quot;;
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿›å…¥&lt;code&gt;Main.java&lt;/code&gt;æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š&lt;code&gt;javac Main.java&lt;/code&gt; ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆå¯¹åº”çš„&lt;code&gt;Main.classæ–‡ä»¶&lt;/code&gt;ã€‚å†æ‰§è¡Œå‘½ä»¤ï¼š&lt;code&gt;javap -v -c Main.class&lt;/code&gt;ï¼Œæ­¤æ—¶ä¼šå¾—åˆ°å¦‚ä¸‹çš„è§£æåçš„å­—èŠ‚ç ä¿¡æ¯&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public class com.dmz.jvm.Main
  minor version: 0
  major version: 52
  flags: ACC_PUBLIC, ACC_SUPER
// è¿™é‡Œå°±æ˜¯å¸¸é‡æ± äº†
Constant pool:
   #1 = Methodref          #4.#20         // java/lang/Object.&quot;&amp;lt;init&amp;gt;&quot;:()V
   #2 = String             #21            // dmz
   #3 = Class              #22            // com/dmz/jvm/Main
   #4 = Class              #23            // java/lang/Object
   #5 = Utf8               &amp;lt;init&amp;gt;
   #6 = Utf8               ()V
   #7 = Utf8               Code
   #8 = Utf8               LineNumberTable
   #9 = Utf8               LocalVariableTable
  #10 = Utf8               this
  #11 = Utf8               Lcom/dmz/jvm/Main;
  #12 = Utf8               main
  #13 = Utf8               ([Ljava/lang/String;)V
  #14 = Utf8               args
  #15 = Utf8               [Ljava/lang/String;
  #16 = Utf8               name
  #17 = Utf8               Ljava/lang/String;
  #18 = Utf8               SourceFile
  #19 = Utf8               Main.java
  #20 = NameAndType        #5:#6          // &quot;&amp;lt;init&amp;gt;&quot;:()V
  #21 = Utf8               dmz
  #22 = Utf8               com/dmz/jvm/Main
  #23 = Utf8               java/lang/Object
 // ä¸‹é¢æ˜¯æ–¹æ³•è¡¨                           
{
  public com.dmz.jvm.Main();
    descriptor: ()V
    flags: ACC_PUBLIC
    Code:
      stack=1, locals=1, args_size=1
         0: aload_0
         1: invokespecial #1                  // Method java/lang/Object.&quot;&amp;lt;init&amp;gt;&quot;:()V
         4: return
      LineNumberTable:
        line 7: 0
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0       5     0  this   Lcom/dmz/jvm/Main;

  public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=1, locals=2, args_size=1
         // å¯ä»¥çœ‹åˆ°æ–¹æ³•è¡¨ä¸­çš„æŒ‡ä»¤å¼•ç”¨äº†å¸¸é‡æ± ä¸­çš„å¸¸é‡ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¯´å¸¸é‡æ± æ˜¯èµ„æºä»“åº“çš„åŸå› 
         // å› ä¸ºå®ƒä¼šè¢«classæ–‡ä»¶ä¸­çš„å…¶å®ƒç»“æ„å¼•ç”¨         
         0: ldc           #2                  // String dmz
         2: astore_1
         3: return
      LineNumberTable:
        line 9: 0
        line 10: 3
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0       4     0  args   [Ljava/lang/String;
            3       1     1  name   Ljava/lang/String;
}
SourceFile: &quot;Main.java&quot;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„å­—èŠ‚ç ä¸­ï¼Œæˆ‘ä»¬æš‚ä¸”å…³æ³¨å¸¸é‡æ± ä¸­çš„å†…å®¹å³å¯ã€‚ä¸»è¦çœ‹è¿™ä¸¤è¡Œ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;#2 = String             #14            // dmz
#14 = Utf8               dmz
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¦‚æœè¦çœ‹æ‡‚è¿™ä¸¤è¡Œä»£ç ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å¸¸é‡æ± ä¸­Stringç±»å‹å¸¸é‡çš„ç»“æ„æœ‰ä¸€å®šäº†è§£ï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;CONSTANT_String_info&lt;/th&gt;
&lt;th&gt;tag&lt;/th&gt;
&lt;th&gt;æ ‡å¿—å¸¸é‡ç±»å‹çš„æ ‡ç­¾&lt;/th&gt;
&lt;/tr&gt;&lt;/thead&gt;&lt;tbody readability=&quot;1&quot;&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td/&gt;
&lt;td&gt;index&lt;/td&gt;
&lt;td&gt;æŒ‡å‘å­—ç¬¦ä¸²å­—é¢é‡çš„ç´¢å¼•&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;å¯¹åº”åˆ°æˆ‘ä»¬ä¸Šé¢çš„å­—èŠ‚ç ä¸­ï¼Œtag=Stringï¼Œindex=&lt;code&gt;#14&lt;/code&gt;ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œ&lt;code&gt;#2&lt;/code&gt;æ˜¯ä¸€ä¸ªå­—é¢é‡ä¸º&lt;code&gt;#14&lt;/code&gt;çš„å­—ç¬¦ä¸²ç±»å‹å¸¸é‡ã€‚è€Œ&lt;code&gt;#14&lt;/code&gt;å¯¹åº”çš„å­—é¢é‡ä¿¡æ¯ï¼ˆä¸€ä¸ª&lt;code&gt;Utf8&lt;/code&gt;ç±»å‹çš„å¸¸é‡ï¼‰å°±æ˜¯&lt;code&gt;dmz&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¸¸é‡æ± ä½œä¸ºèµ„æºä»“åº“ï¼Œæœ€å¤§çš„ç”¨å¤„åœ¨äºè¢«classæ–‡ä»¶ä¸­çš„å…¶å®ƒç»“æ„æ‰€å¼•ç”¨ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†å°†æ³¨æ„åŠ›æ”¾åˆ°mainæ–¹æ³•ä¸Šæ¥ï¼Œå¯¹åº”çš„å°±æ˜¯è¿™ä¸‰æ¡æŒ‡ä»¤&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;0: ldc           #2                  // String dmz
2: astore_1
3: return
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;ldc&lt;/code&gt;ï¼šè¿™ä¸ªæŒ‡ä»¤çš„ä½œç”¨æ˜¯å°†å¯¹åº”çš„å¸¸é‡çš„å¼•ç”¨å‹å…¥æ“ä½œæ•°æ ˆï¼Œåœ¨æ‰§è¡Œ&lt;code&gt;ldc&lt;/code&gt;æŒ‡ä»¤æ—¶ä¼šè§¦å‘å¯¹å®ƒçš„ç¬¦å·å¼•ç”¨è¿›è¡Œè§£æï¼Œåœ¨ä¸Šé¢ä¾‹å­ä¸­å¯¹åº”çš„ç¬¦å·å¼•ç”¨å°±æ˜¯&lt;code&gt;#2&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆè¿™é‡Œå°±èƒ½çœ‹å‡ºæ–¹æ³•è¡¨ä¸­å°±å¼•ç”¨äº†å¸¸é‡æ± ä¸­çš„èµ„æºï¼‰&lt;/p&gt;
&lt;p&gt;&lt;code&gt;astore_1&lt;/code&gt;ï¼šå°†æ“ä½œæ•°æ ˆåº•å…ƒç´ å¼¹å‡ºï¼Œå­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­çš„1å·å…ƒç´ &lt;/p&gt;
&lt;p&gt;&lt;code&gt;return&lt;/code&gt;ï¼šæ–¹æ³•è¿”å›å€¼ä¸ºvoidï¼Œæ ‡å¿—æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œå°†æ–¹æ³•å¯¹åº”æ ˆå¸§ä»æ ˆä¸­å¼¹å‡º&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ç”¨ç”»å›¾çš„æ–¹å¼æ¥ç”»å‡ºæ•´ä¸ªæµç¨‹ï¼Œä¸»è¦åˆ†ä¸ºå››æ­¥&lt;/p&gt;
&lt;ol readability=&quot;1&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;è§£æ&lt;code&gt;ldc&lt;/code&gt;æŒ‡ä»¤çš„ç¬¦å·å¼•ç”¨ï¼ˆ&lt;code&gt;#2&lt;/code&gt;ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;å°†&lt;code&gt;#2&lt;/code&gt;å¯¹åº”çš„å¸¸é‡çš„å¼•ç”¨å‹å…¥åˆ°æ“ä½œæ•°æ ˆé¡¶&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;å°†æ“ä½œæ•°æ ˆçš„å…ƒç´ å¼¹å‡ºå¹¶å­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;æ‰§è¡Œ&lt;code&gt;return&lt;/code&gt;æŒ‡ä»¤ï¼Œæ–¹æ³•æ‰§è¡Œç»“æŸï¼Œå¼¹å‡ºæ ˆåŒºè¯¥æ–¹æ³•å¯¹åº”çš„æ ˆå¸§&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;&lt;strong&gt;ç¬¬ä¸€æ­¥ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNjIxNTc0NTYzMy5wbmc?x-oss-process=image/format,png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è§£æ&lt;code&gt;#2&lt;/code&gt;è¿™ä¸ªç¬¦å·å¼•ç”¨æ—¶ï¼Œä¼šå…ˆåˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å¯¹åº”å­—ç¬¦ä¸²å®ä¾‹çš„å¼•ç”¨ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›è¿™ä¸ªå­—ç¬¦ä¸²å®ä¾‹çš„å¼•ç”¨ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œä¼šåˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å®ä¾‹ï¼Œé‚£ä¹ˆå°†å…¶æ·»åŠ åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼ˆå®é™…ä¸Šæ˜¯å°†å…¶å¼•ç”¨æ”¾å…¥åˆ°ä¸€ä¸ªå“ˆå¸Œè¡¨ä¸­ï¼‰ï¼Œä¹‹åå†è¿”å›è¿™ä¸ªå­—ç¬¦ä¸²å®ä¾‹å¯¹è±¡çš„å¼•ç”¨ã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;åˆ°è¿™é‡Œä¹Ÿèƒ½å›ç­”æˆ‘ä»¬ä¹‹å‰æå‡ºçš„é‚£ä¸ªé—®é¢˜äº†ï¼Œä¸€ä¸ªå¯¹è±¡æ˜¯newå‡ºæ¥çš„ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯åœ¨è§£æå¸¸é‡æ± çš„æ—¶å€™JVMè‡ªåŠ¨åˆ›å»ºçš„&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬äºŒæ­¥ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNjIxNTgzODQxNS5wbmc?x-oss-process=image/format,png&quot; alt=&quot;image-20200616215838415&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å°†ç¬¬ä¸€æ­¥å¾—åˆ°çš„å¼•ç”¨å‹å…¥åˆ°æ“ä½œæ•°æ ˆï¼Œæ­¤æ—¶è¿™ä¸ªå­—ç¬¦ä¸²å®ä¾‹åŒæ—¶è¢«æ“ä½œæ•°æ ˆä»¥åŠå­—ç¬¦ä¸²å¸¸é‡æ± å¼•ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬ä¸‰æ­¥ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNjIyMDM0NDEwMi5wbmc?x-oss-process=image/format,png&quot; alt=&quot;image-20200616220344102&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ“ä½œæ•°æ ˆä¸­çš„å¼•ç”¨å¼¹å‡ºï¼Œå¹¶èµ‹å€¼ç»™å±€éƒ¨å˜é‡è¡¨ä¸­çš„1å·ä½ç½®å…ƒç´ ï¼Œåˆ°è¿™ä¸€æ­¥å…¶å®æ‰§è¡Œå®Œäº†&lt;code&gt;String name = &quot;dmz&quot;&lt;/code&gt;è¿™è¡Œä»£ç ã€‚æ­¤æ—¶å±€éƒ¨å˜é‡è¡¨ä¸­å‚¨å­˜ç€ä¸€ä¸ªæŒ‡å‘å †ä¸­å­—ç¬¦ä¸²å®ä¾‹çš„å¼•ç”¨ï¼Œå¹¶ä¸”è¿™ä¸ªå­—ç¬¦ä¸²å®ä¾‹åŒæ—¶ä¹Ÿè¢«å­—ç¬¦ä¸²å¸¸é‡æ± å¼•ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬å››æ­¥ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸€æ­¥æˆ‘å°±ä¸ç”»å›¾äº†ï¼Œå°±æ˜¯æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œæ ˆå¸§å¼¹å‡ºï¼Œéå¸¸ç®€å•ã€‚&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘å¤šæ¬¡æåˆ°äº†&lt;strong&gt;å­—ç¬¦ä¸²å¸¸é‡æ± &lt;/strong&gt;ï¼Œå®ƒåˆ°åº•æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿæˆ‘ä»¬è¿˜æ˜¯åˆ†ä¸ºä¸¤éƒ¨åˆ†è®¨è®º&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ä½ç½®åœ¨å“ª?&lt;/li&gt;
&lt;li&gt;ç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;&lt;h2 id=&quot;å­—ç¬¦ä¸²å¸¸é‡æ± &quot;&gt;å­—ç¬¦ä¸²å¸¸é‡æ± &lt;/h2&gt;
&lt;h3 id=&quot;ä½ç½®åœ¨å“ªï¼Ÿ-2&quot;&gt;ä½ç½®åœ¨å“ªï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å­—ç¬¦ä¸²å¸¸é‡æ± æ¯”è¾ƒç‰¹æ®Šï¼Œåœ¨&lt;code&gt;JDK1.7&lt;/code&gt;ä¹‹å‰ï¼Œå…¶å­˜åœ¨äºæ°¸ä¹…ä»£ä¸­ï¼Œåˆ°&lt;code&gt;JDK1.7åŠ&lt;/code&gt;ä¹‹åï¼Œå·²ç»ä¸­æ°¸ä¹…ä»£ç§»åˆ°äº†å †ä¸­ã€‚å½“ç„¶ï¼Œå¦‚æœä½ éè¦è¯´æ°¸ä¹…ä»£ä¹Ÿæ˜¯å †çš„ä¸€éƒ¨åˆ†é‚£æˆ‘ä¹Ÿæ²¡åŠæ³•ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–è¿˜è¦è¯´æ˜ä¸€ç‚¹ï¼Œç»å¸¸æœ‰åŒå­¦ä¼šå°†&lt;code&gt;æ–¹æ³•åŒº&lt;/code&gt;ï¼Œ&lt;code&gt;å…ƒç©ºé—´&lt;/code&gt;ï¼Œ&lt;code&gt;æ°¸ä¹…ä»£ï¼ˆpermgen spaceï¼‰&lt;/code&gt;çš„æ¦‚å¿µæ··æ·†ã€‚è¯·æ³¨æ„&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;&lt;code&gt;æ–¹æ³•åŒº&lt;/code&gt;æ˜¯&lt;code&gt;JVM&lt;/code&gt;åœ¨å†…å­˜åˆ†é…æ—¶éœ€è¦éµå®ˆçš„è§„èŒƒï¼Œæ˜¯ä¸€ä¸ªç†è®ºï¼Œå…·ä½“çš„å®ç°å¯ä»¥å› äººè€Œå¼‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;æ°¸ä¹…ä»£&lt;/code&gt;æ˜¯&lt;code&gt;hotspot&lt;/code&gt; çš„&lt;code&gt;jdk1.8&lt;/code&gt;ä»¥å‰å¯¹æ–¹æ³•åŒºçš„å®ç°ï¼Œä½¿ç”¨&lt;code&gt;jdk1.7&lt;/code&gt;çš„è€å¸æœºè‚¯å®šä»¥å‰ç»å¸¸é‡åˆ°è¿‡&lt;code&gt;java.lang.OutOfMemoryError: PremGen space&lt;/code&gt;å¼‚å¸¸ã€‚è¿™é‡Œçš„&lt;code&gt;PermGen space&lt;/code&gt;å…¶å®æŒ‡çš„å°±æ˜¯æ–¹æ³•åŒºã€‚ä¸è¿‡æ–¹æ³•åŒºå’Œ&lt;code&gt;PermGen space&lt;/code&gt;åˆæœ‰ç€æœ¬è´¨çš„åŒºåˆ«ã€‚å‰è€…æ˜¯&lt;code&gt;JVMçš„è§„èŒƒ&lt;/code&gt;ï¼Œè€Œåè€…åˆ™æ˜¯&lt;code&gt;JVMè§„èŒƒ&lt;/code&gt;çš„ä¸€ç§å®ç°ï¼Œå¹¶ä¸”åªæœ‰&lt;code&gt;HotSpot&lt;/code&gt;æ‰æœ‰&lt;code&gt;PermGen space&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;å…ƒç©ºé—´&lt;/code&gt;æ˜¯&lt;code&gt;jdk1.8&lt;/code&gt;å¯¹æ–¹æ³•åŒºçš„å®ç°ï¼Œ&lt;code&gt;jdk1.8&lt;/code&gt;å½»åº•ç§»é™¤äº†æ°¸ä¹…ä»£ï¼Œå…¶å®ï¼Œç§»é™¤æ°¸ä¹…ä»£çš„å·¥ä½œä»&lt;code&gt;JDK 1.7&lt;/code&gt;å°±å¼€å§‹äº†ã€‚&lt;code&gt;JDK 1.7&lt;/code&gt;ä¸­ï¼Œå­˜å‚¨åœ¨æ°¸ä¹…ä»£çš„éƒ¨åˆ†æ•°æ®å°±å·²ç»è½¬ç§»åˆ°Java Heapæˆ–è€…Native Heapã€‚ä½†æ°¸ä¹…ä»£ä»å­˜åœ¨äº&lt;code&gt;JDK 1.7&lt;/code&gt;ä¸­ï¼Œå¹¶æ²¡æœ‰å®Œå…¨ç§»é™¤ï¼Œè­¬å¦‚ç¬¦å·å¼•ç”¨(Symbols)è½¬ç§»åˆ°äº†native heapï¼›å­—é¢é‡(interned strings)è½¬ç§»åˆ°äº†Java heapï¼›ç±»çš„é™æ€å˜é‡(class statics)è½¬ç§»åˆ°äº†Java heapã€‚åˆ°&lt;code&gt;jdk1.8&lt;/code&gt;å½»åº•ç§»é™¤äº†æ°¸ä¹…ä»£ï¼Œå°†JDK7ä¸­è¿˜å‰©ä½™çš„æ°¸ä¹…ä»£ä¿¡æ¯å…¨éƒ¨ç§»åˆ°å…ƒç©ºé—´ï¼Œå…ƒç©ºé—´ç›¸æ¯”å¯¹æ°¸ä¹…ä»£æœ€å¤§çš„å·®åˆ«æ˜¯ï¼Œ&lt;strong&gt;å…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ï¼ˆNative Memoryï¼‰&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;ç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿ-2&quot;&gt;ç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œé¡¾åæ€ä¹‰ï¼Œè‚¯å®šå°±æ˜¯ç”¨æ¥å­˜å‚¨å­—ç¬¦ä¸²çš„å˜›ï¼Œå‡†ç¡®æ¥è¯´å­˜å‚¨çš„æ˜¯å­—ç¬¦ä¸²å®ä¾‹å¯¹è±¡çš„å¼•ç”¨ã€‚æˆ‘æŸ¥é˜…äº†å¾ˆå¤šåšå®¢ã€èµ„æ–™ï¼Œå®ƒä»¬éƒ½ä¼šè¯´ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­˜å‚¨çš„å°±æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ã€‚å…¶å®æˆ‘ä»¬å¯ä»¥ç±»æ¯”ä¸‹é¢è¿™æ®µä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;HashSet&amp;lt;Person&amp;gt; persons = new HashSet&amp;lt;Person&amp;gt;;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨&lt;code&gt;persons&lt;/code&gt;è¿™ä¸ªé›†åˆä¸­ï¼Œå­˜å‚¨çš„æ˜¯&lt;code&gt;Person&lt;/code&gt;å¯¹è±¡è¿˜æ˜¯&lt;code&gt;Person&lt;/code&gt;å¯¹è±¡å¯¹åº”çš„å¼•ç”¨å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œè¯·å¤§å£°è·Ÿæˆ‘å¿µä¸‰é&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å­—ç¬¦ä¸²å¸¸é‡æ± å­˜å‚¨çš„æ˜¯å­—ç¬¦ä¸²å®ä¾‹å¯¹è±¡çš„å¼•ç”¨ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å­—ç¬¦ä¸²å¸¸é‡æ± å­˜å‚¨çš„æ˜¯å­—ç¬¦ä¸²å®ä¾‹å¯¹è±¡çš„å¼•ç”¨ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å­—ç¬¦ä¸²å¸¸é‡æ± å­˜å‚¨çš„æ˜¯å­—ç¬¦ä¸²å®ä¾‹å¯¹è±¡çš„å¼•ç”¨ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ¥çœ‹Rå¤§åšæ–‡ä¸‹è¯„è®ºçš„ä¸€æ®µè¯ï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼ŒHotSpot VMé‡ŒStringTableæ˜¯ä¸ªå“ˆå¸Œè¡¨ï¼Œé‡Œé¢å­˜çš„æ˜¯é©»ç•™å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼ˆè€Œä¸æ˜¯é©»ç•™å­—ç¬¦ä¸²å®ä¾‹è‡ªèº«ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´æŸäº›æ™®é€šçš„å­—ç¬¦ä¸²å®ä¾‹è¢«è¿™ä¸ªStringTableå¼•ç”¨ä¹‹åå°±ç­‰åŒè¢«èµ‹äºˆäº†â€œé©»ç•™å­—ç¬¦ä¸²â€çš„èº«ä»½ã€‚è¿™ä¸ªStringTableåœ¨æ¯ä¸ªHotSpot VMçš„å®ä¾‹é‡Œåªæœ‰ä¸€ä»½ï¼Œè¢«æ‰€æœ‰çš„ç±»å…±äº«ã€‚ç±»çš„è¿è¡Œæ—¶å¸¸é‡æ± é‡Œçš„CONSTANT_Stringç±»å‹çš„å¸¸é‡ï¼Œç»è¿‡è§£æï¼ˆresolveï¼‰ä¹‹åï¼ŒåŒæ ·å­˜çš„æ˜¯å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼›è§£æçš„è¿‡ç¨‹ä¼šå»æŸ¥è¯¢StringTableï¼Œä»¥ä¿è¯è¿è¡Œæ—¶å¸¸é‡æ± æ‰€å¼•ç”¨çš„å­—ç¬¦ä¸²ä¸StringTableæ‰€å¼•ç”¨çš„æ˜¯ä¸€è‡´çš„ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ ------Rå¤§åšå®¢&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çŸ¥é“&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;å­—ç¬¦ä¸²å¸¸é‡æ± æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨&lt;/li&gt;
&lt;li&gt;å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­˜å‚¨çš„æ˜¯å­—ç¬¦ä¸²å®ä¾‹çš„å¼•ç”¨&lt;/li&gt;
&lt;li&gt;å­—ç¬¦ä¸²å¸¸é‡æ± åœ¨è¢«æ•´ä¸ªJVMå…±äº«&lt;/li&gt;
&lt;li&gt;åœ¨è§£æè¿è¡Œæ—¶å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ—¶ï¼Œä¼šå»æŸ¥è¯¢å­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œç¡®ä¿è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è§£æåçš„ç›´æ¥å¼•ç”¨è·Ÿå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¼•ç”¨æ˜¯ä¸€è‡´çš„&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;ä¸ºäº†æ›´å¥½ç†è§£ä¸Šé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦å»åˆ†æStringä¸­çš„ä¸€ä¸ªæ–¹æ³•-----&lt;code&gt;intern()&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;internæ–¹æ³•åˆ†æ&quot;&gt;internæ–¹æ³•åˆ†æ&lt;/h3&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;/** 
 * Returns a canonical representation for the string object. 
 * &amp;lt;p&amp;gt; 
 * A pool of strings, initially empty, is maintained privately by the 
 * class &amp;lt;code&amp;gt;String&amp;lt;/code&amp;gt;. 
 * &amp;lt;p&amp;gt; 
 * When the intern method is invoked, if the pool already contains a 
 * string equal to this &amp;lt;code&amp;gt;String&amp;lt;/code&amp;gt; object as determined by 
 * the {@link #equals(Object)} method, then the string from the pool is 
 * returned. Otherwise, this &amp;lt;code&amp;gt;String&amp;lt;/code&amp;gt; object is added to the 
 * pool and a reference to this &amp;lt;code&amp;gt;String&amp;lt;/code&amp;gt; object is returned. 
 * &amp;lt;p&amp;gt; 
 * It follows that for any two strings &amp;lt;code&amp;gt;s&amp;lt;/code&amp;gt; and &amp;lt;code&amp;gt;t&amp;lt;/code&amp;gt;, 
 * &amp;lt;code&amp;gt;s.intern()&amp;amp;nbsp;==&amp;amp;nbsp;t.intern()&amp;lt;/code&amp;gt; is &amp;lt;code&amp;gt;true&amp;lt;/code&amp;gt; 
 * if and only if &amp;lt;code&amp;gt;s.equals(t)&amp;lt;/code&amp;gt; is &amp;lt;code&amp;gt;true&amp;lt;/code&amp;gt;. 
 * &amp;lt;p&amp;gt; 
 * All literal strings and string-valued constant expressions are 
 * interned. String literals are defined in section 3.10.5 of the 
 * &amp;lt;cite&amp;gt;The Java&amp;amp;trade; Language Specification&amp;lt;/cite&amp;gt;. 
 * 
 * @return  a string that has the same contents as this string, but is 
 *          guaranteed to be from a pool of unique strings. 
 */  
public native String intern();  
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;String#intern&lt;/code&gt;æ–¹æ³•ä¸­çœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ª native çš„æ–¹æ³•ï¼Œä½†æ³¨é‡Šå†™çš„éå¸¸æ˜äº†ã€‚â€œå¦‚æœå¸¸é‡æ± ä¸­å­˜åœ¨å½“å‰å­—ç¬¦ä¸², å°±ä¼šç›´æ¥è¿”å›å½“å‰å­—ç¬¦ä¸². å¦‚æœå¸¸é‡æ± ä¸­æ²¡æœ‰æ­¤å­—ç¬¦ä¸², ä¼šå°†æ­¤å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± ä¸­å, å†è¿”å›â€ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºå…¶è¯¦ç»†çš„åˆ†æå¯ä»¥å‚è€ƒï¼šç¾å›¢ï¼š&lt;a href=&quot;https://tech.meituan.com/2014/03/06/in-depth-understanding-string-intern.html&quot;&gt;æ·±å…¥è§£æString#intern&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç ç‰åœ¨å‰ï¼Œæ‰€ä»¥æœ¬æ–‡ç€é‡å°±åˆ†æä¸‹internæ–¹æ³•åœ¨&lt;code&gt;JDK&lt;/code&gt;ä¸åŒç‰ˆæœ¬ä¸‹çš„å·®å¼‚ï¼Œé¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“å¼•èµ·å·®å¼‚çš„åŸå› æ˜¯å› ä¸º&lt;strong&gt;&lt;code&gt;JDK1.7åŠä¹‹å&lt;/code&gt;å°†å­—ç¬¦ä¸²å¸¸é‡æ± ä»æ°¸ä¹…ä»£æŒªåˆ°äº†å †ä¸­ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘è¿™é‡Œå°±ä»¥ç¾å›¢æ–‡ç« ä¸­çš„ç¤ºä¾‹ä»£ç æ¥è¿›è¡Œåˆ†æï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public static void main(String[] args) {
    String s = new String(&quot;1&quot;);
    s.intern();
    String s2 = &quot;1&quot;;
    System.out.println(s == s2);

    String s3 = new String(&quot;1&quot;) + new String(&quot;1&quot;);
    s3.intern();
    String s4 = &quot;11&quot;;
    System.out.println(s3 == s4);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ‰“å°ç»“æœæ˜¯&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;jdk6 ä¸‹&lt;code&gt;false false&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;jdk7 ä¸‹&lt;code&gt;false true&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;åœ¨ç¾å›¢çš„æ–‡ç« ä¸­å·²ç»å¯¹è¿™ä¸ªç»“æœåšäº†è¯¦ç»†çš„è§£é‡Šï¼Œæ¥ä¸‹æ¥æˆ‘å°±ç”¨æˆ‘çš„å›¾è§£æ–¹å¼å†åˆ†æä¸€æ³¢è¿™ä¸ªè¿‡ç¨‹&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;jdk6 æ‰§è¡Œæµç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬ä¸€æ­¥ï¼š&lt;/strong&gt;æ‰§è¡Œ &lt;code&gt;String s = new String(&quot;1&quot;)&lt;/code&gt;ï¼Œè¦æ¸…æ¥šè¿™è¡Œä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¾—ä»å­—èŠ‚ç å…¥æ‰‹ï¼Œè¿™è¡Œä»£ç å¯¹åº”çš„å­—èŠ‚ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;  public static void main(java.lang.String[]);
    Code:
       0: new           #2                  // class java/lang/String
       3: dup
       4: ldc           #3                  // String 1
       6: invokespecial #4                  // Method java/lang/String.&quot;&amp;lt;init&amp;gt;&quot;:(Ljava/lang/String;)V
       9: astore_1
      10: return

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;new&lt;/code&gt; ï¼šåˆ›å»ºäº†ä¸€ä¸ªç±»çš„å®ä¾‹ï¼ˆè¿˜æ²¡æœ‰è°ƒç”¨æ„é€ å™¨å‡½æ•°ï¼‰ï¼Œå¹¶å°†å…¶å¼•ç”¨å‹å…¥æ“ä½œæ•°æ ˆé¡¶&lt;/p&gt;
&lt;p&gt;&lt;code&gt;dup&lt;/code&gt;ï¼šå¤åˆ¶æ ˆé¡¶æ•°å€¼å¹¶å°†å¤åˆ¶å€¼å‹å…¥æ ˆé¡¶ï¼Œè¿™æ˜¯å› ä¸º&lt;code&gt;invokespecial&lt;/code&gt;è·Ÿ&lt;code&gt;astore_1&lt;/code&gt;å„éœ€è¦æ¶ˆè€—ä¸€ä¸ªå¼•ç”¨&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ldc&lt;/code&gt;ï¼šè§£æå¸¸é‡æ± ç¬¦å·å¼•ç”¨ï¼Œå°†å®é™…çš„ç›´æ¥å¼•ç”¨å‹å…¥æ“ä½œæ•°æ ˆé¡¶&lt;/p&gt;
&lt;p&gt;&lt;code&gt;invokespecial&lt;/code&gt;ï¼šå¼¹å‡ºæ­¤æ—¶æ ˆé¡¶çš„å¸¸é‡å¼•ç”¨åŠå¯¹è±¡å¼•ç”¨ï¼Œæ‰§è¡Œ&lt;code&gt;invokespecial&lt;/code&gt;æŒ‡ä»¤ï¼Œè°ƒç”¨æ„é€ å‡½æ•°&lt;/p&gt;
&lt;p&gt;&lt;code&gt;astore_1&lt;/code&gt;ï¼šå°†æ­¤æ—¶æ“ä½œæ•°æ ˆé¡¶çš„å…ƒç´ å¼¹å‡ºï¼Œèµ‹å€¼ç»™å±€éƒ¨å˜é‡è¡¨ä¸­1å·å…ƒç´ ï¼ˆ0å·å…ƒç´ å­˜çš„æ˜¯mainå‡½æ•°çš„å‚æ•°ï¼‰&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µ&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;è§£æå¸¸é‡&lt;/li&gt;
&lt;li&gt;è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡å¹¶è¿”å›å¼•ç”¨&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;åœ¨è§£æå¸¸é‡çš„è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºè¯¥å­—ç¬¦ä¸²å¸¸é‡æ˜¯ç¬¬ä¸€æ¬¡è§£æï¼Œæ‰€ä»¥ä¼šå…ˆåœ¨æ°¸ä¹…ä»£ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å®ä¾‹å¯¹è±¡ï¼Œå¹¶å°†å…¶å¼•ç”¨æ·»åŠ åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚æ­¤æ—¶å†…å­˜çŠ¶æ€å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNzAxNTExOTg4NS5wbmc?x-oss-process=image/format,png&quot; alt=&quot;image-20200617015119885&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å½“çœŸæ­£é€šè¿‡newæ–¹å¼åˆ›å»ºå¯¹è±¡å®Œæˆåï¼Œå¯¹åº”çš„å†…å­˜çŠ¶æ€å¦‚ä¸‹ï¼Œå› ä¸ºåœ¨åˆ†æ&lt;code&gt;classæ–‡ä»¶ä¸­çš„å¸¸é‡æ± &lt;/code&gt;çš„æ—¶å€™å·²ç»å¯¹æ ˆåŒºåšäº†è¯¦ç»†çš„åˆ†æï¼Œæ‰€ä»¥è¿™é‡Œå°±çœç•¥ä¸€äº›ç»†èŠ‚äº†ï¼Œåœ¨æ‰§è¡Œå®Œè¿™è¡Œä»£ç åï¼Œæ ˆåŒºå­˜åœ¨ä¸€ä¸ªå¼•ç”¨ï¼ŒæŒ‡å‘ äº†å †åŒºçš„ä¸€ä¸ªå­—ç¬¦ä¸²å®ä¾‹å†…å­˜çŠ¶æ€å¯¹åº”å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNzAxNTMzMTA0MC5wbmc?x-oss-process=image/format,png&quot; alt=&quot;image-20200617015331040&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬äºŒæ­¥ï¼š&lt;/strong&gt;ç´§æ¥ç€ï¼Œæˆ‘ä»¬è°ƒç”¨äº†sçš„internæ–¹æ³•ï¼Œå¯¹åº”ä»£ç å°±æ˜¯ &lt;code&gt;s.intern()&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å½“internæ–¹æ³•æ‰§è¡Œæ—¶ï¼Œå› ä¸ºæ­¤æ—¶å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨äº†ä¸€ä¸ªå­—é¢é‡ä¿¡æ¯è·Ÿsç›¸åŒçš„å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼Œæ‰€ä»¥æ­¤æ—¶å†…å­˜çŠ¶æ€ä¸ä¼šå‘ç”Ÿä»»ä½•æ”¹å˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬ä¸‰æ­¥ï¼š&lt;/strong&gt;æ‰§è¡Œ&lt;code&gt;String s2 = &quot;1&quot;&lt;/code&gt;,æ­¤æ—¶å› ä¸ºå¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨äº†å­—é¢é‡1çš„å¯¹åº”å­—ç¬¦ä¸²å®ä¾‹çš„å¼•ç”¨ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œå°±ç›´æ¥è¿”å›äº†è¿™ä¸ªå¼•ç”¨å¹¶ä¸”èµ‹å€¼ç»™äº†å±€éƒ¨å˜é‡s2ã€‚å¯¹åº”çš„å†…å­˜çŠ¶æ€å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNzAxNTczODUyMC5wbmc?x-oss-process=image/format,png&quot; alt=&quot;image-20200617015738520&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;åˆ°è¿™é‡Œå°±å¾ˆæ¸…æ™°äº†ï¼Œsè·Ÿs2æŒ‡å‘ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œæ‰€ä»¥s==s2è‚¯å®šæ˜¯falseå˜›~&lt;/p&gt;
&lt;p&gt;å¦‚æœçœ‹è¿‡ç¾å›¢é‚£ç¯‡æ–‡ç« çš„åŒå­¦å¯èƒ½ä¼šæœ‰äº›ç–‘æƒ‘ï¼Œæˆ‘åœ¨å›¾ä¸­å¯¹å¸¸é‡æ± çš„æè¿°è·Ÿç¾å›¢æ–‡ç« å›¾ä¸­ç•¥æœ‰å·®å¼‚ï¼Œåœ¨ç¾å›¢é‚£ç¯‡æ–‡ç« ä¸­ï¼Œç›´æ¥å°†å…·ä½“çš„å­—ç¬¦ä¸²å®ä¾‹æ”¾åˆ°äº†å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œè€Œåœ¨æˆ‘ä¸Šé¢çš„å›¾ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± å­˜çš„æ°¸è¿œæ—¶å¼•ç”¨ï¼Œå®ƒçš„å›¾æ˜¯è¿™æ ·ç”»çš„&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNzAxMDc0NDI1MC5wbmc?x-oss-process=image/format,png&quot; alt=&quot;image-20200617010744250&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å°±æˆ‘æŸ¥é˜…çš„èµ„æ–™è€Œè¨€ï¼Œæˆ‘ä¸ªäººä¸èµåŒè¿™ç§è¯´æ³•ï¼Œå¸¸é‡æ± ä¸­åº”è¯¥ä¿å­˜çš„ä»…ä»…æ˜¯å¼•ç”¨ã€‚å…³äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å·²ç»å‘ç¾å›¢çš„å›¢é˜Ÿè¿›è¡Œäº†ç•™è¨€ï¼Œä¹Ÿè¯·å¤§ä½¬å‡ºæ¥çº é”™ï¼&lt;/p&gt;
&lt;p&gt;æ¥ç€æˆ‘ä»¬åˆ†æs3è·Ÿs4ï¼Œå¯¹åº”çš„å°±æ˜¯è¿™å‡ è¡Œä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;String s3 = new String(&quot;1&quot;) + new String(&quot;1&quot;);
s3.intern();
String s4 = &quot;11&quot;;
System.out.println(s3 == s4);
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æˆ‘ä»¬ä¸€è¡Œè¡Œåˆ†æï¼Œçœ‹çœ‹æ‰§è¡Œå®Œåï¼Œå†…å­˜çš„çŠ¶æ€æ˜¯ä»€ä¹ˆæ ·çš„&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬ä¸€æ­¥ï¼š&lt;/strong&gt;&lt;code&gt;String s3 = new String(&quot;1&quot;) + new String(&quot;1&quot;)&lt;/code&gt;ï¼Œæ‰§è¡Œå®Œæˆåï¼Œå †åŒºå¤šäº†ä¸¤ä¸ªåŒ¿åå¯¹è±¡ï¼Œè¿™ä¸ªæˆ‘ä»¬ä¸ç”¨å¤šå…³æ³¨ï¼Œå¦å¤–å †åŒºè¿˜å¤šäº†ä¸€ä¸ªå­—é¢é‡ä¸º11çš„å­—ç¬¦ä¸²å®ä¾‹ï¼Œå¹¶ä¸”æ ˆä¸­å­˜åœ¨ä¸€ä¸ªå¼•ç”¨æŒ‡å‘è¿™ä¸ªå®ä¾‹&lt;/p&gt;
&lt;p&gt;[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥,æºç«™å¯èƒ½æœ‰é˜²ç›—é“¾æœºåˆ¶,å»ºè®®å°†å›¾ç‰‡ä¿å­˜ä¸‹æ¥ç›´æ¥ä¸Šä¼ (img-NVeeWKoO-1592334452491)(upload\image-20200617020742618.png)]&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Šä¸Šå›¾ä¸­è¿˜å°‘äº†ä¸€ä¸ªåŒ¿åçš„&lt;code&gt;StringBuilder&lt;/code&gt;çš„å¯¹è±¡ï¼Œè¿™æ˜¯å› ä¸ºå½“æˆ‘ä»¬åœ¨è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥æ—¶ï¼Œç¼–è¯‘å™¨é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ª&lt;code&gt;StringBuilder&lt;/code&gt;å¯¹è±¡å¹¶è°ƒç”¨å…¶&lt;code&gt;append&lt;/code&gt;æ–¹æ³•æ¥è¿›è¡Œæ‹¼æ¥ï¼Œæœ€åå†è°ƒç”¨å…¶&lt;code&gt;toString&lt;/code&gt;æ–¹æ³•æ¥è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œ&lt;code&gt;StringBuilder&lt;/code&gt;çš„&lt;code&gt;toString&lt;/code&gt;æ–¹æ³•å…¶å®å°±æ˜¯newä¸€ä¸ªå­—ç¬¦ä¸²&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public String toString() {
    // Create a copy, don't share the array
    return new String(value, 0, count);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨å›¾ä¸­ä¼šè¯´åœ¨å †ä¸Šå¤šäº†ä¸€ä¸ªå­—é¢é‡ä¸º11çš„å­—ç¬¦ä¸²å®ä¾‹çš„åŸå› ï¼Œå› ä¸ºå®é™…ä¸Šå°±æ˜¯newå‡ºæ¥çš„å˜›ï¼&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬äºŒæ­¥ï¼š&lt;/strong&gt;&lt;code&gt;s3.intern()&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è°ƒç”¨&lt;code&gt;intern&lt;/code&gt;æ–¹æ³•åï¼Œå› ä¸ºå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç›®å‰æ²¡æœ‰11è¿™ä¸ªå­—é¢é‡å¯¹åº”çš„å­—ç¬¦ä¸²å®ä¾‹çš„åº”ç”¨ï¼Œæ‰€ä»¥JVMä¼šå…ˆä»å †åŒºå¤åˆ¶ä¸€ä¸ªå­—ç¬¦ä¸²å®ä¾‹åˆ°æ°¸ä¹…ä»£ä¸­ï¼Œå†å°†å…¶å¼•ç”¨æ·»åŠ åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œæœ€ç»ˆçš„å†…å­˜çŠ¶æ€å°±å¦‚ä¸‹æ‰€ç¤º&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNzAyMTQyOTM5My5wbmc?x-oss-process=image/format,png&quot; alt=&quot;image-20200617021429393&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¬¬ä¸‰æ­¥ï¼š&lt;/strong&gt;&lt;code&gt;String s4 = &quot;11&quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¿™åº”è¯¥æ²¡å•¥å¥½è¯´çš„äº†å§ï¼Œå¸¸é‡æ± ä¸­æœ‰äº†ï¼Œç›´æ¥æŒ‡å‘å¯¹åº”çš„å­—ç¬¦ä¸²å®ä¾‹&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNzAyMjMzNzU5Mi5wbmc?x-oss-process=image/format,png&quot; alt=&quot;image-20200617022337592&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;åˆ°è¿™é‡Œå¯ä»¥å‘ç°ï¼Œs3è·Ÿs4æŒ‡å‘çš„æ ¹æœ¬å°±æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œæ‰€ä»¥ä¹Ÿè¿”å›false&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;jdk7 æ‰§è¡Œæµç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨jdk1.7ä¸­ï¼Œsè·Ÿs2çš„æ‰§è¡Œç»“æœè¿˜æ˜¯ä¸€æ ·çš„ï¼Œè¿™æ˜¯å› ä¸º &lt;code&gt;String s = new String(&quot;1&quot;)&lt;/code&gt;è¿™è¡Œä»£ç æœ¬èº«å°±åˆ›å»ºäº†ä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¸€ä¸ªå±äºè¢«å¸¸é‡æ± å¼•ç”¨çš„é©»ç•™å­—ç¬¦ä¸²ï¼Œè€Œå¦å¤–ä¸€ä¸ªåªæ˜¯å †ä¸Šçš„ä¸€ä¸ªæ™®é€šå­—ç¬¦ä¸²å¯¹è±¡ã€‚è·Ÿ1.6çš„åŒºåˆ«åœ¨äºï¼Œ1.7ä¸­çš„é©»ç•™å­—ç¬¦ä¸²ä½äºå †ä¸Šï¼Œè€Œ1.6ä¸­çš„ä½äºæ–¹æ³•åŒºä¸­ï¼Œä½†æ˜¯æœ¬è´¨ä¸Šå®ƒä»¬è¿˜æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œåœ¨ä¸‹é¢ä»£ç æ‰§è¡Œå®Œå&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;    String s = new String(&quot;1&quot;);
    s.intern();
    String s2 = &quot;1&quot;;
    System.out.println(s == s2);
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å†…å­˜çŠ¶æ€ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNzAyMzMwNDg2MC5wbmc?x-oss-process=image/format,png&quot; alt=&quot;image-20200617023304860&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å¯¹äºs3è·Ÿs4ç¡®ä¸åŒäº†ï¼Œå› ä¸ºåœ¨jdk1.7ä¸­ä¸ä¼šå†å»å¤åˆ¶å­—ç¬¦ä¸²å®ä¾‹äº†ï¼Œåœ¨internæ–¹æ³•æ‰§è¡Œæ—¶åœ¨å‘ç°å †ä¸Šæœ‰å¯¹åº”çš„å¯¹è±¡ä¹‹åï¼Œç›´æ¥å°†è¿™ä¸ªå¯¹åº”çš„å¼•ç”¨æ·»åŠ åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œæ‰€ä»¥ä»£ç æ‰§è¡Œå®Œï¼Œå†…å­˜çŠ¶æ€å¯¹åº”å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNzAyMzgzMjc4My5wbmc?x-oss-process=image/format,png&quot; alt=&quot;image-20200617023832783&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°äº†å§ï¼Œs3è·Ÿs4æŒ‡å‘çš„åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ˜¯å› ä¸ºinternæ–¹æ³•æ‰§è¡Œæ—¶ï¼Œç›´æ¥s3è¿™ä¸ªå¼•ç”¨å¤åˆ¶åˆ°äº†å¸¸é‡æ± ï¼Œä¹‹åæ‰§è¡Œ&lt;code&gt;String s4= &quot;11&quot;&lt;/code&gt;çš„æ—¶å€™ï¼Œç›´æ¥å†å°†å¸¸é‡æ± ä¸­çš„å¼•ç”¨å¤åˆ¶ç»™äº†s4ï¼Œæ‰€ä»¥s3==s4è‚¯å®šä¸ºtrueå•¦ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç†è§£äº†å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ä¹‹åï¼Œæˆ‘ä»¬å†æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œå‡è®¾æˆ‘ç°åœ¨å°†ä»£ç æ”¹æˆè¿™ä¸ªæ ·å­ï¼Œé‚£ä¹ˆè¿è¡Œç»“æœæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public static void main(String[] args) {
    String s = new String(&quot;1&quot;);
    String sintern = s.intern();
    String s2 = &quot;1&quot;;
    System.out.println(sintern == s2);

    String s3 = new String(&quot;1&quot;) + new String(&quot;1&quot;);
    String s3intern = s3.intern();
    String s4 = &quot;11&quot;;
    System.out.println(s3intern == s4);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸Šé¢è¿™æ®µä»£ç è¿è¡Œèµ·æ¥ç»“æœä¼šæœ‰å·®å¼‚å—ï¼Ÿå¤§å®¶å¯ä»¥è‡ªè¡Œæ€è€ƒ~&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬å¯¹å­—ç¬¦ä¸²å¸¸é‡æ± æœ‰äº†ä¸€å®šç†è§£ä¹‹åä¼šå‘ç°ï¼Œå…¶å®é€šè¿‡&lt;code&gt;String name = &quot;dmz&quot;&lt;/code&gt;è¿™è¡Œä»£ç ç”³æ˜ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®é™…çš„æ‰§è¡Œé€»è¾‘å°±åƒä¸‹é¢è¿™æ®µä¼ªä»£ç æ‰€ç¤º&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;/**
  * è¿™æ®µä»£ç é€»è¾‘ç±»æ¯”äº
  * &amp;lt;code&amp;gt;String s = &quot;å­—é¢é‡&quot;&amp;lt;/code&amp;gt;;è¿™ç§æ–¹å¼ç”³æ˜ä¸€ä¸ªå­—ç¬¦ä¸²
  * å…¶ä¸­å­—é¢é‡å°±æ˜¯åœ¨&quot;&quot;ä¸­çš„å€¼
  *
  */
public String declareString(å­—é¢é‡) {
    String s;
    // è¿™æ˜¯ä¸€ä¸ªä¼ªæ–¹æ³•ï¼Œæ ‡æ˜ä¼šæ ¹æ®å­—é¢é‡çš„å€¼åˆ°å­—ç¬¦ä¸²å€¼ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å¯¹åº”Stringå®ä¾‹çš„å¼•ç”¨
    s = findInStringTable(å­—é¢é‡);
    // è¯´æ˜å­—ç¬¦ä¸²æ± ä¸­å·²ç»å­˜åœ¨äº†è¿™ä¸ªå¼•ç”¨ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›
    if (s != null) {
        return s;
    }
    // ä¸å­˜åœ¨è¿™ä¸ªå¼•ç”¨ï¼Œéœ€è¦æ–°å»ºä¸€ä¸ªå­—ç¬¦ä¸²å®ä¾‹ï¼Œç„¶åè°ƒç”¨å…¶internæ–¹æ³•å°†å…¶æ‹˜ç•™åˆ°å­—ç¬¦ä¸²æ± ä¸­ï¼Œ
    // æœ€åè¿”å›è¿™ä¸ªæ–°å»ºå­—ç¬¦ä¸²çš„å¼•ç”¨
    s = new String(å­—é¢é‡);
    // è°ƒç”¨internæ–¹æ³•ï¼Œå°†åˆ›å»ºå¥½çš„å­—ç¬¦ä¸²æ”¾å…¥åˆ°StringTableä¸­,
    // ç±»ä¼¼å°±æ˜¯è°ƒç”¨StringTable.add(s)è¿™ä¹Ÿçš„ä¸€ä¸ªä¼ªæ–¹æ³•
    s.intern();
    return s;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æŒ‰ç…§è¿™ä¸ªé€»è¾‘ï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬å°†ä¸Šé¢æ€è€ƒé¢˜ä¸­çš„æ‰€æœ‰å­—é¢é‡è¿›è¡Œæ›¿æ¢ï¼Œä¼šå‘ç°ä¸ç®¡åœ¨å“ªä¸ªç‰ˆæœ¬ä¸­ç»“æœéƒ½åº”è¯¥è¿”å›trueã€‚&lt;/p&gt;
&lt;h2 id=&quot;è¿è¡Œæ—¶å¸¸é‡æ± &quot;&gt;è¿è¡Œæ—¶å¸¸é‡æ± &lt;/h2&gt;
&lt;h3 id=&quot;ä½ç½®åœ¨å“ªï¼Ÿ-3&quot;&gt;ä½ç½®åœ¨å“ªï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä½äºæ–¹æ³•åŒºä¸­ï¼Œ1.6åœ¨æ°¸ä¹…ä»£ï¼Œ1.7åœ¨å…ƒç©ºé—´ä¸­ï¼Œæ°¸ä¹…ä»£è·Ÿå…ƒç©ºé—´éƒ½æ˜¯å¯¹æ–¹æ³•åŒºçš„å®ç°&lt;/p&gt;
&lt;h3 id=&quot;ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ&quot;&gt;ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ&lt;/h3&gt;
&lt;p&gt;jvmåœ¨æ‰§è¡ŒæŸä¸ªç±»çš„æ—¶å€™ï¼Œå¿…é¡»ç»è¿‡&lt;strong&gt;åŠ è½½ã€è¿æ¥ã€åˆå§‹åŒ–&lt;/strong&gt;ï¼Œè€Œè¿æ¥åˆåŒ…æ‹¬éªŒè¯# ä½ç½®åœ¨å“ªï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä½äºæ–¹æ³•åŒºä¸­ï¼Œ1.6åœ¨æ°¸ä¹…ä»£ï¼Œ1.7åœ¨å…ƒç©ºé—´ä¸­ï¼Œæ°¸ä¹…ä»£è·Ÿå…ƒç©ºé—´éƒ½æ˜¯å¯¹æ–¹æ³•åŒºçš„å®ç°&lt;/p&gt;
&lt;h2 id=&quot;ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ-2&quot;&gt;ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ&lt;/h2&gt;
&lt;p&gt;jvmåœ¨æ‰§è¡ŒæŸä¸ªç±»çš„æ—¶å€™ï¼Œå¿…é¡»ç»è¿‡&lt;strong&gt;åŠ è½½ã€è¿æ¥ã€åˆå§‹åŒ–&lt;/strong&gt;ï¼Œè€Œè¿æ¥åˆåŒ…æ‹¬éªŒè¯ã€å‡†å¤‡ã€è§£æä¸‰ä¸ªé˜¶æ®µã€‚è€Œå½“ç±»åŠ è½½åˆ°å†…å­˜ä¸­åï¼Œ&lt;strong&gt;jvmå°±ä¼šå°†classå¸¸é‡æ± ä¸­çš„å†…å®¹å­˜æ”¾åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­&lt;/strong&gt;ï¼Œç”±æ­¤å¯çŸ¥ï¼Œ&lt;strong&gt;è¿è¡Œæ—¶å¸¸é‡æ± ä¹Ÿæ˜¯æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª&lt;/strong&gt;ã€‚åœ¨ä¸Šé¢æˆ‘ä¹Ÿè¯´äº†ï¼Œclasså¸¸é‡æ± ä¸­å­˜çš„æ˜¯å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–ä»¬å­˜çš„å¹¶ä¸æ˜¯å¯¹è±¡çš„å®ä¾‹ï¼Œè€Œæ˜¯å¯¹è±¡çš„ç¬¦å·å¼•ç”¨å€¼ã€‚è€Œç»è¿‡è§£æï¼ˆresolveï¼‰ä¹‹åï¼Œä¹Ÿå°±æ˜¯æŠŠç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œ&lt;strong&gt;è§£æçš„è¿‡ç¨‹ä¼šå»æŸ¥è¯¢å…¨å±€å­—ç¬¦ä¸²æ± ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„&lt;code&gt;StringTable&lt;/code&gt;ï¼Œä»¥ä¿è¯è¿è¡Œæ—¶å¸¸é‡æ± æ‰€å¼•ç”¨çš„å­—ç¬¦ä¸²ä¸å…¨å±€å­—ç¬¦ä¸²æ± ä¸­æ‰€å¼•ç”¨çš„æ˜¯ä¸€è‡´çš„&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ç®€å•æ¥è¯´ï¼Œ&lt;strong&gt;è¿è¡Œæ—¶å¸¸é‡æ± å°±æ˜¯ç”¨æ¥å­˜æ”¾classå¸¸é‡æ± ä¸­çš„å†…å®¹çš„ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å°†ä¸‰è€…è¿›è¡Œä¸€ä¸ªæ¯”è¾ƒ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci9pbWFnZS0yMDIwMDYxNzAyNTcyMTU4Ni5wbmc?x-oss-process=image/format,png&quot; alt=&quot;image-20200617025721586&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;// ç¯å¢ƒ1.7åŠä»¥ä¸Š
public class Clazz {
    public static void main(String[] args) {
        String s1 = new StringBuilder().append(&quot;ja&quot;).append(&quot;va1&quot;).toString();
        String s2 = s1.intern();
        System.out.println(s1==s2);
        
        String s5 = &quot;dmz&quot;;
        String s3 = new StringBuilder().append(&quot;d&quot;).append(&quot;mz&quot;).toString();
        String s4 = s3.intern();
        System.out.println(s3 == s4);

        String s7 = new StringBuilder().append(&quot;s&quot;).append(&quot;pring&quot;).toString();
        String s8 = s7.intern();
        String s6 = &quot;spring&quot;;
        System.out.println(s7 == s8);
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç­”æ¡ˆæ˜¯true,false,trueã€‚å¤§å®¶å¯ä»¥ä»”ç»†æ€è€ƒä¸ºä»€ä¹ˆï¼Œå¦‚æœ‰ç–‘æƒ‘å¯ä»¥ç»™æˆ‘ç•™è¨€ï¼Œæˆ–è€…è¿›ç¾¤äº¤æµï¼&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œè®°å¾—ç‚¹ä¸ªèµå§ï¼ä¹Ÿæ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼Œå¾®ä¿¡æœç´¢ï¼šç¨‹åºå‘˜DMZï¼Œæˆ–è€…æ‰«æä¸‹æ–¹äºŒç»´ç ï¼Œè·Ÿç€æˆ‘ä¸€èµ·è®¤è®¤çœŸçœŸå­¦Java,è¸è¸å®å®åšä¸€ä¸ªcoderã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9naXRlZS5jb20vd3hfY2MzNDdiZTY5Ni9ibG9nSW1hZ2UvcmF3L21hc3Rlci8lRTUlODUlQUMlRTQlQkMlOTclRTUlOEYlQjcuanBn?x-oss-process=image/format,png&quot; alt=&quot;å…¬ä¼—å·&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘å«DMZï¼Œä¸€ä¸ªåœ¨å­¦ä¹ è·¯ä¸ŠåŒåŒå‰è¡Œçš„å°èœé¸Ÿï¼&lt;/p&gt;
&lt;p&gt;å‚è€ƒæ–‡ç« ï¼š&lt;/p&gt;
&lt;p&gt;Rå¤§åšæ–‡ï¼š&lt;a href=&quot;https://www.iteye.com/blog/rednaxelafx-774673&quot;&gt;è¯·åˆ«å†æ‹¿â€œString s = new String(&quot;xyz&quot;);åˆ›å»ºäº†å¤šå°‘ä¸ªStringå®ä¾‹â€æ¥é¢è¯•äº†å§&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Rå¤§çŸ¥ä¹å›ç­”ï¼š&lt;a href=&quot;https://www.zhihu.com/question/57109429/answer/151717241&quot;&gt;JVM å¸¸é‡æ± ä¸­å­˜å‚¨çš„æ˜¯å¯¹è±¡è¿˜æ˜¯å¼•ç”¨å‘¢ï¼Ÿ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://tangxman.github.io/2015/07/27/the-difference-of-java-string-pool/&quot;&gt;Javaä¸­å‡ ç§å¸¸é‡æ± çš„åŒºåˆ†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.jianshu.com/p/1b61feb2e336&quot;&gt;æ–¹æ³•åŒºï¼Œæ°¸ä¹…ä»£å’Œå…ƒç©ºé—´&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç¾å›¢ï¼š&lt;a href=&quot;https://tech.meituan.com/2014/03/06/in-depth-understanding-string-intern.html&quot;&gt;æ·±å…¥è§£æString#intern&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å‚è€ƒä¹¦ç±ï¼š&lt;/p&gt;
&lt;p&gt;ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ç¬¬äºŒç‰ˆ&lt;/p&gt;
&lt;p&gt;ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ç¬¬ä¸‰ç‰ˆ&lt;/p&gt;
&lt;p&gt;ã€ŠJavaè™šæ‹Ÿæœºè§„èŒƒã€‹&lt;/p&gt;
</description>
<pubDate>Tue, 16 Jun 2020 19:10:00 +0000</pubDate>
<dc:creator>ç¨‹åºå‘˜DMZ</dc:creator>
<og:description>ä»ä¸€é“é¢è¯•é¢˜å¼€å§‹ çœ‹åˆ°è¿™ä¸ªæ ‡é¢˜ï¼Œä½ è‚¯å®šä»¥ä¸ºæˆ‘åˆè¦è®²è¿™é“é¢è¯•é¢˜äº† // è¿™è¡Œä»£ç åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ String s3 = new String(&amp;amp;quot;1&amp;amp;quot;); æ˜¯çš„ï¼Œæ²¡é”™</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/daimzh/p/13150192.html</dc:identifier>
</item>
</channel>
</rss>