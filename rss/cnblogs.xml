<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>åšå®¢å›­_é¦–é¡µ</title>
<link></link>
<description>ä»£ç æ”¹å˜ä¸–ç•Œ</description>
<item>
<title>Javaï¼Œä½ å‘Šè¯‰æˆ‘ fail-fast æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ - æ²‰é»˜ç‹äºŒ</title>
<link>http://www.cnblogs.com/qing-gee/p/11909576.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/qing-gee/p/11909576.html</guid>
<description>&lt;p&gt;æœ¬ç¯‡æˆ‘ä»¬æ¥èŠèŠ Java çš„ fail-fast æœºåˆ¶ï¼Œæ–‡å­—ä¸€å¦‚æ—¢å¾€çš„æœ‰è¶£å“¦ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å‰è¨€&quot;&gt;01ã€å‰è¨€&lt;/h3&gt;
&lt;p&gt;è¯´èµ·æ¥çœŸç‰¹ä¹ˆæƒ­æ„§ï¼šåå¹´ IT è€å…µï¼ŒJava èœé¸Ÿä¸€æšã€‚ä»Šå¤©æˆ‘æ‰äº†è§£åˆ° Java è¿˜æœ‰ fail-fast ä¸€è¯´ã€‚ä¸å¾—ä¸æ„Ÿæ…¨å•Šï¼Œå­¦ä¹ çœŸçš„æ˜¯æ²¡æœ‰æ­¢å¢ƒã€‚åªè¦è‚¯å­¦ï¼Œå°±ä¼šæœ‰å·¨å¤šå·¨å¤šåˆ«äººçœ¼ä¸­çš„â€œæ—§â€çŸ¥è¯†æ¶Œç°å‡ºæ¥ï¼Œå¹¶ä¸”åœ¨æˆ‘è¿™å…¨æ˜¯æ–°çš„ã€‚&lt;/p&gt;
&lt;p&gt;èƒ½æ€ä¹ˆåŠå‘¢ï¼Ÿé™¤äº†ç¾æ„§ï¼Œå°±åªèƒ½èµ¶ç´§å…¨èº«å¿ƒåœ°æŠ•å…¥å­¦ä¹ ï¼ŒæŠŠè¿™äº›çŸ¥è¯†æŒæ¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é•‡æ¥¼ï¼Œå¿…é¡»æ¬ä¸€æ®µè‹±æ–‡æ¥è§£é‡Šä¸€ä¸‹ fail-fastã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;11&quot;&gt;
&lt;p&gt;In systems design, a fail-fast system is one which immediately reports at its interface any condition that is likely to indicate a failure. Fail-fast systems are usually designed to stop normal operation rather than attempt to continue a possibly flawed process. Such designs often check the system's state at several points in an operation, so any failures can be detected early. The responsibility of a fail-fast module is detecting errors, then letting the next-highest level of the system handle them.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¤§å®¶ä¸å«Œå¼ƒçš„è¯ï¼Œæˆ‘å°±ç”¨è¹©è„šçš„è‹±è¯­èƒ½åŠ›ç¿»è¯‘ä¸€ä¸‹ã€‚æŸåœºæˆ˜å½¹å½“ä¸­ï¼Œæ”¿å§”å‘ç°å¸ä»¤å‘˜åœ¨ä¹±æŒ‡æŒ¥çš„è¯ï¼Œå°±ç«‹é©¬æŠ¥å‘Šç»™æƒé™æ›´é«˜çš„ä¸­å¤®å†›å§”â€”â€”è¿™æ ·å¯ä»¥æœ‰æ•ˆåœ°é¿å…æ›´ä¸¥é‡çš„åæœå‡ºç°ã€‚å½“ç„¶äº†ï¼Œå¦‚æœå¸ä»¤å‘˜æ˜¯æäº‘é¾™çš„è¯ï¼ŒæŠ¥å‘Šä¹Ÿæ²¡å•¥ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡ï¼ŒJava çš„ä¸–ç•Œé‡Œä¸å­˜åœ¨æäº‘é¾™ã€‚fail-fast æ‰®æ¼”çš„å°±æ˜¯æ”¿å§”çš„è§’è‰²ï¼Œä¸€æ—¦æŠ¥å‘Šç»™ä¸Šçº§ï¼Œåé¢çš„è¡ŒåŠ¨å°±åˆ«æƒ³æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;æ€ä¹ˆå’Œä»£ç å…³è”èµ·æ¥å‘¢ï¼Ÿçœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public void test(Wanger wanger) {   
    if (wanger == null) {
        throw new RuntimeException(&quot;wanger ä¸èƒ½ä¸ºç©º&quot;);
    }
    
    System.out.println(wanger.toString());
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸€æ—¦æ£€æµ‹åˆ° wanger ä¸º nullï¼Œå°±ç«‹é©¬æŠ›å‡ºå¼‚å¸¸ï¼Œè®©è°ƒç”¨è€…æ¥å†³å®šè¿™ç§æƒ…å†µä¸‹è¯¥æ€ä¹ˆå¤„ç†ï¼Œä¸‹ä¸€æ­¥ &lt;code&gt;wanger.toString()&lt;/code&gt; å°±ä¸ä¼šæ‰§è¡Œäº†â€”â€”é¿å…æ›´ä¸¥é‡çš„é”™è¯¯å‡ºç°ï¼Œè¿™æ®µä»£ç ç”±äºå¤ªè¿‡ç®€å•ï¼Œä½“ç°ä¸å‡ºæ¥ï¼Œåé¢ä¼šè®²åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;ç§ï¼Œfail-fast å°±æ˜¯è¿™ä¸ªé¬¼ï¼Œæ²¡ä»€ä¹ˆç¥ç§˜çš„ã€‚å¦‚æœå¤§å®¶æºç çœ‹å¾—æ¯”è¾ƒå¤šçš„è¯ï¼Œè¿™ç§ä¾‹å­å¤šå¾—å°±åƒæ—…æ¸¸é«˜å³°æœŸçš„äººå¤´ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åå‘¢ï¼Œæ²¡äº†ï¼Ÿä¸‰ç§’é’Ÿï¼Œåˆ«ç€æ€¥ï¼Œæˆ‘ä»¬ç»§ç»­ã€‚&lt;/p&gt;
&lt;h3 id=&quot;for-each-ä¸­é›†åˆçš„-remove-æ“ä½œ&quot;&gt;02ã€for each ä¸­é›†åˆçš„ remove æ“ä½œ&lt;/h3&gt;
&lt;p&gt;å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œ&lt;a href=&quot;https://mp.weixin.qq.com/s/feoOINGSyivBO8Z1gaQVOA&quot;&gt;æˆ‘&lt;/a&gt;éƒ½ä¸æ˜ç™½ä¸ºä»€ä¹ˆä¸èƒ½åœ¨ &lt;code&gt;for each&lt;/code&gt; å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ removeã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥å€Ÿæœºæ¥ä½“éªŒä¸€æŠŠã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;List&amp;lt;String&amp;gt; list = new ArrayList&amp;lt;&amp;gt;();
list.add(&quot;æ²‰é»˜ç‹äºŒ&quot;);
list.add(&quot;æ²‰é»˜ç‹ä¸‰&quot;);
list.add(&quot;ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜&quot;);

for (String str : list) {
    if (&quot;æ²‰é»˜ç‹äºŒ&quot;.equals(str)) {
        list.remove(str);
    }
}

System.out.println(list);&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™æ®µä»£ç çœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†è¿è¡Œèµ·æ¥å°±ç³Ÿç³•äº†ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Exception in thread &quot;main&quot; java.util.ConcurrentModificationException
    at java.util.ArrayList$Itr.checkForComodification(ArrayList.java:909)
    at java.util.ArrayList$Itr.next(ArrayList.java:859)
    at com.cmower.java_demo.str.Cmower3.main(Cmower3.java:14)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸ºæ¯›å‘¢ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&quot;åˆ†æé—®é¢˜çš„æ€æ‰‹é”&quot;&gt;03ã€åˆ†æé—®é¢˜çš„æ€æ‰‹é”&lt;/h3&gt;
&lt;p&gt;è¿™æ—¶å€™å°±åªèƒ½çœ‹æºç äº†ï¼ŒArrayList.java çš„ 909 è¡Œä»£ç æ˜¯è¿™æ ·çš„ã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;final void checkForComodification() {
    if (modCount != expectedModCount)
        throw new ConcurrentModificationException();
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œremove çš„æ—¶å€™æ‰§è¡Œäº† &lt;code&gt;checkForComodification&lt;/code&gt; æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯¹ modCount å’Œ expectedModCount è¿›è¡Œäº†æ¯”è¾ƒï¼Œå‘ç°ä¸¤è€…ä¸ç­‰ï¼Œå°±æŠ›å‡ºäº† &lt;code&gt;ConcurrentModificationException&lt;/code&gt; å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä¸ºä»€ä¹ˆä¼šæ‰§è¡Œ &lt;code&gt;checkForComodification&lt;/code&gt; æ–¹æ³•å‘¢ï¼Ÿè¿™å°±éœ€è¦åç¼–è¯‘ä¸€ä¸‹ &lt;code&gt;for each&lt;/code&gt; é‚£æ®µä»£ç äº†ã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;List&amp;lt;String&amp;gt; list = new ArrayList();
list.add(&quot;æ²‰é»˜ç‹äºŒ&quot;);
list.add(&quot;æ²‰é»˜ç‹ä¸‰&quot;);
list.add(&quot;ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜&quot;);
Iterator var3 = list.iterator();

while (var3.hasNext()) {
    String str = (String) var3.next();
    if (&quot;æ²‰é»˜ç‹äºŒ&quot;.equals(str)) {
        list.remove(str);
    }
}

System.out.println(list);&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åŸæ¥ &lt;code&gt;for each&lt;/code&gt; æ˜¯é€šè¿‡è¿­ä»£å™¨ Iterator é…åˆ while å¾ªç¯å®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;1ï¼‰&lt;code&gt;ArrayList.iterator()&lt;/code&gt; è¿”å›çš„ Iterator å…¶å®æ˜¯ ArrayList çš„ä¸€ä¸ªå†…éƒ¨ç±» Itrã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public Iterator&amp;lt;E&amp;gt; iterator() {
    return new Itr();
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Itr å®ç°äº† Iterator æ¥å£ã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;private class Itr implements Iterator&amp;lt;E&amp;gt; {
    int cursor;       // index of next element to return
    int lastRet = -1; // index of last element returned; -1 if no such
    int expectedModCount = modCount;

    Itr() {}

    public boolean hasNext() {
        return cursor != size;
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public E next() {
        checkForComodification();
        int i = cursor;
        Object[] elementData = ArrayList.this.elementData;
        if (i &amp;gt;= elementData.length)
            throw new ConcurrentModificationException();
        cursor = i + 1;
        return (E) elementData[lastRet = i];
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ &lt;code&gt;new Itr()&lt;/code&gt; çš„æ—¶å€™ expectedModCount è¢«èµ‹å€¼ä¸º modCountï¼Œè€Œ modCount æ˜¯ List çš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œè¡¨ç¤ºé›†åˆè¢«ä¿®æ”¹çš„æ¬¡æ•°ã€‚ç”±äº list æ­¤å‰æ‰§è¡Œäº† 3 æ¬¡ add æ–¹æ³•ï¼Œæ‰€ä»¥ modCount çš„å€¼ä¸º 3ï¼›expectedModCount çš„å€¼ä¹Ÿä¸º 3ã€‚&lt;/p&gt;
&lt;p&gt;å¯å½“æ‰§è¡Œ &lt;code&gt;list.remove(str)&lt;/code&gt; åï¼ŒmodCount çš„å€¼å˜æˆäº† 4ã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;private void fastRemove(int index) {
    modCount++;
    int numMoved = size - index - 1;
    if (numMoved &amp;gt; 0)
        System.arraycopy(elementData, index+1, elementData, index,
                         numMoved);
    elementData[--size] = null; // clear to let GC do its work
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ³¨ï¼šremove æ–¹æ³•å†…éƒ¨è°ƒç”¨äº† fastRemove æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹ä¸€æ¬¡å¾ªç¯æ‰§è¡Œåˆ° &lt;code&gt;String str = (String) var3.next();&lt;/code&gt; çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨ &lt;code&gt;checkForComodification&lt;/code&gt; æ–¹æ³•ï¼Œæ­¤æ—¶ä¸€ä¸ªä¸º 3ï¼Œä¸€ä¸ªä¸º 4ï¼Œå°±åªå¥½æŠ›å‡ºå¼‚å¸¸ ConcurrentModificationException äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ä¿¡ï¼Œå¯ä»¥ç›´æ¥åœ¨ ArrayList ç±»çš„ 909 è¡Œæ‰“ä¸ªæ–­ç‚¹ debug ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.itwanger.com/assets/images/2019/11/java-fail-fast-1.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;çœŸçš„è€¶ï¼Œä¸€ä¸ªæ˜¯ 4 ä¸€ä¸ªæ˜¯ 3ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ€»ç»“ä¸€ä¸‹&lt;/strong&gt;ã€‚åœ¨ &lt;code&gt;for each&lt;/code&gt; å¾ªç¯ä¸­ï¼Œé›†åˆéå†å…¶å®æ˜¯é€šè¿‡è¿­ä»£å™¨ Iterator é…åˆ while å¾ªç¯å®ç°çš„ï¼Œä½†æ˜¯å…ƒç´ çš„ remove å´ç›´æ¥ä½¿ç”¨çš„é›†åˆç±»è‡ªèº«çš„æ–¹æ³•ã€‚è¿™å°±å¯¼è‡´ Iterator åœ¨éå†çš„æ—¶å€™ï¼Œä¼šå‘ç°å…ƒç´ åœ¨è‡ªå·±ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¢«ä¿®æ”¹äº†ï¼Œå®ƒè§‰å¾—å¾ˆéš¾æ¥å—ï¼Œå°±æŠ›å‡ºäº†å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;è¯»è€…æœ‹å‹ä»¬ï¼Œä½ ä»¬æ˜¯ä¸æ˜¯è§‰å¾—æˆ‘è·‘é¢˜äº†ï¼Œfail-fast å’Œ &lt;code&gt;for each&lt;/code&gt; ä¸­é›†åˆçš„ remove æ“ä½œæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æœ‰ï¼Iterator ä½¿ç”¨äº† fail-fast çš„ä¿æŠ¤æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ€ä¹ˆé¿å¼€-fail-fast-ä¿æŠ¤æœºåˆ¶å‘¢&quot;&gt;04ã€æ€ä¹ˆé¿å¼€ fail-fast ä¿æŠ¤æœºåˆ¶å‘¢&lt;/h3&gt;
&lt;p&gt;é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œç›¸ä¿¡å¤§å®¶éƒ½æ˜ç™½ä¸ºä»€ä¹ˆä¸èƒ½åœ¨ &lt;code&gt;for each&lt;/code&gt; å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ remove äº†ã€‚&lt;/p&gt;
&lt;p&gt;é‚£æ€ä¹ˆé¿å¼€ fail-fast ä¿æŠ¤æœºåˆ¶å‘¢ï¼Ÿæ¯•ç«Ÿåˆ é™¤å…ƒç´ æ˜¯å¸¸è§„æ“ä½œï¼Œå’±ä¸èƒ½å› å™åºŸé£Ÿå•Šã€‚&lt;/p&gt;
&lt;p&gt;1ï¼‰remove å break&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;List&amp;lt;String&amp;gt; list = new ArrayList&amp;lt;&amp;gt;();
list.add(&quot;æ²‰é»˜ç‹äºŒ&quot;);
list.add(&quot;æ²‰é»˜ç‹ä¸‰&quot;);
list.add(&quot;ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜&quot;);

for (String str : list) {
    if (&quot;æ²‰é»˜ç‹äºŒ&quot;.equals(str)) {
        list.remove(str);
        break;
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æˆ‘æ€ä¹ˆè¿™ä¹ˆèªæ˜ï¼Œå¿ä¸ä½éª„å‚²ä¸€ä¸‹ã€‚æœ‰è¯»è€…ä¸æ˜ç™½ä¸ºä»€ä¹ˆå—ï¼Ÿé‚£æˆ‘ä¸Šé¢çš„æºç åˆ†æå¯å°±ç™½åˆ†æäº†ï¼Œçˆ¬æ¥¼å†çœ‹ä¸€éå§ï¼&lt;/p&gt;
&lt;p&gt;ç•¥å¾®é€éœ²ä¸€ä¸‹åŸå› ï¼šbreak åå¾ªç¯å°±ä¸å†éå†äº†ï¼Œæ„å‘³ç€ Iterator çš„ next æ–¹æ³•ä¸å†æ‰§è¡Œäº†ï¼Œä¹Ÿå°±æ„å‘³ç€ &lt;code&gt;checkForComodification&lt;/code&gt; æ–¹æ³•ä¸å†æ‰§è¡Œäº†ï¼Œæ‰€ä»¥å¼‚å¸¸ä¹Ÿå°±ä¸ä¼šæŠ›å‡ºäº†ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å‘¢ï¼Œå½“ List ä¸­æœ‰é‡å¤å…ƒç´ è¦åˆ é™¤çš„æ—¶å€™ï¼Œbreak å°±ä¸åˆé€‚äº†ã€‚&lt;/p&gt;
&lt;p&gt;2ï¼‰for å¾ªç¯&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;List&amp;lt;String&amp;gt; list = new ArrayList&amp;lt;&amp;gt;();
list.add(&quot;æ²‰é»˜ç‹äºŒ&quot;);
list.add(&quot;æ²‰é»˜ç‹ä¸‰&quot;);
list.add(&quot;ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜&quot;);
for (int i = 0, n = list.size(); i &amp;lt; n; i++) {
    String str = list.get(i);
    if (&quot;æ²‰é»˜ç‹äºŒ&quot;.equals(str)) {
        list.remove(str);
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;for å¾ªç¯è™½ç„¶å¯ä»¥é¿å¼€ fail-fast ä¿æŠ¤æœºåˆ¶ï¼Œä¹Ÿå°±è¯´ remove å…ƒç´ åä¸å†æŠ›å‡ºå¼‚å¸¸ï¼›ä½†æ˜¯å‘¢ï¼Œè¿™æ®µç¨‹åºåœ¨åŸåˆ™ä¸Šæ˜¯æœ‰é—®é¢˜çš„ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ¬¡å¾ªç¯çš„æ—¶å€™ï¼Œi ä¸º 0ï¼Œ&lt;code&gt;list.size()&lt;/code&gt; ä¸º 3ï¼Œå½“æ‰§è¡Œå®Œ remove æ–¹æ³•åï¼Œi ä¸º 1ï¼Œ&lt;code&gt;list.size()&lt;/code&gt; å´å˜æˆäº† 2ï¼Œå› ä¸º list çš„å¤§å°åœ¨ remove åå‘ç”Ÿäº†å˜åŒ–ï¼Œä¹Ÿå°±æ„å‘³ç€â€œæ²‰é»˜ç‹ä¸‰â€è¿™ä¸ªå…ƒç´ è¢«è·³è¿‡äº†ã€‚èƒ½æ˜ç™½å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;remove ä¹‹å‰ &lt;code&gt;list.get(1)&lt;/code&gt; ä¸ºâ€œæ²‰é»˜ç‹ä¸‰â€ï¼›ä½† remove ä¹‹å &lt;code&gt;list.get(1)&lt;/code&gt; å˜æˆäº†â€œä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜â€ï¼Œè€Œ &lt;code&gt;list.get(0)&lt;/code&gt; å˜æˆäº†â€œæ²‰é»˜ç‹ä¸‰â€ã€‚&lt;/p&gt;
&lt;p&gt;3ï¼‰Iterator&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;List&amp;lt;String&amp;gt; list = new ArrayList&amp;lt;&amp;gt;();
list.add(&quot;æ²‰é»˜ç‹äºŒ&quot;);
list.add(&quot;æ²‰é»˜ç‹ä¸‰&quot;);
list.add(&quot;ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜&quot;);

Iterator&amp;lt;String&amp;gt; itr = list.iterator();

while (itr.hasNext()) {
    String str = itr.next();
    if (&quot;æ²‰é»˜ç‹äºŒ&quot;.equals(str)) {
        itr.remove();
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆä½¿ç”¨ Iterator çš„ remove æ–¹æ³•å°±å¯ä»¥é¿å¼€ fail-fast ä¿æŠ¤æœºåˆ¶å‘¢ï¼Ÿçœ‹ä¸€ä¸‹ remove çš„æºç å°±æ˜ç™½äº†ã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public void remove() {
    if (lastRet &amp;lt; 0)
        throw new IllegalStateException();
    checkForComodification();

    try {
        ArrayList.this.remove(lastRet);
        cursor = lastRet;
        lastRet = -1;
        expectedModCount = modCount;
    } catch (IndexOutOfBoundsException ex) {
        throw new ConcurrentModificationException();
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è™½ç„¶åˆ é™¤å…ƒç´ ä¾ç„¶ä½¿ç”¨çš„æ˜¯ ArrayList çš„ remove æ–¹æ³•ï¼Œä½†æ˜¯åˆ é™¤å®Œä¼šæ‰§è¡Œ &lt;code&gt;expectedModCount = modCount&lt;/code&gt;ï¼Œä¿è¯äº† expectedModCount ä¸ modCount çš„åŒæ­¥ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æœ€å&quot;&gt;05ã€æœ€å&lt;/h3&gt;
&lt;p&gt;åœ¨ Java ä¸­ï¼Œfail-fast ä»ç‹­ä¹‰ä¸Šè®²æ˜¯é’ˆå¯¹å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„é›†åˆè¿­ä»£å™¨è€Œè¨€çš„ã€‚è¿™ä¸€ç‚¹å¯ä»¥ä» &lt;code&gt;ConcurrentModificationException&lt;/code&gt; å®šä¹‰ä¸Šçœ‹å¾—å‡ºæ¥ã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;16&quot;&gt;
&lt;p&gt;This exception may be thrown by methods that have detected concurrent&lt;br/&gt;modification of an object when such modification is not permissible.&lt;/p&gt;&lt;p&gt;For example, it is not generally permissible for one thread to modify a Collectionwhile another thread is iterating over it. In general, the results of theiteration are undefined under these circumstances. Some Iteratorimplementations (including those of all the general purpose collection implementationsprovided by the JRE) may choose to throw this exception if this behavior isdetected. Iterators that do this are known as fail-fast iterators,as they fail quickly and cleanly, rather that risking arbitrary,non-deterministic behavior at an undetermined time in the future.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å†æ¬¡æ‹™åŠ£åœ°ç¿»è¯‘ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥å¼‚å¸¸å¯èƒ½ç”±äºæ£€æµ‹åˆ°å¯¹è±¡åœ¨å¹¶å‘æƒ…å†µä¸‹è¢«ä¿®æ”¹è€ŒæŠ›å‡ºçš„ï¼Œè€Œè¿™ç§ä¿®æ”¹æ˜¯ä¸å…è®¸çš„ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸ï¼Œè¿™ç§æ“ä½œæ˜¯ä¸å…è®¸çš„ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªçº¿ç¨‹åœ¨ä¿®æ”¹é›†åˆï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹åœ¨è¿­ä»£å®ƒã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè¿­ä»£çš„ç»“æœæ˜¯ä¸ç¡®å®šçš„ã€‚å¦‚æœæ£€æµ‹åˆ°è¿™ç§è¡Œä¸ºï¼Œä¸€äº› Iteratorï¼ˆæ¯”å¦‚è¯´ ArrayList çš„å†…éƒ¨ç±» Itrï¼‰å°±ä¼šé€‰æ‹©æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚è¿™æ ·çš„è¿­ä»£å™¨è¢«ç§°ä¸º fail-fast è¿­ä»£å™¨ï¼Œå› ä¸ºå°½æ—©çš„å¤±è´¥æ¯”æœªæ¥å‡ºç°ä¸ç¡®å®šçš„é£é™©æ›´å¥½ã€‚&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶æ˜¯é’ˆå¯¹å¤šçº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¹‹å‰çš„åˆ†æéƒ½æ˜¯åŸºäºå•çº¿ç¨‹çš„å‘¢ï¼Ÿå› ä¸ºä»å¹¿ä¹‰ä¸Šè®²ï¼Œfail-fast æŒ‡çš„æ˜¯å½“æœ‰å¼‚å¸¸æˆ–è€…é”™è¯¯å‘ç”Ÿæ—¶å°±ç«‹å³ä¸­æ–­æ‰§è¡Œçš„è¿™ç§è®¾è®¡ï¼Œä»å•çº¿ç¨‹çš„è§’åº¦å»åˆ†æï¼Œå¤§å®¶æ›´å®¹æ˜“æ˜ç™½ã€‚&lt;/p&gt;
&lt;p&gt;ä½ è¯´å¯¹å—ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&quot;è‡´è°¢&quot;&gt;06ã€è‡´è°¢&lt;/h3&gt;
&lt;p&gt;è°¢è°¢å¤§å®¶çš„é˜…è¯»ï¼ŒåŸåˆ›ä¸æ˜“ï¼Œå–œæ¬¢å°±éšæ‰‹ç‚¹ä¸ªèµğŸ‘ï¼Œè¿™å°†æ˜¯æˆ‘æœ€å¼ºçš„å†™ä½œåŠ¨åŠ›ã€‚&lt;/p&gt;
</description>
<pubDate>Fri, 22 Nov 2019 00:48:00 +0000</pubDate>
<dc:creator>æ²‰é»˜ç‹äºŒ</dc:creator>
<og:description>æœ¬ç¯‡æˆ‘ä»¬æ¥èŠèŠ Java çš„ fail fast æœºåˆ¶ï¼Œæ–‡å­—ä¸€å¦‚æ—¢å¾€çš„æœ‰è¶£å“¦ã€‚ &lt;! more 01ã€å‰è¨€ è¯´èµ·æ¥çœŸç‰¹ä¹ˆæƒ­æ„§ï¼šåå¹´ IT è€å…µï¼ŒJava èœé¸Ÿä¸€æšã€‚ä»Šå¤©æˆ‘æ‰äº†è§£åˆ° Java è¿˜æœ‰ fa</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/qing-gee/p/11909576.html</dc:identifier>
</item>
<item>
<title>å°ç™½å­¦ Python çˆ¬è™«ï¼ˆ2ï¼‰ï¼šå‰ç½®å‡†å¤‡ï¼ˆä¸€ï¼‰åŸºæœ¬ç±»åº“çš„å®‰è£… - æå®¢æŒ–æ˜æœº</title>
<link>http://www.cnblogs.com/babycomeon/p/11909567.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/babycomeon/p/11909567.html</guid>
<description>&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201911/908359-20191122084440582-186699232.jpg&quot;/&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;äººç”Ÿè‹¦çŸ­ï¼Œæˆ‘ç”¨ Python&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å‰æ–‡ä¼ é€é—¨ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/11/13/3303836941/&quot;&gt;å°ç™½å­¦ Python çˆ¬è™«ï¼ˆ1ï¼‰ï¼šå¼€ç¯‡&lt;/a&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;æœ¬ç¯‡å†…å®¹è¾ƒé•¿ï¼Œå„ä½åŒå­¦å¯ä»¥å…ˆæ”¶è—åå†çœ‹~~&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨å¼€å§‹è®²çˆ¬è™«ä¹‹å‰ï¼Œè¿˜æ˜¯å…ˆæŠŠç¯å¢ƒææå¥½ï¼Œå·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨å˜›~~~&lt;/p&gt;
&lt;p&gt;æœ¬ç¯‡æ–‡ç« ä¸»è¦ä»‹ç» Python çˆ¬è™«æ‰€ä½¿ç”¨åˆ°çš„è¯·æ±‚åº“å’Œè§£æåº“ï¼Œè¯·æ±‚åº“ç”¨æ¥è¯·æ±‚ç›®æ ‡å†…å®¹ï¼Œè§£æåº“ç”¨æ¥è§£æè¯·æ±‚å›æ¥çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å¼€å‘ç¯å¢ƒ&quot;&gt;å¼€å‘ç¯å¢ƒ&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆä»‹ç»å°ç¼–æœ¬åœ°çš„å¼€å‘ç¯å¢ƒï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Python3.7.4&lt;/li&gt;
&lt;li&gt;win10&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;å·®ä¸å¤šå°±è¿™äº›ï¼Œæœ€åŸºç¡€çš„ç¯å¢ƒï¼Œå…¶ä»–ç¯å¢ƒéœ€è¦æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªå®‰è£…ï¼Œç°åœ¨å¼€å§‹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;è¯·æ±‚åº“&quot;&gt;è¯·æ±‚åº“&lt;/h2&gt;
&lt;p&gt;è™½ç„¶ Python ä¸ºæˆ‘ä»¬å†…ç½®äº† HTTP è¯·æ±‚åº“ urllib ï¼Œä½¿ç”¨å§¿åŠ¿å¹¶ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œä½†æ˜¯å¾ˆå¤šç¬¬ä¸‰æ–¹çš„æä¾›çš„ HTTP åº“ç¡®å®æ›´åŠ çš„ç®€æ´ä¼˜é›…ï¼Œæˆ‘ä»¬ä¸‹é¢å¼€å§‹ã€‚&lt;/p&gt;
&lt;h3 id=&quot;requests&quot;&gt;Requests&lt;/h3&gt;
&lt;p&gt;Requests ç±»åº“æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹æä¾›çš„ç”¨äºå‘é€ HTTP åŒæ­¥è¯·æ±‚çš„ç±»åº“ï¼Œç›¸æ¯”è¾ƒ Python è‡ªå¸¦çš„ urllib ç±»åº“æ›´åŠ çš„æ–¹ä¾¿å’Œç®€æ´ã€‚&lt;/p&gt;
&lt;p&gt;Python ä¸ºæˆ‘ä»¬æä¾›äº†åŒ…ç®¡ç†å·¥å…· pip ï¼Œä½¿ç”¨ pip å®‰è£…å°†ä¼šéå¸¸çš„æ–¹ä¾¿ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;pip install requests&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;éªŒè¯ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;C:\Users\inwsy&amp;gt;python
Python 3.7.4 (tags/v3.7.4:e09359112e, Jul  8 2019, 20:34:20) [MSC v.1916 64 bit (AMD64)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&amp;gt;&amp;gt;&amp;gt; import requests&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;é¦–å…ˆåœ¨ CMD å‘½ä»¤è¡Œä¸­è¾“å…¥ python ï¼Œè¿›å…¥ python çš„å‘½ä»¤è¡Œæ¨¡å¼ï¼Œç„¶åè¾“å…¥ &lt;code&gt;import requests&lt;/code&gt; å¦‚æœæ²¡æœ‰ä»»ä½•é”™è¯¯æç¤ºï¼Œè¯´æ˜æˆ‘ä»¬å·²ç»æˆåŠŸå®‰è£… &lt;code&gt;Requests&lt;/code&gt; ç±»åº“ã€‚&lt;/p&gt;
&lt;h3 id=&quot;selenium&quot;&gt;Selenium&lt;/h3&gt;
&lt;p&gt;Selenium ç°åœ¨æ›´å¤šçš„æ˜¯ç”¨æ¥åšè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼Œç›¸å…³çš„ä¹¦ç±ä¹Ÿä¸å°‘ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒæ¥åšçˆ¬è™«å·¥å…·ï¼Œæ¯•ç«Ÿæ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•ä¹ˆï¼Œåˆ©ç”¨å®ƒæˆ‘ä»¬å¯ä»¥è®©æµè§ˆå™¨æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„åŠ¨ä½œï¼Œæ¯”å¦‚ç‚¹å‡»æŸä¸ªæŒ‰é’®ã€æ»šåŠ¨æ»‘è½®ä¹‹ç±»çš„æ“ä½œï¼Œè¿™å¯¹æˆ‘ä»¬æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œæ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;pip install selenium&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;éªŒè¯ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;C:\Users\inwsy&amp;gt;python
Python 3.7.4 (tags/v3.7.4:e09359112e, Jul  8 2019, 20:34:20) [MSC v.1916 64 bit (AMD64)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&amp;gt;&amp;gt;&amp;gt; import selenium&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™æ ·æ²¡æŠ¥é”™æˆ‘ä»¬å°±å®‰è£…å®Œæˆï¼Œä½†æ˜¯ä½ ä»¥ä¸ºè¿™æ ·å°±ç®—å¥½äº†ä¹ˆï¼Ÿå›¾æ ·å›¾æ£®ç ´å•Šã€‚&lt;/p&gt;
&lt;h4 id=&quot;chromedriver&quot;&gt;ChromeDriver&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜éœ€è¦æµè§ˆå™¨çš„æ”¯æŒæ¥é…åˆ &lt;code&gt;selenium&lt;/code&gt; çš„å·¥ä½œï¼Œå¼€å‘äººå‘˜å˜›ï¼Œå¸¸ç”¨çš„æµè§ˆå™¨è«éé‚£ä¹ˆå‡ ç§ï¼šChromeã€Firefoxï¼Œé‚£ä½è¯´ IE çš„åŒå­¦ï¼Œä½ ç»™æˆ‘ç«™èµ·æ¥ï¼Œå°å¿ƒæˆ‘è·³èµ·æ¥æ‰“ä½ è†ç›–ï¼Œè¿˜æœ‰è¯´ 360 æµè§ˆå™¨çš„ï¼Œä½ ä»¬å¯è®©æˆ‘çœçœå¿ƒå§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201911/908359-20191122084440906-318678530.jpg&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œå®‰è£… Chrome æµè§ˆå™¨å°±ä¸ç”¨è®²äº†å§ã€‚ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;å†æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¼€å§‹å®‰è£… ChromeDriver ï¼Œå®‰è£…äº† ChromeDriver åï¼Œæˆ‘ä»¬æ‰èƒ½é€šè¿‡åˆšæ‰å®‰è£…çš„ &lt;code&gt;selenium&lt;/code&gt; æ¥é©±åŠ¨ Chrome æ¥å®Œæˆå„ç§éªšæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹è‡ªå·±çš„ Chrome æµè§ˆå™¨çš„ç‰ˆæœ¬ï¼Œåœ¨ Chrome æµè§ˆå™¨å³ä¸Šè§’çš„ä¸‰ä¸ªç‚¹é’Ÿï¼Œç‚¹å‡» å¸®åŠ© -&amp;gt; å…³äºï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201911/908359-20191122084441351-1447529644.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å°†è¿™ä¸ªç‰ˆæœ¬æ‰¾ä¸ªå°æœ¬æœ¬è®°ä¸‹æ¥ï¼Œå°ç¼–è¿™é‡Œçš„ç‰ˆæœ¬ä¸ºï¼š ç‰ˆæœ¬ 78.0.3904.97ï¼ˆæ­£å¼ç‰ˆæœ¬ï¼‰ ï¼ˆ64 ä½ï¼‰&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å» ChromeDriver çš„å®˜ç½‘æŸ¥çœ‹å½“å‰ Chrome å¯¹åº”çš„é©±åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;å®˜ç½‘åœ°å€ï¼š &lt;a href=&quot;https://sites.google.com/a/chromium.org/chromedriver/&quot; class=&quot;uri&quot;&gt;https://sites.google.com/a/chromium.org/chromedriver/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å› æŸäº›åŸå› ï¼Œè®¿é—®æ—¶éœ€æŸäº›æ‰‹æ®µï¼Œè®¿é—®ä¸äº†çš„å°±çœ‹å°ç¼–ä¸ºå¤§å®¶å‡†å¤‡çš„ç‰ˆæœ¬å¯¹åº”è¡¨æ ¼å§ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;table&gt;&lt;thead/&gt;&lt;tbody&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;78.0.3904.11&lt;/td&gt;
&lt;td&gt;78&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;77.0.3865.40&lt;/td&gt;
&lt;td&gt;77&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;77.0.3865.10&lt;/td&gt;
&lt;td&gt;77&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;76.0.3809.126&lt;/td&gt;
&lt;td&gt;76&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;76.0.3809.68&lt;/td&gt;
&lt;td&gt;76&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;76.0.3809.25&lt;/td&gt;
&lt;td&gt;76&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;76.0.3809.12&lt;/td&gt;
&lt;td&gt;76&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;75.0.3770.90&lt;/td&gt;
&lt;td&gt;75&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;75.0.3770.8&lt;/td&gt;
&lt;td&gt;75&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;74.0.3729.6&lt;/td&gt;
&lt;td&gt;74&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;73.0.3683.68&lt;/td&gt;
&lt;td&gt;73&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;72.0.3626.69&lt;/td&gt;
&lt;td&gt;72&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;2.46&lt;/td&gt;
&lt;td&gt;71-73&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;2.45&lt;/td&gt;
&lt;td&gt;70-72&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;2.44&lt;/td&gt;
&lt;td&gt;69-71&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;2.43&lt;/td&gt;
&lt;td&gt;69-71&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;2.42&lt;/td&gt;
&lt;td&gt;68-70&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;2.41&lt;/td&gt;
&lt;td&gt;67-69&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;2.40&lt;/td&gt;
&lt;td&gt;66-68&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;2.39&lt;/td&gt;
&lt;td&gt;66-68&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;2.38&lt;/td&gt;
&lt;td&gt;65-67&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;2.37&lt;/td&gt;
&lt;td&gt;64-66&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;2.36&lt;/td&gt;
&lt;td&gt;63-65&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;2.35&lt;/td&gt;
&lt;td&gt;62-64&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;é¡ºä¾¿å°ç¼–æ‰¾åˆ°äº†å›½å†…å¯¹åº”çš„ä¸‹è½½çš„é•œåƒç«™ï¼Œç”±æ·˜å®æä¾›ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://npm.taobao.org/mirrors/chromedriver&quot; class=&quot;uri&quot;&gt;http://npm.taobao.org/mirrors/chromedriver&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è™½ç„¶å’Œå°ç¼–æœ¬åœ°çš„å°ç‰ˆæœ¬å¯¹ä¸ä¸Šï¼Œä½†æ˜¯çœ‹æ ·å­åªè¦å¤§ç‰ˆæœ¬ç¬¦åˆåº”è¯¥æ²¡å•¥é—®é¢˜ï¼Œsoï¼Œå»é•œåƒç«™ä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬å³å¯ï¼Œå°ç¼–è¿™é‡Œä¸‹è½½çš„ç‰ˆæœ¬æ˜¯ï¼š78.0.3904.70 ï¼ŒChromeDriver 78ç‰ˆæœ¬çš„æœ€åä¸€ä¸ªå°ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½å®Œæˆåï¼Œå°†å¯æ‰§è¡Œæ–‡ä»¶ &lt;code&gt;chromedriver.exe&lt;/code&gt; ç§»åŠ¨è‡³ Python å®‰è£…ç›®å½•çš„ Scripts ç›®å½•ä¸‹ã€‚å¦‚æœä½¿ç”¨é»˜è®¤å®‰è£…æœªä¿®æ”¹è¿‡å®‰è£…ç›®å½•çš„è¯ç›®å½•æ˜¯ï¼š&lt;code&gt;%homepath%\AppData\Local\Programs\Python\Python37\Scripts&lt;/code&gt; ï¼Œå¦‚æœæœ‰è¿‡ä¿®æ”¹ï¼Œé‚£å°±è‡ªåŠ›æ›´ç”Ÿå§ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201911/908359-20191122084441850-1902910520.jpg&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å°† &lt;code&gt;chromedriver.exe&lt;/code&gt; æ·»åŠ åç»“æœå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201911/908359-20191122084443173-133848336.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;éªŒè¯ï¼š&lt;/p&gt;
&lt;p&gt;è¿˜æ˜¯åœ¨ CMD å‘½ä»¤è¡Œä¸­ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;C:\Users\inwsy&amp;gt;python
Python 3.7.4 (tags/v3.7.4:e09359112e, Jul  8 2019, 20:34:20) [MSC v.1916 64 bit (AMD64)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&amp;gt;&amp;gt;&amp;gt; from selenium import webdriver
&amp;gt;&amp;gt;&amp;gt; browser = webdriver.Chrome()&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¦‚æœæ‰“å¼€ä¸€ä¸ªç©ºç™½çš„ Chrome é¡µé¢è¯´æ˜å®‰è£…æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201911/908359-20191122084444496-932010255.png&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;geckodriver&quot;&gt;GeckoDriver&lt;/h4&gt;
&lt;p&gt;ä¸Šé¢æˆ‘ä»¬é€šè¿‡å®‰è£… Chrome çš„é©±åŠ¨å®Œæˆäº† Selenium ä¸ Chrome çš„å¯¹æ¥ï¼Œæƒ³è¦å®Œæˆ Selenium ä¸ FireFox çš„å¯¹æ¥åˆ™éœ€è¦å®‰è£…å¦ä¸€ä¸ªé©±åŠ¨ GeckoDriver ã€‚&lt;/p&gt;
&lt;p&gt;FireFox çš„å®‰è£…å°ç¼–è¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼Œå¤§å®¶æœ€å¥½å»å®˜ç½‘ä¸‹è½½å®‰è£…ï¼Œè·¯å¾„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;FireFox å®˜ç½‘åœ°å€ï¼š &lt;a href=&quot;http://www.firefox.com.cn/&quot; class=&quot;uri&quot;&gt;http://www.firefox.com.cn/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;GeckoDriver çš„ä¸‹è½½éœ€è¦å» Github ï¼ˆå…¨çƒæœ€å¤§çš„åŒæ€§äº¤å‹ç½‘ç«™ï¼‰ï¼Œä¸‹è½½è·¯å¾„å°ç¼–å·²ç»æ‰¾å¥½äº†ï¼Œå¯ä»¥é€‰æ‹©æœ€æ–°çš„ releases ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½åœ°å€ï¼š &lt;a href=&quot;https://github.com/mozilla/geckodriver/releases&quot; class=&quot;uri&quot;&gt;https://github.com/mozilla/geckodriver/releases&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é€‰æ‹©å¯¹åº”è‡ªå·±çš„ç¯å¢ƒï¼Œå°ç¼–è¿™é‡Œé€‰æ‹© win-64 ï¼Œç‰ˆæœ¬ä¸º v0.26.0 è¿›è¡Œä¸‹è½½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201911/908359-20191122084444761-1998973815.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å…·ä½“é…ç½®æ–¹å¼å’Œä¸Šé¢ä¸€æ ·ï¼Œå°†å¯æ‰§è¡Œçš„ &lt;code&gt;.exe&lt;/code&gt; æ–‡ä»¶æ”¾å…¥ &lt;code&gt;%homepath%\AppData\Local\Programs\Python\Python37\Scripts&lt;/code&gt; ç›®å½•ä¸‹å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;éªŒè¯ï¼š&lt;/p&gt;
&lt;p&gt;è¿˜æ˜¯åœ¨ CMD å‘½ä»¤è¡Œä¸­ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;C:\Users\inwsy&amp;gt;python
Python 3.7.4 (tags/v3.7.4:e09359112e, Jul  8 2019, 20:34:20) [MSC v.1916 64 bit (AMD64)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&amp;gt;&amp;gt;&amp;gt; from selenium import webdriver
&amp;gt;&amp;gt;&amp;gt; browser = webdriver.Firefox()&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åº”è¯¥æ˜¯å¯ä»¥æ­£å¸¸æ‰“å¼€ä¸€ä¸ªç©ºç™½çš„ FireFox é¡µé¢çš„ï¼Œç»“æœå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201911/908359-20191122084445231-1634203140.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼š&lt;/strong&gt; GeckoDriver æŒ‡å‡ºä¸€ç‚¹ï¼Œå½“å‰çš„ç‰ˆæœ¬åœ¨ win ä¸‹ä½¿ç”¨æœ‰å·²çŸ¥ bug ï¼Œéœ€è¦å®‰è£…å¾®è½¯çš„ä¸€ä¸ªæ’ä»¶æ‰èƒ½è§£å†³ï¼ŒåŸæ–‡å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;4.4590163934426&quot;&gt;
&lt;p&gt;You must still have the &lt;a href=&quot;https://support.microsoft.com/en-us/help/2977003/the-latest-supported-visual-c-downloads&quot;&gt;Microsoft Visual Studio redistributable runtime&lt;/a&gt; installed on your system for the binary to run. This is a known bug which we weren't able fix for this release.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ’ä»¶ä¸‹è½½åœ°å€ï¼š &lt;a href=&quot;https://support.microsoft.com/en-us/help/2977003/the-latest-supported-visual-c-downloads&quot; class=&quot;uri&quot;&gt;https://support.microsoft.com/en-us/help/2977003/the-latest-supported-visual-c-downloads&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¯·å„ä½åŒå­¦é€‰æ‹©è‡ªå·±å¯¹åº”çš„ç³»ç»Ÿç‰ˆæœ¬è¿›è¡Œä¸‹è½½å®‰è£…ã€‚&lt;/p&gt;
&lt;h3 id=&quot;aiohttp&quot;&gt;Aiohttp&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº†åŒæ­¥çš„ Http è¯·æ±‚åº“ Requests ï¼Œè€Œ Aiohttp åˆ™æ˜¯ä¸€ä¸ªæä¾›å¼‚æ­¥ Http è¯·æ±‚çš„ç±»åº“ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œé—®é¢˜æ¥äº†ï¼Œä»€ä¹ˆæ˜¯åŒæ­¥è¯·æ±‚ï¼Ÿä»€ä¹ˆæ˜¯å¼‚æ­¥è¯·æ±‚å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;åŒæ­¥ï¼šé˜»å¡å¼ï¼Œç®€å•ç†è§£å°±æ˜¯å½“å‘å‡ºä¸€ä¸ªè¯·æ±‚ä»¥åï¼Œç¨‹åºä¼šä¸€ç›´ç­‰å¾…è¿™ä¸ªè¯·æ±‚å“åº”ï¼Œç›´åˆ°å“åº”ä»¥åï¼Œæ‰ç»§ç»­åšä¸‹ä¸€æ­¥ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥ï¼šéé˜»å¡å¼ï¼Œè¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œå½“å‘å‡ºä¸€ä¸ªè¯·æ±‚ä»¥åï¼Œç¨‹åºå¹¶ä¸ä¼šé˜»å¡åœ¨è¿™é‡Œï¼Œç­‰å¾…è¯·æ±‚å“åº”ï¼Œè€Œæ˜¯å¯ä»¥å»åšå…¶ä»–äº‹æƒ…ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;ä»èµ„æºæ¶ˆè€—å’Œæ•ˆç‡ä¸Šæ¥è¯´ï¼ŒåŒæ­¥è¯·æ±‚æ˜¯è‚¯å®šæ¯”ä¸è¿‡å¼‚æ­¥è¯·æ±‚çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¼‚æ­¥è¯·æ±‚ä¼šæ¯”åŒæ­¥è¯·æ±‚æ‹¥æœ‰æ›´å¤§çš„ååé‡ã€‚åœ¨æŠ“å–æ•°æ®æ—¶ä½¿ç”¨å¼‚æ­¥è¯·æ±‚ï¼Œå¯ä»¥å¤§å¤§æå‡æŠ“å–çš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè¿˜æƒ³äº†è§£è·Ÿå¤šæœ‰å…³ aiohttp çš„å†…å®¹ï¼Œå¯ä»¥è®¿é—®å®˜æ–¹æ–‡æ¡£ï¼š &lt;a href=&quot;https://aiohttp.readthedocs.io/en/stable/&quot; class=&quot;uri&quot;&gt;https://aiohttp.readthedocs.io/en/stable/&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;p&gt;aiohttp å®‰è£…å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;pip install aiohttp&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;aiohttp è¿˜æ¨èæˆ‘ä»¬å®‰è£…å¦å¤–ä¸¤ä¸ªåº“ï¼Œä¸€ä¸ªæ˜¯å­—ç¬¦ç¼–ç æ£€æµ‹åº“ cchardet ï¼Œå¦ä¸€ä¸ªæ˜¯åŠ é€ŸDNSçš„è§£æåº“ aiodns ã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£… cchardet åº“ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;pip install cchardet&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å®‰è£… aiodns åº“ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;pip install aiodns&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;aiohttp ååˆ†è´´å¿ƒçš„ä¸ºæˆ‘ä»¬å‡†å¤‡äº†æ•´åˆçš„å®‰è£…å‘½ä»¤ï¼Œæ— éœ€ä¸€ä¸ªä¸€ä¸ªé”®å…¥å‘½ä»¤ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;pip install aiohttp[speedups]&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;éªŒè¯ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;C:\Users\inwsy&amp;gt;python
Python 3.7.4 (tags/v3.7.4:e09359112e, Jul  8 2019, 20:34:20) [MSC v.1916 64 bit (AMD64)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&amp;gt;&amp;gt;&amp;gt; import aiohttp&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ²¡æŠ¥é”™å°±å®‰è£…æˆåŠŸã€‚&lt;/p&gt;
&lt;h2 id=&quot;è§£æåº“&quot;&gt;è§£æåº“&lt;/h2&gt;
&lt;h3 id=&quot;lxml&quot;&gt;lxml&lt;/h3&gt;
&lt;p&gt;lxml æ˜¯ Python çš„ä¸€ä¸ªè§£æåº“ï¼Œæ”¯æŒ HTML å’Œ XML çš„è§£æï¼Œæ”¯æŒ XPath çš„è§£ææ–¹å¼ï¼Œè€Œä¸”è§£ææ•ˆç‡éå¸¸é«˜ã€‚&lt;/p&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯ XPath ï¼Ÿ&lt;/p&gt;
&lt;blockquote readability=&quot;10&quot;&gt;
&lt;p&gt;XPathå³ä¸ºXMLè·¯å¾„è¯­è¨€ï¼ˆXML Path Languageï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§ç”¨æ¥ç¡®å®šXMLæ–‡æ¡£ä¸­æŸéƒ¨åˆ†ä½ç½®çš„è¯­è¨€ã€‚&lt;br/&gt;XPathåŸºäºXMLçš„æ ‘çŠ¶ç»“æ„ï¼Œæä¾›åœ¨æ•°æ®ç»“æ„æ ‘ä¸­æ‰¾å¯»èŠ‚ç‚¹çš„èƒ½åŠ›ã€‚èµ·åˆXPathçš„æå‡ºçš„åˆè¡·æ˜¯å°†å…¶ä½œä¸ºä¸€ä¸ªé€šç”¨çš„ã€ä»‹äºXPointerä¸XSLé—´çš„è¯­æ³•æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šå†…å®¹æ¥æºã€Šç™¾åº¦ç™¾ç§‘ã€‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¥½å§ï¼Œå°ç¼–è¯´äººè¯ï¼Œå°±æ˜¯å¯ä»¥ä» XML æ–‡æ¡£æˆ–è€… HTML æ–‡æ¡£ä¸­å¿«é€Ÿçš„å®šä½åˆ°æ‰€éœ€è¦çš„ä½ç½®çš„è·¯å¾„è¯­è¨€ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æ²¡çœ‹æ‡‚ï¼Ÿemmmmmmmmmmmï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ XPath å¿«é€Ÿçš„å–å‡º XML æˆ–è€… HTML æ–‡æ¡£ä¸­æƒ³è¦çš„å€¼ã€‚ç”¨æ³•çš„è¯æˆ‘ä»¬æ”¾åˆ°åé¢å†èŠã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£… lxml åº“ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;pip install lxml&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;éªŒè¯ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;C:\Users\inwsy&amp;gt;python
Python 3.7.4 (tags/v3.7.4:e09359112e, Jul  8 2019, 20:34:20) [MSC v.1916 64 bit (AMD64)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&amp;gt;&amp;gt;&amp;gt; import lxml&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ²¡æŠ¥é”™å°±å®‰è£…æˆåŠŸã€‚&lt;/p&gt;
&lt;h3 id=&quot;beautiful-soup&quot;&gt;Beautiful Soup&lt;/h3&gt;
&lt;p&gt;Beautiful Soup åŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ª Python çš„ HTML æˆ– XML çš„è§£æåº“ ã€‚å®ƒæ‹¥æœ‰å¼ºå¤§çš„è§£æèƒ½åŠ›ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ›´æ–¹ä¾¿çš„ä» HTML æ–‡æ¡£ä¸­æå–æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæ”¾ä¸€ä¸‹ Beautiful Soup çš„å®˜æ–¹ç½‘å€ï¼Œæœ‰å„ç§é—®é¢˜éƒ½å¯ä»¥åœ¨å®˜ç½‘æŸ¥çœ‹æ–‡æ¡£ï¼Œå„ä½åŒå­¦å…»æˆä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œæœ‰é—®é¢˜æ‰¾å®˜æ–¹æ–‡æ¡£ï¼Œè™½ç„¶æ˜¯è‹±æ–‡çš„ï¼Œä½¿ç”¨ Chrome è‡ªå¸¦çš„ç¿»è¯‘åŠŸèƒ½è¿˜æ˜¯å‹‰å¼ºèƒ½çœ‹çš„ã€‚&lt;/p&gt;
&lt;p&gt;å®˜æ–¹ç½‘ç«™ï¼š&lt;a href=&quot;https://www.crummy.com/software/BeautifulSoup/&quot; class=&quot;uri&quot;&gt;https://www.crummy.com/software/BeautifulSoup/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®‰è£…æ–¹å¼ä¾ç„¶ä½¿ç”¨ pip è¿›è¡Œå®‰è£…ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;pip install beautifulsoup4&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Beautiful Soup çš„ HTML å’Œ XML è§£æå™¨æ˜¯ä¾èµ–äº lxml åº“çš„ï¼Œæ‰€ä»¥åœ¨æ­¤ä¹‹å‰è¯·ç¡®ä¿å·²ç»æˆåŠŸå®‰è£…å¥½äº† lxml åº“ ã€‚&lt;/p&gt;
&lt;p&gt;éªŒè¯ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;C:\Users\inwsy&amp;gt;python
Python 3.7.4 (tags/v3.7.4:e09359112e, Jul  8 2019, 20:34:20) [MSC v.1916 64 bit (AMD64)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&amp;gt;&amp;gt;&amp;gt; from bs4 import BeautifulSoup&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ²¡æŠ¥é”™å°±å®‰è£…æˆåŠŸã€‚&lt;/p&gt;
&lt;h3 id=&quot;pyquery&quot;&gt;pyquery&lt;/h3&gt;
&lt;p&gt;pyquery åŒæ ·ä¹Ÿæ˜¯ä¸€ä¸ªç½‘é¡µè§£æåº“ï¼Œåªä¸è¿‡å’Œå‰é¢ä¸¤ä¸ªæœ‰åŒºåˆ«çš„æ˜¯å®ƒæä¾›äº†ç±»ä¼¼ jQuery çš„è¯­æ³•æ¥è§£æ HTML æ–‡æ¡£ï¼Œå‰ç«¯æœ‰ç»éªŒçš„åŒå­¦åº”è¯¥ä¼šéå¸¸å–œæ¬¢è¿™æ¬¾è§£æåº“ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆè¿˜æ˜¯æ”¾ä¸€ä¸‹ pyquery çš„å®˜æ–¹æ–‡æ¡£åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;å®˜æ–¹æ–‡æ¡£ï¼š &lt;a href=&quot;https://pyquery.readthedocs.io/en/latest/&quot; class=&quot;uri&quot;&gt;https://pyquery.readthedocs.io/en/latest/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®‰è£…ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;pip install pyquery&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;éªŒè¯ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;C:\Users\inwsy&amp;gt;python
Python 3.7.4 (tags/v3.7.4:e09359112e, Jul  8 2019, 20:34:20) [MSC v.1916 64 bit (AMD64)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&amp;gt;&amp;gt;&amp;gt; import pyquery&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ²¡æŠ¥é”™å°±å®‰è£…æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç¯‡çš„å†…å®¹å°±å…ˆåˆ°è¿™é‡Œç»“æŸäº†ã€‚è¯·å„ä½åŒå­¦åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šå°†ä¸Šé¢ä»‹ç»çš„å†…å®¹éƒ½å®‰è£…ä¸€éï¼Œä»¥ä¾¿åç»­å­¦ä¹ ä½¿ç”¨ã€‚&lt;/p&gt;
</description>
<pubDate>Fri, 22 Nov 2019 00:45:00 +0000</pubDate>
<dc:creator>æå®¢æŒ–æ˜æœº</dc:creator>
<og:description>äººç”Ÿè‹¦çŸ­ï¼Œæˆ‘ç”¨ Python å‰æ–‡ä¼ é€é—¨ï¼š 'å°ç™½å­¦ Python çˆ¬è™«ï¼ˆ1ï¼‰ï¼šå¼€ç¯‡' æœ¬ç¯‡å†…å®¹è¾ƒé•¿ï¼Œå„ä½åŒå­¦å¯ä»¥å…ˆæ”¶è—åå†çœ‹~~ åœ¨å¼€å§‹è®²çˆ¬è™«ä¹‹å‰ï¼Œè¿˜æ˜¯å…ˆæŠŠç¯å¢ƒææå¥½ï¼Œå·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨å˜›~~~</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/babycomeon/p/11909567.html</dc:identifier>
</item>
<item>
<title>ã€pythonæµ‹è¯•å¼€å‘æ ˆã€‘å¸¦ä½ å½»åº•ææ˜ç™½python3ç¼–ç åŸç† - å¸ƒé“å¸ˆç„æŸ¯</title>
<link>http://www.cnblogs.com/zhouliweiblog/p/11909554.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/zhouliweiblog/p/11909554.html</guid>
<description>&lt;p&gt;åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»è¿‡ç¼–ç æ ¼å¼çš„å‘å±•å²ï¼š[æ–‡ç« ä¼ é€é—¨-todo]ã€‚ä»Šå¤©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­ï¼Œæ¥å½»åº•ææ¸…æ¥špython3ä¸­çš„ç¼–ç æ ¼å¼åŸç†ï¼Œè¿™æ ·ä½ ä¹‹åå†™pythonè„šæœ¬æ—¶ç¢°åˆ°ç¼–ç é—®é¢˜ï¼Œæ‰èƒ½æœ‰ç« å¯å¾ªã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆææ¸…æ¥šå‡ ä¸ªæ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;ç³»ç»Ÿé»˜è®¤ç¼–ç &lt;/strong&gt;ï¼šæŒ‡pythonè§£é‡Šå™¨é»˜è®¤çš„ç¼–ç æ ¼å¼ï¼Œåœ¨pythonæ–‡ä»¶å¤´éƒ¨æ²¡æœ‰å£°æ˜å…¶ä»–ç¼–ç æ ¼å¼æ—¶ï¼Œpython3é»˜è®¤çš„ç¼–ç æ ¼å¼æ˜¯utf-8ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœ¬åœ°é»˜è®¤ç¼–ç &lt;/strong&gt;ï¼šæ“ä½œç³»ç»Ÿé»˜è®¤çš„ç¼–ç ï¼Œå¸¸è§çš„Windowsçš„é»˜è®¤ç¼–ç æ˜¯gbkï¼ŒLinuxçš„é»˜è®¤ç¼–ç æ˜¯UTF-8ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pythonæ–‡ä»¶å¤´éƒ¨å£°æ˜ç¼–ç æ ¼å¼&lt;/strong&gt;ï¼šä¿®æ”¹çš„æ˜¯æ–‡ä»¶çš„é»˜è®¤ç¼–ç æ ¼å¼ï¼Œåªæ˜¯ä¼šå½±å“pythonè§£é‡Šå™¨è¯»å–pythonæ–‡ä»¶æ—¶çš„ç¼–ç æ ¼å¼ï¼Œå¹¶ä¸ä¼šæ”¹å˜ç³»ç»Ÿé»˜è®¤ç¼–ç å’Œæœ¬åœ°é»˜è®¤ç¼–ç ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;é€šè¿‡pythonè‡ªå¸¦çš„åº“ï¼Œå¯ä»¥æŸ¥çœ‹ç³»ç»Ÿé»˜è®¤ç¼–ç å’Œæœ¬åœ°é»˜è®¤ç¼–ç &lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;
&lt;code&gt;Python 3.7.4 (tags/v3.7.4:e09359112e, Jul  8 2019, 20:34:20) [MSC v.1916 64 bit (AMD64)] on win32
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&amp;gt;&amp;gt;&amp;gt; import sys
&amp;gt;&amp;gt;&amp;gt; sys.getdefaultencoding()
'utf-8'
&amp;gt;&amp;gt;&amp;gt; import locale
&amp;gt;&amp;gt;&amp;gt; locale.getdefaultlocale()
('zh_CN', 'cp936')
&amp;gt;&amp;gt;&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ³¨æ„ï¼Œå› ä¸ºæˆ‘åœ¨windowsç³»ç»Ÿçš„ç”µè„‘ä¸Š è¿›è¡Œæµ‹è¯•ï¼Œæ‰€ä»¥ç³»ç»Ÿé»˜è®¤ç¼–ç è¿”å›â€œcp936â€, è¿™æ˜¯ä»£ç é¡µï¼ˆæ˜¯å­—ç¬¦ç¼–ç é›†çš„åˆ«åï¼‰ï¼Œè€Œ936å¯¹åº”çš„å°±æ˜¯gbkã€‚å¦‚æœä½ åœ¨linuxæˆ–è€…macä¸Šæ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œåº”è¯¥ä¼šè¿”å›utf-8ç¼–ç ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®æ€»ç»“æ¥çœ‹ï¼Œå®¹æ˜“å‡ºç°ä¹±ç çš„åœºæ™¯ï¼ŒåŸºæœ¬éƒ½ä¸è¯»å†™ç¨‹åºæœ‰å…³ï¼Œæ¯”å¦‚ï¼šè¯»å–/å†™å…¥æŸä¸ªæ–‡ä»¶ï¼Œæˆ–è€…ä»ç½‘ç»œæµä¸­è¯»å–æ•°æ®ç­‰ï¼Œå› ä¸ºè¿™ä¸ªè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°äº†&lt;strong&gt;ç¼–ç &lt;/strong&gt; å’Œ&lt;strong&gt;è§£ç &lt;/strong&gt;çš„è¿‡ç¨‹ï¼Œåªè¦ç¼–ç å’Œè§£ç çš„ç¼–ç æ ¼å¼å¯¹åº”ä¸ä¸Šï¼Œå°±å®¹æ˜“å‡ºç°ä¹±ç ã€‚ä¸‹é¢æˆ‘ä»¬ä¸¾ä¸¤ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œæ¥éªŒè¯ä¸‹pythonçš„ç¼–ç åŸç†ï¼Œå¸®åŠ©ä½ ç†è§£è¿™ä¸ªè¿‡ç¨‹ã€‚æ³¨æ„ï¼šä¸‹é¢çš„ä¾‹å­éƒ½æ˜¯åœ¨pycharmä¸­å†™çš„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;é»˜è®¤çš„ç¼–ç æ ¼å¼&quot;&gt;01é»˜è®¤çš„ç¼–ç æ ¼å¼&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬æ–°å»ºä¸€ä¸ªencode_demo.pyçš„æ–‡ä»¶ï¼Œå…¶æ–‡ä»¶é»˜è®¤çš„ç¼–ç æ ¼å¼æ˜¯UTF-8ï¼ˆå¯ä»¥ä»pycharmå³ä¸‹è§’çœ‹åˆ°ç¼–ç æ ¼å¼ï¼‰ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;&quot;&quot;&quot;
    @author: asus
    @time: 2019/11/21
    @function: éªŒè¯ç¼–ç æ ¼å¼
&quot;&quot;&quot;
import sys, locale


def write_str_default_encode():
    s = &quot;æˆ‘æ˜¯ä¸€ä¸ªstr&quot;
    print(s)
    print(type(s))
    print(sys.getdefaultencoding())
    print(locale.getdefaultlocale())

    with open(&quot;utf_file&quot;, &quot;w&quot;, encoding=&quot;utf-8&quot;) as f:
        f.write(s)
    with open(&quot;gbk_file&quot;, &quot;w&quot;, encoding=&quot;gbk&quot;) as f:
        f.write(s)
    with open(&quot;jis_file&quot;, &quot;w&quot;, encoding=&quot;shift-jis&quot;) as f:
        f.write(s)


if __name__ == '__main__':
    write_str_default_encode()
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæ¥çŒœæµ‹ä¸‹ç»“æœï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å£°æ˜ç¼–ç æ ¼å¼ï¼Œæ‰€ä»¥pythonè§£é‡Šå™¨é»˜è®¤ç”¨UTF-8å»è§£ç æ–‡ä»¶ï¼Œå› ä¸ºæ–‡ä»¶é»˜è®¤ç¼–ç æ ¼å¼å°±æ˜¯UTF-8ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²så¯ä»¥æ­£å¸¸æ‰“å°ã€‚åŒæ—¶ä»¥UTF-8ç¼–ç æ ¼å¼å†™æ–‡ä»¶ä¸ä¼šå‡ºç°ä¹±ç ï¼Œè€Œä»¥gbkå’Œshift-jisï¼ˆæ—¥æ–‡ç¼–ç ï¼‰å†™æ–‡ä»¶ä¼šå‡ºç°ä¹±ç ï¼ˆè¿™é‡Œè¯´æ˜ä¸€ç‚¹ï¼Œæˆ‘æ˜¯ç”¨pycharmç›´æ¥æ‰“å¼€ç”Ÿæˆçš„æ–‡ä»¶æŸ¥çœ‹çš„ï¼Œç¼–è¾‘å™¨é»˜è®¤ç¼–ç æ˜¯UTF-8ï¼Œå¦‚æœåœ¨windowsä¸Šç”¨è®°äº‹æœ¬æ‰“å¼€åˆ™å…¶é»˜è®¤ç¼–ç è·Ÿéšç³»ç»Ÿæ˜¯GBKï¼Œgbk_fileå’Œutf_fileå‡ä¸ä¼šå‡ºç°ä¹±ç ï¼Œåªæœ‰jis_fileæ˜¯ä¹±ç ï¼‰ï¼Œæˆ‘ä»¬è¿è¡Œçœ‹ä¸‹ç»“æœï¼š&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;# è¿è¡Œç»“æœ
æˆ‘æ˜¯ä¸€ä¸ªstr
&amp;lt;class 'str'&amp;gt;
utf-8
('zh_CN', 'cp936')

# å†™æ–‡ä»¶utf_fileã€gbk_fileã€jis_fileæ–‡ä»¶å†…å®¹åˆ†åˆ«æ˜¯ï¼š
æˆ‘æ˜¯ä¸€ä¸ªstr
ï¿½ï¿½ï¿½ï¿½Ò»ï¿½ï¿½str
ï¿½ä¥ï¿½ê˜¢str&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å’Œæˆ‘ä»¬çŒœæµ‹çš„ç»“æœä¸€è‡´ï¼Œä¸‹é¢æˆ‘ä»¬åšä¸ªæ”¹å˜ï¼Œåœ¨æ–‡ä»¶å¤´éƒ¨å£°æ˜ä¸ªç¼–ç æ ¼å¼ï¼Œå†æ¥çœ‹çœ‹æ•ˆæœã€‚&lt;/p&gt;
&lt;h2 id=&quot;pythonå¤´æ–‡ä»¶å£°æ˜ç¼–ç æ ¼å¼&quot;&gt;02 pythonå¤´æ–‡ä»¶å£°æ˜ç¼–ç æ ¼å¼&lt;/h2&gt;
&lt;p&gt;å› ä¸ºä¸Šé¢æ–‡ä»¶encode_demo.pyçš„æ ¼å¼æ˜¯UTF-8ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å°†å…¶å˜ä¸ºgbkç¼–ç ã€‚åŒæ ·çš„æˆ‘ä»¬å…ˆæ¥æ¨æµ‹ä¸‹ç»“æœï¼Œåœ¨pycharmä¸­ï¼Œåœ¨pythonæ–‡ä»¶å¤´éƒ¨å£°æ˜ç¼–ç ä¸ºgbkåï¼ˆå¤´éƒ¨åŠ ä¸Š # coding=gbk ï¼‰ï¼Œæ–‡ä»¶çš„ç¼–ç æ ¼å¼å˜æˆgbkï¼ŒåŒæ—¶pythonè§£é‡Šå™¨ä¼šç”¨gbkå»è§£ç encode_demo.pyæ–‡ä»¶ï¼Œæ‰€ä»¥è¿è¡Œç»“æœåº”è¯¥å’Œç”¨UTF-8ç¼–ç æ—¶ä¸€æ ·ã€‚è¿è¡Œç»“æœå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;# è¿è¡Œç»“æœ
æˆ‘æ˜¯ä¸€ä¸ªstr
&amp;lt;class 'str'&amp;gt;
utf-8
('zh_CN', 'cp936')

# å†™æ–‡ä»¶utf_fileã€gbk_fileã€jis_fileæ–‡ä»¶å†…å®¹åˆ†åˆ«æ˜¯ï¼š
æˆ‘æ˜¯ä¸€ä¸ªstr
ï¿½ï¿½ï¿½ï¿½Ò»ï¿½ï¿½str
ï¿½ä¥ï¿½ê˜¢str&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç»“æœç¡®å®æ˜¯ä¸€æ ·çš„ï¼Œè¯æ˜æˆ‘ä»¬æ¨è®ºæ˜¯æ­£ç¡®çš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å†åšä¸ªå°è¯•ï¼Œå‡å¦‚æˆ‘ä»¬å°†ï¼ˆ# coding=gbkï¼‰å»æ‰ï¼ˆéœ€è¦æ³¨æ„ï¼Œåœ¨pycharmä¸­å°† # coding=gbkå»æ‰ï¼Œå¹¶ä¸ä¼šæ”¹å˜æ–‡ä»¶çš„ç¼–ç æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯è¯´encode_demo.pyè¿˜æ˜¯gbkç¼–ç ï¼‰ï¼Œæˆ‘ä»¬å†è¿è¡Œä¸€æ¬¡çœ‹ç»“æœï¼š&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;  File &quot;D:/codespace/python/pythonObject/pythonSample/basic/encodeDemo/encode_demo.py&quot;, line 4
SyntaxError: Non-UTF-8 code starting with '\xd1' in file D:/codespace/python/pythonObject/pythonSample/basic/encodeDemo/encode_demo.py on line 5, but no encoding declared; see http://python.org/dev/peps/pep-0263/ for details
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç›´æ¥æŠ¥é”™äº†ï¼Œæˆ‘ä»¬åŠ ä¸ªæ–­ç‚¹ï¼Œçœ‹çœ‹å…·ä½“çš„å¼‚å¸¸ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/367944/201911/367944-20191122083608020-528296077.png&quot; alt=&quot;ç¼–ç é”™è¯¯.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;çœ‹é”™è¯¯æç¤ºæ˜¯UnicodeDecodeErrorï¼Œpythonè§£é‡Šå™¨åœ¨å¯¹encode_demo.pyæ–‡ä»¶è§£ç æ—¶ï¼Œä½¿ç”¨é»˜è®¤çš„UTF-8ç¼–ç ï¼Œä½†æ˜¯æ–‡ä»¶æœ¬èº«æ˜¯gbkç¼–ç ï¼Œæ‰€ä»¥å½“ç¢°åˆ°æœ‰ä¸­æ–‡æ²¡åŠæ³•è¯†åˆ«æ—¶ï¼Œå°±æŠ›å‡ºDecodeErrorã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ•²é»‘æ¿åˆ’é‡ç‚¹&quot;&gt;03 æ•²é»‘æ¿ï¼Œåˆ’é‡ç‚¹&lt;/h2&gt;
&lt;h3 id=&quot;python3ä¸­çš„strå’Œbytes&quot;&gt;python3ä¸­çš„strå’Œbytes&lt;/h3&gt;
&lt;p&gt;python3çš„é‡è¦ç‰¹æ€§ä¹‹ä¸€å°±æ˜¯å¯¹å­—ç¬¦ä¸²å’ŒäºŒè¿›åˆ¶æµåšäº†ä¸¥æ ¼çš„åŒºåˆ†ï¼Œæˆ‘ä»¬å£°æ˜çš„å­—ç¬¦ä¸²éƒ½æ˜¯strç±»å‹ï¼Œä¸è¿‡Strå’Œbytesæ˜¯å¯ä»¥ç›¸äº’è½¬æ¢çš„ï¼š&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;def str_transfor_bytes():
    s = 'æˆ‘æ˜¯ä¸€ä¸ªæµ‹è¯•Str'
    print(type(s))
    # str è½¬bytes
    b = s.encode()
    print(b)
    print(type(b))
    # bytesè½¬str
    c = b.decode('utf-8')
    print(c)
    print(type(c))


if __name__ == '__main__':
    str_transfor_bytes()&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼šåœ¨è°ƒç”¨encode()å’Œdecode()æ–¹æ³•æ—¶ï¼Œå¦‚æœä¸ä¼ å‚æ•°ï¼Œåˆ™ä¼šä½¿ç”¨pythonè§£é‡Šå™¨é»˜è®¤çš„ç¼–ç æ ¼å¼UTF-8ï¼ˆå¦‚æœä¸åœ¨pythonå¤´æ–‡ä»¶å£°æ˜ç¼–ç æ ¼å¼ï¼‰ã€‚ä½†æ˜¯å¦‚æœä¼ å‚çš„è¯ï¼Œencodeå’Œdecodeä½¿ç”¨çš„ç¼–ç æ ¼å¼è¦èƒ½å¯¹åº”ä¸Šã€‚&lt;/p&gt;
&lt;h3 id=&quot;python3é»˜è®¤ç¼–ç æ˜¯utf-8è¿˜æ˜¯unicode&quot;&gt;python3é»˜è®¤ç¼–ç æ˜¯UTF-8ï¼Ÿè¿˜æ˜¯Unicodeï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ç»å¸¸åœ¨å¾ˆå¤šæ–‡ç« é‡Œçœ‹åˆ°ï¼Œpython3çš„é»˜è®¤ç¼–ç æ ¼å¼æ˜¯Unicodeï¼Œä½†æ˜¯æˆ‘åœ¨æœ¬æ–‡ä¸­å´ä¸€ç›´åœ¨è¯´python3çš„é»˜è®¤ç¼–ç æ ¼å¼æ˜¯UTF-8ï¼Œé‚£ä¹ˆå“ªç§è¯´æ³•æ˜¯æ­£ç¡®çš„å‘¢ï¼Ÿå…¶å®ä¸¤ç§è¯´æ³•éƒ½å¯¹ï¼Œä¸»è¦å¾—ææ¸…æ¥šUnicodeå’ŒUTF-8çš„åŒºåˆ«ï¼ˆä¹‹å‰æ–‡ç« æœ‰æåˆ°ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Unicodeæ˜¯ä¸€ä¸ªå­—ç¬¦é›†ï¼Œè¯´ç™½äº†å°±æ˜¯æŠŠå„ç§ç¼–ç çš„æ˜ å°„å…³ç³»å…¨éƒ½æ•´åˆèµ·æ¥ï¼Œä¸è¿‡å®ƒæ˜¯ä¸å¯å˜é•¿çš„ï¼Œå…¨éƒ¨éƒ½ä»¥ä¸¤ä¸ªå­—èŠ‚æˆ–å››ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºï¼Œå ç”¨çš„å†…å­˜ç©ºé—´æ¯”è¾ƒå¤§ã€‚&lt;/li&gt;
&lt;li&gt;UTF-8æ˜¯Unicodeçš„ä¸€ç§å®ç°æ–¹å¼ï¼Œä¸»è¦å¯¹ Unicode ç çš„æ•°æ®è¿›è¡Œè½¬æ¢ï¼Œæ–¹ä¾¿å­˜å‚¨å’Œç½‘ç»œä¼ è¾“ ã€‚å®ƒæ˜¯å¯å˜é•¿ç¼–ç ï¼Œæ¯”å¦‚å¯¹äºè‹±æ–‡å­—æ¯ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªå­—èŠ‚å°±å¯ä»¥è¡¨ç¤ºã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;åœ¨python3å†…å­˜ä¸­ä½¿ç”¨çš„å­—ç¬¦ä¸²å…¨éƒ½æ˜¯Unicodeç ï¼Œå½“pythonè§£é‡Šå™¨è§£æpythonæ–‡ä»¶æ—¶ï¼Œé»˜è®¤ä½¿ç”¨UTF-8ç¼–ç ã€‚&lt;/p&gt;
&lt;h3 id=&quot;openæ–¹æ³•é»˜è®¤ä½¿ç”¨æœ¬åœ°ç¼–ç &quot;&gt;open()æ–¹æ³•é»˜è®¤ä½¿ç”¨æœ¬åœ°ç¼–ç &lt;/h3&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¾€ç£ç›˜å†™å…¥æ–‡ä»¶æ—¶ï¼Œéƒ½æŒ‡å®šäº†ç¼–ç æ ¼å¼ã€‚å¦‚æœä¸æŒ‡å®šç¼–ç æ ¼å¼ï¼Œé‚£ä¹ˆé»˜è®¤å°†ä½¿ç”¨æ“ä½œç³»ç»Ÿæœ¬åœ°é»˜è®¤çš„ç¼–ç æ ¼å¼ï¼Œæ¯”å¦‚ï¼šLinuxé»˜è®¤æ˜¯UTF-8ï¼Œwindowsé»˜è®¤æ˜¯GBKã€‚å…¶å®è¿™ä¹Ÿå¥½ç†è§£ï¼Œå› ä¸ºå’Œç£ç›˜äº¤äº’ï¼Œè‚¯å®šè¦è€ƒè™‘æ“ä½œç³»ç»Ÿçš„ç¼–ç æ ¼å¼ã€‚è¿™æœ‰åŒºåˆ«äºencode()å’Œdecode()ä½¿ç”¨çš„æ˜¯pythonè§£é‡Šå™¨çš„é»˜è®¤ç¼–ç æ ¼å¼ï¼Œåƒä¸‡åˆ«ææ··æ·†äº†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ€»ç»“&quot;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ä¸çŸ¥é“ä½ çœ‹å®Œä¸Šé¢çš„ä¾‹å­åï¼Œæ˜¯å¦å·²ç»å½»åº•ç†è§£äº†python3çš„ç¼–ç åŸç†ã€‚ä¸è¿‡æ‰€æœ‰çš„ç¼–ç é—®é¢˜ï¼Œéƒ½é€ƒä¸è¿‡â€œç¼–ç â€å’Œâ€œè§£ç â€ä¸¤ä¸ªè¿‡ç¨‹ï¼Œå½“ä½ ç¢°åˆ°ç¼–ç é—®é¢˜æ—¶ï¼Œå…ˆç¡®å®šæºæ–‡ä»¶ä½¿ç”¨çš„ç¼–ç ï¼Œå†ç¡®å®šç›®æ ‡æ–‡ä»¶éœ€è¦çš„ç¼–ç æ ¼å¼ï¼Œåªè¦èƒ½åŒ¹é…ï¼Œä¸€èˆ¬å°±å¯ä»¥è§£å†³ç¼–ç çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/367944/201911/367944-20191122083608225-453511459.jpg&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Fri, 22 Nov 2019 00:36:00 +0000</pubDate>
<dc:creator>å¸ƒé“å¸ˆç„æŸ¯</dc:creator>
<og:description>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»è¿‡ç¼–ç æ ¼å¼çš„å‘å±•å²ï¼š[æ–‡ç« ä¼ é€é—¨ todo]ã€‚ä»Šå¤©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­ï¼Œæ¥å½»åº•ææ¸…æ¥špython3ä¸­çš„ç¼–ç æ ¼å¼åŸç†ï¼Œè¿™æ ·ä½ ä¹‹åå†™pythonè„šæœ¬æ—¶ç¢°åˆ°ç¼–ç é—®é¢˜ï¼Œæ‰èƒ½æœ‰ç« å¯å¾ªã€‚ æˆ‘ä»¬</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/zhouliweiblog/p/11909554.html</dc:identifier>
</item>
<item>
<title>äº”åˆ†é’Ÿå­¦ä¼šHTML5çš„WebSocketåè®® - Peerless1029</title>
<link>http://www.cnblogs.com/peerless1029/p/11909446.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/peerless1029/p/11909446.html</guid>
<description>&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;1ã€èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒå¾ˆå¤šç½‘ç«™ä¸ºäº†å®ç°æ¨é€æŠ€æœ¯ï¼Œæ‰€ç”¨çš„æŠ€æœ¯éƒ½æ˜¯&lt;strong&gt;Ajaxè½®è¯¢&lt;/strong&gt;ã€‚è½®è¯¢æ˜¯åœ¨ç‰¹å®šçš„çš„æ—¶é—´é—´éš”ç”±æµè§ˆå™¨å¯¹æœåŠ¡å™¨å‘å‡ºHTTPè¯·æ±‚ï¼Œç„¶åç”±æœåŠ¡å™¨è¿”å›æœ€æ–°çš„æ•°æ®ç»™å®¢æˆ·ç«¯çš„æµè§ˆå™¨ã€‚è¿™ç§ä¼ ç»Ÿçš„æ¨¡å¼å¸¦æ¥å¾ˆæ˜æ˜¾çš„ç¼ºç‚¹ï¼Œå³æµè§ˆå™¨éœ€è¦ä¸æ–­çš„å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œç„¶è€ŒHTTPè¯·æ±‚å¯èƒ½åŒ…å«è¾ƒé•¿çš„å¤´éƒ¨ï¼Œå…¶ä¸­çœŸæ­£æœ‰æ•ˆçš„æ•°æ®å¯èƒ½åªæ˜¯å¾ˆå°çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¾ç„¶è¿™æ ·ä¼šæµªè´¹å¾ˆå¤šçš„å¸¦å®½ç­‰èµ„æºã€‚HTML5æ–°å¢çš„ä¸€äº›æ–°åè®®&lt;strong&gt;WebSocket&lt;/strong&gt;,å¯ä»¥æä¾›åœ¨å•ä¸ªTCPè¿æ¥ä¸Š&lt;strong&gt;æä¾›å…¨åŒå·¥ï¼ŒåŒå‘é€šä¿¡&lt;/strong&gt;ï¼Œèƒ½å¤ŸèŠ‚çœæœåŠ¡å™¨èµ„æºå’Œå¸¦å®½ï¼Œå¹¶ä¸”èƒ½å¤Ÿå®æ—¶è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;
&lt;h2 id=&quot;websocketä»‹ç»&quot;&gt;2ã€WebSocketä»‹ç»&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒä¼ ç»Ÿçš„httpä¹Ÿæ˜¯ä¸€ç§åè®®ï¼ŒWebSocketæ˜¯ä¸€ç§åè®®ï¼Œä½¿ç”¨httpæœåŠ¡å™¨æ— æ³•å®ç°WebSocketï¼Œ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2.1.æµè§ˆå™¨æ”¯æŒæƒ…å†µ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åŸºæœ¬ä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1103967/201911/1103967-20191122022640237-1033309185.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2.2.ä¼˜ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç›¸å¯¹äºhttpæœ‰å¦‚ä¸‹å¥½å¤„ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1.å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨åªå»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œå¯ä»¥ä½¿ç”¨æ›´å°‘çš„è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;2.WebSocketæœåŠ¡å™¨ç«¯å¯ä»¥ä¸»åŠ¨æ¨é€æ•°æ®åˆ°å®¢æˆ·ç«¯ï¼Œæ›´çµæ´»é«˜æ•ˆã€‚&lt;/li&gt;
&lt;li&gt;3.æ›´è½»é‡çº§çš„åè®®å¤´ï¼Œå‡å°‘æ•°æ®ä¼ é€é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;å¯¹æ¯”è½®è®­æœºåˆ¶&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1103967/201911/1103967-20191122022658213-1496251397.png&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;websocketç”¨æ³•&quot;&gt;3ã€WebSocketç”¨æ³•&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒæˆ‘ä»¬äº†è§£WebSocketæ˜¯ä»€ä¹ˆï¼Œæœ‰å“ªäº›ä¼˜ç‚¹åï¼Œæ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3.1.WebSocketåˆ›å»º&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;WebSocketä½¿ç”¨äº†è‡ªå®šä¹‰åè®®ï¼Œurlæ¨¡å¼ä¸httpç•¥æœ‰ä¸åŒï¼ŒæœªåŠ å¯†çš„è¿æ¥æ˜¯ws://ï¼ŒåŠ å¯†çš„è¿æ¥æ˜¯wss://ï¼ŒWebSocketå®ä¾‹ä½¿ç”¨&lt;code&gt;new WebSocket()&lt;/code&gt;æ–¹æ³•æ¥åˆ›å»ºï¼Œ&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;var ws = new WebSocket(url, [protocol] );&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;em&gt;ç¬¬ä¸€ä¸ªå‚æ•° url, æŒ‡å®šè¿æ¥çš„ URLã€‚ç¬¬äºŒä¸ªå‚æ•° protocol æ˜¯å¯é€‰çš„ï¼ŒæŒ‡å®šäº†å¯æ¥å—çš„å­åè®®ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3.2.WebSocketå±æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å½“åˆ›å»ºwså¯¹è±¡åï¼ŒreadyStateä¸ºwså®ä¾‹çŠ¶æ€ï¼Œå…±4ç§çŠ¶æ€&lt;/p&gt;
&lt;ul readability=&quot;1&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;0 è¡¨ç¤ºè¿æ¥å°šæœªå»ºç«‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;1 è¡¨ç¤ºè¿æ¥å·²å»ºç«‹ï¼Œå¯ä»¥è¿›è¡Œé€šä¿¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;2 è¡¨ç¤ºè¿æ¥æ­£åœ¨è¿›è¡Œå…³é—­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;3 è¡¨ç¤ºè¿æ¥å·²ç»å…³é—­æˆ–è€…è¿æ¥ä¸èƒ½æ‰“å¼€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;Tipsï¼š&lt;/strong&gt;åœ¨å‘é€æŠ¥æ–‡ä¹‹å‰è¦åˆ¤æ–­çŠ¶æ€ï¼Œæ–­å¼€ä¹Ÿåº”è¯¥æœ‰é‡è¿æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3.3.WebSocketäº‹ä»¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨åˆ›å»ºwså®ä¾‹å¯¹è±¡åï¼Œä¼šæ‹¥æœ‰ä»¥ä¸‹å‡ ä¸ªäº‹ä»¶ï¼Œæ ¹æ®ä¸åŒçŠ¶æ€å¯åœ¨äº‹ä»¶å›è°ƒå†™æ–¹æ³•ã€‚&lt;/p&gt;
&lt;ul readability=&quot;1&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;ws.onopen è¿æ¥å»ºç«‹æ—¶è§¦å‘&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;ws.onmessage å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡ç«¯æ•°æ®æ—¶è§¦å‘&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;ws.onerror é€šä¿¡å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;ws.onclose è¿æ¥å…³é—­æ—¶è§¦å‘&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;pre&gt;
&lt;code&gt;ws.onmessage = (res) =&amp;gt; {
  console.log(res.data);
};

ws.onopen = () =&amp;gt; {
  console.log('OPEN...');
};

ws.onclose=()=&amp;gt;{
 console.log('CLOSE...');
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;3.4.WebSocketæ–¹æ³•&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;demoæ¼”ç¤º&quot;&gt;4ã€Demoæ¼”ç¤º&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒäº†è§£WebSocketçš„ä¸€äº›APIä¹‹åï¼Œè¶çƒ­æ‰“é“ï¼Œåšä¸€ä¸ªå°æ¡ˆä¾‹è·‘ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4.1.NodeæœåŠ¡å™¨ç«¯&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;WebSocketåè®®ä¸Nodeä¸€èµ·ç”¨éå¸¸å¥½ï¼ŒåŸå› æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;1.WebSocketå®¢æˆ·ç«¯åŸºäºäº‹ä»¶ç¼–ç¨‹ä¸Nodeä¸­è‡ªå®šä¹‰äº‹ä»¶å·®ä¸å¤šã€‚&lt;/p&gt;
&lt;p&gt;2.WebSocketå®ç°å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯é•¿è¿æ¥ï¼ŒNodeåŸºæœ¬äº‹ä»¶é©±åŠ¨çš„æ–¹å¼ååˆ†é€‚åˆé«˜å¹¶å‘è¿æ¥&lt;/p&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªwebSocket.jså¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;const WebSocketServer = require('ws').Server;
const wss = new WebSocketServer({ port: 8080 });
wss.on('connection', function (ws) {
    console.log('client connected');
    ws.on('message', function (message) {
        ws.send('æˆ‘æ”¶åˆ°äº†' + message);
    });
});&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ‰“å¼€windowså‘½ä»¤çª—å£è¿è¡Œ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1103967/201911/1103967-20191122022622029-1771959083.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4.2.HTMLå®¢æˆ·ç«¯&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ–°å»ºä¸€ä¸ªindex.htmlé¡µé¢&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html lang=&quot;en&quot;&amp;gt;
&amp;lt;head&amp;gt;
    &amp;lt;meta charset=&quot;UTF-8&quot;&amp;gt;
    &amp;lt;title&amp;gt;webSocketå°Demo&amp;lt;/title&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
    &amp;lt;div class=&quot;container&quot;&amp;gt;
        &amp;lt;div&amp;gt;
            &amp;lt;input type=&quot;text&quot; id=&quot;msg&quot;&amp;gt;
            &amp;lt;button onclick=&quot;sendMsg()&quot;&amp;gt;å‘é€æŠ¥æ–‡&amp;lt;/button&amp;gt;
        &amp;lt;/div&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;script&amp;gt;
        const ws = new WebSocket('ws://localhost:8080');
        ws.onmessage = (res) =&amp;gt; {
            console.log(res);
        };
        ws.onopen = () =&amp;gt; {
            console.log('OPEN...');
        };
        ws.onclose = () =&amp;gt; {
            console.log('CLOSE...');
        }
        function sendMsg() {
            let msg = document.getElementById('msg').value;
            ws.send(msg);
        }
    &amp;lt;/script&amp;gt;
&amp;lt;/body&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ‰“å¼€æµè§ˆå™¨ä¾æ¬¡è¾“å…¥å­—ç¬¦1,2,3ï¼Œæ¯æ¬¡è¾“å…¥å®Œç‚¹å‡»å‘é€æŠ¥ä½“ï¼Œå¯è§åœ¨ws.onmessageäº‹ä»¶ä¸­res.dataä¸­è¿”å›æ¥æˆ‘ä»¬å‘çš„æŠ¥æ–‡&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1103967/201911/1103967-20191122022609323-1300599992.png&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;é—®é¢˜ä¸æ€»ç»“&quot;&gt;5ã€é—®é¢˜ä¸æ€»ç»“&lt;/h2&gt;
&lt;p&gt;â€ƒâ€ƒä»¥ä¸Šåªæ˜¯ç®€å•çš„ä»‹ç»äº†ä¸‹WebSocketçš„APIä¸ç®€å•ç”¨æ³•ï¼Œåœ¨å¤„ç†é«˜å¹¶å‘ï¼Œé•¿è¿æ¥è¿™äº›éœ€æ±‚ä¸Šï¼Œä¾‹å¦‚èŠå¤©å®¤ï¼Œå¯èƒ½WebSocketçš„httpè¯·æ±‚æ›´åŠ åˆé€‚é«˜æ•ˆã€‚&lt;/p&gt;
&lt;p&gt;â€ƒ â€ƒä½†åœ¨ä½¿ç”¨WebSocketè¿‡ç¨‹ä¸­å‘ç°å®¹æ˜“æ–­å¼€è¿æ¥ç­‰é—®é¢˜ï¼Œæ‰€ä»¥åœ¨æ¯æ¬¡å‘é€æŠ¥æ–‡å‰è¦åˆ¤æ–­æ˜¯å¦æ–­å¼€ï¼Œå½“å¤šæ¬¡å‘é€æŠ¥æ–‡æ—¶ï¼Œç”±äºæœåŠ¡å™¨ç«¯è¿”å›æ•°æ®é‡ä¸åŒï¼Œè¿”å›å®¢æˆ·ç«¯å‰åé¡ºåºä¹Ÿä¸åŒï¼Œæ‰€ä»¥éœ€è¦åœ¨å®¢æˆ·ç«¯æ”¶åˆ°ä¸Šä¸€ä¸ªæŠ¥æ–‡è¿”å›æ•°æ®åå†å‘é€ä¸‹ä¸€ä¸ªæŠ¥æ–‡ï¼Œä¸ºäº†é¿å…å›è°ƒåµŒå¥—è¿‡å¤šï¼Œé€šè¿‡Promise ï¼Œasync ,awaitç­‰åŒæ­¥æ–¹å¼è§£å†³ã€‚å…³äºWebSocketå°±å†™è¿™ä¹ˆå¤šï¼Œå¦‚æœ‰ä¸è¶³ï¼Œæ¬¢è¿å¤šå¤šæŒ‡æ­£ï¼&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;br/&gt;ã€ŠJavaScripté«˜çº§æ•™ç¨‹ã€‹&lt;br/&gt;ã€Šæ·±å…¥æ£€å‡ºNodeJsã€‹&lt;br/&gt;&lt;a href=&quot;https://www.runoob.com/&quot;&gt;ã€Šèœé¸Ÿæ•™ç¨‹ã€‹&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Fri, 22 Nov 2019 00:12:00 +0000</pubDate>
<dc:creator>Peerless1029</dc:creator>
<og:description>1ã€èƒŒæ™¯ &amp;emsp;&amp;emsp;å¾ˆå¤šç½‘ç«™ä¸ºäº†å®ç°æ¨é€æŠ€æœ¯ï¼Œæ‰€ç”¨çš„æŠ€æœ¯éƒ½æ˜¯ Ajaxè½®è¯¢ ã€‚è½®è¯¢æ˜¯åœ¨ç‰¹å®šçš„çš„æ—¶é—´é—´éš”ç”±æµè§ˆå™¨å¯¹æœåŠ¡å™¨å‘å‡ºHTTPè¯·æ±‚ï¼Œç„¶åç”±æœåŠ¡å™¨è¿”å›æœ€æ–°çš„æ•°æ®ç»™å®¢æˆ·ç«¯çš„æµè§ˆå™¨ã€‚è¿™ç§ä¼ </og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/peerless1029/p/11909446.html</dc:identifier>
</item>
<item>
<title>[springboot å¼€å‘å•ä½“web shop] 7. å¤šç§å½¢å¼æä¾›å•†å“åˆ—è¡¨ - IsaacZhang</title>
<link>http://www.cnblogs.com/zhangpan1244/p/11909515.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/zhangpan1244/p/11909515.html</guid>
<description>&lt;p&gt;&lt;a href=&quot;https://segmentfault.com/a/1190000021047932&quot;&gt;ä¸ŠèŠ‚&lt;/a&gt; æˆ‘ä»¬å®ç°äº†ä»¿&lt;code&gt;jd&lt;/code&gt;çš„è½®æ’­å¹¿å‘Šä»¥åŠå•†å“åˆ†ç±»çš„åŠŸèƒ½ï¼Œå¹¶ä¸”è®²è§£äº†ä¸åŒçš„æ³¨å…¥æ–¹å¼ï¼Œæœ¬èŠ‚æˆ‘ä»¬å°†ç»§ç»­å®ç°æˆ‘ä»¬çš„ç”µå•†ä¸»ä¸šåŠ¡ï¼Œå•†å“ä¿¡æ¯çš„å±•ç¤ºã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆï¼Œåœ¨æˆ‘ä»¬å¼€å§‹æœ¬èŠ‚ç¼–ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹éƒ½æœ‰å“ªäº›åœ°æ–¹ä¼šå¯¹å•†å“è¿›è¡Œå±•ç¤ºï¼Œæ‰“å¼€&lt;code&gt;jd&lt;/code&gt;é¦–é¡µï¼Œé¼ æ ‡ä¸‹æ‹‰å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/48397/201911/48397-20191122075917091-108425741.png&quot; alt=&quot;é¦–é¡µå•†å“åˆ—è¡¨ç¤ºä¾‹&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¤§ç±»å‹ä¸‹æŸ¥è¯¢äº†éƒ¨åˆ†å•†å“åœ¨é¦–é¡µè¿›è¡Œå±•ç¤ºï¼ˆå¯ä»¥æ˜¯æœ€æ–°çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç½‘ç«™æ¨èç­‰ç­‰ï¼‰ï¼Œç„¶åç‚¹å‡»ä»»ä½•ä¸€ä¸ªåˆ†ç±»ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/48397/201911/48397-20191122075920969-2048505841.png&quot; alt=&quot;åˆ†ç±»å•†å“åˆ—è¡¨ç¤ºä¾‹&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¸€èˆ¬è¿›åˆ°ç”µå•†ç½‘ç«™ä¹‹åï¼Œæœ€å¸¸ç”¨çš„ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯æœç´¢ï¼Œ&lt;a href=&quot;%5Bhttps://search.jd.com/Search?keyword=%E7%94%B5%E9%92%A2%E7%90%B4&amp;amp;enc=utf-8&amp;amp;spm=a.0.0&amp;amp;wq=&amp;amp;pvid=2162c63a5cb942d0aa73b921fb00dca9%5D(https://search.jd.com/Search?keyword=%E7%94%B5%E9%92%A2%E7%90%B4&amp;amp;enc=utf-8&amp;amp;spm=a.0.0&amp;amp;wq=&amp;amp;pvid=2162c63a5cb942d0aa73b921fb00dca9)&quot;&gt;æœç´¢é’¢ç´&lt;/a&gt; ç»“æœå¦‚ä¸‹ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/48397/201911/48397-20191122075924676-1965450771.png&quot; alt=&quot;æœç´¢æŸ¥è¯¢ç»“æœç¤ºä¾‹&quot;/&gt;&lt;/p&gt;
&lt;p&gt;é€‰æ‹©ä»»æ„ä¸€ä¸ªå•†å“ç‚¹å‡»ï¼Œéƒ½å¯ä»¥è¿›å…¥åˆ°è¯¦æƒ…é¡µé¢ï¼Œè¿™ä¸ªæ˜¯å•ä¸ªå•†å“çš„ä¿¡æ¯å±•ç¤ºã€‚&lt;br/&gt;ç»¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè¦å®ç°ä¸€ä¸ªç”µå•†å¹³å°çš„å•†å“å±•ç¤ºï¼Œæœ€åŸºæœ¬çš„åŒ…å«ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;é¦–é¡µæ¨è/æœ€æ–°ä¸Šæ¶å•†å“&lt;/li&gt;
&lt;li&gt;åˆ†ç±»æŸ¥è¯¢å•†å“&lt;/li&gt;
&lt;li&gt;å…³é”®è¯æœç´¢å•†å“&lt;/li&gt;
&lt;li&gt;å•†å“è¯¦æƒ…å±•ç¤º&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å•†å“ç›¸å…³çš„ä¸šåŠ¡å¼€å‘äº†ã€‚&lt;/p&gt;

&lt;h2 id=&quot;å¼€å‘æ¢³ç†&quot;&gt;å¼€å‘æ¢³ç†&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬é¦–å…ˆæ¥å®ç°åœ¨é¦–é¡µå±•ç¤ºçš„æ¨èå•†å“åˆ—è¡¨ï¼Œæ¥çœ‹ä¸€ä¸‹éƒ½éœ€è¦å±•ç¤ºå“ªäº›ä¿¡æ¯ï¼Œä»¥åŠå¦‚ä½•è¿›è¡Œå±•ç¤ºã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å•†å“ä¸»é”®(product_id)&lt;/li&gt;
&lt;li&gt;å±•ç¤ºå›¾ç‰‡ï¼ˆimage_urlï¼‰&lt;/li&gt;
&lt;li&gt;å•†å“åç§°ï¼ˆproduct_nameï¼‰&lt;/li&gt;
&lt;li&gt;å•†å“ä»·æ ¼(product_price)&lt;/li&gt;
&lt;li&gt;åˆ†ç±»è¯´æ˜(description)&lt;/li&gt;
&lt;li&gt;åˆ†ç±»åç§°(category_name)&lt;/li&gt;
&lt;li&gt;åˆ†ç±»ä¸»é”®ï¼ˆcategory_idï¼‰&lt;/li&gt;
&lt;li&gt;å…¶ä»–...&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;ç¼–ç å®ç°&quot;&gt;ç¼–ç å®ç°&lt;/h2&gt;
&lt;h3 id=&quot;æ ¹æ®ä¸€çº§åˆ†ç±»æŸ¥è¯¢&quot;&gt;æ ¹æ®ä¸€çº§åˆ†ç±»æŸ¥è¯¢&lt;/h3&gt;
&lt;p&gt;éµå¾ªå¼€å‘é¡ºåºï¼Œè‡ªä¸‹è€Œä¸Šï¼Œå¦‚æœåŸºç¡€mapperè§£å†³ä¸äº†ï¼Œé‚£ä¹ˆä¼˜å…ˆç¼–å†™SQL mapperï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨åŒä¸€å¼ è¡¨ä¸­æ ¹æ®&lt;code&gt;parent_id&lt;/code&gt;é€’å½’çš„å®ç°æ•°æ®æŸ¥è¯¢ï¼Œå½“ç„¶æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯&lt;code&gt;è¡¨é“¾æ¥&lt;/code&gt;çš„æ–¹å¼å®ç°ã€‚å› æ­¤ï¼Œ&lt;code&gt;common mapper&lt;/code&gt;æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œéœ€è¦è‡ªå®šä¹‰mapperå®ç°ã€‚&lt;/p&gt;
&lt;h4 id=&quot;custom-mapperå®ç°&quot;&gt;Custom Mapperå®ç°&lt;/h4&gt;
&lt;p&gt;å’Œ&lt;a href=&quot;https://segmentfault.com/a/1190000021047932&quot;&gt;ä¸ŠèŠ‚&lt;/a&gt;æ ¹æ®ä¸€çº§åˆ†ç±»æŸ¥è¯¢å­åˆ†ç±»ä¸€æ ·ï¼Œåœ¨é¡¹ç›®&lt;code&gt;mscx-shop-mapper&lt;/code&gt;ä¸­æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰å®ç°æ¥å£&lt;code&gt;com.liferunner.custom.ProductCustomMapper&lt;/code&gt;ï¼Œç„¶ååœ¨&lt;code&gt;resources\mapper\custom&lt;/code&gt;è·¯å¾„ä¸‹åŒæ­¥åˆ›å»ºxmlæ–‡ä»¶&lt;code&gt;mapper/custom/ProductCustomMapper.xml&lt;/code&gt;ï¼Œæ­¤æ—¶ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ä¸ŠèŠ‚ä¸­å·²ç»é…ç½®äº†å½“å‰æ–‡ä»¶å¤¹å¯ä»¥è¢«å®¹å™¨æ‰«æåˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ çš„æ–°çš„mapperå°±ä¼šåœ¨å¯åŠ¨æ—¶è¢«æ‰«æåŠ è½½ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;/**
 * ProductCustomMapper for : è‡ªå®šä¹‰å•†å“Mapper
 */
public interface ProductCustomMapper {

    /***
     * æ ¹æ®ä¸€çº§åˆ†ç±»æŸ¥è¯¢å•†å“
     *
     * @param paramMap ä¼ é€’ä¸€çº§åˆ†ç±»ï¼ˆmapä¼ é€’å¤šå‚æ•°ï¼‰
     * @return java.util.List&amp;lt;com.liferunner.dto.IndexProductDTO&amp;gt;
     */
    List&amp;lt;IndexProductDTO&amp;gt; getIndexProductDtoList(@Param(&quot;paramMap&quot;) Map&amp;lt;String, Integer&amp;gt; paramMap);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
&amp;lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&amp;gt;
&amp;lt;mapper namespace=&quot;com.liferunner.custom.ProductCustomMapper&quot;&amp;gt;
    &amp;lt;resultMap id=&quot;IndexProductDTO&quot; type=&quot;com.liferunner.dto.IndexProductDTO&quot;&amp;gt;
        &amp;lt;id column=&quot;rootCategoryId&quot; property=&quot;rootCategoryId&quot;/&amp;gt;
        &amp;lt;result column=&quot;rootCategoryName&quot; property=&quot;rootCategoryName&quot;/&amp;gt;
        &amp;lt;result column=&quot;slogan&quot; property=&quot;slogan&quot;/&amp;gt;
        &amp;lt;result column=&quot;categoryImage&quot; property=&quot;categoryImage&quot;/&amp;gt;
        &amp;lt;result column=&quot;bgColor&quot; property=&quot;bgColor&quot;/&amp;gt;
        &amp;lt;collection property=&quot;productItemList&quot; ofType=&quot;com.liferunner.dto.IndexProductItemDTO&quot;&amp;gt;
            &amp;lt;id column=&quot;productId&quot; property=&quot;productId&quot;/&amp;gt;
            &amp;lt;result column=&quot;productName&quot; property=&quot;productName&quot;/&amp;gt;
            &amp;lt;result column=&quot;productMainImageUrl&quot; property=&quot;productMainImageUrl&quot;/&amp;gt;
            &amp;lt;result column=&quot;productCreateTime&quot; property=&quot;productCreateTime&quot;/&amp;gt;
        &amp;lt;/collection&amp;gt;
    &amp;lt;/resultMap&amp;gt;
    &amp;lt;select id=&quot;getIndexProductDtoList&quot; resultMap=&quot;IndexProductDTO&quot; parameterType=&quot;Map&quot;&amp;gt;
        SELECT
        c.id as rootCategoryId,
        c.name as rootCategoryName,
        c.slogan as slogan,
        c.category_image as categoryImage,
        c.bg_color as bgColor,
        p.id as productId,
        p.product_name as productName,
        pi.url as productMainImageUrl,
        p.created_time as productCreateTime
        FROM category c
        LEFT JOIN products p
        ON c.id = p.root_category_id
        LEFT JOIN products_img pi
        ON p.id = pi.product_id
        WHERE c.type = 1
        AND p.root_category_id = #{paramMap.rootCategoryId}
        AND pi.is_main = 1
        LIMIT 0,10;
    &amp;lt;/select&amp;gt;
&amp;lt;/mapper&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;serviceå®ç°&quot;&gt;Serviceå®ç°&lt;/h4&gt;
&lt;p&gt;åœ¨&lt;code&gt;service&lt;/code&gt;project åˆ›å»º&lt;code&gt;com.liferunner.service.IProductServiceæ¥å£&lt;/code&gt;ä»¥åŠå…¶å®ç°ç±»&lt;code&gt;com.liferunner.service.impl.ProductServiceImpl&lt;/code&gt;,æ·»åŠ æŸ¥è¯¢æ–¹æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public interface IProductService {

    /**
     * æ ¹æ®ä¸€çº§åˆ†ç±»idè·å–é¦–é¡µæ¨èçš„å•†å“list
     *
     * @param rootCategoryId ä¸€çº§åˆ†ç±»id
     * @return å•†å“list
     */
    List&amp;lt;IndexProductDTO&amp;gt; getIndexProductDtoList(Integer rootCategoryId);
    ...
}

---
    
@Slf4j
@Service
@RequiredArgsConstructor(onConstructor = @__(@Autowired))
public class ProductServiceImpl implements IProductService {

    // RequiredArgsConstructor æ„é€ å™¨æ³¨å…¥
    private final ProductCustomMapper productCustomMapper;

    @Transactional(propagation = Propagation.SUPPORTS)
    @Override
    public List&amp;lt;IndexProductDTO&amp;gt; getIndexProductDtoList(Integer rootCategoryId) {
        log.info(&quot;====== ProductServiceImpl#getIndexProductDtoList(rootCategoryId) : {}=======&quot;, rootCategoryId);
        Map&amp;lt;String, Integer&amp;gt; map = new HashMap&amp;lt;&amp;gt;();
        map.put(&quot;rootCategoryId&quot;, rootCategoryId);
        val indexProductDtoList = this.productCustomMapper.getIndexProductDtoList(map);
        if (CollectionUtils.isEmpty(indexProductDtoList)) {
            log.warn(&quot;ProductServiceImpl#getIndexProductDtoListæœªæŸ¥è¯¢åˆ°ä»»ä½•å•†å“ä¿¡æ¯&quot;);
        }
        log.info(&quot;æŸ¥è¯¢ç»“æœï¼š{}&quot;, indexProductDtoList);
        return indexProductDtoList;
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;controllerå®ç°&quot;&gt;Controllerå®ç°&lt;/h4&gt;
&lt;p&gt;æ¥ç€ï¼Œåœ¨&lt;code&gt;com.liferunner.api.controller.IndexController&lt;/code&gt;ä¸­å®ç°å¯¹å¤–æš´éœ²çš„æŸ¥è¯¢æ¥å£ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;@RestController
@RequestMapping(&quot;/index&quot;)
@Api(value = &quot;é¦–é¡µä¿¡æ¯controller&quot;, tags = &quot;é¦–é¡µä¿¡æ¯æ¥å£API&quot;)
@Slf4j
public class IndexController {
    ...
    @Autowired
    private IProductService productService;

    @GetMapping(&quot;/rootCategorys&quot;)
    @ApiOperation(value = &quot;æŸ¥è¯¢ä¸€çº§åˆ†ç±»&quot;, notes = &quot;æŸ¥è¯¢ä¸€çº§åˆ†ç±»&quot;)
    public JsonResponse findAllRootCategorys() {
        log.info(&quot;============æŸ¥è¯¢ä¸€çº§åˆ†ç±»==============&quot;);
        val categoryResponseDTOS = this.categoryService.getAllRootCategorys();
        if (CollectionUtils.isEmpty(categoryResponseDTOS)) {
            log.info(&quot;============æœªæŸ¥è¯¢åˆ°ä»»ä½•åˆ†ç±»==============&quot;);
            return JsonResponse.ok(Collections.EMPTY_LIST);
        }
        log.info(&quot;============ä¸€çº§åˆ†ç±»æŸ¥è¯¢resultï¼š{}==============&quot;, categoryResponseDTOS);
        return JsonResponse.ok(categoryResponseDTOS);
    }
    ...
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;test-api&quot;&gt;Test API&lt;/h4&gt;
&lt;p&gt;ç¼–å†™å®Œæˆä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å¯¹æˆ‘ä»¬çš„ä»£ç è¿›è¡Œæµ‹è¯•éªŒè¯ï¼Œè¿˜æ˜¯é€šè¿‡ä½¿ç”¨&lt;code&gt;RestService&lt;/code&gt;æ’ä»¶æ¥å®ç°ï¼Œå½“ç„¶ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥é€šè¿‡Postmanæ¥æµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/48397/201911/48397-20191122075924996-1852241189.png&quot; alt=&quot;æ ¹æ®ä¸€çº§åˆ†ç±»æŸ¥è¯¢å•†å“åˆ—è¡¨&quot;/&gt;&lt;/p&gt;

&lt;p&gt;å¦‚å¼€æ–‡ä¹‹åˆæˆ‘ä»¬çœ‹åˆ°çš„äº¬ä¸œå•†å“åˆ—è¡¨ä¸€æ ·ï¼Œæˆ‘ä»¬å…ˆåˆ†æä¸€ä¸‹åœ¨å•†å“åˆ—è¡¨é¡µé¢éƒ½éœ€è¦å“ªäº›å…ƒç´ ä¿¡æ¯ï¼Ÿ&lt;/p&gt;
&lt;h2 id=&quot;å¼€å‘æ¢³ç†-1&quot;&gt;å¼€å‘æ¢³ç†&lt;/h2&gt;
&lt;p&gt;å•†å“åˆ—è¡¨çš„å±•ç¤ºæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„åˆ†æï¼Œæ€»å…±åˆ†ä¸º2å¤§ç±»:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;é€‰æ‹©å•†å“åˆ†ç±»ä¹‹åï¼Œå±•ç¤ºå½“å‰åˆ†ç±»ä¸‹æ‰€æœ‰å•†å“&lt;/li&gt;
&lt;li&gt;è¾“å…¥æœç´¢å…³é”®è¯åï¼Œå±•ç¤ºå½“å‰æœç´¢åˆ°ç›¸å…³çš„æ‰€æœ‰å•†å“&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;åœ¨è¿™ä¸¤ç±»ä¸­å±•ç¤ºçš„å•†å“åˆ—è¡¨æ•°æ®ï¼Œé™¤äº†æ•°æ®æ¥æºä¸åŒä»¥å¤–ï¼Œå…¶ä»–å…ƒç´ åŸºæœ¬éƒ½ä¿æŒä¸€è‡´ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥ä½¿ç”¨ç»Ÿä¸€çš„æ¥å£æ¥æ ¹æ®å‚æ•°å®ç°éš”ç¦»å‘¢ï¼Ÿ ç†è®ºä¸Šä¸å­˜åœ¨é—®é¢˜ï¼Œå®Œå…¨å¯ä»¥é€šè¿‡ä¼ å‚åˆ¤æ–­çš„æ–¹å¼è¿›è¡Œæ•°æ®å›ä¼ ï¼Œä½†æ˜¯ï¼Œåœ¨æˆ‘ä»¬å®ç°ä¸€äº›å¯é¢„è§çš„åŠŸèƒ½éœ€æ±‚æ—¶ï¼Œä¸€å®šè¦ç»™è‡ªå·±çš„å¼€å‘é¢„ç•™åè·¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„&lt;code&gt;å¯æ‹“å±•æ€§&lt;/code&gt;ï¼ŒåŸºäºæ­¤ï¼Œæˆ‘ä»¬ä¼šåˆ†å¼€å®ç°å„è‡ªçš„æ¥å£ï¼Œä»¥ä¾¿äºåæœŸçš„æ‰©å±•ã€‚&lt;br/&gt;æ¥ç€æ¥åˆ†æåœ¨åˆ—è¡¨é¡µä¸­æˆ‘ä»¬éœ€è¦å±•ç¤ºçš„å…ƒç´ ï¼Œé¦–å…ˆå› ä¸ºéœ€è¦åˆ†ä¸Šè¿°ä¸¤ç§æƒ…å†µï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬APIè®¾è®¡çš„æ—¶å€™åˆ†åˆ«å¤„ç†ï¼Œé’ˆå¯¹äº&lt;br/&gt;1.åˆ†ç±»çš„å•†å“åˆ—è¡¨å±•ç¤ºï¼Œéœ€è¦ä¼ å…¥çš„å‚æ•°æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;åˆ†ç±»id&lt;/li&gt;
&lt;li&gt;æ’åºï¼ˆåœ¨ç”µå•†åˆ—è¡¨æˆ‘ä»¬å¸¸è§çš„å‡ ç§æ’åºï¼ˆé”€é‡ï¼Œä»·æ ¼ç­‰ç­‰ï¼‰ï¼‰&lt;/li&gt;
&lt;li&gt;åˆ†é¡µç›¸å…³ï¼ˆå› ä¸ºæˆ‘ä»¬ä¸å¯èƒ½æŠŠæ•°æ®åº“ä¸­æ‰€æœ‰çš„å•†å“éƒ½å–å‡ºæ¥ï¼‰
&lt;ul&gt;&lt;li&gt;PageNumberï¼ˆå½“å‰ç¬¬å‡ é¡µï¼‰&lt;/li&gt;
&lt;li&gt;PageSizeï¼ˆæ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡æ•°æ®ï¼‰&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;2.å…³é”®è¯æŸ¥è¯¢å•†å“åˆ—è¡¨ï¼Œéœ€è¦ä¼ å…¥çš„å‚æ•°æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å…³é”®è¯&lt;/li&gt;
&lt;li&gt;æ’åºï¼ˆåœ¨ç”µå•†åˆ—è¡¨æˆ‘ä»¬å¸¸è§çš„å‡ ç§æ’åºï¼ˆé”€é‡ï¼Œä»·æ ¼ç­‰ç­‰ï¼‰ï¼‰&lt;/li&gt;
&lt;li&gt;åˆ†é¡µç›¸å…³ï¼ˆå› ä¸ºæˆ‘ä»¬ä¸å¯èƒ½æŠŠæ•°æ®åº“ä¸­æ‰€æœ‰çš„å•†å“éƒ½å–å‡ºæ¥ï¼‰
&lt;ul&gt;&lt;li&gt;PageNumberï¼ˆå½“å‰ç¬¬å‡ é¡µï¼‰&lt;/li&gt;
&lt;li&gt;PageSizeï¼ˆæ¯é¡µæ˜¾ç¤ºå¤šå°‘æ¡æ•°æ®ï¼‰&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;éœ€è¦åœ¨é¡µé¢å±•ç¤ºçš„ä¿¡æ¯æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å•†å“id(ç”¨äºè·³è½¬å•†å“è¯¦æƒ…ä½¿ç”¨)&lt;/li&gt;
&lt;li&gt;å•†å“åç§°&lt;/li&gt;
&lt;li&gt;å•†å“ä»·æ ¼&lt;/li&gt;
&lt;li&gt;å•†å“é”€é‡&lt;/li&gt;
&lt;li&gt;å•†å“å›¾ç‰‡&lt;/li&gt;
&lt;li&gt;å•†å“ä¼˜æƒ &lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;ç¼–ç å®ç°-1&quot;&gt;ç¼–ç å®ç°&lt;/h2&gt;
&lt;p&gt;æ ¹æ®ä¸Šé¢æˆ‘ä»¬çš„åˆ†æï¼Œæ¥ä¸‹æ¥å¼€å§‹æˆ‘ä»¬çš„ç¼–ç ï¼š&lt;/p&gt;
&lt;h3 id=&quot;æ ¹æ®å•†å“åˆ†ç±»æŸ¥è¯¢&quot;&gt;æ ¹æ®å•†å“åˆ†ç±»æŸ¥è¯¢&lt;/h3&gt;
&lt;p&gt;æ ¹æ®æˆ‘ä»¬çš„åˆ†æï¼Œè‚¯å®šä¸ä¼šåœ¨ä¸€å¼ è¡¨ä¸­æŠŠæ‰€æœ‰æ•°æ®è·å–å…¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è¿›è¡Œå¤šè¡¨è”æŸ¥ï¼Œæ•…æˆ‘ä»¬éœ€è¦åœ¨è‡ªå®šä¹‰mapperä¸­å®ç°æˆ‘ä»¬çš„åŠŸèƒ½æŸ¥è¯¢.&lt;/p&gt;
&lt;h4 id=&quot;responsedto-å®ç°&quot;&gt;ResponseDTO å®ç°&lt;/h4&gt;
&lt;p&gt;æ ¹æ®æˆ‘ä»¬å‰é¢åˆ†æçš„å‰ç«¯éœ€è¦å±•ç¤ºçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªç”¨äºå±•ç¤ºè¿™äº›ä¿¡æ¯çš„å¯¹è±¡&lt;code&gt;com.liferunner.dto.SearchProductDTO&lt;/code&gt;ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class SearchProductDTO {
    private String productId;
    private String productName;
    private Integer sellCounts;
    private String imgUrl;
    private Integer priceDiscount;
    //å•†å“ä¼˜æƒ ï¼Œæˆ‘ä»¬ç›´æ¥è®¡ç®—ä¹‹åè¿”å›ä¼˜æƒ åä»·æ ¼
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;custom-mapper-å®ç°&quot;&gt;Custom Mapper å®ç°&lt;/h4&gt;
&lt;p&gt;åœ¨&lt;code&gt;com.liferunner.custom.ProductCustomMapper.java&lt;/code&gt;ä¸­æ–°å¢ä¸€ä¸ªæ–¹æ³•æ¥å£ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;    List&amp;lt;SearchProductDTO&amp;gt; searchProductListByCategoryId(@Param(&quot;paramMap&quot;) Map&amp;lt;String, Object&amp;gt; paramMap);&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åŒæ—¶ï¼Œåœ¨&lt;code&gt;mapper/custom/ProductCustomMapper.xml&lt;/code&gt;ä¸­å®ç°æˆ‘ä»¬çš„æŸ¥è¯¢æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;select id=&quot;searchProductListByCategoryId&quot; resultType=&quot;com.liferunner.dto.SearchProductDTO&quot; parameterType=&quot;Map&quot;&amp;gt;
        SELECT
        p.id as productId,
        p.product_name as productName,
        p.sell_counts as sellCounts,
        pi.url as imgUrl,
        tp.priceDiscount
        FROM products p
        LEFT JOIN products_img pi
        ON p.id = pi.product_id
        LEFT JOIN
        (
        SELECT product_id, MIN(price_discount) as priceDiscount
        FROM products_spec
        GROUP BY product_id
        ) tp
        ON tp.product_id = p.id
        WHERE pi.is_main = 1
        AND p.category_id = #{paramMap.categoryId}
        ORDER BY
        &amp;lt;choose&amp;gt;
            &amp;lt;when test=&quot;paramMap.sortby != null and paramMap.sortby == 'sell'&quot;&amp;gt;
                p.sell_counts DESC
            &amp;lt;/when&amp;gt;
            &amp;lt;when test=&quot;paramMap.sortby != null and paramMap.sortby == 'price'&quot;&amp;gt;
                tp.priceDiscount ASC
            &amp;lt;/when&amp;gt;
            &amp;lt;otherwise&amp;gt;
                p.created_time DESC
            &amp;lt;/otherwise&amp;gt;
        &amp;lt;/choose&amp;gt;
    &amp;lt;/select&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸»è¦æ¥è¯´æ˜ä¸€ä¸‹è¿™é‡Œçš„&lt;code&gt;&amp;lt;choose&amp;gt;&lt;/code&gt;æ¨¡å—ï¼Œä»¥åŠä¸ºä»€ä¹ˆä¸ä½¿ç”¨&lt;code&gt;if&lt;/code&gt;æ ‡ç­¾ã€‚&lt;br/&gt;åœ¨æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›æ‰€æœ‰çš„æ¡ä»¶éƒ½åŒæ—¶ç”Ÿæ•ˆï¼Œè€Œåªæ˜¯æƒ³ä»å¤šä¸ªé€‰é¡¹ä¸­é€‰æ‹©ä¸€ä¸ªï¼Œä½†æ˜¯åœ¨ä½¿ç”¨&lt;code&gt;IF&lt;/code&gt;æ ‡ç­¾æ—¶ï¼Œåªè¦&lt;code&gt;test&lt;/code&gt;ä¸­çš„è¡¨è¾¾å¼ä¸º &lt;code&gt;true&lt;/code&gt;ï¼Œå°±ä¼šæ‰§è¡Œ&lt;code&gt;IF&lt;/code&gt; æ ‡ç­¾ä¸­çš„æ¡ä»¶ã€‚MyBatis æä¾›äº† &lt;code&gt;choose&lt;/code&gt; å…ƒç´ ã€‚&lt;code&gt;IF&lt;/code&gt;æ ‡ç­¾æ˜¯&lt;code&gt;ä¸(and)&lt;/code&gt;çš„å…³ç³»ï¼Œè€Œ choose æ˜¯&lt;code&gt;æˆ–(or)&lt;/code&gt;çš„å…³ç³»ã€‚&lt;br/&gt;å®ƒçš„é€‰æ‹©æ˜¯æŒ‰ç…§é¡ºåºè‡ªä¸Šè€Œä¸‹ï¼Œä¸€æ—¦æœ‰ä»»ä½•ä¸€ä¸ªæ»¡è¶³æ¡ä»¶ï¼Œåˆ™é€‰æ‹©é€€å‡ºã€‚&lt;/p&gt;
&lt;h4 id=&quot;service-å®ç°&quot;&gt;Service å®ç°&lt;/h4&gt;
&lt;p&gt;ç„¶ååœ¨service&lt;code&gt;com.liferunner.service.IProductService&lt;/code&gt;ä¸­æ·»åŠ æ–¹æ³•æ¥å£ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;    /**
     * æ ¹æ®å•†å“åˆ†ç±»æŸ¥è¯¢å•†å“åˆ—è¡¨
     *
     * @param categoryId åˆ†ç±»id
     * @param sortby     æ’åºæ–¹å¼
     * @param pageNumber å½“å‰é¡µç 
     * @param pageSize   æ¯é¡µå±•ç¤ºå¤šå°‘æ¡æ•°æ®
     * @return é€šç”¨åˆ†é¡µç»“æœè§†å›¾
     */
    CommonPagedResult searchProductList(Integer categoryId, String sortby, Integer pageNumber, Integer pageSize);&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨å®ç°ç±»&lt;code&gt;com.liferunner.service.impl.ProductServiceImpl&lt;/code&gt;ä¸­ï¼Œå®ç°ä¸Šè¿°æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;    // æ–¹æ³•é‡è½½
    @Override
    public CommonPagedResult searchProductList(Integer categoryId, String sortby, Integer pageNumber, Integer pageSize) {
        Map&amp;lt;String, Object&amp;gt; paramMap = new HashMap&amp;lt;&amp;gt;();
        paramMap.put(&quot;categoryId&quot;, categoryId);
        paramMap.put(&quot;sortby&quot;, sortby);
        // mybatis-pagehelper
        PageHelper.startPage(pageNumber, pageSize);
        val searchProductDTOS = this.productCustomMapper.searchProductListByCategoryId(paramMap);
        // è·å–mybatisæ’ä»¶ä¸­è·å–åˆ°ä¿¡æ¯
        PageInfo&amp;lt;?&amp;gt; pageInfo = new PageInfo&amp;lt;&amp;gt;(searchProductDTOS);
        // å°è£…ä¸ºè¿”å›åˆ°å‰ç«¯åˆ†é¡µç»„ä»¶å¯è¯†åˆ«çš„è§†å›¾
        val commonPagedResult = CommonPagedResult.builder()
                .pageNumber(pageNumber)
                .rows(searchProductDTOS)
                .totalPage(pageInfo.getPages())
                .records(pageInfo.getTotal())
                .build();
        return commonPagedResult;
    }&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ°äº†ä¸€ä¸ª&lt;code&gt;mybatis-pagehelper&lt;/code&gt;æ’ä»¶ï¼Œä¼šåœ¨ä¸‹é¢çš„ç¦åˆ©è®²è§£ä¸­åˆ†è§£ã€‚&lt;/p&gt;
&lt;h4 id=&quot;controller-å®ç°&quot;&gt;Controller å®ç°&lt;/h4&gt;
&lt;p&gt;ç»§ç»­åœ¨&lt;code&gt;com.liferunner.api.controller.ProductController&lt;/code&gt;ä¸­æ·»åŠ å¯¹å¤–æš´éœ²çš„æ¥å£APIï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;@GetMapping(&quot;/searchByCategoryId&quot;)
    @ApiOperation(value = &quot;æŸ¥è¯¢å•†å“ä¿¡æ¯åˆ—è¡¨&quot;, notes = &quot;æ ¹æ®å•†å“åˆ†ç±»æŸ¥è¯¢å•†å“åˆ—è¡¨&quot;)
    public JsonResponse searchProductListByCategoryId(
        @ApiParam(name = &quot;categoryId&quot;, value = &quot;å•†å“åˆ†ç±»id&quot;, required = true, example = &quot;0&quot;)
        @RequestParam Integer categoryId,
        @ApiParam(name = &quot;sortby&quot;, value = &quot;æ’åºæ–¹å¼&quot;, required = false)
        @RequestParam String sortby,
        @ApiParam(name = &quot;pageNumber&quot;, value = &quot;å½“å‰é¡µç &quot;, required = false, example = &quot;1&quot;)
        @RequestParam Integer pageNumber,
        @ApiParam(name = &quot;pageSize&quot;, value = &quot;æ¯é¡µå±•ç¤ºè®°å½•æ•°&quot;, required = false, example = &quot;10&quot;)
        @RequestParam Integer pageSize
    ) {
        if (null == categoryId || categoryId == 0) {
            return JsonResponse.errorMsg(&quot;åˆ†ç±»idé”™è¯¯ï¼&quot;);
        }
        if (null == pageNumber || 0 == pageNumber) {
            pageNumber = DEFAULT_PAGE_NUMBER;
        }
        if (null == pageSize || 0 == pageSize) {
            pageSize = DEFAULT_PAGE_SIZE;
        }
        log.info(&quot;============æ ¹æ®åˆ†ç±»:{} æœç´¢åˆ—è¡¨==============&quot;, categoryId);

        val searchResult = this.productService.searchProductList(categoryId, sortby, pageNumber, pageSize);
        return JsonResponse.ok(searchResult);
    }&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬çš„è¯·æ±‚ä¸­ï¼Œåªä¼šè¦æ±‚å•†å“åˆ†ç±»idæ˜¯å¿…å¡«é¡¹ï¼Œå…¶ä½™çš„è°ƒç”¨æ–¹éƒ½å¯ä»¥ä¸æä¾›ï¼Œä½†æ˜¯å¦‚æœä¸æä¾›çš„è¯ï¼Œæˆ‘ä»¬ç³»ç»Ÿå°±éœ€è¦ç»™å®šä¸€äº›é»˜è®¤çš„å‚æ•°æ¥ä¿è¯æˆ‘ä»¬çš„ç³»ç»Ÿæ­£å¸¸ç¨³å®šçš„è¿è¡Œï¼Œå› æ­¤ï¼Œæˆ‘å®šä¹‰äº†&lt;code&gt;com.liferunner.api.controller.BaseController&lt;/code&gt;,ç”¨äºå­˜å‚¨ä¸€äº›å…¬å…±çš„é…ç½®ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;/**
 * BaseController for : controller åŸºç±»
 */
@Controller
public class BaseController {
    /**
     * é»˜è®¤å±•ç¤ºç¬¬1é¡µ
     */
    public final Integer DEFAULT_PAGE_NUMBER = 1;
    /**
     * é»˜è®¤æ¯é¡µå±•ç¤º10æ¡æ•°æ®
     */
    public final Integer DEFAULT_PAGE_SIZE = 10;
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;test-api-1&quot;&gt;Test API&lt;/h4&gt;
&lt;p&gt;æµ‹è¯•çš„å‚æ•°åˆ†åˆ«æ˜¯ï¼šcategoryId : 51 ï¼Œsortby : priceï¼ŒpageNumber : 1ï¼ŒpageSize : 5&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/48397/201911/48397-20191122075925210-760122496.png&quot; alt=&quot;æ ¹æ®åˆ†ç±»idæŸ¥è¯¢&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æŸ¥è¯¢åˆ°7æ¡æ•°æ®ï¼Œæ€»é¡µæ•°&lt;code&gt;totalPage&lt;/code&gt;ä¸º2ï¼Œå¹¶ä¸”æ ¹æ®ä»·æ ¼ä»å°åˆ°å¤§è¿›è¡Œäº†æ’åºï¼Œè¯æ˜æˆ‘ä»¬çš„ç¼–ç æ˜¯æ­£ç¡®çš„ã€‚æ¥ä¸‹æ¥ï¼Œé€šè¿‡ç›¸åŒçš„ä»£ç é€»è¾‘ï¼Œæˆ‘ä»¬ç»§ç»­å®ç°æ ¹æ®æœç´¢å…³é”®è¯è¿›è¡ŒæŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ ¹æ®å…³é”®è¯æŸ¥è¯¢&quot;&gt;æ ¹æ®å…³é”®è¯æŸ¥è¯¢&lt;/h3&gt;
&lt;h4 id=&quot;response-dto-å®ç°&quot;&gt;Response DTO å®ç°&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨ä¸Šé¢å®ç°çš„&lt;code&gt;com.liferunner.dto.SearchProductDTO&lt;/code&gt;.&lt;/p&gt;
&lt;h4 id=&quot;custom-mapper-å®ç°-1&quot;&gt;Custom Mapper å®ç°&lt;/h4&gt;
&lt;p&gt;åœ¨&lt;code&gt;com.liferunner.custom.ProductCustomMapper&lt;/code&gt;ä¸­æ–°å¢æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;List&amp;lt;SearchProductDTO&amp;gt; searchProductList(@Param(&quot;paramMap&quot;) Map&amp;lt;String, Object&amp;gt; paramMap);&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨&lt;code&gt;mapper/custom/ProductCustomMapper.xml&lt;/code&gt;ä¸­æ·»åŠ æŸ¥è¯¢SQLï¼š&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;select id=&quot;searchProductList&quot; resultType=&quot;com.liferunner.dto.SearchProductDTO&quot; parameterType=&quot;Map&quot;&amp;gt;
        SELECT
        p.id as productId,
        p.product_name as productName,
        p.sell_counts as sellCounts,
        pi.url as imgUrl,
        tp.priceDiscount
        FROM products p
        LEFT JOIN products_img pi
        ON p.id = pi.product_id
        LEFT JOIN
        (
        SELECT product_id, MIN(price_discount) as priceDiscount
        FROM products_spec
        GROUP BY product_id
        ) tp
        ON tp.product_id = p.id
        WHERE pi.is_main = 1
        &amp;lt;if test=&quot;paramMap.keyword != null and paramMap.keyword != ''&quot;&amp;gt;
            AND p.item_name LIKE &quot;%${paramMap.keyword}%&quot;
        &amp;lt;/if&amp;gt;
        ORDER BY
        &amp;lt;choose&amp;gt;
            &amp;lt;when test=&quot;paramMap.sortby != null and paramMap.sortby == 'sell'&quot;&amp;gt;
                p.sell_counts DESC
            &amp;lt;/when&amp;gt;
            &amp;lt;when test=&quot;paramMap.sortby != null and paramMap.sortby == 'price'&quot;&amp;gt;
                tp.priceDiscount ASC
            &amp;lt;/when&amp;gt;
            &amp;lt;otherwise&amp;gt;
                p.created_time DESC
            &amp;lt;/otherwise&amp;gt;
        &amp;lt;/choose&amp;gt;
    &amp;lt;/select&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;service-å®ç°-1&quot;&gt;Service å®ç°&lt;/h4&gt;
&lt;p&gt;åœ¨&lt;code&gt;com.liferunner.service.IProductService&lt;/code&gt;ä¸­æ–°å¢æŸ¥è¯¢æ¥å£ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;    /**
     * æŸ¥è¯¢å•†å“åˆ—è¡¨
     *
     * @param keyword    æŸ¥è¯¢å…³é”®è¯
     * @param sortby     æ’åºæ–¹å¼
     * @param pageNumber å½“å‰é¡µç 
     * @param pageSize   æ¯é¡µå±•ç¤ºå¤šå°‘æ¡æ•°æ®
     * @return é€šç”¨åˆ†é¡µç»“æœè§†å›¾
     */
    CommonPagedResult searchProductList(String keyword, String sortby, Integer pageNumber, Integer pageSize);&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨&lt;code&gt;com.liferunner.service.impl.ProductServiceImpl&lt;/code&gt;å®ç°ä¸Šè¿°æ¥å£æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;    @Override
    public CommonPagedResult searchProductList(String keyword, String sortby, Integer pageNumber, Integer pageSize) {
        Map&amp;lt;String, Object&amp;gt; paramMap = new HashMap&amp;lt;&amp;gt;();
        paramMap.put(&quot;keyword&quot;, keyword);
        paramMap.put(&quot;sortby&quot;, sortby);
        // mybatis-pagehelper
        PageHelper.startPage(pageNumber, pageSize);
        val searchProductDTOS = this.productCustomMapper.searchProductList(paramMap);
        // è·å–mybatisæ’ä»¶ä¸­è·å–åˆ°ä¿¡æ¯
        PageInfo&amp;lt;?&amp;gt; pageInfo = new PageInfo&amp;lt;&amp;gt;(searchProductDTOS);
        // å°è£…ä¸ºè¿”å›åˆ°å‰ç«¯åˆ†é¡µç»„ä»¶å¯è¯†åˆ«çš„è§†å›¾
        val commonPagedResult = CommonPagedResult.builder()
                .pageNumber(pageNumber)
                .rows(searchProductDTOS)
                .totalPage(pageInfo.getPages())
                .records(pageInfo.getTotal())
                .build();
        return commonPagedResult;
    }&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸Šè¿°æ–¹æ³•å’Œä¹‹å‰&lt;code&gt;searchProductList(Integer categoryId, String sortby, Integer pageNumber, Integer pageSize)&lt;/code&gt;å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å®ƒæ˜¯è‚¯å®šæœç´¢å…³é”®è¯æ¥è¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œä½¿ç”¨é‡è½½çš„ç›®çš„æ˜¯ä¸ºäº†æˆ‘ä»¬åç»­ä¸åŒç±»å‹çš„ä¸šåŠ¡æ‰©å±•è€Œè€ƒè™‘çš„ã€‚&lt;/p&gt;
&lt;h4 id=&quot;controller-å®ç°-1&quot;&gt;Controller å®ç°&lt;/h4&gt;
&lt;p&gt;åœ¨&lt;code&gt;com.liferunner.api.controller.ProductController&lt;/code&gt;ä¸­æ·»åŠ å…³é”®è¯æœç´¢APIï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;    @GetMapping(&quot;/search&quot;)
    @ApiOperation(value = &quot;æŸ¥è¯¢å•†å“ä¿¡æ¯åˆ—è¡¨&quot;, notes = &quot;æŸ¥è¯¢å•†å“ä¿¡æ¯åˆ—è¡¨&quot;)
    public JsonResponse searchProductList(
        @ApiParam(name = &quot;keyword&quot;, value = &quot;æœç´¢å…³é”®è¯&quot;, required = true)
        @RequestParam String keyword,
        @ApiParam(name = &quot;sortby&quot;, value = &quot;æ’åºæ–¹å¼&quot;, required = false)
        @RequestParam String sortby,
        @ApiParam(name = &quot;pageNumber&quot;, value = &quot;å½“å‰é¡µç &quot;, required = false, example = &quot;1&quot;)
        @RequestParam Integer pageNumber,
        @ApiParam(name = &quot;pageSize&quot;, value = &quot;æ¯é¡µå±•ç¤ºè®°å½•æ•°&quot;, required = false, example = &quot;10&quot;)
        @RequestParam Integer pageSize
    ) {
        if (StringUtils.isBlank(keyword)) {
            return JsonResponse.errorMsg(&quot;æœç´¢å…³é”®è¯ä¸èƒ½ä¸ºç©ºï¼&quot;);
        }
        if (null == pageNumber || 0 == pageNumber) {
            pageNumber = DEFAULT_PAGE_NUMBER;
        }
        if (null == pageSize || 0 == pageSize) {
            pageSize = DEFAULT_PAGE_SIZE;
        }
        log.info(&quot;============æ ¹æ®å…³é”®è¯:{} æœç´¢åˆ—è¡¨==============&quot;, keyword);

        val searchResult = this.productService.searchProductList(keyword, sortby, pageNumber, pageSize);
        return JsonResponse.ok(searchResult);
    }&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;test-api-2&quot;&gt;Test API&lt;/h4&gt;
&lt;p&gt;æµ‹è¯•å‚æ•°ï¼škeyword : è¥¿å‡¤ï¼Œsortby : sellï¼ŒpageNumber : 1ï¼ŒpageSize : 10&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/48397/201911/48397-20191122075925650-1726770316.png&quot; alt=&quot;æµ‹è¯•å…³é”®è¯ç»“æœ&quot;/&gt;&lt;br/&gt;æ ¹æ®é”€é‡æ’åºæ­£å¸¸ï¼ŒæŸ¥è¯¢å…³é”®è¯æ­£å¸¸ï¼Œæ€»æ¡æ•°32ï¼Œæ¯é¡µ10æ¡ï¼Œæ€»å…±3é¡µæ­£å¸¸ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æœ¬èŠ‚ç¼–ç å®ç°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ°äº†ä¸€ä¸ªé€šç”¨çš„mybatisåˆ†é¡µæ’ä»¶&lt;code&gt;mybatis-pagehelper&lt;/code&gt;,æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹è¿™ä¸ªæ’ä»¶çš„åŸºæœ¬æƒ…å†µã€‚&lt;/p&gt;
&lt;h2 id=&quot;mybatis-pagehelper&quot;&gt;&lt;code&gt;mybatis-pagehelper&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;å¦‚æœå„ä½å°ä¼™ä¼´ä½¿ç”¨è¿‡ï¼š&lt;a href=&quot;https://pagehelper.github.io/&quot;&gt;MyBatis åˆ†é¡µæ’ä»¶ PageHelper&lt;/a&gt;, é‚£ä¹ˆå¯¹äºè¿™ä¸ªå°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œå®ƒå…¶å®å°±æ˜¯åŸºäº&lt;a href=&quot;https://pagehelper.github.io/docs/interceptor/&quot;&gt;Executor æ‹¦æˆªå™¨&lt;/a&gt;æ¥å®ç°çš„ï¼Œå½“æ‹¦æˆªåˆ°åŸå§‹SQLä¹‹åï¼Œå¯¹SQLè¿›è¡Œä¸€æ¬¡æ”¹é€ å¤„ç†ã€‚&lt;br/&gt;æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬è‡ªå·±ä»£ç ä¸­çš„å®ç°ï¼Œæ ¹æ®springbootç¼–ç ä¸‰éƒ¨æ›²ï¼š&lt;/p&gt;
&lt;p&gt;1.æ·»åŠ ä¾èµ–&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;        &amp;lt;!-- å¼•å…¥mybatis-pagehelper æ’ä»¶--&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;com.github.pagehelper&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;pagehelper-spring-boot-starter&amp;lt;/artifactId&amp;gt;
            &amp;lt;version&amp;gt;1.2.12&amp;lt;/version&amp;gt;
        &amp;lt;/dependency&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æœ‰åŒå­¦å°±è¦é—®äº†ï¼Œä¸ºä»€ä¹ˆå¼•å…¥çš„è¿™ä¸ªä¾èµ–å’Œæˆ‘åŸæ¥ä½¿ç”¨çš„ä¸åŒï¼Ÿä»¥å‰ä½¿ç”¨çš„æ˜¯ï¼š&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;com.github.pagehelper&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;pagehelper&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;5.1.10&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç­”æ¡ˆå°±åœ¨è¿™é‡Œï¼š&lt;a href=&quot;https://github.com/pagehelper&quot;&gt;ä¾èµ–ä¼ é€é—¨&lt;/a&gt;&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/48397/201911/48397-20191122075925846-1472508877.png&quot; alt=&quot;spring-boot-pagehelper&quot;/&gt;&lt;br/&gt;æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯springbootè¿›è¡Œçš„é¡¹ç›®å¼€å‘ï¼Œæ—¢ç„¶ä½¿ç”¨çš„æ˜¯springboot,é‚£æˆ‘ä»¬å®Œå…¨å¯ä»¥ç”¨åˆ°å®ƒçš„&lt;code&gt;è‡ªåŠ¨è£…é…&lt;/code&gt;ç‰¹æ€§,ä½œè€…å¸®æˆ‘ä»¬å®ç°äº†è¿™ä¹ˆä¸€ä¸ª&lt;a href=&quot;https://github.com/pagehelper/pagehelper-spring-boot&quot;&gt;è‡ªåŠ¨è£…é…çš„jar&lt;/a&gt;,æˆ‘ä»¬åªéœ€è¦å‚è€ƒç¤ºä¾‹æ¥ç¼–å†™å°±okäº†ã€‚&lt;/p&gt;
&lt;p&gt;2.æ”¹é…ç½®&lt;/p&gt;
&lt;pre class=&quot;yaml&quot;&gt;
&lt;code&gt;# mybatis åˆ†é¡µç»„ä»¶é…ç½®
pagehelper:
  helperDialect: mysql #æ’ä»¶æ”¯æŒ12ç§æ•°æ®åº“ï¼Œé€‰æ‹©ç±»å‹
  supportMethodsArguments: true&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;3.æ”¹ä»£ç &lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹ç¤ºä¾‹ä»£ç ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;    @Override
    public CommonPagedResult searchProductList(String keyword, String sortby, Integer pageNumber, Integer pageSize) {
        Map&amp;lt;String, Object&amp;gt; paramMap = new HashMap&amp;lt;&amp;gt;();
        paramMap.put(&quot;keyword&quot;, keyword);
        paramMap.put(&quot;sortby&quot;, sortby);
        // mybatis-pagehelper
        PageHelper.startPage(pageNumber, pageSize);
        val searchProductDTOS = this.productCustomMapper.searchProductList(paramMap);
        // è·å–mybatisæ’ä»¶ä¸­è·å–åˆ°ä¿¡æ¯
        PageInfo&amp;lt;?&amp;gt; pageInfo = new PageInfo&amp;lt;&amp;gt;(searchProductDTOS);
        // å°è£…ä¸ºè¿”å›åˆ°å‰ç«¯åˆ†é¡µç»„ä»¶å¯è¯†åˆ«çš„è§†å›¾
        val commonPagedResult = CommonPagedResult.builder()
                .pageNumber(pageNumber)
                .rows(searchProductDTOS)
                .totalPage(pageInfo.getPages())
                .records(pageInfo.getTotal())
                .build();
        return commonPagedResult;
    }&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬æŸ¥è¯¢æ•°æ®åº“ä¹‹å‰ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€å¥&lt;code&gt;PageHelper.startPage(pageNumber, pageSize);&lt;/code&gt;,å‘Šè¯‰mybatisæˆ‘ä»¬è¦å¯¹æŸ¥è¯¢è¿›è¡Œåˆ†é¡µå¤„ç†ï¼Œè¿™ä¸ªæ—¶å€™æ’ä»¶ä¼šå¯åŠ¨ä¸€ä¸ªæ‹¦æˆªå™¨&lt;code&gt;com.github.pagehelper.PageInterceptor&lt;/code&gt;,é’ˆå¯¹æ‰€æœ‰çš„&lt;code&gt;query&lt;/code&gt;è¿›è¡Œæ‹¦æˆªï¼Œæ·»åŠ è‡ªå®šä¹‰å‚æ•°å’Œæ·»åŠ æŸ¥è¯¢æ•°æ®æ€»æ•°ã€‚ï¼ˆåç»­æˆ‘ä»¬ä¼šæ‰“å°sqlæ¥è¯æ˜ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;å½“æŸ¥è¯¢åˆ°ç»“æœä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬æŸ¥è¯¢åˆ°çš„ç»“æœé€šçŸ¥ç»™æ’ä»¶ï¼Œä¹Ÿå°±æ˜¯&lt;code&gt;PageInfo&amp;lt;?&amp;gt; pageInfo = new PageInfo&amp;lt;&amp;gt;(searchProductDTOS);&lt;/code&gt;ï¼ˆ&lt;code&gt;com.github.pagehelper.PageInfo&lt;/code&gt;æ˜¯å¯¹æ’ä»¶é’ˆå¯¹åˆ†é¡µåšçš„ä¸€ä¸ªå±æ€§åŒ…è£…ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹&lt;a href=&quot;http://bbs.csdn.net/topics/360010907&quot;&gt;å±æ€§ä¼ é€é—¨&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è‡³æ­¤ï¼Œæˆ‘ä»¬çš„æ’ä»¶ä½¿ç”¨å°±å·²ç»ç»“æŸäº†ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨åé¢åˆå°è£…äº†ä¸€ä¸ªå¯¹è±¡æ¥å¯¹å¤–è¿›è¡Œè¿”å›ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æŸ¥è¯¢åˆ°çš„&lt;code&gt;PageInfo&lt;/code&gt;å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæˆ‘ä»¬å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†æ•°æ®ç»“æ„çš„ä¸€è‡´æ€§åšçš„ä¸€æ¬¡ç»“æ„å°è£…ï¼Œä½ ä¹Ÿå¯ä¸å®ç°è¯¥æ­¥éª¤ï¼Œéƒ½æ˜¯å¯¹ç»“æœæ²¡æœ‰ä»»ä½•å½±å“çš„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;sqlæ‰“å°å¯¹æ¯”&quot;&gt;SQLæ‰“å°å¯¹æ¯”&lt;/h2&gt;
&lt;pre class=&quot;shell&quot;&gt;
&lt;code&gt;2019-11-21 12:04:21 INFO  ProductController:134 - ============æ ¹æ®å…³é”®è¯:è¥¿å‡¤ æœç´¢åˆ—è¡¨==============
Creating a new SqlSession
SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@4ff449ba] was not registered for synchronization because synchronization is not active
JDBC Connection [HikariProxyConnection@1980420239 wrapping com.mysql.cj.jdbc.ConnectionImpl@563b22b1] will not be managed by Spring
==&amp;gt;  Preparing: SELECT count(0) FROM products p LEFT JOIN products_img pi ON p.id = pi.product_id LEFT JOIN (SELECT product_id, MIN(price_discount) AS priceDiscount FROM products_spec GROUP BY product_id) tp ON tp.product_id = p.id WHERE pi.is_main = 1 AND p.product_name LIKE &quot;%è¥¿å‡¤%&quot; 
==&amp;gt; Parameters: 
&amp;lt;==    Columns: count(0)
&amp;lt;==        Row: 32
&amp;lt;==      Total: 1
==&amp;gt;  Preparing: SELECT p.id as productId, p.product_name as productName, p.sell_counts as sellCounts, pi.url as imgUrl, tp.priceDiscount FROM product p LEFT JOIN products_img pi ON p.id = pi.product_id LEFT JOIN ( SELECT product_id, MIN(price_discount) as priceDiscount FROM products_spec GROUP BY product_id ) tp ON tp.product_id = p.id WHERE pi.is_main = 1 AND p.product_name LIKE &quot;%è¥¿å‡¤%&quot; ORDER BY p.sell_counts DESC LIMIT ? 
==&amp;gt; Parameters: 10(Integer)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„SQLä¸­å¤šäº†ä¸€ä¸ª&lt;code&gt;SELECT count(0)&lt;/code&gt;ï¼Œç¬¬äºŒæ¡SQLå¤šäº†ä¸€ä¸ª&lt;code&gt;LIMIT&lt;/code&gt;å‚æ•°ï¼Œåœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¾ˆæ˜ç¡®çš„çŸ¥é“ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰æ˜¾ç¤ºçš„å»æœç´¢æ€»æ•°å’ŒæŸ¥è¯¢æ¡æ•°ï¼Œå¯ä»¥ç¡®å®šå®ƒå°±æ˜¯æ’ä»¶å¸®æˆ‘ä»¬å®ç°çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/Isaac-Zhang/expensive-shop&quot;&gt;Github ä¼ é€é—¨&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://gitee.com/IsaacZhang/expensive-shop&quot;&gt;Gitee ä¼ é€é—¨&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†ç»§ç»­å¼€å‘å•†å“è¯¦æƒ…å±•ç¤ºä»¥åŠå•†å“è¯„ä»·ä¸šåŠ¡ï¼Œåœ¨è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„ä»»ä½•å¼€å‘ç»„ä»¶ï¼Œæˆ‘éƒ½ä¼šé€šè¿‡ä¸“é—¨çš„ä¸€èŠ‚æ¥è¿›è¡Œä»‹ç»çš„ï¼Œå…„å¼Ÿä»¬æœ«æ…Œï¼&lt;/p&gt;
&lt;p&gt;gogogoï¼&lt;/p&gt;
</description>
<pubDate>Thu, 21 Nov 2019 23:59:00 +0000</pubDate>
<dc:creator>IsaacZhang</dc:creator>
<og:description>ä¸Šæ–‡å›é¡¾ 'ä¸ŠèŠ‚' æˆ‘ä»¬å®ç°äº†ä»¿ çš„è½®æ’­å¹¿å‘Šä»¥åŠå•†å“åˆ†ç±»çš„åŠŸèƒ½ï¼Œå¹¶ä¸”è®²è§£äº†ä¸åŒçš„æ³¨å…¥æ–¹å¼ï¼Œæœ¬èŠ‚æˆ‘ä»¬å°†ç»§ç»­å®ç°æˆ‘ä»¬çš„ç”µå•†ä¸»ä¸šåŠ¡ï¼Œå•†å“ä¿¡æ¯çš„å±•ç¤ºã€‚ éœ€æ±‚åˆ†æ é¦–å…ˆï¼Œåœ¨æˆ‘ä»¬å¼€å§‹æœ¬èŠ‚ç¼–ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/zhangpan1244/p/11909515.html</dc:identifier>
</item>
<item>
<title>å¦‚ä½•æ•™ä¼šå¥³å‹é€’å½’ç®—æ³•ï¼Ÿ - å®œæ˜¥</title>
<link>http://www.cnblogs.com/yichunguo/p/11909512.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/yichunguo/p/11909512.html</guid>
<description>&lt;p&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20190904112822217.gif&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot;/&gt;&lt;br/&gt;ä¸€åˆ°å‘¨æœ«å°±å¼€å§‹æ”¾è¡è‡ªæˆ‘ï¼Œè¿™ä¸å¸¦ç€å¥³æœ‹å‹å»ä¸‡è¾¾ç”µå½±é™¢çœ‹ç”µå½±ï¼ˆå…¶å®æ˜¯ç”±äºæ•´å¤©å‘†åœ¨å®¶æ•²ä»£ç ç¡¬æ˜¯&lt;/p&gt;
&lt;p&gt;è¢«å¥³æœ‹å‹å¼ºè¡Œæ‹–æ‹½å»çœ‹ç”µå½±ï¼Œä½œä¸ºä¸€ä¸ªæœ‰ç†æƒ³çš„ç¨‹åºå‘˜ï¼Œæˆ‘æƒ³å„ä½åº”è¯¥éƒ½èƒ½ä½“è°…æˆ‘ï¼‰ï¼Œä¸€åˆ°ç”µå½±é™¢ï¼Œ&lt;/p&gt;
&lt;p&gt;å¥³æœ‹å‹è¯´è¦ä¹°çˆ†ç±³èŠ±å’Œå¯ä¹ï¼Œæˆ‘å½“æ—¶äºŒè¯æ²¡è¯´ï¼Œè‡£æœ¬å¸ƒè¡£èº¬è€•äºå—é˜³ï¼Œå£¤ä¸­ç¾æ¶©ï¼Œæ‰€ä»¥å•ä¹°äº†çˆ†ç±³&lt;/p&gt;
&lt;p&gt;èŠ±ï¼Œä¹°å®Œéƒ½ä¸å¸¦å›å¤´çœ‹è€æ¿çš„é‚£ç§ï¼Œé¥®æ–™å–å¤šäº†ä¸å¥½ï¼Œå‡ºé—¨çš„æ—¶å€™æˆ‘å¸¦äº†ç™½å¼€æ°´ï¼Œè¿˜å¾—äºæˆ‘é•¿å¾—é”€&lt;/p&gt;
&lt;p&gt;é­‚ï¼Œä¹ä¸€çœ‹å°±èƒ½çœ‹å‡ºæ˜¯ä¸ªç¤¾ä¼šç²¾ç¥å°ä¼™ï¼Œå¥³æœ‹å‹ä¹Ÿæ²¡å¤šè¯´ä»€ä¹ˆï¼Œåªæ˜¯å¯¹æˆ‘å¾®äº†å¾®ç¬‘ï¼ˆæˆ‘ä¼°è®¡æ˜¯è¢«æˆ‘çš„&lt;/p&gt;
&lt;p&gt;é¢œå€¼ä»¥åŠç‹¬åˆ°çš„è§è§£æ‰€æŠ˜æœï¼‰ï¼Œåˆšåä¸‹æ²¡å¤šä¹…ï¼Œå¥³æœ‹å‹çªç„¶é—®æˆ‘ï¼Œå’±ä»¬ç°åœ¨ååœ¨ç¬¬å‡ æ’å•Šï¼Ÿç”µå½±é™¢é‡Œ&lt;/p&gt;
&lt;p&gt;é¢å¤ªé»‘äº†ï¼Œçœ‹ä¸æ¸…ï¼Œæ²¡æ³•æ•°ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœæ˜¯ä½ ç°åœ¨ä½ æ€ä¹ˆåŠï¼Ÿåˆ«å¿˜äº†ä½ æˆ‘æ˜¯ç¨‹åºå‘˜ï¼Œè¿™ä¸ªå¯éš¾ä¸&lt;/p&gt;
&lt;p&gt;å€’æˆ‘ï¼Œé€’å½’å°±å¼€å§‹æ’ä¸Šç”¨åœºäº†ã€‚äºæ˜¯æˆ‘å°±é—®å‰é¢ä¸€æ’çš„äººä»–æ˜¯ç¬¬å‡ æ’ï¼Œä½ æƒ³åªè¦åœ¨ä»–çš„æ•°å­—ä¸ŠåŠ ä¸€ï¼Œ&lt;/p&gt;
&lt;p&gt;å°±çŸ¥é“è‡ªå·±åœ¨å“ªä¸€æ’äº†ã€‚ä½†æ˜¯ï¼Œå‰é¢çš„äººä¹Ÿçœ‹ä¸æ¸…å•Šï¼Œæ‰€ä»¥ä»–ä¹Ÿé—®ä»–å‰é¢çš„äººã€‚å°±è¿™æ ·ä¸€æ’ä¸€æ’å¾€å‰&lt;/p&gt;
&lt;p&gt;é—®ï¼Œç›´åˆ°é—®åˆ°ç¬¬ä¸€æ’çš„äººï¼Œè¯´æˆ‘åœ¨ç¬¬ä¸€æ’ï¼Œç„¶åå†è¿™æ ·ä¸€æ’ä¸€æ’å†æŠŠæ•°å­—ä¼ å›æ¥ã€‚ç›´åˆ°ä½ å‰é¢çš„äººå‘Š&lt;/p&gt;
&lt;p&gt;è¯‰ä½ ä»–åœ¨å“ªä¸€æ’ï¼Œäºæ˜¯ä½ å°±çŸ¥é“ç­”æ¡ˆäº†ã€‚è¿™å°±æ˜¯ä¸€ä¸ªéå¸¸æ ‡å‡†çš„é€’å½’æ±‚è§£é—®é¢˜çš„åˆ†è§£è¿‡ç¨‹ï¼Œå»çš„è¿‡ç¨‹&lt;/p&gt;
&lt;p&gt;å«â€œé€’â€ï¼Œå›æ¥çš„è¿‡ç¨‹å«â€œå½’â€ã€‚åŸºæœ¬ä¸Šï¼Œæ‰€æœ‰çš„é€’å½’é—®é¢˜éƒ½å¯ä»¥ç”¨é€’æ¨å…¬å¼æ¥è¡¨ç¤ºã€‚æˆ‘ä»¬ç”¨é€’æ¨å…¬å¼å°†&lt;/p&gt;
&lt;p&gt;å®ƒè¡¨ç¤ºå‡ºæ¥å°±æ˜¯è¿™æ ·çš„&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;f ( n ) = f (n - 1) + 1 å…¶ä¸­ï¼Œf ( 1 ) = 1&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;f(n)è¡¨ç¤ºä½ æƒ³çŸ¥é“è‡ªå·±åœ¨å“ªä¸€æ’ï¼Œf(n-1)è¡¨ç¤ºå‰é¢ä¸€æ’æ‰€åœ¨çš„æ’æ•°ï¼Œf(1)=1è¡¨ç¤ºç¬¬ä¸€æ’çš„äººçŸ¥é“è‡ªå·±åœ¨&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ’ã€‚æœ‰äº†è¿™ä¸ªé€’æ¨å…¬å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆè½»æ¾åœ°å°†å®ƒæ”¹ä¸ºé€’å½’ä»£ç ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;int f(int n) {
  if (n == 1) return 1;
  return f(n-1) + 1;
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¥³æœ‹å‹ä¸æ‡‚é€’å½’ï¼Œäºæ˜¯æˆ‘ç»™å¥¹è®²é€’å½’éœ€è¦æ»¡è¶³çš„ä¸‰ä¸ªæ¡ä»¶ï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;1.ä¸€ä¸ªé—®é¢˜çš„è§£å¯ä»¥åˆ†è§£ä¸ºå‡ ä¸ªå­é—®é¢˜çš„è§£&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½•ä¸ºå­é—®é¢˜ï¼Ÿå­é—®é¢˜å°±æ˜¯æ•°æ®è§„æ¨¡æ›´å°çš„é—®é¢˜ã€‚å°±å¥½æ¯”ï¼Œåœ¨ç”µå½±é™¢ï¼Œä½ è¦çŸ¥é“ï¼Œâ€œè‡ªå·±åœ¨å“ªä¸€æ’â€çš„é—®&lt;/p&gt;
&lt;p&gt;é¢˜ï¼Œå¯ä»¥åˆ†è§£ä¸ºâ€œå‰ä¸€æ’çš„äººåœ¨å“ªä¸€æ’â€è¿™æ ·ä¸€ä¸ªå­é—®é¢˜ã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;2.è¿™ä¸ªé—®é¢˜ä¸åˆ†è§£ä¹‹åçš„å­é—®é¢˜ï¼Œé™¤äº†æ•°æ®è§„æ¨¡ä¸åŒï¼Œæ±‚è§£æ€è·¯å®Œå…¨ä¸€æ ·&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½ æ±‚è§£â€œè‡ªå·±åœ¨å“ªä¸€æ’â€çš„æ€è·¯ï¼Œå’Œå‰é¢ä¸€æ’äººæ±‚è§£â€œè‡ªå·±åœ¨å“ªä¸€æ’â€çš„æ€è·¯ï¼Œæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;3.å­˜åœ¨é€’å½’ç»ˆæ­¢æ¡ä»¶&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æŠŠé—®é¢˜åˆ†è§£ä¸ºå­é—®é¢˜ï¼ŒæŠŠå­é—®é¢˜å†åˆ†è§£ä¸ºå­å­é—®é¢˜ï¼Œä¸€å±‚ä¸€å±‚åˆ†è§£ä¸‹å»ï¼Œä¸èƒ½å­˜åœ¨æ— é™å¾ªç¯ï¼Œè¿™å°±éœ€&lt;/p&gt;
&lt;p&gt;è¦æœ‰ç»ˆæ­¢æ¡ä»¶ã€‚å°±å¥½æ¯”ï¼Œç¬¬ä¸€æ’çš„äººä¸éœ€è¦å†ç»§ç»­è¯¢é—®ä»»ä½•äººï¼Œå°±çŸ¥é“è‡ªå·±åœ¨å“ªä¸€æ’ï¼Œä¹Ÿå°±æ˜¯&lt;/p&gt;
&lt;p&gt;f(1)=1ï¼Œè¿™å°±æ˜¯é€’å½’çš„ç»ˆæ­¢æ¡ä»¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å¦‚ä½•æ•™å¥³å‹æ•²é€’å½’ä»£ç &quot;&gt;å¦‚ä½•æ•™å¥³å‹æ•²é€’å½’ä»£ç ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;åˆšåˆšé“ºå«äº†è¿™ä¹ˆå¤šï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ï¼Œå¦‚ä½•æ¥æ•™å¥³å‹æ•²é€’å½’ä»£ç ï¼Ÿä¸ªäººè§‰å¾—ï¼Œå†™é€’å½’ä»£ç æœ€å…³é”®çš„æ˜¯å†™&lt;/p&gt;
&lt;p&gt;å‡ºé€’æ¨å…¬å¼ï¼Œæ‰¾åˆ°ç»ˆæ­¢æ¡ä»¶ï¼Œå‰©ä¸‹å°†é€’æ¨å…¬å¼è½¬åŒ–ä¸ºä»£ç å°±å¾ˆç®€å•äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å…ˆè®°ä½è¿™ä¸ªç†è®ºã€‚æˆ‘ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå¸¦ä½ ä¸€æ­¥ä¸€æ­¥å®ç°ä¸€ä¸ªé€’å½’ä»£ç ï¼Œå¸®ä½ ç†è§£ã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;å‡å¦‚è¿™é‡Œæœ‰nä¸ªå°é˜¶ï¼Œæ¯æ¬¡ä½ å¯ä»¥è·¨1ä¸ªå°é˜¶æˆ–è€…2ä¸ªå°é˜¶ï¼Œè¯·é—®èµ°è¿™nä¸ªå°é˜¶æœ‰å¤šå°‘ç§èµ°æ³•ï¼Ÿå¦‚æœæœ‰7ä¸ªå°é˜¶ï¼Œä½ å¯ä»¥2ï¼Œ2ï¼Œ2ï¼Œ1è¿™æ ·å­ä¸Šå»ï¼Œä¹Ÿå¯ä»¥1ï¼Œ2ï¼Œ1ï¼Œ1ï¼Œ2è¿™æ ·å­ä¸Šå»ï¼Œæ€»ä¹‹èµ°æ³•æœ‰å¾ˆå¤šï¼Œé‚£å¦‚ä½•ç”¨ç¼–ç¨‹æ±‚å¾—æ€»å…±æœ‰å¤šå°‘ç§èµ°æ³•å‘¢ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬ä»”ç»†æƒ³ä¸‹ï¼Œå®é™…ä¸Šï¼Œå¯ä»¥æ ¹æ®ç¬¬ä¸€æ­¥çš„èµ°æ³•æŠŠæ‰€æœ‰èµ°æ³•åˆ†ä¸ºä¸¤ç±»ï¼Œç¬¬ä¸€ç±»æ˜¯ç¬¬ä¸€æ­¥èµ°äº†1ä¸ªå°&lt;/p&gt;
&lt;p&gt;é˜¶ï¼Œå¦ä¸€ç±»æ˜¯ç¬¬ä¸€æ­¥èµ°äº†2ä¸ªå°é˜¶ã€‚æ‰€ä»¥nä¸ªå°é˜¶çš„èµ°æ³•å°±ç­‰äºå…ˆèµ°1é˜¶åï¼Œn-1ä¸ªå°é˜¶çš„èµ°æ³• åŠ ä¸Šå…ˆ&lt;/p&gt;
&lt;p&gt;èµ°2é˜¶åï¼Œn-2ä¸ªå°é˜¶çš„èµ°æ³•ã€‚ç”¨å…¬å¼è¡¨ç¤ºå°±æ˜¯ï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;f ( n ) = f (n - 1) + f ( n - 2 )&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æœ‰äº†é€’æ¨å…¬å¼ï¼Œé€’å½’ä»£ç åŸºæœ¬ä¸Šå°±å®Œæˆäº†ä¸€åŠã€‚æˆ‘ä»¬å†æ¥çœ‹ä¸‹ç»ˆæ­¢æ¡ä»¶ã€‚å½“æœ‰ä¸€ä¸ªå°é˜¶æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€&lt;/p&gt;
&lt;p&gt;è¦å†ç»§ç»­é€’å½’ï¼Œå°±åªæœ‰ä¸€ç§èµ°æ³•ã€‚æ‰€ä»¥f(1)=1ã€‚è¿™ä¸ªé€’å½’ç»ˆæ­¢æ¡ä»¶è¶³å¤Ÿå—ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨n=2ï¼Œn=3è¿™æ ·&lt;/p&gt;
&lt;p&gt;æ¯”è¾ƒå°çš„æ•°è¯•éªŒä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;n=2æ—¶ï¼Œf(2)=f(1)+f(0)ã€‚å¦‚æœé€’å½’ç»ˆæ­¢æ¡ä»¶åªæœ‰ä¸€ä¸ªf(1)=1ï¼Œé‚£f(2)å°±æ— æ³•æ±‚è§£äº†ã€‚æ‰€ä»¥é™¤äº†f(1)=1è¿™ä¸€&lt;/p&gt;
&lt;p&gt;ä¸ªé€’å½’ç»ˆæ­¢æ¡ä»¶å¤–ï¼Œè¿˜è¦æœ‰f(0)=1ï¼Œè¡¨ç¤ºèµ°0ä¸ªå°é˜¶æœ‰ä¸€ç§èµ°æ³•ï¼Œä¸è¿‡è¿™æ ·å­çœ‹èµ·æ¥å°±ä¸ç¬¦åˆæ­£å¸¸çš„&lt;/p&gt;
&lt;p&gt;é€»è¾‘æ€ç»´äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠf(2)=2ä½œä¸ºä¸€ç§ç»ˆæ­¢æ¡ä»¶ï¼Œè¡¨ç¤ºèµ°2ä¸ªå°é˜¶ï¼Œæœ‰ä¸¤ç§èµ°æ³•ï¼Œä¸€æ­¥èµ°å®Œ&lt;/p&gt;
&lt;p&gt;æˆ–è€…åˆ†ä¸¤æ­¥æ¥èµ°ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œé€’å½’ç»ˆæ­¢æ¡ä»¶å°±æ˜¯f(1)=1ï¼Œf(2)=2ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä½ å¯ä»¥å†æ‹¿n=3ï¼Œn=4æ¥éªŒè¯ä¸€ä¸‹ï¼Œè¿™ä¸ªç»ˆæ­¢æ¡&lt;/p&gt;
&lt;p&gt;ä»¶æ˜¯å¦è¶³å¤Ÿå¹¶ä¸”æ­£ç¡®ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æŠŠé€’å½’ç»ˆæ­¢æ¡ä»¶å’Œåˆšåˆšå¾—åˆ°çš„é€’æ¨å…¬å¼æ”¾åˆ°ä¸€èµ·å°±æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;f(1) = 1;
f(2) = 2;
f(n) = f(n-1)+f(n-2)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æœ‰äº†è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬è½¬åŒ–æˆé€’å½’ä»£ç å°±ç®€å•å¤šäº†ã€‚æœ€ç»ˆçš„é€’å½’ä»£ç æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;int f(int n) {
  if (n == 1) return 1;
  if (n == 2) return 2;
  return f(n-1) + f(n-2);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æˆ‘æ€»ç»“ä¸€ä¸‹ï¼Œå†™é€’å½’ä»£ç çš„å…³é”®å°±æ˜¯æ‰¾åˆ°å¦‚ä½•å°†&lt;span&gt;&lt;strong&gt;å¤§é—®é¢˜åˆ†è§£ä¸ºå°é—®é¢˜&lt;/strong&gt;&lt;/span&gt;çš„è§„å¾‹ï¼Œå¹¶ä¸”åŸºäºæ­¤&lt;span&gt;&lt;strong&gt;å†™å‡ºé€’æ¨å…¬å¼&lt;/strong&gt;&lt;/span&gt;ï¼Œç„¶åå†&lt;span&gt;&lt;strong&gt;æ¨æ•²ç»ˆæ­¢æ¡ä»¶&lt;/strong&gt;&lt;/span&gt;ï¼Œæœ€åå°†&lt;span&gt;&lt;strong&gt;é€’æ¨å…¬å¼å’Œç»ˆæ­¢æ¡ä»¶&lt;/strong&gt;&lt;/span&gt;ç¿»è¯‘æˆä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä»¥åå†é‡åˆ°ç±»ä¼¼é—®é¢˜ï¼ŒAå¯ä»¥åˆ†è§£ä¸ºè‹¥å¹²å­é—®é¢˜Bã€Cã€Dæƒ…å†µï¼Œä½ å¯ä»¥å‡è®¾å­é—®é¢˜Bã€Cã€Då·²ç»&lt;/p&gt;
&lt;p&gt;è§£å†³ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ€è€ƒå¦‚ä½•è§£å†³é—®é¢˜Aã€‚è€Œä¸”ï¼Œä½ åªéœ€è¦æ€è€ƒé—®é¢˜Aä¸å­é—®é¢˜Bã€Cã€Dä¸¤å±‚ä¹‹é—´çš„å…³&lt;/p&gt;
&lt;p&gt;ç³»å³å¯ï¼Œä¸éœ€è¦ä¸€å±‚ä¸€å±‚å¾€ä¸‹æ€è€ƒå­é—®é¢˜ä¸å­å­é—®é¢˜ï¼Œå­å­é—®é¢˜ä¸å­å­å­é—®é¢˜ä¹‹é—´çš„å…³ç³»ã€‚å±è”½æ‰é€’&lt;/p&gt;
&lt;p&gt;å½’ç»†èŠ‚ï¼Œè¿™æ ·å­ç†è§£èµ·æ¥å°±ç®€å•å¤šäº†ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œç¼–å†™é€’å½’ä»£ç çš„å…³é”®æ˜¯ï¼Œ&lt;span&gt;åªè¦é‡åˆ°é€’å½’ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒæŠ½è±¡æˆä¸€ä¸ªé€’æ¨å…¬å¼ï¼Œä¸ç”¨æƒ³ä¸€å±‚å±‚çš„è°ƒ&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;ç”¨å…³ç³»ï¼Œä¸è¦è¯•å›¾ç”¨äººè„‘å»åˆ†è§£é€’å½’çš„æ¯ä¸ªæ­¥éª¤&lt;/span&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å¦‚ä½•æ•™å¥³å‹ç©è½¬æ±‰ç½—å¡”&quot;&gt;å¦‚ä½•æ•™å¥³å‹ç©è½¬æ±‰ç½—å¡”&lt;/h2&gt;
&lt;p&gt;å¥½äº†ï¼Œè®²å®Œäº†é€’å½’ç®—æ³•ï¼Œå†å›åˆ°ç”µå½±é™¢ï¼Œä¸è¯´åˆ«çš„ï¼Œæˆ‘è¿˜çœŸé‚£ä¹ˆåšäº†ï¼Œæˆ‘çœŸé—®äº†å‰é¢ä¸€æ’çš„äººä»–æ˜¯ç¬¬&lt;/p&gt;
&lt;p&gt;å‡ æ’å¦‚æœä¸æ¸…æ¥šå¹¶è®©ä»–è·Ÿæˆ‘ä¸€æ ·é—®ä»–çš„ä¸Šä¸€æ’ï¼Œæ˜¾ç„¶ï¼Œæ²¡å¾ªç¯åˆ°ç¬¬ä¸‰äººï¼Œæˆ‘å·®ç‚¹è¢«è®¤ä¸ºæ˜¯ç¥ç»ç—…ï¼Œå·®&lt;/p&gt;
&lt;p&gt;ç‚¹æ²¡è¢«å‡ ä¸ªç¤¾ä¼šç²¾ç¥å°ä¼™æ‰“siï¼Œåº§ä½äº‹æƒ…æš‚æ—¶å‘Šä¸€æ®µè½ï¼Œè¯è¯´è¿™ç”µå½±å±å®å¤Ÿæ— èŠï¼Œäºæ˜¯æˆ‘ä¸çŸ¥æ˜¯è¶çƒ­&lt;/p&gt;
&lt;p&gt;æ‰“é“ï¼Œè¿˜æ˜¯å¿ƒè¡€æ¥æ½®ï¼Œéè¦ç»™å¥³æœ‹å‹ç©ä¸€ä¸ªæ±‰ç½—å¡”æ¸¸æˆï¼Œæˆ‘è¿™æš´è„¾æ°”ï¼Œåˆšå®è·µé€’å½’ç®—æ³•è¢«æ€¼ï¼Œæ˜¯æ—¶å€™&lt;/p&gt;
&lt;p&gt;æŒ½å›å½¢è±¡äº†ï¼Œä¸ç§€ä¸€æŠŠé€’å½’ç®—æ³•æˆ‘å°±ä¸å¾—åŠ²ã€‚å°±æ˜¯è¿™ä¸ªæ¸¸æˆï¼Œè‡³äºæ¸¸æˆè§„åˆ™ï¼Œæˆ‘è§‰å¾—ä½ ä½“éªŒä¸€ä¸¤æŠŠç»&lt;/p&gt;
&lt;p&gt;å¯¹æ¯”æˆ‘è¯´çš„æ›´åŠ è®°å¿†æ·±åˆ»ï¼Œ&lt;a href=&quot;http://www.4399.com/flash/109504_1.htm&quot;&gt;ç‚¹å‡»è“è‰²å­—ä½“è¿›å…¥æ±‰ç½—å¡”æ¸¸æˆ&lt;/a&gt;ï¼Œåˆ«çœ‹4399è§‰å¾—æœ‰ç‚¹å¼±zhiï¼Œå†æ€ä¹ˆè¯´ä¹Ÿæ‰¿&lt;/p&gt;
&lt;p&gt;è½½ç€ç«¥å¹´&lt;br/&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20190904105215293.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0NTQzNTA4,size_16,color_FFFFFF,t_70&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot;/&gt;&lt;br/&gt;æœç„¶ï¼Œå¥³æœ‹å‹æ˜¯ä¸ªå“ˆçš®ï¼Œåˆšè¿‡ç¬¬ä¸‰å…³å°±æ‰‘è¡—äº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¤´å†’äº”ä¸ˆå…‰èŠ’çš„æˆ‘èº«æŠ«é‡‘ç”²æŒºèº«è€Œå‡ºï¼ˆè²Œ&lt;/p&gt;
&lt;p&gt;ä¼¼æœ‰ä¸€ç‚¹ç‚¹å°å¤¸å¼ ï¼Œå‰§æƒ…éœ€è¦å˜›ï¼‰ä¸€å£°ä¸å­åœ°æ•²äº†å‡ è¡Œé“ä¸½çš„ä»£ç &lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public class TestHanoi {

    public static void main(String[] args) {
        hanoi(5,'A','B','C');  //å¯ä»¥ç†è§£ä¸º5ä¸ªåœˆæˆ–è€…ç¬¬5å…³
    }
    
    /**
     * @param n     å…±æœ‰Nä¸ªåœˆ
     * @param A    å¼€å§‹çš„æŸ±å­
     * @param B ä¸­é—´çš„æŸ±å­
     * @param C ç›®æ ‡çš„æŸ±å­
     * æ— è®ºæœ‰å¤šå°‘ä¸ªåœˆï¼Œéƒ½è®¤ä¸ºåªæœ‰ä¸¤ä¸ªã€‚ä¸Šé¢çš„æ‰€æœ‰åœˆå’Œæœ€ä¸‹é¢ä¸€ä¸ªåœˆã€‚
     */
    public static void hanoi(int n,char A,char B,char C) {
        //åªæœ‰ä¸€ä¸ªåœˆã€‚
        if(n==1) {
            System.out.println(&quot;ç¬¬1ä¸ªç›˜å­ä»&quot;+A+&quot;ç§»åˆ°&quot;+C);
        //æ— è®ºæœ‰å¤šå°‘ä¸ªåœˆï¼Œéƒ½è®¤ä¸ºåªæœ‰ä¸¤ä¸ªã€‚ä¸Šé¢çš„æ‰€æœ‰åœˆå’Œæœ€ä¸‹é¢ä¸€ä¸ªåœˆã€‚
        }else {
            //ç§»åŠ¨ä¸Šé¢æ‰€æœ‰çš„åœˆåˆ°ä¸­é—´ä½ç½®
            hanoi(n-1,A,C,B);
            //ç§»åŠ¨ä¸‹é¢çš„åœˆ
            System.out.println(&quot;ç¬¬&quot;+n+&quot;ä¸ªåœˆä»&quot;+A+&quot;ç§»åˆ°&quot;+C);
            //æŠŠä¸Šé¢çš„æ‰€æœ‰åœˆä»ä¸­é—´ä½ç½®ç§»åˆ°ç›®æ ‡ä½ç½®
            hanoi(n-1,B,A,C);
        }
    }

}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åªè¦mainæ–¹æ³•ä¸€è‡´è¡Œï¼Œå¯¹ç€ç»“æœç§»åŠ¨å³å¯ï¼Œå°±è·Ÿå¼€äº†æŒ‚ä¸€æ ·çš„ï¼Œå…¶å®æ±‰ç½—å¡”é—®é¢˜æ ¸å¿ƒå…³é”®æ˜¯æ— è®ºæœ‰å¤šå°‘ä¸ªåœˆï¼Œéƒ½è®¤ä¸ºåªæœ‰ä¸¤ä¸ªã€‚ä¸Šé¢çš„æ‰€æœ‰åœˆå’Œæœ€ä¸‹é¢ä¸€ä¸ªåœˆã€‚&lt;img src=&quot;https://img-blog.csdnimg.cn/20190904111942623.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20190904113016587.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot;/&gt;&lt;br/&gt;&lt;strong&gt;åˆ°è¿™é‡Œï¼Œæ•™å¥³å‹æ•²é€’å½’ç®—æ³•ä»£ç ï¼Œä½ å­¦ä¼šäº†å—ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å“¦è±ï¼Œæ˜å¤©è¿˜æ˜¯ä¸€ä¸ªæ™´å¤©~è€å¤©èµç»™å®œæ˜¥ä¸€ä¸ªå¥³æœ‹å‹å§~æ¯•ç«Ÿæˆ‘ä»¬ç¨‹åºå‘˜é•¿å¾—åˆå¸…æ•²ä»£ç åˆå¥½çœ‹ï¼Œæ˜¯å§å“¥å‡ ä¸ª~~&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰ä¸€ç‚¹ç‚¹å¸®åŠ©ï¼Œé‚£ä¹ˆè¯·ç‚¹ä¸ªèµå‘—ï¼Œè°¢è°¢~&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;&lt;strong&gt;æœ€åï¼Œè‹¥æœ‰ä¸è¶³æˆ–è€…ä¸æ­£ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡æ­£æ‰¹è¯„ï¼Œæ„Ÿæ¿€ä¸å°½ï¼å¦‚æœæœ‰ç–‘é—®æ¬¢è¿ç•™è¨€ï¼Œç»å¯¹ç¬¬ä¸€æ—¶é—´å›å¤ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¬¢è¿å„ä½å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼Œä¸€èµ·æ¢è®¨æŠ€æœ¯ï¼Œå‘å¾€æŠ€æœ¯ï¼Œè¿½æ±‚æŠ€æœ¯ï¼Œè¯´å¥½äº†æ¥äº†å°±æ˜¯ç›†å‹å–”...&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20191028085725979.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0NTQzNTA4,size_16,color_FFFFFF,t_70&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Thu, 21 Nov 2019 23:58:00 +0000</pubDate>
<dc:creator>å®œæ˜¥</dc:creator>
<og:description>ä¸€åˆ°å‘¨æœ«å°±å¼€å§‹æ”¾è¡è‡ªæˆ‘ï¼Œè¿™ä¸å¸¦ç€å¥³æœ‹å‹å»ä¸‡è¾¾ç”µå½±é™¢çœ‹ç”µå½±ï¼ˆå…¶å®æ˜¯ç”±äºæ•´å¤©å‘†åœ¨å®¶æ•²ä»£ç ç¡¬æ˜¯ è¢«å¥³æœ‹å‹å¼ºè¡Œæ‹–æ‹½å»çœ‹ç”µå½±ï¼Œä½œä¸ºä¸€ä¸ªæœ‰ç†æƒ³çš„ç¨‹åºå‘˜ï¼Œæˆ‘æƒ³å„ä½åº”è¯¥éƒ½èƒ½ä½“è°…æˆ‘ï¼‰ï¼Œä¸€åˆ°ç”µå½±é™¢ï¼Œ å¥³æœ‹å‹è¯´è¦ä¹°çˆ†ç±³èŠ±å’Œ</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/yichunguo/p/11909512.html</dc:identifier>
</item>
<item>
<title>javaä¸­hashmapå®¹é‡çš„åˆå§‹åŒ– - æ¨å† æ ‡</title>
<link>http://www.cnblogs.com/yanggb/p/11613070.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/yanggb/p/11613070.html</guid>
<description>&lt;p&gt;HashMapä½¿ç”¨HashMap(int initialCapacity)å¯¹é›†åˆè¿›è¡Œåˆå§‹åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼ŒHashMapçš„å®¹é‡æ˜¯16ã€‚ä½†æ˜¯å¦‚æœç”¨æˆ·é€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šäº†ä¸€ä¸ªæ•°å­—ä½œä¸ºå®¹é‡ï¼Œé‚£ä¹ˆHashä¼šé€‰æ‹©å¤§äºè¯¥æ•°å­—çš„ç¬¬ä¸€ä¸ª2çš„å¹‚ä½œä¸ºå®¹é‡ã€‚æ¯”å¦‚å¦‚æœæŒ‡å®šäº†3ï¼Œåˆ™å®¹é‡æ˜¯4ï¼›å¦‚æœæŒ‡å®šäº†7ï¼Œåˆ™å®¹é‡æ˜¯8ï¼›å¦‚æœæŒ‡å®šäº†9ï¼Œåˆ™å®¹é‡æ˜¯16ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;ä¸ºä»€ä¹ˆè¦è®¾ç½®HashMapçš„åˆå§‹åŒ–å®¹é‡&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹ä¸­ï¼Œæœ‰ä¸€æ¡å¼€å‘å»ºè®®æ˜¯å»ºè®®æˆ‘ä»¬è®¾ç½®HashMapçš„åˆå§‹åŒ–å®¹é‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬é€šè¿‡å…·ä½“çš„ä»£ç æ¥äº†è§£ä¸‹ä¸ºä»€ä¹ˆä¼šè¿™ä¹ˆå»ºè®®ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å…ˆæ¥å†™ä¸€æ®µä»£ç åœ¨JDK1.7çš„ç¯å¢ƒä¸‹è¿è¡Œï¼Œæ¥åˆ†åˆ«æµ‹è¯•ä¸‹ï¼Œåœ¨ä¸æŒ‡å®šåˆå§‹åŒ–å®¹é‡å’ŒæŒ‡å®šåˆå§‹åŒ–å®¹é‡çš„æƒ…å†µä¸‹æ€§èƒ½æƒ…å†µçš„ä¸åŒã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; main(String[] args) {
    &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; aHundredMillion = 10000000&lt;span&gt;;

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; æœªåˆå§‹åŒ–å®¹é‡&lt;/span&gt;
    Map&amp;lt;Integer, Integer&amp;gt; map = &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;&lt;span&gt;();
    &lt;/span&gt;&lt;span&gt;long&lt;/span&gt; s1 =&lt;span&gt; System.currentTimeMillis();
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = 0; i &amp;lt; aHundredMillion; i++&lt;span&gt;) {
        map.put(i, i);
    }
    &lt;/span&gt;&lt;span&gt;long&lt;/span&gt; s2 =&lt;span&gt; System.currentTimeMillis();
    System.out.println(&lt;/span&gt;&quot;æœªåˆå§‹åŒ–å®¹é‡ï¼Œè€—æ—¶ï¼š &quot; + (s2 - s1)); &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 14322

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆå§‹åŒ–å®¹é‡ä¸º50000000&lt;/span&gt;
    Map&amp;lt;Integer, Integer&amp;gt; map1 = &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;(aHundredMillion / 2&lt;span&gt;);
    &lt;/span&gt;&lt;span&gt;long&lt;/span&gt; s3 =&lt;span&gt; System.currentTimeMillis();
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = 0; i &amp;lt; aHundredMillion; i++&lt;span&gt;) {
        map1.put(i, i);
    }
    &lt;/span&gt;&lt;span&gt;long&lt;/span&gt; s4 =&lt;span&gt; System.currentTimeMillis();
    System.out.println(&lt;/span&gt;&quot;åˆå§‹åŒ–å®¹é‡5000000ï¼Œè€—æ—¶ï¼š &quot; + (s4 - s3)); &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 11819

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆå§‹åŒ–å®¹é‡ä¸º100000000&lt;/span&gt;
    Map&amp;lt;Integer, Integer&amp;gt; map2 = &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;&lt;span&gt;(aHundredMillion);
    &lt;/span&gt;&lt;span&gt;long&lt;/span&gt; s5 =&lt;span&gt; System.currentTimeMillis();
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = 0; i &amp;lt; aHundredMillion; i++&lt;span&gt;) {
        map2.put(i, i);
    }
    &lt;/span&gt;&lt;span&gt;long&lt;/span&gt; s6 =&lt;span&gt; System.currentTimeMillis();
    System.out.println(&lt;/span&gt;&quot;åˆå§‹åŒ–å®¹é‡ä¸º10000000ï¼Œè€—æ—¶ï¼š &quot; + (s6 - s5)); &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 7978&lt;/span&gt;
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä»ä»¥ä¸Šçš„ä»£ç ä¸éš¾ç†è§£ï¼Œæˆ‘ä»¬åˆ›å»ºäº†3ä¸ªHashMapï¼Œåˆ†åˆ«ä½¿ç”¨é»˜è®¤çš„å®¹é‡ï¼ˆ16ï¼‰ã€ä½¿ç”¨å…ƒç´ ä¸ªæ•°çš„ä¸€åŠï¼ˆ5åƒä¸‡ï¼‰ä½œä¸ºåˆå§‹å®¹é‡å’Œä½¿ç”¨å…ƒç´ ä¸ªæ•°ï¼ˆä¸€äº¿ï¼‰ä½œä¸ºåˆå§‹å®¹é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶ååˆ†åˆ«å‘å…¶ä¸­putä¸€äº¿ä¸ªKVã€‚&lt;/p&gt;
&lt;p&gt;ä»ä¸Šé¢çš„æ‰“å°ç»“æœä¸­å¯ä»¥å¾—åˆ°ä¸€ä¸ªåˆæ­¥çš„ç»“è®ºï¼šåœ¨å·²çŸ¥HashMapä¸­å°†è¦å­˜æ”¾çš„KVä¸ªæ•°çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªåˆç†çš„åˆå§‹åŒ–å®¹é‡å¯ä»¥æœ‰æ•ˆåœ°æé«˜æ€§èƒ½ã€‚ä¸‹é¢æˆ‘ä»¬æ¥ç®€å•åˆ†æä¸€ä¸‹åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“ï¼ŒHashMapæ˜¯æœ‰æ‰©å®¹æœºåˆ¶çš„ã€‚æ‰€è°“çš„æ‰©å®¹æœºåˆ¶ï¼ŒæŒ‡çš„æ˜¯å½“è¾¾åˆ°æ‰©å®¹æ¡ä»¶çš„æ—¶å€™ï¼ŒHashMapå°±ä¼šè‡ªåŠ¨è¿›è¡Œæ‰©å®¹ã€‚è€ŒHashMapçš„æ‰©å®¹æ¡ä»¶å°±æ˜¯å½“HashMapä¸­çš„å…ƒç´ ä¸ªæ•°ï¼ˆSizeï¼‰è¶…è¿‡ä¸´ç•Œå€¼ï¼ˆThresholdï¼‰çš„æƒ…å†µä¸‹å°±ä¼šè‡ªåŠ¨æ‰©å®¹ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
threshold = loadFactor * capacity
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;åœ¨å…ƒç´ ä¸ªæ•°è¶…è¿‡ä¸´ç•Œå€¼çš„æƒ…å†µä¸‹ï¼Œéšç€å…ƒç´ çš„ä¸æ–­å¢åŠ ï¼ŒHashMapå°±ä¼šå‘ç”Ÿæ‰©å®¹ï¼Œè€ŒHashMapä¸­çš„æ‰©å®¹æœºåˆ¶å†³å®šäº†æ¯æ¬¡æ‰©å®¹éƒ½éœ€è¦é‡å»ºhashè¡¨ï¼Œè¿™ä¸€æ“ä½œéœ€è¦æ¶ˆè€—å¤§é‡èµ„æºï¼Œæ˜¯éå¸¸å½±å“æ€§èƒ½çš„ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰è®¾ç½®åˆå§‹çš„å®¹é‡å¤§å°ï¼ŒHashMapå°±å¯èƒ½ä¼šä¸æ–­å‘ç”Ÿæ‰©å®¹ï¼Œä¹Ÿå°±ä½¿å¾—ç¨‹åºçš„æ€§èƒ½é™ä½äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬ä¼šå‘ç°ï¼ŒåŒæ ·æ˜¯è®¾ç½®äº†åˆå§‹åŒ–å®¹é‡ï¼Œè®¾ç½®çš„æ•°å€¼ä¸åŒä¹Ÿä¼šå½±å“æ€§èƒ½ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬å·²çŸ¥HashMapä¸­å³å°†å­˜æ”¾çš„KVä¸ªæ•°çš„æ—¶å€™ï¼Œå®¹é‡çš„è®¾ç½®å°±æˆäº†ä¸€ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;HashMapä¸­å®¹é‡çš„åˆå§‹åŒ–&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å¼€å¤´æåˆ°ï¼Œåœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬è®¾ç½®HashMapçš„åˆå§‹åŒ–å®¹é‡æ—¶ï¼Œå®é™…ä¸ŠHashMapä¼šé‡‡ç”¨ç¬¬ä¸€ä¸ªå¤§äºè¯¥æ•°å€¼çš„2çš„å¹‚ä½œä¸ºåˆå§‹åŒ–å®¹é‡ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
Map&amp;lt;String, String&amp;gt; map = &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;(1&lt;span&gt;);
map.put(&lt;/span&gt;&quot;huangq&quot;, &quot;yanggb&quot;&lt;span&gt;);

Class&lt;/span&gt;&amp;lt;?&amp;gt; mapType =&lt;span&gt; map.getClass();
Method capacity &lt;/span&gt;= mapType.getDeclaredMethod(&quot;capacity&quot;&lt;span&gt;);
capacity.setAccessible(&lt;/span&gt;&lt;span&gt;true&lt;/span&gt;&lt;span&gt;);
System.out.println(&lt;/span&gt;&quot;capacity : &quot; + capacity.invoke(map)); &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å½“åˆå§‹åŒ–çš„å®¹é‡è®¾ç½®æˆ1çš„æ—¶å€™ï¼Œé€šè¿‡åå°„å–å‡ºæ¥çš„capacityå´æ˜¯2ã€‚åœ¨JDK1.8ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥çš„åˆå§‹åŒ–å®¹é‡ä¸º1ï¼Œå®é™…ä¸Šè®¾ç½®çš„ç»“æœä¹Ÿæ˜¯1ã€‚ä¸Šé¢çš„ä»£ç æ‰“å°çš„ç»“æœä¸º2çš„åŸå› ï¼Œæ˜¯ä»£ç ä¸­ç»™mapå¡å…¥å€¼çš„æ“ä½œå¯¼è‡´äº†æ‰©å®¹ï¼Œå®¹é‡ä»1æ‰©å®¹åˆ°äº†2ã€‚äº‹å®ä¸Šï¼Œåœ¨JDK1.7å’ŒJDK1.8ä¸­ï¼ŒHashMapåˆå§‹åŒ–å®¹é‡ï¼ˆcapacityï¼‰çš„æ—¶æœºä¸åŒã€‚åœ¨JDK1.8ä¸­ï¼Œè°ƒç”¨HashMapçš„æ„é€ å‡½æ•°å®šä¹‰HashMapçš„æ—¶å€™ï¼Œå°±ä¼šè¿›è¡Œå®¹é‡çš„è®¾å®šã€‚è€Œåœ¨JDK1.7ä¸­ï¼Œè¦ç­‰åˆ°ç¬¬ä¸€æ¬¡putæ“ä½œæ—¶æ‰è¿›è¡Œè¿™ä¸€æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå½“æˆ‘ä»¬é€šè¿‡HashMap(int initialCapacity)è®¾ç½®åˆå§‹å®¹é‡çš„æ—¶å€™ï¼ŒHashMapå¹¶ä¸ä¸€å®šä¼šç›´æ¥é‡‡ç”¨æˆ‘ä»¬ä¼ å…¥çš„æ•°å€¼ï¼Œè€Œæ˜¯ç»è¿‡è®¡ç®—ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°å€¼ï¼Œç›®çš„æ˜¯æé«˜hashçš„æ•ˆç‡ã€‚æ¯”å¦‚1-&amp;gt;1ã€3-&amp;gt;4ã€7-&amp;gt;8å’Œ9-&amp;gt;16ã€‚&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;HashMapä¸­åˆå§‹å®¹é‡çš„åˆç†å€¼&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨HashMap(int initialCapacity)æ¥åˆå§‹åŒ–å®¹é‡çš„æ—¶å€™ï¼ŒJDKä¼šé»˜è®¤å¸®æˆ‘ä»¬è®¡ç®—ä¸€ä¸ªç›¸å¯¹åˆç†çš„å€¼å½“åšåˆå§‹å®¹é‡ã€‚é‚£ä¹ˆï¼Œæ˜¯ä¸æ˜¯æˆ‘ä»¬åªéœ€è¦æŠŠå·²çŸ¥çš„HashMapä¸­å³å°†å­˜æ”¾çš„å…ƒç´ ä¸ªæ•°ç›´æ¥ä¼ ç»™initialCapacityå°±å¯ä»¥äº†å‘¢ï¼Ÿ&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
initialCapacity = (éœ€è¦å­˜å‚¨çš„å…ƒç´ ä¸ªæ•° / è´Ÿè½½å› å­) + 1
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™é‡Œçš„è´Ÿè½½å› å­å°±æ˜¯loaderFactorï¼Œé»˜è®¤å€¼ä¸º0.75ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
initialCapacity = expectedSize / 0.75F + 1.0F
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸Šé¢è¿™ä¸ªå…¬å¼æ˜¯ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹ä¸­çš„ä¸€ä¸ªå»ºè®®ï¼Œåœ¨Guavaä¸­ä¹Ÿæ˜¯æä¾›äº†ç›¸åŒçš„ç®—æ³•ï¼Œæ›´ç”šä¹‹ï¼Œè¿™ä¸ªç®—æ³•å®é™…ä¸Šæ˜¯JDK8ä¸­putAll()æ–¹æ³•çš„å®ç°ã€‚è¿™æ˜¯å…¬å¼çš„å¾—å‡ºæ˜¯å› ä¸ºï¼Œå½“HashMapå†…éƒ¨ç»´æŠ¤çš„å“ˆå¸Œè¡¨çš„å®¹é‡è¾¾åˆ°75%æ—¶ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ï¼Œå°±ä¼šè§¦å‘rehashï¼ˆé‡å»ºhashè¡¨ï¼‰æ“ä½œã€‚è€Œrehashçš„è¿‡ç¨‹æ˜¯æ¯”è¾ƒè€—è´¹æ—¶é—´çš„ã€‚æ‰€ä»¥åˆå§‹åŒ–å®¹é‡è¦è®¾ç½®æˆexpectedSize/0.75 + 1çš„è¯ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å‡å°‘å†²çªï¼Œä¹Ÿå¯ä»¥å‡å°è¯¯å·®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬æƒ³è¦åœ¨ä»£ç ä¸­åˆ›å»ºä¸€ä¸ªHashMapçš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬å·²çŸ¥è¿™ä¸ªMapä¸­å³å°†å­˜æ”¾çš„å…ƒç´ ä¸ªæ•°ï¼Œç»™HashMapè®¾ç½®åˆå§‹å®¹é‡å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæå‡æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼ŒJDKå¹¶ä¸ä¼šç›´æ¥æ‹¿ç”¨æˆ·ä¼ è¿›æ¥çš„æ•°å­—å½“åšé»˜è®¤å®¹é‡ï¼Œè€Œæ˜¯ä¼šè¿›è¡Œä¸€ç•ªè¿ç®—ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ª2çš„å¹‚ã€‚è€Œä¸ºäº†æœ€å¤§ç¨‹åº¦åœ°é¿å…æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œé€šå¸¸æ˜¯å»ºè®®å¯ä»¥æŠŠé»˜è®¤å®¹é‡çš„æ•°å­—è®¾ç½®æˆexpectedSize / 0.75F + 1.0Fã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¯ä»¥ä½¿ç”¨Guavaæä¾›çš„ä¸€ä¸ªæ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªHashMapï¼Œè®¡ç®—çš„è¿‡ç¨‹Guavaä¼šå¸®æˆ‘ä»¬å®Œæˆã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
Map&amp;lt;String, String&amp;gt; map = Maps.newHashMapWithExpectedSize(10);
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æœ€åè¦è¯´çš„ä¸€ç‚¹æ˜¯ï¼Œè¿™ç§ç®—æ³•å®é™…ä¸Šæ˜¯ä¸€ç§ä½¿ç”¨å†…å­˜æ¢å–æ€§èƒ½çš„åšæ³•ï¼Œåœ¨çœŸæ­£çš„åº”ç”¨åœºæ™¯ä¸­è¦è€ƒè™‘åˆ°å†…å­˜çš„å½±å“ã€‚&lt;/p&gt;

&lt;p&gt;&quot;å½“ä½ è®¤çœŸå–œæ¬¢ä¸€ä¸ªäººçš„æ—¶å€™ï¼Œä½ çš„å…¨ä¸–ç•Œéƒ½æ˜¯å¥¹ã€‚&quot;&lt;/p&gt;
</description>
<pubDate>Thu, 21 Nov 2019 22:05:00 +0000</pubDate>
<dc:creator>æ¨å† æ ‡</dc:creator>
<og:description>HashMapä½¿ç”¨HashMap(int initialCapacity)å¯¹é›†åˆè¿›è¡Œåˆå§‹åŒ–ã€‚ åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼ŒHashMapçš„å®¹é‡æ˜¯16ã€‚ä½†æ˜¯å¦‚æœç”¨æˆ·é€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šäº†ä¸€ä¸ªæ•°å­—ä½œä¸ºå®¹é‡ï¼Œé‚£ä¹ˆHashä¼š</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/yanggb/p/11613070.html</dc:identifier>
</item>
<item>
<title>linuxä¸Windowsè¿›ç¨‹æ§åˆ¶ - LightningStar</title>
<link>http://www.cnblogs.com/harrypotterjackson/p/11908825.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/harrypotterjackson/p/11908825.html</guid>
<description>&lt;h2 id=&quot;è¿›ç¨‹ç®¡ç†æ§åˆ¶&quot;&gt;è¿›ç¨‹ç®¡ç†æ§åˆ¶&lt;/h2&gt;
&lt;p&gt;è¿™é‡Œå®ç°çš„æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰timerç”¨äºç»Ÿè®¡å­è¿›ç¨‹è¿è¡Œçš„æ—¶é—´ã€‚ä½¿ç”¨æ–¹å¼ä¸»è¦æ˜¯&lt;/p&gt;
&lt;pre class=&quot;cpp&quot;&gt;
&lt;code&gt;timer [-t seconds] command arguments&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¾‹å¦‚è¦ç»Ÿè®¡&lt;code&gt;ls&lt;/code&gt;çš„è¿è¡Œæ—¶é—´å¯ä»¥ç›´æ¥è¾“å…¥&lt;code&gt;timer ls&lt;/code&gt;ï¼Œå…¶åçš„&lt;code&gt;arguments&lt;/code&gt;æ˜¯æŒ‡æ‰€è¦è¿è¡Œçš„ç¨‹åºçš„å‚æ•°ã€‚å¦‚ï¼š&lt;code&gt;timer ls -al&lt;/code&gt;ã€‚å¦‚æœè¦æŒ‡å®šç¨‹åºè¿è¡Œå¤šå°‘æ—¶é—´ï¼Œå¦‚5ç§’é’Ÿï¼Œå¯ä»¥è¾“å…¥&lt;code&gt;timer -t 5 ls -al&lt;/code&gt;ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥ç¨‹åºå¯¹è¾“å…¥æ²¡æœ‰åšå¼‚å¸¸æ£€æµ‹ï¼Œæ‰€ä»¥è¦ç¡®ä¿ç¨‹åºè¾“å…¥æ­£ç¡®ã€‚&lt;/p&gt;
&lt;h2 id=&quot;linux&quot;&gt;Linux&lt;/h2&gt;
&lt;h4 id=&quot;ç¨‹åºæ€è·¯&quot;&gt;ç¨‹åºæ€è·¯&lt;/h4&gt;
&lt;ol readability=&quot;3.9857566765579&quot;&gt;&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;è·å–æ—¶é—´&lt;/p&gt;
&lt;p&gt;æ—¶é—´è·å–å‡½æ•°ä½¿ç”¨&lt;code&gt;gettimeofday&lt;/code&gt;ï¼Œç²¾åº¦å¯ä»¥è¾¾åˆ°å¾®ç§’&lt;/p&gt;
&lt;pre class=&quot;cpp&quot;&gt;
&lt;code&gt;struct timeval{
     long tv_sec;*//ç§’*
     long tv_usec;*//å¾®ç§’*
}&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;6.9740018570102&quot;&gt;
&lt;p&gt;å­è¿›ç¨‹åˆ›å»º&lt;/p&gt;
&lt;ol readability=&quot;15.423298969072&quot;&gt;&lt;li readability=&quot;4.8347107438017&quot;&gt;
&lt;p&gt;&lt;code&gt;fork()&lt;/code&gt;å‡½æ•°&lt;/p&gt;
&lt;pre class=&quot;cpp&quot;&gt;
&lt;code&gt;#include &amp;lt;sys/types.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
pid_t fork(void);&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;fork&lt;/code&gt;è°ƒç”¨å¤±è´¥åˆ™è¿”å›-1ï¼Œè°ƒç”¨æˆåŠŸåˆ™ï¼š&lt;/p&gt;
&lt;p&gt;forkå‡½æ•°ä¼šæœ‰ä¸¤ç§è¿”å›å€¼ï¼Œä¸€æ˜¯ä¸º0ï¼Œä¸€æ˜¯ä¸ºæ­£æ•´æ•°ã€‚è‹¥ä¸º0ï¼Œåˆ™è¯´æ˜å½“å‰è¿›ç¨‹ä¸ºå­è¿›ç¨‹ï¼›è‹¥ä¸ºæ­£æ•´æ•°ï¼Œåˆ™è¯¥è¿›ç¨‹ä¸ºçˆ¶è¿›ç¨‹ä¸”è¯¥å€¼ä¸ºå­è¿›ç¨‹pidã€‚å…³äºè¿›ç¨‹æ§åˆ¶çš„è¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š&lt;a href=&quot;https://www.cnblogs.com/harrypotterjackson/p/docs.linuxtone.org/ebooks/C&amp;amp;CPP/c/ch30s03.html&quot;&gt;è¿›ç¨‹æ§åˆ¶&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;21&quot;&gt;
&lt;p&gt;&lt;code&gt;exec&lt;/code&gt;å‡½æ•°&lt;/p&gt;
&lt;p&gt;ç”¨forkåˆ›å»ºå­è¿›ç¨‹åæ‰§è¡Œçš„æ˜¯å’Œçˆ¶è¿›ç¨‹ç›¸åŒçš„ç¨‹åºï¼ˆä½†æœ‰å¯èƒ½æ‰§è¡Œä¸åŒçš„ä»£ç åˆ†æ”¯ï¼‰ï¼Œå­è¿›ç¨‹å¾€å¾€è¦è°ƒç”¨ä¸€ç§execå‡½æ•°ä»¥æ‰§è¡Œå¦ä¸€ä¸ªç¨‹åºã€‚å½“è¿›ç¨‹è°ƒç”¨ä¸€ç§execå‡½æ•°æ—¶ï¼Œè¯¥è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´ä»£ç å’Œæ•°æ®å®Œå…¨è¢«æ–°ç¨‹åºæ›¿æ¢ï¼Œä»æ–°ç¨‹åºçš„å¯åŠ¨ä¾‹ç¨‹å¼€å§‹æ‰§è¡Œã€‚è°ƒç”¨execå¹¶ä¸åˆ›å»ºæ–°è¿›ç¨‹ï¼Œæ‰€ä»¥è°ƒç”¨execå‰åè¯¥è¿›ç¨‹çš„idå¹¶æœªæ”¹å˜ã€‚&lt;br/&gt;å…¶å®æœ‰å…­ç§ä»¥execå¼€å¤´çš„å‡½æ•°ï¼Œç»Ÿç§°execå‡½æ•°ï¼š&lt;/p&gt;
&lt;pre class=&quot;cpp&quot;&gt;
&lt;code&gt;#include &amp;lt;unistd.h&amp;gt;
int execl(const char *path, const char *arg, ...);
int execlp(const char *file, const char *arg, ...);
int execle(const char *path, const char *arg, ..., char *const envp[]);
int execv(const char *path, char *const argv[]);
int execvp(const char *file, char *const argv[]);
int execve(const char *path, char *const argv[], char *const envp[]);&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™äº›å‡½æ•°å¦‚æœè°ƒç”¨æˆåŠŸåˆ™åŠ è½½æ–°çš„ç¨‹åºä»å¯åŠ¨ä»£ç å¼€å§‹æ‰§è¡Œï¼Œä¸å†è¿”å›ï¼Œå¦‚æœè°ƒç”¨å‡ºé”™åˆ™è¿”å›-1ï¼Œæ‰€ä»¥execå‡½æ•°åªæœ‰å‡ºé”™çš„è¿”å›å€¼è€Œæ²¡æœ‰æˆåŠŸçš„è¿”å›å€¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;&lt;code&gt;wait&lt;/code&gt;ä¸&lt;code&gt;waitpid&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªè¿›ç¨‹åœ¨ç»ˆæ­¢æ—¶ä¼šå…³é—­æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦ï¼Œé‡Šæ”¾åœ¨ç”¨æˆ·ç©ºé—´åˆ†é…çš„å†…å­˜ï¼Œä½†å®ƒçš„PCBè¿˜ä¿ç•™ç€ï¼Œå†…æ ¸åœ¨å…¶ä¸­ä¿å­˜äº†ä¸€äº›ä¿¡æ¯ï¼šå¦‚æœæ˜¯æ­£å¸¸ç»ˆæ­¢åˆ™ä¿å­˜ç€é€€å‡ºçŠ¶æ€ï¼Œå¦‚æœæ˜¯å¼‚å¸¸ç»ˆæ­¢åˆ™ä¿å­˜ç€å¯¼è‡´è¯¥è¿›ç¨‹ç»ˆæ­¢çš„ä¿¡å·æ˜¯å“ªä¸ªã€‚è¿™ä¸ªè¿›ç¨‹çš„çˆ¶è¿›ç¨‹å¯ä»¥è°ƒç”¨waitæˆ–waitpidè·å–è¿™äº›ä¿¡æ¯ï¼Œç„¶åå½»åº•æ¸…é™¤æ‰è¿™ä¸ªè¿›ç¨‹ã€‚æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªè¿›ç¨‹çš„é€€å‡ºçŠ¶æ€å¯ä»¥åœ¨Shellä¸­ç”¨ç‰¹æ®Šå˜é‡$?æŸ¥çœ‹ï¼Œå› ä¸ºShellæ˜¯å®ƒçš„çˆ¶è¿›ç¨‹ï¼Œå½“å®ƒç»ˆæ­¢æ—¶Shellè°ƒç”¨waitæˆ–waitpidå¾—åˆ°å®ƒçš„é€€å‡ºçŠ¶æ€åŒæ—¶å½»åº•æ¸…é™¤æ‰è¿™ä¸ªè¿›ç¨‹ã€‚&lt;br/&gt;å¦‚æœä¸€ä¸ªè¿›ç¨‹å·²ç»ç»ˆæ­¢ï¼Œä½†æ˜¯å®ƒçš„çˆ¶è¿›ç¨‹å°šæœªè°ƒç”¨waitæˆ–waitpidå¯¹å®ƒè¿›è¡Œæ¸…ç†ï¼Œè¿™æ—¶çš„è¿›ç¨‹çŠ¶æ€ç§°ä¸ºåƒµå°¸ï¼ˆZombieï¼‰è¿›ç¨‹ã€‚ä»»ä½•è¿›ç¨‹åœ¨åˆšç»ˆæ­¢æ—¶éƒ½æ˜¯åƒµå°¸è¿›ç¨‹ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œåƒµå°¸è¿›ç¨‹éƒ½ç«‹åˆ»è¢«çˆ¶è¿›ç¨‹æ¸…ç†äº†ã€‚&lt;br/&gt;åƒµå°¸è¿›ç¨‹æ˜¯ä¸èƒ½ç”¨killå‘½ä»¤æ¸…é™¤æ‰çš„ï¼Œå› ä¸ºkillå‘½ä»¤åªæ˜¯ç”¨æ¥ç»ˆæ­¢è¿›ç¨‹çš„ï¼Œè€Œåƒµå°¸è¿›ç¨‹å·²ç»ç»ˆæ­¢äº†ã€‚&lt;br/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;pre class=&quot;cpp&quot;&gt;
&lt;code&gt;#include &amp;lt;sys/types.h&amp;gt;
#include &amp;lt;sys/wait.h&amp;gt;
pid_t wait(int *status);
pid_t waitpid(pid_t pid, int *status, int options);&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è‹¥è°ƒç”¨æˆåŠŸåˆ™è¿”å›æ¸…ç†æ‰çš„å­è¿›ç¨‹idï¼Œè‹¥è°ƒç”¨å‡ºé”™åˆ™è¿”å›-1ã€‚çˆ¶è¿›ç¨‹è°ƒç”¨waitæˆ–waitpidæ—¶å¯èƒ½ä¼šï¼š&lt;/p&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å¦‚æœçˆ¶è¿›ç¨‹çš„æ‰€æœ‰å­è¿›ç¨‹éƒ½è¿˜åœ¨è¿è¡Œï¼Œè°ƒç”¨waitå°†ä½¿çˆ¶è¿›ç¨‹é˜»å¡ï¼Œè€Œè°ƒç”¨waitpidæ—¶å¦‚æœåœ¨optionså‚æ•°ä¸­æŒ‡å®šWNOHANGå¯ä»¥ä½¿çˆ¶è¿›ç¨‹ä¸é˜»å¡è€Œç«‹å³è¿”å›0&lt;/li&gt;
&lt;li&gt;waitç­‰å¾…ç¬¬ä¸€ä¸ªç»ˆæ­¢çš„å­è¿›ç¨‹ï¼Œè€Œwaitpidå¯ä»¥é€šè¿‡pidå‚æ•°æŒ‡å®šç­‰å¾…å“ªä¸€ä¸ªå­è¿›ç¨‹&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;â€‹&lt;/p&gt;
&lt;h4 id=&quot;æºä»£ç &quot;&gt;æºä»£ç &lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;timeræºä»£ç &lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;cpp&quot;&gt;
&lt;code&gt;#include &amp;lt;math.h&amp;gt;
#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;stdlib.h&amp;gt;
#include &amp;lt;sys/time.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
#include &amp;lt;wait.h&amp;gt;
#include &amp;lt;ctime&amp;gt;
#include &amp;lt;iostream&amp;gt;
#include &amp;lt;cstring&amp;gt;
//ç¨‹åºå‡å®šè¾“å…¥å®Œå…¨æ­£ç¡®ï¼Œæ²¡æœ‰åšå¼‚å¸¸å¤„ç†
//mytime [-t number] ç¨‹åº
using namespace std;
//è°ƒç”¨ç³»ç»Ÿæ—¶é—´
struct timeval time_start;
struct timeval time_end;

void printTime();

void newProcess(const char *child_process, char *argv[], double duration);

int main(int argc, char const *argv[])
{
    double duration = 0;
    char **arg;
    int step = 2;
    if (argc &amp;gt; 3 &amp;amp;&amp;amp; (strcmp((char *)&quot;-t&quot;, argv[1]) == 0)) //å¦‚æœæŒ‡å®šäº†è¿è¡Œæ—¶é—´
    {
        step = 4;
        duration = atof(argv[2]); //æ²¡æœ‰åšå¼‚å¸¸å¤„ç†
    }

    arg = new char *[argc - step + 1];
    for (int i = 0; i &amp;lt; argc - step; i++)
    {
        arg[i] = new char[100];
        strcpy(arg[i], argv[i + step]);
    }
    arg[argc - step] = NULL;

    newProcess(argv[step - 1], arg, duration);
    return 0;
}

void printTime()
{
    //ç”¨ä»¥è®°å½•è¿›ç¨‹è¿è¡Œçš„æ—¶é—´
    int time_use = 0;  // us
    int time_left = 0; // us
    int time_hour = 0, time_min = 0, time_sec = 0, time_ms = 0, time_us = 0;
    gettimeofday(&amp;amp;time_end, NULL);

    time_use = (time_end.tv_sec - time_start.tv_sec) * 1000000 + (time_end.tv_usec - time_start.tv_usec);
    time_hour = time_use / (60 * 60 * (int)pow(10, 6));
    time_left = time_use % (60 * 60 * (int)pow(10, 6));
    time_min = time_left / (60 * (int)pow(10, 6));
    time_left %= (60 * (int)pow(10, 6));
    time_sec = time_left / ((int)pow(10, 6));
    time_left %= ((int)pow(10, 6));
    time_ms = time_left / 1000;
    time_left %= 1000;
    time_us = time_left;
    printf(&quot;æ­¤ç¨‹åºè¿è¡Œçš„æ—¶é—´ä¸ºï¼š%d å°æ—¶, %d åˆ†é’Ÿ, %d ç§’, %d æ¯«ç§’, %d å¾®ç§’\n&quot;, time_hour, time_min, time_sec, time_ms, time_us);
}

void newProcess(const char* child_process, char **argv, double duration)
{
    pid_t pid = fork();
    if (pid &amp;lt; 0) //å‡ºé”™
    {
        printf(&quot;åˆ›å»ºå­è¿›ç¨‹å¤±è´¥ï¼&quot;);
        exit(1);
    }
    if (pid == 0) //å­è¿›ç¨‹
    {
        execvp(child_process, argv);
    }
    else
    {
        if (abs(duration - 0) &amp;lt; 1e-6)
        {
            gettimeofday(&amp;amp;time_start, NULL);
            wait(NULL); //ç­‰å¾…å­è¿›ç¨‹ç»“æŸ
            printTime();
        }
        else
        {
            gettimeofday(&amp;amp;time_start, NULL);
            // printf(&quot;sleep: %lf\n&quot;, duration);
            waitpid(pid, NULL, WNOHANG);
            usleep(duration * 1000000); // sec to usec
            int kill_ret_val = kill(pid, SIGKILL);
            if (kill_ret_val == -1) // return -1, fail
            {
                printf(&quot;kill failed.\n&quot;);
                perror(&quot;kill&quot;);
            }
            else if (kill_ret_val == 0) // return 0, success
            {
                printf(&quot;process %d has been killed\n&quot;, pid);
            }
            printTime();
        }
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;æµ‹è¯•æºä»£ç &lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;cpp&quot;&gt;
&lt;code&gt;#include &amp;lt;iostream&amp;gt;
#include &amp;lt;ctime&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
using namespace std;
int main(int argc, char const *argv[])
{
    for(int n = 0; n &amp;lt; argc; n++)
    {
        printf(&quot;arg[%d]:%s\n&quot;,n, argv[n]);
    }
    sleep(5);
    return 0;
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;æµ‹è¯•&quot;&gt;æµ‹è¯•&lt;/h3&gt;
&lt;ol readability=&quot;-1&quot;&gt;&lt;li&gt;
&lt;p&gt;è‡ªè¡Œç¼–å†™ç¨‹åºæµ‹è¯•&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1653979/201911/1653979-20191122002202384-1573837414.png&quot; alt=&quot;1574351830016&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç³»ç»Ÿç¨‹åºæµ‹è¯•&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1653979/201911/1653979-20191122002202710-1833783194.png&quot; alt=&quot;1574351915002&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;å°†timeråŠ å…¥ç¯å¢ƒå˜é‡&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä»…è¿›è¡Œäº†ä¸´æ—¶å˜é‡ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1653979/201911/1653979-20191122002206211-1121320256.png&quot; alt=&quot;1574352171410&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;h2 id=&quot;windows&quot;&gt;Windows&lt;/h2&gt;
&lt;p&gt;åœ¨Windowsä¸‹è¿›è¡Œçˆ¶å­è¿›ç¨‹çš„åˆ›å»ºå’Œç®¡ç†åœ¨apiè°ƒç”¨ä¸Šç›¸è¾ƒLinuxæœ‰ä¸€å®šéš¾åº¦ï¼Œä½†å®é™…ä¸Šåœ¨ä½¿ç”¨ç®¡ç†ä¸Šæ¯”Linuxå®¹æ˜“çš„å¤šã€‚&lt;/p&gt;
&lt;h3 id=&quot;createprocess&quot;&gt;CreateProcess&lt;/h3&gt;
&lt;pre class=&quot;cpp&quot;&gt;
&lt;code&gt;#include &amp;lt;Windows.h&amp;gt;
BOOL CreateProcessA(
  LPCSTR                lpApplicationName,
  LPSTR                 lpCommandLine,
  LPSECURITY_ATTRIBUTES lpProcessAttributes,
  LPSECURITY_ATTRIBUTES lpThreadAttributes,
  BOOL                  bInheritHandles,
  DWORD                 dwCreationFlags,
  LPVOID                lpEnvironment,
  LPCSTR                lpCurrentDirectory,
  LPSTARTUPINFOA        lpStartupInfo,
  LPPROCESS_INFORMATION lpProcessInformation
);&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;æºä»£ç å®ç°&quot;&gt;æºä»£ç å®ç°&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;timerç¨‹åº&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;cpp&quot;&gt;
&lt;code&gt;// è¿›ç¨‹ç®¡ç†.cpp : æ­¤æ–‡ä»¶åŒ…å« &quot;main&quot; å‡½æ•°ã€‚ç¨‹åºæ‰§è¡Œå°†åœ¨æ­¤å¤„å¼€å§‹å¹¶ç»“æŸã€‚
//

#include &amp;lt;iostream&amp;gt;
#include &amp;lt;wchar.h&amp;gt;
#include &amp;lt;Windows.h&amp;gt;
#include &amp;lt;tchar.h&amp;gt;
using namespace std;


void printTime(SYSTEMTIME* start, SYSTEMTIME* end);
void newProcess(TCHAR* cWinDir, double duration);

int _tmain(int argc, TCHAR *argv[])
{
    TCHAR* cWinDir = new TCHAR[MAX_PATH];
    memset(cWinDir, sizeof(TCHAR) * MAX_PATH, 0);

    printf(&quot;argc:   %d\n&quot;, argc);

    int step = 1;
    double duration = 0;
    if (argc &amp;gt; 1)
    {
        if (argv[1][0] == TCHAR('-') &amp;amp;&amp;amp; argv[1][1] == TCHAR('t') &amp;amp;&amp;amp; argv[1][2] == TCHAR('\0'))
        {
            step = 3;
            duration = atof((char*)argv[2]);
        }
    }
    //printf(&quot;printf content start: %ls\n&quot;, argv[1]);
    int j = 0;
    for (int i = 0, h = 0; i &amp;lt; argc - step; i++)
    {
        wcscpy_s(cWinDir + j, MAX_PATH - j, argv[i + step]);
        for (h = 0; argv[i + step][h] != TCHAR('\0'); h++);
        j += h;
        cWinDir[j++] = ' ';
        //printf(&quot;%d : %d\n&quot;, i, j);
        //printf(&quot;printf content start: %ls\n&quot;, cWinDir);
    }
    cWinDir[j - 2] = TCHAR('\0');
    //printf(&quot;printf content start: %ls\n&quot;, cWinDir);

    newProcess(cWinDir,duration);

    return 0;
}


void printTime(SYSTEMTIME* start, SYSTEMTIME* end)
{
    int hours = end-&amp;gt;wHour - start-&amp;gt;wHour;
    int minutes = end-&amp;gt;wMinute - start-&amp;gt;wMinute;
    int seconds = end-&amp;gt;wSecond - start-&amp;gt;wSecond;
    int ms = end-&amp;gt;wMilliseconds - start-&amp;gt;wMilliseconds;
    if (ms &amp;lt; 0)
    {
        ms += 1000;
        seconds -= 1;
    }
    if (seconds &amp;lt; 0)
    {
        seconds += 60;
        minutes -= 1;
    }
    if (minutes &amp;lt; 0)
    {
        minutes += 60;
        hours -= 1;
    }
    //ç”±äºä»…è€ƒè™‘åœ¨ä¸€å¤©ä¹‹å†…ï¼Œä¸è€ƒè™‘å°æ—¶ä¼šå˜æˆè´Ÿæ•°çš„æƒ…å†µ
    printf(&quot;runtime: %02dhours %02dminutes %02dseconds %02dmilliseconds\n&quot;, hours, minutes, seconds, ms);
}

void newProcess(TCHAR* cWinDir, double duration)
{
    PROCESS_INFORMATION pi;
    STARTUPINFO si;
    ZeroMemory(&amp;amp;si, sizeof(si));
    si.cb = sizeof(si);
    ZeroMemory(&amp;amp;pi, sizeof(pi));
    

    SYSTEMTIME start_time, end_time;
    memset(&amp;amp;start_time, sizeof(SYSTEMTIME), 0);
    memset(&amp;amp;end_time, sizeof(SYSTEMTIME), 0);
    GetSystemTime(&amp;amp;start_time);

    if (CreateProcess(
        NULL,       //lpApplicationName.è‹¥ä¸ºç©ºï¼Œåˆ™lpCommandLineå¿…é¡»æŒ‡å®šå¯æ‰§è¡Œç¨‹åº
                    //è‹¥è·¯å¾„ä¸­å­˜åœ¨ç©ºæ ¼ï¼Œå¿…é¡»ä½¿ç”¨å¼•å·æ¡†å®š
        cWinDir,    //lpCommandLine
                    //è‹¥lpApplicationNameä¸ºç©ºï¼ŒlpCommandLineé•¿åº¦ä¸è¶…è¿‡MAX_PATH
        NULL,       //æŒ‡å‘ä¸€ä¸ªSECURITY_ATTRIBUTESç»“æ„ä½“ï¼Œè¿™ä¸ªç»“æ„ä½“å†³å®šæ˜¯å¦è¿”å›çš„å¥æŸ„å¯ä»¥è¢«å­è¿›ç¨‹ç»§æ‰¿ï¼Œè¿›ç¨‹å®‰å…¨æ€§
        NULL,       //  å¦‚æœlpProcessAttributeså‚æ•°ä¸ºç©ºï¼ˆNULLï¼‰ï¼Œé‚£ä¹ˆå¥æŸ„ä¸èƒ½è¢«ç»§æ‰¿ã€‚&amp;lt;åŒä¸Š&amp;gt;ï¼Œçº¿ç¨‹å®‰å…¨æ€§
        false,      //  æŒ‡ç¤ºæ–°è¿›ç¨‹æ˜¯å¦ä»è°ƒç”¨è¿›ç¨‹å¤„ç»§æ‰¿äº†å¥æŸ„ã€‚å¥æŸ„å¯ç»§æ‰¿æ€§
        0,          //  æŒ‡å®šé™„åŠ çš„ã€ç”¨æ¥æ§åˆ¶ä¼˜å…ˆç±»å’Œè¿›ç¨‹çš„åˆ›å»ºçš„æ ‡è¯†ç¬¦ï¼ˆä¼˜å…ˆçº§ï¼‰
                    //  CREATE_NEW_CONSOLE  æ–°æ§åˆ¶å°æ‰“å¼€å­è¿›ç¨‹
                    //  CREATE_SUSPENDED    å­è¿›ç¨‹åˆ›å»ºåæŒ‚èµ·ï¼Œç›´åˆ°è°ƒç”¨ResumeThreadå‡½æ•°
        NULL,       //  æŒ‡å‘ä¸€ä¸ªæ–°è¿›ç¨‹çš„ç¯å¢ƒå—ã€‚å¦‚æœæ­¤å‚æ•°ä¸ºç©ºï¼Œæ–°è¿›ç¨‹ä½¿ç”¨è°ƒç”¨è¿›ç¨‹çš„ç¯å¢ƒã€‚æŒ‡å‘ç¯å¢ƒå­—ç¬¦ä¸²
        NULL,       //  æŒ‡å®šå­è¿›ç¨‹çš„å·¥ä½œè·¯å¾„
        &amp;amp;si,        //  å†³å®šæ–°è¿›ç¨‹çš„ä¸»çª—ä½“å¦‚ä½•æ˜¾ç¤ºçš„STARTUPINFOç»“æ„ä½“
        &amp;amp;pi         //  æ¥æ”¶æ–°è¿›ç¨‹çš„è¯†åˆ«ä¿¡æ¯çš„PROCESS_INFORMATIONç»“æ„ä½“ã€‚è¿›ç¨‹çº¿ç¨‹ä»¥åŠå¥æŸ„
    ))
    {
    }
    else
    {
        printf(&quot;CreateProcess failed (%d).\n&quot;, GetLastError());
        return;
    }


    //wait untill the child process exits
    if (abs(duration - 0) &amp;lt; 1e-6)
        WaitForSingleObject(pi.hProcess, INFINITE);//è¿™é‡ŒæŒ‡å®šè¿è¡Œæ—¶é—´ï¼Œå•ä½æ¯«ç§’
    else
        WaitForSingleObject(pi.hProcess, duration * 1000);

    GetSystemTime(&amp;amp;end_time);

    printTime(&amp;amp;start_time, &amp;amp;end_time);

    CloseHandle(pi.hProcess);
    CloseHandle(pi.hThread);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;æµ‹è¯•ç¨‹åº&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;cpp&quot;&gt;
&lt;code&gt;#include &amp;lt;iostream&amp;gt;
#include &amp;lt;Windows.h&amp;gt;
using namespace std;
int main(int argc, char* argv[])
{
    for (int n = 0; n &amp;lt; argc; n++)
    {
        printf(&quot;arg[%d]:%s\n&quot;, n, argv[n]);
    }
    Sleep(5*1000);
    return 0;
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;æµ‹è¯•-1&quot;&gt;æµ‹è¯•&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;
&lt;p&gt;è‡ªè¡Œç¼–å†™ç¨‹åºæµ‹è¯•&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1653979/201911/1653979-20191122002208277-1323864899.png&quot; alt=&quot;1574352549870&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç³»ç»Ÿç¨‹åºæµ‹è¯•&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1653979/201911/1653979-20191122002208962-1876671015.png&quot; alt=&quot;1574352658762&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ·»åŠ è‡³ç¯å¢ƒå˜é‡&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1653979/201911/1653979-20191122002210576-895999278.png&quot; alt=&quot;1574353167296&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;h2 id=&quot;å‚è€ƒèµ„æ–™&quot;&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;
&lt;h3 id=&quot;windows-1&quot;&gt;Windows&lt;/h3&gt;
&lt;h3 id=&quot;linux-1&quot;&gt;Linux&lt;/h3&gt;
</description>
<pubDate>Thu, 21 Nov 2019 16:27:00 +0000</pubDate>
<dc:creator>LightningStar</dc:creator>
<og:description>è¿›ç¨‹ç®¡ç†æ§åˆ¶ è¿™é‡Œå®ç°çš„æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰timerç”¨äºç»Ÿè®¡å­è¿›ç¨‹è¿è¡Œçš„æ—¶é—´ã€‚ä½¿ç”¨æ–¹å¼ä¸»è¦æ˜¯ ä¾‹å¦‚è¦ç»Ÿè®¡ çš„è¿è¡Œæ—¶é—´å¯ä»¥ç›´æ¥è¾“å…¥ ï¼Œå…¶åçš„ æ˜¯æŒ‡æ‰€è¦è¿è¡Œçš„ç¨‹åºçš„å‚æ•°ã€‚å¦‚ï¼š ã€‚å¦‚æœè¦æŒ‡å®šç¨‹åºè¿è¡Œå¤šå°‘æ—¶é—´ï¼Œå¦‚5</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/harrypotterjackson/p/11908825.html</dc:identifier>
</item>
<item>
<title>æ·±å…¥ç†è§£Kafkaå¿…çŸ¥å¿…ä¼šï¼ˆ2ï¼‰ - luozhiyun</title>
<link>http://www.cnblogs.com/luozhiyun/p/11909315.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/luozhiyun/p/11909315.html</guid>
<description>&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/luozhiyun/p/11811835.html&quot;&gt;æ·±å…¥ç†è§£Kafkaå¿…çŸ¥å¿…ä¼šï¼ˆ1ï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;kafkaç›®å‰æœ‰å“ªäº›å†…éƒ¨topicå®ƒä»¬éƒ½æœ‰ä»€ä¹ˆç‰¹å¾å„è‡ªçš„ä½œç”¨åˆæ˜¯ä»€ä¹ˆ&quot;&gt;Kafkaç›®å‰æœ‰å“ªäº›å†…éƒ¨topicï¼Œå®ƒä»¬éƒ½æœ‰ä»€ä¹ˆç‰¹å¾ï¼Ÿå„è‡ªçš„ä½œç”¨åˆæ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h3&gt;
&lt;p&gt;__consumer_offsetsï¼šä½œç”¨æ˜¯ä¿å­˜ Kafka æ¶ˆè´¹è€…çš„ä½ç§»ä¿¡æ¯&lt;br/&gt;__transaction_stateï¼šç”¨æ¥å­˜å‚¨äº‹åŠ¡æ—¥å¿—æ¶ˆæ¯&lt;/p&gt;
&lt;h3 id=&quot;ä¼˜å…ˆå‰¯æœ¬æ˜¯ä»€ä¹ˆå®ƒæœ‰ä»€ä¹ˆç‰¹æ®Šçš„ä½œç”¨&quot;&gt;ä¼˜å…ˆå‰¯æœ¬æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰ä»€ä¹ˆç‰¹æ®Šçš„ä½œç”¨ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;æ‰€è°“çš„ä¼˜å…ˆå‰¯æœ¬æ˜¯æŒ‡åœ¨ARé›†åˆåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå‰¯æœ¬ã€‚&lt;br/&gt;ç†æƒ³æƒ…å†µä¸‹ï¼Œä¼˜å…ˆå‰¯æœ¬å°±æ˜¯è¯¥åˆ†åŒºçš„leader å‰¯æœ¬ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸º preferred leaderã€‚Kafka è¦ç¡®ä¿æ‰€æœ‰ä¸»é¢˜çš„ä¼˜å…ˆå‰¯æœ¬åœ¨ Kafka é›†ç¾¤ä¸­å‡åŒ€åˆ†å¸ƒï¼Œè¿™æ ·å°±ä¿è¯äº†æ‰€æœ‰åˆ†åŒºçš„ leader å‡è¡¡åˆ†å¸ƒã€‚ä»¥æ­¤æ¥ä¿ƒè¿›é›†ç¾¤çš„è´Ÿè½½å‡è¡¡ï¼Œè¿™ä¸€è¡Œä¸ºä¹Ÿå¯ä»¥ç§°ä¸ºâ€œåˆ†åŒºå¹³è¡¡â€ã€‚&lt;/p&gt;
&lt;h3 id=&quot;kafkaæœ‰å“ªå‡ å¤„åœ°æ–¹æœ‰åˆ†åŒºåˆ†é…çš„æ¦‚å¿µç®€è¿°å¤§è‡´çš„è¿‡ç¨‹åŠåŸç†&quot;&gt;Kafkaæœ‰å“ªå‡ å¤„åœ°æ–¹æœ‰åˆ†åŒºåˆ†é…çš„æ¦‚å¿µï¼Ÿç®€è¿°å¤§è‡´çš„è¿‡ç¨‹åŠåŸç†&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;ç”Ÿäº§è€…çš„åˆ†åŒºåˆ†é…æ˜¯æŒ‡ä¸ºæ¯æ¡æ¶ˆæ¯æŒ‡å®šå…¶æ‰€è¦å‘å¾€çš„åˆ†åŒºã€‚å¯ä»¥ç¼–å†™ä¸€ä¸ªå…·ä½“çš„ç±»å®ç°org.apache.kafka.clients.producer.Partitioneræ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹è€…ä¸­çš„åˆ†åŒºåˆ†é…æ˜¯æŒ‡ä¸ºæ¶ˆè´¹è€…æŒ‡å®šå…¶å¯ä»¥æ¶ˆè´¹æ¶ˆæ¯çš„åˆ†åŒºã€‚Kafka æä¾›äº†æ¶ˆè´¹è€…å®¢æˆ·ç«¯å‚æ•° partition.assignment.strategy æ¥è®¾ç½®æ¶ˆè´¹è€…ä¸è®¢é˜…ä¸»é¢˜ä¹‹é—´çš„åˆ†åŒºåˆ†é…ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;åˆ†åŒºå‰¯æœ¬çš„åˆ†é…æ˜¯æŒ‡ä¸ºé›†ç¾¤åˆ¶å®šåˆ›å»ºä¸»é¢˜æ—¶çš„åˆ†åŒºå‰¯æœ¬åˆ†é…æ–¹æ¡ˆï¼Œå³åœ¨å“ªä¸ª broker ä¸­åˆ›å»ºå“ªäº›åˆ†åŒºçš„å‰¯æœ¬ã€‚kafka-topics.sh è„šæœ¬ä¸­æä¾›äº†ä¸€ä¸ª replica-assignment å‚æ•°æ¥æ‰‹åŠ¨æŒ‡å®šåˆ†åŒºå‰¯æœ¬çš„åˆ†é…æ–¹æ¡ˆã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;ç®€è¿°kafkaçš„æ—¥å¿—ç›®å½•ç»“æ„&quot;&gt;ç®€è¿°Kafkaçš„æ—¥å¿—ç›®å½•ç»“æ„&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1204119/201911/1204119-20191122000040480-372639560.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;Kafka ä¸­çš„æ¶ˆæ¯æ˜¯ä»¥ä¸»é¢˜ä¸ºåŸºæœ¬å•ä½è¿›è¡Œå½’ç±»çš„ï¼Œå„ä¸ªä¸»é¢˜åœ¨é€»è¾‘ä¸Šç›¸äº’ç‹¬ç«‹ã€‚æ¯ä¸ªä¸»é¢˜åˆå¯ä»¥åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªåˆ†åŒºã€‚ä¸è€ƒè™‘å¤šå‰¯æœ¬çš„æƒ…å†µï¼Œä¸€ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ªæ—¥å¿—ï¼ˆLogï¼‰ã€‚ä¸ºäº†é˜²æ­¢ Log è¿‡å¤§ï¼ŒKafka åˆå¼•å…¥äº†æ—¥å¿—åˆ†æ®µï¼ˆLogSegmentï¼‰çš„æ¦‚å¿µï¼Œå°† Log åˆ‡åˆ†ä¸ºå¤šä¸ª LogSegmentï¼Œç›¸å½“äºä¸€ä¸ªå·¨å‹æ–‡ä»¶è¢«å¹³å‡åˆ†é…ä¸ºå¤šä¸ªç›¸å¯¹è¾ƒå°çš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;Log å’Œ LogSegment ä¹Ÿä¸æ˜¯çº¯ç²¹ç‰©ç†æ„ä¹‰ä¸Šçš„æ¦‚å¿µï¼ŒLog åœ¨ç‰©ç†ä¸Šåªä»¥æ–‡ä»¶å¤¹çš„å½¢å¼å­˜å‚¨ï¼Œè€Œæ¯ä¸ª LogSegment å¯¹åº”äºç£ç›˜ä¸Šçš„ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å’Œä¸¤ä¸ªç´¢å¼•æ–‡ä»¶ï¼Œä»¥åŠå¯èƒ½çš„å…¶ä»–æ–‡ä»¶ï¼ˆæ¯”å¦‚ä»¥â€œ.txnindexâ€ä¸ºåç¼€çš„äº‹åŠ¡ç´¢å¼•æ–‡ä»¶ï¼‰&lt;/p&gt;
&lt;h3 id=&quot;kafkaä¸­æœ‰é‚£äº›ç´¢å¼•æ–‡ä»¶&quot;&gt;Kafkaä¸­æœ‰é‚£äº›ç´¢å¼•æ–‡ä»¶ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ªæ—¥å¿—åˆ†æ®µæ–‡ä»¶å¯¹åº”äº†ä¸¤ä¸ªç´¢å¼•æ–‡ä»¶ï¼Œä¸»è¦ç”¨æ¥æé«˜æŸ¥æ‰¾æ¶ˆæ¯çš„æ•ˆç‡ã€‚&lt;br/&gt;åç§»é‡ç´¢å¼•æ–‡ä»¶ç”¨æ¥å»ºç«‹æ¶ˆæ¯åç§»é‡ï¼ˆoffsetï¼‰åˆ°ç‰©ç†åœ°å€ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œæ–¹ä¾¿å¿«é€Ÿå®šä½æ¶ˆæ¯æ‰€åœ¨çš„ç‰©ç†æ–‡ä»¶ä½ç½®&lt;br/&gt;æ—¶é—´æˆ³ç´¢å¼•æ–‡ä»¶åˆ™æ ¹æ®æŒ‡å®šçš„æ—¶é—´æˆ³ï¼ˆtimestampï¼‰æ¥æŸ¥æ‰¾å¯¹åº”çš„åç§»é‡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å¦‚æœæˆ‘æŒ‡å®šäº†ä¸€ä¸ªoffsetkafkaæ€ä¹ˆæŸ¥æ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯&quot;&gt;å¦‚æœæˆ‘æŒ‡å®šäº†ä¸€ä¸ªoffsetï¼ŒKafkaæ€ä¹ˆæŸ¥æ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;Kafkaæ˜¯é€šè¿‡seek() æ–¹æ³•æ¥æŒ‡å®šæ¶ˆè´¹çš„ï¼Œåœ¨æ‰§è¡Œseek() æ–¹æ³•ä¹‹å‰è¦å»æ‰§è¡Œä¸€æ¬¡poll()æ–¹æ³•ï¼Œç­‰åˆ°åˆ†é…åˆ°åˆ†åŒºä¹‹åä¼šå»å¯¹åº”çš„åˆ†åŒºçš„æŒ‡å®šä½ç½®å¼€å§‹æ¶ˆè´¹ï¼Œå¦‚æœæŒ‡å®šçš„ä½ç½®å‘ç”Ÿäº†è¶Šç•Œï¼Œé‚£ä¹ˆä¼šæ ¹æ®auto.offset.reset å‚æ•°è®¾ç½®çš„æƒ…å†µè¿›è¡Œæ¶ˆè´¹ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å¦‚æœæˆ‘æŒ‡å®šäº†ä¸€ä¸ªtimestampkafkaæ€ä¹ˆæŸ¥æ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯&quot;&gt;å¦‚æœæˆ‘æŒ‡å®šäº†ä¸€ä¸ªtimestampï¼ŒKafkaæ€ä¹ˆæŸ¥æ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;Kafkaæä¾›äº†ä¸€ä¸ª offsetsForTimes() æ–¹æ³•ï¼Œé€šè¿‡ timestamp æ¥æŸ¥è¯¢ä¸æ­¤å¯¹åº”çš„åˆ†åŒºä½ç½®ã€‚offsetsForTimes() æ–¹æ³•çš„å‚æ•° timestampsToSearch æ˜¯ä¸€ä¸ª Map ç±»å‹ï¼Œkey ä¸ºå¾…æŸ¥è¯¢çš„åˆ†åŒºï¼Œè€Œ value ä¸ºå¾…æŸ¥è¯¢çš„æ—¶é—´æˆ³ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›æ—¶é—´æˆ³å¤§äºç­‰äºå¾…æŸ¥è¯¢æ—¶é—´çš„ç¬¬ä¸€æ¡æ¶ˆæ¯å¯¹åº”çš„ä½ç½®å’Œæ—¶é—´æˆ³ï¼Œå¯¹åº”äº OffsetAndTimestamp ä¸­çš„ offset å’Œ timestamp å­—æ®µã€‚&lt;/p&gt;
&lt;h3 id=&quot;èŠä¸€èŠä½ å¯¹kafkaçš„log-retentionçš„ç†è§£&quot;&gt;èŠä¸€èŠä½ å¯¹Kafkaçš„Log Retentionçš„ç†è§£&lt;/h3&gt;
&lt;p&gt;æ—¥å¿—åˆ é™¤ï¼ˆLog Retentionï¼‰ï¼šæŒ‰ç…§ä¸€å®šçš„ä¿ç•™ç­–ç•¥ç›´æ¥åˆ é™¤ä¸ç¬¦åˆæ¡ä»¶çš„æ—¥å¿—åˆ†æ®µã€‚&lt;br/&gt;æˆ‘ä»¬å¯ä»¥é€šè¿‡ broker ç«¯å‚æ•° log.cleanup.policy æ¥è®¾ç½®æ—¥å¿—æ¸…ç†ç­–ç•¥ï¼Œæ­¤å‚æ•°çš„é»˜è®¤å€¼ä¸ºâ€œdeleteâ€ï¼Œå³é‡‡ç”¨æ—¥å¿—åˆ é™¤çš„æ¸…ç†ç­–ç•¥ã€‚&lt;/p&gt;
&lt;ol readability=&quot;1.5&quot;&gt;&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;åŸºäºæ—¶é—´&lt;br/&gt;æ—¥å¿—åˆ é™¤ä»»åŠ¡ä¼šæ£€æŸ¥å½“å‰æ—¥å¿—æ–‡ä»¶ä¸­æ˜¯å¦æœ‰ä¿ç•™æ—¶é—´è¶…è¿‡è®¾å®šçš„é˜ˆå€¼ï¼ˆretentionMsï¼‰æ¥å¯»æ‰¾å¯åˆ é™¤çš„æ—¥å¿—åˆ†æ®µæ–‡ä»¶é›†åˆï¼ˆdeletableSegmentsï¼‰retentionMs å¯ä»¥é€šè¿‡ broker ç«¯å‚æ•° log.retention.hoursã€log.retention.minutes å’Œ log.retention.ms æ¥é…ç½®ï¼Œå…¶ä¸­ log.retention.ms çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œlog.retention.minutes æ¬¡ä¹‹ï¼Œlog.retention.hours æœ€ä½ã€‚é»˜è®¤æƒ…å†µä¸‹åªé…ç½®äº† log.retention.hours å‚æ•°ï¼Œå…¶å€¼ä¸º168ï¼Œæ•…é»˜è®¤æƒ…å†µä¸‹æ—¥å¿—åˆ†æ®µæ–‡ä»¶çš„ä¿ç•™æ—¶é—´ä¸º7å¤©ã€‚&lt;br/&gt;åˆ é™¤æ—¥å¿—åˆ†æ®µæ—¶ï¼Œé¦–å…ˆä¼šä» Log å¯¹è±¡ä¸­æ‰€ç»´æŠ¤æ—¥å¿—åˆ†æ®µçš„è·³è·ƒè¡¨ä¸­ç§»é™¤å¾…åˆ é™¤çš„æ—¥å¿—åˆ†æ®µï¼Œä»¥ä¿è¯æ²¡æœ‰çº¿ç¨‹å¯¹è¿™äº›æ—¥å¿—åˆ†æ®µè¿›è¡Œè¯»å–æ“ä½œã€‚ç„¶åå°†æ—¥å¿—åˆ†æ®µæ‰€å¯¹åº”çš„æ‰€æœ‰æ–‡ä»¶æ·»åŠ ä¸Šâ€œ.deletedâ€çš„åç¼€ï¼ˆå½“ç„¶ä¹ŸåŒ…æ‹¬å¯¹åº”çš„ç´¢å¼•æ–‡ä»¶ï¼‰ã€‚æœ€åäº¤ç”±ä¸€ä¸ªä»¥â€œdelete-fileâ€å‘½åçš„å»¶è¿Ÿä»»åŠ¡æ¥åˆ é™¤è¿™äº›ä»¥â€œ.deletedâ€ä¸ºåç¼€çš„æ–‡ä»¶ï¼Œè¿™ä¸ªä»»åŠ¡çš„å»¶è¿Ÿæ‰§è¡Œæ—¶é—´å¯ä»¥é€šè¿‡ file.delete.delay.ms å‚æ•°æ¥è°ƒé…ï¼Œæ­¤å‚æ•°çš„é»˜è®¤å€¼ä¸º60000ï¼Œå³1åˆ†é’Ÿã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;åŸºäºæ—¥å¿—å¤§å°&lt;br/&gt;æ—¥å¿—åˆ é™¤ä»»åŠ¡ä¼šæ£€æŸ¥å½“å‰æ—¥å¿—çš„å¤§å°æ˜¯å¦è¶…è¿‡è®¾å®šçš„é˜ˆå€¼ï¼ˆretentionSizeï¼‰æ¥å¯»æ‰¾å¯åˆ é™¤çš„æ—¥å¿—åˆ†æ®µçš„æ–‡ä»¶é›†åˆï¼ˆdeletableSegmentsï¼‰ã€‚&lt;br/&gt;retentionSize å¯ä»¥é€šè¿‡ broker ç«¯å‚æ•° log.retention.bytes æ¥é…ç½®ï¼Œé»˜è®¤å€¼ä¸º-1ï¼Œè¡¨ç¤ºæ— ç©·å¤§ã€‚æ³¨æ„ log.retention.bytes é…ç½®çš„æ˜¯ Log ä¸­æ‰€æœ‰æ—¥å¿—æ–‡ä»¶çš„æ€»å¤§å°ï¼Œè€Œä¸æ˜¯å•ä¸ªæ—¥å¿—åˆ†æ®µï¼ˆç¡®åˆ‡åœ°è¯´åº”è¯¥ä¸º .log æ—¥å¿—æ–‡ä»¶ï¼‰çš„å¤§å°ã€‚å•ä¸ªæ—¥å¿—åˆ†æ®µçš„å¤§å°ç”± broker ç«¯å‚æ•° log.segment.bytes æ¥é™åˆ¶ï¼Œé»˜è®¤å€¼ä¸º1073741824ï¼Œå³ 1GBã€‚&lt;br/&gt;è¿™ä¸ªåˆ é™¤æ“ä½œå’ŒåŸºäºæ—¶é—´çš„ä¿ç•™ç­–ç•¥çš„åˆ é™¤æ“ä½œç›¸åŒã€‚&lt;/li&gt;
&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;åŸºäºæ—¥å¿—èµ·å§‹åç§»é‡&lt;br/&gt;åŸºäºæ—¥å¿—èµ·å§‹åç§»é‡çš„ä¿ç•™ç­–ç•¥çš„åˆ¤æ–­ä¾æ®æ˜¯æŸæ—¥å¿—åˆ†æ®µçš„ä¸‹ä¸€ä¸ªæ—¥å¿—åˆ†æ®µçš„èµ·å§‹åç§»é‡ baseOffset æ˜¯å¦å°äºç­‰äº logStartOffsetï¼Œè‹¥æ˜¯ï¼Œåˆ™å¯ä»¥åˆ é™¤æ­¤æ—¥å¿—åˆ†æ®µã€‚&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1204119/201911/1204119-20191122000056481-1861985387.png&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾ logStartOffset ç­‰äº25ï¼Œæ—¥å¿—åˆ†æ®µ1çš„èµ·å§‹åç§»é‡ä¸º0ï¼Œæ—¥å¿—åˆ†æ®µ2çš„èµ·å§‹åç§»é‡ä¸º11ï¼Œæ—¥å¿—åˆ†æ®µ3çš„èµ·å§‹åç§»é‡ä¸º23ï¼Œé€šè¿‡å¦‚ä¸‹åŠ¨ä½œæ”¶é›†å¯åˆ é™¤çš„æ—¥å¿—åˆ†æ®µçš„æ–‡ä»¶é›†åˆ deletableSegmentsï¼š&lt;/p&gt;
&lt;p&gt;ä»å¤´å¼€å§‹éå†æ¯ä¸ªæ—¥å¿—åˆ†æ®µï¼Œæ—¥å¿—åˆ†æ®µ1çš„ä¸‹ä¸€ä¸ªæ—¥å¿—åˆ†æ®µçš„èµ·å§‹åç§»é‡ä¸º11ï¼Œå°äº logStartOffset çš„å¤§å°ï¼Œå°†æ—¥å¿—åˆ†æ®µ1åŠ å…¥ deletableSegmentsã€‚&lt;br/&gt;æ—¥å¿—åˆ†æ®µ2çš„ä¸‹ä¸€ä¸ªæ—¥å¿—åç§»é‡çš„èµ·å§‹åç§»é‡ä¸º23ï¼Œä¹Ÿå°äº logStartOffset çš„å¤§å°ï¼Œå°†æ—¥å¿—åˆ†æ®µ2åŠ å…¥ deletableSegmentsã€‚&lt;br/&gt;æ—¥å¿—åˆ†æ®µ3çš„ä¸‹ä¸€ä¸ªæ—¥å¿—åç§»é‡åœ¨ logStartOffset çš„å³ä¾§ï¼Œæ•…ä»æ—¥å¿—åˆ†æ®µ3å¼€å§‹çš„æ‰€æœ‰æ—¥å¿—åˆ†æ®µéƒ½ä¸ä¼šåŠ å…¥ deletableSegmentsã€‚&lt;br/&gt;æ”¶é›†å®Œå¯åˆ é™¤çš„æ—¥å¿—åˆ†æ®µçš„æ–‡ä»¶é›†åˆä¹‹åçš„åˆ é™¤æ“ä½œåŒåŸºäºæ—¥å¿—å¤§å°çš„ä¿ç•™ç­–ç•¥å’ŒåŸºäºæ—¶é—´çš„ä¿ç•™ç­–ç•¥ç›¸åŒ&lt;/p&gt;
&lt;h3 id=&quot;èŠä¸€èŠä½ å¯¹kafkaçš„log-compactionçš„ç†è§£&quot;&gt;èŠä¸€èŠä½ å¯¹Kafkaçš„Log Compactionçš„ç†è§£&lt;/h3&gt;
&lt;p&gt;æ—¥å¿—å‹ç¼©ï¼ˆLog Compactionï¼‰ï¼šé’ˆå¯¹æ¯ä¸ªæ¶ˆæ¯çš„ key è¿›è¡Œæ•´åˆï¼Œå¯¹äºæœ‰ç›¸åŒ key çš„ä¸åŒ value å€¼ï¼Œåªä¿ç•™æœ€åä¸€ä¸ªç‰ˆæœ¬ã€‚&lt;br/&gt;å¦‚æœè¦é‡‡ç”¨æ—¥å¿—å‹ç¼©çš„æ¸…ç†ç­–ç•¥ï¼Œå°±éœ€è¦å°† log.cleanup.policy è®¾ç½®ä¸ºâ€œcompactâ€ï¼Œå¹¶ä¸”è¿˜éœ€è¦å°† log.cleaner.enable ï¼ˆé»˜è®¤å€¼ä¸º trueï¼‰è®¾å®šä¸º trueã€‚&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1204119/201911/1204119-20191122000109206-397224030.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒLog Compaction å¯¹äºæœ‰ç›¸åŒ key çš„ä¸åŒ value å€¼ï¼Œåªä¿ç•™æœ€åä¸€ä¸ªç‰ˆæœ¬ã€‚å¦‚æœåº”ç”¨åªå…³å¿ƒ key å¯¹åº”çš„æœ€æ–° value å€¼ï¼Œåˆ™å¯ä»¥å¼€å¯ Kafka çš„æ—¥å¿—æ¸…ç†åŠŸèƒ½ï¼ŒKafka ä¼šå®šæœŸå°†ç›¸åŒ key çš„æ¶ˆæ¯è¿›è¡Œåˆå¹¶ï¼Œåªä¿ç•™æœ€æ–°çš„ value å€¼ã€‚&lt;/p&gt;
&lt;h3 id=&quot;èŠä¸€èŠä½ å¯¹kafkaåº•å±‚å­˜å‚¨çš„ç†è§£&quot;&gt;èŠä¸€èŠä½ å¯¹Kafkaåº•å±‚å­˜å‚¨çš„ç†è§£&lt;/h3&gt;
&lt;h4 id=&quot;é¡µç¼“å­˜&quot;&gt;é¡µç¼“å­˜&lt;/h4&gt;
&lt;p&gt;é¡µç¼“å­˜æ˜¯æ“ä½œç³»ç»Ÿå®ç°çš„ä¸€ç§ä¸»è¦çš„ç£ç›˜ç¼“å­˜ï¼Œä»¥æ­¤ç”¨æ¥å‡å°‘å¯¹ç£ç›˜ I/O çš„æ“ä½œã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯æŠŠç£ç›˜ä¸­çš„æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­ï¼ŒæŠŠå¯¹ç£ç›˜çš„è®¿é—®å˜ä¸ºå¯¹å†…å­˜çš„è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä¸€ä¸ªè¿›ç¨‹å‡†å¤‡è¯»å–ç£ç›˜ä¸Šçš„æ–‡ä»¶å†…å®¹æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå…ˆæŸ¥çœ‹å¾…è¯»å–çš„æ•°æ®æ‰€åœ¨çš„é¡µï¼ˆpageï¼‰æ˜¯å¦åœ¨é¡µç¼“å­˜ï¼ˆpagecacheï¼‰ä¸­ï¼Œå¦‚æœå­˜åœ¨ï¼ˆå‘½ä¸­ï¼‰åˆ™ç›´æ¥è¿”å›æ•°æ®ï¼Œä»è€Œé¿å…äº†å¯¹ç‰©ç†ç£ç›˜çš„ I/O æ“ä½œï¼›å¦‚æœæ²¡æœ‰å‘½ä¸­ï¼Œåˆ™æ“ä½œç³»ç»Ÿä¼šå‘ç£ç›˜å‘èµ·è¯»å–è¯·æ±‚å¹¶å°†è¯»å–çš„æ•°æ®é¡µå­˜å…¥é¡µç¼“å­˜ï¼Œä¹‹åå†å°†æ•°æ®è¿”å›ç»™è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ ·ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹éœ€è¦å°†æ•°æ®å†™å…¥ç£ç›˜ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿä¹Ÿä¼šæ£€æµ‹æ•°æ®å¯¹åº”çš„é¡µæ˜¯å¦åœ¨é¡µç¼“å­˜ä¸­ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šå…ˆåœ¨é¡µç¼“å­˜ä¸­æ·»åŠ ç›¸åº”çš„é¡µï¼Œæœ€åå°†æ•°æ®å†™å…¥å¯¹åº”çš„é¡µã€‚è¢«ä¿®æ”¹è¿‡åçš„é¡µä¹Ÿå°±å˜æˆäº†è„é¡µï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨åˆé€‚çš„æ—¶é—´æŠŠè„é¡µä¸­çš„æ•°æ®å†™å…¥ç£ç›˜ï¼Œä»¥ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨è¿‡ Java çš„äººä¸€èˆ¬éƒ½çŸ¥é“ä¸¤ç‚¹äº‹å®ï¼šå¯¹è±¡çš„å†…å­˜å¼€é”€éå¸¸å¤§ï¼Œé€šå¸¸ä¼šæ˜¯çœŸå®æ•°æ®å¤§å°çš„å‡ å€ç”šè‡³æ›´å¤šï¼Œç©ºé—´ä½¿ç”¨ç‡ä½ä¸‹ï¼›Java çš„åƒåœ¾å›æ”¶ä¼šéšç€å †å†…æ•°æ®çš„å¢å¤šè€Œå˜å¾—è¶Šæ¥è¶Šæ…¢ã€‚åŸºäºè¿™äº›å› ç´ ï¼Œä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿå¹¶ä¾èµ–äºé¡µç¼“å­˜çš„åšæ³•æ˜æ˜¾è¦ä¼˜äºç»´æŠ¤ä¸€ä¸ªè¿›ç¨‹å†…ç¼“å­˜æˆ–å…¶ä»–ç»“æ„ï¼Œè‡³å°‘æˆ‘ä»¬å¯ä»¥çœå»äº†ä¸€ä»½è¿›ç¨‹å†…éƒ¨çš„ç¼“å­˜æ¶ˆè€—ï¼ŒåŒæ—¶è¿˜å¯ä»¥é€šè¿‡ç»“æ„ç´§å‡‘çš„å­—èŠ‚ç æ¥æ›¿ä»£ä½¿ç”¨å¯¹è±¡çš„æ–¹å¼ä»¥èŠ‚çœæ›´å¤šçš„ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œå³ä½¿ Kafka æœåŠ¡é‡å¯ï¼Œé¡µç¼“å­˜è¿˜æ˜¯ä¼šä¿æŒæœ‰æ•ˆï¼Œç„¶è€Œè¿›ç¨‹å†…çš„ç¼“å­˜å´éœ€è¦é‡å»ºã€‚è¿™æ ·ä¹Ÿæå¤§åœ°ç®€åŒ–äº†ä»£ç é€»è¾‘ï¼Œå› ä¸ºç»´æŠ¤é¡µç¼“å­˜å’Œæ–‡ä»¶ä¹‹é—´çš„ä¸€è‡´æ€§äº¤ç”±æ“ä½œç³»ç»Ÿæ¥è´Ÿè´£ï¼Œè¿™æ ·ä¼šæ¯”è¿›ç¨‹å†…ç»´æŠ¤æ›´åŠ å®‰å…¨æœ‰æ•ˆã€‚&lt;/p&gt;
&lt;h4 id=&quot;é›¶æ‹·è´&quot;&gt;é›¶æ‹·è´&lt;/h4&gt;
&lt;p&gt;é™¤äº†æ¶ˆæ¯é¡ºåºè¿½åŠ ã€é¡µç¼“å­˜ç­‰æŠ€æœ¯ï¼ŒKafka è¿˜ä½¿ç”¨é›¶æ‹·è´ï¼ˆZero-Copyï¼‰æŠ€æœ¯æ¥è¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚æ‰€è°“çš„é›¶æ‹·è´æ˜¯æŒ‡å°†æ•°æ®ç›´æ¥ä»ç£ç›˜æ–‡ä»¶å¤åˆ¶åˆ°ç½‘å¡è®¾å¤‡ä¸­ï¼Œè€Œä¸éœ€è¦ç»ç”±åº”ç”¨ç¨‹åºä¹‹æ‰‹ã€‚é›¶æ‹·è´å¤§å¤§æé«˜äº†åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œå‡å°‘äº†å†…æ ¸å’Œç”¨æˆ·æ¨¡å¼ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚å¯¹ Linux æ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œé›¶æ‹·è´æŠ€æœ¯ä¾èµ–äºåº•å±‚çš„ sendfile() æ–¹æ³•å®ç°ã€‚å¯¹åº”äº Java è¯­è¨€ï¼ŒFileChannal.transferTo() æ–¹æ³•çš„åº•å±‚å®ç°å°±æ˜¯ sendfile() æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h3 id=&quot;èŠä¸€èŠkafkaçš„å»¶æ—¶æ“ä½œçš„åŸç†&quot;&gt;èŠä¸€èŠKafkaçš„å»¶æ—¶æ“ä½œçš„åŸç†&lt;/h3&gt;
&lt;p&gt;Kafka ä¸­æœ‰å¤šç§å»¶æ—¶æ“ä½œï¼Œæ¯”å¦‚å»¶æ—¶ç”Ÿäº§ï¼Œè¿˜æœ‰å»¶æ—¶æ‹‰å–ï¼ˆDelayedFetchï¼‰ã€å»¶æ—¶æ•°æ®åˆ é™¤ï¼ˆDelayedDeleteRecordsï¼‰ç­‰ã€‚&lt;br/&gt;å»¶æ—¶æ“ä½œåˆ›å»ºä¹‹åä¼šè¢«åŠ å…¥å»¶æ—¶æ“ä½œç®¡ç†å™¨ï¼ˆDelayedOperationPurgatoryï¼‰æ¥åšä¸“é—¨çš„å¤„ç†ã€‚å»¶æ—¶æ“ä½œæœ‰å¯èƒ½ä¼šè¶…æ—¶ï¼Œæ¯ä¸ªå»¶æ—¶æ“ä½œç®¡ç†å™¨éƒ½ä¼šé…å¤‡ä¸€ä¸ªå®šæ—¶å™¨ï¼ˆSystemTimerï¼‰æ¥åšè¶…æ—¶ç®¡ç†ï¼Œå®šæ—¶å™¨çš„åº•å±‚å°±æ˜¯é‡‡ç”¨æ—¶é—´è½®ï¼ˆTimingWheelï¼‰å®ç°çš„ã€‚&lt;/p&gt;
&lt;h3 id=&quot;èŠä¸€èŠkafkaæ§åˆ¶å™¨çš„ä½œç”¨&quot;&gt;èŠä¸€èŠKafkaæ§åˆ¶å™¨çš„ä½œç”¨&lt;/h3&gt;
&lt;p&gt;åœ¨ Kafka é›†ç¾¤ä¸­ä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ª brokerï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª broker ä¼šè¢«é€‰ä¸¾ä¸ºæ§åˆ¶å™¨ï¼ˆKafka Controllerï¼‰ï¼Œå®ƒè´Ÿè´£ç®¡ç†æ•´ä¸ªé›†ç¾¤ä¸­æ‰€æœ‰åˆ†åŒºå’Œå‰¯æœ¬çš„çŠ¶æ€ã€‚å½“æŸä¸ªåˆ†åŒºçš„ leader å‰¯æœ¬å‡ºç°æ•…éšœæ—¶ï¼Œç”±æ§åˆ¶å™¨è´Ÿè´£ä¸ºè¯¥åˆ†åŒºé€‰ä¸¾æ–°çš„ leader å‰¯æœ¬ã€‚å½“æ£€æµ‹åˆ°æŸä¸ªåˆ†åŒºçš„ ISR é›†åˆå‘ç”Ÿå˜åŒ–æ—¶ï¼Œç”±æ§åˆ¶å™¨è´Ÿè´£é€šçŸ¥æ‰€æœ‰brokeræ›´æ–°å…¶å…ƒæ•°æ®ä¿¡æ¯ã€‚å½“ä½¿ç”¨ kafka-topics.sh è„šæœ¬ä¸ºæŸä¸ª topic å¢åŠ åˆ†åŒºæ•°é‡æ—¶ï¼ŒåŒæ ·è¿˜æ˜¯ç”±æ§åˆ¶å™¨è´Ÿè´£åˆ†åŒºçš„é‡æ–°åˆ†é…ã€‚&lt;/p&gt;
&lt;h3 id=&quot;kafkaçš„æ—§ç‰ˆscalaçš„æ¶ˆè´¹è€…å®¢æˆ·ç«¯çš„è®¾è®¡æœ‰ä»€ä¹ˆç¼ºé™·&quot;&gt;Kafkaçš„æ—§ç‰ˆScalaçš„æ¶ˆè´¹è€…å®¢æˆ·ç«¯çš„è®¾è®¡æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1204119/201911/1204119-20191122000122500-534809481.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä¸Šå›¾ï¼Œæ—§ç‰ˆæ¶ˆè´¹è€…å®¢æˆ·ç«¯æ¯ä¸ªæ¶ˆè´¹ç»„ï¼ˆï¼‰åœ¨ ZooKeeper ä¸­éƒ½ç»´æŠ¤äº†ä¸€ä¸ª /consumers//ids è·¯å¾„ï¼Œåœ¨æ­¤è·¯å¾„ä¸‹ä½¿ç”¨ä¸´æ—¶èŠ‚ç‚¹è®°å½•éš¶å±äºæ­¤æ¶ˆè´¹ç»„çš„æ¶ˆè´¹è€…çš„å”¯ä¸€æ ‡è¯†ï¼ˆconsumerIdStringï¼‰ï¼Œ/consumers//owner è·¯å¾„ä¸‹è®°å½•äº†åˆ†åŒºå’Œæ¶ˆè´¹è€…çš„å¯¹åº”å…³ç³»ï¼Œ/consumers//offsets è·¯å¾„ä¸‹è®°å½•äº†æ­¤æ¶ˆè´¹ç»„åœ¨åˆ†åŒºä¸­å¯¹åº”çš„æ¶ˆè´¹ä½ç§»ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶éƒ½ä¼šåœ¨ /consumers//ids å’Œ /brokers/ids è·¯å¾„ä¸Šæ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ã€‚å½“ /consumers//ids è·¯å¾„ä¸‹çš„å­èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¡¨ç¤ºæ¶ˆè´¹ç»„ä¸­çš„æ¶ˆè´¹è€…å‘ç”Ÿäº†å˜åŒ–ï¼›å½“ /brokers/ids è·¯å¾„ä¸‹çš„å­èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¡¨ç¤º broker å‡ºç°äº†å¢å‡ã€‚è¿™æ ·é€šè¿‡ ZooKeeper æ‰€æä¾›çš„ Watcherï¼Œæ¯ä¸ªæ¶ˆè´¹è€…å°±å¯ä»¥ç›‘å¬æ¶ˆè´¹ç»„å’Œ Kafka é›†ç¾¤çš„çŠ¶æ€äº†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹å¼ä¸‹æ¯ä¸ªæ¶ˆè´¹è€…å¯¹ ZooKeeper çš„ç›¸å…³è·¯å¾„åˆ†åˆ«è¿›è¡Œç›‘å¬ï¼Œå½“è§¦å‘å†å‡è¡¡æ“ä½œæ—¶ï¼Œä¸€ä¸ªæ¶ˆè´¹ç»„ä¸‹çš„æ‰€æœ‰æ¶ˆè´¹è€…ä¼šåŒæ—¶è¿›è¡Œå†å‡è¡¡æ“ä½œï¼Œè€Œæ¶ˆè´¹è€…ä¹‹é—´å¹¶ä¸çŸ¥é“å½¼æ­¤æ“ä½œçš„ç»“æœï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´ Kafka å·¥ä½œåœ¨ä¸€ä¸ªä¸æ­£ç¡®çš„çŠ¶æ€ã€‚ä¸æ­¤åŒæ—¶ï¼Œè¿™ç§ä¸¥é‡ä¾èµ–äº ZooKeeper é›†ç¾¤çš„åšæ³•è¿˜æœ‰ä¸¤ä¸ªæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ç¾Šç¾¤æ•ˆåº”ï¼ˆHerd Effectï¼‰ï¼šæ‰€è°“çš„ç¾Šç¾¤æ•ˆåº”æ˜¯æŒ‡ZooKeeper ä¸­ä¸€ä¸ªè¢«ç›‘å¬çš„èŠ‚ç‚¹å˜åŒ–ï¼Œå¤§é‡çš„ Watcher é€šçŸ¥è¢«å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œå¯¼è‡´åœ¨é€šçŸ¥æœŸé—´çš„å…¶ä»–æ“ä½œå»¶è¿Ÿï¼Œä¹Ÿæœ‰å¯èƒ½å‘ç”Ÿç±»ä¼¼æ­»é”çš„æƒ…å†µã€‚&lt;/li&gt;
&lt;li&gt;è„‘è£‚é—®é¢˜ï¼ˆSplit Brainï¼‰ï¼šæ¶ˆè´¹è€…è¿›è¡Œå†å‡è¡¡æ“ä½œæ—¶æ¯ä¸ªæ¶ˆè´¹è€…éƒ½ä¸ ZooKeeper è¿›è¡Œé€šä¿¡ä»¥åˆ¤æ–­æ¶ˆè´¹è€…æˆ–brokerå˜åŒ–çš„æƒ…å†µï¼Œç”±äº ZooKeeper æœ¬èº«çš„ç‰¹æ€§ï¼Œå¯èƒ½å¯¼è‡´åœ¨åŒä¸€æ—¶åˆ»å„ä¸ªæ¶ˆè´¹è€…è·å–çš„çŠ¶æ€ä¸ä¸€è‡´ï¼Œè¿™æ ·ä¼šå¯¼è‡´å¼‚å¸¸é—®é¢˜å‘ç”Ÿã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;æ¶ˆè´¹å†å‡è¡¡çš„åŸç†æ˜¯ä»€ä¹ˆæç¤ºæ¶ˆè´¹è€…åè°ƒå™¨å’Œæ¶ˆè´¹ç»„åè°ƒå™¨&quot;&gt;æ¶ˆè´¹å†å‡è¡¡çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆæç¤ºï¼šæ¶ˆè´¹è€…åè°ƒå™¨å’Œæ¶ˆè´¹ç»„åè°ƒå™¨ï¼‰&lt;/h3&gt;
&lt;p&gt;å°±ç›®å‰è€Œè¨€ï¼Œä¸€å…±æœ‰å¦‚ä¸‹å‡ ç§æƒ…å½¢ä¼šè§¦å‘å†å‡è¡¡çš„æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æœ‰æ–°çš„æ¶ˆè´¹è€…åŠ å…¥æ¶ˆè´¹ç»„ã€‚&lt;/li&gt;
&lt;li&gt;æœ‰æ¶ˆè´¹è€…å®•æœºä¸‹çº¿ã€‚æ¶ˆè´¹è€…å¹¶ä¸ä¸€å®šéœ€è¦çœŸæ­£ä¸‹çº¿ï¼Œä¾‹å¦‚é‡åˆ°é•¿æ—¶é—´çš„GCã€ç½‘ç»œå»¶è¿Ÿå¯¼è‡´æ¶ˆè´¹è€…é•¿æ—¶é—´æœªå‘ GroupCoordinator å‘é€å¿ƒè·³ç­‰æƒ…å†µæ—¶ï¼ŒGroupCoordinator ä¼šè®¤ä¸ºæ¶ˆè´¹è€…å·²ç»ä¸‹çº¿ã€‚&lt;/li&gt;
&lt;li&gt;æœ‰æ¶ˆè´¹è€…ä¸»åŠ¨é€€å‡ºæ¶ˆè´¹ç»„ï¼ˆå‘é€ LeaveGroupRequest è¯·æ±‚ï¼‰ã€‚æ¯”å¦‚å®¢æˆ·ç«¯è°ƒç”¨äº† unsubscrible() æ–¹æ³•å–æ¶ˆå¯¹æŸäº›ä¸»é¢˜çš„è®¢é˜…ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹ç»„æ‰€å¯¹åº”çš„ GroupCoorinator èŠ‚ç‚¹å‘ç”Ÿäº†å˜æ›´ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆè´¹ç»„å†…æ‰€è®¢é˜…çš„ä»»ä¸€ä¸»é¢˜æˆ–è€…ä¸»é¢˜çš„åˆ†åŒºæ•°é‡å‘ç”Ÿå˜åŒ–ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;GroupCoordinator æ˜¯ Kafka æœåŠ¡ç«¯ä¸­ç”¨äºç®¡ç†æ¶ˆè´¹ç»„çš„ç»„ä»¶ã€‚è€Œæ¶ˆè´¹è€…å®¢æˆ·ç«¯ä¸­çš„ ConsumerCoordinator ç»„ä»¶è´Ÿè´£ä¸ GroupCoordinator è¿›è¡Œäº¤äº’ã€‚&lt;/p&gt;
&lt;h4 id=&quot;ç¬¬ä¸€é˜¶æ®µfind_coordinator&quot;&gt;ç¬¬ä¸€é˜¶æ®µï¼ˆFIND_COORDINATORï¼‰&lt;/h4&gt;
&lt;p&gt;æ¶ˆè´¹è€…éœ€è¦ç¡®å®šå®ƒæ‰€å±çš„æ¶ˆè´¹ç»„å¯¹åº”çš„ GroupCoordinator æ‰€åœ¨çš„ brokerï¼Œå¹¶åˆ›å»ºä¸è¯¥ broker ç›¸äº’é€šä¿¡çš„ç½‘ç»œè¿æ¥ã€‚å¦‚æœæ¶ˆè´¹è€…å·²ç»ä¿å­˜äº†ä¸æ¶ˆè´¹ç»„å¯¹åº”çš„ GroupCoordinator èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå¹¶ä¸”ä¸å®ƒä¹‹é—´çš„ç½‘ç»œè¿æ¥æ˜¯æ­£å¸¸çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›å…¥ç¬¬äºŒé˜¶æ®µã€‚å¦åˆ™ï¼Œå°±éœ€è¦å‘é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹å‘é€ FindCoordinatorRequest è¯·æ±‚æ¥æŸ¥æ‰¾å¯¹åº”çš„ GroupCoordinatorï¼Œè¿™é‡Œçš„â€œæŸä¸ªèŠ‚ç‚¹â€å¹¶éæ˜¯é›†ç¾¤ä¸­çš„ä»»æ„èŠ‚ç‚¹ï¼Œè€Œæ˜¯è´Ÿè½½æœ€å°çš„èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;h4 id=&quot;ç¬¬äºŒé˜¶æ®µjoin_group&quot;&gt;ç¬¬äºŒé˜¶æ®µï¼ˆJOIN_GROUPï¼‰&lt;/h4&gt;
&lt;p&gt;åœ¨æˆåŠŸæ‰¾åˆ°æ¶ˆè´¹ç»„æ‰€å¯¹åº”çš„ GroupCoordinator ä¹‹åå°±è¿›å…¥åŠ å…¥æ¶ˆè´¹ç»„çš„é˜¶æ®µï¼Œåœ¨æ­¤é˜¶æ®µçš„æ¶ˆè´¹è€…ä¼šå‘ GroupCoordinator å‘é€ JoinGroupRequest è¯·æ±‚ï¼Œå¹¶å¤„ç†å“åº”ã€‚&lt;/p&gt;
&lt;p&gt;é€‰ä¸¾æ¶ˆè´¹ç»„çš„leader&lt;br/&gt;å¦‚æœæ¶ˆè´¹ç»„å†…è¿˜æ²¡æœ‰ leaderï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªåŠ å…¥æ¶ˆè´¹ç»„çš„æ¶ˆè´¹è€…å³ä¸ºæ¶ˆè´¹ç»„çš„ leaderã€‚å¦‚æœæŸä¸€æ—¶åˆ» leader æ¶ˆè´¹è€…ç”±äºæŸäº›åŸå› é€€å‡ºäº†æ¶ˆè´¹ç»„ï¼Œé‚£ä¹ˆä¼šé‡æ–°é€‰ä¸¾ä¸€ä¸ªæ–°çš„ leader&lt;/p&gt;
&lt;p&gt;é€‰ä¸¾åˆ†åŒºåˆ†é…ç­–ç•¥&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;æ”¶é›†å„ä¸ªæ¶ˆè´¹è€…æ”¯æŒçš„æ‰€æœ‰åˆ†é…ç­–ç•¥ï¼Œç»„æˆå€™é€‰é›† candidatesã€‚&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªæ¶ˆè´¹è€…ä»å€™é€‰é›† candidates ä¸­æ‰¾å‡ºç¬¬ä¸€ä¸ªè‡ªèº«æ”¯æŒçš„ç­–ç•¥ï¼Œä¸ºè¿™ä¸ªç­–ç•¥æŠ•ä¸Šä¸€ç¥¨ã€‚&lt;/li&gt;
&lt;li&gt;è®¡ç®—å€™é€‰é›†ä¸­å„ä¸ªç­–ç•¥çš„é€‰ç¥¨æ•°ï¼Œé€‰ç¥¨æ•°æœ€å¤šçš„ç­–ç•¥å³ä¸ºå½“å‰æ¶ˆè´¹ç»„çš„åˆ†é…ç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;h4 id=&quot;ç¬¬ä¸‰é˜¶æ®µsync_group&quot;&gt;ç¬¬ä¸‰é˜¶æ®µï¼ˆSYNC_GROUPï¼‰&lt;/h4&gt;
&lt;p&gt;leader æ¶ˆè´¹è€…æ ¹æ®åœ¨ç¬¬äºŒé˜¶æ®µä¸­é€‰ä¸¾å‡ºæ¥çš„åˆ†åŒºåˆ†é…ç­–ç•¥æ¥å®æ–½å…·ä½“çš„åˆ†åŒºåˆ†é…ï¼Œåœ¨æ­¤ä¹‹åéœ€è¦å°†åˆ†é…çš„æ–¹æ¡ˆåŒæ­¥ç»™å„ä¸ªæ¶ˆè´¹è€…ï¼Œé€šè¿‡ GroupCoordinator è¿™ä¸ªâ€œä¸­é—´äººâ€æ¥è´Ÿè´£è½¬å‘åŒæ­¥åˆ†é…æ–¹æ¡ˆçš„ã€‚&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1204119/201911/1204119-20191122000135707-293241564.png&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;ç¬¬å››é˜¶æ®µheartbeat&quot;&gt;ç¬¬å››é˜¶æ®µï¼ˆHEARTBEATï¼‰&lt;/h4&gt;
&lt;p&gt;è¿›å…¥è¿™ä¸ªé˜¶æ®µä¹‹åï¼Œæ¶ˆè´¹ç»„ä¸­çš„æ‰€æœ‰æ¶ˆè´¹è€…å°±ä¼šå¤„äºæ­£å¸¸å·¥ä½œçŠ¶æ€ã€‚åœ¨æ­£å¼æ¶ˆè´¹ä¹‹å‰ï¼Œæ¶ˆè´¹è€…è¿˜éœ€è¦ç¡®å®šæ‹‰å–æ¶ˆæ¯çš„èµ·å§‹ä½ç½®ã€‚å‡è®¾ä¹‹å‰å·²ç»å°†æœ€åçš„æ¶ˆè´¹ä½ç§»æäº¤åˆ°äº† GroupCoordinatorï¼Œå¹¶ä¸” GroupCoordinator å°†å…¶ä¿å­˜åˆ°äº† Kafka å†…éƒ¨çš„ __consumer_offsets ä¸»é¢˜ä¸­ï¼Œæ­¤æ—¶æ¶ˆè´¹è€…å¯ä»¥é€šè¿‡ OffsetFetchRequest è¯·æ±‚è·å–ä¸Šæ¬¡æäº¤çš„æ¶ˆè´¹ä½ç§»å¹¶ä»æ­¤å¤„ç»§ç»­æ¶ˆè´¹ã€‚&lt;/p&gt;
&lt;p&gt;æ¶ˆè´¹è€…é€šè¿‡å‘ GroupCoordinator å‘é€å¿ƒè·³æ¥ç»´æŒå®ƒä»¬ä¸æ¶ˆè´¹ç»„çš„ä»å±å…³ç³»ï¼Œä»¥åŠå®ƒä»¬å¯¹åˆ†åŒºçš„æ‰€æœ‰æƒå…³ç³»ã€‚åªè¦æ¶ˆè´¹è€…ä»¥æ­£å¸¸çš„æ—¶é—´é—´éš”å‘é€å¿ƒè·³ï¼Œå°±è¢«è®¤ä¸ºæ˜¯æ´»è·ƒçš„ï¼Œè¯´æ˜å®ƒè¿˜åœ¨è¯»å–åˆ†åŒºä¸­çš„æ¶ˆæ¯ã€‚å¿ƒè·³çº¿ç¨‹æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œå¯ä»¥åœ¨è½®è¯¢æ¶ˆæ¯çš„ç©ºæ¡£å‘é€å¿ƒè·³ã€‚å¦‚æœæ¶ˆè´¹è€…åœæ­¢å‘é€å¿ƒè·³çš„æ—¶é—´è¶³å¤Ÿé•¿ï¼Œåˆ™æ•´ä¸ªä¼šè¯å°±è¢«åˆ¤å®šä¸ºè¿‡æœŸï¼ŒGroupCoordinator ä¹Ÿä¼šè®¤ä¸ºè¿™ä¸ªæ¶ˆè´¹è€…å·²ç»æ­»äº¡ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡å†å‡è¡¡è¡Œä¸ºã€‚&lt;/p&gt;
&lt;h3 id=&quot;kafkaä¸­çš„å¹‚ç­‰æ˜¯æ€ä¹ˆå®ç°çš„&quot;&gt;Kafkaä¸­çš„å¹‚ç­‰æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†å®ç°ç”Ÿäº§è€…çš„å¹‚ç­‰æ€§ï¼ŒKafka ä¸ºæ­¤å¼•å…¥äº† producer idï¼ˆä»¥ä¸‹ç®€ç§° PIDï¼‰å’Œåºåˆ—å·ï¼ˆsequence numberï¼‰è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæ–°çš„ç”Ÿäº§è€…å®ä¾‹åœ¨åˆå§‹åŒ–çš„æ—¶å€™éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ª PIDï¼Œè¿™ä¸ª PID å¯¹ç”¨æˆ·è€Œè¨€æ˜¯å®Œå…¨é€æ˜çš„ã€‚å¯¹äºæ¯ä¸ª PIDï¼Œæ¶ˆæ¯å‘é€åˆ°çš„æ¯ä¸€ä¸ªåˆ†åŒºéƒ½æœ‰å¯¹åº”çš„åºåˆ—å·ï¼Œè¿™äº›åºåˆ—å·ä»0å¼€å§‹å•è°ƒé€’å¢ã€‚ç”Ÿäº§è€…æ¯å‘é€ä¸€æ¡æ¶ˆæ¯å°±ä¼šå°† &amp;lt;PIDï¼Œåˆ†åŒº&amp;gt; å¯¹åº”çš„åºåˆ—å·çš„å€¼åŠ 1ã€‚&lt;/p&gt;
&lt;p&gt;broker ç«¯ä¼šåœ¨å†…å­˜ä¸­ä¸ºæ¯ä¸€å¯¹ &amp;lt;PIDï¼Œåˆ†åŒº&amp;gt; ç»´æŠ¤ä¸€ä¸ªåºåˆ—å·ã€‚å¯¹äºæ”¶åˆ°çš„æ¯ä¸€æ¡æ¶ˆæ¯ï¼Œåªæœ‰å½“å®ƒçš„åºåˆ—å·çš„å€¼ï¼ˆSN_newï¼‰æ¯” broker ç«¯ä¸­ç»´æŠ¤çš„å¯¹åº”çš„åºåˆ—å·çš„å€¼ï¼ˆSN_oldï¼‰å¤§1ï¼ˆå³ SN_new = SN_old + 1ï¼‰æ—¶ï¼Œbroker æ‰ä¼šæ¥æ”¶å®ƒã€‚å¦‚æœ SN_new&amp;lt; SN_old + 1ï¼Œé‚£ä¹ˆè¯´æ˜æ¶ˆæ¯è¢«é‡å¤å†™å…¥ï¼Œbroker å¯ä»¥ç›´æ¥å°†å…¶ä¸¢å¼ƒã€‚å¦‚æœ SN_new&amp;gt; SN_old + 1ï¼Œé‚£ä¹ˆè¯´æ˜ä¸­é—´æœ‰æ•°æ®å°šæœªå†™å…¥ï¼Œå‡ºç°äº†ä¹±åºï¼Œæš—ç¤ºå¯èƒ½æœ‰æ¶ˆæ¯ä¸¢å¤±ï¼Œå¯¹åº”çš„ç”Ÿäº§è€…ä¼šæŠ›å‡º OutOfOrderSequenceExceptionï¼Œè¿™ä¸ªå¼‚å¸¸æ˜¯ä¸€ä¸ªä¸¥é‡çš„å¼‚å¸¸ï¼Œåç»­çš„è¯¸å¦‚ send()ã€beginTransaction()ã€commitTransaction() ç­‰æ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šæŠ›å‡º IllegalStateException çš„å¼‚å¸¸ã€‚&lt;/p&gt;
</description>
<pubDate>Thu, 21 Nov 2019 16:02:00 +0000</pubDate>
<dc:creator>luozhiyun</dc:creator>
<og:description>'æ·±å…¥ç†è§£Kafkaå¿…çŸ¥å¿…ä¼šï¼ˆ1ï¼‰' Kafkaç›®å‰æœ‰å“ªäº›å†…éƒ¨topicï¼Œå®ƒä»¬éƒ½æœ‰ä»€ä¹ˆç‰¹å¾ï¼Ÿå„è‡ªçš„ä½œç”¨åˆæ˜¯ä»€ä¹ˆï¼Ÿ __consumer_offsetsï¼šä½œç”¨æ˜¯ä¿å­˜ Kafka æ¶ˆè´¹è€…çš„ä½ç§»ä¿¡æ¯ __t</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/luozhiyun/p/11909315.html</dc:identifier>
</item>
<item>
<title>æ˜Ÿé™…äº‰éœ¸2 AIå¼€å‘(æŒç»­æ›´æ–°) - Restæ¢è·¯è€…</title>
<link>http://www.cnblogs.com/Java-Starter/p/11789858.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/Java-Starter/p/11789858.html</guid>
<description>&lt;h2 id=&quot;å‡†å¤‡&quot;&gt;å‡†å¤‡&lt;/h2&gt;
&lt;p&gt;æˆ‘çš„ç¯å¢ƒæ˜¯python3.6,sc2åŒ…0.11.1&lt;br/&gt;æœºå™¨å­¦ä¹ åŒ…ä¸‹è½½é“¾æ¥ï¼š&lt;a href=&quot;https://github.com/deepmind/pysc2&quot;&gt;pysc2&lt;/a&gt;&lt;br/&gt;åœ°å›¾ä¸‹è½½é“¾æ¥&lt;a href=&quot;https://github.com/Blizzard/s2client-proto#downloads&quot;&gt;maps&lt;/a&gt;&lt;br/&gt;pysc2æ˜¯DeepMindå¼€å‘çš„æ˜Ÿé™…äº‰éœ¸â…¡å­¦ä¹ ç¯å¢ƒã€‚ å®ƒæ˜¯å°è£…æ˜Ÿé™…äº‰éœ¸â…¡æœºå™¨å­¦ä¹ APIï¼ŒåŒæ—¶ä¹Ÿæä¾›Pythonå¢å¼ºå­¦ä¹ ç¯å¢ƒã€‚&lt;br/&gt;ä»¥ç¥æ—ä¸ºä¾‹ç¼–å†™ä»£ç ï¼Œç¥æ—å»ºç­‘ç§‘æŠ€å›¾å¦‚ä¸‹ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1201453/201911/1201453-20191111020642716-1578190460.png&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;é‡‡çŸ¿&quot;&gt;é‡‡çŸ¿&lt;/h2&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;# -*- encoding: utf-8 -*-
'''
@File    :   __init__.py.py    
@Modify Time      @Author       @Desciption
------------      -------       -----------
2019/11/3 12:32   Jonas           None
'''

import sc2
from sc2 import run_game, maps, Race, Difficulty
from sc2.player import Bot, Computer


class SentdeBot(sc2.BotAI):
    async def on_step(self, iteration: int):
        await self.distribute_workers()


run_game(maps.get(&quot;AcidPlantLE&quot;), [
    Bot(Race.Protoss, SentdeBot()), Computer(Race.Terran, Difficulty.Easy)
],realtime = True)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;&lt;br/&gt;game_data.pyçš„&lt;code&gt;assert self.id != 0&lt;/code&gt;æ³¨é‡Šæ‰&lt;br/&gt;pixel_map.pyçš„&lt;code&gt;assert self.bits_per_pixel % 8 == 0, &quot;Unsupported pixel density&quot;&lt;/code&gt;æ³¨é‡Šæ‰&lt;br/&gt;å¦åˆ™ä¼šæŠ¥é”™&lt;/p&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œå†œæ°‘å¼€å§‹é‡‡çŸ¿&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1201453/201911/1201453-20191104004907454-545075471.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥æ­£å¸¸é‡‡çŸ¿&lt;/p&gt;
&lt;h2 id=&quot;å»ºé€ å†œæ°‘å’Œæ°´æ™¶å¡”&quot;&gt;å»ºé€ å†œæ°‘å’Œæ°´æ™¶å¡”&lt;/h2&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;import sc2
from sc2 import run_game, maps, Race, Difficulty
from sc2.player import Bot, Computer
from sc2.constants import *


class SentdeBot(sc2.BotAI):
    async def on_step(self, iteration: int):
        await self.distribute_workers()
        await self.build_workers()
        await self.build_pylons()

    # å»ºé€ å†œæ°‘
    async def build_workers(self):
        # æ˜Ÿçµæ¢çº½(NEXUS)æ— é˜Ÿåˆ—å»ºé€ ï¼Œå¯ä»¥æé«˜æ™¶ä½“çŸ¿çš„åˆ©ç”¨ç‡ï¼Œä¸è‡³äºå ç”¨èµ„æº
        for nexus in self.units(UnitTypeId.NEXUS).ready.noqueue:
            # æ˜¯å¦æœ‰50æ™¶ä½“çŸ¿
            if self.can_afford(UnitTypeId.PROBE):
                await self.do(nexus.train(UnitTypeId.PROBE))

    ## å»ºé€ æ°´æ™¶
    async def build_pylons(self):
        ## ä¾›åº”äººå£å’Œç°æœ‰äººå£ä¹‹å·®å°äº5ä¸”æ°´æ™¶ä¸æ˜¯æ­£åœ¨å»ºé€ 
        if self.supply_left&amp;lt;5 and not self.already_pending(UnitTypeId.PYLON):
            nexuses = self.units(UnitTypeId.NEXUS).ready
            if nexuses.exists:
                if self.can_afford(UnitTypeId.PYLON):
                    await self.build(UnitTypeId.PYLON,near=nexuses.first)

## å¯åŠ¨æ¸¸æˆ
run_game(maps.get(&quot;AcidPlantLE&quot;), [
    Bot(Race.Protoss, SentdeBot()), Computer(Race.Terran, Difficulty.Easy)
],realtime = True)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹ï¼ŒåŸºåœ°é€ å†œæ°‘ï¼Œå†œæ°‘é€ æ°´æ™¶&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1201453/201911/1201453-20191104010608035-279973728.gif&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;æ”¶é›†æ°”ä½“å’Œå¼€çŸ¿&quot;&gt;æ”¶é›†æ°”ä½“å’Œå¼€çŸ¿&lt;/h2&gt;
&lt;p&gt;ä»£ç å¦‚ä¸‹&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;import sc2
from sc2 import run_game, maps, Race, Difficulty
from sc2.player import Bot, Computer
from sc2.constants import *


class SentdeBot(sc2.BotAI):
    async def on_step(self, iteration: int):
        await self.distribute_workers()
        await self.build_workers()
        await self.build_pylons()
        await self.build_assimilators()
        await self.expand()

    # å»ºé€ å†œæ°‘
    async def build_workers(self):
        # æ˜Ÿçµæ¢çº½(NEXUS)æ— é˜Ÿåˆ—å»ºé€ ï¼Œå¯ä»¥æé«˜æ™¶ä½“çŸ¿çš„åˆ©ç”¨ç‡ï¼Œä¸è‡³äºå ç”¨èµ„æº
        for nexus in self.units(UnitTypeId.NEXUS).ready.noqueue:
            # æ˜¯å¦æœ‰50æ™¶ä½“çŸ¿
            if self.can_afford(UnitTypeId.PROBE):
                await self.do(nexus.train(UnitTypeId.PROBE))

    ## å»ºé€ æ°´æ™¶
    async def build_pylons(self):
        ## ä¾›åº”äººå£å’Œç°æœ‰äººå£ä¹‹å·®å°äº5ä¸”å»ºç­‘ä¸æ˜¯æ­£åœ¨å»ºé€ 
        if self.supply_left &amp;lt; 5 and not self.already_pending(UnitTypeId.PYLON):
            nexuses = self.units(UnitTypeId.NEXUS).ready
            if nexuses.exists:
                if self.can_afford(UnitTypeId.PYLON):
                    await self.build(UnitTypeId.PYLON, near=nexuses.first)

    ## å»ºé€ å¸æ”¶å‚
    async def build_assimilators(self):
        for nexus in self.units(UnitTypeId.NEXUS).ready:
            # åœ¨ç“¦æ–¯æ³‰ä¸Šå»ºé€ å¸æ”¶å‚
            vaspenes = self.state.vespene_geyser.closer_than(15.0,nexus)
            for vaspene in vaspenes:
                if not self.can_afford(UnitTypeId.ASSIMILATOR):
                    break
                worker = self.select_build_worker(vaspene.position)
                if worker is None:
                    break
                if not self.units(UnitTypeId.ASSIMILATOR).closer_than(1.0,vaspene).exists:
                    await self.do(worker.build(UnitTypeId.ASSIMILATOR,vaspene))

    ## å¼€çŸ¿
    async def expand(self):
        if self.units(UnitTypeId.NEXUS).amount&amp;lt;3 and self.can_afford(UnitTypeId.NEXUS):
            await self.expand_now()

## å¯åŠ¨æ¸¸æˆ
run_game(maps.get(&quot;AcidPlantLE&quot;), [
    Bot(Race.Protoss, SentdeBot()), Computer(Race.Terran, Difficulty.Easy)
], realtime=False)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;run_gameçš„realtimeè®¾ç½®æˆFalseï¼Œå¯ä»¥åœ¨åŠ é€Ÿæ¨¡å¼ä¸‹è¿è¡Œæ¸¸æˆã€‚&lt;br/&gt;è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1201453/201911/1201453-20191111032527827-459090165.gif&quot;/&gt;&lt;br/&gt;å¯ä»¥å»ºé€ å¸æ”¶å‚å’Œå¼€çŸ¿&lt;/p&gt;
&lt;h2 id=&quot;å»ºé€ å†›é˜Ÿ&quot;&gt;å»ºé€ å†›é˜Ÿ&lt;/h2&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;import sc2
from sc2 import run_game, maps, Race, Difficulty
from sc2.player import Bot, Computer
from sc2.constants import *


class SentdeBot(sc2.BotAI):
    async def on_step(self, iteration: int):
        await self.distribute_workers()
        await self.build_workers()
        await self.build_pylons()
        await self.build_assimilators()
        await self.expand()
        await self.offensive_force_buildings()
        await self.build_offensive_force()

    # å»ºé€ å†œæ°‘
    async def build_workers(self):
        # æ˜Ÿçµæ¢çº½(NEXUS)æ— é˜Ÿåˆ—å»ºé€ ï¼Œå¯ä»¥æé«˜æ™¶ä½“çŸ¿çš„åˆ©ç”¨ç‡ï¼Œä¸è‡³äºå ç”¨èµ„æº
        for nexus in self.units(UnitTypeId.NEXUS).ready.noqueue:
            # æ˜¯å¦æœ‰50æ™¶ä½“çŸ¿
            if self.can_afford(UnitTypeId.PROBE):
                await self.do(nexus.train(UnitTypeId.PROBE))

    ## å»ºé€ æ°´æ™¶
    async def build_pylons(self):
        ## ä¾›åº”äººå£å’Œç°æœ‰äººå£ä¹‹å·®å°äº5ä¸”å»ºç­‘ä¸æ˜¯æ­£åœ¨å»ºé€ 
        if self.supply_left &amp;lt; 5 and not self.already_pending(UnitTypeId.PYLON):
            nexuses = self.units(UnitTypeId.NEXUS).ready
            if nexuses.exists:
                if self.can_afford(UnitTypeId.PYLON):
                    await self.build(UnitTypeId.PYLON, near=nexuses.first)

    ## å»ºé€ å¸æ”¶å‚
    async def build_assimilators(self):
        for nexus in self.units(UnitTypeId.NEXUS).ready:
            # åœ¨ç“¦æ–¯æ³‰ä¸Šå»ºé€ å¸æ”¶å‚
            vaspenes = self.state.vespene_geyser.closer_than(15.0,nexus)
            for vaspene in vaspenes:
                if not self.can_afford(UnitTypeId.ASSIMILATOR):
                    break
                worker = self.select_build_worker(vaspene.position)
                if worker is None:
                    break
                if not self.units(UnitTypeId.ASSIMILATOR).closer_than(1.0,vaspene).exists:
                    await self.do(worker.build(UnitTypeId.ASSIMILATOR,vaspene))

    ## å¼€çŸ¿
    async def expand(self):
        if self.units(UnitTypeId.NEXUS).amount&amp;lt;2 and self.can_afford(UnitTypeId.NEXUS):
            await self.expand_now()

    ## å»ºé€ è¿›æ”»æ€§å»ºç­‘
    async def offensive_force_buildings(self):
        if self.units(UnitTypeId.PYLON).ready.exists:
            pylon = self.units(UnitTypeId.PYLON).ready.random
            if self.units(UnitTypeId.PYLON).ready.exists:
                # æ ¹æ®ç¥æ—å»ºç­‘ç§‘æŠ€å›¾ï¼ŒæŠ˜è·ƒé—¨å»ºé€ è¿‡åæ‰å¯ä»¥å»ºé€ æ§åˆ¶æ ¸å¿ƒ
                if self.units(UnitTypeId.GATEWAY).ready.exists:
                    if not self.units(UnitTypeId.CYBERNETICSCORE):
                        if self.can_afford(UnitTypeId.CYBERNETICSCORE) and not self.already_pending(UnitTypeId.CYBERNETICSCORE):
                            await self.build(UnitTypeId.CYBERNETICSCORE,near = pylon)
                # å¦åˆ™å»ºé€ æŠ˜è·ƒé—¨
                else:
                    if self.can_afford(UnitTypeId.GATEWAY) and not self.already_pending(UnitTypeId.GATEWAY):
                        await self.build(UnitTypeId.GATEWAY,near=pylon)

    # é€ å…µ
    async def build_offensive_force(self):
        # æ— é˜Ÿåˆ—åŒ–å»ºé€ 
        for gw in self.units(UnitTypeId.GATEWAY).ready.noqueue:
            if self.can_afford(UnitTypeId.STALKER) and self.supply_left&amp;gt;0:
                await self.do(gw.train(UnitTypeId.STALKER))



## å¯åŠ¨æ¸¸æˆ
run_game(maps.get(&quot;AcidPlantLE&quot;), [
    Bot(Race.Protoss, SentdeBot()), Computer(Race.Terran, Difficulty.Easy)
], realtime=False)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1201453/201911/1201453-20191111192134346-1642738686.gif&quot;/&gt;&lt;br/&gt;å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å»ºé€ äº†æŠ˜è·ƒé—¨å’Œæ§åˆ¶æ ¸å¿ƒå¹¶è®­ç»ƒäº†è¿½çŒè€…&lt;/p&gt;
&lt;h2 id=&quot;æ§åˆ¶éƒ¨é˜Ÿè¿›æ”»&quot;&gt;æ§åˆ¶éƒ¨é˜Ÿè¿›æ”»&lt;/h2&gt;
&lt;p&gt;ä»£ç å¦‚ä¸‹&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;
import sc2
from sc2 import run_game, maps, Race, Difficulty
from sc2.player import Bot, Computer
from sc2.constants import *
import random

class SentdeBot(sc2.BotAI):
    async def on_step(self, iteration: int):
        await self.distribute_workers()
        await self.build_workers()
        await self.build_pylons()
        await self.build_assimilators()
        await self.expand()
        await self.offensive_force_buildings()
        await self.build_offensive_force()
        await self.attack()

    # å»ºé€ å†œæ°‘
    async def build_workers(self):
        # æ˜Ÿçµæ¢çº½(NEXUS)æ— é˜Ÿåˆ—å»ºé€ ï¼Œå¯ä»¥æé«˜æ™¶ä½“çŸ¿çš„åˆ©ç”¨ç‡ï¼Œä¸è‡³äºå ç”¨èµ„æº
        for nexus in self.units(UnitTypeId.NEXUS).ready.noqueue:
            # æ˜¯å¦æœ‰50æ™¶ä½“çŸ¿
            if self.can_afford(UnitTypeId.PROBE):
                await self.do(nexus.train(UnitTypeId.PROBE))

    ## å»ºé€ æ°´æ™¶
    async def build_pylons(self):
        ## ä¾›åº”äººå£å’Œç°æœ‰äººå£ä¹‹å·®å°äº5ä¸”å»ºç­‘ä¸æ˜¯æ­£åœ¨å»ºé€ 
        if self.supply_left &amp;lt; 5 and not self.already_pending(UnitTypeId.PYLON):
            nexuses = self.units(UnitTypeId.NEXUS).ready
            if nexuses.exists:
                if self.can_afford(UnitTypeId.PYLON):
                    await self.build(UnitTypeId.PYLON, near=nexuses.first)

    ## å»ºé€ å¸æ”¶å‚
    async def build_assimilators(self):
        for nexus in self.units(UnitTypeId.NEXUS).ready:
            # åœ¨ç“¦æ–¯æ³‰ä¸Šå»ºé€ å¸æ”¶å‚
            vaspenes = self.state.vespene_geyser.closer_than(15.0,nexus)
            for vaspene in vaspenes:
                if not self.can_afford(UnitTypeId.ASSIMILATOR):
                    break
                worker = self.select_build_worker(vaspene.position)
                if worker is None:
                    break
                if not self.units(UnitTypeId.ASSIMILATOR).closer_than(1.0,vaspene).exists:
                    await self.do(worker.build(UnitTypeId.ASSIMILATOR,vaspene))

    ## å¼€çŸ¿
    async def expand(self):
        if self.units(UnitTypeId.NEXUS).amount&amp;lt;3 and self.can_afford(UnitTypeId.NEXUS):
            await self.expand_now()

    ## å»ºé€ è¿›æ”»æ€§å»ºç­‘
    async def offensive_force_buildings(self):
        if self.units(UnitTypeId.PYLON).ready.exists:
            pylon = self.units(UnitTypeId.PYLON).ready.random
            # æ ¹æ®ç¥æ—å»ºç­‘ç§‘æŠ€å›¾ï¼ŒæŠ˜è·ƒé—¨å»ºé€ è¿‡åæ‰å¯ä»¥å»ºé€ æ§åˆ¶æ ¸å¿ƒ
            if self.units(UnitTypeId.GATEWAY).ready.exists and not self.units(UnitTypeId.CYBERNETICSCORE):
                if self.can_afford(UnitTypeId.CYBERNETICSCORE) and not self.already_pending(UnitTypeId.CYBERNETICSCORE):
                    await self.build(UnitTypeId.CYBERNETICSCORE,near = pylon)
            # å¦åˆ™å»ºé€ æŠ˜è·ƒé—¨
            elif len(self.units(UnitTypeId.GATEWAY))&amp;lt;=3:
                if self.can_afford(UnitTypeId.GATEWAY) and not self.already_pending(UnitTypeId.GATEWAY):
                    await self.build(UnitTypeId.GATEWAY,near=pylon)

    ## é€ å…µ
    async def build_offensive_force(self):
        # æ— é˜Ÿåˆ—åŒ–å»ºé€ 
        for gw in self.units(UnitTypeId.GATEWAY).ready.noqueue:
            if self.can_afford(UnitTypeId.STALKER) and self.supply_left&amp;gt;0:
                await self.do(gw.train(UnitTypeId.STALKER))

    ## å¯»æ‰¾ç›®æ ‡
    def find_target(self,state):
        if len(self.known_enemy_units)&amp;gt;0:
            # éšæœºé€‰å–æ•Œæ–¹å•ä½
            return random.choice(self.known_enemy_units)
        elif len(self.known_enemy_units)&amp;gt;0:
            # éšæœºé€‰å–æ•Œæ–¹å»ºç­‘
            return random.choice(self.known_enemy_structures)
        else:
            # è¿”å›æ•Œæ–¹å‡ºç”Ÿç‚¹ä½
            return self.enemy_start_locations[0]

    ## è¿›æ”»
    async def attack(self):
        # è¿½çŒè€…æ•°é‡è¶…è¿‡15ä¸ªå¼€å§‹è¿›æ”»
        if self.units(UnitTypeId.STALKER).amount&amp;gt;15:
            for s in self.units(UnitTypeId.STALKER).idle:
                await self.do(s.attack(self.find_target(self.state)))

        # é˜²å«æ¨¡å¼ï¼šè§†é‡èŒƒå›´å†…å­˜åœ¨æ•Œäººï¼Œå¼€å§‹æ”»å‡»
        if self.units(UnitTypeId.STALKER).amount&amp;gt;5:
            if len(self.known_enemy_units)&amp;gt;0:
                for s in self.units(UnitTypeId.STALKER).idle:
                    await self.do(s.attack(random.choice(self.known_enemy_units)))

## å¯åŠ¨æ¸¸æˆ
run_game(maps.get(&quot;AcidPlantLE&quot;), [
    Bot(Race.Protoss, SentdeBot()), Computer(Race.Terran, Difficulty.Medium)
], realtime=False)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1201453/201911/1201453-20191113043610981-1172163725.gif&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1201453/201911/1201453-20191113042828987-1805943221.png&quot;/&gt;&lt;br/&gt;å¯ä»¥çœ‹åˆ°ï¼Œ4ä¸ªæŠ˜è·ƒé—¨è®­ç»ƒè¿½çŒè€…å¹¶å‘åŠ¨è¿›æ”»ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‡»è´¥å›°éš¾ç”µè„‘&quot;&gt;å‡»è´¥å›°éš¾ç”µè„‘&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ç›®å‰çš„ä»£ç åªèƒ½å‡»è´¥ä¸­ç­‰å’Œç®€å•ç”µè„‘ï¼Œé‚£ä¹ˆå¦‚ä½•å‡»è´¥å›°éš¾ç”µè„‘å‘¢ï¼Ÿ&lt;br/&gt;ä»£ç å¦‚ä¸‹&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;
import sc2
from sc2 import run_game, maps, Race, Difficulty
from sc2.player import Bot, Computer
from sc2.constants import *
import random


class SentdeBot(sc2.BotAI):
    def __init__(self):
        # ç»è¿‡è®¡ç®—ï¼Œæ¯åˆ†é’Ÿå¤§çº¦165è¿­ä»£æ¬¡æ•°
        self.ITERATIONS_PER_MINUTE = 165
        # æœ€å¤§å†œæ°‘æ•°é‡
        self.MAX_WORKERS = 65

    async def on_step(self, iteration: int):
        self.iteration = iteration
        await self.distribute_workers()
        await self.build_workers()
        await self.build_pylons()
        await self.build_assimilators()
        await self.expand()
        await self.offensive_force_buildings()
        await self.build_offensive_force()
        await self.attack()

    # å»ºé€ å†œæ°‘
    async def build_workers(self):
        # æ˜Ÿçµæ¢é’®*16ï¼ˆä¸€ä¸ªåŸºåœ°é…å¤‡16ä¸ªå†œæ°‘ï¼‰å¤§äºå†œæ°‘æ•°é‡å¹¶ä¸”ç°æœ‰å†œæ°‘æ•°é‡å°äºMAX_WORKERS
        if len(self.units(UnitTypeId.NEXUS))*16&amp;gt;len(self.units(UnitTypeId.PROBE)) and len(self.units(UnitTypeId.PROBE))&amp;lt;self.MAX_WORKERS:
                # æ˜Ÿçµæ¢çº½(NEXUS)æ— é˜Ÿåˆ—å»ºé€ ï¼Œå¯ä»¥æé«˜æ™¶ä½“çŸ¿çš„åˆ©ç”¨ç‡ï¼Œä¸è‡³äºå ç”¨èµ„æº
                for nexus in self.units(UnitTypeId.NEXUS).ready.noqueue:
                    # æ˜¯å¦æœ‰50æ™¶ä½“çŸ¿å»ºé€ å†œæ°‘
                    if self.can_afford(UnitTypeId.PROBE):
                        await self.do(nexus.train(UnitTypeId.PROBE))

    ## å»ºé€ æ°´æ™¶
    async def build_pylons(self):
        ## ä¾›åº”äººå£å’Œç°æœ‰äººå£ä¹‹å·®å°äº5ä¸”å»ºç­‘ä¸æ˜¯æ­£åœ¨å»ºé€ 
        if self.supply_left &amp;lt; 5 and not self.already_pending(UnitTypeId.PYLON):
            nexuses = self.units(UnitTypeId.NEXUS).ready
            if nexuses.exists:
                if self.can_afford(UnitTypeId.PYLON):
                    await self.build(UnitTypeId.PYLON, near=nexuses.first)

    ## å»ºé€ å¸æ”¶å‚
    async def build_assimilators(self):
        for nexus in self.units(UnitTypeId.NEXUS).ready:
            # åœ¨ç“¦æ–¯æ³‰ä¸Šå»ºé€ å¸æ”¶å‚
            vaspenes = self.state.vespene_geyser.closer_than(15.0,nexus)
            for vaspene in vaspenes:
                if not self.can_afford(UnitTypeId.ASSIMILATOR):
                    break
                worker = self.select_build_worker(vaspene.position)
                if worker is None:
                    break
                if not self.units(UnitTypeId.ASSIMILATOR).closer_than(1.0,vaspene).exists:
                    await self.do(worker.build(UnitTypeId.ASSIMILATOR,vaspene))

    ## å¼€çŸ¿
    async def expand(self):
        # (self.iteration / self.ITERATIONS_PER_MINUTE)æ˜¯ä¸€ä¸ªç¼“æ…¢é€’å¢çš„å€¼,åŠ¨æ€å¼€çŸ¿
        if self.units(UnitTypeId.NEXUS).amount&amp;lt;self.iteration / self.ITERATIONS_PER_MINUTE and self.can_afford(UnitTypeId.NEXUS):
            await self.expand_now()

    ## å»ºé€ è¿›æ”»æ€§å»ºç­‘
    async def offensive_force_buildings(self):
        print(self.iteration / self.ITERATIONS_PER_MINUTE)
        if self.units(UnitTypeId.PYLON).ready.exists:
            pylon = self.units(UnitTypeId.PYLON).ready.random
            # æ ¹æ®ç¥æ—å»ºç­‘ç§‘æŠ€å›¾ï¼ŒæŠ˜è·ƒé—¨å»ºé€ è¿‡åæ‰å¯ä»¥å»ºé€ æ§åˆ¶æ ¸å¿ƒ
            if self.units(UnitTypeId.GATEWAY).ready.exists and not self.units(UnitTypeId.CYBERNETICSCORE):
                if self.can_afford(UnitTypeId.CYBERNETICSCORE) and not self.already_pending(UnitTypeId.CYBERNETICSCORE):
                    await self.build(UnitTypeId.CYBERNETICSCORE, near=pylon)
            # å¦åˆ™å»ºé€ æŠ˜è·ƒé—¨
            # (self.iteration / self.ITERATIONS_PER_MINUTE)/2 æ˜¯ä¸€ä¸ªç¼“æ…¢é€’å¢çš„å€¼
            elif len(self.units(UnitTypeId.GATEWAY)) &amp;lt; ((self.iteration / self.ITERATIONS_PER_MINUTE) / 2):
                if self.can_afford(UnitTypeId.GATEWAY) and not self.already_pending(UnitTypeId.GATEWAY):
                    await self.build(UnitTypeId.GATEWAY, near=pylon)
            # æ§åˆ¶æ ¸å¿ƒå­˜åœ¨çš„æƒ…å†µä¸‹å»ºé€ æ˜Ÿé—¨
            if self.units(UnitTypeId.CYBERNETICSCORE).ready.exists:
                if len(self.units(UnitTypeId.STARGATE)) &amp;lt; ((self.iteration / self.ITERATIONS_PER_MINUTE) / 2):
                    if self.can_afford(UnitTypeId.STARGATE) and not self.already_pending(UnitTypeId.STARGATE):
                        await self.build(UnitTypeId.STARGATE, near=pylon)

    ## é€ å…µ
    async def build_offensive_force(self):
        # æ— é˜Ÿåˆ—åŒ–å»ºé€ 
        for gw in self.units(UnitTypeId.GATEWAY).ready.noqueue:
            if not self.units(UnitTypeId.STALKER).amount &amp;gt; self.units(UnitTypeId.VOIDRAY).amount:

                if self.can_afford(UnitTypeId.STALKER) and self.supply_left &amp;gt; 0:
                    await self.do(gw.train(UnitTypeId.STALKER))

        for sg in self.units(UnitTypeId.STARGATE).ready.noqueue:
            if self.can_afford(UnitTypeId.VOIDRAY) and self.supply_left &amp;gt; 0:
                await self.do(sg.train(UnitTypeId.VOIDRAY))

    ## å¯»æ‰¾ç›®æ ‡
    def find_target(self,state):
        if len(self.known_enemy_units)&amp;gt;0:
            # éšæœºé€‰å–æ•Œæ–¹å•ä½
            return random.choice(self.known_enemy_units)
        elif len(self.known_enemy_units)&amp;gt;0:
            # éšæœºé€‰å–æ•Œæ–¹å»ºç­‘
            return random.choice(self.known_enemy_structures)
        else:
            # è¿”å›æ•Œæ–¹å‡ºç”Ÿç‚¹ä½
            return self.enemy_start_locations[0]

    ## è¿›æ”»
    async def attack(self):
        # {UNIT: [n to fight, n to defend]}
        aggressive_units = {UnitTypeId.STALKER: [15, 5],
                            UnitTypeId.VOIDRAY: [8, 3]}

        for UNIT in aggressive_units:
            # æ”»å‡»æ¨¡å¼
            if self.units(UNIT).amount &amp;gt; aggressive_units[UNIT][0] and self.units(UNIT).amount &amp;gt; aggressive_units[UNIT][
                1]:
                for s in self.units(UNIT).idle:
                    await self.do(s.attack(self.find_target(self.state)))
            # é˜²å«æ¨¡å¼
            elif self.units(UNIT).amount &amp;gt; aggressive_units[UNIT][1]:
                if len(self.known_enemy_units) &amp;gt; 0:
                    for s in self.units(UNIT).idle:
                        await self.do(s.attack(random.choice(self.known_enemy_units)))
## å¯åŠ¨æ¸¸æˆ
run_game(maps.get(&quot;AcidPlantLE&quot;), [
    Bot(Race.Protoss, SentdeBot()), Computer(Race.Terran, Difficulty.Hard)
], realtime=False)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1201453/201911/1201453-20191114022157776-1789834220.gif&quot;/&gt;&lt;br/&gt;å¯ä»¥çœ‹åˆ°ï¼Œå‡»è´¥äº†å›°éš¾äººæ—ç”µè„‘ï¼Œä½†æ˜¯ç”µè„‘é€‰æ‹©äº†rushæˆ˜æœ¯ï¼Œæˆ‘ä»¬å†™å¾—AIè„šæœ¬ä¼šè¾“æ‰æ¸¸æˆã€‚æ˜¾ç„¶ï¼Œè¿™ä¸æ˜¯æœ€ä½³æ–¹æ¡ˆã€‚&lt;br/&gt;â€œåªæœ‰AIæ‰èƒ½æ‹¯æ•‘æˆ‘çš„èƒœç‡â€ï¼Œè¯·çœ‹ä¸‹æ–‡ã€‚&lt;/p&gt;
&lt;h2 id=&quot;é‡‡é›†åœ°å›¾æ•°æ®&quot;&gt;é‡‡é›†åœ°å›¾æ•°æ®&lt;/h2&gt;
&lt;p&gt;è¿™æ¬¡æˆ‘ä»¬åªé€ ä¸€ä¸ªæŠ˜è·ƒé—¨ï¼Œå…¨åŠ›é€šè¿‡æ˜Ÿé—¨é€ è™šç©ºå…‰è¾‰èˆ°&lt;br/&gt;ä¿®æ”¹offensive_force_buildings(self)æ–¹æ³•çš„åˆ¤æ–­&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;elif len(self.units(GATEWAY)) &amp;lt; 1:
                if self.can_afford(GATEWAY) and not self.already_pending(GATEWAY):
                    await self.build(GATEWAY, near=pylon)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ³¨é‡Šæˆ–è€…åˆ é™¤build_offensive_force(self)çš„å»ºé€ è¿½çŒè€…çš„ä»£ç &lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;        ## é€ å…µ
    async def build_offensive_force(self):
        # æ— é˜Ÿåˆ—åŒ–å»ºé€ 
        # for gw in self.units(UnitTypeId.GATEWAY).ready.noqueue:
        #     if not self.units(UnitTypeId.STALKER).amount &amp;gt; self.units(UnitTypeId.VOIDRAY).amount:
        #
        #         if self.can_afford(UnitTypeId.STALKER) and self.supply_left &amp;gt; 0:
        #             await self.do(gw.train(UnitTypeId.STALKER))

        for sg in self.units(UnitTypeId.STARGATE).ready.noqueue:
            if self.can_afford(UnitTypeId.VOIDRAY) and self.supply_left &amp;gt; 0:
                await self.do(sg.train(UnitTypeId.VOIDRAY))&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;attack(self)ä¸­çš„aggressive_unitsæ³¨é‡Šæ‰Stalker&lt;br/&gt;å¯¼å…¥numpyå’Œcv2åº“&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;game_data = np.zeros((self.game_info.map_size[1], self.game_info.map_size[0], 3), np.uint8)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å»ºç«‹ä»¥åœ°å›¾Heigtä¸ºè¡Œï¼ŒWidthä¸ºåˆ—çš„ä¸‰ç»´çŸ©é˜µ&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;for nexus in self.units(NEXUS):
            nex_pos = nexus.position
            print(nex_pos)
            cv2.circle(game_data, (int(nex_pos[0]), int(nex_pos[1])), 10, (0, 255, 0), -1)  # BGR&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;éå†æ˜Ÿçµæ¢çº½ï¼Œè·å–ä¸‹ä¸€ä¸ªä½ç½®ï¼Œç”»åœ†ï¼Œcircle(æ‰¿è½½åœ†çš„img, åœ†å¿ƒ, åŠå¾„, é¢œè‰², thickness=-1è¡¨ç¤ºå¡«å……)&lt;br/&gt;æ¥ä¸‹æ¥æˆ‘ä»¬è¦å‚ç›´ç¿»è½¬ä¸‰ç»´çŸ©é˜µï¼Œå› ä¸ºæˆ‘ä»¬å»ºç«‹çš„çŸ©é˜µå·¦ä¸Šè§’æ˜¯åŸç‚¹(0,0)ï¼Œçºµåæ ‡å‘ä¸‹å»¶ç”³ï¼Œæ¨ªåæ ‡å‘å³å»¶ç”³ã€‚ç¿»è½¬ä¹‹åå°±æˆäº†æ­£å¸¸çš„åæ ‡ç³»ã€‚&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;flipped = cv2.flip(game_data, 0)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å›¾åƒç¼©æ”¾ï¼Œè¾¾åˆ°å¯è§†åŒ–æœ€ä½³ã€‚&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;        resized = cv2.resize(flipped, dsize=None, fx=2, fy=2)
        cv2.imshow('Intel', resized)
        cv2.waitKey(1)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è‡³æ­¤ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;import sc2
from sc2 import run_game, maps, Race, Difficulty
from sc2.player import Bot, Computer
from sc2.constants import *
import random
import numpy as np
import cv2


class SentdeBot(sc2.BotAI):
    def __init__(self):
        # ç»è¿‡è®¡ç®—ï¼Œæ¯åˆ†é’Ÿå¤§çº¦165è¿­ä»£æ¬¡æ•°
        self.ITERATIONS_PER_MINUTE = 165
        # æœ€å¤§å†œæ°‘æ•°é‡
        self.MAX_WORKERS = 65

    async def on_step(self, iteration: int):
        self.iteration = iteration
        await self.distribute_workers()
        await self.build_workers()
        await self.build_pylons()
        await self.build_assimilators()
        await self.expand()
        await self.offensive_force_buildings()
        await self.build_offensive_force()
        await self.intel()
        await self.attack()

    async def intel(self):
        # æ ¹æ®åœ°å›¾å»ºç«‹çš„ä¸‰ç»´çŸ©é˜µ
        game_data = np.zeros((self.game_info.map_size[1], self.game_info.map_size[0], 3), np.uint8)
        for nexus in self.units(UnitTypeId.NEXUS):
            nex_pos = nexus.position
            # circle(æ‰¿è½½åœ†çš„img, åœ†å¿ƒ, åŠå¾„, é¢œè‰², thickness=-1è¡¨ç¤ºå¡«å……)
            # è®°å½•æ˜Ÿçµæ¢çº½çš„ä½ç½®
            cv2.circle(game_data, (int(nex_pos[0]), int(nex_pos[1])), 10, (0, 255, 0), -1)
        # å›¾åƒç¿»è½¬å‚ç›´é•œåƒ
        flipped = cv2.flip(game_data, 0)
        # å›¾åƒç¼©æ”¾
        # cv2.resize(åŸå›¾åƒ,è¾“å‡ºå›¾åƒçš„å¤§å°,widthæ–¹å‘çš„ç¼©æ”¾æ¯”ä¾‹,heightæ–¹å‘ç¼©æ”¾çš„æ¯”ä¾‹)
        resized = cv2.resize(flipped, dsize=None, fx=2, fy=2)
        cv2.imshow('Intel', resized)

        # cv2.waitKey(æ¯Xmsåˆ·æ–°å›¾åƒ)
        cv2.waitKey(1)

    # å»ºé€ å†œæ°‘
    async def build_workers(self):
        # æ˜Ÿçµæ¢é’®*16ï¼ˆä¸€ä¸ªåŸºåœ°é…å¤‡16ä¸ªå†œæ°‘ï¼‰å¤§äºå†œæ°‘æ•°é‡å¹¶ä¸”ç°æœ‰å†œæ°‘æ•°é‡å°äºMAX_WORKERS
        if len(self.units(UnitTypeId.NEXUS)) * 16 &amp;gt; len(self.units(UnitTypeId.PROBE)) and len(
                self.units(UnitTypeId.PROBE)) &amp;lt; self.MAX_WORKERS:
            # æ˜Ÿçµæ¢çº½(NEXUS)æ— é˜Ÿåˆ—å»ºé€ ï¼Œå¯ä»¥æé«˜æ™¶ä½“çŸ¿çš„åˆ©ç”¨ç‡ï¼Œä¸è‡³äºå ç”¨èµ„æº
            for nexus in self.units(UnitTypeId.NEXUS).ready.noqueue:
                # æ˜¯å¦æœ‰50æ™¶ä½“çŸ¿å»ºé€ å†œæ°‘
                if self.can_afford(UnitTypeId.PROBE):
                    await self.do(nexus.train(UnitTypeId.PROBE))

    ## å»ºé€ æ°´æ™¶
    async def build_pylons(self):
        ## ä¾›åº”äººå£å’Œç°æœ‰äººå£ä¹‹å·®å°äº5ä¸”å»ºç­‘ä¸æ˜¯æ­£åœ¨å»ºé€ 
        if self.supply_left &amp;lt; 5 and not self.already_pending(UnitTypeId.PYLON):
            nexuses = self.units(UnitTypeId.NEXUS).ready
            if nexuses.exists:
                if self.can_afford(UnitTypeId.PYLON):
                    await self.build(UnitTypeId.PYLON, near=nexuses.first)

    ## å»ºé€ å¸æ”¶å‚
    async def build_assimilators(self):
        for nexus in self.units(UnitTypeId.NEXUS).ready:
            # åœ¨ç“¦æ–¯æ³‰ä¸Šå»ºé€ å¸æ”¶å‚
            vaspenes = self.state.vespene_geyser.closer_than(15.0, nexus)
            for vaspene in vaspenes:
                if not self.can_afford(UnitTypeId.ASSIMILATOR):
                    break
                worker = self.select_build_worker(vaspene.position)
                if worker is None:
                    break
                if not self.units(UnitTypeId.ASSIMILATOR).closer_than(1.0, vaspene).exists:
                    await self.do(worker.build(UnitTypeId.ASSIMILATOR, vaspene))

    ## å¼€çŸ¿
    async def expand(self):
        # (self.iteration / self.ITERATIONS_PER_MINUTE)æ˜¯ä¸€ä¸ªç¼“æ…¢é€’å¢çš„å€¼,åŠ¨æ€å¼€çŸ¿
        if self.units(UnitTypeId.NEXUS).amount &amp;lt; self.iteration / self.ITERATIONS_PER_MINUTE and self.can_afford(
                UnitTypeId.NEXUS):
            await self.expand_now()

    ## å»ºé€ è¿›æ”»æ€§å»ºç­‘
    async def offensive_force_buildings(self):
        print(self.iteration / self.ITERATIONS_PER_MINUTE)
        if self.units(UnitTypeId.PYLON).ready.exists:
            pylon = self.units(UnitTypeId.PYLON).ready.random
            # æ ¹æ®ç¥æ—å»ºç­‘ç§‘æŠ€å›¾ï¼ŒæŠ˜è·ƒé—¨å»ºé€ è¿‡åæ‰å¯ä»¥å»ºé€ æ§åˆ¶æ ¸å¿ƒ
            if self.units(UnitTypeId.GATEWAY).ready.exists and not self.units(UnitTypeId.CYBERNETICSCORE):
                if self.can_afford(UnitTypeId.CYBERNETICSCORE) and not self.already_pending(UnitTypeId.CYBERNETICSCORE):
                    await self.build(UnitTypeId.CYBERNETICSCORE, near=pylon)
            # å¦åˆ™å»ºé€ æŠ˜è·ƒé—¨
            # (self.iteration / self.ITERATIONS_PER_MINUTE)/2 æ˜¯ä¸€ä¸ªç¼“æ…¢é€’å¢çš„å€¼
            # elif len(self.units(UnitTypeId.GATEWAY)) &amp;lt; ((self.iteration / self.ITERATIONS_PER_MINUTE) / 2):
            elif len(self.units(UnitTypeId.GATEWAY)) &amp;lt; 1:
                if self.can_afford(UnitTypeId.GATEWAY) and not self.already_pending(UnitTypeId.GATEWAY):
                    await self.build(UnitTypeId.GATEWAY, near=pylon)
            # æ§åˆ¶æ ¸å¿ƒå­˜åœ¨çš„æƒ…å†µä¸‹å»ºé€ æ˜Ÿé—¨
            if self.units(UnitTypeId.CYBERNETICSCORE).ready.exists:
                if len(self.units(UnitTypeId.STARGATE)) &amp;lt; ((self.iteration / self.ITERATIONS_PER_MINUTE) / 2):
                    if self.can_afford(UnitTypeId.STARGATE) and not self.already_pending(UnitTypeId.STARGATE):
                        await self.build(UnitTypeId.STARGATE, near=pylon)

    ## é€ å…µ
    async def build_offensive_force(self):
        # æ— é˜Ÿåˆ—åŒ–å»ºé€ 
        for sg in self.units(UnitTypeId.STARGATE).ready.noqueue:
            if self.can_afford(UnitTypeId.VOIDRAY) and self.supply_left &amp;gt; 0:
                await self.do(sg.train(UnitTypeId.VOIDRAY))

    ## å¯»æ‰¾ç›®æ ‡
    def find_target(self, state):
        if len(self.known_enemy_units) &amp;gt; 0:
            # éšæœºé€‰å–æ•Œæ–¹å•ä½
            return random.choice(self.known_enemy_units)
        elif len(self.known_enemy_units) &amp;gt; 0:
            # éšæœºé€‰å–æ•Œæ–¹å»ºç­‘
            return random.choice(self.known_enemy_structures)
        else:
            # è¿”å›æ•Œæ–¹å‡ºç”Ÿç‚¹ä½
            return self.enemy_start_locations[0]

    ## è¿›æ”»
    async def attack(self):
        # {UNIT: [n to fight, n to defend]}
        aggressive_units = {UnitTypeId.VOIDRAY: [8, 3]}

        for UNIT in aggressive_units:
            # æ”»å‡»æ¨¡å¼
            if self.units(UNIT).amount &amp;gt; aggressive_units[UNIT][0] and self.units(UNIT).amount &amp;gt; aggressive_units[UNIT][1]:
                for s in self.units(UNIT).idle:
                    await self.do(s.attack(self.find_target(self.state)))
            # é˜²å«æ¨¡å¼
            elif self.units(UNIT).amount &amp;gt; aggressive_units[UNIT][1]:
                if len(self.known_enemy_units) &amp;gt; 0:
                    for s in self.units(UNIT).idle:
                        await self.do(s.attack(random.choice(self.known_enemy_units)))


## å¯åŠ¨æ¸¸æˆ
run_game(maps.get(&quot;AcidPlantLE&quot;), [
    Bot(Race.Protoss, SentdeBot()), Computer(Race.Terran, Difficulty.Hard)
], realtime=False)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1201453/201911/1201453-20191119022517282-1882042156.png&quot;/&gt;&lt;br/&gt;é‡‡é›†åˆ°äº†åœ°å›¾ä½ç½®ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä¾¦å¯Ÿ&quot;&gt;ä¾¦å¯Ÿ&lt;/h2&gt;
&lt;p&gt;åœ¨intel(self)é‡Œåˆ›å»ºä¸€ä¸ªå­—å…¸draw_dictï¼ŒUnitTypeIdä½œä¸ºkey,åŠå¾„å’Œé¢œè‰²æ˜¯value&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;
        draw_dict = {
            UnitTypeId.NEXUS: [15, (0, 255, 0)],
            UnitTypeId.PYLON: [3, (20, 235, 0)],
            UnitTypeId.PROBE: [1, (55, 200, 0)],
            UnitTypeId.ASSIMILATOR: [2, (55, 200, 0)],
            UnitTypeId.GATEWAY: [3, (200, 100, 0)],
            UnitTypeId.CYBERNETICSCORE: [3, (150, 150, 0)],
            UnitTypeId.STARGATE: [5, (255, 0, 0)],
            UnitTypeId.ROBOTICSFACILITY: [5, (215, 155, 0)],

            UnitTypeId.VOIDRAY: [3, (255, 100, 0)]
        }&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿­ä»£åŒä¸Š&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;for unit_type in draw_dict:
            for unit in self.units(unit_type).ready:
                pos = unit.position
                cv2.circle(game_data, (int(pos[0]), int(pos[1])), draw_dict[unit_type][0], draw_dict[unit_type][1], -1)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å­˜å‚¨ä¸‰æ—çš„ä¸»åŸºåœ°åç§°ï¼ˆæ˜Ÿçµæ¢çº½ï¼ŒæŒ‡æŒ¥ä¸­å¿ƒï¼Œå­µåŒ–åœºï¼‰ï¼Œåˆ»ç”»æ•Œæ–¹å»ºç­‘ã€‚&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;# ä¸»åŸºåœ°åç§°
        main_base_names = [&quot;nexus&quot;, &quot;supplydepot&quot;, &quot;hatchery&quot;]
        # è®°å½•æ•Œæ–¹åŸºåœ°ä½ç½®
        for enemy_building in self.known_enemy_structures:
            pos = enemy_building.position
            if enemy_building.name.lower() not in main_base_names:
                cv2.circle(game_data, (int(pos[0]), int(pos[1])), 5, (200, 50, 212), -1)
        for enemy_building in self.known_enemy_structures:
            pos = enemy_building.position
            if enemy_building.name.lower() in main_base_names:
                cv2.circle(game_data, (int(pos[0]), int(pos[1])), 15, (0, 0, 255), -1)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åˆ»ç”»æ•Œæ–¹å•ä½ï¼Œå¦‚æœæ˜¯å†œæ°‘ç”»å¾—å°äº›ï¼Œå…¶ä»–å•ä½åˆ™ç”»å¤§äº›ã€‚&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;        for enemy_unit in self.known_enemy_units:

            if not enemy_unit.is_structure:
                worker_names = [&quot;probe&quot;, &quot;scv&quot;, &quot;drone&quot;]
                # if that unit is a PROBE, SCV, or DRONE... it's a worker
                pos = enemy_unit.position
                if enemy_unit.name.lower() in worker_names:
                    cv2.circle(game_data, (int(pos[0]), int(pos[1])), 1, (55, 0, 155), -1)
                else:
                    cv2.circle(game_data, (int(pos[0]), int(pos[1])), 3, (50, 0, 215), -1)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨offensive_force_buildings(self)æ–¹æ³•ä¸­æ·»åŠ å»ºé€ æœºæ¢°å°&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;            if self.units(CYBERNETICSCORE).ready.exists:
                if len(self.units(ROBOTICSFACILITY)) &amp;lt; 1:
                    if self.can_afford(ROBOTICSFACILITY) and not self.already_pending(ROBOTICSFACILITY):
                        await self.build(ROBOTICSFACILITY, near=pylon)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åˆ›å»ºscout()ï¼Œè®­ç»ƒObserver&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;async def scout(self):
        if len(self.units(OBSERVER)) &amp;gt; 0:
            scout = self.units(OBSERVER)[0]
            if scout.is_idle:
                enemy_location = self.enemy_start_locations[0]
                move_to = self.random_location_variance(enemy_location)
                print(move_to)
                await self.do(scout.move(move_to))

        else:
            for rf in self.units(ROBOTICSFACILITY).ready.noqueue:
                if self.can_afford(OBSERVER) and self.supply_left &amp;gt; 0:
                    await self.do(rf.train(OBSERVER))&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç”Ÿæˆéšæœºä½ç½®ï¼Œå¾ˆç®€å•ã€‚æ„æ€æ˜¯æ¨ªåæ ‡ç´¯è®¡é€’å¢-0.2å’Œ0.2å€çš„æ¨ªåæ ‡ï¼Œé™åˆ¶æ¡ä»¶ä¸ºå¦‚æœxè¶…è¿‡æ¨ªåæ ‡ï¼Œé‚£ä¹ˆå°±æ˜¯æ¨ªåæ ‡æœ€å¤§å€¼ã€‚&lt;br/&gt;çºµåæ ‡åŒç†ã€‚&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;    def random_location_variance(self, enemy_start_location):
        x = enemy_start_location[0]
        y = enemy_start_location[1]

        x += ((random.randrange(-20, 20))/100) * enemy_start_location[0]
        y += ((random.randrange(-20, 20))/100) * enemy_start_location[1]

        if x &amp;lt; 0:
            x = 0
        if y &amp;lt; 0:
            y = 0
        if x &amp;gt; self.game_info.map_size[0]:
            x = self.game_info.map_size[0]
        if y &amp;gt; self.game_info.map_size[1]:
            y = self.game_info.map_size[1]

        go_to = position.Point2(position.Pointlike((x,y)))
        return go_to&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å®Œæ•´ä»£ç å¦‚ä¸‹&lt;/p&gt;
&lt;pre class=&quot;python&quot;&gt;
&lt;code&gt;# -*- encoding: utf-8 -*-
'''
@File    :   demo.py
@Modify Time      @Author       @Desciption
------------      -------       -----------
2019/11/3 12:32   Jonas           None
'''

import sc2
from sc2 import run_game, maps, Race, Difficulty, position
from sc2.player import Bot, Computer
from sc2.constants import *
import random
import numpy as np
import cv2


class SentdeBot(sc2.BotAI):
    def __init__(self):
        # ç»è¿‡è®¡ç®—ï¼Œæ¯åˆ†é’Ÿå¤§çº¦165è¿­ä»£æ¬¡æ•°
        self.ITERATIONS_PER_MINUTE = 165
        # æœ€å¤§å†œæ°‘æ•°é‡
        self.MAX_WORKERS = 50

    async def on_step(self, iteration: int):
        self.iteration = iteration
        await self.scout()
        await self.distribute_workers()
        await self.build_workers()
        await self.build_pylons()
        await self.build_assimilators()
        await self.expand()
        await self.offensive_force_buildings()
        await self.build_offensive_force()
        await self.intel()
        await self.attack()

    ## ä¾¦å¯Ÿ
    async def scout(self):
        if len(self.units(UnitTypeId.OBSERVER)) &amp;gt; 0:
            scout = self.units(UnitTypeId.OBSERVER)[0]
            if scout.is_idle:
                enemy_location = self.enemy_start_locations[0]
                move_to = self.random_location_variance(enemy_location)
                print(move_to)
                await self.do(scout.move(move_to))

        else:
            for rf in self.units(UnitTypeId.ROBOTICSFACILITY).ready.noqueue:
                if self.can_afford(UnitTypeId.OBSERVER) and self.supply_left &amp;gt; 0:
                    await self.do(rf.train(UnitTypeId.OBSERVER))

    async def intel(self):
        game_data = np.zeros((self.game_info.map_size[1], self.game_info.map_size[0], 3), np.uint8)

        # UnitTypeIdä½œä¸ºkey,åŠå¾„å’Œé¢œè‰²æ˜¯value
        draw_dict = {
            UnitTypeId.NEXUS: [15, (0, 255, 0)],
            UnitTypeId.PYLON: [3, (20, 235, 0)],
            UnitTypeId.PROBE: [1, (55, 200, 0)],
            UnitTypeId.ASSIMILATOR: [2, (55, 200, 0)],
            UnitTypeId.GATEWAY: [3, (200, 100, 0)],
            UnitTypeId.CYBERNETICSCORE: [3, (150, 150, 0)],
            UnitTypeId.STARGATE: [5, (255, 0, 0)],
            UnitTypeId.ROBOTICSFACILITY: [5, (215, 155, 0)],

            UnitTypeId.VOIDRAY: [3, (255, 100, 0)],
            # OBSERVER: [3, (255, 255, 255)],
        }

        for unit_type in draw_dict:
            for unit in self.units(unit_type).ready:
                pos = unit.position
                cv2.circle(game_data, (int(pos[0]), int(pos[1])), draw_dict[unit_type][0], draw_dict[unit_type][1], -1)

        # ä¸»åŸºåœ°åç§°
        main_base_names = [&quot;nexus&quot;, &quot;supplydepot&quot;, &quot;hatchery&quot;]
        # è®°å½•æ•Œæ–¹åŸºåœ°ä½ç½®
        for enemy_building in self.known_enemy_structures:
            pos = enemy_building.position
            # ä¸æ˜¯ä¸»åŸºåœ°å»ºç­‘ï¼Œç”»å°ä¸€äº›
            if enemy_building.name.lower() not in main_base_names:
                cv2.circle(game_data, (int(pos[0]), int(pos[1])), 5, (200, 50, 212), -1)
        for enemy_building in self.known_enemy_structures:
            pos = enemy_building.position
            if enemy_building.name.lower() in main_base_names:
                cv2.circle(game_data, (int(pos[0]), int(pos[1])), 15, (0, 0, 255), -1)

        for enemy_unit in self.known_enemy_units:

            if not enemy_unit.is_structure:
                worker_names = [&quot;probe&quot;, &quot;scv&quot;, &quot;drone&quot;]
                # if that unit is a PROBE, SCV, or DRONE... it's a worker
                pos = enemy_unit.position
                if enemy_unit.name.lower() in worker_names:
                    cv2.circle(game_data, (int(pos[0]), int(pos[1])), 1, (55, 0, 155), -1)
                else:
                    cv2.circle(game_data, (int(pos[0]), int(pos[1])), 3, (50, 0, 215), -1)

        for obs in self.units(UnitTypeId.OBSERVER).ready:
            pos = obs.position
            cv2.circle(game_data, (int(pos[0]), int(pos[1])), 1, (255, 255, 255), -1)

        # flip horizontally to make our final fix in visual representation:
        flipped = cv2.flip(game_data, 0)
        resized = cv2.resize(flipped, dsize=None, fx=2, fy=2)

        cv2.imshow('Intel', resized)
        cv2.waitKey(1)

    def random_location_variance(self, enemy_start_location):
        x = enemy_start_location[0]
        y = enemy_start_location[1]

        x += ((random.randrange(-20, 20)) / 100) * enemy_start_location[0]
        y += ((random.randrange(-20, 20)) / 100) * enemy_start_location[1]

        if x &amp;lt; 0:
            x = 0
        if y &amp;lt; 0:
            y = 0
        if x &amp;gt; self.game_info.map_size[0]:
            x = self.game_info.map_size[0]
        if y &amp;gt; self.game_info.map_size[1]:
            y = self.game_info.map_size[1]

        go_to = position.Point2(position.Pointlike((x, y)))
        return go_to

    # å»ºé€ å†œæ°‘
    async def build_workers(self):
        # æ˜Ÿçµæ¢é’®*16ï¼ˆä¸€ä¸ªåŸºåœ°é…å¤‡16ä¸ªå†œæ°‘ï¼‰å¤§äºå†œæ°‘æ•°é‡å¹¶ä¸”ç°æœ‰å†œæ°‘æ•°é‡å°äºMAX_WORKERS
        if len(self.units(UnitTypeId.NEXUS)) * 16 &amp;gt; len(self.units(UnitTypeId.PROBE)) and len(
                self.units(UnitTypeId.PROBE)) &amp;lt; self.MAX_WORKERS:
            # æ˜Ÿçµæ¢çº½(NEXUS)æ— é˜Ÿåˆ—å»ºé€ ï¼Œå¯ä»¥æé«˜æ™¶ä½“çŸ¿çš„åˆ©ç”¨ç‡ï¼Œä¸è‡³äºå ç”¨èµ„æº
            for nexus in self.units(UnitTypeId.NEXUS).ready.noqueue:
                # æ˜¯å¦æœ‰50æ™¶ä½“çŸ¿å»ºé€ å†œæ°‘
                if self.can_afford(UnitTypeId.PROBE):
                    await self.do(nexus.train(UnitTypeId.PROBE))

    ## å»ºé€ æ°´æ™¶
    async def build_pylons(self):
        ## ä¾›åº”äººå£å’Œç°æœ‰äººå£ä¹‹å·®å°äº5ä¸”å»ºç­‘ä¸æ˜¯æ­£åœ¨å»ºé€ 
        if self.supply_left &amp;lt; 5 and not self.already_pending(UnitTypeId.PYLON):
            nexuses = self.units(UnitTypeId.NEXUS).ready
            if nexuses.exists:
                if self.can_afford(UnitTypeId.PYLON):
                    await self.build(UnitTypeId.PYLON, near=nexuses.first)

    ## å»ºé€ å¸æ”¶å‚
    async def build_assimilators(self):
        for nexus in self.units(UnitTypeId.NEXUS).ready:
            # åœ¨ç“¦æ–¯æ³‰ä¸Šå»ºé€ å¸æ”¶å‚
            vaspenes = self.state.vespene_geyser.closer_than(15.0, nexus)
            for vaspene in vaspenes:
                if not self.can_afford(UnitTypeId.ASSIMILATOR):
                    break
                worker = self.select_build_worker(vaspene.position)
                if worker is None:
                    break
                if not self.units(UnitTypeId.ASSIMILATOR).closer_than(1.0, vaspene).exists:
                    await self.do(worker.build(UnitTypeId.ASSIMILATOR, vaspene))

    ## å¼€çŸ¿
    async def expand(self):
        # (self.iteration / self.ITERATIONS_PER_MINUTE)æ˜¯ä¸€ä¸ªç¼“æ…¢é€’å¢çš„å€¼,åŠ¨æ€å¼€çŸ¿
        if self.units(UnitTypeId.NEXUS).amount &amp;lt; self.iteration / self.ITERATIONS_PER_MINUTE and self.can_afford(
                UnitTypeId.NEXUS):
            await self.expand_now()

    ## å»ºé€ è¿›æ”»æ€§å»ºç­‘
    async def offensive_force_buildings(self):
        print(self.iteration / self.ITERATIONS_PER_MINUTE)
        if self.units(UnitTypeId.PYLON).ready.exists:
            pylon = self.units(UnitTypeId.PYLON).ready.random
            # æ ¹æ®ç¥æ—å»ºç­‘ç§‘æŠ€å›¾ï¼ŒæŠ˜è·ƒé—¨å»ºé€ è¿‡åæ‰å¯ä»¥å»ºé€ æ§åˆ¶æ ¸å¿ƒ
            if self.units(UnitTypeId.GATEWAY).ready.exists and not self.units(UnitTypeId.CYBERNETICSCORE):
                if self.can_afford(UnitTypeId.CYBERNETICSCORE) and not self.already_pending(UnitTypeId.CYBERNETICSCORE):
                    await self.build(UnitTypeId.CYBERNETICSCORE, near=pylon)
            # å¦åˆ™å»ºé€ æŠ˜è·ƒé—¨
            # (self.iteration / self.ITERATIONS_PER_MINUTE)/2 æ˜¯ä¸€ä¸ªç¼“æ…¢é€’å¢çš„å€¼
            # elif len(self.units(UnitTypeId.GATEWAY)) &amp;lt; ((self.iteration / self.ITERATIONS_PER_MINUTE) / 2):
            elif len(self.units(UnitTypeId.GATEWAY)) &amp;lt; 1:
                if self.can_afford(UnitTypeId.GATEWAY) and not self.already_pending(UnitTypeId.GATEWAY):
                    await self.build(UnitTypeId.GATEWAY, near=pylon)
            # æ§åˆ¶æ ¸å¿ƒå­˜åœ¨çš„æƒ…å†µä¸‹å»ºé€ æœºæ¢°å°
            if self.units(UnitTypeId.CYBERNETICSCORE).ready.exists:
                if len(self.units(UnitTypeId.ROBOTICSFACILITY)) &amp;lt; 1:
                    if self.can_afford(UnitTypeId.ROBOTICSFACILITY) and not self.already_pending(
                            UnitTypeId.ROBOTICSFACILITY):
                        await self.build(UnitTypeId.ROBOTICSFACILITY, near=pylon)

            # æ§åˆ¶æ ¸å¿ƒå­˜åœ¨çš„æƒ…å†µä¸‹å»ºé€ æ˜Ÿé—¨
            if self.units(UnitTypeId.CYBERNETICSCORE).ready.exists:
                if len(self.units(UnitTypeId.STARGATE)) &amp;lt; ((self.iteration / self.ITERATIONS_PER_MINUTE) / 2):
                    if self.can_afford(UnitTypeId.STARGATE) and not self.already_pending(UnitTypeId.STARGATE):
                        await self.build(UnitTypeId.STARGATE, near=pylon)

    ## é€ å…µ
    async def build_offensive_force(self):
        # æ— é˜Ÿåˆ—åŒ–å»ºé€ 
        # for gw in self.units(UnitTypeId.GATEWAY).ready.noqueue:
        #     if not self.units(UnitTypeId.STALKER).amount &amp;gt; self.units(UnitTypeId.VOIDRAY).amount:
        #
        #         if self.can_afford(UnitTypeId.STALKER) and self.supply_left &amp;gt; 0:
        #             await self.do(gw.train(UnitTypeId.STALKER))

        for sg in self.units(UnitTypeId.STARGATE).ready.noqueue:
            if self.can_afford(UnitTypeId.VOIDRAY) and self.supply_left &amp;gt; 0:
                await self.do(sg.train(UnitTypeId.VOIDRAY))

    ## å¯»æ‰¾ç›®æ ‡
    def find_target(self, state):
        if len(self.known_enemy_units) &amp;gt; 0:
            # éšæœºé€‰å–æ•Œæ–¹å•ä½
            return random.choice(self.known_enemy_units)
        elif len(self.known_enemy_units) &amp;gt; 0:
            # éšæœºé€‰å–æ•Œæ–¹å»ºç­‘
            return random.choice(self.known_enemy_structures)
        else:
            # è¿”å›æ•Œæ–¹å‡ºç”Ÿç‚¹ä½
            return self.enemy_start_locations[0]

    ## è¿›æ”»
    async def attack(self):
        # {UNIT: [n to fight, n to defend]}
        aggressive_units = {UnitTypeId.VOIDRAY: [8, 3]}

        for UNIT in aggressive_units:
            # æ”»å‡»æ¨¡å¼
            if self.units(UNIT).amount &amp;gt; aggressive_units[UNIT][0] and self.units(UNIT).amount &amp;gt; aggressive_units[UNIT][
                1]:
                for s in self.units(UNIT).idle:
                    await self.do(s.attack(self.find_target(self.state)))
            # é˜²å«æ¨¡å¼
            elif self.units(UNIT).amount &amp;gt; aggressive_units[UNIT][1]:
                if len(self.known_enemy_units) &amp;gt; 0:
                    for s in self.units(UNIT).idle:
                        await self.do(s.attack(random.choice(self.known_enemy_units)))


## å¯åŠ¨æ¸¸æˆ
run_game(maps.get(&quot;AcidPlantLE&quot;), [
    Bot(Race.Protoss, SentdeBot()), Computer(Race.Terran, Difficulty.Hard)
], realtime=False)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œçº¢è‰²å’Œç²‰çº¢è‰²æ˜¯æ•Œæ–¹å•ä½ã€‚&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1201453/201911/1201453-20191121232636261-511874399.gif&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Thu, 21 Nov 2019 15:28:00 +0000</pubDate>
<dc:creator>Restæ¢è·¯è€…</dc:creator>
<og:description>å‡†å¤‡ æˆ‘çš„ç¯å¢ƒæ˜¯python3.6,sc2åŒ…0.11.1 æœºå™¨å­¦ä¹ åŒ…ä¸‹è½½é“¾æ¥ï¼š 'pysc2' åœ°å›¾ä¸‹è½½é“¾æ¥ 'maps' pysc2æ˜¯DeepMindå¼€å‘çš„æ˜Ÿé™…äº‰éœ¸â…¡å­¦ä¹ ç¯å¢ƒã€‚ å®ƒæ˜¯å°è£…æ˜Ÿé™…äº‰éœ¸â…¡æœº</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/Java-Starter/p/11789858.html</dc:identifier>
</item>
</channel>
</rss>