<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>博客园_首页</title>
<link></link>
<description>代码改变世界</description>
<item>
<title>数据分析 第十篇：分类（kNN） - 悦光阴</title>
<link>http://www.cnblogs.com/ljhdo/p/4531164.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/ljhdo/p/4531164.html</guid>
<description>&lt;p&gt;K最近邻(kNN，k-NearestNeighbor)算法是一种监督式的分类方法，但是，它并不存在单独的训练过程，在分类方法中属于惰性学习法，也就是说，当给定一个训练数据集时，惰性学习法简单地存储或稍加处理，并一直等待，直到给定一个检验数据集时，才开始构造模型，以便根据已存储的训练数据集的相似性对检验数据集进行分类。惰性学习法在提供训练数据集时，只做少量的计算，而在进行分类或数值预测时做更多的计算。kNN算法主要用于模式识别，对于随机分布的数据集分类效果较差，对于类内间距小，类间间距大的数据集分类效果好，而且对于边界不规则的数据效果好于线性分类器。常用于推荐系统：推荐受众喜欢电影、美食和娱乐等。&lt;/p&gt;
&lt;h2&gt;一，kNN算法逻辑&lt;/h2&gt;
&lt;p&gt;kNN算法的核心思想是：如果一个数据在特征空间中最相邻的k个数据中的大多数属于某一个类别，则该样本也属于这个类别（类似投票），并具有这个类别上样本的特性。通俗地说，对于给定的测试样本和基于某种度量距离的方式，通过最靠近的k个训练样本来预测当前样本的分类结果。&lt;/p&gt;
&lt;p&gt;例如，借用百度的一张图来说明kNN算法过程，要预测图中Xu的分类结果，先预设一个距离值，只考虑以Xu为圆心以这个距离值为半径的圆内的已知训练样本，然后根据这些样本的投票结果来预测Xu属于w1类别，投票结果是4：1。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/628084/201812/628084-20181228104419753-18337878.png&quot; alt=&quot;&quot; width=&quot;374&quot; height=&quot;325&quot;/&gt;&lt;/p&gt;
&lt;p&gt;kNN算法在确定分类决策上只依据最邻近的一个或者几个样本的类别来决定待分样本所属的类别。&lt;br/&gt;kNN算法在类别决策时，只与极少量的相邻样本有关。&lt;br/&gt;由于kNN算法主要靠周围有限的邻近的样本，而不是靠判别类域的方法来确定所属类别的，因此对于类域的交叉或重叠较多的待分样本集来说，kNN方法较其他方法更为适合。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1，kNN算法的计算步骤&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;kNN算法就是根据距离待分类样本A最近的k个样本数据的分类来预测A可能属于的类别，基本的计算步骤如下：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;对数据进行标准化，通常是进行归一化，避免量纲对计算距离的影响；&lt;/li&gt;
&lt;li&gt;计算待分类数据与训练集中每一个样本之间的距离；&lt;/li&gt;
&lt;li&gt;找出与待分类样本距离最近的k个样本；&lt;/li&gt;
&lt;li&gt;观测这k个样本的分类情况；&lt;/li&gt;
&lt;li&gt;把出现次数最多的类别作为待分类数据的类别。&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;计算距离的方法有：&quot;euclidean&quot;（欧氏距离）,”minkowski”（明科夫斯基距离）, &quot;maximum&quot;（切比雪夫距离）, &quot;manhattan&quot;（绝对值距离）,&quot;canberra&quot;（兰式距离）, 或 &quot;minkowski&quot;（马氏距离）等。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2，kNN算法如何计算距离？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;在计算距离之前，需要对每个数值属性进行规范化&lt;/strong&gt;，这有助于避免较大初始值域的属性比具有较小初始值域的属性的权重过大。&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;对于数值属性，kNN算法使用距离公式来计算任意两个样本数据之间的距离。&lt;/li&gt;
&lt;li&gt;对于标称属性（如类别），kNN算法使用比较法，当两个样本数据相等时，距离为0；当两个样本数据不等时，距离是1。&lt;/li&gt;
&lt;li&gt;对于缺失值，通常取最大的差值，假设每个属性都已经映射到[0,1]区间，对于标称属性，设置差值为1；对于数值属性，如果两个元组都缺失值，那么设置差值为1；如果只有一个值缺失，另一个规范化的值是v，则取差值为 1-v 和 v 的较大者。&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;3，kNN算法如何确定k的值？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;k的最优值，需要通过实验来确定。从k=1开始，使用检验数据集来估计分类器的错误率。重复该过程，每次k增加1，允许增加一个近邻，选取产生最小错误率的k。一般而言，训练数据集越多，k的值越大，使得分类预测可以基于训练数据集的较大比例。在应用中，一般选择较小k并且k是奇数。通常采用交叉验证的方法来选取合适的k值。&lt;/p&gt;
&lt;p&gt;R的kknn包中包含两个自动选择最优参数的函数：train.kknn和cv.kknn，前者采用留一交叉验证做参数选择，后者采用交叉验证做参数选择（可以自己选择折数）：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;47&quot;&gt;
&lt;pre&gt;
train.kknn(formula, data, kmax = &lt;span&gt;11&lt;/span&gt;, ks = NULL, distance = &lt;span&gt;2&lt;/span&gt;, kernel = &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;optimal&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
    ykernel &lt;/span&gt;= NULL, scale = TRUE, contrasts = c(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;unordered&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; = &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;contr.dummy&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
    ordered &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;contr.ordinal&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;), ...)
cv.kknn(formula, data, kcv &lt;/span&gt;= &lt;span&gt;10&lt;/span&gt;, ...)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;参数注释：&lt;/p&gt;
&lt;p&gt;kmax：最大的k值&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ks：向量，用于指定k值，如果非null，那么ks覆盖kmax的值。&lt;/li&gt;
&lt;li&gt;distince：Minkowski距离的参数&lt;/li&gt;
&lt;li&gt;kernel：有效值是：&quot;rectangular&quot; (which is standard unweighted knn), &quot;triangular&quot;, &quot;epanechnikov&quot; (or beta(2,2)), &quot;biweight&quot; (or beta(3,3)), &quot;triweight&quot; (or beta(4,4)), &quot;cos&quot;, &quot;inv&quot;, &quot;gaussian&quot; and &quot;optimal&quot;.&lt;/li&gt;
&lt;li&gt;kcv：k-fold交叉验证的分区数量&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;函数的返回值：&lt;/p&gt;
&lt;p&gt;best.parameters：列出最佳的k和kernel&lt;/p&gt;
&lt;p&gt;fitted.values：内核和k的所有组合的预测列表。&lt;/p&gt;
&lt;p&gt;MISCLASS：分类错误的矩阵，用于查看错误率&lt;/p&gt;
&lt;h2&gt;二，kNN算法的R实现&lt;/h2&gt;
&lt;div readability=&quot;23&quot;&gt;
&lt;p&gt;R语言实现kNN算法的函数包主要有：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;class函数包中的knn、knn.cv函数；&lt;/li&gt;
&lt;li&gt;caret函数包中的knn3函数；&lt;/li&gt;
&lt;li&gt;kknn函数包中的kknn函数；&lt;/li&gt;
&lt;/ul&gt;
class包是比较基础的，kknn是优化之后的算法。&lt;br/&gt;例如，使用kknn包执行kNN算法，对检验数据集进行分类：&lt;br/&gt;&lt;div class=&quot;cnblogs_code&quot; readability=&quot;54&quot;&gt;
&lt;pre&gt;
mydata &amp;lt;- read.csv(file=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;C:/BlackFriday.csv&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,header=TRUE,stringsAsFactors =&lt;span&gt; TRUE)
dt &lt;/span&gt;&amp;lt;- mydata[,c(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Gender&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Age&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Occupation&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;City_Category&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Stay_In_Current_City_Years&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Marital_Status&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Product_Category&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)]

dt$Occupation &lt;/span&gt;&amp;lt;- factor(&lt;span&gt;as&lt;/span&gt;&lt;span&gt;.character(dt$Occupation))
dt$Product_Category&lt;/span&gt;=factor(&lt;span&gt;as&lt;/span&gt;&lt;span&gt;.character(dt$Product_Category))

mydt &lt;/span&gt;&amp;lt;- dt[&lt;span&gt;1&lt;/span&gt;:&lt;span&gt;10000&lt;/span&gt;&lt;span&gt;,]

library(kknn)

m &lt;/span&gt;&amp;lt;- dim(mydt)[&lt;span&gt;1&lt;/span&gt;&lt;span&gt;]
val &lt;/span&gt;&amp;lt;- sample(&lt;span&gt;1&lt;/span&gt;:m,round(m/&lt;span&gt;10&lt;/span&gt;),replace =&lt;span&gt; TRUE)

dt.learn &lt;/span&gt;&amp;lt;- mydt[-&lt;span&gt;val,]
dt.test &lt;/span&gt;&amp;lt;-&lt;span&gt; mydt[val,]

myk &lt;/span&gt;&amp;lt;- train.kknn(Product_Category~&lt;span&gt;.,dt.learn)
k &lt;/span&gt;&amp;lt;-&lt;span&gt; myk$best.parameters # get best parameters of kNN

myknn &lt;/span&gt;&amp;lt;- kknn(Product_Category ~.,dt.learn,dt.test,k=&lt;span&gt;11&lt;/span&gt;&lt;span&gt;)

summary(myknn)

fit &lt;/span&gt;&amp;lt;-&lt;span&gt; fitted(myknn)
table(fit,dt.test$Product_Category)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;




&lt;p&gt;参考文档：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://www.cnblogs.com/YukBrandes/p/5539723.html&quot; target=&quot;_blank&quot;&gt;KNN算法的R语言实现&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Tue, 01 Jan 2019 23:36:00 +0000</pubDate>
<dc:creator>悦光阴</dc:creator>
<og:description>K最近邻(kNN，k-NearestNeighbor)算法是一种监督式的分类方法，但是，它并不存在单独的训练过程，在分类方法中属于惰性学习法，也就是说，当给定一个训练数据集时，惰性学习法简单地存储或稍</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/ljhdo/p/4531164.html</dc:identifier>
</item>
<item>
<title>【Ray Tracing in One Weekend 超详解】 光线追踪1-6 - 林-兮</title>
<link>http://www.cnblogs.com/lv-anchoret/p/10206773.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/lv-anchoret/p/10206773.html</guid>
<description>
&lt;p&gt;&lt;span&gt;新的一年，前来打卡&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;Preface&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;回顾上一篇，我们讲述了漫反射材质，也就是平时的磨砂表面。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;它一种将入射光经表面随机散射形成的材质，是一种非常普遍的表面形式。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;这一篇，我们将来学习镜面反射，或者说是金属材质&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;镜面在生活中见得也很多，它是一种将入射光经表面按照物理反射规律形成的材质。&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;先看效果 &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1316111/201901/1316111-20190102013215997-547850640.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;Ready&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;之前我们就写好的&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;ray.h&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;intersect.h&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;intersection.h&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;sphere.h&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;camera.h&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt; &lt;strong&gt;&lt;span&gt;Chapter8: Metal&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;之前我们已经写过一个漫反射的材质，可以发现，材质其实就解决两个问题：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;1.如何创造反射光或者散射光（吸收转化入射光）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2.如何确定光线强度的衰减量&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;我们采用类比法：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;上一篇中&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;diffuse表面：1.视线与物体表面产生撞击点p，在p处相切单位圆内随机找一点s，散射光方向即p-&amp;gt;s&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　　　　　 2.我们上一篇采用的光线强度衰减机制是取半。&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;这一篇中我们将&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;metal表面： 1.根据物理反射定律确定入射光对应的反射光的方向&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　　　　　2.强度衰减改为三元组，分别对应rgb三分量的衰减度，且用参数自由确定&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;那么首先，它们有共同点，我们有必要将其抽象一下&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;45&quot;&gt;
&lt;pre&gt;
&lt;span&gt;///&lt;/span&gt;&lt;span&gt; material.h&lt;/span&gt;

&lt;span&gt;//&lt;/span&gt;&lt;span&gt; -----------------------------------------------------
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [author]        lv
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [begin ]        2018.1.1
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [brief ]        the material-class for the ray-tracing project
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;                from the 《ray tracing in one week》
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; -----------------------------------------------------&lt;/span&gt;
&lt;span&gt;
#ifndef MATERIAL_H
&lt;/span&gt;&lt;span&gt;#define&lt;/span&gt; MATERIAL_H

&lt;span&gt;namespace&lt;/span&gt;&lt;span&gt; rt
{

&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;abstract basic class&lt;/span&gt;
&lt;span&gt;class&lt;/span&gt;&lt;span&gt; material
    {
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt;:

    &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;
    @brief: produce a scattered ray
    @param: InRay -&amp;gt; Incident light
            info -&amp;gt; the information of intersect-point(hit-point)
            attenuation -&amp;gt; when scattered, how much the ray should be attenuated by tis reflectance R
            scattered -&amp;gt; as we talk, it is a new sight; or
                         it is the scattered ray with the intersect-point
    @retur: the function calculate a scattered ray or not
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
    &lt;span&gt;virtual&lt;/span&gt; &lt;span&gt;bool&lt;/span&gt; scatter(&lt;span&gt;const&lt;/span&gt; ray&amp;amp; InRay, &lt;span&gt;const&lt;/span&gt; hitInfo&amp;amp; info, rtvec&amp;amp; attenuation, ray&amp;amp; scattered)&lt;span&gt;const&lt;/span&gt; = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;

&lt;/span&gt;&lt;span&gt;protected&lt;/span&gt;&lt;span&gt;:

    &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;
    @brief: find a random point in unit_sphere
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
    &lt;span&gt;const&lt;/span&gt; rtvec random_unit_sphere()&lt;span&gt;const&lt;/span&gt;&lt;span&gt;
        {
        rtvec p;
        &lt;/span&gt;&lt;span&gt;do&lt;/span&gt;&lt;span&gt;
            {
            p &lt;/span&gt;= &lt;span&gt;2.0&lt;/span&gt;*rtvec(rtrand01(), rtrand01(), rtrand01()) - rtvec(&lt;span&gt;1&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
            } &lt;/span&gt;&lt;span&gt;while&lt;/span&gt; (dot(p, p) &amp;gt;= &lt;span&gt;1.0&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; p;
        }

    };

}

&lt;/span&gt;&lt;span&gt;#endif&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;span&gt;书上是这样的：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1316111/201901/1316111-20190101220019379-866958649.png&quot; alt=&quot;&quot; width=&quot;947&quot; height=&quot;149&quot;/&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;但是取单位圆随机点在两个材质中都有用到，所以，我还是选择把它放在了基类中，可能作者在后面会进行添加，这个不做讨论。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;我们继续看一下，如果我们定义了材质，那么我们需要改一些其他的文件内容，将它融入进去&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;intersect.h中的hitInfo中需要添加&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1316111/201901/1316111-20190101220427469-238743919.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;我们现在定义漫反射材质（Diffuse or Lambertian）如下：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('03f8cb88-f443-4c99-ac40-99f179b64f50')&quot; readability=&quot;36&quot;&gt;&lt;img id=&quot;code_img_closed_03f8cb88-f443-4c99-ac40-99f179b64f50&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_03f8cb88-f443-4c99-ac40-99f179b64f50&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('03f8cb88-f443-4c99-ac40-99f179b64f50',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_03f8cb88-f443-4c99-ac40-99f179b64f50&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;67&quot;&gt;
&lt;pre&gt;
&lt;span&gt;///&lt;/span&gt;&lt;span&gt; diffuse.h&lt;/span&gt;

&lt;span&gt;//&lt;/span&gt;&lt;span&gt; -----------------------------------------------------
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [author]        lv
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [begin ]        2019.1.1
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [brief ]        one of the materials
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; -----------------------------------------------------&lt;/span&gt;
&lt;span&gt;

#ifndef DIFFUSE_H
&lt;/span&gt;&lt;span&gt;#define&lt;/span&gt; DIFFUSE_H

&lt;span&gt;namespace&lt;/span&gt;&lt;span&gt; rt
{
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;diffuse material&lt;/span&gt;
&lt;span&gt;class&lt;/span&gt; lambertian : &lt;span&gt;public&lt;/span&gt;&lt;span&gt; material
    {
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt;:
    lambertian(&lt;/span&gt;&lt;span&gt;const&lt;/span&gt; rtvec&amp;amp;&lt;span&gt; a) :_albedo(a) {  }

    &lt;/span&gt;&lt;span&gt;virtual&lt;/span&gt; &lt;span&gt;bool&lt;/span&gt; scatter(&lt;span&gt;const&lt;/span&gt; ray&amp;amp; rIn, &lt;span&gt;const&lt;/span&gt; hitInfo&amp;amp; info, rtvec&amp;amp; attenuation, ray&amp;amp; scattered)&lt;span&gt;const&lt;/span&gt; &lt;span&gt;override&lt;/span&gt;&lt;span&gt;;

&lt;/span&gt;&lt;span&gt;protected&lt;/span&gt;&lt;span&gt;:

    rtvec _albedo;
    };

&lt;/span&gt;&lt;span&gt;bool&lt;/span&gt; lambertian::scatter(&lt;span&gt;const&lt;/span&gt; ray&amp;amp; rIn, &lt;span&gt;const&lt;/span&gt; hitInfo&amp;amp; info, rtvec&amp;amp; attenuation, ray&amp;amp; scattered)&lt;span&gt;const&lt;/span&gt;&lt;span&gt;
{
    rtvec target &lt;/span&gt;= info._p + info._n +&lt;span&gt; random_unit_sphere();
    scattered &lt;/span&gt;= ray{ info._p, target -&lt;span&gt; info._p };
    attenuation &lt;/span&gt;=&lt;span&gt; _albedo;
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
}

}

&lt;/span&gt;&lt;span&gt;#endif&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;diffuse.h&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;scatter函数就是上次主函数里面写的 lerp（）&lt;/p&gt;
&lt;p&gt;_albedo为衰减三元组，下同，不再赘述&lt;/p&gt;

&lt;p&gt;&lt;span&gt;接下来，我们需要了解一下，反射定律；&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1316111/201901/1316111-20190102012515969-696514104.jpg&quot; alt=&quot;&quot; width=&quot;956&quot; height=&quot;1104&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt; 所以，我们的反射函数如下：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
inline rtvec reflect(&lt;span&gt;const&lt;/span&gt; rtvec&amp;amp; &lt;span&gt;in&lt;/span&gt;, &lt;span&gt;const&lt;/span&gt; rtvec&amp;amp; n)&lt;span&gt;const&lt;/span&gt; { &lt;span&gt;return&lt;/span&gt; &lt;span&gt;in&lt;/span&gt; - &lt;span&gt;2&lt;/span&gt; * dot(&lt;span&gt;in&lt;/span&gt;, n)*n; }
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;span&gt; 然后我们就可以写金属材质了&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('9427e53a-3e73-4204-b81b-6569fe1b627b')&quot; readability=&quot;38&quot;&gt;&lt;img id=&quot;code_img_closed_9427e53a-3e73-4204-b81b-6569fe1b627b&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_9427e53a-3e73-4204-b81b-6569fe1b627b&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('9427e53a-3e73-4204-b81b-6569fe1b627b',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_9427e53a-3e73-4204-b81b-6569fe1b627b&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;71&quot;&gt;
&lt;pre&gt;
&lt;span&gt;///&lt;/span&gt;&lt;span&gt; metal.h&lt;/span&gt;

&lt;span&gt;//&lt;/span&gt;&lt;span&gt; -----------------------------------------------------
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [author]        lv
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [begin ]        2018.1.1
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [brief ]        one of the materials
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; -----------------------------------------------------&lt;/span&gt;
&lt;span&gt;

#ifndef MEATL_H
&lt;/span&gt;&lt;span&gt;#define&lt;/span&gt; METAL_H

&lt;span&gt;namespace&lt;/span&gt;&lt;span&gt; rt
{
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;metal material&lt;/span&gt;
&lt;span&gt;class&lt;/span&gt; metal :&lt;span&gt;public&lt;/span&gt;&lt;span&gt; material
    {
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt;:

    metal(&lt;/span&gt;&lt;span&gt;const&lt;/span&gt; rtvec&amp;amp;&lt;span&gt; a) :_albedo(a) {     }

    &lt;/span&gt;&lt;span&gt;virtual&lt;/span&gt; &lt;span&gt;bool&lt;/span&gt; scatter(&lt;span&gt;const&lt;/span&gt; ray&amp;amp; rIn, &lt;span&gt;const&lt;/span&gt; hitInfo&amp;amp; info, rtvec&amp;amp; attenuation, ray&amp;amp; scattered)&lt;span&gt;const&lt;/span&gt; &lt;span&gt;override&lt;/span&gt;&lt;span&gt;;

&lt;/span&gt;&lt;span&gt;protected&lt;/span&gt;&lt;span&gt;:

    inline rtvec reflect(&lt;/span&gt;&lt;span&gt;const&lt;/span&gt; rtvec&amp;amp; &lt;span&gt;in&lt;/span&gt;, &lt;span&gt;const&lt;/span&gt; rtvec&amp;amp; n)&lt;span&gt;const&lt;/span&gt; { &lt;span&gt;return&lt;/span&gt; &lt;span&gt;in&lt;/span&gt; - &lt;span&gt;2&lt;/span&gt; * dot(&lt;span&gt;in&lt;/span&gt;, n)*&lt;span&gt;n; }

    rtvec _albedo;
    };


&lt;/span&gt;&lt;span&gt;bool&lt;/span&gt; metal::scatter(&lt;span&gt;const&lt;/span&gt; ray&amp;amp; rIn, &lt;span&gt;const&lt;/span&gt; hitInfo&amp;amp; info, rtvec&amp;amp; attenuation, ray&amp;amp; scattered)&lt;span&gt;const&lt;/span&gt;&lt;span&gt;
{
    rtvec target &lt;/span&gt;=&lt;span&gt; reflect(rIn.direction().ret_unitization(), info._n);
    scattered &lt;/span&gt;=&lt;span&gt; ray{ info._p, target };
    attenuation &lt;/span&gt;=&lt;span&gt; _albedo;
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; dot(scattered.direction(), info._n) != &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
}

}
&lt;/span&gt;&lt;span&gt;#endif&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;metal.h&lt;/span&gt;&lt;/div&gt;

&lt;p&gt;&lt;span&gt;这个其实比较简单，就根据反射定律计算出反射向量然后转移视线即可&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;根据书上的步骤，我们可以先写一个例子了&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;我们首先写lerp函数&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;为了避免场景中物体过多，进行非常多次反射降低渲染效率，我们取合适的反射递归深度值作为界限&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;51&quot;&gt;
&lt;pre&gt;
rtvec lerp(&lt;span&gt;const&lt;/span&gt; ray&amp;amp; sight, intersect* world, &lt;span&gt;int&lt;/span&gt;&lt;span&gt; depth)  
{
    hitInfo info;
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (world-&amp;gt;hit(sight, (rtvar)&lt;span&gt;0.001&lt;/span&gt;&lt;span&gt;, rtInf(), info))
    {
        ray scattered;
        rtvec attenuation;
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (depth &amp;lt; &lt;span&gt;50&lt;/span&gt; &amp;amp;&amp;amp; info.materialp-&amp;gt;&lt;span&gt;scatter(sight, info, attenuation, scattered))
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; attenuation * lerp(scattered, world, depth + &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);　&lt;span&gt;//递归反射，每次反射回退计算rgb的时候进行衰减
        &lt;/span&gt;&lt;/span&gt;&lt;span&gt;else&lt;/span&gt;
            &lt;span&gt;return&lt;/span&gt; rtvec(&lt;span&gt;0&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
    }
    &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;
    {
        rtvec unit_dir &lt;/span&gt;=&lt;span&gt; sight.direction().ret_unitization();
        rtvar t &lt;/span&gt;= &lt;span&gt;0.5&lt;/span&gt;*(unit_dir.y() + &lt;span&gt;1&lt;/span&gt;&lt;span&gt;.);
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;. - t)*rtvec(&lt;span&gt;1&lt;/span&gt;., &lt;span&gt;1&lt;/span&gt;., &lt;span&gt;1&lt;/span&gt;.) + t*rtvec(&lt;span&gt;0.5&lt;/span&gt;, &lt;span&gt;0.7&lt;/span&gt;, &lt;span&gt;1.0&lt;/span&gt;&lt;span&gt;);
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;span&gt; 我们的main函数：&lt;/span&gt;&lt;/p&gt;

&lt;div class=&quot;cnblogs_code&quot; readability=&quot;23.597765363128&quot;&gt;
&lt;pre&gt;
&lt;span&gt;inline rtvar rtrand01()　//&lt;a href=&quot;https://www.cnblogs.com/lv-anchoret/p/10190092.html&quot; target=&quot;_blank&quot;&gt;https://www.cnblogs.com/lv-anchoret/p/10190092.html&lt;/a&gt;
{
    &lt;/span&gt;&lt;span&gt;static&lt;/span&gt;&lt;span&gt; std::mt19937 mt;
    &lt;/span&gt;&lt;span&gt;static&lt;/span&gt; std::uniform_real_distribution&amp;lt;rtvar&amp;gt;&lt;span&gt; rtrand;
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; rtrand(mt);
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;main:&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;67&quot;&gt;
&lt;pre&gt;
    stds ofstream file(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;graph8-1.ppm&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
    size_t W &lt;/span&gt;= &lt;span&gt;400&lt;/span&gt;, H = &lt;span&gt;200&lt;/span&gt;, sample = &lt;span&gt;100&lt;/span&gt;&lt;span&gt;;

    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; (file.is_open())
    {
        file &lt;/span&gt;&amp;lt;&amp;lt; &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;P3\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; &amp;lt;&amp;lt; W &amp;lt;&amp;lt; &lt;span&gt;&quot;&lt;/span&gt; &lt;span&gt;&quot;&lt;/span&gt; &amp;lt;&amp;lt; H &amp;lt;&amp;lt; &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;\n255\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; &amp;lt;&amp;lt;&lt;span&gt; stds endl;
        
        size_t sphereCnt &lt;/span&gt;= &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
        intersect&lt;/span&gt;** list = &lt;span&gt;new&lt;/span&gt; intersect*&lt;span&gt;[sphereCnt];
        list[&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;] = &lt;span&gt;new&lt;/span&gt; sphere(rtvec(&lt;span&gt;0&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, -&lt;span&gt;1&lt;/span&gt;), &lt;span&gt;0.5&lt;/span&gt;, &lt;span&gt;new&lt;/span&gt; lambertian(rtvec(&lt;span&gt;0.8&lt;/span&gt;,&lt;span&gt;0.3&lt;/span&gt;,&lt;span&gt;0.3&lt;/span&gt;&lt;span&gt;)));
        list[&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;] = &lt;span&gt;new&lt;/span&gt; sphere(rtvec(&lt;span&gt;0&lt;/span&gt;, -&lt;span&gt;100.5&lt;/span&gt;, -&lt;span&gt;1&lt;/span&gt;), &lt;span&gt;100&lt;/span&gt;, &lt;span&gt;new&lt;/span&gt; lambertian(rtvec(&lt;span&gt;0.8&lt;/span&gt;, &lt;span&gt;0.8&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;.)));
        list[&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;] = &lt;span&gt;new&lt;/span&gt; sphere(rtvec(-&lt;span&gt;1&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, -&lt;span&gt;1&lt;/span&gt;), &lt;span&gt;0.5&lt;/span&gt;, &lt;span&gt;new&lt;/span&gt; metal(rtvec(&lt;span&gt;0.8&lt;/span&gt;, &lt;span&gt;0.8&lt;/span&gt;, &lt;span&gt;0.8&lt;/span&gt;&lt;span&gt;)));
        list[&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;] = &lt;span&gt;new&lt;/span&gt; sphere(rtvec(&lt;span&gt;1&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;, -&lt;span&gt;1&lt;/span&gt;), &lt;span&gt;0.5&lt;/span&gt;, &lt;span&gt;new&lt;/span&gt; metal(rtvec(&lt;span&gt;0.8&lt;/span&gt;, &lt;span&gt;0.6&lt;/span&gt;, &lt;span&gt;0.2&lt;/span&gt;&lt;span&gt;)));
        intersect&lt;/span&gt;* world = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; intersections(list, sphereCnt);

        camera cma;

        &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; y = H - &lt;span&gt;1&lt;/span&gt;; y &amp;gt;= &lt;span&gt;0&lt;/span&gt;; --&lt;span&gt;y)
            &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; x = &lt;span&gt;0&lt;/span&gt;; x &amp;lt; W; ++&lt;span&gt;x)
            {
                rtvec color;
                &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; cnt = &lt;span&gt;0&lt;/span&gt;; cnt &amp;lt; sample; ++&lt;span&gt;cnt)
                {
                    lvgm::vec2&lt;/span&gt;&amp;lt;rtvar&amp;gt;&lt;span&gt; para{ 
                        (rtrand01() &lt;/span&gt;+ x) /&lt;span&gt; W,
                        (rtrand01() &lt;/span&gt;+ y) /&lt;span&gt; H };
                    color &lt;/span&gt;+= lerp(cma.get_ray(para), world, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
                }
                color &lt;/span&gt;/=&lt;span&gt; sample;
                color &lt;/span&gt;= rtvec(sqrt(color.r()), sqrt(color.g()), sqrt(color.b()));    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;gamma 校正，上一篇讲过&lt;/span&gt;
                &lt;span&gt;int&lt;/span&gt; r = &lt;span&gt;int&lt;/span&gt;(&lt;span&gt;255.99&lt;/span&gt; *&lt;span&gt; color.r());
                &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; g = &lt;span&gt;int&lt;/span&gt;(&lt;span&gt;255.99&lt;/span&gt; *&lt;span&gt; color.g());
                &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; b = &lt;span&gt;int&lt;/span&gt;(&lt;span&gt;255.99&lt;/span&gt; *&lt;span&gt; color.b());
                file &lt;/span&gt;&amp;lt;&amp;lt; r &amp;lt;&amp;lt; &lt;span&gt;&quot;&lt;/span&gt; &lt;span&gt;&quot;&lt;/span&gt; &amp;lt;&amp;lt; g &amp;lt;&amp;lt; &lt;span&gt;&quot;&lt;/span&gt; &lt;span&gt;&quot;&lt;/span&gt; &amp;lt;&amp;lt; b &amp;lt;&amp;lt;&lt;span&gt; stds endl;
            }
        file.close();

        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (list[&lt;span&gt;0&lt;/span&gt;])&lt;span&gt;delete&lt;/span&gt; list[&lt;span&gt;0&lt;/span&gt;&lt;span&gt;];
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (list[&lt;span&gt;1&lt;/span&gt;])&lt;span&gt;delete&lt;/span&gt; list[&lt;span&gt;1&lt;/span&gt;&lt;span&gt;];
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (list[&lt;span&gt;2&lt;/span&gt;])&lt;span&gt;delete&lt;/span&gt; list[&lt;span&gt;2&lt;/span&gt;&lt;span&gt;];
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (list[&lt;span&gt;3&lt;/span&gt;])&lt;span&gt;delete&lt;/span&gt; list[&lt;span&gt;3&lt;/span&gt;&lt;span&gt;];
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (list)&lt;span&gt;delete&lt;/span&gt;&lt;span&gt;[] list;
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (world)&lt;span&gt;delete&lt;/span&gt;&lt;span&gt; world;

        stds cout &lt;/span&gt;&amp;lt;&amp;lt; &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;complished&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; &amp;lt;&amp;lt;&lt;span&gt; stds endl;
    }
    &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;
        stds cerr &lt;/span&gt;&amp;lt;&amp;lt; &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;open file error&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; &amp;lt;&amp;lt; stds endl;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt; 上述的sphere对象增加了材质，所以我们需要为sphere-class做一些适当的补充&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('afeb44ec-d692-4202-af45-cdc2fba34455')&quot; readability=&quot;39&quot;&gt;&lt;img id=&quot;code_img_closed_afeb44ec-d692-4202-af45-cdc2fba34455&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_afeb44ec-d692-4202-af45-cdc2fba34455&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('afeb44ec-d692-4202-af45-cdc2fba34455',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_afeb44ec-d692-4202-af45-cdc2fba34455&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;73&quot;&gt;
&lt;pre&gt;
&lt;span&gt;///&lt;/span&gt;&lt;span&gt; sphere.h&lt;/span&gt;

&lt;span&gt;//&lt;/span&gt;&lt;span&gt; -----------------------------------------------------
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [author]        lv
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [begin ]        2018.1.1
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [brief ]        the sphere-class for the ray-tracing project
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;                from the 《ray tracing in one week》
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; -----------------------------------------------------&lt;/span&gt;
&lt;span&gt;
#ifndef SPHERE_H
&lt;/span&gt;&lt;span&gt;#define&lt;/span&gt; SPHERE_H

&lt;span&gt;namespace&lt;/span&gt;&lt;span&gt; rt
{

&lt;/span&gt;&lt;span&gt;class&lt;/span&gt; sphere :&lt;span&gt;public&lt;/span&gt;&lt;span&gt; intersect
    {
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt;:
    sphere() {  }

        &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;
        @para1: 球心坐标
        @para2: 球半径
        @para3: 材质
        &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    sphere(&lt;/span&gt;&lt;span&gt;const&lt;/span&gt; rtvec&amp;amp; h, rtvar r, material*&lt;span&gt; ma) :_heart(h), _radius(r), _materialp(ma) {  } 

    &lt;/span&gt;~sphere() { &lt;span&gt;if&lt;/span&gt; (_materialp)    &lt;span&gt;delete&lt;/span&gt;&lt;span&gt; _materialp; }
        
    &lt;/span&gt;&lt;span&gt;virtual&lt;/span&gt; &lt;span&gt;bool&lt;/span&gt; hit(&lt;span&gt;const&lt;/span&gt; ray&amp;amp; sight, rtvar t_min, rtvar t_max, hitInfo&amp;amp; rec)&lt;span&gt;const&lt;/span&gt; &lt;span&gt;override&lt;/span&gt;&lt;span&gt;;

    inline &lt;/span&gt;&lt;span&gt;const&lt;/span&gt; rtvar r()&lt;span&gt;const&lt;/span&gt; { &lt;span&gt;return&lt;/span&gt;&lt;span&gt; _radius; }

    inline &lt;/span&gt;&lt;span&gt;const&lt;/span&gt; rtvec&amp;amp; heart()&lt;span&gt;const&lt;/span&gt; { &lt;span&gt;return&lt;/span&gt;&lt;span&gt; _heart; }

    inline rtvar&lt;/span&gt;&amp;amp; r() { &lt;span&gt;return&lt;/span&gt;&lt;span&gt; _radius; }

    inline rtvec&lt;/span&gt;&amp;amp; heart() { &lt;span&gt;return&lt;/span&gt;&lt;span&gt; _heart; }

&lt;/span&gt;&lt;span&gt;private&lt;/span&gt;&lt;span&gt;:
    rtvec _heart;

    rtvar _radius;

    material&lt;/span&gt;*&lt;span&gt; _materialp;
    };


&lt;/span&gt;&lt;span&gt;bool&lt;/span&gt; sphere::hit(&lt;span&gt;const&lt;/span&gt; ray&amp;amp; sight, rtvar t_min, rtvar t_max, hitInfo&amp;amp; rec)&lt;span&gt;const&lt;/span&gt;&lt;span&gt;
{
    rtvec trace &lt;/span&gt;= sight.origin() -&lt;span&gt; _heart;
    rtvar a &lt;/span&gt;=&lt;span&gt; dot(sight.direction(), sight.direction());
    rtvar b &lt;/span&gt;= &lt;span&gt;2.0&lt;/span&gt; *&lt;span&gt; dot(trace, sight.direction());
    rtvar c &lt;/span&gt;= dot(trace, trace) - _radius *&lt;span&gt; _radius;
    rtvar delt &lt;/span&gt;= b*b - &lt;span&gt;4.0&lt;/span&gt;*a*&lt;span&gt;c;
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (delt &amp;gt; &lt;span&gt;0&lt;/span&gt;&lt;span&gt;)
    {
        rec.materialp &lt;/span&gt;=&lt;span&gt; _materialp;
        rtvar x &lt;/span&gt;= (-b - sqrt(delt)) / (&lt;span&gt;2.0&lt;/span&gt;*&lt;span&gt;a);
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (x &amp;lt; t_max &amp;amp;&amp;amp; x &amp;gt;&lt;span&gt; t_min)
        {
            rec._t &lt;/span&gt;=&lt;span&gt; x;
            rec._p &lt;/span&gt;=&lt;span&gt; sight.go(rec._t);
            rec._n &lt;/span&gt;= (rec._p - _heart) /&lt;span&gt; _radius;
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
        }
        x &lt;/span&gt;= (-b + sqrt(delt)) / (&lt;span&gt;2.0&lt;/span&gt;*&lt;span&gt;a);
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (x &amp;lt; t_max &amp;amp;&amp;amp; x &amp;gt;&lt;span&gt; t_min)
        {
            rec._t &lt;/span&gt;=&lt;span&gt; x;
            rec._p &lt;/span&gt;=&lt;span&gt; sight.go(x);
            rec._n &lt;/span&gt;= (rec._p - _heart) /&lt;span&gt; _radius;
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
        }
    }
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
}

}

&lt;/span&gt;&lt;span&gt;#endif&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;sphere.h&lt;/span&gt;&lt;/div&gt;

&lt;p&gt;&lt;span&gt;我们创建了四个球&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;中间heart:(0,0,1)　　r:0.5&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;下面heart:(0,-100.5,-1)　　r:100&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;左边heart:(-1,0,-1) 　r:0.5&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;右边heart:(1,0,-1)　　r:0.5&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;左右为镜面，中间和下面是磨砂&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1316111/201901/1316111-20190102015728283-187075797.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt; 回顾我们的标准屏幕坐标系：&lt;span&gt;&lt;a href=&quot;https://www.cnblogs.com/lv-anchoret/p/10182002.html&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;coor 1.1&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; 中间球的球心 ，距上边界为1，距下边界为1，距左边界为2，距右边界为2&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;所以，绿色球（heart(0,-100.5,-1), r：100）超出屏幕底部0.5，意思是和三个球的底部是契合的，所以，它们之间有三个接触的阴影&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;而左右两个球中的画面均为镜面反射，并不是透明，中间球两边的小球是在旁边球面的球面镜像&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;我们可以测验下，比如把绿球的半径改为100.3，即&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1316111/201901/1316111-20190102020607763-1591220534.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;则是这样的：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1316111/201901/1316111-20190102020641299-128521979.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt; 现在总该相信，绿球的上边界并不是图中的绿色横线，那些都是左右球镜面反射的镜像。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;你也可以把绿球的半径改为99.7&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1316111/201901/1316111-20190102020929177-1977517024.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt; 三个球的底部和绿球并没有接触阴影，且球镜面镜像中绿色横线边界有所降低&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;如果没有明白，我们来屡一下流程再继续往下走：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;流程&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;1.我们先创建几个sphere，每个都需要有球心、半径、rgb衰减三元组和材质&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2.视线扫描屏幕&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;3.lerp计算&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　1)当前视线和场景中所有的物体求表面交点，求最近点，顺便把交点的信息都记录下来，包括位置，表面法线和该点所在的sphere中的材质信息&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;　　2）如果有交点：根据交点的材质，计算反射或散射向量，顺便把材质中的衰减三元组信息通过参数传出来，然后返回rgb的时候进行rgb分量衰减，根据求取的scattered-ray，进行视线转移（视点转换）；&lt;/span&gt;&lt;span&gt;如果没有交点了，那么返回该位置对应的背景插值颜色&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;4.采样&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;5.gamma校正&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;6.输出屏幕中该点的信息&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;那么，我们还是来关注下这里面的一些个有趣的事情，好像有一个叫衰减三元组的，使用计算反射后的光线的rgb乘以三元组进行分量衰减，那么，如果衰减三元组为（1,1,1），那么意思就是保持原值，未损失，那么我们把场景中所有的sphere中的衰减三元组均改为（1,1,1），会是什么样子的呢？&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1316111/201901/1316111-20190102023651582-493671110.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;非常不明显，尤其是中间和下面，基本看不到了，右边还算有些轮廓&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;因为，漫反射材质散射方向随机，所以如果不把散射光进行逐步衰减的话，基本就是周围背景色，所以，漫反射材质很容易融入坏境&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;而镜面是严格的物理反射规律，所以上半部分会用更上面的光代替，下面的会用下面的光代替，所以还是有一些色差的&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;左面的部分还加了镜面模糊效果的，镜面模糊下面讲&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;镜面模糊其实就是 镜面 + 模糊系数*漫反射&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;漫反射&lt;a href=&quot;https://www.cnblogs.com/lv-anchoret/p/10198423.html&quot; target=&quot;_blank&quot;&gt;实现原理&lt;/a&gt;是根据随机化s点，所以模糊镜面实现公式即为：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;&lt;span&gt;模糊镜面反射 = 镜面反射 + 模糊系数 * 单位球随机点漫反射&lt;/span&gt;&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;引用书中一张图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1316111/201901/1316111-20190102025344492-230219258.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;模糊原理就和漫反射原理差不多&lt;/span&gt;&lt;/p&gt;

&lt;div class=&quot;cnblogs_code&quot; readability=&quot;47&quot;&gt;
&lt;pre&gt;
&lt;span&gt;///&lt;/span&gt;&lt;span&gt; metal.h&lt;/span&gt;

&lt;span&gt;//&lt;/span&gt;&lt;span&gt; -----------------------------------------------------
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [author]        lv
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [begin ]        2018.1.1
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; [brief ]        one of the materials
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; -----------------------------------------------------&lt;/span&gt;
&lt;span&gt;

#ifndef MEATL_H
&lt;/span&gt;&lt;span&gt;#define&lt;/span&gt; METAL_H

&lt;span&gt;namespace&lt;/span&gt;&lt;span&gt; rt
{
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;metal material&lt;/span&gt;
&lt;span&gt;class&lt;/span&gt; metal :&lt;span&gt;public&lt;/span&gt;&lt;span&gt; material
    {
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt;:

    metal(&lt;/span&gt;&lt;span&gt;const&lt;/span&gt; rtvec&amp;amp; a, &lt;span&gt;const&lt;/span&gt;&lt;span&gt; rtvar f = 0.) :_albedo(a) 
        { 
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (f &amp;lt; &lt;span&gt;1&lt;/span&gt; &amp;amp;&amp;amp; f &amp;gt;= &lt;span&gt;0&lt;/span&gt;)_fuzz =&lt;span&gt; f;
        &lt;/span&gt;&lt;span&gt;else&lt;/span&gt; _fuzz = &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
        }

    &lt;/span&gt;&lt;span&gt;virtual&lt;/span&gt; &lt;span&gt;bool&lt;/span&gt; scatter(&lt;span&gt;const&lt;/span&gt; ray&amp;amp; rIn, &lt;span&gt;const&lt;/span&gt; hitInfo&amp;amp; info, rtvec&amp;amp; attenuation, ray&amp;amp; scattered)&lt;span&gt;const&lt;/span&gt; &lt;span&gt;override&lt;/span&gt;&lt;span&gt;;

&lt;/span&gt;&lt;span&gt;protected&lt;/span&gt;&lt;span&gt;:
    inline rtvec reflect(&lt;/span&gt;&lt;span&gt;const&lt;/span&gt; rtvec&amp;amp; &lt;span&gt;in&lt;/span&gt;, &lt;span&gt;const&lt;/span&gt; rtvec&amp;amp; n)&lt;span&gt;const&lt;/span&gt; { &lt;span&gt;return&lt;/span&gt; &lt;span&gt;in&lt;/span&gt; - &lt;span&gt;2&lt;/span&gt; * dot(&lt;span&gt;in&lt;/span&gt;, n)*&lt;span&gt;n; }

    rtvec _albedo;

    rtvar _fuzz;
    };


&lt;/span&gt;&lt;span&gt;bool&lt;/span&gt; metal::scatter(&lt;span&gt;const&lt;/span&gt; ray&amp;amp; rIn, &lt;span&gt;const&lt;/span&gt; hitInfo&amp;amp; info, rtvec&amp;amp; attenuation, ray&amp;amp; scattered)&lt;span&gt;const&lt;/span&gt;&lt;span&gt;
{
    rtvec target &lt;/span&gt;=&lt;span&gt; reflect(rIn.direction().ret_unitization(), info._n);
    scattered &lt;/span&gt;= ray{ info._p, target + _fuzz *&lt;span&gt; random_unit_sphere() };
    attenuation &lt;/span&gt;=&lt;span&gt; _albedo;
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; dot(scattered.direction(), info._n) != &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
}

}
&lt;/span&gt;&lt;span&gt;#endif&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; 所以我们在main中创建sphere时，还要指定模糊系数，默认为0（不模糊）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;我们来测试下模糊系数，如果左右两个镜面的模糊系数分别为0.7和0.2的话，是这个样子的：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1316111/201901/1316111-20190102025742017-843935963.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt; 如果只把右边和下边改为镜面，那么就很有意思了：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1316111/201901/1316111-20190102025853910-246808782.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;最后一张，全镜面，左球和中球模糊&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1316111/201901/1316111-20190102030025484-1998660006.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt; 是不是感觉非常有意思&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;感谢您的阅读，生活愉快~&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Tue, 01 Jan 2019 19:05:00 +0000</pubDate>
<dc:creator>林-兮</dc:creator>
<og:description>新的一年，前来打卡 Preface 回顾上一篇，我们讲述了漫反射材质，也就是平时的磨砂表面。 它一种将入射光经表面随机散射形成的材质，是一种非常普遍的表面形式。 这一篇，我们将来学习镜面反射，或者说是</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/lv-anchoret/p/10206773.html</dc:identifier>
</item>
<item>
<title>.NET Core容器化开发系列（一）——Docker里面跑个.NET Core - 蜗牛往前走</title>
<link>http://www.cnblogs.com/leafly/p/10188159.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/leafly/p/10188159.html</guid>
<description>&lt;h2&gt;前言&lt;/h2&gt;
&lt;p&gt;    博客园中已经有很多如何在Docker里面运行ASP.NET Core的介绍了。本篇主要介绍一些细节，帮助初学的朋友更加深入地理解如何在Docker中运行ASP.NET Core。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/other/360251/201812/360251-20181227235157555-1702215126.png&quot; word_img=&quot;file:///C:/Users/Samps/AppData/Local/Programs/blogs51/resources/app.asar/dist/electron/static/editor/neditor/themes/notadd/images/spacer.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h2&gt;安装Docker&lt;/h2&gt;
&lt;p&gt;    Docker现支持在主流Linux、Windows和macOS上安装，官方的安装文档请参考&lt;a href=&quot;https://docs.docker.com/install/linux/docker-ce/centos/&quot; target=&quot;_blank&quot; title=&quot;docker docs&quot;&gt;docker docs&lt;/a&gt;。鉴于国内的网络环境，建议通过国内大厂/高校提供的镜像站快速安装，比如 &lt;a href=&quot;https://opsx.alibaba.com/mirror&quot; target=&quot;_blank&quot;&gt;阿里巴巴开源镜像站&lt;/a&gt;，Ubuntu和Centos7上的安装方式如下：&lt;br/&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;strong&gt;Ubuntu 14.04 16.04 (使用apt-get进行安装)&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;brush:bash;toolbar:false&quot;&gt;
# step 1: 安装必要的一些系统工具
sudo apt-get update
sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common
# step 2: 安装GPG证书
curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -
# Step 3: 写入软件源信息
sudo add-apt-repository &quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;
# Step 4: 更新并安装 Docker-CE
sudo apt-get -y update
sudo apt-get -y install docker-ce

# 安装指定版本的Docker-CE:
# Step 1: 查找Docker-CE的版本:
# apt-cache madison docker-ce
#   docker-ce | 17.03.1~ce-0~ubuntu-xenial | http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial/stable amd64 Packages
#   docker-ce | 17.03.0~ce-0~ubuntu-xenial | http://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial/stable amd64 Packages
# Step 2: 安装指定版本的Docker-CE: (VERSION 例如上面的 17.03.1~ce-0~ubuntu-xenial)
# sudo apt-get -y install docker-ce=[VERSION]
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;CentOS 7 (使用yum进行安装)&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;brush:bash;toolbar:false&quot;&gt;
# step 1: 安装必要的一些系统工具
sudo yum install -y yum-utils device-mapper-persistent-data lvm2
# Step 2: 添加软件源信息
sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
# Step 3: 更新并安装 Docker-CE
sudo yum makecache fast
sudo yum -y install docker-ce
# Step 4: 开启Docker服务
sudo systemctl enable docker &amp;amp;&amp;amp; systemctl start docker

# 注意：
# 官方软件源默认启用了最新的软件，您可以通过编辑软件源的方式获取各个版本的软件包。例如官方并没有将测试版本的软件源置为可用，你可以通过以下方式开启。同理可以开启各种测试版本等。
# vim /etc/yum.repos.d/docker-ce.repo
#   将 [docker-ce-test] 下方的 enabled=0 修改为 enabled=1
#
# 安装指定版本的Docker-CE:
# Step 1: 查找Docker-CE的版本:
# yum list docker-ce.x86_64 --showduplicates | sort -r
#   Loading mirror speeds from cached hostfile
#   Loaded plugins: branch, fastestmirror, langpacks
#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            docker-ce-stable
#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            @docker-ce-stable
#   docker-ce.x86_64            17.03.0.ce-1.el7.centos            docker-ce-stable
#   Available Packages
# Step2 : 安装指定版本的Docker-CE: (VERSION 例如上面的 17.03.0.ce.1-1.el7.centos)
# sudo yum -y install docker-ce-[VERSION]
&lt;/pre&gt;
&lt;p&gt;    以下我的实验在Centos7中进行，其他系统基本类似。&lt;br/&gt;&lt;/p&gt;
&lt;p&gt;安装完成后，可以看到最新Docker版本为18.09（2018年12月27日）&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/other/360251/201812/360251-20181227231438482-8047659.png&quot; word_img=&quot;file:///C:/Users/Samps/AppData/Local/Programs/blogs51/resources/app.asar/dist/electron/static/editor/neditor/themes/notadd/images/spacer.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;h2&gt;效果0X01&lt;/h2&gt;
&lt;p&gt;既然Docker安装好了，也正常运行起来了，我们第一件事儿做的就是运行一下Demo，看看是个什么效果，微软将dotnet的Docker镜像都托管在Docker Hub上，我们可以打开Docker Hub的官方网站：&lt;a href=&quot;https://hub.docker.com&quot; target=&quot;_blank&quot;&gt;https://hub.docker.com&lt;/a&gt; 并直接搜索dotnet，找到microsoft/dotnet即可。&lt;/p&gt;
&lt;p&gt;根据Wiki提示，我们使用如下命令运行第一个ASP.NET Core的Demo：&lt;/p&gt;
&lt;pre class=&quot;brush:bash;toolbar:false&quot;&gt;
docker run -it --rm -p 8000:80 --name aspnetcore_sample microsoft/dotnet-samples:aspnetapp
&lt;/pre&gt;
&lt;p&gt;运行后输出：&lt;/p&gt;
&lt;pre class=&quot;brush:bash;toolbar:false&quot;&gt;
[root@singleCentos7 ~]# docker run -it --rm -p 8000:80 --name aspnetcore_sample microsoft/dotnet-samples:aspnetapp
Unable to find image 'microsoft/dotnet-samples:aspnetapp' locally
aspnetapp: Pulling from microsoft/dotnet-samples
a5a6f2f73cd8: Pull complete 
1e6f560accc2: Pull complete 
8176b77dc10d: Pull complete 
e21dd5015bb0: Pull complete 
10a7ec297783: Pull complete 
52c4b3af04fb: Pull complete 
Digest: sha256:de388b1ced92eadb906f806d0253d93c76cb92b0814798e7441c014b9645a32c
Status: Downloaded newer image for microsoft/dotnet-samples:aspnetapp
warn: Microsoft.AspNetCore.DataProtection.KeyManagement.XmlKeyManager[35]
      No XML encryptor configured. Key {024f9978-2fea-4d8e-818a-b9a378553244} may be persisted to storage in unencrypted form.
Hosting environment: Production
Content root path: /app
Now listening on: http://[::]:80
Application started. Press Ctrl+C to shut down.
&lt;/pre&gt;

&lt;p&gt;简单解释一下命令中几个常见的参数：&lt;/p&gt;
&lt;p&gt;-it 开启一个交互窗口，也急运行docker后，处于docker的交互式输入输出页面&lt;/p&gt;
&lt;p&gt;--rm 当从运行的容器中退出（ctrl+c）时，删除镜像残留信息及数据&lt;/p&gt;
&lt;p&gt;-p 端口映射，将宿主机端口映射到容器内端口&lt;/p&gt;
&lt;p&gt;--name 给容器起个名字，如不设置该项，容器名称将有docker服务随机设定&lt;/p&gt;
&lt;p&gt;最后是镜像的地址以及tag&lt;/p&gt;

&lt;p&gt;运行该段命令后：&lt;/p&gt;
&lt;p&gt;首先查询宿主机本地是否存在microsoft/dotnet-samples:aspnetapp镜像&lt;/p&gt;
&lt;p&gt;如不存在，则从远端拉取镜像&lt;/p&gt;
&lt;p&gt;拉取成功后，运行指定命令，将Demo服务运行起来&lt;/p&gt;

&lt;p&gt;此时我们在局域网的任意一台电脑浏览器中输入&lt;a href=&quot;http://[%E5%AE%BF%E4%B8%BB%E6%9C%BAIP]:8000&quot;&gt;http://[宿主机IP]:8000&lt;/a&gt; 即可打开容器运行的demo&lt;/p&gt;
&lt;p&gt;&lt;img alt=&quot;&quot; data-media-type=&quot;image&quot; src=&quot;f:/有道云笔记_文件/updateserver@163.com/0030f7ddb3fb45069f6aa0ed7c4141e4/clipboard.png&quot; data-attr-org-src-id=&quot;E6633F141B2C4D288E2EF42F5FF40BAC&quot;/&gt;&lt;/p&gt;
&lt;h2&gt;效果0X02&lt;/h2&gt;
&lt;p&gt;看完官方的Demo，接下来我们自制一个DemoV2 。该思路采用将Docker容器转制为镜像的办法，因该方法扩展性不强，不适合重复使用，因此不被推荐，但其中的部分思路非常适合借鉴学习：&lt;/p&gt;
&lt;pre class=&quot;brush:bash;toolbar:false&quot;&gt;
docker run -it --rm --name dotnet_sdk microsoft/dotnet:sdk
&lt;/pre&gt;
&lt;p&gt;&lt;img alt=&quot;&quot; data-media-type=&quot;image&quot; src=&quot;f:/有道云笔记_文件/updateserver@163.com/74bd6dbe3d0b47f6977e7804b6b5ad77/clipboard.png&quot; data-attr-org-src-id=&quot;F4F62C8505F3434AA9CADA7A4762246B&quot;/&gt;&lt;/p&gt;
&lt;p&gt;接下来我们在tmp目录下新建一个ASP.NET Core MVC项目，并发布该项目都/app目录下&lt;br/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/other/360251/201901/360251-20190101224129734-43142066.png&quot; word_img=&quot;file:///C:/Users/Samps/AppData/Local/Programs/blogs51/resources/app.asar/dist/electron/static/editor/neditor/themes/notadd/images/spacer.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;此时我们进入/app目录后,执行命令，即可看到demo1已经能在容器中正常运行：&lt;/p&gt;
&lt;pre class=&quot;brush:bash;toolbar:false&quot;&gt;
cd /app &amp;amp;&amp;amp; dotnet demo1.dll
&lt;/pre&gt;
&lt;p&gt;接下来我们使用docker commit命令将当期容器转制为镜像，以便于我们重复使用。&lt;/p&gt;
&lt;p&gt;首先，新开一个宿主机终端，并在终端中查看当期运行的容器：&lt;/p&gt;
&lt;pre class=&quot;brush:bash;toolbar:false&quot;&gt;
docker ps
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/other/360251/201901/360251-20190101224723470-1531278379.png&quot; word_img=&quot;file:///C:/Users/Samps/AppData/Local/Programs/blogs51/resources/app.asar/dist/electron/static/editor/neditor/themes/notadd/images/spacer.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;可以发现名称为dotnet_sdk的容器，其容器Id为9bc83a01a0d1，此时执行如下命令：&lt;/p&gt;
&lt;pre class=&quot;brush:bash;toolbar:false&quot;&gt;
docker commit 9bc83a01a0d1 mydemo:v1
&lt;/pre&gt;
&lt;p&gt;即可将指定容器保存为名称为mydemo的镜像，执行docker images查看：&lt;br/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/other/360251/201901/360251-20190101224959445-841214794.png&quot; word_img=&quot;file:///C:/Users/Samps/AppData/Local/Programs/blogs51/resources/app.asar/dist/electron/static/editor/neditor/themes/notadd/images/spacer.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;包含我们demo程序的镜像就已经保存下来了，接下来我们可以直接运行该镜像查看效果：&lt;/p&gt;
&lt;pre class=&quot;brush:bash;toolbar:false&quot;&gt;
docker run -it --rm -p 8001:80 --name ggg mydemo:v1 sh -c &quot;cd /app &amp;amp;&amp;amp; dotnet demo1.dll&quot;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/other/360251/201901/360251-20190101225221661-996046992.png&quot; word_img=&quot;file:///C:/Users/Samps/AppData/Local/Programs/blogs51/resources/app.asar/dist/electron/static/editor/neditor/themes/notadd/images/spacer.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;打开浏览器访问效果：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/other/360251/201901/360251-20190101225237594-1012669635.png&quot; word_img=&quot;file:///C:/Users/Samps/AppData/Local/Programs/blogs51/resources/app.asar/dist/electron/static/editor/neditor/themes/notadd/images/spacer.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;h2&gt;效果0x03&lt;/h2&gt;
&lt;p&gt;接下来我们用最常见也是最合适的方式制作我们的.NET Core MVC镜像---Dockerfile&lt;/p&gt;
&lt;p&gt;如果我们希望在Linux下直接开始.NET Core的代码编写，首先就必须要安装平台相关的.Net Core SDK，安装完成后，才可以使用dotnet 的相关指令创建、编译、发布项目。此时我们可以在Docker下采取更“鸡贼”一些的办法：&lt;/p&gt;
&lt;p&gt;首先，我们运行一个.Net Sdk的容器，并进入交互式界面：&lt;/p&gt;
&lt;pre class=&quot;brush:bash;toolbar:false&quot;&gt;
docker run -it --rm --name dotnet_sdk -v /tmp/src:/tmp/src  microsoft/dotnet:sdk
&lt;/pre&gt;
&lt;p&gt;运行.Net Core最新的SDK，并将宿主机/tmp/src 文件夹挂在到容器/tmp/src下面，而后我们在这个文件夹的文件都不会因容器销毁二丢失。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/other/360251/201901/360251-20190101221250620-341793605.png&quot; word_img=&quot;file:///C:/Users/Samps/AppData/Local/Programs/blogs51/resources/app.asar/dist/electron/static/editor/neditor/themes/notadd/images/spacer.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;查看容器中dotnet版本信息，并在容器的/tmp/src文件夹下创建新的ASP.NET Core MVC项目：&lt;/p&gt;
&lt;pre class=&quot;brush:bash;toolbar:false&quot;&gt;
cd /tmp/src
dotnet new mvc -n mydemo
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/other/360251/201901/360251-20190101221538771-580771020.png&quot; word_img=&quot;file:///C:/Users/Samps/AppData/Local/Programs/blogs51/resources/app.asar/dist/electron/static/editor/neditor/themes/notadd/images/spacer.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;此时可以退出当前容器了，接下来进入的是Docker的打包步骤。&lt;/p&gt;
&lt;p&gt;虽然这种做法有点“画蛇添足”，但在某些时刻还是挺有用的，比如系统中存在老版本的.NET Core SDK，安装新版本的SDK可能会产生未知的问题，此时在Docker里面瞎玩，随便搞都没问题，棒呆！&lt;/p&gt;

&lt;p&gt;同时有必要再强调一下，Docker从17.05版本开始支持“多阶段构建（&lt;span&gt;multi-stages builds&lt;/span&gt;）”，而大多数干净的Linux操作系统在直接使用系统包管理器安装docker时安装的是13.1的版本Docker，是不支持该特性的。&lt;/p&gt;
&lt;p&gt;下面介绍的模式是分层结构的构建方式。&lt;/p&gt;
&lt;p&gt;在宿主机/tmp/src/mydemo下新建Dockerfile文件，输入以下内容：&lt;br/&gt;&lt;/p&gt;
&lt;pre class=&quot;brush:bash;toolbar:false&quot;&gt;
FROM microsoft/dotnet:2.2-runtime AS base
WORKDIR /app
EXPOSE 80

FROM microsoft/dotnet:2.2-sdk AS publish
WORKDIR /src
COPY . .
RUN dotnet publish -c Release -o /app

FROM base AS final
WORKDIR /app
COPY --from=publish /app .
ENTRYPOINT [&quot;dotnet&quot;, &quot;mydemo.dll&quot;]
&lt;/pre&gt;

&lt;p&gt;该脚本一共分3次，第一次定义了基础镜像，并设置/app为基础工作目录，告知外部80为开放端口&lt;/p&gt;
&lt;p&gt;第二次，将当期目录下的所有文件发送给Docker服务，执行发布过程，将发布输出到/app文件夹下&lt;/p&gt;
&lt;p&gt;第三次，采用第一次的镜像基础作为当期镜像，并将第二次发布输出拷贝到当前基础工作目录/app&lt;/p&gt;
&lt;p&gt;最后设置工作入口，当镜像运行时，执行dotnet mydemo.dll&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/other/360251/201901/360251-20190101232602583-299320897.png&quot; word_img=&quot;file:///C:/Users/Samps/AppData/Local/Programs/blogs51/resources/app.asar/dist/electron/static/editor/neditor/themes/notadd/images/spacer.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;通过docker images命令可以看到刚刚打包出的镜像&lt;br/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/other/360251/201901/360251-20190101232703293-692430683.png&quot; word_img=&quot;file:///C:/Users/Samps/AppData/Local/Programs/blogs51/resources/app.asar/dist/electron/static/editor/neditor/themes/notadd/images/spacer.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;接下来我们尝试将镜像运行起来：&lt;/p&gt;
&lt;pre class=&quot;brush:bash;toolbar:false;&quot;&gt;
docker run -it --name mydemo -p 8002:80 mydemo:v1
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/other/360251/201901/360251-20190101232754972-955617675.png&quot; word_img=&quot;file:///C:/Users/Samps/AppData/Local/Programs/blogs51/resources/app.asar/dist/electron/static/editor/neditor/themes/notadd/images/spacer.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/other/360251/201901/360251-20190101232809583-1178396238.png&quot; word_img=&quot;file:///C:/Users/Samps/AppData/Local/Programs/blogs51/resources/app.asar/dist/electron/static/editor/neditor/themes/notadd/images/spacer.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;成功！&lt;/p&gt;


&lt;p&gt;这次随笔主要介绍了在Docker里面如何运行一个.NET Core项目的Demo，建议大家在学习Docker时，对如何书写Dockerfile多下点功夫，理解里面的基础命令关键词。&lt;/p&gt;

</description>
<pubDate>Tue, 01 Jan 2019 15:32:00 +0000</pubDate>
<dc:creator>蜗牛往前走</dc:creator>
<og:description>前言 博客园中已经有很多如何在Docker里面运行ASP.NET Core的介绍了。本篇主要介绍一些细节，帮助初学的朋友更加深入地理解如何在Docker中运行ASP.NET Core。 安装Docke</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/leafly/p/10188159.html</dc:identifier>
</item>
<item>
<title>redis5.0部署集群环境 - 渣渣辉</title>
<link>http://www.cnblogs.com/Dev0ps/p/10206604.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/Dev0ps/p/10206604.html</guid>
<description>&lt;p&gt;　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　&lt;strong&gt;redis5.0集群部署&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;一、集群介绍&lt;/h3&gt;
&lt;p&gt;Redis 集群是一个可以在多个 Redis 节点之间进行数据共享的设施（installation）。&lt;/p&gt;&lt;p&gt;Redis 集群不支持那些需要同时处理多个键的 Redis 命令， 因为执行这些命令需要在多个 Redis 节点之间移动数据， 并且在高负载的情况下， 这些命令将降低 Redis 集群的性能， 并导致不可预测的行为。&lt;/p&gt;&lt;p&gt;Redis 集群通过分区（partition）来提供一定程度的可用性（availability）： 即使集群中有一部分节点失效或者无法进行通讯， 集群也可以继续处理命令请求。&lt;/p&gt;&lt;p&gt;Redis 集群提供了以下两个好处：&lt;/p&gt;&lt;p&gt;    将数据自动切分（split）到多个节点的能力。&lt;br/&gt;    当集群中的一部分节点失效或者无法进行通讯时， 仍然可以继续处理命令请求的能力。&lt;/p&gt;
&lt;h3&gt;二、Redis 集群数据共享&lt;/h3&gt;
&lt;p&gt;Redis 集群使用数据分片（sharding）而非一致性哈希（consistency hashing）来实现： 一个 Redis 集群包含 16384 个哈希槽（hash slot）， 数据库中的每个键都属于这 16384 个哈希槽的其中一个， 集群使用公式 CRC16(key) % 16384 来计算键 key 属于哪个槽， 其中 CRC16(key) 语句用于计算键 key 的 CRC16 校验和 。&lt;/p&gt;&lt;p&gt;集群中的每个节点负责处理一部分哈希槽。 举个例子， 一个集群可以有三个哈希槽， 其中：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;    节点 A 负责处理 0 号至 5500 号哈希槽。&lt;/li&gt;
&lt;li&gt;    节点 B 负责处理 5501 号至 11000 号哈希槽。&lt;/li&gt;
&lt;li&gt;    节点 C 负责处理 11001 号至 16384 号哈希槽。&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;br/&gt;这种将哈希槽分布到不同节点的做法使得用户可以很容易地向集群中添加或者删除节点。 比如说：&lt;/p&gt;&lt;p&gt;    如果用户将新节点 D 添加到集群中， 那么集群只需要将节点 A 、B 、 C 中的某些槽移动到节点 D 就可以了。&lt;br/&gt;    与此类似， 如果用户要从集群中移除节点 A ， 那么集群只需要将节点 A 中的所有哈希槽移动到节点 B 和节点 C ， 然后再移除空白（不包含任何哈希槽）的节点 A 就可以了。&lt;/p&gt;&lt;p&gt;因为将一个哈希槽从一个节点移动到另一个节点不会造成节点阻塞， 所以无论是添加新节点还是移除已存在节点， 又或者改变某个节点包含的哈希槽数量， 都不会造成集群下线。&lt;/p&gt;
&lt;h3&gt;三、Redis 集群中的主从复制&lt;/h3&gt;
&lt;p&gt;为了使得集群在一部分节点下线或者无法与集群的大多数（majority）节点进行通讯的情况下， 仍然可以正常运作， Redis 集群对节点使用了主从复制功能： 集群中的每个节点都有 1 个至 N 个复制品（replica）， 其中一个复制品为主节点（master）， 而其余的 N-1 个复制品为从节点（slave）。&lt;/p&gt;&lt;p&gt;在之前列举的节点 A 、B 、C 的例子中， 如果节点 B 下线了， 那么集群将无法正常运行， 因为集群找不到节点来处理 5501 号至 11000 号的哈希槽。&lt;/p&gt;&lt;p&gt;另一方面， 假如在创建集群的时候（或者至少在节点 B 下线之前）， 我们为主节点 B 添加了从节点 B1 ， 那么当主节点 B 下线的时候， 集群就会将 B1 设置为新的主节点， 并让它代替下线的主节点 B ， 继续处理 5501 号至 11000 号的哈希槽， 这样集群就不会因为主节点 B 的下线而无法正常运作了。&lt;/p&gt;&lt;p&gt;不过如果节点 B 和 B1 都下线的话， Redis 集群还是会停止运作。&lt;/p&gt;
&lt;h3&gt;四、创建并使用 Redis 集群&lt;/h3&gt;
&lt;p&gt;必须使用六个节点： 其中三个为主节点， 而其余三个则是各个主节点的从节点。否则集群无法正常运行！！&lt;br/&gt;安装过程&lt;/p&gt;&lt;p&gt;1. 下载并解压&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;33&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
cd /root/software
wget http://download.redis.io/releases/redis-5.0.0.tar.gz
tar -zxvf redis-5.0.0.tar.gz　
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;2. 编译安装&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
cd redis-5.0.0
make &amp;amp;&amp;amp; make install
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;3. 将 redis-trib.rb 复制到 /usr/local/bin 目录下&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
cd src
cp redis-trib.rb /usr/local/bin/
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;4. 创建 Redis 节点&lt;/p&gt;&lt;p&gt;首先在 10.90.6.157 机器上 /root/software/redis-5.0.0 目录下创建 redis_cluster 目录；&lt;/p&gt;&lt;p&gt;mkdir redis_cluster　　&lt;/p&gt;&lt;p&gt;在 redis_cluster 目录下，创建名为6379的目录，并将 redis.conf 拷贝到这个目录中&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
mkdir 6379
cp redis.conf redis_cluster/6379　
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;分别修改这三个配置文件，修改如下内容&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
port  6379                                        //端口默认      
#bind 127.0.0.1                                   //注释掉默认ip为127.0.0.1 需要改为其他节点机器可访问的ip 否则创建集群时无法访问对应的端口，无法创建集群
daemonize    yes                                //redis后台运行
pidfile  /var/run/redis_6379.pid               //pidfile文件对应6379
cluster-enabled  yes                           //开启集群  把注释#去掉
cluster-config-file  nodes_6379.conf         //集群的配置  配置文件首次启动自动生成 6379
cluster-node-timeout  15000                //请求超时  默认15秒，可自行设置
appendonly  yes                           //aof日志开启  有需要就开启，它会每次写操作都记录一条日志　
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;集群的完整配置文件如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
protected-mode no
port 6379
tcp-backlog 511
timeout 0
tcp-keepalive 300
daemonize yes
supervised no
pidfile /var/run/redis_6379.pid
loglevel notice
logfile &quot;&quot;
databases 16
always-show-logo yes
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir ./
replica-serve-stale-data yes
replica-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-disable-tcp-nodelay no
replica-priority 100
lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
replica-lazy-flush no
appendonly yes
appendfilename &quot;appendonly.aof&quot;
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble yes
lua-time-limit 5000
cluster-enabled yes
cluster-config-file nodes-6379.conf
cluster-node-timeout 15000
slowlog-log-slower-than 10000
slowlog-max-len 128
latency-monitor-threshold 0
notify-keyspace-events &quot;&quot;
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000
stream-node-max-bytes 4096
stream-node-max-entries 100
activerehashing yes
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60
hz 10
dynamic-hz yes
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Redis 官方提供了 redis-trib.rb 这个工具是用 ruby 实现的，所以需要安装 ruby。安装命令如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
yum -y install ruby ruby-devel rubygems rpm-build
gem install redis 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中 gem install redis命令执行时出现了：&lt;/p&gt;&lt;p&gt; redis requires Ruby version &amp;gt;= 2.2.2的报错，查了资料发现是Centos默认支持ruby到2.0.0，可gem 安装redis需要最低是2.2.2&lt;/p&gt;&lt;p&gt;解决办法是 先安装rvm，再把ruby版本提升至2.3.3&lt;/p&gt;&lt;p&gt;1.安装curl&lt;/p&gt;&lt;p&gt;sudo yum install curl&lt;/p&gt;&lt;p&gt;2. 安装RVM&lt;/p&gt;&lt;p&gt;curl -L get.rvm.io | bash -s stable&lt;/p&gt;&lt;p&gt;3.&lt;/p&gt;&lt;p&gt;source /usr/local/rvm/scripts/rvm&lt;/p&gt;&lt;p&gt;4. 查看rvm库中已知的ruby版本&lt;/p&gt;&lt;p&gt;rvm list known&lt;/p&gt;&lt;p&gt;5. 安装一个ruby版本&lt;/p&gt;&lt;p&gt;rvm install 2.3.3&lt;/p&gt;&lt;p&gt;6. 使用一个ruby版本&lt;/p&gt;&lt;p&gt;rvm use 2.3.3&lt;/p&gt;&lt;p&gt;7. 设置默认版本&lt;/p&gt;&lt;p&gt;rvm remove 2.0.0&lt;/p&gt;&lt;p&gt;8. 卸载一个已知版本&lt;/p&gt;&lt;p&gt;ruby --version&lt;/p&gt;&lt;p&gt;9. 再安装redis就可以了&lt;br/&gt;gem install redis&lt;/p&gt;&lt;p&gt;好了，重复以上的安装步凑把剩下的5个节点部署好！！！&lt;/p&gt;&lt;p&gt;10.创建集群&lt;br/&gt;在6个节点中执行以下命令启动redis：&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
src/redis-server ./redis_cluster/6379/redis.conf &amp;amp;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在1个节点上执行以下创建集群命令：&lt;br/&gt;src/redis-cli --cluster create 10.90.6.156:6379 10.90.6.157:6379 10.90.6.158:6379 10.90.6.159:6379 10.90.6.160:6379 10.90.6.161:6379 --cluster-replicas 1&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
[root@Redis1 redis-5.0.0]# src/redis-cli --cluster create 10.90.6.156:6379 10.90.6.157:6379 10.90.6.158:6379 10.90.6.159:6379 10.90.6.160:6379 10.90.6.161:6379 --cluster-replicas 1
&amp;gt;&amp;gt;&amp;gt; Performing hash slots allocation on 6 nodes...
Master[0] -&amp;gt; Slots 0 - 5460
Master[1] -&amp;gt; Slots 5461 - 10922
Master[2] -&amp;gt; Slots 10923 - 16383
Adding replica 10.90.6.159:6379 to 10.90.6.156:6379
Adding replica 10.90.6.160:6379 to 10.90.6.157:6379
Adding replica 10.90.6.161:6379 to 10.90.6.158:6379
M: ddebff330f23552db26eadb51c4f9926473cb485 10.90.6.156:6379
   slots:[0-5460] (5461 slots) master
M: 4256ffaa3ad3d1c8ad3174898f97114629922a8e 10.90.6.157:6379
   slots:[5461-10922] (5462 slots) master
M: 9b7c727852f4bde936b8bb8f6cbda2cf621b7c9b 10.90.6.158:6379
   slots:[10923-16383] (5461 slots) master
S: e52195f35519ac8c360b008a354415ad39190027 10.90.6.159:6379
   replicates ddebff330f23552db26eadb51c4f9926473cb485
S: 06d022e927a8f166cd08e333e8723d4c5b5a1092 10.90.6.160:6379
   replicates 4256ffaa3ad3d1c8ad3174898f97114629922a8e
S: b57ebc5c247f01e9e35cf798bd6932bdaee04098 10.90.6.161:6379
   replicates 9b7c727852f4bde936b8bb8f6cbda2cf621b7c9b
Can I set the above configuration? (type 'yes' to accept): yes
&amp;gt;&amp;gt;&amp;gt; Nodes configuration updated
&amp;gt;&amp;gt;&amp;gt; Assign a different config epoch to each node
&amp;gt;&amp;gt;&amp;gt; Sending CLUSTER MEET messages to join the cluster
Waiting for the cluster to join
..
&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check (using node 10.90.6.156:6379)
M: ddebff330f23552db26eadb51c4f9926473cb485 10.90.6.156:6379
   slots:[0-5460] (5461 slots) master
   1 additional replica(s)
S: b57ebc5c247f01e9e35cf798bd6932bdaee04098 10.90.6.161:6379
   slots: (0 slots) slave
   replicates 9b7c727852f4bde936b8bb8f6cbda2cf621b7c9b
S: e52195f35519ac8c360b008a354415ad39190027 10.90.6.159:6379
   slots: (0 slots) slave
   replicates ddebff330f23552db26eadb51c4f9926473cb485
S: 06d022e927a8f166cd08e333e8723d4c5b5a1092 10.90.6.160:6379
   slots: (0 slots) slave
   replicates 4256ffaa3ad3d1c8ad3174898f97114629922a8e
M: 4256ffaa3ad3d1c8ad3174898f97114629922a8e 10.90.6.157:6379
   slots:[5461-10922] (5462 slots) master
   1 additional replica(s)
M: 9b7c727852f4bde936b8bb8f6cbda2cf621b7c9b 10.90.6.158:6379
   slots:[10923-16383] (5461 slots) master
   1 additional replica(s)
[OK] All nodes agree about slots configuration.
&amp;gt;&amp;gt;&amp;gt; Check for open slots...
&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
[OK] All 16384 slots covered.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果报错，请看下面！！&lt;br/&gt;&lt;span&gt;[root@Redis1 redis-5.0.0]# src/redis-cli --cluster create 10.90.6.156:6379 10.90.6.157:6379 10.90.6.158:6379 10.90.6.159:6379 10.90.6.160:6379 10.90.6.161:6379 --cluster-replicas 1&lt;/span&gt;&lt;br/&gt;&lt;span&gt;[ERR] Node 10.90.6.157:6379 is not empty. Either the node already knows other nodes (check with CLUSTER NODES) or contains some key in database 0.&lt;/span&gt;&lt;br/&gt;的问题&lt;br/&gt;解决办法：&lt;br/&gt;1)将每个节点下aof、rdb、nodes.conf本地备份文件删除；&lt;br/&gt;[root@redis-5.0.0]# rm -fr appendonly.aof dump.rdb nodes-*^C&lt;br/&gt;[root@redis-5.0.0]# pwd&lt;br/&gt;/fs01/redis-5.0.0&lt;br/&gt;2)10.90.6.157:6379&amp;gt; flushdb #清空当前数据库&lt;br/&gt;3)之后再执行脚本，成功执行；&lt;br/&gt;这里解释一下dump.rdb文件：&lt;br/&gt;dump.rdb是由Redis服务器自动生成的 默认情况下 每隔一段时间redis服务器程序会自动对数据库做一次遍历，把内存快照写在一个叫做“dump.rdb”的文件里，这个持久化机制叫做SNAPSHOT。有了SNAPSHOT后，如果服务器宕机，重新启动redis服务器程序时redis会自动加载dump.rdb，将数据库状态恢复到上一次做SNAPSHOT时的状态。&lt;br/&gt;SNAPSHOT即快照&lt;br/&gt;重新连接redis集群，成功&lt;/p&gt;&lt;p&gt;8. 集群验证&lt;br/&gt;在一台机器上连接方式为 redis-cli -h  -c 10.90.6.157 ,加参数 -c 可连接到集群，因为上面 redis.conf 将 bind 改为了ip地址，所以 -h 参数不可以省略。&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:python;gutter:true;&quot;&gt;
[root@Redis2 src]# ./redis-cli -c -h 10.90.6.157
10.90.6.157:6379&amp;gt; get hello
&quot;2&quot;
10.90.6.157:6379&amp;gt; 
&lt;/pre&gt;&lt;/div&gt;


</description>
<pubDate>Tue, 01 Jan 2019 15:29:00 +0000</pubDate>
<dc:creator>渣渣辉</dc:creator>
<og:description>redis5.0集群部署 一、集群介绍 Redis 集群是一个可以在多个 Redis 节点之间进行数据共享的设施（installation）。Redis 集群不支持那些需要同时处理多个键的 Redis</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/Dev0ps/p/10206604.html</dc:identifier>
</item>
<item>
<title>汇编笔记_第十二章 - 31415926535x</title>
<link>http://www.cnblogs.com/31415926535x/p/10206507.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/31415926535x/p/10206507.html</guid>
<description>&lt;hr/&gt;&lt;p&gt;title: 汇编笔记_第十二章&lt;br/&gt;date: 2019-01-01 18:49:05&lt;br/&gt;tags:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;笔记&lt;br/&gt;categories:&lt;/li&gt;
&lt;li&gt;
&lt;h2 id=&quot;汇编语言&quot;&gt;汇编语言&lt;/h2&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;中断的产生&quot;&gt;中断的产生&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;中断&lt;/strong&gt;：&lt;br/&gt;中断分为 &lt;em&gt;软件中断&lt;/em&gt; 和 &lt;em&gt;硬件中断&lt;/em&gt;，前者又称为内中断后者又称为外部中断；&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;软件中断&lt;/strong&gt;： 由CPU内部的某些事件引起的，不受中断允许标志IF的控制。包括：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;由终端指令 &lt;code&gt;int n&lt;/code&gt; 引起，n指出中断类型&lt;/li&gt;
&lt;li&gt;由CPU的某些错误引起，除法错中断（类型号0）、溢出中断（类型号4）&lt;/li&gt;
&lt;li&gt;为调试程序Debug设置的中断，单步中断（类型号1）、断点中断（类型号3）&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;硬件中断&lt;/strong&gt;： 由输入输出外设产生的中断请求引起的中断。&lt;br/&gt;8086系统的硬件中断可分为 &lt;em&gt;可屏蔽中断&lt;/em&gt; 和 &lt;em&gt;不可屏蔽中断&lt;/em&gt;。所有的中断请求都有对应的中断处理子程序与之对应；&lt;/p&gt;
&lt;p&gt;补充：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;内中断中，int n和into指令产生的中断以及出发错中断都不能被禁止，并且比任何外部中断的优先级都高；&lt;/li&gt;
&lt;li&gt;8086系统的硬件中断都是通过CPU的引脚引入中断请求型号，不可屏蔽中断请求信号接到CPU的NMI引脚上，当发生电源故障，奇偶检验错，io通道校验错等紧急情况时有系统自动产生，NMI不可屏蔽中断的类型号为2；&lt;/li&gt;
&lt;li&gt;可屏蔽中断是键盘、显示器、打印机、磁盘、串口、并口等外设发出的。由于可屏蔽中断种类较多，系统专门有8259A中断控制器来管理这些中断。可屏蔽中断指这些外设可以用软件设置允许或禁止器发出中断请求。8086可屏蔽中断的中断类型号为08H~0FH；&lt;/li&gt;
&lt;li&gt;优先级由高到低：内部中断-非屏蔽中断-可屏蔽中断-单步中断；&lt;/li&gt;
&lt;li&gt;硬件中断时，CPU执行完一条指令后都会读取INTR引脚信号；&lt;/li&gt;
&lt;li&gt;软件中断时，若为0-4号中断，CPU按相应的方式处理，如果是int n指令，则由n获取中断向量转而执行中断处理程序；&lt;/li&gt;
&lt;li&gt;单步中断是int 1(TF=1)；&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;中断处理程序&quot;&gt;中断处理程序&lt;/h2&gt;
&lt;p&gt;CPU的设计者必须在中断信息和其处理程序的入口地址之间建立某种联系，使得CPU可以根据中断信息可以找到哟啊执行的处理程序；&lt;/p&gt;
&lt;h2 id=&quot;中断类型和中断向量表&quot;&gt;中断类型和中断向量表&lt;/h2&gt;
&lt;p&gt;8086提供了256个中断类型，类型号为0~FFH；&lt;/p&gt;
&lt;p&gt;CPU用8位的中断类型码通过中断向量表找到相应的中断处理程序的入后地址；&lt;/p&gt;
&lt;p&gt;用中断类型码找到中断向量，并用它设置CS和IP，这个工作是由CPU的硬件自动完成的，这个过程称为 &lt;strong&gt;中断过程&lt;/strong&gt;；&lt;/p&gt;
&lt;p&gt;8086中专门建立了一张中断向量表用于保存所有的中断向量。表位于内存最低地址区0开始的1KB单元。每个中断向量占用4个字节，高位放段地址，低位放偏移地址；&lt;/p&gt;
&lt;p&gt;中断向量表的地址为：00000H~003FCH；&lt;/p&gt;
&lt;p&gt;其中，&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;5个专用中断&lt;/strong&gt;：类型0中断（出发出错）00000H~00003H，保存ip和cs内容、类型1中断（单步中断）00004H~00007H、类型2中断（NMI）00008H~0000BH、类型3中断（断点中断）0000CH~0000FH、类型4中断（溢出中断）00010H~00013H；&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;27个系统保留中断&lt;/strong&gt;：类型5中断~类型31中断00014H~0007FH；&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;224个用户自定义中断&lt;/strong&gt;： 类型32中断~类型255中断00080H~003FCH；&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;中断过程&quot;&gt;中断过程&lt;/h2&gt;
&lt;p&gt;8086CPU的中断过程：&lt;/p&gt;
&lt;p&gt;1、取得中断类型码&lt;/p&gt;
&lt;p&gt;2、标志寄存器的指入栈&lt;/p&gt;
&lt;p&gt;3、设置标志寄存器的第8位TF和第9位IF的值0&lt;/p&gt;
&lt;p&gt;4、CS的内容入栈&lt;/p&gt;
&lt;p&gt;5、IP的内容入栈&lt;/p&gt;
&lt;p&gt;6、从内存地址位中断类型码*4和中断类型码*4+2的两个字的单元中读取中断处理程序的入口地址设置IP和CS&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;在使用call指令调用子程序时有同样的问题，子程序执行后还要返回到原来的执行点继续执行，所以，call指令先保存当前CS和IP值，然后设置CS和IP跳转；&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;中断处理程序和iret指令&quot;&gt;中断处理程序和iret指令&lt;/h2&gt;
&lt;p&gt;CPU要随时都可能执行中断程序，所以中断处理程序必须一直在内存的某段空间中；同时，中断程序的入口地址，即中断向量必须储存在对应的中断向量表表项中；&lt;/p&gt;
&lt;p&gt;中断处理程序的编写方法：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1、保存用到的寄存器&lt;/li&gt;
&lt;li&gt;2、处理中断&lt;/li&gt;
&lt;li&gt;3、恢复用到的寄存器&lt;/li&gt;
&lt;li&gt;4、用 &lt;code&gt;iret&lt;/code&gt; 指令返回&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;iret指令的功能用汇编语法描述为：&lt;/p&gt;
&lt;pre class=&quot;armasm&quot;&gt;
&lt;code&gt;pop IP
pop CS
popf&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;iret通常和硬件自动完成的中断程序配合使用；&lt;/p&gt;
&lt;p&gt;入栈的顺序时标志寄存器、CS、IP，和iret的出栈相反；&lt;/p&gt;
&lt;h2 id=&quot;编写处理0号中断&quot;&gt;编写处理0号中断&lt;/h2&gt;
&lt;p&gt;当发生出发溢出时，CPU将进行以下工作：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1、取得中断类型码0&lt;/li&gt;
&lt;li&gt;2、标志寄存器入栈，TF、IF设置为0&lt;/li&gt;
&lt;li&gt;3、CS、IP入栈&lt;/li&gt;
&lt;li&gt;4、(IP)=(0*4),(CS)=(0*4+2)&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;中断处理程序do0，只需显示&quot;overflow!&quot;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1、相关处理&lt;/li&gt;
&lt;li&gt;2、向显示缓冲区送入字符串&quot;overflow!&quot;&lt;/li&gt;
&lt;li&gt;3、返回dos&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;因为除法溢出随时可能发生，CPU随时可能将cs:ip指向do0的入口，执行程序，所以为了简单可以将中断处理程序do0放到中断向量表的0000:0200处；&lt;/p&gt;
&lt;p&gt;所以最后的处理是；&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1、编写可以显示&quot;overflow!&quot;的中断程序do0；&lt;/li&gt;
&lt;li&gt;2、将do0送到内存0000:0200处&lt;/li&gt;
&lt;li&gt;3、将do0的入口地址0000:0200存储在中断向量表0号表项中&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;大致的框架：&lt;/p&gt;
&lt;pre class=&quot;armasm&quot;&gt;
&lt;code&gt;assume cs:code
code segment
start:
    do0安装程序
    设置中断向量表
    mov ax,4c00h
    int 21h

do0:
    显示字符串:&quot;overflow!&quot;
    mov ax,4c00h
    int 21h
;do0程序在这段程序中并不执行，只是作为数据传送到中断向量表中，即安装程序
code ends
end start&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;安装&quot;&gt;安装&lt;/h2&gt;
&lt;p&gt;中断程序的安装可以使用 &lt;code&gt;rep movsb&lt;/code&gt; 来将do0的代码送入到0000:0200处；&lt;/p&gt;
&lt;p&gt;大致框架：&lt;/p&gt;
&lt;pre class=&quot;armasm&quot;&gt;
&lt;code&gt;assume cs:code
code segment
start:
    设置es:di指向目的地址
    设置ds:si指向源地址
    设置cx的长度
    设置传送方向为正
    rep movsb

    设置中断向量表

    mov ax,4c00h
    int 21h

do0:
    显示字符串:&quot;overflow!&quot;
    mov ax,4c00h
    int 21h

code ends
end start&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;使用 &lt;code&gt;rep movsb&lt;/code&gt; 要确定的信息：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;目的地址：0000:0200&lt;/li&gt;
&lt;li&gt;源地址：code:offset do0&lt;/li&gt;
&lt;li&gt;传送的长度cx: do0的代码的长度&lt;/li&gt;
&lt;li&gt;传送方向为正： &lt;code&gt;cld&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;因为do0的长度根据不同的序求需求会改变，没有必要每一次都计算，可以在最后加一个 &lt;code&gt;do0end:nop&lt;/code&gt;，这样 &lt;code&gt;mov cx,offset do0end-offset do0&lt;/code&gt;即可，&quot;-&quot;是编译器识别的运算符号，编译器可以用它来进行两个 &lt;strong&gt;常数&lt;/strong&gt; 的减法，同时，也可以处理表达式；&lt;/p&gt;
&lt;p&gt;最后的安装程序：&lt;/p&gt;
&lt;pre class=&quot;armasm&quot;&gt;
&lt;code&gt;assume cs:code
code segment
start:
    mov ax,0
    mov es,ax
    mov di,0200h        ;目的地址
    mov ax,cs
    mov ds,ax
    mov si,offset do0   ;源地址
    mov cx,offset do0end-offset do0
    cld
    rep movsb

    设置中断向量表

    mov ax,4c00h
    int 21h

do0:
    显示字符串:&quot;overflow!&quot;
    mov ax,4c00h
    int 21h
do0end:nop

code ends
end start&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;do0&quot;&gt;do0&lt;/h2&gt;
&lt;p&gt;do0的任务是显示字符串，大致的框架：&lt;/p&gt;
&lt;pre class=&quot;armasm&quot;&gt;
&lt;code&gt;do0:
    设置ds:si指向字符串
    mov ax,0b800h
    mov es,ax
    mov di,12*160+36*2
    ;设置es:di指向显存空间中间位置

    mov cx,9    ;设置cx为字符串长度
  s:
    mov al,[si]
    mov es:[di],al
    inc si
    add di,2
    loop s

    mov ax,4c00h
    int 21h

do0end:nop&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;这里的字符串的存放不能像之前的程序那样放在总程序的数据段中，因为当总程序运行完后数据段也就释放，不能保证中断程序所显示的字符串还是&quot;overflow!&quot;；&lt;/p&gt;
&lt;p&gt;所以要将字符串放在do0中，将其以通送到中断向量表的0000:0200处；&lt;/p&gt;
&lt;p&gt;这样在发生除法溢出时，cs中存放的是do0的段地址，同时也是字符串的段地址，而因为程序要跳过字符串，不把他当作代码执行，所以在字符串之前要有一个jmp指令跳过字符串到实际的代码处，所以字符串的偏移地址就为0000:0200加2即0000:0202处（jmp占两个字节）&lt;/p&gt;
&lt;p&gt;最后的程序：&lt;/p&gt;
&lt;pre class=&quot;armasm&quot;&gt;
&lt;code&gt;do0:
    jmp short do0start
    db &quot;overflow!&quot;

do0start:
    mov ax,cs
    mov ds,ax
    mov si,0202h
    ;设置ds:si指向字符串

    mov ax,0b800h
    mov es,ax
    mov di,12*160+36*2
    
    mov cx,9

  s:
    mov al,[si]
    mov es:[di],al
    inc si
    add di,2
    loop s

    mov ax,4c00h
    int 21h

do0end:nop&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;设置中断向量&quot;&gt;设置中断向量&lt;/h2&gt;
&lt;p&gt;设置中断向量即为将do0的入后地址0000:0200写入到中断向量表的0号表项中，使do0成为0号中断的中断处理程序；&lt;/p&gt;
&lt;p&gt;0号表项的地址为0:0，其中0:0字单元存放偏移地址(ip)，0:2字单元存放段地址(cs)，&lt;/p&gt;
&lt;pre class=&quot;armasm&quot;&gt;
&lt;code&gt;mov ax,0
mov es,ax
mov word ptr es:[0*4],0200h
mov word ptr es:[0*4+2],0&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;综上，最后的程序如下：&lt;/p&gt;
&lt;pre class=&quot;armasm&quot;&gt;
&lt;code&gt;assume cs:code
code segment
start:
    mov ax,0
    mov es,ax
    mov di,0200h
    mov ax,cs
    mov ds,ax
    mov si,offset do0
    mov cx,offset do0end-offset do0
    cld
    rep movsb
    
    mov ax,0
    mov es,ax
    mov word ptr es:[0*4],0200h
    mov word ptr es:[0*4+2],0
    
    mov ax,1000h
    mov bh,1
    div bh
    
    mov ax,4c00h
    int 21h
    
do0:
    jmp short do0start
    db &quot;overflow!&quot;
do0start:
    mov ax,cs
    mov ds,ax
    mov si,202h
    
    mov ax,0b800h
    mov es,ax
    mov di,12*160+36*2
    
    mov cx,9
    
  s:
    mov al,[si]
    mov es:[di],al
    inc si
    add di,2
    loop s
    
    mov ax,4c00h
    int 21h
    
do0end:nop

code ends
end start&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;单步中断&quot;&gt;单步中断&lt;/h2&gt;
&lt;p&gt;CPU在执行完一条指令后，如果检测到标志寄存器的TF位为1，则产生单步中断，单步中断的中断类型码为1；&lt;/p&gt;
&lt;p&gt;他引发的中断类型如下：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1、取得中断类型码1&lt;/li&gt;
&lt;li&gt;标志寄存器入栈，TF、IF置0&lt;/li&gt;
&lt;li&gt;CS，IP入栈&lt;/li&gt;
&lt;li&gt;(IP)=(1&lt;em&gt;4),(CS)=(1&lt;/em&gt;4+2)&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;使用t命令时，debug将TF设置为1，使得cpu执行完这条指令后引发单步中断；&lt;/p&gt;
&lt;p&gt;执行单步中断的中断程序，所有寄存器的内容显示，等待输入；&lt;/p&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;中断处理程序也是由一条条指令组成的，如果在执行中断处理程序之前，TF=1，则CPU在执行完中断处理程序的第一条指令后，又要产生单步中断，则又要转去执行单步中断的中断处理程序…… ?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;解决方法是在进入中断程序之前设置TF=0，也就是在前面说的中断过程中的第二步标志寄存器入栈后设置TF=0的原因；&lt;/p&gt;
&lt;p&gt;CPU提供单步中断功能的原因就是，为单步跟踪的执行过程，提供了实现机制。&lt;/p&gt;
&lt;h2 id=&quot;响应中断的特殊情况&quot;&gt;响应中断的特殊情况&lt;/h2&gt;
&lt;p&gt;有些情况下，CPU在执行完当前指令后，即使发生中断，也不相应，例如：在执行完向ss寄存器传送数据的指令后，发生中断时，CPU也不会响应，因为，ss:sp联合指向栈顶，对他们的设置应该连续完成；&lt;/p&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;如果在执行完设置ss的指令后，CPU响应中断，引发中断过程，要在栈中压入标志寄存器、CS和IP的值。&lt;br/&gt;而ss改变，sp并未改变，ss:sp指向的不是正确的栈顶，将引起错误。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;所以CPU在执行完设置ss的指令后，不响应中断。&lt;br/&gt;这给连续设置 ss和sp，指向正确的栈顶提供了一个时机。&lt;br/&gt;即，我们应该利用这个特性，将设置ss和sp的指令连续存放，使得设置sp的指令紧接着设置ss的指令执行，而在此之间，CPU不会引发中断过程&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;解释了实验2中的（3）&lt;/em&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;Debug 利用单步中断来实现T命令的功能，&lt;br/&gt;也就是说，用T命令执行一条指令后，CPU响应单步中断，执行Debug设置好的处理程序，才能在屏幕上显示寄存器的状态，并等待命令的输入。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;而在mov ss,ax指令执行后，CPU根本就不响应任何中断，其中也包括单步中断，&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;所以Debug设置好的用来显示寄存器状态和等待输入命令的中断处理程序根本没有得到执行，所以我们看不到预期的结果。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;CPU接着向下执行后面的指令mov sp,10h，然后响应单步中断，我们才看到正常的结果&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;（以上引用来自汇编老师的课件，转载请注明地址）&lt;br/&gt;&lt;a href=&quot;https://www.cnblogs.com/31415926535x/p/10206507.html&quot; class=&quot;uri&quot;&gt;https://www.cnblogs.com/31415926535x/p/10206507.html&lt;/a&gt;&lt;br/&gt;(end)&lt;/p&gt;
</description>
<pubDate>Tue, 01 Jan 2019 15:04:00 +0000</pubDate>
<dc:creator>31415926535x</dc:creator>
<og:description>title: 汇编笔记_第十二章 date: 2019 01 01 18:49:05 tags: 笔记 categories: 汇编语言 内中断 中断的产生 中断 ： 中断分为 软件中断 和 硬件中断</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/31415926535x/p/10206507.html</dc:identifier>
</item>
<item>
<title>设计，架构，框架之间是什么关系？ - YOYO&amp;#</title>
<link>http://www.cnblogs.com/skyesx/p/10206455.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/skyesx/p/10206455.html</guid>
<description>&lt;p&gt;设计(design)、架构(architechure)、框架 (framework)之间是个什么关系？请描述一下？&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/317990/201901/317990-20190101224517918-113693919.png&quot;/&gt;&lt;/p&gt;

&lt;p&gt;在探讨题目问题之前，我们从设计开始聊聊。&lt;/p&gt;
&lt;p&gt;其实我们每个人都在做设计，无论我们是在哪个行业，哪个层次，哪个职位。&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;画家作画时会画草图做设计&lt;/li&gt;
&lt;li&gt;作家写作时会列提纲做设计&lt;/li&gt;
&lt;li&gt;程序员编码时会写伪代码做设计&lt;/li&gt;
&lt;li&gt;清洁工扫地时会在脑海里设计扫地的执行路径&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;对于软件系统领域来说：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;在方法层次，我们可以设计方法名、变量名、语句块使得方法变得易懂、简洁、高效；&lt;/li&gt;
&lt;li&gt;在类的层次，我们可以设计其方法、成员变量、静态变量、继承关系及可见性级别等，使得一个类能更好地抽象与封装，方便其他人使用；&lt;/li&gt;
&lt;li&gt;在包的层次我们可以设计规划各个模块代码的位置，方便我们能快速找到对应的代码；&lt;/li&gt;
&lt;li&gt;在服务层次我们可以设计服务的粒度，暴露的功能，交流的协议，以方便服务间持续的交互；&lt;/li&gt;
&lt;li&gt;在系统层次我们可以通过设计系统暴露的功能、协作的形式以完成系统层次的协作；&lt;/li&gt;
&lt;li&gt;再往上依然存在需要设计的层级，如多个软件系统间协作完成的一个大的软件系统，但每个公司对此叫法可能不一样；&lt;/li&gt;
&lt;li&gt;软件系统再往上也有层级，但其可能就是人类自身的系统了。&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;这里各个层次的设计都有一个朴素的设计理念，那就是 &lt;strong&gt;&lt;em&gt;提供抽象接口以此与外围交互、封装具体变化以此在内部独立演进&lt;/em&gt;&lt;/strong&gt;。这个是我们完成某项复杂任务而组织的大型工程里的一个基础理念。&lt;/p&gt;
&lt;p&gt;刚刚讲的是软件系统领域的设计，但其可扩展到各个领域，如人的系统、建筑的系统、小说的系统等等。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/317990/201901/317990-20190101224536328-501663936.png&quot;/&gt;&lt;/p&gt;

&lt;p&gt;当然，进行高层设计的人能融汇贯通其相关底层子系统的知识当然最好，但是大多数情况下，我们做不到，因为我们现在组织的系统的层级太多太深了。&lt;/p&gt;
&lt;p&gt;举个例子，我们设计的业务代码在编译后能借助操作系统的能力协调CPU、内存及IO一起完成业务代码的执行，但是设计业务代码的人，不一定能知道CPU的流水线是怎么运作的、内存屏障是如何协调多个核心与内存的、数据具体是怎么传输到其他机器的。&lt;/p&gt;
&lt;p&gt;再举个例子，某个大型公司CEO可能不懂编码，但其手下有不同类型的大将，包括懂技术的人才，因此CEO只要组织设计一个团体能覆盖其知识盲点，就能管理好整个公司，包括整个公司的各类软件系统。&lt;/p&gt;
&lt;p&gt;从上面我们可以看到在做高层设计与做底层设计的人的能力是无法直接比较的，因为他们的能力栈可能完全不一样，无法简单地进行比较。&lt;/p&gt;
&lt;p&gt;但通常的套路下，做高层设计的都是从底层设计的人才中转岗（叫提拔、晋升不一定合适，有时候底层设计的人才更为稀缺）而来的，因为只有你的设计能力在影响不那么大的层次经过验证后，才放心让你到更高层次进行设计。&lt;/p&gt;

&lt;p&gt;实际上架构是一种设计。&lt;/p&gt;
&lt;p&gt;架构设计规定了主要组件间一些较大层次的约束与规范，一些较小层次的设计在这些约束与规范下进行的话，能最大限度地满足某些方面的特性，如可阅读性、可靠性、可扩展性、安全性等等。&lt;/p&gt;
&lt;p&gt;举个例子，我们在设计一个屋子的时候，房间、厅、厨房等可以想象为架构，我们在进行软装的时候，是不能改变原有的设计的，不然随便敲墙容易造成安全隐患。但我们能控制软装的，形成风格各异的房间。&lt;/p&gt;
&lt;p&gt;当然，设计层次的大小是相对的。在刚刚例子里一个屋子里的房间布局是架构。但往上看，在一个街区的架构设计里，一个屋子的内部房间布局仅仅只是一个较小层次的设计，其不会影响整个街区的规划。&lt;/p&gt;
&lt;p&gt;因此，&lt;strong&gt;架构这一个词，应该存在于各个层次&lt;/strong&gt;。就像我们在写代码时，运用各种设计模式，如责任链等，规定编写代码所使用的方式，以开闭原则保证代码稳定性及可阅读性时，我们就已经是这段可扩展的代码的架构师了。&lt;/p&gt;

&lt;p&gt;框架是架构的一种实现。&lt;/p&gt;
&lt;p&gt;例如MVC这种架构设计（架构是每个层次都存在的），分离了不同类型代码的关注点，使得代码更为清晰及更易维护。&lt;/p&gt;
&lt;p&gt;而各类MVC框架则实现了这种架构，只要我们基于这个框架扩展实现我们的代码，那么我们就能写出符合MVC架构规范的代码。&lt;/p&gt;
&lt;p&gt;同时，在这里我们需要额外理清楚的一件事情是框架（framework）与库（library）的区别。我觉得以下这幅图很好地说明了这个区别。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/317990/201901/317990-20190101224548809-1433093446.png&quot;/&gt;&lt;/p&gt;

&lt;ul&gt;&lt;li&gt;为了完成某件事情，无论我们身处哪个职位，都需要进行设计；&lt;/li&gt;
&lt;li&gt;一个设计可以包含多个其他人负责的子设计，你的设计也可能是其他人设计的一部分；&lt;/li&gt;
&lt;li&gt;要完成一个复杂的任务，按层级拆分设计是一个常用的方法；&lt;/li&gt;
&lt;li&gt;为了底层设计实现的可控，达到我们预期的某些效果，我们要对设计进行规范与限制，这称为架构，这也是一种设计；&lt;/li&gt;
&lt;li&gt;就像设计有很多层次一样，架构也有很多的层次；&lt;/li&gt;
&lt;li&gt;框架是架构的具体实现，利用框架，并在框架/架构的约束下进行扩展/编码能加速我们代码的实现&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;本文是基于目前个人理解而成，若文章有谬误，望不吝批评斧正；若本文对大家有所帮助，望不吝&lt;strong&gt;&lt;em&gt;点赞&lt;/em&gt;&lt;/strong&gt;。&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s/WOPAnyssa_iUvbQOwGzF7A&quot;&gt;你知道如何画好一幅架构图么？&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;多年金融码农，现为某信用卡中心架构师，EasyTransaction作者，欢迎关注&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/317990/201901/317990-20190101224501936-1441067172.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ref:&lt;/p&gt;
</description>
<pubDate>Tue, 01 Jan 2019 14:47:00 +0000</pubDate>
<dc:creator>YOYO&amp;amp;#</dc:creator>
<og:description>设计(design)、架构(architechure)、框架 (framework)之间是个什么关系？请描述一下？ 每个人都在进行设计 在探讨题目问题之前，我们从设计开始聊聊。 其实我们每个人都在做设</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/skyesx/p/10206455.html</dc:identifier>
</item>
<item>
<title>2018年终总结 - 后天星期天</title>
<link>http://www.cnblogs.com/sunday294/p/10206352.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/sunday294/p/10206352.html</guid>
<description>



&lt;p&gt;&lt;span&gt;回顾自己这一年的时间里，有非常多的感慨。因为这一年里对我来说意义不凡，或者说跌宕起伏。从&lt;/span&gt;17年底开始至今年年初，一切都发展得太顺利了、有时候甚至都会感觉所有的事情都在按照自己的剧本走...&lt;/p&gt;
&lt;p&gt; 一切都太顺利了，顺利得可怕。然而最坏的情况发生了、因为胜利的果实品尝太多，导致我的自信心开始爆棚，整个人都变得很膨胀。自膨胀那一刻起，我已经慢慢地被情绪所控制，被自己的人性所吞噬。&lt;/p&gt;

&lt;h3&gt;&lt;span&gt;&lt;span&gt;挫败感是个好东西、只有尝过各种不同的失败后换来的成功，才是来之不易的，才是真正能守得住的。同理也有这么个说法&lt;/span&gt;: &lt;span&gt;毁掉一个人最好的方法是让他挣快钱。&lt;/span&gt;         &lt;/span&gt;&lt;/h3&gt;

&lt;p&gt;&lt;span&gt;被情绪化控制是非常可怕的，可怕到自己每走一步，都不在会去&lt;/span&gt;&lt;strong&gt;'怀疑'自己和'猜疑'自己、没有胜率和预估，也没有了谨慎&lt;/strong&gt;。这是非常可怕的，到这种情况下的人，每走一步都是兵行险招，自然而然地’赌博’就变成了自己的代名词、自己走的每一步都是在赌博。&lt;/p&gt;

&lt;p&gt;&lt;span&gt;最坏的事情发生了、非常膨胀的我做出了一个决定，将自己&lt;/span&gt;40%的资金投入到了一个道听途说的坑B项目中，当时自我感觉还非常良好，一度的觉得自己要大赚一笔了。为什么说是道听途说呢，因为我自己对这个项目连个最基本的基本面都没有一丝了解，光听别人吹牛。&lt;span&gt;时隔不久，我又做出了一个神操作、将自己剩余的&lt;/span&gt;60%资金，全部All IN到另一个项目当中。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;都说对待金融市场应该保持一颗敬畏的心，果然没错。就在我&lt;/span&gt;All IN不久后，大概在4月份前后，整体大盘下跌，一下子浮亏超过70%，但是就还在那时，我的心依然平静、始终还是认为自己是对的，认为现状的维持只是短期。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;时间很快，转眼&lt;/span&gt;5月就到来了，这个月其实我有一次出逃的机会，因为该月市场迎来了短暂回暖，也让原本亏损的我反而还有20%左右的盈利。本该套利出逃的我，错过了最好的时机。贪婪与恐惧掌控了我，这一刻我反而不想出逃，只想着收益在成几何的增长。&lt;/p&gt;

&lt;h3&gt;&lt;span&gt;&lt;span&gt;被情绪化所控制，真的是很恐怖。没有惨痛的教训，都认识不到自己。&lt;/span&gt;            &lt;/span&gt;&lt;/h3&gt;

&lt;p&gt;&lt;span&gt;结果显然我错了，唯一一次出逃机会我没有珍惜。时间移步到&lt;/span&gt;8月份，那时我的浮亏已经超过了90%、对看待这些帐户上的数字已然有些麻木，但我已经深刻意识到我错了。&lt;/p&gt;

&lt;h3&gt;&lt;span&gt;&lt;span&gt;错并没有用，就算意识到自己错了，时间亦不会在回到过去，结果亦不会发生改变，我只能坦然面对自己的错误。比起这个、我更庆幸我那么快就可以开始重新认识自己。这慢慢熊市，有足够的时间让我对自己的不足做出改变、有足够的时间丰润自己的羽毛、有足够的时间锻炼我除了交易之外的其它技能。&lt;/span&gt;                                      &lt;/span&gt;&lt;/h3&gt;

&lt;p&gt;&lt;span&gt;整个后半年，我时常反思着自己上半年的操作；买了几本书，开始学会安静下来阅读、开始丰富自己的一技之长、开始学会控制自己的情绪&lt;/span&gt;...&lt;/p&gt;

&lt;p&gt;&lt;span&gt;且行且珍惜。经历了一次血的教训，诸多感慨、趁年轻，多磨练自己的羽毛，不要等到出现惨痛的教训才开始亡羊补牢，自我觉得我算是很幸运的一个人，自己&lt;/span&gt;17年赚了几十万，没有借过任何贷款，没有到那种无法挽回的地步、并且认清自己，发现自己的错误，我还是很庆幸的。&lt;strong&gt;有些人经历了血的教训之后，想再亡羊补牢、于是发现自己只有一只羊，再补已无济于事。&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;So,whatever anyway，人生没有白走的路，每一步都算数。趁年轻多磨练自己的羽毛，不要急于求成，带上望远镜你并不迷茫，你想要的东西都在远方。&lt;/p&gt;

</description>
<pubDate>Tue, 01 Jan 2019 14:16:00 +0000</pubDate>
<dc:creator>后天星期天</dc:creator>
<og:description>2018年终总结 回顾自己这一年的时间里，有非常多的感慨。因为这一年里对我来说意义不凡，或者说跌宕起伏。从17年底开始至今年年初，一切都发展得太顺利了、有时候甚至都会感觉所有的事情都在按照自己的剧本走</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/sunday294/p/10206352.html</dc:identifier>
</item>
<item>
<title>用ABP只要加人即可马上加快项目进展(二) - 分工篇 - BDD实战篇 - .NET Core里跑Specflow - 可以跑集成测试和单元测试 - 叶伟民</title>
<link>http://www.cnblogs.com/adalovelacer/p/abp-quickly-delivery-16-run-specflow-at-dot-net-core.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/adalovelacer/p/abp-quickly-delivery-16-run-specflow-at-dot-net-core.html</guid>
<description>


&lt;div readability=&quot;6&quot;&gt;&lt;a href=&quot;https://www.cnblogs.com/adalovelacer/p/abp-quickly-delivery-15-install-specflow-at-dot-net-core.html&quot; target=&quot;_blank&quot;&gt;上一篇文章&lt;/a&gt;说了如何在.NET Core里安装Specflow. 然而文章成果只到了hello world级别。&lt;/div&gt;
&lt;p&gt;要想真的和实际业务结合，比如要能够IOC new class实例和能够调用数据库和第三方服务。用专业术语来说，就是能跑集成测试和单元测试。这就是这篇文章的目的了。&lt;/p&gt;

&lt;p&gt;和.NET不一样的是，.NET Core取消了App.config，并且整个机制都改变了。导致很多.NETer转.NET Core的时候一脸懵逼&lt;/p&gt;

&lt;p&gt;所以在.NET Core下运用BDD/TDD也不一样了。这篇文章就讲讲如何配置。&lt;/p&gt;

&lt;ol readability=&quot;0.49175824175824&quot;&gt;&lt;li readability=&quot;-0.90322580645161&quot;&gt;
&lt;div readability=&quot;8.1290322580645&quot;&gt;原来app.config一分为二，specflow部分划为specflow.json，在&lt;a href=&quot;https://www.cnblogs.com/adalovelacer/p/abp-quickly-delivery-15-install-specflow-at-dot-net-core.html&quot; target=&quot;_blank&quot;&gt;这篇文章&lt;/a&gt;里有提到。其他划为appsetting.json&lt;/div&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;文件格式也从原来的xml文档变为json文档。&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;同时还需要把appsetting.json文件属性设置为如下&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;file:///C:/Users/yeaht/AppData/Local/Temp/enhtmlclip/Image(3).png&quot; alt=&quot;&quot;/&gt;&lt;img src=&quot;data:image/png;base64,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&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;读取配置的方式也从原来的system.configmanager.appsetting变为 IConfigurationRoot[key]方式。示例代码如下:&lt;/p&gt;
&lt;div readability=&quot;7.5&quot;&gt; 
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:csharp;gutter:true;&quot;&gt;
    public class AppEnvConfiguration : ITransientDependency
    {
        private readonly IConfigurationRoot _appConfiguration;        

        public bool IsEnableADFS =&amp;gt; bool.Parse(_appConfiguration[&quot;ExternalAuth:WsFederation:IsEnabled&quot;]);

        public AppEnvConfiguration(IAppConfigurationAccessor configurationAccessor)
        {
            _appConfiguration = configurationAccessor.Configuration;
        }
    }
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Q&amp;amp;A:&lt;/p&gt;
&lt;ol readability=&quot;-0.5&quot;&gt;&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;为啥集成测试里面数据库返回结果数目总是0?&lt;/p&gt;
&lt;p&gt;答：检查一下测试项目目录\bin\Debug\netcoreapp2.1目录下有没有appsetting.json这个文件，没有则看看有没有做上面的第3步&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;通过以上步骤，终于可以调用数据库和第三方服务来跑集成测试了。然而还有一个很大问题，单元测试跑不过啊！！！&lt;/p&gt;

&lt;p&gt;为什么会跑不过呢？&lt;/p&gt;
&lt;p&gt;因为BDD和TDD不一样。&lt;/p&gt;
&lt;p&gt;TDD的Test case是可以直接继承ABP里面的XXXTestBase基类的，这个基类里面提供了IOC new class实例等一系列很有用的方法。&lt;/p&gt;
&lt;p&gt;但是BDD的Specflow却是Test Case和Step Definition分离的。在Step Definition里面是无法调用XXXTestBase基类里的这些方法的。&lt;/p&gt;

&lt;p&gt;那怎么办呢？&lt;/p&gt;
&lt;p&gt;照如下步骤办即可：&lt;/p&gt;
&lt;ol readability=&quot;1&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;新增一个TestBaseWrappers文件夹&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;然后根据实际业务从最小化角度来建立TestBaseWrapper类&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;在这个类里面写IOC代码&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;然后再Step Definition类里调用这些TestBaseWrapper类。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Q&amp;amp;A:&lt;/p&gt;
&lt;ol readability=&quot;4.6484874307627&quot;&gt;&lt;li readability=&quot;2.3235294117647&quot;&gt;
&lt;p&gt;为什么不用Step Definition类直接继承ABP里面的XXXTestBase基类呢？&lt;/p&gt;
&lt;div readability=&quot;10.993006993007&quot;&gt;答：首先会报错。然后我在这篇文章里面说到，&lt;a href=&quot;https://www.cnblogs.com/adalovelacer/p/abp-quickly-delivery-12-team-work-2.html&quot; target=&quot;_blank&quot;&gt;我们只有一个Step Definition类&lt;/a&gt;，然后分布在多个文件，通过Partial关键字来组合。所以如果Step Definition这么大的一个类来直接继承TestBase基类，然后在TestBase基类里构造函数来IOC初始化所有要调用Service类实例，第一会遇到性能问题，第二会遇到循环调用问题，这画面太美不敢看啊。&lt;/div&gt;
&lt;/li&gt;
&lt;li readability=&quot;8.9395161290323&quot;&gt;
&lt;p&gt;报错：Message: System.InvalidOperationException : Mapper not initialized. Call Initialize with appropriate configuration. If you are trying to use mapper instances through a container or otherwise, make sure you do not have any calls to the static Mapper.Map methods, and if you're using ProjectTo or UseAsDataSource extension methods, make sure you pass in the appropriate IConfigurationProvider instance.如何解决？&lt;/p&gt;

&lt;div&gt;&lt;img src=&quot;file:///C:/Users/yeaht/AppData/Local/Temp/enhtmlclip/Image(4).png&quot; alt=&quot;&quot;/&gt;&lt;img src=&quot;data:image/png;base64,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u4ybZMy0l+W8Zv/qUpNMRXPZmWpOPOcr0l7s+z7WXdW3vS7l+0czrsr4dayrad1n+FJXey7r+7X2tK8mGZdl495pveu5mDGay/rG67t92+tSvn8046qMX8e6qfae9RVl/bh3Ws96/m+VcV2m6ynvVXm9VlV96mseyuMHET9A02WyvMnOKD2n166qqd1Mlc9qUVYzk7pdx1ysZX21yqvJrCjOzs6szkXVmShmsv20pjST5TPdDDeZpf07ZpjpnEnGVXXT9Vx2L7Xad7Ks1uw6m5/VVJZxVd1oL8tVc+O5VaYS50TVjFifntWaX2c5s+q7ODPL72ZMtveaXleqvta7GbFne69156JujqtqKsu4qm66nsvupVb7iueq/KrvtG/XWX43Y7K91/Q66s65WIt91fVcnBXPVLXK5Lyrel7rzj3iKx7KJx/OKtN9kKvMtG/uyDwyw8TeNFvlqswqX/Vd7E9mm9X8rD6ZtxJzq73T+ipT9aOYW82taP+OGWYyZ/deVd10PRcz3X4yz3VZ71WZyT3vqMdaddZ4b5LJZL1Yq86vctU54z3NdOe7WWaa9d4jmckMt5phJhnl9aqfidnJPScZVdVN13Mx0+0n81x3bmfmNOu9RzI7M9xqltmZl5nMevR+u3XjvZjpzkz91EN5tbxf0Uy1vJ/R+jRTLe9ntF5lTOxNs1Wuyth1tbzfiX3dd2dX87P6ZF7GerrUau+07nOy5f2JmKvOZXWr6XJZ1lR1F/uTOXZdrUrV6+q6VLePvU6X9V6VifesVmanHmvVWeO9SSaT9WKtOr/KVeeM9zTTnc9mWU2Xy7LOe9NMtby/UmViPctZrVpOrzsxV52Ls6tVqXpdXZfq9rHX6c6tZlpNl8uyznvTTLW8X4m9Kns156yuy3V5V2WMz8tWpqob78VMd2bq5/+bctf1vXd1htYfybg7Z+zcq8pWmZ3ZmdifzvZelcnqk3nKarG+u3darzJu1XdX792dm8zIdDPV5F4rdm51v2lG6T72Ol3We1Xm6j1Nlrdat5xeR96bZCKrd8vptYr11V55rzrTzbLrVb/ivUczZtU3VSarW03rk/kmnsvEfpXX+mpmxc6t7jfNKN3HXqeas5q/6le892jGTGa4KpvVrbY6v8rEnptkTNfLTGf59e78Cg/l/+r63rs6Q+uPZNydM3buVWWrzM7sTOxPZ3uv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&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;
&lt;p&gt;所以这道题是我面试必选题之一！！凡是在ABP项目里面使用MapTo扩展方法而不是使用IObjectMapper的，绝对是没写过单元测试的！这样子一下就可以判断出面试者有没有写过单元测试了！！！&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;为啥你讲了这么多测试方面的知识，开发的知识却很少？&lt;/p&gt;
&lt;p&gt;答：因为：&lt;/p&gt;
&lt;ol readability=&quot;4&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;无论是TDD还是BDD，都是测试驱动，先写测试代码然后再写业务开发代码&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;讲ABP开发的文章太多，不缺我一个，然而讲用ABP去做BDD/TDD的文章却很少，很需要我去补充&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;我现在自己创业，自负盈亏，不像很多开发人员，每月固定有工资，旱涝保收，可以放心的去空谈理论。所以我一切以出活为主，以交付实际成果为第一目标，而不是以理论和空谈为目标。BDD/TDD可以避免把宝贵的时间投入到项目实际上不需要的理论方面，可以保证我做的东西是客户所想要的。所以我强烈推荐BDD这个核武器。&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;在上一点里面我说出了核心，如何保证你所做的东西就是客户想要的？这就是BDD与TDD相比，BDD最大的优点啦！！！毕竟，绝大多数情况下，业务人员会比开发人员更了解业务！&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
<pubDate>Tue, 01 Jan 2019 14:15:00 +0000</pubDate>
<dc:creator>叶伟民</dc:creator>
<og:description>上一篇文章说了如何在.NET Core里安装Specflow. 然而文章成果只到了hello world级别。 要想真的和实际业务结合，比如要能够IOC new class实例和能够调用数据库和第三</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/adalovelacer/p/abp-quickly-delivery-16-run-specflow-at-dot-net-core.html</dc:identifier>
</item>
<item>
<title>SpringBoot(二十二)集成RabbitMQ---MQ实战演练 - 请叫我头头哥</title>
<link>http://www.cnblogs.com/toutou/p/springboot_rabbitmq.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/toutou/p/springboot_rabbitmq.html</guid>
<description>&lt;div class=&quot;bodyCustomClass&quot; readability=&quot;30.015503875969&quot;&gt;
&lt;blockquote readability=&quot;6.5658914728682&quot;&gt;
&lt;p&gt;RabbitMQ是一个在&lt;a title=&quot;请叫我头头哥&quot; href=&quot;https://baike.baidu.com/item/AMQP&quot; target=&quot;_blank&quot;&gt;AMQP&lt;/a&gt;基础上完成的，可复用的企业消息系统。他遵循Mozilla Public License&lt;a title=&quot;请叫我头头哥&quot; href=&quot;https://baike.baidu.com/item/%E5%BC%80%E6%BA%90%E5%8D%8F%E8%AE%AE&quot; target=&quot;_blank&quot;&gt;开源协议&lt;/a&gt;。RabbitMQ是流行的开源消息队列系统，用erlang语言开发。RabbitMQ是AMQP（高级消息队列协议）的标准实现。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;p&gt;消息中间件的工作过程可以用生产者消费者模型来表示.即,生产者不断的向消息队列发送信息,而消费者从消息队列中消费信息.&lt;/p&gt;
&lt;p&gt;如果你还没有安装rabbitmq的，可以看看这篇&lt;a title=&quot;请叫我头头哥&quot; href=&quot;https://www.cnblogs.com/toutou/p/install_rabbitmq.html&quot; target=&quot;_blank&quot;&gt;《centos安装MQ》&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;不说了不说了，来一张图直截了当的看看MQ工作的具体过程：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/506684/201812/506684-20181215153731140-1662835677.png&quot; alt=&quot;请叫我头头哥_RabbitMQ实战演练&quot;/&gt;&lt;/p&gt;
&lt;p&gt;开局一张图 故事全靠编.从上图可看出,对于消息队列来说,生产者,消息队列,消费者是最重要的三个概念,生产者发消息到消息队列中去,消费者监听指定的消息队列,并且当消息队列收到消息之后,接收消息队列传来的消息,并且给予相应的处理.消息队列常用于分布式系统之间互相信息的传递.&lt;/p&gt;
&lt;h2 id=&quot;_nav_0&quot; class=&quot;blogCustomTitleStyle&quot;&gt;&lt;span class=&quot;blogCustomTitleIco&quot;&gt;v&lt;/span&gt;基础概念&lt;/h2&gt;
&lt;p&gt;对于RabbitMQ来说,除了这三个基本模块以外,还添加了一个模块,即交换机(Exchange).它使得生产者和消息队列之间产生了隔离,生产者将消息发送给交换机,而交换机则根据调度策略把相应的消息转发给对应的消息队列.那么RabitMQ的工作流程如下所示:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/506684/201812/506684-20181215153737555-162950537.png&quot; alt=&quot;请叫我头头哥_RabbitMQ实战演练&quot;/&gt;&lt;/p&gt;
&lt;p&gt;关于rabbitmq几个基础名词的介绍：&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Broker：&lt;/span&gt; 简单来说就是消息队列服务器实体。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Exchange：&lt;/span&gt; 消息交换机，它指定消息按什么规则，路由到哪个队列。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Queue：&lt;/span&gt; 消息队列载体，每个消息都会被投入到一个或多个队列。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Binding：&lt;/span&gt; 绑定，它的作用就是把exchange和queue按照路由规则绑定起来。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Routing Key：&lt;/span&gt; 路由关键字，exchange根据这个关键字进行消息投递。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;vhost：&lt;/span&gt; 虚拟主机，一个broker里可以开设多个vhost，用作不同用户的权限分离。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;producer：&lt;/span&gt; 消息生产者，就是投递消息的程序。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;consumer：&lt;/span&gt; 消息消费者，就是接受消息的程序。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;channel：&lt;/span&gt; 消息通道，在客户端的每个连接里，可建立多个channel，每个channel代表一个会话任务。&lt;/p&gt;
&lt;p&gt;交换机的主要作用是接收相应的消息并且绑定到指定的队列.交换机有四种类型,分别为Direct,topic,headers,Fanout：&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Direct：&lt;/span&gt; 处理路由键。需要将一个队列绑定到交换机上，要求该消息与一个特定的路由键完全匹配。这是一个完整的匹配。如果一个队列绑定到该交换机上要求路由键 “demo”，则只有被标记为“demo”的消息才被转发，不会转发demo.ooo，也不会转发test.123，只会转发demo。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Topic：&lt;/span&gt; 转发信息主要是依据通配符,将路由键和某模式进行匹配。此时队列需要绑定要一个模式上。符号“#”匹配一个或多个词，符号“*”匹配不多不少一个词。因此“audit.#”能够匹配到“audit.irs.corporate”，但是“audit.*” 只会匹配到“audit.irs”。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Headers：&lt;/span&gt; 根据一个规则进行匹配,在消息队列和交换机绑定的时候会指定一组键值对规则,而发送消息的时候也会指定一组键值对规则,当两组键值对规则相匹配的时候,消息会被发送到匹配的消息队列中.&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Fanout：&lt;/span&gt; 路由广播的形式,将会把消息发给绑定它的全部队列,即便设置了key,也会被忽略.&lt;/p&gt;
&lt;h2 id=&quot;_nav_1&quot; class=&quot;blogCustomTitleStyle&quot;&gt;&lt;span class=&quot;blogCustomTitleIco&quot;&gt;v&lt;/span&gt;实战演练&lt;/h2&gt;
&lt;p&gt;&lt;span&gt;♛ 2.1 创建MQ&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/506684/201812/506684-20181215153750340-2134550029.png&quot; alt=&quot;请叫我头头哥_RabbitMQ实战演练&quot;/&gt;&lt;/p&gt;
&lt;p&gt;注：若是现有工程引入MQ，则添加Maven引用。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;org.springframework.boot&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;spring-boot-starter-amqp&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里我们延续之前&lt;a title=&quot;请叫我头头哥&quot; href=&quot;https://www.cnblogs.com/toutou/category/1327302.html&quot; target=&quot;_blank&quot;&gt;springboot系列博文&lt;/a&gt;中的例子hellospringboot，在已有项目中添加mq的Maven引用。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;♛ 2.2 application.properties&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;在application.properties文件当中引入RabbitMQ基本的配置信息&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;# ----- MQ -------- #
spring.rabbitmq.host=192.168.11.108
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;♛ 2.3 添加实体类MyModel&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package&lt;/span&gt;&lt;span&gt; com.demo.mq.model;

&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.io.Serializable;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.UUID;

&lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
 * Created by toutou on 2019/1/1.
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; MyModel &lt;span&gt;implements&lt;/span&gt;&lt;span&gt; Serializable {
    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;long&lt;/span&gt; serialVersionUID = 1L&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt;&lt;span&gt; UUID id;
    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt;&lt;span&gt; String info;

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; UUID getId() {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; id;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; setId(UUID id) {
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.id =&lt;span&gt; id;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; String getInfo() {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; info;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; setInfo(String info) {
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.info =&lt;span&gt; info;
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;♛ 2.4 添加RabbitConfig&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package&lt;/span&gt;&lt;span&gt; com.demo.mq.common;

&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.amqp.core.Binding;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.amqp.core.BindingBuilder;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.amqp.core.DirectExchange;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.amqp.core.Queue;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.amqp.rabbit.connection.CachingConnectionFactory;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.amqp.rabbit.core.RabbitTemplate;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.beans.factory.annotation.Value;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.beans.factory.config.ConfigurableBeanFactory;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.context.annotation.Bean;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.context.annotation.Configuration;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.context.annotation.Scope;

&lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
 * Created by toutou on 2019/1/1.
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
@Configuration
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; RabbitConfig {

    @Value(&lt;/span&gt;&quot;${spring.rabbitmq.host}&quot;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt;&lt;span&gt; String host;

    @Value(&lt;/span&gt;&quot;${spring.rabbitmq.port}&quot;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; port;

    @Value(&lt;/span&gt;&quot;${spring.rabbitmq.username}&quot;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt;&lt;span&gt; String username;

    @Value(&lt;/span&gt;&quot;${spring.rabbitmq.password}&quot;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt;&lt;span&gt; String password;


    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String EXCHANGE_A = &quot;my-mq-exchange_A&quot;&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String EXCHANGE_B = &quot;my-mq-exchange_B&quot;&lt;span&gt;;


    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String QUEUE_A = &quot;QUEUE_A&quot;&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String QUEUE_B = &quot;QUEUE_B&quot;&lt;span&gt;;

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String ROUTINGKEY_A = &quot;spring-boot-routingKey_A&quot;&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String ROUTINGKEY_B = &quot;spring-boot-routingKey_B&quot;&lt;span&gt;;

    @Bean
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; CachingConnectionFactory connectionFactory() {
        CachingConnectionFactory connectionFactory &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; CachingConnectionFactory(host,port);
        connectionFactory.setUsername(username);
        connectionFactory.setPassword(password);
        connectionFactory.setVirtualHost(&lt;/span&gt;&quot;/&quot;&lt;span&gt;);
        connectionFactory.setPublisherConfirms(&lt;/span&gt;&lt;span&gt;true&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; connectionFactory;
    }

    @Bean
    @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; RabbitTemplate rabbitTemplate() {
        RabbitTemplate template &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RabbitTemplate(connectionFactory());
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; template;
    }

    &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
     * 针对消费者配置
     * 1. 设置交换机类型
     * 2. 将队列绑定到交换机
     FanoutExchange: 将消息分发到所有的绑定队列，无routingkey的概念
     HeadersExchange ：通过添加属性key-value匹配
     DirectExchange:按照routingkey分发到指定队列
     TopicExchange:多关键字匹配
     &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    @Bean
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; DirectExchange defaultExchange() {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; DirectExchange(EXCHANGE_A);
    }

    &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
     * 获取队列A
     * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;
     &lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    @Bean
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; Queue queueA() {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; Queue(QUEUE_A, &lt;span&gt;true&lt;/span&gt;); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;队列持久&lt;/span&gt;
&lt;span&gt;    }

    &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
     * 获取队列B
     * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;
     &lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    @Bean
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; Queue queueB() {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; Queue(QUEUE_B, &lt;span&gt;true&lt;/span&gt;); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;队列持久&lt;/span&gt;
&lt;span&gt;    }

    &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
     * 把交换机，队列，通过路由关键字进行绑定
     * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;
     &lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    @Bean
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; Binding binding() {

        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; BindingBuilder.bind(queueA()).to(defaultExchange()).with(RabbitConfig.ROUTINGKEY_A);
    }

    &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
     * 一个交换机可以绑定多个消息队列，也就是消息通过一个交换机，可以分发到不同的队列当中去。
     * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;
     &lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    @Bean
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; Binding bindingB(){
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; BindingBuilder.bind(queueB()).to(defaultExchange()).with(RabbitConfig.ROUTINGKEY_B);
    }

}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;♛ 2.5 添加消息的生产者MyProducer&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package&lt;/span&gt;&lt;span&gt; com.demo.mq.producer;

&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; com.demo.mq.common.RabbitConfig;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; com.demo.mq.model.MyModel;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.slf4j.Logger;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.slf4j.LoggerFactory;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.amqp.rabbit.core.RabbitTemplate;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.amqp.rabbit.support.CorrelationData;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.beans.factory.annotation.Autowired;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.stereotype.Component;

&lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
 * Created by toutou on 2019/1/1.
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
@Component
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; MyProducer &lt;span&gt;implements&lt;/span&gt;&lt;span&gt; RabbitTemplate.ConfirmCallback {

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Logger logger = LoggerFactory.getLogger(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.getClass());

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;由于rabbitTemplate的scope属性设置为ConfigurableBeanFactory.SCOPE_PROTOTYPE，所以不能自动注入&lt;/span&gt;
    &lt;span&gt;private&lt;/span&gt;&lt;span&gt; RabbitTemplate rabbitTemplate;

    &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
     * 构造方法注入rabbitTemplate
     &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    @Autowired
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; MyProducer(RabbitTemplate rabbitTemplate) {
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.rabbitTemplate =&lt;span&gt; rabbitTemplate;
        rabbitTemplate.setConfirmCallback(&lt;/span&gt;&lt;span&gt;this&lt;/span&gt;); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;rabbitTemplate如果为单例的话，那回调就是最后设置的内容&lt;/span&gt;
&lt;span&gt;    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; sendMsg(MyModel model) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;把消息放入ROUTINGKEY_A对应的队列当中去，对应的是队列A&lt;/span&gt;
&lt;span&gt;        rabbitTemplate.convertAndSend(RabbitConfig.EXCHANGE_A, RabbitConfig.ROUTINGKEY_A, model);
    }

    &lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
     * 回调
     &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    @Override
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; confirm(CorrelationData correlationData, &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; ack, String cause) {
        logger.info(&lt;/span&gt;&quot; 回调id:&quot; +&lt;span&gt; correlationData);
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; (ack) {
            logger.info(&lt;/span&gt;&quot;消息成功消费&quot;&lt;span&gt;);
        } &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
            logger.info(&lt;/span&gt;&quot;消息消费失败:&quot; +&lt;span&gt; cause);
        }
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;♛ 2.6 添加消息的消费者MyReceiver&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package&lt;/span&gt;&lt;span&gt; com.demo.mq.receiver;

&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; com.demo.mq.common.RabbitConfig;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; com.demo.mq.model.MyModel;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.amqp.rabbit.annotation.RabbitHandler;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.amqp.rabbit.annotation.RabbitListener;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.stereotype.Component;

&lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
 * Created by toutou on 2019/1/1.
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
@Component
@RabbitListener(queues &lt;/span&gt;=&lt;span&gt; RabbitConfig.QUEUE_A)
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; MyReceiver {
    @RabbitHandler
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; process(MyModel model) {
        System.out.println(&lt;/span&gt;&quot;接收处理队列A当中的消息： &quot; +&lt;span&gt; model.getInfo());
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;♛ 2.7 添加MyMQController&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package&lt;/span&gt;&lt;span&gt; com.demo.controller;

&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; com.demo.mq.model.MyModel;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; com.demo.mq.producer.MyProducer;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; lombok.extern.slf4j.Slf4j;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.beans.factory.annotation.Autowired;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.web.bind.annotation.GetMapping;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.web.bind.annotation.RestController;

&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.UUID;

&lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
 * Created by toutou on 2019/1/1.
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
@RestController
@Slf4j
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; MyMQController {
    @Autowired
    MyProducer myProducers;

    @GetMapping(&lt;/span&gt;&quot;/mq/producer&quot;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; String myProducer(String content){
        MyModel model &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; MyModel();
        model.setId(UUID.randomUUID());
        model.setInfo(content);
        myProducers.sendMsg(model);
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &quot;已发送：&quot; +&lt;span&gt; content;
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;♛ 2.8 项目整体目录&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/506684/201812/506684-20181215154041883-1558464252.png&quot; alt=&quot;请叫我头头哥_RabbitMQ实战演练&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;♛ 2.9 调试&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;2.9.1 在页面中请求http://localhost:8081/mq/producer?content=hello rabbitmq&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/506684/201812/506684-20181215154054017-132573354.png&quot; alt=&quot;请叫我头头哥_RabbitMQ实战演练&quot;/&gt;&lt;/p&gt;
&lt;p&gt;2.9.2 查看http://ip:15672/#/queues的变化&lt;/p&gt;
&lt;p&gt;关于RabbitMQ Management有疑问的，可以看上篇博文。&lt;a title=&quot;请叫我头头哥&quot; href=&quot;https://www.cnblogs.com/toutou/p/RabbitMQ_Management.html&quot; target=&quot;_blank&quot;&gt;《浅谈RabbitMQ Management》&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/506684/201812/506684-20181231222318497-1403369854.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;2.9.3 查看消费者日志记录&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/506684/201812/506684-20181215154112266-1808788173.png&quot; alt=&quot;请叫我头头哥_RabbitMQ实战演练&quot;/&gt;&lt;/p&gt;
&lt;p&gt;这样一个完整的rabbitmq实例就有了。&lt;/p&gt;
&lt;h2 id=&quot;_nav_1&quot; class=&quot;blogCustomTitleStyle&quot;&gt;&lt;span class=&quot;blogCustomTitleIco&quot;&gt;v&lt;/span&gt;源码地址&lt;/h2&gt;
&lt;p&gt;&lt;a title=&quot;请叫我头头哥&quot; href=&quot;https://github.com/toutouge/javademo/tree/master/hellospringboot&quot; target=&quot;_blank&quot;&gt;https://github.com/toutouge/javademo/tree/master/hellospringboot&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;MySignature&quot; readability=&quot;9.0030211480363&quot;&gt;
&lt;p id=&quot;PSignature&quot;&gt;&lt;br/&gt;作　　者：&lt;strong&gt;&lt;span&gt;&lt;a href=&quot;http://www.cnblogs.com/toutou/&quot; target=&quot;_blank&quot;&gt;请叫我头头哥&lt;/a&gt;&lt;/span&gt;&lt;/strong&gt;&lt;br/&gt;出　　处：&lt;a href=&quot;http://www.cnblogs.com/toutou/&quot; target=&quot;_blank&quot;&gt;http://www.cnblogs.com/toutou/&lt;/a&gt;&lt;br/&gt;关于作者：专注于基础平台的项目开发。如有问题或建议，请多多赐教！&lt;br/&gt;版权声明：本文版权归作者和博客园共有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文链接。&lt;br/&gt;特此声明：所有评论和私信都会在第一时间回复。也欢迎园子的大大们指正错误，共同进步。或者&lt;a href=&quot;http://msg.cnblogs.com/msg/send/%E8%AF%B7%E5%8F%AB%E6%88%91%E5%A4%B4%E5%A4%B4%E5%93%A5&quot;&gt;直接私信&lt;/a&gt;我&lt;br/&gt;声援博主：如果您觉得文章对您有帮助，可以点击文章右下角&lt;strong&gt;&lt;span&gt;【&lt;a id=&quot;post-up&quot; href=&quot;javascript:void(0);&quot;&gt;推荐&lt;/a&gt;】&lt;/span&gt;&lt;/strong&gt;一下。您的鼓励是作者坚持原创和持续写作的最大动力！&lt;br/&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
<pubDate>Tue, 01 Jan 2019 14:09:00 +0000</pubDate>
<dc:creator>请叫我头头哥</dc:creator>
<og:description>RabbitMQ是一个在AMQP基础上完成的，可复用的企业消息系统。他遵循Mozilla Public License开源协议。RabbitMQ是流行的开源消息队列系统，用erlang语言开发。Rab</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/toutou/p/springboot_rabbitmq.html</dc:identifier>
</item>
<item>
<title>Elasticsearch 分词器 - 不要乱摸</title>
<link>http://www.cnblogs.com/cjsblog/p/10171695.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/cjsblog/p/10171695.html</guid>
<description>&lt;p&gt;&lt;span&gt;无论是内置的分析器（analyzer），还是自定义的分析器（analyzer），都由三种构件块组成的：&lt;span&gt;character filters&lt;/span&gt; ， &lt;span&gt;tokenizers&lt;/span&gt; ， &lt;span&gt;token filters&lt;/span&gt;。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;内置的analyzer将这些构建块预先打包到适合不同语言和文本类型的analyzer中。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;Character filters （字符过滤器）&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;字符过滤器以字符流的形式接收原始文本，并可以通过添加、删除或更改字符来转换该流。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;举例来说，一个字符过滤器可以用来把阿拉伯数字（٠‎١٢٣٤٥٦٧٨‎٩）‎转成成Arabic-Latin的等价物（0123456789）。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;一个分析器可能有0个或多个字符过滤器，它们按顺序应用。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;（PS：类似Servlet中的过滤器，或者拦截器，想象一下有一个过滤器链）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;Tokenizer （分词器）&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;一个分词器接收一个字符流，并将其拆分成单个token （通常是单个单词），并输出一个token流。例如，一个whitespace分词器当它看到空白的时候就会将文本拆分成token。它会将文本“Quick brown fox!”转换为[Quick, brown, fox!]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;（PS：Tokenizer 负责将文本拆分成单个token ，这里token就指的就是一个一个的单词。就是一段文本被分割成好几部分，相当于Java中的字符串的 split ）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;分词器还负责记录每个term的顺序或位置，以及该term所表示的原单词的开始和结束字符偏移量。&lt;span&gt;（PS：文本被分词后的输出是一个term数组）&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;一个分析器必须只能有一个分词器&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;Token filters （token过滤器）&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;token过滤器接收token流，并且可能会添加、删除或更改tokens。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;例如，一个lowercase token filter可以将所有的token转成小写。stop token filter可以删除常用的单词，比如 the 。synonym token filter可以将同义词引入token流。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;不允许token过滤器更改每个token的位置或字符偏移量。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;一个分析器可能有0个或多个token过滤器，它们按顺序应用。&lt;/span&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;小结&amp;amp;回顾&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;span&gt;analyzer（分析器）是一个包，这个包由三部分组成，分别是：character filters （字符过滤器）、tokenizer（分词器）、token filters（token过滤器）&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;一个analyzer可以有0个或多个character filters&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;一个analyzer有且只能有一个tokenizer&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;一个analyzer可以有0个或多个token filters&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;character filter 是做字符转换的，它接收的是文本字符流，输出也是字符流&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;tokenizer 是做分词的，它接收字符流，输出token流（文本拆分后变成一个一个单词，这些单词叫token）&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;token filter 是做token过滤的，它接收token流，输出也是token流&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;由此可见，整个analyzer要做的事情就是将文本拆分成单个单词，文本 ----&amp;gt;  字符  ----&amp;gt;  token&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/blockquote&gt;
&lt;p&gt; &lt;img src=&quot;https://img2018.cnblogs.com/blog/874963/201901/874963-20190101202008487-1623951515.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; 这就好比是拦截器&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/874963/201901/874963-20190101202228389-2085464932.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/874963/201901/874963-20190101202243345-1457397120.png&quot; alt=&quot;&quot;/&gt; &lt;/p&gt;

&lt;p&gt;&lt;span&gt;1.  测试分析器&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;analyze API 是一个工具，可以帮助我们查看分析的过程。（PS：类似于执行计划）&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
curl -X POST &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;192.168.1.134:9200/_analyze&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;whitespace&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:     &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The quick brown fox.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
}
&lt;/span&gt;&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;
curl &lt;/span&gt;-X POST &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;192.168.1.134:9200/_analyze&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;tokenizer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;standard&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;filter&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:  [ &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;lowercase&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;asciifolding&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; ],
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:      &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Is this déja vu?&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;输出：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;54&quot;&gt;
&lt;pre&gt;
&lt;span&gt;{
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;tokens&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;:[
        {
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;token&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;start_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;0&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;end_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;3&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;word&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;position&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;0&lt;/span&gt;&lt;span&gt;
        },
        {
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;token&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;quick&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;start_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;4&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;end_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;9&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;word&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;position&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;1&lt;/span&gt;&lt;span&gt;
        },
        {
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;token&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;brown&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;start_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;10&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;end_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;15&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;word&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;position&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;2&lt;/span&gt;&lt;span&gt;
        },
        {
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;token&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;fox.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;start_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;end_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;20&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;word&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;position&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:&lt;span&gt;3&lt;/span&gt;&lt;span&gt;
        }
    ]
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;可以看到，对于每个term，记录了它的位置和偏移量&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2.  Analyzer&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2.1.  配置内置的分析器&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;内置的分析器不用任何配置就可以直接使用。当然，默认配置是可以更改的。例如，standard分析器可以配置为支持停止字列表:&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
curl -X PUT &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/my_index&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;settings&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analysis&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
        &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;std_english&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: { 
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:      &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;standard&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;stopwords&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;_english_&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
        }
      }
    }
  },
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;mappings&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;_doc&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;properties&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
        &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;my_text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:     &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;standard&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, 
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;fields&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;english&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
              &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:     &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
              &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;std_english&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; 
            }
          }
        }
      }
    }
  }
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;在这个例子中，我们基于standard分析器来定义了一个std_englisth分析器，同时配置为删除预定义的英语停止词列表。后面的mapping中，定义了my_text字段用standard，my_text.english用std_english分析器。因此，下面两个的分词结果会是这样的：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
curl -X POST &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/my_index/_analyze&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;field&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;my_text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, 
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The old brown cow&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
}
&lt;/span&gt;&lt;span&gt;'
&lt;/span&gt;curl -X POST &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/my_index/_analyze&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;field&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;my_text.english&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, 
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The old brown cow&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;第一个由于用的standard分析器，因此分词的结果是：[ the, old, brown, cow ]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;第二个用std_english分析的结果是：[ old, brown, cow ]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2.2.  Standard Analyzer （默认）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;如果没有特别指定的话，standard 是默认的分析器。它提供了基于语法的标记化（基于Unicode文本分割算法），适用于大多数语言。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;例如：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
curl -X POST &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/_analyze&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;standard&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The 2 QUICK Brown-Foxes jumped over the lazy dog\u0027s bone.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;上面例子中，那段文本将会输出如下terms：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;42&quot;&gt;
&lt;pre&gt;
[ the, 2, quick, brown, foxes, jumped, over, the, lazy, dog's, bone ]
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;2.2.1.  配置&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;标准分析器接受下列参数：&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;span&gt;max_token_length  ：  最大token长度，默认255&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;stopwords  ：  预定义的停止词列表，如&lt;span&gt;_english_&lt;/span&gt; 或 包含停止词列表的数组，默认是 &lt;span&gt;_none_&lt;/span&gt;&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;stopwords_path  ：  包含停止词的文件路径&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;span&gt;2.2.2.  示例配置&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
curl -X PUT &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/my_index&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;settings&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analysis&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
        &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;my_english_analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;standard&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;max_token_length&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;5&lt;/span&gt;&lt;span&gt;,
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;stopwords&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;_english_&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
        }
      }
    }
  }
}
&lt;/span&gt;&lt;span&gt;'
&lt;/span&gt;curl -X POST &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/my_index/_analyze&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;my_english_analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The 2 QUICK Brown-Foxes jumped over the lazy dog\u0027s bone.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;以上输出下列terms:&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;
&lt;pre&gt;
[ 2, quick, brown, foxes, jumpe, d, over, lazy, dog's, bone ]
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;2.2.3.  定义&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;standard分析器由下列两部分组成：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Tokenizer&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;span&gt;Standard Tokenizer&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;span&gt;Token Filters&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;span&gt;Standard Token Filter&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;Lower Case Token Filter&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;Stop Token Filter （默认被禁用）&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;span&gt;你还可以自定义&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
curl -X PUT &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/standard_example&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;settings&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analysis&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
        &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;rebuilt_standard&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;tokenizer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;standard&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;filter&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: [
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;lowercase&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;       
          ]
        }
      }
    }
  }
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;2.3.  Simple Analyzer&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; simple 分析器当它遇到&lt;strong&gt;只要不是字母的字符&lt;/strong&gt;，就将文本解析成term，而且所有的term都是小写的。例如：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
curl -X POST &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/_analyze&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;simple&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The 2 QUICK Brown-Foxes jumped over the lazy dog\u0027s bone.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;输入结果如下：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;42&quot;&gt;
&lt;pre&gt;
[ the, quick, brown, foxes, jumped, over, the, lazy, dog, s, bone ]
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;2.3.1.  自定义&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
curl -X PUT &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/simple_example&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;settings&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analysis&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
        &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;rebuilt_simple&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;tokenizer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;lowercase&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;filter&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: [         
          ]
        }
      }
    }
  }
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;2.4.  Whitespace Analyzer&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;whitespace 分析器，当它遇到&lt;strong&gt;空白字符&lt;/strong&gt;时，就将文本解析成terms&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;示例：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
curl -X POST &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/_analyze&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;whitespace&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The 2 QUICK Brown-Foxes jumped over the lazy dog\u0027s bone.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;输出结果如下：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;
&lt;pre&gt;
[ The, &lt;span&gt;2&lt;/span&gt;, QUICK, Brown-Foxes, jumped, over, the, lazy, dog&lt;span&gt;'&lt;/span&gt;&lt;span&gt;s, bone. ]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;2.5.  Stop Analyzer&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; stop 分析器 和 simple 分析器很像，唯一不同的是，stop 分析器增加了对删除停止词的支持。默认用的停止词是 _englisht_&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;（PS：意思是，假设有一句话“this is a apple”，并且假设“this” 和 “is”都是停止词，那么用simple的话输出会是[ this , is , a , apple ]，而用stop输出的结果会是[ a , apple ]，到这里就看出二者的区别了，stop 不会输出停止词，也就是说它不认为停止词是一个term）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;（PS：所谓的停止词，可以理解为分隔符）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2.5.1.  示例输出&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
curl -X POST &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/_analyze&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;stop&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The 2 QUICK Brown-Foxes jumped over the lazy dog\u0027s bone.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;输出&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
[ quick, brown, foxes, jumped, over, lazy, dog, s, bone ]
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;2.5.2.  配置&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;stop 接受以下参数：&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;span&gt;stopwords  ：  一个预定义的停止词列表（比如，_englisht_）或者是一个包含停止词的列表。默认是 _english_&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;stopwords_path  ：  包含停止词的文件路径。这个路径是相对于Elasticsearch的config目录的一个路径&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;span&gt;2.5.3.  示例配置&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
curl -X PUT &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/my_index&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;settings&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analysis&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
        &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;my_stop_analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;stop&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;stopwords&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: [&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;the&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;over&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;]
        }
      }
    }
  }
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;上面配置了一个stop分析器，它的停止词有两个：the 和 over&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
curl -X POST &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/my_index/_analyze&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;my_stop_analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The 2 QUICK Brown-Foxes jumped over the lazy dog\u0027s bone.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;基于以上配置，这个请求输入会是这样的：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
[ quick, brown, foxes, jumped, lazy, dog, s, bone ]
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;2.6.  Pattern Analyzer&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;用&lt;strong&gt;Java正则表达式&lt;/strong&gt;来将文本分割成terms，默认的正则表达式是\W+（非单词字符）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2.6.1.  示例输出&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
curl -X POST &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/_analyze&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;pattern&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The 2 QUICK Brown-Foxes jumped over the lazy dog\u0027s bone.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;由于默认按照非单词字符分割，因此输出会是这样的：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;43&quot;&gt;
&lt;pre&gt;
[ the, &lt;span&gt;2&lt;/span&gt;, quick, brown, foxes, jumped, over, the, lazy, dog, s, bone ]
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;2.6.2.  配置&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;pattern 分析器接受如下参数：&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;span&gt;pattern  ：  一个Java正则表达式，默认 \W+&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;flags  ：  Java正则表达式flags。比如：CASE_INSENSITIVE 、COMMENTS&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;lowercase  ：  是否将terms全部转成小写。默认true&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;stopwords  ：  一个预定义的停止词列表，或者包含停止词的一个列表。默认是 _none_&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;stopwords_path  ：  停止词文件路径&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;span&gt;2.6.3.  示例配置&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
curl -X PUT &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/my_index&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;settings&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analysis&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
        &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;my_email_analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:      &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;pattern&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;pattern&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:   &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;\\W|_&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, 
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;lowercase&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;true&lt;/span&gt;&lt;span&gt;
        }
      }
    }
  }
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;上面的例子中配置了按照非单词字符或者下划线分割，并且输出的term都是小写&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
curl -X POST &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/my_index/_analyze&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;my_email_analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;John_Smith@foo-bar.com&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;因此，基于以上配置，本例输出如下：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
[ john, smith, foo, bar, com ]
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;2.7.  Language Analyzers&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;支持不同语言环境下的文本分析。内置（预定义）的语言有：arabic, armenian, basque, bengali, brazilian, bulgarian, catalan, cjk, czech, danish, dutch, english, finnish, french, galician, german, greek, hindi, hungarian, indonesian, irish, italian, latvian, lithuanian, norwegian, persian, portuguese, romanian, russian, sorani, spanish, swedish, turkish, thai&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;2.8.  自定义Analyzer&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;前面也说过，一个分析器由三部分构成：&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;span&gt;zero or more character filters&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;a tokenizer&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;zero or more token filters&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;span&gt;2.8.1.  实例配置&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
curl -X PUT &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/my_index&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;settings&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analysis&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
        &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;my_custom_analyzer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: {
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;:      &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;custom&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, 
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;tokenizer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;standard&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;char_filter&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: [
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;html_strip&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
          ],
          &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;filter&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: [
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;lowercase&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;asciifolding&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
          ]
        }
      }
    }
  }
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;3.  Tokenizer &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;3.1.  Standard Tokenizer&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
curl -X POST &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost:9200/_analyze&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; -H &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Content-Type: application/json&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; -d&lt;span&gt;'
&lt;/span&gt;&lt;span&gt;{
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;tokenizer&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;standard&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The 2 QUICK Brown-Foxes jumped over the lazy dog\u0027s bone.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
}
&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;4.  中文分词器&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;4.1.  smartCN&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;一个简单的中文或中英文混合文本的分词器&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;这个插件提供 &lt;span&gt;smartcn&lt;/span&gt; analyzer 和 &lt;span&gt;smartcn_tokenizer&lt;/span&gt; tokenizer，而且不需要配置&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;# 安装
bin&lt;/span&gt;/elasticsearch-plugin &lt;span&gt;install&lt;/span&gt; analysis-&lt;span&gt;smartcn
# 卸载
bin&lt;/span&gt;/elasticsearch-plugin remove analysis-smartcn
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/874963/201901/874963-20190101203955749-2118474749.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;下面测试一下&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/874963/201901/874963-20190101204805543-958737862.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;可以看到，“今天天气真好”用smartcn分析器的结果是：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
[ 今天 ， 天气 ， 真 ， 好 ]
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;如果用standard分析器的话，结果会是：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
[ 今 ，天 ，气 ， 真 ， 好 ]
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;4.2.  IK分词器&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;下载对应的版本，这里我下载6.5.3&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/874963/201901/874963-20190101212209398-913041330.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;然后，在Elasticsearch的plugins目录下建一个ik目录，将刚才下载的文件解压到该目录下&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/874963/201901/874963-20190101212442300-9594610.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;最后，重启Elasticsearch&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;接下来，还是用刚才那句话来测试一下&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/874963/201901/874963-20190101212656782-1465788978.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;输出结果如下：&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;59&quot;&gt;
&lt;pre&gt;
&lt;span&gt;{
    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;tokens&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;: [
        {
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;token&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;今天天气&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;start_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;0&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;end_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;4&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;CN_WORD&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;position&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;0&lt;/span&gt;&lt;span&gt;
        },
        {
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;token&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;今天&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;start_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;0&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;end_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;2&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;CN_WORD&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;position&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;1&lt;/span&gt;&lt;span&gt;
        },
        {
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;token&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;天天&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;start_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;1&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;end_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;3&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;CN_WORD&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;position&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;2&lt;/span&gt;&lt;span&gt;
        },
        {
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;token&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;天气&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;start_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;2&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;end_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;4&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;CN_WORD&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;position&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;3&lt;/span&gt;&lt;span&gt;
        },
        {
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;token&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;真好&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;start_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;4&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;end_offset&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;6&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;CN_WORD&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
            &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;position&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;: &lt;span&gt;4&lt;/span&gt;&lt;span&gt;
        }
    ]
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;显然比smartcn要更好一点&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;5.  参考&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis.html&quot; target=&quot;_blank&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis.html&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-tokenfilters.html&quot; target=&quot;_blank&quot;&gt;https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-tokenfilters.html&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;a href=&quot;https://github.com/medcl/elasticsearch-analysis-ik&quot; target=&quot;_blank&quot;&gt;https://github.com/medcl/elasticsearch-analysis-ik&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

</description>
<pubDate>Tue, 01 Jan 2019 13:50:00 +0000</pubDate>
<dc:creator>不要乱摸</dc:creator>
<og:description>无论是内置的分析器（analyzer），还是自定义的分析器（analyzer），都由三种构件块组成的：character filters ， tokenizers ， token filters。 内</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/cjsblog/p/10171695.html</dc:identifier>
</item>
</channel>
</rss>