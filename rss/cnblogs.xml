<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>博客园_首页</title>
<link></link>
<description>代码改变世界</description>
<item>
<title>将WSL2作为生产力工具 - Dmego</title>
<link>http://www.cnblogs.com/dmego/p/12082013.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/dmego/p/12082013.html</guid>
<description>&lt;p&gt;适用于 &lt;code&gt;Linux&lt;/code&gt; 的 &lt;code&gt;Windows&lt;/code&gt; 子系统 (&lt;code&gt;WSL&lt;/code&gt;) 是 &lt;code&gt;Windows 10&lt;/code&gt;新增的功能，使用它可以直接在 &lt;code&gt;Windows&lt;/code&gt; 上运行 &lt;code&gt;Linux&lt;/code&gt; 命令。而&lt;code&gt;WSL 2&lt;/code&gt; 是&lt;code&gt;WSL&lt;/code&gt;的一个新版本，它支持适用于 &lt;code&gt;Linux&lt;/code&gt; 的 &lt;code&gt;Windows&lt;/code&gt; 子系统在 &lt;code&gt;Windows&lt;/code&gt; 上运行 &lt;code&gt;ELF64 Linux&lt;/code&gt; 二进制文件。 它的主要目标是提高文件系统的性能，并增加系统调用的完全兼容性。&lt;code&gt;WSL 2&lt;/code&gt; 使用最新和最高的虚拟化技术在轻型实用程序虚拟机（&lt;code&gt;VM&lt;/code&gt;）内部运行 &lt;code&gt;Linux&lt;/code&gt; 内核。&lt;/p&gt;

&lt;h2 id=&quot;win-版本要求&quot;&gt;win 版本要求&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;WSL 2&lt;/code&gt; 仅在 &lt;code&gt;Windows 10 18917&lt;/code&gt; 或更高版本中可用，如果版本太低，可以加入 &lt;code&gt;Windows Insider&lt;/code&gt; 升级 &lt;code&gt;Windows&lt;/code&gt; ，我们可以在 &lt;code&gt;cmd&lt;/code&gt; 中使用 &lt;code&gt;ver&lt;/code&gt; 来检查当前 &lt;code&gt;win&lt;/code&gt;的版本。&lt;/p&gt;
&lt;h2 id=&quot;启用虚拟机平台可选组件&quot;&gt;启用虚拟机平台可选组件&lt;/h2&gt;
&lt;p&gt;在 &lt;code&gt;powerShell&lt;/code&gt; 中以管理员身份运行下面命令&lt;/p&gt;
&lt;pre class=&quot;powershell&quot;&gt;
&lt;code&gt;dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;运行完成之后，请重启电脑完成安装.&lt;/p&gt;
&lt;h2 id=&quot;设置-wsl-发行版&quot;&gt;设置 WSL 发行版&lt;/h2&gt;
&lt;p&gt;如果想要将默认的&lt;code&gt;WSL&lt;/code&gt;发行版设置成 &lt;code&gt;WSL 2&lt;/code&gt;，在 &lt;code&gt;powerShell&lt;/code&gt; 中使用下面命令&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;wsl --set-default-version 2&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;如果想要设置某一个发行版为&lt;code&gt;WSL2&lt;/code&gt;，在 &lt;code&gt;powerShell&lt;/code&gt; 中使用下面命令，将 &lt;code&gt;&amp;lt;Distro&amp;gt;&lt;/code&gt; 换成你想要设置的发行版即可，例如 &lt;code&gt;Ubuntu-18.04&lt;/code&gt;&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;wsl --set-version &amp;lt;Distro&amp;gt; 2&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;验证使用的&lt;code&gt;WSL&lt;/code&gt;版本&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;wsl -l -v&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;下载安装-ubuntu-18.04&quot;&gt;下载安装 Ubuntu-18.04&lt;/h2&gt;
&lt;p&gt;在 &lt;code&gt;Windows&lt;/code&gt; 应用商店里搜索 &lt;code&gt;Ubuntu-18.04&lt;/code&gt; ，然后下载,下载完成之后打开 &lt;code&gt;Ubuntu-18.04&lt;/code&gt; ，这时会先进行一些初始化安装的设置，然后就会让你设置新的 &lt;code&gt;UNIX&lt;/code&gt;用户名和密码，设置完成之后，就进入了 &lt;code&gt;linux&lt;/code&gt; 子系统。验证是否是 &lt;code&gt;WSL 2&lt;/code&gt; 我们只需要在 &lt;code&gt;powerShell&lt;/code&gt; 下输入 &lt;code&gt;wsl -l -v&lt;/code&gt; ,输出内容如下，这里 &lt;code&gt;VERSION&lt;/code&gt; 为 &lt;code&gt;2&lt;/code&gt; 代表启用了 &lt;code&gt;WSL 2&lt;/code&gt;&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;NAME                   STATE           VERSION
* Ubuntu-18.04           Running         2&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;ubuntu-18.04-更换国内源&quot;&gt;Ubuntu-18.04 更换国内源&lt;/h2&gt;
&lt;p&gt;首先备份一下默认的源&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;cp /etc/apt/sources.list /etc/apt/sourses.list.bak&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;更换默认源为阿里源, 使用 &lt;code&gt;sudo vim /etc/apt/sources.list&lt;/code&gt; 命令编辑，删除原来的内容，添加下面的阿里源信息&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;更换源之后，使用下面的命令更新一下&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;sudo apt-get update
sudo apt-get upgade&lt;/code&gt;
&lt;/pre&gt;

&lt;h2 id=&quot;下载-windows-terminal&quot;&gt;下载 Windows Terminal&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;Windows Terminal&lt;/code&gt; 是&lt;code&gt;win&lt;/code&gt;推出的最新的一款命令行工具，可以在应用商店里搜索并下载，安装完成打开界面如下&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1026866/201912/1026866-20191223085256593-1041605825.png&quot; alt=&quot;Windows Terminal&quot;/&gt;&lt;/p&gt;
&lt;p&gt;关于其的介绍这里就不多展开，这里记录如何使用&lt;code&gt;Windows Terminal&lt;/code&gt; 连接&lt;code&gt;WSL 2&lt;/code&gt;并安装配置&lt;code&gt;zsh&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&quot;安装-zsh&quot;&gt;安装 zsh&lt;/h2&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;# 安装 zsh
sudo apt-get install zsh

# 修改默认的 Shell 为 zsh
chsh -s /bin/zsh&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;安装-oh-my-zsh&quot;&gt;安装 oh-my-zsh&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;oh-my-zsh&lt;/code&gt;用于快速配置&lt;code&gt;zsh&lt;/code&gt;，进入&lt;a href=&quot;https://ohmyz.sh/&quot;&gt;官网&lt;/a&gt;或者&lt;a href=&quot;https://github.com/ohmyzsh/ohmyzsh&quot;&gt;Github&lt;/a&gt;可以了解其基本使用及其丰富的主题使用，安装只需要执行下面代码即可&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&quot;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;安装&lt;code&gt;zsh-syntax-higlighting&lt;/code&gt;语法高亮插件&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;# 下载
git clone https://github.com/zsh-users/zsh-syntax-highlighting.git

# 移动到 plugins 文件夹中
mv -p zsh-syntax-highlighting $ZSH_CUSTOM/plugins

# 配置环境变量
cd ~
vim .zshrc

#在 plugins 一列中添加 zsh-syntax-highlighting，如下
plugins=(
         git
         zsh-syntax-highlighting
         )

# 在文件最后添加
source $ZSH_CUSTOM/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

# 配置生效
source ~/.zshrc&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;安装&lt;code&gt;zsh-autosuggestions&lt;/code&gt;语法历史记录插件&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;# 下载
git clone https://github.com/zsh-users/zsh-autosuggestions.git

# 移动到 plugins 文件夹中
mv -p zsh-autosuggestions $ZSH_CUSTOM/plugins

# 配置环境变量
cd ~
vim .zshrc

#在 plugins 一列中添加 zsh-autosuggestions，如下
plugins=(
         git
         zsh-syntax-highlighting
         zsh-autosuggestions
         )

# 在文件最后添加
source $ZSH_CUSTOM/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh

# 配置生效
source ~/.zshrc&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;配置完成之后，默认的主题光标如下所示，如果想要配置更加丰富的主题，可以自行百度&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1026866/201912/1026866-20191223085332193-1232667619.png&quot; alt=&quot;默认配置&quot;/&gt;&lt;/p&gt;

&lt;h2 id=&quot;在-wsl-2-中安装-docker&quot;&gt;在 WSL 2 中安装 Docker&lt;/h2&gt;
&lt;p&gt;卸载旧版本&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;sudo apt-get remove docker docker-engine docker.io containerd runc&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;设置存储库&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;# 更新 apt 包索引
sudo apt-get update

# 安装软件包以允许 apt 通过 HTTPS 使用存储库
sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg-agent \
    software-properties-common

# 设置稳定的存储库
sudo add-apt-repository \
   &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable&quot;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;安装 Docker 社区版( docker-ce )&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;# 更新 apt 包索引
sudo apt-get update

# 安装最新版本的 Docker 和 containerd
sudo apt-get install docker-ce docker-ce-cli containerd.io
# (*)安装特定版本;&amp;lt;VERSION&amp;gt; 为具体版本,例如 18.09.1
sudo apt-get install docker-ce=&amp;lt;VERSION&amp;gt; docker-ce-cli=&amp;lt;VERSION&amp;gt; containerd.io&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;启动 &lt;code&gt;docker&lt;/code&gt; 并设置开机自启&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;# 启动 docker
systemctl start docker.service
# 设置开机自启
systemctl enable docker.service&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;如果非 &lt;code&gt;root&lt;/code&gt; 用户想要使用 &lt;code&gt;docker&lt;/code&gt; ，需要将该用户添加到 &lt;code&gt;docker&lt;/code&gt; 用户组&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;sudo usermod -aG docker user-name&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;(*)卸载docker&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;# 卸载软件
sudo apt-get purge docker-ce
# 删除 docker 的容器,镜像,卷等存储
sudo rm -rf /var/lib/docker&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;下载安装-docker-desktop-wsl-2-backend&quot;&gt;下载安装 Docker Desktop WSL 2 backend&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;WSL 2&lt;/code&gt; 引入了重大的体系结构更改，因为它是 &lt;code&gt;Microsoft&lt;/code&gt; 构建的完整 &lt;code&gt;Linux&lt;/code&gt; 内核，允许 &lt;code&gt;Linux&lt;/code&gt; 容器在没有仿真的情况下本机运行，而 &lt;code&gt;Docker&lt;/code&gt; 也专门开发了可以使用 &lt;code&gt;WSL 2&lt;/code&gt; 中的 &lt;code&gt;Docker&lt;/code&gt; 守护进程的桌面管理程序, 打开 &lt;a href=&quot;https://docs.docker.com/docker-for-windows/wsl-tech-preview/&quot;&gt;Docker Desktop WSL2 backend&lt;/a&gt; 页面，下载最新的程序,安装之后,打开程序做如下设置&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;启用基于实验性&lt;code&gt;WSL 2&lt;/code&gt;的引擎复选框(&lt;code&gt;Enable the experimental WSL 2 based engine&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1026866/201912/1026866-20191223085400523-1551246220.png&quot; alt=&quot;启用基于实验性 WSL2 的引擎复选框&quot;/&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;(*) 暴露 &lt;code&gt;2375&lt;/code&gt; 端口，让外部其他程序也能管理 &lt;code&gt;Docker&lt;/code&gt; (打开 &lt;code&gt;Expose daemon on tcp://localhost:2375 without TLS&lt;/code&gt; 前面的复选框)&lt;/li&gt;
&lt;li&gt;在 &lt;code&gt;Resources&lt;/code&gt; 中设置要从哪个 &lt;code&gt;WSL 2&lt;/code&gt; 发行版中访问 &lt;code&gt;Docker&lt;/code&gt;，如下图使用的是 &lt;code&gt;Ubuntu-18.04&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1026866/201912/1026866-20191223085419227-869554952.png&quot; alt=&quot;设置 Docker 访问的发行版&quot;/&gt;&lt;/p&gt;
&lt;p&gt;配置完成之后,点击 &lt;code&gt;Apply &amp;amp; Restart&lt;/code&gt; 应用并重启 &lt;code&gt;Docker Desktop&lt;/code&gt; 。重启完成之后，我们看到 &lt;code&gt;Desktop&lt;/code&gt; 左下脚的 &lt;code&gt;Docker&lt;/code&gt; 状态为绿色的 &lt;code&gt;running&lt;/code&gt; 表示 &lt;code&gt;Docker&lt;/code&gt; 正在运行。&lt;/p&gt;
&lt;p&gt;要想知道自己安装的 &lt;code&gt;Docker&lt;/code&gt; 的相关版本信息，我们可以在 &lt;code&gt;About Docker Desktop&lt;/code&gt; 中看到，如下图所示，目前安装的 &lt;code&gt;Docker Engine&lt;/code&gt; 版本为 &lt;code&gt;19.03.5&lt;/code&gt; ，&lt;code&gt;Docker-compose&lt;/code&gt; 版本为 &lt;code&gt;1.25.1-rc1&lt;/code&gt; ，支持的 &lt;code&gt;Kubernetes&lt;/code&gt; 版本为 &lt;code&gt;v1.15.5&lt;/code&gt; 。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1026866/201912/1026866-20191223085440238-1658556127.png&quot; alt=&quot;查看 Desktop 版本&quot;/&gt;&lt;/p&gt;

&lt;h2 id=&quot;修改-docker-daemon-配置&quot;&gt;修改 &lt;code&gt;Docker daemon&lt;/code&gt; 配置&lt;/h2&gt;
&lt;p&gt;docker 默认 &lt;code&gt;Cgroup Driver&lt;/code&gt; 为 &lt;code&gt;cgroup&lt;/code&gt; ，但是在 &lt;code&gt;kubernetes1.14&lt;/code&gt; 之后的版本推荐使用 &lt;code&gt;systemd&lt;/code&gt; 来作为 &lt;code&gt;Docker&lt;/code&gt; 的 &lt;code&gt;cgroup&lt;/code&gt; 驱动 。使使用 &lt;code&gt;vim /etc/docker/deamon.json&lt;/code&gt; 命令修改或新建配置，具体配置内容可以参考 &lt;a href=&quot;https://kubernetes.io/docs/setup/production-environment/container-runtimes/&quot;&gt;Kubernetes 官方&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;另外我们还需要配置一下 &lt;code&gt;Docker&lt;/code&gt; 国内的镜像源，加速你的镜像下载速度，一般使用的有阿里和中科大的镜像源。上面的两项配置步骤如下&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;# 编辑 deamon 文件
vim /etc/docker/deamon.json

# 输入如下内容
{
  &quot;registry-mirrors&quot;: [&quot;https://6e0d9uoa.mirror.aliyuncs.com&quot;,&quot;https://docker.mirrors.ustc.edu.cn&quot;],
  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],
  &quot;log-driver&quot;: &quot;json-file&quot;,
  &quot;log-opts&quot;: {
    &quot;max-size&quot;: &quot;100m&quot;
  },
  &quot;storage-driver&quot;: &quot;overlay2&quot;
}

# 重启 Docker
sudo service docker restart&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;下载-kubernetes-所需的镜像&quot;&gt;下载 Kubernetes 所需的镜像&lt;/h2&gt;
&lt;p&gt;由于国内网络的问题，如果你不开代理，直接在 &lt;code&gt;Decker Desktop&lt;/code&gt; 中选择启用 &lt;code&gt;Kubernetes&lt;/code&gt; 是启动不了的，还好阿里云容器服务在 &lt;code&gt;Github&lt;/code&gt; 上有开源 &lt;a href=&quot;https://github.com/AliyunContainerService/k8s-for-docker-desktop&quot;&gt;Docker Desktop for Mac/Windows 开启 Kubernetes&lt;/a&gt; 的项目，我们只需要下载下来，执行脚本就能把所有 &lt;code&gt;Kubernetes&lt;/code&gt; 所需要的镜像都下载到本地。&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;#将项目下载到本地
git clone https://github.com/AliyunContainerService/k8s-for-docker-desktop
#进入项目目录
cd k8s-for-docker-desktop

#由于最新 master 已经支持 kubernetes v1.15.5,所以直接执行下载脚本即可
./load_images.sh&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;待所有镜像下载完成之后，我们在使用 &lt;code&gt;docker images&lt;/code&gt; 可以看到下载的容器&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;REPOSITORY                                                       TAG                 IMAGE ID            CREATED             SIZE
k8s.gcr.io/kube-apiserver                                        v1.15.5             e534b1952a0d        2 months ago        207MB
k8s.gcr.io/kube-proxy                                            v1.15.5             cbd7f21fec99        2 months ago        82.4MB
k8s.gcr.io/kube-controller-manager                               v1.15.5             1399a72fa1a9        2 months ago        159MB
k8s.gcr.io/kube-scheduler                                        v1.15.5             fab2dded59dd        2 months ago        81.1MB
quay.io/kubernetes-ingress-controller/nginx-ingress-controller   0.26.1              29024c9c6e70        2 months ago        483MB
docker/kube-compose-controller                                   v0.4.23             a8c3d87a58e7        6 months ago        35.3MB
docker/kube-compose-api-server                                   v0.4.23             f3591b2cb223        6 months ago        49.9MB
k8s.gcr.io/coredns                                               1.3.1               eb516548c180        11 months ago       40.3MB
k8s.gcr.io/kubernetes-dashboard-amd64                            v1.10.1             f9aed6605b81        12 months ago       122MB
k8s.gcr.io/etcd                                                  3.3.10              2c4adeb21b4f        12 months ago       258MB
k8s.gcr.io/pause                                                 3.1                 da86e6ba6ca1        24 months ago       742kB&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;启用-kubernetes&quot;&gt;启用 Kubernetes&lt;/h2&gt;
&lt;p&gt;我们在 &lt;code&gt;Docker Desktop&lt;/code&gt; 的设置中选择启用 &lt;code&gt;kubernetes&lt;/code&gt; ，然后点击 &lt;code&gt;Apply &amp;amp; Restart&lt;/code&gt; 重启。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1026866/201912/1026866-20191223085504077-1835565354.png&quot; alt=&quot;启用 Kubernetes&quot;/&gt;&lt;/p&gt;
&lt;p&gt;如果运气好的话，当你重启之后你就会发现 &lt;code&gt;Desktop&lt;/code&gt; 左下脚 &lt;code&gt;Docker&lt;/code&gt; 和 &lt;code&gt;Kubernetes&lt;/code&gt; 的状态都变成了绿色的 &lt;code&gt;runnning&lt;/code&gt; ，但是很有可能你重启之后， &lt;code&gt;kubernetes&lt;/code&gt; 的状态一直是黄色的 &lt;code&gt;starting&lt;/code&gt; 。出现这种情况不要着急，我们可以在 &lt;code&gt;C:\ProgramData\DockerDesktop&lt;/code&gt;下的 &lt;code&gt;service.txt&lt;/code&gt; 查看启动的日志信息，一般情况下，启动不成功，出现最多的日志信息为下面的重复内容&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;[08:57:24.359][ApiProxy          ][Info   ] time=&quot;2019-12-20T08:57:24+08:00&quot; msg=&quot;cannot list nodes: Get https://kubernetes.docker.internal:6443/api/v1/nodes: EOF&quot;
[08:57:24.359][GoBackendProcess  ][Info   ] time=&quot;2019-12-20T08:57:24+08:00&quot; msg=&quot;external: POST /events 200 \&quot;Go-http-client/1.1\&quot; \&quot;\&quot;&quot;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;出现这种情况，可以参考 &lt;a href=&quot;https://github.com/docker/for-win/issues/3769#issuecomment-486046718&quot;&gt;&lt;code&gt;Issue 3769(comment)&lt;/code&gt;&lt;/a&gt;和 &lt;a href=&quot;https://github.com/docker/for-win/issues/1962#issuecomment-431091114&quot;&gt;&lt;code&gt;Issue 1962(comment)&lt;/code&gt;&lt;/a&gt;，其实总结下来就是下面的几个操作：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;修改 &lt;code&gt;host&lt;/code&gt; 文件，将 &lt;code&gt;127.0.0.1 kubernetes.docker.internal&lt;/code&gt; 映射信息添加到 &lt;code&gt;host&lt;/code&gt; 文件中&lt;/li&gt;
&lt;li&gt;修改网络连接的 &lt;code&gt;DNS&lt;/code&gt; 地址为 &lt;code&gt;8.8.8.8&lt;/code&gt; ， &lt;code&gt;win&lt;/code&gt; 下如何修改网络连接的 &lt;code&gt;DNS&lt;/code&gt; 可以自行百度&lt;/li&gt;
&lt;li&gt;删除 &lt;code&gt;C:\ProgramData\DockerDesktop&lt;/code&gt; 目录下的 &lt;code&gt;pki&lt;/code&gt; 目录文件&lt;/li&gt;
&lt;li&gt;删除 &lt;code&gt;C:\Users\&amp;lt;yourname&amp;gt;目录下&lt;/code&gt; 的&lt;code&gt;.kube&lt;/code&gt; 目录文件&lt;/li&gt;
&lt;li&gt;关闭 &lt;code&gt;win&lt;/code&gt; 的网络防火墙，或者将 &lt;code&gt;vpnkit.exe&lt;/code&gt; 添加到防火墙出入站规则中。&lt;/li&gt;
&lt;li&gt;在 &lt;code&gt;Desktop&lt;/code&gt; 中点击进入 &lt;code&gt;troubleshoot&lt;/code&gt; ，点击重置 &lt;code&gt;kubernetes&lt;/code&gt; 集群(&lt;code&gt;Reset Kubernetes cluster&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1026866/201912/1026866-20191223085520573-1872081967.png&quot; alt=&quot;重置 kubernetes 集群&quot;/&gt;&lt;/p&gt;
&lt;p&gt;如果上述操作一次下来还是不成功，建议重复操作几次。如果出现了其他的问题，一般到 &lt;a href=&quot;https://github.com/docker/for-win/issues&quot;&gt;docker\for-win&lt;/a&gt; 项目的 &lt;code&gt;issue&lt;/code&gt;下可以找到解决方法。如果启动成功了，我们在命令行下执行下面的命令可以验证&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;$ kubectl cluster-info
Kubernetes master is running at https://kubernetes.docker.internal:6443
KubeDNS is running at https://kubernetes.docker.internal:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
$ kubectl get nodes
NAME             STATUS   ROLES    AGE   VERSION
docker-desktop   Ready    master   6h    v1.15.5&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;部署-kubernetes-dashboard&quot;&gt;部署 Kubernetes dashboard&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kubernetes/dashboard&quot;&gt;Kubernetes dashboard&lt;/a&gt;是 &lt;code&gt;Kubernetes&lt;/code&gt;集群的基于 &lt;code&gt;Web&lt;/code&gt;的通用 &lt;code&gt;UI&lt;/code&gt;。它允许用户管理集群中运行的应用程序并对其进行故障排除，以及管理集群本身。执行下面命命令即可部署&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;# 新建 dashboard 资源
kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml

# (*)如果上面命令执行说网络连接有问题，把 yaml 文件下载到本地，然后执行
kubectl apply -f kubernetes-dashboard.yaml

# 开启 API Server 访问代理
kubectl proxy&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;部署完成之后，我们通过如下 &lt;code&gt;URL&lt;/code&gt; 即可访问 &lt;code&gt;Kubernetes dashboard&lt;/code&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;0&quot;&gt;
&lt;p&gt;&lt;a href=&quot;http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login&quot; class=&quot;uri&quot;&gt;http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;进入 &lt;code&gt;Dashboard&lt;/code&gt; 需要令牌，可以通过以下命令获取令牌，将生成的令牌复制粘贴到令牌登录输入框即可。&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;kubectl -n kube-system describe secret default| awk '$1==&quot;token:&quot;{print $2}'&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;下载安装-helm&quot;&gt;下载安装 Helm&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://helm.sh/&quot;&gt;Helm&lt;/a&gt;是 &lt;a href=&quot;https://deis.com/&quot;&gt;Deis&lt;/a&gt; 开发的一个用于 &lt;code&gt;kubernetes&lt;/code&gt; 的包管理器。每个包称为一个 &lt;code&gt;Chart&lt;/code&gt; ， &lt;code&gt;Helm&lt;/code&gt; 客户端安装十分简单，我们可以到 &lt;a href=&quot;https://github.com/helm/helm/releases&quot;&gt;Github&lt;/a&gt;下载最新的可执行程序，解压出来就可以使用了，具体操作步骤可如下：&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;# 下载 v2.16.1 版本
wget https://get.helm.sh/helm-v2.16.1-linux-amd64.tar.gz
# 解压
tar -zxvf helm-v2.16.1-linux-amd64.tar.gz
cd linux-amd64/
# 移动到 /usr/local/bin 目录下
cp helm /usr/local/bin/&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;服务端 &lt;code&gt;tiller&lt;/code&gt; 安装起来就相对来说不是那么容易了，因为要下载墙外的镜像。好在 &lt;code&gt;Docker Hub&lt;/code&gt; 上有别人打包上传的镜像，我们只需要 &lt;code&gt;pull&lt;/code&gt; 下来，打个 &lt;code&gt;tag&lt;/code&gt; 即可，具体步骤如下：&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;# 下载镜像到本地
docker pull doublemine/kubernetes-helm.tiller:v2.16.1
# 添加 tag
docker tag doublemine/kubernetes-helm.tiller:v2.16.1 gcr.io/kubernetes-helm/tiller:v2.16.1&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;服务端的镜像下载到本地之后，我们就可以在集群上安装 &lt;code&gt;tiller&lt;/code&gt; ，我们可以运行下面的命令来创建服务账号和初始化客户端&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;kubectl create serviceaccount tiller -n kube-system
kubectl create clusterrolebinding tiller --clusterrole cluster-admin --serviceaccount kube-system:tiller
helm init --wait --service-account tiller&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;安装和初始化完成之后，我们想要验证 &lt;code&gt;tiller&lt;/code&gt; 服务是否运行，可以使用如下命令&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;$ kubectl get pod --namespace kube-system
NAME                                     READY   STATUS    RESTARTS   AGE
coredns-5c98db65d4-7rn5b                 1/1     Running   0          12h
coredns-5c98db65d4-bx9x2                 1/1     Running   0          12h
etcd-docker-desktop                      1/1     Running   0          12h
kube-apiserver-docker-desktop            1/1     Running   0          12h
kube-controller-manager-docker-desktop   1/1     Running   0          12h
kube-proxy-rdtfm                         1/1     Running   0          12h
kube-scheduler-docker-desktop            1/1     Running   0          12h
kubernetes-dashboard-7d75c474bb-qcbxx    1/1     Running   0          4h46m
tiller-deploy-54f7455d59-fgsnb           1/1     Running   0          12h&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;我们可以看到最后一列显示 &lt;code&gt;tiller&lt;/code&gt; 服务正在运行。&lt;/p&gt;
&lt;h2 id=&quot;helm-配置国内镜像源&quot;&gt;Helm 配置国内镜像源&lt;/h2&gt;
&lt;p&gt;当我们使用 &lt;code&gt;helm&lt;/code&gt; 安装应用的时候，我们会发现下载速度特别慢，还有可能会遇到网络的问题，这种情况我们需要配置其默认下载的镜像源为国内。具体配置步骤如下：&lt;/p&gt;
&lt;pre class=&quot;bash&quot;&gt;
&lt;code&gt;# 删除默认的镜像源
helm repo remove stable
# 增加新的国内镜像源
helm repo add stable http://mirror.azure.cn/kubernetes/charts/
helm repo add incubator http://mirror.azure.cn/kubernetes/charts-incubator/
# 更新仓库
sudo helm repo update

# 测试速度
helm search mysql&lt;/code&gt;
&lt;/pre&gt;</description>
<pubDate>Mon, 23 Dec 2019 00:58:00 +0000</pubDate>
<dc:creator>Dmego</dc:creator>
<og:description>适用于 的 子系统 ( ) 是 新增的功能，使用它可以直接在 上运行 命令。而 是 的一个新版本，它支持适用于 的 子系统在 上运行 二进制文件。 它的主要目标是提高文件系统的性能，并增加系统调用的完</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/dmego/p/12082013.html</dc:identifier>
</item>
<item>
<title>Springboot 系列（十七）迅速使用 Spring Boot Admin 监控你的 Spring Boot 程序 - 未读代码</title>
<link>http://www.cnblogs.com/niumoo/p/12082012.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/niumoo/p/12082012.html</guid>
<description>&lt;h2 id=&quot;spring-boot-admin-是什么&quot;&gt;1. Spring Boot Admin 是什么&lt;/h2&gt;
&lt;p&gt;Spring Boot Admin 是由 &lt;a href=&quot;https://www.cnblogs.com/niumoo/p/github.com/codecentric&quot;&gt;codecentric&lt;/a&gt; 组织开发的开源项目，使用 Spring Boot Admin 可以管理和监控你的 Spring Boot 项目。它分为客户端和服务端两部分，客户端添加到你的 Spring Boot 应用增加暴漏相关信息的 HTTP 接口，然后注册到 Spring Boot Admin 服务端，这一步骤可以直接向服务端注册，也可以通过 Eureka 或者 Consul 进行注册。而 Spring Boot Admin Server 通过 Vue.js 程序监控信息进行可视化呈现。并且支持多种事件通知操作。&lt;/p&gt;
&lt;h2 id=&quot;spring-boot-admin-服务端&quot;&gt;2. Spring Boot Admin 服务端&lt;/h2&gt;
&lt;p&gt;Spring Boot Admin 服务端是基于 Spring Boot 项目的，如何创建一个 Spring Boot 项目这里不提，你可以参考之前文章或者从 &lt;a href=&quot;https://start.spring.io/&quot; class=&quot;uri&quot;&gt;https://start.spring.io/&lt;/a&gt; 直接获得一个 Spring Boot 项目。&lt;/p&gt;
&lt;h3 id=&quot;添加依赖&quot;&gt;2.1. 添加依赖&lt;/h3&gt;
&lt;p&gt;只需要添加 web 依赖和 Spring-boot-admin-starter-server 依赖。&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;de.codecentric&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-admin-starter-server&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;启动配置&quot;&gt;2.2. 启动配置&lt;/h3&gt;
&lt;p&gt;为了和下面的客户端端口不冲突，先修改端口号为 9090。&lt;/p&gt;
&lt;pre class=&quot;yml&quot;&gt;
&lt;code&gt;server:
  port: 9090&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;添加 &lt;code&gt;@EnableAdminServer&lt;/code&gt; 注解启用 Spring Boot Admin Server 功能。&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;@EnableAdminServer
@SpringBootApplication
public class SpringbootAdminServerApplication {

    public static void main(String[] args) {
        SpringApplication.run(SpringbootAdminServerApplication.class, args);
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;服务端已经配置完成，启动项目进行访问就可以看到 Spring Boot Admin Server 的页面了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1202902/201912/1202902-20191223085443777-559119226.png&quot; alt=&quot;Spring Boot Admin Server UI&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;spring-boot-admin-客户端&quot;&gt;3. Spring Boot Admin 客户端&lt;/h2&gt;
&lt;p&gt;创建 Spring Boot 项目依旧不提，这里只需要添加 Spring Boot Admin 客户端需要的依赖，在项目启动时就会增加相关的获取信息的 API 接口。然后在 Spring Boot 配置文件中配置 Spring Boot Admin 服务端，就可以进行监控了。&lt;/p&gt;
&lt;h3 id=&quot;客户端依赖&quot;&gt;3.1 客户端依赖&lt;/h3&gt;
&lt;p&gt;pom.xml&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;de.codecentric&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-admin-starter-client&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;!-- Lombok 工具,与 admin client 无关 --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.projectlombok&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;lombok&amp;lt;/artifactId&amp;gt;
    &amp;lt;optional&amp;gt;true&amp;lt;/optional&amp;gt;
&amp;lt;/dependency&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;客户端配置&quot;&gt;3.2 客户端配置&lt;/h3&gt;
&lt;p&gt;客户端配置主要为了让客户端可以成功向服务端注册，所以需要配置客户端所在应用相关信息以及 Spring Boot Admin Server 服务端的 url。&lt;/p&gt;
&lt;pre class=&quot;yml&quot;&gt;
&lt;code&gt;server:
  port: 8080

spring:
  application:
    # 应用名称
    name: sjfx-api-search
  jmx:
    enabled: true
  boot:
    admin:
      client:
        # 服务端 url
        url: http://127.0.0.1:9090
        instance:
          # 客户端实例 url
          service-url: http://127.0.0.1:8080
          prefer-ip: true
          # 客户端实例名称
          name: sjfx-api-search

management:
  endpoints:
    web:
      exposure:
        # 暴漏的接口 - 所有接口
        include: &quot;*&quot;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;配置中的 &lt;code&gt;include: &quot;*&quot;&lt;/code&gt; 公开了所有的端口，对于生产环境，应该自信的选择要公开的接口。&lt;/p&gt;
&lt;p&gt;Spring Boot Admin 可以获取应用中的定时任务，所以在代码中增加一个定时任务计划，每 20 秒输出一次当前时间，日志级别为 &lt;code&gt;INFO&lt;/code&gt;，用于下面的定时任务和日志监控测试。&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;@Slf4j
@SpringBootApplication
@EnableScheduling
public class SpringbootAdminClientApplication {

    public static void main(String[] args) {
        SpringApplication.run(SpringbootAdminClientApplication.class, args);
    }

    @Scheduled(cron = &quot;0/20 * * * * ?&quot;)
    public void run20s() {
        log.info(&quot;定时任务:{}&quot;, LocalDateTime.now());
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;客户端运行&quot;&gt;3.3. 客户端运行&lt;/h3&gt;
&lt;p&gt;启动客户端会暴漏相关的运行状态接口，并且自动向配置的服务端发送注册信息。&lt;/p&gt;
&lt;p&gt;下面是客户端的启动日志：&lt;/p&gt;
&lt;pre class=&quot;log&quot;&gt;
&lt;code&gt;2019-12-21 22:45:32.878  INFO 13204 --- [           main] n.c.b.SpringbootAdminClientApplication   : Starting SpringbootAdminClientApplication on DESKTOP-8SCFV4M with PID 13204 (D:\IdeaProjectMy\springboot-git\springboot-admin\springboot-admin-client\target\classes started by 83981 in D:\IdeaProjectMy\springboot-git\springboot-admin)
2019-12-21 22:45:32.881  INFO 13204 --- [           main] n.c.b.SpringbootAdminClientApplication   : No active profile set, falling back to default profiles: default
2019-12-21 22:45:33.627  INFO 13204 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
2019-12-21 22:45:33.634  INFO 13204 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2019-12-21 22:45:33.634  INFO 13204 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.29]
2019-12-21 22:45:33.706  INFO 13204 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2019-12-21 22:45:33.706  INFO 13204 --- [           main] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 797 ms
2019-12-21 22:45:33.850  INFO 13204 --- [           main] o.s.b.a.e.web.ServletEndpointRegistrar   : Registered '/actuator/jolokia' to jolokia-actuator-endpoint
2019-12-21 22:45:33.954  INFO 13204 --- [           main] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService 'applicationTaskExecutor'
2019-12-21 22:45:34.089  INFO 13204 --- [           main] o.s.s.c.ThreadPoolTaskScheduler          : Initializing ExecutorService
2019-12-21 22:45:34.117  INFO 13204 --- [           main] o.s.s.c.ThreadPoolTaskScheduler          : Initializing ExecutorService 'taskScheduler'
2019-12-21 22:45:34.120  INFO 13204 --- [           main] o.s.b.a.e.web.EndpointLinksResolver      : Exposing 15 endpoint(s) beneath base path '/actuator'
2019-12-21 22:45:34.162  INFO 13204 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
2019-12-21 22:45:34.163  INFO 13204 --- [           main] n.c.b.SpringbootAdminClientApplication   : Started SpringbootAdminClientApplication in 1.563 seconds (JVM running for 2.131)
2019-12-21 22:45:34.271  INFO 13204 --- [gistrationTask1] d.c.b.a.c.r.ApplicationRegistrator       : Application registered itself as 6bcf19a6bf8c
2019-12-21 22:45:34.293  INFO 13204 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2019-12-21 22:45:34.294  INFO 13204 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2019-12-21 22:45:34.300  INFO 13204 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 6 ms&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;从启动日志里的 &lt;code&gt;Exposing 15 endpoint(s) beneath base path '/actuator'&lt;/code&gt; 这段，可以看到暴漏了 15 个 &lt;code&gt;/actuator&lt;/code&gt; 的 API 接口，可以直接访问查看响应结果。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1202902/201912/1202902-20191223085506858-24970948.png&quot; alt=&quot;Spring Boot Admin Client 监测接口&quot;/&gt;&lt;/p&gt;
&lt;p&gt;从日志 &lt;code&gt;Application registered itself as 6bcf19a6bf8c&lt;/code&gt; 可以看到客户端已经注册成功了。再看服务端可以看到注册上来的一个应用实例。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1202902/201912/1202902-20191223085533952-1395689463.png&quot; alt=&quot;Spring Boot Admin Server&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;spring-boot-admin-功能&quot;&gt;4. Spring Boot Admin 功能&lt;/h2&gt;
&lt;p&gt;点击监控页面上的在线的应用实例，可以跳转到应用实例详细的监控管理页面，也就是 Vue.js 实现的 web 展示。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1202902/201912/1202902-20191223085547587-2109634239.png&quot; alt=&quot;Spring Boot Admin Server 监控页面&quot;/&gt;&lt;/p&gt;
&lt;p&gt;Spring Boot Admin Server 可以监控的功能很多，使用起来没有难度，下面描述下可以监测的部分内容：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;应用运行状态，如时间、垃圾回收次数，线程数量，内存使用走势。&lt;/li&gt;
&lt;li&gt;应用性能监测，通过选择 JVM 或者 Tomcat 参数，查看当前数值。&lt;/li&gt;
&lt;li&gt;应用环境监测，查看系统环境变量，应用配置参数，自动配置参数。&lt;/li&gt;
&lt;li&gt;应用 bean 管理，查看 Spring Bean ，并且可以查看是否单例。&lt;/li&gt;
&lt;li&gt;应用计划任务，查看应用的计划任务列表。&lt;/li&gt;
&lt;li&gt;应用日志管理，动态更改日志级别，查看日志。&lt;/li&gt;
&lt;li&gt;应用 JVM 管理，查看当前线程运行情况，dump 内存堆栈信息。&lt;/li&gt;
&lt;li&gt;应用映射管理，查看应用接口调用方法、返回类型、处理类等信息。&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;上面提到的日志管理，可以动态的更改日志级别，以及查看日志。默认配置下是只可以动态更改日志级别的，如果要在线查看日志，就需要手动配置日志路径了。&lt;/p&gt;
&lt;p&gt;客户端上可以像下面这样配置日志路径以及日志高亮。&lt;/p&gt;
&lt;pre class=&quot;yml&quot;&gt;
&lt;code&gt;# 配置文件：application.yml
logging:
  file:
    name: boot.log
  pattern:
#     日志高亮
    file: '%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(%5p) %clr(${PID}){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n%wEx'&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;下面是在 Spring Boot Admin 监测页面上查看的客户端应用日志。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1202902/201912/1202902-20191223085607019-275936503.png&quot; alt=&quot;Spring Boot Admin Server 查看日志&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;spring-boot-admin-进阶&quot;&gt;5. Spring Boot Admin 进阶&lt;/h2&gt;
&lt;h3 id=&quot;邮件通知&quot;&gt;5.1. 邮件通知&lt;/h3&gt;
&lt;p&gt;Spring Boot Admin Server 支持常见的通知方式，比如邮件通知、电报通知、PagerDuty 通知等，下面将会演示常见的通知方式 - 邮件通知，最后也会演示如何通过监听时间进下设置自定义通知方式。&lt;/p&gt;
&lt;p&gt;Spring Boot Admin Server 的邮件通知通过 Thymeleaf 模板发送 HTML 格式的电子邮件。因此，想要使用邮件通知首先要引入 Thymeleaf 依赖以及 &lt;code&gt;spring-boot-starter-mail&lt;/code&gt; 依赖，并配置邮件发送者信息和接受者信息。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. 添加依赖&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;de.codecentric&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-admin-starter-server&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-starter-mail&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;!-- Thymeleaf 模版，用于发送模版邮件 --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-starter-thymeleaf&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;2. 配置邮件&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;主要设置发送者信息和接收者信息。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;spring:
  boot:
    admin:
      notify:
        mail:
          # 逗号分隔的邮件收件人列表
          to: xxxx@126.com
          # 开启邮箱通知
          enabled: true
          # 不需要发送通知的状态：从状态A:到状态B
          ignore-changes: {&quot;UNKNOWN:UP&quot;}
          # 逗号分隔的抄送收件人列表
          cc: xxxx@126.com
          # 发件人
          from: Spring Boot Admin&amp;lt;xxxx@126.com&amp;gt;
          
# 邮件发送者信息
  mail:
    host: smtp.126.com
    port: 25
    username: xxxx@126.com
    default-encoding: utf-8
    password: xxxx&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;如果想了解更多关于 Spring Boot 邮件发送信息，可以参考 &lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzI1MDIxNjQ1OQ==&amp;amp;mid=2247483764&amp;amp;idx=1&amp;amp;sn=8cee8b1781b8659b3fdc23c0d650db49&amp;amp;chksm=e984e810def3610640e741eea1f94bbf95d4a2a5b1c68946829a036b4a6bc58b0d23e156474a&amp;amp;token=971841717&amp;amp;lang=zh_CN#rd&quot;&gt;Spring Boot 系列文章第十三篇&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;配置好邮件通知之后，重启服务端和客户端，等客户端注册到服务端之后直接终止客户端的运行，稍等片刻就可以在配置的通知接收邮箱里收到客户端实例下线通知了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1202902/201912/1202902-20191223085621781-2139334092.png&quot; alt=&quot;Sping Boot Admin Server 邮件通知&quot;/&gt;&lt;/p&gt;
&lt;p&gt;邮件通知使用的模板存放在 server 依赖的 classpath:/META-INF/spring-boot-admin-server/mail/status-changed.html 路径，如果想要自定义模板内容。可以拷贝这个文件放到自己的 templates 目录下，修改成自己想要的效果，然后在配置中指定自定义模板路径。&lt;/p&gt;
&lt;pre class=&quot;yml&quot;&gt;
&lt;code&gt;spring:
  boot:
    admin:
      notify:
        mail:
          # 自定义邮件模版
          template: classpath:/templates/notify.html&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;自定义通知&quot;&gt;5.2 自定义通知&lt;/h3&gt;
&lt;p&gt;自定义通知只需要自己实现 Spring Boot Admin Server 提供的监听通知类即可，下面会演示如何在实例状态改变时输出实例相关信息。&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Component;

import de.codecentric.boot.admin.server.domain.entities.Instance;
import de.codecentric.boot.admin.server.domain.entities.InstanceRepository;
import de.codecentric.boot.admin.server.domain.events.InstanceEvent;
import de.codecentric.boot.admin.server.domain.events.InstanceStatusChangedEvent;
import de.codecentric.boot.admin.server.notify.AbstractEventNotifier;
import de.codecentric.boot.admin.server.notify.LoggingNotifier;
import reactor.core.publisher.Mono;

@Component
public class CustomNotifier extends AbstractEventNotifier {

    private static final Logger LOGGER = LoggerFactory.getLogger(LoggingNotifier.class);

    public CustomNotifier(InstanceRepository repository) {
        super(repository);
    }

    @Override
    protected Mono&amp;lt;Void&amp;gt; doNotify(InstanceEvent event, Instance instance) {
        return Mono.fromRunnable(() -&amp;gt; {
            if (event instanceof InstanceStatusChangedEvent) {
                LOGGER.info(&quot;Instance {} ({}) is {}&quot;, instance.getRegistration().getName(), event.getInstance(),
                    ((InstanceStatusChangedEvent)event).getStatusInfo().getStatus());
            } else {
                LOGGER.info(&quot;Instance {} ({}) {}&quot;, instance.getRegistration().getName(), event.getInstance(),
                    event.getType());
            }
        });
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;访问限制&quot;&gt;5.2. 访问限制&lt;/h3&gt;
&lt;p&gt;上面提到过，因为客户端增加了暴漏运行信息的相关接口，所以在生产环境中使用存在风险，而服务端没有访问限制，谁的可以访问也是不合理的。&lt;/p&gt;
&lt;p&gt;下面将会为客户端和服务端分别增加访问限制，客户端主要是限制敏感接口的访问权限，服务端则是全局的访问限制。这些访问限制都通过 spring 安全框架 security 来实现，所以首先要为客户端和服务端都增加 maven 依赖。&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-starter-security&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;1. 服务端&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在引入安全框架依赖之后，需要配置访问控制，比如静态资源不需要限制，登录登出页面指定等。&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;import java.util.UUID;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler;
import org.springframework.security.web.csrf.CookieCsrfTokenRepository;
import org.springframework.security.web.util.matcher.AntPathRequestMatcher;
import de.codecentric.boot.admin.server.config.AdminServerProperties;
import io.netty.handler.codec.http.HttpMethod;

@Configuration(proxyBeanMethods = false)
public class SecuritySecureConfig extends WebSecurityConfigurerAdapter {

    private final AdminServerProperties adminServer;

    public SecuritySecureConfig(AdminServerProperties adminServer) {
        this.adminServer = adminServer;
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        // @formatter:off
        SavedRequestAwareAuthenticationSuccessHandler successHandler = new SavedRequestAwareAuthenticationSuccessHandler();
        successHandler.setTargetUrlParameter(&quot;redirectTo&quot;);
        successHandler.setDefaultTargetUrl(this.adminServer.path(&quot;/&quot;));

        http.authorizeRequests()
                .antMatchers(this.adminServer.path(&quot;/assets/**&quot;)).permitAll()
                .antMatchers(this.adminServer.path(&quot;/login&quot;)).permitAll()
                .anyRequest().authenticated()
                .and()
                .formLogin().loginPage(this.adminServer.path(&quot;/login&quot;)).successHandler(successHandler).and()
                .logout().logoutUrl(this.adminServer.path(&quot;/logout&quot;)).and()
                .httpBasic().and()
                .csrf()
                .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())
                .ignoringRequestMatchers(
                        new AntPathRequestMatcher(this.adminServer.path(&quot;/instances&quot;), HttpMethod.POST.toString()),
                        new AntPathRequestMatcher(this.adminServer.path(&quot;/instances/*&quot;), HttpMethod.DELETE.toString()),
                        new AntPathRequestMatcher(this.adminServer.path(&quot;/actuator/**&quot;))
                )
                .and()
                .rememberMe().key(UUID.randomUUID().toString()).tokenValiditySeconds(1209600);
        // @formatter:on
    }

    // 代码配置用户名和密码的方式
    // Required to provide UserDetailsService for &quot;remember functionality&quot;
    // @Override
    // protected void configure(AuthenticationManagerBuilder auth) throws Exception {
    // auth.inMemoryAuthentication().withUser(&quot;user&quot;).password(&quot;{noop}password&quot;).roles(&quot;USER&quot;);
    // }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;在 application.yml 配置文件中配置用户名和密码。&lt;/p&gt;
&lt;pre class=&quot;yml&quot;&gt;
&lt;code&gt;spring:
  security:
    user:
      name: user
      password: 123&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;重启服务端，再次访问就需要用户名和密码进行登录了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1202902/201912/1202902-20191223085639522-110364693.png&quot; alt=&quot;Spring Boot Admin Server 登录&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. 客户端&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;客户端在引入安全框架之后，也需要配置访问权限，主要是配置哪些路径可以访问，哪些路径访问需要登录限制，默认所有接口都需要登录限制。&lt;/p&gt;
&lt;p&gt;同样的，客户端应用也需要在配置中配置客户端应用对于敏感接口的登录用户和密码，同时需要配置 Spring Boot Admin Server 的访问用户和密码，还要把自身的用户和密码注册时告诉服务端，不然服务端不能获取到监测数据。&lt;/p&gt;
&lt;pre class=&quot;yml&quot;&gt;
&lt;code&gt;spring:
  security:
    user:
      # 客户端敏感接口用户和密码
      name: client
      password: 123
  application:
    # 应用名称
    name: sjfx-api-search
  jmx:
    enabled: true
  boot:
    admin:
      client:
        # 服务端 url
        url: http://127.0.0.1:9090
        instance:
          # 客户端实例 url
          service-url: http://127.0.0.1:8080
          prefer-ip: true
          # 客户端实例名称
          name: sjfx-api-search
          metadata:
            # 客户端自身的用户和密码告诉服务端
            user.name: client
            user.password: 123
        # 服务端用户名密码
        username: user
        password: 123&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;客户端敏感接口访问测试。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1202902/201912/1202902-20191223085652842-324418142.png&quot; alt=&quot;客户端应用访问&quot;/&gt;&lt;/p&gt;
&lt;p&gt;到这里，客户端的敏感接口访问需要登录，服务端的管理页面也需要登录，客户端和服务端的访问控制已经完成了。&lt;/p&gt;
&lt;p&gt;文中代码已经上传到：&lt;a href=&quot;https://www.cnblogs.com/niumoo/p/github.com/niumoo/springboot/tree/master/springboot-admin&quot; class=&quot;uri&quot;&gt;github.com/niumoo/springboot/tree/master/springboot-admin&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;参考资料：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/codecentric/spring-boot-admin&quot; class=&quot;uri&quot;&gt;https://github.com/codecentric/spring-boot-admin&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://codecentric.github.io/spring-boot-admin/current/&quot; class=&quot;uri&quot;&gt;https://codecentric.github.io/spring-boot-admin/current/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&amp;lt;完&amp;gt;&lt;br/&gt;个人网站：&lt;a href=&quot;https://www.codingme.net&quot; class=&quot;uri&quot;&gt;https://www.codingme.net&lt;/a&gt;&lt;br/&gt;如果你喜欢这篇文章，可以关注公众号，一起成长。&lt;br/&gt;关注公众号回复资源可以没有套路的获取全网最火的的 Java 核心知识整理&amp;amp;面试核心资料。&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1202902/201911/1202902-20191126090837925-1632441965.jpg&quot; alt=&quot;公众号&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Mon, 23 Dec 2019 00:58:00 +0000</pubDate>
<dc:creator>未读代码</dc:creator>
<og:description>1. Spring Boot Admin 是什么 Spring Boot Admin 是由 'codecentric' 组织开发的开源项目，使用 Spring Boot Admin 可以管理和监控你的</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/niumoo/p/12082012.html</dc:identifier>
</item>
<item>
<title>Spring Cloud第十二篇 | 消息总线Bus - 程序开发者社区</title>
<link>http://www.cnblogs.com/coding-farmer/p/12080563.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/coding-farmer/p/12080563.html</guid>
<description>&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;22&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X2dpZi9jWmtJOE0wbmJDa1h6VGVEV2VwSGJod1hESUZKazdzUFdDdlBVTTQ5SUY1NHNTYkZwOUNlNFlSNjlmWHA0SkxTQUNpYnlNZnBCaWFGU21oWnBJWFBYdUx3LzY0MA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X2dpZi9jWmtJOE0wbmJDa1h6VGVEV2VwSGJod1hESUZKazdzUFdDdlBVTTQ5SUY1NHNTYkZwOUNlNFlSNjlmWHA0SkxTQUNpYnlNZnBCaWFGU21oWnBJWFBYdUx3LzY0MA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_gif/cZkI8M0nbCkXzTeDWepHbhwXDIFJk7sPWCvPUM49IF54sSbFp9Ce4YR69fXp4JLSACibyMfpBiaFSmhZpIXPXuLw/640?wx_fmt=gif&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;​本文是Spring Cloud专栏的&lt;span&gt;第十二篇&lt;/span&gt;文章，了解&lt;span&gt;前十一篇&lt;/span&gt;文章内容有助于更好的理解本文：&lt;/p&gt;
&lt;ol readability=&quot;0.13093289689034&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484047&amp;amp;idx=1&amp;amp;sn=d13d8e41bf9476dec16d6053229e90ad&amp;amp;chksm=cf9d8ed8f8ea07ce0827d83e676ebd31e403a006023d567e49426e508e85fb886da006915e24&amp;amp;scene=21#wechat_redirect&quot; data-cke-saved-href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484047&amp;amp;idx=1&amp;amp;sn=d13d8e41bf9476dec16d6053229e90ad&amp;amp;chksm=cf9d8ed8f8ea07ce0827d83e676ebd31e403a006023d567e49426e508e85fb886da006915e24&amp;amp;scene=21#wechat_redirect&quot;&gt;Spring Cloud第一篇 | Spring Cloud前言及其常用组件介绍概览&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484049&amp;amp;idx=1&amp;amp;sn=376c5b50e62239852a75ded77c8b0ca0&amp;amp;chksm=cf9d8ec6f8ea07d0d4a45ac1576b2d141839debb8fd32765ae70c0f14bf5839f69d0d59162a4&amp;amp;scene=21#wechat_redirect&quot; data-cke-saved-href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484049&amp;amp;idx=1&amp;amp;sn=376c5b50e62239852a75ded77c8b0ca0&amp;amp;chksm=cf9d8ec6f8ea07d0d4a45ac1576b2d141839debb8fd32765ae70c0f14bf5839f69d0d59162a4&amp;amp;scene=21#wechat_redirect&quot;&gt;Spring Cloud第二篇 | 使用并认识Eureka注册中心&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484067&amp;amp;idx=1&amp;amp;sn=c607a2c96e2d084de3e2b30e184cfbf8&amp;amp;chksm=cf9d8ef4f8ea07e20c572f6a21ae49f5ba28a7906e48422cbaa8a3f65906a0b68d2213417869&amp;amp;scene=21#wechat_redirect&quot; data-cke-saved-href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484067&amp;amp;idx=1&amp;amp;sn=c607a2c96e2d084de3e2b30e184cfbf8&amp;amp;chksm=cf9d8ef4f8ea07e20c572f6a21ae49f5ba28a7906e48422cbaa8a3f65906a0b68d2213417869&amp;amp;scene=21#wechat_redirect&quot;&gt;Spring Cloud第三篇 | 搭建高可用Eureka注册中心&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484075&amp;amp;idx=1&amp;amp;sn=fbb877838f8d92ea73bd0148805f8343&amp;amp;chksm=cf9d8efcf8ea07eacdb44bedb9d429b7c3e5aa026aa6326e8976593af15688c417e0d01dea79&amp;amp;scene=21#wechat_redirect&quot; data-cke-saved-href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484075&amp;amp;idx=1&amp;amp;sn=fbb877838f8d92ea73bd0148805f8343&amp;amp;chksm=cf9d8efcf8ea07eacdb44bedb9d429b7c3e5aa026aa6326e8976593af15688c417e0d01dea79&amp;amp;scene=21#wechat_redirect&quot;&gt;Spring Cloud第四篇 | 客户端负载均衡Ribbon&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484076&amp;amp;idx=1&amp;amp;sn=a5a5368a831b73393261a26dd434d1f2&amp;amp;chksm=cf9d8efbf8ea07edcb935572a5883cc67f407e5d9c8340b2b5db90d1584a029500c024733651&amp;amp;scene=21#wechat_redirect&quot; data-cke-saved-href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484076&amp;amp;idx=1&amp;amp;sn=a5a5368a831b73393261a26dd434d1f2&amp;amp;chksm=cf9d8efbf8ea07edcb935572a5883cc67f407e5d9c8340b2b5db90d1584a029500c024733651&amp;amp;scene=21#wechat_redirect&quot;&gt;Spring Cloud第五篇 | 服务熔断Hystrix&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484077&amp;amp;idx=1&amp;amp;sn=a8efe35a9678e61ed21c11f3903523ac&amp;amp;chksm=cf9d8efaf8ea07ec4be24b7b67094d99fee5e3863a27f9b5e863c356d4058aa30960b030e4a3&amp;amp;scene=21#wechat_redirect&quot; data-cke-saved-href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484077&amp;amp;idx=1&amp;amp;sn=a8efe35a9678e61ed21c11f3903523ac&amp;amp;chksm=cf9d8efaf8ea07ec4be24b7b67094d99fee5e3863a27f9b5e863c356d4058aa30960b030e4a3&amp;amp;scene=21#wechat_redirect&quot;&gt;Spring Cloud第六篇 | Hystrix仪表盘监控Hystrix Dashboard&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484078&amp;amp;idx=1&amp;amp;sn=4fbc7c9d9ae635412c0c3f6aa25537b0&amp;amp;chksm=cf9d8ef9f8ea07efdbbb52f179a9eea277d430d17494a43b67e0b8a37290702cc0bd3a561ec0&amp;amp;scene=21#wechat_redirect&quot; data-cke-saved-href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484078&amp;amp;idx=1&amp;amp;sn=4fbc7c9d9ae635412c0c3f6aa25537b0&amp;amp;chksm=cf9d8ef9f8ea07efdbbb52f179a9eea277d430d17494a43b67e0b8a37290702cc0bd3a561ec0&amp;amp;scene=21#wechat_redirect&quot;&gt;Spring Cloud第七篇 | 声明式服务调用Feign&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484080&amp;amp;idx=1&amp;amp;sn=bfd6cb072a620595cc24dd86cc1ee745&amp;amp;chksm=cf9d8ee7f8ea07f15b01373ad00b4250f68672a0aaa9c7b56e5193ac996aca4bb93e8e46374b&amp;amp;scene=21#wechat_redirect&quot; data-cke-saved-href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484080&amp;amp;idx=1&amp;amp;sn=bfd6cb072a620595cc24dd86cc1ee745&amp;amp;chksm=cf9d8ee7f8ea07f15b01373ad00b4250f68672a0aaa9c7b56e5193ac996aca4bb93e8e46374b&amp;amp;scene=21#wechat_redirect&quot;&gt;Spring Cloud第八篇 | Hystrix集群监控Turbin&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484104&amp;amp;idx=1&amp;amp;sn=f9234818335fbecd10a35a615865c1e4&amp;amp;chksm=cf9d8e9ff8ea0789b8d103bee952485c588ce9464dde6a178a025fa4ceca7ef72ce3ba3bc669&amp;amp;scene=21#wechat_redirect&quot; data-cke-saved-href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484104&amp;amp;idx=1&amp;amp;sn=f9234818335fbecd10a35a615865c1e4&amp;amp;chksm=cf9d8e9ff8ea0789b8d103bee952485c588ce9464dde6a178a025fa4ceca7ef72ce3ba3bc669&amp;amp;scene=21#wechat_redirect&quot;&gt;Spring Cloud第九篇 | 分布式服务跟踪Sleuth&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484105&amp;amp;idx=1&amp;amp;sn=7794a4ad0b5d8568994fb349c43ed572&amp;amp;chksm=cf9d8e9ef8ea0788bcd08990197af0bdc341d796fd4247298e9ba0c2ad3f3034a00660a09660&amp;amp;scene=21#wechat_redirect&quot; data-cke-saved-href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484105&amp;amp;idx=1&amp;amp;sn=7794a4ad0b5d8568994fb349c43ed572&amp;amp;chksm=cf9d8e9ef8ea0788bcd08990197af0bdc341d796fd4247298e9ba0c2ad3f3034a00660a09660&amp;amp;scene=21#wechat_redirect&quot;&gt;Spring Cloud第十篇 | 分布式配置中心Config&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484107&amp;amp;idx=1&amp;amp;sn=2b26f2c35b2a32fe50174f982b28a475&amp;amp;chksm=cf9d8e9cf8ea078ae7c2da038f37aade2ca0b480983cdda0122ce1253933d4da7ab60508f0e3&amp;amp;scene=21#wechat_redirect&quot; data-cke-saved-href=&quot;http://mp.weixin.qq.com/s?__biz=Mzg4NjIzNDQyNA==&amp;amp;mid=2247484107&amp;amp;idx=1&amp;amp;sn=2b26f2c35b2a32fe50174f982b28a475&amp;amp;chksm=cf9d8e9cf8ea078ae7c2da038f37aade2ca0b480983cdda0122ce1253933d4da7ab60508f0e3&amp;amp;scene=21#wechat_redirect&quot;&gt;Spring Cloud第十一篇 | 分布式配置中心高可用&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;21&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X2dpZi9MamliNFNvN3l1V2hMaWJpY2dWZkJqRjlraWF0d2g3Q2pDUmd2SGNsNDFwSDhmcG1tTjA0TEd4cnllM3ZmcHNqUWI1Y3dodHlpYXhpYlphd016Zzg3QVRJTjd4Zy82NDA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X2dpZi9MamliNFNvN3l1V2hMaWJpY2dWZkJqRjlraWF0d2g3Q2pDUmd2SGNsNDFwSDhmcG1tTjA0TEd4cnllM3ZmcHNqUWI1Y3dodHlpYXhpYlphd016Zzg3QVRJTjd4Zy82NDA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWhLibicgVfBjF9kiatwh7CjCRgvHcl41pH8fpmmN04LGxrye3vfpsjQb5cwhtyiaxibZawMzg87ATIN7xg/640?wx_fmt=gif&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;    由于在没有使用消息总线的时候，我们如果需要修改某个配置，如果涉及修改的微服务节点比较多，我们需要手动的一个节点一个节点的刷新非常麻烦，在微服务架构的系统中，我们通常会使用轻量级的消息代理来构建一个共用的消息主题让系统中所有微服务实例都连接上来，由于该主题中产生的消息会被所有实例监听和消费，所以我们称它为消息总线。在总线上的各个实例都可以方便地广播一些需要让其他连接在该主题上的实例都知道的消息，例如配置信息的变更或者其他一些管理操作等。&lt;/p&gt;
&lt;p&gt;    由于消息总线在微服务架构系统中被广泛使用，所以它同配置中心一样，几乎是微服务架构中的必备组件。Spring Cloud作为微服务架构综合性的解决方案，对此自然也有自己的实现，通过使用Spring Cloud Bus可以非常容易地搭建起消息总线，同时实现了一些消息总线中的常用功能，比如配合Spring Cloud Config实现微服务应用配置信息的动态更新等，架构如图所示：    &lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;20&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X2pwZy9TdmRrbGliVFRzU0hQdGJ5SHQwWTg4QUVoNlphU0hoanQ2dkY1MWw5UHNpYllnV1pwUjhFQWJ4S1dkMDJkYlJJWGx5eUJ6R1JZUGhoQjVGRnQ5enFHUEdBLzY0MA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X2pwZy9TdmRrbGliVFRzU0hQdGJ5SHQwWTg4QUVoNlphU0hoanQ2dkY1MWw5UHNpYllnV1pwUjhFQWJ4S1dkMDJkYlJJWGx5eUJ6R1JZUGhoQjVGRnQ5enFHUEdBLzY0MA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_jpg/SvdklibTTsSHPtbyHt0Y88AEh6ZaSHhjt6vF51l9PsibYgWZpR8EAbxKWd02dbRIXlyyBzGRYPhhB5FFt9zqGPGA/640?wx_fmt=jpeg&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;    目前版本，Spring Cloud Bus仅支持两款中间件产品，RabbitMQ和Kafka，本案例使用RabbitMQ实现Spring Cloud Bus的应用&lt;/p&gt;
&lt;p&gt;    RabbitMQ安装步骤以及使用自行百度啦。。。&lt;/p&gt;

&lt;p&gt;1、修改以前的springcloud-config-server，springcloud-config-client块添加消息总线依赖，actuator依赖在前几篇案例中已经在父模块(springcloud-learn)中引入，此处不需要再次引入&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&amp;lt;!--&lt;/span&gt;&lt;span&gt;spring cloud bus 整合rabbitmq &lt;/span&gt;&lt;span&gt;--&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;org.springframework.cloud&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;spring-cloud-starter-bus-amqp&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;2、rabbitmq服务地址：http://47.112.11.147:15672/  rabbitmq用户名为：admin密码为：123456&lt;/p&gt;
&lt;p&gt;3、在springcloud-config-server模块基础上往application.yml添加bus和rabbitmq的相关配置以及暴露bus-refresh端点&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;spring:
  cloud:
    bus:
      #控制bus消息总线是否能用
      enabled: true
      #打开bus追踪
      trace:
        enabled: true
  rabbitmq:
    addresses: 47.112.11.147
    port: 5672
    username: admin
    password: 123456
    virtual-host: /
management:
  endpoints:
    web:
      exposure:
        include: [&quot;info&quot;,&quot;health&quot;,&quot;bus-refresh&quot;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;4、在springcloud-config-client模块基础上往application.yml添加rabbitmq相关配置就行了&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;spring:
 rabbitmq:
  addresses: 47.112.11.147
  port: 5672
  username: admin
  password: 123456
  virtual-host: /&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;5、启动配置中心服务端(springcloud-config-server)查看bus相应的转换器Exchange以及Type对应的topic，并且同时在控制台上通过日志可以看到bus-refresh端点暴露出来了&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;19&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0VKN1hGZFBHREJCaWJjbFkxVWlicXowdWJpYkd1aWI2QlhpYmhYMkJ4ZXlMT1RyNGZESWQzWmpVR0tVcHcwaWFtaWFzVVBCbmljWW9MWHNpYXZ1SEEvNjQw?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0VKN1hGZFBHREJCaWJjbFkxVWlicXowdWJpYkd1aWI2QlhpYmhYMkJ4ZXlMT1RyNGZESWQzWmpVR0tVcHcwaWFtaWFzVVBCbmljWW9MWHNpYXZ1SEEvNjQw?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSEJ7XFdPGDBBibclY1Uibqz0ubibGuib6BXibhX2BxeyLOTr4fDId3ZjUGKUpw0iamiasUPBnicYoLXsiavuHA/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;RabbitMQ的Topic模式如图所示：&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;18&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFZcUhGWnF4am83YzVSV0JkRGRPNEIzaWJZSnZHY1VkYkRBb25VQUszVEhjclM1ZTlOUW5UdVVnLzY0MA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFZcUhGWnF4am83YzVSV0JkRGRPNEIzaWJZSnZHY1VkYkRBb25VQUszVEhjclM1ZTlOUW5UdVVnLzY0MA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1RaYqHFZqxjo7c5RWBdDdO4B3ibYJvGcUdbDAonUAK3THcrS5e9NQnTuUg/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;如果不懂RabbitMQ的话也不影响你的Bus使用&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;17&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFtWTlQUHNyc2x6Z0FHTjFqSGliSEpNeDNEamhrb2xUOWE4bjBTNDlKN2d0QXpPU24yS1hpY1N0Zy82NDA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFtWTlQUHNyc2x6Z0FHTjFqSGliSEpNeDNEamhrb2xUOWE4bjBTNDlKN2d0QXpPU24yS1hpY1N0Zy82NDA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1RamY9PPsrslzgAGN1jHibHJMx3DjhkolT9a8n0S49J7gtAzOSn2KXicStg/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;查看rabbitmq控制台看到bus相应对列创建了&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;16&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFZbElSZUhqcDhlcGljWDdBZUxibGRGZXlZZUFiQkJ2UW5hdjNSM0haWThTQnFQazI5U09MVlpRLzY0MA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFZbElSZUhqcDhlcGljWDdBZUxibGRGZXlZZUFiQkJ2UW5hdjNSM0haWThTQnFQazI5U09MVlpRLzY0MA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1RaYlIReHjp8epicX7AeLbldFeyYeAbBBvQnav3R3HZY8SBqPk29SOLVZQ/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;查看绑定关系，springcloud bus相应对列已经绑定到了springcloud bus转换器上了&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;15&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFHY1NBRjlOc1lPbmlhbW90TmF6d0UxTXFIZE1NdFp2UmFDdWZkdlVGcjByWjlNZ1d6NE9CRWpRLzY0MA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFHY1NBRjlOc1lPbmlhbW90TmF6d0UxTXFIZE1NdFp2UmFDdWZkdlVGcjByWjlNZ1d6NE9CRWpRLzY0MA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1RaGcSAF9NsYOniamotNazwE1MqHdMMtZvRaCufdvUFr0rZ9MgWz4OBEjQ/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;6、启动配置中心客户端(springcloud-config-client)可以看到该对列也绑定到spirngcloud bus转换器上了&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;14&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFBb0xCOGpxZ3BvTUZtVUlBUzRMbEsyZlFodU9MRHpTamZQcXM1Y0thblhXUTVPQUtnbXJoTkEvNjQw?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFBb0xCOGpxZ3BvTUZtVUlBUzRMbEsyZlFodU9MRHpTamZQcXM1Y0thblhXUTVPQUtnbXJoTkEvNjQw?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1RaAoLB8jqgpoMFmUIAS4LlK2fQhuOLDzSjfPqs5cKanXWQ5OAKgmrhNA/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;7、我们在复制springcloud-config-client的配置，新建文件bootstrap-configclient8882.yml配置文件如下,创键启动类启动SpringcloudConfigClient8882Application&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;server:
  port: 8882
spring:
  application:
    name: springcloud-config-client
  cloud:
    config:
      #uri则表示配置中心的地址
      #uri: http://localhost:8888
      #注：config 客户端在没有 spring.cloud.config.name属性的时候，服务端{application} 获取的是客户端
      #spring.application.name的值，否则，获取的是 spring.cloud.config.name的值。
      #1）、当没有spring.cloud.config.name时，客户端获取的是spring.application.name 所对应的git库中的文件，并且只能
      #获取一个文件，
      #2）、当一个项目中有需求要获取多个文件时，就需要用到spring.cloud.config.name这个属性，以逗号分割
      name: configclient
      profile: dev
      #label对应了label部分
      label: master
#      username: coding-farmer
#      password: 123456
      discovery:
        #表示开启通过服务名来访问config-server
        enabled: true
        #则表示config-server的服务名
        service-id: springcloud-config-server
      #失败快速响应
      fail-fast: true
      retry:
        #配置重试次数，默认为6
        max-attempts: 6
        #初始重试间隔时间，默认1000ms
        initial-interval: 1000
        #间隔乘数，默认1.1
        multiplier: 1.1
        #最大间隔时间，默认2000ms
        max-interval: 2000
  rabbitmq:
    addresses: 47.112.11.147
    port: 5672
    username: admin
    password: 123456
    virtual-host: /
eureka:
  client:
    service-url:
      defaultZone: http://localhost:8700/eureka
    #客户端每隔30秒从Eureka服务上更新一次服务信息
    registry-fetch-interval-seconds: 30
    #需要将我的服务注册到eureka上
    register-with-eureka: true
    #需要检索服务
    fetch-registry: true
  #心跳检测检测与续约时间
  instance:
    #告诉服务端，如果我10s之内没有给你发心跳，就代表我故障了，将我剔除掉，默认90s
    #Eureka服务端在收到最后一次心跳之后等待的时间上限，单位为秒，超过则剔除（客户端告诉服务端按照此规则等待自己）
    lease-expiration-duration-in-seconds: 10
    #每隔2s向服务端发送一次心跳，证明自已依然活着，默认30s
    #Eureka客户端向服务端发送心跳的时间间隔，单位为秒（客户端告诉服务端自己会按照该规则）
    lease-renewal-interval-in-seconds: 2
    # 启用ip配置 这样在注册中心列表中看见的是以ip+端口呈现的
    prefer-ip-address: true
    # 实例名称  最后呈现地址：ip:2002
    instance-id: ${spring.cloud.client.ip-address}:${server.port}
management:
  endpoints:
    web:
      exposure:
        include: [&quot;info&quot;,&quot;health&quot;,&quot;refresh&quot;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;8、码云仓库值默认如下&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;13&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFhRjJwTW0wam0zQTV6M0JmaEFFQmRpYk5iWll5TXJ3d3U3a1pGWk9QZ25iUmgxUUtPVnBOV2dBLzY0MA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFhRjJwTW0wam0zQTV6M0JmaEFFQmRpYk5iWll5TXJ3d3U3a1pGWk9QZ25iUmgxUUtPVnBOV2dBLzY0MA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1RaaF2pMm0jm3A5z3BfhAEBdibNbZYyMrwwu7kZFZOPgnbRh1QKOVpNWgA/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;访问http://localhost:8881/index&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;12&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFud3BwZmRuWVlSWWliSEwyNkZtMlF1d2liamh1QlZpY28yS2xJOVBoZ1JVTzRrUVJ1enpjMHVQMUEvNjQw?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFud3BwZmRuWVlSWWliSEwyNkZtMlF1d2liamh1QlZpY28yS2xJOVBoZ1JVTzRrUVJ1enpjMHVQMUEvNjQw?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1RanwppfdnYYRYibHL26Fm2QuwibjhuBVico2KlI9PhgRUO4kQRuzzc0uP1A/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;访问http://localhost:8882/index&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;11&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFxcTl1ME5nVEhjN2pXOXV6UnoyV1pYSGtOV2E2WnJHd1llWk8yNjN2TmU5VG9PeDV3NVZTb2cvNjQw?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFxcTl1ME5nVEhjN2pXOXV6UnoyV1pYSGtOV2E2WnJHd1llWk8yNjN2TmU5VG9PeDV3NVZTb2cvNjQw?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1Raqq9u0NgTHc7jW9uzRz2WZXHkNWa6ZrGwYeZO263vNe9ToOx5w5VSog/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;9、修改仓库内容&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;10&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFTdlh3aWEzVVFDb29LS3dwV0d5bmZtcnBpYUNZdGVjMnVYVG9BbGduN1BOckNMT1FpYkUyOFJmc3cvNjQw?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFTdlh3aWEzVVFDb29LS3dwV0d5bmZtcnBpYUNZdGVjMnVYVG9BbGduN1BOckNMT1FpYkUyOFJmc3cvNjQw?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1RaSvXwia3UQCooKKwpWGynfmrpiaCYtec2uXToAlgn7PNrCLOQibE28Rfsw/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;然后向springcloud-config-server服务bus-refresh端点发送POST请求http://localhost:8888/actuator/bus-refresh&lt;/p&gt;
&lt;p&gt;10、再次访问客户端8881,882显示如下&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;9&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFPWXZVRHM5d3RTRGliWDdZcGVBTDJpYWliUnhMZ2MwcmliS0tUNnd5YXBzNUZ1eG5mTGM5NXVzS0x3LzY0MA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFPWXZVRHM5d3RTRGliWDdZcGVBTDJpYWliUnhMZ2MwcmliS0tUNnd5YXBzNUZ1eG5mTGM5NXVzS0x3LzY0MA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1RaOYvUDs9wtSDibX7YpeAL2iaibRxLgc0ribKKT6wyaps5FuxnfLc95usKLw/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;8&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFGTEdyR1pnNlZIWk5VTXJ1emliZXdtb0ZLb1o4U2tZUWF2V2ZPak5WZ3A2VXBUWnlkelNlZlRRLzY0MA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFGTEdyR1pnNlZIWk5VTXJ1emliZXdtb0ZLb1o4U2tZUWF2V2ZPak5WZ3A2VXBUWnlkelNlZlRRLzY0MA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1RaFLGrGZg6VHZNUMruzibewmoFKoZ8SkYQavWfOjNVgp6UpTZydzSefTQ/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;    在上面案例中我们看到当你触发/actuator/bus-refresh端点时，它就会刷新所有实例的服务配置，有时候我们可能只需要刷新某个具体的实例。&lt;/p&gt;
&lt;p&gt;    Spring Cloud Bus对这种场景也有很好的支持，/actuator/bus-refresh/{destination}接口提供了一个destination参数，RESTFUL风格请求，用来定位具体要刷新的应用程序。比如：我们可以请求/actuator/bus-refresh/springcloud-config-client:8882，此时总线上的各应用实例会根据destination属性的值来判断是否为自己的实例名，若符合才进行配置刷新，若不符合就忽略该消息。&lt;/p&gt;
&lt;p&gt;    destination参数除了可以定位具体的实例之外，还可以用来定位具体的服务。定位服务的原理是通过使用Spring的PathMatecher(路径匹配)来实现的，比如/actuator/bus-refresh/springcloud-config-client:**,该请求会触发customers服务的所有实例进行刷新。&lt;/p&gt;
&lt;p&gt;1、以前仓库信息为：&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;7&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFTdlh3aWEzVVFDb29LS3dwV0d5bmZtcnBpYUNZdGVjMnVYVG9BbGduN1BOckNMT1FpYkUyOFJmc3cvNjQw?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFTdlh3aWEzVVFDb29LS3dwV0d5bmZtcnBpYUNZdGVjMnVYVG9BbGduN1BOckNMT1FpYkUyOFJmc3cvNjQw?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1RaSvXwia3UQCooKKwpWGynfmrpiaCYtec2uXToAlgn7PNrCLOQibE28Rfsw/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;例如：修改为如下&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;6&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmF4NnNUbkExSUFZVWljZWtGOW5sbjE4cFRaTWs5U0dzVzEzS0wxYTBOaWIyTlZwaWNTOWljVWx0eHZRLzY0MA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmF4NnNUbkExSUFZVWljZWtGOW5sbjE4cFRaTWs5U0dzVzEzS0wxYTBOaWIyTlZwaWNTOWljVWx0eHZRLzY0MA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1Rax6sTnA1IAYUicekF9nln18pTZMk9SGsW13KL1a0Nib2NVpicS9icUltxvQ/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;2、向http://localhost:8888/actuator/bus-refresh/springcloud-config-client:8882发送POST请求&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;5&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFqaWI5QWtnZ3phMXlTb0ZZZnRYU3JuRk42dThtYnhpY2xSTjlpY1BIUHFXYVB0aWI3d2NseVdZWHF3LzY0MA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFqaWI5QWtnZ3phMXlTb0ZZZnRYU3JuRk42dThtYnhpY2xSTjlpY1BIUHFXYVB0aWI3d2NseVdZWHF3LzY0MA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1Rajib9Akggza1ySoFYftXSrnFN6u8mbxiclRN9icPHPqWaPtib7wclyWYXqw/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;3、访问客户端8881，8882服务内容如下&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;4&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFPWXZVRHM5d3RTRGliWDdZcGVBTDJpYWliUnhMZ2MwcmliS0tUNnd5YXBzNUZ1eG5mTGM5NXVzS0x3LzY0MA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFPWXZVRHM5d3RTRGliWDdZcGVBTDJpYWliUnhMZ2MwcmliS0tUNnd5YXBzNUZ1eG5mTGM5NXVzS0x3LzY0MA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1RaOYvUDs9wtSDibX7YpeAL2iaibRxLgc0ribKKT6wyaps5FuxnfLc95usKLw/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;3&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFkSDJhSEthTW4yaWN0Y29nb2lhcThFTWtpYWRnaWNvekFNb1daRjYyMEh0dWZJRkRUZmVFRUhmNWJRLzY0MA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0g1dFdjYVVidm02NVZxdFFZVkMxUmFkSDJhSEthTW4yaWN0Y29nb2lhcThFTWtpYWRnaWNvekFNb1daRjYyMEh0dWZJRkRUZmVFRUhmNWJRLzY0MA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSH5tWcaUbvm65VqtQYVC1RadH2aHKaMn2ictcogoiaq8EMkiadgicozAMoWZF620HtufIFDTfeEEHf5bQ/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;    使用/actuator/bus-refresh发送到我们其中一个config-client中也能刷新配置(前提是该客户端的bus-refresh端点需要暴露出来)，但是这样这个实例就跟其他实例不一样了，它还额外承担了刷新配置的功能。所以，我们将发送post请求刷新配置的任务交由config-server配置服务中心来处理，这样所有服务实例都是对等的，由配置服务中心发送消息通知消息总线更新整个集群中的配置。这样，服务实例就不需要再承担触发配置更新的任务。尽可能让服务集群中的各个节点是对等的将来利于运维工作。&lt;/p&gt;

&lt;p&gt;详细参考案例源码：&lt;a href=&quot;https://gitee.com/coding-farmer/spirngcloud-learn&quot; target=&quot;_blank&quot;&gt;https://gitee.com/coding-farmer/spirngcloud-learn&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;2&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6L3d5aWNlOGtGUWhmNWdlUUszZ3UyRlV1Z2pCOGlhU0dwak9ha24xME9EcW5uckw4NXFwUmJJSWYwcEtHZENqZllmOXRIQndsUGlhQVhzMEJPMmliNlc1NHAyUS82NDA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6L3d5aWNlOGtGUWhmNWdlUUszZ3UyRlV1Z2pCOGlhU0dwak9ha24xME9EcW5uckw4NXFwUmJJSWYwcEtHZENqZllmOXRIQndsUGlhQVhzMEJPMmliNlc1NHAyUS82NDA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz/wyice8kFQhf5geQK3gu2FUugjB8iaSGpjOakn10ODqnnrL85qpRbIIf0pKGdCjfYf9tHBwlPiaAXs0BO2ib6W54p2Q/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;1&quot;&gt;&lt;img class=&quot;cke_widget_element has&quot; src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0dQN0szeWpiRERGRnkzamxvS25aYWY3Zno4VUtRZGE5UXRsQk9hc0lneU5zOHIydVNFZ0hpYURiTFhmNTVrTlJMN3lIYUF4RGYyekZRLzY0MA?x-oss-process=image/format,png&quot; alt=&quot;&quot; data-cke-saved-src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9TdmRrbGliVFRzU0dQN0szeWpiRERGRnkzamxvS25aYWY3Zno4VUtRZGE5UXRsQk9hc0lneU5zOHIydVNFZ0hpYURiTFhmNTVrTlJMN3lIYUF4RGYyekZRLzY0MA?x-oss-process=image/format,png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://mmbiz.qpic.cn/mmbiz_png/SvdklibTTsSGP7K3yjbDDFFy3jloKnZaf7fz8UKQda9QtlBOasIgyNs8r2uSEgHiaDbLXf55kNRL7yHaAxDf2zFQ/640?wx_fmt=png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:[]}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Mon, 23 Dec 2019 00:56:00 +0000</pubDate>
<dc:creator>程序开发者社区</dc:creator>
<og:description>人生的路经历过，才知道有短有长；岁月，在无憾中微笑，才美丽；回过头，想着明天抱一抱。那些年最初的梦想在我们心中依旧美好，我们只需要记住那些美好。把握现在，活在当下才是真理。</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/coding-farmer/p/12080563.html</dc:identifier>
</item>
<item>
<title>ASP.NET Core 3框架揭秘] 配置[8]：多样化的配置源[下篇] - Artech</title>
<link>http://www.cnblogs.com/artech/p/inside-asp-net-core-05-08.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/artech/p/inside-asp-net-core-05-08.html</guid>
<description>&lt;p&gt;XML也是一种常用的配置定义形式，它对数据的表达能力甚至强于JSON，几乎所有类型的数据结构都可以通过XML表示出来。当我们通过一个XML元素表示一个复杂对象的时候，对象的数据成员定义成当前XML元素的子元素。虽然XML对数据结构的表达能力总体要强于JSON，但是作为配置模型的数据来源却有自己的局限性，比如它们对集合的表现形式有点不尽如人意。&lt;/p&gt;

&lt;p&gt;举个简单的例子，对于一个元素类型为Profile的集合，我们可以采用具有如下结构的XML来表现。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Profiles&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Profile &lt;/span&gt;&lt;span&gt;Gender&lt;/span&gt;&lt;span&gt;=&quot;Male&quot;&lt;/span&gt;&lt;span&gt; Age&lt;/span&gt;&lt;span&gt;=&quot;18&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ContactInfo &lt;/span&gt;&lt;span&gt;EmailAddress &lt;/span&gt;&lt;span&gt;=&quot;foo@outlook.com&quot;&lt;/span&gt;&lt;span&gt; PhoneNo&lt;/span&gt;&lt;span&gt;=&quot;123&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;Profile&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Profile &lt;/span&gt;&lt;span&gt;Gender&lt;/span&gt;&lt;span&gt;=&quot;Male&quot;&lt;/span&gt;&lt;span&gt; Age&lt;/span&gt;&lt;span&gt;=&quot;25&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ContactInfo &lt;/span&gt;&lt;span&gt;EmailAddress &lt;/span&gt;&lt;span&gt;=&quot;bar@outlook.com&quot;&lt;/span&gt;&lt;span&gt; PhoneNo&lt;/span&gt;&lt;span&gt;=&quot;456&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;Profile&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;Profile &lt;/span&gt;&lt;span&gt;Gender&lt;/span&gt;&lt;span&gt;=&quot;Male&quot;&lt;/span&gt;&lt;span&gt; Age&lt;/span&gt;&lt;span&gt;=&quot;36&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;ContactInfo &lt;/span&gt;&lt;span&gt;EmailAddress &lt;/span&gt;&lt;span&gt;=&quot;baz@outlook.com&quot;&lt;/span&gt;&lt;span&gt; PhoneNo&lt;/span&gt;&lt;span&gt;=&quot;789&quot;&lt;/span&gt;&lt;span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;Profile&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;Profiles&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;但是这段XML却不能正确地转换成配置字典，原因很简单，因为&lt;span&gt;字典的Key必须是唯一&lt;/span&gt;的，这必然要求最终构成配置树的每个节点必须具有不同的路径。上面这段XML很明显不满足这个基本的要求，因为&lt;span&gt;表示一个Profile对象的三个XML元素（&amp;lt;Profile&amp;gt;...&amp;lt;/Profile&amp;gt;）是“同质”的&lt;/span&gt;，对于由它们表示的三个Profile对象来说，分别表示性别、年龄、电子邮箱地址和电话号码的四个叶子节点的路径是完全一样的，所以根本无法作为配置字典的Key。通过前面针对配置绑定的介绍我们知道，如果需要通过配置字典来表示一个Profile对象的集合，我们需要按照如下的方式为每个集合元素加上相应的索引（“foo”、“bar”和“baz”）。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;foo:Gender
foo:Age
foo:ContactInfo:EmailAddress
foo:ContactInfo:PhoneNo

bar:Gender
bar:Age
bar:ContactInfo:EmailAddress
bar:ContactInfo:PhoneNo

baz:Gender
baz:Age
baz:ContactInfo:EmailAddress
baz:ContactInfo:PhoneNo&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;之所以XML不能像JSON格式那样可以以一种很自然的形式表示集合或者数组，是因为后者对这两种数据类型提供了明确的定义方式（采用中括号定义），但是XML只有子元素的概念，我们不能确定它的子元素是否是一个集合。如果做这样一个假设：&lt;span&gt;如果同一个XML元素下的所有子元素都具有相同的名称，那么我们可以将其视为集合&lt;/span&gt;。根据这么一个假设，我们对XmlConfigurationSource略加改造就可以解决XML难以表示集合数据结构的问题。&lt;/p&gt;
&lt;p&gt;我们通过派生XmlConfigurationSource创建一个新的IConfigurationSource实现类型，姑且将其命名为ExtendedXmlConfigurationSource。XmlConfigurationSource提供的ConfigurationProvdier类型为ExtendedXmlConfigurationProvider，它派生于XmlConfigurationProvider。在重写的Load方法中，ExtendedXmlConfigurationProvider通过对原始的XML结构进行相应的改动，从而让原本不合法的XML（XML元素具有相同的名称）可以转换成一个针对集合的配置字典 。下图展示了XML结构转换采用的规则和步骤。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://img2018.cnblogs.com/blog/19327/201912/19327-20191223085318985-1070015519.png&quot;&gt;&lt;img width=&quot;449&quot; height=&quot;73&quot; title=&quot;6-18&quot; alt=&quot;6-18&quot; src=&quot;https://img2018.cnblogs.com/blog/19327/201912/19327-20191223085319421-1210841262.png&quot; border=&quot;0&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;如上图所示，针对集合对原始XML所作的结构转换由两个步骤组成。第一步为表示集合元素的XML元素添加一个名为“&lt;span&gt;append_index&lt;/span&gt;”的属性（Attribute），我们采用零基索引作为该属性的值。第二步会根据第一步转换的结果创建一个新的XML，同名的集合元素（比如&amp;lt;profile&amp;gt;）将会根据添加的索引值重新命名（比如&amp;lt;&lt;span&gt;profile_index_0&lt;/span&gt;&amp;gt;）。毫无疑问，转换后的这个XML可以很好地表示一个集合对象。如下所示的是ExtendedXmlConfigurationProvider&lt;strong&gt;对象&lt;/strong&gt;的定义，上述的这个转换逻辑体现在重写的Load方法中。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;44&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; ExtendedXmlConfigurationProvider : XmlConfigurationProvider
{
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; ExtendedXmlConfigurationProvider(XmlConfigurationSource source) :  &lt;span&gt;base&lt;/span&gt;&lt;span&gt;(source)
    {}

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;override&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Load(Stream stream)
    {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;加载源文件并创建一个XmlDocument        &lt;/span&gt;
        &lt;span&gt;var&lt;/span&gt; sourceDoc = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; XmlDocument();
        sourceDoc.Load(stream);

        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;添加索引&lt;/span&gt;
&lt;span&gt;        AddIndexes(sourceDoc.DocumentElement);

        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;根据添加的索引创建一个新的XmlDocument&lt;/span&gt;
        &lt;span&gt;var&lt;/span&gt; newDoc = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; XmlDocument();
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; documentElement =&lt;span&gt;  newDoc.CreateElement(sourceDoc.DocumentElement.Name);
        newDoc.AppendChild(documentElement);

        &lt;/span&gt;&lt;span&gt;foreach&lt;/span&gt; (XmlElement element &lt;span&gt;in&lt;/span&gt;&lt;span&gt; sourceDoc.DocumentElement.ChildNodes)
        {
            Rebuild(element, documentElement, name &lt;/span&gt;=&amp;gt;&lt;span&gt; newDoc.CreateElement(name));
        }

        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;根据新的XmlDocument初始化配置字典&lt;/span&gt;
        &lt;span&gt;using&lt;/span&gt; (Stream newStream = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; MemoryStream())
        {
            &lt;/span&gt;&lt;span&gt;using&lt;/span&gt; (XmlWriter writer =&lt;span&gt; XmlWriter.Create(newStream))
            {
                newDoc.WriteTo(writer);
            }
            newStream.Position &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
            &lt;/span&gt;&lt;span&gt;base&lt;/span&gt;&lt;span&gt;.Load(newStream);
        }
    }

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; AddIndexes(XmlElement element)
    {
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (element.ChildNodes.OfType&amp;lt;XmlElement&amp;gt;().Count() &amp;gt; &lt;span&gt;1&lt;/span&gt;&lt;span&gt;)
        {
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (element.ChildNodes.OfType&amp;lt;XmlElement&amp;gt;().GroupBy(it =&amp;gt; it.Name).Count() == &lt;span&gt;1&lt;/span&gt;&lt;span&gt;)
            {
                &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; index = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
                &lt;/span&gt;&lt;span&gt;foreach&lt;/span&gt; (XmlElement subElement &lt;span&gt;in&lt;/span&gt;&lt;span&gt; element.ChildNodes)
                {
                    subElement.SetAttribute(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;append_index&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, (index++&lt;span&gt;).ToString());
                    AddIndexes(subElement);
                }
            }
        }
    }

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; Rebuild(XmlElement source, XmlElement destParent, Func&amp;lt;&lt;span&gt;string&lt;/span&gt;, XmlElement&amp;gt;&lt;span&gt; creator)
    {
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; index = source.GetAttribute(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;append_index&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; elementName = &lt;span&gt;string&lt;/span&gt;.IsNullOrEmpty(index)  ? source.Name : $&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;{source.Name}_index_{index}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; element =&lt;span&gt; creator(elementName);
        destParent.AppendChild(element);
        &lt;/span&gt;&lt;span&gt;foreach&lt;/span&gt; (XmlAttribute attribute &lt;span&gt;in&lt;/span&gt;&lt;span&gt; source.Attributes)
        {
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (attribute.Name != &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;append_index&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
            {
                element.SetAttribute(attribute.Name, attribute.Value);
            }
        }

        &lt;/span&gt;&lt;span&gt;foreach&lt;/span&gt; (XmlElement subElement &lt;span&gt;in&lt;/span&gt;&lt;span&gt; source.ChildNodes)
        {
            Rebuild(subElement, element, creator);
        }
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;为了能够将上面这个XmlConfigurationProvider对象应用到我们的程序中，我们需要为它定义相应的IConfigurationSource对象，为此我们定义了如下这个ExtendedXmlConfigurationSource类型。它直接继承自XmlConfigurationSource对象，并在重写的Build方法中提供上面这个ExtendedXmlConfigurationProvider对象。为了方便将这个ExtendedXmlConfigurationSource对象注册到IConfigurationBuilder对象上，我们也可以进一步定义如下这些扩展方法。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;47&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; ExtendedXmlConfigurationSource : XmlConfigurationSource
{
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;override&lt;/span&gt;&lt;span&gt; IConfigurationProvider Build(IConfigurationBuilder builder)
    {
        EnsureDefaults(builder);
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; ExtendedXmlConfigurationProvider(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;);
    }
}

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; ExtendedXmlConfigurationExtensions
{
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; IConfigurationBuilder AddExtendedXmlFile( &lt;span&gt;this&lt;/span&gt; IConfigurationBuilder builder, &lt;span&gt;string&lt;/span&gt; path)=&amp;gt; builder.AddExtendedXmlFile(path, &lt;span&gt;false&lt;/span&gt;, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; IConfigurationBuilder AddExtendedXmlFile( &lt;span&gt;this&lt;/span&gt; IConfigurationBuilder builder, &lt;span&gt;string&lt;/span&gt; path, &lt;span&gt;bool&lt;/span&gt; optional) =&amp;gt; builder.AddExtendedXmlFile(path, optional, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; IConfigurationBuilder AddExtendedXmlFile(tthis IConfigurationBuilder builder, &lt;span&gt;string&lt;/span&gt; path, &lt;span&gt;bool&lt;/span&gt; optional, &lt;span&gt;bool&lt;/span&gt;&lt;span&gt; reloadOnChange)
    {
        builder.Add(&lt;/span&gt;&lt;span&gt;new&lt;/span&gt; ExtendedXmlConfigurationSource  { Path = path, Optional = optional, ReloadOnChange =&lt;span&gt; reloadOnChange });
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; builder;
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/artech/p/inside-asp-net-core-05-01.html&quot;&gt;[ASP.NET Core 3框架揭秘] 配置[1]：读取配置数据[上篇]&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://www.cnblogs.com/artech/p/inside-asp-net-core-05-02.html&quot;&gt;[ASP.NET Core 3框架揭秘] 配置[2]：读取配置数据[下篇]&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://www.cnblogs.com/artech/p/inside-asp-net-core-05-03.html&quot;&gt;[ASP.NET Core 3框架揭秘] 配置[3]：配置模型总体设计&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://www.cnblogs.com/artech/p/inside-asp-net-core-05-04.html&quot;&gt;[ASP.NET Core 3框架揭秘] 配置[4]：将配置绑定为对象&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://www.cnblogs.com/artech/p/inside-asp-net-core-05-05.html&quot;&gt;[ASP.NET Core 3框架揭秘] 配置[5]：配置数据与数据源的实时同步&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://www.cnblogs.com/artech/p/inside-asp-net-core-05-06.html&quot;&gt;[ASP.NET Core 3框架揭秘] 配置[6]：多样化的配置源[上篇]&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://www.cnblogs.com/artech/p/inside-asp-net-core-05-07.html&quot;&gt;[ASP.NET Core 3框架揭秘] 配置[7]：多样化的配置源[中篇]&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://www.cnblogs.com/artech/p/inside-asp-net-core-05-08.html&quot;&gt;[ASP.NET Core 3框架揭秘] 配置[8]：多样化的配置源[下篇]&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://www.cnblogs.com/artech/p/inside-asp-net-core-05-09.html&quot;&gt;[ASP.NET Core 3框架揭秘] 配置[9]：自定义配置源&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Mon, 23 Dec 2019 00:53:00 +0000</pubDate>
<dc:creator>Artech</dc:creator>
<og:description>XML也是一种常用的配置定义形式，它对数据的表达能力甚至强于JSON，几乎所有类型的数据结构都可以通过XML表示出来。当我们通过一个XML元素表示一个复杂对象的时候，对象的数据成员定义成当前XML元素</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/artech/p/inside-asp-net-core-05-08.html</dc:identifier>
</item>
<item>
<title>Android流媒体开发之路三:基于NDK开发Android平台RTSP播放器 - haibindev</title>
<link>http://www.cnblogs.com/haibindev/p/12081565.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/haibindev/p/12081565.html</guid>
<description>&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;最近做了不少android端的开发，有推流、播放、直播、对讲等各种应用，做了RTMP、RTSP、HTTP-FLV、自定义等各种协议，还是有不少收获和心得的。我这边做，核心模块和核心代码部分，都是基于NDK，用C++开发的，然后将so动态库，在Android java环境中使用，这个既能保证核心部分的代码性能，也能最大程度复用之前写的流媒体相关的大量代码，实践证明，这样的程序架构，还是很有效的。这篇文章里，我打算描述一下我对于开发Android端RTSP播放器的程序框架，和设计思路，有相关需求的，希望能借此扩展下思路。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;逻辑思路&quot;&gt;逻辑思路&lt;/h2&gt;
&lt;ol readability=&quot;3.5&quot;&gt;&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;首先，既然是RTSP播放器，那必然要做RTSP的解析，这部分对我来说已经是非常熟悉了。我常用的RTSP解析代码，一般是基于Live555和FFMpeg的库，通过调用相关的接口，来实现RTSP客户端协议的数据接收，然后再做数据分析。这两种方式，各有适合的应用场景，兼容性也各有优劣，要根据具体项目具体选择。除非是整套都是自己做的RTSP服务器和RTSP客户端，否则我一般都是用他们两个，为的是最大程度的兼容第三方RTSP服务器，比如各种网络摄像头、各种设备、以及其他公司自己写的RTSP server等等，具体就不说了，做过类似的估计都清楚。当然，数据接收是需要做缓冲的，否则会卡顿，这个需要自己来做。&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;其次是解码，对于这点，为了保证内存使用效率，以及避免JNI调用开销，最好是在c++层来做。这个可以基于FFMpeg解码器或者MediaCodec解码器来写，不过要注意后者对Android的版本有要求。解码后需要对数据进行缓冲，按照时间戳进行排队。这个不管是直播还是点播，都需要做队列，否则同样会出现卡顿、音视频不同步，以及其他的情况，这个是非常重要的一点。&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;最后是渲染，这个可以选择在c++层绘制，或者回调上层，交给EGL来进行绘制，后者需要编写EGL代码，创建EGL surface，在渲染线程中进行绘制。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;总结一下：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;连接RTSP服务器，接收数据并进行分析，提取视频和音频数据&lt;/li&gt;
&lt;li&gt;对编码数据，比如h.264、aac等，进行解码，还原原始数据&lt;/li&gt;
&lt;li&gt;把原始数据，进行绘制或回调上层，opengl绘制&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;程序框架&quot;&gt;程序框架&lt;/h2&gt;
&lt;h3 id=&quot;结构示意图&quot;&gt;结构示意图：&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/254714/201912/254714-20191222225129236-843037209.jpg&quot;/&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;em&gt;c++部分是主要代码，java层只需要做封装和调用操作即可&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;框架图&quot;&gt;框架图：&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/254714/201912/254714-20191222225144852-1855484749.jpg&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;android-c工程编译&quot;&gt;Android c++工程编译&lt;/h2&gt;
&lt;p&gt;本人的交叉编译平台是ubuntu 64bit，编译成动态库，然后让APP通过JNI来调用，跟其他程序的编译方式差不多。当然，首先需要系统内布置好NDK编译环境。Google提供了完整的编译工具链，也包括SDK，下载地址在这里：“&lt;a href=&quot;https://developer.android.com/ndk/downloads/?hl=zh-cn&quot;&gt;NDK Downloads&lt;/a&gt;”。我在之前的一篇文章里也写了这部分，可以参考一下：&quot;&lt;a href=&quot;https://www.cnblogs.com/haibindev/p/8989218.html&quot;&gt;NDK开发Android端RTMP直播推流程序&lt;/a&gt;&quot;。&lt;/p&gt;
&lt;h3 id=&quot;编译依赖库&quot;&gt;1. 编译依赖库&lt;/h3&gt;
&lt;p&gt;对第三方库，我通常都是首先尝试NDK工具链的方式来编译，这样的好处，一个是工作量小，能直接使用项目的makefile，当前前提是先配置好编译环境，指定好交叉编译工具；另一个是不同的库的编译方式是相同的，很容易处理。这里以FFMpeg为例&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/254714/201912/254714-20191222225200379-121994829.jpg&quot;/&gt;&lt;/p&gt;
&lt;p&gt;第三方库准备好，这样就行了。&lt;/p&gt;
&lt;h3 id=&quot;编写程序主体的android.mk文件&quot;&gt;2. 编写程序主体的Android.mk文件&lt;/h3&gt;
&lt;p&gt;程序主体，直接写Android.mk，代码和预编译条件，链接参数等自己都清楚，也很方面控制编译输出。之前有篇文章里也有简单介绍，可以参考&quot;&lt;a href=&quot;https://www.cnblogs.com/haibindev/p/8989218.html&quot;&gt;NDK开发Android端RTMP直播推流程序&lt;/a&gt;&quot;，具体的语法可以参考官方网站Android Developer。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/254714/201912/254714-20191222225212692-500380609.jpg&quot;/&gt;&lt;/p&gt;
&lt;p&gt;写好后，调用ndk-build脚本编译，OK。&lt;/p&gt;
&lt;h2 id=&quot;需要注意的地方和部分代码&quot;&gt;需要注意的地方和部分代码&lt;/h2&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;1.在写JNI封装接口的时候，一定要注意jni类型和c++类型的对应关系，尤其是注意返回值。本人就曾经因为jni接口返回值，和代码实现时候的不对应，从而导致android app调用接口的时候异常退出&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/254714/201912/254714-20191222225232547-929886686.jpg&quot;/&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;2.在按照时间戳做播放队列的时候，为了音频和视频的同步，必须注意音频和视频各自的时间戳，需要按照真实的时间进行还原。而当发现视频和音频不同步的时候，或者因为缓冲问题，导致视频需要丢包的情况下，需要及时调整音频播放队列的基准时间戳，避免音视频不同步的情况出现。同时，这样做也能避免长期累积造成的计算误差。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/254714/201912/254714-20191222225244021-1163149617.jpg&quot;/&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;3.由于是手机端或者嵌入式设备端进行播放，因为需要考虑到设备性能不足的情况。这个时候，如果码流较大而设备来不及解码或者渲染，必须及时抛弃视频数据，否则会造成内存溢出，程序崩溃。同时在抛弃数据的时候，要考虑到关键帧的问题，也就是如果发生了抛帧，那么整个GOP的数据都应当放弃，除非是有冗余编码等编码技术，以此来避免花屏的情况，以及第2点列出的音视频同步问题。解决这几点，基本上就可以了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;4.当需要回调给java层，让EGL来渲染画面时，需要用到c++回调Java的技术手段。首先写好java层封装的回调接口，然后在c++代码中，通过JNI环境，获取到java层封装的类jclass对象和方法。注意在调用GetMethodID时，需要写正确函数的签名，例如我在java层的函数是&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;void OnVideoDataBuf(int width, int height, byte[] frameBuf)&lt;/p&gt;
&lt;p&gt;那么对应的签名是“(II[B)V”&lt;br/&gt;以下是调用例子：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/254714/201912/254714-20191222230538958-109872973.jpg&quot;/&gt;&lt;/p&gt;
&lt;p&gt;注意最后需要DetachCurrentThread()。&lt;/p&gt;
&lt;h2 id=&quot;运行效果&quot;&gt;运行效果&lt;/h2&gt;
&lt;p&gt;在手机端运行画面：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/254714/201912/254714-20191222225256964-649045033.jpg&quot;/&gt;&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/254714/201912/254714-20191222232818423-693777647.jpg&quot;/&gt;&lt;strong&gt;haibindev.cnblogs.com，合作请联系QQ或微信。（转载请注明作者和出处~）&lt;/strong&gt;&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/254714/201912/254714-20191222231736319-695758603.jpg&quot;/&gt;&lt;/p&gt;
&lt;hr/&gt;</description>
<pubDate>Mon, 23 Dec 2019 00:49:00 +0000</pubDate>
<dc:creator>haibindev</dc:creator>
<og:description>最近做了不少android端的开发，有推流、播放、直播、对讲等各种应用，做了RTMP、RTSP、HTTP-FLV、自定义等各种协议，还是有不少收获和心得的。我这边做，核心模块和核心代码部分，都是基于N</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/haibindev/p/12081565.html</dc:identifier>
</item>
<item>
<title>小白学 Python 爬虫（24）：2019 豆瓣电影排行 - 极客挖掘机</title>
<link>http://www.cnblogs.com/babycomeon/p/12081996.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/babycomeon/p/12081996.html</guid>
<description>&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201912/908359-20191223084642606-1467262899.jpg&quot;/&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;人生苦短，我用 Python&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;前文传送门：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/11/13/3303836941/&quot;&gt;小白学 Python 爬虫（1）：开篇&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/11/20/2586166930/&quot;&gt;小白学 Python 爬虫（2）：前置准备（一）基本类库的安装&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/11/21/1005563697/&quot;&gt;小白学 Python 爬虫（3）：前置准备（二）Linux基础入门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/11/22/3679472340/&quot;&gt;小白学 Python 爬虫（4）：前置准备（三）Docker基础入门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/11/24/334078215/&quot;&gt;小白学 Python 爬虫（5）：前置准备（四）数据库基础&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/11/25/1881661601/&quot;&gt;小白学 Python 爬虫（6）：前置准备（五）爬虫框架的安装&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/11/26/1197821400/&quot;&gt;小白学 Python 爬虫（7）：HTTP 基础&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/11/27/101847406/&quot;&gt;小白学 Python 爬虫（8）：网页基础&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/11/28/1668465912/&quot;&gt;小白学 Python 爬虫（9）：爬虫基础&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/12/01/2475257648/&quot;&gt;小白学 Python 爬虫（10）：Session 和 Cookies&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/12/02/2333822325/&quot;&gt;小白学 Python 爬虫（11）：urllib 基础使用（一）&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/12/03/819896244/&quot;&gt;小白学 Python 爬虫（12）：urllib 基础使用（二）&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/12/04/2992515886/&quot;&gt;小白学 Python 爬虫（13）：urllib 基础使用（三）&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/12/05/104488944/&quot;&gt;小白学 Python 爬虫（14）：urllib 基础使用（四）&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/12/07/2788855167/&quot;&gt;小白学 Python 爬虫（15）：urllib 基础使用（五）&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/12/09/1691033431/&quot;&gt;小白学 Python 爬虫（16）：urllib 实战之爬取妹子图&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/12/10/1910005577/&quot;&gt;小白学 Python 爬虫（17）：Requests 基础使用&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/12/11/1468953802/&quot;&gt;小白学 Python 爬虫（18）：Requests 进阶操作&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/12/12/3568648672/&quot;&gt;小白学 Python 爬虫（19）：Xpath 基操&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/12/13/2569867940/&quot;&gt;小白学 Python 爬虫（20）：Xpath 进阶&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/12/15/2789385418/&quot;&gt;小白学 Python 爬虫（21）：解析库 Beautiful Soup（上）&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/12/16/876770087/&quot;&gt;小白学 Python 爬虫（22）：解析库 Beautiful Soup（下）&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.geekdigging.com/2019/12/17/876770088/&quot;&gt;小白学 Python 爬虫（23）：解析库 pyquery 入门&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;引言&quot;&gt;引言&lt;/h2&gt;
&lt;p&gt;从本篇的标题各位同学应该已经猜到了，本篇又到了实战环节~~~&lt;/p&gt;
&lt;p&gt;2019 已经快过完了，按照本文推送的时间预估，到 2020 应该还有十来天的时间，又到了各个公司出各种 2019 榜单的时间，小编这里呢，就先帮豆瓣搞一个 2019 电影评分排行榜，希望豆瓣官方看到不要打我。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;郑重声明：&lt;/strong&gt; 本文仅限用作学习等目的。&lt;/p&gt;
&lt;h2 id=&quot;分析&quot;&gt;分析&lt;/h2&gt;
&lt;p&gt;还是先看一下我们要爬取的页面：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201912/908359-20191223084647319-1522951801.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;链接：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;https://movie.douban.com/explore#!type=movie&amp;amp;tag=%E7%83%AD%E9%97%A8&amp;amp;sort=time&amp;amp;page_limit=20&amp;amp;page_start=0&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;思维敏捷的同学看着上面这个链接可能就已经发现了什么，对的，这个链接上已经有分页信息了。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;page_limit&lt;/code&gt; 应该是一页的元素， &lt;code&gt;page_start&lt;/code&gt; 应该是这一页开始的一个序号。&lt;/p&gt;
&lt;p&gt;我们往下翻一下页面，看看下面有没有下一页之类的按钮，翻几页看下地址栏的变化是否和我们推测的一致。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201912/908359-20191223084651961-591392101.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;emmmmmmmmm&lt;/p&gt;
&lt;p&gt;小编猜错了，这里不是下一页，是加载更多，不过问题不大，一个意思，先点一下我们看下地址栏：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;https://movie.douban.com/explore#!type=movie&amp;amp;tag=%E7%83%AD%E9%97%A8&amp;amp;sort=time&amp;amp;page_limit=20&amp;amp;page_start=20&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;和前面一个地址作对比可以发现，只有最后的 &lt;code&gt;page_start&lt;/code&gt; 参数有变化，说明我们刚才上面的猜测没有问题。&lt;/p&gt;
&lt;p&gt;加载更多多点几次，可以发现，这里的电影是可以一直往后排的，可以加载到 2018 年的数据：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201912/908359-20191223084656074-1672324472.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;emmmmmmmmm，有点尴尬，这个数据竟然手动翻出来了，理论上是应该程序自己判断的。&lt;/p&gt;
&lt;p&gt;这里的悬浮层上已经显示了我们想要的数据，接下来的问题是，我们如何获得这个悬浮层上的数据，直接从 DOM 节点来取可以么？&lt;/p&gt;
&lt;p&gt;显然是不行的，不信可以自己动手试试，每个电影的悬浮层其实都是同一个 DOM 节点，只是里面填充的数据不同，显然这个 DOM 节点中的数据是鼠标挪上去的时候才动态加载出来的。&lt;/p&gt;
&lt;p&gt;那么我们从哪里能看到加载数据的来源呢？&lt;/p&gt;
&lt;p&gt;如果上一篇实战有仔细看实操过的同学应该已经想到了， Chrome 浏览器开发者模式中的 Network 标签。&lt;/p&gt;
&lt;p&gt;没错，就是这里，我们看一下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201912/908359-20191223084659030-2145242816.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;首先选择 Network 标签，然后在下面的标签上选择 XHR 。然后鼠标在不同的电影上移动，可以看到鼠标每次移到一张图片上，就会有一个请求，我们看一下这个请求的响应信息：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;{&quot;r&quot;:0,&quot;subject&quot;:{&quot;episodes_count&quot;:&quot;&quot;,&quot;star&quot;:&quot;40&quot;,&quot;blacklisted&quot;:&quot;available&quot;,&quot;title&quot;:&quot;我身体里的那个家伙 내안의 그놈‎ (2019)&quot;,&quot;url&quot;:&quot;https:\/\/movie.douban.com\/subject\/27088750\/&quot;,&quot;collection_status&quot;:&quot;&quot;,&quot;rate&quot;:&quot;7.2&quot;,&quot;short_comment&quot;:{&quot;content&quot;:&quot;男主真的他妈帅 但是我真的接受不了和罗美兰打k &quot;,&quot;author&quot;:&quot;SOUL&quot;},&quot;is_tv&quot;:false,&quot;subtype&quot;:&quot;Movie&quot;,&quot;directors&quot;:[&quot;姜孝镇&quot;],&quot;actors&quot;:[&quot;郑振永&quot;,&quot;朴圣雄&quot;,&quot;罗美兰&quot;,&quot;李垂珉&quot;,&quot;李俊赫&quot;,&quot;金光奎&quot;,&quot;闵智雅&quot;,&quot;尹敬浩&quot;,&quot;金贤穆&quot;,&quot;朴庆惠&quot;,&quot;赵贤荣&quot;,&quot;尹颂雅&quot;,&quot;智燦&quot;,&quot;金凡振 &quot;,&quot;郑元昌&quot;,&quot;孙光业&quot;,&quot;黄仁俊&quot;,&quot;Dae-han Kim&quot;],&quot;duration&quot;:&quot;122分钟&quot;,&quot;region&quot;:&quot;韩国&quot;,&quot;playable&quot;:false,&quot;id&quot;:&quot;27088750&quot;,&quot;types&quot;:[&quot;剧情&quot;,&quot;喜剧&quot;],&quot;release_year&quot;:&quot;2019&quot;}}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;那么我们剩下要关心的就是这个请求的地址了，先看下这个请求的地址：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;https://movie.douban.com/j/subject_abstract?subject_id=27088750&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;这里看起来好像只有最后一个 &lt;code&gt;subject_id&lt;/code&gt; 参数是变化的，其他的都是定死的，多看几个请求检验下我们的推测，小编这里就不检验了，免得嫌弃说小编水内容。&lt;/p&gt;
&lt;p&gt;还有一个问题，最后这个 &lt;code&gt;subject_id&lt;/code&gt; 的数据从哪里来，好像没见过的，小编凭借自己多年丰富的开发经验，猜测这个数据应该是在页面的上的。我们接着看下这个电影的页面 DOM 结构。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201912/908359-20191223084659283-1104478008.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;看到了没，这里的数据是来源于 DOM 结构上的 &lt;code&gt;data-id&lt;/code&gt; 属性。&lt;/p&gt;
&lt;p&gt;PS：更新一件事情，一件异常尴尬的事情，小编偶然发现，点击加载更多的时候，实际上是对应了一个 API 接口，这个接口的访问地址如下：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;https://movie.douban.com/j/search_subjects?type=movie&amp;amp;tag=%E7%83%AD%E9%97%A8&amp;amp;sort=time&amp;amp;page_limit=20&amp;amp;page_start=20&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;这个在 NetWork 中有看到，如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/908359/201912/908359-20191223084659667-1012174990.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;从图中可以看到，这里直接返回了 JSON 数据，并且这个 JSON 数据返回后，顺便还修改了地址栏的数据。&lt;/p&gt;
&lt;p&gt;这里得到的数据如下：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;{
    &quot;subjects&quot;:[
        {
            &quot;rate&quot;:&quot;6.7&quot;,
            &quot;cover_x&quot;:1382,
            &quot;title&quot;:&quot;在无爱之森呐喊&quot;,
            &quot;url&quot;:&quot;https://movie.douban.com/subject/30337760/&quot;,
            &quot;playable&quot;:false,
            &quot;cover&quot;:&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2571542101.jpg&quot;,
            &quot;id&quot;:&quot;30337760&quot;,
            &quot;cover_y&quot;:2048,
            &quot;is_new&quot;:false
        }
    ]
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;因为整体数据有 20 条，太长了放不下，小编这里仅保留了一条数据。&lt;/p&gt;
&lt;h2 id=&quot;编码&quot;&gt;编码&lt;/h2&gt;
&lt;p&gt;有了上面的分析，其实写代码就已经很简单了，我们所有需要用到的数据都可以直接从 API 接口中直接获取到 JSON 的数据。&lt;/p&gt;
&lt;p&gt;屡一下思路，首先我们从&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;https://movie.douban.com/j/search_subjects?type=movie&amp;amp;tag=%E7%83%AD%E9%97%A8&amp;amp;sort=time&amp;amp;page_limit=20&amp;amp;page_start=0&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;这个链接中直接获取电影的相关数据，这里对我们有用的数据是 &lt;code&gt;id&lt;/code&gt; ，获取到这个 &lt;code&gt;id&lt;/code&gt; 后，再从&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;https://movie.douban.com/j/subject_abstract?subject_id=27088750&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;这个链接中获取到电影的详情数据，用上面得到的 &lt;code&gt;id&lt;/code&gt; 替换这里的 &lt;code&gt;subject_id&lt;/code&gt; 。&lt;/p&gt;
&lt;p&gt;好像没页面 DOM 解析啥事儿了，哎，真的是一次失败的选题，下次再也不选豆瓣了。&lt;/p&gt;
&lt;p&gt;代码内容有些简单，小编直接贴出来吧，数据还是在 Mysql 中开了一张表做存放：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;import requests
import pymysql

# 数据库连接
def connect():
    conn = pymysql.connect(host='localhost',
                           port=3306,
                           user='root',
                           password='password',
                           database='test',
                           charset='utf8mb4')

    # 获取操作游标
    cursor = conn.cursor()
    return {&quot;conn&quot;: conn, &quot;cursor&quot;: cursor}

connection = connect()
conn, cursor = connection['conn'], connection['cursor']

sql_insert = &quot;insert into douban2019(id, title, rate, short_comment, duration, subtype, region, release_year, create_date) values (%(id)s, %(title)s, %(rate)s, %(short_comment)s, %(duration)s, %(subtype)s, %(region)s, %(release_year)s, now())&quot;

headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36'
}

flag = True

def get_movie_list(page_start):
    r = requests.get('https://movie.douban.com/j/search_subjects?type=movie&amp;amp;tag=%E7%83%AD%E9%97%A8&amp;amp;sort=time&amp;amp;page_limit=20&amp;amp;page_start=' + str(page_start), headers = headers)
    for item in r.json()['subjects']:
        get_movie_info(item['id'])

def get_movie_info(subject_id):
    r = requests.get('https://movie.douban.com/j/subject_abstract?subject_id=' + str(subject_id), headers=headers)

    subject = r.json()['subject']

    if subject['release_year'] != '2019':
        global flag
        flag = False
        return

    print(subject)

    insert_data = {
        &quot;id&quot;: subject['id'],
        &quot;title&quot;: subject['title'],
        &quot;rate&quot;: subject['rate'],
        &quot;short_comment&quot;: subject['short_comment']['content'],
        &quot;duration&quot;: subject['duration'],
        &quot;subtype&quot;: subject['subtype'],
        &quot;region&quot;: subject['region'],
        &quot;release_year&quot;: subject['release_year']
    }
    cursor.execute(sql_insert, insert_data)
    conn.commit()
    print(subject['title'], '写入完成')



def main():
    num = 0
    while(flag):
        get_movie_list(num)
        num += 20

if __name__ == '__main__':
    main()&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;小结&quot;&gt;小结&lt;/h2&gt;
&lt;p&gt;最后小编做了一下简单的统计，截止目前， 2019 豆瓣电影共计 312 部，评分超过 8.0 分的共计 37 部，超过 8.5 分的共计 14 部，超过 9.0 分的只有 1 部。&lt;/p&gt;
&lt;p&gt;下表为评分超过 8.0 分的，还有没看过的小伙伴可以抓紧时间看一下咯~~&lt;/p&gt;
&lt;table&gt;&lt;thead/&gt;&lt;tbody readability=&quot;36&quot;&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;爱尔兰人 The Irishman‎ (2019)&lt;/td&gt;
&lt;td&gt;9.1&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;3&quot;&gt;&lt;td&gt;银河英雄传说 Die Neue These 星乱 第1章 銀河英雄伝説 Die Neue These 星乱 第1章‎ (2019)&lt;/td&gt;
&lt;td&gt;8.9&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;小丑 Joker‎ (2019)&lt;/td&gt;
&lt;td&gt;8.8&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;婚姻故事 Marriage Story‎ (2019)&lt;/td&gt;
&lt;td&gt;8.8&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;玩具总动员4 Toy Story 4‎ (2019)&lt;/td&gt;
&lt;td&gt;8.7&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;寄生虫 기생충‎ (2019)&lt;/td&gt;
&lt;td&gt;8.7&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;代号基亚斯：复活的鲁路修 コードギアス 復活のルルーシュ‎ (2019)&lt;/td&gt;
&lt;td&gt;8.7&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;82年生的金智英 82년생 김지영‎ (2019)&lt;/td&gt;
&lt;td&gt;8.7&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;克劳斯：圣诞节的秘密 Klaus‎ (2019)&lt;/td&gt;
&lt;td&gt;8.6&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;痛苦与荣耀 Dolor y gloria‎ (2019)&lt;/td&gt;
&lt;td&gt;8.6&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;3&quot;&gt;&lt;td&gt;青春期猪头少年不做怀梦少女的梦 青春ブタ野郎はゆめみる少女の夢を見ない‎ (2019)&lt;/td&gt;
&lt;td&gt;8.6&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;复仇者联盟4：终局之战 Avengers: Endgame‎ (2019)&lt;/td&gt;
&lt;td&gt;8.5&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;哪吒之魔童降世‎ (2019)&lt;/td&gt;
&lt;td&gt;8.5&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;普罗米亚 プロメア‎ (2019)&lt;/td&gt;
&lt;td&gt;8.5&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;少年的你‎ (2019)&lt;/td&gt;
&lt;td&gt;8.4&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;少年泰坦出击大战少年泰坦 Teen Titans Go! vs Teen Titans‎ (2019)&lt;/td&gt;
&lt;td&gt;8.4&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;悲惨世界 Les misérables‎ (2019)&lt;/td&gt;
&lt;td&gt;8.4&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;我的一级兄弟 나의 특별한 형제‎ (2019)&lt;/td&gt;
&lt;td&gt;8.3&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;燃烧女子的肖像 Portrait de la jeune fille en feu‎ (2019)&lt;/td&gt;
&lt;td&gt;8.3&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;再见钟情 Mon inconnue‎ (2019)&lt;/td&gt;
&lt;td&gt;8.3&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;我在雨中等你 The Art of Racing in the Rain‎ (2019)&lt;/td&gt;
&lt;td&gt;8.2&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;罗小黑战记‎ (2019)&lt;/td&gt;
&lt;td&gt;8.2&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;行骗天下JP：浪漫篇 コンフィデンスマンJP‎ (2019)&lt;/td&gt;
&lt;td&gt;8.2&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;阿松 剧场版 劇場版 えいがのおそ松さん‎ (2019)&lt;/td&gt;
&lt;td&gt;8.2&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;3&quot;&gt;&lt;td&gt;蜡笔小新：新婚旅行飓风之遗失的野原广志 映画クレヨンしんちゃん 新婚旅行ハリケーン ～失われたひろし～‎ (2019)&lt;/td&gt;
&lt;td&gt;8.2&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;驭风男孩 The Boy Who Harnessed the Wind‎ (2019)&lt;/td&gt;
&lt;td&gt;8.1&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;对不起，我们错过了你 Sorry We Missed You‎ (2019)&lt;/td&gt;
&lt;td&gt;8.1&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;续命之徒：绝命毒师电影 El Camino: A Breaking Bad Movie‎ (2019)&lt;/td&gt;
&lt;td&gt;8.1&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;我失去了身体 J'ai perdu mon corps‎ (2019)&lt;/td&gt;
&lt;td&gt;8.1&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;最初的梦想 Chhichhore‎ (2019)&lt;/td&gt;
&lt;td&gt;8.1&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;千子2 センコロール コネクト‎ (2019)&lt;/td&gt;
&lt;td&gt;8.0&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;地久天长‎ (2019)&lt;/td&gt;
&lt;td&gt;8.0&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;金发男子 Un rubio‎ (2019)&lt;/td&gt;
&lt;td&gt;8.0&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;3&quot;&gt;&lt;td&gt;心理测量者SS2：第一卫士 PSYCHO-PASS サイコパス Sinners of the System Case.2「First Guardian」‎ (2019)&lt;/td&gt;
&lt;td&gt;8.0&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;漫长的告别 長いお別れ‎ (2019)&lt;/td&gt;
&lt;td&gt;8.0&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;我的喜马拉雅‎ (2019)&lt;/td&gt;
&lt;td&gt;8.0&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;小委托人 어린 의뢰인‎ (2019)&lt;/td&gt;
&lt;td&gt;8.0&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;h2 id=&quot;示例代码&quot;&gt;示例代码&lt;/h2&gt;
&lt;p&gt;本系列的所有代码小编都会放在代码管理仓库 Github 和 Gitee 上，方便大家取用。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/meteor1993/python-learning/tree/master/python-spider/douban-2019&quot; title=&quot;示例代码-Github&quot;&gt;示例代码-Github&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://gitee.com/inwsy/python-learning/tree/master/python-spider/douban-2019&quot; title=&quot;示例代码-Gitee&quot;&gt;示例代码-Gitee&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Mon, 23 Dec 2019 00:47:00 +0000</pubDate>
<dc:creator>极客挖掘机</dc:creator>
<og:description>人生苦短，我用 Python 前文传送门： '小白学 Python 爬虫（1）：开篇' '小白学 Python 爬虫（2）：前置准备（一）基本类库的安装' '小白学 Python 爬虫（3）：前置准备</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/babycomeon/p/12081996.html</dc:identifier>
</item>
<item>
<title>Java equals 和 hashCode 的这几个问题可以说明白吗？ - 日拱一兵</title>
<link>http://www.cnblogs.com/FraserYu/p/12081976.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/FraserYu/p/12081976.html</guid>
<description>&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;上一篇文章 &lt;a href=&quot;https://dayarch.top/p/spring-data-binding-mechanism.html&quot;&gt;如何妙用 Spring 数据绑定？&lt;/a&gt; ，&lt;strong&gt;灵魂追问&lt;/strong&gt; 环节留下了一个有关 equals 和 hashcode 问题 。基础面试经常会碰到与之相关的问题，这不是一个复杂的问题，但很多朋友都苦于说明他们二者的关系和约束，于是写本文做单独说明，本篇文章将循序渐进 ( &lt;em&gt;通过举例，让记忆与理解更轻松&lt;/em&gt; ) 说明这些让你有些苦恼的问题，Let's go .......&lt;/p&gt;
&lt;h2 id=&quot;面试问题&quot;&gt;面试问题&lt;/h2&gt;
&lt;h3 id=&quot;java-里面有了-运算符为什么还需要-equals&quot;&gt;1. Java 里面有了 == 运算符，为什么还需要 equals ？&lt;/h3&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;code&gt;==&lt;/code&gt; 比较的是对象地址，&lt;code&gt;equals&lt;/code&gt; 比较的是对象值&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;先来看一看 &lt;code&gt;Object&lt;/code&gt; 类中 &lt;code&gt;equals&lt;/code&gt; 方法:&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public boolean equals(Object obj) {
    return (this == obj);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;我们看到 &lt;code&gt;equals&lt;/code&gt; 方法同样是通过 &lt;code&gt;==&lt;/code&gt; 比较对象地址，并没有帮我们比较值。Java 世界中 &lt;code&gt;Object&lt;/code&gt; 绝对是&quot;老祖宗&quot; 的存在，&lt;code&gt;==&lt;/code&gt; 号我们没办法改变或重写。但 &lt;code&gt;equals&lt;/code&gt; 是方法，这就给了我们重写 &lt;code&gt;equals&lt;/code&gt; 方法的可能，让我们实现其对值的比较:&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;@Override
public boolean equals(Object obj) {
    //重写逻辑
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;新买的电脑，每个电脑都有唯一的序列号，通常情况下，两个一模一样的电脑放在面前，你会说由于序列号不一样，这两个电脑不一样吗？&lt;/p&gt;
&lt;p&gt;如果我们要说两个电脑一样，通常是比较其「品牌/尺寸/配置 」(值) ，比如这样:&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;@Override
public boolean equals(Object obj) {
    return 品牌相等 &amp;amp;&amp;amp; 尺寸相等 &amp;amp;&amp;amp; 配置相等
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;当遇到如上场景时，我们就需要重写 &lt;code&gt;equals&lt;/code&gt; 方法。这就解释了 Java 世界为什么有了 &lt;code&gt;==&lt;/code&gt; 还有&lt;code&gt;equals&lt;/code&gt; 这个问题了.&lt;/p&gt;
&lt;h3 id=&quot;equals相等-和-hashcode-相等问题&quot;&gt;2. &lt;code&gt;equals&lt;/code&gt;相等 和 &lt;code&gt;hashcode&lt;/code&gt; 相等问题&lt;/h3&gt;
&lt;p&gt;关于二者，你经常会碰到下面的两个问题:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;两个对象 &lt;code&gt;equals&lt;/code&gt; 相等，那他们 &lt;code&gt;hashCode&lt;/code&gt; 相等吗？&lt;/li&gt;
&lt;li&gt;两个对象 &lt;code&gt;hashCode&lt;/code&gt; 相等，那他们 &lt;code&gt;equals&lt;/code&gt; 相等吗？&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;em&gt;为了说明上面两个问题的结论，这里举一个不太恰当的例子，只为方便记忆&lt;/em&gt;，我们将 &lt;code&gt;equals&lt;/code&gt; 比作一个单词的拼写；&lt;code&gt;hashCode&lt;/code&gt; 比作一个单词的发音，在相同语境下:&lt;/p&gt;
&lt;blockquote readability=&quot;9&quot;&gt;
&lt;p&gt;sea / sea 「大海」，两个单词拼写一样，所以 &lt;code&gt;equals&lt;/code&gt; 相等，他们读音 &lt;code&gt;/siː/&lt;/code&gt; 也一样，所以 &lt;code&gt;hashCode&lt;/code&gt; 就相等，这就回答了第一个问题:&lt;/p&gt;
&lt;h4 id=&quot;两个对象-equals-相等那他们-hashcode-一定也相等&quot;&gt;两个对象 &lt;code&gt;equals&lt;/code&gt; 相等，那他们 &lt;code&gt;hashCode&lt;/code&gt; 一定也相等&lt;/h4&gt;
&lt;p&gt;sea / see 「大海/看」，两个单词的读音 &lt;code&gt;/siː/&lt;/code&gt; 一样，显然单词是不一样的，这就回答了第二个问题:&lt;/p&gt;
&lt;h4 id=&quot;两个对象-hashcode-相等那他们-equals-不一定相等&quot;&gt;两个对象 &lt;code&gt;hashCode&lt;/code&gt; 相等，那他们 &lt;code&gt;equals&lt;/code&gt; 不一定相等&lt;/h4&gt;
&lt;/blockquote&gt;
&lt;p&gt;查看 &lt;code&gt;Object&lt;/code&gt; 类的 &lt;code&gt;hashCode&lt;/code&gt; 方法:&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public native int hashCode();&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;继续查看该方法的注释，明确写明关于该方法的约束&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1583165/201912/1583165-20191223083743500-1002249213.jpg&quot;/&gt;&lt;/p&gt;
&lt;p&gt;其实在这个结果的背后，还有的是关于重写 &lt;code&gt;equals&lt;/code&gt; 方法的约束&lt;/p&gt;
&lt;h3 id=&quot;重写-equals-有哪些约束&quot;&gt;3. 重写 &lt;code&gt;equals&lt;/code&gt; 有哪些约束？&lt;/h3&gt;
&lt;p&gt;关于重写 &lt;code&gt;equals&lt;/code&gt; 方法的约束，同样在该方法的注释中写的很清楚了，我在这里再说明一下:&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1583165/201912/1583165-20191223083753983-833441886.jpg&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;赤橙红绿青蓝紫，七彩以色列；哆来咪发唆拉西, 一曲安哥拉&lt;/strong&gt; ，这些规则不是用来背诵的，只是在你需要重写 &lt;code&gt;equals&lt;/code&gt; 方法时，打开 JDK 查看该方法，按照准则重写就好&lt;/p&gt;
&lt;h3 id=&quot;什么时候需要我们重写-hashcode&quot;&gt;4. 什么时候需要我们重写 &lt;code&gt;hashCode&lt;/code&gt;？&lt;/h3&gt;
&lt;p&gt;为了比较值，我们重写 &lt;code&gt;equals&lt;/code&gt; 方法，那什么时候又需要重写 &lt;code&gt;hashCode&lt;/code&gt; 方法呢？&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;通常只要我们重写 &lt;code&gt;equals&lt;/code&gt; 方法就要重写 &lt;code&gt;hashCode&lt;/code&gt; 方法&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;为什么会有这样的约束呢？按照上面讲的原则，两个对象 &lt;code&gt;equals&lt;/code&gt; 相等，那他们的 &lt;code&gt;hashCode&lt;/code&gt; 一定也相等。如果我们只重写 &lt;code&gt;equals&lt;/code&gt; 方法而不重写 &lt;code&gt;hashCode&lt;/code&gt; 方法，看看会发生什么，举个例子来看:&lt;/p&gt;
&lt;p&gt;定义学生类，并通过 IDE 只帮我们生成 &lt;code&gt;equals&lt;/code&gt; 方法:&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public class Student {

    private String name;

    private int age;

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        Student student = (Student) o;
        return age == student.age &amp;amp;&amp;amp;
                Objects.equals(name, student.name);
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;编写测试代码:&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;Student student1 = new Student();
student1.setName(&quot;日拱一兵&quot;);
student1.setAge(18);

Student student2 = new Student();
student2.setName(&quot;日拱一兵&quot;);
student2.setAge(18);

System.out.println(&quot;student1.equals(student2)的结果是：&quot; + student1.equals(student2));

Set&amp;lt;Student&amp;gt; students = new HashSet&amp;lt;Student&amp;gt;();
students.add(student1);
students.add(student2);
System.out.println(&quot;Student Set 集合长度是：&quot; + students.size());

Map&amp;lt;Student, java.lang.String&amp;gt; map = new HashMap&amp;lt;Student, java.lang.String&amp;gt;();
map.put(student1, &quot;student1&quot;);
map.put(student2, &quot;student2&quot;);
System.out.println(&quot;Student Map 集合长度是：&quot; + map.keySet().size());&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;查看运行结果:&lt;/p&gt;
&lt;pre class=&quot;console&quot;&gt;
&lt;code&gt;student1.equals(student2)的结果是：true
Student Set 集合长度是：2
Student Map 集合长度是：2&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;很显然，按照集合 Set 和 Map 加入元素的标准来看，student1 和 student2 是两个对象，因为在调用他们的 put (Set add 方法的背后也是 HashMap 的 put)方法时， 会先判断 hash 值是否相等，这个小伙伴们打开 JDK 自行查看吧&lt;/p&gt;
&lt;p&gt;所以我们继续重写 Student 类的 &lt;code&gt;hashCode&lt;/code&gt; 方法:&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;@Override
public int hashCode() {
    return Objects.hash(name, age);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;重新运行上面的测试，查看结果:&lt;/p&gt;
&lt;pre class=&quot;console&quot;&gt;
&lt;code&gt;student1.equals(student2)的结果是：true
Student Set 集合长度是：1
Student Map 集合长度是：1&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;得到我们预期的结果，这也就是为什么通常我们重写 &lt;code&gt;equals&lt;/code&gt; 方法为什么最好也重写 &lt;code&gt;hashCode&lt;/code&gt; 方法的原因&lt;/p&gt;
&lt;ul readability=&quot;0.47686375321337&quot;&gt;&lt;li readability=&quot;0.928&quot;&gt;
&lt;p&gt;如果你在使用 Lombok，不知道你是否注意到 Lombok 只有一个 &lt;code&gt;@EqualsAndHashCode&lt;/code&gt; 注解，而没有拆分成 @Equals 和 @HashCode 两个注解，想了解更多 Lombok 的内容，也可以查看我之前写的文章 &lt;a href=&quot;https://dayarch.top/p/lombok-usage.html&quot;&gt;Lomok 使用详解&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;另外通过 IDE 快捷键生成重写方法时，你也会看到这两个方法放在一起，而不是像 getter 和 setter 那样分开&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1583165/201912/1583165-20191223083755480-333843844.jpg&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;以上两点都是隐形的规范约束，希望大家也严格遵守这个规范，以防带来不必要的麻烦，记忆的方式有多样，如果记不住这个文字约束，脑海中记住上面的图你也就懂了&lt;/p&gt;
&lt;h3 id=&quot;重写-hashcode-为什么总有-31-这个数字&quot;&gt;5. 重写 &lt;code&gt;hashCode&lt;/code&gt; 为什么总有 31 这个数字？&lt;/h3&gt;
&lt;p&gt;细心的朋友可能注意到，我上面重写 &lt;code&gt;hashCode&lt;/code&gt;的方法很简答， 就是用了 &lt;code&gt;Objects.hash&lt;/code&gt; 方法，进去查看里面的方法:&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public static int hashCode(Object a[]) {
    if (a == null)
        return 0;

    int result = 1;

    for (Object element : a)
        result = 31 * result + (element == null ? 0 : element.hashCode());

    return result;
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;这里通过 31 来计算对象 hash 值&lt;/p&gt;
&lt;p&gt;在 &lt;a href=&quot;https://dayarch.top/p/spring-data-binding-mechanism.html&quot;&gt;如何妙用 Spring 数据绑定？&lt;/a&gt; 文章末尾提到的在 &lt;code&gt;HandlerMethodArgumentResolverComposite&lt;/code&gt; 类中有这样一个成员变量:&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;private final Map&amp;lt;MethodParameter, HandlerMethodArgumentResolver&amp;gt; argumentResolverCache =
            new ConcurrentHashMap&amp;lt;MethodParameter, HandlerMethodArgumentResolver&amp;gt;(256);&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Map 的 key 是 &lt;code&gt;MethodParameter&lt;/code&gt; ，根据我们上面的分析，这个类一定也会重写 &lt;code&gt;equals&lt;/code&gt; 和 &lt;code&gt;hashCode&lt;/code&gt; 方法，进去查看发现，hashCode 的计算也用到了 31 这个数字&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;@Override
public boolean equals(Object other) {
    if (this == other) {
        return true;
    }
    if (!(other instanceof MethodParameter)) {
        return false;
    }
    MethodParameter otherParam = (MethodParameter) other;
    return (this.parameterIndex == otherParam.parameterIndex &amp;amp;&amp;amp; getMember().equals(otherParam.getMember()));
}

@Override
public int hashCode() {
    return (getMember().hashCode() * 31 + this.parameterIndex);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;为什么计算 hash 值要用到 31 这个数字呢？我在网上看到一篇不错的文章，分享给大家，作为科普，可以简单查看一下:&lt;br/&gt;&lt;a href=&quot;https://www.cnblogs.com/nullllun/p/8350178.html&quot;&gt;String hashCode 方法为什么选择数字31作为乘子&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;
&lt;p&gt;如果还对&lt;code&gt;equals&lt;/code&gt; 和 &lt;code&gt;hashCode&lt;/code&gt; 关系及约束含混，我们只需要按照上述步骤逐步回忆即可，更好的是直接查看 JDK 源码；另外拿出实际的例子来反推验证是非常好的办法。如果你还有相关疑问，也可以留言探讨.&lt;/p&gt;
&lt;h2 id=&quot;灵魂追问&quot;&gt;灵魂追问&lt;/h2&gt;
&lt;ol&gt;&lt;li&gt;Thread 类就没有重写 &lt;code&gt;equals&lt;/code&gt; 方法，你还知道哪些情况没必要重写 &lt;code&gt;equals&lt;/code&gt; 方法吗？&lt;/li&gt;
&lt;li&gt;从上面 HandlerMethodArgumentResolverComposite 类中定义的 Map 成员变量，你注意到哪些知识点，比如 final，ConcurrentHashMap，初识容量，为什么要这样写？你能解释出原因吗？&lt;/li&gt;
&lt;/ol&gt;&lt;blockquote&gt;
&lt;h3 id=&quot;欢迎持续关注公众号日拱一兵&quot;&gt;欢迎持续关注公众号：「日拱一兵」&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;前沿 Java 技术干货分享&lt;/li&gt;
&lt;li&gt;高效工具汇总 | 回复「工具」&lt;/li&gt;
&lt;li&gt;面试问题分析与解答&lt;/li&gt;
&lt;li&gt;技术资料领取 | 回复「资料」&lt;/li&gt;
&lt;/ul&gt;&lt;/blockquote&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;以读侦探小说思维轻松趣味学习 Java 技术栈相关知识，本着将复杂问题简单化，抽象问题具体化和图形化原则逐步分解技术问题，技术持续更新，请持续关注......&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr/&gt;&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1583165/201912/1583165-20191223083758456-1473831456.png&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Mon, 23 Dec 2019 00:38:00 +0000</pubDate>
<dc:creator>日拱一兵</dc:creator>
<og:description>前言 上一篇文章 '如何妙用 Spring 数据绑定？' ， 灵魂追问 环节留下了一个有关 equals 和 hashcode 问题 。基础面试经常会碰到与之相关的问题，这不是一个复杂的问题，但很多朋</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/FraserYu/p/12081976.html</dc:identifier>
</item>
<item>
<title>《程序员有故事》终于，我还是被他们搞崩溃了 - 我是13</title>
<link>http://www.cnblogs.com/han-1034683568/p/12043767.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/han-1034683568/p/12043767.html</guid>
<description>&lt;p&gt;这是发生在我 QQ 群里的一件事情，当时直接把我气的吐血，也过去了挺久的，但是觉得挺有意思的，现在整理一下这个事情，逗大家一乐儿。由于最近比较忙，也没想好新的题材来写博客，就拿这件事来顶一顶，主要是觉得这也是我日常生活中经历的小折磨，伤口扒开让大家看一看刀疤可不可爱，把我不开心的事情说出来让大家开心一下，接下来我们谈一谈次的崩溃事件。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;PS：本次事件中的主角我已经沟通过，可以用该事件来整理这篇文章，感谢。另外，所有关于聊天记录中的个人账户信息都已经做了遮挡操作。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/859549/201912/859549-20191221184314221-109941510.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;我的 2019 年记录：&lt;/strong&gt;&lt;br/&gt;&lt;a href=&quot;https://juejin.im/post/5df74b8cf265da33ee178407&quot;&gt;&lt;strong&gt;「合抱之木，生于毫末，百丈之台，起于垒土」记录我的 2019&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;在线问答&quot;&gt;在线问答&lt;/h2&gt;
&lt;p&gt;好，来。&lt;/p&gt;
&lt;p&gt;这是一个非常平静的周一，打完卡--&amp;gt;吃完早饭--&amp;gt;开完早会，准备看看邮件又有什么东西要做。忽然，QQ 群里热闹起来了，这就是我的日常，几个 QQ 群总会时不时的忽然就躁动了起来，躁动的像你妈打你毫无道理。此时，我还没有意识到事情的严重性，接下来的半个小时我应该都会后悔点开这只跳动的小企鹅。&lt;/p&gt;
&lt;h4 id=&quot;section&quot;&gt;9:56:44&lt;/h4&gt;
&lt;p&gt;记住这个时间，&lt;strong&gt;9:56:44&lt;/strong&gt;，一切的一切由此开始，一位 QQ 群友在群里发问，无法登陆 &lt;a href=&quot;https://github.com/ZHENFENG13/My-Blog&quot;&gt;My-Blog&lt;/a&gt; 的后台让我们帮忙看一下。 &lt;a href=&quot;https://github.com/ZHENFENG13/My-Blog&quot;&gt;My-Blog&lt;/a&gt; 是我的另外一个在 GitHub 上发布的开源博客项目，我还没有介绍给大家，后续我会整理一些文章来详细地介绍一下这个 Spring Boot 开源博客项目。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/859549/201912/859549-20191221184112388-1933815505.png&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;section-1&quot;&gt;9:58:42&lt;/h4&gt;
&lt;p&gt;有其他群友发了一句加盐了，紧接着发问的群友又问了一句什么意思。&lt;/p&gt;
&lt;h4 id=&quot;section-2&quot;&gt;10:23:02&lt;/h4&gt;
&lt;p&gt;好的，过了差不多半小时，本次崩溃事件的主角闪亮登场了！让我们掌声欢迎受害者入场！&lt;/p&gt;
&lt;p&gt;可能是当时开会比较久，亦或者是在带薪蹲坑，所以一直到半小时后才看到群里的消息，然后受害者回了一句“可能又是没连上数据库”，同时配上一个无语的表情。&lt;/p&gt;
&lt;h3 id=&quot;事件背景&quot;&gt;事件背景&lt;/h3&gt;
&lt;p&gt;好的，通过以上三个时间点以及施暴者和受害者之间的对话，我来还原一下整个事件的背景：&lt;/p&gt;
&lt;p&gt;一位群友使用了我的开源博客项目代码，在本地启动并很顺畅的运行了，但是在登录博客后台管理系统时，没有登录成功，他不知道是什么原因，也可能捣鼓了很久但是没有结果，因此他选择来到受害者的 QQ 群里施暴，噢不对，是发问。&lt;/p&gt;
&lt;p&gt;紧接着一位群友说是加盐了，这里我插一句，并不是加盐了， &lt;a href=&quot;https://github.com/ZHENFENG13/My-Blog&quot;&gt;My-Blog&lt;/a&gt; 这个开源博客的登录方式很简单，用户的登录流程也不复杂，表结构设计也就是用户名、密码这种字段，密码是用到了 MD5 方式存储的，并没有加盐。&lt;/p&gt;
&lt;p&gt;紧接着受害者回答到可能是没连上数据库，我们看此时的受害者还是一脸轻松，他竟然还能发得出宝情标，说明此时受害者情绪也比较稳定。&lt;/p&gt;
&lt;p&gt;至于为什么说没连上数据库呢？因为这个项目自从开源到现在，我遇到最多的问题就是为什么连不上数据库，至于没连上数据库的原因也很简单，十个遇到这个问题的朋友有九个是数据库账户或者密码写错了。其他问题应该不多，因为这个开源项目很齐全，所有的代码都是开源的，Java 代码全部开源，页面文件全部开源，数据库文件全部开源，默认的后台登录账号密码我也已经写到文档里了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2019/12/15/16f07e6ad7083482?w=1280&amp;amp;h=807&amp;amp;f=png&amp;amp;s=112255&quot;/&gt;&lt;/p&gt;
&lt;p&gt;因此使用这个项目的朋友一般不会遇到这个问题，最多的问题就是连不上数据库，这也是为什么我会那么回答。&lt;/p&gt;
&lt;p&gt;OK，背景介绍完毕，请大家记住受害者此时的平静，弹幕刷起来，“合影留念”。&lt;/p&gt;
&lt;h2 id=&quot;在线确认&quot;&gt;在线确认&lt;/h2&gt;
&lt;h4 id=&quot;section-3&quot;&gt;10:44:58&lt;/h4&gt;
&lt;p&gt;紧接着，这位群友回答，已经连上数据库了，只是登录不进去。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/859549/201912/859549-20191221184126646-345983108.png&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;section-4&quot;&gt;10:49:09&lt;/h4&gt;
&lt;p&gt;由于众人并没有在群里说话，这位群友又再次确认，并问道“账号密码不就是 user 表里的吗”。&lt;strong&gt;（PS：还好他问了这么一句，不然真找不到什么问题）&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&quot;section-5&quot;&gt;10:50:12&lt;/h4&gt;
&lt;p&gt;通过监控记录，我们再次发现了受害者的身影。&lt;/p&gt;
&lt;p&gt;因为他刚刚问了那么一句话，所以我已经确定应该不是程序问题，之前我还有点怀疑是不是开源代码有问题，现在可以确认应该是这位群友的操作问题。虽然如此，但是我也发现了一个令我吃惊的事情，就是这哥们儿貌似在做一件我无法理解、也万万没有想到的事情，他输账号密码的时候输入了加密后的字符串。&lt;/p&gt;
&lt;p&gt;因此，受害者开始进行确认：“你账号输了 admin 密码输了 md5 后的字符串？”。此时，我多么希望他不是这么做的，不然我真的无法接受。&lt;/p&gt;
&lt;h4 id=&quot;section-6&quot;&gt;10:51:12&lt;/h4&gt;
&lt;p&gt;通过监控记录，我们发现嫌疑人也出现在画面中，而且，手中的凶器上已经沾上了血迹。&lt;/p&gt;
&lt;p&gt;这位群友发的截图，真的像是一刀扎在了我坚实的胸膛上（就当是坚实的吧，大家别戳穿我，嘻嘻），我当时真的开始有点儿难受了。&lt;/p&gt;
&lt;h4 id=&quot;section-7&quot;&gt;10:51:22&lt;/h4&gt;
&lt;p&gt;不看监控了。&lt;/p&gt;
&lt;p&gt;受害者当时并不死心，又再次进行确认。&lt;/p&gt;
&lt;p&gt;我不敢相信我的眼睛，因此我再三确认，前文中我也提到过，这个开源博客项目的文档是很全的，所有文件开源，而且一些注意事项我也写在仓库文档里了，其实确认的时候已经是崩溃的前兆了。&lt;/p&gt;
&lt;h4 id=&quot;section-8&quot;&gt;10:51:56&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;“对，密码直接复制进去的”&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;弹幕刷起来，“合影留念”。&lt;/p&gt;
&lt;p&gt;这句话当时就将我击倒了，我不敢相信我的眼睛，也有其他群友看不下去了，开始表示无奈。&lt;/p&gt;
&lt;h2 id=&quot;在线崩溃&quot;&gt;在线崩溃&lt;/h2&gt;
&lt;h4 id=&quot;section-9&quot;&gt;10:52:04&lt;/h4&gt;
&lt;p&gt;确认结果仅仅几秒钟之后，受害者崩溃了，QQ 群主在线崩溃。&lt;/p&gt;
&lt;p&gt;OK，还开始口吐芬芳。&lt;/p&gt;
&lt;p&gt;跟大家说一下，10:51:57 到 10:52:04 这短短的几秒钟，大家不知道我有多痛苦，我平时在群里一直是一个很开朗的形象，但是真的被这件事情打击的没了心智。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;那几秒钟，我甚至开始怀疑世界，我做错了什么？我到底要怎样活？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;10:52:04 到 10:52:30 继续自闭。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/859549/201912/859549-20191221184141972-995632574.png&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;section-10&quot;&gt;10:52:50&lt;/h4&gt;
&lt;p&gt;终于整理好了情绪，但是我已经崩溃了。&lt;/p&gt;
&lt;p&gt;我向群里的老哥们发问：“你们真的要这么搞我吗？”&lt;/p&gt;
&lt;p&gt;我当时太痛苦了，我真的已经开始怀疑世界了，为什么要这么针对我啊？明明已经告诉你账号密码了，你怎么还能输错啊？是不是要我到你家里给你开电脑、给你启动项目才行啊？我到底要怎样做你们才能满意啊？&lt;/p&gt;
&lt;h3 id=&quot;开始整活儿&quot;&gt;开始整活儿&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;看到这里我气得浑身发抖，大热天的全身冷汗，手脚冰凉，地狱空荡荡魔鬼在人间，这个 QQ 群还能不能好了？群主到底要怎么活着你们才满意 ？眼泪不争气的流了下来 ，这个 QQ 群到处充斥着对群主的压迫，群主何时才能真正的站起来！&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;浑身发抖，浑身发抖，爷当时只记得浑身发抖。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2019/12/15/16f07e6ad5a11cd3?w=589&amp;amp;h=418&amp;amp;f=gif&amp;amp;s=169882&quot;/&gt;&lt;/p&gt;
&lt;p&gt;你们发现了吗？还有群友看热闹不嫌事儿大，&lt;strong&gt;我太难了，发抖警告！&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;在线诉苦&quot;&gt;在线诉苦&lt;/h2&gt;
&lt;p&gt;其实我也不记得当时的想法了，但是我感觉得到我当时心里特别特别堵，因为真的很少在群里暴躁，要么就是当天早上发生了其他的事情，茶叶蛋壳没剥好，或者是豆浆太烫不舒服，总之那天就忽然崩溃掉了，这也是我建群以来第一次崩溃，之后开始诉苦。&lt;/p&gt;
&lt;h4 id=&quot;section-11&quot;&gt;10:53:22&lt;/h4&gt;
&lt;p&gt;其实我当时已经崩溃了，也有点疯了，10:53:22 开始碎碎念模式。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/859549/201912/859549-20191221184200088-84440445.png&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;section-12&quot;&gt;10:53:43&lt;/h4&gt;
&lt;p&gt;继续诉苦，碰到一些很无奈的问题，就得调整心态。&lt;/p&gt;
&lt;h4 id=&quot;section-13&quot;&gt;10:54:04&lt;/h4&gt;
&lt;p&gt;这群主疯了！他还在碎碎念！&lt;/p&gt;
&lt;p&gt;所有的代码都是开源的，Java 代码全部开源，页面文件全部开源，数据库文件全部开源，我都做到这份儿上了，我真的不知道为毛还要被折磨啊？&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/859549/201912/859549-20191221184212886-988557416.png&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;section-14&quot;&gt;10:54:19&lt;/h4&gt;
&lt;p&gt;崩溃的群主，他还在诉苦！&lt;/p&gt;
&lt;p&gt;对，还有说找不到 SQL 文件的！！！我都写在文档里了好吗！！！都已经标上去了！！！&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2019/12/15/16f07e6b0b28f658?w=1280&amp;amp;h=807&amp;amp;f=png&amp;amp;s=109211&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;section-15&quot;&gt;10:56:52&lt;/h4&gt;
&lt;p&gt;继续诉苦。&lt;/p&gt;
&lt;p&gt;建群之后遇到的问题也很多了，连不上数据库、页面报错、Maven 依赖报错、代码看不懂、下载不到 Jar 包、不会用 IDEA.....&lt;/p&gt;
&lt;p&gt;一系列的问题，我都感觉挺正常的，可能是刚开始学 Spring Boot，或者刚开始着手做一些 Java Web 项目，有一些问题是非常正常的。但是今天这种事情真的离谱，我也是第一次碰到这种问题，而且我万万想不到的就是，这位朋友真的把 MD5 后的字符串输入了密码框！这也是我建群之后，或者说开源了这个博客项目之后，第一次碰到有人这么搞我，真的崩溃了。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/859549/201912/859549-20191221184223811-1566306201.png&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;section-16&quot;&gt;10:57:06&lt;/h4&gt;
&lt;p&gt;帅气的脸庞忽然红了。&lt;/p&gt;
&lt;p&gt;可能是意识到场面有些失控，群主开始调整心态，毕竟崩溃是不能解决问题的。&lt;/p&gt;
&lt;h4 id=&quot;section-17&quot;&gt;10:57:34&lt;/h4&gt;
&lt;p&gt;真的好累啊。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;就算了吧，不要把大家弄得尴尬。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;还是算了吧，也不是有意错填密码。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;那就算了吧，各回各家。&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;放下吧&quot;&gt;放下吧&lt;/h3&gt;
&lt;p&gt;“没事儿，都是一步步过来的，我好了。”&lt;/p&gt;
&lt;p&gt;还是告诉大家，群主已经没事了，这件事就让它过去吧。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/859549/201912/859549-20191221184403542-2040037204.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;我不是真的快乐，我的微笑只是我涂上的保护色。&lt;/p&gt;
&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;
&lt;p&gt;别再逼我了，我就要发抖了，手脚冰凉警告！&lt;/p&gt;
&lt;p&gt;给大家整理了一下受害者崩溃的时间线，希望大家能够心疼一下这位卑微的群主，哪怕一秒也行。当然，这位被折磨到崩溃的受害者就是我本人，这件事情我一直都印象深刻，每次看到群里有人问关于 &lt;a href=&quot;https://github.com/ZHENFENG13/My-Blog&quot;&gt;My-Blog&lt;/a&gt; 这个开源博客项目的问题时，我都会想起这段回忆，也会记起那天被群友支配的恐惧，唉。&lt;/p&gt;
&lt;p&gt;我是十三，今后我依然会分享一些经历过的好玩的事情。&lt;/p&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;除注明转载/出处外，皆为作者原创，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文链接，否则保留追究法律责任的权利。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;感谢大家的观看，我是十三，文章首发于我的公众号“程序员的小故事”。&lt;/strong&gt;&lt;/p&gt;
</description>
<pubDate>Mon, 23 Dec 2019 00:32:00 +0000</pubDate>
<dc:creator>我是13</dc:creator>
<og:description>看到这里我气得浑身发抖，大热天的全身冷汗，手脚冰凉，地狱空荡荡魔鬼在人间...</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/han-1034683568/p/12043767.html</dc:identifier>
</item>
<item>
<title>【玩转SpringBoot】SpringBoot应用的启动过程一览表 - 编程新说(李新杰)</title>
<link>http://www.cnblogs.com/lixinjie/p/playing-springboot-007.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/lixinjie/p/playing-springboot-007.html</guid>
<description>&lt;p&gt;&lt;span&gt;&lt;br/&gt;SpringBoot应用的启动方式很简单，就一行代码，如下图01：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141207266-1945039671.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;span&gt;其实这行代码背后主要执行两个方法，一个是构造方法，一个是run方法。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;构造方法主要内容就是收集一些数据，和确认一些信息。&lt;/span&gt;&lt;span&gt;如下图02：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141217311-1476174029.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;span&gt;真正的执行要从run方法开始，为此，SpringBoot特意定义了一个监听器，专门监听这个run方法的执行过程。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;这个监听器的名字是，&lt;/span&gt;&lt;span&gt;SpringApplicationRunListener&lt;/span&gt;&lt;span&gt;，如下图03：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141225045-1627730833.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;span&gt;这个接口的方法其实就表示了SpringBoot应用的启动过程。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;&lt;span&gt;备注&lt;/span&gt;&lt;/strong&gt;&lt;span&gt;：这个监听器是SpringBoot自己使用的，我们虽然也可以使用，但有些麻烦。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;第一步，启动&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;当进入run方法后，首先就是获取监听器，并触发&lt;/span&gt;&lt;span&gt;starting&lt;/span&gt;&lt;span&gt;方法。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;应用正式开始启动，如下图04：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141245413-1375397992.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;span&gt;第二步，准备环境&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;最先要准备好的就是&lt;/span&gt;&lt;span&gt;Environment&lt;/span&gt;&lt;span&gt;，因为后续要使用它。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;它里面的值也包含启动时的命令行参数，如下图05：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141300904-375540715.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;span&gt;此时会触发监听器的&lt;/span&gt;&lt;span&gt;environmentPrepared&lt;/span&gt;&lt;span&gt;方法，如下图06：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141309325-1845451146.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;span&gt;第三步，创建容器&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;根据应用类型创建适合的Spring容器，如下图07：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141316749-1702201894.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;span&gt;第四步，准备容器&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;主要包括把Environment设置给容器，执行容器的自定义初始化器。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;同时触发监听器的&lt;/span&gt;&lt;span&gt;contextPrepared&lt;/span&gt;&lt;span&gt;方法，如下图08：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141328235-710324115.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;span&gt;第五步，加载资源&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;这里的资源主要包括应用的主类，还有用户显式设置的类名/包名/XML文件等。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;加载这些资源的目的就是为了&lt;/span&gt;&lt;span&gt;注册bean定义&lt;/span&gt;&lt;span&gt;。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;然后再触发监听器的&lt;/span&gt;&lt;span&gt;contextLoaded&lt;/span&gt;&lt;span&gt;方法，如下图09：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141340234-456637407.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;span&gt;第六步，容器刷新&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;容器刷新主要包括调用“&lt;/span&gt;&lt;span&gt;后处理器&lt;/span&gt;&lt;span&gt;”进一步注册bean定义。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;还包括对所有（非延迟加载）单例bean的实例化和初始化。如下图10：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141347276-1652407232.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;span&gt;此时，其实Spring容器已经启动成功了。所以触发了监听器的&lt;/span&gt;&lt;span&gt;started&lt;/span&gt;&lt;span&gt;方法。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;表明已经启动了，如下图11：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141355353-619133203.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;span&gt;第七步，调用Runner接口&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;Runner&lt;/span&gt;&lt;span&gt;接口就是容器启动成功后马上就会被执行的。它的实现类作为bean注册到容器中。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;所以是从容器中拿出这些bean再执行，如下图12：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141411686-1234871519.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;span&gt;此时，启动过程需要执行的所有东西都已完成。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span&gt;因此，要触发监听器的&lt;/span&gt;&lt;span&gt;running&lt;/span&gt;&lt;span&gt;方法，表明已经进入正常运行状态，如下图13：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141422661-713865932.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;&lt;span&gt;run方法也已经结束了，就把&lt;/span&gt;&lt;span&gt;容器对象&lt;/span&gt;&lt;span&gt;返回了，如下图14：&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141433149-993735555.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;（END）&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;&amp;gt;&amp;gt;&amp;gt; 玩转SpringBoot系列文章 &amp;lt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484558&amp;amp;idx=1&amp;amp;sn=6da1a74d280f4f2a41cbf5874ed620e0&amp;amp;chksm=fc333f7ecb44b668f8d18be8efa436d8052d98874f843a8edf314141c7a4bb4bcb2345ab5ae4&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【玩转SpringBoot】配置文件yml的正确打开姿势&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484588&amp;amp;idx=1&amp;amp;sn=2b790b38aab1d1f6818c078a52b69553&amp;amp;chksm=fc333f5ccb44b64afcb7a9cabe51edefbb4f4123f6324ae3e1b2545f97ef8c9a2fb49e8a560e&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【玩转SpringBoot】用好条件相关注解，开启自动配置之门&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484604&amp;amp;idx=1&amp;amp;sn=e999dadf378e3da42b05b99f8df00dc9&amp;amp;chksm=fc333f4ccb44b65a7a3cfd6f3261c9eef1d21b8f4e1a3d8358778fda7d3e98f806b271ce4886&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【玩转SpringBoot】给自动配置来个整体大揭秘&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484633&amp;amp;idx=1&amp;amp;sn=36ee4389dedd80a617fed5b1f8653f0e&amp;amp;chksm=fc333f29cb44b63f198793bd06179278153e1688fffa3af364959f525b87e707fa588f345611&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【玩转SpringBoot】看似复杂的Environment其实很简单&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484649&amp;amp;idx=1&amp;amp;sn=72a27fd5a3d6547e5c6045a56290d78c&amp;amp;chksm=fc333f19cb44b60ffe5fc25f9597ae696b535b4d0367ca6ca1ebe6cbce7ebd782fd2a8e10456&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【玩转SpringBoot】翻身做主人，一统web服务器&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484671&amp;amp;idx=1&amp;amp;sn=3c23049752569faf6c3a31f1bbcc51aa&amp;amp;chksm=fc333f0fcb44b619b579423de446e7adb2e997e3bb6ad75ce097100b71879d1a3b85505d2490&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【玩转SpringBoot】让错误处理重新由web服务器接管&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;&amp;gt;&amp;gt;&amp;gt; 品Spring系列文章 &amp;lt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt; &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484224&amp;amp;idx=1&amp;amp;sn=78a994d8311dd0abf3f9419108ff363a&amp;amp;chksm=fc3338b0cb44b1a6803dbeb8540c17ce753f1878e3b7cc86cf6508e81dc32736f84d7224f166&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：帝国的基石&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484229&amp;amp;idx=1&amp;amp;sn=b552914c42963d06306d35f1d8332284&amp;amp;chksm=fc3338b5cb44b1a39d0762b2fd94d8870fcbc520b0713964d9a453d8466d781897707de8cd8f&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：bean定义上梁山&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484244&amp;amp;idx=1&amp;amp;sn=d500b3ed748331687028b78d567222a8&amp;amp;chksm=fc3338a4cb44b1b23f5dd9bef1cc66950a1ded23151a05b38716f4ec46ff960cdda5d8022e8f&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：实现bean定义时采用的“先进生产力”&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484249&amp;amp;idx=1&amp;amp;sn=dfbdca65a2b64b0ac951f90b301e73a0&amp;amp;chksm=fc3338a9cb44b1bfafee072597430dae91d4dd8b4787e4af0896f9ce45b258fd5d3634169a5d&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：注解终于“成功上位”&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484259&amp;amp;idx=1&amp;amp;sn=791a5726b9b7bf41e4e64053cfbc7ffa&amp;amp;chksm=fc333893cb44b1851d2052423392551ca9188c4fc0a33f412ddda13af9e0dc6655966a668964&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：能工巧匠们对注解的“加持”&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484301&amp;amp;idx=1&amp;amp;sn=a5557c4c285cb07a052238d3de2a2585&amp;amp;chksm=fc33387dcb44b16b487edee0ab4c755de394d19dd4a0acd2532af0e49e95eb7988628e93157b&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：SpringBoot和Spring到底有没有本质的不同？&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484319&amp;amp;idx=1&amp;amp;sn=89d925e6128109444c2ec40111a9f217&amp;amp;chksm=fc33386fcb44b179dcee6ef522e2252420658c0342759a9d6d9795bf90b144f6284c72fe808d&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：负责bean定义注册的两个“排头兵”&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484337&amp;amp;idx=1&amp;amp;sn=398a1f718cc8b5a711ba9f45a6d9074b&amp;amp;chksm=fc333841cb44b157da33d685daedda001cb59abb64aa6152c3d4096d43c8d92bff8ae5d084ed&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：SpringBoot轻松取胜bean定义注册的“第一阶段”&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484358&amp;amp;idx=1&amp;amp;sn=21fc717c7815ae41103e3e2e4f5520df&amp;amp;chksm=fc333836cb44b120fd9073b6075580109d5665afbd0f50abe43e8a5aea42e066c759dcdb8157&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：SpringBoot发起bean定义注册的“二次攻坚战”&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484369&amp;amp;idx=1&amp;amp;sn=ac9d591014074f49a96bc9f3ed7cca4a&amp;amp;chksm=fc333821cb44b137f3c0c7c24b88fc5b3edfa0dc530366b884a3813759ae6fb32c1974e506de&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：注解之王@Configuration和它的一众“小弟们”&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484403&amp;amp;idx=1&amp;amp;sn=f10760d51119f91b5c18d3267ebbd1eb&amp;amp;chksm=fc333803cb44b115a6fcab3e264233514f90fd8874f038361aaa174e8c73bb7f2a31d96f9099&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：bean工厂后处理器的调用规则&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484414&amp;amp;idx=1&amp;amp;sn=16391934efdc318c65251d311a6cc61c&amp;amp;chksm=fc33380ecb44b1183af1d82647996fb5ec24a3cc977b028671cb62f91edcc421542e92ecbe92&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：详细解说bean后处理器&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484431&amp;amp;idx=1&amp;amp;sn=29a6cc3aa9959c04512864ee59365f6b&amp;amp;chksm=fc333fffcb44b6e9cce30ca85ee1c8a32fd5e5597cd27d45a1c1a6bc3bd59b004df3cc66ea22&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：对@PostConstruct和@PreDestroy注解的处理方法&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484448&amp;amp;idx=1&amp;amp;sn=dc0e6d9b0ddd8168d749b90069999c03&amp;amp;chksm=fc333fd0cb44b6c68127c6a1e8b9c91891ef4ee37df40e7c85d2b67bd058d3c59e5e51d06101&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：对@Resource注解的处理方法&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484462&amp;amp;idx=1&amp;amp;sn=d492ff48764329f37abd452b0b4e1287&amp;amp;chksm=fc333fdecb44b6c8b6634ac340a63c9271d22a08e53d3adaeef5e487658a425122b45f84fd20&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：对@Autowired和@Value注解的处理方法&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484505&amp;amp;idx=1&amp;amp;sn=98e154a00e7782ec8fb9ca2d6295dfcd&amp;amp;chksm=fc333fa9cb44b6bf0283da8353aba4cca8267315c91e18765dfebc4aa70da96394b9b374e078&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：真没想到，三十步才能完成一个bean实例的创建&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484532&amp;amp;idx=1&amp;amp;sn=09a007062e2d5835a253f14f9269d9b0&amp;amp;chksm=fc333f84cb44b692b4db0a7140776eefe746f52ca03bd522582d35752fc3ed3ff5eb6087feb8&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：关于@Scheduled定时任务的思考与探索，结果尴尬了&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;&amp;gt;&amp;gt;&amp;gt; 热门文章集锦 &amp;lt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484219&amp;amp;idx=1&amp;amp;sn=e6c39138e44ce8f0c91aba4873fb42cd&amp;amp;chksm=fc3338cbcb44b1dde7ae372ed66b40bdf4f755d711008810eb837a8f78d884f00956ae7ce7a7&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;毕业10年，我有话说&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247483949&amp;amp;idx=1&amp;amp;sn=200c9ac4f8e4e877b0b253d45205712a&amp;amp;chksm=fc3339ddcb44b0cb5ac2957dbed41b2f9e11fbba14967d00f97012806a9d6af364b0f8135eee&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【面试】我是如何面试别人List相关知识的，深度有点长文&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247483989&amp;amp;idx=1&amp;amp;sn=cf9ce5c3f7981c16b71047b868b1c1ab&amp;amp;chksm=fc3339a5cb44b0b3df524ce684e8cd76ab6d15a2ccf26ec2425ecbcdd26bc777b95a06994189&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;我是如何在毕业不久只用1年就升为开发组长的&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247483994&amp;amp;idx=1&amp;amp;sn=fb09e943331e89abcb99d8304ea6b677&amp;amp;chksm=fc3339aacb44b0bc2a120c79efebb46a43ce5b4d3148992d86b2841a89bb46bf5d8863e065ea&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;爸爸又给Spring MVC生了个弟弟叫Spring WebFlux&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484017&amp;amp;idx=1&amp;amp;sn=a2055640b142fc4cfa5a9901d22ec57f&amp;amp;chksm=fc333981cb44b09782c196da25dc613b38a9ede52de073bfaaaef6214a9deb294b6527091892&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【面试】我是如何在面试别人Spring事务时“套路”对方的&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484029&amp;amp;idx=1&amp;amp;sn=44b05473af37fe008bb9659a35d1a9de&amp;amp;chksm=fc33398dcb44b09bbd25a7e14e7100419988479fbeb4bda7787f1b93dd932ec699dfd793df04&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【面试】Spring事务面试考点吐血整理（建议珍藏）&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484158&amp;amp;idx=1&amp;amp;sn=1ca952ba9166c5ccf0e3f40622335fc5&amp;amp;chksm=fc33390ecb44b01898bb2500ba61a15e38487a23f5c0405d738cc4c272cd705d2dbbf1a3f8e7&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【面试】我是如何在面试别人Redis相关知识时“软怼”他的&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484164&amp;amp;idx=1&amp;amp;sn=390d911b19812d22aebd3f0f6522004c&amp;amp;chksm=fc3338f4cb44b1e20bc2344474586934a2b148f92eefdaecf134d57af10f64310579e196904a&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【面试】吃透了这些Redis知识点，面试官一定觉得你很NB（干货 | 建议珍藏）&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484184&amp;amp;idx=1&amp;amp;sn=37007efde0cc93e48c55a133dc9cc8d4&amp;amp;chksm=fc3338e8cb44b1fea0ed4af7f01de658e8a1bc7f573cb5bde2701d9b09ba14747139d2bcea39&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【面试】如果你这样回答“什么是线程安全”，面试官都会对你刮目相看（建议珍藏）&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484195&amp;amp;idx=1&amp;amp;sn=95c3acdaeb0f6a1d61f152550c3d2669&amp;amp;chksm=fc3338d3cb44b1c55f6046f6280da863d3514cca3ce50ef29e2d53b0eafe2b7efef062c51c27&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【面试】迄今为止把同步/异步/阻塞/非阻塞/BIO/NIO/AIO讲的这么清楚的好文章（快快珍藏）&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484201&amp;amp;idx=1&amp;amp;sn=7cf45aff64eecdff58d2acea8fb7c9fa&amp;amp;chksm=fc3338d9cb44b1cfc6b5c797a005c91ed19b0dd06587fdfb2e7b553e2b03104a145380a7a990&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【面试】一篇文章帮你彻底搞清楚“I/O多路复用”和“异步I/O”的前世今生（深度好文，建议珍藏）&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484206&amp;amp;idx=1&amp;amp;sn=9547fdad111ac1a8ac9311cb9e76b9dc&amp;amp;chksm=fc3338decb44b1c89aee789e80e32989ea43232321397cc265c99b1d0ce4057e6563bc00a3d3&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;【面试】如果把线程当作一个人来对待，所有问题都瞬间明白了&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484214&amp;amp;idx=1&amp;amp;sn=0f677e8b0d61b5a5317a274cc8b33cbc&amp;amp;chksm=fc3338c6cb44b1d06aa20533aafb0b7b709b3bd88dbf6af6b8f3cb91288e4afc585ecb77489a&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;Java多线程通关———基础知识挑战&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzU1NzY1Nzc1OQ==&amp;amp;mid=2247484224&amp;amp;idx=1&amp;amp;sn=78a994d8311dd0abf3f9419108ff363a&amp;amp;chksm=fc3338b0cb44b1a6803dbeb8540c17ce753f1878e3b7cc86cf6508e81dc32736f84d7224f166&amp;amp;scene=21#wechat_redirect&quot; target=&quot;_blank&quot; data-itemshowtype=&quot;0&quot; data-linktype=&quot;2&quot;&gt;&lt;span&gt;品Spring：帝国的基石&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;strong&gt;作者&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;是工作超过&lt;/span&gt;&lt;span&gt;&lt;strong&gt;10年&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;的码农，现在任架构师。喜欢研究技术，崇尚简单快乐。&lt;/span&gt;&lt;span&gt;&lt;strong&gt;追求以通俗易懂的语言解说技术，希望所有的读者都能看懂并记住。&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;下面是公众号的二维码，欢迎关注！&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/76066/201912/76066-20191215141442088-2029921887.jpg&quot; alt=&quot;&quot;/&gt;  &lt;/p&gt;
</description>
<pubDate>Mon, 23 Dec 2019 00:28:00 +0000</pubDate>
<dc:creator>编程新说(李新杰)</dc:creator>
<og:description>SpringBoot应用的启动方式很简单，就一行代码，如下图01： 其实这行代码背后主要执行两个方法，一个是构造方法，一个是run方法。构造方法主要内容就是收集一些数据，和确认一些信息。如下图02：</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/lixinjie/p/playing-springboot-007.html</dc:identifier>
</item>
<item>
<title>springcloud-ribbon负载均衡 - 知识追寻者</title>
<link>http://www.cnblogs.com/zszxz/p/12081935.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/zszxz/p/12081935.html</guid>
<description>&lt;p&gt;经过几篇的cloud系列文章，我想大家都有一个坚实的基础，后续的学习就会轻松很多，如果是刚刚来看的读者需要有eureka基础知识，或者查阅知识追寻者的cloud系列专栏；这篇文章主要讲解如何使用ribbon实现web service客户端调用，ribbon默认算法实现负载均衡等！&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/Netflix/ribbon&quot;&gt;ribbon&lt;/a&gt;是一个客户端负载均衡器，其能够整合不同的协议工具进行web service API 调用；&lt;/p&gt;
&lt;p&gt;主要特色如下：&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;提供可插拔式的负载均衡&lt;/li&gt;
&lt;li&gt;整合服务发现&lt;/li&gt;
&lt;li&gt;故障弹性恢复&lt;/li&gt;
&lt;li&gt;cloud支持&lt;/li&gt;
&lt;li&gt;客户端整合加载负载均衡&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;核心工程如下：&lt;/p&gt;
&lt;p&gt;ribbon-core：整合其他模块实现负载均衡&lt;/p&gt;
&lt;p&gt;ribbon-eureka: 基于 eureka client 实现 负载均衡&lt;/p&gt;
&lt;p&gt;ribbon-httpclient: 包括JSR-311 实现REST 加载负载均衡&lt;/p&gt;

&lt;p&gt;在之前的 eureka-client工程中创建controller包，并提供表现层接口，代码如下，然后启动eureka-client实例2个，分别为8090端口，8091端口;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;/**
 * @Author lsc
 * &amp;lt;p&amp;gt; 知识追寻者，ribbon provider the restful api&amp;lt;/p&amp;gt;
 */
@RestController
public class RibbonProvidderController {


    @GetMapping(&quot;zszxz/ribbon&quot;)
    public String testRibbon(){
        return &quot;hell i am zszxz&quot;;
    }
}&lt;/code&gt;
&lt;/pre&gt;

&lt;h2 id=&quot;pom.xml&quot;&gt;4.1 pom.xml&lt;/h2&gt;
&lt;p&gt;在父工程低下添加新模块 ribbon-client；原来的start-web依赖在父工程中已经引入，故ribbon模块中不会再次引入该依赖；&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;    &amp;lt;dependencies&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;spring-cloud-starter-netflix-eureka-client&amp;lt;/artifactId&amp;gt;
        &amp;lt;/dependency&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;spring-cloud-starter-ribbon&amp;lt;/artifactId&amp;gt;
        &amp;lt;/dependency&amp;gt;
    &amp;lt;/dependencies&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;config&quot;&gt;4.2 config&lt;/h2&gt;
&lt;p&gt;使用restTemplate进行客户端调用，故需要进行配置，并且在方法上加 @LoadBalanced 注解表示开启ribbon负载均衡；&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;/**
 * @Author lsc
 * &amp;lt;p&amp;gt; ribbon-restTemplate配置 &amp;lt;/p&amp;gt;
 */
@Configuration
public class RibbonConfig {

    @Bean
    @LoadBalanced//表示用于负载均衡
    RestTemplate restTemplate(){
        return new RestTemplate();
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;service&quot;&gt;4.3 service&lt;/h2&gt;
&lt;p&gt;创建service类，并且使用restTemplate进行HTTP API 调用；注意点是这边不使用ip端口，而是直接使用服务的应用名称 eureka-client ;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;/**
 * @Author lsc
 * &amp;lt;p&amp;gt; &amp;lt;/p&amp;gt;
 */
@Service
public class RibbonService {

    @Autowired
    RestTemplate restTemplate;


    public String testRibbon(){
        return restTemplate.getForObject(&quot;http://eureka-client/zszxz/ribbon&quot;,String.class);
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;controller&quot;&gt;4.4 controller&lt;/h2&gt;
&lt;p&gt;创建表现层类, 用于浏览器访问;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;/**
 * @Author lsc
 * &amp;lt;p&amp;gt; &amp;lt;/p&amp;gt;
 */
@RestController
public class RibbonController {

    @Autowired
    RibbonService ribbonService;

    @GetMapping(&quot;ribbon/test&quot;)
    public String testRibbon(){
        return ribbonService.testRibbon();
    }
}    &lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;ribbon启动类&quot;&gt;4.5 ribbon启动类&lt;/h2&gt;
&lt;p&gt;ribbon的启动类也是作为 eureka 的客户端故需要加上@EnableEurekaClient注解；&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;/**
 * @Author lsc
 * &amp;lt;p&amp;gt;知识追寻者 ribbon启动类 &amp;lt;/p&amp;gt;
 */
@SpringBootApplication
@EnableEurekaClient
public class RibbonApp {

    public static void main(String[] args) {
        SpringApplication.run(RibbonApp.class,args);
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;application.yml&quot;&gt;4.6 application.yml&lt;/h2&gt;
&lt;p&gt;application.yml 配置中使用端口8092，服务注册地址分别是peer1,peer2,peer3；&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;server:
  port: 8092

spring:
  application:
    name: eureka-ribbon # 应用名称

eureka:
  client:
    service-url:
      # 服务注册地址
      defaultZone: http://peer1:10081/eureka/,http://peer2:10082/eureka/,http://peer3:10083/eureka/&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;启动工程&quot;&gt;4.7 启动工程&lt;/h2&gt;
&lt;p&gt;分别启动 client ,server ; 如下图&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20191222211810526.png&quot; alt=&quot;在这里插入图片描述&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;浏览器访问结果&quot;&gt;4.8 浏览器访问结果&lt;/h2&gt;
&lt;p&gt;浏览器结果如下，说明我们在 eureka-ribbon 中使用 restTemplate 结合 ribbon 实现了HTTP 方式从 eureka-clinet 模块中调用API；&lt;br/&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20191222211932572.png&quot; alt=&quot;在这里插入图片描述&quot;/&gt;&lt;/p&gt;

&lt;p&gt;LoadBalancerClient 是 ribbon 的一个核心类，其能够获得 ribbon提供负载均衡的实例信息；在 ribbon-client模块中的controller层添加 方法 ，方法主体是获得实例的端口和主机；以便于于我们分析ribbon负载均衡算法；&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;    @Autowired
    LoadBalancerClient loadBalanced;

    @GetMapping(&quot;ribbon&quot;)
    public String ribbon(){
        ServiceInstance choose = loadBalanced.choose(&quot;eureka-client&quot;);
        String s = &quot;host is :&quot; + choose.getHost() + &quot;  port is :&quot; + choose.getPort();
        System.out.println(s);
        return s;
    }&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;重启ribbon-client 工程，使用浏览器访问，控制台输出如下，分别调用了8090,8091两个 eureka-client实例API，说明ribbon默认的负载均衡机制是轮询算法；&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;host is :peer1  port is :8091
host is :peer1  port is :8090
host is :peer1  port is :8091
host is :peer1  port is :8090
host is :peer1  port is :8091
host is :peer1  port is :8090
host is :peer1  port is :8091
host is :peer1  port is :8090
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20191222214453980.png&quot; alt=&quot;在这里插入图片描述&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Mon, 23 Dec 2019 00:08:00 +0000</pubDate>
<dc:creator>知识追寻者</dc:creator>
<og:description>一 前言 经过几篇的cloud系列文章，我想大家都有一个坚实的基础，后续的学习就会轻松很多，如果是刚刚来看的读者需要有eureka基础知识，或者查阅知识追寻者的cloud系列专栏；这篇文章主要讲解如何</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/zszxz/p/12081935.html</dc:identifier>
</item>
</channel>
</rss>