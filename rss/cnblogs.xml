<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>åšå®¢å›­_é¦–é¡µ</title>
<link></link>
<description>ä»£ç æ”¹å˜ä¸–ç•Œ</description>
<item>
<title>C# 9.0 æ–°ç‰¹æ€§ä¹‹æ¨¡å¼åŒ¹é…ç®€åŒ– - LiamWang</title>
<link>http://www.cnblogs.com/willick/p/13129012.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/willick/p/13129012.html</guid>
<description>&lt;p&gt;é˜…è¯»æœ¬æ–‡å¤§æ¦‚éœ€è¦ 2 åˆ†é’Ÿã€‚&lt;/p&gt;
&lt;p&gt;è®°å¾—åœ¨ MS Build 2020 å¤§ä¼šä¸Šï¼ŒC# è¯­è¨€å¼€å‘é¡¹ç›®ç»ç† Mads Torgersen å®£ç§° C# 9.0 å°†ä¼šéšç€ .NET 5 åœ¨ä»Šå¹´ 11 æœˆä»½æ­£å¼å‘å¸ƒã€‚ç›®å‰ .NET 5 å·²ç»åˆ°äº† Preview 5 é˜¶æ®µäº†ï¼ŒC# 9.0 ä¹Ÿå·²ç»åˆå…·è§„æ¨¡ã€‚å¿ä¸ä½æ¿€åŠ¨çš„å¿ƒæƒ…ï¼Œæš‚åœæ›´æ–°ã€ŠC#.NET æ‹¾é—è¡¥æ¼ã€‹ç³»åˆ—å‡ å¤©ï¼Œå…ˆè¦å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹æˆ‘äº†è§£åˆ°çš„ C# 9.0 çš„æ–°ç‰¹æ€§ã€‚ç”±äºæ–°ç‰¹æ€§æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥ä¼šåˆ†æˆå‡ ç¯‡æ¥è®²ã€‚è¿™æ˜¯ç¬¬ä¸€ç¯‡ï¼Œä¸“è®²æ¨¡å¼åŒ¹é…è¿™ä¸ªç‰¹æ€§çš„ç®€åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;æ¨¡å¼åŒ¹é…ï¼ˆPattern Matchingï¼‰æ˜¯åœ¨ C# 7.0 å¼•å…¥çš„ï¼Œæ˜¯å¯¹ switch è¯­å¥çš„å¢å¼ºï¼Œå¯ä»¥æ”¯æŒå®ç°å¤æ‚çš„æ¡ä»¶åŒ¹é…ã€‚ä¸‹é¢æˆ‘å…ˆç”¨ä¸€ä¸ªç¤ºä¾‹æ¥å±•ç¤ºä¸€ä¸‹æ¨¡å¼åŒ¹é…çš„ä¸€èˆ¬çš„ç”¨æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å‡å¦‚ç°åœ¨æˆ‘ä»¬è¦è®¡ç®—å„ç§è½¦è¾†åœ¨æŸé«˜é€Ÿçš„é€šè¡Œè´¹ï¼Œæ¯”å¦‚æœ‰ä¸‹é¢å››ç§è½¦è¾†ï¼Œåˆ†åˆ«å®šä¹‰ä¸ºä»¥ä¸‹å››ä¸ªç±»ï¼Œå„ä¸ªç±»ä¸­å®šä¹‰äº†å’Œé€šè¡Œè´¹è®¡ç®—ç›¸å…³çš„å±æ€§ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;public class Car
{
    public int Passengers { get; set; }
}

public class DeliveryTruck
{
    public int GrossWeightClass { get; set; }
}

public class Taxi
{
    public int Fares { get; set; }
}

public class Bus
{
    public int Capacity { get; set; }
    public int Riders { get; set; }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸‹é¢ç”¨ç”¨æ¨¡å¼åŒ¹é…çš„æ–¹å¼æ¥å®ç°ä¸€ä¸ªè®¡ç®—é€šè¡Œè´¹çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;public decimal CalculateToll(object vehicle) =&amp;gt;
    vehicle switch
{
    Car { Passengers: 0}        =&amp;gt; 2.00m + 0.50m,
    Car { Passengers: 1}        =&amp;gt; 2.0m,
    Car { Passengers: 2}        =&amp;gt; 2.0m - 0.50m,
    Car c                       =&amp;gt; 2.00m - 1.0m,

    Taxi t =&amp;gt; t.Fares switch
    {
        0 =&amp;gt; 3.50m + 1.00m,
        1 =&amp;gt; 3.50m,
        2 =&amp;gt; 3.50m - 0.50m,
        _ =&amp;gt; 3.50m - 1.00m
    },

    Bus b when ((double)b.Riders / (double)b.Capacity) &amp;lt; 0.50 =&amp;gt; 5.00m + 2.00m,
    Bus b when ((double)b.Riders / (double)b.Capacity) &amp;gt; 0.90 =&amp;gt; 5.00m - 1.00m,
    Bus b =&amp;gt; 5.00m,

    DeliveryTruck t when (t.GrossWeightClass &amp;gt; 5000) =&amp;gt; 10.00m + 5.00m,
    DeliveryTruck t when (t.GrossWeightClass &amp;lt; 3000) =&amp;gt; 10.00m - 2.00m,
    DeliveryTruck _ =&amp;gt; 10.00m,

    { } =&amp;gt; throw new ArgumentException(message: &quot;Not a known vehicle type&quot;, paramName: nameof(vehicle)),
    null =&amp;gt; throw new ArgumentNullException(nameof(vehicle))
};
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä»£ç æ¥æºäºæ–‡æœ«å‚è€ƒé“¾æ¥&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸Šé¢ä»£ç é˜…è¯»èµ·æ¥æ„Ÿè§‰åƒåŠ›ï¼Œä½ å¯ä»¥å…ˆé˜…è¯»æ–‡æœ«å‚è€ƒé“¾æ¥ä¸­çš„ç¬¬ä¸€ä¸ªé“¾æ¥ï¼Œå…³äºæ¨¡å¼åŒ¹é…çš„è¯¦ç»†ä»‹ç»ã€‚&lt;/p&gt;
&lt;p&gt;å®ç°è¿™ä¸ªä¸šåŠ¡é€»è¾‘ï¼Œè‹¥åœ¨ C# 7.0 ä¹‹å‰ï¼Œéœ€è¦ç”¨ä¸€å †çš„ if/else æ¥å®ç°ã€‚æœ‰äº†æ¨¡å¼åŒ¹é…åï¼Œå˜å¾—æ–¹ä¾¿äº†å¾ˆå¤šï¼Œè€Œä¸”ä½¿ç”¨ä¸Šå¾ˆçµæ´»ï¼Œä»£ç ç»“æ„ä¹Ÿæ›´ä¼˜ç¾ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹æˆ‘æ¥è¯´ï¼Œæ¨¡å¼åŒ¹é…æ˜¯ä¸ªæå¥½çš„ç‰¹æ€§ï¼ä½†è¿™è¿˜ä¸å¤Ÿï¼ŒC# 9.0 å¯¹æ¨¡å¼åŒ¹é…çš„å†™æ³•åšäº†è¿›ä¸€æ­¥çš„ç®€åŒ–ï¼&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šé¢ä»£ç ä¸ºä¾‹ï¼Œæ¨¡å¼åŒ¹é…å¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼šç®€å•æ¨¡å¼ã€å…³ç³»æ¨¡å¼å’Œé€»è¾‘æ¨¡å¼ã€‚ä¸‹é¢åˆ†åˆ«è¯´è¯´ C# 9.0 å¯¹ä¸‰ç§æ¨¡å¼çš„ç®€åŒ–ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ç®€å•æ¨¡å¼&quot;&gt;ç®€å•æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸Šé¢ &lt;code&gt;CalculateToll&lt;/code&gt; æ–¹æ³•ç¤ºä¾‹ä»£ç ä¸ºä¾‹ï¼Œç®€å•æ¨¡å¼æ˜¯è¿™ç§ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;vehicle switch
{
    ...
    Car c =&amp;gt; 2.00m - 1.0m
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æˆ‘ä»¬å…¶å®å¯ä»¥å‘ç°ï¼Œä¸Šé¢çš„å˜é‡ &lt;code&gt;c&lt;/code&gt; å£°æ˜äº†å´æ²¡ç”¨è¢«ä½¿ç”¨ï¼Œç°åœ¨ C# 9.0 ä¸­å¯ä»¥æŠŠå®ƒçœç•¥äº†ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;vehicle switch
{
    ...
    Car =&amp;gt; 2.00m - 1.0m
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;å…³ç³»æ¨¡å¼&quot;&gt;å…³ç³»æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸Šé¢ &lt;code&gt;CalculateToll&lt;/code&gt; æ–¹æ³•ç¤ºä¾‹ä»£ç ä¸ºä¾‹ï¼Œå…³ç³»æ¨¡å¼æ˜¯é€šè¿‡æ¯”è¾ƒï¼ˆå¤§å°ï¼‰å…³ç³»æ¥åŒ¹é…çš„ï¼Œå¯¹åº”çš„ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;DeliveryTruck t when (t.GrossWeightClass &amp;gt; 5000) =&amp;gt; 10.00m + 5.00m,
DeliveryTruck t when (t.GrossWeightClass &amp;lt; 3000) =&amp;gt; 10.00m - 2.00m,
DeliveryTruck _ =&amp;gt; 10.00m,
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç°åœ¨ C# 9.0 å¯ä»¥ç®€å†™æˆï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;DeliveryTruck t when t.GrossWeightClass switch
{
    &amp;gt; 5000 =&amp;gt; 10.00m + 5.00m,
    &amp;lt; 3000 =&amp;gt; 10.00m - 2.00m,
    _ =&amp;gt; 10.00m,
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;é€»è¾‘æ¨¡å¼&quot;&gt;é€»è¾‘æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;åœ¨ C# 9.0 ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡é€»è¾‘æ“ä½œç¬¦ &lt;code&gt;and&lt;/code&gt;ã€&lt;code&gt;or&lt;/code&gt; å’Œ &lt;code&gt;not&lt;/code&gt; å¯¹æ¨¡å¼è¿›è¡Œç»„åˆï¼Œä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;DeliveryTruck t when t.GrossWeightClass switch
{
    &amp;lt; 3000 =&amp;gt; 10.00m - 2.00m,
    &amp;gt;= 3000 and &amp;lt;= 5000 =&amp;gt; 10.00m,
    &amp;gt; 5000 =&amp;gt; 10.00m + 5.00m,
}

not null =&amp;gt; throw new ArgumentException($&quot;Not a known vehicle type: {vehicle}&quot;, nameof(vehicle)),
null =&amp;gt; throw new ArgumentNullException(nameof(vehicle))
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¦å¤–ï¼Œ&lt;code&gt;not&lt;/code&gt; å…³é”®å­—è¿˜å¯ä»¥ç”¨æ¥æ›¿ä»£ if æ¡ä»¶åˆ¤æ–­ä¸­çš„é€»è¾‘é(!)ï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;// åŸæ¥çš„å†™æ³•
if (!(e is Customer)) { ... }

// æ–°çš„å†™æ³•ï¼ˆæ˜“è¯»æ€§æ›´å¥½ï¼‰
if (e is not Customer) { ... }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;C# 9.0 è¿˜æœ‰å¾ˆå¤šå…¶å®ƒå¥½ç”¨çš„æ–°ç‰¹æ€§ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ç»§ç»­ä¸ä½ åˆ†äº«ã€‚æ–‡ç« å†™çŸ­ä¸€ç‚¹ä¸æ˜¯å› ä¸ºæˆ‘å·æ‡’å“ˆï¼Œè€Œæ˜¯ä¸ºäº†ä¿ƒä½¿å¤§å®¶ä¸€æ¬¡æ€§çœ‹å®Œï¼Œæ–¹ä¾¿å¤§å®¶åœ¨é›¶ç¢æ—¶é—´é˜…è¯»ï¼Œé¿å…å› æ–‡ç« å¤ªé•¿è€Œæˆä¸ºâ€œæ”¶è—ä¸çœ‹â€ç³»åˆ—ã€‚&lt;/p&gt;
&lt;p&gt;æ•¬è¯·å…³æ³¨æˆ‘æ˜å¤©ä¸‹ä¸€ç¯‡å…³äº C# 9.0 æ–°ç‰¹æ€§çš„ä»‹ç»ï¼Œæ˜å¤©ä¸è§ä¸æ•£ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;&lt;a href=&quot;https://bit.ly/2MNc0DJ&quot;&gt;https://bit.ly/2MNc0DJ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://bit.ly/2UzEIwu&quot;&gt;https://bit.ly/2UzEIwu&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;/blockquote&gt;
</description>
<pubDate>Mon, 15 Jun 2020 00:51:00 +0000</pubDate>
<dc:creator>LiamWang</dc:creator>
<og:description>é˜…è¯»æœ¬æ–‡å¤§æ¦‚éœ€è¦ 2 åˆ†é’Ÿã€‚ è®°å¾—åœ¨ MS Build 2020 å¤§ä¼šä¸Šï¼ŒC# è¯­è¨€å¼€å‘é¡¹ç›®ç»ç† Mads Torgersen å®£ç§° C# 9.0 å°†ä¼šéšç€ .NET 5 åœ¨ä»Šå¹´ 11 æœˆä»½æ­£å¼å‘å¸ƒã€‚</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/willick/p/13129012.html</dc:identifier>
</item>
<item>
<title>é¢è¯•å®˜ï¼šæ·¦ï¼0202å¹´ä½ è¿˜ä¸çŸ¥é“é¢å‘å¯¹è±¡ï¼Ÿ - å±±ç¦¾è¯´</title>
<link>http://www.cnblogs.com/viyoung/p/13128956.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/viyoung/p/13128956.html</guid>
<description>&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;2020å¹´6æœˆ13æ—¥ å¤šäº‘è½¬æš´é›¨&lt;/strong&gt;â›ˆï¸&lt;/p&gt;
&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; readability=&quot;10&quot;&gt;
&lt;p&gt;I'm &lt;s&gt;sad,tired,negative,powerless,miss,lonely&lt;/s&gt; fine :)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;é‚£ä½ å›å»ç­‰é€šçŸ¥å§&lt;/span&gt;&lt;/h2&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é¢è¯•å®˜ï¼šæˆ‘çœ‹ä½ ç®€å†ä¸Šè¯´ï¼Œä½ çš„ä¸»è¦ç¼–ç¨‹è¯­è¨€æ˜¯&lt;strong&gt;Java&lt;/strong&gt;ï¼Œå¶å°”ä¹Ÿç”¨&lt;strong&gt;Python&lt;/strong&gt;ï¼Œé‚£ä¹ˆä½ å¯ä»¥è¯´ä¸€ä¸‹è¿™ä¸¤ä¸ªçš„ç›¸åŒç‚¹åœ¨ä»€ä¹ˆåœ°æ–¹å—ï¼Ÿ&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å±±ç¦¾ï¼šå®ƒä»¬éƒ½æ˜¯é«˜çº§ç¨‹åºè®¾è®¡è¯­è¨€ï¼Œéƒ½æ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é¢è¯•å®˜ï¼šé‚£ä½ è®²è®²ä½ æ˜¯æ€ä¹ˆç†è§£é¢å‘å¯¹è±¡çš„å§ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å±±ç¦¾ï¼šemmmã€‚ã€‚å°è£…ï¼Œç»§æ‰¿ï¼Œå¤šæ€æ˜¯é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é¢è¯•å®˜ï¼šè¿˜æœ‰å…¶ä»–è¦è¡¥å……çš„å—ï¼Ÿ&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å±±ç¦¾ï¼šæ²¡äº†&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é¢è¯•å®˜ï¼š&lt;strong&gt;é‚£ä½ å›å»ç­‰é€šçŸ¥å§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;æ˜¯ä»€ä¹ˆ&lt;/span&gt;&lt;/h2&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç—›å®šæ€ç—›ï¼ŒæŒ«æŠ˜åªä¼šè®©æˆ‘å˜å¾—æ›´å¼ºï¼Œå¥¥åˆ©ç»™ï¼ä¸‹é¢å¼€å§‹è¿›å…¥æ­£æ–‡ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“é¢å‘å¯¹è±¡æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é¢å‘å¯¹è±¡ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯é¢å‘&lt;strong&gt;å¯¹è±¡&lt;/strong&gt;ï¼Œä¹Ÿå°±æ˜¯è¯´å•èº«ç‹—æ˜¯ä¸é…ä½¿ç”¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€çš„ï¼ˆå½“ç„¶åªæ˜¯å¼€ä¸ªç©ç¬‘ï¼Œé€ƒï¼‰ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;å¯¹è±¡&lt;/strong&gt;ï¼Œå°±æ˜¯æŠŠç°å®ä¸–ç•Œä¸­çš„&lt;strong&gt;å®ç‰©&lt;/strong&gt;æ˜ å°„æŠ½è±¡åˆ°è™šæ‹Ÿä¸–ç•Œä¸­ï¼ŒæŠŠå®ç‰©çš„å±æ€§å’Œè¡Œä¸ºï¼Œé€šè¿‡ä»£ç çš„æ–¹å¼è¡¨è¾¾å‡ºæ¥ã€‚ç„¶åé€šè¿‡è®¾è®¡å¯¹è±¡çš„&lt;strong&gt;æ•°æ®ç»“æ„&lt;/strong&gt;ï¼ˆå±æ€§ï¼‰ï¼Œç„¶åä½¿ç”¨&lt;strong&gt;ç®—æ³•&lt;/strong&gt;è¿›è¡Œè¡Œä¸ºçš„æ¨¡æ‹Ÿï¼ˆæ–¹æ³•ï¼‰ï¼Œå°±å®Œæˆäº†ä»ç°å®åˆ°è™šæ‹Ÿçš„ä¸€ä¸ªæ˜ å°„ã€‚&lt;/p&gt;
&lt;table data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;å®ä½“&lt;/th&gt;
&lt;th&gt;å¯¹è±¡&lt;/th&gt;
&lt;th&gt;ç±»&lt;/th&gt;
&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;å±æ€§&lt;/td&gt;
&lt;td&gt;æ•°æ®ç»“æ„&lt;/td&gt;
&lt;td&gt;å˜é‡&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;è¡Œä¸º&lt;/td&gt;
&lt;td&gt;ç®—æ³•&lt;/td&gt;
&lt;td&gt;æ–¹æ³•&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸é¢å‘å¯¹è±¡ç»å¸¸æ‹¿æ¥å¯¹æ¯”çš„å°±æ˜¯é¢å‘è¿‡ç¨‹ç¼–ç¨‹ï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹é—´çš„åŒºåˆ«åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿ&lt;/p&gt;
&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;é¢å‘è¿‡ç¨‹å’Œé¢å‘å¯¹è±¡&lt;/span&gt;&lt;/h3&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é¢å‘è¿‡ç¨‹ç¼–ç¨‹ï¼Œæ‰“ä¸ªæ¯”æ–¹ï¼Œæˆ‘ä»¬ä¹°è¿‡çš„ä¸€èˆ¬çš„ç©å…·ï¼ˆå˜å½¢é‡‘åˆšï¼‰ï¼Œæˆ‘ä»¬å¿…é¡»è¦æŒ‰ç…§å®ƒè¯´æ˜ä¹¦ä¸Šçš„æ­¥éª¤ï¼Œä¸€æ­¥ä¸€æ­¥çš„å»ç»„è£…ï¼Œæ‰èƒ½å¾—åˆ°æœ€åçš„ç©å…·ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä¸€ä¸ªæ–°çš„ç©å…·ï¼Œå°±è¦å»å•†åœºä¹°ä¸€ä¸ªæ–°çš„ï¼Œç„¶åæŒ‰ç…§è¯´æ˜ä¹¦çš„é¡ºåºä¸€æ­¥ä¸€æ­¥çš„ç»„è£…ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è€Œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå°±å¯ä»¥ç†è§£ä¸ºç§¯æœ¨ï¼Œæ²¡æœ‰ä¸€ä¸ªå›ºå®šçš„æ‹¼è£…æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å‘æŒ¥è‡ªå·±çš„æƒ³è±¡åŠ›ï¼Œå»è‡ªç”±çš„æ‹¼è£…å’Œç»„è£…ï¼ŒåŒæ ·çš„æ¨¡å—åœ¨ä¸åŒçš„åœ°æ–¹å¯ä»¥èµ·åˆ°ä¸åŒçš„ä½œç”¨ï¼ˆå¤šæ€ï¼‰ï¼Œä¸€å—å„¿ç§¯æœ¨å°±æ˜¯ä¸€ä¸ªæœ€å°çš„å•ä½ï¼Œæˆ‘ä»¬ä¸ç”¨å»å…³å¿ƒç§¯æœ¨æ˜¯æ€ä¹ˆé€ çš„ï¼ˆå°è£…ï¼‰ã€‚ä¹Ÿå¯ä»¥ç”¨å¤šä¸ªå¯¹è±¡ç»„è£…èµ·æ¥å»æ‹¼è£…æˆä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ˆç»§æ‰¿ï¼‰ã€‚å¤§å¤§çš„æ–¹ä¾¿äº†æˆ‘ä»¬çš„è®¾è®¡ï¼Œä¸å†æ‹˜æ³¥äºè¿‡ç¨‹ï¼Œæå¤§ç¨‹åº¦ä¸Šçš„æ”¾é£äº†ç”Ÿäº§åŠ›å’Œæ•ˆç‡ã€‚&lt;/p&gt;
&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;ä¸ºä»€ä¹ˆ&lt;/span&gt;&lt;/h2&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬åˆšåˆšå·²ç»äº†è§£äº†é¢å‘å¯¹è±¡æ˜¯ä»€ä¹ˆï¼Œä¸‹é¢æˆ‘ä»¬æ¥è¯´ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¦ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹&lt;/p&gt;
&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;li readability=&quot;-1.5&quot;&gt;
&lt;section readability=&quot;3&quot;&gt;&lt;p&gt;é¦–å…ˆä»ç†è§£è§’åº¦ä¸Šæ¥è¯´ï¼Œå®ƒç¬¦åˆæˆ‘ä»¬å¯¹ç°å®ä¸–ç•Œçš„è®¤çŸ¥ä¹ æƒ¯ï¼Œæ›´å®¹æ˜“å»ç†è§£ã€å®ç°å’Œè®¾è®¡æˆ‘ä»¬çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;/section&gt;&lt;/li&gt;
&lt;li readability=&quot;-0.5&quot;&gt;
&lt;section readability=&quot;5&quot;&gt;&lt;p&gt;å…¶æ¬¡ä»è½¯ä»¶è®¾è®¡çš„è§’åº¦ä¸Šæ¥è¯´ï¼Œè¡Œä¸ºçš„å®ç°å¯¹äºå¤–éƒ¨æ˜¯å®Œå…¨å°é—­çš„ï¼Œåªéœ€è¦æä¾›å¯¹åº”çš„æ¥å£å°±å¯ä»¥è·å¾—ç›¸åº”çš„ç»“æœï¼Œé™ä½äº†ä»£ç ä¸ä»£ç ä¹‹é—´çš„è€¦åˆåº¦ã€‚ç¬¦åˆæˆ‘ä»¬é«˜å†…èšï¼Œä½è€¦åˆçš„è®¾è®¡ç†å¿µã€‚&lt;strong&gt;ä¼˜é›…ï¼Œå®¢è§‚ï¼Œå±‚æ¬¡åˆ†æ˜&lt;/strong&gt;ï¼Œåƒç§¯æœ¨ä¸€æ ·ï¼Œå¯ä»¥æ–¹ä¾¿çš„å®ç°æ’æ‹”å’Œç»´æŠ¤ï¼Œå¯¹è±¡ç»„åˆè€Œæˆçš„æ¨¡å—åŒ–å’ŒæœåŠ¡åŒ–ï¼Œæ›´æ˜¯å¤§å¤§æ‰©å±•äº†ç³»ç»Ÿçš„ä¼¸ç¼©æ€§ï¼Œä¾¿äº&lt;strong&gt;ç»´æŠ¤ã€æ‰©å±•å’Œå¤ç”¨&lt;/strong&gt;ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¶Šæ¥è¶Šå¤šçš„ç¼–ç¨‹è¯­è¨€é€‰æ‹©å‘è¿™ä¸ªæ–¹å‘å»é æ‹¢ï¼ˆ TypeScriptè¯´çš„å°±æ˜¯ä½ &lt;/p&gt;
&lt;/section&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;æ€ä¹ˆç”¨&lt;/span&gt;&lt;/h2&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åˆšåˆšæˆ‘ä¸€ç›´å¿ä½ï¼Œæ²¡æœ‰å»æé¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§ï¼šå°è£…ã€ç»§æ‰¿å’Œå¤šæ€ï¼Œæˆ‘ç›¸ä¿¡æˆ‘ä»¬æœ‰ä¸€äº›ç»éªŒçš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œè¿™ä¸‰ä¸ªè¯è¯­æ˜¯å†ç†Ÿæ‚‰ä¸è¿‡äº†ã€‚ä¸‹é¢ï¼Œæˆ‘é€šè¿‡ä»£ç çš„æ–¹å¼ï¼Œæ¥çœ‹çœ‹è¿™ä¸‰ä¸ªç‰¹æ€§åœ¨ä»£ç ä¸­çš„æ¨¡æ‹Ÿåº”ç”¨ã€‚&lt;/p&gt;
&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;å°è£…&lt;/span&gt;&lt;/h3&gt;
&lt;pre class=&quot;custom&quot; data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; readability=&quot;6&quot;&gt;
&lt;code class=&quot;hljs&quot; readability=&quot;6&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@Data&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Uzi&lt;/span&gt; &lt;/span&gt;{&lt;p&gt;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; String type;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; String bestHero;&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;private&lt;/span&gt; Status status;&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;status.say();&lt;br/&gt;}&lt;br/&gt;}&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Status&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{}&lt;br/&gt;}&lt;br/&gt;&lt;/p&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸Šé¢æ˜¯ä¸€æ®µéå¸¸ç®€å•çš„ä»£ç ï¼Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªå¾ˆç®€å•çš„ç±»ï¼Œé‡Œé¢çš„&lt;code&gt;name&lt;/code&gt;ï¼Œ&lt;code&gt;type&lt;/code&gt;ï¼Œ&lt;code&gt;bestHero&lt;/code&gt;å¯¹äºæˆ‘ä»¬æ¥è¯´éƒ½æ˜¯ä¸€ä¸ªåŒ…è£…åœ¨ç›’å­é‡Œçš„ä¸œè¥¿ã€‚æ¯”å¦‚ï¼š&lt;/p&gt;
&lt;pre class=&quot;custom&quot; data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;
&lt;code class=&quot;hljs&quot;&gt;    Uzi uzi = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; Uzi();&lt;br/&gt;uzi.setType(&lt;span class=&quot;hljs-string&quot;&gt;&quot;ADC&quot;&lt;/span&gt;);&lt;br/&gt;uzi.setBestHero(&lt;span class=&quot;hljs-string&quot;&gt;&quot;å­™å°šé¦™&quot;&lt;/span&gt;);&lt;br/&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬çœ‹åˆ°çš„Uziå¯èƒ½å°±æ˜¯ä¸€ä¸ªä¸»ç©å­™å°šé¦™çš„èŒä¸šADCé€‰æ‰‹ï¼ˆğŸ¶ç‹—å¤´ä¿å‘½ï¼Œæˆ‘å•¥éƒ½ä¸çŸ¥é“ï¼‰ï¼Œä»–æ€ä¹ˆç©çš„ï¼Œæˆ‘ä»¬ä¸éœ€è¦çŸ¥é“ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ä»–è¿™æ ·çš„ä¸€åé€‰æ‰‹å°±å¯ä»¥äº†ã€‚è¿™å°±æ˜¯å°è£…çš„é­…åŠ›ï¼š&lt;/p&gt;
&lt;ol data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;li&gt;
&lt;section&gt;éšè—äº†å®ç°çš„ç»†èŠ‚ï¼Œæä¾›å¯¹å¤–çš„è®¿é—®æ–¹å¼ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;li&gt;
&lt;section&gt;å¤–éƒ¨å¦‚æœæƒ³è¦è®¿é—®ï¼Œå¿…é¡»ç»è¿‡è¿™ä¸ªæ–¹æ³•ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;ç»§æ‰¿&lt;/span&gt;&lt;/h3&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;çœ‹å®Œäº†å°è£…ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ç»§æ‰¿ï¼Œæˆ‘ä»¬åˆ†åˆ«ç”¨ä¸‰ä¸ªçŠ¶æ€å»ç»§æ‰¿Statusç±»ï¼š&lt;/p&gt;
&lt;pre class=&quot;custom&quot; data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; readability=&quot;7.5&quot;&gt;
&lt;code class=&quot;hljs&quot; readability=&quot;9&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;ShunFeng&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Status&lt;/span&gt; &lt;/span&gt;{&lt;p&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;é¡ºé£ç‹‚å°ç‹—&quot;&lt;/span&gt;);&lt;br/&gt;}&lt;br/&gt;}&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;NiFeng&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Status&lt;/span&gt; &lt;/span&gt;{&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;é€†é£ç®€è‡ªè±ª&quot;&lt;/span&gt;);&lt;br/&gt;}&lt;br/&gt;}&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;JueJing&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Status&lt;/span&gt; &lt;/span&gt;{&lt;/p&gt;&lt;p&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@Override&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;say&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;{&lt;br/&gt;System.out.println(&lt;span class=&quot;hljs-string&quot;&gt;&quot;ç»å¢ƒUzi&quot;&lt;/span&gt;);&lt;br/&gt;}&lt;br/&gt;}&lt;br/&gt;&lt;/p&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…³é”®å­—&lt;strong&gt;extends&lt;/strong&gt;è¡¨ç¤ºæ­£åœ¨æ„é€ çš„æ–°ç±»æ´¾ç”Ÿäºä¸€ä¸ªå·²ç»å­˜åœ¨ç±»ã€‚è¿™ä¸ªå·²ç»å­˜åœ¨çš„ç±»è¢«ç§°ä¸ºçˆ¶ç±»ï¼ˆè¶…ç±»ï¼ŒåŸºç±»ï¼‰ï¼›æ–°åˆ›å»ºçš„ç±»è¢«ç§°ä¸ºå­ç±»ã€‚åœ¨é€šè¿‡æ‰©å±•çˆ¶ç±»å®šä¹‰å­ç±»çš„æ—¶å€™ï¼Œä»…ä»…éœ€è¦æŒ‡å‡ºå­ç±»å’Œçˆ¶ç±»çš„ä¸åŒä¹‹å¤„ã€‚å› æ­¤åœ¨è®¾è®¡ç±»çš„æ—¶å€™ï¼Œåº”è¯¥å°†é€šç”¨çš„æ–¹æ³•æ”¾åœ¨çˆ¶ç±»ä¸­ï¼Œè€Œå°†å…·æœ‰ç‰¹æ®Šç”¨é€”çš„æ–¹æ³•æ”¾åœ¨å­ç±»ä¸­ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘ä»¬åªæ˜¯åœ¨çˆ¶ç±»&lt;code&gt;Status&lt;/code&gt;ä¸­å®šä¹‰äº†sayæ–¹æ³•ï¼Œç„¶åä¸‰ç§ä¸åŒçš„ç±»å»ç»§æ‰¿è¿™ä¸ªç±»ï¼Œç„¶åå®ç°æ–¹æ³•ï¼Œè¿™æ ·å°±ä½“ç°å‡ºäº†é¢å‘å¯¹è±¡åœ¨è®¾è®¡ä¸Šçš„å¯æ‰©å±•æ€§ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»§æ‰¿ä¼šç ´åå°è£…ï¼Œæˆ‘ä»¬éœ€è¦è°¨æ…ä½¿ç”¨ï¼Œå°½é‡ä½¿ç”¨ä¸€äº›è®¾è®¡æ¨¡å¼å»é¿å…ç»§æ‰¿ï¼Œåˆç†ä½¿ç”¨ï¼Œæ‰èƒ½ä½“ç°å‡ºå®ƒçš„ä¼˜åŠ¿ï½&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¯´å®Œäº†ç»§æ‰¿ï¼Œæ¥ä¸‹æ¥å°±è¦å»è¯´å¤šæ€äº†ã€‚&lt;/p&gt;
&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;å¤šæ€&lt;/span&gt;&lt;/h3&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨è¯´å¤šæ€ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä»£ç ï¼š&lt;/p&gt;
&lt;pre class=&quot;custom&quot; data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; readability=&quot;5&quot;&gt;
&lt;code class=&quot;hljs&quot; readability=&quot;4&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;Test&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;(String[] args)&lt;/span&gt; &lt;/span&gt;{&lt;br/&gt;Uzi uzi1 = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; Uzi();&lt;br/&gt;ShunFeng shunFeng = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; ShunFeng();&lt;br/&gt;uzi1.setStatus(shunFeng);&lt;br/&gt;Uzi uzi2 = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; Uzi();&lt;br/&gt;NiFeng niFeng = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; NiFeng();&lt;br/&gt;uzi2.setStatus(niFeng);&lt;br/&gt;Uzi uzi3 = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; Uzi();&lt;br/&gt;JueJing jueJing = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; JueJing();&lt;br/&gt;uzi3.setStatus(jueJing);&lt;p&gt;&lt;br/&gt;Uzi[] uzis = {uzi1,uzi2,uzi3};&lt;br/&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;for&lt;/span&gt; (Uzi uzi : uzis) {&lt;br/&gt;uzi.play();&lt;br/&gt;}&lt;br/&gt;}&lt;br/&gt;}&lt;br/&gt;&lt;/p&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿è¡Œç¨‹åºçš„ç»“æœï¼š &lt;img src=&quot;http://viyoungblog.oss-cn-beijing.aliyuncs.com/2020/06/13/15920440449129.jpg?image/auto-orient,1/quality,q_90&quot; alt=&quot;&quot;/&gt; ï¼ˆTMDï¼Œæ³ªç›®ï¼ŒğŸ‘´é’ç»“ï¼‰&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ‰€è°“çš„å¤šæ€å°±æ˜¯ä¸€ä¸ªå¯¹è±¡å˜é‡ï¼ˆæ¯”å¦‚ä¸Šæ–‡ä¸­çš„statuså˜é‡ï¼‰å¯ä»¥æŒ‡ç¤ºå¤šç§å®é™…ç±»å‹çš„ç°è±¡ï¼ˆæ¯”å¦‚statusæ—¢å¯ä»¥å¼•ç”¨Statuså¯¹è±¡ï¼Œä¹Ÿå¯ä»¥å¼•ç”¨å®ƒçš„å­ç±»ShunFengå¯¹è±¡ï¼‰è¢«ç§°ä¸º&lt;strong&gt;å¤šæ€&lt;/strong&gt;ã€‚åœ¨è¿è¡Œæ—¶å€™èƒ½å¤Ÿè‡ªåŠ¨åœ°é€‰æ‹©è°ƒç”¨å“ªä¸ªæ–¹æ³•çš„ç°è±¡è¢«ç§°ä¸º&lt;strong&gt;åŠ¨æ€ç»‘å®š&lt;/strong&gt;ï¼Œä¸Šé¢æ‰“å°å‡ºçš„è¯­å¥ï¼Œå°±è¯´æ˜äº†è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;h2 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;åç»­&lt;/span&gt;&lt;/h2&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åŸæ¥æˆ‘ä»¬å¤©å¤©æŒ‚åœ¨å£è¾¹çš„é¢å‘å¯¹è±¡ï¼Œå…¶å®æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ï¼Œ&lt;strong&gt;æ›´åƒæ˜¯ä¸€ç§å“²å­¦ï¼Œä¸€ç§è®¡ç®—æœºç§‘å­¦å‘å±•çš„è‡ªç„¶è§„åˆ™ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;å¦‚æœä½ æœ‰å­¦åˆ°ï¼Œè¯·ç»™æˆ‘ç‚¹èµğŸ‘+å…³æ³¨ï¼Œè¿™æ˜¯å¯¹ä¸€ä¸ªâœŠåšæŒåŸåˆ›ä½œè€…çš„æœ€å¤§æ”¯æŒï¼æˆ‘æ˜¯å±±ç¦¾ï¼Œåƒç¯‡ä¸€å¾‹çš„çš®å›Šï¼Œä¸‡é‡ŒæŒ‘ä¸€çš„çµé­‚ï¼Œä¸€ä¸ªä¸å¤ªä¸€æ ·çš„å†™æ‰‹ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;ä¸–äº‹æ´æ˜çš†å­¦é—®ï¼Œäººæƒ…ç»ƒè¾¾å³æ–‡ç« ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;img src=&quot;https://viyoungblog.oss-cn-beijing.aliyuncs.com/qrcode_for_gh_a65beceb0947_258_20200615083058.jpg&quot; alt=&quot;&quot;/&gt;</description>
<pubDate>Mon, 15 Jun 2020 00:32:00 +0000</pubDate>
<dc:creator>å±±ç¦¾è¯´</dc:creator>
<og:description>ä½ å…ˆå›å»ç­‰é€šçŸ¥å§</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/viyoung/p/13128956.html</dc:identifier>
</item>
<item>
<title>ä¸€æ–‡è¯»æ‡‚Redisçš„å››ç§æ¨¡å¼ï¼Œå•æœºã€ä¸»ä»ã€å“¨å…µã€é›†ç¾¤ - é¾™è·ƒåäºŒ</title>
<link>http://www.cnblogs.com/zhonglongbo/p/13128955.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/zhonglongbo/p/13128955.html</guid>
<description>&lt;blockquote data-tool=&quot;mdniceç¼–è¾‘å™¨&quot; readability=&quot;5&quot;&gt;
&lt;p&gt;å°‘ç‚¹ä»£ç ï¼Œå¤šç‚¹å¤´å‘&lt;/p&gt;
&lt;/blockquote&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ¬æ–‡å·²ç»è¢«GitHubæ”¶å½•,æ¬¢è¿å¤§å®¶è¸Šè·ƒstar å’Œ issuesã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;https://github.com/midou-tech/articles&lt;/p&gt;
&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;å…¥èŒç¬¬ä¸€å‘¨ï¼Œæˆ‘è¢«å‘äº†&lt;/span&gt;&lt;/h3&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ€è¿‘åˆšå…¥èŒæ–°å…¬å¸ï¼Œæœ¬æ¥æƒ³ç€è¿™åˆšæ¥æ–°å…¬å¸ï¼Œä¸€èˆ¬éƒ½æ˜¯ç†Ÿæ‚‰ç†Ÿæ‚‰å…¬å¸åŒäº‹ï¼Œçœ‹çœ‹ç»„å†…å·¥ç¨‹æ–‡æ¡£ï¼Œæ‰¾å‡ ä¸ªdemoè‡ªå·±ç»ƒç»ƒæ‰‹ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å’³å’³å’³ï¼Œä¸‡ä¸‡æ²¡æƒ³åˆ°å•Šï¼Œä¸€åˆ‡éƒ½æ˜¯æˆ‘ä»¥ä¸ºçš„ï¼Œæˆ‘è¿˜æ˜¯å¤ª&lt;strong&gt;å«©&lt;/strong&gt;äº†ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…¥èŒé‚£å¤©ä¸‹åˆï¼Œç»„é•¿ç»™æˆ‘ä¸¢äº†å‡ ä¸ªæ–‡æ¡£ï¼Œè®©æˆ‘çœ‹ä¸‹è¿™ä¸ªè¿™äº›å·¥ç¨‹çš„ç¼“å­˜ç³»ç»Ÿé—®é¢˜ï¼Œè®©æˆ‘æŠŠrediså‡çº§ä¸ºå“¨å…µæ¨¡å¼ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¥åˆ°ä»»åŠ¡çš„æˆ‘ï¼Œå†…å¿ƒæ˜¯æ‡µé€¼çš„ã€‚&lt;/p&gt;
&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlly1gfhur27smkj3064064dfs.jpg&quot; alt=&quot;&quot;/&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç¬¬ä¸€ã€ä¸çŸ¥é“éƒ½æ˜¯äº›ä»€ä¹ˆç±»å‹çš„æœåŠ¡åœ¨ç”¨redisã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç¬¬äºŒã€ä¸çŸ¥é“ä»¥ä»€ä¹ˆå§¿åŠ¿åœ¨ç”¨redisã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç¬¬ä¸‰ã€å¦‚æœredisæŒ‚äº†ä¼šä¸ä¼šå½±å“ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç¬¬å››ã€æˆ‘å®Œå…¨æ²¡ç”¨è¿‡redisã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è™½è¯´æ²¡å¹²è¿‡ï¼Œä½†å’‹ä¹Ÿ&lt;strong&gt;ä¸æ€‚&lt;/strong&gt;ã€‚æ¯•ç«Ÿè¦æ˜¯å¤©å¤©å¹²çš„éƒ½æ˜¯&lt;strong&gt;å¹²è¿‡&lt;/strong&gt;çš„å·¥ä½œï¼Œé‚£å°±æ˜¯æœ‰é—®é¢˜äº†ï¼Œå¾ˆå¿«å°±è¢«ä¼˜åŒ–æ‰äº†ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;çœ‹æ¥ç¤¾æ‹›å…¥èŒå’Œæ ¡æ‹›è¿˜æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ ¡æ‹›è¿›æ¥éƒ½ä¼šæœ‰äº›å…¥èŒåŸ¹è®­æˆ–è€…æ–°äººç­è¯¾ç¨‹ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é€šè¿‡è¿™äº›å½¢å¼çš„æ•™è‚²ï¼Œç¬¬ä¸€ã€äº†è§£å…¬å¸çš„æ–‡åŒ–ã€ä»·å€¼è§‚ï¼Œç¬¬äºŒã€å­¦ä¹ å·¥ä½œæµç¨‹ã€æ„Ÿå—å…¬å¸æŠ€æœ¯æ°›å›´ã€‚&lt;/p&gt;
&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;ä»»åŠ¡&lt;/span&gt;&lt;/h3&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æŠŠæˆ‘ä»¬éƒ¨é—¨æ‰€æœ‰ä½¿ç”¨redisæœåŠ¡å‡çº§åˆ°&lt;strong&gt;å“¨å…µ&lt;/strong&gt;æ¨¡å¼ã€‚&lt;/p&gt;
&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;redisçš„å¤šç§æ¨¡å¼&lt;/span&gt;&lt;/h3&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;éƒ½è¯´äº†å‡çº§åˆ°å“¨å…µæ¨¡å¼ï¼Œé‚£ä¹‹å‰ç”¨çš„ä¸æ˜¯å“¨å…µæ¨¡å¼ï¼Œè‚¯å®šè¿˜æœ‰å…¶ä»–æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;å•æœºæ¨¡å¼ã€ä¸»ä»æ¨¡å¼ã€å“¨å…µæ¨¡å¼ã€é›†ç¾¤æ¨¡å¼&lt;/strong&gt;&lt;/p&gt;
&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;å•æœºæ¨¡å¼&lt;/span&gt;&lt;/h4&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™ä¸ªæœ€ç®€å•ï¼Œä¸€çœ‹å°±æ‡‚ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å°±æ˜¯å®‰è£…ä¸€ä¸ªredisï¼Œå¯åŠ¨èµ·æ¥ï¼Œä¸šåŠ¡è°ƒç”¨å³å¯ã€‚å…·ä½“å®‰è£…æ­¥éª¤å’Œå¯åŠ¨æ­¥éª¤å°±ä¸èµ˜è¿°äº†ï¼Œç½‘ä¸Šéšä¾¿æœä¸€ä¸‹å°±æœ‰äº†ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å•æœºåœ¨å¾ˆå¤šåœºæ™¯ä¹Ÿæ˜¯æœ‰ä½¿ç”¨çš„ï¼Œä¾‹å¦‚åœ¨ä¸€ä¸ªå¹¶éå¿…é¡»ä¿è¯é«˜å¯ç”¨çš„æƒ…å†µä¸‹ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å’³å’³å’³ï¼Œå…¶å®æˆ‘ä»¬çš„æœåŠ¡ä½¿ç”¨çš„å°±æ˜¯rediså•æœºæ¨¡å¼ï¼Œæ‰€ä»¥æ¥äº†å°±è®©æˆ‘æ”¹ä¸ºå“¨å…µæ¨¡å¼ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¯´è¯´å•æœºçš„&lt;strong&gt;ä¼˜ç¼ºç‚¹&lt;/strong&gt;å§ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;li&gt;
&lt;section&gt;éƒ¨ç½²ç®€å•ï¼Œ0æˆæœ¬ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;li&gt;
&lt;section&gt;æˆæœ¬ä½ï¼Œæ²¡æœ‰å¤‡ç”¨èŠ‚ç‚¹ï¼Œä¸éœ€è¦å…¶ä»–çš„å¼€æ”¯ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;li&gt;
&lt;section&gt;é«˜æ€§èƒ½ï¼Œå•æœºä¸éœ€è¦åŒæ­¥æ•°æ®ï¼Œæ•°æ®å¤©ç„¶ä¸€è‡´æ€§ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;li&gt;
&lt;section&gt;å¯é æ€§ä¿è¯ä¸æ˜¯å¾ˆå¥½ï¼Œå•èŠ‚ç‚¹æœ‰å®•æœºçš„é£é™©ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;li&gt;
&lt;section&gt;å•æœºé«˜æ€§èƒ½å—é™äºCPUçš„å¤„ç†èƒ½åŠ›ï¼Œredisæ˜¯å•çº¿ç¨‹çš„ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å•æœºæ¨¡å¼é€‰æ‹©éœ€è¦æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯å»é€‰æ‹©ï¼Œå¦‚æœéœ€è¦å¾ˆé«˜çš„æ€§èƒ½ã€å¯é æ€§ï¼Œå•æœºå°±ä¸å¤ªåˆé€‚äº†ã€‚&lt;/p&gt;
&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;ä¸»ä»å¤åˆ¶&lt;/span&gt;&lt;/h3&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸»ä»å¤åˆ¶ï¼Œæ˜¯æŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹(master)ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹(slave)ï¼›æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1gfitgiiz4hj30ra0o6abx.jpg&quot; alt=&quot;&quot;/&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸»ä»æ¨¡å¼é…ç½®å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨ä»èŠ‚ç‚¹é…ç½®ä¸»èŠ‚ç‚¹çš„ipå’Œç«¯å£å·å³å¯ã€‚&lt;/p&gt;
&lt;pre class=&quot;custom&quot; data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;
&lt;code class=&quot;hljs&quot;&gt;slaveof &amp;lt;masterip&amp;gt; &amp;lt;masterport&amp;gt;
# ä¾‹å¦‚
# slaveof &lt;span class=&quot;hljs-number&quot;&gt;192.168&lt;/span&gt;.1.214 &lt;span class=&quot;hljs-number&quot;&gt;6379&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¯åŠ¨&lt;strong&gt;ä¸»ä»&lt;/strong&gt;èŠ‚ç‚¹çš„æ‰€æœ‰æœåŠ¡ï¼ŒæŸ¥çœ‹æ—¥å¿—å³å¯ä»¥çœ‹åˆ°&lt;strong&gt;ä¸»ä»&lt;/strong&gt;èŠ‚ç‚¹ä¹‹é—´çš„æœåŠ¡è¿æ¥ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä»ä¸Šé¢å¾ˆå®¹æ˜“å°±æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæ—¢ç„¶ä¸»ä»å¤åˆ¶ï¼Œæ„å‘³ç€masterå’Œslaveçš„æ•°æ®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæœ‰æ•°æ®å†—ä½™é—®é¢˜ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨ç¨‹åºè®¾è®¡ä¸Šï¼Œä¸ºäº†é«˜å¯ç”¨æ€§å’Œé«˜æ€§èƒ½ï¼Œæ˜¯å…è®¸æœ‰å†—ä½™å­˜åœ¨çš„ã€‚è¿™ç‚¹å¸Œæœ›å¤§å®¶åœ¨è®¾è®¡ç³»ç»Ÿçš„æ—¶å€™è¦è€ƒè™‘è¿›å»ï¼Œä¸ç”¨ä¸ºå…¬å¸èŠ‚çœè¿™ä¸€ç‚¹èµ„æºã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¯¹äºè¿½æ±‚æè‡´&lt;strong&gt;ç”¨æˆ·ä½“éªŒ&lt;/strong&gt;çš„äº§å“ï¼Œæ˜¯ç»å¯¹ä¸å…è®¸æœ‰&lt;strong&gt;å®•æœº&lt;/strong&gt;å­˜åœ¨çš„ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸»ä»æ¨¡å¼åœ¨å¾ˆå¤šç³»ç»Ÿè®¾è®¡æ—¶éƒ½ä¼šè€ƒè™‘ï¼Œä¸€ä¸ªmasteræŒ‚åœ¨å¤šä¸ªslaveèŠ‚ç‚¹ï¼Œå½“masteræœåŠ¡å®•æœºï¼Œä¼š&lt;strong&gt;é€‰ä¸¾&lt;/strong&gt;äº§ç”Ÿä¸€ä¸ªæ–°çš„masterèŠ‚ç‚¹ï¼Œä»è€Œä¿è¯æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸»ä»æ¨¡å¼çš„ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;li readability=&quot;-2&quot;&gt;
&lt;section readability=&quot;2&quot;&gt;&lt;p&gt;ä¸€æ—¦ ä¸»èŠ‚ç‚¹å®•æœºï¼Œ&lt;strong&gt;ä»èŠ‚ç‚¹&lt;/strong&gt; ä½œä¸º ä¸»èŠ‚ç‚¹ çš„ &lt;strong&gt;å¤‡ä»½&lt;/strong&gt; å¯ä»¥éšæ—¶é¡¶ä¸Šæ¥ã€‚&lt;/p&gt;
&lt;/section&gt;&lt;/li&gt;
&lt;li readability=&quot;-2&quot;&gt;
&lt;section readability=&quot;2&quot;&gt;&lt;p&gt;æ‰©å±• &lt;strong&gt;ä¸»èŠ‚ç‚¹&lt;/strong&gt; çš„ &lt;strong&gt;è¯»èƒ½åŠ›&lt;/strong&gt;ï¼Œåˆ†æ‹…ä¸»èŠ‚ç‚¹è¯»å‹åŠ›ã€‚&lt;/p&gt;
&lt;/section&gt;&lt;/li&gt;
&lt;li readability=&quot;-1.5&quot;&gt;
&lt;section readability=&quot;3&quot;&gt;&lt;p&gt;é«˜å¯ç”¨åŸºçŸ³ï¼šé™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µæ¨¡å¼å’Œé›†ç¾¤æ¨¡å¼èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»å¤åˆ¶æ˜¯Redisé«˜å¯ç”¨çš„åŸºçŸ³ã€‚&lt;/p&gt;
&lt;/section&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¹Ÿæœ‰ç›¸åº”çš„ç¼ºç‚¹ï¼Œæ¯”å¦‚æˆ‘åˆšæåˆ°çš„æ•°æ®å†—ä½™é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;li&gt;
&lt;section&gt;ä¸€æ—¦ &lt;strong&gt;ä¸»èŠ‚ç‚¹å®•æœº&lt;/strong&gt;ï¼Œ&lt;strong&gt;ä»èŠ‚ç‚¹&lt;/strong&gt; æ™‹å‡æˆ &lt;strong&gt;ä¸»èŠ‚ç‚¹&lt;/strong&gt;ï¼ŒåŒæ—¶éœ€è¦ä¿®æ”¹ &lt;strong&gt;åº”ç”¨æ–¹&lt;/strong&gt; çš„ &lt;strong&gt;ä¸»èŠ‚ç‚¹åœ°å€&lt;/strong&gt;ï¼Œè¿˜éœ€è¦å‘½ä»¤æ‰€æœ‰ &lt;strong&gt;ä»èŠ‚ç‚¹&lt;/strong&gt; å» &lt;strong&gt;å¤åˆ¶&lt;/strong&gt; æ–°çš„ä¸»èŠ‚ç‚¹ï¼Œæ•´ä¸ªè¿‡ç¨‹éœ€è¦ &lt;strong&gt;äººå·¥å¹²é¢„&lt;/strong&gt;ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;li&gt;
&lt;section&gt;&lt;strong&gt;ä¸»èŠ‚ç‚¹&lt;/strong&gt; çš„ &lt;strong&gt;å†™èƒ½åŠ›&lt;/strong&gt; å—åˆ° &lt;strong&gt;å•æœºçš„é™åˆ¶&lt;/strong&gt;ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;li&gt;
&lt;section&gt;&lt;strong&gt;ä¸»èŠ‚ç‚¹&lt;/strong&gt; çš„ &lt;strong&gt;å­˜å‚¨èƒ½åŠ›&lt;/strong&gt; å—åˆ° &lt;strong&gt;å•æœºçš„é™åˆ¶&lt;/strong&gt;ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;å“¨å…µæ¨¡å¼&lt;/span&gt;&lt;/h3&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åˆšåˆšæåˆ°äº†ï¼Œä¸»ä»æ¨¡å¼ï¼Œå½“ä¸»èŠ‚ç‚¹å®•æœºä¹‹åï¼Œä»èŠ‚ç‚¹æ˜¯å¯ä»¥ä½œä¸ºä¸»èŠ‚ç‚¹é¡¶ä¸Šæ¥ï¼Œç»§ç»­æä¾›æœåŠ¡çš„ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¸»èŠ‚ç‚¹çš„IPå·²ç»å˜åŠ¨äº†ï¼Œæ­¤æ—¶åº”ç”¨æœåŠ¡è¿˜æ˜¯æ‹¿ç€&lt;strong&gt;åŸ&lt;/strong&gt;ä¸»èŠ‚ç‚¹çš„åœ°å€å»è®¿é—®ï¼Œè¿™...&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;äºæ˜¯ï¼Œåœ¨Redis 2.8ç‰ˆæœ¬å¼€å§‹å¼•å…¥ï¼Œå°±æœ‰äº†å“¨å…µè¿™ä¸ªæ¦‚å¿µã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨&lt;strong&gt;å¤åˆ¶çš„åŸºç¡€&lt;/strong&gt;ä¸Šï¼Œå“¨å…µå®ç°äº†&lt;strong&gt;è‡ªåŠ¨åŒ–&lt;/strong&gt;çš„æ•…éšœæ¢å¤ã€‚&lt;/p&gt;
&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1gfitueyqq3j30ys0n476e.jpg&quot; alt=&quot;&quot;/&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚å›¾ï¼Œå“¨å…µèŠ‚ç‚¹ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå“¨å…µèŠ‚ç‚¹å’Œæ•°æ®èŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;li&gt;
&lt;section&gt;å“¨å…µèŠ‚ç‚¹ï¼šå“¨å…µç³»ç»Ÿç”±ä¸€ä¸ªæˆ–å¤šä¸ªå“¨å…µèŠ‚ç‚¹ç»„æˆï¼Œå“¨å…µèŠ‚ç‚¹æ˜¯ç‰¹æ®Šçš„redisèŠ‚ç‚¹ï¼Œä¸å­˜å‚¨æ•°æ®ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;li&gt;
&lt;section&gt;æ•°æ®èŠ‚ç‚¹ï¼šä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹éƒ½æ˜¯æ•°æ®èŠ‚ç‚¹ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è®¿é—®redisé›†ç¾¤çš„æ•°æ®éƒ½æ˜¯é€šè¿‡å“¨å…µé›†ç¾¤çš„ï¼Œå“¨å…µç›‘æ§æ•´ä¸ªredisé›†ç¾¤ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸€æ—¦å‘ç°redisé›†ç¾¤å‡ºç°äº†é—®é¢˜ï¼Œæ¯”å¦‚åˆšåˆšè¯´çš„ä¸»èŠ‚ç‚¹æŒ‚äº†ï¼Œä»èŠ‚ç‚¹ä¼šé¡¶ä¸Šæ¥ã€‚ä½†æ˜¯ä¸»èŠ‚ç‚¹åœ°å€å˜äº†ï¼Œè¿™æ—¶å€™åº”ç”¨æœåŠ¡æ— æ„ŸçŸ¥ï¼Œä¹Ÿä¸ç”¨æ›´æ”¹è®¿é—®åœ°å€ï¼Œå› ä¸ºå“¨å…µæ‰æ˜¯å’Œåº”ç”¨æœåŠ¡åšäº¤äº’çš„ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Sentinel å¾ˆå¥½çš„è§£å†³äº†æ•…éšœè½¬ç§»ï¼Œåœ¨é«˜å¯ç”¨æ–¹é¢åˆä¸Šå‡äº†ä¸€ä¸ªå°é˜¶ï¼Œå½“ç„¶Sentinelè¿˜æœ‰å…¶ä»–åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¯”å¦‚ &lt;strong&gt;ä¸»èŠ‚ç‚¹å­˜æ´»æ£€æµ‹&lt;/strong&gt;ã€&lt;strong&gt;ä¸»ä»è¿è¡Œæƒ…å†µæ£€æµ‹&lt;/strong&gt;ã€&lt;strong&gt;ä¸»ä»åˆ‡æ¢&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Redisçš„Sentinelæœ€å°é…ç½®æ˜¯ &lt;strong&gt;ä¸€ä¸»ä¸€ä»&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;è¯´ä¸‹å“¨å…µæ¨¡å¼ç›‘æ§çš„åŸç†&lt;/span&gt;&lt;/h4&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¯ä¸ªSentinelä»¥ æ¯ç§’é’Ÿ ä¸€æ¬¡çš„é¢‘ç‡ï¼Œå‘å®ƒ&lt;strong&gt;æ‰€æœ‰&lt;/strong&gt;çš„ &lt;strong&gt;ä¸»æœåŠ¡å™¨&lt;/strong&gt;ã€&lt;strong&gt;ä»æœåŠ¡å™¨&lt;/strong&gt; ä»¥åŠå…¶ä»–Sentinel&lt;strong&gt;å®ä¾‹&lt;/strong&gt; å‘é€ä¸€ä¸ªPING å‘½ä»¤ã€‚&lt;/p&gt;
&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1gfixu17nfyj30vg0ng41n.jpg&quot; alt=&quot;&quot;/&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœä¸€ä¸ª å®ä¾‹ï¼ˆinstanceï¼‰è·ç¦»æœ€åä¸€æ¬¡æœ‰æ•ˆå›å¤ PINGå‘½ä»¤çš„æ—¶é—´è¶…è¿‡ down-after-milliseconds æ‰€æŒ‡å®šçš„å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå®ä¾‹ä¼šè¢« Sentinelæ ‡è®°ä¸º &lt;strong&gt;ä¸»è§‚ä¸‹çº¿&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœä¸€ä¸ª &lt;strong&gt;ä¸»æœåŠ¡å™¨&lt;/strong&gt; è¢«æ ‡è®°ä¸º &lt;strong&gt;ä¸»è§‚ä¸‹çº¿&lt;/strong&gt;ï¼Œé‚£ä¹ˆæ­£åœ¨ ç›‘è§† è¿™ä¸ª ä¸»æœåŠ¡å™¨ çš„&lt;strong&gt;æ‰€æœ‰&lt;/strong&gt; Sentinel èŠ‚ç‚¹ï¼Œè¦ä»¥ &lt;strong&gt;æ¯ç§’ä¸€æ¬¡&lt;/strong&gt; çš„é¢‘ç‡ç¡®è®¤ è¯¥ä¸»æœåŠ¡å™¨æ˜¯å¦çš„ç¡®è¿›å…¥äº† &lt;strong&gt;ä¸»è§‚ä¸‹çº¿&lt;/strong&gt; çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœä¸€ä¸ª ä¸»æœåŠ¡å™¨ è¢«æ ‡è®°ä¸º ä¸»è§‚ä¸‹çº¿ï¼Œå¹¶ä¸”æœ‰ &lt;strong&gt;è¶³å¤Ÿæ•°é‡&lt;/strong&gt; çš„ Sentinelï¼ˆè‡³å°‘è¦è¾¾åˆ°é…ç½®æ–‡ä»¶æŒ‡å®šçš„æ•°é‡ï¼‰åœ¨æŒ‡å®šçš„ &lt;strong&gt;æ—¶é—´èŒƒå›´&lt;/strong&gt; å†…åŒæ„è¿™ä¸€åˆ¤æ–­ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯¥ä¸»æœåŠ¡å™¨è¢«æ ‡è®°ä¸º &lt;strong&gt;å®¢è§‚ä¸‹çº¿&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ æ¯ä¸ª Sentinel ä¼šä»¥æ¯ 10ç§’ä¸€æ¬¡çš„é¢‘ç‡ï¼Œå‘å®ƒå·²çŸ¥çš„æ‰€æœ‰ ä¸»æœåŠ¡å™¨ å’Œ ä»æœåŠ¡å™¨ å‘é€ INFO å‘½ä»¤ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å½“ä¸€ä¸ª &lt;strong&gt;ä¸»æœåŠ¡å™¨&lt;/strong&gt; è¢« Sentinelæ ‡è®°ä¸º &lt;strong&gt;å®¢è§‚ä¸‹çº¿&lt;/strong&gt; æ—¶ï¼ŒSentinel å‘ ä¸‹çº¿ä¸»æœåŠ¡å™¨ çš„æ‰€æœ‰ ä»æœåŠ¡å™¨ å‘é€ INFO å‘½ä»¤çš„é¢‘ç‡ï¼Œä¼šä»10ç§’ä¸€æ¬¡æ”¹ä¸º æ¯ç§’ä¸€æ¬¡ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Sentinelå’Œå…¶ä»– Sentinel åå•† &lt;strong&gt;ä¸»èŠ‚ç‚¹&lt;/strong&gt; çš„çŠ¶æ€ï¼Œå¦‚æœ ä¸»èŠ‚ç‚¹å¤„äº &lt;strong&gt;SDOWN`&lt;strong&gt;çŠ¶æ€ï¼Œåˆ™æŠ•ç¥¨&lt;/strong&gt;è‡ªåŠ¨é€‰å‡º&lt;/strong&gt;æ–°çš„ä¸»èŠ‚ç‚¹ã€‚å°†å‰©ä½™çš„ &lt;strong&gt;ä»èŠ‚ç‚¹&lt;/strong&gt; æŒ‡å‘ &lt;strong&gt;æ–°çš„ä¸»èŠ‚ç‚¹&lt;/strong&gt; è¿›è¡Œ &lt;strong&gt;æ•°æ®å¤åˆ¶&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å½“æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinel åŒæ„ ä¸»æœåŠ¡å™¨ ä¸‹çº¿æ—¶ï¼Œ ä¸»æœåŠ¡å™¨ çš„ &lt;strong&gt;å®¢è§‚ä¸‹çº¿çŠ¶æ€&lt;/strong&gt; å°±ä¼šè¢«ç§»é™¤ã€‚å½“ &lt;strong&gt;ä¸»æœåŠ¡å™¨&lt;/strong&gt; é‡æ–°å‘ Sentinelçš„PINGå‘½ä»¤è¿”å› æœ‰æ•ˆå›å¤ æ—¶ï¼Œä¸»æœåŠ¡å™¨ çš„ &lt;strong&gt;ä¸»è§‚ä¸‹çº¿çŠ¶æ€&lt;/strong&gt; å°±ä¼šè¢«ç§»é™¤ã€‚&lt;/p&gt;
&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;å“¨å…µæ¨¡å¼çš„ä¼˜ç¼ºç‚¹&lt;/span&gt;&lt;/h4&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;â€‹ ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;li&gt;
&lt;section&gt;å“¨å…µæ¨¡å¼æ˜¯åŸºäºä¸»ä»æ¨¡å¼çš„ï¼Œæ‰€æœ‰ä¸»ä»çš„ä¼˜ç‚¹ï¼Œå“¨å…µæ¨¡å¼éƒ½å…·æœ‰ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;li&gt;
&lt;section&gt;ä¸»ä»å¯ä»¥è‡ªåŠ¨åˆ‡æ¢ï¼Œç³»ç»Ÿæ›´å¥å£®ï¼Œå¯ç”¨æ€§æ›´é«˜ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;li&gt;
&lt;section&gt;Sentinel ä¼šä¸æ–­çš„æ£€æŸ¥ ä¸»æœåŠ¡å™¨ å’Œ ä»æœåŠ¡å™¨ æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚å½“è¢«ç›‘æ§çš„æŸä¸ª Redis æœåŠ¡å™¨å‡ºç°é—®é¢˜ï¼ŒSentinel é€šè¿‡APIè„šæœ¬å‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–çš„åº”ç”¨ç¨‹åºå‘é€é€šçŸ¥ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;â€‹ ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ul data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;li&gt;
&lt;section&gt;Redisè¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œå¯¹äºé›†ç¾¤ï¼Œå®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚&lt;/section&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;æˆ‘çš„ä»»åŠ¡&lt;/span&gt;&lt;/h4&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘éƒ¨ç½²çš„redisæœåŠ¡å°±å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸‰ä¸ªå“¨å…µèŠ‚ç‚¹ï¼Œä¸‰ä¸ªä¸»ä»å¤åˆ¶èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä½¿ç”¨javaçš„jediså»è®¿é—®æˆ‘çš„redisæœåŠ¡ï¼Œä¸‹é¢æ¥ä¸€æ®µç®€å•çš„æ¼”ç¤ºä»£ç (å¹¶éå·¥ç¨‹é‡Œé¢çš„ä»£ç )ï¼š&lt;/p&gt;
&lt;pre class=&quot;custom&quot; data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;
&lt;code class=&quot;hljs&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;hljs-title&quot;&gt;testSentinel&lt;/span&gt;&lt;span class=&quot;hljs-params&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;throws&lt;/span&gt; Exception &lt;/span&gt;{
     
         String masterName = &lt;span class=&quot;hljs-string&quot;&gt;&quot;master&quot;&lt;/span&gt;;
         Set&amp;lt;String&amp;gt; sentinels = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&amp;gt;();
     
         sentinels.add(&lt;span class=&quot;hljs-string&quot;&gt;&quot;192.168.200,213:26379&quot;&lt;/span&gt;);
         sentinels.add(&lt;span class=&quot;hljs-string&quot;&gt;&quot;192.168.200.214:26380&quot;&lt;/span&gt;);
         sentinels.add(&lt;span class=&quot;hljs-string&quot;&gt;&quot;192.168.200.215:26381&quot;&lt;/span&gt;);
 
     
         JedisSentinelPool pool = &lt;span class=&quot;hljs-keyword&quot;&gt;new&lt;/span&gt; JedisSentinelPool(masterName, sentinels); 
     
         Jedis jedis = pool.getResource();
     
         jedis.set(&lt;span class=&quot;hljs-string&quot;&gt;&quot;key1&quot;&lt;/span&gt;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;value1&quot;&lt;/span&gt;);
     
     jedis.get(&lt;span class=&quot;hljs-string&quot;&gt;&quot;key1&quot;&lt;/span&gt;);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…·ä½“éƒ¨ç½²çš„é…ç½®æ–‡ä»¶è¿™é‡Œå¤ªé•¿äº†ï¼Œéœ€è¦çš„æœ‹å‹å¯ä»¥å…¬ä¼—å·åå°å›å¤ã€redisé…ç½®ã€‘è·å–ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¬èµ·æ¥æ˜¯å…¥èŒç¬¬äºŒå¤©å°±éƒ¨ç½²äº†ä»»åŠ¡æ„Ÿè§‰å¾ˆéš¾çš„æ ·å­ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å…¶å®ç°åœ¨çœ‹æ¥æ˜¯ä¸ªso easyçš„ä»»åŠ¡ï¼Œç”³è¯·ä¸€ä¸ªredisé›†ç¾¤ï¼Œè‡ªå·±é…ç½®ä¸‹ã€‚åœ¨æŠŠå·¥ç¨‹é‡Œé¢ä½¿ç”¨åˆ°redisçš„åœ°æ–¹æ”¹ä¸€ä¸‹ï¼Œä¹‹å‰ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªä¸¤ä¸ªå•æœºèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¹²å®Œï¼Œæ”¶å·¥ã€‚&lt;/p&gt;
&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1gfiy23mlv6g306o06oaao.gif&quot; alt=&quot;&quot;/&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è™½ç„¶é¢†å¯¼çš„ä»»åŠ¡å®Œæˆäº†ï¼Œä½†å¹¶ä¸æ„å‘³ç€å­¦ä¹ redisçš„è·¯ç»“æŸäº†ã€‚çˆ±å­¦ä¹ çš„é¾™å”ï¼Œç»§ç»­ç ”ç©¶äº†ä¸‹redisçš„é›†ç¾¤æ¨¡å¼ã€‚&lt;/p&gt;
&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;é›†ç¾¤æ¨¡å¼&lt;/span&gt;&lt;/h3&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸»ä»ä¸èƒ½è§£å†³æ•…éšœè‡ªåŠ¨æ¢å¤é—®é¢˜ï¼Œå“¨å…µå·²ç»å¯ä»¥è§£å†³æ•…éšœè‡ªåŠ¨æ¢å¤äº†ï¼Œé‚£åˆ°åº•ä¸ºå•¥è¿˜è¦é›†ç¾¤æ¨¡å¼å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸»ä»å’Œå“¨å…µéƒ½è¿˜æœ‰å¦å¤–ä¸€äº›é—®é¢˜æ²¡æœ‰è§£å†³ï¼Œå•ä¸ªèŠ‚ç‚¹çš„å­˜å‚¨èƒ½åŠ›æ˜¯æœ‰ä¸Šé™ï¼Œè®¿é—®èƒ½åŠ›æ˜¯æœ‰ä¸Šé™çš„ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;Redis Cluster é›†ç¾¤æ¨¡å¼å…·æœ‰ &lt;strong&gt;é«˜å¯ç”¨&lt;/strong&gt;ã€&lt;strong&gt;å¯æ‰©å±•æ€§&lt;/strong&gt;ã€&lt;strong&gt;åˆ†å¸ƒå¼&lt;/strong&gt;ã€&lt;strong&gt;å®¹é”™&lt;/strong&gt; ç­‰ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;h4 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;Cluster é›†ç¾¤æ¨¡å¼çš„åŸç†&lt;/span&gt;&lt;/h4&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é€šè¿‡æ•°æ®åˆ†ç‰‡çš„æ–¹å¼æ¥è¿›è¡Œæ•°æ®å…±äº«é—®é¢˜ï¼ŒåŒæ—¶æä¾›æ•°æ®å¤åˆ¶å’Œæ•…éšœè½¬ç§»åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¹‹å‰çš„ä¸¤ç§æ¨¡å¼æ•°æ®éƒ½æ˜¯åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„ï¼Œå•ä¸ªèŠ‚ç‚¹å­˜å‚¨æ˜¯å­˜åœ¨ä¸Šé™çš„ã€‚é›†ç¾¤æ¨¡å¼å°±æ˜¯æŠŠæ•°æ®è¿›è¡Œåˆ†ç‰‡å­˜å‚¨ï¼Œå½“ä¸€ä¸ªåˆ†ç‰‡æ•°æ®è¾¾åˆ°ä¸Šé™çš„æ—¶å€™ï¼Œå°±åˆ†æˆå¤šä¸ªåˆ†ç‰‡ã€‚&lt;/p&gt;
&lt;h5 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;æ•°æ®åˆ†ç‰‡æ€ä¹ˆåˆ†ï¼Ÿ&lt;/span&gt;&lt;/h5&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;é›†ç¾¤çš„é”®ç©ºé—´è¢«åˆ†å‰²ä¸º16384ä¸ªslotsï¼ˆå³hashæ§½ï¼‰ï¼Œé€šè¿‡hashçš„æ–¹å¼å°†æ•°æ®åˆ†åˆ°ä¸åŒçš„åˆ†ç‰‡ä¸Šçš„ã€‚&lt;/p&gt;
&lt;pre class=&quot;custom&quot; data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;
&lt;code class=&quot;hljs&quot;&gt;HASH_SLOT = CRC16(key) &amp;amp; &lt;span class=&quot;hljs-number&quot;&gt;16384&lt;/span&gt; 
&lt;/code&gt;
&lt;/pre&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;CRC16æ˜¯ä¸€ç§å¾ªç¯æ ¡éªŒç®—æ³•ï¼Œè¿™é‡Œä¸æ˜¯æˆ‘ä»¬ç ”ç©¶çš„é‡ç‚¹ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹çœ‹ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¿™é‡Œç”¨äº†&lt;strong&gt;ä½è¿ç®—&lt;/strong&gt;å¾—åˆ°å–æ¨¡ç»“æœï¼Œä½è¿ç®—çš„é€Ÿåº¦é«˜äºå–æ¨¡è¿ç®—ã€‚&lt;/p&gt;
&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1gfjigqb0omj315w0pc776.jpg&quot; alt=&quot;&quot;/&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆæ˜¯åˆ†å‰²ä¸º16384ä¸ªæ§½ï¼Ÿè¿™ä¸ªé—®é¢˜å¯èƒ½ä¼šè¢«é¢è¯•å®˜éšå£ä¸€é—®&lt;/p&gt;
&lt;h5 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;æ•°æ®åˆ†ç‰‡ä¹‹åæ€ä¹ˆæŸ¥ï¼Œæ€ä¹ˆå†™ï¼Ÿ&lt;/span&gt;&lt;/h5&gt;
&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1gfjiydi719j31980pk426.jpg&quot; alt=&quot;&quot;/&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;è¯»è¯·æ±‚åˆ†é…ç»™slaveèŠ‚ç‚¹ï¼Œå†™è¯·æ±‚åˆ†é…ç»™masterï¼Œæ•°æ®åŒæ­¥ä»masteråˆ°slaveèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;strong&gt;è¯»å†™åˆ†ç¦»&lt;/strong&gt;æé«˜å¹¶å‘èƒ½åŠ›ï¼Œå¢åŠ é«˜æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h5 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;å¦‚ä½•åšåˆ°æ°´å¹³æ‰©å±•ï¼Ÿ&lt;/span&gt;&lt;/h5&gt;
&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1gfjj6f6zcqj318h0u043d.jpg&quot; alt=&quot;&quot;/&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;masterèŠ‚ç‚¹å¯ä»¥åšæ‰©å……ï¼Œæ•°æ®è¿ç§»rediså†…éƒ¨è‡ªåŠ¨å®Œæˆã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å½“ä½ æ–°å¢ä¸€ä¸ªmasterèŠ‚ç‚¹ï¼Œéœ€è¦åšæ•°æ®è¿ç§»ï¼ŒredisæœåŠ¡ä¸éœ€è¦ä¸‹çº¿ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ä¸¾ä¸ªæ —å­ï¼šä¸Šé¢çš„æœ‰ä¸‰ä¸ªmasterèŠ‚ç‚¹ï¼Œæ„å‘³ç€redisçš„æ§½è¢«åˆ†ä¸ºä¸‰ä¸ªæ®µï¼Œå‡è®¾ä¸‰æ®µåˆ†åˆ«æ˜¯0~7000ï¼Œ7001~12000ã€12001~16383ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;ç°åœ¨å› ä¸ºä¸šåŠ¡éœ€è¦æ–°å¢äº†ä¸€ä¸ªmasterèŠ‚ç‚¹ï¼Œå››ä¸ªèŠ‚ç‚¹å…±åŒå æœ‰16384ä¸ªæ§½ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ§½éœ€è¦é‡æ–°åˆ†é…ï¼Œæ•°æ®ä¹Ÿéœ€è¦é‡æ–°è¿ç§»ï¼Œä½†æ˜¯æœåŠ¡ä¸éœ€è¦ä¸‹çº¿ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;redisé›†ç¾¤çš„é‡æ–°åˆ†ç‰‡ç”±rediså†…éƒ¨çš„ç®¡ç†è½¯ä»¶redis-tribè´Ÿè´£æ‰§è¡Œã€‚redisæä¾›äº†è¿›è¡Œé‡æ–°åˆ†ç‰‡çš„æ‰€æœ‰å‘½ä»¤ï¼Œredis-tribé€šè¿‡å‘èŠ‚ç‚¹å‘é€å‘½ä»¤æ¥è¿›è¡Œé‡æ–°åˆ†ç‰‡ã€‚&lt;/p&gt;
&lt;h5 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;å¦‚ä½•åšæ•…éšœè½¬ç§»ï¼Ÿ&lt;/span&gt;&lt;/h5&gt;
&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1gfjjuellcgj316q0u0gqk.jpg&quot; alt=&quot;&quot;/&gt;&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å‡å¦‚é€”ä¸­çº¢è‰²çš„èŠ‚ç‚¹æ•…éšœäº†ï¼Œæ­¤æ—¶master3ä¸‹é¢çš„ä»èŠ‚ç‚¹ä¼šé€šè¿‡ &lt;strong&gt;é€‰ä¸¾&lt;/strong&gt; äº§ç”Ÿä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚æ›¿æ¢åŸæ¥çš„æ•…éšœèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ­¤è¿‡ç¨‹å’Œå“¨å…µæ¨¡å¼çš„æ•…éšœè½¬ç§»æ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;h3 data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;&lt;span class=&quot;content&quot;&gt;æ€»ç»“&lt;/span&gt;&lt;/h3&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¯ç§æ¨¡å¼éƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œåœ¨å®é™…ä½¿ç”¨åœºæ™¯ä¸­è¦æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹å»é€‰æ‹©åˆé€‚çš„æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;redisæ˜¯ä¸€ä¸ªéå¸¸&lt;strong&gt;å¸¸ç”¨&lt;/strong&gt;çš„ä¸­é—´ä»¶ï¼Œä½œä¸ºä¸€ä¸ªä½¿ç”¨è€…æ¥è¯´ï¼Œå­¦ä¹ æˆæœ¬ä¸€ç‚¹ä¸é«˜ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;å¦‚æœä½œä¸ºä¸€ä¸ªå¾ˆå¥½çš„ä¸­é—´ä»¶å»ç ”ç©¶çš„è¯ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šå€¼å¾—å­¦ä¹ å’Œå€Ÿé‰´çš„åœ°æ–¹ã€‚æ¯”å¦‚redisçš„å„ç§æ•°æ®ç»“æ„(åŠ¨æ€å­—ç¬¦ä¸²ã€è·³è·ƒè¡¨ã€é›†åˆã€å­—å…¸ç­‰)ã€é«˜æ•ˆçš„å†…å­˜åˆ†é…(jemalloc)ã€é«˜æ•ˆçš„IOæ¨¡å‹ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æ¯ä¸ªç‚¹éƒ½å¯ä»¥æ·±å…¥ç ”ç©¶ï¼Œåœ¨åæœŸè®¾è®¡é«˜å¹¶å‘ã€é«˜å¯ç”¨ç³»ç»Ÿçš„æ—¶å€™èå…¥è¿›å»ã€‚&lt;/p&gt;
&lt;p data-tool=&quot;mdniceç¼–è¾‘å™¨&quot;&gt;æˆ‘æ˜¯é¾™å”ï¼Œä¸€ä¸ªåˆ†äº«äº’è”ç½‘æŠ€æœ¯å’Œæˆé•¿å¿ƒè·¯å†ç¨‹çš„starã€‚&lt;/p&gt;
&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1gev88f8kfvj30p00dw0tn.jpg&quot; alt=&quot;&quot;/&gt;</description>
<pubDate>Mon, 15 Jun 2020 00:31:00 +0000</pubDate>
<dc:creator>é¾™è·ƒåäºŒ</dc:creator>
<og:description>Redisçš„å››ç§æ¨¡å¼è¯¦è§£ï¼Œå•æœºã€ä¸»ä»ã€å“¨å…µã€é›†ç¾¤æ¨¡å¼</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/zhonglongbo/p/13128955.html</dc:identifier>
</item>
<item>
<title>ç½‘é¡µå…ƒç´ å±…ä¸­çš„nç§æ–¹æ³• - ä¸°è‡£æ­£ä¸€</title>
<link>http://www.cnblogs.com/cnroadbridge/p/13128943.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/cnroadbridge/p/13128943.html</guid>
<description>&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;å¯¼è¯­ï¼šå…ƒç´ å±…ä¸­å¯¹é½åœ¨å¾ˆå¤šåœºæ™¯çœ‹ä¸Šå»å¾ˆå’Œè°å¾ˆæ¼‚äº®ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºå‰ç«¯å¼€å‘é¢è¯•è€…çš„åŸºç¡€ä¹Ÿæ˜¯å¾ˆå¥½çš„ä¸€ä¸ªè€ƒå¯Ÿç‚¹ã€‚ä¸‹é¢è·Ÿç€ä½œè€…çš„æ€è·¯ï¼Œä¸€èµ·æ¥çœ‹ä¸‹å§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;åœºæ™¯åˆ†æ&quot;&gt;åœºæ™¯åˆ†æ&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒæœ‰å¯èƒ½æœ‰èƒŒæ™¯ï¼Œé‚£æˆ‘è¦å®ƒçš„èƒŒæ™¯å±…ä¸­å¯¹é½&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒè¿˜æœ‰å¯èƒ½æœ‰ä¸ªçˆ¶çº§å…ƒç´ ï¼Œé‚£æˆ‘è¦å®ƒå±…ä¸­äºå…¶çˆ¶çº§å…ƒç´ &lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒä¹Ÿæœ‰å¯èƒ½è¿˜å¸¦æœ‰ä¸€äº›å­å†…å®¹ï¼Œæˆ‘è¦è®©å®ƒçš„å­å†…å®¹å±…ä¸­&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;åœºæ™¯å»ºæ¨¡&quot;&gt;åœºæ™¯å»ºæ¨¡&lt;/h2&gt;
&lt;p&gt;æ ¹æ®åœºæ™¯åˆ†ææå‡ºçš„ä¸€äº›å‡è®¾ï¼Œæˆ‘ä»¬è¯•ç€å»å»ºç«‹å¯¹åº”çš„æ¨¡å‹ï¼Œä¸‹é¢æ˜¯åˆ†åˆ«æ ¹æ®ä¸Šé¢çš„ä¸‰ä¸ªåœºæ™¯è®¾è®¡çš„ç›¸å…³æ¨¡å‹ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æçˆ¶å­å…ƒç´ å±…ä¸­å¯¹é½&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/2055171/202006/2055171-20200615082212222-349199370.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æå…ƒç´ èƒŒæ™¯å±…ä¸­å¯¹é½&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/2055171/202006/2055171-20200615082226483-1696347594.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æå…ƒç´ å†…å®¹å±…ä¸­å¯¹é½&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/2055171/202006/2055171-20200615082241956-306194736.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;åœºæ™¯å®ç°&quot;&gt;åœºæ™¯å®ç°&lt;/h2&gt;
&lt;h3 id=&quot;ç›¸å…³è¯´æ˜&quot;&gt;ç›¸å…³è¯´æ˜&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†ç»Ÿä¸€ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª&lt;code&gt;400*400px&lt;/code&gt;çš„å¸¦ç€é»‘è‰²è¾¹æ¡†ç²‰çº¢è‰²èº«ä½“çš„ç±»åä¸º&lt;code&gt;.box&lt;/code&gt;çš„çˆ¶å®¹å™¨ï¼Œå®ƒæœ‰å¯èƒ½ä¼šæœ‰ä¸€ä¸ª&lt;code&gt;200*200px&lt;/code&gt;çš„å¸¦ç€åŸè°…è‰²èº«ä½“çš„ç±»åä¸º&lt;code&gt;.box-son&lt;/code&gt;çš„å­å®¹å™¨ã€‚è¿™é‡Œä¸ºäº†æ•ˆæœèƒ½å¤Ÿç›´è§‚ä¸”æ˜æ˜¾ï¼Œç¬”è€…æ•…æ„æŠŠèƒŒæ™¯å›¾ç‰‡çš„åŸå§‹å¤§å°å¤„ç†æˆå°äºå®¿ä¸»åƒç´ çš„å¤§å°ã€‚å¥½å§ï¼Œæˆ‘ä»¬å¼€å§‹å§ï¼&lt;/p&gt;
&lt;h3 id=&quot;èƒŒæ™¯å±…ä¸­&quot;&gt;èƒŒæ™¯å±…ä¸­&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬åšè¿™æ ·ä¸€ä»¶äº‹ï¼Œåœ¨ä¸€ä¸ªdivå®¹å™¨ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡&lt;code&gt;background-image&lt;/code&gt;å±æ€§å¼•å…¥ä¸€å¼ èƒŒæ™¯ï¼Œä¹‹åæˆ‘ä»¬æœŸæœ›è¿™å¼ å¼•å…¥çš„èƒŒæ™¯å‘¢ï¼Œå®ƒèƒ½å¤Ÿæ°´å¹³å‚ç›´å±…ä¸­äºå®¿ä¸»å…ƒç´ ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä»‹ç»ä¸¤ä¸ªå±æ€§&lt;code&gt;background-repeat&lt;/code&gt;å’Œ&lt;code&gt;background-position&lt;/code&gt;ï¼Œå¦‚æœä½ åˆä¸­è‹±è¯­å¥½çš„è¯ï¼Œæˆ‘æƒ³ä½ ä¹Ÿåº”è¯¥çŸ¥é“äº†ï¼Œè¿™é‡Œå­—é¢æ„æ€å°±æ˜¯è¿™ä¸ªå±æ€§çš„æ„æ€ã€‚ä¸€ä¸ªæ˜¯è®¾ç½®èƒŒæ™¯å›¾ç‰‡æ€ä¹ˆé“ºå®¿ä¸»å…ƒç´ ï¼ˆé»˜è®¤æ—¶é“ºæ»¡çš„ï¼‰æ›´ç¾ä¸½çš„ï¼Œå¦ä¸€ä¸ªæ˜¯è®¾ç½®èƒŒæ™¯å›¾ç‰‡ç›¸å¯¹äºå®¿ä¸»å…ƒç´ çš„çš„ä½ç½®ï¼Œä½ å¯ä»¥ä¼ åƒç´ ã€ç™¾åˆ†æ¯”ã€ç›¸å…³æ–¹å‘å•è¯ï¼ˆtopã€bottomã€leftã€rightï¼‰ç»™å®ƒã€‚å½“å…¶ä¸ºç™¾åˆ†æ¯”çš„æ—¶å€™ï¼Œå®ƒçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;(container width - image width) * (position x%) = (x offset value)
(container height - image height) * (position y%) = (y offset value)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç®€è¨€ä¹‹ï¼Œå°±æ˜¯å®¿ä¸»å…ƒç´ çš„å®½é«˜å‡å»å›¾ç‰‡å®½é«˜ä¹˜ä»¥ç›¸å…³ç™¾åˆ†æ¯”å°±æ˜¯ç›¸å¯¹äºå®¿ä¸»å…ƒç´ å·¦ä¸Šè§’é‚£ä¸ªåŸç‚¹çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨èƒŒæ™¯å›¾ç‰‡ä¸é‡å¤çš„æƒ…å†µä¸‹ï¼Œä½ æƒ³è®©ä¸€å¼ å›¾ç‰‡å±…ä¸­äºå®¿ä¸»å…ƒç´ çš„æ–¹æ³•ï¼Œå¯ä»¥æœ‰&lt;code&gt;background-postion: center center&lt;/code&gt;ã€&lt;code&gt;background-postion: 50%, 50%&lt;/code&gt;,ä¹Ÿå¯ä»¥ç®€å†™æˆ&lt;code&gt;background-postion: center&lt;/code&gt;æˆ–è€…&lt;code&gt;background-postion: 50%&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œåœ¨æ¥¼ä¸Šè¿™äº›å‰æä¸‹ï¼Œæˆ‘ä»¬å¤§è‡´èƒ½å¤Ÿå½’å‡ºä¸€ä¸ªç±»ï¼Œå½¢å¦‚ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-css&quot;&gt;/** è¿™é‡Œä»¥å¤æ‚å†™æ³•çš„ç™¾åˆ†æ¯”ä¸ºä¾‹ï¼Œ åˆ†åˆ«ä»£è¡¨è·ç¦»å®¿ä¸»å…ƒç´ å·¦ä¸Šè§’çš„xå’Œyè½´çš„è·ç¦»**/
.box-son {
        background-repeat: no-repeat;
        background-position: 50%, 50%;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;æ–‡å­—å†…å®¹å±…ä¸­&quot;&gt;æ–‡å­—å†…å®¹å±…ä¸­&lt;/h3&gt;
&lt;p&gt;å¦‚æœå®¿ä¸»å…ƒç´ çš„å†…å®¹æ˜¯æ–‡å­—ä¹‹ç±»çš„ï¼Œæˆ‘ä»¬æœŸæœ›å®ƒèƒ½å¤Ÿå±…ä¸­äºå®¿ä¸»å…ƒç´ ï¼Œè¿™é‡Œç”¨åˆ°ä¸¤ä¸ªå±æ€§ï¼Œä¸€ä¸ªæ˜¯&lt;code&gt;text-align&lt;/code&gt;ï¼Œä¸€ä¸ªæ˜¯&lt;code&gt;line-height&lt;/code&gt;ã€‚&lt;code&gt;text-algin:center&lt;/code&gt;å¯ä»¥ä½¿å†…å®¹æ°´å¹³å±…ä¸­äºå®¿ä¸»å…ƒç´ ï¼Œå°†&lt;code&gt;line-height&lt;/code&gt;è®¾ç½®æˆå®¿ä¸»å…ƒç´ ç›¸åŒçš„é«˜åº¦ï¼Œä¾¿å¯è®©å®¿ä¸»å…ƒç´ å‚ç›´å±…ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸å…³ä¾‹å­é“¾æ¥ï¼š&lt;a href=&quot;https://ataola.github.io/show/zj/center-middle.html#example11&quot;&gt;https://ataola.github.io/show/zj/center-middle.html#example11&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;å­å…ƒç´ å±…ä¸­äºçˆ¶å…ƒç´ &quot;&gt;å­å…ƒç´ å±…ä¸­äºçˆ¶å…ƒç´ &lt;/h3&gt;
&lt;h4 id=&quot;ç›¸å…³è¯´æ˜-2&quot;&gt;ç›¸å…³è¯´æ˜&lt;/h4&gt;
&lt;p&gt;è¿™é‡Œè§£é‡Šä¸‹ï¼Œçˆ¶ç›¸å­ç»ï¼Œè¿™ä¸ªæ˜¯æˆ‘é˜‰å‰²äº†â€œçˆ¶çº§å…ƒç´ ç›¸å¯¹å®šä½ï¼Œå­çº§å…ƒç´ ç»å¯¹å®šä½â€è¿™å¥è¯æµ“ç¼©åçš„å«æ³•ã€‚åé¢å‡ºç°è¿™ä¸ªæ¦‚å¿µæˆ‘å°±ä¸è¿‡å¤šå†è¿›è¡Œé‡å¤ä»‹ç»äº†ã€‚&lt;/p&gt;
&lt;h4 id=&quot;çˆ¶ç›¸å­ç»--margin-auto&quot;&gt;çˆ¶ç›¸å­ç» + margin: auto&lt;/h4&gt;
&lt;p&gt;çˆ¶å…ƒç´ ç›¸å¯¹å®šä½å­å…ƒç´ ç»å¯¹å®šä½åï¼Œè®¾ç½®å…¶&lt;code&gt;topã€rightã€bottomã€left&lt;/code&gt;éƒ½ä¸º0ï¼Œä¹‹åæˆ‘ä»¬å°†å…¶çš„&lt;code&gt;margin&lt;/code&gt;è®¾ç½®ä¸º&lt;code&gt;auto&lt;/code&gt;ã€‚è¿™æ ·å­çš„è¯ï¼Œçˆ¶çº§å…ƒç´ ä¸å­çº§å…ƒç´ ä»–ä»¬ä¹‹é—´ç©ºå‡ºæ¥çš„éƒ¨åˆ†éƒ½ä¼šè¢«è¿™ä¸ª&lt;code&gt;margin&lt;/code&gt;å‡åŒ€æ’‘å¼€ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-css&quot;&gt;.box-position {
    position: relative;
}

.box-example1 {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    margin: auto;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç›¸å…³ä¾‹å­é“¾æ¥ï¼š&lt;a href=&quot;https://ataola.github.io/show/zj/center-middle.html#example1&quot;&gt;https://ataola.github.io/show/zj/center-middle.html#example1&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;çˆ¶ç›¸å­ç»--è´Ÿå€¼margin&quot;&gt;çˆ¶ç›¸å­ç» + è´Ÿå€¼margin&lt;/h4&gt;
&lt;p&gt;çˆ¶å…ƒç´ ç›¸å¯¹å®šä½å­å…ƒç´ ç»å¯¹å®šä½åï¼Œå­å…ƒç´ è®¾ç½®&lt;code&gt;top: 50%; left:50%;&lt;/code&gt;ï¼Œè¿™é‡Œçš„ç™¾åˆ†æ¯”å‚è€ƒå€¼æ˜¯ç›¸å¯¹äºçˆ¶å…ƒç´ çš„å®½é«˜ï¼Œå‚è€ƒçš„ç‚¹æ˜¯çˆ¶å…ƒç´ çš„å·¦ä¸Šè§’å’Œå­å…ƒç´ çš„å·¦ä¸Šè§’ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦çŸ«æ­£ä¸€ä¸‹ï¼Œå‡å»å­å…ƒç´ å®½é«˜çš„ä¸€åŠã€‚è¿™ä»¶äº‹å¯ä»¥è®©å­å…ƒç´ çš„&lt;code&gt;margin&lt;/code&gt;ä»£åŠ³ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-css&quot;&gt;.box-position {
    position: relative;
}

.box-example2 {
    position: absolute;
    top: 50%;
    left: 50%;
    margin-left: -100px;
    margin-top: -100px;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç›¸å…³ä¾‹å­é“¾æ¥ï¼š &lt;a href=&quot;https://ataola.github.io/show/zj/center-middle.html#example2&quot;&gt;https://ataola.github.io/show/zj/center-middle.html#example2&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;çˆ¶ç›¸å­ç»--å¹³ç§»ï¼ˆtranslateï¼‰&quot;&gt;çˆ¶ç›¸å­ç» + å¹³ç§»ï¼ˆtranslateï¼‰&lt;/h4&gt;
&lt;p&gt;åœ¨æ¥¼ä¸Šé‚£ä¸ªä¾‹å­çš„åŸºç¡€ä¸Šï¼Œä¸ºäº†çŸ«æ­£å­å…ƒç´ çš„åç§»ï¼Œæˆ‘ä»¬å…¶å®è¿˜å¯ä»¥ç”¨cssçš„å¹³ç§»å±æ€§ã€‚è¿™ä¸ªå¹³ç§»çš„ç™¾åˆ†æ¯”æ˜¯ç›¸å¯¹äºå…¶æœ¬èº«çš„å®½é«˜çš„ï¼Œæ‰€ä»¥æ˜¯å‘åæ–¹å‘50%ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-css&quot;&gt;.box-position {
    position: relative;
}

.box-example3 {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç›¸å…³ä¾‹å­é“¾æ¥ï¼š&lt;a href=&quot;https://ataola.github.io/show/zj/center-middle.html#example3&quot;&gt;https://ataola.github.io/show/zj/center-middle.html#example3&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;çˆ¶å­doubleç›¸ï¼ˆä¸æ¨èï¼Œåšç€ç©ç©çš„ï¼‰&quot;&gt;çˆ¶å­doubleç›¸ï¼ˆä¸æ¨èï¼Œåšç€ç©ç©çš„ï¼‰&lt;/h4&gt;
&lt;p&gt;ä¸€ä¸ªä¸æˆç†Ÿçš„åšæ³•å“ˆï¼Œçˆ¶å­éƒ½æ˜¯ç›¸å¯¹å®šä½ä¹Ÿè¿˜æ˜¯å¯ä»¥å‹‰å¼ºå±…ä¸­çš„ï¼Œç¡¬ç®—å˜›ï¼Œè¿™é‡Œæ²¡æœ‰å¤ªå¤§ä»·å€¼å°±ä¸å±•å¼€äº†ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-css&quot;&gt;.box-position {
    position: relative;
}

.box-example4 {
    position: relative;
    top: 90px;
    left: 90px;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç›¸å…³ä¾‹å­é“¾æ¥ï¼š&lt;a href=&quot;https://ataola.github.io/show/zj/center-middle.html#example4&quot;&gt;https://ataola.github.io/show/zj/center-middle.html#example4&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;çˆ¶å­doubleç›¸--remï¼ˆä¸æ¨èï¼ŒåŒæ¥¼ä¸Šï¼‰&quot;&gt;çˆ¶å­doubleç›¸ + remï¼ˆä¸æ¨èï¼ŒåŒæ¥¼ä¸Šï¼‰&lt;/h4&gt;
&lt;p&gt;æ²¡æœ‰å¤ªå¤§ä»·å€¼ï¼Œç•¥è¿‡ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸å…³ä¾‹å­é“¾æ¥: &lt;a href=&quot;https://ataola.github.io/show/zj/center-middle.html#example5&quot;&gt;https://ataola.github.io/show/zj/center-middle.html#example5&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;çˆ¶ç›¸å­ç»--calc&quot;&gt;çˆ¶ç›¸å­ç» + calc&lt;/h4&gt;
&lt;p&gt;calcè¿™ä¸ªcsså±æ€§å¯ä»¥å…è®¸åœ¨å£°æ˜csså±æ€§å€¼æ—¶æ‰§è¡Œä¸€äº›è®¡ç®—ï¼Œå›åˆ°æˆ‘ä»¬ä¹‹å‰çš„é‚£ä¸ªçŸ«æ­£åç§»é‡çš„æ¨¡å‹ä¸Šï¼Œé‚£ä¹ˆè¿™é‡Œå¾ˆå®¹æ˜“æƒ³åˆ°å­å…ƒç´ &lt;code&gt;topã€left&lt;/code&gt;å±æ€§è®¾ç½®æˆ50%å‡å»å­å…ƒç´ ä¸€åŠçš„è¿™æ ·ä¸€ä¸ªæ¨¡å‹ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-css&quot;&gt;.box-position {
        position: relative;
}
.box-example6 {
    position: absolute;
    top: calc(50% - 100px);
    left: calc(50% - 100px);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç›¸å…³ä¾‹å­é“¾æ¥ï¼š&lt;a href=&quot;https://ataola.github.io/show/zj/center-middle.html#example6&quot;&gt;https://ataola.github.io/show/zj/center-middle.html#example6&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;æ–°æ—§flex&quot;&gt;æ–°æ—§flex&lt;/h4&gt;
&lt;p&gt;flexå¸ƒå±€ï¼Œä½†å‡¡ä¸€ä¸ªæ­£ç»ç‚¹çš„åˆé¢éƒ½ä¼šé‡åˆ°çš„ï¼Œå› ä¸ºå®ƒå¥½ç”¨ä¹Ÿå¾ˆå¸¸ç”¨ï¼Œè¿™é‡Œä»‹ç»ä¸¤ç§ï¼Œä¸€ç§æ˜¯æ–°ç‰ˆçš„flexå¸ƒå±€çš„å†™æ³•ï¼Œä¸€ç§æ˜¯æ—§ç‰ˆçš„flexå¸ƒå±€çš„å†™æ³•&lt;/p&gt;
&lt;p&gt;flexå¸ƒå±€ä½ å°±æŠŠå®ƒçœ‹æˆæ˜¯ä¸€æ¡è½´çº¿ï¼Œä¸€æ¡é•¿å¾—è¿˜æŒºå¤¯å®çš„è½´çº¿ï¼Œåœ¨è¿™æ¡è½´çº¿ä¸Šï¼Œæˆ‘ä»¬æƒ³è¦æ”¾ä¸€ä¸ªç›’å­ï¼Œæœ‰å¾ˆå¤šç§æ”¾æ³•ï¼Œå…·ä½“çš„å¯ä»¥æœä¸‹é˜®ä¸€å³°è€å¸ˆçš„æ•™ç¨‹è¿™é‡Œä¸å†èµ˜è¿°ã€‚ä¸€ä¸ªåŒ–ç¹ä¸ºç®€çš„æƒ³æ³•å“ˆï¼Œè¿™ä¸ªæ˜¯è·Ÿç¦ç‘å“¥å­¦åˆ°çš„ï¼Œå°±æ˜¯æˆ‘ä»¬å¾ˆå¤šæ—¶å€™ä¹Ÿä¸ä¸€å®šèƒ½è®°å¾—ä½é‚£ä¹ˆå¤šå±æ€§ï¼Œæˆ‘ä»¬æœŸæœ›åšè¿™æ ·ä¸€ä»¶äº‹ï¼Œå°±æ˜¯æŠŠå®ƒåŒ–æŠ½è±¡ä¸ºå½¢è±¡ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å…·ä½“çš„æ–¹ä½å»è¡¨è¾¾æˆ‘ä»¬çš„æƒ³æ³•ï¼Œç®€è¨€ä¹‹å°±æ˜¯å°è£…æˆä¸€ä¸ªç±»åº“ï¼Œç„¶åç”¨ä¸€äº›æ¥åœ°æ°”çš„ç±»åå»æ§åˆ¶flexå¸ƒå±€ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰å…´è¶£çš„ç«¥é‹å¯ä»¥çœ‹ä¸‹æˆ‘å®ç°çš„ä¸€ä¸ªä½é…ç‰ˆçš„cssæ ·å¼åº“ï¼š&lt;a href=&quot;https://ataola.github.io/show/box/assets/taolaui/flex.css&quot;&gt;https://ataola.github.io/show/box/assets/taolaui/flex.css&lt;/a&gt;&lt;/p&gt;
&lt;h5 id=&quot;æ–°ç‰ˆflexçš„å†™æ³•&quot;&gt;æ–°ç‰ˆflexçš„å†™æ³•&lt;/h5&gt;
&lt;p&gt;åœ¨ä¸æ”¹å˜è½´æ–¹å‘çš„æƒ…å†µä¸‹ï¼Œå…¶çˆ¶å…ƒç´ è®¾ç½®&lt;code&gt;align-items: center;&lt;/code&gt;è¡¨ç¤ºå‚ç›´å±…ä¸­ï¼Œ&lt;code&gt;justify-content: center;&lt;/code&gt;è¡¨ç¤ºæ°´å¹³å±…ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;çˆ¶å…ƒç´ è®¾ç½®ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-css&quot;&gt;.flex {
    display: flex;
}

.flex-middle {
    align-items: center;
}

.flex-center {
    justify-content: center;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç›¸å…³ä¾‹å­é“¾æ¥ï¼š&lt;a href=&quot;https://ataola.github.io/show/zj/center-middle.html#example7&quot;&gt;https://ataola.github.io/show/zj/center-middle.html#example7&lt;/a&gt;&lt;/p&gt;
&lt;h5 id=&quot;æ—§ç‰ˆflexçš„å†™æ³•&quot;&gt;æ—§ç‰ˆflexçš„å†™æ³•&lt;/h5&gt;
&lt;p&gt;è¿™é‡Œå°±æ˜¯æåŠä¸€ä¸‹æœ‰è¿™ä¹ˆç§å­˜åœ¨ï¼Œè¯»è€…ç”¨æ–°ç‰ˆçš„å†™æ³•å°±å¥½ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-css&quot;&gt;.box-old {
    display: -webkit-box;
    -webkit-box-pack: center;
    -webkit-box-align: center;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç›¸å…³ä¾‹å­é“¾æ¥ï¼š&lt;a href=&quot;https://ataola.github.io/show/zj/center-middle.html#example8&quot;&gt;https://ataola.github.io/show/zj/center-middle.html#example8&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;tableå¸ƒå±€&quot;&gt;tableå¸ƒå±€&lt;/h4&gt;
&lt;p&gt;çˆ¶å…ƒç´ è®¾ç½®&lt;code&gt;display: table&lt;/code&gt;,å­å…ƒç´ è®¾ç½®&lt;code&gt;display:table-cell&lt;/code&gt;ï¼Œåœ¨åªæœ‰ä¸€ä¸ªå­å…ƒç´ çš„æƒ…å†µä¸‹å®ƒä¼šå°½å¯èƒ½æ’‘æ»¡çˆ¶å…ƒç´ ï¼Œå¤šä¸ªå­å…ƒç´ çš„æƒ…å†µä¸‹æ°´å¹³å‡åˆ†ã€‚è®¾ç½®&lt;code&gt;vertical-align: middle&lt;/code&gt;å¯ä»¥ä½¿å¾—å…¶å†…å®¹å‚ç›´å±…ä¸­ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-css&quot;&gt;.box-table {
        display: table;
}

.box-son-table {
    display: table-cell;
    vertical-align: middle;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç›¸å…³ä¾‹å­é“¾æ¥ï¼š&lt;a href=&quot;https://ataola.github.io/show/zj/center-middle.html#example9&quot;&gt;https://ataola.github.io/show/zj/center-middle.html#example9&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;gridå¸ƒå±€&quot;&gt;gridå¸ƒå±€&lt;/h4&gt;
&lt;p&gt;å‰é¢æˆ‘ä»¬æåˆ°çš„flexå¸ƒå±€æ—¶è½´å¸ƒå±€æ˜¯ä¸€ç»´çš„ï¼Œè¿™é‡Œçš„gridç½‘æ ¼å¸ƒå±€æ—¶äºŒç»´çš„æ˜¯å¹³é¢çš„ã€‚å°†å…¶çˆ¶å…ƒç´ è®¾ç½®æˆ&lt;code&gt;displayï¼šgrid&lt;/code&gt;ï¼Œç„¶åå­å…ƒç´ è®¾ç½®&lt;code&gt;align-self: center;&lt;/code&gt;è¡¨ç¤ºå‚ç›´å±…ä¸­ï¼Œ&lt;code&gt;justify-self: center;&lt;/code&gt;è¡¨ç¤ºæ°´å¹³å±…ä¸­ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-css&quot;&gt;.box-grid {
        display: grid;
}

.box-son-grid {
    align-self: center;
    justify-self: center;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç›¸å…³ä¾‹å­é“¾æ¥ï¼š&lt;a href=&quot;https://ataola.github.io/show/zj/center-middle.html#example10&quot;&gt;https://ataola.github.io/show/zj/center-middle.html#example10&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;æœ€å&quot;&gt;æœ€å&lt;/h2&gt;
&lt;p&gt;ç›¸å…³å®ç°åœ°å€å·²å¼€æºï¼š&lt;a href=&quot;https://ataola.github.io/show/zj/center-middle.html%EF%BC%8C%E8%8B%A5%E6%9C%89%E4%B8%8D%E8%B6%B3%E4%B9%8B%E5%A4%84%EF%BC%8C%E4%BE%9B%E6%89%B9%E8%AF%84%E6%8C%87%E6%AD%A3%EF%BC%81&quot;&gt;https://ataola.github.io/show/zj/center-middle.htmlï¼Œè‹¥æœ‰ä¸è¶³ä¹‹å¤„ï¼Œä¾›æ‰¹è¯„æŒ‡æ­£ï¼&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä»–ç½‘é¡µè®¾è®¡åŸºç¡€æ€»ç»“ï¼š&lt;a href=&quot;https://ataola.github.io/show/&quot;&gt;https://ataola.github.io/show/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;å‚è€ƒæ–‡çŒ®&quot;&gt;å‚è€ƒæ–‡çŒ®&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-position&quot;&gt;https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-position&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-repeat&quot;&gt;https://developer.mozilla.org/zh-CN/docs/Web/CSS/background-repeat&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/CSS/calc&quot;&gt;https://developer.mozilla.org/zh-CN/docs/Web/CSS/calc&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-nc-sa/4.0/&quot;&gt;&lt;img alt=&quot;çŸ¥è¯†å…±äº«è®¸å¯åè®®&quot; src=&quot;https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png&quot;/&gt;&lt;/a&gt;&lt;br/&gt;æœ¬ä½œå“é‡‡ç”¨&lt;a rel=&quot;license&quot; href=&quot;http://creativecommons.org/licenses/by-nc-sa/4.0/&quot;&gt;çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®&lt;/a&gt;è¿›è¡Œè®¸å¯ã€‚&lt;/p&gt;
</description>
<pubDate>Mon, 15 Jun 2020 00:25:00 +0000</pubDate>
<dc:creator>ä¸°è‡£æ­£ä¸€</dc:creator>
<og:description>å¯¼è¯­ï¼šå…ƒç´ å±…ä¸­å¯¹é½åœ¨å¾ˆå¤šåœºæ™¯çœ‹ä¸Šå»å¾ˆå’Œè°å¾ˆæ¼‚äº®ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºå‰ç«¯å¼€å‘é¢è¯•è€…çš„åŸºç¡€ä¹Ÿæ˜¯å¾ˆå¥½çš„ä¸€ä¸ªè€ƒå¯Ÿç‚¹ã€‚ä¸‹é¢è·Ÿç€ä½œè€…çš„æ€è·¯ï¼Œä¸€èµ·æ¥çœ‹ä¸‹å§ã€‚ åœºæ™¯åˆ†æ ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒæœ‰å¯èƒ½æœ‰èƒŒæ™¯ï¼Œé‚£æˆ‘è¦å®ƒçš„èƒŒæ™¯å±…ä¸­å¯¹é½</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/cnroadbridge/p/13128943.html</dc:identifier>
</item>
<item>
<title>.Net Coreå¾®æœåŠ¡å…¥é—¨å…¨çºªå½•ï¼ˆä¸‰ï¼‰â€”â€”Consul-æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆä¸‹ï¼‰ - xhznl</title>
<link>http://www.cnblogs.com/xhznl/p/13096891.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/xhznl/p/13096891.html</guid>
<description>&lt;p&gt;ä¸Šä¸€ç¯‡ã€&lt;a href=&quot;https://www.cnblogs.com/xhznl/p/13091750.html&quot;&gt;.Net Coreå¾®æœåŠ¡å…¥é—¨å…¨çºªå½•ï¼ˆäºŒï¼‰â€”â€”Consul-æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆä¸Šï¼‰&lt;/a&gt;ã€‘å·²ç»æˆåŠŸå°†æˆ‘ä»¬çš„æœåŠ¡æ³¨å†Œåˆ°Consulä¸­ï¼Œæ¥ä¸‹æ¥å°±è¯¥å®¢æˆ·ç«¯é€šè¿‡Consulå»åšæœåŠ¡å‘ç°äº†ã€‚&lt;/p&gt;

&lt;p&gt;ServiceHelper.csï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;    public class ServiceHelper : IServiceHelper
    {
        private readonly IConfiguration _configuration;

        public ServiceHelper(IConfiguration configuration)
        {
            _configuration = configuration;
        }

        public async Task&amp;lt;string&amp;gt; GetOrder()
        {
            //string[] serviceUrls = { &quot;http://localhost:9060&quot;, &quot;http://localhost:9061&quot;, &quot;http://localhost:9062&quot; };//è®¢å•æœåŠ¡çš„åœ°å€ï¼Œå¯ä»¥æ”¾åœ¨é…ç½®æ–‡ä»¶æˆ–è€…æ•°æ®åº“ç­‰ç­‰...

            var consulClient = new ConsulClient(c =&amp;gt;
            {
                //consulåœ°å€
                c.Address = new Uri(_configuration[&quot;ConsulSetting:ConsulAddress&quot;]);
            });

            //consulClient.Catalog.Services().Result.Response;
            //consulClient.Agent.Services().Result.Response;
            var services = consulClient.Health.Service(&quot;OrderService&quot;, null, true, null).Result.Response;//å¥åº·çš„æœåŠ¡

            string[] serviceUrls = services.Select(p =&amp;gt; $&quot;http://{p.Service.Address + &quot;:&quot; + p.Service.Port}&quot;).ToArray();//è®¢å•æœåŠ¡åœ°å€åˆ—è¡¨

            if (!serviceUrls.Any())
            {
                return await Task.FromResult(&quot;ã€è®¢å•æœåŠ¡ã€‘æœåŠ¡åˆ—è¡¨ä¸ºç©º&quot;);
            }

            //æ¯æ¬¡éšæœºè®¿é—®ä¸€ä¸ªæœåŠ¡å®ä¾‹
            var Client = new RestClient(serviceUrls[new Random().Next(0, serviceUrls.Length)]);
            var request = new RestRequest(&quot;/orders&quot;, Method.GET);

            var response = await Client.ExecuteAsync(request);
            return response.Content;
        }

        public async Task&amp;lt;string&amp;gt; GetProduct()
        {
            //string[] serviceUrls = { &quot;http://localhost:9050&quot;, &quot;http://localhost:9051&quot;, &quot;http://localhost:9052&quot; };//äº§å“æœåŠ¡çš„åœ°å€ï¼Œå¯ä»¥æ”¾åœ¨é…ç½®æ–‡ä»¶æˆ–è€…æ•°æ®åº“ç­‰ç­‰...

            var consulClient = new ConsulClient(c =&amp;gt;
            {
                //consulåœ°å€
                c.Address = new Uri(_configuration[&quot;ConsulSetting:ConsulAddress&quot;]);
            });

            //consulClient.Catalog.Services().Result.Response;
            //consulClient.Agent.Services().Result.Response;
            var services = consulClient.Health.Service(&quot;ProductService&quot;, null, true, null).Result.Response;//å¥åº·çš„æœåŠ¡

            string[] serviceUrls = services.Select(p =&amp;gt; $&quot;http://{p.Service.Address + &quot;:&quot; + p.Service.Port}&quot;).ToArray();//äº§å“æœåŠ¡åœ°å€åˆ—è¡¨

            if (!serviceUrls.Any())
            {
                return await Task.FromResult(&quot;ã€äº§å“æœåŠ¡ã€‘æœåŠ¡åˆ—è¡¨ä¸ºç©º&quot;);
            }

            //æ¯æ¬¡éšæœºè®¿é—®ä¸€ä¸ªæœåŠ¡å®ä¾‹
            var Client = new RestClient(serviceUrls[new Random().Next(0, serviceUrls.Length)]);
            var request = new RestRequest(&quot;/products&quot;, Method.GET);

            var response = await Client.ExecuteAsync(request);
            return response.Content;
        }
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;appsettings.jsonï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;{
  &quot;Logging&quot;: {
    &quot;LogLevel&quot;: {
      &quot;Default&quot;: &quot;Information&quot;,
      &quot;Microsoft&quot;: &quot;Warning&quot;,
      &quot;Microsoft.Hosting.Lifetime&quot;: &quot;Information&quot;
    }
  },
  &quot;AllowedHosts&quot;: &quot;*&quot;,
  &quot;ConsulSetting&quot;: {
    &quot;ConsulAddress&quot;: &quot;http://localhost:8500&quot;
  }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;OKï¼Œä»¥ä¸Šä»£ç å°±å®Œæˆäº†æœåŠ¡åˆ—è¡¨çš„è·å–ã€‚&lt;/p&gt;
&lt;p&gt;æµè§ˆå™¨æµ‹è¯•ä¸€ä¸‹ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200612223624498-1549106400.gif&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;éšä¾¿åœæ­¢2ä¸ªæœåŠ¡ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200612223955339-1406012739.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ç»§ç»­è®¿é—®ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200612224143276-449242601.gif&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;è¿™æ—¶å€™åœæ­¢çš„æœåŠ¡åœ°å€å°±è·å–ä¸åˆ°äº†ï¼Œå®¢æˆ·ç«¯ä¾ç„¶æ­£å¸¸è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ—¶å€™è§£å†³äº†æœåŠ¡çš„å‘ç°ï¼Œæ–°çš„é—®é¢˜åˆæ¥äº†...&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å®¢æˆ·ç«¯æ¯æ¬¡è¦è°ƒç”¨æœåŠ¡ï¼Œéƒ½å…ˆå»Consulè·å–ä¸€ä¸‹åœ°å€ï¼Œè¿™ä¸ä»…æµªè´¹èµ„æºï¼Œè¿˜å¢åŠ äº†è¯·æ±‚çš„å“åº”æ—¶é—´ï¼Œè¿™æ˜¾ç„¶è®©äººæ— æ³•æ¥å—ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;é‚£ä¹ˆæ€ä¹ˆä¿è¯ä¸è¦æ¯æ¬¡è¯·æ±‚éƒ½å»Consulè·å–åœ°å€ï¼ŒåŒæ—¶åˆè¦æ‹¿åˆ°å¯ç”¨çš„åœ°å€åˆ—è¡¨å‘¢ï¼Ÿ&lt;br/&gt;Consulæä¾›çš„è§£å†³æ–¹æ¡ˆï¼šâ€”â€”Blocking Queries ï¼ˆé˜»å¡çš„è¯·æ±‚ï¼‰ã€‚è¯¦æƒ…è¯·è§å®˜ç½‘ï¼š&lt;a href=&quot;https://www.consul.io/api-docs/features/blocking&quot;&gt;https://www.consul.io/api-docs/features/blocking&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Œç®€å•æ¥è¯´å°±æ˜¯å½“å®¢æˆ·ç«¯è¯·æ±‚Consulè·å–åœ°å€åˆ—è¡¨æ—¶ï¼Œéœ€è¦æºå¸¦ä¸€ä¸ªç‰ˆæœ¬å·ä¿¡æ¯ï¼ŒConsulä¼šæ¯”è¾ƒè¿™ä¸ªå®¢æˆ·ç«¯ç‰ˆæœ¬å·æ˜¯å¦å’ŒConsulæœåŠ¡ç«¯çš„ç‰ˆæœ¬å·ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™Consulä¼šé˜»å¡è¿™ä¸ªè¯·æ±‚ï¼Œç›´åˆ°Consulä¸­çš„æœåŠ¡åˆ—è¡¨å‘ç”Ÿå˜åŒ–ï¼Œæˆ–è€…åˆ°è¾¾é˜»å¡æ—¶é—´ä¸Šé™ï¼›å¦‚æœç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œåˆ™ç«‹å³è¿”å›ã€‚è¿™ä¸ªé˜»å¡æ—¶é—´é»˜è®¤æ˜¯5åˆ†é’Ÿï¼Œæ”¯æŒè‡ªå®šä¹‰ã€‚&lt;br/&gt;é‚£ä¹ˆæˆ‘ä»¬å¦å¤–å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å»å¹²è¿™ä»¶äº‹æƒ…ï¼Œå°±ä¸ä¼šå½±å“æ¯æ¬¡çš„ç”¨æˆ·è¯·æ±‚äº†ã€‚è¿™æ ·æ—¢ä¿è¯äº†å®¢æˆ·ç«¯æœåŠ¡åˆ—è¡¨çš„å‡†ç¡®æ€§ï¼ŒåˆèŠ‚çº¦äº†å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡åˆ—è¡¨çš„æ¬¡æ•°ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ç»§ç»­æ”¹é€ ä»£ç ï¼š&lt;br/&gt;IServiceHelperå¢åŠ ä¸€ä¸ªè·å–æœåŠ¡åˆ—è¡¨çš„æ¥å£æ–¹æ³•ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;pre&gt;
&lt;code&gt;    public interface IServiceHelper
    {
        /// &amp;lt;summary&amp;gt;
        /// è·å–äº§å“æ•°æ®
        /// &amp;lt;/summary&amp;gt;
        /// &amp;lt;returns&amp;gt;&amp;lt;/returns&amp;gt;
        Task&amp;lt;string&amp;gt; GetProduct();

        /// &amp;lt;summary&amp;gt;
        /// è·å–è®¢å•æ•°æ®
        /// &amp;lt;/summary&amp;gt;
        /// &amp;lt;returns&amp;gt;&amp;lt;/returns&amp;gt;
        Task&amp;lt;string&amp;gt; GetOrder();

        /// &amp;lt;summary&amp;gt;
        /// è·å–æœåŠ¡åˆ—è¡¨
        /// &amp;lt;/summary&amp;gt;
        void GetServices();
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ServiceHelperå®ç°æ¥å£ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;    public class ServiceHelper : IServiceHelper
    {
        private readonly IConfiguration _configuration;
        private readonly ConsulClient _consulClient;
        private ConcurrentBag&amp;lt;string&amp;gt; _orderServiceUrls;
        private ConcurrentBag&amp;lt;string&amp;gt; _productServiceUrls;

        public ServiceHelper(IConfiguration configuration)
        {
            _configuration = configuration;
            _consulClient = new ConsulClient(c =&amp;gt;
            {
                //consulåœ°å€
                c.Address = new Uri(_configuration[&quot;ConsulSetting:ConsulAddress&quot;]);
            });
        }

        public async Task&amp;lt;string&amp;gt; GetOrder()
        {
            if (_productServiceUrls == null)
                return await Task.FromResult(&quot;ã€è®¢å•æœåŠ¡ã€‘æ­£åœ¨åˆå§‹åŒ–æœåŠ¡åˆ—è¡¨...&quot;);

            //æ¯æ¬¡éšæœºè®¿é—®ä¸€ä¸ªæœåŠ¡å®ä¾‹
            var Client = new RestClient(_orderServiceUrls.ElementAt(new Random().Next(0, _orderServiceUrls.Count())));
            var request = new RestRequest(&quot;/orders&quot;, Method.GET);

            var response = await Client.ExecuteAsync(request);
            return response.Content;
        }

        public async Task&amp;lt;string&amp;gt; GetProduct()
        {
            if(_productServiceUrls == null)
                return await Task.FromResult(&quot;ã€äº§å“æœåŠ¡ã€‘æ­£åœ¨åˆå§‹åŒ–æœåŠ¡åˆ—è¡¨...&quot;);

            //æ¯æ¬¡éšæœºè®¿é—®ä¸€ä¸ªæœåŠ¡å®ä¾‹
            var Client = new RestClient(_productServiceUrls.ElementAt(new Random().Next(0, _productServiceUrls.Count())));
            var request = new RestRequest(&quot;/products&quot;, Method.GET);

            var response = await Client.ExecuteAsync(request);
            return response.Content;
        }

        public void GetServices()
        {
            var serviceNames = new string[] { &quot;OrderService&quot;, &quot;ProductService&quot; };
            Array.ForEach(serviceNames, p =&amp;gt;
            {
                Task.Run(() =&amp;gt;
                {
                    //WaitTimeé»˜è®¤ä¸º5åˆ†é’Ÿ
                    var queryOptions = new QueryOptions { WaitTime = TimeSpan.FromMinutes(10) };
                    while (true)
                    {
                        GetServices(queryOptions, p);
                    }
                });
            });
        }
        private void GetServices(QueryOptions queryOptions, string serviceName)
        {
            var res = _consulClient.Health.Service(serviceName, null, true, queryOptions).Result;
            
            //æ§åˆ¶å°æ‰“å°ä¸€ä¸‹è·å–æœåŠ¡åˆ—è¡¨çš„å“åº”æ—¶é—´ç­‰ä¿¡æ¯
            Console.WriteLine($&quot;{DateTime.Now}è·å–{serviceName}ï¼šqueryOptions.WaitIndexï¼š{queryOptions.WaitIndex}  LastIndexï¼š{res.LastIndex}&quot;);

            //ç‰ˆæœ¬å·ä¸ä¸€è‡´ è¯´æ˜æœåŠ¡åˆ—è¡¨å‘ç”Ÿäº†å˜åŒ–
            if (queryOptions.WaitIndex != res.LastIndex)
            {
                queryOptions.WaitIndex = res.LastIndex;

                //æœåŠ¡åœ°å€åˆ—è¡¨
                var serviceUrls = res.Response.Select(p =&amp;gt; $&quot;http://{p.Service.Address + &quot;:&quot; + p.Service.Port}&quot;).ToArray();

                if (serviceName == &quot;OrderService&quot;)
                    _orderServiceUrls = new ConcurrentBag&amp;lt;string&amp;gt;(serviceUrls);
                else if (serviceName == &quot;ProductService&quot;)
                    _productServiceUrls = new ConcurrentBag&amp;lt;string&amp;gt;(serviceUrls);
            }
        }
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Startupçš„Configureæ–¹æ³•ä¸­è°ƒç”¨ä¸€ä¸‹è·å–æœåŠ¡åˆ—è¡¨ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;        public void Configure(IApplicationBuilder app, IWebHostEnvironment env, IServiceHelper serviceHelper)
        {
            if (env.IsDevelopment())
            {
                app.UseDeveloperExceptionPage();
            }
            else
            {
                app.UseExceptionHandler(&quot;/Home/Error&quot;);
            }
            app.UseStaticFiles();

            app.UseRouting();

            app.UseAuthorization();

            app.UseEndpoints(endpoints =&amp;gt;
            {
                endpoints.MapControllerRoute(
                    name: &quot;default&quot;,
                    pattern: &quot;{controller=Home}/{action=Index}/{id?}&quot;);
            });

            //ç¨‹åºå¯åŠ¨æ—¶ è·å–æœåŠ¡åˆ—è¡¨
            serviceHelper.GetServices();
        }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä»£ç å®Œæˆï¼Œè¿è¡Œæµ‹è¯•ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200613081207554-1589906564.gif&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;ç°åœ¨ä¸ç”¨æ¯æ¬¡å…ˆè¯·æ±‚æœåŠ¡åˆ—è¡¨äº†ï¼Œæ˜¯ä¸æ˜¯æµç•…å¤šäº†ï¼Ÿ&lt;/p&gt;
&lt;p&gt;çœ‹ä¸€ä¸‹æ§åˆ¶å°æ‰“å°ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200613074917304-1731280476.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ—¶å€™å¦‚æœæœåŠ¡åˆ—è¡¨æ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„è¯ï¼Œè·å–æœåŠ¡åˆ—è¡¨çš„è¯·æ±‚ä¼šä¸€ç›´é˜»å¡åˆ°æˆ‘ä»¬è®¾ç½®çš„10åˆ†é’Ÿã€‚&lt;/p&gt;
&lt;p&gt;éšä¾¿åœæ­¢2ä¸ªæœåŠ¡ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200613075035183-1531572636.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200613075115105-2055578034.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;è¿™æ—¶å€™å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®è¢«ç«‹é©¬è¿”å›äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/610959/202006/610959-20200613081009885-649972258.gif&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;ç»§ç»­è®¿é—®å®¢æˆ·ç«¯ç½‘ç«™ï¼ŒåŒæ ·æµç•…ã€‚&lt;br/&gt;ï¼ˆgifå›¾ä¼ çš„æœ‰ç‚¹é—®é¢˜ã€‚ã€‚ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;è‡³æ­¤ï¼Œæˆ‘ä»¬å°±é€šè¿‡Consulå®Œæˆäº†æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚&lt;br/&gt;æ¥ä¸‹æ¥åˆå¼•å‘æ–°çš„æ€è€ƒã€‚ã€‚ã€‚&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;æ¯ä¸ªå®¢æˆ·ç«¯ç³»ç»Ÿéƒ½å»ç»´æŠ¤è¿™ä¸€å †æœåŠ¡åœ°å€ï¼Œåˆç†å—ï¼Ÿ&lt;/li&gt;
&lt;li&gt;æœåŠ¡çš„ipç«¯å£ç›´æ¥æš´éœ²ç»™æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œå®‰å…¨å—ï¼Ÿ&lt;/li&gt;
&lt;li&gt;è¿™ç§æ¨¡å¼ä¸‹æ€ä¹ˆåšåˆ°å®¢æˆ·ç«¯çš„ç»Ÿä¸€ç®¡ç†å‘¢ï¼Ÿ&lt;br/&gt;...&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;ä»£ç æ”¾åœ¨ï¼š&lt;a href=&quot;https://github.com/xiajingren/NetCoreMicroserviceDemo&quot;&gt;https://github.com/xiajingren/NetCoreMicroserviceDemo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœªå®Œå¾…ç»­...&lt;/p&gt;
</description>
<pubDate>Mon, 15 Jun 2020 00:17:00 +0000</pubDate>
<dc:creator>xhznl</dc:creator>
<og:description>å‰è¨€ ä¸Šä¸€ç¯‡ã€.Net Coreå¾®æœåŠ¡å…¥é—¨å…¨çºªå½•ï¼ˆäºŒï¼‰â€”â€”Consul-æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆä¸Šï¼‰ã€‘å·²ç»æˆåŠŸå°†æˆ‘ä»¬çš„æœåŠ¡æ³¨å†Œåˆ°Consulä¸­ï¼Œæ¥ä¸‹æ¥å°±è¯¥å®¢æˆ·ç«¯é€šè¿‡Consulå»åšæœåŠ¡å‘ç°äº†ã€‚ æœåŠ¡å‘ç° åŒæ ·</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/xhznl/p/13096891.html</dc:identifier>
</item>
<item>
<title>foreach é›†åˆåˆæŠ›ç»å…¸å¼‚å¸¸äº†ï¼Œè¿™æ¬¡ä¸€å®šè¦åˆ¨æ ¹é—®åº• - ä¸€çº¿ç å†œ</title>
<link>http://www.cnblogs.com/huangxincheng/p/13128901.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/huangxincheng/p/13128901.html</guid>
<description>&lt;h2 id=&quot;ä¸€ï¼šèƒŒæ™¯&quot;&gt;ä¸€ï¼šèƒŒæ™¯&lt;/h2&gt;
&lt;h3 id=&quot;1-è®²æ•…äº‹&quot;&gt;1. è®²æ•…äº‹&lt;/h3&gt;
&lt;p&gt;æœ€è¿‘åŒäº‹åœ¨å†™ä¸€æ®µä¸šåŠ¡é€»è¾‘çš„æ—¶å€™ï¼Œç¨‹åºè·‘èµ·æ¥æ€»æ˜¯æŠ¥ï¼š&lt;strong&gt;&lt;code&gt;é›†åˆå·²ä¿®æ”¹ï¼›å¯èƒ½æ— æ³•æ‰§è¡Œæšä¸¾æ“ä½œ&lt;/code&gt;&lt;/strong&gt;ï¼Œç¡¬æ˜¯æ²¡æœ‰æ‰¾åˆ°ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´è¿™ä¸ªå¼‚å¸¸äº§ç”Ÿï¼Œå°±è®©æˆ‘æ¥æ‰¾ä¸€ä¸‹bugï¼Œå…¶å®è¿™ä¸ªå¼‚å¸¸åœ¨åº§çš„æ¯ä¸ªç¨‹åºå‘˜å‡ ä¹éƒ½é‡åˆ°è¿‡ï¼Œè°ä¹Ÿä¸æ˜¯ä¸€ç”Ÿä¸‹å°±æ˜¯å¤§ç‰›ï¼Œç®€å•çœ‹äº†ä¸‹ä»£ç ï¼Œç¡®å®æ˜¯å¤šçº¿ç¨‹æ“ä½œforeachï¼Œä½†å¹¶æ²¡æœ‰å¯¹foreachè¿›è¡ŒAddï¼ŒRemoveæ“ä½œï¼Œæ‰«å®Œä»£ç å…¶å®æˆ‘ä¹Ÿæ˜¯æœ‰ç‚¹æ‡µï¼Œæ²¡æ’¤åªèƒ½è°ƒè¯•äº†ï¼Œåœ¨foreaché‡Œå¥—ä¸€å±‚trycatchï¼ŒæŸ¥çœ‹å¼‚å¸¸çš„çº¿ç¨‹å †æ ˆä»è€Œæ‰¾å‡ºäº†é—®é¢˜ä»£ç ï¼Œä»£ç ç®€åŒ–å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C#&quot;&gt;
        static void Main(string[] args)
        {
            var dict = new Dictionary&amp;lt;int, int&amp;gt;()
            {
                [1001] = 1,
                [1002] = 10,
                [1003] = 20
            };

            foreach (var userid in dict.Keys)
            {
                dict[userid] = dict[userid] + 1;
            }
        }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å…ˆå¯»æ‰¾ç‚¹å®‰æ…°ï¼Œè¯´å®è¯ï¼Œå‡­è‚‰çœ¼ä½ è§‰å¾—è¿™æ®µä»£ç ä¼šæŠ›å‡ºå¼‚å¸¸å—ï¼Ÿ åæ­£æˆ‘æ˜¯è¢«éª—è¿‡äº†ï¼Œå¤§å†™çš„å°´å°¬ï¼Œç»“è®ºå¦‚ä¸‹ï¼Œè¿è¡Œä¸€ä¸‹ä¾¿çŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/214741/202006/214741-20200615074829011-1123958279.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­çœ‹ç¡®å®æ˜¯å¼‚å¸¸ï¼Œè¯´æ˜åœ¨foreachçš„è¿‡ç¨‹ä¸­è¿è¿­ä»£é›†åˆçš„ value éƒ½ä¸å¯ä»¥ä¿®æ”¹ï¼Œè¿™è®©æˆ‘æ¿€èµ·äº†å¼ºçƒˆçš„æ¢ç´¢æ¬²ï¼Œçœ‹çœ‹FCLä¸­åˆ°åº•æ˜¯æ€ä¹ˆé™åˆ¶çš„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;äºŒï¼šæºç æ¢ç´¢&quot;&gt;äºŒï¼šæºç æ¢ç´¢&lt;/h2&gt;
&lt;h3 id=&quot;1-ä»ilä¸­å¯»æ‰¾ç­”æ¡ˆ&quot;&gt;1. ä»ILä¸­å¯»æ‰¾ç­”æ¡ˆ&lt;/h3&gt;
&lt;p&gt;C#å·²å‘å±•åˆ° &lt;code&gt;9.0&lt;/code&gt; äº†ï¼Œåˆ°å¤„éƒ½å……æ–¥ç€è¯­æ³•ç³–ï¼Œæœ‰æ—¶å€™ä¸çœ‹ä¸€ä¸‹åº•å±‚çš„ILéƒ½ä¸çŸ¥é“åˆ°åº•æ˜¯è½¬åŒ–æˆäº†ä»€ä¹ˆï¼Œæ‰€ä»¥è¿™ä¸ªæ˜¯å¿…é¡»çš„ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C#&quot;&gt;
        IL_000d: callvirt instance void class [System.Collections]System.Collections.Generic.Dictionary`2&amp;lt;int32, int32&amp;gt;::set_Item(!0, !1)
        IL_001b: callvirt instance void class [System.Collections]System.Collections.Generic.Dictionary`2&amp;lt;int32, int32&amp;gt;::set_Item(!0, !1)
        IL_0029: callvirt instance void class [System.Collections]System.Collections.Generic.Dictionary`2&amp;lt;int32, int32&amp;gt;::set_Item(!0, !1)
        IL_0037: callvirt instance valuetype [System.Collections]System.Collections.Generic.Dictionary`2/KeyCollection/Enumerator&amp;lt;!0, !1&amp;gt; class [System.Collections]System.Collections.Generic.Dictionary`2/KeyCollection&amp;lt;int32, int32&amp;gt;::GetEnumerator()

        .try
        {
                IL_003d: br.s IL_005a
                // loop start (head: IL_005a)
                        IL_003f: ldloca.s 1
                        IL_0041: call instance !0 valuetype [System.Collections]System.Collections.Generic.Dictionary`2/KeyCollection/Enumerator&amp;lt;int32, int32&amp;gt;::get_Current()
                        IL_004c: callvirt instance !1 class [System.Collections]System.Collections.Generic.Dictionary`2&amp;lt;int32, int32&amp;gt;::get_Item(!0)
                        IL_0053: callvirt instance void class [System.Collections]System.Collections.Generic.Dictionary`2&amp;lt;int32, int32&amp;gt;::set_Item(!0, !1)
                        IL_005a: ldloca.s 1
                        IL_005c: call instance bool valuetype [System.Collections]System.Collections.Generic.Dictionary`2/KeyCollection/Enumerator&amp;lt;int32, int32&amp;gt;::MoveNext()
                        IL_0061: brtrue.s IL_003f
                // end loop

                IL_0063: leave.s IL_0074
        } // end .try
        finally
        {

        } // end handler    

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä»ILä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå…ˆæ‰§è¡Œäº†ä¸‰æ¬¡å­—å…¸çš„ç´¢å¼•å™¨æ“ä½œï¼Œç„¶åè°ƒç”¨äº† &lt;code&gt;Dictionary.GetEnumerator&lt;/code&gt; æ¥ç”Ÿæˆå­—å…¸çš„è¿­ä»£ç±»ï¼Œè¿™æ€è·¯å°±éå¸¸æ¸…æ™°äº†ï¼Œç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸‹ç±»ç´¢å¼•å™¨éƒ½åšäº†äº›ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/214741/202006/214741-20200615074829376-163944539.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€æ¬¡çš„ç´¢å¼•å™¨æ“ä½œï¼Œè¿™é‡Œéƒ½æ‰§è¡Œäº†version++ï¼Œæ‰€ä»¥å­—å…¸åˆå§‹åŒ–å®Œæˆä¹‹åï¼Œè¿™é‡Œçš„ &lt;code&gt;version=3&lt;/code&gt;ï¼Œæ²¡æœ‰é—®é¢˜å§ï¼Œç„¶åç»§ç»­çœ‹ä»£ç ï¼Œå¯»æ‰¾ &lt;code&gt;Dictionary.GetEnumerator&lt;/code&gt; æ–¹æ³•å¯åŠ¨è¿­ä»£ç±»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/214741/202006/214741-20200615074832312-247049188.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šé¢ä»£ç çš„ &lt;code&gt;_version = dictionary._version;&lt;/code&gt; ä¸€å®šè¦çœ‹ä»”ç»†äº†ï¼Œåœ¨å¯åŠ¨è¿­ä»£ç±»çš„æ—¶å€™è®°å½•äº†å½“æ—¶å­—å…¸çš„ç‰ˆæœ¬å·ï¼Œä¹Ÿå°±æ˜¯&lt;code&gt;_version=3&lt;/code&gt;ï¼Œç„¶åç»§ç»­æ¢ç´¢moveNextæ–¹æ³•å¹²äº†ä»€ä¹ˆï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/214741/202006/214741-20200615074832824-1842158121.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå½“æ¯æ¬¡æ‰§è¡ŒmoveNextçš„è¿‡ç¨‹ä¸­ï¼Œéƒ½ä¼šåˆ¤æ–­ä¸€ä¸‹å­—å…¸çš„ version å’Œ å½“åˆåˆå§‹åŒ–è¿­ä»£ç±»ä¸­çš„version ç‰ˆæœ¬å·æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´å°±æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥è¿™è¡Œä»£ç å°±æ˜¯ç‚¹ç›ä¹‹ç¬”äº†ï¼Œå½“åœ¨foreachä½“ä¸­æ‰§è¡Œäº† &lt;code&gt;dict[userid] = dict[userid] + 1;&lt;/code&gt; è¯­å¥ï¼Œç›¸å½“äºåˆæ‰§è¡Œäº†ä¸€æ¬¡ç±»ç´¢å¼•å™¨æ“ä½œï¼Œè¿™æ—¶å€™å­—å…¸çš„versionå°±å˜æˆ 4 äº†ï¼Œè€Œå½“åˆåˆå§‹åŒ–è¿­ä»£ç±»çš„æ—¶å€™è¿˜æ˜¯3ï¼Œè‡ªç„¶ä¸‹ä¸€æ¬¡æ‰§è¡Œ moveNext å°±æ˜¯ &lt;code&gt;3 != 4&lt;/code&gt; æŠ›å‡ºå¼‚å¸¸äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ éè¦è®©æˆ‘è¯æ˜ç»™ä½ çœ‹ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨dnspyç›´æ¥è°ƒè¯•æºç ï¼Œåœ¨å¼‚å¸¸é‚£é‡Œä¸‹ä¸€ä¸ªæ–­ç‚¹å†æŸ¥çœ‹ä¸¤ä¸ªversionç‰ˆæœ¬å·ä¸å°±çŸ¥é“å•¦ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/214741/202006/214741-20200615074833131-1656709659.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-é¢å¯¹ç–¾é£&quot;&gt;2. é¢å¯¹ç–¾é£&lt;/h3&gt;
&lt;p&gt;æœ‰äº›æœ‹å‹å¯èƒ½è¦è¯´ï¼Œç å†œä»Šå¤©åˆ†äº«çš„è¿™ç¯‡ä¸€ç‚¹æ°´å‡†éƒ½æ²¡æœ‰ï¼Œæˆ‘18å¹´å‰å°±çŸ¥é“å­—å…¸æ˜¯ä¸èƒ½åŠ¨æ€ä¿®æ”¹çš„ï¼Œè¿˜åˆ†æçš„å¤´å¤´æ˜¯åŠ²ğŸ˜ğŸ˜ğŸ˜ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æˆ‘æœ‰è¯è¦è¯´ï¼Œè¿™ä¸ªè¿˜ç¡®å®æ˜¯æˆ‘çš„ä¸€ä¸ªç›²åŒºï¼Œå¹³æ—¶åœ¨è¿­ä»£å­—å…¸çš„æ—¶å€™valueä¸€èˆ¬éƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼ŒåŠ¨æ€ä¿®æ”¹å¼•ç”¨ç±»å‹çš„å€¼è‡ªç„¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œè¿™æ˜¯å› ä¸ºä½ ä¸ç®¡æ€ä¹ˆä¿®æ”¹éƒ½ä¸ä¼šæ”¹å˜ &lt;code&gt;_version&lt;/code&gt; ç‰ˆæœ¬å·ï¼Œ&lt;span&gt;ä½†è´¨ç–‘æˆ‘çš„ä¹Ÿä¸è¦æŠŠè¯è¯´çš„å¤ªæ»¡ï¼Œå› ä¸ºè¿™ç§æ“ä½œæ˜¯éå¸¸è¯­ä¹‰åŒ–éå¸¸å¤§ä¼—çš„éœ€æ±‚ï¼Œä½ èƒ½ä¿è¯åé¢netç‰ˆæœ¬ä¸æ”¯æŒè¿™ä¸ªå—ï¼Ÿï¼Ÿï¼Ÿ&lt;/span&gt; å¦‚æœä½ è¯´ä¸å¯èƒ½ï¼Œé‚£æ­å–œä½ ï¼Œè¢«æˆ‘å¸¦åˆ°å‘é‡Œé¢å»å•¦ã€‚ğŸ˜„ğŸ˜„ğŸ˜„&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ç”¨åŸå°ä¸åŠ¨çš„ä»£ç åœ¨ &lt;code&gt;.net 5&lt;/code&gt; ä¸‹è·‘ä¸€æ¬¡ï¼Œçå¤§çœ¼ç›å¥½å¥½çœ‹å“¦~~~&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/214741/202006/214741-20200615074833452-1474810854.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æƒŠè®¶å§, å±…ç„¶åœ¨ &lt;code&gt;.Net 5&lt;/code&gt; ä¸­å¯ä»¥çš„ï¼Œæ¥ä¸‹æ¥ç”¨ILSpyå»æŸ¥æŸ¥åº•å±‚æºç ï¼Œ.netcore 3.1 å’Œ net5 ä¸­åˆ†åˆ«å¯¹ ç±»ç´¢å¼•å™¨ éƒ½åšäº†å•¥ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;netcore 3.1&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;Pathï¼š C:\Program Files\dotnet\shared\Microsoft.NETCore.App\3.1.2\System.Private.CoreLib.dll&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/214741/202006/214741-20200615074833713-305626603.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;Pathï¼š C:\Program Files\dotnet\shared\Microsoft.NETCore.App\5.0.0-preview.5.20278.1\System.Private.CoreLib.dll&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/214741/202006/214741-20200615074833959-890322334.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¯¹æ¯”ä¸¤å¼ å›¾ä½ ä¼šå‘ç° &lt;code&gt;.Net5&lt;/code&gt; ä¸­å¹¶æ²¡æœ‰åš &lt;code&gt;_version++&lt;/code&gt; æ“ä½œï¼Œè¿™å°±ğŸ®ğŸ‘ƒäº†ï¼Œå¦‚æœä½ å†ç»†è¯»ä»£ç ï¼Œä½ è¿˜å‘ç° .Net5 å¯¹å­—å…¸è¿›è¡Œäº†è¾ƒå¤§å¹…åº¦çš„ä¼˜åŒ–ï¼Œå“ˆå“ˆï¼Œå½“åˆåœ¨ &lt;code&gt;.Net5&lt;/code&gt; ä¹‹å‰äº§ç”Ÿçš„é”™è¯¯ï¼Œåœ¨ &lt;code&gt;.Net5&lt;/code&gt; ä¸­å±…ç„¶æ²¡æœ‰å•¦!&lt;/p&gt;
&lt;h2 id=&quot;å››ï¼š-æ€»ç»“&quot;&gt;å››ï¼š æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æºç é¢å‰ï¼Œä¸è°ˆéšç§ï¼Œæ²¡äº‹å¤šç¿»ç¿»æºç ï¼Œæœ‰å¯èƒ½è¿˜æœ‰æ„å¤–æ”¶è·ï¼Œæ¯”å¦‚åœ¨ &lt;code&gt;.Net 5&lt;/code&gt;ä¸‹çš„è¿™ç‚¹æ–°å‘ç°ï¼Œ&lt;span&gt;å¯èƒ½è¿˜æ˜¯å…¨ç½‘ç¬¬ä¸€ä¸ªå“¦&lt;/span&gt;ï¼Œè¿™è¦æ˜¯ä¸¤ä¸ªå¤§ç‰›äº‰åµï¼Œè®©å°ç™½å»ç›¸ä¿¡è°å‘¢ï¼Œå˜¿å˜¿ï¼Œæºç æ‰æ˜¯çœŸæ­£çš„ä¸“å®¶~&lt;/p&gt;
&lt;hr/&gt;&lt;h3 id=&quot;å¦‚æ‚¨æœ‰æ›´å¤šé—®é¢˜ä¸æˆ‘äº’åŠ¨ï¼Œæ‰«æä¸‹æ–¹è¿›æ¥å§&quot;&gt;å¦‚æ‚¨æœ‰æ›´å¤šé—®é¢˜ä¸æˆ‘äº’åŠ¨ï¼Œæ‰«æä¸‹æ–¹è¿›æ¥å§~&lt;/h3&gt;
&lt;hr/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/214741/202005/214741-20200522143723695-575216767.png&quot; width=&quot;600&quot; height=&quot;200&quot; alt=&quot;å›¾ç‰‡åç§°&quot; align=&quot;center&quot;/&gt;</description>
<pubDate>Sun, 14 Jun 2020 23:49:00 +0000</pubDate>
<dc:creator>ä¸€çº¿ç å†œ</dc:creator>
<og:description>ä¸€ï¼šèƒŒæ™¯ 1. è®²æ•…äº‹ æœ€è¿‘åŒäº‹åœ¨å†™ä¸€æ®µä¸šåŠ¡é€»è¾‘çš„æ—¶å€™ï¼Œç¨‹åºè·‘èµ·æ¥æ€»æ˜¯æŠ¥ï¼šé›†åˆå·²ä¿®æ”¹ï¼›å¯èƒ½æ— æ³•æ‰§è¡Œæšä¸¾æ“ä½œï¼Œç¡¬æ˜¯æ²¡æœ‰æ‰¾åˆ°ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´è¿™ä¸ªå¼‚å¸¸äº§ç”Ÿï¼Œå°±è®©æˆ‘æ¥æ‰¾ä¸€ä¸‹bugï¼Œå…¶å®è¿™ä¸ªå¼‚å¸¸åœ¨åº§çš„æ¯ä¸ªç¨‹åºå‘˜</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/huangxincheng/p/13128901.html</dc:identifier>
</item>
<item>
<title>[.NET å¼€æº] é«˜æ€§èƒ½çš„ Swifter.MessagePack å·²å‘å¸ƒï¼Œå¹¶é™„å¸¦æ–°ç‰ˆæœ¬çš„ Swifter.Json å’Œ Swifter.Dataã€‚ - é™ˆé‘«ä¼Ÿ</title>
<link>http://www.cnblogs.com/Dogwei/p/12915046.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/Dogwei/p/12915046.html</guid>
<description>&lt;p&gt;&lt;span&gt;æŠ±æ­‰å„ä½æœ‹å‹ï¼Œç”±äºå„ç§ç§äº‹å…¬äº‹ï¼Œæœ¬åº”è¯¥åœ¨ 19 å¹´åº•å‘å¸ƒçš„ Swifter.MessagePack åº“å»¶è¿Ÿäº†è¿™ä¹ˆä¹…æ‰å‘å¸ƒï¼Œæˆ‘æ·±æ„ŸæŠ±æ­‰ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1527310/202006/1527310-20200615002922857-1319139358.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;MsgPack ç®€ä»‹&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;MsgPack ä¸€ç§éå¸¸è½»å·§çš„äºŒè¿›åˆ¶æ•°æ®äº¤æ¢æ ¼å¼ï¼Œå·§å¦™çš„è®¾è®¡è®©å®ƒç›¸æ¯”å…¶ä»–äºŒè¿›åˆ¶æ•°æ®æ ¼å¼æ›´å¯è¯»ï¼Œå¹¶ä¸”æœ‰ç€ä¸é”™çš„å‹ç¼©ç‡å’Œé€»è¾‘æ€§èƒ½ï¼Œæ˜¯ç›®å‰ç›¸å½“ç«çƒ­çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Swifter.MessagePack éµå¾ªÂ MsgPack æ–°çš„è§„èŒƒå®ç°ï¼›ç›¸æ¯” .NET å…¶ä»–Â MsgPack åºåˆ—åŒ–åº“ï¼ŒSwifter.MessagePack æœ‰ç€æ›´å¥½çš„æ€§èƒ½ï¼Œç”Ÿæˆçš„å†…å®¹æ›´ç´§å‡‘åˆç†ä¸”æ›´ç®€å•æ˜“ç”¨ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Nugetï¼š&lt;span&gt;&lt;a href=&quot;https://www.nuget.org/packages/Swifter.MessagePack/&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;Swifter.MessagePack&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;ï¼Œ&lt;a href=&quot;https://www.nuget.org/packages/Swifter.Json/&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;Swifter.Json&lt;/span&gt;&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://www.nuget.org/packages/Swifter.Data/&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;Swifter.Data&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;GitHubï¼š&lt;/span&gt;&lt;span&gt;&lt;a href=&quot;https://github.com/Dogwei/Swifter.MessagePack&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;Swifter.MessagePack&lt;/span&gt;&lt;/a&gt;&lt;span&gt;ï¼Œ&lt;/span&gt;&lt;a href=&quot;https://github.com/Dogwei/Swifter.Json&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;Swifter.Json&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;å¦‚æœæ‚¨æƒ³ä½¿ç”¨ Swifter åº“ï¼Œè¯·åœ¨ Nuget ä¸Šå®‰è£…/ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼Œå¦‚éœ€å•æ–‡ä»¶ç‰ˆæœ¬ï¼Œè¯·è‡ªè¡Œç”Ÿæˆ/åˆå¹¶ã€‚&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;ç®€å•ä½¿ç”¨ Swifter.MessagePack&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1527310/202006/1527310-20200611170238330-1484849950.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;MessagePackFormatter ç±»å†…éƒ¨è¿˜æœ‰&lt;/strong&gt;æ•°&lt;/span&gt;&lt;strong&gt;åä¸ª&lt;/strong&gt;æ–¹æ³•é‡è½½ï¼ŒåŒ…æ‹¬é™æ€å’Œå®ä¾‹æ–¹æ³•&lt;strong&gt;ï¼Œæ€»æœ‰ä¸€äº›é€‚åˆæ‚¨&lt;/strong&gt;ï¼›è¿™äº›æ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;æ›´å¤šä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒæ—©æœŸå…³äº Swifter.Json çš„æ–‡ç« ï¼ŒGitHub æˆ– Wikiï¼›å­¦ä¹ äº¤æµè¿› Swifter çš„ QQ ç¾¤ï¼š&lt;/strong&gt;133630914ï¼ˆæ–°ç¾¤ï¼Œæ¬¢è¿åŠ å…¥ï¼‰ã€‚&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;Swifter æ¡†æ¶çš„ç‰¹æ€§&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(1)Â &lt;/strong&gt;Swifter å¯ä»¥è¿è¡Œåœ¨ .NET Framework 2.0+, .NET Core 2.0+, .NET Standard 2.0+, MONO JIT, MONO AOT,Â Xamarin.Android,Â Xamarin.iOS, Unity JIT ç­‰å¹³å°/è¿è¡Œæ—¶ä¸Šï¼Œ&lt;strong&gt;&lt;span&gt;Unity IL2CPP è¿è¡Œæ—¶ç”±äºæ²¡æœ‰æˆ‘ä»¬æµ‹è¯•ç¯å¢ƒï¼Œä¸çŸ¥å¯å¦æ­£å¸¸è¿è¡Œï¼Œæ›´å¤šä¿¡æ¯è¯·çœ‹ä¸‹é¢çš„ AOT è¯´æ˜&lt;/span&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(2)Â &lt;/strong&gt;Swifter æœ‰ç€æ·±å±‚çš„æŠ½è±¡å°è£…ï¼Œè¿™è™½ç„¶å¸¦æ¥äº†ä¸€äº›æ€§èƒ½å’Œå†…å­˜çš„æŸè€—ï¼Œä½†ä¹Ÿè·å¾—äº†æ›´é«˜çš„æ‰©å±•æ€§ï¼›Swifter.Json/Swifter.MessagePack/Swifter.Data çš„å¯å…¬ç”¨çš„ä»£ç éå¸¸å¤šï¼Œè¿™ä½¿å¾—åœ¨ Swifter ä¸Šå®ç°ä¸€ä¸ªæ–°çš„åºåˆ—åŒ–åº“åªéœ€è¦ç¼–å†™å°‘é‡ä»£ç å³å¯å®ç°ï¼Œè¿™æ˜¯å…¶ä»–æ¡†æ¶éš¾å®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(3)Â &lt;/strong&gt;è™½ç„¶ Swifter æœ‰å¾ˆå¤šæ¥å£å’ŒæŠ½è±¡ç¼–ç¨‹ï¼Œä½†æ˜¯ Swifter å¹¶æ²¡æœ‰å› æ­¤æ¯”å…¶ä»–çš„æ¡†æ¶æ…¢æˆ–å†…å­˜å ç”¨å¤§ï¼Œåæ¯”å®ƒä»¬æ›´å¿«å’Œæ›´å°å†…å­˜å ç”¨ï¼›è¿™æ˜¯å› ä¸º Swifter ä»æ¥éƒ½æ˜¯ä½¿ç”¨æ›´å¥½ç®—æ³•å’Œé€»è¾‘æ¥è·å–æ€§èƒ½ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ›´ç›´æ¥çš„ä»£ç è·å–ç›´æ¥çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(4)Â &lt;/strong&gt;ä½œä¸ºç±»åº“å¼€å‘è€…ï¼Œæˆ‘ä»¬æ·±çŸ¥æ¯ä¸ªäººå¼€å‘å’Œæµ‹è¯•çš„ä¾§é‡ç‚¹éƒ½ä¸ä»–äººä¸ä¸€æ ·ï¼Œè‡ªå·±æ‰¾å‡ºè‡ªå·±çš„é—®é¢˜å¤ªéš¾ï¼Œæ‰€ä»¥ Swifter.Json å’Œ Swifter.MessagePack é™¤äº†æˆ‘ä»¬è‡ªå·±çš„æµ‹è¯•å•å…ƒä¹‹å¤–ï¼Œ è¿˜ &quot;å·&quot; äº† Newtonsoft, Neuecc å’Œ Spanjson çš„ 5000+ ä¸ªæµ‹è¯•å•å…ƒï¼ˆÂ å»é™¤äº† Newtonsoft çš„éƒ¨åˆ†æµ‹è¯•å•å…ƒï¼‰ï¼›ç°å·²æµ‹è¯•é€šè¿‡ 4200+ ä¸ªï¼Œä¸é€šè¿‡ 800+ ä¸ªæ˜¯æˆ‘ä»¬è®¤ä¸ºå¯ä»¥å…è®¸æˆ–æ˜¯æ›´åŠ åˆç†çš„è¡Œä¸ºã€‚ï¼ˆä¸åŠ³è€Œè·çš„æµ‹è¯•å•å…ƒç¡®å®ç”¨ç€å¾ˆçˆ½ï¼Œä½†äº‹å®æ˜¯æˆ‘ä»¬&quot;æ¬&quot;è¿™äº›æµ‹è¯•å•å…ƒç”¨äº† 3 å¤©ğŸ˜«ï¼Œæ— è„‘æ›¿æ¢æ”¹åˆ°æ‰‹æŒ‡æŠ½ç­‹ï¼‰&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;Swifter.Json å’Œ Swifter.MessagePack&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(1)Â &lt;/strong&gt;Swifter.MessagePack å’Œ Swifter.Json ä¸€æ ·ï¼Œéƒ½æœ‰ç€éå¸¸ä¼˜å¼‚çš„æ€§èƒ½å’Œæå°çš„é¢å¤–å†…å­˜åˆ†é…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(2)Â &lt;/strong&gt;Swifter.MessagePack å’Œ Swifter.Json çš„ API å¤§è‡´ç›¸åŒï¼Œå¦‚æœä½¿ç”¨è€…åŒæ—¶ä½¿ç”¨å®ƒä»¬ï¼Œé‚£ä¹ˆå¯ä»¥æå°æˆæœ¬åœ¨å®ƒä»¬ä¹‹é—´åˆ‡æ¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;strong&gt;(3)Â &lt;/strong&gt;&lt;/strong&gt;å¾—ç›Šäº Swifter.Core çš„å¼ºå¤§æ•°æ®æ˜ å°„ï¼ŒSwifter.MessagePack å’Œ Swifter.Json éƒ½åŒæ—¶æ”¯æŒ .NET ä¸Šå¤§å¤šæ•°å¸¸ç”¨çš„æ•°æ®ç»“æ„å’Œç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(4)Â &lt;/strong&gt;Swifter.MessagePack å’Œ Swifter.Json å¯¹é‡å¤å¼•ç”¨çš„å¯¹è±¡çš„è¡¨ç¤ºæ–¹å¼ä¸ä¸€æ ·ï¼Œåœ¨å¼€å¯Â &lt;span&gt;&lt;strong&gt;MultiReferencingReference&lt;/strong&gt;&lt;/span&gt; é…ç½®é¡¹åï¼ŒSwifter.Json å°†ä½¿ç”¨ { &quot;$ref&quot;: &quot;#/obj/1/target&quot; } æ¥è¡¨ç¤ºé‡å¤å¼•ç”¨çš„å¯¹è±¡ï¼Œè€Œ Swifter.MessagePack ä½¿ç”¨å¯¹è±¡åœ¨ MsgPack å†…å®¹çš„åç§»é‡è¡¨ç¤ºé‡å¤å¼•ç”¨çš„å¯¹è±¡ï¼›ç›¸æ¯”ä¹‹ä¸‹ Swifter.MessagePack çš„æ–¹æ¡ˆæ›´ç®€å•æ€§èƒ½æ›´å¿«ï¼Œä½†æ˜¯å¯è¯»æ€§è¾ƒå·®ï¼Œä¸è¿‡è¯´æ¥ MsgPack æœ¬æ¥å°±æ˜¯è¦ä¸“é—¨çš„å·¥å…·æ‰èƒ½é˜…è¯»ğŸ˜„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(5)Â &lt;/strong&gt;Swifter.MessagePack åœ¨åºåˆ—åŒ–åŸºç¡€ç±»å‹æ—¶ï¼Œåœ¨ä¿è¯ç²¾åº¦ä¸ä¸¢å¤±çš„å‰æä¸‹ï¼Œå°†å¤§æ•°æ®ç±»å‹è½¬æ¢ä¸ºæ›´å°æ•°æ®ç±»å‹ï¼Œä»¥å¾—åˆ°æ›´ç´§å‡‘çš„ MsgPack å†…å®¹ï¼ˆå¦‚å°† double 123 è½¬æ¢ä¸º int 123ï¼Œint 123 åªéœ€è¦ 1 ä¸ªå­—èŠ‚å³å¯è¡¨ç¤ºï¼Œå¦‚æœä¸åšè½¬æ¢åˆ™éœ€è¦ 9 ä¸ªå­—èŠ‚è¡¨ç¤ºï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(6)Â &lt;/strong&gt;Swifter.MessagePack åœ¨åºåˆ—åŒ–æœªçŸ¥é•¿åº¦çš„é›†åˆæ—¶ï¼ˆå¦‚ Enumerable&amp;lt;T&amp;gt;ï¼‰ï¼Œä¼šå°†é•¿åº¦å®šä¹‰ä¸ºå››å­—èŠ‚ (FixArray32)ï¼Œç„¶ååœ¨å†™å…¥å®ŒæˆåæŠŠå®é™…é•¿åº¦èµ‹äºˆè¿™å››å­—èŠ‚é•¿åº¦ï¼›è¿™æ ·è™½ç„¶åœ¨è¾ƒçŸ­çš„æœªçŸ¥é•¿åº¦é›†åˆæ—¶ï¼Œå°†äº§ç”Ÿ 1-3 ä¸ª 0ï¼›ä½†æ˜¯è¿™é¿å…äº†å°†æœªçŸ¥é•¿åº¦çš„é›†åˆè½¬æ¢ä¸º List&amp;lt;T&amp;gt; æˆ– T[], è¿™æé«˜äº†æ€§èƒ½ä¹Ÿå‡å°‘äº†å†…å­˜åˆ†é…ï¼Œè¿™æ˜¯ä¸äºçš„ï¼ˆå› ä¸ºæœªçŸ¥é•¿åº¦çš„é›†åˆå¾ˆå¸¸ç”¨ï¼Œå¦‚ Linqï¼ŒDbDataReader ç­‰ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;æ–°ç‰ˆæœ¬åšäº†å•¥ï¼Ÿ&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;&lt;span&gt;(1)&lt;/span&gt; ä¸»è¦æ˜¯è§£å†³äº†å·²çŸ¥ BUGï¼ŒåŒ…æ‹¬äº† Issues ä¸Šæåˆ°çš„å‡ ä¸ªã€‚&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(2)Â &lt;/strong&gt;å…è®¸å°† &lt;span&gt;&quot;&quot;&lt;/span&gt; å€¼è§£æä¸º DateTime, int?, double ç­‰åŸºç¡€ç±»å‹çš„é»˜è®¤å€¼ï¼Œä½†æ˜¯éœ€è¦å¯ç”¨Â EmptyStringAsDefault é…ç½®é¡¹ï¼Œé»˜è®¤æœªå¼€å¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;(3)&lt;/span&gt;Â &lt;/strong&gt;è§£å†³äº† Swifter.Json æµ®ç‚¹æ•°: float, double å¤±çœŸçš„é—®é¢˜&lt;/span&gt;&lt;/strong&gt;ï¼Œå¹¶å¢åŠ äº†Â UseSystemFloatingPointsMethods é…ç½®é¡¹ä½¿ç”¨ç³»ç»Ÿçš„æµ®ç‚¹æ•°æ–¹æ³•ï¼Œæ­¤é…ç½®é¡¹çš„æ›´å¤šè¯´æ˜è¯·çœ‹è¯¥é…ç½®é¡¹çš„æ³¨é‡Šã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(4)Â &lt;/strong&gt;å¢åŠ äº†åºåˆ—åŒ–çš„äº‹ä»¶ï¼šObjectFiltering å’Œ ArrayFilteringï¼Œè¿™ä¸¤ä¸ªäº‹ä»¶å¯ä»¥å¯¹æ­£åœ¨åºåˆ—åŒ–ä¸­çš„ é”®/å€¼ åšå¤„ç†å’Œç­›é€‰ï¼ŒåŒ…æ‹¬é©¼å³°å‘½åæ³•ï¼Œå¿½ç•¥ä¸€äº›å€¼ç­‰ã€‚å®ƒä»¬è¢«æ”¾åœ¨ JsonFormatter å’Œ MessagePackFormatter çš„å®ä¾‹é‡Œé¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(5)Â &lt;/strong&gt;å¢åŠ äº† .NET å¯¹è±¡çš„æŒä¹…åºåˆ—åŒ–å’Œååºåˆ—åŒ–åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºåŒ…å«ç±»å‹ä¿¡æ¯å’Œå­—æ®µå€¼çš„å†…å®¹ï¼Œä¸åŒ…å«é€»è¾‘ä¿¡æ¯ï¼›ä½¿ç”¨Â SerializationBox&amp;lt;T&amp;gt; ç›’å­ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚å›¾ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1527310/202006/1527310-20200608163020852-1569230157.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;æ›´å¤šæ–°å¢çš„åŠŸèƒ½è¯·ç»§ç»­çœ‹ä»¥ä¸‹å†…å®¹ã€‚&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;


&lt;p&gt;&lt;strong&gt;&lt;span&gt;AOT&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ Swifter æ–°ç‰ˆæœ¬é‡Œï¼ŒAOT çš„ JIT çš„ç•Œé™æ›´åŠ æ˜æ˜¾ï¼Œç”± &lt;span&gt;&lt;strong&gt;VersionDifferences.IsSupportEmit&lt;/strong&gt;&lt;/span&gt; å­—æ®µæ ‡è¯†ï¼›å½“è¿™ä¸ªå­—æ®µä¸º true è¡¨ç¤ºå½“å‰å¹³å°æ˜¯ JIT è¿è¡Œæ—¶ï¼ŒSwifter å°†åœ¨ä¸€äº›ç±»ä¸­ä½¿ç”¨ Emit æŠ€æœ¯æé«˜æ€§èƒ½ï¼›å½“æ­¤å­—æ®µä¸º false æ—¶ï¼ŒSwifter ä¼šå®Œå…¨ä¸ä½¿ç”¨ Emit æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;å› æˆ‘ä»¬è®¾å¤‡æœ‰é™ï¼Œæ— æ³•æä¾›å¤§è§„æ¨¡çš„å¹³å°æµ‹è¯•ï¼Œä½†æˆ‘ä»¬éå¸¸å¸Œæœ›å¯ä»¥ Swifter å¯ä»¥æ”¯æŒæ›´å¤šçš„å¹³å°ï¼Œ&lt;strong&gt;&lt;span&gt;æ‰€ä»¥å¸Œæœ›æœ‹å‹ä»¬åŠ  Swifter äº¤æµ QQ ç¾¤ï¼š(133630914)&lt;/span&gt;&lt;/strong&gt;ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ›´å¿«çš„æä¾›åé¦ˆã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;ç›´æ¥æ–‡æ¡£è¯»å–/å†™å…¥çš„ API&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šå¸¸æƒ…å†µä¸‹ï¼Œå°†å°å‹å¯¹è±¡åºåˆ—åŒ–ä¸º Json/MsgPack å’Œå°†å°å‹ Json/MsgPack ååºåˆ—åŒ–ä¸ºå¯¹è±¡æ˜¯ .NET ç¨‹åºä¸­å¸¸è§çš„æ“ä½œï¼ŒSwifter ä¹Ÿæ­£ä»¥æ­¤ä¸ºå¸¸ç”¨åœºæ™¯åšä¼˜åŒ–ï¼Œæ‰€ä»¥ Swifter åœ¨å¯¹å°å‹æ•°æ®æ“ä½œæ—¶æ€§èƒ½æœ€ä½³ï¼Œä¸”ç›¸æ¯”å…¶ä»– Json/MsgPack è§£æåº“ä¼˜åŠ¿æ˜æ˜¾ã€‚&lt;/p&gt;
&lt;p&gt;ä½†åœ¨å¤§å‹æ•°æ®ä¸‹ä¼˜åŠ¿å‡å°‘ï¼Œè¿™ä¸»è¦åŸå› æ˜¯å¤§å‹æ•°æ®çš„å­˜å‚¨éœ€è¦å®ä½“ç±»æˆ–å­—å…¸/é›†åˆå­˜å‚¨ï¼Œåˆ›å»º/å¡«å……/éå†è¿™äº›å¯¹è±¡æ¶ˆè€—äº†å¤§é‡èµ„æºï¼ˆæ¥å£ç¼–ç¨‹çš„æŸè€—ï¼‰ï¼›æ‰€ä»¥ Swifter æä¾›äº†ç›´æ¥è¯»å–/å†™å…¥çš„ API æ¥ç»•å¼€äº†å¯¹å­˜å‚¨ä»‹è´¨çš„æ“ä½œï¼Œä»¥æ›´å¿«æ›´å°æŸè€—çš„è¯»å†™å¤§å‹æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨Â JsonFormatter.CreateJsonReader/MessagePackFormatter.CreateMessagePackReader å‡½æ•°æ¥åˆ›å»ºæ–‡æ¡£è¯»å–å™¨ï¼Œä½¿ç”¨ JsonFormatter.CreateJsonWriter/MessagePackFormatter.CreateMessagePackWriter å‡½æ•°æ¥åˆ›å»ºæ–‡æ¡£å†™å…¥å™¨ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ–‡æ¡£è¯»å–å™¨å®Œæ•´çš„è¯»å–ä¸€ä¸ª Json/MsgPack æ–‡æ¡£å°†æ¯”ååºåˆ—åŒ–ä¸ºå¯¹è±¡å¿« 4-8 å€ï¼ä½¿ç”¨æ–‡æ¡£å†™å…¥å™¨ç”Ÿæˆæ–‡æ¡£çš„æ€§èƒ½ä¸å°†å®ä½“ç±»åºåˆ—åŒ–ä¸º Json/MsgPack ç›¸å·®è¾ƒå°ï¼Œå‰ææ˜¯æ‚¨å·²æ„å»ºå¥½äº†è¿™äº›å¯¹è±¡ğŸ˜„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¯»å–å™¨æ¼”ç¤ºï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1527310/202006/1527310-20200608172721183-1040319350.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å†™å…¥å™¨æ¼”ç¤ºï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1527310/202006/1527310-20200608164758133-612572219.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;æ‹¥æœ‰ç®€å•é¢„æµ‹æ•°ç»„çš„é•¿åº¦çš„èƒ½åŠ›&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Swifter åœ¨å¯¹å°å‹æ•°ç»„ï¼Œéƒ¨åˆ†é›†åˆå†™å…¥æ—¶ï¼Œä¼šæ ¹æ®æ•°ç»„çš„ç±»å‹ï¼Œæ¥æºï¼ˆData,Json,MsgPack ç­‰ï¼‰ï¼Œåç§°ç­‰ä¿¡æ¯å¹¶ç»“åˆä¹‹å‰çš„ä¸€äº›é•¿åº¦è®°å½•ï¼Œç®€å•çš„é¢„æµ‹å‡ºæ–°çš„æ•°ç»„çš„é•¿åº¦ï¼›åœ¨å†™å…¥å®Œæˆåï¼Œå¦‚æœé¢„æµ‹é•¿åº¦ä¸å®é™…é•¿åº¦ä¸ç¬¦ï¼Œåˆ™æ‰©å±•æˆ–å‹ç¼©ä¸ºå®é™…é•¿åº¦ï¼›å¦‚æœä¸å®é™…é•¿åº¦ç›¸ç¬¦ï¼Œåˆ™ä¸éœ€è¦é‡æ–°åˆ›å»ºæ–°æ•°ç»„ã€‚æ­¤èƒ½åŠ›æœ‰æ•ˆæé«˜ååºåˆ—åŒ–å°å‹æ•°ç»„å’Œéƒ¨åˆ†é›†åˆæ€§èƒ½ï¼Œå¹¶ä¸”å‡å°‘é¢å¤–å†…å­˜åˆ†é…ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å…¶ä»–é«˜æ€§èƒ½çš„ Json è§£æåº“ï¼Œå®ƒä»¬ä½¿ç”¨ ArrayPool&amp;lt;T&amp;gt; åŒæ ·å¯ä»¥æé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜åˆ†é…ï¼›ä½†æ˜¯ç”±äº Swifter å¯¹å…¼å®¹æ€§çš„è¦æ±‚ï¼Œä½¿å¾—æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨Â ArrayPool&amp;lt;T&amp;gt; æ–¹æ¡ˆï¼›åœ¨æ•°ç»„çš„é•¿åº¦æ¯”è¾ƒç¨³å®šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„æ–¹æ¡ˆæ›´å¥½ï¼›ä½†åœ¨æ•°ç»„é•¿åº¦éå¸¸ä¸ç¨³å®šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„æ–¹æ¡ˆå¯èƒ½ä»éœ€è¦ 1-3 æ¬¡çš„æ‰©å®¹/å‹ç¼©ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;å‡å®šæœ‰åºçš„å¯¹è±¡ååºåˆ—åŒ–&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Swifter.Json å’Œ Swifter.MessagePack éƒ½æ”¯æŒäº†å‡å®šæœ‰åºçš„å¯¹è±¡ååºåˆ—åŒ–ï¼Œå½“ä¸€ä¸ª Json/MsgPack çš„å¯¹è±¡ä¸å½“å‰çš„å®ä½“ç±»å¯¹è±¡çš„å­—æ®µé¡ºåºä¸€è‡´æ—¶ï¼Œå°†æœ‰æ•ˆæå‡ååºåˆ—åŒ–æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤æ“ä½œé»˜è®¤ä¸å¼€å¯ï¼Œå¯ä»¥ä½¿ç”¨ AsOrderedObjectDeserialize é…ç½®é¡¹å¼€å¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;é«˜æ€§èƒ½çš„åå°„å°è£…&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Swifter.Core é‡Œæä¾›äº†ä¸€äº›å¯¹åå°„å°è£…çš„ç±»ï¼Œå®ƒä»¬æ”¾åœ¨ Swifter.Reflection å‘½åç©ºé—´ä¸‹ï¼›è¿™äº›ç±»å‹ä¸»è¦åŠŸèƒ½å°±æ˜¯æé«˜äº†ç³»ç»Ÿåå°„çš„æ€§èƒ½ï¼›XObjectRW æ­£æ˜¯ä½¿ç”¨å®ƒä»¬å®ç°ä¸ä¾èµ– Emit çš„é«˜æ€§èƒ½å¯¹è±¡è¯»å†™å™¨ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶æ”¾å¼ƒä¸€äº›å®‰å…¨æ€§æ£€æŸ¥å¯ä»¥æé«˜æ›´å¤šçš„æ€§èƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶æ²¡æœ‰è¿™ä¹ˆåšï¼›æˆ‘ä»¬ä»ç„¶æœ‰ç±»å‹å®‰å…¨æ£€æŸ¥å’Œé˜²æº¢å‡ºæ£€æŸ¥ï¼ˆäº‹å®ä¸Šè¯»å†™å­—æ®µå’Œå±æ€§å¤§å¤šæ•°çš„æŸå®³éƒ½åœ¨è¿™é‡Œï¼Œå¦‚æœå»æ‰è¿™äº›æ£€æŸ¥å°†å¾—åˆ°ä¸Šç™¾å€çš„æ€§èƒ½ï¼›äº‹å®ä¸Šè¿™äº›æ£€æŸ¥åªèµ·åˆ°äº†æç¤ºç¨‹åºå‘˜ä¸èƒ½è¿™ä¹ˆåšçš„ä½œç”¨ï¼Œç¨‹åºå®é™…è¿è¡Œæ—¶è¿™äº›æ£€æŸ¥æ— æ„ä¹‰ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1527310/202006/1527310-20200608164918761-1997016275.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;é«˜æ•ˆçš„æ•°å­— ToString å’Œ Parse æ–¹æ³•&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Swifter.Core æä¾›äº†ä¸€äº›é«˜æ€§èƒ½æ•°å­—ç®—æ³•ï¼ŒåŒ…æ‹¬ Int64, UInt64, Double, Single, Decimal çš„ Parse å’Œ ToString ç®—æ³•ï¼Œå®ƒä»¬è¢«æ”¾åœ¨ Swifter.Tools.NumberHelper é‡Œï¼Œè¿™äº›ç®—æ³•è¢«åº”ç”¨ä¸ Swifter.Json å’Œä¸€äº›å…¶ä»–åœ°æ–¹ï¼Œè¿™äº›ç®—æ³•æ”¯æŒ 2-64 è¿›åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1527310/202006/1527310-20200608165050540-53556330.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;XConvert ä¸‡èƒ½ç±»å‹è½¬æ¢å™¨&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Swifter.Tools.XConvert.Convert&amp;lt;TSource, TDestination&amp;gt; æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ä¸‡èƒ½ç±»å‹è½¬æ¢å‡½æ•°ï¼Œå®ƒåœ¨åˆå§‹åŒ–æ—¶å°è¯•ä»¥ä¸‹æ–¹å¼è·å–åˆé€‚çš„è½¬æ¢å‡½æ•°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(1)&lt;/strong&gt; åŒ…å«åœ¨ System.Convert é‡Œçš„åŸºç¡€è½¬æ¢å‡½æ•°ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(2)&lt;/strong&gt; ç±»å‹å…¼å®¹çš„éšå¼è½¬æ¢ï¼ˆå¦‚ï¼šä»å­ç±»è½¬æ¢ä¸ºçˆ¶ç±»ï¼Œä» Int32 è½¬æ¢ä¸º Int64ï¼Œä» Int64 è½¬æ¢ä¸º Doubleï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(3)&lt;/strong&gt; åŸç±»å‹å’Œç›®æ ‡ç±»å‹ä¸­çš„ staticÂ implicitÂ operator (éšå¼è½¬æ¢) å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(4)&lt;/strong&gt; åŸç±»å‹ä¸­çš„ ToXXX å®ä¾‹å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(5)&lt;/strong&gt; ç›®æ ‡ç±»å‹ä¸­çš„ Parse å’Œ ValueOf é™æ€å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(7)&lt;/strong&gt; ç›®æ ‡ç±»å‹çš„æ„é€ å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(8)&lt;/strong&gt; åŸç±»å‹å’Œç›®æ ‡ç±»å‹ä¸­çš„Â staticÂ explicit operator (æ˜¾å¼è½¬æ¢) å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;(9)&lt;/strong&gt; å½“ä»¥ä¸Šæ–¹æ³•éƒ½æ²¡æœ‰æ‰¾åˆ°åˆé€‚å‡½æ•°æ—¶ï¼Œå°†ä½¿ç”¨Â (TDestination)(object)value è¿›è¡Œå¼ºåˆ¶è½¬æ¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç®€å•ç¤ºä¾‹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1527310/202006/1527310-20200608165753792-115525316.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;æ€§èƒ½æµ‹è¯•&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1527310/202006/1527310-20200609115622335-1226707148.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ServiceStack.Json, Jil, LitJson, NetJson ç­‰åº“&lt;/strong&gt;å› ä¸ºå‡ºé”™å¤ªå¤šæœªå±•ç¤ºå‡ºæ¥ï¼›å¦‚æœæœ‰éœ€è¦ï¼Œæ‚¨å¯ä»¥åˆ° GitHub ä¸Šè‡ªè¡Œå…‹éš†/ä¿®æ”¹/è¿è¡Œï¼Œå·²æ”¶å½•äº†&lt;strong&gt;Â .NET çš„&lt;/strong&gt;å¤§å¤šæ•° Json åºåˆ—åŒ–åº“ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;æ›´å¤šå®ç”¨åŠŸèƒ½ç­‰ä½ å‘ç°...&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Swifter.Core è¿˜æä¾›äº†è®¸è®¸å¤šå¤šçš„å·¥å…·ç±»ï¼ŒåŒ…æ‹¬åå°„ï¼Œå§”æ‰˜ï¼Œç±»å‹è½¬æ¢ï¼Œå­—ç¬¦ä¸²ï¼ŒåŠ å¯†ï¼Œå“ˆå¸Œï¼Œæ•°å­—ï¼Œæ—¥æœŸï¼Œæ•°ç»„å’Œé›†åˆç­‰å·¥å…·ï¼Œå®ƒä»¬è¢«æ”¾åœ¨ Swifter.Tools å‘½åç©ºé—´ä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥æé«˜å¼€å‘æ•ˆç‡å’Œè¿è¡Œæ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;Swifter.RW å‘½åç©ºé—´æ˜¯æ•´ä¸ª Swifter æ¡†æ¶çš„æ ¸å¿ƒï¼Œå®ƒä¸»è¦é€»è¾‘æ˜¯ï¼šä»è¯»å–å™¨ä¸­è¯»å–å€¼ï¼Œå†™å…¥åˆ°å†™å…¥å™¨ä¸­ï¼›å¦‚ï¼šä» JsonReader è¯»å–å€¼åˆ° ObjectWriter æˆ– DictionaryWriter ä¸­ï¼›ç†Ÿæ‚‰å®ƒä»¬å°±ç­‰äºç²¾é€šäº† Swifter æ¡†æ¶ã€‚&lt;/p&gt;
&lt;p&gt;Swifter.Json/Swifter.MessagePack æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„é…ç½®é¡¹ JsonFormatterOptions/MessagePackFormatterOptionsï¼›ä½¿ç”¨å‰&lt;strong&gt;&lt;span&gt;å»ºè®®å…ˆé˜…è¯»å®ƒä»¬&lt;/span&gt;&lt;/strong&gt;ï¼Œä»¥é…ç½®æ›´é€‚åˆæ‚¨ç³»ç»Ÿçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;æœ€åé™„ä¸Š Swifter.Data çš„ç®€ä»‹&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Swifter.Data æ˜¯ä¸€ä¸ªå°å‹çš„ ORM å·¥å…·ï¼Œå®ƒç›¸æ¯” Dapper æ€§èƒ½è¦å¿«ä¸€äº›ï¼ŒåŠŸèƒ½è¦å¼ºå¤§ä¸€äº›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1527310/202006/1527310-20200608161452366-1052886546.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;æ„Ÿè°¢é˜…è¯»&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
</description>
<pubDate>Sun, 14 Jun 2020 23:43:00 +0000</pubDate>
<dc:creator>é™ˆé‘«ä¼Ÿ</dc:creator>
<og:description>æŠ±æ­‰å„ä½æœ‹å‹ï¼Œç”±äºå„ç§ç§äº‹å…¬äº‹ï¼Œæœ¬åº”è¯¥åœ¨ 19 å¹´åº•å‘å¸ƒçš„ Swifter.MessagePack åº“å»¶è¿Ÿäº†è¿™ä¹ˆä¹…æ‰å‘å¸ƒï¼Œæˆ‘æ·±æ„ŸæŠ±æ­‰ã€‚ MsgPack ç®€ä»‹ MsgPack ä¸€ç§éå¸¸è½»å·§çš„äºŒè¿›åˆ¶æ•°æ®äº¤</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/Dogwei/p/12915046.html</dc:identifier>
</item>
<item>
<title>é¢è¯•å®˜ï¼šçº¿ç¨‹æ± å¦‚ä½•æŒ‰ç…§coreã€maxã€queueçš„æ‰§è¡Œå¾ªåºå»æ‰§è¡Œï¼Ÿï¼ˆå†…é™„è¯¦ç»†è§£æï¼‰ - ä¸€æèŠ±ç®—ä¸ç®—æµªæ¼«</title>
<link>http://www.cnblogs.com/wang-meng/p/13128890.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/wang-meng/p/13128890.html</guid>
<description>&lt;h3 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;è¿™æ˜¯ä¸€ä¸ªçœŸå®çš„é¢è¯•é¢˜ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‰å‡ å¤©ä¸€ä¸ªæœ‹å‹åœ¨ç¾¤é‡Œåˆ†äº«äº†ä»–åˆšåˆšé¢è¯•å€™é€‰è€…æ—¶é—®çš„é—®é¢˜ï¼š&lt;strong&gt;&quot;çº¿ç¨‹æ± å¦‚ä½•æŒ‰ç…§coreã€maxã€queueçš„æ‰§è¡Œå¾ªåºå»æ‰§è¡Œï¼Ÿ&quot;&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“çº¿ç¨‹æ± ä¸­ä»£ç æ‰§è¡Œé¡ºåºæ˜¯ï¼š&lt;strong&gt;corePool-&amp;gt;workQueue-&amp;gt;maxPool&lt;/strong&gt;ï¼Œæºç æˆ‘éƒ½çœ‹è¿‡ï¼Œä½ ç°åœ¨é—®é¢˜è®©æˆ‘æ”¹æºç ï¼Ÿï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸€æ—¶é—´ç¾¤é‡Œç‚¸å¼€äº†é”…ï¼Œå°ä¼™ä¼´ä»¬çº·çº·æ‰“å¬ä»–æ‰€åœ¨çš„å…¬å¸ï¼Œç„¶åæ‹‰é»‘é¿å‘ã€‚&lt;strong&gt;(æ‰‹åŠ¨ç‹—å¤´ï¼Œå¤§å®¶ä¸€èµ·è°ƒä¾ƒÙ©(à¹‘â›á´—â›à¹‘)Û¶)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…³äºçº¿ç¨‹æ± ä»–ä¸€å…±é—®äº†è¿™ä¹ˆå‡ ä¸ªé—®é¢˜ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;çº¿ç¨‹æ± å¦‚ä½•æŒ‰ç…§coreã€maxã€queueçš„é¡ºåºå»æ‰§è¡Œï¼Ÿ&lt;/li&gt;
&lt;li&gt;å­çº¿ç¨‹æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä¸»çº¿ç¨‹èƒ½æ„ŸçŸ¥åˆ°ä¹ˆï¼Ÿ&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹æ± å‘ç”Ÿäº†å¼‚å¸¸æ”¹æ€æ ·å¤„ç†ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;å…¨æ˜¯ä¸€äº›æœ‰æ„æ€çš„é—®é¢˜ï¼Œæˆ‘ä¹‹å‰ä¹Ÿå†™è¿‡ä¸€ç¯‡å¾ˆè¯¦ç»†çš„å›¾æ–‡æ•™ç¨‹ï¼š&lt;a href=&quot;https://www.cnblogs.com/wang-meng/p/12945703.html&quot;&gt;ã€ä¸‡å­—å›¾æ–‡-åŸåˆ›ã€‘ | å­¦ä¼šJavaä¸­çš„çº¿ç¨‹æ± ï¼Œè¿™ä¸€ç¯‡ä¹Ÿè®¸å°±å¤Ÿäº†ï¼&lt;/a&gt; ï¼Œä¸äº†è§£çš„å°ä¼™ä¼´å¯ä»¥å†å›é¡¾ä¸‹~&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯é’ˆå¯¹è¿™å‡ ä¸ªé—®é¢˜ï¼Œå¯èƒ½å¤§å®¶ä¸€æ—¶é—´ä¹Ÿæœ‰ç‚¹æ‡µã€‚ä»Šå¤©çš„æ–‡ç« æˆ‘ä»¬ä»¥æºç ä¸ºåŸºç¡€æ¥åˆ†æä¸‹è¯¥å¦‚ä½•å›ç­”è¿™ä¸‰ä¸ªé—®é¢˜ã€‚&lt;strong&gt;ï¼ˆä¹‹å‰æ²¡é˜…è¯»è¿‡æºç ä¹Ÿæ²¡å…³ç³»ï¼Œæ‰€æœ‰çš„åˆ†æéƒ½ä¼šè´´å‡ºæºç åŠå›¾è§£ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;çº¿ç¨‹æ± å¦‚ä½•æŒ‰ç…§coreã€maxã€queueçš„é¡ºåºæ‰§è¡Œï¼Ÿ&quot;&gt;çº¿ç¨‹æ± å¦‚ä½•æŒ‰ç…§coreã€maxã€queueçš„é¡ºåºæ‰§è¡Œï¼Ÿ&lt;/h3&gt;
&lt;h4 id=&quot;é—®é¢˜æ€è€ƒ&quot;&gt;é—®é¢˜æ€è€ƒ&lt;/h4&gt;
&lt;p&gt;å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œå¾ˆå¤šå°ä¼™ä¼´è‚¯å®šä¼šç–‘æƒ‘ï¼š&lt;strong&gt;&quot;åˆ«äººæºç ä¸­å†™å¥½çš„æ‰§è¡Œæµç¨‹ä½ ä¸ºå•¥è¦æ”¹ï¼Ÿè¿™é¢è¯•å®˜è„‘å­æœ‰ç—…å§......&quot;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæ¥æ€è€ƒä¸€ä¸‹ç°å®å·¥ä½œåœºæ™¯ä¸­æ˜¯å¦æœ‰è¿™ç§éœ€æ±‚ï¼Ÿä¹‹å‰ä¹Ÿçœ‹åˆ°è¿‡ä¸€ä»½ç®€å†ä¹Ÿå†™åˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/799093/202006/799093-20200615072705573-1473063398.png&quot; alt=&quot;åœºæ™¯æè¿°.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªçº¿ç¨‹æ± æ‰§è¡Œçš„ä»»åŠ¡å±äº&lt;code&gt;IO&lt;/code&gt;å¯†é›†å‹ï¼Œ&lt;code&gt;CPU&lt;/code&gt;å¤§å¤šå±äºé—²ç½®çŠ¶æ€ï¼Œç³»ç»Ÿèµ„æºæœªå……åˆ†åˆ©ç”¨ã€‚å¦‚æœä¸€ç¬é—´æ¥äº†å¤§é‡è¯·æ±‚ï¼Œå¦‚æœçº¿ç¨‹æ± æ•°é‡å¤§äº&lt;code&gt;coreSize&lt;/code&gt;æ—¶ï¼Œå¤šä½™çš„è¯·æ±‚éƒ½ä¼šæ”¾å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚ç­‰å¾…ç€&lt;code&gt;corePool&lt;/code&gt;ä¸­çš„çº¿ç¨‹æ‰§è¡Œå®Œæˆåå†æ¥æ‰§è¡Œç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¯•æƒ³ä¸€ä¸‹ï¼Œè¿™ç§åœºæ™¯æˆ‘ä»¬è¯¥å¦‚ä½•ä¼˜åŒ–ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä¿®æ”¹çº¿ç¨‹æ± çš„æ‰§è¡Œé¡ºåºä¸º&lt;strong&gt;corePool-&amp;gt;maxPool-&amp;gt;workQueue&lt;/strong&gt;ã€‚ è¿™æ ·å°±èƒ½å¤Ÿå……åˆ†åˆ©ç”¨&lt;code&gt;CPU&lt;/code&gt;èµ„æºï¼Œæäº¤çš„ä»»åŠ¡ä¼šè¢«ä¼˜å…ˆæ‰§è¡Œã€‚å½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°é‡å¤§äº&lt;code&gt;maxSize&lt;/code&gt;æ—¶æ‰ä¼šå°†ä»»åŠ¡æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å°±è¯´å·§ä¸å·§ï¼Ÿé¢è¯•å®˜çš„è¿™ä¸ªé—®é¢˜æ˜¾ç„¶æ˜¯ç»è¿‡è®¤çœŸæ€è€ƒæ¥æé—®çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„æ¸©æ©æï¼Œä¸‹é¢å°±ä¸€èµ·çœ‹çœ‹å¦‚ä½•è§£å†³å§ã€‚&lt;/p&gt;
&lt;h4 id=&quot;çº¿ç¨‹æ± è¿è¡Œæµç¨‹&quot;&gt;çº¿ç¨‹æ± è¿è¡Œæµç¨‹&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“çº¿ç¨‹æ± æ‰§è¡Œæµç¨‹æ˜¯å…ˆ&lt;code&gt;corePool&lt;/code&gt;å†&lt;code&gt;workQueue&lt;/code&gt;ï¼Œæœ€åæ‰æ˜¯&lt;code&gt;maxPool&lt;/code&gt;çš„ä¸€ä¸ªæ‰§è¡Œæµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/799093/202006/799093-20200615072705858-681238152.png&quot; alt=&quot;æ‰§è¡Œæµç¨‹.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;çº¿ç¨‹æ± æ ¸å¿ƒå‚æ•°&quot;&gt;çº¿ç¨‹æ± æ ¸å¿ƒå‚æ•°&lt;/h4&gt;
&lt;p&gt;åœ¨å›é¡¾ä¸‹&lt;code&gt;ThreadPoolExecutor.execute()&lt;/code&gt;æºç å‰æˆ‘ä»¬å…ˆå›é¡¾ä¸‹çº¿ç¨‹æ± ä¸­çš„å‡ ä¸ªé‡è¦å‚æ•°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/799093/202006/799093-20200615072706060-1065893697.png&quot; alt=&quot;çº¿ç¨‹æ± æ ¸å¿ƒå‚æ•°.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹ä¸‹è¿™å‡ ä¸ªå‚æ•°çš„å®šä¹‰ï¼š&lt;br/&gt;&lt;code&gt;corePoolSize&lt;/code&gt;: çº¿ç¨‹æ± ä¸­æ ¸å¿ƒçº¿ç¨‹æ•°é‡&lt;br/&gt;&lt;code&gt;maximumPoolSize&lt;/code&gt;: çº¿ç¨‹æ± ä¸­æœ€å¤§çº¿ç¨‹æ•°é‡&lt;br/&gt;&lt;code&gt;keepAliveTime&lt;/code&gt;: éæ ¸å¿ƒçš„ç©ºé—²çº¿ç¨‹ç­‰å¾…æ–°ä»»åŠ¡çš„æ—¶é—´&lt;br/&gt;&lt;code&gt;unit&lt;/code&gt;: æ—¶é—´å•ä½ã€‚é…åˆ&lt;code&gt;allowCoreThreadTimeOut&lt;/code&gt;ä¹Ÿä¼šæ¸…ç†æ ¸å¿ƒçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ã€‚&lt;br/&gt;&lt;code&gt;workQueue&lt;/code&gt;: åŸºäº&lt;code&gt;Blocking&lt;/code&gt;çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œæœ€å¥½é€‰ç”¨æœ‰ç•Œé˜Ÿåˆ—ï¼ŒæŒ‡å®šé˜Ÿåˆ—é•¿åº¦&lt;br/&gt;&lt;code&gt;threadFactory&lt;/code&gt;: çº¿ç¨‹å·¥å‚ï¼Œæœ€å¥½è‡ªå®šä¹‰çº¿ç¨‹å·¥å‚ï¼Œå¯ä»¥è‡ªå®šä¹‰æ¯ä¸ªçº¿ç¨‹çš„åç§°&lt;br/&gt;&lt;code&gt;handler&lt;/code&gt;: æ‹’ç»ç­–ç•¥ï¼Œé»˜è®¤æ˜¯&lt;code&gt;AbortPolicy&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;threadpoolexecutorexecuteæºç åˆ†æ&quot;&gt;ThreadPoolExecutor.execute()æºç åˆ†æ&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹&lt;code&gt;execute()&lt;/code&gt;å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/799093/202006/799093-20200615072706289-1610433293.png&quot; alt=&quot;executeæ‰§è¡Œæºç .png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ¥ç€æ¥åˆ†æä¸‹æ‰§è¡Œè¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ç¬¬ä¸€æ­¥ï¼š&lt;code&gt;workerCountOf(c)&lt;/code&gt;æ—¶é—´è®¡ç®—å½“å‰çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„ä¸ªæ•°ï¼Œå½“çº¿ç¨‹ä¸ªæ•°å°äºæ ¸å¿ƒçº¿ç¨‹æ•°&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒæ­¥ï¼šçº¿ç¨‹æ± çº¿ç¨‹æ•°é‡å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œæ­¤æ—¶æäº¤çš„ä»»åŠ¡ä¼šæ”¾å…¥&lt;code&gt;workQueue&lt;/code&gt;ä¸­ï¼Œä½¿ç”¨&lt;code&gt;offer()&lt;/code&gt;è¿›è¡Œæ“ä½œ&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰æ­¥ï¼š&lt;code&gt;workQueue.offer()&lt;/code&gt;æ‰§è¡Œå¤±è´¥ï¼Œæ–°æäº¤çš„ä»»åŠ¡ä¼šç›´æ¥æ‰§è¡Œï¼Œ&lt;code&gt;addWorker()&lt;/code&gt;ä¼šåˆ¤æ–­å¦‚æœå½“å‰çº¿ç¨‹æ± æ•°é‡å¤§äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™æ‰§è¡Œæ‹’ç»ç­–ç•¥&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;å¥½äº†ï¼Œåˆ°äº†è¿™é‡Œæˆ‘ä»¬éƒ½å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œå…³é”®åœ¨äºç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥å¦‚ä½•äº¤æ¢é¡ºåºæ‰§è¡Œå‘¢ï¼Ÿ&lt;/p&gt;
&lt;h4 id=&quot;è§£å†³æ€è·¯&quot;&gt;è§£å†³æ€è·¯&lt;/h4&gt;
&lt;p&gt;ä»”ç»†æƒ³ä¸€æƒ³ï¼Œå¦‚æœä¿®æ”¹&lt;code&gt;workQueue.offer()&lt;/code&gt;çš„å®ç°ä¸å°±å¯ä»¥è¾¾åˆ°ç›®çš„äº†ï¼Ÿæˆ‘ä»¬å…ˆæ¥ç”»å›¾æ¥çœ‹ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/799093/202006/799093-20200615072706519-331395459.png&quot; alt=&quot;é—®é¢˜æ€è·¯.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨çš„é—®é¢˜å°±åœ¨äºï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­&lt;code&gt;coreSize &amp;lt; workCount &amp;lt; maxSize&lt;/code&gt;æ—¶ï¼Œä¸€å®šä¼šå…ˆæ‰§è¡Œ&lt;code&gt;offer()&lt;/code&gt;æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¦‚æœä¿®æ”¹&lt;code&gt;offer&lt;/code&gt;çš„å®ç°æ˜¯å¦å¯ä»¥å®Œæˆæ‰§è¡Œé¡ºåºçš„æ›´æ¢å‘¢ï¼Ÿè¿™é‡Œä¹Ÿæ˜¯ç”»å›¾æ¥å±•ç¤ºä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/799093/202006/799093-20200615072706730-1807526275.png&quot; alt=&quot;è§£å†³æ–¹å¼.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;dubboä¸­eagerthreadpoolè§£å†³æ–¹æ¡ˆ&quot;&gt;Dubboä¸­EagerThreadPoolè§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;å‡‘å·§&lt;code&gt;Dubbo&lt;/code&gt;ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„å®ç°ï¼Œåœ¨&lt;code&gt;Dubbo&lt;/code&gt;çš„&lt;code&gt;EagerThreadPool&lt;/code&gt;è‡ªå®šä¹‰äº†ä¸€ä¸ª&lt;code&gt;BlockingQueue&lt;/code&gt;ï¼Œåœ¨&lt;code&gt;offer()&lt;/code&gt;æ–¹æ³•ä¸­ï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ± æ•°é‡å°äºæœ€å¤§çº¿ç¨‹æ± æ—¶ï¼Œç›´æ¥è¿”å›&lt;code&gt;false&lt;/code&gt;ï¼Œè¿™é‡Œå°±è¾¾åˆ°äº†è°ƒèŠ‚çº¿ç¨‹æ± æ‰§è¡Œé¡ºåºçš„ç›®çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/799093/202006/799093-20200615072706935-1372798478.png&quot; alt=&quot;dubboä¸­è§£å†³æ–¹æ¡ˆ.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æºç ç›´è¾¾&lt;/strong&gt;ï¼š&lt;a href=&quot;https://github.com/apache/dubbo/blob/master/dubbo-common/src/main/java/org/apache/dubbo/common/threadpool/support/eager/TaskQueue.java&quot;&gt;https://github.com/apache/dubbo/blob/master/dubbo-common/src/main/java/org/apache/dubbo/common/threadpool/support/eager/TaskQueue.java&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°è¿™é‡Œä¸€åˆ‡éƒ½çœŸç›¸å¤§ç™½äº†ï¼Œè§£å†³æ€è·¯ä»¥åŠæ–¹æ¡ˆéƒ½å¾ˆç®€å•ï¼Œå­¦ä¼šäº†æ²¡æœ‰ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜èƒŒåè¿˜éšè—äº†ä¸€äº›åœºæ™¯çš„ä¼˜åŒ–ã€æºç çš„æ‰©å±•ç­‰ç­‰çŸ¥è¯†ï¼Œæœç„¶æ˜¯ä¸€ä¸ªå€¼å¾—æ€è€ƒçš„å¥½é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å­çº¿ç¨‹æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä¸»çº¿ç¨‹èƒ½æ„ŸçŸ¥åˆ°ä¹ˆï¼Ÿ&quot;&gt;å­çº¿ç¨‹æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä¸»çº¿ç¨‹èƒ½æ„ŸçŸ¥åˆ°ä¹ˆï¼Ÿ&lt;/h3&gt;
&lt;h4 id=&quot;é—®é¢˜æ€è€ƒ-2&quot;&gt;é—®é¢˜æ€è€ƒ&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªé—®é¢˜å…¶å®ä¹Ÿå¾ˆå®¹æ˜“å›ç­”ï¼Œä¹Ÿä»…ä»…æ˜¯ä¸€ä¸ªé¢è¯•é¢˜è€Œå·²ï¼Œå®é™…å·¥ä½œä¸­å­çº¿ç¨‹çš„å¼‚å¸¸ä¸åº”è¯¥ç”±ä¸»çº¿ç¨‹æ¥æ•è·ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œå¸Œæœ›å¤§å®¶æ¸…æ¥šçš„æ˜¯ï¼š&lt;/strong&gt; æˆ‘ä»¬è¦æ˜ç¡®çº¿ç¨‹ä»£ç çš„è¾¹ç•Œï¼Œå¼‚æ­¥åŒ–è¿‡ç¨‹ä¸­ï¼Œå­çº¿ç¨‹æŠ›å‡ºçš„å¼‚å¸¸åº”è¯¥ç”±å­çº¿ç¨‹è‡ªå·±å»å¤„ç†ï¼Œè€Œä¸æ˜¯éœ€è¦ä¸»çº¿ç¨‹æ„ŸçŸ¥æ¥ååŠ©å¤„ç†ã€‚&lt;/p&gt;
&lt;h4 id=&quot;è§£å†³æ–¹æ¡ˆ&quot;&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆå¾ˆç®€å•ï¼Œåœ¨è™šæ‹Ÿæœºä¸­ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å¦‚æœæ²¡æœ‰æ˜¾å¼å¤„ç†å¼‚å¸¸è€ŒæŠ›å‡ºæ—¶ä¼šå°†è¯¥å¼‚å¸¸äº‹ä»¶æŠ¥å‘Šç»™è¯¥çº¿ç¨‹å¯¹è±¡çš„ &lt;code&gt;java.lang.Thread.UncaughtExceptionHandler&lt;/code&gt; è¿›è¡Œå¤„ç†ï¼Œå¦‚æœçº¿ç¨‹æ²¡æœ‰è®¾ç½® &lt;code&gt;UncaughtExceptionHandler&lt;/code&gt;ï¼Œåˆ™é»˜è®¤ä¼šæŠŠå¼‚å¸¸æ ˆä¿¡æ¯è¾“å‡ºåˆ°ç»ˆç«¯è€Œä½¿ç¨‹åºç›´æ¥å´©æºƒã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³åœ¨çº¿ç¨‹æ„å¤–å´©æºƒæ—¶åšä¸€äº›å¤„ç†å°±å¯ä»¥é€šè¿‡å®ç° &lt;code&gt;UncaughtExceptionHandler&lt;/code&gt; æ¥æ»¡è¶³éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨çº¿ç¨‹æ± è®¾ç½®&lt;code&gt;ThreadFactory&lt;/code&gt;æ—¶å¯ä»¥æŒ‡å®š&lt;code&gt;UncaughtExceptionHandler&lt;/code&gt;ï¼Œè¿™æ ·å°±å¯ä»¥æ•è·åˆ°å­çº¿ç¨‹æŠ›å‡ºçš„å¼‚å¸¸äº†ã€‚&lt;/p&gt;
&lt;h4 id=&quot;ä»£ç ç¤ºä¾‹&quot;&gt;ä»£ç ç¤ºä¾‹&lt;/h4&gt;
&lt;p&gt;å…·ä½“ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;/**
 * æµ‹è¯•å­çº¿ç¨‹å¼‚å¸¸é—®é¢˜
 *
 * @author wangmeng
 * @date 2020/6/13 18:08
 */
public class ThreadPoolExceptionTest {

    public static void main(String[] args) throws InterruptedException {
        MyHandler myHandler = new MyHandler();
        ExecutorService execute = new ThreadPoolExecutor(10, 10,
                0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&amp;lt;Runnable&amp;gt;(), new ThreadFactoryBuilder().setUncaughtExceptionHandler(myHandler).build());

        TimeUnit.SECONDS.sleep(5);
        for (int i = 0; i &amp;lt; 10; i++) {
            execute.execute(new MyRunner());
        }
    }


    private static class MyRunner implements Runnable {
        @Override
        public void run() {
            int count = 0;
            while (true) {
                count++;
                System.out.println(&quot;æˆ‘è¦å¼€å§‹ç”Ÿäº§Bugäº†============&quot;);
                if (count == 10) {
                    System.out.println(1 / 0);
                }

                if (count == 20) {
                    System.out.println(&quot;è¿™é‡Œæ˜¯ä¸ä¼šæ‰§è¡Œåˆ°çš„==========&quot;);
                    break;
                }
            }
        }
    }
}

class MyHandler implements Thread.UncaughtExceptionHandler {
    private final static Logger LOGGER = LoggerFactory.getLogger(MyHandler.class);
    @Override
    public void uncaughtException(Thread t, Throwable e) {
        LOGGER.error(&quot;threadId = {}, threadName = {}, ex = {}&quot;, t.getId(), t.getName(), e.getMessage());
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ‰§è¡Œç»“æœï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/799093/202006/799093-20200615072707185-630328833.png&quot; alt=&quot;æ‰§è¡Œç»“æœ.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;uncaughtexceptionhandler-è§£æ&quot;&gt;UncaughtExceptionHandler è§£æ&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹ä¸‹&lt;code&gt;Thread&lt;/code&gt;ä¸­çš„å†…éƒ¨æ¥å£&lt;code&gt;UncaughtExceptionHandler&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public class Thread {
    ......
    /**
     * å½“ä¸€ä¸ªçº¿ç¨‹å› æœªæ•è·çš„å¼‚å¸¸è€Œå³å°†ç»ˆæ­¢æ—¶è™šæ‹Ÿæœºå°†ä½¿ç”¨ Thread.getUncaughtExceptionHandler()
     * è·å–å·²ç»è®¾ç½®çš„ UncaughtExceptionHandler å®ä¾‹ï¼Œå¹¶é€šè¿‡è°ƒç”¨å…¶ uncaughtException(...) æ–¹
     * æ³•è€Œä¼ é€’ç›¸å…³å¼‚å¸¸ä¿¡æ¯ã€‚
     * å¦‚æœä¸€ä¸ªçº¿ç¨‹æ²¡æœ‰æ˜ç¡®è®¾ç½®å…¶ UncaughtExceptionHandlerï¼Œåˆ™å°†å…¶ ThreadGroup å¯¹è±¡ä½œä¸ºå…¶
     * handlerï¼Œå¦‚æœ ThreadGroup å¯¹è±¡å¯¹å¼‚å¸¸æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„è¦æ±‚ï¼Œåˆ™ ThreadGroup ä¼šå°†è°ƒç”¨è½¬å‘ç»™
     * é»˜è®¤çš„æœªæ•è·å¼‚å¸¸å¤„ç†å™¨ï¼ˆå³ Thread ç±»ä¸­å®šä¹‰çš„é™æ€æœªæ•è·å¼‚å¸¸å¤„ç†å™¨å¯¹è±¡ï¼‰ã€‚
     *
     * @see #setDefaultUncaughtExceptionHandler
     * @see #setUncaughtExceptionHandler
     * @see ThreadGroup#uncaughtException
     */
    @FunctionalInterface
    public interface UncaughtExceptionHandler {
        /**
         * æœªæ•è·å¼‚å¸¸å´©æºƒæ—¶å›è°ƒæ­¤æ–¹æ³•
         */
        void uncaughtException(Thread t, Throwable e);
    }

    /**
     * é™æ€æ–¹æ³•ï¼Œç”¨äºè®¾ç½®ä¸€ä¸ªé»˜è®¤çš„å…¨å±€å¼‚å¸¸å¤„ç†å™¨ã€‚
     */
    public static void setDefaultUncaughtExceptionHandler(UncaughtExceptionHandler eh) {
         defaultUncaughtExceptionHandler = eh;
     }

    /**
     * é’ˆå¯¹æŸä¸ª Thread å¯¹è±¡çš„æ–¹æ³•ï¼Œç”¨äºå¯¹ç‰¹å®šçš„çº¿ç¨‹è¿›è¡Œæœªæ•è·çš„å¼‚å¸¸å¤„ç†ã€‚
     */
    public void setUncaughtExceptionHandler(UncaughtExceptionHandler eh) {
        checkAccess();
        uncaughtExceptionHandler = eh;
    }

    /**
     * å½“ Thread å´©æºƒæ—¶ä¼šè°ƒç”¨è¯¥æ–¹æ³•è·å–å½“å‰çº¿ç¨‹çš„ handlerï¼Œè·å–ä¸åˆ°å°±ä¼šè°ƒç”¨ groupï¼ˆhandler ç±»å‹ï¼‰ã€‚
     * group æ˜¯ Thread ç±»çš„ ThreadGroup ç±»å‹å±æ€§ï¼Œåœ¨ Thread æ„é€ ä¸­å®ä¾‹åŒ–ã€‚
     */
    public UncaughtExceptionHandler getUncaughtExceptionHandler() {
        return uncaughtExceptionHandler != null ?
            uncaughtExceptionHandler : group;
    }

    /**
     * çº¿ç¨‹å…¨å±€é»˜è®¤ handlerã€‚
     */
    public static UncaughtExceptionHandler getDefaultUncaughtExceptionHandler() {
        return defaultUncaughtExceptionHandler;
    }
    ......
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;éƒ¨åˆ†å†…å®¹å‚è€ƒè‡ªï¼š&lt;a href=&quot;https://mp.weixin.qq.com/s/ghnNQnpou6-NemhFjpl4Jg&quot;&gt;https://mp.weixin.qq.com/s/ghnNQnpou6-NemhFjpl4Jg&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;çº¿ç¨‹æ± å‘ç”Ÿäº†å¼‚å¸¸æ”¹æ€æ ·å¤„ç†ï¼Ÿ&quot;&gt;çº¿ç¨‹æ± å‘ç”Ÿäº†å¼‚å¸¸æ”¹æ€æ ·å¤„ç†ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;çº¿ç¨‹æ± ä¸­çº¿ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸è¯¥æ€æ ·å¤„ç†å‘¢ï¼Ÿçº¿ç¨‹æ± æäº¤ä»»åŠ¡æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯&lt;code&gt;execute()&lt;/code&gt;å’Œ&lt;code&gt;submit()&lt;/code&gt;ï¼Œè¿™é‡Œä¼šä¾æ¬¡è¯´æ˜ã€‚&lt;/p&gt;
&lt;h4 id=&quot;threadpoolexecutorrunworkerå®ç°&quot;&gt;ThreadPoolExecutor.runWorker()å®ç°&lt;/h4&gt;
&lt;p&gt;ä¸ç®¡æ˜¯ä½¿ç”¨&lt;code&gt;execute()&lt;/code&gt;è¿˜æ˜¯&lt;code&gt;submit()&lt;/code&gt;æäº¤ä»»åŠ¡ï¼Œæœ€ç»ˆéƒ½ä¼šæ‰§è¡Œåˆ°&lt;code&gt;ThreadPoolExecutor.runWorker()&lt;/code&gt;ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æºç ï¼ˆæºç åŸºäºJDK1.8ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/799093/202006/799093-20200615072707418-737082823.png&quot; alt=&quot;runWorker().png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çœ‹åˆ°åœ¨æ‰§è¡Œ&lt;code&gt;task.run()&lt;/code&gt;æ—¶ï¼Œå‡ºç°å¼‚å¸¸ä¼šç›´æ¥å‘ä¸ŠæŠ›å‡ºï¼Œè¿™é‡Œå¤„ç†çš„æœ€å¥½çš„æ–¹å¼å°±æ˜¯åœ¨æˆ‘ä»¬ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨&lt;code&gt;try...catch()&lt;/code&gt;æ¥æ•è·å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;h4 id=&quot;futuretaskrunå®ç°&quot;&gt;FutureTask.run()å®ç°&lt;/h4&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬ä½¿ç”¨&lt;code&gt;submit()&lt;/code&gt;æ¥æäº¤ä»»åŠ¡ï¼Œåœ¨&lt;code&gt;ThreadPoolExecutor.runWorker()&lt;/code&gt;æ–¹æ³•æ‰§è¡Œæ—¶æœ€ç»ˆä¼šè°ƒç”¨åˆ°&lt;code&gt;FutureTask.run()&lt;/code&gt;æ–¹æ³•é‡Œé¢å»ï¼Œä¸æ¸…æ¥šçš„å°ä¼™ä¼´ä¹Ÿå¯ä»¥çœ‹ä¸‹æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/wang-meng/p/13023710.html&quot;&gt;çº¿ç¨‹æ± ç»­ï¼šä½ å¿…é¡»è¦çŸ¥é“çš„çº¿ç¨‹æ± submit()å®ç°åŸç†ä¹‹FutureTaskï¼&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/799093/202006/799093-20200615072707687-894104673.png&quot; alt=&quot;FutureTask.run().png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœä¸šåŠ¡ä»£ç æŠ›å‡ºå¼‚å¸¸åï¼Œä¼šè¢«&lt;code&gt;catch&lt;/code&gt;æ•è·åˆ°ï¼Œç„¶åè°ƒç”¨&lt;code&gt;setExeception()&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/799093/202006/799093-20200615072707856-1037893017.png&quot; alt=&quot;FutureTask.setException().png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°å…¶å®ç±»ä¼¼äºç›´æ¥åæ‰äº†ï¼Œå½“æˆ‘ä»¬è°ƒç”¨&lt;code&gt;get()&lt;/code&gt;æ–¹æ³•çš„æ—¶å€™å¼‚å¸¸ä¿¡æ¯ä¼šåŒ…è£…åˆ°FutureTaskå†…éƒ¨çš„å˜é‡outcomeä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¼šè·å–åˆ°å¯¹åº”çš„å¼‚å¸¸ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨&lt;code&gt;ThreadPoolExecutor.runWorker()&lt;/code&gt;æœ€å&lt;code&gt;finally&lt;/code&gt;ä¸­æœ‰ä¸€ä¸ª&lt;code&gt;afterExecute()&lt;/code&gt;é’©å­æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬é‡å†™äº†&lt;code&gt;afterExecute()&lt;/code&gt;æ–¹æ³•ï¼Œå°±å¯ä»¥è·å–åˆ°å­çº¿ç¨‹æŠ›å‡ºçš„å…·ä½“å¼‚å¸¸ä¿¡æ¯&lt;code&gt;Throwable&lt;/code&gt;äº†ã€‚&lt;/p&gt;
&lt;h4 id=&quot;ç»“è®º&quot;&gt;ç»“è®º&lt;/h4&gt;
&lt;p&gt;å¯¹äºçº¿ç¨‹æ± ã€åŒ…æ‹¬çº¿ç¨‹çš„å¼‚å¸¸å¤„ç†æ¨èä»¥ä¸‹æ–¹å¼:&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ç›´æ¥ä½¿ç”¨&lt;code&gt;try/catch&lt;/code&gt;ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æœ€æ¨èçš„æ–¹å¼&lt;/li&gt;
&lt;li&gt;åœ¨æˆ‘ä»¬æ„é€ çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œé‡å†™&lt;code&gt;uncaughtException()&lt;/code&gt;æ–¹æ³•ï¼Œä¸Šé¢ç¤ºä¾‹ä»£ç ä¹Ÿæœ‰æåˆ°ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public class ThreadPoolExceptionTest {

    public static void main(String[] args) throws InterruptedException {
        MyHandler myHandler = new MyHandler();
        ExecutorService execute = new ThreadPoolExecutor(10, 10,
                0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&amp;lt;Runnable&amp;gt;(), new ThreadFactoryBuilder().setUncaughtExceptionHandler(myHandler).build());

        TimeUnit.SECONDS.sleep(5);
        for (int i = 0; i &amp;lt; 10; i++) {
            execute.execute(new MyRunner());
        }
    }
}

class MyHandler implements Thread.UncaughtExceptionHandler {
    private final static Logger LOGGER = LoggerFactory.getLogger(MyHandler.class);
    @Override
    public void uncaughtException(Thread t, Throwable e) {
        LOGGER.error(&quot;threadId = {}, threadName = {}, ex = {}&quot;, t.getId(), t.getName(), e.getMessage());
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;3 ç›´æ¥é‡å†™&lt;code&gt;afterExecute()&lt;/code&gt;æ–¹æ³•ï¼Œæ„ŸçŸ¥å¼‚å¸¸ç»†èŠ‚&lt;/p&gt;
&lt;h3 id=&quot;æ€»ç»“&quot;&gt;æ€»ç»“&lt;/h3&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œä¸çŸ¥é“å°ä¼™ä¼´ä»¬æœ‰æ²¡æœ‰ä¸€äº›æ„Ÿæ‚Ÿæˆ–æ”¶è·ï¼Ÿ&lt;/p&gt;
&lt;p&gt;é€šè¿‡è¿™å‡ ä¸ªé¢è¯•é—®é¢˜ï¼Œæˆ‘ä¹Ÿæ·±åˆ»çš„æ„Ÿå—åˆ°å­¦ä¹ çŸ¥è¯†è¦å¤šæ€è€ƒï¼Œçœ‹æºç çš„è¿‡ç¨‹ä¸­è¦å¤šè®¾ç½®ä¸€äº›åœºæ™¯ï¼Œè¿™æ ·æ‰ä¼šæ”¶è·æ›´å¤šã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/799093/202006/799093-20200615072709565-1835814448.png&quot; alt=&quot;åŸåˆ›å¹²è´§åˆ†äº«.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Sun, 14 Jun 2020 23:27:00 +0000</pubDate>
<dc:creator>ä¸€æèŠ±ç®—ä¸ç®—æµªæ¼«</dc:creator>
<og:description>å‰è¨€ è¿™æ˜¯ä¸€ä¸ªçœŸå®çš„é¢è¯•é¢˜ã€‚ å‰å‡ å¤©ä¸€ä¸ªæœ‹å‹åœ¨ç¾¤é‡Œåˆ†äº«äº†ä»–åˆšåˆšé¢è¯•å€™é€‰è€…æ—¶é—®çš„é—®é¢˜ï¼š&amp;amp;quot;çº¿ç¨‹æ± å¦‚ä½•æŒ‰ç…§coreã€maxã€queueçš„æ‰§è¡Œå¾ªåºå»æ‰§è¡Œï¼Ÿ&amp;amp;quot;ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“çº¿</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/wang-meng/p/13128890.html</dc:identifier>
</item>
<item>
<title>è€å¤§å©å’çš„å¯é‡å…¥åˆ†å¸ƒå¼é”ï¼Œç»ˆäºå®Œç¾çš„å®ç°äº†ï¼ï¼ï¼ - æ¥¼ä¸‹å°é»‘å“¥</title>
<link>http://www.cnblogs.com/goodAndyxublog/p/13128883.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/goodAndyxublog/p/13128883.html</guid>
<description>&lt;h2 id=&quot;é‡åšæ°¸è¿œæ¯”æ”¹é€ ç®€å•&quot;&gt;é‡åšæ°¸è¿œæ¯”æ”¹é€ ç®€å•&lt;/h2&gt;
&lt;p&gt;æœ€è¿‘åœ¨åšä¸€ä¸ªé¡¹ç›®ï¼Œå°†ä¸€ä¸ªå…¶ä»–å…¬å¸çš„å®ç°ç³»ç»Ÿï¼ˆ&lt;em&gt;ä¸‹æ–‡ç§°ä½œæ—§ç³»ç»Ÿ&lt;/em&gt;ï¼‰ï¼Œå®Œæ•´çš„æ•´åˆåˆ°è‡ªå·±å…¬å¸çš„ç³»ç»Ÿï¼ˆ&lt;em&gt;ä¸‹æ–‡ç§°ä½œæ–°ç³»ç»Ÿ&lt;/em&gt;ï¼‰ä¸­ï¼Œè¿™å…¶ä¸­éœ€è¦å°†å¯¹æ–¹å®ç°çš„åŠŸèƒ½å®Œæ•´åœ¨è‡ªå·±ç³»ç»Ÿä¹Ÿå®ç°ä¸€éã€‚&lt;/p&gt;
&lt;p&gt;æ—§ç³»ç»Ÿè¿˜æœ‰ä¸€æ‰¹å­˜é‡å•†æˆ·ï¼Œä¸ºäº†ä¸å½±å“å­˜é‡å•†æˆ·çš„ä½“éªŒï¼Œæ–°ç³»ç»Ÿæä¾›çš„å¯¹å¤–æ¥å£ï¼Œè¿˜å¿…é¡»å¾—è·Ÿä»¥å‰ä¸€è‡´ã€‚æœ€åç³»ç»Ÿå®Œæ•´åˆ‡æ¢ä¹‹åï¼ŒåŠŸèƒ½åªè¿è¡Œåœ¨æ–°ç³»ç»Ÿä¸­ï¼Œè¿™å°±è¦æ±‚æ—§ç³»ç»Ÿçš„æ•°æ®è¿˜éœ€è¦å®Œæ•´çš„è¿ç§»åˆ°æ–°ç³»ç»Ÿä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶è¿™äº›åœ¨åšè¿™ä¸ªé¡¹ç›®ä¹‹å‰å°±æœ‰é¢„æœŸï¼Œæƒ³è¿‡è¿™ä¸ªè¿‡ç¨‹å¾ˆéš¾ï¼Œä½†æ˜¯æ²¡æƒ³åˆ°æœ‰é‚£ä¹ˆéš¾ã€‚åŸæœ¬æ„Ÿè§‰æ’æœŸå¤§åŠå¹´ï¼Œæ—¶é—´è¿˜æ˜¯æŒºå®½è£•ï¼Œç°åœ¨æ„Ÿè§‰å°±æ˜¯å¤§å‘ï¼Œè¿˜ä¸å¾—ä¸åœ¨å‘é‡Œä¸€ç‚¹ç‚¹å»å¡«ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1419561/202006/1419561-20200615070959849-950502677.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å“ï¼Œè¯´å¤šéƒ½æ˜¯æ³ªï¼Œä¸åæ§½äº†ï¼Œç­‰åˆ°ä¸‹æ¬¡åšå®Œå†ç»™å¤§å®¶å¤ç›˜ä¸‹çœŸæ­£å¿ƒå¾—ä½“ä¼šã€‚&lt;/p&gt;
&lt;p&gt;å›åˆ°æ­£æ–‡ï¼Œä¸Šç¯‡æ–‡ç« &lt;a href=&quot;https://mp.weixin.qq.com/s/HlD46m-OP-HDdKJFxgqFYA&quot;&gt;Redis åˆ†å¸ƒå¼é”&lt;/a&gt;ï¼Œå’±ä»¬åŸºäº Redis å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é”ã€‚è¿™ä¸ªåˆ†å¸ƒå¼é”åŸºæœ¬åŠŸèƒ½æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ç¼ºå°‘å¯é‡å…¥çš„ç‰¹æ€§ï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« å°é»‘å“¥å°±å¸¦å¤§å®¶æ¥å®ç°ä¸€ä¸‹å¯é‡å…¥çš„åˆ†å¸ƒå¼é”ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç¯‡æ–‡ç« å°†ä¼šæ¶‰åŠä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å¯é‡å…¥&lt;/li&gt;
&lt;li&gt;åŸºäº ThreadLocal å®ç°æ–¹æ¡ˆ&lt;/li&gt;
&lt;li&gt;åŸºäº Redis Hash å®ç°æ–¹æ¡ˆ&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;å…ˆèµåçœ‹ï¼Œå…»æˆä¹ æƒ¯ã€‚å¾®ä¿¡æœç´¢ã€Œç¨‹åºé€šäº‹ã€ï¼Œå…³æ³¨å°±å®Œäº‹äº†~&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;å¯é‡å…¥&quot;&gt;å¯é‡å…¥&lt;/h2&gt;
&lt;p&gt;è¯´åˆ°å¯é‡å…¥é”ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ä¸€æ®µæ¥è‡ª &lt;a href=&quot;https://zh.wikipedia.org/wiki/%E5%8F%AF%E9%87%8D%E5%85%A5&quot;&gt;wiki&lt;/a&gt; ä¸Šå¯é‡å…¥çš„è§£é‡Šï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;è‹¥ä¸€ä¸ªç¨‹åºæˆ–å­ç¨‹åºå¯ä»¥â€œåœ¨ä»»æ„æ—¶åˆ»è¢«ä¸­æ–­ç„¶åæ“ä½œç³»ç»Ÿè°ƒåº¦æ‰§è¡Œå¦å¤–ä¸€æ®µä»£ç ï¼Œè¿™æ®µä»£ç åˆè°ƒç”¨äº†è¯¥å­ç¨‹åºä¸ä¼šå‡ºé”™â€ï¼Œåˆ™ç§°å…¶ä¸º&lt;strong&gt;å¯é‡å…¥&lt;/strong&gt;ï¼ˆreentrantæˆ–re-entrantï¼‰çš„ã€‚å³å½“è¯¥å­ç¨‹åºæ­£åœ¨è¿è¡Œæ—¶ï¼Œæ‰§è¡Œçº¿ç¨‹å¯ä»¥å†æ¬¡è¿›å…¥å¹¶æ‰§è¡Œå®ƒï¼Œä»ç„¶è·å¾—ç¬¦åˆè®¾è®¡æ—¶é¢„æœŸçš„ç»“æœã€‚ä¸å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹å®‰å…¨ä¸åŒï¼Œå¯é‡å…¥å¼ºè°ƒå¯¹å•ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶é‡æ–°è¿›å…¥åŒä¸€ä¸ªå­ç¨‹åºä»ç„¶æ˜¯å®‰å…¨çš„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€æ®µä»£ç æˆåŠŸè·å–é”ä¹‹åï¼Œç»§ç»­æ‰§è¡Œæ—¶ï¼Œåˆé‡åˆ°åŠ é”çš„ä»£ç ï¼Œå¯é‡å…¥æ€§å°±å°±ä¿è¯çº¿ç¨‹èƒ½ç»§ç»­æ‰§è¡Œï¼Œè€Œä¸å¯é‡å…¥å°±æ˜¯éœ€è¦ç­‰å¾…é”é‡Šæ”¾ä¹‹åï¼Œå†æ¬¡è·å–é”æˆåŠŸï¼Œæ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ç”¨ä¸€æ®µ Java ä»£ç è§£é‡Šå¯é‡å…¥ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public synchronized void a() {
    b();
}

public synchronized void b() {
    // pass
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å‡è®¾ X çº¿ç¨‹åœ¨ a æ–¹æ³•è·å–é”ä¹‹åï¼Œç»§ç»­æ‰§è¡Œ b æ–¹æ³•ï¼Œå¦‚æœæ­¤æ—¶&lt;strong&gt;ä¸å¯é‡å…¥&lt;/strong&gt;ï¼Œçº¿ç¨‹å°±å¿…é¡»ç­‰å¾…é”é‡Šæ”¾ï¼Œå†æ¬¡äº‰æŠ¢é”ã€‚&lt;/p&gt;
&lt;p&gt;é”æ˜æ˜æ˜¯è¢« X çº¿ç¨‹æ‹¥æœ‰ï¼Œå´è¿˜éœ€è¦ç­‰å¾…è‡ªå·±é‡Šæ”¾é”ï¼Œç„¶åå†å»æŠ¢é”ï¼Œè¿™çœ‹èµ·æ¥å°±å¾ˆå¥‡æ€ªï¼Œæˆ‘é‡Šæ”¾æˆ‘è‡ªå·±~&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1419561/202006/1419561-20200615071000003-1637972343.gif&quot; alt=&quot;æˆ‘æ‰“æˆ‘è‡ªå·±&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¯é‡å…¥æ€§å°±å¯ä»¥è§£å†³è¿™ä¸ªå°´å°¬çš„é—®é¢˜ï¼Œå½“çº¿ç¨‹æ‹¥æœ‰é”ä¹‹åï¼Œå¾€åå†é‡åˆ°åŠ é”æ–¹æ³•ï¼Œç›´æ¥å°†åŠ é”æ¬¡æ•°åŠ  1ï¼Œç„¶åå†æ‰§è¡Œæ–¹æ³•é€»è¾‘ã€‚é€€å‡ºåŠ é”æ–¹æ³•ä¹‹åï¼ŒåŠ é”æ¬¡æ•°å†å‡ 1ï¼Œå½“åŠ é”æ¬¡æ•°ä¸º 0 æ—¶ï¼Œé”æ‰è¢«çœŸæ­£çš„é‡Šæ”¾ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°å¯é‡å…¥é”æœ€å¤§ç‰¹æ€§å°±æ˜¯è®¡æ•°ï¼Œè®¡ç®—åŠ é”çš„æ¬¡æ•°ã€‚æ‰€ä»¥å½“å¯é‡å…¥é”éœ€è¦åœ¨åˆ†å¸ƒå¼ç¯å¢ƒå®ç°æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå°±éœ€è¦ç»Ÿè®¡åŠ é”æ¬¡æ•°ã€‚&lt;/p&gt;
&lt;p&gt;åˆ†å¸ƒå¼å¯é‡å…¥é”å®ç°æ–¹å¼æœ‰ä¸¤ç§ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;åŸºäº ThreadLocal å®ç°æ–¹æ¡ˆ&lt;/li&gt;
&lt;li&gt;åŸºäº Redis Hash å®ç°æ–¹æ¡ˆ&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹åŸºäº ThreadLocal å®ç°æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id=&quot;åŸºäº-threadlocal-å®ç°æ–¹æ¡ˆ&quot;&gt;åŸºäº ThreadLocal å®ç°æ–¹æ¡ˆ&lt;/h2&gt;
&lt;h3 id=&quot;å®ç°æ–¹å¼&quot;&gt;å®ç°æ–¹å¼&lt;/h3&gt;
&lt;p&gt;Java ä¸­ &lt;code&gt;ThreadLocal&lt;/code&gt;å¯ä»¥ä½¿æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„å®ä¾‹å‰¯æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§å¯¹çº¿ç¨‹é‡å…¥æ¬¡æ•°è¿›è¡ŒæŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª&lt;code&gt;ThreadLocal&lt;/code&gt;çš„å…¨å±€å˜é‡ &lt;code&gt;LOCKS&lt;/code&gt;ï¼Œå†…å­˜å­˜å‚¨ &lt;code&gt;Map&lt;/code&gt; å®ä¾‹å˜é‡ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-javascript&quot;&gt;private static ThreadLocal&amp;lt;Map&amp;lt;String, Integer&amp;gt;&amp;gt; LOCKS = ThreadLocal.withInitial(HashMap::new);
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥é€šè¿‡ &lt;code&gt;ThreadLocal&lt;/code&gt;è·å–è‡ªå·±çš„ &lt;code&gt;Map&lt;/code&gt;å®ä¾‹ï¼Œ&lt;code&gt;Map&lt;/code&gt; ä¸­ &lt;code&gt;key&lt;/code&gt; å­˜å‚¨é”çš„åç§°ï¼Œè€Œ &lt;code&gt;value&lt;/code&gt;å­˜å‚¨é”çš„é‡å…¥æ¬¡æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŠ é”çš„ä»£ç å¦‚ä¸‹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;/**
 * å¯é‡å…¥é”
 *
 * @param lockName  é”åå­—,ä»£è¡¨éœ€è¦äº‰ä¸´ç•Œèµ„æº
 * @param request   å”¯ä¸€æ ‡è¯†ï¼Œå¯ä»¥ä½¿ç”¨ uuidï¼Œæ ¹æ®è¯¥å€¼åˆ¤æ–­æ˜¯å¦å¯ä»¥é‡å…¥
 * @param leaseTime é”é‡Šæ”¾æ—¶é—´
 * @param unit      é”é‡Šæ”¾æ—¶é—´å•ä½
 * @return
 */
public Boolean tryLock(String lockName, String request, long leaseTime, TimeUnit unit) {
    Map&amp;lt;String, Integer&amp;gt; counts = LOCKS.get();
    if (counts.containsKey(lockName)) {
        counts.put(lockName, counts.get(lockName) + 1);
        return true;
    } else {
        if (redisLock.tryLock(lockName, request, leaseTime, unit)) {
            counts.put(lockName, 1);
            return true;
        }
    }
    return false;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;ps: &lt;code&gt;redisLock#tryLock&lt;/code&gt; ä¸ºä¸Šä¸€ç¯‡æ–‡ç« å®ç°çš„åˆ†å¸ƒé”ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºå…¬å·å¤–é“¾æ— æ³•ç›´æ¥è·³è½¬ï¼Œå…³æ³¨ã€&lt;strong&gt;ç¨‹åºé€šäº‹&lt;/strong&gt;ã€ï¼Œå›å¤&lt;strong&gt;åˆ†å¸ƒå¼é”&lt;/strong&gt;è·å–æºä»£ç ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åŠ é”æ–¹æ³•é¦–å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»å·²ç»æ‹¥æœ‰è¯¥é”ï¼Œè‹¥å·²ç»æ‹¥æœ‰ï¼Œç›´æ¥å¯¹é”çš„é‡å…¥æ¬¡æ•°åŠ  1ã€‚&lt;/p&gt;
&lt;p&gt;è‹¥è¿˜æ²¡æ‹¥æœ‰è¯¥é”ï¼Œåˆ™å°è¯•å» &lt;strong&gt;Redis&lt;/strong&gt; åŠ é”ï¼ŒåŠ é”æˆåŠŸä¹‹åï¼Œå†å¯¹é‡å…¥æ¬¡æ•°åŠ  1 ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é‡Šæ”¾é”çš„ä»£ç å¦‚ä¸‹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;/**
 * è§£é”éœ€è¦åˆ¤æ–­ä¸åŒçº¿ç¨‹æ± 
 *
 * @param lockName
 * @param request
 */
public void unlock(String lockName, String request) {
    Map&amp;lt;String, Integer&amp;gt; counts = LOCKS.get();
    if (counts.getOrDefault(lockName, 0) &amp;lt;= 1) {
        counts.remove(lockName);
        Boolean result = redisLock.unlock(lockName, request);
        if (!result) {
            throw new IllegalMonitorStateException(&quot;attempt to unlock lock, not locked by lockName:+&quot; + lockName + &quot; with request: &quot;
                    + request);
        }

    } else {
        counts.put(lockName, counts.get(lockName) - 1);
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;é‡Šæ”¾é”çš„æ—¶é¦–å…ˆåˆ¤æ–­é‡å…¥æ¬¡æ•°ï¼Œè‹¥å¤§äº 1ï¼Œåˆ™ä»£è¡¨è¯¥é”æ˜¯è¢«è¯¥çº¿ç¨‹æ‹¥æœ‰ï¼Œæ‰€ä»¥ç›´æ¥å°†é”é‡å…¥æ¬¡æ•°å‡ 1 å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;è‹¥å½“å‰å¯é‡å…¥æ¬¡æ•°å°äºç­‰äº 1ï¼Œé¦–å…ˆç§»é™¤ &lt;code&gt;Map&lt;/code&gt;ä¸­é”å¯¹åº”çš„ keyï¼Œç„¶åå†åˆ° Redis é‡Šæ”¾é”ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“é”æœªè¢«è¯¥çº¿ç¨‹æ‹¥æœ‰ï¼Œç›´æ¥è§£é”ï¼Œå¯é‡å…¥æ¬¡æ•°ä¹Ÿæ˜¯å°äºç­‰äº 1 ï¼Œè¿™æ¬¡å¯èƒ½æ— æ³•ç›´æ¥è§£é”æˆåŠŸã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;&lt;code&gt;ThreadLocal&lt;/code&gt; ä½¿ç”¨è¿‡ç¨‹è¦è®°å¾—åŠæ—¶æ¸…ç†å†…éƒ¨å­˜å‚¨å®ä¾‹å˜é‡ï¼Œé˜²æ­¢å‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œä¸Šä¸‹æ–‡æ•°æ®ä¸²ç”¨ç­‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹æ¬¡å’±æ¥èŠèŠæœ€è¿‘ä½¿ç”¨ &lt;code&gt;ThreadLocal&lt;/code&gt; å†™çš„ Bugã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;ç›¸å…³é—®é¢˜&quot;&gt;ç›¸å…³é—®é¢˜&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ &lt;code&gt;ThreadLocal&lt;/code&gt; è¿™ç§æœ¬åœ°è®°å½•é‡å…¥æ¬¡æ•°ï¼Œè™½ç„¶çœŸçš„ç®€å•é«˜æ•ˆï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿‡æœŸæ—¶é—´é—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šè¿°åŠ é”çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œé‡å…¥åŠ é”æ—¶ï¼Œä»…ä»…å¯¹æœ¬åœ°è®¡æ•°åŠ  1 è€Œå·²ã€‚è¿™æ ·å¯èƒ½å°±ä¼šå¯¼è‡´ä¸€ç§æƒ…å†µï¼Œç”±äºä¸šåŠ¡æ‰§è¡Œè¿‡é•¿ï¼ŒRedis å·²ç»è¿‡æœŸé‡Šæ”¾é”ã€‚&lt;/p&gt;
&lt;p&gt;è€Œå†æ¬¡é‡å…¥åŠ é”æ—¶ï¼Œç”±äºæœ¬åœ°è¿˜å­˜åœ¨æ•°æ®ï¼Œè®¤ä¸ºé”è¿˜åœ¨è¢«æŒæœ‰ï¼Œè¿™å°±ä¸ç¬¦åˆå®é™…æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè¦åœ¨æœ¬åœ°å¢åŠ è¿‡æœŸæ—¶é—´ï¼Œè¿˜éœ€è¦è€ƒè™‘æœ¬åœ°ä¸ Redis è¿‡æœŸæ—¶é—´ä¸€è‡´æ€§çš„ï¼Œä»£ç å°±ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸åŒçº¿ç¨‹/è¿›ç¨‹å¯é‡å…¥é—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç‹­ä¹‰ä¸Šå¯é‡å…¥æ€§åº”è¯¥åªæ˜¯å¯¹äº&lt;strong&gt;åŒä¸€çº¿ç¨‹&lt;/strong&gt;çš„å¯é‡å…¥ï¼Œä½†æ˜¯å®é™…ä¸šåŠ¡å¯èƒ½éœ€è¦ä¸åŒçš„åº”ç”¨çº¿ç¨‹ä¹‹é—´å¯ä»¥é‡å…¥åŒæŠŠé”ã€‚&lt;/p&gt;
&lt;p&gt;è€Œ &lt;code&gt;ThreadLocal&lt;/code&gt;çš„æ–¹æ¡ˆä»…ä»…åªèƒ½æ»¡è¶³åŒä¸€çº¿ç¨‹é‡å…¥ï¼Œæ— æ³•è§£å†³ä¸åŒçº¿ç¨‹/è¿›ç¨‹ä¹‹é—´é‡å…¥é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸åŒçº¿ç¨‹/è¿›ç¨‹é‡å…¥é—®é¢˜å°±éœ€è¦ä½¿ç”¨ä¸‹è¿°æ–¹æ¡ˆ Redis Hash æ–¹æ¡ˆè§£å†³ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åŸºäº-redis-hash-å¯é‡å…¥é”&quot;&gt;åŸºäº Redis Hash å¯é‡å…¥é”&lt;/h2&gt;
&lt;h3 id=&quot;å®ç°æ–¹å¼-2&quot;&gt;å®ç°æ–¹å¼&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;ThreadLocal&lt;/code&gt; çš„æ–¹æ¡ˆä¸­æˆ‘ä»¬ä½¿ç”¨äº† &lt;code&gt;Map&lt;/code&gt; è®°è½½é”çš„å¯é‡å…¥æ¬¡æ•°ï¼Œè€Œ Redis ä¹ŸåŒæ ·æä¾›äº† Hash ï¼ˆå“ˆå¸Œè¡¨ï¼‰è¿™ç§å¯ä»¥å­˜å‚¨é”®å€¼å¯¹æ•°æ®ç»“æ„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Redis Hash å­˜å‚¨çš„é”çš„é‡å…¥æ¬¡æ•°ï¼Œç„¶ååˆ©ç”¨ &lt;code&gt;lua&lt;/code&gt; è„šæœ¬åˆ¤æ–­é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;åŠ é”çš„ lua è„šæœ¬å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-lua&quot;&gt;---- 1 ä»£è¡¨ true
---- 0 ä»£è¡¨ false

if (redis.call('exists', KEYS[1]) == 0) then
    redis.call('hincrby', KEYS[1], ARGV[2], 1);
    redis.call('pexpire', KEYS[1], ARGV[1]);
    return 1;
end ;
if (redis.call('hexists', KEYS[1], ARGV[2]) == 1) then
    redis.call('hincrby', KEYS[1], ARGV[2], 1);
    redis.call('pexpire', KEYS[1], ARGV[1]);
    return 1;
end ;
return 0;
&lt;/code&gt;
&lt;/pre&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;å¦‚æœ KEYS:[lock],ARGV[1000,uuid]&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸ç†Ÿæ‚‰ lua è¯­è¨€åŒå­¦ä¹Ÿä¸è¦æ€•ï¼Œä¸Šè¿°é€»è¾‘è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ã€‚&lt;/p&gt;
&lt;p&gt;åŠ é”ä»£ç é¦–å…ˆä½¿ç”¨ Redis &lt;code&gt;exists&lt;/code&gt; å‘½ä»¤åˆ¤æ–­å½“å‰ lock è¿™ä¸ªé”æ˜¯å¦å­˜åœ¨ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœé”ä¸å­˜åœ¨çš„è¯ï¼Œç›´æ¥ä½¿ç”¨ &lt;code&gt;hincrby&lt;/code&gt;åˆ›å»ºä¸€ä¸ªé”®ä¸º &lt;code&gt;lock&lt;/code&gt; hash è¡¨ï¼Œå¹¶ä¸”ä¸º Hash è¡¨ä¸­é”®ä¸º &lt;code&gt;uuid&lt;/code&gt; åˆå§‹åŒ–ä¸º 0ï¼Œç„¶åå†æ¬¡åŠ  1ï¼Œæœ€åå†è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå½“å‰é”å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ &lt;code&gt;hexists&lt;/code&gt;åˆ¤æ–­å½“å‰ &lt;code&gt;lock&lt;/code&gt; å¯¹åº”çš„ hash è¡¨ä¸­æ˜¯å¦å­˜åœ¨ &lt;code&gt;uuid&lt;/code&gt; è¿™ä¸ªé”®ï¼Œå¦‚æœå­˜åœ¨,å†æ¬¡ä½¿ç”¨ &lt;code&gt;hincrby&lt;/code&gt; åŠ  1ï¼Œæœ€åå†æ¬¡è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åå¦‚æœä¸Šè¿°ä¸¤ä¸ªé€»è¾‘éƒ½ä¸ç¬¦åˆï¼Œç›´æ¥è¿”å›ã€‚&lt;/p&gt;
&lt;p&gt;åŠ é”ä»£ç å¦‚ä¸‹:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;// åˆå§‹åŒ–ä»£ç 

String lockLuaScript = IOUtils.toString(ResourceUtils.getURL(&quot;classpath:lock.lua&quot;).openStream(), Charsets.UTF_8);
lockScript = new DefaultRedisScript&amp;lt;&amp;gt;(lockLuaScript, Boolean.class);

/**
 * å¯é‡å…¥é”
 *
 * @param lockName  é”åå­—,ä»£è¡¨éœ€è¦äº‰ä¸´ç•Œèµ„æº
 * @param request   å”¯ä¸€æ ‡è¯†ï¼Œå¯ä»¥ä½¿ç”¨ uuidï¼Œæ ¹æ®è¯¥å€¼åˆ¤æ–­æ˜¯å¦å¯ä»¥é‡å…¥
 * @param leaseTime é”é‡Šæ”¾æ—¶é—´
 * @param unit      é”é‡Šæ”¾æ—¶é—´å•ä½
 * @return
 */
public Boolean tryLock(String lockName, String request, long leaseTime, TimeUnit unit) {
    long internalLockLeaseTime = unit.toMillis(leaseTime);
    return stringRedisTemplate.execute(lockScript, Lists.newArrayList(lockName), String.valueOf(internalLockLeaseTime), request);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;Spring-Boot 2.2.7.RELEASE&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åªè¦ææ‡‚ Lua è„šæœ¬åŠ é”é€»è¾‘ï¼ŒJava ä»£ç å®ç°è¿˜æ˜¯æŒºç®€å•çš„ï¼Œç›´æ¥ä½¿ç”¨ SpringBoot æä¾›çš„ &lt;code&gt;StringRedisTemplate&lt;/code&gt; å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;è§£é”çš„ Lua è„šæœ¬å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-lua&quot;&gt;-- åˆ¤æ–­ hash set å¯é‡å…¥ key çš„å€¼æ˜¯å¦ç­‰äº 0
-- å¦‚æœä¸º 0 ä»£è¡¨ è¯¥å¯é‡å…¥ key ä¸å­˜åœ¨
if (redis.call('hexists', KEYS[1], ARGV[1]) == 0) then
    return nil;
end ;
-- è®¡ç®—å½“å‰å¯é‡å…¥æ¬¡æ•°
local counter = redis.call('hincrby', KEYS[1], ARGV[1], -1);
-- å°äºç­‰äº 0 ä»£è¡¨å¯ä»¥è§£é”
if (counter &amp;gt; 0) then
    return 0;
else
    redis.call('del', KEYS[1]);
    return 1;
end ;
return nil;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;é¦–å…ˆä½¿ç”¨ &lt;code&gt;hexists&lt;/code&gt; åˆ¤æ–­ Redis Hash è¡¨æ˜¯å¦å­˜ç»™å®šçš„åŸŸã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœ lock å¯¹åº” Hash è¡¨ä¸å­˜åœ¨ï¼Œæˆ–è€… Hash è¡¨ä¸å­˜åœ¨ uuid è¿™ä¸ª keyï¼Œç›´æ¥è¿”å› &lt;code&gt;nil&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è‹¥å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œä»£è¡¨å½“å‰é”è¢«å…¶æŒæœ‰ï¼Œé¦–å…ˆä½¿ç”¨ &lt;code&gt;hincrby&lt;/code&gt;ä½¿å¯é‡å…¥æ¬¡æ•°å‡ 1 ï¼Œç„¶ååˆ¤æ–­è®¡ç®—ä¹‹åå¯é‡å…¥æ¬¡æ•°ï¼Œè‹¥å°äºç­‰äº 0ï¼Œåˆ™ä½¿ç”¨ &lt;code&gt;del&lt;/code&gt; åˆ é™¤è¿™æŠŠé”ã€‚&lt;/p&gt;
&lt;p&gt;è§£é”çš„ Java ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;// åˆå§‹åŒ–ä»£ç ï¼š


String unlockLuaScript = IOUtils.toString(ResourceUtils.getURL(&quot;classpath:unlock.lua&quot;).openStream(), Charsets.UTF_8);
unlockScript = new DefaultRedisScript&amp;lt;&amp;gt;(unlockLuaScript, Long.class);

/**
 * è§£é”
 * è‹¥å¯é‡å…¥ key æ¬¡æ•°å¤§äº 1ï¼Œå°†å¯é‡å…¥ key æ¬¡æ•°å‡ 1 &amp;lt;br&amp;gt;
 * è§£é” lua è„šæœ¬è¿”å›å«ä¹‰ï¼š&amp;lt;br&amp;gt;
 * 1:ä»£è¡¨è§£é”æˆåŠŸ &amp;lt;br&amp;gt;
 * 0:ä»£è¡¨é”æœªé‡Šæ”¾ï¼Œå¯é‡å…¥æ¬¡æ•°å‡ 1 &amp;lt;br&amp;gt;
 * nilï¼šä»£è¡¨å…¶ä»–çº¿ç¨‹å°è¯•è§£é” &amp;lt;br&amp;gt;
 * &amp;lt;p&amp;gt;
 * å¦‚æœä½¿ç”¨ DefaultRedisScript&amp;lt;Boolean&amp;gt;ï¼Œç”±äº Spring-data-redis eval ç±»å‹è½¬åŒ–ï¼Œ&amp;lt;br&amp;gt;
 * å½“ Redis è¿”å›  Nil bulk, é»˜è®¤å°†ä¼šè½¬åŒ–ä¸º falseï¼Œå°†ä¼šå½±å“è§£é”è¯­ä¹‰ï¼Œæ‰€ä»¥ä¸‹è¿°ä½¿ç”¨ï¼š&amp;lt;br&amp;gt;
 * DefaultRedisScript&amp;lt;Long&amp;gt;
 * &amp;lt;p&amp;gt;
 * å…·ä½“è½¬åŒ–ä»£ç è¯·æŸ¥çœ‹ï¼š&amp;lt;br&amp;gt;
 * JedisScriptReturnConverter&amp;lt;br&amp;gt;
 *
 * @param lockName é”åç§°
 * @param request  å”¯ä¸€æ ‡è¯†ï¼Œå¯ä»¥ä½¿ç”¨ uuid
 * @throws IllegalMonitorStateException è§£é”ä¹‹å‰ï¼Œè¯·å…ˆåŠ é”ã€‚è‹¥ä¸ºåŠ é”ï¼Œè§£é”å°†ä¼šæŠ›å‡ºè¯¥é”™è¯¯
 */
public void unlock(String lockName, String request) {
    Long result = stringRedisTemplate.execute(unlockScript, Lists.newArrayList(lockName), request);
    // å¦‚æœæœªè¿”å›å€¼ï¼Œä»£è¡¨å…¶ä»–çº¿ç¨‹å°è¯•è§£é”
    if (result == null) {
        throw new IllegalMonitorStateException(&quot;attempt to unlock lock, not locked by lockName:+&quot; + lockName + &quot; with request: &quot;
                + request);
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è§£é”ä»£ç æ‰§è¡Œæ–¹å¼ä¸åŠ é”ç±»ä¼¼ï¼Œåªä¸è¿‡è§£é”çš„æ‰§è¡Œç»“æœè¿”å›ç±»å‹ä½¿ç”¨ &lt;code&gt;Long&lt;/code&gt;ã€‚è¿™é‡Œä¹‹æ‰€ä»¥æ²¡æœ‰è·ŸåŠ é”ä¸€æ ·ä½¿ç”¨ &lt;code&gt;Boolean&lt;/code&gt; ,è¿™æ˜¯å› ä¸ºè§£é” lua è„šæœ¬ä¸­ï¼Œä¸‰ä¸ªè¿”å›å€¼å«ä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;1 ä»£è¡¨è§£é”æˆåŠŸï¼Œé”è¢«é‡Šæ”¾&lt;/li&gt;
&lt;li&gt;0 ä»£è¡¨å¯é‡å…¥æ¬¡æ•°è¢«å‡ 1&lt;/li&gt;
&lt;li&gt;&lt;code&gt;null&lt;/code&gt; ä»£è¡¨å…¶ä»–çº¿ç¨‹å°è¯•è§£é”ï¼Œè§£é”å¤±è´¥&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;å¦‚æœè¿”å›å€¼ä½¿ç”¨ &lt;code&gt;Boolean&lt;/code&gt;ï¼Œ&lt;strong&gt;Spring-data-redis&lt;/strong&gt; è¿›è¡Œç±»å‹è½¬æ¢æ—¶å°†ä¼šæŠŠ &lt;code&gt;null&lt;/code&gt; è½¬ä¸º falseï¼Œè¿™å°±ä¼šå½±å“æˆ‘ä»¬é€»è¾‘åˆ¤æ–­ï¼Œæ‰€ä»¥è¿”å›ç±»å‹åªå¥½ä½¿ç”¨ &lt;code&gt;Long&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹ä»£ç æ¥è‡ª &lt;code&gt;JedisScriptReturnConverter&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1419561/202006/1419561-20200615071000265-1799688379.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;ç›¸å…³é—®é¢˜-2&quot;&gt;ç›¸å…³é—®é¢˜&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;spring-data-redis ä½ç‰ˆæœ¬é—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœ Spring-Boot ä½¿ç”¨ Jedis ä½œä¸ºè¿æ¥å®¢æˆ·ç«¯,å¹¶ä¸”ä½¿ç”¨Redis Cluster é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦ä½¿ç”¨ &lt;strong&gt;2.1.9&lt;/strong&gt; ä»¥ä¸Šç‰ˆæœ¬çš„&lt;strong&gt;spring-boot-starter-data-redis&lt;/strong&gt;,ä¸ç„¶æ‰§è¡Œè¿‡ç¨‹ä¸­å°†ä¼šæŠ›å‡ºï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-log&quot;&gt;org.springframework.dao.InvalidDataAccessApiUsageException: EvalSha is not supported in cluster environment.
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¦‚æœå½“å‰åº”ç”¨æ— æ³•å‡çº§ &lt;code&gt;spring-data-redis&lt;/code&gt;ä¹Ÿæ²¡å…³ç³»ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼Œç›´æ¥ä½¿ç”¨åŸç”Ÿ Jedis è¿æ¥æ‰§è¡Œ lua è„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥åŠ é”ä»£ç ä¸ºä¾‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public boolean tryLock(String lockName, String reentrantKey, long leaseTime, TimeUnit unit) {
    long internalLockLeaseTime = unit.toMillis(leaseTime);
    Boolean result = stringRedisTemplate.execute((RedisCallback&amp;lt;Boolean&amp;gt;) connection -&amp;gt; {
        Object innerResult = eval(connection.getNativeConnection(), lockScript, Lists.newArrayList(lockName), Lists.newArrayList(String.valueOf(internalLockLeaseTime), reentrantKey));
        return convert(innerResult);
    });
    return result;
}

private Object eval(Object nativeConnection, RedisScript redisScript, final List&amp;lt;String&amp;gt; keys, final List&amp;lt;String&amp;gt; args) {

    Object innerResult = null;
    // é›†ç¾¤æ¨¡å¼å’Œå•ç‚¹æ¨¡å¼è™½ç„¶æ‰§è¡Œè„šæœ¬çš„æ–¹æ³•ä¸€æ ·ï¼Œä½†æ˜¯æ²¡æœ‰å…±åŒçš„æ¥å£ï¼Œæ‰€ä»¥åªèƒ½åˆ†å¼€æ‰§è¡Œ
    // é›†ç¾¤
    if (nativeConnection instanceof JedisCluster) {
        innerResult = evalByCluster((JedisCluster) nativeConnection, redisScript, keys, args);
    }
    // å•ç‚¹
    else if (nativeConnection instanceof Jedis) {
        innerResult = evalBySingle((Jedis) nativeConnection, redisScript, keys, args);
    }
    return innerResult;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®ç±»å‹è½¬åŒ–é—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨ Jedis åŸç”Ÿè¿æ¥æ‰§è¡Œ Lua è„šæœ¬ï¼Œé‚£ä¹ˆå¯èƒ½åˆä¼šç¢°åˆ°æ•°æ®ç±»å‹çš„è½¬æ¢å‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1419561/202006/1419561-20200615071000492-730832562.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ° &lt;code&gt;Jedis#eval&lt;/code&gt;è¿”å› &lt;code&gt;Object&lt;/code&gt;ï¼Œæˆ‘ä»¬éœ€è¦å…·ä½“æ ¹æ® Lua è„šæœ¬çš„è¿”å›å€¼çš„ï¼Œå†è¿›è¡Œç›¸å…³è½¬åŒ–ã€‚è¿™å…¶ä¸­å°±æ¶‰åŠåˆ° Lua æ•°æ®ç±»å‹è½¬åŒ–ä¸º Redis æ•°æ®ç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ä¸»è¦æˆ‘ä»¬æ¥è®²ä¸‹ Lua æ•°æ®è½¬åŒ– Redis çš„è§„åˆ™ä¸­å‡ æ¡æ¯”è¾ƒå®¹æ˜“è¸©å‘ï¼š&lt;/p&gt;
&lt;p&gt;1ã€Lua number ä¸ Redis æ•°æ®ç±»å‹è½¬æ¢&lt;/p&gt;
&lt;p&gt;Lua ä¸­ number ç±»å‹æ˜¯ä¸€ä¸ªåŒç²¾åº¦çš„æµ®ç‚¹æ•°ï¼Œä½†æ˜¯ Redis åªæ”¯æŒæ•´æ•°ç±»å‹ï¼Œæ‰€ä»¥è¿™ä¸ªè½¬åŒ–è¿‡ç¨‹å°†ä¼šä¸¢å¼ƒå°æ•°ä½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1419561/202006/1419561-20200615071000624-1930734144.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;2ã€Lua boolean ä¸ Redis ç±»å‹è½¬æ¢&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªè½¬åŒ–æ¯”è¾ƒå®¹æ˜“è¸©å‘ï¼ŒRedis ä¸­æ˜¯ä¸å­˜åœ¨ boolean ç±»å‹ï¼Œæ‰€ä»¥å½“Lua ä¸­ &lt;code&gt;true&lt;/code&gt; å°†ä¼šè½¬ä¸º Redis æ•´æ•° 1ã€‚è€Œ Lua ä¸­ &lt;code&gt;false&lt;/code&gt; å¹¶ä¸æ˜¯è½¬åŒ–æ•´æ•°ï¼Œè€Œæ˜¯è½¬åŒ– &lt;strong&gt;null&lt;/strong&gt; è¿”å›ç»™å®¢æˆ·ç«¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1419561/202006/1419561-20200615071000811-779991641.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;3ã€Lua nil ä¸ Redis ç±»å‹è½¬æ¢&lt;/p&gt;
&lt;p&gt;Lua nil å¯ä»¥å½“åšæ˜¯ä¸€ä¸ªç©ºå€¼ï¼Œå¯ä»¥ç­‰åŒäº Java ä¸­çš„ &lt;strong&gt;null&lt;/strong&gt;ã€‚åœ¨ Lua ä¸­å¦‚æœ nil å‡ºç°åœ¨æ¡ä»¶è¡¨è¾¾å¼ï¼Œå°†ä¼šå½“åš false å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ Lua nil ä¹Ÿå°†ä¼š &lt;strong&gt;null&lt;/strong&gt; è¿”å›ç»™å®¢æˆ·ç«¯ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä»–è½¬åŒ–è§„åˆ™æ¯”è¾ƒç®€å•ï¼Œè¯¦æƒ…å‚è€ƒ:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&quot;http://doc.redisfans.com/script/eval.html&quot;&gt;http://doc.redisfans.com/script/eval.html&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;æ€»ç»“&quot;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å¯é‡å…¥åˆ†å¸ƒå¼é”å…³é”®åœ¨äºå¯¹äºé”é‡å…¥çš„è®¡æ•°ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦ç»™å‡ºä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œä¸€ç§åŸºäº &lt;code&gt;ThreadLocal&lt;/code&gt; å®ç°æ–¹æ¡ˆï¼Œè¿™ç§æ–¹æ¡ˆå®ç°ç®€å•ï¼Œè¿è¡Œä¹Ÿæ¯”è¾ƒé«˜æ•ˆã€‚ä½†æ˜¯è‹¥è¦å¤„ç†é”è¿‡æœŸçš„é—®é¢˜ï¼Œä»£ç å®ç°å°±æ¯”è¾ƒå¤æ‚ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€ç§é‡‡ç”¨ Redis Hash æ•°æ®ç»“æ„å®ç°æ–¹æ¡ˆï¼Œè§£å†³äº† &lt;code&gt;ThreadLocal&lt;/code&gt; çš„ç¼ºé™·ï¼Œä½†æ˜¯ä»£ç å®ç°éš¾åº¦ç¨å¤§ï¼Œéœ€è¦ç†Ÿæ‚‰ Lua è„šæœ¬ï¼Œä»¥åŠRedis ä¸€äº›å‘½ä»¤ã€‚å¦å¤–ä½¿ç”¨ &lt;strong&gt;spring-data-redis&lt;/strong&gt; ç­‰æ“ä½œ Redis æ—¶ä¸ç»æ„é—´å°±ä¼šé‡åˆ°å„ç§é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å¸®åŠ©&quot;&gt;å¸®åŠ©&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.sofastack.tech/blog/sofa-jraft-rheakv-distributedlock/&quot;&gt;https://www.sofastack.tech/blog/sofa-jraft-rheakv-distributedlock/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://tech.meituan.com/2016/09/29/distributed-system-mutually-exclusive-idempotence-cerberus-gtis.html&quot;&gt;https://tech.meituan.com/2016/09/29/distributed-system-mutually-exclusive-idempotence-cerberus-gtis.html&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;æœ€åè¯´ä¸¤å¥ï¼ˆæ±‚å…³æ³¨ï¼‰&quot;&gt;æœ€åè¯´ä¸¤å¥ï¼ˆæ±‚å…³æ³¨ï¼‰&lt;/h2&gt;
&lt;p&gt;çœ‹å®Œæ–‡ç« ï¼Œå“¥å“¥å§å§ä»¬ç‚¹ä¸ª&lt;strong&gt;èµ&lt;/strong&gt;å§ï¼Œå‘¨æ›´çœŸçš„è¶…ç´¯ï¼Œä¸çŸ¥è§‰åˆå†™äº†ä¸¤å¤©ï¼Œæ‹’ç»ç™½å«–ï¼Œæ¥ç‚¹æ­£åé¦ˆå‘—~ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åæ„Ÿè°¢å„ä½çš„é˜…è¯»ï¼Œæ‰ç–å­¦æµ…ï¼Œéš¾å…å­˜åœ¨çº°æ¼ï¼Œå¦‚æœä½ å‘ç°é”™è¯¯çš„åœ°æ–¹ï¼Œå¯ä»¥ç•™è¨€æŒ‡å‡ºã€‚å¦‚æœçœ‹å®Œæ–‡ç« è¿˜æœ‰å…¶ä»–ä¸æ‡‚çš„åœ°æ–¹ï¼Œæ¬¢è¿åŠ æˆ‘ï¼Œäº’ç›¸å­¦ä¹ ï¼Œä¸€èµ·æˆé•¿~&lt;/p&gt;
&lt;p&gt;æœ€åè°¢è°¢å¤§å®¶æ”¯æŒ~&lt;/p&gt;
&lt;p&gt;æœ€æœ€åï¼Œé‡è¦çš„äº‹å†è¯´ä¸€ç¯‡~&lt;/p&gt;
&lt;p&gt;å¿«æ¥å…³æ³¨æˆ‘å‘€~&lt;br/&gt;å¿«æ¥å…³æ³¨æˆ‘å‘€~&lt;br/&gt;å¿«æ¥å…³æ³¨æˆ‘å‘€~&lt;/p&gt;
&lt;blockquote readability=&quot;5.5384615384615&quot;&gt;
&lt;p&gt;æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼šç¨‹åºé€šäº‹ï¼Œè·å¾—æ—¥å¸¸å¹²è´§æ¨é€ã€‚å¦‚æœæ‚¨å¯¹æˆ‘çš„ä¸“é¢˜å†…å®¹æ„Ÿå…´è¶£ï¼Œä¹Ÿå¯ä»¥å…³æ³¨æˆ‘çš„åšå®¢ï¼š&lt;a href=&quot;https://studyidea.cn&quot;&gt;studyidea.cn&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</description>
<pubDate>Sun, 14 Jun 2020 23:10:00 +0000</pubDate>
<dc:creator>æ¥¼ä¸‹å°é»‘å“¥</dc:creator>
<og:description>é‡åšæ°¸è¿œæ¯”æ”¹é€ ç®€å• æœ€è¿‘åœ¨åšä¸€ä¸ªé¡¹ç›®ï¼Œå°†ä¸€ä¸ªå…¶ä»–å…¬å¸çš„å®ç°ç³»ç»Ÿï¼ˆä¸‹æ–‡ç§°ä½œæ—§ç³»ç»Ÿï¼‰ï¼Œå®Œæ•´çš„æ•´åˆåˆ°è‡ªå·±å…¬å¸çš„ç³»ç»Ÿï¼ˆä¸‹æ–‡ç§°ä½œæ–°ç³»ç»Ÿï¼‰ä¸­ï¼Œè¿™å…¶ä¸­éœ€è¦å°†å¯¹æ–¹å®ç°çš„åŠŸèƒ½å®Œæ•´åœ¨è‡ªå·±ç³»ç»Ÿä¹Ÿå®ç°ä¸€éã€‚ æ—§ç³»ç»Ÿè¿˜æœ‰ä¸€æ‰¹å­˜</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/goodAndyxublog/p/13128883.html</dc:identifier>
</item>
<item>
<title>æ›¹å·¥è¯´Redisæºç ï¼ˆ8ï¼‰--é¢è¯•æ—¶ï¼Œredis å†…å­˜æ·˜æ±°æ€»è¢«é—®ï¼Œä½†æ˜¯æ€»ç­”ä¸å¥½ - ä¸‰å›½æ¢¦å›</title>
<link>http://www.cnblogs.com/grey-wolf/p/13128882.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/grey-wolf/p/13128882.html</guid>
<description>&lt;p&gt;Redisæºç ç³»åˆ—çš„åˆè¡·ï¼Œæ˜¯å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£Redisï¼Œæ›´æ‡‚Redisï¼Œè€Œæ€ä¹ˆæ‰èƒ½æ‡‚ï¼Œå…‰çœ‹æ˜¯ä¸å¤Ÿçš„ï¼Œå»ºè®®è·Ÿç€ä¸‹é¢çš„è¿™ä¸€ç¯‡ï¼ŒæŠŠç¯å¢ƒæ­å»ºèµ·æ¥ï¼Œåç»­å¯ä»¥è‡ªå·±é˜…è¯»æºç ï¼Œæˆ–è€…è·Ÿç€æˆ‘è¿™è¾¹ä¸€èµ·é˜…è¯»ã€‚ç”±äºæˆ‘ç”¨cä¹Ÿæ˜¯å¥½å‡ å¹´ä»¥å‰äº†ï¼Œäº›è®¸é”™è¯¯åœ¨æ‰€éš¾å…ï¼Œå¸Œæœ›è¯»è€…èƒ½ä¸åæŒ‡å‡ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/grey-wolf/p/12637730.html&quot;&gt;æ›¹å·¥è¯´Redisæºç ï¼ˆ1ï¼‰-- redis debugç¯å¢ƒæ­å»ºï¼Œä½¿ç”¨clionï¼Œè¾¾åˆ°å’Œè°ƒè¯•javaä¸€æ ·çš„æ•ˆæœ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/grey-wolf/p/12682760.html&quot;&gt;æ›¹å·¥è¯´Redisæºç ï¼ˆ2ï¼‰-- redis server å¯åŠ¨è¿‡ç¨‹è§£æåŠç®€å•cè¯­è¨€åŸºç¡€çŸ¥è¯†è¡¥å……&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/grey-wolf/p/12685918.html&quot;&gt;æ›¹å·¥è¯´Redisæºç ï¼ˆ3ï¼‰-- redis server å¯åŠ¨è¿‡ç¨‹å®Œæ•´è§£æï¼ˆä¸­ï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/grey-wolf/p/12694767.html&quot;&gt;æ›¹å·¥è¯´Redisæºç ï¼ˆ4ï¼‰-- é€šè¿‡redis serveræºç æ¥ç†è§£ listen å‡½æ•°ä¸­çš„ backlog å‚æ•°&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/grey-wolf/p/12709257.html&quot;&gt;æ›¹å·¥è¯´Redisæºç ï¼ˆ5ï¼‰-- redis server å¯åŠ¨è¿‡ç¨‹è§£æï¼Œä»¥åŠEventLoopæ¯æ¬¡å¤„ç†äº‹ä»¶å‰çš„å‰ç½®å·¥ä½œè§£æï¼ˆä¸‹ï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/grey-wolf/p/12728548.html&quot;&gt;æ›¹å·¥è¯´Redisæºç ï¼ˆ6ï¼‰-- redis server ä¸»å¾ªç¯å¤§ä½“æµç¨‹è§£æ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/grey-wolf/p/12748424.html&quot;&gt;æ›¹å·¥è¯´Redisæºç ï¼ˆ7ï¼‰-- redis server çš„å‘¨æœŸæ‰§è¡Œä»»åŠ¡ï¼Œåˆ°åº•è¦åšäº›å•¥&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;å†…å­˜æ·˜æ±°ï¼Œå’Œå¹³æ—¶æˆ‘ä»¬è®¾ç½®redis keyçš„è¿‡æœŸæ—¶é—´ï¼Œä¸æ˜¯ä¸€å›äº‹ï¼›å†…å­˜æ·˜æ±°æ˜¯è¯´ï¼Œå‡è®¾æˆ‘ä»¬é™å®šredisåªèƒ½ä½¿ç”¨8gå†…å­˜ï¼Œç°åœ¨å·²ç»ä½¿ç”¨äº†è¿™ä¹ˆå¤šäº†ï¼ˆåŒ…æ‹¬è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyå’Œæ²¡è®¾è¿‡æœŸæ—¶é—´çš„keyï¼‰ï¼Œé‚£ï¼Œåç»­çš„setæ“ä½œï¼Œè¿˜æ€ä¹ˆåŠå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ˜¯ä¸æ˜¯åªèƒ½æŠ¥é”™äº†ï¼Ÿ&lt;/p&gt;
&lt;p&gt;é‚£ä¸è¡Œå•Šï¼Œä¸ç§‘å­¦å§ï¼Œå› ä¸ºæœ‰çš„keyï¼Œå¯èƒ½å·²ç»å¾ˆä¹…æ²¡äººç”¨äº†ï¼Œå¯èƒ½ä»¥åä¹Ÿä¸ä¼šå†ç”¨åˆ°äº†ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æŠŠè¿™ç±»keyç»™å¹²æ‰å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¹²æ‰keyçš„è¿‡ç¨‹ï¼Œå°±æ˜¯å†…å­˜æ·˜æ±°ã€‚&lt;/p&gt;

&lt;p&gt;å½“æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶é‡Œè®¾ç½®äº†å¦‚ä¸‹å±æ€§æ—¶ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;# maxmemory &amp;lt;bytes&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;é»˜è®¤ï¼Œè¯¥å±æ€§æ˜¯è¢«æ³¨é‡Šæ‰çš„ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®ï¼Œè¿™ä¸ªé…ç½®é¡¹çš„æ³¨é‡Šï¼Œç›¸å½“æœ‰ä»·å€¼ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;# Don't use more memory than the specified amount of bytes.
# When the memory limit is reached Redis will try to remove keys
# according to the eviction policy selected (see maxmemory-policy).
#
# If Redis can't remove keys according to the policy, or if the policy is
# set to 'noeviction', Redis will start to reply with errors to commands
# that would use more memory, like SET, LPUSH, and so on, and will continue
# to reply to read-only commands like GET.
#
# This option is usually useful when using Redis as an LRU cache, or to set
# a hard memory limit for an instance (using the 'noeviction' policy).
#
# WARNING: If you have slaves attached to an instance with maxmemory on,
# the size of the output buffers needed to feed the slaves are subtracted
# from the used memory count, so that network problems / resyncs will
# not trigger a loop where keys are evicted, and in turn the output
# buffer of slaves is full with DELs of keys evicted triggering the deletion
# of more keys, and so forth until the database is completely emptied.
#
# In short... if you have slaves attached it is suggested that you set a lower
# limit for maxmemory so that there is some free RAM on the system for slave
# output buffers (but this is not needed if the policy is 'noeviction').
#
# maxmemory &amp;lt;bytes&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ¸£ç¿»è¯‘å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;13&quot;&gt;
&lt;p&gt;ä¸èƒ½ä½¿ç”¨è¶…è¿‡æŒ‡å®šæ•°é‡bytesçš„å†…å­˜ã€‚å½“è¯¥å†…å­˜é™åˆ¶è¢«è¾¾åˆ°æ—¶ï¼Œredisä¼šæ ¹æ®è¿‡æœŸç­–ç•¥ï¼ˆeviction policyï¼Œé€šè¿‡å‚æ•° maxmemory-policyæ¥æŒ‡å®šï¼‰æ¥é©±é€keyã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœredisæ ¹æ®æŒ‡å®šçš„ç­–ç•¥ï¼Œæˆ–è€…ç­–ç•¥è¢«è®¾ç½®ä¸ºâ€œnoevictionâ€ï¼Œredisä¼šå¼€å§‹é’ˆå¯¹å¦‚ä¸‹è¿™ç§å‘½ä»¤ï¼Œå›å¤é”™è¯¯ã€‚ä»€ä¹ˆå‘½ä»¤å‘¢ï¼Ÿä¼šä½¿ç”¨æ›´å¤šå†…å­˜çš„é‚£ç±»å‘½ä»¤ï¼Œæ¯”å¦‚setã€lpushï¼›åªè¯»å‘½ä»¤è¿˜æ˜¯ä¸å—å½±å“ï¼Œå¯ä»¥æ­£å¸¸å“åº”ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥é€‰é¡¹é€šå¸¸åœ¨redisä½¿ç”¨LRUç¼“å­˜æ—¶æœ‰ç”¨ï¼Œæˆ–è€…åœ¨ä½¿ç”¨noevictionç­–ç•¥æ—¶ï¼Œè®¾ç½®ä¸€ä¸ªè¿›ç¨‹çº§åˆ«çš„å†…å­˜limitã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ‰€è°“ç­–ç•¥ï¼Œæ„æ€æ˜¯ï¼Œå½“æˆ‘ä»¬è¦åˆ é™¤éƒ¨åˆ†keyçš„æ—¶å€™ï¼Œåˆ å“ªäº›ï¼Œä¸åˆ å“ªäº›ï¼Ÿæ˜¯ä¸æ˜¯éœ€è¦ä¸€ä¸ªç­–ç•¥ï¼Ÿæ¯”å¦‚æ˜¯éšæœºåˆ ï¼Œå°±åƒç­éœ¸ä¸€æ ·ï¼Ÿè¿˜æ˜¯æŒ‰ç…§lruæ—¶é—´æ¥åˆ ï¼Œlruçš„ç­–ç•¥æ„æ€å°±æ˜¯ï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„keyï¼Œå°†è¢«ä¼˜å…ˆåˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œæˆ‘ä»¬éœ€è¦å®šä¸€ä¸ªè§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;redisé»˜è®¤æ”¯æŒä»¥ä¸‹ç­–ç•¥ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;# MAXMEMORY POLICY: how Redis will select what to remove when maxmemory
# is reached. You can select among five behaviors:
# 
# volatile-lru -&amp;gt; remove the key with an expire set using an LRU algorithm
# allkeys-lru -&amp;gt; remove any key accordingly to the LRU algorithm
# volatile-random -&amp;gt; remove a random key with an expire set
# allkeys-random -&amp;gt; remove a random key, any key
# volatile-ttl -&amp;gt; remove the key with the nearest expire time (minor TTL)
# noeviction -&amp;gt; don't expire at all, just return an error on write operations
# 
# Note: with any of the above policies, Redis will return an error on write
#       operations, when there are not suitable keys for eviction.
#
#       At the date of writing this commands are: set setnx setex append
#       incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd
#       sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby
#       zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby
#       getset mset msetnx exec sort
#
# The default is:
#
# maxmemory-policy noeviction
maxmemory-policy allkeys-lru
&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;é’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ï¼Œä½¿ç”¨lruç®—æ³•
# volatile-lru -&amp;gt; remove the key with an expire set using an LRU algorithm

é’ˆå¯¹å…¨éƒ¨keyï¼Œä½¿ç”¨lruç®—æ³•
# allkeys-lru -&amp;gt; remove any key accordingly to the LRU algorithm

é’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ï¼Œéšæœºåˆ 
# volatile-random -&amp;gt; remove a random key with an expire set

é’ˆå¯¹å…¨éƒ¨keyï¼Œéšæœºåˆ 
# allkeys-random -&amp;gt; remove a random key, any key

é’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ï¼Œé©¬ä¸Šè¦è¿‡æœŸçš„ï¼Œåˆ æ‰
# volatile-ttl -&amp;gt; remove the key with the nearest expire time (minor TTL)

ä¸è¿‡æœŸï¼Œä¸èƒ½å†™äº†ï¼Œå°±æŠ¥é”™
# noeviction -&amp;gt; don't expire at all, just return an error on write operations
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸€èˆ¬å‘¢ï¼Œæˆ‘ä»¬ä¼šè®¾ç½®ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;allkeys-lru&lt;/code&gt;ï¼Œå³ï¼Œé’ˆå¯¹å…¨éƒ¨keyï¼Œè¿›è¡Œlruã€‚&lt;/p&gt;

&lt;h2 id=&quot;é…ç½®è¯»å–&quot;&gt;é…ç½®è¯»å–&lt;/h2&gt;
&lt;p&gt;åœ¨å¦‚ä¸‹ç»“æ„ä½“ä¸­ï¼Œå®šä¹‰äº†å¦‚ä¸‹å­—æ®µï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;struct redisServer {
        ...
        unsigned long long maxmemory;   /* Max number of memory bytes to use */
    int maxmemory_policy;           /* Policy for key eviction */
    int maxmemory_samples;          /* Pricision of random sampling */
    ...
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å½“æˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿›å…¥å¦‚ä¸‹é…ç½®æ—¶ï¼Œè¯¥ç»“æ„ä½“ä¸­å‡ ä¸ªå­—æ®µçš„å€¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;maxmemory 3mb
maxmemory-policy allkeys-lru
# maxmemory-samples 5  è¿™ä¸ªå–äº†é»˜è®¤å€¼
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/519126/202006/519126-20200614100616444-1893913670.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;maxmemory_policyä¸º3ï¼Œæ˜¯å› ä¸ºæšä¸¾å€¼ä¸º3ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;#define REDIS_MAXMEMORY_VOLATILE_LRU 0
#define REDIS_MAXMEMORY_VOLATILE_TTL 1
#define REDIS_MAXMEMORY_VOLATILE_RANDOM 2
#define REDIS_MAXMEMORY_ALLKEYS_LRU 3
#define REDIS_MAXMEMORY_ALLKEYS_RANDOM 4
#define REDIS_MAXMEMORY_NO_EVICTION 5
#define REDIS_DEFAULT_MAXMEMORY_POLICY REDIS_MAXMEMORY_NO_EVICTION
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;å¤„ç†å‘½ä»¤æ—¶ï¼Œåˆ¤æ–­æ˜¯å¦è¿›è¡Œå†…å­˜æ·˜æ±°&quot;&gt;å¤„ç†å‘½ä»¤æ—¶ï¼Œåˆ¤æ–­æ˜¯å¦è¿›è¡Œå†…å­˜æ·˜æ±°&lt;/h2&gt;
&lt;p&gt;åœ¨å¤„ç†å‘½ä»¤çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨ä¸­çš„&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;redis.c  processCommand
    
int processCommand(redisClient *c) {
    /* The QUIT command is handled separately. Normal command procs will
     * go through checking for replication and QUIT will cause trouble
     * when FORCE_REPLICATION is enabled and would be implemented in
     * a regular command proc. */
    // ç‰¹åˆ«å¤„ç† quit å‘½ä»¤
    void *commandName = c-&amp;gt;argv[0]-&amp;gt;ptr;
    redisLog(REDIS_NOTICE, &quot;The server is now processing %s&quot;, commandName);

    if (!strcasecmp(c-&amp;gt;argv[0]-&amp;gt;ptr, &quot;quit&quot;)) {
        addReply(c, shared.ok);
        c-&amp;gt;flags |= REDIS_CLOSE_AFTER_REPLY;
        return REDIS_ERR;
    }

    /* Now lookup the command and check ASAP about trivial error conditions
     * such as wrong arity, bad command name and so forth. */
    // 1 æŸ¥æ‰¾å‘½ä»¤ï¼Œå¹¶è¿›è¡Œå‘½ä»¤åˆæ³•æ€§æ£€æŸ¥ï¼Œä»¥åŠå‘½ä»¤å‚æ•°ä¸ªæ•°æ£€æŸ¥
    c-&amp;gt;cmd = c-&amp;gt;lastcmd = lookupCommand(c-&amp;gt;argv[0]-&amp;gt;ptr);
    if (!c-&amp;gt;cmd) {
        // æ²¡æ‰¾åˆ°æŒ‡å®šçš„å‘½ä»¤
        flagTransaction(c);
        addReplyErrorFormat(c, &quot;unknown command '%s'&quot;,
                            (char *) c-&amp;gt;argv[0]-&amp;gt;ptr);
        return REDIS_OK;
    }

    /* Check if the user is authenticated */
    //2 æ£€æŸ¥è®¤è¯ä¿¡æ¯
    if (server.requirepass &amp;amp;&amp;amp; !c-&amp;gt;authenticated &amp;amp;&amp;amp; c-&amp;gt;cmd-&amp;gt;proc != authCommand) {
        flagTransaction(c);
        addReply(c, shared.noautherr);
        return REDIS_OK;
    }

    /* If cluster is enabled perform the cluster redirection here.
     *
     * 3 å¦‚æœå¼€å¯äº†é›†ç¾¤æ¨¡å¼ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œè¿›è¡Œè½¬å‘æ“ä½œã€‚
     *
     * However we don't perform the redirection if:
     *
     * ä¸è¿‡ï¼Œå¦‚æœæœ‰ä»¥ä¸‹æƒ…å†µå‡ºç°ï¼Œé‚£ä¹ˆèŠ‚ç‚¹ä¸è¿›è¡Œè½¬å‘ï¼š
     *
     * 1) The sender of this command is our master.
     *    å‘½ä»¤çš„å‘é€è€…æ˜¯æœ¬èŠ‚ç‚¹çš„ä¸»èŠ‚ç‚¹
     *
     * 2) The command has no key arguments. 
     *    å‘½ä»¤æ²¡æœ‰ key å‚æ•°
     */
    if (server.cluster_enabled &amp;amp;&amp;amp;
        !(c-&amp;gt;flags &amp;amp; REDIS_MASTER) &amp;amp;&amp;amp;
        !(c-&amp;gt;cmd-&amp;gt;getkeys_proc == NULL &amp;amp;&amp;amp; c-&amp;gt;cmd-&amp;gt;firstkey == 0)) {
        int hashslot;

        // é›†ç¾¤å·²ä¸‹çº¿
        if (server.cluster-&amp;gt;state != REDIS_CLUSTER_OK) {
            flagTransaction(c);
            addReplySds(c, sdsnew(&quot;-CLUSTERDOWN The cluster is down. Use CLUSTER INFO for more information\r\n&quot;));
            return REDIS_OK;

            // é›†ç¾¤è¿ä½œæ­£å¸¸
        } else {
            int error_code;
            clusterNode *n = getNodeByQuery(c, c-&amp;gt;cmd, c-&amp;gt;argv, c-&amp;gt;argc, &amp;amp;hashslot, &amp;amp;error_code);
            // ä¸èƒ½æ‰§è¡Œå¤šé”®å¤„ç†å‘½ä»¤
            if (n == NULL) {
                flagTransaction(c);
                if (error_code == REDIS_CLUSTER_REDIR_CROSS_SLOT) {
                    addReplySds(c, sdsnew(&quot;-CROSSSLOT Keys in request don't hash to the same slot\r\n&quot;));
                } else if (error_code == REDIS_CLUSTER_REDIR_UNSTABLE) {
                    /* The request spawns mutliple keys in the same slot,
                     * but the slot is not &quot;stable&quot; currently as there is
                     * a migration or import in progress. */
                    addReplySds(c, sdsnew(&quot;-TRYAGAIN Multiple keys request during rehashing of slot\r\n&quot;));
                } else {
                    redisPanic(&quot;getNodeByQuery() unknown error.&quot;);
                }
                return REDIS_OK;

                //3.1 å‘½ä»¤é’ˆå¯¹çš„æ§½å’Œé”®ä¸æ˜¯æœ¬èŠ‚ç‚¹å¤„ç†çš„ï¼Œè¿›è¡Œè½¬å‘
            } else if (n != server.cluster-&amp;gt;myself) {
                flagTransaction(c);
                // -&amp;lt;ASK or MOVED&amp;gt; &amp;lt;slot&amp;gt; &amp;lt;ip&amp;gt;:&amp;lt;port&amp;gt;
                // ä¾‹å¦‚ -ASK 10086 127.0.0.1:12345
                addReplySds(c, sdscatprintf(sdsempty(),
                                            &quot;-%s %d %s:%d\r\n&quot;,
                                            (error_code == REDIS_CLUSTER_REDIR_ASK) ? &quot;ASK&quot; : &quot;MOVED&quot;,
                                            hashslot, n-&amp;gt;ip, n-&amp;gt;port));

                return REDIS_OK;
            }

            // å¦‚æœæ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜é”® key æ‰€åœ¨çš„æ§½ç”±æœ¬èŠ‚ç‚¹å¤„ç†
            // æˆ–è€…å®¢æˆ·ç«¯æ‰§è¡Œçš„æ˜¯æ— å‚æ•°å‘½ä»¤
        }
    }

    /* Handle the maxmemory directive.
     *
     * First we try to free some memory if possible (if there are volatile
     * keys in the dataset). If there are not the only thing we can do
     * is returning an error. */
    //4 å¦‚æœè®¾ç½®äº†æœ€å¤§å†…å­˜ï¼Œé‚£ä¹ˆæ£€æŸ¥å†…å­˜æ˜¯å¦è¶…è¿‡é™åˆ¶ï¼Œå¹¶åšç›¸åº”çš„æ“ä½œ
    if (server.maxmemory) {
        //4.1 å¦‚æœå†…å­˜å·²è¶…è¿‡é™åˆ¶ï¼Œé‚£ä¹ˆå°è¯•é€šè¿‡åˆ é™¤è¿‡æœŸé”®æ¥é‡Šæ”¾å†…å­˜
        int retval = freeMemoryIfNeeded();
        // å¦‚æœå³å°†è¦æ‰§è¡Œçš„å‘½ä»¤å¯èƒ½å ç”¨å¤§é‡å†…å­˜ï¼ˆREDIS_CMD_DENYOOMï¼‰
        // å¹¶ä¸”å‰é¢çš„å†…å­˜é‡Šæ”¾å¤±è´¥çš„è¯
        // é‚£ä¹ˆå‘å®¢æˆ·ç«¯è¿”å›å†…å­˜é”™è¯¯
        if ((c-&amp;gt;cmd-&amp;gt;flags &amp;amp; REDIS_CMD_DENYOOM) &amp;amp;&amp;amp; retval == REDIS_ERR) {
            flagTransaction(c);
            addReply(c, shared.oomerr);
            return REDIS_OK;
        }
    }    
    ....
&lt;/code&gt;
&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;1å¤„ï¼ŒæŸ¥æ‰¾å‘½ä»¤ï¼Œå¯¹åº”çš„å‡½æ•°æŒ‡é’ˆï¼ˆç±»ä¼¼äºjavaé‡Œçš„ç­–ç•¥æ¨¡å¼ï¼Œæ ¹æ®å‘½ä»¤ï¼Œæ‰¾å¯¹åº”çš„ç­–ç•¥ï¼‰&lt;/li&gt;
&lt;li&gt;2å¤„ï¼Œæ£€æŸ¥ï¼Œæ˜¯å¦å¯†ç æ­£ç¡®&lt;/li&gt;
&lt;li&gt;3å¤„ï¼Œé›†ç¾¤ç›¸å…³æ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;3.1å¤„ï¼Œä¸æ˜¯æœ¬èŠ‚ç‚¹å¤„ç†ï¼Œç›´æ¥è¿”å›askï¼ŒæŒ‡ç¤ºå®¢æˆ·ç«¯è½¬å‘&lt;/li&gt;
&lt;li&gt;4å¤„ï¼Œåˆ¤æ–­æ˜¯å¦è®¾ç½®äº†maxMemoryï¼Œè¿™é‡Œå°±æ˜¯æœ¬æ–‡é‡ç‚¹ï¼šè®¾ç½®äº†maxMemoryæ—¶ï¼Œå†…å­˜æ·˜æ±°ç­–ç•¥&lt;/li&gt;
&lt;li&gt;4.1å¤„ï¼Œè°ƒç”¨äº†ä¸‹æ–¹çš„ freeMemoryIfNeeded&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæ·±å…¥4.1å¤„ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;
int freeMemoryIfNeeded(void) {
    size_t mem_used, mem_tofree, mem_freed;
    int slaves = listLength(server.slaves);

    /* Remove the size of slaves output buffers and AOF buffer from the
     * count of used memory. */
    // è®¡ç®—å‡º Redis ç›®å‰å ç”¨çš„å†…å­˜æ€»æ•°ï¼Œä½†æœ‰ä¸¤ä¸ªæ–¹é¢çš„å†…å­˜ä¸ä¼šè®¡ç®—åœ¨å†…ï¼š
    // 1ï¼‰ä»æœåŠ¡å™¨çš„è¾“å‡ºç¼“å†²åŒºçš„å†…å­˜
    // 2ï¼‰AOF ç¼“å†²åŒºçš„å†…å­˜
    mem_used = zmalloc_used_memory();
    if (slaves) {
                ...
    }
    if (server.aof_state != REDIS_AOF_OFF) {
        mem_used -= sdslen(server.aof_buf);
        mem_used -= aofRewriteBufferSize();
    }

    /* Check if we are over the memory limit. */
    //1 å¦‚æœç›®å‰ä½¿ç”¨çš„å†…å­˜å¤§å°æ¯”è®¾ç½®çš„ maxmemory è¦å°ï¼Œé‚£ä¹ˆæ— é¡»æ‰§è¡Œè¿›ä¸€æ­¥æ“ä½œ
    if (mem_used &amp;lt;= server.maxmemory) return REDIS_OK;

    //2 å¦‚æœå ç”¨å†…å­˜æ¯” maxmemory è¦å¤§ï¼Œä½†æ˜¯ maxmemory ç­–ç•¥ä¸ºä¸æ·˜æ±°ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›
    if (server.maxmemory_policy == REDIS_MAXMEMORY_NO_EVICTION)
        return REDIS_ERR; /* We need to free memory, but policy forbids. */

    /* Compute how much memory we need to free. */
    // 3 è®¡ç®—éœ€è¦é‡Šæ”¾å¤šå°‘å­—èŠ‚çš„å†…å­˜
    mem_tofree = mem_used - server.maxmemory;

    // åˆå§‹åŒ–å·²é‡Šæ”¾å†…å­˜çš„å­—èŠ‚æ•°ä¸º 0
    mem_freed = 0;

    // æ ¹æ® maxmemory ç­–ç•¥ï¼Œ
    //4 éå†å­—å…¸ï¼Œé‡Šæ”¾å†…å­˜å¹¶è®°å½•è¢«é‡Šæ”¾å†…å­˜çš„å­—èŠ‚æ•°
    while (mem_freed &amp;lt; mem_tofree) {
        int j, k, keys_freed = 0;

        // éå†æ‰€æœ‰å­—å…¸
        for (j = 0; j &amp;lt; server.dbnum; j++) {
            long bestval = 0; /* just to prevent warning */
            sds bestkey = NULL;
            dictEntry *de;
            redisDb *db = server.db + j;
            dict *dict;

            if (server.maxmemory_policy == REDIS_MAXMEMORY_ALLKEYS_LRU ||
                server.maxmemory_policy == REDIS_MAXMEMORY_ALLKEYS_RANDOM) {
                // å¦‚æœç­–ç•¥æ˜¯ allkeys-lru æˆ–è€… allkeys-random 
                //5 é‚£ä¹ˆæ·˜æ±°çš„ç›®æ ‡ä¸ºæ‰€æœ‰æ•°æ®åº“é”®
                dict = server.db[j].dict;
            } else {
                // å¦‚æœç­–ç•¥æ˜¯ volatile-lru ã€ volatile-random æˆ–è€… volatile-ttl 
                //6 é‚£ä¹ˆæ·˜æ±°çš„ç›®æ ‡ä¸ºå¸¦è¿‡æœŸæ—¶é—´çš„æ•°æ®åº“é”®
                dict = server.db[j].expires;
            }


            /* volatile-random and allkeys-random policy */
            // å¦‚æœä½¿ç”¨çš„æ˜¯éšæœºç­–ç•¥ï¼Œé‚£ä¹ˆä»ç›®æ ‡å­—å…¸ä¸­éšæœºé€‰å‡ºé”®
            if (server.maxmemory_policy == REDIS_MAXMEMORY_ALLKEYS_RANDOM ||
                server.maxmemory_policy == REDIS_MAXMEMORY_VOLATILE_RANDOM) {
                de = dictGetRandomKey(dict);
                bestkey = dictGetKey(de);
            }
            /* volatile-lru and allkeys-lru policy */
            //7 
            else if (server.maxmemory_policy == REDIS_MAXMEMORY_ALLKEYS_LRU ||
                     server.maxmemory_policy == REDIS_MAXMEMORY_VOLATILE_LRU) {
                struct evictionPoolEntry *pool = db-&amp;gt;eviction_pool;

                while (bestkey == NULL) {
                    // 8 
                    evictionPoolPopulate(dict, db-&amp;gt;dict, db-&amp;gt;eviction_pool);
                    /* Go backward from best to worst element to evict. */
                    for (k = REDIS_EVICTION_POOL_SIZE - 1; k &amp;gt;= 0; k--) {
                        if (pool[k].key == NULL) continue;
                        // 8.1
                        de = dictFind(dict, pool[k].key);

                        /* 8.2 Remove the entry from the pool. */
                        sdsfree(pool[k].key);
                        /* Shift all elements on its right to left. */
                        memmove(pool + k, pool + k + 1,
                                sizeof(pool[0]) * (REDIS_EVICTION_POOL_SIZE - k - 1));
                        /* Clear the element on the right which is empty
                         * since we shifted one position to the left.  */
                        pool[REDIS_EVICTION_POOL_SIZE - 1].key = NULL;
                        pool[REDIS_EVICTION_POOL_SIZE - 1].idle = 0;

                        /* If the key exists, is our pick. Otherwise it is
                         * a ghost and we need to try the next element. */
                        // 8.3
                        if (de) {
                            bestkey = dictGetKey(de);
                            break;
                        } else {
                            /* Ghost... */
                            continue;
                        }
                    }
                }
            }

                /* volatile-ttl */
                // ç­–ç•¥ä¸º volatile-ttl ï¼Œä»ä¸€é›† sample é”®ä¸­é€‰å‡ºè¿‡æœŸæ—¶é—´è·ç¦»å½“å‰æ—¶é—´æœ€æ¥è¿‘çš„é”®
            else if (server.maxmemory_policy == REDIS_MAXMEMORY_VOLATILE_TTL) {
                ...
            }

            /* Finally remove the selected key. */
            // 8.4 åˆ é™¤è¢«é€‰ä¸­çš„é”®
            if (bestkey) {
                long long delta;

                robj *keyobj = createStringObject(bestkey, sdslen(bestkey));
                propagateExpire(db, keyobj);
                /* We compute the amount of memory freed by dbDelete() alone.
                 * It is possible that actually the memory needed to propagate
                 * the DEL in AOF and replication link is greater than the one
                 * we are freeing removing the key, but we can't account for
                 * that otherwise we would never exit the loop.
                 *
                 * AOF and Output buffer memory will be freed eventually so
                 * we only care about memory used by the key space. */
                // è®¡ç®—åˆ é™¤é”®æ‰€é‡Šæ”¾çš„å†…å­˜æ•°é‡
                delta = (long long) zmalloc_used_memory();
                dbDelete(db, keyobj);
                delta -= (long long) zmalloc_used_memory();
                mem_freed += delta;

                // å¯¹æ·˜æ±°é”®çš„è®¡æ•°å™¨å¢ä¸€
                server.stat_evictedkeys++;

                notifyKeyspaceEvent(REDIS_NOTIFY_EVICTED, &quot;evicted&quot;,
                                    keyobj, db-&amp;gt;id);
                decrRefCount(keyobj);
                keys_freed++;
                                ...
            }
        }

        if (!keys_freed) return REDIS_ERR; /* nothing to free... */
    }

    return REDIS_OK;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;ul readability=&quot;12&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;1å¤„ï¼Œå¦‚æœç›®å‰ä½¿ç”¨çš„å†…å­˜å¤§å°æ¯”è®¾ç½®çš„ maxmemory è¦å°ï¼Œé‚£ä¹ˆæ— é¡»æ‰§è¡Œè¿›ä¸€æ­¥æ“ä½œ&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;2å¤„ï¼Œå¦‚æœå ç”¨å†…å­˜æ¯” maxmemory è¦å¤§ï¼Œä½†æ˜¯ maxmemory ç­–ç•¥ä¸ºä¸æ·˜æ±°ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;3å¤„ï¼Œè®¡ç®—éœ€è¦é‡Šæ”¾å¤šå°‘å­—èŠ‚çš„å†…å­˜&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;4å¤„ï¼Œéå†å­—å…¸ï¼Œé‡Šæ”¾å†…å­˜å¹¶è®°å½•è¢«é‡Šæ”¾å†…å­˜çš„å­—èŠ‚æ•°&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;5å¤„ï¼Œå¦‚æœç­–ç•¥æ˜¯ allkeys-lru æˆ–è€… allkeys-random é‚£ä¹ˆæ·˜æ±°çš„ç›®æ ‡ä¸ºæ‰€æœ‰æ•°æ®åº“é”®&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;6å¤„ï¼Œå¦‚æœç­–ç•¥æ˜¯ volatile-lru ã€ volatile-random æˆ–è€… volatile-ttl ï¼Œé‚£ä¹ˆæ·˜æ±°çš„ç›®æ ‡ä¸ºå¸¦è¿‡æœŸæ—¶é—´çš„æ•°æ®åº“é”®&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;7å¤„ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯ LRU ç­–ç•¥ï¼Œ é‚£ä¹ˆä» sample é”®ä¸­é€‰å‡º IDLE æ—¶é—´æœ€é•¿çš„é‚£ä¸ªé”®&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;4&quot;&gt;
&lt;p&gt;8å¤„ï¼Œè°ƒç”¨evictionPoolPopulateï¼Œè¯¥å‡½æ•°åœ¨ä¸‹é¢è®²è§£,è¯¥å‡½æ•°çš„åŠŸèƒ½æ˜¯ï¼Œä¼ å…¥ä¸€ä¸ªé“¾è¡¨ï¼Œå³è¿™é‡Œçš„db-&amp;gt;eviction_poolï¼Œç„¶ååœ¨å‡½æ•°å†…éƒ¨ï¼Œéšæœºæ‰¾å‡ºnä¸ªkeyï¼Œæ”¾å…¥ä¼ å…¥çš„é“¾è¡¨ä¸­ï¼Œå¹¶æŒ‰ç…§ç©ºé—²æ—¶é—´æ’åºï¼Œç©ºé—²æœ€ä¹…çš„ï¼Œæ”¾åˆ°æœ€åã€‚&lt;/p&gt;
&lt;p&gt;å½“è¯¥å‡½æ•°ï¼Œè¿”å›åï¼Œdb-&amp;gt;eviction_poolè¿™ä¸ªé“¾è¡¨é‡Œå°±å­˜æ”¾äº†æˆ‘ä»¬è¦æ·˜æ±°çš„keyã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;8.1å¤„ï¼Œæ‰¾åˆ°è¿™ä¸ªkeyï¼Œè¿™ä¸ªkeyï¼Œåœ¨åè¾¹ä¼šè¢«åˆ é™¤&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;8.2å¤„ï¼Œä¸‹é¢è¿™ä¸€æ®µï¼Œä»db-&amp;gt;eviction_poolå°†è¿™ä¸ªå·²ç»å¤„ç†äº†çš„keyåˆ æ‰&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;8.3å¤„ï¼Œå¦‚æœè¿™ä¸ªkeyï¼Œæ˜¯å­˜åœ¨çš„ï¼Œåˆ™è·³å‡ºå¾ªç¯ï¼Œåœ¨åé¢8.4å¤„ï¼Œä¼šè¢«åˆ é™¤&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;8.4å¤„ï¼Œåˆ é™¤è¿™ä¸ªkey&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;é€‰æ‹©å“ªäº›keyä½œä¸ºè¢«æ·˜æ±°çš„key&quot;&gt;é€‰æ‹©å“ªäº›keyä½œä¸ºè¢«æ·˜æ±°çš„key&lt;/h2&gt;
&lt;p&gt;å‰é¢æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨7å¤„ï¼Œå¦‚æœä¸ºlruç­–ç•¥ï¼Œåˆ™ä¼šè¿›å…¥8å¤„çš„å‡½æ•°ï¼š&lt;/p&gt;
&lt;p&gt;evictionPoolPopulateã€‚&lt;/p&gt;
&lt;p&gt;è¯¥å‡½æ•°çš„åç§°ä¸ºï¼šå¡«å……(populate)é©±é€(eviction)å¯¹è±¡æ± (pool)ã€‚é©±é€çš„æ„æ€ï¼Œå°±æ˜¯ç°åœ¨è¾¾åˆ°äº†maxmemoryï¼Œæ²¡åŠæ³•ï¼Œåªèƒ½å¼€å§‹åˆ é™¤æ‰ä¸€éƒ¨åˆ†å…ƒç´ ï¼Œæ¥è…¾ç©ºé—´äº†ï¼Œä¸ç„¶æ–°çš„putç±»å‹çš„å‘½ä»¤ï¼Œæ ¹æœ¬æ²¡åŠæ³•æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æ–¹æ³•çš„å¤§æ¦‚æ€è·¯æ˜¯ï¼Œä½¿ç”¨lruçš„æ—¶å€™ï¼Œéšæœºæ‰¾nä¸ªkeyï¼Œç±»ä¼¼äºæŠ½æ ·ï¼Œç„¶åæ”¾åˆ°ä¸€ä¸ªé“¾è¡¨ï¼Œæ ¹æ®ç©ºé—²æ—¶é—´æ’åºã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“çœ‹çœ‹è¯¥æ–¹æ³•çš„å®ç°ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;void evictionPoolPopulate(dict *sampledict, dict *keydict, struct evictionPoolEntry *pool) {
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å…¶ä¸­ï¼Œä¼ å…¥çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œæ˜¯è¦è¢«å¡«å……çš„å¯¹è±¡ï¼Œåœ¨cè¯­è¨€ä¸­ï¼Œä¹ æƒ¯ä¼ å…¥ä¸€ä¸ªå…¥å‚ï¼Œç„¶ååœ¨å‡½æ•°å†…éƒ¨å¡«å……æˆ–è€…ä¿®æ”¹å…¥å‚å¯¹è±¡çš„å±æ€§ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥å±æ€§ï¼Œå°±æ˜¯å‰é¢è¯´çš„é‚£ä¸ªé“¾è¡¨ï¼Œç”¨æ¥å­˜æ”¾æ”¶é›†çš„éšæœºçš„å…ƒç´ ï¼Œè¯¥é“¾è¡¨ä¸­èŠ‚ç‚¹çš„ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;struct evictionPoolEntry {
    unsigned long long idle;    /* Object idle time. */
    sds key;                    /* Key name. */
};
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¯¥ç»“æ„å…±2ä¸ªå­—æ®µï¼Œä¸€ä¸ªå­˜å‚¨keyï¼Œä¸€ä¸ªå­˜å‚¨ç©ºé—²æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥é“¾è¡¨ä¸­ï¼Œå…±maxmemory-samplesä¸ªå…ƒç´ ï¼Œä¼šæŒ‰ç…§idleæ—¶é—´é•¿çŸ­æ’åºï¼Œidleæ—¶é—´é•¿çš„åœ¨é“¾è¡¨å°¾éƒ¨ï¼Œï¼ˆå‡è®¾å¤´åœ¨å·¦ï¼Œå°¾åœ¨å³ï¼‰ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;void evictionPoolPopulate(dict *sampledict, dict *keydict, struct evictionPoolEntry *pool) {
    int j, k, count;
    dictEntry *_samples[EVICTION_SAMPLES_ARRAY_SIZE];
    dictEntry **samples;

    /* Try to use a static buffer: this function is a big hit...
     * Note: it was actually measured that this helps. */
    if (server.maxmemory_samples &amp;lt;= EVICTION_SAMPLES_ARRAY_SIZE) {
        samples = _samples;
    } else {
        samples = zmalloc(sizeof(samples[0]) * server.maxmemory_samples);
    }

    /* 1 Use bulk get by default. */
    count = dictGetRandomKeys(sampledict, samples, server.maxmemory_samples);

        // 2
    for (j = 0; j &amp;lt; count; j++) {
        unsigned long long idle;
        sds key;
        robj *o;
        dictEntry *de;

        de = samples[j];
        key = dictGetKey(de);
        /* If the dictionary we are sampling from is not the main
         * dictionary (but the expires one) we need to lookup the key
         * again in the key dictionary to obtain the value object. */
        if (sampledict != keydict) de = dictFind(keydict, key);
        // 3
        o = dictGetVal(de);
        // 4
        idle = estimateObjectIdleTime(o);

        /* 5  Insert the element inside the pool.
         * First, find the first empty bucket or the first populated
         * bucket that has an idle time smaller than our idle time. */
        k = 0;
        while (k &amp;lt; REDIS_EVICTION_POOL_SIZE &amp;amp;&amp;amp;
               pool[k].key &amp;amp;&amp;amp;
               pool[k].idle &amp;lt; idle)
            k++;
        
                ...
            
        // 6
        pool[k].key = sdsdup(key);
        pool[k].idle = idle;
    }
    if (samples != _samples) zfree(samples);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;ul readability=&quot;22&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;1å¤„ï¼Œè·å– &lt;code&gt;server.maxmemory_samples&lt;/code&gt;ä¸ªkeyï¼Œè¿™é‡Œæ˜¯éšæœºè·å–çš„ï¼Œï¼ˆdictGetRandomKeysï¼‰ï¼Œè¿™ä¸ªå€¼ï¼Œé»˜è®¤å€¼ä¸º5ï¼Œæ”¾åˆ°samplesä¸­&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;2å¤„ï¼Œéå†è¿”å›æ¥çš„samples&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;12&quot;&gt;
&lt;p&gt;3å¤„ï¼Œè°ƒç”¨å¦‚ä¸‹å®ï¼Œè·å–val&lt;/p&gt;
&lt;p&gt;heçš„ç±»å‹ä¸ºdictEntryï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;/*
 * å“ˆå¸Œè¡¨èŠ‚ç‚¹
 */
typedef struct dictEntry {
    
    // é”®
    void *key;

    // å€¼
    union {
        // 1
        void *val;
        uint64_t u64;
        int64_t s64;
    } v;

    // æŒ‡å‘ä¸‹ä¸ªå“ˆå¸Œè¡¨èŠ‚ç‚¹ï¼Œå½¢æˆé“¾è¡¨
    struct dictEntry *next;

} dictEntry;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œè¿™é‡Œå»&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;robj *o; 

o = dictGetVal(de);
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å®é™…å°±æ˜¯è·å–å…¶vå±æ€§ä¸­çš„val,(1å¤„)ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;#define dictGetVal(he) ((he)-&amp;gt;v.val)
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;18&quot;&gt;
&lt;p&gt;4å¤„ï¼Œå‡†å¤‡è®¡ç®—è¯¥valçš„ç©ºé—²æ—¶é—´&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¸Šé¢3å¤„ï¼Œçœ‹åˆ°ï¼Œè·å–çš„oçš„ç±»å‹ä¸ºrobjã€‚æˆ‘ä»¬ç°åœ¨çœ‹çœ‹æ€ä¹ˆè®¡ç®—å¯¹è±¡çš„ç©ºé—²æ—¶é•¿ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;/* Given an object returns the min number of milliseconds the object was never
 * requested, using an approximated LRU algorithm. */
unsigned long long estimateObjectIdleTime(robj *o) {
    //4.1 è·å–ç³»ç»Ÿçš„å½“å‰æ—¶é—´
    unsigned long long lruclock = LRU_CLOCK();
    // 4.2
    if (lruclock &amp;gt;= o-&amp;gt;lru) {
        // 4.3
        return (lruclock - o-&amp;gt;lru) * REDIS_LRU_CLOCK_RESOLUTION;
    } else {
        return (lruclock + (REDIS_LRU_CLOCK_MAX - o-&amp;gt;lru)) *
                    REDIS_LRU_CLOCK_RESOLUTION;
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œï¼Œ4.1å¤„ï¼Œè·å–ç³»ç»Ÿçš„å½“å‰æ—¶é—´ï¼›&lt;/p&gt;
&lt;p&gt;4.2å¤„ï¼Œå¦‚æœç³»ç»Ÿæ—¶é—´ï¼Œå¤§äºå¯¹è±¡çš„lruæ—¶é—´&lt;/p&gt;
&lt;p&gt;4.3å¤„ï¼Œåˆ™ç”¨ç³»ç»Ÿæ—¶é—´å‡å»å¯¹è±¡çš„lruæ—¶é—´ï¼Œå†ä¹˜ä»¥å•ä½,æ¢ç®—ä¸ºæ¯«ç§’ï¼Œæœ€ç»ˆè¿”å›çš„å•ä½ï¼Œä¸ºæ¯«ç§’(å¯ä»¥çœ‹æ³¨é‡Šã€‚)&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;#define REDIS_LRU_CLOCK_RESOLUTION 1000 /* LRU clock resolution in ms */
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;4&quot;&gt;
&lt;p&gt;5å¤„ï¼Œè¿™é‡Œæ‹¿å½“å‰å…ƒç´ ï¼Œå’Œpoolä¸­å·²ç»æ”¾è¿›å»çš„å…ƒç´ ï¼Œä»ç¬¬0ä¸ªå¼€å§‹æ¯”è¾ƒï¼Œå¦‚æœå½“å‰å…ƒç´ çš„idleæ—¶é•¿ï¼Œå¤§äºpoolä¸­æŒ‡é’ˆ0æŒ‡å‘çš„å…ƒç´ ï¼Œåˆ™å’Œpoolä¸­ç´¢å¼•1çš„å…ƒç´ æ¯”è¾ƒï¼›ç›´åˆ°æ¡ä»¶ä¸æ»¡è¶³ä¸ºæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å¥è¯æ„æ€å°±æ˜¯ï¼Œç±»ä¼¼äºå†’æ³¡ï¼ŒæŠŠå½“å‰å…ƒç´ ä¸€ç›´å¾€åå†’ï¼Œç›´åˆ°idleæ—¶é•¿å°äºè¢«æ¯”è¾ƒçš„å…ƒç´ ä¸ºæ­¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;6å¤„ï¼ŒæŠŠå½“å‰å…ƒç´ æ”¾è¿›poolä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;ç»è¿‡ä¸Šé¢çš„å¤„ç†åï¼Œé“¾è¡¨ä¸­å­˜æ”¾äº†å…¨éƒ¨çš„æŠ½æ ·å…ƒç´ ï¼Œä¸”ideæ—¶é—´æœ€é•¿çš„ï¼Œåœ¨æœ€å³è¾¹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å¯¹è±¡è¿˜æœ‰å­—æ®µå­˜å‚¨ç©ºé—²æ—¶é—´ï¼Ÿ&quot;&gt;å¯¹è±¡è¿˜æœ‰å­—æ®µå­˜å‚¨ç©ºé—²æ—¶é—´ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å‰é¢4å¤„ï¼Œè¯´åˆ°ï¼Œç”¨ç³»ç»Ÿçš„å½“å‰æ—¶é—´ï¼Œå‡å»å¯¹è±¡çš„lruæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;å¤§å®¶çœ‹çœ‹å¯¹è±¡çš„ç»“æ„ä½“&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;typedef struct redisObject {

    // ç±»å‹
    unsigned type:4;

    // ç¼–ç 
    unsigned encoding:4;

    //1 å¯¹è±¡æœ€åä¸€æ¬¡è¢«è®¿é—®çš„æ—¶é—´
    unsigned lru:REDIS_LRU_BITS; /* lru time (relative to server.lruclock) */

    // å¼•ç”¨è®¡æ•°
    int refcount;

    // æŒ‡å‘å®é™…å€¼çš„æŒ‡é’ˆ
    void *ptr;

} robj;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸Šé¢1å¤„ï¼Œlruå±æ€§ï¼Œå°±æ˜¯ç”¨æ¥å­˜å‚¨è¿™ä¸ªã€‚&lt;/p&gt;
&lt;h3 id=&quot;åˆ›å»ºå¯¹è±¡æ—¶ï¼Œç›´æ¥ä½¿ç”¨å½“å‰ç³»ç»Ÿæ—¶é—´åˆ›å»º&quot;&gt;åˆ›å»ºå¯¹è±¡æ—¶ï¼Œç›´æ¥ä½¿ç”¨å½“å‰ç³»ç»Ÿæ—¶é—´åˆ›å»º&lt;/h3&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;robj *createObject(int type, void *ptr) {

    robj *o = zmalloc(sizeof(*o));

    o-&amp;gt;type = type;
    o-&amp;gt;encoding = REDIS_ENCODING_RAW;
    o-&amp;gt;ptr = ptr;
    o-&amp;gt;refcount = 1;

    /*1 Set the LRU to the current lruclock (minutes resolution). */
    o-&amp;gt;lru = LRU_CLOCK();
    return o;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;1å¤„å³æ˜¯ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;robj *createEmbeddedStringObject(char *ptr, size_t len) {
    robj *o = zmalloc(sizeof(robj)+sizeof(struct sdshdr)+len+1);
    struct sdshdr *sh = (void*)(o+1);

    o-&amp;gt;type = REDIS_STRING;
    o-&amp;gt;encoding = REDIS_ENCODING_EMBSTR;
    o-&amp;gt;ptr = sh+1;
    o-&amp;gt;refcount = 1;
    // 1
    o-&amp;gt;lru = LRU_CLOCK();

    sh-&amp;gt;len = len;
    sh-&amp;gt;free = 0;
    if (ptr) {
        memcpy(sh-&amp;gt;buf,ptr,len);
        sh-&amp;gt;buf[len] = '\0';
    } else {
        memset(sh-&amp;gt;buf,0,len+1);
    }
    return o;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;1å¤„å³æ˜¯ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ¯æ¬¡æŸ¥æ‰¾è¯¥keyæ—¶ï¼Œåˆ·æ–°æ—¶é—´&quot;&gt;æ¯æ¬¡æŸ¥æ‰¾è¯¥keyæ—¶ï¼Œåˆ·æ–°æ—¶é—´&lt;/h3&gt;
&lt;pre&gt;
&lt;code class=&quot;language-c&quot;&gt;robj *lookupKey(redisDb *db, robj *key) {

    // æŸ¥æ‰¾é”®ç©ºé—´
    dictEntry *de = dictFind(db-&amp;gt;dict,key-&amp;gt;ptr);

    // èŠ‚ç‚¹å­˜åœ¨
    if (de) {
        

        // å–å‡ºå€¼
        robj *val = dictGetVal(de);

        /* Update the access time for the ageing algorithm.
         * Don't do it if we have a saving child, as this will trigger
         * a copy on write madness. */
        // æ›´æ–°æ—¶é—´ä¿¡æ¯ï¼ˆåªåœ¨ä¸å­˜åœ¨å­è¿›ç¨‹æ—¶æ‰§è¡Œï¼Œé˜²æ­¢ç ´å copy-on-write æœºåˆ¶ï¼‰
        if (server.rdb_child_pid == -1 &amp;amp;&amp;amp; server.aof_child_pid == -1)
            // 1
            val-&amp;gt;lru = LRU_CLOCK();

        // è¿”å›å€¼
        return val;
    } else {

        // èŠ‚ç‚¹ä¸å­˜åœ¨

        return NULL;
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;1å¤„å³æ˜¯ï¼ŒåŒ…æ‹¬getã€setç­‰å„ç§æ“ä½œï¼Œéƒ½ä¼šåˆ·æ–°è¯¥æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;ä»”ç»†çœ‹ä¸‹é¢çš„å †æ ˆï¼Œsetçš„ï¼ŒgetåŒç†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/519126/202006/519126-20200614110730822-1634522816.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;p&gt;å¤§å®¶æœ‰æ²¡æœ‰æ›´æ¸…æ¥šä¸€äº›å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯ï¼Œè®¾ç½®äº†max-memoryåï¼Œè¾¾åˆ°è¯¥å†…å­˜é™åˆ¶åï¼Œä¼šåœ¨å¤„ç†å‘½ä»¤æ—¶ï¼Œæ£€æŸ¥æ˜¯å¦è¦è¿›è¡Œå†…å­˜æ·˜æ±°ï¼›å¦‚æœè¦æ·˜æ±°ï¼Œåˆ™æ ¹æ®maxmemory-policyçš„ç­–ç•¥æ¥ã€‚&lt;/p&gt;
&lt;p&gt;éšæœºé€‰æ‹©maxmemory-sampleä¸ªå…ƒç´ ï¼ŒæŒ‰ç…§ç©ºé—²æ—¶é—´æ’åºï¼Œæ‹‰é“¾è¡¨ï¼›æŒ¨ä¸ªæŒ¨ä¸ªæ¸…é™¤ã€‚&lt;/p&gt;
</description>
<pubDate>Sun, 14 Jun 2020 23:05:00 +0000</pubDate>
<dc:creator>ä¸‰å›½æ¢¦å›</dc:creator>
<og:description>æ–‡ç« å¯¼èˆª Redisæºç ç³»åˆ—çš„åˆè¡·ï¼Œæ˜¯å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£Redisï¼Œæ›´æ‡‚Redisï¼Œè€Œæ€ä¹ˆæ‰èƒ½æ‡‚ï¼Œå…‰çœ‹æ˜¯ä¸å¤Ÿçš„ï¼Œå»ºè®®è·Ÿç€ä¸‹é¢çš„è¿™ä¸€ç¯‡ï¼ŒæŠŠç¯å¢ƒæ­å»ºèµ·æ¥ï¼Œåç»­å¯ä»¥è‡ªå·±é˜…è¯»æºç ï¼Œæˆ–è€…è·Ÿç€æˆ‘è¿™è¾¹ä¸€èµ·é˜…è¯»ã€‚ç”±äº</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/grey-wolf/p/13128882.html</dc:identifier>
</item>
</channel>
</rss>