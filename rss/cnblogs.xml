<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>博客园_首页</title>
<link></link>
<description>代码改变世界</description>
<item>
<title>补习系列(19)-springboot JPA + PostGreSQL - 美码师</title>
<link>http://www.cnblogs.com/littleatp/p/10562583.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/littleatp/p/10562583.html</guid>
<description>&lt;h2 id=&quot;springboot-整合-postgresql&quot;&gt;SpringBoot 整合 PostGreSQL&lt;/h2&gt;
&lt;h2 id=&quot;一postgresql简介&quot;&gt;一、PostGreSQL简介&lt;/h2&gt;
&lt;p&gt;PostGreSQL是一个功能强大的开源对象关系数据库管理系统(ORDBMS)，号称&lt;strong&gt;世界上最先进的开源关系型数据库&lt;/strong&gt;&lt;br/&gt;经过长达15年以上的积极开发和不断改进，PostGreSQL已在可靠性、稳定性、数据一致性等获得了很大的提升。&lt;br/&gt;对比时下最流行的 MySQL 来说，PostGreSQL 拥有更灵活，更高度兼容标准的一些特性。&lt;br/&gt;此外，PostGreSQL基于MIT开源协议，其开放性极高，这也是其成为各个云计算大T 主要的RDS数据库的根本原因。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/242916/201903/242916-20190320073459488-1577069804.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;从DBEngine的排名上看，PostGreSQL排名第四，且保持着高速的增长趋势，非常值得关注。&lt;br/&gt;这篇文章，以整合SpringBoot 为例，讲解如何在常规的 Web项目中使用 PostGreSQL。&lt;/p&gt;
&lt;h2 id=&quot;二关于-springdatajpa&quot;&gt;二、关于 SpringDataJPA&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;JPA 是指 Java Persistence API&lt;/strong&gt;，即 Java 的持久化规范，一开始是作为 JSR-220 的一部分。&lt;br/&gt;JPA 的提出，主要是为了简化 Java EE 和 Java SE 应用开发工作，统一当时的一些不同的 ORM 技术。&lt;br/&gt;一般来说，规范只是定义了一套运作的规则，也就是接口，而像我们所熟知的Hibernate 则是 JPA 的一个实现(Provider)。&lt;/p&gt;
&lt;p&gt;JPA 定义了什么，大致有：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ORM 映射元数据，用来将对象与表、字段关联起来&lt;/li&gt;
&lt;li&gt;操作API，即完成增删改查的一套接口&lt;/li&gt;
&lt;li&gt;JPQL 查询语言，实现一套可移植的面向对象查询表达式&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;要体验 JPA 的魅力，可以从Spring Data JPA 开始。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/242916/201903/242916-20190320073516420-1504379536.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SpringDataJPA&lt;/strong&gt; 是 SpringFramework 对 JPA 的一套封装，主要呢，还是为了简化数据持久层的开发。&lt;br/&gt;比如：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;提供基础的 CrudRepository 来快速实现增删改查&lt;/li&gt;
&lt;li&gt;提供一些更灵活的注解，如@Query、@Transaction&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;基本上，SpringDataJPA 几乎已经成为 Java Web 持久层的必选组件。更多一些细节可以参考官方文档：&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;https://docs.spring.io/spring-data/jpa/docs/1.11.0.RELEASE/reference/html&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;接下来的篇幅，将演示 JPA 与 PostGreSQL 的整合实例。&lt;/p&gt;
&lt;h2 id=&quot;三整合-postgresql&quot;&gt;三、整合 PostGreSQL&lt;/h2&gt;
&lt;p&gt;这里假定你已经安装好数据库，并已经创建好一个 SpringBoot 项目，接下来需添加依赖：&lt;/p&gt;
&lt;h3 id=&quot;a.-依赖包&quot;&gt;A. 依赖包&lt;/h3&gt;
&lt;pre&gt;
&lt;code&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-starter-data-jpa&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;${spring-boot.version}&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.postgresql&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;postgresql&amp;lt;/artifactId&amp;gt;
    &amp;lt;scope&amp;gt;runtime&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;通过&lt;strong&gt;spring-boot-stater-data-jpa&lt;/strong&gt;，可以间接引入 &lt;strong&gt;spring-data-jpa&lt;/strong&gt;的配套版本；&lt;br/&gt;为了使用 PostGreSQL，则需要引入 &lt;strong&gt;&lt;em&gt;org.postgresql.postgresql&lt;/em&gt;&lt;/strong&gt; 驱动包。&lt;/p&gt;
&lt;h3 id=&quot;b.-配置文件&quot;&gt;B. 配置文件&lt;/h3&gt;
&lt;p&gt;编辑 &lt;strong&gt;application.properties&lt;/strong&gt;，如下：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;## 数据源配置 (DataSourceAutoConfiguration &amp;amp; DataSourceProperties)
spring.datasource.url=jdbc:postgresql://localhost:5432/appdb
spring.datasource.username=appuser
spring.datasource.password=appuser

# Hibernate 原语
spring.jpa.properties.hibernate.dialect = org.hibernate.dialect.PostgreSQLDialect

# DDL 级别 (create, create-drop, validate, update)
spring.jpa.hibernate.ddl-auto = update&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;其中，&lt;strong&gt;spring.jpa.hibernate.ddl-auto&lt;/strong&gt; 指定为 update，这样框架会自动帮我们创建或更新表结构。&lt;/p&gt;
&lt;h3 id=&quot;c.-模型定义&quot;&gt;C. 模型定义&lt;/h3&gt;
&lt;p&gt;我们以书籍信息来作为实例，一本书会有标题、类型、作者等属性，对应于表的各个字段。&lt;br/&gt;这里为了演示多对一的关联，我们还会定义一个Author(作者信息)实体，书籍和实体通过一个外键(author_id)关联&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Book 类&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@Entity
@Table(name = &quot;book&quot;)
public class Book extends AuditModel{

    @Id
    @GeneratedValue(strategy=GenerationType.IDENTITY)
    private Long id;

    @NotBlank
    @Size(min = 1, max = 50)
    private String type;

    @NotBlank
    @Size(min = 3, max = 100)
    private String title;

    @Column(columnDefinition = &quot;text&quot;)
    private String description;

    @Column(name = &quot;fav_count&quot;)
    private int favCount;

    @ManyToOne(fetch = FetchType.LAZY, optional = false)
    @JoinColumn(name = &quot;author_id&quot;, nullable = false)
    private Author author;

    //省略 get/set &lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;这里，我们用了一系列的注解，比如@Table、@Column分别对应了数据库的表、列。&lt;br/&gt;@GeneratedValue 用于指定ID主键的生成方式，&lt;strong&gt;GenerationType.IDENTITY&lt;/strong&gt; 指采用数据库原生的自增方式，&lt;br/&gt;对应到 PostGreSQL则会自动采用 BigSerial 做自增类型(匹配Long 类型)&lt;/p&gt;
&lt;p&gt;@ManyToOne 描述了一个多对一的关系，这里声明了其关联的&quot;作者“实体，LAZY 方式指的是当执行属性访问时才真正去数据库查询数据；&lt;br/&gt;@JoinColumn 在这里配合使用，用于指定其关联的一个外键。&lt;/p&gt;
&lt;p&gt;Book 实体的属性：&lt;/p&gt;
&lt;table&gt;&lt;thead/&gt;&lt;tbody&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;书籍编号&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;type&lt;/td&gt;
&lt;td&gt;书籍分类&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;title&lt;/td&gt;
&lt;td&gt;书籍标题&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;description&lt;/td&gt;
&lt;td&gt;书籍描述&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot;&gt;&lt;td&gt;favCount&lt;/td&gt;
&lt;td&gt;收藏数&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot;&gt;&lt;td&gt;author&lt;/td&gt;
&lt;td&gt;作者&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;&lt;strong&gt;&lt;em&gt;Author信息&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@Entity
@Table(name = &quot;author&quot;)
public class Author extends AuditModel{

    @Id
    @GeneratedValue(strategy=GenerationType.IDENTITY)
    private Long id;

    @NotBlank
    @Size(min = 1, max = 100)
    private String name;

    @Size(max = 400)
    private String hometown;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;审计模型&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;注意到两个实体都继承了AuditModel这个类，这个基础类实现了&quot;审计&quot;的功能。&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;审计，是指对数据的创建、变更等生命周期进行审阅的一种机制，&lt;br/&gt;通常审计的属性包括 创建时间、修改时间、创建人、修改人等信息&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;AuditModel&lt;/em&gt;&lt;/strong&gt;的定义如下所示：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public abstract class AuditModel implements Serializable {
    @Temporal(TemporalType.TIMESTAMP)
    @Column(name = &quot;created_at&quot;, nullable = false, updatable = false)
    @CreatedDate
    private Date createdAt;

    @Temporal(TemporalType.TIMESTAMP)
    @Column(name = &quot;updated_at&quot;, nullable = false)
    @LastModifiedDate
    private Date updatedAt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;上面的审计实体包含了 createAt、updateAt 两个日期类型字段，@CreatedDate、@LastModifiedDate分别对应了各自的语义，还是比较容易理解的。&lt;br/&gt;@Temporal 则用于声明日期类型对应的格式，如TIMESTAMP会对应 &lt;strong&gt;&lt;em&gt;yyyy-MM-dd HH:mm:ss&lt;/em&gt;&lt;/strong&gt;的格式，而这个也会被体现到DDL中。&lt;br/&gt;@MappedSuperClass 是必须的，目的是为了让子类定义的表能拥有继承的字段(列)&lt;/p&gt;
&lt;p&gt;审计功能的“魔力”在于，添加了这些继承字段之后，对象在创建、更新时会自动刷新这几个字段，这些是由框架完成的，应用并不需要关心。&lt;br/&gt;为了让审计功能生效，需要为AuditModel 添加 &lt;strong&gt;&lt;em&gt;@EntityListeners(AuditingEntityListener.class)&lt;/em&gt;&lt;/strong&gt;声明，同时还应该为SpringBoot 应用声明启用审计：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@EnableJpaAuditing
@SpringBootApplication
public class BootJpa {
    ...&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;d.-持久层&quot;&gt;D. 持久层&lt;/h3&gt;
&lt;p&gt;持久层基本是继承于 JpaRepository或CrudRepository的接口。&lt;br/&gt;如下面的代码：&lt;/p&gt;
&lt;p&gt;***AuthorRepository&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@Repository
public interface AuthorRepository extends JpaRepository&amp;lt;Author, Long&amp;gt; {
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;*** BookRepository ***&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@Repository
public interface BookRepository extends JpaRepository&amp;lt;Book, Long&amp;gt;{

    List&amp;lt;Book&amp;gt; findByType(String type, Pageable request);

    @Transactional
    @Modifying
    @Query(&quot;update Book b set b.favCount = b.favCount + ?2 where b.id = ?1&quot;)
    int incrFavCount(Long id, int fav);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;findByType&lt;/strong&gt; 实现的是按照 类型(type) 进行查询，这个方法将会被自动转换为一个JPQL查询语句。&lt;br/&gt;而且，SpringDataJPA 已经可以支持大部分常用场景，可以&lt;a href=&quot;https://docs.spring.io/spring-data/jpa/docs/1.11.0.RELEASE/reference/html/#jpa.sample-app.finders.strategies&quot;&gt;参考这里&lt;/a&gt;&lt;br/&gt;&lt;strong&gt;incrFavCount&lt;/strong&gt; 实现了收藏数的变更，除了使用 @Query 声明了一个update 语句之外，@Modify用于标记这是一个&lt;strong&gt;“产生变更的查询”&lt;/strong&gt;，用于通知EntityManager及时清除缓存。&lt;br/&gt;@Transactional 在这里是必须的，否则会提示 &lt;strong&gt;&lt;em&gt;TransactionRequiredException&lt;/em&gt;&lt;/strong&gt;这样莫名其妙的错误。&lt;/p&gt;
&lt;h3 id=&quot;e.-service-层&quot;&gt;E. Service 层&lt;/h3&gt;
&lt;p&gt;Service 的实现相对简单，仅仅是调用持久层实现数据操作。&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@Service
public class BookService {

    @Autowired
    private BookRepository bookRepository;

    @Autowired
    private AuthorRepository authorRepository;


    /**
     * 创建作者信息
     *
     * @param name
     * @param hometown
     * @return
     */
    public Author createAuthor(String name, String hometown) {

        if (StringUtils.isEmpty(name)) {
            return null;
        }

        Author author = new Author();
        author.setName(name);
        author.setHometown(hometown);

        return authorRepository.save(author);
    }

    /**
     * 创建书籍信息
     *
     * @param author
     * @param type
     * @param title
     * @param description
     * @return
     */
    public Book createBook(Author author, String type, String title, String description) {

        if (StringUtils.isEmpty(type) || StringUtils.isEmpty(title) || author == null) {
            return null;
        }

        Book book = new Book();
        book.setType(type);
        book.setTitle(title);
        book.setDescription(description);

        book.setAuthor(author);
        return bookRepository.save(book);
    }


    /**
     * 更新书籍信息
     *
     * @param bookId
     * @param type
     * @param title
     * @param description
     * @return
     */
    @Transactional(propagation = Propagation.REQUIRED, isolation = Isolation.SERIALIZABLE, readOnly = false)
    public boolean updateBook(Long bookId, String type, String title, String description) {
        if (bookId == null || StringUtils.isEmpty(title)) {
            return false;
        }

        Book book = bookRepository.findOne(bookId);
        if (book == null) {
            return false;
        }

        book.setType(type);
        book.setTitle(title);
        book.setDescription(description);
        return bookRepository.save(book) != null;
    }

    /**
     * 删除书籍信息
     *
     * @param bookId
     * @return
     */
    public boolean deleteBook(Long bookId) {
        if (bookId == null) {
            return false;
        }


        Book book = bookRepository.findOne(bookId);
        if (book == null) {
            return false;
        }
        bookRepository.delete(book);
        return true;
    }

    /**
     * 根据编号查询
     *
     * @param bookId
     * @return
     */
    public Book getBook(Long bookId) {
        if (bookId == null) {
            return null;
        }
        return bookRepository.findOne(bookId);
    }

    /**
     * 增加收藏数
     *
     * @return
     */
    public boolean incrFav(Long bookId, int fav) {

        if (bookId == null || fav &amp;lt;= 0) {
            return false;
        }
        return bookRepository.incrFavCount(bookId, fav) &amp;gt; 0;
    }

    /**
     * 获取分类下书籍，按收藏数排序
     *
     * @param type
     * @return
     */
    public List&amp;lt;Book&amp;gt; listTopFav(String type, int max) {

        if (StringUtils.isEmpty(type) || max &amp;lt;= 0) {
            return Collections.emptyList();
        }

        // 按投票数倒序排序
        Sort sort = new Sort(Sort.Direction.DESC, &quot;favCount&quot;);
        PageRequest request = new PageRequest(0, max, sort);

        return bookRepository.findByType(type, request);
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;四高级操作&quot;&gt;四、高级操作&lt;/h2&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;前面的部分已经完成了基础的CRUD操作，但在正式的项目中往往会需要一些定制做法，下面做几点介绍。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;自定义查询&quot;&gt;1. 自定义查询&lt;/h4&gt;
&lt;p&gt;使用 &lt;strong&gt;&lt;em&gt;findByxxx&lt;/em&gt;&lt;/strong&gt; 这样的方法映射已经可以满足大多数的场景，但如果是一些&lt;strong&gt;&quot;不确定&quot;&lt;/strong&gt;的查询条件呢？&lt;br/&gt;我们知道，JPA 定义了一套的API来帮助我们实现灵活的查询，通过EntityManager 可以实现各种灵活的组合查询。&lt;br/&gt;那么在 Spring Data JPA 框架中该如何实现呢？&lt;/p&gt;
&lt;p&gt;首先创建一个自定义查询的接口：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public interface BookRepositoryCustom {
    public PageResult&amp;lt;Book&amp;gt; search(String type, String title, boolean hasFav, Pageable pageable);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;接下来让 BookRepository 继承于该接口：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@Repository
public interface BookRepository extends JpaRepository&amp;lt;Book, Long&amp;gt;, BookRepositoryCustom {
    ...&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;最终是 实现这个自定义接口，通过 AOP 的&quot;魔法&quot;，框架会将我们的实现自动嫁接到接口实例上。&lt;br/&gt;具体的实现如下：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public class BookRepositoryImpl implements BookRepositoryCustom {

    private final EntityManager em;

    @Autowired
    public BookRepositoryImpl(JpaContext context) {
        this.em = context.getEntityManagerByManagedType(Book.class);
    }

    @Override
    public PageResult&amp;lt;Book&amp;gt; search(String type, String title, boolean hasFav, Pageable pageable) {
        CriteriaBuilder cb = em.getCriteriaBuilder();
        CriteriaQuery cq = cb.createQuery();

        Root&amp;lt;Book&amp;gt; root = cq.from(Book.class);

        List&amp;lt;Predicate&amp;gt; conds = new ArrayList&amp;lt;&amp;gt;();

        //按类型检索
        if (!StringUtils.isEmpty(type)) {
            conds.add(cb.equal(root.get(&quot;type&quot;).as(String.class
            ), type));
        }

        //标题模糊搜索
        if (!StringUtils.isEmpty(title)) {
            conds.add(cb.like(root.get(&quot;title&quot;).as(String.class
            ), &quot;%&quot; + title + &quot;%&quot;));
        }

        //必须被收藏过
        if (hasFav) {
            conds.add(cb.gt(root.get(&quot;favCount&quot;).as(Integer.class
            ), 0));
        }

        //count 数量
        cq.select(cb.count(root)).where(conds.toArray(new Predicate[0]));
        Long count = (Long) em.createQuery(cq).getSingleResult();

        if (count &amp;lt;= 0) {
            return PageResult.empty();
        }

        //list 列表
        cq.select(root).where(conds.toArray(new Predicate[0]));

        //获取排序
        List&amp;lt;Order&amp;gt; orders = toOrders(pageable, cb, root);

        if (!CollectionUtils.isEmpty(orders)) {
            cq.orderBy(orders);
        }


        TypedQuery&amp;lt;Book&amp;gt; typedQuery = em.createQuery(cq);

        //设置分页
        typedQuery.setFirstResult(pageable.getOffset());
        typedQuery.setMaxResults(pageable.getPageSize());

        List&amp;lt;Book&amp;gt; list = typedQuery.getResultList();

        return PageResult.of(count, list);

    }

    private List&amp;lt;Order&amp;gt; toOrders(Pageable pageable, CriteriaBuilder cb, Root&amp;lt;?&amp;gt; root) {

        List&amp;lt;Order&amp;gt; orders = new ArrayList&amp;lt;&amp;gt;();
        if (pageable.getSort() != null) {
            for (Sort.Order o : pageable.getSort()) {
                if (o.isAscending()) {
                    orders.add(cb.asc(root.get(o.getProperty())));
                } else {
                    orders.add(cb.desc(root.get(o.getProperty())));
                }
            }
        }

        return orders;
    }

}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;聚合&quot;&gt;2. 聚合&lt;/h4&gt;
&lt;p&gt;聚合功能可以用 SQL 实现，但通过JPA 的 Criteria API 会更加简单。&lt;br/&gt;与实现自定义查询的方法一样，也是通过EntityManager来完成操作：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public List&amp;lt;Tuple&amp;gt; groupCount(){
    CriteriaBuilder cb = em.getCriteriaBuilder();
    CriteriaQuery cq = cb.createQuery();

    Root&amp;lt;Book&amp;gt; root = cq.from(Book.class);

    Path&amp;lt;String&amp;gt; typePath = root.get(&quot;type&quot;);

    //查询type/count(*)/sum(favCount)
    cq.select(cb.tuple(typePath,cb.count(root).alias(&quot;count&quot;), cb.sum(root.get(&quot;favCount&quot;))));
    //按type分组
    cq.groupBy(typePath);
    //按数量排序
    cq.orderBy(cb.desc(cb.literal(&quot;count&quot;)));

    //查询出元祖
    TypedQuery&amp;lt;Tuple&amp;gt; typedQuery = em.createQuery(cq);
    return typedQuery.getResultList();
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;上面的代码中，会按书籍的分组统计数量，且按数量降序返回。&lt;br/&gt;等价于下面的SQL：&lt;/p&gt;
&lt;p&gt;···&lt;br/&gt;select type, count(*) as count , sum(fav_count) from book&lt;br/&gt;group by type order by count;&lt;br/&gt;···&lt;/p&gt;
&lt;h4 id=&quot;视图&quot;&gt;3. 视图&lt;/h4&gt;
&lt;p&gt;视图的操作与表基本是相同的，只是视图一般是只读的(没有更新操作)。&lt;br/&gt;执行下面的语句可以创建一个视图：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;create view v_author_book as
 select b.id, b.title, a.name as author_name, 
        a.hometown as author_hometown, b.created_at
   from author a, book b
   where a.id = b.author_id;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;在代码中使用@Table来进行映射：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@Entity
@Table(name = &quot;v_author_book&quot;)
public class AuthorBookView {

    @Id
    private Long id;
    private String title;

    @Column(name = &quot;author_name&quot;)
    private String authorName;
    @Column(name = &quot;author_hometown&quot;)
    private String authorHometown;

    @Column(name = &quot;created_at&quot;)
    private Date createdAt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;创建一个相应的Repository：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@Repository
public interface AuthorBookViewRepository extends JpaRepository&amp;lt;AuthorBookView, Long&amp;gt; {

}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;这样就可以进行读写了。&lt;/p&gt;
&lt;h4 id=&quot;连接池&quot;&gt;4. 连接池&lt;/h4&gt;
&lt;p&gt;在生产环境中一般需要配置合适的连接池大小，以及超时参数等等。&lt;br/&gt;这些需要通过对数据源(DataSource)进行配置来实现，DataSource也是一个抽象定义，默认情况下SpringBoot 1.x会使用Tomcat的连接池。&lt;/p&gt;
&lt;p&gt;以Tomcat的连接池为例，配置如下：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;spring.datasource.type=org.apache.tomcat.jdbc.pool.DataSource

# 初始连接数
spring.datasource.tomcat.initial-size=15
# 获取连接最大等待时长(ms)
spring.datasource.tomcat.max-wait=20000
# 最大连接数
spring.datasource.tomcat.max-active=50
# 最大空闲连接
spring.datasource.tomcat.max-idle=20
# 最小空闲连接
spring.datasource.tomcat.min-idle=15
# 是否自动提交事务
spring.datasource.tomcat.default-auto-commit=true &lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;从&lt;a href=&quot;http://tomcat.apache.org/tomcat-8.5-doc/jdbc-pool.html#Common_Attributes&quot;&gt;这里&lt;/a&gt;可以找到一些详尽的参数&lt;/p&gt;
&lt;h4 id=&quot;事务&quot;&gt;5. 事务&lt;/h4&gt;
&lt;p&gt;SpringBoot 默认情况下会为我们开启事务的支持，引入 spring-starter-data-jpa 的组件将会默认使用 &lt;strong&gt;JpaTransactionManager&lt;/strong&gt; 用于事务管理。&lt;br/&gt;在业务代码中使用@Transactional 可以声明一个事务，如下：&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@Transactional(propagation = Propagation.REQUIRED, 
        isolation = Isolation.DEFAULT, 
        readOnly = false, 
        rollbackFor = Exception.class)
public boolean updateBook(Long bookId, String type, String title, String description) {
...&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;为了演示事务的使用，上面的代码指定了几个关键属性，包括：&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;propagation 传递行为，指事务的创建或嵌套处理，默认为 REQUIRED&lt;/li&gt;
&lt;/ul&gt;&lt;table&gt;&lt;thead/&gt;&lt;tbody readability=&quot;6&quot;&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;REQUIRED&lt;/td&gt;
&lt;td&gt;使用已存在的事务，如果没有则创建一个。&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;MANDATORY&lt;/td&gt;
&lt;td&gt;如果存在事务则加入，如果没有事务则报错。&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;REQUIRES_NEW&lt;/td&gt;
&lt;td&gt;创建一个事务，如果已存在事务会将其挂起。&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;NOT_SUPPORTED&lt;/td&gt;
&lt;td&gt;以非事务方式运行，如果当前存在事务，则将其挂起。&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;NEVER&lt;/td&gt;
&lt;td&gt;以非事务方式运行，如果当前存在事务，则抛出异常。&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;NESTED&lt;/td&gt;
&lt;td&gt;创建一个事务，如果已存在事务，新事务将嵌套执行。&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;ul&gt;&lt;li&gt;isolation 隔离级别，默认值为DEFAULT&lt;/li&gt;
&lt;/ul&gt;&lt;table&gt;&lt;thead/&gt;&lt;tbody readability=&quot;7&quot;&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;DEFAULT&lt;/td&gt;
&lt;td&gt;默认值，使用底层数据库的默认隔离级别。大部分等于READ_COMMITTED&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;3&quot;&gt;&lt;td&gt;READ_UNCOMMITTED&lt;/td&gt;
&lt;td&gt;未提交读，一个事务可以读取另一个事务修改但还没有提交的数据。不能防止脏读和不可重复读。&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;3&quot;&gt;&lt;td&gt;READ_COMMITTED&lt;/td&gt;
&lt;td&gt;已提交读，一个事务只能读取另一个事务已经提交的数据。可以防止脏读，大多数情况下的推荐值。&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;3&quot;&gt;&lt;td&gt;REPEATABLE_READ&lt;/td&gt;
&lt;td&gt;可重复读，一个事务在整个过程中可以多次重复执行某个查询，并且每次返回的记录都相同。可以防止脏读和不可重复读。&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;3&quot;&gt;&lt;td&gt;SERIALIZABLE&lt;/td&gt;
&lt;td&gt;串行读，所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，可以防止脏读、不可重复读以及幻读。性能低。&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;ul readability=&quot;-0.5&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;readOnly&lt;br/&gt;指示当前事务是否为只读事务，默认为false&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;rollbackFor&lt;br/&gt;指示当捕获什么类型的异常时会进行回滚，默认情况下产生 RuntimeException 和 Error 都会进行回滚(受检异常除外)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;a href=&quot;https://gitee.com/littleatp/springboot-samples/tree/master/springboot-samples/springboot-jpa&quot;&gt;码云同步代码&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;参考文档&lt;/em&gt;&lt;/strong&gt;&lt;br/&gt;https://www.baeldung.com/spring-boot-tomcat-connection-pool&lt;br/&gt;https://www.baeldung.com/transaction-configuration-with-jpa-and-spring&lt;br/&gt;https://www.callicoder.com/spring-boot-jpa-hibernate-postgresql-restful-crud-api-example/&lt;br/&gt;https://docs.spring.io/spring-data/jpa/docs/1.11.0.RELEASE/reference/html/#projections&lt;br/&gt;https://www.cnblogs.com/yueshutong/p/9409295.html&lt;/p&gt;
&lt;h2 id=&quot;小结&quot;&gt;小结&lt;/h2&gt;
&lt;p&gt;本篇文章描述了一个完整的 SpringBoot + JPA + PostGreSQL 开发案例，一些做法可供大家借鉴使用。&lt;br/&gt;由于 JPA 帮我们简化许多了数据库的开发工作，使得我们在使用数据库时并不需要了解过多的数据库的特性。&lt;br/&gt;因此，本文也适用于整合其他的关系型数据库。&lt;br/&gt;前面也已经提到过，PostGreSQL由于其开源许可的开放性受到了云计算大T的青睐，相信未来前景可期。在接下来将会更多的关注该数据库的发展。&lt;/p&gt;
&lt;p&gt;欢迎继续关注&quot;美码师的补习系列-springboot篇&quot; ，期待更多精彩内容^-^&lt;/p&gt;
</description>
<pubDate>Tue, 19 Mar 2019 23:36:00 +0000</pubDate>
<dc:creator>美码师</dc:creator>
<og:description>[TOC] SpringBoot 整合 PostGreSQL 一、PostGreSQL简介 PostGreSQL是一个功能强大的开源对象关系数据库管理系统(ORDBMS)，号称 世界上最先进的开源关系</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/littleatp/p/10562583.html</dc:identifier>
</item>
<item>
<title>IT老人，给后辈的十一点建议 - 技术小工</title>
<link>http://www.cnblogs.com/qianpangzi/p/10562574.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/qianpangzi/p/10562574.html</guid>
<description>&lt;p&gt;我已经在IT业打拼9年了，从完全自学成为技术团队leader到PM也确实总结了不少的经验，自己也经常跟学弟学妹聊天，分享职场经验，当老家有人报考计算机或者从事相关工作时也会咨询我的意见，我很明白IT人的艰辛。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;1、不要高估自己的能力，也不要低估自己的潜力。&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;有时候不要高估自己的能力，当初我做技术的时候，什么都想学，觉得什么都简单，php，java，go前端混着学，觉得自己学的快，别人不行我行，可是后来发现典型的囫囵吞枣，没有那个精力也没有那个时间。 反而浪费了大量的时间，应该每个阶段用每个阶段的工具，做每个阶段应该做的事情。&lt;/p&gt;
&lt;p&gt;再者当老板安排任务的时候也不要高估自己的能力，什么都接什么都承诺，有时候就算你24小时每分每秒在做也完不成。反而会留下什么都做不好的印象。&lt;/p&gt;
&lt;p&gt;不管做什么事儿都要量力而行。&lt;/p&gt;
&lt;p&gt;但是也不要低估自己的潜力。当初我从php转到java，其实很吃力，但是做了很多复盘，每天比别人努力一点，周末少玩一点，最后顺利的超越别人。也影响了项目的核心决策。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;2、成为某一领域的专家&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;多争取资源，积累在某一领域的能力，当你在某一领域具有影响力的时候，你也就成功了。我有个朋友，之前做电商运营，对各种玩法研究很透，现在做讲师学员遍地，口碑爆棚。&lt;/p&gt;
&lt;p&gt;如果你是技术，那么一定要对自己的技术栈深入下去，不管多么小的市场永远缺的是头部玩家，什么都会的其实什么都做的一般，那么公司只能让你当做码农，奋斗在开发一线。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;3、积累人脉，与人和善，切记不要做老好人&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;不管工作中还是生活中，一定要积累人脉，与人和善，这些人脉将是你后来发展的重要资源，很多人的成功就是因为有不一样的圈子和人脉。&lt;/p&gt;
&lt;p&gt;在工作中不要做老好人，否则你永远都不是被优先考虑的对象，大家永远觉得你一般般。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;4、不要迷失在平台里&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;很多人在大厂，在大的平台，觉得自己很牛逼，其实牛逼的不是你，而是你所在的平台，都是平台成就人，很少是人来成就平台。&lt;/p&gt;
&lt;p&gt;在哪个平台就要积累这个平台能给你带来的资源和经验，要透过平台看看外面的世界，不要离开了平台，就变得泯然众人矣。要对的起平台给你带来的光环。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;5、既要低头拉车，也要抬头看路&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;很多IT人焦虑，作为IT人一定要突破自己专业的屏障，要抬头看路，做好未来规划。不要自己默默无闻勤勤恳恳的付出，然后被公司一脚踢开，出去才发现世界已经变了。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;6、心要大，也要胸腔装的下&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;做人要有野心，IT业也一样，要争取机会发展自己，但是野心不要过大，不然会适得其反，把自己逼入无人敢接触的境地。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;7、大部分公司是青春和健康驱动的公司&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;在中国绝大部分公司都是青春和健康驱动的公司，消磨时间和健康创造价值，996遍地都是，你要钱，人家要命。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;8、技术不是一切，生活才是&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;如果你是技术，千万别盲目的追求技术，有时候不差那点儿时间，技术人就是一直在不断的学习，工作日没时间，周末可能还要学习，没有时间。有时候不差那点儿时间，多享受生活，陪陪家人。毕竟学习技术的初衷就是养家养活自己，过上更好的生活。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;9、说员工不努力的公司都有问题&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;之前我朋友向我抱怨，公司说员工不努力，要求大家跟公司一起成长，要改下班时间，每天固定9点，其实之前不固定每天安排的工作都做不完，要到10点多甚至凌晨下班，现在固定后任务更重了，已经要把自己拖垮了。&lt;/p&gt;
&lt;p&gt;这种公司千万不能留到过年，任务安排不当，效率低下，管理混乱，乌烟瘴气。这些却让员工背锅。最好远离这种公司。&lt;/p&gt;
&lt;p&gt;公司要大家跟公司一起成长，其实对于员工来说什么都没涨，公资待遇没涨，倒是发际线和黑眼圈还有亚健康增长了。&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;10、不要总是守着自己的一亩三分地&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;要学会全面发展，不要总守着自己的一亩三分地，做技术的也可以学学营销，时间充足学下下产品，理财。代码写的好并不妨碍你文章写的好，并不妨碍你歌唱的好，也并不妨碍你具有牛批的商业思维。&lt;/p&gt;
&lt;p&gt;认知，思维，视野只有突破自己圈子的局限性，才能看得更高，走的更远。&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;11、抓住机遇，但不是所有的猪都能被风吹起&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;互联网每年都有风口，每年都有新的方向，但是很快就会出现头部玩家。比如移动互联网，比如团购、外卖、直播、共享、打车等等。&lt;/p&gt;
&lt;p&gt;无论是找工作还是创业要跟随趋势，抓住机遇，虽然在互联网上说，猪在风口都能飞起，但是毕竟是个别的猪，大部分猪还是被宰的。&lt;/p&gt;
&lt;p&gt;作为一个IT人，我一直认为“既要鸡汤鼓励，也要脚踏实地！”，一定要突破技术造成的屏障，看看外面的世界，不要太精彩。&lt;/p&gt;
</description>
<pubDate>Tue, 19 Mar 2019 23:24:00 +0000</pubDate>
<dc:creator>技术小工</dc:creator>
<og:description>我已经在IT业打拼9年了，从完全自学成为技术团队leader到PM也确实总结了不少的经验，自己也经常跟学弟学妹聊天，分享职场经验，当老家有人报考计算机或者从事相关工作时也会咨询我的意见，我很明白IT人</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/qianpangzi/p/10562574.html</dc:identifier>
</item>
<item>
<title>从小白到区块链工程师：第一阶段：Go语言环境的搭建（1） - Rocky Ren</title>
<link>http://www.cnblogs.com/renyanlei/p/10562536.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/renyanlei/p/10562536.html</guid>
<description>&lt;p&gt;&lt;span&gt;       2009年由谷歌公司推出，由C语言之父Ken Thompson主导研发。&lt;strong&gt;Go&lt;/strong&gt;（又称&lt;strong&gt;Golang&lt;/strong&gt;）是Google开发的一种静态强类型、编译型、并发型，并具有垃圾回收功能的编程语言。可爱的吉祥物是地鼠。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320024006427-1092074502.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;&lt;span&gt;&lt;strong&gt;      提示：&lt;/strong&gt;我们本套课程后面的区块链开发是基于Ubuntu操作系统的，但我们在前期学习Go语言语法的过程中使用Windows10操作系统。Go语言是跨平台的。（指的是不同的这个语言可以在不同的操作系统服务器开发Linux,Window,Mac…..）。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;     如果想开发Go语言程序，那么我们的计算机首先要安装Go语言的环境。&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320024223499-1637118976.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;    我们前期使用Windows。所以选择下载图中所示的Windows版本。下载完成之后我们找到刚下好的安装包。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320024356132-1042800549.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h2 align=&quot;center&quot;&gt;&lt;span lang=&quot;EN-US&quot;&gt;2： 安装&lt;span lang=&quot;EN-US&quot;&gt;Go语言开发包&lt;/span&gt;&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;&lt;span&gt;   双击go语言安装包，界面效果如下所示。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320024525383-77477588.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;   点击“运行”。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320024622968-2147187986.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320024642318-1775878587.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;   点击“Next”。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320024746730-1274387418.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;    选择你安装的目录，我这里不做修改，直接点击“Next”。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320024931368-1803278053.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;点击“Install(安装)”。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320025042540-1439275666.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320025105577-1602251272.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;   点击“finish”完成。我们怎么测试一下是否go语言的安装包已经安装成功了呢？&lt;/span&gt;&lt;/p&gt;
&lt;h2 align=&quot;center&quot;&gt;&lt;span lang=&quot;EN-US&quot;&gt;3： 检测是否安装成功？&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;&lt;span&gt;    通过window系统的命令行来查看，首先，按住你键盘上的Win+R键。弹出命令行对话框。输入指令“cmd”。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320025218891-2036496244.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;   打开Windows下面的命令提示行窗口。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320025303028-1415147781.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;   直接输入指令，go version。回车出现安装的go语言版本信息。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320025339050-1373407101.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320025350831-1998922395.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h2 align=&quot;center&quot;&gt;&lt;span lang=&quot;EN-US&quot;&gt;4： 配置&lt;span lang=&quot;EN-US&quot;&gt;go语言的环境&lt;/span&gt;&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;&lt;span&gt;我们需要配置两个环境变量。GOPATH和GOROOT。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;GOPATH为项目目录（你将来在什么地方写代码的文件夹）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;GOROOT为安装目录（你的Go语言安装包安装在了什么地方）。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;我们来配置一下这两个安装环境，首先右击“此电脑”。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320025459048-2038051713.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt; &lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320025513013-357438610.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;   点击“高级系统设置”。在“高级”选项卡下面有一个“环境变量”。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320025552565-1808540520.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;点击“环境变量”。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320025645113-273662109.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;   我们看到这里GOROOT的变量已经配置好了，指向了我们Go语言安装的位置。我们点击“新建”，将GOPATH添加到系统变量中。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320025736801-1920864271.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;我们现在电脑上还有建立一个存放我们代码的文件夹。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;我们在电脑里新建一个即可，比如说我的代码放在D盘下的GoCode文件夹，在GoCode下面我新建了一个子文件夹叫做src来存放我以后写的代码（注意：在golang语言中大家约定俗成的存放源文件的文件夹名称都是src。后面详细解释）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320025840052-1681931929.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320025853759-1921411397.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;   回到我们的系统变量中，我们来配置系统变量。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320025938980-814366707.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;点击“确定”之后，我们就配置好了。我们来看一下是否将系统变量配置好。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;首先我们准备一个go语言的源代码。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;在D：\GoCode\src下面新建一个HelloWorld.go文件。&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;（记事本文件）&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320030021813-1659713569.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;打开文本文件里输入以下代码：复制下面的代码，粘贴到新建的HelloWorld.txt.&lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;center&quot;&gt;&lt;span&gt;&lt;strong&gt;package&lt;/strong&gt; main&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&lt;strong&gt;import&lt;/strong&gt; &quot;fmt&quot;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;func main() {&lt;/span&gt;&lt;br/&gt;&lt;span&gt;    fmt.Println(&quot;Hello, World!&quot;)&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320030253977-746080696.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p align=&quot;left&quot;&gt;&lt;span&gt;保存并修改后缀名为.go。（注意go语言的后缀名为.go），保存完毕之后，我们在控制台将这个程序运行起来。看是否能够出现“HelloWorld”。&lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;left&quot;&gt;&lt;span&gt;步骤如下，输入cmd命令。打开控制台。&lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;left&quot;&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320030321585-310014458.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;left&quot;&gt;&lt;span&gt;找到我们的源代码所在的位置。（命令行找到）。&lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;left&quot;&gt;&lt;span&gt;D：&lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;left&quot;&gt;&lt;span&gt;cd GoCode/src&lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;left&quot;&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320030400185-2032558793.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p align=&quot;left&quot;&gt;&lt;span&gt;执行指令“go run HelloWorld.go”。&lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;left&quot;&gt;&lt;span&gt;显示效果如下所示。&lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;left&quot;&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320030436952-152273268.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;left&quot;&gt;&lt;span&gt;安装配置成功。&lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;left&quot;&gt;&lt;span&gt;本套课程我录制的有视频课程。在学习中我希望和大家一起沟通探讨，需要视频或者想与我沟通的朋友可以加微信。&lt;/span&gt;&lt;/p&gt;
&lt;p align=&quot;left&quot;&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/294888/201903/294888-20190320030709337-1961367829.png&quot; alt=&quot;&quot;/&gt;&lt;/span&gt;&lt;/p&gt;

</description>
<pubDate>Tue, 19 Mar 2019 19:08:00 +0000</pubDate>
<dc:creator>Rocky Ren</dc:creator>
<og:description>一，Golang语言简介 2009年由谷歌公司推出，由C语言之父Ken Thompson主导研发。Go（又称Golang）是Google开发的一种静态强类型、编译型、并发型，并具有垃圾回收功能的编程语</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/renyanlei/p/10562536.html</dc:identifier>
</item>
<item>
<title>聊聊微服务熔断降级Hystrix - 黄青石</title>
<link>http://www.cnblogs.com/huangqingshi/p/10555828.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/huangqingshi/p/10555828.html</guid>
<description>&lt;p&gt;　　在现在的微服务使用的过程中，经常会遇到依赖的服务不可用，那么如果依赖的服务不可用的话，会导致把自己的服务也会拖死，那么就产生了熔断，熔断顾名思义就是当服务处于不可用的时候采取半开关的状态，达到一定数量后就熔断器就打开。这就相当于家里边的保险丝，如果电压过高的话，保险丝就会断掉，起到保护电器的作用。&lt;/p&gt;
&lt;p&gt;　　目前支持熔断，降级的就是Hystrix，当然还有resilience4j还有Sentinel。今天咱们以Hystrix为主吧。其他的大家可以自行研究。&lt;/p&gt;
&lt;p&gt;　　Hystrix主要实现三个功能，接下来咱们继续展开。&lt;/p&gt;
&lt;p&gt;　　1. 资源隔离&lt;/p&gt;
&lt;p&gt;　　2. 熔断&lt;/p&gt;
&lt;p&gt;　　3. 降级&lt;/p&gt;
&lt;p&gt;　　资源隔离分为两种，一种是线程池隔离，一种是信号量semaphore隔离。线程池以请求的线程和执行的线程分为不同的线程执行，信号量是请求和执行采用相同的线程。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1236784/201903/1236784-20190319230151311-1010911048.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　当然，涉及到线程池的话，那么就支持异步，支持异步Future的话也就支持get的时候支持超时获取。信号量这些功能不支持，但是信号量是支持熔断，限流。他们的区别如下：&lt;/p&gt;
&lt;table border=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt; &lt;/td&gt;
&lt;td&gt;线程切换&lt;/td&gt;
&lt;td&gt;异步&lt;/td&gt;
&lt;td&gt;超时&lt;/td&gt;
&lt;td&gt;熔断&lt;/td&gt;
&lt;td&gt;限流&lt;/td&gt;
&lt;td&gt;资源开销&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;线程池&lt;/td&gt;
&lt;td&gt;是&lt;/td&gt;
&lt;td&gt;是&lt;/td&gt;
&lt;td&gt;是&lt;/td&gt;
&lt;td&gt;是&lt;/td&gt;
&lt;td&gt;是&lt;/td&gt;
&lt;td&gt;大&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;信号量&lt;/td&gt;
&lt;td&gt;否&lt;/td&gt;
&lt;td&gt;否&lt;/td&gt;
&lt;td&gt;否&lt;/td&gt;
&lt;td&gt;是&lt;/td&gt;
&lt;td&gt;是&lt;/td&gt;
&lt;td&gt;小&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;　　HystrixCommand的命令执行大致如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1236784/201903/1236784-20190319230845028-1080393985.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　依赖的pom如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
        &lt;span&gt;&amp;lt;!--&lt;/span&gt;&lt;span&gt; 依赖版本 &lt;/span&gt;&lt;span&gt;--&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;hystrix.version&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;1.3.16&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;hystrix.version&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;hystrix-metrics-event-stream.version&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;1.1.2&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;hystrix-metrics-event-stream.version&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;

        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;com.netflix.hystrix&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;hystrix-core&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;version&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;${hystrix.version}&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;version&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;com.netflix.hystrix&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;hystrix-metrics-event-stream&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;version&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;${hystrix-metrics-event-stream.version}&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;version&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　支持同步，异步，观察事件拦截，以及订阅方式，下面咱们直接看代码实现吧。大家一看就明白了：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;42&quot;&gt;
&lt;pre&gt;
&lt;span&gt;import&lt;/span&gt;&lt;span&gt; com.netflix.hystrix.HystrixCommand;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; com.netflix.hystrix.HystrixCommandGroupKey;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; rx.Observable;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; rx.Subscriber;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; rx.functions.Action1;

&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.concurrent.ExecutionException;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.concurrent.Future;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.concurrent.TimeUnit;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.concurrent.TimeoutException;

&lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
 * &lt;/span&gt;&lt;span&gt;@author&lt;/span&gt;&lt;span&gt; huangqingshi
 * @Date 2019-03-17
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; HelloWorldCommand &lt;span&gt;extends&lt;/span&gt; HystrixCommand&amp;lt;String&amp;gt;&lt;span&gt; {

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; String name;

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; HelloWorldCommand(String name) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;指定命令组名&lt;/span&gt;
        &lt;span&gt;super&lt;/span&gt;(HystrixCommandGroupKey.Factory.asKey(&quot;myGroup&quot;&lt;span&gt;));
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.name =&lt;span&gt; name;
    }

    @Override
    &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt; String run() &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Exception {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;逻辑封装在run里边&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt; &quot;Hello:&quot; + name + &quot; thread:&quot; +&lt;span&gt; Thread.currentThread().getName();
    }


    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; main(String[] args) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; InterruptedException, ExecutionException, TimeoutException {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;每个Command只能调用一次，不能重复调用。重复调用会报异常。&lt;/span&gt;
        HelloWorldCommand  helloWorldCommand = &lt;span&gt;new&lt;/span&gt; HelloWorldCommand(&quot;Synchronous-hystrix&quot;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;execute同步调用 等同于：helloWorldCommand.queue().get();&lt;/span&gt;
        String result =&lt;span&gt; helloWorldCommand.execute();
        System.out.println(&lt;/span&gt;&quot;result:&quot; +&lt;span&gt; result);

        helloWorldCommand &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; HelloWorldCommand(&quot;Asynchronous-hystrix&quot;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;异步调用&lt;/span&gt;
        Future&amp;lt;String&amp;gt; future =&lt;span&gt; helloWorldCommand.queue();
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;get可以指定获取的时间100毫秒，默认为1秒&lt;/span&gt;
        result = future.get(100&lt;span&gt;, TimeUnit.MILLISECONDS);
        System.out.println(&lt;/span&gt;&quot;result:&quot; +&lt;span&gt; result);
        System.out.println(&lt;/span&gt;&quot;main thread:&quot; +&lt;span&gt; Thread.currentThread().getName());

        testObserve();

    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; testObserve() {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;注册观察者事件拦截&lt;/span&gt;
        Observable&amp;lt;String&amp;gt; observable = &lt;span&gt;new&lt;/span&gt; HelloWorldCommand(&quot;observe&quot;&lt;span&gt;).observe();
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;注册回调事件&lt;/span&gt;
        observable.subscribe(&lt;span&gt;new&lt;/span&gt; Action1&amp;lt;String&amp;gt;&lt;span&gt;() {
            @Override
            &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; call(String result) {
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;result就是调用HelloWorldCommand的结果&lt;/span&gt;
                System.out.println(&quot;callback:&quot; +&lt;span&gt; result);
            }
        });
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;注册完成版的事件&lt;/span&gt;
        observable.subscribe(&lt;span&gt;new&lt;/span&gt; Subscriber&amp;lt;String&amp;gt;&lt;span&gt;() {
            @Override
            &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; onCompleted() {
                System.out.println(&lt;/span&gt;&quot;onCompleted调用：onNext : onError之后调用&quot;&lt;span&gt;);
            }

            @Override
            &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; onError(Throwable throwable) {
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;异常产生了之后会调用&lt;/span&gt;
                System.out.println(&quot;onError:&quot; +&lt;span&gt; throwable.getMessage());
            }

            @Override
            &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; onNext(String s) {
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;获取结果后回调&lt;/span&gt;
                System.out.println(&quot;onNext:&quot; +&lt;span&gt; s);
            }
        });
    }

}&lt;br/&gt;执行结果如下:&lt;br/&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;p&gt;result:Hello:Synchronous-hystrix thread:hystrix-myGroup-1&lt;br/&gt;result:Hello:Asynchronous-hystrix thread:hystrix-myGroup-2&lt;br/&gt;main thread:main&lt;br/&gt;callback:Hello:observe thread:hystrix-myGroup-3&lt;br/&gt;onNext:Hello:observe thread:hystrix-myGroup-3&lt;br/&gt;onCompleted调用：onNext : onError之后调用&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;　　接下来是线程池隔离的例子：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;import&lt;/span&gt; com.netflix.hystrix.*&lt;span&gt;;

&lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
 * &lt;/span&gt;&lt;span&gt;@author&lt;/span&gt;&lt;span&gt; huangqingshi
 * @Date 2019-03-17
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; ThreadPoolCommand &lt;span&gt;extends&lt;/span&gt; HystrixCommand&amp;lt;String&amp;gt;&lt;span&gt; {

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt;&lt;span&gt; String name;

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; ThreadPoolCommand(String name) {
        &lt;/span&gt;&lt;span&gt;super&lt;/span&gt;(Setter.withGroupKey(HystrixCommandGroupKey.Factory.asKey(&quot;threadPoolGroup&quot;&lt;span&gt;))
             .andCommandKey(HystrixCommandKey.Factory.asKey(&lt;/span&gt;&quot;threadPoolCommand&quot;&lt;span&gt;))
             .andCommandPropertiesDefaults(HystrixCommandProperties.Setter()
                .withCircuitBreakerRequestVolumeThreshold(&lt;/span&gt;10) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;至少10个请求，熔断器才进行错误计算 默认值20&lt;/span&gt;
                .withCircuitBreakerSleepWindowInMilliseconds(5000) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;熔断终端5秒后会进入半打开状态&lt;/span&gt;
                .withCircuitBreakerErrorThresholdPercentage(50)    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;错误率达到50开启熔断保护&lt;/span&gt;
&lt;span&gt;                .withExecutionIsolationStrategy(HystrixCommandProperties.ExecutionIsolationStrategy.THREAD)
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;10个核心线程&lt;/span&gt;
             ).andThreadPoolPropertiesDefaults(HystrixThreadPoolProperties.Setter().withCoreSize(10&lt;span&gt;))
        );
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.name =&lt;span&gt; name;
    }


    @Override
    &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt; String run() &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Exception {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &quot;threadPoolCommand name:&quot; +&lt;span&gt; name;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; main(String[] args) {
        ThreadPoolCommand threadPoolCommand &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; ThreadPoolCommand(&quot;threadPool&quot;&lt;span&gt;);
        String result &lt;/span&gt;=&lt;span&gt; threadPoolCommand.execute();
        System.out.println(&lt;/span&gt;&quot;result:&quot; +&lt;span&gt; result);
    }
}

执行结果：
result:threadPoolCommand name:threadPool&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　信号量隔离例子：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
 * &lt;/span&gt;&lt;span&gt;@author&lt;/span&gt;&lt;span&gt; huangqingshi
 * @Date 2019-03-17
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; SemaphoreCommand &lt;span&gt;extends&lt;/span&gt; HystrixCommand&amp;lt;String&amp;gt;&lt;span&gt; {

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt;&lt;span&gt; String name;

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; SemaphoreCommand(String name) {
        &lt;/span&gt;&lt;span&gt;super&lt;/span&gt;(Setter.withGroupKey(HystrixCommandGroupKey.Factory.asKey(&quot;semaphoreGroup&quot;&lt;span&gt;))
            .andCommandKey(HystrixCommandKey.Factory.asKey(&lt;/span&gt;&quot;semaphoreCommand&quot;&lt;span&gt;))
                .andCommandPropertiesDefaults(HystrixCommandProperties.Setter()
                 &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;至少10个请求，熔断器才会进行错误率的计算 默认值20&lt;/span&gt;
                .withCircuitBreakerRequestVolumeThreshold(10&lt;span&gt;)
                 &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;熔断器中断请求5秒后会自动进入半打开状态，放部分流量进行重试 默认值5000ms&lt;/span&gt;
                .withCircuitBreakerSleepWindowInMilliseconds(5000&lt;span&gt;)
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;错误率达到50开启熔断保护&lt;/span&gt;
                .withCircuitBreakerErrorThresholdPercentage(50&lt;span&gt;)
                 &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;设置隔离策略&lt;/span&gt;
&lt;span&gt;                .withExecutionIsolationStrategy(HystrixCommandProperties.ExecutionIsolationStrategy.SEMAPHORE)
                 &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;最大并发量10&lt;/span&gt;
                .withExecutionIsolationSemaphoreMaxConcurrentRequests(10&lt;span&gt;)
                )
        );
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.name =&lt;span&gt; name;
    }

    @Override
    &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt; String run() &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Exception {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &quot;semaphore success name:&quot; +&lt;span&gt; name;
    }

    @Override
    &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt;&lt;span&gt; String getFallback() {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &quot;semaphore fallback name:&quot; +&lt;span&gt; name;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; main(String[] args) {
        SemaphoreCommand semaphoreCommand &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; SemaphoreCommand(&quot;semaphoreCommand&quot;&lt;span&gt;);
        String result &lt;/span&gt;=&lt;span&gt; semaphoreCommand.execute();
        System.out.println(result);
    }

}
执行结果：
semaphore success name:semaphoreCommand&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　在执行的过程中，如果出现调用服务的时候出现错误的时候会先进行熔断，就是如果流量达到设置的量的时候进行统计，比如10个请求，然后如果出现错误率超过配置的错误率就会进行将熔断进行打开，打开之后会进行调用降级方法fallback。过了一段时间后，可以放行部分流量，如果流量正常了，则会将熔断器开关关闭。下图是来自官方文档截图，里边维护者一个bucket，每秒一个bucket，里边记录着成功，失败，超时，拒绝。这个周期是通过withCircuitBreakerSleepWindowInMilliseconds配置的。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1236784/201903/1236784-20190319232216713-1349163485.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　接下来咱们看一下降级，也就是熔断器打开的时候，会走fallback方法，继续看例子。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;import&lt;/span&gt; com.netflix.hystrix.*&lt;span&gt;;

&lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
 * &lt;/span&gt;&lt;span&gt;@author&lt;/span&gt;&lt;span&gt; huangqingshi
 * @Date 2019-03-17
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; ThreadPoolCommand &lt;span&gt;extends&lt;/span&gt; HystrixCommand&amp;lt;String&amp;gt;&lt;span&gt; {

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt;&lt;span&gt; String name;

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; ThreadPoolCommand(String name) {
        &lt;/span&gt;&lt;span&gt;super&lt;/span&gt;(Setter.withGroupKey(HystrixCommandGroupKey.Factory.asKey(&quot;threadPoolGroup&quot;&lt;span&gt;))
             .andCommandKey(HystrixCommandKey.Factory.asKey(&lt;/span&gt;&quot;threadPoolCommand&quot;&lt;span&gt;))
             .andCommandPropertiesDefaults(HystrixCommandProperties.Setter()
                .withCircuitBreakerRequestVolumeThreshold(&lt;/span&gt;10) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;至少10个请求，熔断器才进行错误计算 默认值20&lt;/span&gt;
                .withCircuitBreakerSleepWindowInMilliseconds(5000) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;熔断终端5秒后会进入半打开状态&lt;/span&gt;
                .withCircuitBreakerErrorThresholdPercentage(50)    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;错误率达到50开启熔断保护&lt;/span&gt;
&lt;span&gt;                .withExecutionIsolationStrategy(HystrixCommandProperties.ExecutionIsolationStrategy.THREAD)
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;10个核心线程&lt;/span&gt;
             ).andThreadPoolPropertiesDefaults(HystrixThreadPoolProperties.Setter().withCoreSize(10&lt;span&gt;))
        );
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.name =&lt;span&gt; name;
    }


    @Override
    &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt; String run() &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Exception {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &quot;threadPoolCommand name:&quot; +&lt;span&gt; name;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; main(String[] args) {
        ThreadPoolCommand threadPoolCommand &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; ThreadPoolCommand(&quot;threadPool&quot;&lt;span&gt;);
        String result &lt;/span&gt;=&lt;span&gt; threadPoolCommand.execute();
        System.out.println(&lt;/span&gt;&quot;result:&quot; +&lt;span&gt; result);
    }
}
执行结果：
result:executed fallback
并且抛出超时异常。因为程序故意设计超时的。&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　当然，Hystrixcommand还支持primary或secondary的方式，可以先看看流程图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1236784/201903/1236784-20190319233016831-1482429994.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;　　是否执行primary是通过参数primarySecondary.userPrimary为true时执行。false的时候执行secondary方式。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
 * &lt;/span&gt;&lt;span&gt;@author&lt;/span&gt;&lt;span&gt; huangqingshi
 * @Date 2019-03-18
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; PrimarySecondaryFacade &lt;span&gt;extends&lt;/span&gt; HystrixCommand&amp;lt;String&amp;gt;&lt;span&gt; {

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; DynamicBooleanProperty usePrimary =&lt;span&gt; DynamicPropertyFactory.getInstance().
            getBooleanProperty(&lt;/span&gt;&quot;primarySecondary.usePrimary&quot;, &lt;span&gt;true&lt;/span&gt;&lt;span&gt;);

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; id;

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; PrimarySecondaryFacade(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; id) {
        &lt;/span&gt;&lt;span&gt;super&lt;/span&gt;(Setter.withGroupKey(HystrixCommandGroupKey.Factory.asKey(&quot;facadeGroup&quot;&lt;span&gt;))
            .andCommandKey(HystrixCommandKey.Factory.asKey(&lt;/span&gt;&quot;primarySecondCommand&quot;&lt;span&gt;))
             &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;此处采用信号量，primary、secondary采用线程池&lt;/span&gt;
&lt;span&gt;            .andCommandPropertiesDefaults(HystrixCommandProperties.Setter().withExecutionIsolationStrategy(
                    HystrixCommandProperties.ExecutionIsolationStrategy.SEMAPHORE)
            )

        );
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.id =&lt;span&gt; id;
    }

    @Override
    &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt; String run() &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Exception {
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt;(usePrimary.get()) {
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; PrimaryCommand(id).execute();
        } &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; SecondaryCommand(id).execute();
        }
    }

    @Override
    &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt;&lt;span&gt; String getFallback() {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &quot;static-fallback-&quot; +&lt;span&gt; id;
    }

    @Override
    &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt;&lt;span&gt; String getCacheKey() {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; String.valueOf(id);
    }

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; PrimaryCommand &lt;span&gt;extends&lt;/span&gt; HystrixCommand&amp;lt;String&amp;gt;&lt;span&gt; {

        &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; id;

        &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; PrimaryCommand(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; id) {
            &lt;/span&gt;&lt;span&gt;super&lt;/span&gt;&lt;span&gt;(Setter
                    .withGroupKey(HystrixCommandGroupKey.Factory.asKey(&lt;/span&gt;&quot;facadeGroup&quot;&lt;span&gt;))
                    .andCommandKey(HystrixCommandKey.Factory.asKey(&lt;/span&gt;&quot;PrimaryCommand&quot;&lt;span&gt;))
                    .andThreadPoolKey(HystrixThreadPoolKey.Factory.asKey(&lt;/span&gt;&quot;PrimaryCommand&quot;&lt;span&gt;))
                    .andCommandPropertiesDefaults(HystrixCommandProperties.Setter().
                            withExecutionIsolationThreadTimeoutInMilliseconds(&lt;/span&gt;600&lt;span&gt;)));
            &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.id =&lt;span&gt; id;
        }

        @Override
        &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt;&lt;span&gt; String run() {
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &quot;responseFromPrimary-&quot; +&lt;span&gt; id;
        }

    }

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; SecondaryCommand &lt;span&gt;extends&lt;/span&gt; HystrixCommand&amp;lt;String&amp;gt;&lt;span&gt; {

        &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; id;

        &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; SecondaryCommand(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; id) {
            &lt;/span&gt;&lt;span&gt;super&lt;/span&gt;&lt;span&gt;(Setter
                    .withGroupKey(HystrixCommandGroupKey.Factory.asKey(&lt;/span&gt;&quot;facadeGroup&quot;&lt;span&gt;))
                    .andCommandKey(HystrixCommandKey.Factory.asKey(&lt;/span&gt;&quot;SecondaryCommand&quot;&lt;span&gt;))
                    .andThreadPoolKey(HystrixThreadPoolKey.Factory.asKey(&lt;/span&gt;&quot;SecondaryCommand&quot;&lt;span&gt;))
                    .andCommandPropertiesDefaults(HystrixCommandProperties.Setter().
                            withExecutionIsolationThreadTimeoutInMilliseconds(&lt;/span&gt;600&lt;span&gt;)));
            &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.id =&lt;span&gt; id;
        }

        @Override
        &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt;&lt;span&gt; String run() {
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &quot;responseFromSecondary-&quot; +&lt;span&gt; id;
        }

    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; UnitTest {

        @Test
        &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; testPrimary() {
            HystrixRequestContext context &lt;/span&gt;=&lt;span&gt; HystrixRequestContext.initializeContext();
            &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
                ConfigurationManager.getConfigInstance().setProperty(&lt;/span&gt;&quot;primarySecondary.usePrimary&quot;, &lt;span&gt;true&lt;/span&gt;&lt;span&gt;);
                assertEquals(&lt;/span&gt;&quot;responseFromPrimary-100&quot;, &lt;span&gt;new&lt;/span&gt; PrimarySecondaryFacade(100&lt;span&gt;).execute());
            } &lt;/span&gt;&lt;span&gt;finally&lt;/span&gt;&lt;span&gt; {
                context.shutdown();
                ConfigurationManager.getConfigInstance().clear();
            }
        }

        @Test
        &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; testSecondary() {
            HystrixRequestContext context &lt;/span&gt;=&lt;span&gt; HystrixRequestContext.initializeContext();
            &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
                ConfigurationManager.getConfigInstance().setProperty(&lt;/span&gt;&quot;primarySecondary.usePrimary&quot;, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
                assertEquals(&lt;/span&gt;&quot;responseFromSecondary-100&quot;, &lt;span&gt;new&lt;/span&gt; PrimarySecondaryFacade(100&lt;span&gt;).execute());
            } &lt;/span&gt;&lt;span&gt;finally&lt;/span&gt;&lt;span&gt; {
                context.shutdown();
                ConfigurationManager.getConfigInstance().clear();
            }
        }
    }


}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;　　好了，这个基本上就是Hystrix的基本功能，但是有个问题就是Hystrix已经不维护了，但是目前的稳定版大家也都在使用，所以列出来了。当然也推荐大家使用Sentinel，功能比较强大，就是自适应限流功能等，功能也非常强大，后续研究之后再出相关文章吧。这个文章就当大家的一个敲门砖吧，有问题请及时告知，谢谢。&lt;/p&gt;


</description>
<pubDate>Tue, 19 Mar 2019 15:34:00 +0000</pubDate>
<dc:creator>黄青石</dc:creator>
<og:description>在现在的微服务使用的过程中，经常会遇到依赖的服务不可用，那么如果依赖的服务不可用的话，会导致把自己的服务也会拖死，那么就产生了熔断，熔断顾名思义就是当服务处于不可用的时候采取半开关的状态，达到一定数量</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/huangqingshi/p/10555828.html</dc:identifier>
</item>
<item>
<title>PXE+Kickstart无人值守安装系统re - f1烈日灼心</title>
<link>http://www.cnblogs.com/volac/p/10562245.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/volac/p/10562245.html</guid>
<description>&lt;p&gt;PXE（Preboot Excute Environment）预启动执行环境，可以让计算机通过网络启动系统，主要用于无人值守安装系统中引导客户端主机安装Linux操作系统。&lt;/p&gt;
&lt;p&gt;由于之前有过使用cobbler+kickstart PXE安装系统的博客，这里RHEL7下使用第二种方法。&lt;/p&gt;
&lt;h3&gt;&lt;span id=&quot;192&quot;&gt;&lt;strong&gt;部署PXE相关环境&lt;/strong&gt;&lt;/span&gt;&lt;/h3&gt;
&lt;h4&gt;&lt;span&gt;&lt;strong&gt;第一步：DHCP服务&lt;/strong&gt;&lt;/span&gt;&lt;/h4&gt;
&lt;h5&gt;&lt;span&gt;&lt;strong&gt;部署DHCP服务之前，由于使用虚拟机测试，为了避免虚拟机软件的DHCP功能对本实验造成影响，在网络配置中将应用DHCP服务选项取消掉&lt;/strong&gt;&lt;/span&gt;&lt;/h5&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1491231/201903/1491231-20190319220639461-1805303388.png&quot; alt=&quot;&quot;/&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h5&gt; 安装DHCP服务&lt;/h5&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
[root@localhost ~]# &lt;span&gt;yum&lt;/span&gt; &lt;span&gt;install&lt;/span&gt; -y dhcp
&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;编辑DHCP服务配置文件&lt;/h5&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
[root@localhost ~]# vim /etc/dhcp/dhcpd.conf
&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;配置文件&lt;/h5&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;allow booting;
allow bootp;
ddns&lt;/span&gt;-update-&lt;span&gt;style interim;
ignore client&lt;/span&gt;-&lt;span&gt;updates;
subnet &lt;/span&gt;&lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;10.0&lt;/span&gt; netmask &lt;span&gt;255.255&lt;/span&gt;.&lt;span&gt;255.0&lt;/span&gt;&lt;span&gt; {
        option subnet&lt;/span&gt;-mask &lt;span&gt;255.255&lt;/span&gt;.&lt;span&gt;255.0&lt;/span&gt;&lt;span&gt;;
        option domain&lt;/span&gt;-name-servers &lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;10.10&lt;/span&gt;&lt;span&gt;;
        range dynamic&lt;/span&gt;-bootp &lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;10.50&lt;/span&gt; &lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;10.100&lt;/span&gt;&lt;span&gt;;
        default&lt;/span&gt;-lease-&lt;span&gt;time&lt;/span&gt; &lt;span&gt;21600&lt;/span&gt;&lt;span&gt;;
        max&lt;/span&gt;-lease-&lt;span&gt;time&lt;/span&gt; &lt;span&gt;43200&lt;/span&gt;&lt;span&gt;;
        next&lt;/span&gt;-server &lt;span&gt;192.168&lt;/span&gt;.&lt;span&gt;10.10&lt;/span&gt;&lt;span&gt;;
        filename    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;pxelinux.0&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;配置完成重启DHCP服务，由于DHCP服务未成功启动也不会报错，所以查看一下DHCPD服务状态&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
[root@localhost ~&lt;span&gt;]# systemctl restart dhcpd
[root@localhost &lt;/span&gt;~&lt;span&gt;]# systemctl status dhcpd
dhcpd.service &lt;/span&gt;-&lt;span&gt; DHCPv4 Server Daemon
   Loaded: loaded (&lt;/span&gt;/usr/lib/systemd/system/&lt;span&gt;dhcpd.service; disabled)
   Active: &lt;span&gt;failed&lt;/span&gt; (Result: exit&lt;/span&gt;-code) since Tue &lt;span&gt;2019&lt;/span&gt;-&lt;span&gt;03&lt;/span&gt;-&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt;&lt;span&gt; EDT; 6s ago
     Docs: &lt;/span&gt;&lt;span&gt;man&lt;/span&gt;:dhcpd(&lt;span&gt;8&lt;/span&gt;&lt;span&gt;)
           &lt;/span&gt;&lt;span&gt;man&lt;/span&gt;:dhcpd.conf(&lt;span&gt;5&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;果然启动失败了，配置文件一定有哪里出现错误。&lt;/p&gt;
&lt;p&gt;我们执行journal -xe命令查看一下&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
[root@localhost ~]# journalctl -&lt;span&gt;xe
&lt;/span&gt;-- 
-- The start-up result is &lt;span&gt;done&lt;/span&gt;&lt;span&gt;.
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;&lt;span&gt;]: Internet Systems Consortium 
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;]: Copyright &lt;span&gt;2004&lt;/span&gt;-&lt;span&gt;2013&lt;/span&gt;&lt;span&gt; Internet
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;&lt;span&gt;]: All rights reserved.
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;]: For &lt;span&gt;info&lt;/span&gt;&lt;span&gt;, please visit https
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;&lt;span&gt;]: Not searching LDAP since lda
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;]: Wrote &lt;span&gt;0&lt;/span&gt;&lt;span&gt; leases to leases fil
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;]: Mar &lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt;&lt;span&gt; localhost.lo
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;]: &lt;span&gt;**&lt;/span&gt;&lt;span&gt;&lt;span&gt; Ignoring requests on eno1&lt;/span&gt;
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;]: &lt;span&gt;you want, please write&lt;/span&gt;&lt;span&gt;&lt;span&gt; a sub&lt;/span&gt;
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;]: &lt;span&gt;in your dhcpd.conf file for&lt;/span&gt;&lt;span&gt; 
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;]: to &lt;span&gt;which&lt;/span&gt;&lt;span&gt; interface eno167777
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;]: Mar &lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt;&lt;span&gt; localhost.lo
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;]: Mar &lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt;&lt;span&gt; localhost.lo
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;]: &lt;span&gt;on ftp&lt;/span&gt;&lt;span&gt;&lt;span&gt;.isc.org.  Features ha&lt;/span&gt;
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;&lt;span&gt;]: &lt;span&gt;have been made to the base s&lt;/span&gt;
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;&lt;span&gt;]: &lt;span&gt;it work better with this dis&lt;/span&gt;
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;]: Mar &lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt;&lt;span&gt; localhost.lo
Mar &lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;16&lt;/span&gt;:&lt;span&gt;36&lt;/span&gt; localhost.localdomain dhcpd[&lt;span&gt;42926&lt;/span&gt;]: http:&lt;span&gt;//&lt;/span&gt;&lt;span&gt;bugzilla.redhat.com&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;似乎是eno167777网卡问题，原来我们还原虚拟机后没有将IP修改为DHCP配置文件中对应的192.168.10.10。修改一下。&lt;/p&gt;
&lt;p&gt;修改完成后，再次重启DHCPD服务&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
[root@localhost ~&lt;span&gt;]# systemctl restart dhcpd
[root@localhost &lt;/span&gt;~&lt;span&gt;]# systemctl status dhcpd
dhcpd.service &lt;/span&gt;-&lt;span&gt; DHCPv4 Server Daemon
   Loaded: loaded (&lt;/span&gt;/usr/lib/systemd/system/&lt;span&gt;dhcpd.service; disabled)
   Active: active (&lt;span&gt;running&lt;/span&gt;) since Tue &lt;/span&gt;&lt;span&gt;2019&lt;/span&gt;-&lt;span&gt;03&lt;/span&gt;-&lt;span&gt;19&lt;/span&gt; &lt;span&gt;10&lt;/span&gt;:&lt;span&gt;23&lt;/span&gt;:&lt;span&gt;13&lt;/span&gt;&lt;span&gt; EDT; 6s ago
     Docs: &lt;/span&gt;&lt;span&gt;man&lt;/span&gt;:dhcpd(&lt;span&gt;8&lt;/span&gt;&lt;span&gt;)
           &lt;/span&gt;&lt;span&gt;man&lt;/span&gt;:dhcpd.conf(&lt;span&gt;5&lt;/span&gt;&lt;span&gt;)
 Main PID: &lt;/span&gt;&lt;span&gt;43382&lt;/span&gt; (dhcpd)
&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;第二步TFTP服务&lt;/h4&gt;
&lt;h5&gt;Trivial File Transfer Protocol 简单文本传输协议。该轻量级的服务由xinetd网络守护进程管理，开启TFTP服务时只需在xinetd服务主配置文件中/etc/xinetd.d/tftp文件中将disable修改为no 即可。&lt;/h5&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
[root@localhost ~]# &lt;span&gt;yum&lt;/span&gt; &lt;span&gt;install&lt;/span&gt; -y tftp-&lt;span&gt;server
[root@localhost &lt;/span&gt;~]# vim /etc/xinetd.d/tftp 
&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;service tftp
{
        socket_type             &lt;/span&gt;=&lt;span&gt; dgram
        protocol                &lt;/span&gt;=&lt;span&gt; udp
        &lt;/span&gt;&lt;span&gt;wait&lt;/span&gt;                    =&lt;span&gt; yes
        user                    &lt;/span&gt;=&lt;span&gt; root
        server                  &lt;/span&gt;= /usr/sbin/&lt;span&gt;in&lt;/span&gt;&lt;span&gt;.tftpd
        server_args             &lt;/span&gt;= -s /var/lib/&lt;span&gt;tftpboot
        &lt;span&gt;disable                 &lt;/span&gt;&lt;/span&gt;&lt;span&gt;=&lt;/span&gt;&lt;span&gt;&lt;span&gt; no&lt;/span&gt;
        per_source              &lt;/span&gt;= &lt;span&gt;11&lt;/span&gt;&lt;span&gt;
        cps                     &lt;/span&gt;= &lt;span&gt;100&lt;/span&gt; &lt;span&gt;2&lt;/span&gt;&lt;span&gt;
        flags                   &lt;/span&gt;=&lt;span&gt; IPv4
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;TFTP默认占用69/udp端口，在生产环境中，需要在firewalld防火墙管理工具中永久放行69/udp端口。&lt;/h5&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
[root@localhost ~]# firewall-cmd --permanent --add-port=&lt;span&gt;69&lt;/span&gt;/&lt;span&gt;udp
success
[root@localhost &lt;/span&gt;~]# firewall-cmd --&lt;span&gt;reload 
success&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;第三部：SYSlinux服务是一个提供引导加载的服务程序&lt;/h4&gt;
&lt;h5&gt;安装syslinux&lt;/h5&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
[root@localhost ~]# &lt;span&gt;yum&lt;/span&gt; &lt;span&gt;install&lt;/span&gt; -y syslinux
&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;我们需要将syslinux服务提供的引导文件（即上面提到的pxelinu.0）复制到TFTP服务默认目录中，另外ISO镜像里也有一些引导文件需要复制到TFTP默认目录中。&lt;/h5&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
[root@localhost ~]# cd /var/lib/tftpboot/&lt;span&gt;
[root@localhost tftpboot]# &lt;/span&gt;&lt;span&gt;cp&lt;/span&gt; /usr/share/syslinux/pxelinux.&lt;span&gt;0&lt;/span&gt;&lt;span&gt;  .
[root@localhost tftpboot]# &lt;/span&gt;&lt;span&gt;cp&lt;/span&gt; /mnt/images/pxeboot/&lt;span&gt;{vmlinuz,initrd.img} .
[root@localhost tftpboot]# &lt;/span&gt;&lt;span&gt;cp&lt;/span&gt; /mnt/isolinux/{vesamenu.c32,boot.msg} .
&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;另外我们还要在TFTP默认目录中，创建一个名为pxelinux.cfg的文件夹，将镜像文件里的开机选项菜单复制到里面并重命名为default。&lt;/h5&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
[root@localhost tftpboot]# &lt;span&gt;mkdir&lt;/span&gt;&lt;span&gt; pxelinux.cfg
[root@localhost tftpboot]# &lt;/span&gt;&lt;span&gt;cp&lt;/span&gt; /mnt/isolinux/isolinux.cfg pxelinux.cfg/default
&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;由于默认的开机菜单中有两个选项，要么是安装系统，要么是对安装介质进行检验。既然我们已经确定采用无人值守的方式安装系统，还需要为每台主机手动选择相应的选项，未免与我们的主旨（无人值守安装）相悖。现在我们编辑这个default文件，把第1行的default参数修改为linux，这样系统在开机时就会默认执行那个名称为linux的选项了。对应的linux选项大约在64行，我们将默认的光盘镜像安装方式修改成FTP文件传输方式，并指定好光盘镜像的获取网址以及Kickstart应答文件的获取路径。&lt;/h5&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
[root@localhost tftpboot]# vim !&lt;span&gt;$
  &lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt; default linux
  ..
  &lt;/span&gt;&lt;span&gt;64&lt;/span&gt;   append initrd=initrd.img inst.stage2=&lt;span&gt;ftp&lt;/span&gt;:&lt;span&gt;//&lt;/span&gt;&lt;span&gt;192.168.10.10 ks=ftp:&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;192.168.10.10/pub/ks.cfg quiet&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;第四步：配置vsftpd服务程序&lt;/h4&gt;
&lt;h5&gt;当前pxe服务是通过镜像文件安装的，是必要的用到FTP文件传输服务。也可以使用HTTP的web网站访问的方式，只要能确保，光盘中的镜像能顺利地传输给客户端主机即可。&lt;/h5&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
[root@localhost tftpboot]# &lt;span&gt;yum&lt;/span&gt; &lt;span&gt;install&lt;/span&gt; -&lt;span&gt;y vsftpd
[root@localhost tftpboot]# systemctl start vsftpd
[root@localhost tftpboot]# systemctl enable vsftpd
&lt;/span&gt;&lt;span&gt;ln&lt;/span&gt; -s &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/usr/lib/systemd/system/vsftpd.service&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;&lt;span&gt;/etc/systemd/system/multi-user.target.wants/vsftpd.service&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;接下来将镜像中的所有文件复制到vsftpd服务的的工作目录中（过程大概几分钟），同时在firewalld防火墙管理工具中放行ftp服务。在selinux域策略中放行FTP传输。&lt;/h5&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
[root@localhost linuxprobe]# firewall-cmd --permanent --add-service=&lt;span&gt;ftp&lt;/span&gt;&lt;span&gt;
success
[root@localhost linuxprobe]# firewall&lt;/span&gt;-cmd --&lt;span&gt;reload
success
[root@localhost linuxprobe]# getsebool &lt;/span&gt;-a | &lt;span&gt;grep&lt;/span&gt;&lt;span&gt; ftpd
ftpd_anon_write &lt;/span&gt;--&amp;gt;&lt;span&gt; off
&lt;span&gt;ftpd_connect_all_unreserved &lt;/span&gt;&lt;/span&gt;&lt;span&gt;--&amp;gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt; off&lt;/span&gt;
ftpd_connect_db &lt;/span&gt;--&amp;gt;&lt;span&gt; off
ftpd_full_access &lt;/span&gt;--&amp;gt;&lt;span&gt; off
ftpd_use_cifs &lt;/span&gt;--&amp;gt;&lt;span&gt; off
ftpd_use_fusefs &lt;/span&gt;--&amp;gt;&lt;span&gt; off
ftpd_use_nfs &lt;/span&gt;--&amp;gt;&lt;span&gt; off
ftpd_use_passive_mode &lt;/span&gt;--&amp;gt;&lt;span&gt; off
sftpd_anon_write &lt;/span&gt;--&amp;gt;&lt;span&gt; off
sftpd_enable_homedirs &lt;/span&gt;--&amp;gt;&lt;span&gt; off
sftpd_full_access &lt;/span&gt;--&amp;gt;&lt;span&gt; off
sftpd_write_ssh_home &lt;/span&gt;--&amp;gt;&lt;span&gt; off
[root@localhost linuxprobe]# setsebool &lt;/span&gt;-P ftpd_connect_all_unreserved=on
&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;&lt;strong&gt;创建KickStart应答文件&lt;/strong&gt;&lt;/h4&gt;
&lt;h5&gt;&lt;strong&gt;在rhel7系统中root用户家目录有个&lt;/strong&gt;anaconda-ks.cfg文件，是为当前系统的ks应答文件。ks文件具体参数在上次实验中有详细的讲解。这里只改三个地方测试效果即可：首先把第6行的光盘镜像安装方式修改成FTP协议，仔细填写好FTP服务器的IP地址，并用本地浏览器尝试打开下检查有没有报错。然后把第21行的时区修改成上海(Asia/Shanghai)，最后再把29行的磁盘选项设置为清空所有磁盘内容并初始化磁盘。&lt;/h5&gt;
&lt;h5&gt;首先将该文件复制到ftp家目录中。chmod +r 命令让所有人都可对其读取。&lt;/h5&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
t@localhost ~]# &lt;span&gt;cp&lt;/span&gt;  /root/anaconda-ks.cfg /var/&lt;span&gt;ftp&lt;/span&gt;/pub/&lt;span&gt;ks.cfg
[root@localhost &lt;/span&gt;~]# &lt;span&gt;chmod&lt;/span&gt; -r !&lt;span&gt;$
&lt;/span&gt;&lt;span&gt;chmod&lt;/span&gt; -r /var/&lt;span&gt;ftp&lt;/span&gt;/pub/ks.cfg
&lt;/pre&gt;&lt;/div&gt;
&lt;h5&gt;修改参数&lt;/h5&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
#version=&lt;span&gt;RHEL7
# System authorization information
auth &lt;/span&gt;--enableshadow --passalgo=&lt;span&gt;sha512

# Use CDROM installation media
&lt;span&gt;url &lt;/span&gt;&lt;/span&gt;&lt;span&gt;--url=ftp://192.168.10.10　　　　　　　　　　　　　　　　　　　　设置FTP安装模式&lt;/span&gt;
&lt;span&gt;# Run the Setup Agent on first boot
firstboot &lt;/span&gt;--&lt;span&gt;enable
ignoredisk &lt;/span&gt;--only-use=&lt;span&gt;sda
# Keyboard layouts
keyboard &lt;/span&gt;--vckeymap=us --xlayouts=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;us&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;
# System language
lang en_US.UTF&lt;/span&gt;-&lt;span&gt;8&lt;/span&gt;&lt;span&gt;

# Network information
network  &lt;/span&gt;--bootproto=dhcp --device=eno16777736 --onboot=off --ipv6=&lt;span&gt;auto
network  &lt;/span&gt;--&lt;span&gt;hostname&lt;/span&gt;=&lt;span&gt;localhost.localdomain
# Root password
rootpw &lt;/span&gt;--iscrypted $&lt;span&gt;6&lt;/span&gt;$0XQWDt7L9e0SdNCH$LyxVJ8ZoncLu2tTPn/4nUjOT.DFmLgejZOWWg/U9aF7qPJGnLs6JuDZ1/&lt;span&gt;RHrr17HKs1zA10ifsUk.axakInCG.
# System timezone
&lt;span&gt;timezone Asia&lt;/span&gt;&lt;/span&gt;&lt;span&gt;/Shanghai --&lt;/span&gt;&lt;span&gt;&lt;span&gt;isUtc　　　　　　　　　　　　　　　　　　设置时区为上海&lt;/span&gt;
# X Window System configuration information
xconfig  &lt;/span&gt;--&lt;span&gt;startxonboot
# System bootloader configuration
bootloader &lt;/span&gt;--location=mbr --boot-drive=&lt;span&gt;sda
autopart &lt;/span&gt;--type=&lt;span&gt;lvm
# Partition clearing information
&lt;span&gt;clearpart &lt;/span&gt;&lt;/span&gt;&lt;span&gt;--all --initlabel　　　　　　　　　　　　　　　　　　　　清空并初始化磁盘

&lt;/span&gt;%&lt;span&gt;packages
@base
@core
@desktop&lt;/span&gt;-&lt;span&gt;debugging
@dial&lt;/span&gt;-up
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;自动部署客户端&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1491231/201903/1491231-20190319231045857-1059714533.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1491231/201903/1491231-20190319231059557-1698518293.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1491231/201903/1491231-20190319231124416-1334296632.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt; &lt;img src=&quot;https://img2018.cnblogs.com/blog/1491231/201903/1491231-20190319231154871-287401423.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt; &lt;img src=&quot;https://img2018.cnblogs.com/blog/1491231/201903/1491231-20190319231553320-513606497.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1491231/201903/1491231-20190319232502227-880195795.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

</description>
<pubDate>Tue, 19 Mar 2019 15:25:00 +0000</pubDate>
<dc:creator>f1烈日灼心</dc:creator>
<og:description>PXE（Preboot Excute Environment）预启动执行环境，可以让计算机通过网络启动系统，主要用于无人值守安装系统中引导客户端主机安装Linux操作系统。 由于之前有过使用cobbl</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/volac/p/10562245.html</dc:identifier>
</item>
<item>
<title>从零开始学习Java多线程(二) - 不忘长安</title>
<link>http://www.cnblogs.com/supiaol/p/10531156.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/supiaol/p/10531156.html</guid>
<description>&lt;p&gt;前面已经简单介绍进程和线程，为后续学习做铺垫。本文讨论多线程传参，Java多线程异常处理机制。&lt;/p&gt;
&lt;h3&gt;1. 多线程的参数传递&lt;/h3&gt;
&lt;p&gt;     在传统开发过程中，我们习惯在调用函数时，将所需的参数传入其中，通过函数内部逻辑处理返回结果，大多情况下，整个过程均是由一条线程执行，排除运行不必要的的偶发性，似乎并不会出现意料之外的结果。而在多线程环境下，在使用线程时需要对线程进行一些必要的初始化，线程对这些数据进行处理后返回结果，由于线程的运行和结束并不可控，线程传参变得复杂起来，本文就以上问题介绍三种常用的传递参数方式。&lt;/p&gt;
&lt;p&gt; （&lt;strong&gt;一）构造方法传参&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;      在创建线程时，需要创建一个Thread类的或者其子类的实例，通过调用其start()方法执行run()方法中的代码块，在此之前，我们可以通过构造函数传递线程运行所需要的数据，并使用变量保存起来。代码如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; MyThread &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; Thread {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;定义变量保存参数&lt;/span&gt;
&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt;&lt;span&gt; String msg;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; 
&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; MyThread() {
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; 
&lt;span&gt; 9&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; MyThread(String msg) {
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.msg =&lt;span&gt; msg;
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; 
&lt;span&gt;13&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;多线程的入口&lt;/span&gt;
&lt;span&gt;14&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; run() {
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;         System.out.println(&quot;MyThread &quot; +&lt;span&gt; msg);
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; 
&lt;span&gt;18&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; main(String[] args) {
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;         MyThread myThread = &lt;span&gt;new&lt;/span&gt; MyThread(&quot;is running&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;        myThread.start();
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;运行结果：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt;MyThread is running

Process finished with exit code &lt;/span&gt;0
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;     这种方式的优点很明显：简单、安全。在线程运行之前数据已经准备完成，避免线程丢失数据，如果传递更复杂数据，可以定义集合或者类等数据结构。缺点就是传递比较多的参数时，这种方式会使构造方法过于复杂，为了避免这种情况可以通过类方法和变量传递参数&lt;/p&gt;
&lt;h4&gt;(二)变量和类方法传递参数&lt;/h4&gt;
&lt;p&gt;     在Thread实例类中定义需要传递的参数变量，并且定义一系列public的方法(或变量)，在创建完Tread实例后通过调用方法给参数逐个赋值。上面的代码也可以通过定义setMsg()方法传递参数，代码如下：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; MyThread &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; Thread {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;定义变量保存参数&lt;/span&gt;
&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt;&lt;span&gt; String msg;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; 
&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; setMsg(String msg) {
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.msg =&lt;span&gt; msg;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; 
&lt;span&gt;10&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; MyThread() {
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; 
&lt;span&gt;13&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; MyThread(String msg) {
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.msg =&lt;span&gt; msg;
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; 
&lt;span&gt;17&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;多线程的入口&lt;/span&gt;
&lt;span&gt;18&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; run() {
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;         System.out.println(&quot;MyThread &quot; +&lt;span&gt; msg);
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;        System.out.println(Thread.currentThread().getThreadGroup());
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; 
&lt;span&gt;23&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; main(String[] args) {
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt;         MyThread myThread = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; MyThread();
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;         myThread.setMsg(&quot;is running&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt; &lt;span&gt;        myThread.start();
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;(三)通过回调函数传递数据&lt;/h4&gt;
&lt;p&gt;     以上线程传递参数最常用的两种方式，但是可以发现参数都在main方法中设置，然后Thread实例被动的接受参数，假如在线程运行中动态的获取参数，如在run()方法先获取三个随机数，通过Work类的process方法对这随机数求和，最后通过Data类的value值返回结果。此例看出在返回value之前，因为随机数的不确定性，我们并不能事先传递的值value。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34.5&quot;&gt;&lt;img id=&quot;code_img_closed_7b684f81-7cbf-429f-b593-3479369225a8&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_7b684f81-7cbf-429f-b593-3479369225a8&quot; class=&quot;code_img_opened&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_7b684f81-7cbf-429f-b593-3479369225a8&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;64&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; Data {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; value = 0&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; 
&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; Work {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;回调函数&lt;/span&gt;
&lt;span&gt; 7&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; process(Data data, Integer[] numbers) {
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt;&lt;span&gt; n : numbers) {
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;             data.value +=&lt;span&gt; n;
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; 
&lt;span&gt;14&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; MyThread &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; Thread {
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;回调函数的对象&lt;/span&gt;
&lt;span&gt;16&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt;&lt;span&gt; Work work;
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; 
&lt;span&gt;18&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; MyThread(Work work) {
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.work =&lt;span&gt; work;
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; 
&lt;span&gt;22&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; run() {
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;         java.util.Random random = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; java.util.Random();
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt;         Data data = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Data();
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; n1 = random.nextInt(1000&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; n2 = random.nextInt(2000&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; n3 = random.nextInt(3000&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;         work.process(data, &lt;span&gt;new&lt;/span&gt; Integer[]{n1, n2, n3}); &lt;span&gt;//&lt;/span&gt;&lt;span&gt; 使用回调函数&lt;/span&gt;
&lt;span&gt;29&lt;/span&gt;         System.out.println(String.valueOf(n1) + &quot;+&quot; + String.valueOf(n2) + &quot;+&quot;
&lt;span&gt;30&lt;/span&gt;                 + String.valueOf(n3) + &quot;=&quot; +&lt;span&gt; data.value);
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; 
&lt;span&gt;33&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; main(String[] args) {
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt;         Thread thread = &lt;span&gt;new&lt;/span&gt; MyThread(&lt;span&gt;new&lt;/span&gt;&lt;span&gt; Work());
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt; &lt;span&gt;        thread.start();
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt; 
&lt;span&gt;38&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;    上面代码中process()方法即是回调函数，实质上是一个事件函数。整个事件流程为：将求和对象work传入线程，线程执行过程中三个随机数的产生触发了求和事件，通过传递进来的work对象调用process()方法，最后将结果返回线程并在控制台输出。这种传递数据的方式是在上面两种传参的基础上进行了薄层封装，并没有直接将参数传递给线程，而是通过传递的对象进行逻辑处理之后将结果返回。&lt;/p&gt;
&lt;h3&gt;2. Java多线程异常处理机制&lt;/h3&gt;
&lt;p&gt;     先来看对于未检查异常在run()方法中是如何处理的。&lt;/p&gt;
&lt;p&gt;     &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319212932813-958689532.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;    运行结果：&lt;/p&gt;
&lt;p&gt;     &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319212751923-2011488537.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;     由上可以看出对于未检查异常，从线程将会直接宕掉，主线程继续运行。那么在主线程中能不能捕获到异常呢？我们直接将全部代码块try catch起来&lt;/p&gt;
&lt;p&gt;     &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319213522914-1067605570.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;     然后你会发现并没有什么卵用，主线程没有捕获到任何异常信息，和未检出异常如出一辙，从线程直接宕掉，主线程继续运行&lt;/p&gt;
&lt;p&gt;     如果先检查异常呢？&lt;/p&gt;
&lt;p&gt;      &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319213912152-140481578.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;     IDEA提示：&lt;/p&gt;
&lt;p&gt;     &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319214014563-625923868.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;     结果还是让人失望，程序还没运行，IDEA已经提示报错，原来run()方法本身不支持抛出异常的，方法重写更不允许throws,所以run()方法不支持往外抛出异常。&lt;/p&gt;
&lt;p&gt;     最后再试下能不能在run()方法中try catch捕获异常，&lt;/p&gt;
&lt;p&gt;      &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319214305949-244725635.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;      运行结果：&lt;/p&gt;
&lt;p&gt;     &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319214439881-1618595757.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;      原来在run()方法中try catch是能捕捉到异常的。所以对于多线程已检查的异常我们可以通过try catch进行处理，而对于未检查的异常，如果没有处理，一旦抛出该线程立马宕掉，主线程则继续运行，那么未检查的异常也全部需要try catch吗？当然这也是一种方式。除此之外，Java还提供了异常处理器。&lt;/p&gt;
&lt;h3&gt;  (一)Java异常处理器&lt;/h3&gt;
&lt;p&gt;    在Java线程run()方法中，对于未检查异常，借助于异常处理器进行处理。异常处理器可以直接理解为异常处理的方法，下面为具体如何使用。&lt;/p&gt;
&lt;p&gt;    UncaughtExceptionHandler，是Thread的内部接口。&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319215643827-1333102957.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;  Thread内部有两个变量，用来记录异常处理器。&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319215748194-640639098.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;   Thread内部也分别提供了它们的get/set方法，set()方法其实没什么特别，主要是用来设置这两个内部变量，重点在于它们的get()方法。&lt;/p&gt;
&lt;p&gt;   对于getUncaughtExceptionHandler方法，如果当前UncaughtExceptionHandler对象不为空，那么直接返回该对象，如果为空，返回该线程所属的线程组，由此得知，ThreadGroup实现了UncaughtExceptionHandler接口。&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319220447959-759611164.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319220554307-1729548346.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319220515600-696304092.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;   与此同时，内部实现了uncaughtException方法，&lt;/p&gt;
&lt;p&gt;  &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319221649053-632184241.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;   而对于getDefaultUncaughtExceptionHandler()方法，只是简单的返回内部对象。&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319221027050-211255512.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;    至此，我们可以了解到Thread内部有两个异常处理器，分别提供了get/set方法，对于set方法只是单纯的设置异常处理器，对于get方法，getDefaultUncaughtExceptionHandler()方法直接获取处理器；getUncaughtExceptionHandler()方法，进行判空，如果非空直接返回，如果为空返回该线程所属的线程组，并且当前线程组是实现了Thread.UncaughtExceptionHandler接口，内部实现了public void uncaughtException(Thread t, Throwable e),其本质上它才是线程处理器。&lt;/p&gt;
&lt;p&gt;    对于defaultUncaughtExceptionHandler,表示应该程序默认的，整个程序可以使用的，它的get/set方法均为static修饰；对于uncaughtExceptionHandler，属于实例方法，也就是说每个线程可以拥有一个，简言之：每个线程都可以有一个uncaughtExceptionHandler，整个应用可以有一个defaultUncaughtExceptionHandler。它们之间是个体与全局的关系，如果个体拥有那么就不再使用全局的；否则，走全局。这样做的好处是非常灵活，既可以保证单个线程特别处理，又可以保障整个程序做到统一处理，在诸多场景发挥多种用处。&lt;/p&gt;
&lt;h3&gt;  （二）异常处理逻辑&lt;/h3&gt;
&lt;p&gt;      当run()方法中发生异常，JVM调用异常分发器，也就是借助getUncaughtExceptionHandler方法获取异常处理器，然后执行它的uncaughtException方法。&lt;/p&gt;
&lt;p&gt;     &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319223153453-695337580.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;     所以关键之处在于uncaughtException()方法，再来看它的源码：&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34.5&quot;&gt;&lt;img id=&quot;code_img_closed_cbed7f71-01a6-4277-a8ac-2b3b81331b28&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_cbed7f71-01a6-4277-a8ac-2b3b81331b28&quot; class=&quot;code_img_opened&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_cbed7f71-01a6-4277-a8ac-2b3b81331b28&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;64&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; uncaughtException(Thread t, Throwable e) {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;是否存在父线程组&lt;/span&gt;
&lt;span&gt; 3&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (parent != &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;            parent.uncaughtException(t, e);
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;         } &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;获取默认异常处理器&lt;/span&gt;
&lt;span&gt; 7&lt;/span&gt;             Thread.UncaughtExceptionHandler ueh =
&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;                    Thread.getDefaultUncaughtExceptionHandler();
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;如果非空,调用其uncaughtException方法&lt;/span&gt;
&lt;span&gt;10&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (ueh != &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;                ueh.uncaughtException(t, e);
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;                 &lt;span&gt;//&lt;/span&gt;&lt;span&gt;否则打出标准错误信息&lt;/span&gt;
&lt;span&gt;13&lt;/span&gt;             } &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (!(e &lt;span&gt;instanceof&lt;/span&gt;&lt;span&gt; ThreadDeath)) {
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;                 System.err.print(&quot;Exception in thread \&quot;&quot;
&lt;span&gt;15&lt;/span&gt;                         + t.getName() + &quot;\&quot; &quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;                e.printStackTrace(System.err);
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;     }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;    如果已经设置异常处理器，那么直接返回，如果没有设置，返回当前线程组，并且调用线程组的uncaughtException方法时(如上图)，如果该线程组重写了uncaughtException方法，直接调用；如果没有，调用该线程组的父线程组；如果父线程组仍然没有重写，调用爷爷线程组，以此类推。但是如果所有的线程组都没有重写，进入else里面，在else中获取默认处理器，如果默认有，执行uncaughtException方法，如果没有直接system.err。&lt;/p&gt;
&lt;p&gt;   以上就是异常处理器的处理逻辑，可以看出uncaughtExceptionHandler处理器优先级要高于defaultUncaughtException,这也符合就近原则，如果自身拥有了，又何必调用全局拥有的呢！&lt;/p&gt;
&lt;h3&gt;  （三）异常处理器代码演示&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;&lt;img id=&quot;code_img_closed_a13dbe2e-071c-4954-b463-7295137c1495&quot; class=&quot;code_img_closed&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_a13dbe2e-071c-4954-b463-7295137c1495&quot; class=&quot;code_img_opened&quot; src=&quot;http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_a13dbe2e-071c-4954-b463-7295137c1495&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;61&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; TestThread {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; main(String[] args) {
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;             MyThread myThread = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; MyThread();
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;             myThread.setUncaughtExceptionHandler((Thread t,Throwable e)-&amp;gt;&lt;span&gt;{
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;                 System.out.println(&quot;出现异常...&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;                 System.out.println(&quot;线程名称： &quot;+&lt;span&gt;myThread.getName());
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;                 System.out.println(&quot;异常信息： &quot;+&lt;span&gt;e.getMessage());
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;            });
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;            myThread.start();
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;             System.out.println(&quot;main runing....&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;             System.out.println(&quot;main runing....&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;             System.out.println(&quot;main runing....&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;             System.out.println(&quot;main runing....&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; MyThread &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; Thread {
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; run() {
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;抛出异常&lt;/span&gt;
&lt;span&gt;20&lt;/span&gt;             &lt;span&gt;int&lt;/span&gt; i = 13 / 0&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;  运行结果：&lt;/p&gt;
&lt;p&gt;   &lt;img src=&quot;https://img2018.cnblogs.com/blog/1616831/201903/1616831-20190319230131635-1234709723.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;  以上示例可以看出，尽管为检查异常，通过异常处理器依然能够感知异常和信息获取，不会直接宕掉了。主要注意的是，必须在调用start()方法之前设置异常处理器，否则线程依旧直接宕掉。&lt;/p&gt;
&lt;h3&gt; （四）总结&lt;/h3&gt;
&lt;p&gt;      Java多线程异常处理机制依赖于Thread内部两个异常处理器，uncaughtExceptionHandler和defaultUncaughtExceptionHandler。两者之间为个体和全局之间的关系，如果前者已经设置，那么直接使用，否则使用后者。大致步骤为：&lt;/p&gt;
&lt;p&gt;      a. 如果设置了异常处理器uncaughtExceptionHandler直接使用。&lt;/p&gt;
&lt;p&gt;      b. 如果没设置，将会在祖先线程组中查找第一个重写了uncaughtException的线程组，然后调用他的uncaughtException方法&lt;/p&gt;
&lt;p&gt;      c. 如果都没有重写，那么使用应用默认的全局异常处理器defaultUncaughtExceptionHandler&lt;/p&gt;
&lt;p&gt;      d. 如果还是没有设置，直接标准错误打印信息&lt;/p&gt;
&lt;p&gt;       如果想要设置线程特有的异常处理器，可以调用set方法进行设置；如果想要对全局进行设置，可以调用静态方法进行设置，需要注意的是必须要在调用start()方法之前设置。&lt;/p&gt;

</description>
<pubDate>Tue, 19 Mar 2019 15:22:00 +0000</pubDate>
<dc:creator>不忘长安</dc:creator>
<og:description>前面已经简单介绍进程和线程，为后续学习做铺垫。本文讨论多线程传参，Java多线程异常处理机制。 1. 多线程的参数传递 在传统开发过程中，我们习惯在调用函数时，将所需的参数传入其中，通过函数内部逻辑处</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/supiaol/p/10531156.html</dc:identifier>
</item>
<item>
<title>深入Go的底层，带你走近一群有追求的人 - Stefno</title>
<link>http://www.cnblogs.com/qcrao-2018/p/10562216.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/qcrao-2018/p/10562216.html</guid>
<description>&lt;p&gt;上周六晚上，我参加了“Go夜读”活动，这期主要讲Go汇编语言，由滴滴大佬曹春晖大神主讲。活动结束后，我感觉打通了任督二脉。活动从晚上9点到深夜11点多，全程深度参与，大呼过瘾，以至于活动结束之后，久久不能平静。&lt;/p&gt;
&lt;p&gt;可以说理解了Go汇编语言，就可以让我们对Go的理解上一个台阶，很多以前模棱的东西，在汇编语言面前都无所遁形了。我在活动上收获了很多，今天我来作一个总结，希望给大家带来启发！&lt;/p&gt;
&lt;p&gt;[toc]&lt;/p&gt;

&lt;p&gt;几周前我写了一篇关于&lt;code&gt;defer&lt;/code&gt;的文章：&lt;a href=&quot;https://www.cnblogs.com/qcrao-2018/p/10367346.html&quot;&gt;《Golang之如何轻松化解defer的温柔陷阱》&lt;/a&gt;。这篇文章发出后不久就被&lt;code&gt;GoCN&lt;/code&gt;的每日新闻收录了，然后就被Go夜读群的大佬杨文看到了，之后被邀请去夜读活动分享。&lt;/p&gt;
&lt;p&gt;正式分享前，我又主题阅读了很多文章，以求把defer讲清楚。阅读过程中，我发现但凡深入一点的文章，都会抛出Go汇编语言。于是就去搜索资料，无奈相关的资料太少，看得云里雾里，最后到了真正要分享的时候也没有完全弄清楚。&lt;/p&gt;
&lt;p&gt;夜读活动结束之后，杨大发布了由春晖大神带来的夜读分享预告：&lt;code&gt;《plan9 汇编入门，带你打通应用和底层》&lt;/code&gt;。我得知这个消息后，非常激动！终于有牛人可以讲讲Go汇编语言了，听完之后估计会有很大提升，也能搞懂defer的底层原理了！&lt;/p&gt;
&lt;p&gt;接着，我发现，春晖大神竟然和我在同一个公司！我在公司内网上搜到了他写的plan9汇编相关文章，发布到Go夜读的github上。我提前花时间预习完了文章，整理出了遇到的问题。&lt;/p&gt;
&lt;p&gt;周六晚上9点准时开讲，曹大的准备很充分！原来1个小时的时间被拉长到了2个多小时，而曹大精力和反应一直很迅速，问的问题很快就能得到回答。我全程和曹大直接对话，感觉简直不要太爽！&lt;/p&gt;
&lt;p&gt;这篇文章既是对这次夜读的总结，也是为了宣传一下Go夜读活动。那里是一群有追求的人，他们每周都会聚在一起，通过网络，探讨Go语言的方方面面。我相信，参与的人都会有很多不同的收获。&lt;/p&gt;
&lt;p&gt;我直接参与的Go夜读活动有三期，一期分享，两期听讲，每次都有很多的收获。&lt;/p&gt;

&lt;p&gt;很多人都不知道怎么做好一个自我介绍，要么含糊其辞，介绍完大家都不知道你讲了什么；要么说了半天无效的信息，大家并不关心的事情，搞得很尴尬。 其实自我介绍没那么难，掌握套路后，是可以做得很好的！&lt;/p&gt;
&lt;p&gt;我在上上期Go夜读分享的时候，用一张PPT完成了自我介绍。包含了四个方面：&lt;code&gt;个人基本信息&lt;/code&gt;、&lt;code&gt;出现在此时此地的原因&lt;/code&gt;、&lt;code&gt;我能带来的帮助&lt;/code&gt;、&lt;code&gt;我希望得到的帮助&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;个人基本信息&lt;/code&gt;包括你叫什么名字，是哪里人，在什么地方工作，毕业于哪个学校，有什么兴趣爱好……这些基本的属性。这些信息可以让大家快速形成对你的直观认识。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;出现在此时此地的原因&lt;/code&gt;，可以讲解你的故事。你在什么地方通过什么人知道了这个活动，然后因为什么打动你来参加……通过故事可以迅速拉近与现场其他参与者的距离。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;我能带来的帮助&lt;/code&gt;，参加活动的人都是想获取一些东西的：知识、经验、见闻等等。但是，我们不能只索取，不付出。因此，可以讲讲你可以提供的帮助。比如我可以联系场地，我会写宣传文章等等，你可以讲出你独特的价值。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;我希望得到的帮助&lt;/code&gt;。每个参与的人都希望从活动中获得自己想要的东西，正是因为此，这个活动对于参与者才有意义，也才会持续下去的动力。&lt;/p&gt;
&lt;p&gt;这四个方面，可以组成一个非常精彩的自我介绍。它最早是我在听罗胖的《罗辑思维》听到的，我把它写进了我的&lt;code&gt;人生算法&lt;/code&gt;里，今天推荐给大家。希望大家以后在需要自我介绍的场合有话可说，而且能说的精彩。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/7698088/54608061-e3d77000-4a8a-11e9-95a3-7484f94b959b.png&quot; alt=&quot;自我介绍&quot;/&gt;&lt;/p&gt;

&lt;h2 id=&quot;什么是plan9汇编&quot;&gt;什么是plan9汇编&lt;/h2&gt;
&lt;p&gt;我们知道，CPU是只认二进制指令的，也就是一串的0101；人类无法记住这些二进制码，于是发明了汇编语言。汇编语言实际上是二进制指令的文本形式，它与指令可以一一对应。&lt;/p&gt;
&lt;p&gt;每一种CPU指令都是不一样的，因此对应的汇编语言也就不一样。人类写完汇编语言后，把它转换成二进制码，就可以被机器执行了。转换的动作由编译器完成。&lt;/p&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;Go语言的编译器和汇编器都带了一个-S参数，可以查看生成的最终目标代码。通过对比目标代码和原始的Go语言或Go汇编语言代码的差异可以加深对底层实现的理解。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Go汇编语言实际上来源于plan9汇编语言，而plan9汇编语言最初来源于Go语言作者之一的Ken Thompson为plan9系统所写的C语言编译器输出的汇编伪代码。这里强烈推荐一下春晖大神的新书《Go语言高级编程》，即将上市，电子版的点击阅读原文可以看到地址，书中有一整个章节讲Go的汇编语言，非常精彩！&lt;/p&gt;
&lt;p&gt;理解Go的汇编语言，哪怕只是一点点，都能对Go的运行机制有更深入的理解。比如我们以前讲的defer，如果从Go源码编译后的汇编代码来看，就能深刻地掌握它的底层原理。再比如，很多文章都会分析Go的函数参数传递都是值传递，如果把汇编代码秀出来，很容易就能得出结论。&lt;/p&gt;
&lt;h2 id=&quot;汇编角度看函数调用及返回过程&quot;&gt;汇编角度看函数调用及返回过程&lt;/h2&gt;
&lt;p&gt;假设我们有一个这样年幼无知的例子，求两个int的和，Go源码如下：&lt;/p&gt;
&lt;pre class=&quot;golang&quot;&gt;
&lt;code&gt;package main

func main() {
    _ = add(3,5)
}

func add(a, b int) int {
    return a+b
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;使用如下命令得到汇编代码：&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;
&lt;code&gt;go tool compile -S main.go&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;go tool compile&lt;/code&gt;命令用于调用Go语言提供的底层命令工具，其中&lt;code&gt;-S&lt;/code&gt;参数表示输出汇编格式。&lt;/p&gt;
&lt;p&gt;我们现在只关心add函数的汇编代码：&lt;/p&gt;
&lt;pre class=&quot;asm&quot;&gt;
&lt;code&gt;&quot;&quot;.add STEXT nosplit size=19 args=0x18 locals=0x0
        0x0000 00000 (main.go:7)        TEXT    &quot;&quot;.add(SB), NOSPLIT, $0-24
        0x0000 00000 (main.go:7)        FUNCDATA        $0, gclocals·54241e171da8af6ae173d69da0236748(SB)
        0x0000 00000 (main.go:7)        FUNCDATA        $1, gclocals·33cdeccccebe80329f1fdbee7f5874cb(SB)
        0x0000 00000 (main.go:7)        MOVQ    &quot;&quot;.b+16(SP), AX
        0x0005 00005 (main.go:7)        MOVQ    &quot;&quot;.a+8(SP), CX
        0x000a 00010 (main.go:8)        ADDQ    CX, AX
        0x000d 00013 (main.go:8)        MOVQ    AX, &quot;&quot;.~r2+24(SP)
        0x0012 00018 (main.go:8)        RET&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;看不懂没关系，我目前也不是全部都懂，但是对于理解一个函数调用的整体过程而言，足够了。&lt;/p&gt;
&lt;pre class=&quot;asm&quot;&gt;
&lt;code&gt;0x0000 00000 (main.go:7)        TEXT    &quot;&quot;.add(SB), NOSPLIT, $0-24&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;这一行表示定义&lt;code&gt;add&lt;/code&gt;这个函数，最后的数字&lt;code&gt;$0-24&lt;/code&gt;，其中&lt;code&gt;0&lt;/code&gt;表示函数栈帧大小为0；&lt;code&gt;24&lt;/code&gt;表示参数及返回值的大小：参数是2个int型变量，返回值是1个int型变量，共24字节。&lt;/p&gt;
&lt;p&gt;再看中间这四行：&lt;/p&gt;
&lt;pre class=&quot;asm&quot;&gt;
&lt;code&gt;        0x0000 00000 (main.go:7)        MOVQ    &quot;&quot;.b+16(SP), AX
        0x0005 00005 (main.go:7)        MOVQ    &quot;&quot;.a+8(SP), CX
        0x000a 00010 (main.go:8)        ADDQ    CX, AX
        0x000d 00013 (main.go:8)        MOVQ    AX, &quot;&quot;.~r2+24(SP)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;代码片段中的第1行，将第2个参数&lt;code&gt;b&lt;/code&gt;搬到&lt;code&gt;AX&lt;/code&gt;寄存器；第2行将1个参数&lt;code&gt;a&lt;/code&gt;搬到寄存器&lt;code&gt;CX&lt;/code&gt;；第3行将&lt;code&gt;a&lt;/code&gt;和&lt;code&gt;b&lt;/code&gt;相加，相加的结果搬到&lt;code&gt;AX&lt;/code&gt;；最后一行，将结果搬到返回参数的地址，这段汇编代码非常简单，来看一下函数调用者和被调者的栈帧图：&lt;/p&gt;
&lt;p&gt;(SP)指栈顶，b+16(SP)表示裸骑1的位置，从SP往上增加16个字节，注意，前面的b仅表示一个标号；同样，a+8(SP)表示实参0；~r2+24(SP)则表示返回值的位置。&lt;/p&gt;
&lt;p&gt;具体可以看下面的图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/7698088/54614544-8c8bcc80-4a97-11e9-9e68-61be5e6f5085.png&quot; alt=&quot;add函数栈帧&quot;/&gt;&lt;/p&gt;
&lt;p&gt;上面add函数的栈帧大小为0，其实更一般的调用者与被调用者的栈帧示意图如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/7698088/54598545-aca99480-4a73-11e9-8870-99ab8ee9fcb7.png&quot; alt=&quot;栈帧&quot;/&gt;&lt;/p&gt;
&lt;p&gt;最后，执行&lt;code&gt;RET&lt;/code&gt;指令。这一步把被调用函数&lt;code&gt;add&lt;/code&gt;栈帧清零,接着，弹出栈顶的&lt;code&gt;返回地址&lt;/code&gt;，把它赋给指令寄存器&lt;code&gt;rip&lt;/code&gt;，而&lt;code&gt;返回地址&lt;/code&gt;就是&lt;code&gt;main&lt;/code&gt;函数里调用&lt;code&gt;add&lt;/code&gt;函数的下一行。&lt;/p&gt;
&lt;p&gt;于是，又回到了&lt;code&gt;main&lt;/code&gt;函数的执行环境，&lt;code&gt;add&lt;/code&gt;函数的栈帧也被销毁了。但是注意，这块内存是没有被清零的，清零动作是之后再次申请这块内存的时候要做的事。比如，声明了一个int型变量，它的默认值是0，清零的动作是在这里完成的。&lt;/p&gt;
&lt;p&gt;这样，main函数完成了函数调用，也拿到了返回值，完美。&lt;/p&gt;
&lt;h2 id=&quot;汇编角度看slice&quot;&gt;汇编角度看slice&lt;/h2&gt;
&lt;p&gt;再来看一个例子，我们来看看&lt;code&gt;slice&lt;/code&gt;的底层到底是什么。&lt;/p&gt;
&lt;pre class=&quot;golang&quot;&gt;
&lt;code&gt;package main

func main() {
    s := make([]int, 3, 10)
    _ = f(s)
}

func f(s []int) int {
    return s[1]
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;用上面同样的命令得到汇编代码，我们只关注&lt;code&gt;f&lt;/code&gt;函数的汇编代码：&lt;/p&gt;
&lt;pre class=&quot;asm&quot;&gt;
&lt;code&gt;&quot;&quot;.f STEXT nosplit size=53 args=0x20 locals=0x8
        // 栈帧大小为8字节，参数和返回值为32字节
        0x0000 00000 (main.go:8)        TEXT    &quot;&quot;.f(SB), NOSPLIT, $8-32
        // SP栈顶指针下移8字节
        0x0000 00000 (main.go:8)        SUBQ    $8, SP
        // 将BP寄存器的值入栈
        0x0004 00004 (main.go:8)        MOVQ    BP, (SP)
        // 将新的栈顶地址保存到BP寄存器
        0x0008 00008 (main.go:8)        LEAQ    (SP), BP
        0x000c 00012 (main.go:8)        FUNCDATA        $0, gclocals·4032f753396f2012ad1784f398b170f4(SB)
        0x000c 00012 (main.go:8)        FUNCDATA        $1, gclocals·69c1753bd5f81501d95132d08af04464(SB)
        // 取出slice的长度len
        0x000c 00012 (main.go:8)        MOVQ    &quot;&quot;.s+24(SP), AX
        // 比较索引1是否超过len
        0x0011 00017 (main.go:9)        CMPQ    AX, $1
        // 如果超过len，越界了。跳转到46
        0x0015 00021 (main.go:9)        JLS     46
        // 将slice的数据首地址加载到AX寄存器
        0x0017 00023 (main.go:9)        MOVQ    &quot;&quot;.s+16(SP), AX
        // 将第8byte地址的元素保存到AX寄存器，也就是salaries[1]
        0x001c 00028 (main.go:9)        MOVQ    8(AX), AX
        // 将结果拷贝到返回参数的位置（y）
        0x0020 00032 (main.go:9)        MOVQ    AX, &quot;&quot;.~r1+40(SP)
        // 恢复BP的值
        0x0025 00037 (main.go:9)        MOVQ    (SP), BP
        // SP向上移动8个字节
        0x0029 00041 (main.go:9)        ADDQ    $8, SP
        // 返回
        0x002d 00045 (main.go:9)        RET
        0x002e 00046 (main.go:9)        PCDATA  $0, $1
        // 越界，panic
        0x002e 00046 (main.go:9)        CALL    runtime.panicindex(SB)
        0x0033 00051 (main.go:9)        UNDEF
        0x0000 48 83 ec 08 48 89 2c 24 48 8d 2c 24 48 8b 44 24  H...H.,$H.,$H.D$
        0x0010 18 48 83 f8 01 76 17 48 8b 44 24 10 48 8b 40 08  .H...v.H.D$.H.@.
        0x0020 48 89 44 24 28 48 8b 2c 24 48 83 c4 08 c3 e8 00  H.D$(H.,$H......
        0x0030 00 00 00 0f 0b                                   .....
        rel 47+4 t=8 runtime.panicindex+0&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;通过上面的汇编代码，我们画出函数调用的栈帧图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/7698088/54599149-fe065380-4a74-11e9-800b-9a12db0c730c.png&quot; alt=&quot;f函数栈帧&quot;/&gt;&lt;/p&gt;
&lt;p&gt;我们可以清晰地看到，一个slice本质上是用一个数据首地址，一个长度Len，一个容量Cap。所以在参数是slice的函数里，对slice的操作会影响到实参的slice。&lt;/p&gt;

&lt;p&gt;最后再说一下Go夜读活动的方式和目标。引自Go夜读的github说明文件：&lt;/p&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;由一个主讲人带着大家一起去阅读 Go 源代码，一起去啃那些难啃的算法、学习代码里面的奇淫技巧，遇到问题或者有疑惑了，我们可以一起去检索，解答这些问题。我们可以一起学习，共同成长。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;我们希望可以推进大家深入了解 Go ，快速成长为资深的 Gopher 。我们希望每次来了的人和没来的人都能够有收获，成长。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;前面我说Go夜读活动的小伙伴是一群有追求的人，这里我也指出一些问题吧。就我参与的三期来看，虽然zoom接入人数很多，高峰期50+人，但是全过程大家交流比较少，基本上是主讲人一个人在那自嗨。春晖大佬讲的那期，只有我全程提问。感觉像是我们两个人在对话，我的问题弄清楚了，只是不知道其他的参与同学如何？&lt;/p&gt;
&lt;p&gt;我再给分享者和参与者提一些建议吧：&lt;/p&gt;
&lt;p&gt;对于分享者，事先做好充足的准备，可以在文章里列出主要的点，放在github里，参考春晖大佬的plan9汇编讲义；最重要的一点，分享前给大家提供一份预习资料。&lt;/p&gt;
&lt;p&gt;对于参与者，能获得最多收获的方式就是会前预习，会中积极提问，会后复习总结发散。另外，强烈建议参与者会前要准备至少一个问题，有针对性地听，才会有收获。会中也要积极提问，这也是对主讲者的反馈，不至于主讲者觉得只有自己在对着电脑讲。&lt;/p&gt;
&lt;p&gt;最后，欢迎每一个学习Go语言的同学都能来Go夜读看看！点击阅读原文可以看到文章里提到的所有资料，包括上期曹大plan9汇编的视频回放，不容错过！&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/7698088/51420568-305b1800-1bce-11e9-962a-52b12be7eb2e.png&quot; alt=&quot;QR&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/cch123/asmshare/blob/master/layout.md&quot;&gt;《plan9 汇编入门，带你打通应用和底层》讲义&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://www.bilibili.com/video/av46494102&quot;&gt;《plan9 汇编入门，带你打通应用和底层》视频地址&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://chai2010.cn/advanced-go-programming-book/&quot;&gt;曹大的Go高级编程书，纸质书即将出版&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://github.com/cch123/golang-notes&quot;&gt;曹大go源码阅读&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;http://xargin.com/&quot;&gt;曹大博客&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Tue, 19 Mar 2019 15:20:00 +0000</pubDate>
<dc:creator>Stefno</dc:creator>
<og:description>理解了Go汇编语言，可以让我们对Go的理解上一个台阶！</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/qcrao-2018/p/10562216.html</dc:identifier>
</item>
<item>
<title>spring源码 — 五、事务 - lacker</title>
<link>http://www.cnblogs.com/sunshine-2015/p/10562202.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/sunshine-2015/p/10562202.html</guid>
<description>&lt;p&gt;spring提供了可配置、易扩展的事务处理框架，本文主要从一下几个方面说明spring事务的原理&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;基本概念&lt;/li&gt;
&lt;li&gt;事务配置解析&lt;/li&gt;
&lt;li&gt;事务处理过程&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;基本概念&quot;&gt;基本概念&lt;/h2&gt;
&lt;h3 id=&quot;事务隔离级别&quot;&gt;事务隔离级别&lt;/h3&gt;
&lt;p&gt;在同时进行多个事务的时候，可能会出现脏读、不可重复读、幻读四种情况，数据库分别有四种隔离级别处理这些情况。Spring中TransactionDefinition定义了事务的隔离级别和传播属性，隔离级别有&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ISOLATION_DEFAULT：PlatforTransactionManager默认的隔离级别，也就是数据库默认的隔离级别，下面四中分别对应数据库四中隔离级别&lt;/li&gt;
&lt;li&gt;ISOLATION_READ_UNCOMMITED：在另外一个事务未提交的时候可以读取另一个事务中的数据，会出现脏读、不可重复读、幻读，系统开销最小，没有加锁&lt;/li&gt;
&lt;li&gt;ISOLATION_READ_COMMITED：在另外一个事务提交之后才可以读取数据，防止了脏读，会出现不可重复读、幻读&lt;/li&gt;
&lt;li&gt;ISOLATION_REPEATABLE_READ：防止了脏读、不可重复读（在一个事物读取数据之后，第一个事务提交数据，第一个事务再次读取数据，发现前后不一致），会出现幻读，读不加锁，增删改加锁&lt;/li&gt;
&lt;li&gt;ISOLATION_SERIALIZABLE：可以防止脏读、不可重复读、幻读（第一个事务修改涉及到了数据库中全部行，第二个事务向表中插入一行，第一个事务会发现表中还有没有修改的行）&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;spring事务传播属性&quot;&gt;spring事务传播属性&lt;/h3&gt;
&lt;p&gt;传播属性：定义了多层事务时候的行为，spring的TransactionDefinition定义了7种事务传播行为&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;PROPAGETION_REQUIRED：如果已经有事务，则使用当前事务，如果没有则新开一个事务&lt;/li&gt;
&lt;li&gt;PROPAGETION_SUPPORT：如果已经有事务则事务的执行，如果没有则非事务地执行&lt;/li&gt;
&lt;li&gt;PROPAGERION_MANDATORY：如果有事务则支持事务，否则抛出异常&lt;/li&gt;
&lt;li&gt;PROPAGETION_REQUIRES_NEW：总是开启一个新的事务，如果已经有事务，则挂起当前事务&lt;/li&gt;
&lt;li&gt;PROPAGETION_NOT_SUPPORT：总是非事务执行，如果有事务则挂起&lt;/li&gt;
&lt;li&gt;PROPAGETION_NEVER：总是非事务执行，如果有事务则抛出异常&lt;/li&gt;
&lt;li&gt;PEOPAGETION_NESTED：嵌套事务（内层事务不影响外层事务，外层事务失败会回滚内层事务），如果有事务，则嵌套在当前事务中执行，如果没有事务则按照PROPAGETION_REQUIRED的方式运行&lt;/li&gt;
&lt;/ol&gt;&lt;h2 id=&quot;事务配置解析&quot;&gt;事务配置解析&lt;/h2&gt;
&lt;p&gt;spring支持编程式事务，也支持声明式事务，这里以声明式事务的配置为例。&lt;/p&gt;
&lt;p&gt;在配置事务管理器的时候配置为使用cglib生成代理&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot; proxy-target-class=&quot;true&quot; /&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;上面xml配置的作用&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;# tx命名空间的处理类
org.springframework.transaction.config.TxNamespaceHandler
# annotation-driven标签的解析类
org.springframework.transaction.config.AnnotationDrivenBeanDefinitionParser
# 解析标签annotation-driven的方法
org.springframework.transaction.config.AnnotationDrivenBeanDefinitionParser.AopAutoProxyConfigurer#configureAutoProxyCreator&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;解析该标签的时候做了以下的事&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;注册org.springframework.aop.config.AopConfigUtils#AUTO_PROXY_CREATOR_BEAN_NAME，org.springframework.aop.framework.autoproxy.InfrastructureAdvisorAutoProxyCreator&lt;/li&gt;
&lt;li&gt;设置InfrastructureAdvisorAutoProxyCreator这个bean对应的属性，proxyTargetClass，exposeProxy&lt;/li&gt;
&lt;li&gt;注册bean：AnnotationTransactionAttributeSource&lt;/li&gt;
&lt;li&gt;注册bean：TransactionInterceptor&lt;/li&gt;
&lt;li&gt;注册bean：TransactionAttributeSourceAdvisor&lt;/li&gt;
&lt;li&gt;注册组合component：CompositeComponentDefinition&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;上面解析标签的时候注入的这些bean在getBean的时候会起作用，在getBean的时候会判断是否需要返回包装后的bean，也就是org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator#wrapIfNecessary方法，找到所有的advisor（顺便完成初始化），然后判断找出所有可以应用到该类的advisor（org.springframework.aop.support.AopUtils#findAdvisorsThatCanApply），然后利用可用的advisor创建proxy（org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator#createProxy）,这个proxy就是原来类的代理，在请求该类的方法的时候是通过代理进行的，在代理中会判断是否有事务，是否需要开启事务&lt;/p&gt;
&lt;h2 id=&quot;事务处理过程&quot;&gt;事务处理过程&lt;/h2&gt;
&lt;p&gt;Spring 事务处理是基于AOP实现的，为事务方法所在类生成一个代理类，在调用事务方法的时候实际会调用代理类的代理方法，这里就是&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;org.springframework.transaction.interceptor.TransactionInterceptor#invoke&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/846961/201903/846961-20190319231626720-204935801.png&quot; alt=&quot;spring事务&quot;/&gt;&lt;/p&gt;
&lt;p&gt;在看spring事务处理流程之前，我们先回顾下直接使用jdbc编程的时候使用事务的流程&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;拿到数据库连接&lt;/li&gt;
&lt;li&gt;设置数据库连接为非自动提交&lt;/li&gt;
&lt;li&gt;执行事务操作&lt;/li&gt;
&lt;li&gt;提交事务&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;spring事务处理的流程也基本相似，只是做了一些封装&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;拿到数据库连接，需要判断当前事务的传播级别，有些传播级别需要新的数据库连接开启新的事务&lt;/li&gt;
&lt;li&gt;设置数据库连接为非自动提交&lt;/li&gt;
&lt;li&gt;执行事务操作&lt;/li&gt;
&lt;li&gt;执行事务提交前的一些回调方法，比如：beforeCommit&lt;/li&gt;
&lt;li&gt;提交事务，判断是否有异常，是需要回滚还是提交&lt;/li&gt;
&lt;li&gt;执行事务提交后的一个方法，比如：afterCommit&lt;/li&gt;
&lt;/ol&gt;&lt;h2 id=&quot;总结&quot;&gt;总结&lt;/h2&gt;
&lt;p&gt;spring事务在屏蔽了一些繁琐逻辑的同时，也提供了比较好的扩展性，比如支持自定义数据源，自定义事务管理器，而且支持在事务执行前后加入自己的回调用方法。&lt;/p&gt;
</description>
<pubDate>Tue, 19 Mar 2019 15:19:00 +0000</pubDate>
<dc:creator>lacker</dc:creator>
<og:description>spring提供了可配置、易扩展的事务处理框架，本文主要从一下几个方面说明spring事务的原理 基本概念 事务配置解析 事务处理过程 基本概念 事务隔离级别 在同时进行多个事务的时候，可能会出现脏读</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/sunshine-2015/p/10562202.html</dc:identifier>
</item>
<item>
<title>unity3d俄罗斯方块源码教程+源码和程序下载 - Aili_Xiao</title>
<link>http://www.cnblogs.com/CLXiao-1029/p/10562062.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/CLXiao-1029/p/10562062.html</guid>
<description>&lt;p&gt;小时候，大家都应玩过或听说过《俄罗斯方块》，它是红白机，掌机等一些电子设备中最常见的一款游戏。而随着时代的发展，信息的进步，游戏画面从简单的黑白方块到彩色方块，游戏的玩法机制从最简单的消方块到现在的多人pk等，无一不是在体现它的火爆。在这里，通过这篇文章向大家分享一下自己在制作俄罗斯方块的经验和心得，以及文章最后的源码和pc程序。&lt;/p&gt;
&lt;p&gt;首先，看标题都知道这篇文章中所用到的游戏引擎是：unity3d，版本不限，但最好是5.4.3以上的，原因是因为作者自己没有用过5.4.3以下的版本。&lt;/p&gt;
&lt;p&gt;准备工具都有：unity3d + Visual Studio 2015&lt;/p&gt;
&lt;p&gt;素材准备有(密码：1vp5)：&lt;a href=&quot;https://pan.baidu.com/s/1cv49H_BE7_QW80-M9GMmAg&quot; data-cke-saved-href=&quot;https://pan.baidu.com/s/1cv49H_BE7_QW80-M9GMmAg&quot;&gt;字体方正粗圆_GBK，以及一些图集&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;项目分析：&lt;/p&gt;
&lt;p&gt;当一切准备就绪后，就可以开始创建我们的俄罗斯方块工程(2d)的。&lt;/p&gt;

&lt;p&gt;一、游戏框架的搭建和方块预设物的制作&lt;/p&gt;
&lt;p&gt;1.双击unity快捷方式，打开unity界面点击New新建工程，Template类型选择2d，工程名 Tetris，点击创建后稍等片刻进入编辑器界面&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;32&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/20190319174514226.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&quot; alt=&quot;&quot; width=&quot;660&quot; height=&quot;256&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20190319174514226.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20190319174514226.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;660&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;256&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;2.在Assets文件夹下创建几个常用文件夹用来归类：&lt;/p&gt;
&lt;p&gt;创建文件夹方式，在Project面板下右键&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;31&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/20190319175334184.png&quot; alt=&quot;&quot; width=&quot;568&quot; height=&quot;131&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20190319175334184.png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20190319175334184.png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;568&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;131&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Scenes(场景文件夹)，Resources(资源文件夹)，Script(脚本文件夹)，Texture(图集文件夹)，Prefabs(预设物文件夹)&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;30&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/20190319175254810.png&quot; alt=&quot;&quot; width=&quot;114&quot; height=&quot;108&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20190319175254810.png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20190319175254810.png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;114&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;108&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;从图中可以看到将预设物文件夹放到了资源文件夹下，这样做的好处是可以在代码中直接通过unity3d提供的Resources类进行访问。当然其他文件或文件夹也可以放进去，但是了解过Unity3d的你，应该知道Resource下的文件在打包的时候会占用很大资源，具体的提自行百度。&lt;/p&gt;
&lt;p&gt;3.导入图片等资源到对应的文件夹中(也可以自行创建)；保存当前场景，场景名MainGame；切割图片资源生成我们想要的图片集。&lt;/p&gt;
&lt;p&gt;4.在层级面板中右键创建UI面板Canvas，有关UI的对象都放置到UI面板中。设置相机背景颜色设置为纯白色，Canvas属性UIScaleMode设置为屏幕分辨率&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;29&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/20190319192042265.png&quot; alt=&quot;&quot; width=&quot;274&quot; height=&quot;620&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20190319192042265.png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20190319192042265.png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;274&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;620&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;界面搭建过程中在Canvas下可创建空物体用来做对应界面的父对象，也可以直接创建Panel。这里采用了创建空物体&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;28&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/201903191807325.png&quot; alt=&quot;&quot; width=&quot;170&quot; height=&quot;27&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/201903191807325.png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/201903191807325.png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;170&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;27&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;4-1.开始界面的搭建：&lt;/p&gt;
&lt;p&gt;创建空物体F2修改名字为StartPanel，设置StartPanel大小，点击stretch，按住Alt键，之后点击右下角，StartPanel的大小和位置就会被拉伸到Canvas尺寸&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;27&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/20190319183652546.png&quot; alt=&quot;&quot; width=&quot;273&quot; height=&quot;444&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20190319183652546.png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20190319183652546.png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;273&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;444&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;在StartPanel下创建UI→Text，将其锚点固定到上方中心位置也放到上方，文本信息设置为：俄罗斯方块&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;26&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/20190319184305681.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&quot; alt=&quot;&quot; width=&quot;1200&quot; height=&quot;650&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20190319184305681.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20190319184305681.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;1200&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;650&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;创建一个空物体重命名：ButtonGroup，用来整合开始界面中的按钮，将空物体放置到界面下方，在ButtonGroup下创建3个UI→Button，然后删除Button下的Text子物体，添加子物体Image，并分别重命名：btn_Start，btn_Set，btn_Rank。在ButtonGroup上添加布局组件可以将子物体进行一些布局调整&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;25&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/20190319185029823.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&quot; alt=&quot;&quot; width=&quot;905&quot; height=&quot;312&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20190319185029823.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20190319185029823.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;905&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;312&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;(做好一个按钮后可以将其拖拽成预设物，方便下次使用)&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;24&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/20190319192207229.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&quot; alt=&quot;&quot; width=&quot;1043&quot; height=&quot;432&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20190319192207229.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20190319192207229.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;1043&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;432&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;在预设物文件夹下创建三个文件夹用来分类预设物：Panel，Square，Other，将做好的StartPanel拖放到Panel文件夹下，btn_Start移动到Other文件夹下。&lt;/p&gt;
&lt;p&gt;4-2. 游戏运行界面搭建：创建四个Text其中两个用来文本提示，另外两个用来显示分数。将之前做好的按钮预设物拽上来，修改名字用来做暂停按钮，最后将做好的界面放到Panel文件夹中。&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;23&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/20190319193412915.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&quot; alt=&quot;&quot; width=&quot;1012&quot; height=&quot;357&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20190319193412915.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20190319193412915.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI0MzM1NDY=,size_16,color_FFFFFF,t_70&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;1012&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;357&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;4-3.设置界面排行界面暂停界面以及游戏结束界面，可分别搭建成如下图所示的样子。&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;22&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/20190319195336771.png&quot; alt=&quot;&quot; width=&quot;147&quot; height=&quot;147&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20190319195336771.png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20190319195336771.png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;147&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;147&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;21&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/2019031919540850.png&quot; alt=&quot;&quot; width=&quot;177&quot; height=&quot;181&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/2019031919540850.png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/2019031919540850.png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;177&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;181&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;20&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/20190319195421678.png&quot; alt=&quot;&quot; width=&quot;175&quot; height=&quot;160&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20190319195421678.png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20190319195421678.png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;175&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;160&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;19&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/20190319195434856.png&quot; alt=&quot;&quot; width=&quot;179&quot; height=&quot;176&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20190319195434856.png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20190319195434856.png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;179&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;176&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;4-4：界面预设物打包下载：&lt;a href=&quot;https://pan.baidu.com/s/1XP8LkIVQEZfWYreHnKrYdg&quot; data-cke-saved-href=&quot;https://pan.baidu.com/s/1XP8LkIVQEZfWYreHnKrYdg&quot;&gt;https://pan.baidu.com/s/1XP8LkIVQEZfWYreHnKrYdg&lt;/a&gt; 提取码：ad1o &lt;/p&gt;
&lt;p&gt;5.制作方块预设物：玩过俄罗斯方块的都知道，俄罗斯方块下落的方块类型有7种：&lt;span class=&quot;cke_widget_wrapper cke_widget_inline cke_widget_image cke_image_nocaption cke_widget_selected&quot; data-cke-widget-wrapper=&quot;1&quot; data-cke-filter=&quot;off&quot; data-cke-display-name=&quot;图像&quot; data-cke-widget-id=&quot;18&quot;&gt;&lt;img class=&quot;has cke_widget_element&quot; src=&quot;https://img-blog.csdnimg.cn/20190319195830284.png&quot; alt=&quot;&quot; width=&quot;269&quot; height=&quot;298&quot; data-cke-saved-src=&quot;https://img-blog.csdnimg.cn/20190319195830284.png&quot; data-cke-widget-data=&quot;{&amp;amp;quot;hasCaption&amp;amp;quot;:false,&amp;amp;quot;src&amp;amp;quot;:&amp;amp;quot;https://img-blog.csdnimg.cn/20190319195830284.png&amp;amp;quot;,&amp;amp;quot;alt&amp;amp;quot;:&amp;amp;quot;&amp;amp;quot;,&amp;amp;quot;width&amp;amp;quot;:&amp;amp;quot;269&amp;amp;quot;,&amp;amp;quot;height&amp;amp;quot;:&amp;amp;quot;298&amp;amp;quot;,&amp;amp;quot;lock&amp;amp;quot;:true,&amp;amp;quot;align&amp;amp;quot;:&amp;amp;quot;none&amp;amp;quot;,&amp;amp;quot;classes&amp;amp;quot;:{&amp;amp;quot;has&amp;amp;quot;:1}}&quot; data-cke-widget-upcasted=&quot;1&quot; data-cke-widget-keep-attr=&quot;0&quot; data-widget=&quot;image&quot;/&gt;&lt;span class=&quot;cke_reset cke_widget_drag_handler_container&quot;&gt;&lt;img class=&quot;cke_reset cke_widget_drag_handler&quot; title=&quot;点击并拖拽以移动&quot; src=&quot;data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==&quot; alt=&quot;&quot; width=&quot;15&quot; height=&quot;15&quot; data-cke-widget-drag-handler=&quot;1&quot;/&gt;&lt;span class=&quot;cke_image_resizer&quot; title=&quot;点击并拖拽以改变尺寸&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;这7种方块类型，我提供了下载包，可直接下载使用：&lt;a href=&quot;https://pan.baidu.com/s/1d-40cuiD_ioH69Pc_Hv9ng&quot; data-cke-saved-href=&quot;https://pan.baidu.com/s/1d-40cuiD_ioH69Pc_Hv9ng&quot;&gt;https://pan.baidu.com/s/1d-40cuiD_ioH69Pc_Hv9ng&lt;/a&gt; 提取码：8tj7 &lt;/p&gt;
&lt;p&gt;6.制作方块背景地图Map：Map最直接最简单的作用是为了显示方块可下落的位置，为此我们在做Map时，第一块物体的位置很重要，在这里，我们将其位置重置为0，然后Ctrl+D复制创建，然后选中复制出来的按住键盘Ctrl键进行向右拖拽。最后做到一行有10个方块，之后创建一个空物体将其坐标重置，将这一行方块整体放倒空物体后重命名空物体：Row，重复Ctrl+D复制创建并且按住键盘Ctrl键进行向上拖拽，做到场景中有12个Row后创建一个空物体将其坐标重置重命名为Map，将12行Row放到Map下面，最终生成10*12一块Map，将做好的&lt;a href=&quot;https://pan.baidu.com/s/1NgcwnW-995oSkhrOJHZUcw&quot; data-cke-saved-href=&quot;https://pan.baidu.com/s/1NgcwnW-995oSkhrOJHZUcw&quot;&gt;Map拖拽到Other文件夹下生成预设物&lt;/a&gt;。提取码：q0o8&lt;/p&gt;
&lt;p&gt;注意：在制作Map时，可以将第一块方块拖拽成预设物，这样子可以方便修改Map中所有方块的属性。&lt;/p&gt;
&lt;p&gt;至此，俄罗斯方块界面框架和预设物算是完成了。&lt;/p&gt;
&lt;p&gt;二、游戏代码逻辑编写&lt;/p&gt;
&lt;p&gt;在unity中提供两种常见的代码方式：C#和JavaScript，在这里采用C#去编写。游戏代码的编写风格以及框架有很多种，可以根据自己的习惯去书写自己满意的代码风格，但为了他人在阅读浏览自己代码是有可能会造成的一些问题，我们应该规范自己的代码风格和框架。在本教程中采用的是简单的MVC框架。&lt;/p&gt;
&lt;p&gt;在Script文件夹下创建三个文件夹：Ctrl，View，Data，分别用来存放控制脚本，视图脚本和数据脚本。&lt;/p&gt;
&lt;p&gt;在View文件夹下分别创建对应UIPanel的C#脚本：StartView，RunView，SetView，RankView，PasueView，OverView。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('52dcc68c-c231-47bd-8198-bd0a3eac4977')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_52dcc68c-c231-47bd-8198-bd0a3eac4977&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_52dcc68c-c231-47bd-8198-bd0a3eac4977&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('52dcc68c-c231-47bd-8198-bd0a3eac4977',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_52dcc68c-c231-47bd-8198-bd0a3eac4977&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine.UI;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; StartView : MonoBehaviour {

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_Start { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_ReStart { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_Set { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_Rank { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Text Txt_Title { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Use this for initialization&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Awake() {
        Btn_Start &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ButtonGroup/btn_Start&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
        Btn_Set &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ButtonGroup/btn_Set&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
        Btn_Rank &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ButtonGroup/btn_Rank&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
        Txt_Title &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;txt_Title&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Text&amp;gt;&lt;span&gt;();
    }
    
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Update is called once per frame&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Update () {        
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;StartView脚本&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('596e6aee-4243-4a49-a267-99bb46455f97')&quot; readability=&quot;33.5&quot;&gt;&lt;img id=&quot;code_img_closed_596e6aee-4243-4a49-a267-99bb46455f97&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_596e6aee-4243-4a49-a267-99bb46455f97&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('596e6aee-4243-4a49-a267-99bb46455f97',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_596e6aee-4243-4a49-a267-99bb46455f97&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;62&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine.UI;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; RunView : MonoBehaviour {

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_Pause { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Text Txt_Curr { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Text Txt_Max { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Use this for initialization&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Awake() {
        Btn_Pause &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;TopGroup/btn_Pasue&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
        Txt_Curr &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;TopGroup/txt_Current/Text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Text&amp;gt;&lt;span&gt;();
        Txt_Max &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;TopGroup/txt_Max/Text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Text&amp;gt;&lt;span&gt;();
        
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; SetScoreText(&lt;span&gt;int&lt;/span&gt; curr,&lt;span&gt;int&lt;/span&gt;&lt;span&gt; max) {
        Txt_Curr.text &lt;/span&gt;=&lt;span&gt; curr.ToString();
        Txt_Max.text &lt;/span&gt;=&lt;span&gt; max.ToString();
    }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; SetScoreText(&lt;span&gt;string&lt;/span&gt; curr, &lt;span&gt;string&lt;/span&gt;&lt;span&gt; max)
    {
        Txt_Curr.text &lt;/span&gt;=&lt;span&gt; curr;
        Txt_Max.text &lt;/span&gt;=&lt;span&gt; max;
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;RunView脚本&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('da403305-c3e6-4af5-b344-842b4a43f7fa')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_da403305-c3e6-4af5-b344-842b4a43f7fa&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_da403305-c3e6-4af5-b344-842b4a43f7fa&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('da403305-c3e6-4af5-b344-842b4a43f7fa',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_da403305-c3e6-4af5-b344-842b4a43f7fa&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine.UI;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; SetView : MonoBehaviour {
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_Forum { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_WebSite { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_Collect { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_Sound { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_Return { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; GameObject mask { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Use this for initialization&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Awake() {
        Btn_Forum &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Img_Bg/Btn_Forum&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
        Btn_WebSite &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Img_Bg/Btn_WebSite&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
        Btn_Collect &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Img_Bg/Btn_Collect&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
        Btn_Sound &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Img_Bg/Btn_Sound&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
        mask &lt;/span&gt;= Btn_Sound.transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Mask&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;).gameObject;
        Btn_Return &lt;/span&gt;= GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
    }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; SetSoundMask(&lt;span&gt;bool&lt;/span&gt;&lt;span&gt; isActive)
    {
        mask.SetActive(isActive);
    }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; SetSoundMask() {
        mask.SetActive(&lt;/span&gt;!&lt;span&gt;mask.activeSelf);
        GameManager.instance.Sound &lt;/span&gt;=&lt;span&gt; mask.activeSelf;
        AudioManager.instance.SetAudioSource(&lt;/span&gt;!&lt;span&gt;mask.activeSelf);
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;SetView脚本&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('be541cba-5ec7-4085-901b-f6488b8da2d3')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_be541cba-5ec7-4085-901b-f6488b8da2d3&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_be541cba-5ec7-4085-901b-f6488b8da2d3&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('be541cba-5ec7-4085-901b-f6488b8da2d3',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_be541cba-5ec7-4085-901b-f6488b8da2d3&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine.UI;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; RankView : MonoBehaviour {
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_Clear { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_Return { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Text Txt_Curr { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Text Txt_Max { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Text Txt_Count { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Use this for initialization&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Awake() {
        Btn_Clear &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Img_Bg/Btn_Clear&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
        Txt_Curr &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Img_Bg/Txt_Name&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Text&amp;gt;&lt;span&gt;();
        Txt_Max &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Img_Bg/Txt_Max/Text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Text&amp;gt;&lt;span&gt;();
        Txt_Count &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Img_Bg/Txt_Count/Text&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Text&amp;gt;&lt;span&gt;();
        Btn_Return &lt;/span&gt;= GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
    }
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; Start()
    {
        SetScoreText();
    }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; TextClearData() {
        Txt_Max.text &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;.ToString();
        Txt_Count.text &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;.ToString();
        GameManager.instance.Score &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
        GameManager.instance.highScore &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
        GameManager.instance.numbersGame &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; SetScoreText() {
        Txt_Max.text &lt;/span&gt;=&lt;span&gt; GameManager.instance.highScore.ToString();
        Txt_Count.text &lt;/span&gt;=&lt;span&gt; GameManager.instance.numbersGame.ToString();
    }
    
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;RankView脚本&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('f34b4c3d-bd5c-491d-8c2d-5ae6afa03579')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_f34b4c3d-bd5c-491d-8c2d-5ae6afa03579&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_f34b4c3d-bd5c-491d-8c2d-5ae6afa03579&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('f34b4c3d-bd5c-491d-8c2d-5ae6afa03579',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_f34b4c3d-bd5c-491d-8c2d-5ae6afa03579&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine.UI;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; PasueView : MonoBehaviour {

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_Home { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_Start { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Text Txt_Curr { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Use this for initialization&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Awake()
    {
        Btn_Home &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Img_Bg/Btn_Home&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
        Btn_Start &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Img_Bg/Btn_Start&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
        Txt_Curr &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Img_Bg/Txt_Count&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Text&amp;gt;&lt;span&gt;();
    }

}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;PasueView脚本&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('370e0011-293c-4420-8fc7-d00dd628752a')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_370e0011-293c-4420-8fc7-d00dd628752a&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_370e0011-293c-4420-8fc7-d00dd628752a&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('370e0011-293c-4420-8fc7-d00dd628752a',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_370e0011-293c-4420-8fc7-d00dd628752a&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine.UI;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; OverView : MonoBehaviour {
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_Home { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Button Btn_ReStart { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Text Txt_Curr { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Use this for initialization&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Awake () {
        Btn_Home &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Img_Bg/Btn_Home&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
        Btn_ReStart &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Img_Bg/Btn_ReStart&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Button&amp;gt;&lt;span&gt;();
        Txt_Curr &lt;/span&gt;= transform.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Img_Bg/Txt_Count&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Text&amp;gt;&lt;span&gt;();
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; SetScoreText(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; score) {
        Txt_Curr.text &lt;/span&gt;=&lt;span&gt; score.ToString();
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;OverView脚本&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;在Ctrl文件夹下分别创建对应UIPanel的C#脚本：StartCtrl，RunCtrl，SetCtrl，RankCtrl，PasueCtrl，OverCtrl。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('647c45d5-1c72-4dde-8576-4273f0a5f5a6')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_647c45d5-1c72-4dde-8576-4273f0a5f5a6&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_647c45d5-1c72-4dde-8576-4273f0a5f5a6&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('647c45d5-1c72-4dde-8576-4273f0a5f5a6',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_647c45d5-1c72-4dde-8576-4273f0a5f5a6&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; StartCtrl : MonoBehaviour {
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; StartView view { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    Camera mainCamera { &lt;/span&gt;&lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; Awake()
    {
        mainCamera &lt;/span&gt;=&lt;span&gt; Camera.main;
    }

    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; Start () {
        view &lt;/span&gt;= gameObject.AddComponent&amp;lt;StartView&amp;gt;&lt;span&gt;();
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;开始按钮事件&lt;/span&gt;
        view.Btn_Start.onClick.AddListener(&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt;() {
            Destroy(gameObject);
            GameManager.instance.CreatePanel(PanelType.RunPanel);
            AudioManager.instance.PlayCursor();
        });
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;设置按钮事件&lt;/span&gt;
        view.Btn_Set.onClick.AddListener(&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt; () {            
            GameManager.instance.CreatePanel(PanelType.SetPanel);
            AudioManager.instance.PlayCursor();
        });
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;排行榜按钮事件&lt;/span&gt;
        view.Btn_Rank.onClick.AddListener(&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt; () {
            GameManager.instance.CreatePanel(PanelType.RankPanel);
            AudioManager.instance.PlayCursor();
        });
        StartCoroutine(doZoomOut());
    }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;缩小&lt;/span&gt;
&lt;span&gt;    IEnumerator doZoomOut()
    {
        &lt;/span&gt;&lt;span&gt;bool&lt;/span&gt; isdo = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;yield&lt;/span&gt; &lt;span&gt;return&lt;/span&gt; &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;while&lt;/span&gt; (!&lt;span&gt;isdo)
        {
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (mainCamera.orthographicSize &amp;gt; &lt;span&gt;12.5f&lt;/span&gt;&lt;span&gt;)
            {
                isdo &lt;/span&gt;= &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
            }
            mainCamera.orthographicSize &lt;/span&gt;+= &lt;span&gt;0.1f&lt;/span&gt;&lt;span&gt;;
            &lt;/span&gt;&lt;span&gt;yield&lt;/span&gt; &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; WaitForSeconds(&lt;span&gt;0.02f&lt;/span&gt;&lt;span&gt;);
        }
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;StartCtrl脚本&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('112130e3-baa2-4399-b8fa-8510e8983ff6')&quot; readability=&quot;33.5&quot;&gt;&lt;img id=&quot;code_img_closed_112130e3-baa2-4399-b8fa-8510e8983ff6&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_112130e3-baa2-4399-b8fa-8510e8983ff6&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('112130e3-baa2-4399-b8fa-8510e8983ff6',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_112130e3-baa2-4399-b8fa-8510e8983ff6&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;62&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; RunCtrl : MonoBehaviour {
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;bool&lt;/span&gt; isPause { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; RunView view { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    Camera mainCamera { &lt;/span&gt;&lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Awake()
    {
        view &lt;/span&gt;= gameObject.AddComponent&amp;lt;RunView&amp;gt;&lt;span&gt;();
        GameManager.instance.isOver &lt;/span&gt;= &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
        isPause &lt;/span&gt;= &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
        mainCamera &lt;/span&gt;= GameObject.Find(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Main Camera&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;).GetComponent&amp;lt;Camera&amp;gt;&lt;span&gt;();
    }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Use this for initialization&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Start () {
        view.SetScoreText(&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;, GameManager.instance.highScore);

        StartCoroutine(doZoomIn());


        view.Btn_Pause.onClick.AddListener(&lt;/span&gt;&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt; () {
            isPause &lt;/span&gt;= &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
            GameManager.instance.currentShape.isPause &lt;/span&gt;= &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
            GameManager.instance.CreatePanel(PanelType.PasuePanel);
            AudioManager.instance.PlayCursor();
        });
        
    }

    &lt;/span&gt;&lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;summary&amp;gt;&lt;/span&gt;
    &lt;span&gt;///&lt;/span&gt;&lt;span&gt; 放大
    &lt;/span&gt;&lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;/summary&amp;gt;&lt;/span&gt;
    &lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;returns&amp;gt;&amp;lt;/returns&amp;gt;&lt;/span&gt;
&lt;span&gt;    IEnumerator doZoomIn()
    {
        &lt;/span&gt;&lt;span&gt;bool&lt;/span&gt; isdo = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;yield&lt;/span&gt; &lt;span&gt;return&lt;/span&gt; &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;while&lt;/span&gt; (!&lt;span&gt;isdo)
        {
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (Camera.main.orthographicSize &amp;lt;&lt;span&gt; 10f)
            {
                isdo &lt;/span&gt;= &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
            }
            Camera.main.orthographicSize &lt;/span&gt;-= &lt;span&gt;0.1f&lt;/span&gt;&lt;span&gt;;
            &lt;/span&gt;&lt;span&gt;yield&lt;/span&gt; &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; WaitForSeconds(&lt;span&gt;0.02f&lt;/span&gt;&lt;span&gt;);
        }
    }

    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; Update()
    {
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (isPause) &lt;span&gt;return&lt;/span&gt;&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;while&lt;/span&gt; (GameManager.instance.currentShape == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;)
        {
            SquareType st &lt;/span&gt;= (SquareType)Random.Range(&lt;span&gt;0&lt;/span&gt;, &lt;span&gt;7&lt;/span&gt;&lt;span&gt;);
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;测试生成&lt;/span&gt;
&lt;span&gt;            GameManager.instance.CreateSquare(st);
        }
    }

}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;RunCtrl脚本&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('3c270f21-d4ef-4460-8d22-8a7761e1f35c')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_3c270f21-d4ef-4460-8d22-8a7761e1f35c&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_3c270f21-d4ef-4460-8d22-8a7761e1f35c&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('3c270f21-d4ef-4460-8d22-8a7761e1f35c',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_3c270f21-d4ef-4460-8d22-8a7761e1f35c&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; SetCtrl : MonoBehaviour {
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; SetView view { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Use this for initialization&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Start () {    
        view &lt;/span&gt;= gameObject.AddComponent&amp;lt;SetView&amp;gt;&lt;span&gt;();

        view.SetSoundMask(GameManager.instance.Sound);

        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;声音按钮事件&lt;/span&gt;
        view.Btn_Sound.onClick.AddListener(&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt; () {
            view.SetSoundMask();
            DataModel.SaveData();
            AudioManager.instance.PlayControl();
        });

        view.Btn_Collect.onClick.AddListener(&lt;/span&gt;&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt; () {
        });
        view.Btn_Forum.onClick.AddListener(&lt;/span&gt;&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt; () {
        });
        view.Btn_WebSite.onClick.AddListener(&lt;/span&gt;&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt; () {
        });


        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;返回按钮事件&lt;/span&gt;
        view.Btn_Return.onClick.AddListener(&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt; () {
            Destroy(gameObject);
        });
    }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Update is called once per frame&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Update () {
    
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;SetCtrl脚本&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('2eb08245-273e-4923-b811-103b1a6701fc')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_2eb08245-273e-4923-b811-103b1a6701fc&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_2eb08245-273e-4923-b811-103b1a6701fc&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('2eb08245-273e-4923-b811-103b1a6701fc',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_2eb08245-273e-4923-b811-103b1a6701fc&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; RankCtrl : MonoBehaviour {
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; RankView view { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Use this for initialization&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Start () {
        view &lt;/span&gt;= gameObject.AddComponent&amp;lt;RankView&amp;gt;&lt;span&gt;();

        view.Btn_Clear.onClick.AddListener(&lt;/span&gt;&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt; () {
            view.TextClearData();
            DataModel.SaveData();
        });

        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;返回按钮事件&lt;/span&gt;
        view.Btn_Return.onClick.AddListener(&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt; () {
            Destroy(gameObject);
        });
    }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Update is called once per frame&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Update () {
    
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;RankCtrl脚本&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('7133f628-79b5-49fe-aefc-cf69635c653c')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_7133f628-79b5-49fe-aefc-cf69635c653c&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_7133f628-79b5-49fe-aefc-cf69635c653c&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('7133f628-79b5-49fe-aefc-cf69635c653c',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_7133f628-79b5-49fe-aefc-cf69635c653c&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; PasueCtrl : MonoBehaviour {
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; PasueView view { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Use this for initialization&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Start () {
        view &lt;/span&gt;= gameObject.AddComponent&amp;lt;PasueView&amp;gt;&lt;span&gt;();
        view.Txt_Curr.text &lt;/span&gt;=&lt;span&gt; GameManager.instance.Score.ToString();
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;继续游戏按钮事件&lt;/span&gt;
        view.Btn_Start.onClick.AddListener(&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt; () {
            GameManager.instance.isOver &lt;/span&gt;= &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
            GameManager.instance.ctrl_run.isPause &lt;/span&gt;= &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
            GameManager.instance.currentShape.isPause &lt;/span&gt;= &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
            Destroy(gameObject);
            AudioManager.instance.PlayCursor();
        });

        view.Btn_Home.onClick.AddListener(&lt;/span&gt;&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt; () {
            DestroyAll();
            GameManager.instance.isOver &lt;/span&gt;= &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
            AudioManager.instance.PlayCursor();
            GameManager.instance.CreatePanel(PanelType.StartPanel);
        });
    }
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; DestroyAll() {
        &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;1&lt;/span&gt;; i &amp;lt; GameManager.instance.transform.childCount; i++&lt;span&gt;)
        {
            Destroy(GameManager.instance.transform.GetChild(i).gameObject);
        }
        &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; GameManager.instance.CreatePoint.childCount; i++&lt;span&gt;)
        {
            Destroy(GameManager.instance.CreatePoint.GetChild(i).gameObject);
        }
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;PasueCtrl脚本&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('81721703-6f51-41fe-818a-85f0ebe9cec0')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_81721703-6f51-41fe-818a-85f0ebe9cec0&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_81721703-6f51-41fe-818a-85f0ebe9cec0&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('81721703-6f51-41fe-818a-85f0ebe9cec0',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_81721703-6f51-41fe-818a-85f0ebe9cec0&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; OverCtrl : MonoBehaviour {
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; OverView view { &lt;span&gt;get&lt;/span&gt;; &lt;span&gt;set&lt;/span&gt;&lt;span&gt;; }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Use this for initialization&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; Start () {
        view &lt;/span&gt;= gameObject.AddComponent&amp;lt;OverView&amp;gt;&lt;span&gt;();

        view.SetScoreText(GameManager.instance.Score);
        
        AudioManager.instance.PlayGameOver();


        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;重新开始&lt;/span&gt;
        view.Btn_ReStart.onClick.AddListener(&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt;() {
            ClearSquare();
            GameManager.instance.isOver &lt;/span&gt;= &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;取消暂停&lt;/span&gt;
            GameManager.instance.ctrl_run.isPause = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
        });

        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;返回主页&lt;/span&gt;
        view.Btn_Home.onClick.AddListener(&lt;span&gt;delegate&lt;/span&gt;&lt;span&gt;() {
            ClearSquare();
            GameManager.instance.isOver &lt;/span&gt;= &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
            Destroy(GameManager.instance.ctrl_run.gameObject);
            GameManager.instance.CreatePanel(PanelType.StartPanel);
        });
    }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Update is called once per frame&lt;/span&gt;
    &lt;span&gt;void&lt;/span&gt;&lt;span&gt; ClearSquare () {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;清除已生成的方块&lt;/span&gt;
        &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; GameManager.instance.CreatePoint.childCount; i++&lt;span&gt;)
        {
            Destroy(GameManager.instance.CreatePoint.GetChild(i).gameObject);
        }
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;清除当前分数&lt;/span&gt;
        GameManager.instance.Score = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
        GameManager.instance.ctrl_run.view.Txt_Curr.text &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;.ToString();
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;销毁自身&lt;/span&gt;
&lt;span&gt;        Destroy(gameObject);
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;OverCtrl脚本&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;在Data文件夹下分别创建方块和游戏涉及到的数据脚本：DataModel，CtrlInput，SquareControl。&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('60f95164-961e-4e3e-9e0b-5cf93f9df2e0')&quot; readability=&quot;40.5&quot;&gt;&lt;img id=&quot;code_img_closed_60f95164-961e-4e3e-9e0b-5cf93f9df2e0&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_60f95164-961e-4e3e-9e0b-5cf93f9df2e0&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('60f95164-961e-4e3e-9e0b-5cf93f9df2e0',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_60f95164-961e-4e3e-9e0b-5cf93f9df2e0&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;76&quot;&gt;
&lt;pre&gt;
&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.Collections.Generic;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; System.IO;
&lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; UnityEngine;



&lt;/span&gt;&lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;summary&amp;gt;&lt;/span&gt;
&lt;span&gt;///&lt;/span&gt;&lt;span&gt; 面板类型(PanelType)
&lt;/span&gt;&lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;/summary&amp;gt;&lt;/span&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;enum&lt;/span&gt;&lt;span&gt; PanelType
{
    StartPanel, RunPanel, SetPanel, RankPanel, PasuePanel, GameOverPanel
}

&lt;/span&gt;&lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;summary&amp;gt;&lt;/span&gt;
&lt;span&gt;///&lt;/span&gt;&lt;span&gt; 方块类型
&lt;/span&gt;&lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;/summary&amp;gt;&lt;/span&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;enum&lt;/span&gt;&lt;span&gt; SquareType
{
    Square_1, Square_2, Square_3, Square_4, Square_5, Square_6, Square_7
}

&lt;/span&gt;&lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;summary&amp;gt;&lt;/span&gt;
&lt;span&gt;///&lt;/span&gt;&lt;span&gt; 方向键控制
&lt;/span&gt;&lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;/summary&amp;gt;&lt;/span&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;enum&lt;/span&gt;&lt;span&gt; DirectionType
{
    None, Left, Right, Down, Up
}


&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; DataModel  {
    &lt;/span&gt;&lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;summary&amp;gt;&lt;/span&gt;
    &lt;span&gt;///&lt;/span&gt;&lt;span&gt; 获取数据储存文件完整路径
    &lt;/span&gt;&lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;/summary&amp;gt;&lt;/span&gt;
    &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;readonly&lt;/span&gt; &lt;span&gt;string&lt;/span&gt; dataPath = Application.persistentDataPath + &lt;span&gt;@&quot;&lt;/span&gt;&lt;span&gt;\data.bin&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;summary&amp;gt;&lt;/span&gt;
    &lt;span&gt;///&lt;/span&gt;&lt;span&gt; 保存数据
    &lt;/span&gt;&lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;/summary&amp;gt;&lt;/span&gt;
    &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; SaveData()
    {
        &lt;/span&gt;&lt;span&gt;string&lt;/span&gt; content = GameManager.instance.highScore + &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; + GameManager.instance.numbersGame + &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; +&lt;span&gt; GameManager.instance.Sound;
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;写出文件&lt;/span&gt;
&lt;span&gt;        File.WriteAllText(dataPath, content);
    }
    &lt;/span&gt;&lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;summary&amp;gt;&lt;/span&gt;
    &lt;span&gt;///&lt;/span&gt;&lt;span&gt; 读取数据
    &lt;/span&gt;&lt;span&gt;///&lt;/span&gt; &lt;span&gt;&amp;lt;/summary&amp;gt;&lt;/span&gt;
    &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; LoadData()
    {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;判断文件是否存在&lt;/span&gt;
        &lt;span&gt;if&lt;/span&gt;&lt;span&gt; (File.Exists(dataPath))
        {
            &lt;/span&gt;&lt;span&gt;string&lt;/span&gt; content =&lt;span&gt; File.ReadAllText(dataPath);
            GameManager.instance.highScore &lt;/span&gt;= &lt;span&gt;int&lt;/span&gt;.Parse(content.Split(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;\n&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;)[&lt;span&gt;0&lt;/span&gt;&lt;span&gt;]);
            GameManager.instance.numbersGame &lt;/span&gt;= &lt;span&gt;int&lt;/span&gt;.Parse(content.Split(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;\n&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;)[&lt;span&gt;1&lt;/span&gt;&lt;span&gt;]);
            GameManager.instance.Sound &lt;/span&gt;= content.Split(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;\n&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;)[&lt;span&gt;2&lt;/span&gt;] == &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;true&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; ? &lt;span&gt;true&lt;/span&gt; : &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
        }
        &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;
        {
            GameManager.instance.highScore &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
            GameManager.instance.numbersGame &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
            GameManager.instance.Sound &lt;/span&gt;= &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
        }

    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;DataModel脚本&lt;/span&gt;&lt;/div&gt;



&lt;p&gt;在游戏打开的时候，要实现Map地图，开始界面等初始化，所以在GameManager类中写一个初始化方法和创建界面生成的方法&lt;/p&gt;

&lt;p&gt;留到最后的话，一款游戏如果缺了音乐总会觉得少些动感，所以在程序的最后说一下本工程中的音频管理。&lt;/p&gt;
&lt;p&gt;本工程中音频AudioSource有两个分别用来控制有可能冲突的音效，两个AudioSource分别添加到MainCamera和Canvas上。并且将音频文件所在的文件夹放置到Resource文件夹下，方便调用。在脚本文件夹中创建一个AudioManager脚本用来控制程序的音频。&lt;/p&gt;

&lt;p&gt;unity3d俄罗斯方块源码5.4.3版(有动画版)&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://download.csdn.net/download/u012433546/11037870&quot; data-cke-saved-href=&quot;https://download.csdn.net/download/u012433546/11037870&quot;&gt;https://download.csdn.net/download/u012433546/11037870&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;unity3d俄罗斯方块源码2018.2.14版(无动画)：&lt;/p&gt;
&lt;p&gt;链接：&lt;a href=&quot;https://pan.baidu.com/s/1-2UhD7_A-4IQf8qMMBm_Wg&quot; data-cke-saved-href=&quot;https://pan.baidu.com/s/1-2UhD7_A-4IQf8qMMBm_Wg&quot;&gt;https://pan.baidu.com/s/1-2UhD7_A-4IQf8qMMBm_Wg &lt;/a&gt;&lt;br/&gt;提取码：w8rr &lt;/p&gt;
&lt;p&gt;unity3d俄罗斯方块PC端程序：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://download.csdn.net/download/u012433546/11038002&quot; data-cke-saved-href=&quot;https://download.csdn.net/download/u012433546/11038002&quot;&gt;https://download.csdn.net/download/u012433546/11038002&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;链接：&lt;a href=&quot;https://pan.baidu.com/s/16vdhu6rRC5nx1Rz7W2qGsg&quot; data-cke-saved-href=&quot;https://pan.baidu.com/s/16vdhu6rRC5nx1Rz7W2qGsg&quot;&gt;https://pan.baidu.com/s/16vdhu6rRC5nx1Rz7W2qGsg&lt;/a&gt; &lt;br/&gt;提取码：ypa2 &lt;/p&gt;
</description>
<pubDate>Tue, 19 Mar 2019 14:48:00 +0000</pubDate>
<dc:creator>Aili_Xiao</dc:creator>
<og:description>小时候，大家都应玩过或听说过《俄罗斯方块》，它是红白机，掌机等一些电子设备中最常见的一款游戏。而随着时代的发展，信息的进步，游戏画面从简单的黑白方块到彩色方块，游戏的玩法机制从最简单的消方块到现在的多</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/CLXiao-1029/p/10562062.html</dc:identifier>
</item>
<item>
<title>一家创业公司发展历程-真实记录 - 故事爱人</title>
<link>http://www.cnblogs.com/WUXIAOCHANG/p/10561963.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/WUXIAOCHANG/p/10561963.html</guid>
<description>&lt;h2&gt;文章大纲&lt;/h2&gt;
&lt;p&gt;一、前言&lt;br data-filtered=&quot;filtered&quot;/&gt;
二、来这家公司之前的我&lt;br data-filtered=&quot;filtered&quot;/&gt;
三、介绍我目前在公司的情况&lt;br data-filtered=&quot;filtered&quot;/&gt;
四、公司发展历程与感悟&lt;br data-filtered=&quot;filtered&quot;/&gt;
五、技术部门发展详述&lt;br data-filtered=&quot;filtered&quot;/&gt;
六、总结&lt;/p&gt;
&lt;h2&gt;一、前言&lt;/h2&gt;
&lt;p&gt;  昨晚就寝时，忽然脑子晃出来了一个东西-关于我职业生涯规划，回想走出校门到现在的整个职场历程，最让我难忘的是目睹了一家公司从十几号人，发展到六十多个人，再锐减到四十个人，这个过程有很多值得分享与思考的地方。&lt;/p&gt;
&lt;h2&gt;二、来这家公司之前的我&lt;/h2&gt;
&lt;p&gt;  我于17年6月份踏出校门，我很了解自己，我的性格决定了我未来适合从事经营方面的工作，所以本该实习的我并没有寻找工作，而是闭门修炼了3个月的管理与市场的功课，在这个过程我思考着一个问题：我应该想办法去大企业，还是去创业公司？那时的我没有能力思考完整的职业规划，但我承认，面对大企业工资诱惑，我开始寻找校招、内推等方式，那时的我满怀希望，总觉得我可以的，但是事实却是不尽人意的，我每天要投递不下20份简历，但是如同大海捞针，没人给予回复，在17年10月份，我进入了一家做大项目类型的公司，刚进去我就和IT经理一同进行学校智慧化校园建设的调研与方案编写，仅仅一个月我就离职了，因为我觉得离我的理想有点脱轨了，于是在11月份我来到了现在的这家公司，从事android开发，那时候的公司，有十几号人，开发的同事仅仅有3个。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;经验分享：&lt;/span&gt;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;对于刚出学校的同学，第一份工作无比重要，无论是平台也好，经验也好，他会直接影响你下一份工作的起点，我身份就有很多真实的案例。&lt;/li&gt;
&lt;li&gt;当你忧虑去大企业或创业公司时候，你要评估以下几点，第一是你的学历，一般大企业会进行简历筛选，很可能你连门都没进去，就已经出局了。第二是你要明白自己的特长与爱好，你是综合素质能力比较强/希望全面的发展呢？还是在某个切入点有很好的深度，如果是前者，那我建议你挑选一家你很看好的创业公司，在这个过程你会全面的锻炼到自己，而且很快地进行晋升，如果是后者，那我建议找大企业，稳妥的一步步往高处走。&lt;/li&gt;
&lt;/ol&gt;&lt;h2&gt;三、介绍我目前在公司的情况&lt;/h2&gt;
&lt;p&gt;  目前我在公司的职位是技术经理，公司所有的开发工作都由我落实安排，由于公司处于创业期，所以不会有明确的条条框框，在这个过程，我会与老板、总经理、市场人员、产品等同事进行深入接触，共同讨论公司的业务发展与技术部门架构调整。&lt;/p&gt;
&lt;h2&gt;四、公司发展历程与感悟&lt;/h2&gt;
&lt;h3&gt;1. 公司前身&lt;/h3&gt;
&lt;p&gt;  2016年，老板联合几个好友，成立了现在的公司，那时并没有一个明确的战略目标，这个公司适合做什么，该做什么，未来发展规划是怎样，没人能完整概述出来，完全是走一步，看一步。并且他们接触的是一个有所了解，但未真实去落地的行业，所以有个摸着石头过河的过程。那时候我们有十几号人，组织架构是：老板、总经理、几个销售、行政（兼财务）和开发组。业务模型很单一，没有什么天然竞争优势。日常的运作是老板、总经理、几个销售到外面与各大资源进行项目商谈，技术部做技术支撑。在这样的情景下，没有考勤、考核制度，所有人处于没有监管的状态，没人管你工作具体什么时候完成，只是在必要时催你一下，也没有人能够告诉你如果努力，你可以在这个公司匹配哪个岗位。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;经验分享：&lt;/span&gt;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;从创业者角度讲，如果你对某个行业了解不够透彻，你也不知道自己想要的是什么，该怎么去实现，那你就不要盲目开始，有些东西是一开始，就回不了头，又或者一旦开始，你就必须跑得足够快。比如你投资了一家公司，现在资金链快断了，你会开始挣扎，想着放弃不甘心，也许我再投入一点，真的可以挽救这个局面，最后越陷越深。又比如，你打算开始某款产品，但你还没想清楚一切，包括战略性目标、推广运营模式、盈利模式等等，然后你出市场了，别人了解到你的东西后开始快速复制，最终你可能因为跑得不够快，倒下了。&lt;/li&gt;
&lt;li&gt;从人力资源角度讲，我觉得有两种人是最可贵的，第一种是本身就掌握了很丰富的资源与经验，比如技术管理岗位的人才，他刚进入公司，就能把一整套成熟并经过实战的管理机制，底层框架引入公司，帮公司减少搭建架构和试错的成本。第二种是经验不足，但能力足够好，愿意努力前进的。但无论对于哪一种人，公司都必须建立有效的萝卜+大棒机制，这样才能留住有用的人才。&lt;/li&gt;
&lt;/ol&gt;&lt;h3&gt;2. 天使轮融资成功&lt;/h3&gt;
&lt;p&gt;  企业发展到一定阶段，且未实现盈利情况下，只能开始寻找融资，然而对于一个连发展方向都没思考清楚的企业，想要按正常渠道进行融资谈何容易？而刚好这个公司的领导人喜欢扁平化管理，他认为互联网公司不应该有太多等级对待，所有人，包括老板都是同处于一个办公室的，所以一有什么开心的事情、难过的事情，会在整个公司进行状态的放大，严重地影响所有人的正常工作。幸好，通过老板自身的资源，融到了天使轮xx万，但这是一个对赌的条约，如果没达到xx条件（不方便透露），那么必须将xx万进行归还，并每年以20%的利息进行偿还，具体偿还周期我没有深入了解。经过了1个月左右的风波，融资事情总算顺利结束了，然而接下来发生的事情，才是痛苦的开始。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;经验分享：&lt;/span&gt;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;对于办公场所布局，是领导有自己办公室，还是大家一起办公？，我一直保持中立态度，如果领导自控能力极强，能保持愉悦的工作氛围，那是最好的，这样有利于领导对整个公司情况进行了解，而且上传下达的过程可以突破很多的屏障，但反之，我认为是不可取的。&lt;/li&gt;
&lt;li&gt;我自身经验感觉，广州适合做产业相关的东西，或某些产品发布宣传活动，而深圳适合创业，因为深圳各方面的配套都比广州的完整，无论是制造业还是科技等发面，并且广州相关的基金公司比较少。&lt;/li&gt;
&lt;/ol&gt;&lt;h3&gt;3. 花钱买教训&lt;/h3&gt;
&lt;p&gt;  在天使轮融资后，刚好嗅到了国家政策的利好，于是我们开始接触新的行业，而且注意了，这次一来，就是两个行业，对于中小企业来讲，很少有领导会深入进行市场调研且做综合评估。基本是一想到什么，就开始组织一帮人马干起来了。基于这样的背景，我们公司开始急速扩张，从原来的几名销售，发展到3个销售组，毫无疑问，技术部门的人力也必须增加，于是成立了产品经理、技术经理、开发组长，测试人员等，一场浩浩浩荡荡且即将看到光明的征途开始了。&lt;br data-filtered=&quot;filtered&quot;/&gt;
  表面看似一切都紧张有序进行着，但实际上，各个销售团队的负责人缺乏足够的实战经验，并且这对他们来讲已经有难度了-跨行业，再加上公司战略、方向、部门考核与奖励、盈利模式等等都未规划完整，所以全部人乱成一锅，各大销售组会想出各种奇奇怪怪的需求，然而老板和总经理也不知未来的方向在哪里，便只能硬着头皮去尝试各种可能，因为他生怕放过某个可能成功的机会。这个过程遭殃的就是属于技术部门了，他们得随着市场的快速变化进行思路转变，对他们来讲就是煎熬，每次需求一提上来，就会定出一个看似不可能完成的时间，他们开始赶工完成，在完成时候，又发现他们所做的东西，被搁浅在那里了，事情重复了大概3个月，整个公司陷入焦虑，又有波浪形的兴奋中。经过时间的沉淀，事情有了结论，这个过程的战术是有问题的，问题之一是我们总想着一个自认为很完美的方案，去颠覆多个企业或一个企业多个部门之间的运作逻辑，但是人家碍于关系，会和你谈，但项目永远落不了地。问题之二是在项目/产品落地最后一步，我们太理想化了，总觉得别人会按我们既定的逻辑思维是做，但是实际却不尽人意。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;经验分享：&lt;/span&gt;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;在启动一个大型项目时候，一定要经过深入市场调研，试运行阶段，然后收集相关信息进行分析评估，再决定是否开始大规模发展。&lt;/li&gt;
&lt;li&gt;公司在最初的时候，战线不应该拉的太长，不然很容易就资金链断裂。并不是每次危机都能化险为夷的。&lt;/li&gt;
&lt;li&gt;凡事讲究共赢，做生意也是，如果你试着去抢别人的蛋糕，但你又无法产生新的蛋糕，那么事情是很难进行顺利的。&lt;/li&gt;
&lt;/ol&gt;&lt;h3&gt;4. 减员&lt;/h3&gt;
&lt;p&gt;  经过大规模试错，企业的领导已经意识到原来的销售模式不行，迫于成本原因，公司决定调整人员架构，留住几个较有能力的销售跟进项目，开始与资源方进行搭配性的合作，前期的谈判和开发等铺垫性工作由我们完成，在项目真正落地时，按双方约定好的条件进行广度铺开。于是公司从60多人，锐减到40多人。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;经验分享：&lt;/span&gt;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;社会永远处于变动之中，总会有一大波的人被裁员，另一大波的人晋升，所以我们在工作过程中，一定要保持上进心，对自己未知东西保持敬畏心与探索。我想，裁员跟年龄关系并不是绝对的，当你足够优秀时，别人一定很需要你。&lt;/li&gt;
&lt;li&gt;一定要去一个让你能够成长的地方，如果那里所有人都比你差，那么我想你该换一个发展地方了。&lt;/li&gt;
&lt;/ol&gt;&lt;h2&gt;五、技术部门发展详述&lt;/h2&gt;
&lt;p&gt;  因为我一直处于公司的技术部，所以对技术部的发展有比较深的感悟，就从我刚进入公司开始讲起吧，刚踏进这个公司的时候，我就明显感觉到这个公司的氛围是很简单的，在这里你不会有多大的工作压力，但是你也不可能从这里获得什么额外的收获，还记得那时的我处于试用期，在一次介绍下周工作计划时，我说了某个功能模块大概一周可以开发完成，这时候领导满怀期待得说：那我们就拭目以待，那时候我就有种感觉，这个公司适合养老，哈哈。&lt;/p&gt;
&lt;h3&gt;1. 急速膨胀过程&lt;/h3&gt;
&lt;p&gt;  在公司急速、盲目壮大过程中，技术部也面临着考验，必须快速地从3个人发展到足以支撑整个公司业务的状态，而此时，我也不甘做一个普普通通的android开发人员，所以我对技术部进行了总结，包括目前有哪些好的现象，哪些不好的现象，包括我能为公司贡献的有什么，于是领导为我开通了三个月的试用期技术经理，接下来的所有发挥只能靠我自己，因为也没人可以为我指引。&lt;br data-filtered=&quot;filtered&quot;/&gt;
  我开始搭建出技术部最基础的人员架构，那时的我，局限于能力，能考虑到的只有开发的架构，在这个阶段，没有产品设计人员，没有测试人员和运维人员，全程由我一人进行牵头，我们就这样开始了一个十几个人的队伍，从正常逻辑讲，一个高度依赖技术的公司，发展到几十号人时候，必须要有1-2位技术大牛在，但是我们没有，全体性平庸，又全体性前进。但激情总有消退时，刚过两个月，有人开始抱怨，他们觉得他们正在做的工作不属于他们负责的范畴，他们喜欢一个萝卜一个坑的工作方式，又或者开发出来的东西，并没有按照UI设计师的效果进行开发。而对我来说，管理能力也是一个全新的挑战，我开始尝试一种新的管理方式-开放性的管理，因为我觉得每个人会像我一样具有主观能动性，所以我为每个人制定工作计划，告诉他们什么时候完成哪些内容，完成的指标是什么，当到了指定时间，有一些人没有完成任务，我问他们为什么？有的说他不知道详细的目标是什么，有的人说东西有点难度，这个时间完成不了又或者需要有多个人配合他进行。。。我开始意识我必须搭建出完整的的游戏规则了，我开始将技术部按项目类型进行分组，成立两个开发组，分别配置一个开发组长和四个开发人员，一个UI设计师，我也开始搭建我的技术管理逻辑，从需求整理，到原型与UI设计，到开发的成员表、任务分配表、代码管理、BUG管理等等规则，我幻想着每个人可以按照我既定的轨道，一环扣一环地接上去，所以我用了很长的时间去设计这个东西，然后满怀期待的推广出去，但最后我失望了，我开始意识到，每个人的思维、能力真的是有区别的，并不是每个人都能理解你的计划，并为之努力。但这个过程我有一个意外的收获，我发现我们闭门造车设计了很久的东西，在外界已经有相当成熟的方案，并且被人们实践着。&lt;br data-filtered=&quot;filtered&quot;/&gt;
  在经历了一个月之后，我开始感觉到疲惫，因为我意识到技术部缺乏了一个测试的人员为我分担工作，所以我开始进行招聘，但是有一点让我很苦恼，我们公司没有人力资源管理人员，所有技术相关的面试工作必须由我一人进行，因此我决定群面，这样就能够减少我的面试占用时间，经过几轮面试，我发现群面有几个好处，你能够快速地对所有人有一个对比，同时每个人的能力，特别是应急能力能够很快体现出来。最后我招聘了一个女的测试工程师，然后我发现，测试工程师这个岗位，真的要找一个性格很好，喜欢与人打交道的女生，这样可以减少很多工作上的摩擦，因为我的这个女的测试工程师就是这样，所以我要感谢她。&lt;br data-filtered=&quot;filtered&quot;/&gt;
  基于上面提到的技术架构，已经基本能够完成公司的业务内容，但是我一直觉得有一点很不妥，就是公司的产品，每次一有什么新的想法，都没有经过完整的规划，需求评审，技术评审，就直接来到了开发排期，导致了各种混乱，包括产品方向的错误，人力资源浪费等等。所以我开始提出申请，成立产品设计部门，为公司的产品进行细致分析规划。&lt;/p&gt;
&lt;h3&gt;2. 稳定发展&lt;/h3&gt;
&lt;p&gt;  目前公司的方向已经明朗，所有事情都开始趋于稳定，而技术、产品部门也逐步发展完善，从产品、开发、测试的整个过程都有较好的管理方式、考核方式、福利制度等，而我，则希望在动态平衡下，成立运维部门，并且将完整的管理机器跑起来。现在的我已经没有当初那么忙了，我开始有时间可以思考自己的人生，与此同时，我逐渐意识到：过早的转型管理并非是好事，这个过程会进行思维跳跃，你会觉得那些最基本的东西似乎没什么作用，你会开始眼高手低，你总认为你应该有更好的发展，而不应该在这里做这么底层的东西，但是当你准备往上跳的时候，你又觉得很空虚，因为你觉得你能力不够，因为我就是如此。&lt;/p&gt;
&lt;p&gt;&lt;span&gt;经验分享：&lt;/span&gt;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;处于发展期的创业公司，他基本会有一个试错的过程，所以技术显得格外重要，如果一个公司的底层架构、提高效率方面的准备工作没做充足，最后会使得每个人都很疲倦。&lt;/li&gt;
&lt;li&gt;凡事讲究动态平衡，只要他合理，你就不应该过度的去要求，因为你不能要求每件事情都按照你既定的逻辑去发展，就像一个公司/部门，领导人肯定是希望每个人能够一直的忙着，不要停下来，但是，可能吗？&lt;/li&gt;
&lt;li&gt;做任何事情，都需要进行规划，但不要过度规划，比如我们准备一个产品，我们可以计划哪些基本功能先实现，哪些版本迭代时候实现，又或者预估它的发展路线，但是一定不要去完整地规划他，因为这个过程会花费你很多的时间，你也许还会发现这个事情好像各方面条件都不成熟，不应该做，然而后面你会发现，事情根本就不是你想的那样。&lt;/li&gt;
&lt;li&gt;当你开始接触一个新东西时候，你不要自己凭空的去设计相应的逻辑，这时你应该向外界进行探索，因为总有人在做你相同的事情，并且做的比你好。&lt;/li&gt;
&lt;li&gt;在你工作过程中，接到了不属于你工作范畴的任务，你要先评估，这个东西做了对你是否有经验性成长，如果有，那么你就应该尽力得去做好他，如果没有，那么你再进行婉拒。&lt;/li&gt;
&lt;li&gt;当你谋求其他出路时，你手上一定要有一个能让你活下去的工具，比如我希望去创业，那么在开始之前，我需要把我的技术能力进行广度和深度的锻炼，当我失败时候，我还能潇洒活下去，其实这跟商业逻辑是一样的：就算天塌下来，也必须有一样东西能赚钱。&lt;/li&gt;
&lt;li&gt;当你想和领导提涨工资/晋升岗位时候，你一定要投其所好，你要知道领导缺的是什么，并且传达出你能够帮他解决问题的信息，再去和他谈相应的条件。&lt;/li&gt;
&lt;li&gt;如果你是一个很喜欢管理计划的人，那么你一定要注意了，千万要注意周围事物的发展，及时调整你的计划，因为有些人，一旦定出了计划，他就会忽略外界的变化，他总认为事情会像他规划的那样发展。&lt;/li&gt;
&lt;li&gt;对于管理，我认为一定要制定出完整的游戏规则，并且这个规则要具有萝卜+大棒的机制，在中国要让人自觉的去完成某些东西，真的太难了。&lt;/li&gt;
&lt;li&gt;如果你是产品经理，你可能会随时接到老板凭空想象出来的一个东西，然后让你去完善整个产品的规划，这个时候很多人会郁闷，没头没尾的东西该怎么进行？在此我建议一个处理的思路：把这个产品相关的干系人找出来，比如这个产品涉及到老板的哪些资源利用，由谁负责项目落地等等，从他们身上去收集各种有效信息，再进行整合。&lt;/li&gt;
&lt;li&gt;对于在创业公司担任管理的小伙伴，一般你会是身兼多职的，但你必须明白你此时所处的身份后，再进行决策，因为有时候我们会出现身份切换错乱情况，导致很多决策失误。&lt;/li&gt;
&lt;/ol&gt;&lt;h2&gt;六、总结&lt;/h2&gt;
&lt;p&gt;  因为工作原因，能静下心来写这些东西时间真的寥寥无几，有些内容只能在后面进行更新。我一直相信，在有空的时候一定要多读书，因为那些东西是人们跌跌撞撞后，总结的一整套经验性东西，也许那时的你学了，无法体会其真正的含义，但当你在经历某个很相似的经历时，你会明白别人是怎么处理的，然后结合当时的实际情况做出正确决定。另外我觉得，对于以后有创业想法的小伙伴，在年轻的时候，想办法找一家你觉得有可能成功的公司，陪他一起成长，你能够分享他的成功，也能总结他的失败，为你人生路铺上一层免费的垫脚石。&lt;/p&gt;
</description>
<pubDate>Tue, 19 Mar 2019 14:31:00 +0000</pubDate>
<dc:creator>故事爱人</dc:creator>
<og:description>文章大纲 一、前言二、来这家公司之前的我三、介绍我目前在公司的情况四、公司发展历程与感悟五、技术部门发展详述六、总结 一、前言 昨晚就寝时，忽然脑子晃出来了一个东西-关于我职业生涯规划，回想走出校门到</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/WUXIAOCHANG/p/10561963.html</dc:identifier>
</item>
</channel>
</rss>