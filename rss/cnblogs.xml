<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>åšå®¢å›­_é¦–é¡µ</title>
<link></link>
<description>ä»£ç æ”¹å˜ä¸–ç•Œ</description>
<item>
<title>5 ä¸ª Git å·¥ä½œæµï¼Œæ”¹å–„ä½ çš„å¼€å‘æµç¨‹ - å‰Šå¾®å¯’</title>
<link>http://www.cnblogs.com/xueweihan/p/13524162.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/xueweihan/p/13524162.html</guid>
<description>&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200818161317199-1015274632.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘è¿˜æ²¡æœ‰é‡åˆ°è¿‡ä¸€ä¸ªå¼€å‘äººå‘˜ï¼Œåœ¨æŸ¥çœ‹ Git åˆ†æ”¯åˆå¹¶çš„å†²çªä¿¡æ¯æ—¶ä¸æŠ“è€³æŒ è…®ã€‚&lt;/p&gt;
&lt;p&gt;è§£å†³ Git åˆå¹¶å†²çªæ˜¯æ¯ä¸ªå¼€å‘äººå‘˜éƒ½è®¨åŒçš„äº‹æƒ…ä¹‹ä¸€ï¼Œå°¤å…¶æ˜¯å½“ä½ å‡†å¤‡è¿›è¡Œç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ—¶ï¼&lt;/p&gt;
&lt;p&gt;æ­£ç¡®çš„è®¾ç½® Git å·¥ä½œæµå¯ä»¥æ”¹å–„ä½ çš„ &lt;a href=&quot;https://zepel.io/blog/simple-software-development-workflow/&quot;&gt;å¼€å‘æµç¨‹&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œæ‹¥æœ‰æ­£ç¡®çš„ Git å·¥ä½œæµå¹¶ä¸èƒ½è§£å†³ä½ çš„æ‰€æœ‰é—®é¢˜ã€‚ä½†è¿™æ˜¯æœæ­£ç¡®æ–¹å‘è¿ˆå‡ºçš„ä¸€æ­¥ã€‚æ¯•ç«Ÿï¼Œç”±äºæ¯ä¸ªå›¢é˜Ÿéƒ½æ˜¯è¿œç¨‹å·¥ä½œçš„ï¼Œåœ¨ä¸ç ´åä»£ç åº“çš„æƒ…å†µä¸‹å…±åŒå¼€å‘äº§å“åŠŸèƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•è®¾ç½® Git å·¥ä½œæµå–å†³äºä½ æ­£åœ¨å¼€å‘çš„é¡¹ç›®ã€å›¢é˜Ÿçš„å‘å¸ƒè®¡åˆ’ã€å›¢é˜Ÿçš„è§„æ¨¡ç­‰ç­‰ï¼&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å‘ä½ ä»‹ç» 5 ç§ä¸åŒçš„ Git å·¥ä½œæµï¼Œå®ƒä»¬çš„ä¼˜ç‚¹ï¼Œç¼ºç‚¹ä»¥åŠä½¿ç”¨å®ƒä»¬çš„æ—¶æœºã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼&lt;/p&gt;
&lt;h2 id=&quot;1-åŸºæœ¬çš„-git-å·¥ä½œæµ&quot;&gt;1. åŸºæœ¬çš„ Git å·¥ä½œæµ&lt;/h2&gt;
&lt;p&gt;æœ€åŸºæœ¬çš„ Git å·¥ä½œæµæ˜¯åªæœ‰ä¸€ä¸ªåˆ†æ”¯ - master åˆ†æ”¯çš„æ¨¡å¼ã€‚å¼€å‘äººå‘˜ç›´æ¥æäº¤ master åˆ†æ”¯å¹¶ä½¿ç”¨å®ƒæ¥éƒ¨ç½²åˆ°é¢„å‘å¸ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200818161329729-796929090.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸ºåŸºæœ¬çš„ Git å·¥ä½œæµï¼Œæ‰€æœ‰æäº¤éƒ½ç›´æ¥æ·»åŠ åˆ° master åˆ†æ”¯ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸ä¸å»ºè®®ä½¿ç”¨æ­¤å·¥ä½œæµï¼Œé™¤éä½ æ­£åœ¨å¼€å‘ä¸€ä¸ª side é¡¹ç›®å¹¶ä¸”å¸Œæœ›å¿«é€Ÿå¼€å§‹ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºåªæœ‰ä¸€ä¸ªåˆ†æ”¯ï¼Œå› æ­¤è¿™é‡Œå®é™…ä¸Šæ²¡æœ‰ä»»ä½•æµç¨‹ã€‚è¿™æ ·ä¸€æ¥ï¼Œä½ å°±å¯ä»¥è½»æ¾å¼€å§‹ä½¿ç”¨ Gitã€‚ä½†æ˜¯ï¼Œä½¿ç”¨æ­¤å·¥ä½œæµæ—¶éœ€è¦è®°ä½å®ƒçš„ä¸€äº›ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;åœ¨ä»£ç ä¸Šè¿›è¡Œåä½œå°†å¯¼è‡´å¤šç§å†²çªã€‚&lt;/li&gt;
&lt;li&gt;ç”Ÿäº§ç¯å¢ƒå‡ºç° bug çš„æ¦‚ç‡ä¼šå¤§å¢ã€‚&lt;/li&gt;
&lt;li&gt;ç»´æŠ¤å¹²å‡€çš„ä»£ç å°†æ›´åŠ å›°éš¾ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;h2 id=&quot;2-git-åŠŸèƒ½åˆ†æ”¯å·¥ä½œæµ&quot;&gt;2. Git åŠŸèƒ½åˆ†æ”¯å·¥ä½œæµ&lt;/h2&gt;
&lt;p&gt;å½“ä½ æœ‰å¤šä¸ªå¼€å‘äººå‘˜åœ¨åŒä¸€ä¸ªä»£ç åº“ä¸Šå·¥ä½œæ—¶ï¼ŒGit åŠŸèƒ½åˆ†æ”¯å·¥ä½œæµå°†æˆä¸ºå¿…é€‰é¡¹ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾ä½ æœ‰ä¸€ä¸ªæ­£åœ¨å¼€å‘ä¸€é¡¹æ–°åŠŸèƒ½çš„å¼€å‘äººå‘˜ã€‚å¦ä¸€ä¸ªå¼€å‘äººå‘˜æ­£åœ¨å¼€å‘ç¬¬äºŒä¸ªåŠŸèƒ½ã€‚ç°åœ¨ï¼Œå¦‚æœä¸¤ä¸ªå¼€å‘äººå‘˜éƒ½å‘åŒä¸€ä¸ªåˆ†æ”¯æäº¤ä»£ç ï¼Œè¿™å°†ä½¿ä»£ç åº“é™·å…¥æ··ä¹±ï¼Œå¹¶äº§ç”Ÿå¤§é‡å†²çªã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200818161338583-1267594128.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸ºå…·æœ‰åŠŸèƒ½åˆ†æ”¯çš„ Git å·¥ä½œæµæ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œä¸¤ä¸ªå¼€å‘äººå‘˜å¯ä»¥åˆ†åˆ«ä» master åˆ†æ”¯åˆ›å»ºä¸¤ä¸ªå•ç‹¬çš„åˆ†æ”¯ï¼Œå¹¶åˆ†åˆ«å¼€å‘å…¶è´Ÿè´£çš„åŠŸèƒ½ã€‚å®ŒæˆåŠŸèƒ½åï¼Œä»–ä»¬å¯ä»¥å°†å„è‡ªçš„åˆ†æ”¯åˆå¹¶åˆ° master åˆ†æ”¯ï¼Œç„¶åè¿›è¡Œéƒ¨ç½²ï¼Œè€Œä¸å¿…ç­‰å¾…å¯¹æ–¹çš„åŠŸèƒ½å¼€å‘å®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ­¤å·¥ä½œæµçš„ä¼˜ç‚¹æ˜¯ï¼ŒGit åŠŸèƒ½åˆ†æ”¯å·¥ä½œæµä½¿ä½ å¯ä»¥åœ¨ä»£ç ä¸Šè¿›è¡Œåä½œï¼Œè€Œä¸å¿…æ‹…å¿ƒä»£ç å†²çªã€‚&lt;/p&gt;
&lt;h2 id=&quot;3-å¸¦æœ‰-develop-åˆ†æ”¯çš„-git-åŠŸèƒ½åˆ†æ”¯å·¥ä½œæµ&quot;&gt;3. å¸¦æœ‰ Develop åˆ†æ”¯çš„ Git åŠŸèƒ½åˆ†æ”¯å·¥ä½œæµ&lt;/h2&gt;
&lt;p&gt;æ­¤å·¥ä½œæµæ˜¯å¼€å‘å›¢é˜Ÿä¸­æ¯”è¾ƒæµè¡Œçš„å·¥ä½œæµä¹‹ä¸€ã€‚å®ƒä¸ Git åŠŸèƒ½åˆ†æ”¯å·¥ä½œæµç›¸ä¼¼ï¼Œä½†å®ƒçš„ develop åˆ†æ”¯ä¸ master åˆ†æ”¯å¹¶è¡Œå­˜åœ¨ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤å·¥ä½œæµä¸­ï¼Œmaster åˆ†æ”¯å§‹ç»ˆä»£è¡¨ç”Ÿäº§ç¯å¢ƒçš„çŠ¶æ€ã€‚æ¯å½“å›¢é˜Ÿæƒ³è¦éƒ¨ç½²ä»£ç åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œä»–ä»¬éƒ½ä¼šéƒ¨ç½² master åˆ†æ”¯ã€‚&lt;/p&gt;
&lt;p&gt;Develop åˆ†æ”¯ä»£è¡¨é’ˆå¯¹ä¸‹ä¸€ç‰ˆæœ¬çš„æœ€æ–°äº¤ä»˜çš„ä»£ç ã€‚å¼€å‘äººå‘˜ä» develop åˆ†æ”¯åˆ›å»ºæ–°åˆ†æ”¯ï¼Œå¹¶å¼€å‘æ–°åŠŸèƒ½ã€‚åŠŸèƒ½å¼€å‘å®Œæ¯•åï¼Œå°†å¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼Œä¸ develop åˆ†æ”¯åˆå¹¶ï¼Œåœ¨åˆå¹¶äº†å…¶ä»–åŠŸèƒ½åˆ†æ”¯çš„æƒ…å†µä¸‹ä½¿ç”¨ develop åˆ†æ”¯çš„ä»£ç è¿›è¡Œæµ‹è¯•ï¼Œç„¶åä¸ master åˆ†æ”¯åˆå¹¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200818161349949-489956003.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸ºå…·æœ‰ develop åˆ†æ”¯çš„ Git åŠŸèƒ½åˆ†æ”¯å·¥ä½œæµæ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å·¥ä½œæµçš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒä½¿å›¢é˜Ÿèƒ½å¤Ÿä¸€è‡´åœ°åˆå¹¶æ‰€æœ‰æ–°åŠŸèƒ½ï¼Œåœ¨é¢„å‘å¸ƒé˜¶æ®µå¯¹å…¶è¿›è¡Œæµ‹è¯•å¹¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚å°½ç®¡è¿™ç§å·¥ä½œæµè®©ä»£ç ç»´æŠ¤å˜å¾—æ›´åŠ å®¹æ˜“ï¼Œä½†æ˜¯å¯¹äºæŸäº›å›¢é˜Ÿæ¥è¯´ï¼Œè¿™æ ·åšå¯èƒ½ä¼šæ„Ÿåˆ°æœ‰äº›ç–²å€¦ï¼Œå› ä¸ºé¢‘ç¹çš„ Git æ“ä½œå¯èƒ½ä¼šè®©ä½ æ„Ÿåˆ°ä¹å‘³ã€‚&lt;/p&gt;
&lt;h2 id=&quot;4-gitflow-å·¥ä½œæµ&quot;&gt;4. Gitflow å·¥ä½œæµ&lt;/h2&gt;
&lt;p&gt;Gitflow å·¥ä½œæµä¸æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„å·¥ä½œæµéå¸¸ç›¸ä¼¼ï¼Œæˆ‘ä»¬å°†å®ƒä»¬ä¸å…¶ä»–ä¸¤ä¸ªåˆ†æ”¯ï¼ˆ release åˆ†æ”¯å’Œ hot-fix åˆ†æ”¯ï¼‰ç»“åˆä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&quot;41-hot-fix-åˆ†æ”¯&quot;&gt;4.1 Hot-Fix åˆ†æ”¯&lt;/h3&gt;
&lt;p&gt;Hot-fix åˆ†æ”¯æ˜¯å”¯ä¸€ä¸€ä¸ªä» master åˆ†æ”¯åˆ›å»ºçš„åˆ†æ”¯ï¼Œå¹¶ä¸”ç›´æ¥åˆå¹¶åˆ° master åˆ†æ”¯è€Œä¸æ˜¯ develop åˆ†æ”¯ã€‚ä»…åœ¨å¿…é¡»å¿«é€Ÿä¿®å¤ç”Ÿäº§ç¯å¢ƒé—®é¢˜æ—¶ä½¿ç”¨ã€‚è¯¥åˆ†æ”¯çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œå®ƒä½¿ä½ å¯ä»¥å¿«é€Ÿä¿®å¤å¹¶éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒçš„é—®é¢˜ï¼Œè€Œæ— éœ€ä¸­æ–­å…¶ä»–äººçš„å·¥ä½œæµï¼Œä¹Ÿä¸å¿…ç­‰å¾…ä¸‹ä¸€ä¸ªå‘å¸ƒå‘¨æœŸã€‚&lt;/p&gt;
&lt;p&gt;å°†ä¿®å¤åˆå¹¶åˆ° master åˆ†æ”¯å¹¶è¿›è¡Œéƒ¨ç½²åï¼Œåº”å°†å…¶åˆå¹¶åˆ° develop å’Œå½“å‰çš„ release åˆ†æ”¯ä¸­ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†ç¡®ä¿ä»»ä½•ä» develop åˆ†æ”¯åˆ›å»ºæ–°åŠŸèƒ½åˆ†æ”¯çš„äººéƒ½å…·æœ‰æœ€æ–°ä»£ç ã€‚&lt;/p&gt;
&lt;h3 id=&quot;42-release-åˆ†æ”¯&quot;&gt;4.2 Release åˆ†æ”¯&lt;/h3&gt;
&lt;p&gt;åœ¨å°†æ‰€æœ‰å‡†å¤‡å‘å¸ƒçš„åŠŸèƒ½çš„ä»£ç æˆåŠŸåˆå¹¶åˆ° develop åˆ†æ”¯ä¹‹åï¼Œå°±å¯ä»¥ä» develop åˆ†æ”¯åˆ›å»º release åˆ†æ”¯äº†ã€‚&lt;/p&gt;
&lt;p&gt;Release åˆ†æ”¯ä¸åŒ…å«æ–°åŠŸèƒ½ç›¸å…³çš„ä»£ç ã€‚ä»…å°†ä¸å‘å¸ƒç›¸å…³çš„ä»£ç æ·»åŠ åˆ° release åˆ†æ”¯ã€‚ä¾‹å¦‚ï¼Œä¸æ­¤ç‰ˆæœ¬ç›¸å…³çš„æ–‡æ¡£ï¼Œé”™è¯¯ä¿®å¤å’Œå…¶ä»–å…³è”ä»»åŠ¡æ‰èƒ½æ·»åŠ åˆ°æ­¤åˆ†æ”¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦å°†æ­¤åˆ†æ”¯ä¸ master åˆ†æ”¯åˆå¹¶å¹¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒåï¼Œå®ƒä¹Ÿå°†è¢«åˆå¹¶å› develop åˆ†æ”¯ä¸­ï¼Œä»¥ä¾¿ä¹‹åä» develop åˆ†æ”¯åˆ›å»ºæ–°åŠŸèƒ½åˆ†æ”¯æ—¶ï¼Œæ–°çš„åˆ†æ”¯èƒ½å¤Ÿå…·æœ‰æœ€æ–°ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200818161400164-1833173904.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸ºå…·æœ‰ hot-fix å’Œ release åˆ†æ”¯çš„ Gitflow å·¥ä½œæµæ¨¡å‹&lt;/p&gt;
&lt;p&gt;æ­¤å·¥ä½œæµç”± &lt;a href=&quot;http://nvie.com/posts/a-successful-git-branching-model/&quot;&gt;Vincent Driessen&lt;/a&gt; é¦–æ¬¡å‘å¸ƒå¹¶å¹¿å—æ¬¢è¿ï¼Œå·²è¢«å…·æœ‰é¢„å®šå‘å¸ƒå‘¨æœŸçš„ç»„ç»‡å¹¿æ³›ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äº git-flow æ˜¯å¯¹ Git çš„åŒ…è£…ï¼Œå› æ­¤ä½ å¯ä»¥ä¸ºå½“å‰ä»£ç åº“å®‰è£… git-flowã€‚git-flow éå¸¸ç®€å•ï¼Œé™¤äº†ä¸ºä½ åˆ›å»ºåˆ†æ”¯å¤–ï¼Œå®ƒä¸ä¼šæ›´æ”¹ä»£ç åº“ä¸­çš„ä»»ä½•å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;è¦åœ¨ Mac æœºå™¨ä¸Šå®‰è£… ï¼Œè¯·åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œ &lt;code&gt;brew install git-flow&lt;/code&gt; ã€‚&lt;/p&gt;
&lt;p&gt;è¦åœ¨ Windows æœºå™¨ä¸Šå®‰è£…ï¼Œä½ éœ€è¦ &lt;a href=&quot;https://git-scm.com/download/win&quot;&gt;ä¸‹è½½å¹¶å®‰è£… git-flow&lt;/a&gt; ã€‚å®‰è£…å®Œæˆåï¼Œè¿è¡Œ &lt;code&gt;git flow init&lt;/code&gt; å‘½ä»¤ï¼Œå°±å¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å®ƒäº†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;5-git-fork-å·¥ä½œæµ&quot;&gt;5. Git Fork å·¥ä½œæµ&lt;/h2&gt;
&lt;p&gt;Fork å·¥ä½œæµåœ¨ä½¿ç”¨å¼€æºè½¯ä»¶çš„å›¢é˜Ÿä¸­å¾ˆæµè¡Œã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æµç¨‹é€šå¸¸å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;å¼€å‘äººå‘˜ fork å¼€æºè½¯ä»¶çš„å®˜æ–¹ä»£ç åº“ã€‚åœ¨ä»–ä»¬çš„å¸æˆ·ä¸­åˆ›å»ºæ­¤ä»£ç åº“çš„å‰¯æœ¬ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åï¼Œå¼€å‘äººå‘˜å°†ä»£ç åº“ä»å…¶å¸æˆ·å…‹éš†åˆ°æœ¬åœ°ç³»ç»Ÿã€‚&lt;/li&gt;
&lt;li&gt;å®˜æ–¹ä»£ç åº“çš„è¿œç«¯æºå·²æ·»åŠ åˆ°å…‹éš†åˆ°æœ¬åœ°ç³»ç»Ÿçš„ä»£ç åº“ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å¼€å‘äººå‘˜åˆ›å»ºä¸€ä¸ªæ–°çš„åŠŸèƒ½åˆ†æ”¯ï¼Œè¯¥åˆ†æ”¯å°†åœ¨å…¶æœ¬åœ°ç³»ç»Ÿä¸­åˆ›å»ºï¼Œè¿›è¡Œæ›´æ”¹å¹¶æäº¤ã€‚&lt;/li&gt;
&lt;li&gt;è¿™äº›æ›´æ”¹ä»¥åŠåˆ†æ”¯å°†è¢«æ¨é€åˆ°å…¶å¸æˆ·ä¸Šå¼€å‘äººå‘˜çš„ä»£ç åº“å‰¯æœ¬ã€‚&lt;/li&gt;
&lt;li&gt;ä»è¯¥æ–°åŠŸèƒ½åˆ†æ”¯åˆ›å»ºä¸€ä¸ª pull requestï¼Œæäº¤åˆ°å®˜æ–¹ä»£ç åº“ã€‚&lt;/li&gt;
&lt;li&gt;å®˜æ–¹ä»£ç åº“çš„ç»´æŠ¤è€…æ£€æŸ¥ pull request ä¸­çš„ä¿®æ”¹å¹¶æ‰¹å‡†å°†è¿™äº›ä¿®æ”¹åˆå¹¶åˆ°å®˜æ–¹ä»£ç åº“ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;h2 id=&quot;ä½ è‡ªå·±çš„å·¥ä½œæµï¼&quot;&gt;ä½ è‡ªå·±çš„å·¥ä½œæµï¼&lt;/h2&gt;
&lt;p&gt;æˆ‘åœ¨æœ¬æ–‡ä¸­æè¿°çš„ Git å·¥ä½œæµæ˜¯ä¸€äº›åœ¨å¼€å‘å›¢é˜Ÿä¸­éå¸¸æµè¡Œå’Œæœ€ä½³çš„å·¥ä½œæµçš„ç¤ºä¾‹ã€‚ä¹Ÿæœ‰ä¸€äº›å›¢é˜Ÿä¸ºé¢„å‘å¸ƒåˆ›å»ºåˆ†æ”¯ï¼Œå¹¶ä¸”è¯¥åˆ†æ”¯éå¸¸é€‚åˆä»–ä»¬ã€‚æ‰€ä»¥ä½ å¯ä»¥å‚è€ƒè¿™äº›å·¥ä½œæµï¼Œç„¶ååˆ›å»ºè‡ªå·±çš„ Git å·¥ä½œæµã€‚&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;æœ¬æ–‡ä½¿ç”¨å…è´¹æ–‡æ¡£ç¿»è¯‘å·¥å…· &lt;strong&gt;Breword&lt;/strong&gt; è¿›è¡Œç¿»è¯‘ï¼Œå®ƒæ”¯æŒï¼šæœºå™¨é¢„ç¿»è¯‘ã€å¯è§†åŒ–ç¼–è¾‘å™¨ã€åä½œç¿»è¯‘ã€å®¡æ ¡ã€ä¸€é”®ç”Ÿæˆæ–‡æ¡£ç½‘ç«™ã€è‡ªåŠ¨ç›‘æµ‹æ–‡æ¡£æ›´æ–°ã€å¯¼å‡ºç­‰ã€‚è®©ç¿»è¯‘å·¥ä½œå˜å¾—æ›´åŠ ç®€å•ã€é«˜æ•ˆã€å¯ç»´æŠ¤ï¼Œå¿«å»è¯•è¯•å§ï¼&lt;/p&gt;
&lt;blockquote readability=&quot;2.0731707317073&quot;&gt;
&lt;p&gt;breword å®˜ç½‘ï¼š&lt;a href=&quot;https://www.breword.com/&quot;&gt;https://www.breword.com/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr/&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200810143823578-1303441549.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ç¿»è¯‘å¼€æºé¡¹ç›®æ–‡æ¡£ã€æ–‡ç« éƒ½æ˜¯ä¸ºå¼€æºç¤¾åŒºåšè´¡çŒ®ï¼ˆé¢˜æï¼šGitHubã€ç¼–ç¨‹ã€ç¨‹åºå‘˜ï¼‰â€‹ï¼Œæ¬¢è¿çƒ­çˆ±æŠ€æœ¯å’Œå¼€æºçš„å°ä¼™ä¼´åŠ å…¥ HG æ¨å‡ºçš„è¯‘æ–‡äº¦èˆç³»åˆ—çš„ç¿»è¯‘ä¸­æ¥ï¼Œå¯æ·»åŠ å¾®ä¿¡å·ï¼šHelloGitHubï¼ˆå¤‡æ³¨ï¼šç¿»è¯‘ï¼‰ã€‚&lt;/p&gt;
</description>
<pubDate>Fri, 21 Aug 2020 00:34:00 +0000</pubDate>
<dc:creator>å‰Šå¾®å¯’</dc:creator>
<og:description>åŸæ–‡åœ°å€ï¼š5 Git workflows you can use to deliver better code and improve your development process åŸæ–‡ä½œè€…ï¼šVi</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/xueweihan/p/13524162.html</dc:identifier>
</item>
<item>
<title>æ‰“ç ´å›½å¤–å„æ–­ï¼Œå¼€å‘ä¸­å›½äººè‡ªå·±çš„ç¼–ç¨‹è¯­è¨€ï¼ˆ2ï¼‰ï¼šä½¿ç”¨ç›‘å¬å™¨å®ç°è®¡ç®—å™¨ - é“¶æ²³ä½¿è€…</title>
<link>http://www.cnblogs.com/nokiaguy/p/13539090.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/nokiaguy/p/13539090.html</guid>
<description>&lt;p&gt;æœ¬æ–‡è¯¦ç»†è®²è§£å¦‚ä½•ç”¨Listeneræ–¹å¼å®ç°ä¸€ä¸ªå¯ä»¥è®¡ç®—è¡¨è¾¾å¼çš„ç¨‹åºï¼Œè¯¥ç¨‹åºä¸ä»…å¯ä»¥è®¡ç®—è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥è¯†åˆ«è¡¨è¾¾å¼çš„é”™è¯¯ï¼Œå¦‚æœæŸä¸€ä¸ªè¡¨è¾¾å¼å‡ºé”™ï¼Œé‚£ä¹ˆè¯¥è¡¨è¾¾å¼ä¸ä¼šè¾“å‡ºä»»ä½•ç»“æœã€‚&lt;/p&gt;&lt;div id=&quot;cnblogs_post_body&quot; readability=&quot;113.66656667167&quot;&gt;
&lt;p&gt;ä¸Šä¸€ç¯‡ï¼š&lt;a href=&quot;https://www.cnblogs.com/nokiaguy/p/13385386.html&quot; target=&quot;_blank&quot;&gt;å®ç°å¯ä»¥è§£æè¡¨è¾¾å¼çš„è®¡ç®—å™¨&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;br/&gt;æœ¬æ–‡å·²ç»åŒæ­¥åˆ°å…¬ä¼—å·ã€Œ&lt;span&gt;æå®¢èµ·æº&lt;/span&gt;ã€ï¼Œè¾“å…¥&lt;span&gt;379404&lt;/span&gt;å¼€å§‹å­¦ä¹ ï¼&lt;/p&gt;

&lt;p&gt;æœ¬æ–‡æ˜¯&lt;span&gt;ã€Šæ‰“ç ´å›½å¤–å„æ–­ï¼Œå¼€å‘ä¸­å›½äººè‡ªå·±çš„ç¼–ç¨‹è¯­è¨€ã€‹&lt;/span&gt;ç³»åˆ—æ–‡ç« çš„ç¬¬1ç¯‡ã€‚æœ¬ç³»åˆ—æ–‡ç« çš„ä¸»è¦ç›®çš„æ˜¯æ•™å¤§å®¶å­¦ä¼šå¦‚ä½•ä»é›¶å¼€å§‹è®¾è®¡ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼ˆmarvelè¯­è¨€ï¼‰ï¼Œå¹¶ä½¿ç”¨marvelè¯­è¨€å¼€å‘ä¸€äº›çœŸå®çš„é¡¹ç›®ï¼Œå¦‚ç§»åŠ¨Appã€Webåº”ç”¨ç­‰ã€‚marvelè¯­è¨€å¯ä»¥é€šè¿‡ä¸‹é¢3ç§æ–¹å¼è¿è¡Œï¼š&lt;/p&gt;
&lt;p&gt;1. è§£é‡Šæ‰§è¡Œ&lt;/p&gt;
&lt;p&gt;2. ç¼–è¯‘æˆJava Bytecodeï¼Œåˆ©ç”¨JVMæ‰§è¡Œ&lt;/p&gt;
&lt;p&gt;3. ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæœ¬åœ°æ‰§è¡Œï¼ˆåŸºäºLLVMï¼‰&lt;/p&gt;

&lt;div readability=&quot;99.5&quot;&gt;
&lt;p&gt;æœ¬æ–‡è¯¦ç»†è®²è§£å¦‚ä½•ç”¨Listeneræ–¹å¼å®ç°ä¸€ä¸ªå¯ä»¥è®¡ç®—è¡¨è¾¾å¼çš„ç¨‹åºï¼Œè¯¥ç¨‹åºä¸ä»…å¯ä»¥è®¡ç®—è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥è¯†åˆ«è¡¨è¾¾å¼çš„é”™è¯¯ï¼Œå¦‚æœæŸä¸€ä¸ªè¡¨è¾¾å¼å‡ºé”™ï¼Œé‚£ä¹ˆè¯¥è¡¨è¾¾å¼ä¸ä¼šè¾“å‡ºä»»ä½•ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. Visitorä¸Listener&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä½¿ç”¨Antlrå’ŒVisitorå®ç°äº†ä¸€ä¸ªå¯ä»¥è®¡ç®—è¡¨è¾¾å¼çš„ç¨‹åºMarvelCalcã€‚è¿™ä¸ªç¨‹åºéå¸¸ç®€å•ï¼Œç›¸å½“äºAntlrçš„HelloWorldã€‚ä¸è¿‡Antlré™¤äº†Visitoræ–¹å¼å¤–ï¼Œè¿˜æ”¯æŒListeneræ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ç›‘å¬å™¨æ–¹å¼ã€‚ä¸ç®¡æ˜¯å“ªç§æ–¹å¼ï¼Œå…¶ç›®çš„éƒ½æ˜¯éå†ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œåªæ˜¯Visitoræ–¹å¼éœ€è¦æ˜¾å¼è®¿é—®å­èŠ‚ç‚¹ï¼ˆé€šè¿‡visitæ–¹æ³•è®¿é—®ï¼‰ï¼Œä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç è®¿é—®äº†MulDivçš„ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯MulDivçš„å·¦å³æ“ä½œæ•°ï¼ˆctx.expr(0)å’Œctx.expr(1)ï¼‰ã€‚&lt;/p&gt;
&lt;div readability=&quot;7.5&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;//&lt;/span&gt;&lt;span&gt; expr op=('*'|'/') expr      # MulDiv&lt;/span&gt;
&lt;span&gt;public&lt;/span&gt;&lt;span&gt; Integer visitMulDiv(CalcParser.MulDivContext ctx) {

    &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; left = visit(ctx.expr(0));          &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è®¿é—®MulDivçš„å·¦æ“ä½œæ•°&lt;/span&gt;
    &lt;span&gt;int&lt;/span&gt; right = visit(ctx.expr(1));         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è®¿é—®MulDivçš„å³æ“ä½œæ•°&lt;/span&gt;

    &lt;span&gt;if&lt;/span&gt; ( ctx.op.getType() == CalcParser.MUL ) &lt;span&gt;return&lt;/span&gt; left *&lt;span&gt; right;
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; left /&lt;span&gt; right; 
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;è€ŒListeneræ–¹å¼æ˜¯ç”±ç³»ç»Ÿè‡ªåŠ¨è®¿é—®å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„ï¼Œå¹¶ä¸éœ€è¦æ˜¾å¼è®¿é—®å­èŠ‚ç‚¹ã€‚è€Œä¸”Listenerå¯ä»¥æ‹¦æˆªå½“å‰èŠ‚ç‚¹çš„å¼€å§‹å¤„ç†å’Œç»“æŸå¤„ç†åŠ¨ä½œã€‚å¼€å§‹å¤„ç†åŠ¨ä½œçš„äº‹ä»¶æ–¹æ³•ä»¥enterå¼€å¤´ï¼Œç»“æŸå¤„ç†åŠ¨ä½œçš„äº‹ä»¶æ–¹æ³•ä»¥exitå¼€å¤´ã€‚ä¾‹å¦‚ï¼Œå¤„ç†MulDivåŠ¨ä½œæ—¶ï¼Œä¼šç”Ÿæˆä¸¤ä¸ªäº‹ä»¶æ–¹æ³•ï¼šenterMulDivå’ŒexitMulDivï¼Œåˆ†åˆ«è¡¨ç¤ºå¼€å§‹å¤„ç†MulDivå’Œç»“æŸå¤„ç†MulDivï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div readability=&quot;11.5&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;@Override 
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; enterMulDiv(CalcParser.MulDivContext ctx) {
}
@Override 
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitMulDiv(CalcParser.MulDivContext ctx) {
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

Â é‚£ä¹ˆå¼€å§‹å¤„ç†åŠ¨ä½œå’Œç»“æŸå¤„ç†åŠ¨ä½œæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿå¦‚æœæ˜¯åŸå­è¡¨è¾¾å¼ï¼ˆå†…éƒ¨ä¸åŒ…å«å…¶ä»–è¡¨è¾¾å¼çš„è¡¨è¾¾å¼ï¼‰ï¼Œå¦‚idã€æ•°å€¼ç­‰ï¼Œè¿™ä¸¤ä¸ªäº‹ä»¶æ–¹æ³•æ²¡ä»€ä¹ˆä¸åŒçš„ï¼ˆç”¨å“ªä¸€ä¸ªå¤„ç†è¡¨è¾¾å¼éƒ½å¯ä»¥ï¼‰ã€‚ä½†å¦‚æœæ˜¯éåŸå­è¡¨è¾¾å¼ï¼Œå°±è¦è€ƒè™‘ä¸‹ä½¿ç”¨enterè¿˜æ˜¯exitäº†ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¡¨è¾¾å¼ï¼š&lt;/div&gt;

&lt;div id=&quot;1860-1597842392848&quot; data-theme=&quot;default&quot; data-language=&quot;javascript&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
3 * (20 / x * 43)
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;è¿™ä¸ªè¡¨è¾¾å¼æ˜æ˜¾æ˜¯éåŸå­çš„ã€‚ç¼–è¯‘å™¨ä¼šä»å·¦å‘å³æ‰«ææ•´ä¸ªè¡¨è¾¾å¼ï¼Œå½“æ‰«æåˆ°ç¬¬ä¸€ä¸ªä¹˜å·ï¼ˆ*ï¼‰æ—¶ï¼Œä¼šå°†å³ä¾§çš„æ‰€æœ‰å†…å®¹ï¼ˆ20 / x * 43ï¼‰å½“åšä¸€ä¸ªæ•´ä½“å¤„ç†ï¼Œè¿™å°±ä¼šç¬¬ä¸€æ¬¡è°ƒç”¨enterMulDivæ–¹æ³•å’ŒexitMulDivæ–¹æ³•ã€‚åªä¸è¿‡åœ¨è°ƒç”¨enterMulDivæ–¹æ³•åï¼Œè¿˜ä¼šåšå¾ˆå¤šå…¶ä»–çš„å·¥ä½œï¼Œæœ€åæ‰ä¼šè°ƒç”¨exitMulDivæ–¹æ³•ã€‚é‚£ä¹ˆä¸­é—´è¦åšä»€ä¹ˆå·¥ä½œå‘¢ï¼Ÿå½“ç„¶æ˜¯å¤„ç†è¡¨è¾¾å¼(20 / x * 43)äº†ã€‚ç”±äºè¿™ä¸ªè¡¨è¾¾å¼ä¸­æœ‰ä¸€ä¸ªå˜é‡xï¼Œæ‰€ä»¥åœ¨æ‰«æåˆ°xæ—¶ï¼Œéœ€è¦æœç´¢è¯¥å˜é‡æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œéœ€è¦æå–è¯¥å˜é‡çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨enterMulDivæ–¹æ³•æ—¶è¿˜æ²¡æœ‰å¤„ç†è¿™ä¸ªå˜é‡xï¼Œå¦‚æœåœ¨enterMulDivæ–¹æ³•ä¸­è¦è®¡ç®—æ•´ä¸ªè¡¨è¾¾å¼çš„å€¼æ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ï¼ˆå› ä¸ºxçš„å€¼è¿˜æ²¡æœ‰ç¡®å®šï¼‰ï¼Œæ‰€ä»¥æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯åœ¨exitMulDivæ–¹æ³•ä¸­è®¡ç®—æ•´ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œå› ä¸ºåœ¨è¯¥æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œæ•´ä¸ªè¡¨è¾¾å¼çš„æ¯ä¸€ä¸ªå­è¡¨è¾¾å¼çš„å€¼éƒ½å·²ç»è®¡ç®—å®Œäº†ã€‚&lt;/p&gt;

&lt;p&gt;enterXxxå’ŒexitXxxæ–¹æ³•ä¹Ÿç»å¸¸è¢«ç”¨äºå¤„ç†ä½œç”¨åŸŸï¼Œä¾‹å¦‚ï¼Œåœ¨æ‰«æåˆ°ä¸‹é¢çš„å‡½æ•°æ—¶ï¼Œ åœ¨è¯¥å‡½æ•°å¯¹åº”çš„enterXxxæ–¹æ³•ä¸­ä¼šå°†å½“å‰ä½œç”¨åŸŸåˆ‡æ¢åˆ°myfunå‡½æ•°ï¼ˆé€šå¸¸ç”¨Stackå¤„ç†ï¼‰ï¼Œè€Œåœ¨exitXxxæ–¹æ³•ä¸­ï¼Œä¼šæ¢å¤myfunå‡½æ•°çš„parentä½œç”¨åŸŸã€‚ç±»ã€æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥ä¹ŸåŒæ ·æ¶‰åŠåˆ°ä½œç”¨åŸŸçš„é—®é¢˜ã€‚å…³äºä½œç”¨åŸŸçš„é—®é¢˜ï¼Œåœ¨åé¢çš„æ–‡ç« ä¸­ä¼šè¯¦ç»†ä»‹ç»ä½œç”¨åŸŸçš„å®ç°æ–¹æ³•ã€‚&lt;/p&gt;
&lt;div id=&quot;6328-1597842980528&quot; data-theme=&quot;default&quot; data-language=&quot;javascript&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot;&gt;
&lt;pre&gt;
&lt;span&gt;void&lt;/span&gt;&lt;span&gt; myfun() {
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;p&gt;ä»å‰é¢çš„ä»‹ç»å¯çŸ¥ï¼ŒListeneræ¯”Visitoræ›´çµæ´»ï¼ŒListenerä¹Ÿæ˜¯æˆ‘æ¨èçš„éå†ASTçš„æ–¹å¼ï¼Œåé¢çš„æ–‡ç« ä¹ŸåŸºæœ¬ä¸Šä½¿ç”¨Listenerçš„æ–¹å¼å®ç°ç¼–è¯‘å™¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;2. Listenerå¯¹åº”çš„æ¥å£å’ŒåŸºç±»&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç°åœ¨å›åˆ°æœ¬æ–‡çš„ä¸»é¢˜ä¸Šæ¥ï¼Œæœ¬æ–‡çš„ç›®çš„æ˜¯ä½¿ç”¨Listenerçš„æ–¹å¼å–ä»£Visitorçš„æ–¹å¼å®ç°è®¡ç®—å™¨ã€‚åœ¨ç¼–è¯‘Calc.g4æ—¶ï¼Œé™¤äº†ç”ŸæˆCalcVisitor.javaå’ŒCalcBaseVisitor.javaï¼Œè¿˜ç”Ÿæˆäº†å¦å¤–ä¸¤ä¸ªæ–‡ä»¶ï¼šCalcListener.javaå’ŒCalcBaseListener.javaã€‚å…¶ä¸­CalcListener.javaæ–‡ä»¶æ˜¯Listenerçš„æ¥å£æ–‡ä»¶ï¼Œæ¥å£ä¸­çš„æ–¹æ³•ä¼šæ ¹æ®Calc.g4æ–‡ä»¶ä¸­çš„äº§ç”Ÿå¼ç”Ÿæˆï¼Œè¯¥æ–‡ä»¶çš„ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;div id=&quot;8053-1597844239205&quot; data-theme=&quot;default&quot; data-language=&quot;javascript&quot; readability=&quot;7.5&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.antlr.v4.runtime.tree.ParseTreeListener;
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;interface&lt;/span&gt; CalcListener &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; ParseTreeListener {
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; enterProg(CalcParser.ProgContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitProg(CalcParser.ProgContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; enterPrintExpr(CalcParser.PrintExprContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitPrintExpr(CalcParser.PrintExprContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; enterAssign(CalcParser.AssignContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitAssign(CalcParser.AssignContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; enterBlank(CalcParser.BlankContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitBlank(CalcParser.BlankContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; enterParens(CalcParser.ParensContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitParens(CalcParser.ParensContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; enterMulDiv(CalcParser.MulDivContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitMulDiv(CalcParser.MulDivContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; enterAddSub(CalcParser.AddSubContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitAddSub(CalcParser.AddSubContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; enterId(CalcParser.IdContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitId(CalcParser.IdContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; enterInt(CalcParser.IntContext ctx);
    &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitInt(CalcParser.IntContext ctx);
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;p&gt;é€šå¸¸æ¥è®²ï¼Œå¹¶ä¸éœ€è¦å®ç°CalcListeneræ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œæ‰€ä»¥antlrè¿˜ä¸ºæˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªé»˜è®¤å®ç°ç±»CalcBaseListenerï¼Œè¯¥ç±»ä½äºCalcBaseListener.javaæ–‡ä»¶ä¸­ã€‚CalcListeneræ¥å£çš„æ¯ä¸€ä¸ªæ–¹æ³•éƒ½åœ¨CalcBaseListenerç±»ä¸­æä¾›äº†ä¸€ä¸ªç©ºå®ç°ï¼Œæ‰€ä»¥ä½¿ç”¨Listeneræ–¹å¼éå†ASTï¼Œåªéœ€è¦ä»CalcBaseListenerç±»ç»§æ‰¿ï¼Œå¹¶ä¸”è¦†ç›–å¿…è¦çš„æ–¹æ³•å³å¯ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;3. ç”¨Listeneræ–¹å¼å®ç°å¯è®¡ç®—å™¨&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç°åœ¨åˆ›å»ºä¸€ä¸ªMyCalcParser.javaæ–‡ä»¶ï¼Œå¹¶åœ¨è¯¥æ–‡ä»¶ä¸­ç¼–å†™ä¸€ä¸ªåä¸ºMyCalcParserçš„ç©ºç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div id=&quot;1465-1597844698682&quot; data-theme=&quot;default&quot; data-language=&quot;javascript&quot; readability=&quot;6&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; MyCalcParser  &lt;span&gt;extends&lt;/span&gt;&lt;span&gt;  CalcBaseListener{
    ... ...
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;p&gt;ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œåœ¨MyCalcParserç±»ä¸­åˆ°åº•è¦è¦†ç›–CalcBaseListenerä¸­çš„å“ªä¸€ä¸ªæ–¹æ³•ï¼Œè€Œä¸”å¦‚ä½•å®ç°è¿™äº›æ–¹æ³•å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå°±è¦å…ˆåˆ†æä¸€ä¸‹ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ç¼–å†™çš„EvalVisitorç±»çš„ä»£ç äº†ã€‚å…¶å®åœ¨EvalVisitorä¸­è¦†ç›–äº†å“ªä¸€ä¸ªåŠ¨ä½œå¯¹åº”çš„æ–¹æ³•ï¼Œåœ¨MyCalcParserç±»ä¸­ä¹ŸåŒæ ·éœ€è¦è¦†ç›–è¯¥åŠ¨ä½œå¯¹åº”çš„æ–¹æ³•ï¼ŒåŒºåˆ«åªæ˜¯ä½¿ç”¨enterXxxï¼Œè¿˜æ˜¯ä½¿ç”¨exitXxxï¼Œæˆ–æ˜¯éƒ½ä½¿ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;ç°åœ¨å°†EvalVisitorç±»çš„å…³é”®ç‚¹æå‡ºæ¥ï¼š&lt;/p&gt;
&lt;p&gt;ï¼ˆ1ï¼‰ åœ¨EvalVisitorç±»ä¸­æœ‰ä¸€ä¸ªåä¸ºmemoryçš„Mapå¯¹è±¡ï¼Œç”¨æ¥ä¿å­˜å˜é‡çš„å€¼ï¼Œè¿™åœ¨Listenerä¸­åŒæ ·éœ€è¦ï¼›&lt;/p&gt;
&lt;p&gt;ï¼ˆ2ï¼‰åœ¨EvalVisitorç±»ä¸­æœ‰ä¸€ä¸ªerrorå˜é‡ï¼Œç”¨æ¥æ ‡è¯†åˆ†æçš„è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰é”™è¯¯ï¼Œåœ¨Listenerä¸­åŒæ ·éœ€è¦ï¼›&lt;/p&gt;
&lt;p&gt;ï¼ˆ3ï¼‰æ¯ä¸€ä¸ªvisitXxxæ–¹æ³•éƒ½æœ‰è¿”å›å€¼ï¼Œå…¶å®è¿™ä¸ªè¿”å›å€¼æ˜¯å‘ä¸Šä¸€å±‚èŠ‚ç‚¹ä¼ é€’çš„å€¼ã€‚è€ŒListenerä¸­çš„æ–¹æ³•å¹¶æ²¡æœ‰è¿”å›å€¼ï¼Œä½†ä»ç„¶éœ€è¦å°†å€¼å‘ä¸Šä¸€å±‚èŠ‚ç‚¹ä¼ é€’ï¼Œæ‰€ä»¥éœ€è¦æƒ³å…¶ä»–çš„æ–¹å¼å®ç°å‘ä¸Šä¼ å€¼ï¼›&lt;/p&gt;


&lt;p&gt;é‚£ä¹ˆä¸ºä»€ä¹ˆè¦å‘ä¸Šä¼ å€¼å‘¢ï¼Ÿå…ˆæ¥ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œçœ‹ä¸‹é¢çš„è¡¨è¾¾å¼ï¼š&lt;/p&gt;



&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªä¹˜æ³•è¡¨è¾¾å¼ï¼Œç¼–è¯‘å™¨å¯¹è¿™ä¸ªè¡¨è¾¾å¼æ‰«ææ—¶ï¼Œä¼šå…ˆè¯†åˆ«ä¸¤ä¸ªæ•´æ•°ï¼ˆ4å’Œ5ï¼‰ï¼Œè¿™ä¸¤ä¸ªæ•´æ•°æ˜¯ä¸¤ä¸ªåŸå­è¡¨è¾¾å¼ã€‚å¦‚æœä½¿ç”¨Listenerçš„æ–¹å¼ï¼Œéœ€è¦åœ¨è¿™ä¸¤ä¸ªæ•´æ•°å¯¹åº”çš„enterIntæ–¹æ³•ï¼ˆexitIntæ–¹æ³•ä¹Ÿå¯ä»¥ï¼‰ä¸­å°†'4'å’Œ'5'è½¬æ¢ä¸ºæ•´æ•°ï¼Œè¿™æ˜¯å› ä¸ºä¸ç®¡å€¼æ˜¯ä»€ä¹ˆç±»å‹ï¼Œç¼–è¯‘å™¨è¯»ä¸Šæ¥çš„éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œç±»å‹è½¬æ¢ã€‚&lt;/p&gt;

&lt;p&gt;åŒ…å«4å’Œ5çš„è¡¨è¾¾å¼æ˜¯MulDivï¼Œå¯¹åº”çš„åŠ¨ä½œæ–¹æ³•æ˜¯exitMulDivï¼ˆä¸èƒ½ç”¨enterMulDivï¼Œå› ä¸ºè¿™æ—¶4å’Œ5è¿˜æ²¡æœ‰æ‰«æåˆ°ï¼‰ã€‚åœ¨exitMulDivæ–¹æ³•ä¸­è¦è·å–ä¹˜å·ï¼ˆ*ï¼‰å·¦å³ä¸¤ä¸ªæ“ä½œæ•°çš„å€¼ï¼ˆctx.expr(0)å’Œctx.expr(1)ï¼‰ã€‚è€Œè¿™ä¸¤ä¸ªæ“ä½œæ•°çš„å€¼åœ¨enterIntæ–¹æ³•ä¸­å·²ç»è·å–äº†ï¼Œæˆ‘ä»¬è¦åšçš„åªæ˜¯å°†è·å–çš„å€¼ä¼ é€’ç»™ä¸Šä¸€å±‚è¡¨è¾¾å¼ï¼Œä¹Ÿå°±æ˜¯MulDivè¡¨è¾¾å¼ã€‚å‘ä¸Šä¸€å±‚ä¼ å€¼çš„æ–¹æ³•å¾ˆå¤šï¼Œè¿™é‡Œé‡‡ç”¨ä¸€ä¸ªæˆ‘éå¸¸æ¨èçš„æ–¹å¼ï¼Œé€šè¿‡ç”¨ä¸€ä¸ªMapå¯¹è±¡ä¿å­˜æ‰€æœ‰éœ€è¦ä¼ é€’çš„å€¼ï¼Œkeyå°±æ˜¯ä¸Šä¸€å±‚èŠ‚ç‚¹çš„ParseTreeå¯¹è±¡ï¼ˆæ¯ä¸€ä¸ªenterXxxå’ŒexitXxxæ–¹æ³•çš„ctxå‚æ•°çš„ç±»å‹éƒ½å®ç°äº†ParseTreeæ¥å£ï¼‰ï¼Œè€Œvalueåˆ™æ˜¯å¾…ä¼ é€’çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼å®šä¹‰è¿™ä¸ªMapå¯¹è±¡ã€‚&lt;/p&gt;

&lt;div id=&quot;5370-1597845753046&quot; data-theme=&quot;default&quot; data-language=&quot;javascript&quot; readability=&quot;6.5&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
 &lt;span&gt;private&lt;/span&gt; Map&amp;lt;ParseTree,Integer&amp;gt; values = &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;åŒæ—¶è¿˜éœ€è¦ä¸¤ä¸ªæ–¹æ³•æ¥è®¾ç½®å’Œè·å–å€¼ï¼Œåˆ†åˆ«æ˜¯setValueå’ŒgetValueï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div id=&quot;7025-1597845825622&quot; data-theme=&quot;default&quot; data-language=&quot;javascript&quot; readability=&quot;7.5&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; setValue(ParseTree node, &lt;span&gt;int&lt;/span&gt;&lt;span&gt; value) {
    values.put(node,value);
}
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getValue(ParseTree node) {
    &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; values.get(node);
    } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; 0&lt;span&gt;;
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;ä¸‹é¢ç»™å‡ºMyCalcParserç±»çš„å®Œæ•´ä»£ç ï¼š&lt;/p&gt;
&lt;div id=&quot;8078-1597845901019&quot; data-theme=&quot;default&quot; data-language=&quot;javascript&quot; readability=&quot;16.5&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;53&quot;&gt;
&lt;pre&gt;
&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.antlr.v4.runtime.tree.ParseTree;

&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.HashMap;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.Map;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; MyCalcParser  &lt;span&gt;extends&lt;/span&gt;&lt;span&gt;  CalcBaseListener{
    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; Map&amp;lt;ParseTree,Integer&amp;gt; values = &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();        &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç”¨äºä¿å­˜å‘ä¸Šä¸€å±‚èŠ‚ç‚¹ä¼ é€’çš„å€¼&lt;/span&gt;
    Map&amp;lt;String, Integer&amp;gt; memory = &lt;span&gt;new&lt;/span&gt; HashMap&amp;lt;String, Integer&amp;gt;();    &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç”¨äºä¿å­˜å˜é‡çš„å€¼&lt;/span&gt;
    &lt;span&gt;boolean&lt;/span&gt; error = &lt;span&gt;false&lt;/span&gt;;                                           &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç”¨äºæ ‡è¯†åˆ†æçš„è¿‡ç¨‹æ˜¯å¦å‡ºé”™
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è®¾ç½®å€¼&lt;/span&gt;
    &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; setValue(ParseTree node, &lt;span&gt;int&lt;/span&gt;&lt;span&gt; value) {
        values.put(node,value);
    }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å–å€¼&lt;/span&gt;
    &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getValue(ParseTree node) {
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; values.get(node);
        } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; 0&lt;span&gt;;
        }

    }
    @Override &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; enterPrintExpr(CalcParser.PrintExprContext ctx) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å½“å¼€å§‹å¤„ç†è¡¨è¾¾å¼æ—¶ï¼Œé»˜è®¤æ²¡æœ‰é”™è¯¯&lt;/span&gt;
        error = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
    }
    @Override &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitPrintExpr(CalcParser.PrintExprContext ctx) {
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(!&lt;span&gt;error) {
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; åªæœ‰åœ¨æ²¡æœ‰é”™è¯¯çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šè¾“å‡ºè¡¨è¾¾å¼çš„å€¼ &lt;/span&gt;
&lt;span&gt;            System.out.println(getValue(ctx.expr()));
        }
    }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¿…é¡»è¦æ”¾åœ¨exitAssigné‡Œ&lt;/span&gt;
    @Override &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitAssign(CalcParser.AssignContext ctx) {
        String id &lt;/span&gt;= ctx.ID().getText();     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å–å˜é‡å&lt;/span&gt;
        &lt;span&gt;int&lt;/span&gt; value = getValue(ctx.expr());   &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å–å³ä¾§è¡¨è¾¾å¼çš„å€¼&lt;/span&gt;
        memory.put(id, value);              &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¿å­˜å˜é‡&lt;/span&gt;
&lt;span&gt;    }    
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¿…é¡»åœ¨exitParensä¸­å®Œæˆ&lt;/span&gt;
    @Override &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitParens(CalcParser.ParensContext ctx) {
        setValue(ctx,getValue(ctx.expr()));
    }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è®¡ç®—ä¹˜æ³•å’Œé™¤æ³•ï¼ˆå¿…é¡»åœ¨exitMulDivä¸­å®Œæˆï¼‰&lt;/span&gt;
    @Override &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitMulDiv(CalcParser.MulDivContext ctx) {

        &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; left =  getValue(ctx.expr(0));  &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å–å·¦æ“ä½œæ•°çš„å€¼&lt;/span&gt;
        &lt;span&gt;int&lt;/span&gt; right = getValue(ctx.expr(1));  &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å–å³æ“ä½œæ•°çš„å€¼&lt;/span&gt;
        &lt;span&gt;if&lt;/span&gt; ( ctx.op.getType() ==&lt;span&gt; CalcParser.MUL )
            setValue(ctx,left &lt;/span&gt;* right);       &lt;span&gt;//&lt;/span&gt;&lt;span&gt; å‘ä¸Šä¼ é€’å€¼&lt;/span&gt;
        &lt;span&gt;else&lt;/span&gt;&lt;span&gt;
            setValue(ctx,left &lt;/span&gt;/ right);       &lt;span&gt;//&lt;/span&gt;&lt;span&gt; å‘ä¸Šä¼ é€’å€¼&lt;/span&gt;
&lt;span&gt;    }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è®¡ç®—åŠ æ³•å’Œå‡æ³•ï¼ˆå¿…é¡»åœ¨exitAddSubä¸­å®Œæˆï¼‰&lt;/span&gt;
    @Override &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitAddSub(CalcParser.AddSubContext ctx) {
        &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; left =  getValue(ctx.expr(0));  &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å–å·¦æ“ä½œæ•°çš„å€¼&lt;/span&gt;
        &lt;span&gt;int&lt;/span&gt; right = getValue(ctx.expr(1));  &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å–å³æ“ä½œæ•°çš„å€¼&lt;/span&gt;
        &lt;span&gt;if&lt;/span&gt; ( ctx.op.getType() ==&lt;span&gt; CalcParser.ADD )
            setValue(ctx,left &lt;/span&gt;+&lt;span&gt; right);
        &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;
            setValue(ctx,left &lt;/span&gt;-&lt;span&gt; right);
    }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; åœ¨enterIdæ–¹æ³•ä¸­ä¹Ÿå¯ä»¥&lt;/span&gt;
    @Override &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; exitId(CalcParser.IdContext ctx) {
        String id &lt;/span&gt;=&lt;span&gt; ctx.ID().getText();
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; ( memory.containsKey(id) ) {
            setValue(ctx,memory.get(id));      &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å°†å˜é‡çš„å€¼å‘ä¸Šä¼ é€’&lt;/span&gt;
        } &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å˜é‡ä¸å­˜åœ¨ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼ˆåŒ…æ‹¬è¡Œå’Œåˆ—ï¼‰ï¼Œ &lt;/span&gt;
            System.err.println(String.format(&quot;è¡Œï¼š%d, åˆ—ï¼š%d, å˜é‡&amp;lt;%s&amp;gt; ä¸å­˜åœ¨ï¼&quot;,ctx.getStart().getLine(),ctx.getStart().getCharPositionInLine() + 1&lt;span&gt;,  id));
            error &lt;/span&gt;= &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
        }
    }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¤„ç†intç±»å‹çš„å€¼&lt;/span&gt;
    @Override &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; enterInt(CalcParser.IntContext ctx) {

        &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; value =&lt;span&gt; Integer.valueOf(ctx.getText());
        setValue(ctx, value);      &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å°†æ•´æ•°å€¼å‘ä¸Šä¼ é€’&lt;/span&gt;
&lt;span&gt;    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;
&lt;p&gt;ç°åœ¨ç¼–å†™ç”¨äºéå†ASTå’Œè®¡ç®—ç»“æœçš„MarvelListenerCalcç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div readability=&quot;8&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.antlr.v4.runtime.CharStream;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.antlr.v4.runtime.CharStreams;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.antlr.v4.runtime.CommonTokenStream;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.antlr.v4.runtime.tree.ParseTree;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.antlr.v4.runtime.tree.ParseTreeWalker;

&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.io.FileInputStream;
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.io.InputStream;

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; MarvelListenerCalc {
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; main(String[] args) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Exception  {
        String inputFile &lt;/span&gt;= &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; ( args.length&amp;gt;0&lt;span&gt; ) {
            inputFile &lt;/span&gt;= args[0&lt;span&gt;];
        } &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
            System.out.println(&lt;/span&gt;&quot;è¯­æ³•æ ¼å¼ï¼šMarvelCalc inputfile&quot;&lt;span&gt;);
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt;;
        }
        InputStream is &lt;/span&gt;=&lt;span&gt; System.in;
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; ( inputFile!=&lt;span&gt;null&lt;/span&gt; ) is = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; FileInputStream(inputFile);


        CharStream input &lt;/span&gt;=&lt;span&gt; CharStreams.fromStream(is);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆ›å»ºè¯æ³•åˆ†æå™¨&lt;/span&gt;
        CalcLexer lexer = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; CalcLexer(input);
        CommonTokenStream tokens &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; CommonTokenStream(lexer);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt; 
        CalcParser parser = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; CalcParser(tokens);
        ParseTree tree &lt;/span&gt;=&lt;span&gt;  parser.prog();
        MyCalcParser calc &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; MyCalcParser();
        ParseTreeWalker walker &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ParseTreeWalker();
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¼€å§‹éå†AST&lt;/span&gt;
&lt;span&gt;        walker.walk(calc, tree);

    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
Â &lt;/div&gt;

&lt;p&gt;æˆ‘ä»¬ä»ç„¶ä½¿ç”¨ä¸Šä¸€ç¯‡æ–‡ç« ä½¿ç”¨çš„æµ‹è¯•ç”¨ä¾‹ï¼š&lt;/p&gt;

&lt;div id=&quot;4632-1597846417104&quot; data-theme=&quot;default&quot; data-language=&quot;javascript&quot; readability=&quot;6&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
1+3 * 4 - 12 /6&lt;span&gt;;
x &lt;/span&gt;= 40&lt;span&gt;;
y &lt;/span&gt;= 13&lt;span&gt;;
x &lt;/span&gt;* y + 20 - 42/6&lt;span&gt;;
z &lt;/span&gt;= 12&lt;span&gt;;
&lt;/span&gt;4&lt;span&gt;;
x &lt;/span&gt;+ 41 * z - y;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;è¿è¡ŒMarvelListenerCalcçš„æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div&gt;Â &lt;img src=&quot;https://img2020.cnblogs.com/blog/32818/202008/32818-20200821082311261-1528415109.png&quot; alt=&quot;&quot; width=&quot;693&quot; height=&quot;433&quot; loading=&quot;lazy&quot;/&gt;&lt;/div&gt;
&lt;div&gt;&lt;img src=&quot;https://note.youdao.com/src/0B00AEFB331944619126C97F19221C6A&quot; alt=&quot;&quot; data-media-type=&quot;image&quot;/&gt;&lt;/div&gt;

&lt;p&gt;æœ¬æ–‡å®ç°çš„ç¨‹åºè¿˜æ”¯æŒé”™è¯¯æ•æ‰ï¼Œä¾‹å¦‚ï¼Œå°†æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å˜é‡xæ”¹æˆxxï¼Œå†æ‰§è¡Œç¨‹åºï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå‡ºé”™çš„è¡¨è¾¾å¼æ²¡æœ‰è¾“å‡ºä»»ä½•å€¼ï¼Œå¼‚å¸¸ä¼šæŒ‡ç¤ºå‡ºé”™çš„ä½ç½®ï¼ˆè¡Œå’Œåˆ—ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div&gt;&lt;img src=&quot;https://note.youdao.com/src/22ED0D795A9D4C37B645E8B3BEF828B5&quot; alt=&quot;&quot; data-media-type=&quot;image&quot;/&gt;&lt;/div&gt;
&lt;div&gt;Â &lt;img src=&quot;https://img2020.cnblogs.com/blog/32818/202008/32818-20200821082332982-155277063.png&quot; alt=&quot;&quot; width=&quot;704&quot; height=&quot;337&quot; loading=&quot;lazy&quot;/&gt;

&lt;/div&gt;
&lt;p&gt;è¯·å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ã€Œ&lt;span&gt;æå®¢èµ·æº&lt;/span&gt;ã€ï¼Œæ›´å¤šç²¾å½©å†…å®¹æœŸå¾…æ‚¨çš„å…‰ä¸´ï¼&lt;/p&gt;

&lt;div&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/32818/202007/32818-20200727144809192-1450907133.jpg&quot; alt=&quot;&quot; width=&quot;567&quot; height=&quot;315&quot; loading=&quot;lazy&quot;/&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
<pubDate>Fri, 21 Aug 2020 00:32:00 +0000</pubDate>
<dc:creator>é“¶æ²³ä½¿è€…</dc:creator>
<og:description>æœ¬æ–‡è¯¦ç»†è®²è§£å¦‚ä½•ç”¨Listeneræ–¹å¼å®ç°ä¸€ä¸ªå¯ä»¥è®¡ç®—è¡¨è¾¾å¼çš„ç¨‹åºï¼Œè¯¥ç¨‹åºä¸ä»…å¯ä»¥è®¡ç®—è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥è¯†åˆ«è¡¨è¾¾å¼çš„é”™è¯¯ï¼Œå¦‚æœæŸä¸€ä¸ªè¡¨è¾¾å¼å‡ºé”™ï¼Œé‚£ä¹ˆè¯¥è¡¨è¾¾å¼ä¸ä¼šè¾“å‡ºä»»ä½•ç»“æœã€‚</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/nokiaguy/p/13539090.html</dc:identifier>
</item>
<item>
<title>.Net Coreä¸­çš„è¯Šæ–­æ—¥å¿—DiagnosticSourceè®²è§£ - yiå¿µä¹‹é—´</title>
<link>http://www.cnblogs.com/wucy/p/13532534.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/wucy/p/13532534.html</guid>
<description>&lt;h3 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h3&gt;
&lt;p&gt;Â Â Â Â è¿‘æœŸç”±äºéœ€è¦è¿›è¡Œåˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ªç³»ç»Ÿçš„æŠ€æœ¯é€‰å‹ï¼Œæ‰€ä»¥ä¸€ç›´åœ¨ç ”ç©¶é“¾è·¯è·Ÿè¸ªç›¸å…³çš„æ¡†æ¶ã€‚ä½œä¸ºèƒ½åœ¨.Net Coreä¸­ä½¿ç”¨çš„APMï¼ŒSkyWalkingè‡ªç„¶æˆä¸ºäº†é¦–é€‰ã€‚&lt;a href=&quot;https://github.com/SkyAPM/SkyAPM-dotnet&quot;&gt;SkyAPM-dotnet&lt;/a&gt;æ˜¯SkyWalkingåœ¨.Net Coreç«¯çš„æ¢é’ˆå®ç°ï¼Œå…¶ä¸»è¦çš„æ”¶é›†æ—¥å¿—çš„æ‰‹æ®µå°±æ˜¯åŸºäºDiagnosticSourceæ¥è¿›è¡Œè¯Šæ–­è·Ÿè¸ªçš„ã€‚ä¸å¾—ä¸è¯´SkyAPM-dotnetçš„è®¾è®¡è¿˜æ˜¯éå¸¸ä¼˜ç§€çš„ï¼Œå®ƒæœ¬èº«å®šä¹‰äº†ä¸€å¥—éå¸¸è§„èŒƒçš„æ ‡å‡†ï¼Œè€Œä¸”æä¾›äº†éå¸¸è‰¯å¥½çš„æ‰©å±•æ€§ï¼Œè™½ç„¶æ¡†æ¶æœ¬èº«å¯æ”¯æŒçš„é‡‡é›†ç«¯æœ‰é™ï¼Œä½†æ˜¯åŸºäºè¿™å¥—æ ‡å‡†æ‰©å±•èµ·æ¥è¿˜æ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ¦‚å¿µä»‹ç»&quot;&gt;æ¦‚å¿µä»‹ç»&lt;/h3&gt;
&lt;p&gt;Â Â Â Â å…³äºDiagnosticSourceå®ƒæœ¬èº«æ˜¯ä¸€ä¸ªåŸºäºå‘å¸ƒè®¢é˜…æ¨¡å¼çš„å·¥ä½œæ¨¡å¼ï¼Œç”±äºå®ƒæœ¬èº«çš„å®ç°æ–¹å¼æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥ä¸ä»…ä»…å¯ä»¥æŠŠå®ƒç”¨åˆ°æ—¥å¿—ä¸Šï¼Œè¿˜å¯ä»¥ç”¨å®ƒå®ç°å¼‚æ­¥æ“ä½œï¼Œæˆ–è€…ç”¨å®ƒç®€åŒ–å®ç°å‘å¸ƒè®¢é˜…çš„åŠŸèƒ½ã€‚DiagnosticSourceæœ¬èº«æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨åˆ°çš„æ˜¯å®ƒçš„å­ç±»DiagnosticListenerï¼Œé€šè¿‡DiagnosticSourceçš„Writeæ–¹æ³•å®ç°å‘å¸ƒä¸€æ¡æœ‰å…·ä½“åç§°çš„æ¶ˆæ¯ï¼Œç„¶åé€šè¿‡IObserverå»è®¢é˜…æ¶ˆæ¯ã€‚DiagnosticListenerå¯ä»¥å®ç°ä¸åŒçš„å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹å¯ä»¥æœ‰è‡ªå·±çš„åç§°ï¼Œæ¯ä¸ªå®ä¾‹è¿˜å¯ä»¥å‘å¸ƒä¸åŒåç§°çš„æ¶ˆæ¯ï¼Œå¥½æ¯”ä¸€ä¸ªåœ¨å†™ä»£ç çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥å®šä¹‰å¤šä¸ªç¨‹åºé›†ï¼Œä¸€ä¸ªç¨‹åºé›†ä¸‹é¢å¯ä»¥åŒ…å«å¤šä¸ªå‘½åç©ºé—´ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä½¿ç”¨æ–¹å¼&quot;&gt;ä½¿ç”¨æ–¹å¼&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢æˆ‘ä»¬å¤§è‡´çš„ä»‹ç»äº†å…³äºDiagnosticSourceç›¸å…³çš„æ¦‚å¿µï¼Œç›¸ä¿¡å¤§å®¶å·²ç»æœ‰äº†åˆæ­¥çš„äº†è§£ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹åœ¨ä»£ç ä¸­å¦‚ä½•ä½¿ç”¨DiagnosticSourceï¼Œè¿˜è¯´åˆ°äº†å®ƒä¸€ä¸ªé‡è¦çš„å­ç±»DiagnosticListenerï¼ŒåŸºæœ¬ä¸Šå…³äºDiagnosticSourceçš„å·¥ä½œæ–¹å¼éƒ½æ˜¯å›´ç»•ç€DiagnosticListenerå®ç°çš„ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å‘å¸ƒä¸€æ¡æ¶ˆæ¯&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;//å£°æ˜DiagnosticListenerå¹¶å‘½åä¸ºMyTest
DiagnosticSource diagnosticSource = new DiagnosticListener(&quot;MyTest&quot;);
string pubName = &quot;MyTest.Log&quot;;
//åˆ¤æ–­æ˜¯å¦å­˜åœ¨MyTest.Logçš„è®¢é˜…è€…
if (diagnosticSource.IsEnabled(pubName))
{
    //å‘é€åä¸ºMyTest.Logçš„æ¶ˆæ¯ï¼ŒåŒ…å«Nameï¼ŒAddressä¸¤ä¸ªå±æ€§
    diagnosticSource.Write(pubName, new { Name = &quot;oldç‹&quot;, Address=&quot;éš”å£&quot; });
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®Œæˆé’ˆå¯¹æ¶ˆæ¯çš„å‘å¸ƒï¼Œå…¶ä¸­ç”¨åˆ°äº†IsEnabledæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨å®é™…ä½¿ç”¨DiagnosticSourceè¿‡ç¨‹ä¸­æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¤Ÿå­˜åœ¨å¯¹åº”åç§°çš„æ¶ˆè´¹è€…ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„é¿å…å‘é€æ¶ˆæ¯æµªè´¹ã€‚&lt;br/&gt;å‘é€ç›¸å¯¹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•è®¢é˜…å‘å¸ƒçš„æ¶ˆæ¯ã€‚ä¸Šé¢æˆ‘ä»¬æåˆ°äº†è®¢é˜…æ¶ˆæ¯æ˜¯é€šè¿‡IObserveræ¥å£å®ç°çš„ï¼ŒIObserverä»£è¡¨äº†è®¢é˜…è€…ã€‚è™½ç„¶æˆ‘ä»¬é€šè¿‡DiagnosticSourceå»å‘å¸ƒæ¶ˆæ¯ï¼Œä½†æ˜¯çœŸæ­£æè¿°å‘å¸ƒè€…èº«ä»½çš„æ˜¯IObservableæ¥å£ï¼ŒIObservableçš„å”¯ä¸€æ–¹æ³•Subscribeæ˜¯ç”¨æ¥æ³¨å†Œè®¢é˜…è€…IObserverï¼Œä½†æ˜¯é»˜è®¤ç³»ç»Ÿå¹¶æ²¡æœ‰ä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªå…·ä½“çš„å®ç°ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªIObserverè®¢é˜…è€…çš„å®ç°ç±»&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;public class MyObserver&amp;lt;T&amp;gt;:IObserver&amp;lt;T&amp;gt;
{
    private Action&amp;lt;T&amp;gt; _next;
    public MyObserver(Action&amp;lt;T&amp;gt; next)
    {
        _next = next;
    }

    public void OnCompleted()
    {
    }

    public void OnError(Exception error)
    {
    }

    public void OnNext(T value) =&amp;gt; _next(value);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æœ‰äº†å…·ä½“çš„è®¢é˜…è€…å®ç°ç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸ºå‘å¸ƒè€…æ³¨å†Œè®¢é˜…è€…äº†,åŒæ ·æ˜¯ä½¿ç”¨DiagnosticListenerï¼Œä¸ªäººè®¤ä¸ºè™½ç„¶æ“ä½œéƒ½æ˜¯é€šè¿‡DiagnosticSourceæ¥å®Œæˆçš„ï¼Œä½†å®ƒåªæ˜¯ä¸€ä¸ªå¤–è§‚ç±»ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ç›´æ¥æè¿°å‘å¸ƒè€…å’Œè®¢é˜…è€…æœ¬èº«ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹å…·ä½“å®ç°&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;//AllListenersè·å–æ‰€æœ‰å‘å¸ƒè€…ï¼ŒSubscribeä¸ºå‘å¸ƒè€…æ³¨å†Œè®¢é˜…è€…MyObserver
DiagnosticListener.AllListeners.Subscribe(new MyObserver&amp;lt;DiagnosticListener&amp;gt;(listener =&amp;gt;
{
    //åˆ¤æ–­å‘å¸ƒè€…çš„åå­—
    if (listener.Name == &quot;MyTest&quot;)
    {
        //è·å–è®¢é˜…ä¿¡æ¯
        listener.Subscribe(new MyObserver&amp;lt;KeyValuePair&amp;lt;string, object&amp;gt;&amp;gt;(listenerData =&amp;gt;
        {
            System.Console.WriteLine($&quot;ç›‘å¬åç§°:{listenerData.Key}&quot;);
            dynamic data = listenerData.Value;
            //æ‰“å°å‘å¸ƒçš„æ¶ˆæ¯
            System.Console.WriteLine($&quot;è·å–çš„ä¿¡æ¯ä¸º:{data.Name}çš„åœ°å€æ˜¯{data.Address}&quot;);
        }));

        listener.SubscribeWithAdapter(new MyDiagnosticListener());
    }
}));
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å…·ä½“å®ç°å¯æ€»ç»“ä¸ºä¸¤æ­¥ï¼Œé¦–å…ˆä¸ºå‘å¸ƒè€…æ³¨å†Œè®¢é˜…è€…ï¼Œç„¶åè·å–è®¢é˜…è€…è·å–å‘å¸ƒçš„æ¶ˆæ¯ã€‚è¿™ç§å†™æ³•è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œé¦–å…ˆéœ€è¦å®ç°è®¢é˜…è€…ç±»ï¼Œç„¶åé€šè¿‡ä¸€ç³»åˆ—å¤æ‚çš„æ“ä½œï¼Œæ‰èƒ½å®Œæˆæ¶ˆæ¯è®¢é˜…ï¼Œç„¶åè¿˜è¦è‡ªå·±è·å–å‘å¸ƒçš„æ¶ˆæ¯ï¼Œè§£æå…·ä½“çš„æ¶ˆæ¯å€¼ï¼Œæ€»ä¹‹æ“ä½œæµç¨‹éå¸¸ç¹çã€‚å¾®è½¯ä¼¼ä¹ä¹Ÿæ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œäºæ˜¯ä¹ç»™æˆ‘æä¾›äº†ä¸€ä¸ªå…³äºå®ç°è®¢é˜…è€…çš„ä¾¿åˆ©æ–¹æ³•ï¼Œç¼–è¾‘é¡¹ç›®æ–‡ä»¶å¼•å…¥DiagnosticAdapteråŒ…&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;lt;PackageReference Include=&quot;Microsoft.Extensions.DiagnosticAdapter&quot; Version=&quot;3.1.7&quot; /&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æˆ–è€…é€šè¿‡åŒ…ç®¡ç†å™¨ç›´æ¥æœç´¢å®‰è£…ï¼Œé“è·¯åƒä¸‡æ¡éƒ½æ˜¯é€šç½—é©¬ã€‚é€šè¿‡è¿™ä¸ªåŒ…è§£å†³äº†æˆ‘ä»¬ä¸¤ä¸ªç—›ç‚¹ï¼Œé¦–å…ˆæ˜¯å…³äºè®¢é˜…è€…çš„æ³¨å†Œéš¾é—®é¢˜ï¼Œå…¶æ¬¡è§£å†³äº†å…³äºå‘å¸ƒæ¶ˆæ¯è§£æéš¾çš„ç—›ç‚¹ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¢é˜…ä¸€ä¸ªé€‚é…ç±»æ¥å……å½“è®¢é˜…è€…çš„è½½ä½“ï¼Œå…¶æ¬¡æˆ‘ä»¬å¯ä»¥å®šä¹‰æ–¹æ³•æ¨¡æ‹Ÿè®¢é˜…å»è®¢é˜…æ¶ˆæ¯ï¼Œè€Œè¿™ä¸ªæ–¹æ³•çš„å‚æ•°å°±æ˜¯æˆ‘ä»¬å‘å¸ƒçš„æ¶ˆæ¯å†…å®¹ã€‚è¯´äº†è¿™ä¹ˆå¤šï¼Œä¸å¦‚ç›´æ¥ä¸Šä»£ç &lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;public class MyDiagnosticListener
{
    //å‘å¸ƒçš„æ¶ˆæ¯ä¸»é¢˜åç§°
    [DiagnosticName(&quot;MyTest.Log&quot;)]
    //å‘å¸ƒçš„æ¶ˆæ¯å‚æ•°åç§°å’Œå‘å¸ƒçš„å±æ€§åç§°è¦ä¸€è‡´
    public void MyLog(string name,string address)
    {
        System.Console.WriteLine($&quot;ç›‘å¬åç§°:MyTest.Log&quot;);
        System.Console.WriteLine($&quot;è·å–çš„ä¿¡æ¯ä¸º:{name}çš„åœ°å€æ˜¯{address}&quot;);
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥éšä¾¿å®šä¹‰ä¸€ä¸ªç±»æ¥å……å½“è®¢é˜…è€…è½½ä½“,ç±»é‡Œé¢å¯ä»¥è‡ªå®šä¹‰æ–¹æ³•æ¥å®ç°è·å–è§£ææ¶ˆæ¯çš„å®ç°ã€‚æƒ³è¦è®©æ–¹æ³•å¯ä»¥è®¢é˜…æ¶ˆæ¯ï¼Œéœ€è¦åœ¨æ–¹æ³•ä¸Šå£°æ˜DiagnosticNameï¼Œç„¶ååç§°å°±æ˜¯ä½ è¦è®¢é˜…æ¶ˆæ¯çš„åç§°ï¼Œè€Œæ–¹æ³•çš„å‚æ•°å°±æ˜¯ä½ å‘å¸ƒæ¶ˆæ¯çš„å­—æ®µå±æ€§åç§°ï¼Œ&lt;span&gt;è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯è®¢é˜…çš„å‚æ•°åç§°éœ€è¦å’Œå‘å¸ƒå£°æ˜å±æ€§åç§°ä¸€è‡´ã€‚&lt;/span&gt;&lt;br/&gt;ç„¶åæˆ‘ä»¬ç›´æ¥å¯ä»¥é€šè¿‡è¿™ä¸ªç±»å»æ¥æ”¶è®¢é˜…æ¶ˆæ¯&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;DiagnosticListener.AllListeners.Subscribe(new MyObserver&amp;lt;DiagnosticListener&amp;gt;(listener =&amp;gt;
{
    if (listener.Name == &quot;MyTest&quot;)
    {
        //é€‚é…è®¢é˜…
        listener.SubscribeWithAdapter(new MyDiagnosticListener());
    }
}));
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¯èƒ½ä½ è§‰å¾—è¿™æ ·è¿˜æ˜¯ä¸å¤Ÿå¥½ï¼Œå› ä¸ºè¿˜æ˜¯æ²¡æœ‰è„±ç¦»éœ€è¦è‡ªå®šä¹‰è®¢é˜…è€…ï¼Œè¿™é‡Œè¿˜æœ‰æ›´ç®€æ´çš„å®ç°æ–¹å¼ã€‚ç»†å¿ƒçš„ä½ å¯èƒ½å·²ç»å‘ç°äº†SubscribeWithAdapteræ˜¯DiagnosticListenerçš„æ‰©å±•æ–¹æ³•ï¼Œè€Œæˆ‘ä»¬å£°æ˜DiagnosticSourceå°±æ˜¯ä½¿ç”¨çš„DiagnosticListenerå®ä¾‹ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç å¯ä»¥ç®€åŒ–ä¸ºä¸€ä¸‹æ–¹å¼&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;DiagnosticListener diagnosticListener = new DiagnosticListener(&quot;MyTest&quot;);
DiagnosticSource diagnosticSource = diagnosticListener;
//ç›´æ¥å»é€‚é…è®¢é˜…è€…
diagnosticListener.SubscribeWithAdapter(new MyDiagnosticListener());

string pubName = &quot;MyTest.Log&quot;;
if (diagnosticSource.IsEnabled(pubName))
{
    diagnosticSource.Write(pubName, new { Name = &quot;oldç‹&quot;, Address=&quot;éš”å£&quot; });
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™ç§æ–¹å¼ä¹Ÿæ˜¯æˆ‘ä»¬æ¯”è¾ƒæ¨èçš„ä½¿ç”¨æ–¹å¼ï¼Œæå¤§çš„èŠ‚çœäº†å·¥ä½œçš„æ–¹å¼ï¼Œè€Œä¸”ä»£ç éå¸¸çš„ç®€æ´ã€‚ä½†æ˜¯å­˜åœ¨å”¯ä¸€çš„ä¸è¶³ï¼Œè¿™ç§å†™æ³•åªèƒ½é’ˆå¯¹ç‰¹å®šçš„DiagnosticListenerè¿›è¡Œè®¢é˜…å¤„ç†ï¼Œå¦‚æœä½ éœ€è¦ç›‘å¬æ‰€æœ‰å‘å¸ƒè€…ï¼Œå°±éœ€è¦ä½¿ç”¨DiagnosticListener.AllListeners.Subscribeçš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;h3 id=&quot;dotnetcoreæºç ä¸­è¯Šæ–­æ—¥å¿—çš„åŸ‹ç‚¹&quot;&gt;DotNetCoreæºç ä¸­è¯Šæ–­æ—¥å¿—çš„åŸ‹ç‚¹&lt;/h3&gt;
&lt;p&gt;åœ¨.Net Coreçš„æºç ä¸­ï¼Œå¾®è½¯é»˜è®¤åœ¨æ¶‰åŠåˆ°ç½‘ç»œè¯·æ±‚æˆ–å¤„ç†è¯·æ±‚ç­‰è®¸å¤šé‡è¦çš„èŠ‚ç‚¹éƒ½ä½¿ç”¨äº†DiagnosticListeneræ¥å‘å¸ƒæ‹¦æˆªçš„æ¶ˆæ¯ï¼Œæ¥ä¸‹æ¥å°±ç½—åˆ—ä¸€äº›æˆ‘çŸ¥é“çš„æ¯”è¾ƒå¸¸è§çš„åŸ‹ç‚¹ï¼Œé€šè¿‡è¿™äº›æ“ä½œæˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºï¼Œè¯Šæ–­æ—¥å¿—è¿˜æ˜¯å¾ˆä¾¿åˆ©çš„ï¼Œè€Œä¸”å¾®è½¯åœ¨.Net Coreä¸­ä¹Ÿéå¸¸é‡è§†å®ƒçš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h4 id=&quot;åœ¨aspnet-coreä¸­&quot;&gt;åœ¨ASP.NET Coreä¸­&lt;/h4&gt;
&lt;p&gt;å½“æˆ‘ä»¬é€šè¿‡ConfigureWebHostDefaultsé…ç½®Webä¸»æœºçš„æ—¶å€™ï¼Œç¨‹åºå°±å·²ç»é»˜è®¤ç»™æˆ‘ä»¬æ³¨å…¥äº†è¯Šæ–­åç§°ä¸ºMicrosoft.AspNetCoreçš„DiagnosticListenerå’ŒDiagnosticSourceï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨ç¨‹åºä¸­ç›´æ¥è·å–DiagnosticListenerå®ä¾‹å»å‘å¸ƒæ¶ˆæ¯æˆ–è€…ç›‘å¬å‘å¸ƒçš„å†…éƒ¨æ¶ˆæ¯ï¼Œå…·ä½“æ³¨å…¥é€»è¾‘ä½äºå¯ä»¥å»GenericWebHostBuilderç±»ä¸­æŸ¥çœ‹[&lt;a href=&quot;https://github.com/dotnet/aspnetcore/blob/v3.1.7/src/Hosting/Hosting/src/GenericHost/GenericWebHostBuilder.cs#L80&quot;&gt;ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ&lt;/a&gt;]&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;var listener = new DiagnosticListener(&quot;Microsoft.AspNetCore&quot;);
services.TryAddSingleton&amp;lt;DiagnosticListener&amp;gt;(listener);
services.TryAddSingleton&amp;lt;DiagnosticSource&amp;gt;(listener);
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç„¶ååœ¨Serverå¯åŠ¨çš„æ—¶å€™ä¼ é€’äº†DiagnosticListenerå®ä¾‹[&lt;a href=&quot;https://github.com/dotnet/aspnetcore/blob/v3.1.7/src/Hosting/Hosting/src/GenericHost/GenericWebHostedService.cs#L118&quot;&gt;ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ&lt;/a&gt;]&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;var httpApplication = new HostingApplication(application, Logger, DiagnosticListener, HttpContextFactory);
await Server.StartAsync(httpApplication, cancellationToken);
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™æ ·åœ¨Serverè¿è¡ŒæœŸé—´æˆ‘ä»¬å¯ä»¥é€šè¿‡DiagnosticListenerè¯Šæ–­è·Ÿè¸ªè¯·æ±‚ç›¸å…³çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹åœ¨å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­DiagnosticListeneréƒ½å‘å¸ƒäº†å“ªäº›æ¶ˆæ¯ï¼Œæˆ‘ä»¬æ‰¾åˆ°å‘é€è¯Šæ–­è·Ÿè¸ªçš„ä½ç½®ä½äºHostingApplicationDiagnosticsä¸­[&lt;a href=&quot;https://github.com/dotnet/aspnetcore/blob/v3.1.7/src/Hosting/Hosting/src/Internal/HostingApplicationDiagnostics.cs&quot;&gt;ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ&lt;/a&gt;]ï¼Œè¿™äº‹é›†ä¸­å¤„ç†è¯·æ±‚ç›¸å…³çš„è¯Šæ–­è·Ÿè¸ªï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å¤§è‡´æŸ¥çœ‹ä¸€ä¸‹å®ƒå‘å¸ƒäº†å“ªäº›äº‹ä»¶æ¶ˆæ¯ï¼Œé¦–å…ˆæ‰¾åˆ°å®šä¹‰å‘å¸ƒåç§°çš„å±æ€§&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;private const string ActivityName = &quot;Microsoft.AspNetCore.Hosting.HttpRequestIn&quot;;
private const string ActivityStartKey = ActivityName + &quot;.Start&quot;;
private const string ActivityStopKey = ActivityName + &quot;.Stop&quot;;

private const string DeprecatedDiagnosticsBeginRequestKey = &quot;Microsoft.AspNetCore.Hosting.BeginRequest&quot;;
private const string DeprecatedDiagnosticsEndRequestKey = &quot;Microsoft.AspNetCore.Hosting.EndRequest&quot;;
private const string DiagnosticsUnhandledExceptionKey = &quot;Microsoft.AspNetCore.Hosting.UnhandledException&quot;;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;é€šè¿‡è¿™äº›å‘å¸ƒæ¶ˆæ¯çš„åç§°æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºï¼Œåœ¨è¯·æ±‚å¼€å§‹ã€è¯·æ±‚è¿›å…¥ã€è¯·æ±‚ç»“æŸã€è¯·æ±‚åœæ­¢ã€è¯·æ±‚å¼‚å¸¸ç­‰éƒ½å‘å¸ƒäº†è¯Šæ–­æ¶ˆæ¯ï¼Œæˆ‘ä»¬ä»¥BeginRequestä¸ºä¾‹æŸ¥çœ‹ä¸€ä¸‹å…·ä½“å‘é€çš„æ¶ˆæ¯&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;if (_diagnosticListener.IsEnabled(DeprecatedDiagnosticsBeginRequestKey))
{
    startTimestamp = Stopwatch.GetTimestamp();
    RecordBeginRequestDiagnostics(httpContext, startTimestamp);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ‰¾åˆ°RecordBeginRequestDiagnosticsæ–¹æ³•çš„å®ç°&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;[MethodImpl(MethodImplOptions.NoInlining)]
private void RecordBeginRequestDiagnostics(HttpContext httpContext, long startTimestamp)
{
    _diagnosticListener.Write(
        DeprecatedDiagnosticsBeginRequestKey,
        new
        {
            httpContext = httpContext,
            timestamp = startTimestamp
        });
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºåœ¨BeginRequestä¸­è¯Šæ–­æ—¥å¿—å‘å‡ºçš„æ¶ˆæ¯ä¸­åŒ…å«äº†HttpContextå’Œå¼€å§‹æ—¶é—´æˆ³ä¿¡æ¯ï¼Œç„¶åå†æ¥çœ‹ä¸€ä¸‹è¯·æ±‚ç»“æŸå‘å¸ƒçš„è¯Šæ–­æ¶ˆæ¯&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;[MethodImpl(MethodImplOptions.NoInlining)]
private void RecordEndRequestDiagnostics(HttpContext httpContext, long currentTimestamp)
{
    _diagnosticListener.Write(
        DeprecatedDiagnosticsEndRequestKey,
        new
        {
            httpContext = httpContext,
            timestamp = currentTimestamp
        });
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;é€šè¿‡å‘å¸ƒçš„è¿™äº›è·Ÿè¸ªæ—¥å¿—æˆ‘ä»¬å¯ä»¥è·å–è¯·æ±‚ä¿¡æ¯,è¯·æ±‚æ—¶é—´å¹¶ä¸”èƒ½å¾—åˆ°è¾“å‡ºä¿¡æ¯å’Œç»“æŸæ—¶é—´ï¼Œæœ‰äº†è¿™äº›å…³é”®ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›‘å¬è¯·Asp.Net Coreå¤„ç†è¯·æ±‚çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¸Šé¢æåˆ°è¿‡SkyAPM-dotnetæ­£æ˜¯é€šè¿‡è¿™äº›å‘å‡ºè¯Šæ–­è·Ÿè¸ªæ—¥å¿—ï¼Œæ¥å®ç°å¯¹ç¨‹åºæ— å…¥ä¾µçš„æ–¹å¼æ¥å¤„ç†åº”ç”¨ç³»ç»Ÿç›‘æ§çš„ï¼Œå…·ä½“æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ç›¸å…³å®ç°ï¼Œæˆ‘ä»¬æ‰¾åˆ°è®¢é˜…è¿™äº›æ¶ˆæ¯çš„åœ°æ–¹&lt;br/&gt;[&lt;a href=&quot;https://github.com/SkyAPM/SkyAPM-dotnet/blob/master/src/SkyApm.Diagnostics.AspNetCore/HostingDiagnosticProcessor.cs&quot;&gt;ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ&lt;/a&gt;],æ‹¿å‡ºæ¥ç±»çš„ç»“æ„ï¼Œå¤§è‡´å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;public class HostingTracingDiagnosticProcessor : ITracingDiagnosticProcessor
{
    public string ListenerName { get; } = &quot;Microsoft.AspNetCore&quot;;

    [DiagnosticName(&quot;Microsoft.AspNetCore.Hosting.BeginRequest&quot;)]
    public void BeginRequest([Property] HttpContext httpContext)
    {
    }

    [DiagnosticName(&quot;Microsoft.AspNetCore.Hosting.EndRequest&quot;)]
    public void EndRequest([Property] HttpContext httpContext)
    {
    }

    [DiagnosticName(&quot;Microsoft.AspNetCore.Diagnostics.UnhandledException&quot;)]
    public void DiagnosticUnhandledException([Property] HttpContext httpContext, [Property] Exception exception)
    {
    }

    [DiagnosticName(&quot;Microsoft.AspNetCore.Hosting.UnhandledException&quot;)]
    public void HostingUnhandledException([Property] HttpContext httpContext, [Property] Exception exception)
    {
    }

    //[DiagnosticName(&quot;Microsoft.AspNetCore.Mvc.BeforeAction&quot;)]
    public void BeforeAction([Property] ActionDescriptor actionDescriptor, [Property] HttpContext httpContext)
    {
    }

    //[DiagnosticName(&quot;Microsoft.AspNetCore.Mvc.AfterAction&quot;)]
    public void AfterAction([Property] ActionDescriptor actionDescriptor, [Property] HttpContext httpContext)
    {
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸å¾—ä¸æ‰¿è®¤SkyAPM-dotnetéå¸¸å·§å¦™çš„åˆ©ç”¨äº†ç³»ç»Ÿå†…éƒ¨å‘å‡ºçš„è¯Šæ–­è·Ÿè¸ªæ—¥å¿—ï¼Œå®ç°äº†å¯¹è¯·æ±‚çš„å¤„ç†è·Ÿè¸ªï¼ŒçœŸçš„æ˜¯éå¸¸ä¼˜ç§€ã€‚&lt;/p&gt;
&lt;h4 id=&quot;åœ¨httpclientä¸­&quot;&gt;åœ¨HttpClientä¸­&lt;/h4&gt;
&lt;p&gt;ä¸Šé¢æˆ‘ä»¬çœ‹åˆ°çš„æ˜¯AspNetCoreå¤„ç†è¯·æ±‚çš„è¯Šæ–­æ—¥å¿—åŸ‹ç‚¹ï¼Œåœ¨å‘å‡ºè¯·æ±‚çš„HttpClientä¸­ï¼Œå¾®è½¯ä¹Ÿåšäº†åŸ‹ç‚¹å¤„ç†ã€‚æˆ‘ä»¬åœ¨ä¹‹å‰çš„æ–‡ç« &lt;a href=&quot;https://www.cnblogs.com/wucy/p/12964869.html&quot;&gt;.NET Core HttpClientæºç æ¢ç©¶&lt;/a&gt;ä¸­æåˆ°è¿‡HttpClienté€šè¿‡HttpClientHandlerå‘é€è¯·æ±‚çš„ï¼Œåœ¨HttpClientHandler SendAsyncæ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å®ç°&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;protected internal override Task&amp;lt;HttpResponseMessage&amp;gt; SendAsync(HttpRequestMessage request,
            CancellationToken cancellationToken)
{
    return DiagnosticsHandler.IsEnabled() &amp;amp;&amp;amp; _diagnosticsHandler != null ?
        _diagnosticsHandler.SendAsync(request, cancellationToken) :
        _underlyingHandler.SendAsync(request, cancellationToken);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´å¦‚æœæ»¡è¶³DiagnosticsHandler.IsEnabled()å¹¶ä¸”_diagnosticsHandlerä¸ä¸ºç©ºçš„æƒ…å†µä¸‹å°†ä¼šä½¿ç”¨DiagnosticsHandlerå‘é€è¯·æ±‚ï¼Œå…³äºDiagnosticsHandler.IsEnabled()çš„å¤§è‡´å®ç°é€»è¾‘å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;if (AppContext.TryGetSwitch(&quot;System.Net.Http.EnableActivityPropagation&quot;, out bool enableActivityPropagation))
{
    return enableActivityPropagation;
}

string? envVar = Environment.GetEnvironmentVariable(&quot;DOTNET_SYSTEM_NET_HTTP_ENABLEACTIVITYPROPAGATION&quot;);
if (envVar != null &amp;amp;&amp;amp; (envVar.Equals(&quot;false&quot;, StringComparison.OrdinalIgnoreCase) || envVar.Equals(&quot;0&quot;)))
{
    return false;
}
return true;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;é€šè¿‡è¿™ä¸ªé€»è¾‘å¯ä»¥çœ‹å‡ºï¼Œé»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬ä¸åšç‰¹æ®Šå¤„ç†è¿”å›çš„å°±æ˜¯trueï¼Œä¹Ÿå°±æ˜¯è¯´å‘é€è¯·æ±‚ä¼šé€šè¿‡DiagnosticsHandlerï¼Œæˆ‘ä»¬æ‰¾åˆ°DiagnosticsHandlerçš„å®ç°[&lt;a href=&quot;https://github.com/dotnet/runtime/blob/34a9820567/src/libraries/System.Net.Http/src/System/Net/Http/DiagnosticsHandler.cs#L66&quot;&gt;ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ&lt;/a&gt;]ï¼ŒæŠ½ç¦»å‡ºæ¥SendAsyncCoreæ–¹æ³•ä¸­å…³äºè¯Šæ–­è·Ÿè¸ªçš„æ ¸å¿ƒå®ç°é€»è¾‘ï¼Œå¤§è‡´å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;DiagnosticListener diagnosticListener = new DiagnosticListener(&quot;HttpHandlerDiagnosticListener&quot;);
if (diagnosticListener.IsEnabled(&quot;System.Net.Http.Request&quot;))
{
    long timestamp = Stopwatch.GetTimestamp();
    loggingRequestId = Guid.NewGuid();
    //è¯·æ±‚å¼€å§‹ä¹‹å‰å‘é€è¯Šæ–­æ—¥å¿—
    diagnosticListener.Write(&quot;System.Net.Http.Request&quot;,new RequestData(request, loggingRequestId, timestamp));
}
HttpResponseMessage? response = null;
TaskStatus taskStatus = TaskStatus.RanToCompletion;
try
{
    response = async ?
        await base.SendAsync(request, cancellationToken).ConfigureAwait(false) :
        base.Send(request, cancellationToken);
    return response;
}
catch (OperationCanceledException)
{
    taskStatus = TaskStatus.Canceled;
    throw;
}
catch (Exception ex)
{
    taskStatus = TaskStatus.Faulted;
    if (diagnosticListener.IsEnabled(&quot;System.Net.Http.Exception&quot;))
    {  
        //å¦‚æœè¯·æ±‚å‡ºç°å¼‚å¸¸å‘å‡ºå¼‚å¸¸æ¶ˆæ¯è¯Šæ–­æ—¥å¿—
        diagnosticListener.Write(&quot;System.Net.Http.Exception&quot;, new ExceptionData(ex, request));
    }
    throw;
}
finally
{
    if (activity != null)
    {
        diagnosticListener.StopActivity(activity, new ActivityStopData(response,request,taskStatus));
    }
    if (diagnosticListener.IsEnabled(&quot;System.Net.Http.Response&quot;))
    {
        long timestamp = Stopwatch.GetTimestamp();
        //å¾—åˆ°è¾“å‡ºç»“æœåå‘é€è¯Šæ–­æ—¥å¿—
        diagnosticListener.Write(&quot;System.Net.Http.Response&quot;,new ResponseData(response,loggingRequestId,timestamp,taskStatus));
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åŒæ ·çš„æ€è·¯HttpClientä¼šåœ¨å‘é€è¯·æ±‚ä¹‹å‰å‘å‡ºè¯·æ±‚ä¿¡æ¯ç›¸å…³çš„è¯Šæ–­è·Ÿè¸ªï¼Œä¼šåœ¨å¾—åˆ°ç›¸åº”ä¹‹åå‘é€å“åº”ç›¸å…³è¯Šæ–­è·Ÿè¸ªï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯æˆ‘ä»¬å¯ä»¥æ•è·åˆ°ç”±ç¨‹åºå‘å‡ºçš„Httpè¯·æ±‚ç›¸å…³çš„ä¿¡æ¯ï¼Œä»è€Œç›‘æ§è¯·æ±‚ç›¸å…³çš„æ•°æ®ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹SkyAPM-dotnetè®¢é˜…Httpè¯·æ±‚ç›¸å…³çš„å®ç°ï¼Œåœ¨HttpClientTracingDiagnosticProcessorç±»ä¸­[&lt;a href=&quot;https://github.com/SkyAPM/SkyAPM-dotnet/blob/master/src/SkyApm.Diagnostics.HttpClient/HttpClientDiagnosticProcessor.cs&quot;&gt;ç‚¹å‡»æŸ¥çœ‹æºç ğŸ‘ˆ&lt;/a&gt;]ï¼ŒæŠ½ç¦»å®ç°çš„æ¡†æ¶å¤§è‡´å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cs&quot;&gt;public class HttpClientTracingDiagnosticProcessor : ITracingDiagnosticProcessor
{
    public string ListenerName { get; } = &quot;HttpHandlerDiagnosticListener&quot;;

    [DiagnosticName(&quot;System.Net.Http.Request&quot;)]
    public void HttpRequest([Property(Name = &quot;Request&quot;)] HttpRequestMessage request)
    {
    }

    [DiagnosticName(&quot;System.Net.Http.Response&quot;)]
    public void HttpResponse([Property(Name = &quot;Response&quot;)] HttpResponseMessage response)
    {
    }

    [DiagnosticName(&quot;System.Net.Http.Exception&quot;)]
    public void HttpException([Property(Name = &quot;Request&quot;)] HttpRequestMessage request,
        [Property(Name = &quot;Exception&quot;)] Exception exception)
    {
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œæ­£æ˜¯ç›‘å¬çš„HttpClientå‘å‡ºçš„è¯Šæ–­æ—¥å¿—ã€‚å‡å¦‚å­˜åœ¨ç³»ç»ŸAå’Œç³»ç»ŸBï¼Œç³»ç»ŸAé€šè¿‡HttpClientå‘é€è¯·æ±‚è°ƒç”¨Asp.Net Coreç³»ç»ŸBï¼Œé€šè¿‡è®¢é˜…ä»–ä»¬å‘å‡ºçš„è¯Šæ–­è·Ÿè¸ªæ—¥å¿—ï¼Œè€Œè¿™äº›æ•°æ®æ­£æ˜¯å®ç°ç³»ç»Ÿç›‘æ§å’Œé“¾è·¯è·Ÿè¸ªé‡è¦ä¾æ®ã€‚&lt;/p&gt;
&lt;h4 id=&quot;å…¶ä»–&quot;&gt;å…¶ä»–&lt;/h4&gt;
&lt;p&gt;Â Â Â Â åœ¨.Net Coreç›¸å…³çš„æºç ä¸­è¿˜æœ‰è®¸å¤šå…¶ä»–å…³äºDiagnosticListenerçš„åŸ‹ç‚¹ä¿¡æ¯æ¯”å¦‚è¯·æ±‚æ‰§è¡Œåˆ°Actionçš„æ—¶å€™æˆ–è€…å‡ºç°å…¨å±€å¼‚å¸¸çš„æ—¶å€™éƒ½æœ‰ç±»ä¼¼çš„å¤„ç†ã€‚åŒæ ·åœ¨EFCoreä¸­ä¹Ÿå­˜åœ¨è¿™äº›åŸ‹ç‚¹ä¿¡æ¯ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡ŒæŸ¥é˜…ç›¸å…³æºç å’ŒSkyAPM-dotnetæºç ï¼Œäº†è§£DiagnosticSourceå·¥ä½œæ–¹å¼ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡è¿™äº›ä¿¡æ¯å®ç°APMç³»ç»Ÿã€‚è™½ç„¶SkyAPM-dotnetæœ¬èº«å®ç°çš„æ¡†æ¶ä¸ªæ•°æœ‰é™ï¼Œä½†æ˜¯å®ƒç»™æˆ‘ä»¬å®ç°äº†è‰¯å¥½çš„æ‰©å±•æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡DiagnosticSourceå’ŒDiagnosticListenerè‡ªè¡Œå®ç°SkyAPM-dotnetçš„æ‰©å±•ï¼Œæ¯”å¦‚ä½ å¯ä»¥æ‰©å±•Redis MongoDbç­‰å…¶å®ƒä¸­é—´ä»¶ã€‚æ¯”å¦‚SkyApm.Diagnostics.CAPæ˜¯CAPçº³å…¥SkyAPMä¸­ç¨‹åºåŒ…ï¼Œæ­£æ˜¯æ¨æ€»å‚ä¸äº†ç›¸å…³ä»£ç çš„å®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ€»ç»“&quot;&gt;æ€»ç»“&lt;/h3&gt;
&lt;p&gt;Â Â Â Â DiagnosticSourceè¯Šæ–­è·Ÿè¸ªæ¶‰åŠåˆ°çš„æ¦‚å¿µè™½ç„¶ä¸æ˜¯å¾ˆå¤šï¼Œä½†æ˜¯åœ¨.Net Coreç›¸å…³çš„æ¡†æ¶ä¸­ä½¿ç”¨çš„è¿˜æ˜¯éå¸¸å¹¿æ³›çš„ï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯æˆ‘ä»¬å¯ä»¥æ‹¿åˆ°æ¡†æ¶æ‰§è¡Œè¿‡ç¨‹ä¸­å…³é”®èŠ‚ç‚¹å¾—åˆ°çš„ä¿¡æ¯ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤§çš„ä¾¿åˆ©ã€‚åŠ ä¸ŠSkyAPM-dotnetå·§å¦™çš„ä½¿ç”¨äº†è¿™ä¸€ç‰¹ç‚¹ä½¿å¾—DiagnosticSourceæ›´å˜å¾—å¼ºå¤§è€Œä¸”é€šç”¨ã€‚ä¸Šé¢æˆ‘ä»¬è®²è¿°çš„åªæ˜¯å†°å±±ä¸€è§’ï¼Œè¿˜æœ‰æ›´å¤šæ›´æ·±çš„åº”ç”¨ï¼Œæ¯”å¦‚Azureç›‘æ§.Net Coreåº”ç”¨ç¨‹åºä¹Ÿæ˜¯åˆ©ç”¨äº†è¿™äº›ã€‚æœ‰å…´è¶£çš„å¯ä»¥æŸ¥çœ‹ç›¸å…³æºç ï¼Œä¹Ÿå¯ä»¥å­¦ä¹ ä¸€ä¸‹SkyAPM-dotnetç›¸å…³æºç ï¼Œä½“ä¼šä¸€ä¸‹DiagnosticSourceç²¾é«“æ‰€åœ¨ã€‚&lt;/p&gt;
&lt;div align=&quot;center&quot;&gt;&lt;span&gt;ğŸ‘‡æ¬¢è¿æ‰«ç å…³æ³¨æˆ‘çš„å…¬ä¼—å·ğŸ‘‡&lt;/span&gt; &lt;img src=&quot;https://img2020.cnblogs.com/blog/2042116/202006/2042116-20200622133425514-1420050576.png&quot;/&gt;&lt;/div&gt;
</description>
<pubDate>Thu, 20 Aug 2020 16:34:00 +0000</pubDate>
<dc:creator>yiå¿µä¹‹é—´</dc:creator>
<og:description>å‰è¨€ è¿‘æœŸç”±äºéœ€è¦è¿›è¡Œåˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ªç³»ç»Ÿçš„æŠ€æœ¯é€‰å‹ï¼Œæ‰€ä»¥ä¸€ç›´åœ¨ç ”ç©¶é“¾è·¯è·Ÿè¸ªç›¸å…³çš„æ¡†æ¶ã€‚ä½œä¸ºèƒ½åœ¨.Net Coreä¸­ä½¿ç”¨çš„APMï¼ŒSkyWalkingè‡ªç„¶æˆä¸ºäº†é¦–é€‰ã€‚SkyAPM-dotnetæ˜¯SkyW</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/wucy/p/13532534.html</dc:identifier>
</item>
<item>
<title>çº¿ç¨‹æ± ä¹‹Executoræ¡†æ¶ - Chiakiiii</title>
<link>http://www.cnblogs.com/chiaki/p/13538829.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/chiaki/p/13538829.html</guid>
<description>&lt;p&gt;Javaçš„çº¿ç¨‹æ—¢æ˜¯å·¥ä½œå•å…ƒï¼Œä¹Ÿæ˜¯æ‰§è¡Œæœºåˆ¶ã€‚ä»JDK5å¼€å§‹ï¼ŒæŠŠå·¥ä½œæœºå•å…ƒå’Œæ‰§è¡Œæœºåˆ¶åˆ†ç¦»å¼€æ¥ã€‚&lt;strong&gt;å·¥ä½œå•å…ƒåŒ…æ‹¬Runnableå’ŒCallableï¼Œè€Œæ‰§è¡Œæœºåˆ¶ç”±Executoræ¡†æ¶æä¾›ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;1-executoræ¡†æ¶ç®€ä»‹&quot;&gt;1. Executoræ¡†æ¶ç®€ä»‹&lt;/h3&gt;
&lt;h4 id=&quot;11-executoræ¡†æ¶çš„ä¸¤çº§è°ƒåº¦æ¨¡å‹&quot;&gt;1.1 Executoræ¡†æ¶çš„ä¸¤çº§è°ƒåº¦æ¨¡å‹&lt;/h4&gt;
&lt;p&gt;åœ¨ä¸Šå±‚ï¼ŒJavaå¤šçº¿ç¨‹ç¨‹åºé€šå¸¸æŠŠåº”ç”¨åˆ†è§£ä¸ºè‹¥å¹²ä¸ªä»»åŠ¡ï¼Œç„¶åä½¿ç”¨ç”¨æˆ·çº§çš„è°ƒåº¦å™¨ï¼ˆExecutoræ¡†æ¶ï¼‰å°†è¿™äº›ä»»åŠ¡æ˜ å°„ä¸ºå›ºå®šæ•°é‡çš„çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åº•å±‚ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸å°†è¿™äº›çº¿ç¨‹æ˜ å°„åˆ°ç¡¬ä»¶å¤„ç†å™¨ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://chiaki.oss-cn-beijing.aliyuncs.com/image-20200820220148034.png&quot; alt=&quot;image-20200820220148034&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;12-executoræ¡†æ¶çš„ç»“æ„&quot;&gt;1.2 Executoræ¡†æ¶çš„ç»“æ„&lt;/h4&gt;
&lt;p&gt;Executoræ¡†æ¶ä¸»è¦ç”±3éƒ¨åˆ†ç»„æˆï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;ä»»åŠ¡&lt;/strong&gt;ã€‚åŒ…æ‹¬è¢«æ‰§è¡Œä»»åŠ¡éœ€è¦å®ç°çš„æ¥å£ï¼šRunnableæ¥å£æˆ–è€…Callableæ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»»åŠ¡çš„æ‰§è¡Œ&lt;/strong&gt;ã€‚åŒ…æ‹¬ä»»åŠ¡æ‰§è¡Œæœºåˆ¶çš„æ ¸å¿ƒæ¥å£Executorï¼Œä»¥åŠç»§æ‰¿è‡ªExecutorçš„ExecutorServiceæ¥å£ã€‚Executoræ¡†æ¶æœ‰ä¸¤ä¸ªå…³é”®ç±»å®ç°äº†ExecutorServiceæ¥å£ï¼ˆThreadPoolExecutorå’ŒScheduledThreadPoolExecutorï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚æ­¥è®¡ç®—çš„ç»“æœ&lt;/strong&gt;ã€‚åŒ…æ‹¬Futureå’Œå®ç°Futureçš„FutureTaskç±»ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;Executoræ¡†æ¶çš„æˆå‘˜åŠå…¶å…³ç³»å¯ä»¥ç”¨ä¸€ä¸‹çš„å…³ç³»å›¾è¡¨ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://chiaki.oss-cn-beijing.aliyuncs.com/image-20200820221319222.png&quot; alt=&quot;image-20200820221319222&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;Executoræ¡†æ¶çš„ä½¿ç”¨ç¤ºæ„å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://chiaki.oss-cn-beijing.aliyuncs.com/image-20200820222719384.png&quot; alt=&quot;image-20200820222719384&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä¸»çº¿ç¨‹é¦–å…ˆåˆ›å»ºå®ç°Runnableæˆ–Callableæ¥å£çš„ä»»åŠ¡å¯¹è±¡ã€‚å·¥å…·ç±»Executorså¯ä»¥æŠŠä¸€ä¸ªRunnableå¯¹è±¡å°è£…ä¸ºä¸€ä¸ªCallableå¯¹è±¡ï¼ˆ&lt;code&gt;Executors.callable(Runnable task)&lt;/code&gt;æˆ–&lt;code&gt;Executors.callable(Runnable task, Object result)&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºExecutoræ¥å£çš„å®ç°ç±»ThreadPoolExecutorç±»æˆ–è€…ScheduledThreadPoolExecutorç±»çš„å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å…¶execute()æ–¹æ³•æˆ–è€…submit()æ–¹æ³•æŠŠå·¥ä½œä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹ä¸­ï¼Œå¦‚æœæœ‰è¿”å›å€¼åˆ™è¿”å›Futureå¯¹è±¡ã€‚å…¶ä¸­Callableå¯¹è±¡æœ‰è¿”å›å€¼ï¼Œå› æ­¤ä½¿ç”¨submit()æ–¹æ³•ï¼›è€ŒRunnableå¯ä»¥ä½¿ç”¨execute()æ–¹æ³•ï¼Œæ­¤å¤–è¿˜å¯ä»¥ä½¿ç”¨submit()æ–¹æ³•ï¼Œåªè¦ä½¿ç”¨callable(Runnable task)æˆ–è€…callable(Runnable task, Object result)æ–¹æ³•æŠŠRunnableå¯¹è±¡åŒ…è£…èµ·æ¥å°±å¯ä»¥ï¼Œä½¿ç”¨callable(Runnable task)æ–¹æ³•è¿”å›çš„nullï¼Œä½¿ç”¨callable(Runnable task, Object result)æ–¹æ³•è¿”å›resultã€‚&lt;/li&gt;
&lt;li&gt;ä¸»çº¿ç¨‹å¯ä»¥æ‰§è¡ŒFutureå¯¹è±¡çš„get()æ–¹æ³•è·å–è¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨cancle()æ–¹æ³•å–æ¶ˆå½“å‰çº¿ç¨‹çš„æ‰§è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;13-executoræ¡†æ¶çš„ä½¿ç”¨æ¡ˆä¾‹&quot;&gt;1.3 Executoræ¡†æ¶çš„ä½¿ç”¨æ¡ˆä¾‹&lt;/h4&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;import java.util.concurrent.*;

public class ExecutorDemo {
    // åˆ›å»ºThreadPoolExecutorå®ç°ç±»
    private static ThreadPoolExecutor executor = new ThreadPoolExecutor(
            5,
            10,
            100,
            TimeUnit.MILLISECONDS,
            new ArrayBlockingQueue&amp;lt;&amp;gt;(5),
    );

    public static void main(String[] args) {
        // é‡‡ç”¨submit()æ–¹æ³•æäº¤Callableå¯¹è±¡å¹¶è¿”å›Futureå¯¹è±¡
        Future&amp;lt;String&amp;gt; future = executor.submit(new callableDemo());
        try {
            // get()æ–¹æ³•è·å–è¿”å›å€¼
            System.out.println(future.get());
        } catch (InterruptedException | ExecutionException e) {
            // å¤„ç†å¼‚å¸¸
            e.printStackTrace();
        } finally {
            // å…³é—­çº¿ç¨‹æ± 
            executor.shutdown();
        }
    }
}

/**
 * åˆ›å»ºCallableæ¥å£çš„å®ç°ç±»
 */
class callableDemo implements Callable&amp;lt;String&amp;gt; {
    @Override
    public String call() throws Exception {
        Thread.sleep(1000);
        String s = &quot;return string&quot;;
        return s;
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;2-executoræ¡†æ¶æˆå‘˜&quot;&gt;2. Executoræ¡†æ¶æˆå‘˜&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://chiaki.oss-cn-beijing.aliyuncs.com/image-20200820225956625.png&quot; alt=&quot;image-20200820225956625&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;21-threadpoolexecutor&quot;&gt;2.1 ThreadPoolExecutor&lt;/h4&gt;
&lt;p&gt;ç›´æ¥åˆ›å»ºThreadPoolExecutorçš„å®ä¾‹å¯¹è±¡ï¼Œè§https://www.cnblogs.com/chiaki/p/13536624.html&lt;/p&gt;
&lt;p&gt;ThreadPoolExecutoré€šå¸¸ä½¿ç”¨å·¥å‚ç±»Executorsåˆ›å»ºï¼Œå¯ä»¥åˆ›å»º3ç§ç±»å‹çš„ThreadPoolExecutorï¼Œå³FixedThreadPoolã€SingleThreadExecutorä»¥åŠCachedThreadPoolã€‚&lt;/p&gt;
&lt;ul readability=&quot;27&quot;&gt;&lt;li readability=&quot;16&quot;&gt;
&lt;p&gt;&lt;strong&gt;FixedThreadPool&lt;/strong&gt;ï¼š&lt;strong&gt;é€‚ç”¨äºä¸ºäº†æ»¡è¶³èµ„æºç®¡ç†çš„éœ€æ±‚ï¼Œè€Œéœ€è¦é™åˆ¶å½“å…ˆçº¿ç¨‹æ•°é‡çš„åº”ç”¨åœºæ™¯ï¼Œé€‚ç”¨äºè´Ÿè½½æ¯”è¾ƒé‡çš„æœåŠ¡å™¨ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public static ExecutorService es = Executors.newFixedThreadPool(int threadNums);
public static ExecutorService es = Executors.newFixedThreadPool(int threadNums, ThreadFactory threadFactory);
&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public static ExecutorService newFixedThreadPool(int nThreads) {
        return new ThreadPoolExecutor(nThreads, nThreads,
                                      0L, TimeUnit.MILLISECONDS,
                                      new LinkedBlockingQueue&amp;lt;Runnable&amp;gt;());
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æŠŠçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°é‡maxmumPoolSizeå’Œæ ¸å¿ƒçº¿ç¨‹æ± çš„æ•°é‡corePoolSizeè®¾ç½®ä¸º&lt;code&gt;threadNums&lt;/code&gt;ï¼Œå°†å‚æ•°keepAliveTimeè®¾ç½®ä¸º&lt;code&gt;0L&lt;/code&gt;ã€‚ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—&lt;code&gt;LinkedBlockingQueue&lt;/code&gt;ä½œä¸ºé˜»å¡é˜Ÿåˆ—ï¼Œå› æ­¤å½“ä»»åŠ¡ä¸èƒ½ç«‹åˆ»æ‰§è¡Œæ—¶ï¼Œéƒ½ä¼šæ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸”maximumPoolSizeï¼ŒkeepAliveTimeéƒ½æ˜¯æ— æ•ˆçš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;15&quot;&gt;
&lt;p&gt;&lt;strong&gt;SingleThreadExecutorï¼š&lt;/strong&gt;é€‚ç”¨äºéœ€è¦ä¿è¯é¡ºåºåœ°æ‰§è¡Œå„ä¸ªä»»åŠ¡ï¼›å¹¶ä¸”åœ¨ä»»æ„æ—¶é—´ç‚¹ï¼Œä¸ä¼šæœ‰å¤šä¸ªçº¿ç¨‹æ˜¯æ´»åŠ¨åœ°åº”ç”¨åœºæ™¯ã€‚**&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public static ExecutorService es = Executors.newSingleThreadExecutor();
public static ExecutorService es = Executors.newSingleThreadExecutor(ThreadFactory threadFactory);
&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public static ExecutorService newSingleThreadExecutor() {
        return new FinalizableDelegatedExecutorService
            (new ThreadPoolExecutor(1, 1,
                                    0L, TimeUnit.MILLISECONDS,
                                    new LinkedBlockingQueue&amp;lt;Runnable&amp;gt;()));
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å› ä¸ºé˜»å¡é˜Ÿåˆ—ä½¿ç”¨çš„æ˜¯&lt;code&gt;LinkedBlockingQueue&lt;/code&gt;ï¼Œå› æ­¤å’ŒFixedThreadPoolä¸€æ ·ï¼Œå‚æ•°maximumPoolSizeä»¥åŠkeepAliveTimeéƒ½æ˜¯æ— æ•ˆçš„ã€‚corePoolSizeä¸º&lt;code&gt;1&lt;/code&gt;ï¼Œå› æ­¤&lt;strong&gt;æœ€å¤šåªèƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;20&quot;&gt;
&lt;p&gt;&lt;strong&gt;CachedThreadPool&lt;/strong&gt;ï¼š&lt;strong&gt;å¤§å°æ— ç•Œçš„çº¿ç¨‹æ± ï¼Œé€‚ç”¨äºæ‰§è¡Œå¾ˆå¤šçš„çŸ­æœŸå¼‚æ­¥ä»»åŠ¡çš„å°ç¨‹åºï¼Œæˆ–è€…æ˜¯è´Ÿè½½è¾ƒè½»çš„æœåŠ¡å™¨ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public static ExecutorService es = Executors.newCachedThreadPool();
public static ExecutorService es = Executors.newCachedThreadPool(ThreadFactory threadFactory);
&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public static ExecutorService newCachedThreadPool() {
        return new ThreadPoolExecutor(0, Integer.MAX_VALUE,
                                      60L, TimeUnit.SECONDS,
                                      new SynchronousQueue&amp;lt;Runnable&amp;gt;());
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;CachedThreadPoolä½¿ç”¨&lt;code&gt;SynchronizedQueue&lt;/code&gt;ä½œä¸ºé˜»å¡é˜Ÿåˆ—ï¼ŒSynchronizedQueueæ˜¯ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œå®ç°&lt;strong&gt;â€œä¸€å¯¹ä¸€çš„äº¤ä»˜â€&lt;/strong&gt;ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡å‘é˜Ÿåˆ—ä¸­putä¸€ä¸ªä»»åŠ¡å¿…é¡»ç­‰æœ‰çº¿ç¨‹æ¥takeè¿™ä¸ªä»»åŠ¡ï¼Œå¦åˆ™å°±ä¼šä¸€ç›´é˜»å¡è¯¥ä»»åŠ¡ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è¦takeä¸€ä¸ªä»»åŠ¡å°±è¦ä¸€ç›´é˜»å¡çŸ¥é“æœ‰ä»»åŠ¡è¢«putè¿›é˜»å¡é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºCachedThreadPoolçš„maximumPoolSizeä¸º&lt;code&gt;Integer.MUX_VALUE&lt;/code&gt;ï¼Œå› æ­¤&lt;strong&gt;CachedThreadPoolæ˜¯æ— ç•Œçš„çº¿ç¨‹æ± ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥ä¸€ç›´ä¸æ–­çš„åˆ›å»ºçº¿ç¨‹ï¼Œè¿™æ ·å¯èƒ½ä¼šä½¿CPUå’Œå†…å­˜èµ„æºè€—å°½&lt;/strong&gt;ã€‚corePoolSizeä¸º&lt;code&gt;0&lt;/code&gt; ï¼Œå› æ­¤åœ¨&lt;strong&gt;CachedThreadPoolä¸­ç›´æ¥é€šè¿‡é˜»å¡é˜Ÿåˆ—æ¥è¿›è¡Œä»»åŠ¡çš„æäº¤&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;22-scheduledthreadpoolexecutor&quot;&gt;2.2 ScheduledThreadPoolExecutor&lt;/h4&gt;
&lt;p&gt;ScheduledThreadPoolExecutorç±»ç»§æ‰¿äº†ThreadPoolExecutorå¹¶å®ç°äº†ScheduledExecutorServiceæ¥å£ã€‚&lt;strong&gt;ä¸»è¦ç”¨äºåœ¨ç»™å®šçš„å»¶è¿Ÿåæ‰§è¡Œä»»åŠ¡æˆ–è€…å®šæœŸæ‰§è¡Œä»»åŠ¡ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ScheduledThreadPoolExecutoré€šå¸¸ä½¿ç”¨Executorså·¥å‚ç±»æ¥åˆ›å»ºï¼Œå¯åˆ›å»º2ç§ç±»å‹çš„ScheduledThreadPoolExecutorï¼Œå³ScheduledThreadPoolExecutorå’ŒSingleThreadScheduledExecutorã€‚&lt;/p&gt;
&lt;ul readability=&quot;5&quot;&gt;&lt;li readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;strong&gt;ScheduledThreadPoolExecutorï¼šé€‚ç”¨äºè‹¥å¹²ä¸ªï¼ˆå›ºå®šï¼‰çº¿ç¨‹å»¶æ—¶æˆ–è€…å®šæœŸæ‰§è¡Œä»»åŠ¡ï¼ŒåŒæ—¶ä¸ºäº†æ»¡è¶³èµ„æºç®¡ç†çš„éœ€æ±‚è€Œéœ€è¦é™åˆ¶åå°çº¿ç¨‹æ•°é‡çš„åœºæ™¯ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public static ScheduledExecutorService ses = Executors.newScheduledThreadPool(int threadNums);
public static ScheduledExecutorService ses = Executors.newScheduledThreadPool(int threadNums, ThreadFactory threadFactory);
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;strong&gt;SingleThreadScheduledExecutorï¼šé€‚ç”¨äºéœ€è¦å•ä¸ªçº¿ç¨‹å»¶æ—¶æˆ–è€…å®šæœŸçš„æ‰§è¡Œä»»åŠ¡ï¼ŒåŒæ—¶éœ€è¦ä¿è¯å„ä¸ªä»»åŠ¡é¡ºåºæ‰§è¡Œçš„åº”ç”¨åœºæ™¯ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public static ScheduledExecutorService ses = Executors.newSingleThreadScheduledExecutor(int threadNums);
public static ScheduledExecutorService ses = Executors.newSingleThreadScheduledExecutor(int threadNums, ThreadFactory threadFactory);
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;ScheduledThreadPoolExecutorçš„å®ç°ï¼š&lt;/p&gt;
&lt;p&gt;ScheduledThreadPoolExecutorçš„å®ç°ä¸»è¦æ˜¯é€šè¿‡&lt;strong&gt;æŠŠä»»åŠ¡å°è£…ä¸ºScheduledFutureTaskæ¥å®ç°&lt;/strong&gt;ã€‚é€šè¿‡è°ƒç”¨scheduledAtFixedTime()æ–¹æ³•æˆ–è€…scheduledWithFixedDelay()æ–¹æ³•å‘é˜»å¡é˜Ÿåˆ—æ·»åŠ ä¸€ä¸ªå®ç°äº†RunnableScheduledFutureTaskæ¥å£çš„ScheduledFutureTaskç±»å¯¹è±¡ã€‚ScheduledFutureTaskä¸»è¦åŒ…æ‹¬3ä¸ªæˆå‘˜å˜é‡ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;// åºåˆ—å·ï¼Œç”¨äºä¿å­˜ä»»åŠ¡æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—çš„é¡ºåº
private final long sequenceNumber;
// ç”¨äºä¿å­˜è¯¥ä»»åŠ¡å°†è¦è¢«æ‰§è¡Œçš„å…·ä½“æ—¶é—´
private long time;
// å‘¨æœŸï¼Œç”¨äºä¿å­˜ä»»åŠ¡ç›´çº¿çš„é—´éš”å‘¨æœŸ
private final long period;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ScheduledTreadPoolExecutorçš„é˜»å¡é˜Ÿåˆ—æ˜¯ç”¨&lt;strong&gt;æ— ç•Œé˜Ÿåˆ—&lt;/strong&gt;&lt;code&gt;DelayQueue&lt;/code&gt;å®ç°çš„ï¼Œå¯ä»¥å®ç°å…ƒç´ å»¶æ—¶delayTimeåæ‰èƒ½è·å–å…ƒç´ ï¼Œåœ¨ScheduledThreadPoolExecutorä¸­ï¼ŒDelayQueueå†…éƒ¨å°è£…äº†ä¸€ä¸ªPriorityQueueï¼Œæ¥å¯¹ä»»åŠ¡è¿›è¡Œæ’åºï¼Œé¦–å…ˆå¯¹timeæ’åºï¼Œtimeå°çš„åœ¨å‰ï¼Œå¦‚æœtimeä¸€æ ·ï¼Œåˆ™sequenceå°çš„åœ¨å‰ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœtimeä¸€æ ·ï¼Œé‚£ä¹ˆå…ˆè¢«æäº¤çš„ä»»åŠ¡å…ˆæ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºDelayQueueæ˜¯ä¸€ä¸ªæ— ç•Œçš„é˜Ÿåˆ—ï¼Œå› æ­¤çº¿ç¨‹æ± çš„maximumPoolSizeæ˜¯æ— æ•ˆçš„ã€‚ScheduledThreadPoolExecutorçš„å·¥ä½œæµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://chiaki.oss-cn-beijing.aliyuncs.com/image-20200820233614169.png&quot; alt=&quot;image-20200820233614169&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;23-futureæ¥å£futuretaskå®ç°ç±»&quot;&gt;2.3 Futureæ¥å£/FutureTaskå®ç°ç±»&lt;/h4&gt;
&lt;p&gt;Futureæ¥å£å’Œå®ç°Futureæ¥å£çš„FutureTaskå®ç°ç±»ï¼Œä»£è¡¨å¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚&lt;/p&gt;
&lt;h5 id=&quot;231-futuretaskçš„ä½¿ç”¨&quot;&gt;2.3.1 FutureTaskçš„ä½¿ç”¨&lt;/h5&gt;
&lt;p&gt;FutureTaské™¤äº†å®ç°Futureæ¥å£å¤–è¿˜å®ç°äº†Runnableæ¥å£ã€‚å› æ­¤ï¼ŒFutureTaskå¯ä»¥äº¤ç»™Executoræ‰§è¡Œï¼Œä¹Ÿå¯ä»¥æ¡ç”¨çº¿ç¨‹ç›´æ¥æ‰§è¡Œï¼ˆ&lt;code&gt;FutureTask.run()&lt;/code&gt;ï¼‰ã€‚æ ¹æ®FutureTask.run()æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶æœºï¼ŒFutureTaskå¯å¤„äºä»¥ä¸‹3ç§çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æœªå¯åŠ¨ï¼šåˆ›å»ºäº†ä¸€ä¸ªFutureTaskå¯¹è±¡ä½†æ²¡æœ‰æ‰§è¡ŒFutureTask.run()ï¼›&lt;/li&gt;
&lt;li&gt;å·²å¯åŠ¨ï¼šFutureTask.run()æ–¹æ³•è¢«æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;å·²å®Œæˆï¼šFutureTask.run()æ­£å¸¸æ‰§è¡Œç»“æŸï¼Œæˆ–è€…FutureTaskè¢«å–æ¶ˆï¼ˆ&lt;code&gt;FutureTask.cancel()&lt;/code&gt;ï¼‰ï¼Œæˆ–è€…æ‰§è¡ŒFutureTask.run()æ—¶æŠ›å‡ºå¼‚å¸¸è€Œå¼‚å¸¸ç»“æŸï¼›&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;çŠ¶æ€è¿ç§»ç¤ºæ„å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://chiaki.oss-cn-beijing.aliyuncs.com/image-20200820234612077.png&quot; alt=&quot;image-20200820234612077&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;FutureTaskçš„getå’Œcancleæ‰§è¡Œç¤ºæ„å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://chiaki.oss-cn-beijing.aliyuncs.com/image-20200820234818187.png&quot; alt=&quot;image-20200820234818187&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h5 id=&quot;232-futuretaskçš„å®ç°&quot;&gt;2.3.2 FutureTaskçš„å®ç°&lt;/h5&gt;
&lt;p&gt;&lt;strong&gt;FutureTaskæ˜¯ä¸€ä¸ªåŸºäºAQSåŒæ­¥é˜Ÿåˆ—å®ç°çš„ä¸€ä¸ªè‡ªå®šä¹‰åŒæ­¥ç»„ä»¶&lt;/strong&gt;ï¼Œé€šè¿‡å¯¹åŒæ­¥çŠ¶æ€stateçš„ç«äº‰å®ç°acquireæˆ–è€…releaseæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;FutureTaskçš„å†…éƒ¨ç±»Syncå®ç°äº†AQSæ¥å£ï¼Œé€šè¿‡&lt;strong&gt;å¯¹tryAcquireç­‰æŠ½è±¡æ–¹æ³•çš„é‡å†™å’Œæ¨¡æ¿æ–¹æ³•çš„è°ƒç”¨æ¥å®ç°å†…éƒ¨ç±»Syncçš„tryAcquireSharedç­‰æ–¹æ³•&lt;/strong&gt;ï¼Œç„¶åèšåˆSyncçš„æ–¹æ³•æ¥å®ç°FutureTaskçš„getå’Œcancelç­‰æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;FutureTaskçš„è®¾è®¡ç¤ºæ„å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://chiaki.oss-cn-beijing.aliyuncs.com/image-20200820235358434.png&quot; alt=&quot;image-20200820235358434&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;FutureTaskçš„getæ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨&lt;code&gt;AQS.acquireSharedInterruptibly(int arg)&lt;/code&gt;æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;è°ƒç”¨&lt;code&gt;AQS.acquireSharedInterruptibly(int arg)&lt;/code&gt;æ–¹æ³•ä¼šé¦–å…ˆè°ƒç”¨&lt;code&gt;tryAcquireShared()&lt;/code&gt;æ–¹æ³•åˆ¤æ–­acquireæ“ä½œæ˜¯å¦å¯ä»¥æˆåŠŸï¼Œå¯ä»¥æˆåŠŸçš„æ¡ä»¶æ˜¯stateä¸ºæ‰§è¡Œå®ŒæˆçŠ¶æ€RANæˆ–è€…å·²å–æ¶ˆçŠ¶æ€CANCELLEDï¼Œä¸”runnerä¸ä¸ºnullï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœæˆåŠŸåˆ™&lt;code&gt;get()&lt;/code&gt;æ–¹æ³•ç«‹å³è¿”å›ï¼Œå¦‚æœå¤±è´¥åˆ™åˆ°çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—æ‰§è¡Œreleaseæ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;å½“å…¶ä»–çº¿ç¨‹æ‰§è¡Œreleaseæ“ä½œå”¤é†’å½“å‰çº¿ç¨‹åï¼ˆæ¯”å¦‚&lt;code&gt;FutureTask.run()&lt;/code&gt;æˆ–&lt;code&gt;FutureTask.cancle(...)&lt;/code&gt;ï¼‰ï¼Œå½“å‰çº¿ç¨‹å†æ¬¡æ‰§è¡Œ&lt;code&gt;tryAcquireShared()&lt;/code&gt;å°†è¿”å›æ­£å€¼1ï¼Œå½“å‰çº¿ç¨‹ç¦»å¼€ç°åœºç­‰å¾…é˜Ÿåˆ—å¹¶å”¤é†’å®ƒçš„åç»§çº¿ç¨‹ï¼ˆçº§è”å”¤é†’ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;æœ€åè¿”å›è®¡ç®—çš„ç»“æœæˆ–æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://chiaki.oss-cn-beijing.aliyuncs.com/image-20200821000310543.png&quot; alt=&quot;image-20200821000310543&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h5 id=&quot;233-futuretaskçš„ä½¿ç”¨åœºæ™¯&quot;&gt;2.3.3 FutureTaskçš„ä½¿ç”¨åœºæ™¯&lt;/h5&gt;
&lt;ul&gt;&lt;li&gt;å½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æŠŠæŸä¸ªä»»åŠ¡æ‰§è¡Œå®Œä»¥åå®ƒæ‰èƒ½ç»§ç»­æ‰§è¡Œæ—¶ï¼›&lt;/li&gt;
&lt;li&gt;æœ‰è‹¥å¹²çº¿ç¨‹æ‰§è¡Œè‹¥å¹²ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡æœ€å¤šåªèƒ½è¢«æ‰§è¡Œä¸€æ¬¡ï¼›&lt;/li&gt;
&lt;li&gt;å½“å¤šä¸ªçº¿ç¨‹å¸ˆå¾’æ‰§è¡ŒåŒä¸€ä¸ªä»»åŠ¡ï¼Œä½†åªèƒ½å…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ­¤ä»»åŠ¡ï¼Œå…¶å®ƒçº¿ç¨‹éœ€è¦ç­‰è¿™ä¸ªä»»åŠ¡è¢«æ‰§è¡Œå®Œæ¯•ä»¥åæ‰èƒ½ç»§ç»­æ‰§è¡Œæ—¶ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;24-runnableå’Œcallableæ¥å£&quot;&gt;2.4 Runnableå’ŒCallableæ¥å£&lt;/h4&gt;
&lt;p&gt;ç”¨äºå®ç°çº¿ç¨‹è¦æ‰§è¡Œçš„å·¥ä½œå•å…ƒã€‚&lt;/p&gt;
&lt;h4 id=&quot;25-executorså·¥å‚ç±»&quot;&gt;2.5 Executorså·¥å‚ç±»&lt;/h4&gt;
&lt;p&gt;æä¾›äº†å¸¸è§é…ç½®çº¿ç¨‹æ± çš„æ–¹æ³•ï¼Œå› ä¸ºThreadPoolExecutorçš„å‚æ•°ä¼—å¤šä¸”æ„ä¹‰é‡å¤§ï¼Œä¸ºäº†é¿å…é…ç½®å‡ºé”™ï¼Œæ‰æœ‰äº†Executorså·¥å‚ç±»ã€‚&lt;/p&gt;
&lt;h3 id=&quot;3-ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨executorsåˆ›å»ºçº¿ç¨‹æ± ï¼Ÿ&quot;&gt;3. ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;FixedThreadPool&lt;/strong&gt;å’Œ&lt;strong&gt;SingleThreadExecutor&lt;/strong&gt;ï¼šå…è®¸è¯·æ±‚çš„é˜Ÿåˆ—é•¿åº¦ä¸ºInteger.MAX_VALUEï¼ˆæ— ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼‰ï¼Œå¯èƒ½å †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´OOMã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CachedThreadPool&lt;/strong&gt;å’Œ&lt;strong&gt;ScheduledThreadPool&lt;/strong&gt;ï¼šå…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸ºInteger.MAX_VALUEï¼ˆæ— ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼‰ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´OOMã€‚&lt;/p&gt;
</description>
<pubDate>Thu, 20 Aug 2020 16:18:00 +0000</pubDate>
<dc:creator>Chiakiiii</dc:creator>
<og:description>çº¿ç¨‹æ± ä¹‹Executoræ¡†æ¶ Javaçš„çº¿ç¨‹æ—¢æ˜¯å·¥ä½œå•å…ƒï¼Œä¹Ÿæ˜¯æ‰§è¡Œæœºåˆ¶ã€‚ä»JDK5å¼€å§‹ï¼ŒæŠŠå·¥ä½œæœºå•å…ƒå’Œæ‰§è¡Œæœºåˆ¶åˆ†ç¦»å¼€æ¥ã€‚å·¥ä½œå•å…ƒåŒ…æ‹¬Runnableå’ŒCallableï¼Œè€Œæ‰§è¡Œæœºåˆ¶ç”±Executoræ¡†æ¶</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/chiaki/p/13538829.html</dc:identifier>
</item>
<item>
<title>Kerasç»“åˆKerasåç«¯æ­å»ºä¸ªæ€§åŒ–ç¥ç»ç½‘ç»œæ¨¡å‹ï¼ˆä¸ç”¨åŸç”ŸTensorflowï¼‰ - é¢€å‘¨</title>
<link>http://www.cnblogs.com/qizhou/p/13530440.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/qizhou/p/13530440.html</guid>
<description>&lt;p&gt;ã€€ã€€Kerasæ˜¯åŸºäºTensorflowç­‰åº•å±‚å¼ é‡å¤„ç†åº“çš„é«˜çº§APIåº“ã€‚å®ƒå¸®æˆ‘ä»¬å®ç°äº†ä¸€ç³»åˆ—ç»å…¸çš„ç¥ç»ç½‘ç»œå±‚ï¼ˆå…¨è¿æ¥å±‚ã€å·ç§¯å±‚ã€å¾ªç¯å±‚ç­‰ï¼‰ï¼Œä»¥åŠç®€æ´çš„è¿­ä»£æ¨¡å‹çš„æ¥å£ï¼Œè®©æˆ‘ä»¬èƒ½åœ¨æ¨¡å‹å±‚é¢å†™ä»£ç ï¼Œä»è€Œä¸ç”¨ä»”ç»†è€ƒè™‘æ¨¡å‹å„å±‚å¼ é‡ä¹‹é—´çš„æ•°æ®æµåŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬æœ‰äº†å…¨æ–°çš„æƒ³æ³•ï¼Œæƒ³è¦ä¸ªæ€§åŒ–æ¨¡å‹å±‚çš„å®ç°ï¼ŒKerasçš„é«˜çº§APIæ˜¯ä¸èƒ½æ»¡è¶³è¿™ä¸€è¦æ±‚çš„ï¼Œè€Œæ¢æˆTensorflowåˆè¦é‡æ–°å†™å¾ˆå¤šè½®å­ï¼Œè¿™æ—¶ï¼ŒKerasçš„åç«¯å°±æ´¾ä¸Šç”¨åœºäº†ã€‚Keraså°†åº•å±‚å¼ é‡åº“çš„å‡½æ•°åŠŸèƒ½ç»Ÿä¸€å°è£…åœ¨â€œbackendâ€ä¸­ï¼Œç”¨æˆ·å¯ä»¥ç”¨ç»Ÿä¸€çš„å‡½æ•°æ¥å£è°ƒç”¨ä¸åŒçš„åç«¯å®ç°çš„ç›¸åŒåŠŸèƒ½ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸è¿½æ±‚é€Ÿåº¦çš„è¯ï¼Œå¯ä»¥ä»…ä½¿ç”¨Keraså®ç°ä½ çš„ä»»ä½•ç‹¬ç‰¹æƒ³æ³•ï¼Œä»è€Œé¿å…ä½¿ç”¨åŸç”ŸTensorflowå†™é‡å¤çš„è½®å­ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€æˆ‘ä»¬å®šä¹‰å¹¶è®­ç»ƒä¸€ä¸ªç¥ç»ç½‘ç»œæ¨¡å‹éœ€è¦è€ƒè™‘çš„è¦ç´ æœ‰ä¸‰ä¸ªï¼šå±‚ã€æŸå¤±å‡½æ•°ã€ä¼˜åŒ–å™¨ã€‚è€Œæˆ‘ä»¬åˆ›æ–°ä¸»è¦åœ¨äºå‰ä¸¤ä¸ªï¼Œå› æ­¤ä¸‹é¢ä»‹ç»å¦‚ä½•ç»“åˆKerasé«˜çº§APIä¸åç«¯ï¼Œè‡ªå®šä¹‰ç‰¹æ®Šç¥ç»ç½‘ç»œå±‚ä»¥åŠæŸå¤±å‡½æ•°ã€‚&lt;/p&gt;

&lt;p&gt;ã€€ã€€è‡ªå®šä¹‰å±‚å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°ï¼šä½¿ç”¨Lambdaå±‚å’Œç»§æ‰¿Layerç±»ã€‚&lt;/p&gt;
&lt;h2&gt;lambdaå±‚&lt;/h2&gt;
&lt;p&gt;ã€€ã€€Lambdaå±‚ä»…èƒ½å¯¹è¾“å…¥åš&lt;strong&gt;å›ºå®šçš„å˜æ¢&lt;/strong&gt;ï¼Œå¹¶ä¸èƒ½å®šä¹‰å¯ä»¥é€šè¿‡åå‘ä¼ æ’­è®­ç»ƒçš„å‚æ•°ï¼ˆé€šè¿‡Kerasçš„fitè®­ç»ƒï¼‰ï¼Œå› æ­¤èƒ½å®ç°çš„ä¸œè¥¿è¾ƒå°‘ã€‚ä»¥ä¸‹ä»£ç å®ç°äº†Dropoutçš„åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;from&lt;/span&gt; keras &lt;span&gt;import&lt;/span&gt;&lt;span&gt; backend as K
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; keras &lt;span&gt;import&lt;/span&gt;&lt;span&gt; layers

&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; my_layer(x):     
  mask &lt;/span&gt;= K.random_binomial(K.shape(x),0.5&lt;span&gt;)
  &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; x*mask*2&lt;span&gt;
x &lt;/span&gt;= layers.Lambda(my_layer)(x) 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€å…¶ä¸­my_layerå‡½æ•°æ˜¯è‡ªå®šä¹‰å±‚è¦å®ç°çš„æ“ä½œï¼Œä¼ é€’å‚æ•°åªèƒ½æ˜¯Lambdaå±‚çš„è¾“å…¥ã€‚å®šä¹‰å¥½å‡½æ•°åï¼Œç›´æ¥åœ¨layers.Lambdaä¸­ä¼ å…¥å‡½æ•°å¯¹è±¡å³å¯ã€‚å®é™…ä¸Šï¼Œè¿™äº›å˜æ¢ä¸æ•´åˆåœ¨lambdaå±‚ä¸­è€Œç›´æ¥å†™åœ¨å¤–é¢ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;from&lt;/span&gt; keras &lt;span&gt;import&lt;/span&gt;&lt;span&gt; backend as K
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; keras &lt;span&gt;import&lt;/span&gt;&lt;span&gt; layers

x &lt;/span&gt;= layers.Dense(500,activation=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;relu&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)(x) 
mask &lt;/span&gt;=&lt;span&gt; K.random_binomial(K.shape(x),0.5)
x &lt;/span&gt;= x*mask*2
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æ•°æ®å…ˆç»è¿‡ä¸€ä¸ªå…¨è¿æ¥å±‚ï¼Œç„¶åå†è¢«0.5æ¦‚ç‡Dropoutã€‚ä»¥ä¸Šå®ç°Dropoutåªæ˜¯ä½œä¸¾ä¾‹ï¼Œä½ å¯ä»¥ä»¥åŒæ ·çš„æ–¹å¼å®ç°å…¶å®ƒçš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;h2&gt;ç»§æ‰¿layerç±»&lt;/h2&gt;
&lt;p&gt;ã€€ã€€å¦‚æœä½ æƒ³è‡ªå®šä¹‰å¯ä»¥è®­ç»ƒå‚æ•°çš„å±‚ï¼Œå°±éœ€è¦ç»§æ‰¿å®ç°Kerasçš„æŠ½è±¡ç±»Layerã€‚ä¸»è¦å®ç°ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;ã€€ã€€&lt;strong&gt;1ã€__init__(self, *args, **kwargs)&lt;/strong&gt;ï¼šæ„é€ å‡½æ•°ï¼Œåœ¨å®ä¾‹åŒ–å±‚æ—¶è°ƒç”¨ã€‚æ­¤æ—¶è¿˜æ²¡æœ‰æ·»åŠ è¾“å…¥ï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶è¾“å…¥è§„æ¨¡æœªçŸ¥ï¼Œä½†å¯ä»¥å®šä¹‰è¾“å‡ºè§„æ¨¡ç­‰ä¸è¾“å…¥æ— å…³çš„å˜é‡ã€‚ç±»æ¯”äºDenseå±‚é‡Œçš„unitsã€activationså‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€2ã€build(self, input_shape)&lt;/strong&gt;ï¼šåœ¨æ·»åŠ è¾“å…¥æ—¶è°ƒç”¨ï¼ˆ__init__ä¹‹åï¼‰ï¼Œä¸”å‚æ•°åªèƒ½ä¼ å…¥è¾“å…¥è§„æ¨¡input_shapeã€‚æ­¤æ—¶è¾“å…¥è§„æ¨¡ä¸è¾“å‡ºè§„æ¨¡éƒ½å·²çŸ¥ï¼Œå¯ä»¥å®šä¹‰è®­ç»ƒå‚æ•°ï¼Œæ¯”å¦‚å…¨è¿æ¥å±‚çš„æƒé‡wå’Œåæ‰§bã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€&lt;strong&gt;3ã€call(self, *args, **kwargs)&lt;/strong&gt;ï¼šç¼–å†™å±‚çš„åŠŸèƒ½é€»è¾‘ã€‚&lt;/p&gt;
&lt;h3&gt;å•ä¸€è¾“å…¥&lt;/h3&gt;
&lt;p&gt;ã€€ã€€å½“è¾“å…¥å¼ é‡åªæœ‰ä¸€ä¸ªæ—¶ï¼Œä¸‹é¢æ˜¯å®ç°å…¨è¿æ¥å±‚çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;51&quot;&gt;
&lt;pre&gt;
&lt;span&gt;import&lt;/span&gt;&lt;span&gt; numpy as np
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; keras &lt;span&gt;import&lt;/span&gt;&lt;span&gt; layers,Model,Input,utils
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; keras &lt;span&gt;import&lt;/span&gt;&lt;span&gt; backend as K
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; tensorflow as tf

&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; MyDense(layers.Layer): 
  &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;(self, units=32): &lt;span&gt;#&lt;/span&gt;&lt;span&gt;åˆå§‹åŒ–&lt;/span&gt;
    super(MyDense, self).&lt;span&gt;__init__&lt;/span&gt;()&lt;span&gt;#&lt;/span&gt;&lt;span&gt;åˆå§‹åŒ–çˆ¶ç±»&lt;/span&gt;
    self.units = units  &lt;span&gt;#&lt;/span&gt;&lt;span&gt;å®šä¹‰è¾“å‡ºè§„æ¨¡&lt;/span&gt;
  &lt;span&gt;def&lt;/span&gt; build(self, input_shape):   &lt;span&gt;#&lt;/span&gt;&lt;span&gt;å®šä¹‰è®­ç»ƒå‚æ•°&lt;/span&gt;
    self.w = K.variable(K.random_normal(shape=[input_shape[-1],self.units]))  &lt;span&gt;#&lt;/span&gt;&lt;span&gt;è®­ç»ƒå‚æ•°&lt;/span&gt;
    self.b = tf.Variable(K.random_normal(shape=[self.units]),trainable=True)  &lt;span&gt;#&lt;/span&gt;&lt;span&gt;è®­ç»ƒå‚æ•°&lt;/span&gt;
    self.a = tf.Variable(K.random_normal(shape=[self.units]),trainable=False) &lt;span&gt;#&lt;/span&gt;&lt;span&gt;éè®­ç»ƒå‚æ•°&lt;/span&gt;
  &lt;span&gt;def&lt;/span&gt; call(self, inputs): &lt;span&gt;#&lt;/span&gt;&lt;span&gt;åŠŸèƒ½å®ç°&lt;/span&gt;
    &lt;span&gt;return&lt;/span&gt; K.dot(inputs, self.w) +&lt;span&gt; self.b
  
&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;å®šä¹‰æ¨¡å‹&lt;/span&gt;
input_feature = Input([None,28,28&lt;span&gt;]) 
x &lt;/span&gt;= layers.Reshape(target_shape=[28*28&lt;span&gt;])(input_feature)
x &lt;/span&gt;= layers.Dense(500,activation=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;relu&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)(x)  
x &lt;/span&gt;= MyDense(100&lt;span&gt;)(x)
x &lt;/span&gt;= layers.Dense(10,activation=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;softmax&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)(x) 
  
model &lt;/span&gt;=&lt;span&gt; Model(input_feature,x) 
model.summary() &lt;br/&gt;utils.plot_model(model)&lt;br/&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æ¨¡å‹ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;table border=&quot;0&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1908255/202008/1908255-20200820223347734-452616859.png&quot; alt=&quot;&quot; width=&quot;494&quot; height=&quot;273&quot; loading=&quot;lazy&quot;/&gt;&lt;/td&gt;
&lt;td&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1908255/202008/1908255-20200820233136265-368910824.png&quot; alt=&quot;&quot; width=&quot;167&quot; height=&quot;273&quot; loading=&quot;lazy&quot;/&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;ã€€ã€€åœ¨build()ä¸­ï¼Œè®­ç»ƒå‚æ•°å¯ä»¥ç”¨K.variableæˆ–tf.Variableå®šä¹‰ã€‚å¹¶ä¸”ï¼Œåªè¦æ˜¯ç”¨è¿™ä¸¤ä¸ªå‡½æ•°å®šä¹‰å¹¶å­˜å…¥selfä¸­ï¼Œå°±ä¼šè¢«kerasè®¤å®šä¸ºè®­ç»ƒå‚æ•°ï¼Œä¸ç®¡æ˜¯åœ¨buildè¿˜æ˜¯__init__æˆ–æ˜¯å…¶å®ƒå‡½æ•°ä¸­å®šä¹‰ã€‚ä½†æ˜¯K.variableæ²¡æœ‰trainableå‚æ•°ï¼Œä¸èƒ½è®¾ç½®ä¸ºNon-trainable paramsï¼Œæ‰€ä»¥è¿˜æ˜¯ç”¨tf.Variableæ›´å¥½æ›´çµæ´»äº›ã€‚&lt;/p&gt;
&lt;h3&gt;å¤šæºè¾“å…¥&lt;/h3&gt;
&lt;p&gt;ã€€ã€€å¦‚æœè¾“å…¥åŒ…æ‹¬å¤šä¸ªå¼ é‡ï¼Œéœ€è¦ä¼ å…¥å¼ é‡åˆ—è¡¨ã€‚å®ç°ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt;import&lt;/span&gt;&lt;span&gt; numpy as np
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; keras &lt;span&gt;import&lt;/span&gt;&lt;span&gt; layers,Model,Input,utils
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; keras &lt;span&gt;import&lt;/span&gt;&lt;span&gt; backend as K
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; tensorflow as tf

&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; MyLayer(layers.Layer): 
  &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;&lt;span&gt;(self, output_dims):
    super(MyLayer, self).&lt;/span&gt;&lt;span&gt;__init__&lt;/span&gt;&lt;span&gt;()  
    self.output_dims &lt;/span&gt;=&lt;span&gt; output_dims
  &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; build(self, input_shape):  
    [dim1,dim2] &lt;/span&gt;=&lt;span&gt; self.output_dims
    self.w1 &lt;/span&gt;= tf.Variable(K.random_uniform(shape=[input_shape[0][-1&lt;span&gt;],dim1]))
    self.b1 &lt;/span&gt;= tf.Variable(K.random_uniform(shape=&lt;span&gt;[dim1]))  
    self.w2 &lt;/span&gt;= tf.Variable(K.random_uniform(shape=[input_shape[1][-1&lt;span&gt;],dim2])) 
    self.b2 &lt;/span&gt;= tf.Variable(K.random_uniform(shape=&lt;span&gt;[dim2])) 
  &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; call(self, x): 
    [x1, x2] &lt;/span&gt;=&lt;span&gt; x
    y1 &lt;/span&gt;= K.dot(x1, self.w1)+&lt;span&gt;self.b1 
    y2 &lt;/span&gt;= K.dot(x2, self.w2)+&lt;span&gt;self.b2
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; K.concatenate([y1,y2],axis = -1&lt;span&gt;)
 
&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;å®šä¹‰æ¨¡å‹&lt;/span&gt;
input_feature = Input([None,28,28])&lt;span&gt;#&lt;/span&gt;&lt;span&gt;è¾“å…¥&lt;/span&gt;
x = layers.Reshape(target_shape=[28*28&lt;span&gt;])(input_feature) 
x1 &lt;/span&gt;= layers.Dense(500,activation=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;relu&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)(x)  
x2 &lt;/span&gt;= layers.Dense(500,activation=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;relu&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)(x)  
x &lt;/span&gt;= MyLayer([100,80&lt;span&gt;])([x1,x2])   
x &lt;/span&gt;= layers.Dense(10,activation=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;softmax&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)(x) 
  
model &lt;/span&gt;=&lt;span&gt; Model(input_feature,x) 
model.summary() 
utils.plot_model(model,show_layer_names&lt;/span&gt;=False,show_shapes=True)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æ¨¡å‹ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1908255/202008/1908255-20200820232953967-305129242.png&quot; alt=&quot;&quot; width=&quot;308&quot; height=&quot;334&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€æ€»ä¹‹ï¼Œä¼ å…¥å¼ é‡åˆ—è¡¨ï¼Œbuildä¼ å…¥çš„input_shapeå°±æ˜¯å„ä¸ªå¼ é‡å½¢çŠ¶çš„åˆ—è¡¨ã€‚å…¶å®ƒéƒ½ä¸å•ä¸€è¾“å…¥ç±»ä¼¼ã€‚&lt;/p&gt;

&lt;p&gt;ã€€ã€€æ ¹æ®Kerasèƒ½æ·»åŠ è‡ªå®šä¹‰æŸå¤±çš„ç‰¹æ€§ï¼Œè¿™é‡Œå°†æ·»åŠ æŸå¤±çš„æ–¹æ³•åˆ†ä¸ºä¸¤ç±»ï¼š&lt;/p&gt;
&lt;p&gt;ã€€ã€€1ã€æŸå¤±éœ€è¦æ ¹æ®æ¨¡å‹è¾“å‡ºä¸çœŸå®æ ‡ç­¾æ¥è®¡ç®—ï¼Œä¹Ÿå°±æ˜¯åªæœ‰æ¨¡å‹çš„è¾“å‡ºä¸å¤–éƒ¨çœŸå®æ ‡ç­¾ä½œä¸ºè®¡ç®—æŸå¤±çš„å‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€2ã€æŸå¤±æ— éœ€ä½¿ç”¨å¤–éƒ¨çœŸå®æ ‡ç­¾ï¼Œä¹Ÿå°±æ˜¯åªç”¨æ¨¡å‹å†…éƒ¨å„å±‚çš„è¾“å‡ºä½œä¸ºè®¡ç®—æŸå¤±çš„å‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€è¿™ä¸¤ç±»æŸå¤±æ·»åŠ çš„æ–¹å¼å¹¶ä¸ä¸€æ ·ï¼Œå¸Œæœ›ä»¥åKerasèƒ½æŠŠAPIå†æ”¹å–„ä¸€ä¸‹ï¼Œè¿™ç§å†—ä½™æœ‰æ—¶è®©äººæ‘¸ä¸ç€å¤´è„‘ã€‚&lt;/p&gt;
&lt;h2&gt;ç¬¬ä¸€ç±»æŸå¤±&lt;/h2&gt;
&lt;p&gt;ã€€ã€€è¿™ç±»æŸå¤±å¯ä»¥é€šè¿‡è‡ªå®šä¹‰å‡½æ•°çš„å½¢å¼æ¥å®ç°ã€‚å‡½æ•°çš„å‚æ•°å¿…é¡»æ˜¯ä¸¤ä¸ªï¼šçœŸå®æ ‡ç­¾ä¸æ¨¡å‹è¾“å‡ºï¼Œä¸èƒ½å¤šä¹Ÿä¸èƒ½å°‘ï¼Œå¹¶ä¸”é¡ºåºä¸èƒ½å˜ã€‚ç„¶åä½ å¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°ä¸­å®šä¹‰ä½ æƒ³è¦çš„å…³äºè¾“å‡ºä¸çœŸå®æ ‡ç­¾ä¹‹é—´çš„æŸå¤±ã€‚ç„¶ååœ¨model.compile()ä¸­å°†è¿™ä¸ªå‡½æ•°å¯¹è±¡ä¼ ç»™losså‚æ•°ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼ˆ&lt;a href=&quot;https://stackoverflow.com/questions/45961428/make-a-custom-loss-function-in-keras&quot; target=&quot;_blank&quot;&gt;å‚è€ƒé“¾æ¥&lt;/a&gt;ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
def&lt;span&gt; customed_loss(true_label,predict_label): 
  loss =&lt;span&gt; keras.losses.categorical_crossentropy(true_label,predict_label)  
  loss +=&lt;span&gt; K.max(predict_label)
  return&lt;span&gt; loss

model.compile(optimizer='rmsprop', loss=customed_loss)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€å¦‚æœç¡¬æ˜¯æƒ³ç”¨è¿™ç§æ–¹æ³•æŠŠæ¨¡å‹éšå±‚çš„è¾“å‡ºæ‹¿æ¥ç®—æŸå¤±çš„è¯ï¼Œä¹Ÿä¸æ˜¯ä¸å¯ä»¥ã€‚åªè¦æŠŠç›¸åº”éšå±‚çš„è¾“å‡ºæ·»åŠ åˆ°æ¨¡å‹çš„è¾“å‡ºåˆ—è¡¨ä¸­ï¼Œè‡ªå®šä¹‰æŸå¤±å‡½æ•°å°±å¯ä»¥ä»æ¨¡å‹è¾“å‡ºåˆ—è¡¨ä¸­å–å‡ºéšå±‚è¾“å‡ºæ¥ç”¨äº†ã€‚å³ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
model = Model(input,[model_output, hidden_layer_output])
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€å½“ç„¶ï¼Œè¿™æ ·å°±æŠŠæ¨¡å‹ç»“æ„æ”¹äº†ï¼Œå¦‚æœä¸æƒ³æ”¹æ¨¡å‹çš„ç»“æ„è€Œæ·»åŠ â€œæ­£åˆ™åŒ–â€æŸå¤±ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2&gt;ç¬¬äºŒç±»æŸå¤±&lt;/h2&gt;
&lt;p&gt;ã€€ã€€è¿™ç±»æŸå¤±å¯ä»¥ç”¨Model.add_loss(loss)æ–¹æ³•å®ç°ï¼Œlosså¯ä»¥ä½¿ç”¨Kerasåç«¯å®šä¹‰è®¡ç®—å›¾æ¥å®ç°ã€‚ä½†æ˜¯æ˜¾ç„¶ï¼Œè®¡ç®—å›¾å¹¶ä¸èƒ½æŠŠæœªæ¥è®­ç»ƒç”¨çš„çœŸå®æ ‡ç­¾ä¼ å…¥ï¼Œæ‰€ä»¥ï¼Œadd_lossæ–¹æ³•åªèƒ½è®¡ç®—æ¨¡å‹å†…éƒ¨çš„â€œæ­£åˆ™åŒ–â€æŸå¤±ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€add_lossæ–¹æ³•å¯ä»¥ä½¿ç”¨å¤šæ¬¡ï¼ŒæŸå¤±å°±æ˜¯å¤šæ¬¡æ·»åŠ çš„lossä¹‹å’Œã€‚ä½¿ç”¨äº†add_lossæ–¹æ³•åï¼Œcompileä¸­å°±å¯ä»¥ä¸ç”¨ç»™lossèµ‹å€¼ï¼Œä¸ç»™lossèµ‹å€¼çš„è¯ä½¿ç”¨fit()æ—¶å°±ä¸èƒ½ä¼ å…¥æ•°æ®çš„æ ‡ç­¾ï¼Œä¹Ÿå°±æ˜¯y_trainã€‚å¦‚æœç»™compileçš„lossèµ‹å€¼ï¼Œæœ€ç»ˆçš„ç›®æ ‡æŸå¤±å°±æ˜¯å¤šæ¬¡add_lossæ·»åŠ çš„losså’Œcompileä¸­lossä¹‹å’Œã€‚å¦å¤–ï¼Œå¦‚æœè¦ç»™å„é¡¹æŸå¤±åŠ æƒé‡çš„è¯ï¼Œç›´æ¥åœ¨å®šä¹‰lossçš„æ—¶å€™åŠ ä¸Šå³å¯ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
loss = 100000*K.mean(K.square(somelayer_output))#somelayer_outputæ˜¯å®šä¹‰modelæ—¶è·å¾—çš„æŸå±‚è¾“å‡º
&lt;span&gt;model.add_loss(loss)
model.compile(optimizer='rmsprop')&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€ä»¥ä¸Šè®²çš„éƒ½æ˜¯å…³äºå±‚è¾“å‡ºçš„æŸå¤±ï¼Œå±‚æƒé‡çš„æ­£åˆ™åŒ–æŸå¤±å¹¶ä¸è¿™æ ·æ·»åŠ ï¼Œè‡ªå®šä¹‰æ­£åˆ™é¡¹å¯ä»¥çœ‹ä¸‹é¢ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€&lt;a href=&quot;https://blog.csdn.net/qq_34840129/article/details/89083624&quot;&gt;kerasä¸­æ·»åŠ æ­£åˆ™åŒ–_Bebrçš„åšå®¢-CSDNåšå®¢_keras æ­£åˆ™åŒ–&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€é‡Œé¢ä»‹ç»äº†å·²å®ç°å±‚çš„è‡ªå®šä¹‰æ­£åˆ™åŒ–ï¼Œä½†æ²¡æœ‰ä»‹ç»è‡ªå®šä¹‰å±‚çš„è‡ªå®šä¹‰æ­£åˆ™åŒ–ï¼Œè¿™é‡Œå…ˆæŒ–ä¸ªå‘ï¼Œä»¥åè¦ç”¨å†ç ”ç©¶ã€‚&lt;/p&gt;
</description>
<pubDate>Thu, 20 Aug 2020 15:51:00 +0000</pubDate>
<dc:creator>é¢€å‘¨</dc:creator>
<og:description>Kerasæ˜¯åŸºäºTensorflowç­‰åº•å±‚å¼ é‡å¤„ç†åº“çš„é«˜çº§APIåº“ã€‚å®ƒå¸®æˆ‘ä»¬å®ç°äº†ä¸€ç³»åˆ—ç»å…¸çš„ç¥ç»ç½‘ç»œå±‚ï¼ˆå…¨è¿æ¥å±‚ã€å·ç§¯å±‚ã€å¾ªç¯å±‚ç­‰ï¼‰ï¼Œä»¥åŠç®€æ´çš„è¿­ä»£æ¨¡å‹çš„æ¥å£ï¼Œè®©æˆ‘ä»¬èƒ½åœ¨æ¨¡å‹å±‚é¢å†™ä»£ç ï¼Œä»è€Œä¸ç”¨ä»”ç»†</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/qizhou/p/13530440.html</dc:identifier>
</item>
<item>
<title>Hyperledger Fabric æ‰‹åŠ¨æ­å»ºã€åŒºå—é“¾å­¦ä¹ ä¸‰ã€‘ - æ™¨æ›¦001</title>
<link>http://www.cnblogs.com/chenxi001/p/13509829.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/chenxi001/p/13509829.html</guid>
<description>&lt;blockquote readability=&quot;6.1393442622951&quot;&gt;
&lt;p&gt;å‰é¢æˆ‘ä»¬å­¦ä¹ äº†&lt;a href=&quot;https://www.cnblogs.com/chenxi001/p/13496269.html&quot;&gt;åŒºå—é“¾æ˜¯ä»€ä¹ˆ&lt;/a&gt;ã€è¿˜æœ‰&lt;a href=&quot;https://www.cnblogs.com/chenxi001/p/13472111.html&quot;&gt;è‡ªåŠ¨æ­å»º&lt;/a&gt;å­¦ä¹ ä¸œè¥¿æˆ‘ä»¬å°±è¦ä»ç®€å•åˆ°æ·±å…¥ï¼ˆå…¥é—¨åˆ°æ”¾å¼ƒï¼‰ï¼Œç°åœ¨è‡ªåŠ¨éƒ¨ç½²å·²ç»è·‘é€šäº†æ¥ä¸‹æ¥å°±æ˜¯æ‰‹åŠ¨æ­å»ºFabric ç½‘ç»œå¯ä»¥æ›´å¥½çš„ç†è§£ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ä½¿ç”¨cryptogenï¼ˆå¯†ç ç”Ÿæˆå™¨ï¼‰å’Œconfigtxgenï¼ˆé…ç½®äº¤æ˜“ç”Ÿæˆå™¨ï¼‰æ‰‹åŠ¨ç”Ÿæˆè¯ä¹¦å¯†é’¥å’Œå„ç§é…ç½®æ„ä»¶ï¼ˆç­‰åŒäºæ‰§è¡Œbyfnsh-generateï¼‰&quot;&gt;ä½¿ç”¨cryptogenï¼ˆå¯†ç ç”Ÿæˆå™¨ï¼‰å’Œconfigtxgenï¼ˆé…ç½®äº¤æ˜“ç”Ÿæˆå™¨ï¼‰æ‰‹åŠ¨ç”Ÿæˆè¯ä¹¦/å¯†é’¥å’Œå„ç§é…ç½®æ„ä»¶ï¼ˆç­‰åŒäºæ‰§è¡Œ./byfn.sh generateï¼‰&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;å¯†é’¥ç”Ÿæˆå™¨ cryptogen
&lt;ul&gt;&lt;li&gt;cryptogen å·¥å…·ä¸ºæˆ‘ä»¬çš„ç½‘ç»œå®ä½“ç”Ÿæˆå„ç§åŠ å¯†ææ–™ï¼ˆ x509 è¯ä¹¦å’Œç­¾åç§˜é’¥ï¼‰ã€‚è¿™äº›è¯ä¹¦æ˜¯èº«ä»½çš„ä»£è¡¨ï¼Œåœ¨å®ä½“ä¹‹é—´é€šä¿¡å’Œäº¤æ˜“çš„æ—¶å€™ï¼Œå®ƒä»¬å…è®¸å¯¹èº«ä»½éªŒè¯è¿›è¡Œç­¾åå’ŒéªŒè¯&lt;/li&gt;
&lt;li&gt;crypto-config.yamlï¼Œä¸ºæ‰€æœ‰ç»„ç»‡å’Œå±äºè¿™äº›ç»„ç»‡çš„ç»„ä»¶ç”Ÿæˆä¸€ç»„è¯ä¹¦å’Œç§˜é’¥ã€‚æ¯ä¸€ä¸ªç»„ç»‡è¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æ ¹è¯ä¹¦ï¼ˆca-certï¼‰ï¼Œå®ƒç»‘å®šè¯¥ç»„ç»‡çš„ç‰¹å®šç»„ä»¶ï¼ˆPeer èŠ‚ç‚¹å’Œæ’åºèŠ‚ç‚¹ï¼‰ã€‚é€šè¿‡ä¸ºæ¯ä¸ªç»„ç»‡åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ CA è¯ä¹¦ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿäº†ä¸€ä¸ªå…¸å‹çš„ç½‘ç»œï¼Œç½‘ç»œä¸­çš„æˆå‘˜å¯ä»¥ä½¿ç”¨å®ƒè‡ªå·±çš„è¯ä¹¦æˆæƒä¸­å¿ƒã€‚Fabric ä¸­çš„äº‹åŠ¡å’Œé€šä¿¡ç”±ä¸€ä¸ªå®ä½“çš„ç§é’¥ï¼ˆkeystoreï¼‰ç­¾åï¼Œç„¶åé€šè¿‡å…¬é’¥ï¼ˆsigncertsï¼‰éªŒè¯ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;# crypto-config.yaml æ–‡ä»¶ç»“æ„
OrdererOrgs:    #å®šä¹‰ä¸€ä¸ªOrderç»„ç»‡
  - Name: Orderer    #orderèŠ‚ç‚¹çš„åç§°,å½“å‰ç½‘ç»œæ¨¡å¼ä¸ºsoloç±»å‹ï¼Œæ‰€ä»¥åªå®šä¹‰äº†ä¸€ä¸ªOrderèŠ‚ç‚¹
    Domain: example.com    #orderèŠ‚ç‚¹çš„åŸŸ
    Specs:      #æš‚æ—¶ç”¨ä¸åˆ°
      - Hostname: orderer
      - Hostname: orderer2
      - Hostname: orderer3
      - Hostname: orderer4
      - Hostname: orderer5

PeerOrgs:      #å®šä¹‰Peerç»„ç»‡
  - Name: Org1      #å£°æ˜Peerç»„ç»‡åç§°ä¸ºOrg1
    Domain: org1.example.com    #Org1ç»„ç»‡çš„åŸŸ
    EnableNodeOUs: true    #æš‚æ—¶æ²¡ææ¸…æ¥šè¯¥å­—æ®µçš„æ„ä¹‰
    Template:       #åœ¨è¿™é‡Œå¯ä»¥å®šä¹‰æ‰€ç”Ÿæˆçš„Org1ç»„ç»‡ä¸­çš„PeerèŠ‚ç‚¹è¯ä¹¦æ•°é‡ï¼Œä¸åŒ…æ‹¬Admin
      Count: 2      #è¡¨æ˜éœ€è¦ç”Ÿæˆä¸¤ä¸ªPeerèŠ‚ç‚¹çš„è¯ä¹¦ï¼Œå¦‚æœéœ€è¦å…¶ä»–æ•°é‡çš„PeerèŠ‚ç‚¹ï¼Œåªéœ€è¦æ›´æ”¹è¿™é‡Œçš„æ•°é‡ã€‚
    Users:        #åœ¨è¿™é‡Œå¯ä»¥å®šä¹‰æ‰€ç”Ÿæˆçš„Org1ç»„ç»‡ä¸­ç±»å‹ä¸ºUserçš„è¯ä¹¦æ•°é‡ï¼Œä¸åŒ…æ‹¬Admin
      Count: 1    #ç”Ÿæˆç”¨æˆ·çš„è¯ä¹¦çš„æ•°é‡

  - Name: Org2   #å£°æ˜ç¬¬äºŒä¸ªPeerç»„ç»‡åç§°ä¸ºOrg2ï¼Œå¦‚æœéœ€è¦æ›´å¤šçš„Peerç»„ç»‡è¯ä¹¦ï¼Œåªéœ€è¦æŒ‰è¯¥æ¨¡æ¿æ·»åŠ å³å¯ã€‚
    Domain: org2.example.com  #ä¸ä»¥ä¸Šç›¸åŒ 
    EnableNodeOUs: true
    Template:
      Count: 2
    Users:
      Count: 1
&lt;/code&gt;
&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;é…ç½®äº¤æ˜“ç”Ÿæˆå™¨ configtxgen
&lt;ul&gt;&lt;li&gt;ä½¿ç”¨configtxgenå·¥å…·ç”Ÿæˆç³»ç»Ÿé€šé“çš„åˆ›ä¸–åŒºå—ï¼Œå¹¶å°†ç³»ç»Ÿçš„é…ç½®æ“ä½œï¼ˆåˆ›å»ºé€šé“ï¼Œè®¾ç½®æŸç»„ç»‡çš„é”šèŠ‚ç‚¹ç­‰ï¼‰ä½œä¸ºç³»ç»Ÿäº‹åŠ¡ç”Ÿæˆæäº¤åˆ°ç³»ç»Ÿé€šé“çš„äº‹åŠ¡æ–‡ä»¶ï¼ˆ.txï¼‰ï¼Œé…ç½®æ–‡ä»¶ä¸º&lt;a href=&quot;https://my.oschina.net/u/2476019/blog/2046258&quot;&gt;configtx.yaml&lt;/a&gt;ï¼Œç”Ÿæˆçš„é…ç½®ç»„ä»¶ä½äºchannel-artifactsç›®å½•ä¸‹ã€åˆ†åˆ«ä¸ºï¼šgenesis.blockï¼Œchannel.txï¼ŒOrg1MSPanchors.txï¼ŒOrg2MSPanchors.txï¼Œgenesis.blockä¸ºç³»ç»Ÿé€šé“çš„åˆ›ä¸–åŒºå—ï¼Œåä¸‰è€…åˆ†åˆ«ä¸ºåˆ›å»ºé€šé“ï¼Œè®¾ç½®ç»„ç»‡ä¸€ã€ç»„ç»‡äºŒçš„é”šèŠ‚ç‚¹çš„äº‹åŠ¡ï¼Œè¿™äº›é…ç½®æ“ä½œä½œä¸ºç³»ç»Ÿäº‹åŠ¡æäº¤åˆ°ç³»ç»Ÿé€šé“ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;# ä¼šæ ¹æ®crypto-config.yamlæ–‡ä»¶é…ç½®ç”Ÿæˆä¸¤ä¸ªé”šèŠ‚ç‚¹äº¤æ˜“ï¼Œä¸€ä¸ªå¯¹åº”ä¸€ä¸ªPeerç»„ç»‡
cryptogen generate --config=./crypto-config.yaml

#ç”Ÿæˆç³»ç»Ÿé€šé“åˆ›ä¸–åŒºå—genesis.blockç”Ÿæˆçš„é…ç½®ç»„ä»¶ä½äºchannel-artifactsç›®å½•ä¸‹
configtxgen -profile SampleMultiNodeEtcdRaft -channelID byfn-sys-channel -outputBlock ./channel-artifacts/genesis.block

#é€šè¿‡ç¯å¢ƒå˜é‡è®¾å®šé€šé“åç§°
export CHANNEL_NAME=mychannel

#åˆ›å»º é€šé“é…ç½® äº‹åŠ¡
configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID $CHANNEL_NAME  

#åˆ›å»º æ›´æ–°ç»„ç»‡Org1åœ¨è¯¥é€šé“ä¸Šçš„é”šèŠ‚ç‚¹ï¼ˆé”šèŠ‚ç‚¹ä¸ºæŸç»„ç»‡å¯¹orderå¯è§çš„èŠ‚ç‚¹ï¼‰ çš„äº‹åŠ¡
configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org1MSP

#åˆ›å»º æ›´æ–°ç»„ç»‡Org2åœ¨è¯¥é€šé“ä¸Šçš„é”šèŠ‚ç‚¹ çš„äº‹åŠ¡
configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org2MSP
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;å¯åŠ¨ç½‘ç»œï¼Œåˆ›å»ºå¹¶åŠ å…¥é€šé“ï¼Œæ›´æ–°ç»„ç»‡é”šèŠ‚ç‚¹ï¼Œå®‰è£…ã€å®šä¹‰å¹¶è°ƒç”¨ä¸€ä¸ªé“¾ä»£ç ï¼ˆç­‰åŒäºæ‰§è¡Œbyfnsh-upï¼‰&quot;&gt;å¯åŠ¨ç½‘ç»œï¼Œåˆ›å»ºå¹¶åŠ å…¥é€šé“ï¼Œæ›´æ–°ç»„ç»‡é”šèŠ‚ç‚¹ï¼Œå®‰è£…ã€å®šä¹‰å¹¶è°ƒç”¨ä¸€ä¸ªé“¾ä»£ç ï¼ˆç­‰åŒäºæ‰§è¡Œ./byfn.sh upï¼‰&lt;/h2&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;#å¯åŠ¨fabricç½‘ç»œ -dç”¨äºä¸æ˜¾ç¤ºç½‘ç»œçš„å®æ—¶æ—¥å¿—ï¼Œè‹¥æƒ³æŸ¥çœ‹æ—¥å¿—æµï¼Œåˆ™åç»­å‘½ä»¤éœ€è¦æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯æ¥æ‰§è¡Œ
#é¦–å…ˆå°†first-networkç›®å½•ä¸‹çš„docker-compose-cli.yamlæ–‡ä»¶ä¸­cliå®¹å™¨é…ç½®ä¿¡æ¯ä¸­çš„FABRIC_LOGGING_SPEC=INFOä¿®æ”¹ä¸ºFABRIC_LOGGING_SPEC=DEBUGä»¥çœ‹åˆ°æ›´å¤šçš„æ‰§è¡Œè¿‡ç¨‹ä¿¡æ¯
docker-compose -f docker-compose-cli.yaml -f docker-compose-etcdraft2.yaml up -d   
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;å¯åŠ¨ç½‘ç»œä¹‹åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°dockerå¯åŠ¨çš„å®¹å™¨&lt;/strong&gt;&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1808958/202008/1808958-20200820215655459-195591862.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;&lt;strong&gt;è¿›å…¥å®¹å™¨ åˆ›å»ºå¹¶åŠ å…¥é€šé“ï¼Œå¹¶æŒ‡å®šï¼ˆæ›´æ–°ï¼‰ç»„ç»‡çš„é”šèŠ‚ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;#è¿›å…¥cliå®¹å™¨å†…éƒ¨
docker exec -it cli bash

#é…ç½®CLIå®¹å™¨ä½œä¸ºpeer0.org1.example.comèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤çš„ç¯å¢ƒå˜é‡
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt

#ä»¥ç¯å¢ƒå˜é‡å½¢å¼è®¾å®šé€šé“åç§°ï¼Œå¿…é¡»å…¨éƒ¨å°å†™ï¼Œé•¿åº¦å°äº250ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸æ­£åˆ™è¡¨è¾¾å¼[a-z][a-z0-9.-]*åŒ¹é…
export CHANNEL_NAME=mychannel  

#å°†é€šé“é…ç½®äº‹åŠ¡å‘é€ç»™orderèŠ‚ç‚¹ä»¥åˆ›å»ºé€šé“ï¼ŒæŒ‡å®šorderèŠ‚ç‚¹çš„è¯ä¹¦ä»¥è¿›è¡ŒTLSæ¡æ‰‹ï¼Œæ‰§è¡Œç»“æŸåè¯¥èŠ‚ç‚¹å°†æ”¶åˆ°æ¥è‡ªorderèŠ‚ç‚¹çš„å¯¹åº”äºæ‰€åˆ›å»ºé€šé“çš„åˆ›ä¸–åŒºå—$CHANNEL_NAME.block
peer channel create -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/channel.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem 
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1808958/202008/1808958-20200820222508428-114220437.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;#å°†peer0.org1.example.comåŠ å…¥é€šé“ï¼Œæ³¨æ„å‘½ä»¤ä¸­çš„$CHANNEL_NAME.blockï¼Œæ ¹æ®é€šé“åç§°è€Œå˜åŒ–
peer channel join -b mychannel.block

#æŒ‡å®špeer0.org1.example.comä½œä¸ºç»„ç»‡Org1çš„é”šèŠ‚ç‚¹
peer channel update -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/Org1MSPanchors.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem 

#é…ç½®CLIå®¹å™¨ä½œä¸ºpeer0.org2.example.comèŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤çš„ç¯å¢ƒå˜é‡
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp 
CORE_PEER_ADDRESS=peer0.org2.example.com:9051 
CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot; 
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt

#å°†peer0.org2.example.comåŠ å…¥é€šé“ï¼Œæ³¨æ„å‘½ä»¤ä¸­çš„$CHANNEL_NAME.blockï¼Œæ ¹æ®é€šé“åç§°è€Œå˜åŒ–
peer channel join -b mychannel.block

#æŒ‡å®špeer0.org2.example.comä½œä¸ºç»„ç»‡Org2çš„é”šèŠ‚ç‚¹
peer channel update -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/Org2MSPanchors.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem

#ä¸‹è½½å®‰è£…å¹¶å®šä¹‰ä¸€ä¸ªé“¾ä»£ç 
peer lifecycle chaincode package mycc.tar.gz --path github.com/hyperledger/fabric-samples/chaincode/abstore/go/ --lang golang --label mycc_1
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1808958/202008/1808958-20200820223059320-455780581.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;#å®‰è£…é“¾ç 
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp
CORE_PEER_ADDRESS=peer0.org1.example.com:7051
CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt

#å®‰è£…é“¾ç 
peer lifecycle chaincode install mycc.tar.gz

#æŸ¥è¯¢å·²å®‰è£…çš„é“¾ç 
peer lifecycle chaincode queryinstalled 

#åç»­å‘½ä»¤å°†éœ€è¦é“¾ç åŒ…çš„IDï¼Œå› æ­¤æˆ‘ä»¬å°†å®ƒä¿å­˜ä¸ºä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªIDæ˜¯åŠ¨æ€çš„(ä¸Šé¢æŸ¥è¯¢å‡ºæ¥çš„)
CC_PACKAGE_ID=mycc_1:3a8c52d70c36313cfebbaf09d8616e7a6318ababa01c7cbe40603c373bcfe173

#åˆ¶å®šé“¾ç åˆå§‹åŒ–é“¾ç TLSåé¢çš„å‘½ä»¤æ˜¯è¦æƒé™æ‰èƒ½åˆå§‹åŒ–
#é€šé“ä¸­çš„ç»„ç»‡éœ€è¦å°±é“¾ç çš„å®šä¹‰è¾¾æˆä¸€è‡´ï¼Œä»¥ä¸‹å‘½ä»¤ç”¨äºæ‰¹å‡†ä¸€ä¸ªchaincodeå®šä¹‰ï¼Œ--init-requiredç”¨äºåˆå§‹åŒ–chaincodeæ—¶ä½¿initå‡½æ•°è¢«è°ƒç”¨ï¼Œ--package-idæŒ‡å®šé“¾ç åŒ…çš„IDï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æä¾›--signature-policyæˆ–--channel-config-policyå‚æ•°æ¥è®¾ç½®chaincodeèƒŒä¹¦ç­–ç•¥ï¼Œè‹¥æœªæä¾›å°†ä½¿ç”¨é»˜è®¤è®¾ç½®-å¤§å¤šæ•°é€šé“æˆå‘˜èƒŒä¹¦ï¼Œè¿™ç§æƒ…å†µä¸‹è‹¥åœ¨è¯¥æ¸ é“ä¸­æ·»åŠ æˆ–åˆ é™¤æ–°ç»„ç»‡ï¼ŒèƒŒä¹¦ç­–ç•¥å°†è‡ªåŠ¨æ›´æ–°ï¼Œä»¥è¦æ±‚æ›´å¤šæˆ–æ›´å°‘çš„èƒŒä¹¦ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œé»˜è®¤ç­–ç•¥å°†éœ€è¦æ¥è‡ªå±äºOrg1å’ŒOrg2çš„peerçš„èƒŒä¹¦(å³ä¸¤ä¸ªèƒŒä¹¦)
peer lifecycle chaincode approveformyorg --channelID $CHANNEL_NAME --name mycc --version 1.0 --init-required --package-id $CC_PACKAGE_ID --sequence 1 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem

#æ›´æ”¹CLIå®¹å™¨çš„ç¯å¢ƒå˜é‡åï¼Œåœ¨å…¶å®ƒèŠ‚ç‚¹ä¸Šå®‰è£…é“¾ç 
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp
CORE_PEER_ADDRESS=peer0.org2.example.com:9051
CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt

#å®‰è£…é“¾ç 
peer lifecycle chaincode install mycc.tar.gz

#åˆ¶å®šé“¾ç åˆå§‹åŒ–é“¾ç TLSåé¢çš„å‘½ä»¤æ˜¯è¦æƒé™æ‰èƒ½åˆå§‹åŒ–
#é€šé“ä¸­çš„ç»„ç»‡éœ€è¦å°±é“¾ç çš„å®šä¹‰è¾¾æˆä¸€è‡´ï¼Œä»¥ä¸‹å‘½ä»¤ç”¨äºæ‰¹å‡†ä¸€ä¸ªchaincodeå®šä¹‰ï¼Œ--init-requiredç”¨äºåˆå§‹åŒ–chaincodeæ—¶ä½¿initå‡½æ•°è¢«è°ƒç”¨ï¼Œ--package-idæŒ‡å®šé“¾ç åŒ…çš„IDï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æä¾›--signature-policyæˆ–--channel-config-policyå‚æ•°æ¥è®¾ç½®chaincodeèƒŒä¹¦ç­–ç•¥ï¼Œè‹¥æœªæä¾›å°†ä½¿ç”¨é»˜è®¤è®¾ç½®-å¤§å¤šæ•°é€šé“æˆå‘˜èƒŒä¹¦ï¼Œè¿™ç§æƒ…å†µä¸‹è‹¥åœ¨è¯¥æ¸ é“ä¸­æ·»åŠ æˆ–åˆ é™¤æ–°ç»„ç»‡ï¼ŒèƒŒä¹¦ç­–ç•¥å°†è‡ªåŠ¨æ›´æ–°ï¼Œä»¥è¦æ±‚æ›´å¤šæˆ–æ›´å°‘çš„èƒŒä¹¦ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œé»˜è®¤ç­–ç•¥å°†éœ€è¦æ¥è‡ªå±äºOrg1å’ŒOrg2çš„peerçš„èƒŒä¹¦(å³ä¸¤ä¸ªèƒŒä¹¦)
peer lifecycle chaincode approveformyorg --channelID $CHANNEL_NAME --name mycc --version 1.0 --init-required --package-id $CC_PACKAGE_ID --sequence 1 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem

#ä¸€æ—¦è¶³å¤Ÿå¤šçš„é€šé“æˆå‘˜ç»„ç»‡æ‰¹å‡†äº†chaincodeå®šä¹‰ï¼Œä¸€ä¸ªæˆå‘˜ç»„ç»‡å°±å¯ä»¥å°†å®šä¹‰æäº¤ç»™é€šé“ã€‚å¯ä»¥é€šè¿‡å‘å‡ºä»¥ä¸‹æŸ¥è¯¢æ¥æ£€æŸ¥chaincodeå®šä¹‰æ˜¯å¦å·²å‡†å¤‡å¥½æäº¤ï¼Œå¹¶æŸ¥çœ‹å½“å‰ç»„ç»‡çš„æ‰¹å‡†æƒ…å†µ
#æŸ¥çœ‹å„ç»„ç»‡å¯¹chaincodeå®šä¹‰çš„æ‰¹å‡†çŠ¶å†µ
peer lifecycle chaincode checkcommitreadiness --channelID $CHANNEL_NAME --name mycc --version 1.0 --init-required --sequence 1 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --output json

#ä¸€æ—¦å°±é“¾ç å®šä¹‰è¾¾æˆä¸€è‡´ï¼ŒæŠŠä¸¤ä¸ªç»„ç»‡ä¸­çš„é“¾ç æäº¤åˆ°orderç»„ç»‡--é€šçŸ¥ç»™å…¶ä»–èŠ‚ç‚¹æˆ‘åŠ å…¥äº†
peer lifecycle chaincode commit -o orderer.example.com:7050 --channelID $CHANNEL_NAME --name mycc --version 1.0 --sequence 1 --init-required --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --peerAddresses peer0.org1.example.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses peer0.org2.example.com:9051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt

#è°ƒç”¨chaincode å°†--isInitæ ‡å¿—ä¼ é€’ç»™é“¾ç çš„ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œå¹¶å°†å‚æ•°æä¾›ç»™Initå‡½æ•°ã€‚ç¬¬ä¸€ä¸ªè°ƒç”¨å°†å¯åŠ¨chaincodeå®¹å™¨ã€‚æˆ‘ä»¬å¯èƒ½éœ€è¦ç­‰å¾…å®¹å™¨å¯åŠ¨ã€‚ï¼ˆç¡®ä¿é€šé“åç§°å’Œé“¾ç åç§°æ­£ç¡®ï¼‰
peer chaincode invoke -o orderer.example.com:7050 --isInit --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n mycc --peerAddresses peer0.org1.example.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses peer0.org2.example.com:9051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c '{&quot;Args&quot;:[&quot;Init&quot;,&quot;a&quot;,&quot;100&quot;,&quot;b&quot;,&quot;100&quot;]}' --waitForEvent

#æŸ¥è¯¢chaincode
peer chaincode query -C $CHANNEL_NAME -n mycc -c '{&quot;Args&quot;:[&quot;query&quot;,&quot;a&quot;]}'

#è°ƒç”¨é“¾ç çš„invokeå‡½æ•°ï¼Œaå‘bè½¬è´¦åå…ƒ
peer chaincode invoke -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n mycc --peerAddresses peer0.org1.example.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses peer0.org2.example.com:9051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c '{&quot;Args&quot;:[&quot;invoke&quot;,&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]}' --waitForEvent

#æ³¨ï¼šè‹¥é€šé“æˆå‘˜ç»„ç»‡çš„å…¶å®ƒèŠ‚ç‚¹æƒ³å’ŒåŒºå—é“¾ç½‘ç»œè¿›è¡Œäº¤äº’ï¼Œåªéœ€è¦åŠ å…¥é€šé“å¹¶å®‰è£…é“¾ç åŒ…å³å¯ï¼Œè€Œä¸éœ€è¦æäº¤é“¾ç å®šä¹‰ï¼ˆæ¯ä¸ªç»„ç»‡æ‰¹å‡†ä¸€æ¬¡é“¾ç å®šä¹‰å³å¯ï¼‰ã€‚
&lt;/code&gt;
&lt;/pre&gt;</description>
<pubDate>Thu, 20 Aug 2020 14:41:00 +0000</pubDate>
<dc:creator>æ™¨æ›¦001</dc:creator>
<og:description>#Hyperledger Fabric æ‰‹åŠ¨æ­å»º å‰é¢æˆ‘ä»¬å­¦ä¹ äº†åŒºå—é“¾æ˜¯ä»€ä¹ˆã€è¿˜æœ‰è‡ªåŠ¨æ­å»ºå­¦ä¹ ä¸œè¥¿æˆ‘ä»¬å°±è¦ä»ç®€å•åˆ°æ·±å…¥ï¼ˆå…¥é—¨åˆ°æ”¾å¼ƒï¼‰ï¼Œç°åœ¨è‡ªåŠ¨éƒ¨ç½²å·²ç»è·‘é€šäº†æ¥ä¸‹æ¥å°±æ˜¯æ‰‹åŠ¨æ­å»ºFabric ç½‘ç»œå¯ä»¥æ›´å¥½</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/chenxi001/p/13509829.html</dc:identifier>
</item>
<item>
<title>ç—å­è¡¡åµŒå…¥å¼ï¼šè§£é”i.MXRTxxxä¸ŠFlexSPIæ¨¡å—è‡ªå¸¦çš„åœ°å€é‡æ˜ å°„(Remap)åŠŸèƒ½ - ç—å­è¡¡</title>
<link>http://www.cnblogs.com/henjay724/p/13538105.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/henjay724/p/13538105.html</guid>
<description>&lt;p&gt;å‰æ®µæ—¶é—´ç—å­è¡¡å†™äº†ä¸€ç¯‡æ–‡ç«  ã€Šåˆ©ç”¨i.MXRT1060,1010ä¸Šæ–°å¢çš„FlexSPIåœ°å€é‡æ˜ å°„(Remap)åŠŸèƒ½å¯å®‰å…¨OTAã€‹ï¼Œä»‹ç»äº†RemapåŠŸèƒ½åœ¨OTAè®¾è®¡ä¸­çš„é‡è¦æ€§ã€‚å¦‚æœä½ å¯¹æ¯”è¿‡i.MXRTä¸‰ä½æ•°ï¼ˆRT500/600ï¼‰å’Œå››ä½æ•°ï¼ˆRT1xxxï¼‰çš„FlexSPIæ¨¡å—ï¼Œä½ ä¼šå‘ç°å®ƒä»¬æ˜¯ä¸€æ ·çš„ï¼Œå¯„å­˜å™¨å®šä¹‰å‡ ä¹å®Œå…¨ä¸€è‡´ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“è¿™ä¸¤ä¸ªç³»åˆ—åˆåˆ†åˆ«æ˜¯æ¥è‡ªä¸åŒå¹³å°ï¼ˆLPC/i.MXï¼‰ï¼Œi.MXRTä¸‰ä½æ•°å¯æ²¡æœ‰i.MXRTå››ä½æ•°ä¸Šç”¨äºå­˜æ”¾Remapæ§åˆ¶çš„IOMUXC_GPRæ¨¡å—ï¼Œé‚£ä¹ˆåœ¨i.MXRT500/600ä¸Šåˆ°åº•æœ‰æ²¡æœ‰RemapåŠŸèƒ½å‘¢ï¼Ÿæœ¬æ–‡ç—å­è¡¡å°†ä¸ºä½ è§£ç­”ã€‚&lt;/p&gt;&lt;div id=&quot;cnblogs_post_body&quot; readability=&quot;152.4030075188&quot;&gt;
&lt;hr/&gt;&lt;p&gt;ã€€ã€€å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ç—å­è¡¡ï¼Œæ˜¯æ­£ç»ææŠ€æœ¯çš„ç—å­ã€‚ä»Šå¤©ç—å­è¡¡ç»™å¤§å®¶ä»‹ç»çš„æ˜¯&lt;strong&gt;i.MXRTä¸‰ä½æ•°ç³»åˆ—éšè—çš„FlexSPI RemapåŠŸèƒ½&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€å‰æ®µæ—¶é—´ç—å­è¡¡å†™äº†ä¸€ç¯‡æ–‡ç«  &lt;a href=&quot;https://www.cnblogs.com/henjay724/p/13510275.html&quot;&gt;ã€Šåˆ©ç”¨i.MXRT1060,1010ä¸Šæ–°å¢çš„FlexSPIåœ°å€é‡æ˜ å°„(Remap)åŠŸèƒ½å¯å®‰å…¨OTAã€‹&lt;/a&gt;ï¼Œä»‹ç»äº†RemapåŠŸèƒ½åœ¨OTAè®¾è®¡ä¸­çš„é‡è¦æ€§ã€‚å¦‚æœä½ å¯¹æ¯”è¿‡i.MXRTä¸‰ä½æ•°ï¼ˆRT500/600ï¼‰å’Œå››ä½æ•°ï¼ˆRT1xxxï¼‰çš„FlexSPIæ¨¡å—ï¼Œä½ ä¼šå‘ç°å®ƒä»¬æ˜¯ä¸€æ ·çš„ï¼Œå¯„å­˜å™¨å®šä¹‰å‡ ä¹å®Œå…¨ä¸€è‡´ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“è¿™ä¸¤ä¸ªç³»åˆ—åˆåˆ†åˆ«æ˜¯æ¥è‡ªä¸åŒå¹³å°ï¼ˆLPC/i.MXï¼‰ï¼Œi.MXRTä¸‰ä½æ•°å¯æ²¡æœ‰i.MXRTå››ä½æ•°ä¸Šç”¨äºå­˜æ”¾Remapæ§åˆ¶çš„IOMUXC_GPRæ¨¡å—ï¼Œé‚£ä¹ˆåœ¨i.MXRT500/600ä¸Šåˆ°åº•æœ‰æ²¡æœ‰RemapåŠŸèƒ½å‘¢ï¼Ÿæœ¬æ–‡ç—å­è¡¡å°†ä¸ºä½ è§£ç­”ã€‚&lt;/p&gt;
&lt;h3 id=&quot;1-flexspi-norç³»ç»Ÿæ˜ å°„åœ°å€&quot;&gt;1. FlexSPI NORç³»ç»Ÿæ˜ å°„åœ°å€&lt;/h3&gt;
&lt;p&gt;ã€€ã€€è€è§„çŸ©è¿˜æ˜¯å…ˆçœ‹ä¸€ä¸‹FlexSPIåœ¨i.MXRTä¸‰ä½æ•°ä¸Šçš„ç³»ç»Ÿæ˜ å°„ç©ºé—´ã€‚å› ä¸ºå†…æ ¸æ¶æ„çš„å·®å¼‚ï¼Œåˆ†é…çš„æ˜ å°„åœ°å€ä¸i.MXRT1xxxä¸Šå®Œå…¨ä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€i.MXRT500ä¸­åˆ†é…ç»™FlexSPIçš„ç³»ç»Ÿæ˜ å°„ç©ºé—´å¦‚ä¸‹ï¼Œä¸¤ä¸ªFlexSPIå„åˆ†é…äº†128MBã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://henjay724.com/image/cnblogs/i.MXRTxxx_FlexSPI_Remap_RT500_flash_map.PNG&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€i.MXRT600ä¸­åˆ†é…ç»™FlexSPIçš„ç³»ç»Ÿæ˜ å°„ç©ºé—´å¦‚ä¸‹ï¼Œä¸€ä¸ªFlexSPIåˆ†é…äº†128MBã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://henjay724.com/image/cnblogs/i.MXRTxxx_FlexSPI_Remap_RT600_flash_map.PNG&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;2-flexspi-remapæ§åˆ¶åœ¨å“ªé‡Œï¼Ÿ&quot;&gt;2. FlexSPI Remapæ§åˆ¶åœ¨å“ªé‡Œï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ã€€ã€€ç›®å‰æˆ‘ä»¬å·²ç»å¯ä»¥ä»æ©æ™ºæµ¦å®˜ç½‘ä¸‹è½½åˆ°i.MXRT600çš„SDKè½¯ä»¶åŒ…å’Œå‚è€ƒæ‰‹å†Œï¼Œi.MXRT500çš„èµ„æ–™æš‚æ—¶è¿˜æ²¡æœ‰å…¬å¸ƒã€‚å¯¹äºi.MXRT600ï¼Œæ— è®ºæ˜¯åœ¨SDKè½¯ä»¶åŒ…ä¸­çš„å¤´æ–‡ä»¶è¿˜æ˜¯åœ¨å‚è€ƒæ‰‹å†Œä¸­æœç´¢â€œRemapâ€å…³é”®å­—ï¼Œéƒ½æœä¸åˆ°ä»»ä½•ä¿¡æ¯ï¼Œè«éæ˜¯æ²¡æœ‰RemapåŠŸèƒ½ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ã€€ã€€å¥½äº†ï¼Œç—å­è¡¡å°±ä¸å–å…³å­äº†ï¼Œå…¶å®RemapåŠŸèƒ½æ˜¯æ”¯æŒçš„ï¼Œè€Œä¸”ç›´æ¥åšåˆ°äº†FlexSPIæ¨¡å—é‡Œï¼Œæ§åˆ¶å¯„å­˜å™¨ä¹Ÿåœ¨FlexSPIé‡Œï¼Œå°±åœ¨FLEXSPI BASEåœ°å€åç§»0x420çš„åœ°æ–¹ï¼ˆæ¨¡å—æœ‰æ›´æ–°ï¼Œä½†æ–‡æ¡£æš‚æ—¶æ²¡æœ‰åŒæ­¥æ›´æ–°ï¼‰ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C&quot;&gt;typedef struct
{
    __IO uint32_t HADDRSTART;
    __IO uint32_t HADDREND;
    __IO uint32_t HADDROFFSET;
} FLEXSPI_REMAP_Type;

#define FLEXSPI_REMAP  ((FLEXSPI_REMAP_Type *)(FLEXSPI_BASE + 0x420u));
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ã€€ã€€å› ä¸ºRemapæ§åˆ¶åµŒåœ¨FlexSPIæ¨¡å—å¯„å­˜å™¨é‡Œï¼Œæ‰€ä»¥å¯¹äºæœ‰ä¸¤ä¸ªFlexSPIæ¨¡å—çš„i.MXRT500ï¼ŒRemapæ§åˆ¶ä¹Ÿæœ‰ä¸¤ç»„ï¼Œç›¸äº’ç‹¬ç«‹ï¼Œè¿™ç‚¹è·ŸåŒæ ·æœ‰ä¸¤ä¸ªFlexSPIæ¨¡å—çš„i.MXRT1060ä¸ŠRemapè®¾è®¡æ˜¯ä¸ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;h3 id=&quot;3-flexspi-remapåŠŸèƒ½è®¾è®¡&quot;&gt;3. FlexSPI RemapåŠŸèƒ½è®¾è®¡&lt;/h3&gt;
&lt;p&gt;ã€€ã€€è™½ç„¶i.MXRT500/600ä¸Šçš„Remapæ§åˆ¶åµŒåœ¨FlexSPIæ¨¡å—å†…éƒ¨ï¼Œä½†Remapè®¾è®¡ä¾ç„¶æ˜¯å±äºç³»ç»Ÿæ¶æ„å±‚é¢çš„ï¼Œåªæ˜¯åœ¨AHBæ€»çº¿å±‚é¢åšä¸€ä¸ªåœ°å€é‡å®šå‘ã€‚ä¸‹é¢æ˜¯Remapæ§åˆ¶å¯„å­˜å™¨ï¼š&lt;/p&gt;
&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th rowspan=&quot;2&quot;&gt;RemapåŠŸèƒ½&lt;/th&gt;
&lt;th colspan=&quot;2&quot;&gt;å¯¹åº”æ§åˆ¶å¯„å­˜å™¨&lt;/th&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;å¯„å­˜å™¨å&lt;/td&gt;
&lt;td&gt;å¯„å­˜å™¨åœ°å€&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;ADDR_START&lt;/td&gt;
&lt;td&gt;HADDRSTART&lt;/td&gt;
&lt;td&gt;FLEXSPI_BASE + 0x420&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;ADDR_END&lt;/td&gt;
&lt;td&gt;HADDREND&lt;/td&gt;
&lt;td&gt;FLEXSPI_BASE + 0x424&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;ADDR_OFFSET&lt;/td&gt;
&lt;td&gt;HADDROFFSET&lt;/td&gt;
&lt;td&gt;FLEXSPI_BASE + 0x428&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;ã€€ã€€Remapè®¾è®¡å¾ˆç®€å•ï¼Œå°±æ˜¯åœ°å€ï¼ˆaddrï¼‰è½åœ¨[ADDR_START, ADDR_END]é‡Œçš„AHBè¯»è®¿é—®ï¼Œå…¶å®é™…è®¿é—®åˆ°çš„æ˜¯addr + ADDR_OFFSETä½ç½®å¤„çš„æ•°æ®ã€‚ï¼ˆæ³¨æ„ADDR_START, ADDR_END, ADDR_OFFSETéƒ½æ˜¯4KBå¯¹é½çš„ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://henjay724.com/image/cnblogs/i.MXRTxxx_FlexSPI_Remap_remap_case_1.PNG&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€RemapåŠŸèƒ½åŠå¯„å­˜å™¨å®šä¹‰ä¸ŠåŸºæœ¬è·Ÿi.MX1xxxä¿æŒä¸€è‡´ï¼Œä½†æœ‰ä¸€ä¸ªå°åŒºåˆ«ï¼Œå°±æ˜¯HADDRSTARTå¯„å­˜å™¨çš„bit0åŒæ—¶ä¹Ÿæ‰¿æ‹…äº†RemapåŠŸèƒ½å¼€å…³æ§åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://henjay724.com/image/cnblogs/i.MXRTxxx_FlexSPI_Remap_HADDRSTART_defn.PNG&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;4-remapå¯¹æ“¦å†™flashçš„å½±å“&quot;&gt;4. Remapå¯¹æ“¦å†™Flashçš„å½±å“&lt;/h3&gt;
&lt;p&gt;ã€€ã€€å¯ç”¨RemapåŠŸèƒ½åï¼Œè°ƒç”¨FlexSPI NORé©±åŠ¨å‡½æ•°å»æ“¦å†™Flashä¸ä¼šå—å½±å“ï¼Œæ“¦å†™Flashæ“ä½œæ­£å¸¸èµ°çš„æ˜¯FlexSPI IPGå‘½ä»¤æ–¹å¼ï¼Œæ•°æ®æ²¡æœ‰ç»è¿‡AHB busã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä¸‹é¢è¿™æ®µæµ‹è¯•ä»£ç æ˜¯åœ¨MIMXRT500-EVKä¸Šè·‘çš„ï¼Œç”¨ROM APIé©±åŠ¨æ“¦å†™0x08100000åœ°å€ï¼Œæ“¦å†™æ“ä½œå‰åŠ äº†ä¸€æ®µRemapè®¾ç½®å¹²æ‰°ï¼Œå®æµ‹ä¸‹æ¥Remapè®¾ç½®å¯¹æ“¦å†™æ²¡æœ‰ä»»ä½•å½±å“ï¼Œå¤ä½åå»è¯»Flashï¼Œæ“ä½œçš„è¿˜æ˜¯åŸ0x08100000åœ°å€ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C&quot;&gt;#define FLEXSPI0_REMAP  ((FLEXSPI_REMAP_Type *)(FLEXSPI0_BASE + 0x420u));

flexspi_nor_config_t flashConfig;
serial_nor_config_option_t configOption;
configOption.option0.U = 0xc0403004;

uint32_t programBuffer[64];
for (uint32_t i = 0; i &amp;lt; sizeof(programBuffer); i++)
{
    *((uint8_t *)programBuffer + i) = (uint8_t)(i &amp;amp; 0xFF);
}

g_bootloaderTree-&amp;gt;flexspiNorDriver-&amp;gt;get_config(1, &amp;amp;flashConfig, &amp;amp;configOption);
g_bootloaderTree-&amp;gt;flexspiNorDriver-&amp;gt;init(1, &amp;amp;flashConfig);

FLEXSPI0_REMAP-&amp;gt;HADDRSTART  = 0x08100000 | 0x01;
FLEXSPI0_REMAP-&amp;gt;HADDREND    = 0x08200000;
FLEXSPI0_REMAP-&amp;gt;HADDROFFSET = 0x100000;

g_bootloaderTree-&amp;gt;flexspiNorDriver-&amp;gt;erase(1, &amp;amp;flashConfig, 0x100000, 0x100);
g_bootloaderTree-&amp;gt;flexspiNorDriver-&amp;gt;page_program(1, &amp;amp;flashConfig, 0x100000, programBuffer);
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ã€€ã€€Remapå¯„å­˜å™¨å› ä¸ºåœ¨FlexSPIæ¨¡å—ä¸­ï¼Œå› æ­¤Remapè®¾ç½®ä»£ç è¦åœ¨FlexSPIæ¨¡å—åˆå§‹åŒ–ä¹‹åï¼Œä»…æœ‰æ¨¡å—æ—¶é’Ÿè¢«å¼€å¯ï¼Œæ¨¡å—å¯„å­˜å™¨æ‰èƒ½æ­£å¸¸èµ‹å€¼ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆï¼ˆå®æµ‹æ—¶é’Ÿä¸æ‰“å¼€ï¼Œè¯»å†™Remapå¯„å­˜å™¨æ°¸è¿œæ˜¯0ï¼Œå¹¶ä¸”ä¸äº§ç”ŸHardFaultï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&quot;5-å…³äºrom-apiä¼ å‚çš„ç–‘æƒ‘è§£é‡Š&quot;&gt;5. å…³äºROM APIä¼ å‚çš„ç–‘æƒ‘è§£é‡Š&lt;/h3&gt;
&lt;p&gt;ã€€ã€€æœ€åå†ç®€å•è¯´ä¸€ä¸‹ç¬¬4èŠ‚ç¤ºä¾‹ä»£ç é‡Œä¸€ç‚¹è®©äººç–‘æƒ‘çš„åœ°æ–¹ï¼Œæˆ‘ä»¬æ˜¯åœ¨MIMXRT500-EVKä¸Šåšçš„æµ‹è¯•ï¼Œi.MXRT500æœ‰ä¸¤ä¸ªFlexSPIï¼ˆ0/1ï¼‰ï¼ŒFlashæ˜¯è¿åœ¨FlexSPI0ä¸Šï¼Œä½†æ˜¯ROM APIé‡Œçš„instanceä¼ å‚ç«Ÿç„¶éœ€è¦æ˜¯1ï¼ˆi.MXRT1060 ROM APIçš„FLEXSPI0ä¼ å‚å°±æ˜¯0ï¼‰ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä¸‹é¢æ˜¯i.MXRT500 BootROMä¸­æ ¹æ®instanceè·å–FLEXSPIæ¨¡å—åŸºå€çš„å‡½æ•°ä»£ç ï¼Œå…¶æ˜¯æ ¹æ®i.MXRT500å¤´æ–‡ä»¶ä¸­FLEXSPI_BASE_PTRSå®šä¹‰æ¥è·å–åŸºå€å€¼çš„ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C&quot;&gt;static FLEXSPI_Type *const g_flexSpiInstances[] = FLEXSPI_BASE_PTRS;

static FLEXSPI_Type *flexspi_get_module_base(uint32_t instance)
{
    FLEXSPI_Type *baseAddr = NULL;
    baseAddr = g_flexSpiInstances[instance];
    return baseAddr;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ã€€ã€€è€ŒBootROMä¸­ç”¨çš„i.MXRT500å¤´æ–‡ä»¶ä¸­FLEXSPI_BASE_PTRSå®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼Œæœ‰ç‚¹å¥‡æ€ªï¼Œè·Ÿæ­£å¼SDKé‡Œçš„å®šä¹‰ä¸ä¸€è‡´ã€‚å…¶å®ä¹Ÿå¯ä»¥ç†è§£ï¼ŒBootROMæ˜¯èŠ¯ç‰‡è®¾è®¡é˜¶æ®µçš„äº§ç‰©ï¼Œé‚£æ—¶å€™å¤´æ–‡ä»¶æ˜¯åˆç‰ˆï¼ŒåæœŸæœ‰å˜åŒ–ä¹Ÿæ­£å¸¸ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-C&quot;&gt;/** Array initializer of FLEXSPI peripheral base pointers */
#define FLEXSPI_BASE_PTRS                      \
    {                                          \
        (FLEXSPI_Type *)0u, FLEXSPI1, FLEXSPI2 \
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ã€€ã€€è‡³æ­¤ï¼Œi.MXRTä¸‰ä½æ•°ç³»åˆ—éšè—çš„FlexSPI RemapåŠŸèƒ½ç—å­è¡¡ä¾¿ä»‹ç»å®Œæ¯•äº†ï¼ŒæŒå£°åœ¨å“ªé‡Œ~~~&lt;/p&gt;
&lt;h3 id=&quot;æ¬¢è¿è®¢é˜…&quot;&gt;æ¬¢è¿è®¢é˜…&lt;/h3&gt;
&lt;p&gt;æ–‡ç« ä¼šåŒæ—¶å‘å¸ƒåˆ°æˆ‘çš„ &lt;a href=&quot;https://www.cnblogs.com/henjay724/&quot;&gt;åšå®¢å›­ä¸»é¡µ&lt;/a&gt;ã€&lt;a href=&quot;https://blog.csdn.net/henjay724&quot;&gt;CSDNä¸»é¡µ&lt;/a&gt;ã€&lt;a href=&quot;https://www.zhihu.com/people/henjay724&quot;&gt;çŸ¥ä¹ä¸»é¡µ&lt;/a&gt;ã€&lt;a href=&quot;http://weixin.sogou.com/weixin?type=1&amp;amp;query=%E7%97%9E%E5%AD%90%E8%A1%A1%E5%B5%8C%E5%85%A5%E5%BC%8F&quot;&gt;å¾®ä¿¡å…¬ä¼—å·&lt;/a&gt; å¹³å°ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å¾®ä¿¡æœç´¢&quot;&lt;strong&gt;ç—å­è¡¡åµŒå…¥å¼&lt;/strong&gt;&quot;æˆ–è€…æ‰«æä¸‹é¢äºŒç»´ç ï¼Œå°±å¯ä»¥åœ¨æ‰‹æœºä¸Šç¬¬ä¸€æ—¶é—´çœ‹äº†å“¦ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://henjay724.com/image/github/pzhMcu_qrcode_258x258.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;/div&gt;</description>
<pubDate>Thu, 20 Aug 2020 13:58:00 +0000</pubDate>
<dc:creator>ç—å­è¡¡</dc:creator>
<og:description>å‰æ®µæ—¶é—´ç—å­è¡¡å†™äº†ä¸€ç¯‡æ–‡ç«  ã€Šåˆ©ç”¨i.MXRT1060,1010ä¸Šæ–°å¢çš„FlexSPIåœ°å€é‡æ˜ å°„(Remap)åŠŸèƒ½å¯å®‰å…¨OTAã€‹ï¼Œä»‹ç»äº†RemapåŠŸèƒ½åœ¨OTAè®¾è®¡ä¸­çš„é‡è¦æ€§ã€‚å¦‚æœä½ å¯¹æ¯”è¿‡i.MXRTä¸‰</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/henjay724/p/13538105.html</dc:identifier>
</item>
<item>
<title>C++ Templates (2.1 ç±»æ¨¡æ¿Stackçš„å®ç° Implementation of Class Template Stack) - å¤±è½å­¤èˆŸ</title>
<link>http://www.cnblogs.com/kaycharm/p/13532307.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/kaycharm/p/13532307.html</guid>
<description>&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/kaycharm/p/13433381.html#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E7%AB%A0%E8%8A%82%E7%9B%AE%E5%BD%95&quot;&gt;è¿”å›å®Œæ•´ç›®å½•&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;æ­£å¦‚å‡½æ•°æ¨¡æ¿ï¼Œå¯ä»¥å¦‚ä¸‹æ–¹å¼åœ¨ä¸€ä¸ªå¤´æ–‡ä»¶ä¸­å£°æ˜å’Œå®šä¹‰ç±»&lt;code&gt;Stack&amp;lt;&amp;gt;&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;// basics/stack1.hpp

#include &amp;lt;vector&amp;gt;
#include &amp;lt;cassert&amp;gt;

template &amp;lt;typename T&amp;gt;
class Stack
{
private:
      std::vector&amp;lt;T&amp;gt; elems;      //å…ƒç´ 

public:
      void push(T const&amp;amp; elem);      //å‹å…¥å…ƒç´ 
      void pop();      // å¼¹å‡ºå…ƒç´ 
      T const&amp;amp; top() const;      //è¿”å›é¡¶ä¸Šçš„å…ƒç´ 
      bool empty()      //è¿”å›æ ˆstackæ˜¯å¦ä¸ºç©º
      {
            return elems.empty();
      }
};

template &amp;lt;typename T&amp;gt;
void Stack&amp;lt;T&amp;gt;::push(T const&amp;amp; elem)
{
      elems.push_back(elem);      //å°†elemçš„æ‹·è´æ”¾å…¥elemsæœ«å°¾
}

template &amp;lt;typename T&amp;gt;
void Stack&amp;lt;T&amp;gt;::pop()
{
      assert(!elems.empty());
      elems.pop_back();      //ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ 
}

template &amp;lt;typename T&amp;gt;
T const&amp;amp; Stack&amp;lt;T&amp;gt;::top() const
{
      assert(!elems.empty());
      return elems.back();      //è¿”å›æœ€åä¸€ä¸ªå…ƒç´ 
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ­£å¦‚æ‰€çœ‹åˆ°çš„ï¼Œè¯¥ç±»æ¨¡æ¿ä½¿ç”¨C++æ ‡å‡†åº“çš„&lt;code&gt;vector&amp;lt;&amp;gt;&lt;/code&gt;å®ç°ï¼Œè¿™æ ·ä¾¿æ— éœ€å®ç°å†…å­˜ç®¡ç†ã€æ‹·è´æ§åˆ¶å’Œèµ‹å€¼è¿ç®—ï¼Œè¿™æ ·ä¾¿å¯ä»¥å°†é‡å¿ƒæ”¾åœ¨ç±»æ¨¡æ¿çš„æ¥å£ä¸Šã€‚&lt;/p&gt;
&lt;h2 id=&quot;211-å£°æ˜ç±»æ¨¡æ¿-declaration-of-class-templates&quot;&gt;2.1.1 å£°æ˜ç±»æ¨¡æ¿ Declaration of Class Templates&lt;/h2&gt;
&lt;p&gt;å£°æ˜ç±»æ¨¡æ¿ä¸å£°æ˜å‡½æ•°æ¨¡æ¿ç±»ä¼¼ï¼šåœ¨å£°æ˜ä¹‹å‰ï¼Œå¿…é¡»å£°æ˜ä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹å‚æ•°çš„æ ‡è¯†ç¬¦ã€‚å†ä¸€æ¬¡ï¼ŒTæ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ ‡è¯†ç¬¦ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;template &amp;lt;typename T&amp;gt;
class Stack
{
...
};
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ­¤å¤„çš„å…³é”®å­—&lt;code&gt;typename&lt;/code&gt;ä¹Ÿå¯ä»¥ç”¨&lt;code&gt;class&lt;/code&gt;ä»£æ›¿ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;template &amp;lt;class T&amp;gt;
class Stack
{
...
};
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨ç±»æ¨¡æ¿ä¸­ï¼ŒTå¯ä»¥åƒå…¶ä»–ä»»ä½•ç±»å‹ä¸€æ ·ç”¨äºå£°æ˜æˆå‘˜å’Œæˆå‘˜å‡½æ•°ï¼ˆmember functionï¼‰ã€‚è¯¥ä¾‹å­ä¸­ï¼ŒTç”¨äºå£°æ˜æˆå‘˜çš„ç±»å‹ä¸ºTçš„å‘é‡vectorï¼Œç”¨äºå£°æ˜æˆå‘˜å‡½æ•°&lt;code&gt;push()&lt;/code&gt;ä½¿ç”¨Tç±»å‹ä½œä¸ºå‚æ•°ï¼Œç”¨äºå£°æ˜æˆå‘˜å‡½æ•°&lt;code&gt;top()&lt;/code&gt;çš„è¿”å›ç±»å‹ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;template &amp;lt;typename T&amp;gt;
class Stack
{
private:
      std::vector&amp;lt;T&amp;gt; elems;      //å…ƒç´ 

public:
      void push(T const&amp;amp; elem);      //å‹å…¥å…ƒç´ 
      void pop();      // å¼¹å‡ºå…ƒç´ 
      T const&amp;amp; top() const;      //è¿”å›é¡¶ä¸Šçš„å…ƒç´ 
      bool empty()      //è¿”å›æ ˆstackæ˜¯å¦ä¸ºç©º
      {
            return elems.empty();
      }
};
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¯¥ç±»çš„ç±»å‹ä¸ºStackï¼Œå…¶ä¸­Tä¸ºæ¨¡æ¿å‚æ•°ã€‚å› æ­¤ï¼Œåªè¦åœ¨å£°æ˜ä¸­ä½¿ç”¨è¯¥ç±»çš„ç±»å‹ï¼Œå¿…é¡»ä½¿ç”¨Stackï¼Œé™¤éæ¨¡æ¿å‚æ•°å¯ä»¥æ¨æ–­è€Œå¾—ã€‚ç„¶è€Œï¼Œåœ¨ç±»æ¨¡æ¿å†…ï¼Œä½¿ç”¨æ²¡æœ‰æ¨¡æ¿å®å‚çš„ç±»åæ„å‘³ç€å°†ç±»æ¨¡æ¿å®å‚ä½œä¸ºæ¨¡æ¿å‚æ•°ï¼ˆHowever, inside a class template using the class name not followed by template arguments represents the class with its template parameters as its arguments.ï¼‰ï¼ˆè¯¦è§13.2.3èŠ‚ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼Œå¦‚æœå¿…é¡»å£°æ˜æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦ï¼Œè¿™é€šå¸¸çœ‹èµ·æ¥åƒè¿™æ ·ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;template &amp;lt;typename T&amp;gt;
class Stack
{
      ...
      Stack(Stack const&amp;amp;);      //æ‹·è´æ„é€ 
      Stack&amp;amp; operator=(Stack const&amp;amp;);      //èµ‹å€¼è¿ç®—ç¬¦
};
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™ä¸å¦‚ä¸‹å½¢å¼ç­‰ä»·ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;template &amp;lt;typename T&amp;gt;
class Stack
{
      ...
      Stack(Stack&amp;lt;T&amp;gt; const&amp;amp;);      //æ‹·è´èµ‹å€¼
      Stack&amp;lt;T&amp;gt;&amp;amp; operator=(Stack&amp;lt;T&amp;gt; const&amp;amp;);      //èµ‹å€¼è¿ç®—ç¬¦
};
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä½†é€šå¸¸æ„å‘³ç€å¯¹ç‰¹æ®Šæ¨¡æ¿å‚æ•°çš„ç‰¹æ®Šå¤„ç†ï¼Œå› æ­¤ç¬¬ä¸€ç§å½¢å¼æ›´å¥½ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œåœ¨ç±»ç»“æ„ä¹‹å¤–éœ€è¦æŒ‡å®šæ¨¡æ¿å‚æ•°ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;template &amp;lt;typename T&amp;gt;
bool operator==(Stack&amp;lt;T&amp;gt; const&amp;amp; lhs, Stack&amp;lt;T&amp;gt; const&amp;amp; rhs);
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ³¨æ„åˆ°åœ¨éœ€è¦ç±»åè€Œä¸æ˜¯ç±»çš„ç±»å‹çš„åœ°æ–¹ï¼Œä»…ä»…ä½¿ç”¨Stackä¾¿å¯ä»¥ã€‚è¿™ç‰¹åˆ«æ˜¯åœ¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°åå­—çš„æƒ…å½¢ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸éæ¨¡æ¿ç±»ä¸åŒï¼Œä¸èƒ½åœ¨å‡½æ•°å†…éƒ¨æˆ–è€…&lt;code&gt;å—ä½œç”¨åŸŸï¼ˆblock scopeï¼‰&lt;/code&gt;å†…å£°æ˜ç±»æ¨¡æ¿ã€‚é€šå¸¸ï¼Œæ¨¡æ¿åªèƒ½å®šä¹‰åœ¨å…¨å±€ä½œç”¨åŸŸï¼ˆglobal scopeï¼‰æˆ–è€…å‘½åç©ºé—´ä½œç”¨åŸŸï¼ˆnamespace scopeï¼‰æˆ–è€…ç±»å£°æ˜å†…ï¼ˆè¯¦è§12.1èŠ‚ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&quot;212-æˆå‘˜å‡½æ•°å®ç°-implementation-of-member-functions&quot;&gt;2.1.2 æˆå‘˜å‡½æ•°å®ç° Implementation of Member Functions&lt;/h2&gt;
&lt;p&gt;å®šä¹‰ç±»æ¨¡æ¿çš„æˆå‘˜å‡½æ•°å¿…é¡»æŒ‡å®šè¿™æ˜¯ä¸€ä¸ªæ¨¡æ¿ä¸”å¿…é¡»ä½¿ç”¨ç±»æ¨¡æ¿çš„å®Œæ•´ç±»å‹é™åˆ¶ã€‚å› æ­¤ï¼Œç±»å‹Stackçš„æˆå‘˜å‡½æ•°&lt;code&gt;push()&lt;/code&gt;çš„å®ç°ä¸º&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;template &amp;lt;typename T&amp;gt;
void Stack&amp;lt;T&amp;gt;::push(T const&amp;amp; elem)
{
      elems.push_back(elem);      //å°†elemçš„æ‹·è´æ”¾å…¥elemsæœ«å°¾
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¯¥æƒ…å†µä¸‹ï¼Œæˆå‘˜å‘é‡çš„&lt;code&gt;push_bask()&lt;/code&gt;æ–¹æ³•è¢«è°ƒç”¨ï¼Œå°†å…ƒç´ æ”¾å…¥å‘é‡vectorçš„æœ«å°¾ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„åˆ°å‘é‡vectorçš„&lt;code&gt;pop_back()&lt;/code&gt;å°†ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ ä½†ä¸è¿”å›ï¼Œè¿™è¡Œä¸ºçš„åŸå› æ˜¯&lt;strong&gt;å¼‚å¸¸å®‰å…¨ï¼ˆexception safetyï¼‰&lt;/strong&gt;ã€‚ä¸å¯èƒ½å®ç°ä¸€ä¸ªè¿”å›ç§»é™¤å…ƒç´ çš„å®Œå…¨å¼‚å¸¸å®‰å…¨çš„&lt;code&gt;pop()&lt;/code&gt;ç‰ˆæœ¬ï¼ˆè¯¥é—®é¢˜é¦–å…ˆç”±Tom Cargillåœ¨[CargilExceptionSafety]ä¸­çš„ç¬¬10é¡¹æ¡æ¬¾[SutterExceptional]ä¸­è®¨è®ºï¼‰ã€‚ç„¶è€Œï¼Œå¦‚æœå¿½ç•¥è¯¥å±é™©ï¼Œå¯ä»¥å®ç°è¿”å›ç§»é™¤çš„å…ƒç´ çš„&lt;code&gt;pop()&lt;/code&gt;ã€‚ä¸ºå®ç°æ­¤åŠŸèƒ½ï¼Œç®€å•åœ°ä½¿ç”¨Tæ¥å£°æ˜ç±»å‹ä¸ºå…ƒç´ ç±»å‹çš„å±€éƒ¨å˜é‡ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;template &amp;lt;typename T&amp;gt;
T Stack&amp;lt;T&amp;gt;::pop()
{
      assert(!elems.empty());
      T elem = elems.back();      //ä¿å­˜æœ€åä¸€ä¸ªå…ƒç´ 
      elems.pop_back();      //ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ 
      return elem;      //è¿”å›ä¿å­˜å…ƒç´ çš„æ‹·è´
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç”±äºå½“vectorä¸­æ²¡æœ‰å…ƒç´ æ—¶ï¼Œ&lt;code&gt;back()&lt;/code&gt;ï¼ˆè¿”å›æœ€åä¸€ä¸ªå…ƒç´ ï¼‰å’Œ&lt;code&gt;pop_back()&lt;/code&gt;ï¼ˆç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ ï¼‰éƒ½å°†æœ‰æœªå®šä¹‰çš„è¡Œä¸ºï¼Œå› æ­¤éœ€è¦æ£€æŸ¥æ ˆæ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ºç©ºï¼Œåˆ™æ–­è¨€ï¼ˆassertï¼‰ï¼Œå› ä¸ºåœ¨ç©ºçš„æ ˆä¸Šè°ƒç”¨&lt;code&gt;pop()&lt;/code&gt;æ˜¯é”™è¯¯çš„ã€‚åœ¨&lt;code&gt;top()&lt;/code&gt;ä¸Šä¹Ÿéœ€è¦è¿™ä¹ˆåšï¼Œå®ƒè¿”å›é¡¶ä¸Šçš„å…ƒç´ ä½†ä¸ç§»é™¤ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;template &amp;lt;typename T&amp;gt;
T const&amp;amp; Stack&amp;lt;T&amp;gt;::top() const
{
      assert(elems.empty());
      return elems.back();      //è¿”å›æœ€åä¸€ä¸ªå…ƒç´ 
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å½“ç„¶ï¼Œå¯¹äºä»»ä½•æˆå‘˜å‡½æ•°ï¼Œä¹Ÿå¯ä»¥å°†ç±»æ¨¡æ¿çš„æˆå‘˜å‡½æ•°åœ¨ç±»çš„å£°æ˜ä¸­å®ç°ä¸ºinlineï¼Œæ¯”å¦‚ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;template &amp;lt;typename T&amp;gt;
class Stack
{
      ...
      void push(T const&amp;amp; elem)
      {
            elems.push_back(elem);      //å°†elemæ”¾å…¥æœ«å°¾
      }
};
&lt;/code&gt;
&lt;/pre&gt;</description>
<pubDate>Thu, 20 Aug 2020 13:57:00 +0000</pubDate>
<dc:creator>å¤±è½å­¤èˆŸ</dc:creator>
<og:description>è¿”å›å®Œæ•´ç›®å½• 2.1 ç±»æ¨¡æ¿Stackçš„å®ç° Implementation of Class Template Stack æ­£å¦‚å‡½æ•°æ¨¡æ¿ï¼Œå¯ä»¥å¦‚ä¸‹æ–¹å¼åœ¨ä¸€ä¸ªå¤´æ–‡ä»¶ä¸­å£°æ˜å’Œå®šä¹‰ç±»Stack&amp;amp;lt</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/kaycharm/p/13532307.html</dc:identifier>
</item>
<item>
<title>ã€æ•…éšœå…¬å‘Šã€‘é˜¿é‡Œäº‘ RDS æ•°æ®åº“çªå‘ CPU è¿‘ 100% å¼•å‘å…¨ç«™æ•…éšœ - åšå®¢å›­å›¢é˜Ÿ</title>
<link>http://www.cnblogs.com/cmt/p/13538091.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/cmt/p/13538091.html</guid>
<description>&lt;p&gt;ä»Šå¤©æ™šä¸Š9ç‚¹æˆ‘ä»¬æ”¶åˆ°é˜¿é‡Œäº‘çš„å‘Šè­¦é€šçŸ¥ï¼Œæ”¶åˆ°é€šçŸ¥åï¼Œæˆ‘ä»¬ç«‹å³ç™»å½•é˜¿é‡Œäº‘ RDS æ§åˆ¶å°è¿›è¡Œä¸»å¤‡åº“åˆ‡æ¢ï¼Œç­‰ä¸»å¤‡åº“å®Œæˆåˆ‡æ¢åä¸€çœ‹å¹¶æ²¡æœ‰åˆ‡æ¢è¿‡æ¥ï¼Œèµ¶ç´§å†æ¬¡è¿›è¡Œåˆ‡æ¢ï¼Œç¬¬2æ¬¡åˆ‡æ¢æˆåŠŸäº†ï¼Œåˆ‡æ¢å®Œæˆå CPU ç«‹åˆ»é™è‡³æ­£å¸¸æ°´å¹³ï¼Œå…¨ç«™æ¢å¤æ­£å¸¸ã€‚è¿™æ¬¡æ•…éšœå‘ç”Ÿæ—¶é—´æ˜¯8æœˆ20æ—¥20:55~21:14ï¼Œç”±æ­¤ç»™æ‚¨å¸¦æ¥éº»çƒ¦ï¼Œè¯·æ‚¨è°…è§£ã€‚&lt;/p&gt;&lt;div id=&quot;cnblogs_post_body&quot; readability=&quot;66.619146722164&quot;&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/35695/202008/35695-20200820213902223-1633586256.png&quot; width=&quot;600&quot; height=&quot;290&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä»Šå¤©æ™šä¸Š9ç‚¹æˆ‘ä»¬æ”¶åˆ°é˜¿é‡Œäº‘çš„å‘Šè­¦é€šçŸ¥ï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;ã€é˜¿é‡Œäº‘ç›‘æ§ã€‘åä¸œ1(æ­å·)-äº‘æ•°æ®åº“RDSç‰ˆ&amp;lt;cnblogsdb&amp;gt; [instanceId=xxx] äº21:00 å‘ç”Ÿå‘Šè­¦ï¼ŒÂ å‰å¾€è¯Šæ–­Â CPUä½¿ç”¨ç‡å¹³å‡å€¼ï¼ˆ98.25&amp;gt;=80 ï¼‰ï¼Œ æŒç»­æ—¶é—´4åˆ†é’Ÿ,Â rds_CpuUsage&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ”¶åˆ°é€šçŸ¥åï¼Œæˆ‘ä»¬ç«‹å³ç™»å½•é˜¿é‡Œäº‘ RDS æ§åˆ¶å°è¿›è¡Œä¸»å¤‡åº“åˆ‡æ¢ï¼Œç­‰ä¸»å¤‡åº“å®Œæˆåˆ‡æ¢åä¸€çœ‹å¹¶æ²¡æœ‰åˆ‡æ¢è¿‡æ¥ï¼Œèµ¶ç´§å†æ¬¡è¿›è¡Œåˆ‡æ¢ï¼Œç¬¬2æ¬¡åˆ‡æ¢æˆåŠŸäº†ï¼Œåˆ‡æ¢å®Œæˆå CPU ç«‹åˆ»é™è‡³æ­£å¸¸æ°´å¹³ï¼Œå…¨ç«™æ¢å¤æ­£å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ¬¡æ•…éšœå‘ç”Ÿæ—¶é—´æ˜¯8æœˆ20æ—¥20:55~21:14ï¼Œç”±æ­¤ç»™æ‚¨å¸¦æ¥éº»çƒ¦ï¼Œè¯·æ‚¨è°…è§£ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šæ¬¡å‘ç”ŸåŒæ ·æ•…éšœæ˜¯6æœˆ24æ—¥ï¼Œè¯¦è§ &lt;a id=&quot;cb_post_title_url&quot; class=&quot;postTitle2 vertical-middle&quot; href=&quot;https://www.cnblogs.com/cmt/p/13185741.html&quot;&gt;ã€æ•…éšœå…¬å‘Šã€‘é˜¿é‡Œäº‘ RDS å®ä¾‹ CPU 100% æ•…éšœå¼•å‘å…¨ç«™æ— æ³•æ­£å¸¸è®¿é—®&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é˜¿é‡Œäº‘æ•°æ®åº“ä¸“å®¶åˆ†æåæ€€ç–‘æ˜¯â€œLINQ ç”Ÿæˆçš„ SQL å­˜åœ¨é—®é¢˜ï¼Œå¯¼è‡´æ¦‚ç‡æ€§ SQL Server å‡ºç°å‚æ•°å—…æ¢é—®é¢˜â€ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä¼šè¿›ä¸€æ­¥åˆ†æå¹¶ä¼˜åŒ–è¿™æ¬¡å¼•å‘å‚æ•°å—…æ¢é—®é¢˜çš„ SQL è¯­å¥ã€‚&lt;/p&gt;
&lt;/div&gt;</description>
<pubDate>Thu, 20 Aug 2020 13:55:00 +0000</pubDate>
<dc:creator>åšå®¢å›­å›¢é˜Ÿ</dc:creator>
<og:description>ä»Šå¤©æ™šä¸Š9ç‚¹æˆ‘ä»¬æ”¶åˆ°é˜¿é‡Œäº‘çš„å‘Šè­¦é€šçŸ¥ï¼Œæ”¶åˆ°é€šçŸ¥åï¼Œæˆ‘ä»¬ç«‹å³ç™»å½•é˜¿é‡Œäº‘ RDS æ§åˆ¶å°è¿›è¡Œä¸»å¤‡åº“åˆ‡æ¢ï¼Œç­‰ä¸»å¤‡åº“å®Œæˆåˆ‡æ¢åä¸€çœ‹å¹¶æ²¡æœ‰åˆ‡æ¢è¿‡æ¥ï¼Œèµ¶ç´§å†æ¬¡è¿›è¡Œåˆ‡æ¢ï¼Œç¬¬2æ¬¡åˆ‡æ¢æˆåŠŸäº†ï¼Œåˆ‡æ¢å®Œæˆå CPU ç«‹åˆ»é™</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/cmt/p/13538091.html</dc:identifier>
</item>
<item>
<title>Javaè¿›é˜¶ä¸“é¢˜(åä¸€) æ¢ç©¶JMM - é“é˜»ä¸”é•¿å•Š</title>
<link>http://www.cnblogs.com/whgk/p/13534969.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/whgk/p/13534969.html</guid>
<description>&lt;p&gt;å‰è¨€&lt;/p&gt;
&lt;p&gt;â€‹ JMMå³javaå†…å­˜æ¨¡å‹ï¼ŒJMMç ”ç©¶çš„å°±æ˜¯å¤šçº¿ç¨‹ä¸‹Javaä»£ç çš„æ‰§è¡Œé¡ºåºï¼Œå…±äº«å˜é‡çš„è¯»å†™ã€‚å®ƒå®šä¹‰äº†Javaè™šæ‹Ÿæœºåœ¨è®¡ç®—æœºå†…å­˜ä¸­çš„å·¥ä½œæ–¹å¼ã€‚ä»æŠ½è±¡è§’åº¦çœ‹ï¼ŒJMMå®šä¹‰äº†çº¿ç¨‹å’Œä¸»å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ï¼šçº¿ç¨‹ä¹‹å‰çš„å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†è¯¥çº¿ç¨‹è¯»å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚æœ¬åœ°å†…å­˜æ˜¯JMMçš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ã€‚å®ƒæ¶µç›–äº†ç¼“å­˜ã€å†™ç¼“å†²åŒºã€å¯„å­˜å™¨ä»¥åŠå…¶ä»–ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ å…ˆæŠ›å‡ºä¸¤ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ä½ å†™çš„ä»£ç ä¸€å®šæ˜¯å®é™…è¿è¡Œçš„ä»£ç å—ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä»£ç çš„ç¼–å†™é¡ºåºï¼Œä¸€å®šæ˜¯å®é™…æ‰§è¡Œçš„é¡ºåºå—ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;&lt;strong&gt;å‚è€ƒæ–‡çŒ®&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.oracle.com/javase/specs/jls/se7/html/jls-17.html#jls-17.4&quot;&gt;Java Language Specification Chapter 17. Threads and Locks&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://download.oracle.com/otndocs/jcp/memory_model-1.0-pfd-spec-oth-JSpec/&quot;&gt;JSR-133: JavaTM Memory Model and Thread Specification&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://gee.cs.oswego.edu/dl/jmm/cookbook.html&quot;&gt;Doug Lea' s JSR-133 cookbook&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¹¦ç±ï¼šã€ŠJava Concurrency in Practiceã€‹&lt;/p&gt;
&lt;p&gt;å¹¶å‘æµ‹è¯•æ¡†æ¶ï¼š&lt;a href=&quot;https://wiki.openjdk.java.net/display/CodeTools/jcstress&quot;&gt;jcstress&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;å¤šçº¿ç¨‹è¯»å†™å…±äº«å˜é‡&quot;&gt;å¤šçº¿ç¨‹è¯»å†™å…±äº«å˜é‡&lt;/h2&gt;
&lt;h3 id=&quot;é—®é¢˜æ¼”ç¤º&quot;&gt;é—®é¢˜æ¼”ç¤º&lt;/h3&gt;
&lt;p&gt;çŒœçŒœä¸€ä¸‹ä»£ç åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæ ·çš„æƒ…å†µï¼Ÿ&lt;/p&gt;
&lt;h4 id=&quot;æ°¸è¿œçš„å¾ªç¯&quot;&gt;æ°¸è¿œçš„å¾ªç¯&lt;/h4&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;boolean stop;
@Actor
public void a1() {
   while(!stop){
   }
}
@Signal
void a2() {
   stop = true;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;åŠ åŠ å‡å‡&quot;&gt;åŠ åŠ å‡å‡&lt;/h4&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;int balance = 10;
@Actor
public void deposit() {
   balance += 5;
}
@Actor
public void withdraw() {
   balance -= 5;
}
@Arbiter
public void query(I_Result r) {
   r.r1 = balance;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;ç¬¬å››ç§å¯èƒ½&quot;&gt;ç¬¬å››ç§å¯èƒ½&lt;/h4&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;int a;
int b;
@Actor
public void actor1(II_Result r) {
   b = 1;
   r.r2 = a;
}
@Actor
public void actor2(II_Result r) {
   a = 2;
   r.r1 = b;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;é—®é¢˜è§£å¯†&quot;&gt;é—®é¢˜è§£å¯†&lt;/h3&gt;
&lt;h4 id=&quot;å¾ªç¯é—®é¢˜-æ­ç§˜&quot;&gt;å¾ªç¯é—®é¢˜-æ­ç§˜&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæ”¹é€ ä¸‹ä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;package com.study.demo6;

import java.util.concurrent.TimeUnit;

public class WhileTest {
    static boolean stop;

    public static void a1() {
        while (true) {
            boolean b = stop;
            if (b) {
                break;
            }
        }
    }
    
    public static void main(String[] args) {
        new Thread(() -&amp;gt; {
            try {
                TimeUnit.SECONDS.sleep(1);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            stop = true;
            System.out.println(&quot;stop&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;true!&quot;);
        }).start();
        a1();
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœ:&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820144049043-1517957044.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å‘ç°mainä¸»çº¿ç¨‹ä¸­ï¼Œè°ƒç”¨äº†å•Ša1()æ–¹æ³•ï¼Œå­çº¿ç¨‹1ç§’åï¼Œå¯¹stopä¿®æ”¹äº†trueï¼ŒæŒ‰æ­£å¸¸é€»è¾‘ï¼Œæ­»å¾ªç¯åº”è¯¥ä¼šbreakç»ˆæ­¢äº†ï¼Œä½†æ˜¯å®é™…ä¸Šè¿è¡Œï¼Œæˆ‘ä»¬å‘ç°ï¼Œä¸€ç›´åœ¨å¾ªç¯ä¸­ï¼Œå¹¶æœªç»ˆæ­¢ï¼&lt;/p&gt;
&lt;p&gt;æç¤ºï¼š&lt;/p&gt;
&lt;p&gt;å…ˆç”¨ -XX:+PrintCompilation æ¥æŸ¥çœ‹å³æ—¶ç¼–è¯‘æƒ…å†µï¼ˆ% çš„å«ä¹‰ On-Stack-Replacementï¼ˆOSRï¼‰ï¼‰&lt;/p&gt;
&lt;p&gt;å†å°è¯•ç”¨ -Xint å¼ºåˆ¶è§£é‡Šæ‰§è¡Œ&lt;/p&gt;
&lt;h4 id=&quot;åŠ åŠ å‡å‡é—®é¢˜-è§£å¯†&quot;&gt;åŠ åŠ å‡å‡é—®é¢˜-è§£å¯†&lt;/h4&gt;
&lt;p&gt;ä»£ç æ¼”ç¤º&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;package com.study.demo6;

import java.util.Arrays;
import java.util.List;

public class AddSubTest {
    static int balance = 10;

    private static void add(){
        balance+=5;
    }
    private static void sub(){
        balance-=5;
    }

    public static void main(String[] args) throws InterruptedException {
        List&amp;lt;Thread&amp;gt; threadList = Arrays.asList(new Thread(AddSubTest::add), new Thread(AddSubTest::sub));
        threadList.forEach(Thread::start);
        for (Thread thread : threadList) {
            thread.join();
        }
        System.out.println(balance);
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™å›ç”¨ä¸€ä¸‹ASM å·¥å…·ï¼Œå¯ä»¥çœ‹åˆ°æºç ç¬¬10 è¡Œçš„ balance += 5 çš„å­—èŠ‚ç å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;LINENUMBER 8 L0
   GETSTATIC TestAddSub.balance : I
   ICONST_5
   IADD
   PUTSTATIC TestAddSub.balance : I
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è€Œç¬¬13 è¡Œçš„ balance -= 5 å­—èŠ‚ç å¦‚ä¸‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;LINENUMBER 12 L0
   GETSTATIC TestAddSub.balance : I
   ICONST_5
   ISUB
   PUTSTATIC TestAddSub.balance : I
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ¢æˆä¼ªä»£å&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;    static int balance = 10;

    private static void add(){
        //balance+=5;
        int b = balance;
        b += 5;
        balance = b;
    }
    private static void sub(){
        //balance-=5;
        int c = balance;
        c -= 5;
        balance = c;
    }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¯èƒ½å‡ºç°çš„æ‰§è¡Œé¡ºåºå¦‚ä¸‹:&lt;/p&gt;
&lt;p&gt;case1: çº¿ç¨‹1å’Œ2ä¸²è¡Œ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;int b = balance; // çº¿ç¨‹1
b += 5;          // çº¿ç¨‹1
balance = b;     // çº¿ç¨‹1
int c = balance; // çº¿ç¨‹2
c -= 5;          // çº¿ç¨‹2
balance = c;     // çº¿ç¨‹2
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;case2:çº¿ç¨‹1å’Œçº¿ç¨‹2åŒæ—¶æ‹¿åˆ°10,çº¿ç¨‹1æ‰§è¡Œå®Œ,çº¿ç¨‹2å†æ‰§è¡Œå®Œ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;int c = balance; // çº¿ç¨‹2
int b = balance; // çº¿ç¨‹1
b += 5;          // çº¿ç¨‹1
balance = b;     // çº¿ç¨‹1
c -= 5;          // çº¿ç¨‹2
balance = c;     // çº¿ç¨‹2
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;case3:çº¿ç¨‹1å’Œçº¿ç¨‹2åŒæ—¶æ‹¿åˆ°10,çº¿ç¨‹2æ‰§è¡Œå®Œ,çº¿ç¨‹1å†æ‰§è¡Œå®Œ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;int b = balance; // çº¿ç¨‹1
int c = balance; // çº¿ç¨‹2
c -= 5;          // çº¿ç¨‹2
balance = c;     // çº¿ç¨‹2
b += 5;          // çº¿ç¨‹1
balance = b;     // çº¿ç¨‹1
&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;ç¬¬å››ç§å¯èƒ½-æ­ç§˜&quot;&gt;ç¬¬å››ç§å¯èƒ½-æ­ç§˜&lt;/h4&gt;
&lt;p&gt;ä»£ç æ¼”ç¤º:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;package com.study.demo6;

public class FourthResultTest {
    int a;
    int b;

    private void actor1(IIResult r){
        b=1;
        r.r2 = a;
    }

    private void actor2(IIResult r){
        a=2;
        r.r1 = b;
    }

}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¯èƒ½å‡ºç°çš„ç»“æœ&lt;/p&gt;
&lt;p&gt;case1:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;b = 1;      // çº¿ç¨‹1
r.r2 = a;   // çº¿ç¨‹1
a = 2;      // çº¿ç¨‹2
r.r1 = b;   // çº¿ç¨‹2
// ç»“æœ r1==1, r2==0
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;case2:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;a = 2;      // çº¿ç¨‹2
r.r1 = b;   // çº¿ç¨‹2
b = 1;      // çº¿ç¨‹1
r.r2 = a;   // çº¿ç¨‹1
// ç»“æœ r1==0, r2==2
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;case3:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;a = 2;      // çº¿ç¨‹2
b = 1;      // çº¿ç¨‹1
r.r2 = a;   // çº¿ç¨‹1
r.r1 = b;   // çº¿ç¨‹2
// ç»“æœ r1==1, r2==2
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;case4:è¿™ç§ç»“æœæ˜¯ä¸æ˜¯è¶…ä¹ä½ çš„é¢„æœŸäº†?è¿™æ˜¯å› ä¸ºå¯èƒ½æ˜¯ç¼–è¯‘å™¨è°ƒæ•´äº†æŒ‡ä»¤æ‰§è¡Œé¡ºåº&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;r.r2 = a;   // çº¿ç¨‹1
a = 2;      // çº¿ç¨‹2
r.r1 = b;   // çº¿ç¨‹2
b = 1;      // çº¿ç¨‹1
// ç»“æœ r1==0, r2==0
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;æ€è€ƒä¸ºä»€ä¹ˆ&quot;&gt;æ€è€ƒä¸ºä»€ä¹ˆ&lt;/h3&gt;
&lt;ol readability=&quot;0.5&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;å¦‚æœè®©ä¸€ä¸ªçº¿ç¨‹æ€»æ˜¯å ç”¨CPU æ˜¯ä¸åˆç†çš„ï¼Œæ‰€æœ‰ä»»åŠ¡è°ƒåº¦å™¨ä¼šè®©çº¿ç¨‹åˆ†æ—¶ä½¿ç”¨CPU&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;ç¼–è¯‘å™¨ä»¥åŠç¡¬ä»¶å±‚é¢éƒ½ä¼šåšå±‚å±‚ä¼˜åŒ–ï¼Œæå‡æ€§èƒ½&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Compiler/JIT ä¼˜åŒ–&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;Processor æµæ°´çº¿ä¼˜åŒ–&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Cache ä¼˜åŒ–&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;h4 id=&quot;ç¼–è¾‘å™¨ä¼˜åŒ–&quot;&gt;ç¼–è¾‘å™¨ä¼˜åŒ–&lt;/h4&gt;
&lt;p&gt;case1:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;//ä¼˜åŒ–å‰
x=1
y=&quot;universe&quot;
x=2
//ä¼˜åŒ–å
y=&quot;universe&quot;
x=2
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;case2:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;//ä¼˜åŒ–å‰
for(i=0;i&amp;lt;max;i++){
       z += a[i]
   }
//ä¼˜åŒ–å
t = z
for(i=0;i&amp;lt;max;i++){
       t += a[i]
   }
z = t
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;case3:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;//ä¼˜åŒ–å‰
if(x&amp;gt;=0){
y = 1;
// ...
}
//ä¼˜åŒ–å
y = 1;
if(x&amp;gt;=0){
// ...
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;processorä¼˜åŒ–&quot;&gt;Processorä¼˜åŒ–&lt;/h4&gt;
&lt;p&gt;æµæ°´çº¿åœ¨CPU çš„ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ä¼šæ‰§è¡Œå¤šä¸ªæŒ‡ä»¤çš„ä¸åŒéƒ¨åˆ†&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éæµæ°´çº¿æ“ä½œ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‡è®¾æœ‰ä¸‰æ¡æŒ‡ä»¤&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;---|---|---|
1   2   3
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ¯æ¡æŒ‡ä»¤æ‰§è¡ŒèŠ±è´¹300ps æ—¶é—´ï¼Œæœ€åå°†ç»“æœå­˜å…¥å¯„å­˜å™¨éœ€è¦20ps&lt;br/&gt;ä¸€ç§’èƒ½è¿è¡Œçš„æŒ‡ä»¤æ•°ä¸º&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820144156563-587917450.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æµæ°´çº¿æ“ä½œ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä»”ç»†åˆ†æå°±ä¼šå‘ç°ï¼Œå¯ä»¥æŠŠæ¯ä¸ªæŒ‡ä»¤ç»†åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;A|B|C|          // 1
 A|B|C|        // 2
   A|B|C|      // 3
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¢åŠ ä¸€äº›å¯„å­˜å™¨ï¼Œç¼“å­˜æ¯ä¸€é˜¶æ®µçš„ç»“æœï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ‰§è¡Œ æŒ‡ä»¤1-C é˜¶æ®µæ—¶ï¼ŒåŒæ—¶æ‰§è¡Œ æŒ‡ä»¤2-B ä»¥åŠ æŒ‡ä»¤3-A&lt;br/&gt;ä¸€ç§’èƒ½è¿è¡Œçš„æŒ‡ä»¤æ•°ä¸º&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820144224741-525364635.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;execute-out-of-order&quot;&gt;execute out of order&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;åœ¨æŒ‰åºæ‰§è¡Œä¸­ï¼Œä¸€æ—¦é‡åˆ°æŒ‡ä»¤ä¾èµ–çš„æƒ…å†µï¼Œæµæ°´çº¿å°±ä¼šåœæ»&lt;/li&gt;
&lt;li&gt;å¦‚æœé‡‡ç”¨ä¹±åºæ‰§è¡Œï¼Œå°±å¯ä»¥è·³åˆ°ä¸‹ä¸€ä¸ªéä¾èµ–æŒ‡ä»¤å¹¶å‘å¸ƒå®ƒã€‚è¿™æ ·ï¼Œæ‰§è¡Œå•å…ƒå°±å¯ä»¥æ€»æ˜¯å¤„äºå·¥ä½œçŠ¶æ€ï¼ŒæŠŠ&lt;br/&gt;æ—¶é—´æµªè´¹å‡åˆ°æœ€å°‘&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;ç¼“å­˜ä¼˜åŒ–&quot;&gt;ç¼“å­˜ä¼˜åŒ–&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820144234091-1796783106.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;MESI (CPUç¼“å­˜ä¸€è‡´æ€§)åè®® å¼•å…¥ç¼“å­˜çš„å‰¯ä½œç”¨åœ¨äºåŒä¸€ä»½æ•°æ®å¯èƒ½ä¿å­˜äº†å‰¯æœ¬ï¼Œä¸€è‡´æ€§è¯¥å¦‚ä½•ä¿è¯å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Modified - è¦å‘å…¶å®ƒCPU å‘é€cache line æ— æ•ˆæ¶ˆæ¯ï¼Œå¹¶ç­‰å¾…ack&lt;/li&gt;
&lt;li&gt;Exclusive - ç‹¬å ã€å³å°†è¦æ‰§è¡Œä¿®æ”¹&lt;/li&gt;
&lt;li&gt;Shared - å…±äº«ã€ä¸€èˆ¬è¯»å–æ—¶çš„åˆå§‹çŠ¶æ€&lt;/li&gt;
&lt;li&gt;Invalid - ä¸€æ—¦å‘ç°æ•°æ®æ— æ•ˆï¼Œéœ€è¦é‡æ–°åŠ è½½æ•°æ®&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;ä¾‹å­&quot;&gt;ä¾‹å­&lt;/h4&gt;
&lt;p&gt;å°±ä¸Šæ–‡æ‰€è¯´çš„ç¬¬å››ç§å¯èƒ½:r1 å’Œr2 æœ‰æ²¡æœ‰å¯èƒ½åŒæ—¶ä¸º0&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;r.r1 = b;   // çº¿ç¨‹2 ä¸ a = 2 é‡æ’
r.r2 = a;   // çº¿ç¨‹1 ä¸ a = 1 é‡æ’
b = 1;      // çº¿ç¨‹1
a = 2;      // çº¿ç¨‹2
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸‹é¢ä»ç¼“å­˜çš„è§’åº¦åˆ†æï¼Œæ³¨æ„å‡å®šæŒ‡ä»¤æ²¡æœ‰é‡æ’&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;b = 1;      // çº¿ç¨‹1 - å†™å…¥ CPU-0 çš„ store buffer
a = 2;      // çº¿ç¨‹2 - å†™å…¥ CPU-1 çš„ store buffer
r.r1 = b;   // çº¿ç¨‹2 - é©¬ä¸Šæ‰§è¡Œ
r.r2 = a;   // çº¿ç¨‹1 - é©¬ä¸Šæ‰§è¡Œ
// çº¿ç¨‹1 - å°† store buffer ä¸­çš„ b = 1 å†™å…¥ cache, æ™šäº†
// çº¿ç¨‹2 - å°† store buffer ä¸­çš„ a = 2 å†™å…¥ cache, æ™šäº†
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;æˆ‘ä»¬å…³æ³¨é—®é¢˜çš„ç‚¹&quot;&gt;æˆ‘ä»¬å…³æ³¨é—®é¢˜çš„ç‚¹&lt;/h3&gt;
&lt;p&gt;â€‹ ä»¥ä¸Šä»‹ç»äº†å¤šçº¿ç¨‹è¯»å†™å…±äº«å˜é‡å¯èƒ½å‘ç”Ÿçš„å“ªäº›é—®é¢˜?ä½†å¯¹äºç¨‹åºå‘˜è€Œè¨€ï¼Œæˆ‘ä»¬ä¸åº”å½“å…³æ³¨ç©¶ç«Ÿæ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–ã€Processor ä¼˜åŒ–ã€ç¼“å­˜ä¼˜åŒ–ã€‚å¦åˆ™ï¼Œå°±å¥½åƒæ‰“å¼€äº†æ½˜å¤šæ‹‰é­”ç›’ï¼&lt;/p&gt;
&lt;h2 id=&quot;jmmå†…å­˜æ¨¡å‹&quot;&gt;JMMå†…å­˜æ¨¡å‹&lt;/h2&gt;
&lt;h3 id=&quot;ä»€ä¹ˆæ˜¯jmm&quot;&gt;ä»€ä¹ˆæ˜¯JMM&lt;/h3&gt;
&lt;p&gt;A memory model describes, given a program and an execution trace of that program, whether the execution trace is a legal execution of the program. A high level, informal overview of the memory model shows it to be a set of rules for when writes by one thread are visible to another thread.&lt;/p&gt;
&lt;p&gt;å¤šçº¿ç¨‹ä¸‹ï¼Œå…±äº«å˜é‡çš„è¯»å†™é¡ºåºæ˜¯å¤´ç­‰å¤§äº‹ï¼Œå†…å­˜æ¨¡å‹å°±æ˜¯å¤šçº¿ç¨‹ä¸‹å¯¹å…±äº«å˜é‡çš„ä¸€ç»„è¯»å†™è§„åˆ™&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å…±äº«å˜é‡å€¼æ˜¯å¦åœ¨çº¿ç¨‹é—´åŒæ­¥&lt;/li&gt;
&lt;li&gt;ä»£ç å¯èƒ½çš„æ‰§è¡Œé¡ºåº&lt;/li&gt;
&lt;li&gt;éœ€è¦å…³æ³¨çš„æ“ä½œå°±æœ‰ä¸¤ç§Loadã€Store
&lt;ul&gt;&lt;li&gt;Load å°±æ˜¯ä»ç¼“å­˜è¯»å–åˆ°å¯„å­˜å™¨ä¸­ï¼Œå¦‚æœä¸€çº§ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œå°±ä¼šå±‚å±‚è¯»å–äºŒçº§ã€ä¸‰çº§ç¼“å­˜ï¼Œæœ€åæ‰æ˜¯Memory&lt;/li&gt;
&lt;li&gt;Store å°±æ˜¯ä»å¯„å­˜å™¨è¿ç®—ç»“æœå†™å…¥ç¼“å­˜ï¼Œä¸ä¼šç›´æ¥å†™å…¥Memoryï¼Œå½“Cache line å°†è¢«eject æ—¶ï¼Œä¼š&lt;br/&gt;writeback åˆ°Memory&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;jmmè§„èŒƒ&quot;&gt;JMMè§„èŒƒ&lt;/h2&gt;
&lt;h4 id=&quot;è§„åˆ™ä¸€-race-condition&quot;&gt;è§„åˆ™ä¸€ Race Condition&lt;/h4&gt;
&lt;p&gt;â€‹ åœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œæ²¡æœ‰å…³ç³»ä¾èµ–çš„ä»£ç ï¼Œåœ¨æ“ä½œå…±äº«å˜é‡æ—¶ï¼ˆè‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹å†™ï¼‰ï¼Œå¹¶ä¸èƒ½ä¿è¯æŒ‰ç¼–å†™é¡ºåºï¼ˆProgram Orderï¼‰æ‰§è¡Œï¼Œè¿™ç§°ä¸ºå‘ç”Ÿäº†ç«æ€æ¡ä»¶ï¼ˆRace Conditonï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚&lt;/p&gt;
&lt;p&gt;æœ‰å…±äº«å˜é‡ xï¼Œçº¿ç¨‹ 1 æ‰§è¡Œ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;r.r1 = y; 
r.r2 = x;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;çº¿ç¨‹ 2 æ‰§è¡Œ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;x = 1; 
y = 1;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æœ€ç»ˆçš„ç»“æœå¯èƒ½æ˜¯ r1&lt;mark&gt;1 è€Œ r2&lt;/mark&gt;0&lt;/p&gt;
&lt;p&gt;ç«æ€æ¡ä»¶æ˜¯ä¸ºäº†æ›´å¥½çš„ data race freeã€‚&lt;/p&gt;
&lt;h4 id=&quot;è§„åˆ™äºŒ-syncronization-order&quot;&gt;è§„åˆ™äºŒ Syncronization Order&lt;/h4&gt;
&lt;p&gt;â€‹ è‹¥è¦ä¿è¯&lt;strong&gt;å¤šçº¿ç¨‹&lt;/strong&gt;ä¸‹ï¼Œ&lt;strong&gt;æ¯ä¸ªçº¿ç¨‹&lt;/strong&gt;çš„&lt;strong&gt;æ‰§è¡Œé¡ºåº&lt;/strong&gt;ï¼ˆSynchronization Orderï¼‰æŒ‰ç¼–å†™é¡ºåºï¼ˆProgram Orderï¼‰æ‰§è¡Œï¼Œé‚£ä¹ˆå¿…é¡»&lt;strong&gt;ä½¿ç”¨&lt;/strong&gt; &lt;strong&gt;Synchronization Actions&lt;/strong&gt; &lt;strong&gt;æ¥ä¿è¯&lt;/strong&gt;ï¼Œè¿™äº› SA æœ‰&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Synchronization Order&lt;/em&gt; ä¹Ÿç§°ä¹‹ä¸º &lt;em&gt;Total Order&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚&lt;/p&gt;
&lt;p&gt;ç”¨ volatile ä¿®é¥°å…±äº«å˜é‡ yï¼Œçº¿ç¨‹ 1 æ‰§è¡Œ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;r.r1 = y; 
r.r2 = x;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;çº¿ç¨‹ 2 æ‰§è¡Œ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;x = 1; 
y = 1;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æœ€ç»ˆçš„ç»“æœå°±&lt;strong&gt;ä¸å¯èƒ½&lt;/strong&gt;æ˜¯ r1&lt;mark&gt;1 è€Œ r2&lt;/mark&gt;0&lt;/p&gt;
&lt;h5 id=&quot;soå¹¶ä¸æ˜¯é˜»æ­¢å¤šçº¿ç¨‹åˆ‡æ¢&quot;&gt;SOå¹¶ä¸æ˜¯é˜»æ­¢å¤šçº¿ç¨‹åˆ‡æ¢&lt;/h5&gt;
&lt;p&gt;é”™è¯¯çš„è®¤è¯†ï¼Œçº¿ç¨‹ 1 æ‰§è¡Œ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;synchronized(LOCK) { 
  r1 = x; //1 å¤„ 
  r2 = x; //2 å¤„ 
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;çº¿ç¨‹ 2 æ‰§è¡Œ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;synchronized(LOCK) { 
  x = 1 
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¹¶ä¸æ˜¯è¯´ //1 ä¸ //2 å¤„ä¹‹é—´ä¸èƒ½åˆ‡æ¢åˆ°çº¿ç¨‹ 2ï¼Œåªæ˜¯å³ä½¿åˆ‡æ¢åˆ°äº†çº¿ç¨‹ 2ï¼Œå› ä¸ºçº¿ç¨‹ 2 ä¸èƒ½æ‹¿åˆ° LOCK é”å¯¼è‡´è¢«é˜»å¡ï¼Œæ‰§è¡Œæƒåˆä¼šè½®åˆ°çº¿ç¨‹ 1&lt;/p&gt;
&lt;h5 id=&quot;volatile-åªç”¨äº†ä¸€åŠç®—-so-å—&quot;&gt;&lt;strong&gt;volatile&lt;/strong&gt; &lt;strong&gt;åªç”¨äº†ä¸€åŠç®—&lt;/strong&gt; &lt;strong&gt;SO&lt;/strong&gt; å—?&lt;/h5&gt;
&lt;p&gt;&lt;strong&gt;ç”¨ä¾‹1&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;int x; 
volatile int y;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¹‹åé‡‡ç”¨&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;x = 10; //1 å¤„ 
y = 20; //2 å¤„
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ­¤æ—¶ //1 å¤„ä»£ç ç»ä¸ä¼šé‡æ’åˆ° //2 å¤„ä¹‹åï¼ˆåªå†™äº† volatile å˜é‡ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç”¨ä¾‹&lt;/strong&gt; &lt;strong&gt;2&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;int x; 
volatile int y;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ‰§è¡Œä¸‹é¢çš„æµ‹è¯•ç”¨ä¾‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;@Actor 
public void a1(II_Result r) { 
  y = 1; //1 å¤„ 
  r.r2 = x; //2 å¤„ 
}
@Actor 
public void a2(II_Result r) { 
  x = 1; //3 å¤„ 
  r.r1 = y; //4 å¤„ 
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;//1 //2 å¤„çš„é¡ºåºå¯ä»¥ä¿è¯ï¼ˆåªå†™äº† volatile å˜é‡ï¼‰ï¼Œä½† //3 //4 å¤„çš„é¡ºåºå´ä¸èƒ½ä¿è¯ï¼ˆåªè¯»äº† volatile å˜é‡ï¼‰ï¼Œä»ä¼šå‡ºç° r1&lt;mark&gt;r2&lt;/mark&gt;0 çš„é—®é¢˜&lt;/p&gt;
&lt;p&gt;æœ‰æ—¶ä¼šå¾ˆè¿·æƒ‘äººï¼Œä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç”¨ä¾‹3&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;@Actor 
public void a1(II_Result r) { 
  r.r2 = x; //1 å¤„ 
  y = 1; //2 å¤„ 
}
@Actor 
public void a2(II_Result r) { 
  r.r1 = y; //3 å¤„ 
  x = 1; //4 å¤„ 
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™å› //1 //2 ï¼ˆåªå†™äº† volatile å˜é‡ï¼‰//3 //4 å¤„ï¼ˆåªè¯»äº† volatile å˜é‡ï¼‰çš„é¡ºåºå‡èƒ½ä¿è¯äº†ï¼Œç»ä¸ä¼šå‡ºç°r1&lt;mark&gt;r2&lt;/mark&gt;1 çš„æƒ…å†µ&lt;/p&gt;
&lt;p&gt;â€‹ æ­¤å¤–å°†ç”¨ä¾‹ 2 ä¸­ä¸¤ä¸ªå˜é‡å‡ç”¨ volatile ä¿®é¥°å°±ä¸ä¼šå‡ºç° r1&lt;mark&gt;r2&lt;/mark&gt;0 çš„é—®é¢˜ï¼Œå› æ­¤ä¹ŸæŠŠå…¨éƒ¨éƒ½ç”¨ &lt;em&gt;volatile&lt;/em&gt; ä¿®é¥°ç§°ä¸º&lt;em&gt;total order&lt;/em&gt;ï¼Œéƒ¨åˆ†å˜é‡ç”¨ &lt;em&gt;volatile&lt;/em&gt; ä¿®é¥°ç§°ä¸º &lt;em&gt;partial order&lt;/em&gt;&lt;/p&gt;
&lt;h4 id=&quot;è§„åˆ™ä¸‰-happens-before&quot;&gt;è§„åˆ™ä¸‰ Happens Before&lt;/h4&gt;
&lt;p&gt;â€‹ è‹¥æ˜¯å˜é‡è¯»å†™æ—¶&lt;strong&gt;å‘ç”Ÿçº¿ç¨‹åˆ‡æ¢&lt;/strong&gt;ï¼ˆä¾‹å¦‚ï¼Œçº¿ç¨‹ 1 å†™å…¥ xï¼Œåˆ‡æ¢è‡³çº¿ç¨‹ 2ï¼Œçº¿ç¨‹ 2 è¯»å– xï¼‰åœ¨è¿™äº›è¾¹ç•Œçš„å¤„ç†ä¸Š&lt;strong&gt;å¦‚æœæœ‰&lt;/strong&gt;action1 &lt;strong&gt;å…ˆäº&lt;/strong&gt; &lt;strong&gt;action 2&lt;/strong&gt; &lt;strong&gt;å‘ç”Ÿ&lt;/strong&gt;ï¼Œé‚£ä¹ˆä»£ç &lt;strong&gt;å¯ä»¥æŒ‰ç¡®å®šçš„é¡ºåº&lt;/strong&gt;æ‰§è¡Œï¼Œè¿™ç§°ä¹‹ä¸º &lt;strong&gt;Happens-Before Order&lt;/strong&gt; è§„åˆ™(&lt;em&gt;Happens-Before Order&lt;/em&gt; ä¹Ÿç§°ä¹‹ä¸º &lt;em&gt;Partial Order&lt;/em&gt;).&lt;/p&gt;
&lt;p&gt;ç”¨å…¬å¼è¡¨è¾¾å°±æ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820212223348-1145987560.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å«ä¹‰ä¸ºï¼šå¦‚æœ action1 å…ˆäº action2 å‘ç”Ÿï¼Œé‚£ä¹ˆ action1 ä¹‹å‰çš„å…±äº«å˜é‡çš„ä¿®æ”¹å¯¹äº action2 &lt;strong&gt;å¯è§&lt;/strong&gt;ï¼Œä¸”ä»£ç æŒ‰ PO&lt;strong&gt;é¡ºåº&lt;/strong&gt;æ‰§è¡Œ&lt;/p&gt;
&lt;h5 id=&quot;å…·ä½“è§„åˆ™&quot;&gt;å…·ä½“è§„åˆ™&lt;/h5&gt;
&lt;p&gt;å…¶ä¸­ $T_{n}$ ä»£è¡¨çº¿ç¨‹ï¼Œè€Œ x æœªåŠ è¯´æ˜ï¼Œæ˜¯æ™®é€šå…±äº«å˜é‡ï¼Œä½¿ç”¨ volatile ä¼šå•ç‹¬è¯´æ˜&lt;/p&gt;
&lt;h5 id=&quot;1ï¼‰çº¿ç¨‹çš„å¯åŠ¨å’Œè¿è¡Œè¾¹ç•Œ&quot;&gt;1ï¼‰çº¿ç¨‹çš„å¯åŠ¨å’Œè¿è¡Œè¾¹ç•Œ&lt;/h5&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820212234711-905975963.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h5 id=&quot;2ï¼‰çº¿ç¨‹çš„ç»“æŸå’Œjoinè¾¹ç•Œ&quot;&gt;2ï¼‰çº¿ç¨‹çš„ç»“æŸå’Œjoinè¾¹ç•Œ&lt;/h5&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820212247535-1019908661.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h5 id=&quot;3ï¼‰çº¿ç¨‹çš„æ‰“æ–­å’Œå¾—çŸ¥æ‰“æ–­çš„è¾¹ç•Œ&quot;&gt;3ï¼‰çº¿ç¨‹çš„æ‰“æ–­å’Œå¾—çŸ¥æ‰“æ–­çš„è¾¹ç•Œ&lt;/h5&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820212302937-492808887.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h5 id=&quot;4ï¼‰unlock-ä¸-lock-è¾¹ç•Œ&quot;&gt;4ï¼‰&lt;strong&gt;unlock&lt;/strong&gt; &lt;strong&gt;ä¸&lt;/strong&gt; &lt;strong&gt;lock&lt;/strong&gt; &lt;strong&gt;è¾¹ç•Œ&lt;/strong&gt;&lt;/h5&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820212315977-1829899709.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h5 id=&quot;5ï¼‰volatile-write-ä¸-volatile-read-è¾¹ç•Œ&quot;&gt;5ï¼‰&lt;strong&gt;volatile write&lt;/strong&gt; &lt;strong&gt;ä¸&lt;/strong&gt; &lt;strong&gt;volatile read&lt;/strong&gt; &lt;strong&gt;è¾¹ç•Œ&lt;/strong&gt;&lt;/h5&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820212327955-291320079.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h5 id=&quot;6ï¼‰ä¼ é€’æ€§&quot;&gt;6ï¼‰ä¼ é€’æ€§&lt;/h5&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820212336616-783991906.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;è§„åˆ™å››-causality&quot;&gt;è§„åˆ™å›› Causality&lt;/h4&gt;
&lt;p&gt;Causality å³å› æœå¾‹ï¼šä»£ç ä¹‹é—´å¦‚&lt;strong&gt;å­˜åœ¨ä¾èµ–å…³ç³»&lt;/strong&gt;ï¼Œ&lt;strong&gt;å³ä½¿æ²¡æœ‰åŠ &lt;/strong&gt; &lt;strong&gt;SA&lt;/strong&gt; æ“ä½œï¼Œä»£ç çš„æ‰§è¡Œé¡ºåºä¹Ÿæ˜¯å¯ä»¥é¢„è§çš„&lt;/p&gt;
&lt;p&gt;å›é¡¾ä¸€ä¸‹&lt;/p&gt;
&lt;p&gt;â€‹ &lt;em&gt;å¤šçº¿ç¨‹ä¸‹ï¼Œæ²¡æœ‰ä¾èµ–å…³ç³»çš„ä»£ç ï¼Œåœ¨å…±äº«å˜é‡è¯»å†™æ“ä½œï¼ˆè‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹å†™ï¼‰æ—¶ï¼Œå¹¶ä¸èƒ½ä¿è¯ä»¥ç¼–å†™é¡ºåºï¼ˆProgram Orderï¼‰æ‰§è¡Œï¼Œè¿™ç§°ä¸ºå‘ç”Ÿäº†ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰ä¸€å®šçš„ä¾èµ–å…³ç³»å‘¢ï¼Ÿ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;@JCStressTest
@Outcome(id = {&quot;0&quot;, &quot;0&quot;}, expect = Expect.ACCEPTABLE, desc = &quot;ACCEPTABLE&quot;)
@Outcome(expect = Expect.FORBIDDEN, desc = &quot;FORBIDDEN&quot;)
@State
public class Case {
    int x;
    int y;

    @Actor
    public void a1(IIResult r) {
        r.r1 = x;
        y = r.r1;
    }

    @Actor
    public void a2(IIResult r){
        r.r2 = y;
        x = r.r2;
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;x çš„å€¼æ¥è‡ªäº yï¼Œy çš„å€¼æ¥è‡ªäº xï¼Œè€ŒäºŒè€…çš„åˆå§‹å€¼éƒ½æ˜¯ 0ï¼Œå› æ­¤æ²¡æœ‰å¯èƒ½æœ‰å…¶ä»–ç»“æœ&lt;/p&gt;
&lt;h4 id=&quot;è§„åˆ™äº”å®‰å…¨å‘å¸ƒ&quot;&gt;è§„åˆ™äº”å®‰å…¨å‘å¸ƒ&lt;/h4&gt;
&lt;p&gt;è‹¥è¦å®‰å…¨æ„é€ å¯¹è±¡ï¼Œå¹¶å°†å…¶å…±äº«ä½¿ç”¨ï¼Œ&lt;strong&gt;éœ€è¦ç”¨&lt;/strong&gt; &lt;strong&gt;final&lt;/strong&gt; &lt;strong&gt;æˆ–&lt;/strong&gt; &lt;strong&gt;volatile&lt;/strong&gt; &lt;strong&gt;ä¿®é¥°å…¶æˆå‘˜å˜é‡&lt;/strong&gt;ï¼Œå¹¶&lt;strong&gt;é¿å…&lt;/strong&gt; &lt;strong&gt;this&lt;/strong&gt; &lt;strong&gt;æº¢å‡º&lt;/strong&gt;æƒ…å†µ(é™æ€æˆå‘˜å˜é‡å¯ä»¥å®‰å…¨åœ°å‘å¸ƒ)&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;class Holder{
    int x1;
    volatile int x2;

    public Holder(int x) {
        x1=x;
        x2=x;
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;éœ€è¦å°†å®ƒä½œä¸ºå…¨å±€ä½¿ç”¨&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;Holder f;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªåˆ›å»ºï¼Œä¸€ä¸ªä½¿ç”¨&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;Holder holder;

@Actor
public void a1(){
  holder = new Holder(1);
}

@Actor
public void a2(IIResult r){
  Holder holder = this.holder;
  if (holder != null){
    r.r1 = holder.x1 +holder.x2;
  }else {
    r.r1 = -1;
  }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¯èƒ½çœ‹è§æœªæ„é€ å®Œæ•´çš„å¯¹è±¡&lt;/p&gt;
&lt;h2 id=&quot;åŒæ­¥åŠ¨ä½œ&quot;&gt;åŒæ­¥åŠ¨ä½œ&lt;/h2&gt;
&lt;p&gt;å‰é¢æ²¡æœ‰è¯¦ç»†å±•å¼€ä»è§„åˆ™ 2 ä¹‹åçš„è®²è§£ï¼Œæ˜¯å› ä¸ºè¦ç†è§£è§„åˆ™ï¼Œè¿˜éœ€ç†è§£åº•å±‚åŸç†ï¼Œå³å†…å­˜å±éšœ&lt;/p&gt;
&lt;h3 id=&quot;å†…å­˜å±éšœ&quot;&gt;å†…å­˜å±éšœ&lt;/h3&gt;
&lt;h4 id=&quot;loadload&quot;&gt;LoadLoad&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820212350869-2013411859.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ul readability=&quot;0.5&quot;&gt;&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;é˜²æ­¢ y çš„ Load é‡æ’åˆ° x çš„ Load ä¹‹å‰&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;if(x) { 
  LoadLoad 
    return y 
}
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;æ„ä¹‰ï¼šx == true æ—¶ï¼Œå†å»è·å– yï¼Œå¦åˆ™å¯èƒ½ä¼šç”±äºé‡æ’å¯¼è‡´ y çš„å€¼ç›¸å¯¹äº x æ˜¯è¿‡æœŸçš„&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;loadstore&quot;&gt;LoadStore&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820212403522-1224380374.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;é˜²æ­¢ y çš„ Store è¢«é‡æ’åˆ° x çš„ Load ä¹‹å‰&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;storesotre&quot;&gt;StoreSotre&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820212413582-412954655.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ul readability=&quot;0&quot;&gt;&lt;li readability=&quot;1&quot;&gt;
&lt;p&gt;é˜²æ­¢ A çš„ Store è¢«é‡æ’åˆ° B çš„ Store ä¹‹å&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;A = x 
StoreStore 
B = true
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;æ„ä¹‰ï¼šåœ¨ B ä¿®æ”¹ä¸º true ä¹‹å‰ï¼Œå…¶å®ƒçº¿ç¨‹åˆ«æƒ³çœ‹åˆ° A çš„ä¿®æ”¹&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æœ‰ç‚¹ç±»ä¼¼äº sql ä¸­æ›´æ–°åï¼Œcommit ä¹‹å‰ï¼Œå…¶å®ƒäº‹åŠ¡ä¸èƒ½çœ‹åˆ°è¿™äº›æ›´æ–°ï¼ˆB çš„èµ‹å€¼ä¼šè§¦å‘ commit å¹¶æ’¤é™¤å±éšœï¼‰&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;storeload&quot;&gt;StoreLoad&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820212423763-1970844561.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æ„ä¹‰ï¼šå±éšœå‰çš„æ”¹åŠ¨éƒ½&lt;strong&gt;åŒæ­¥åˆ°ä¸»å­˜&lt;/strong&gt; ï¼Œå±éšœåçš„ Load &lt;strong&gt;è·å–ä¸»å­˜æœ€æ–°æ•°æ®&lt;/strong&gt;ï¼Œå‘ç”Ÿåœ¨çº¿ç¨‹åˆ‡æ¢æ—¶ï¼Œå¹¶ä¸”ä½¿å¾—è“è‰²çº¿ç¨‹æ‰€æœ‰çš„å†™æ“ä½œå†™å…¥ä¸»å­˜ï¼Œä½¿å¾—çº¢è‰²çº¿ç¨‹èƒ½è¯»å–åˆ°æœ€æ–°æ•°æ®
&lt;ul&gt;&lt;li&gt;é˜²æ­¢å±éšœå‰æ‰€æœ‰çš„å†™æ“ä½œï¼Œè¢«é‡æ’åºåˆ°å±éšœåçš„ä»»ä½•çš„è¯»æ“ä½œï¼Œå¯ä»¥è®¤ä¸ºæ­¤ store -&amp;gt; load æ˜¯è¿ç»­çš„&lt;/li&gt;
&lt;li&gt;æœ‰ç‚¹ç±»ä¼¼äº git ä¸­å…ˆ commitï¼Œå†è¿œç¨‹ pollï¼Œè€Œä¸”è¿™ä¸ªåŠ¨ä½œæ˜¯åŸå­çš„&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;å¦‚ä½•è®°å¿†&quot;&gt;å¦‚ä½•è®°å¿†&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;LoadLoad + LoadStore = Acquire å³è®©åŒä¸€çº¿ç¨‹å†…è¯»æ“ä½œä¹‹åçš„è¯»å†™ä¸Šä¸å»ï¼Œç¬¬ä¸€ä¸ª Load èƒ½è¯»åˆ°ä¸»å­˜æœ€æ–°å€¼&lt;/li&gt;
&lt;li&gt;LoadStore + StoreStore = Release å³è®©åŒä¸€çº¿ç¨‹å†…å†™æ“ä½œä¹‹å‰çš„è¯»å†™ä¸‹ä¸æ¥ï¼Œåä¸€ä¸ª Store èƒ½å°†æ”¹åŠ¨éƒ½å†™å…¥ä¸»å­˜&lt;/li&gt;
&lt;li&gt;StoreLoad æœ€ä¸ºç‰¹æ®Šï¼Œè¿˜èƒ½ç”¨åœ¨çº¿ç¨‹åˆ‡æ¢æ—¶ï¼Œå¯¹å˜é‡çš„å†™æ“ä½œ &lt;strong&gt;+&lt;/strong&gt; è¯»æ“ä½œåšåŒæ­¥ï¼Œåªè¦æ˜¯å¯¹åŒä¸€å˜é‡å…ˆå†™åè¯»ï¼Œé‚£ä¹ˆå±éšœå°±èƒ½ç”Ÿæ•ˆ&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;volatile&quot;&gt;Volatile&lt;/h3&gt;
&lt;h4 id=&quot;æœ¬è´¨&quot;&gt;æœ¬è´¨&lt;/h4&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820212434687-2145733747.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;äº‹å®ä¸Šå¯¹ volatile è€Œè¨€ Store-Load å±éšœæœ€ä¸ºæœ‰ç”¨ï¼Œç®€åŒ–èµ·è§ä»¥åçš„åˆ†æçœç•¥éƒ¨åˆ†å…¶ä»–å±éšœ&lt;/p&gt;
&lt;h4 id=&quot;ä½œç”¨&quot;&gt;ä½œç”¨&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;ä¿è¯å•ä¸€å˜é‡çš„åŸå­æ€§&lt;/li&gt;
&lt;li&gt;æ§åˆ¶äº†å¯èƒ½çš„æ‰§è¡Œè·¯å¾„ï¼š çº¿ç¨‹å†…æŒ‰å±éšœæœ‰åºï¼Œçº¿ç¨‹åˆ‡æ¢æ—¶æŒ‰HBæœ‰åº&lt;/li&gt;
&lt;li&gt;å¯è§æ€§ï¼šçº¿ç¨‹åˆ‡æ¢æ—¶è‹¥å‘ç”Ÿäº†è¯»å†™åˆ™å˜é‡å¯è§ï¼Œé¡ºå¸¦å½±å“æ™®é€šå˜é‡å¯è§&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;volatileçš„ç”¨é€”&quot;&gt;volatileçš„ç”¨é€”&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;å‡¡æ˜¯éœ€è¦casæ“ä½œçš„åœ°æ–¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚AtomicIntegerçš„æºç &lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public class AtomicInteger extends Number implements java.io.Serializable {
    private static final Unsafe U = Unsafe.getUnsafe();
    private static final long VALUE = U.objectFieldOffset(AtomicInteger.class, &quot;value&quot;);
    private volatile int value; 
    
    // ...

    public final boolean compareAndSet(int expectedVal, int newVal) {
        return U.compareAndSetInt(this, VALUE, expectedVal, newVal);
    }
    
    // ...
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;em&gt;AbstractQueuedSynchronizer&lt;/em&gt;çš„æºç &lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public abstract class AbstractQueuedSynchronizer extends AbstractOwnableSynchronizer implements java.io.Serializable {
    private transient volatile Node head;
    private transient volatile Node tail;
    private volatile int state;

    protected final int getState() {
        return state;
    }

    protected final boolean compareAndSetState(int e, int n) {
        return U.compareAndSetInt(this, STATE, e, n);
    }

    final void enqueue(Node node) {
        if (node != null) {
            for (; ; ) {
                Node t = tail;
                node.setPrevRelaxed(t);
                if (t == null) tryInitializeHead();

                else if (casTail(t, node)) {
                    t.next = node;
                    if (t.status &amp;lt; 0) LockSupport.unpark(node.waiter);
                    break;
                }
            }
        }
    }

    private void tryInitializeHead() {
        Node h = new ExclusiveNode(); // å¤´
        if (U.compareAndSetReference(this, HEAD, null, h)) tail = h;
    }

    private boolean casTail(Node c, Node v) {
        return U.compareAndSetReference(this, TAIL, c, v);
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;em&gt;ConcurrentHashMap&lt;/em&gt;æºç &lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public class ConcurrentHashMap&amp;lt;K, V&amp;gt; extends AbstractMap&amp;lt;K, V&amp;gt; implements ConcurrentMap&amp;lt;K, V&amp;gt;, Serializable {
    /**
     * Table initialization and resizing control. When negative, the
     * table is being initialized or resized: -1 for initialization,
     * else -(1 + the number of active resizing threads). Otherwise,
     * when table is null, holds the initial table size to use upon
     * reation, or 0 for default. After initialization, holds the
     * next element count value upon which to resize the table.
     */
    private transient volatile int sizeCtl;
    /**
     * The array of bins. Lazily initialized upon first insertion.
     * Size is always a power of two. Accessed directly by iterators.
     */
    transient volatile Node&amp;lt;K, V&amp;gt;[] table;

    private final Node&amp;lt;K, V&amp;gt;[] initTable() {
        Node&amp;lt;K, V&amp;gt;[] tab;
        int sc;
        while ((tab = table) == null || tab.length == 0) {
            if ((sc = sizeCtl) &amp;lt; 0) Thread.yield();
            else if (U.compareAndSetInt(this, SIZECTL, sc, -1)) {
                try {
                    if ((tab = table) == null || tab.length == 0) {
                        int n = (sc &amp;gt; 0) ? sc : DEFAULT_CAPACITY;
                        Node&amp;lt;K, V&amp;gt;[] nt = (Node&amp;lt;K, V&amp;gt;[]) new Node&amp;lt;?, ?&amp;gt;[n];
                        table = tab = nt;
                        sc = n - (n &amp;gt;&amp;gt;&amp;gt; 2);
                    }
                } finally {
                    sizeCtl = sc;
                }
                break;
            }
        }
        return tab;
    }
    // ... 
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;volatileè´Ÿè´£ä¿è¯å¯è§æ€§ï¼Œcasæ¥ä¿è¯åŸå­&lt;/p&gt;
&lt;h3 id=&quot;synchronized&quot;&gt;Synchronized&lt;/h3&gt;
&lt;p&gt;æœ¬è´¨&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820212452659-2135317720.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;èµ·å§‹synchronizedæœ¬è´¨å°±æ˜¯é€šä¸¤ä¸ªJVMæŒ‡ä»¤ï¼šmonitorenterå’Œmonitorexitæ¥å®ç°äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢ä¸€æ®µä»£ç çš„æ¥ç ”ç©¶ä¸‹ï¼Œå…¶åŸç†&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;package com;

public class SynchronizedTest {
    static int i = 0;
    public static void main(String[] args) {
        synchronized (SynchronizedTest.class){
            i++;
        }
    }
}

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;é€šè¿‡åç¼–è¯‘çœ‹ä¸‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt; #......
 public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=2, locals=3, args_size=1
         0: ldc           #2                  // class com/SynchronizedTest
         2: dup
         3: astore_1
         4: monitorenter
         5: getstatic     #3                  // Field i:I
         8: iconst_1
         9: iadd
        10: putstatic     #3                  // Field i:I
        13: aload_1
        14: monitorexit
        15: goto          23
        18: astore_2
        19: aload_1
        20: monitorexit
        21: aload_2
        22: athrow
        23: return
#......
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°å°±æ˜¯é€šè¿‡jvmæŒ‡ä»¤monitorenterã€monitorexitå®ç°çš„ï¼Œç»“åˆä¸Šå›¾ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“synchronizedæ˜¯é€šåŠ å¯¹è±¡é”æ¥å®ç°çš„ï¼Œä½†æ˜¯è¿™ä¸ªå¯¹è±¡æ˜¯å¦ä½œä¸ºé”è€Œå­˜åœ¨å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;å½“çº¿ç¨‹1æ‰§è¡Œsynchronizedæ—¶ï¼Œjvmè°ƒç”¨monitorenteræ—¶ï¼Œå°±ä¼šå…ˆæ“ä½œç³»ç»Ÿç”³è¯·ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„Moniteré”ï¼ˆåº•å±‚ç”±c++å®ç°çš„ï¼‰ï¼Œå¹¶æŠŠå…¶åœ°å€å­˜æ”¾åœ¨LOCKå¯¹è±¡å¤´ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;å½“çº¿ç¨‹1æ ¹æ®LOCKå¯¹è±¡å¤´æ‰¾åˆ°Moniteré”ï¼Œåˆ¤æ–­owneræ˜¯å¦è¢«å ç”¨ï¼Œæ²¡æœ‰è¢«å ç”¨ï¼Œå°±ä¼šä¿®æ”¹å…¶å€¼ï¼Œç­‰äºæŒæœ‰äº†é”ã€‚&lt;/li&gt;
&lt;li&gt;å¤§æ¦‚çº¿ç¨‹2åŒæ ·ä¼šæ‰§è¡ŒmonitorenteræŒ‡ä»¤ï¼Œæ ¹æ®LOCKå¯¹è±¡å¤´æ‰¾åˆ°Moniteré”ï¼Œåˆ¤æ–­owneræ˜¯å¦è¢«å ç”¨ï¼Œå‘ç°å·²ç»è¢«å ç”¨ï¼Œé¦–å…ˆä¼šè‡ªæ—‹å°è¯•è·å–ï¼Œä¸€å®šæ¬¡æ•°æ²¡è·å–åˆ°ï¼Œå°±ä¼šè¿›å…¥EntryListé˜Ÿåˆ—ç­‰å¾…ï¼Œå¹¶ä»è¿è¡ŒçŠ¶æ€å˜æˆé˜»å¡çŠ¶æ€ï¼Œçº¿ç¨‹3ä¹Ÿæ˜¯å¦‚æ­¤ã€‚&lt;/li&gt;
&lt;li&gt;å½“çº¿ç¨‹1æ‰§è¡Œå®Œæ¯•æˆ–å‡ºç°å¼‚å¸¸æ—¶å°±ä¼šæ‰§è¡Œmonitorexitï¼Œé‡Šæ”¾ownerå¹¶å”¤é†’EntryListä¸­çš„è¢«é˜»å¡çº¿ç¨‹ï¼Œå…·ä½“éƒ½é˜Ÿåˆ—å¤´è¿˜æ˜¯é˜Ÿåˆ—å°¾éƒ¨å»å”¤é†’ï¼Œè¿™ä¸ªæ ¹æ®å…·ä½“ç®—æ³•å®ç°ï¼Œè¿™é‡Œä¸åšèµ˜è¿°ã€‚&lt;/li&gt;
&lt;li&gt;å‡å¦‚çº¿ç¨‹2è¢«å”¤é†’å°±ä¼šå»è·å–owneræ˜¯å¦ç©ºé—²ï¼Œç©ºé—²äº†å°±å ç”¨ï¼Œçº¿ç¨‹3ä¾ç„¶å¤„äºé˜»å¡çŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;ç›¸å…³å†…å­˜å±éšœ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/874710/202008/874710-20200820212506305-1753503154.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;ä¼˜åŒ–ï¼ˆjdk16ä¹‹åï¼‰&quot;&gt;ä¼˜åŒ–ï¼ˆJDK1.6ä¹‹åï¼‰&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;é‡é‡çº§
&lt;ul&gt;&lt;li&gt;å½“æœ‰ç«äº‰æ—¶ï¼Œä»ä¼šå‘ç³»ç»Ÿç”³è¯· Monitor äº’æ–¥é”&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;è½»é‡çº§é”
&lt;ul&gt;&lt;li&gt;å¦‚æœçº¿ç¨‹åŠ é”ã€è§£é”æ—¶é—´ä¸Šåˆšå¥½æ˜¯é”™å¼€çš„ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨è½»é‡çº§é”ï¼Œåªæ˜¯ä½¿ç”¨ cas å°è¯•å°†å¯¹è±¡å¤´æ›¿æ¢ä¸ºè¯¥çº¿ç¨‹çš„é”è®°å½•åœ°å€ï¼Œå¦‚æœ cas å¤±è´¥ï¼Œä¼šé”é‡å…¥æˆ–è§¦å‘é‡é‡çº§é”å‡çº§&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;åå‘é”
&lt;ul&gt;&lt;li&gt;æ‰“ä¸ªæ¯”æ–¹ï¼Œè½»é‡çº§é”å°±å¥½æ¯”ç”¨è¯¾æœ¬å åº§ï¼Œçº¿ç¨‹æ¯æ¬¡å åº§å‰è¿˜å¾—æ¯”è¾ƒä¸€ä¸‹ï¼Œè¯¾æœ¬æ˜¯ä¸æ˜¯è‡ªå·±çš„ï¼ˆcasï¼‰ï¼Œé¢‘ç¹ cas æ€§èƒ½ä¹Ÿä¼šå—åˆ°å½±å“&lt;/li&gt;
&lt;li&gt;è€Œåå‘é”å°±å¥½æ¯”åº§ä½ä¸Šå·²ç»åˆ»å¥½äº†çº¿ç¨‹çš„åå­—ï¼Œçº¿ç¨‹ã€ä¸“ç”¨ã€‘è¿™ä¸ªåº§ä½ï¼Œæ¯” cas æ›´ä¸ºè½»é‡&lt;/li&gt;
&lt;li&gt;ä½†æ˜¯ä¸€æ—¦å…¶ä»–çº¿ç¨‹è®¿é—®åå‘å¯¹è±¡ï¼Œé‚£ä¹ˆæ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦æŠŠåº§ä½ä¸Šçš„åå­—æ“¦å»ï¼Œè¿™ç§°ä¹‹ä¸º&lt;strong&gt;åå‘é”æ’¤é”€&lt;/strong&gt;ï¼Œé”ä¹Ÿå‡çº§ä¸ºè½»é‡çº§é”&lt;/li&gt;
&lt;li&gt;åå‘é”æ’¤é”€ä¹Ÿå±äºæ˜‚è´µçš„æ“ä½œï¼Œæ€ä¹ˆå‡å°‘å‘¢ï¼ŒJVM ä¼šè®°å½•&lt;strong&gt;è¿™ä¸€ç±»å¯¹è±¡&lt;/strong&gt;è¢«æ’¤é”€çš„æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡äº† 20 è¿™ä¸ªé˜ˆå€¼ï¼Œä¸‹æ¬¡æ–°çº¿ç¨‹è®¿é—®åå‘å¯¹è±¡æ—¶ï¼Œå°±ä¸ç”¨æ’¤é”€äº†ï¼Œè€Œæ˜¯åˆ»ä¸Šæ–°çº¿ç¨‹çš„åå­—ï¼Œè¿™ç§°ä¸º&lt;strong&gt;é‡åå‘&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœæ’¤é”€æ¬¡æ•°è¿›ä¸€æ­¥å¢åŠ ï¼Œè¶…è¿‡ 40 è¿™ä¸ªé˜ˆå€¼ï¼ŒJVM ä¼šè®¤ä¸º&lt;strong&gt;è¿™ä¸€ç±»å¯¹è±¡&lt;/strong&gt;ä¸é€‚åˆé‡‡ç”¨åå‘é”ï¼Œä¼šå¯¹å®ƒä»¬ç¦ç”¨åå‘é”ï¼Œä¸‹æ¬¡æ–°å»ºå¯¹è±¡ä¼šç›´æ¥åŠ è½»é‡çº§é”&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;æ— é”ä¸æœ‰é”&quot;&gt;æ— é”ä¸æœ‰é”&lt;/h4&gt;
&lt;ul readability=&quot;2.5&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;synchronized æ›´ä¸ºé‡é‡ï¼Œç”³è¯·é”ã€é”é‡å…¥éƒ½è¦&lt;strong&gt;å‘èµ·ç³»ç»Ÿè°ƒç”¨&lt;/strong&gt;ï¼Œé¢‘ç¹è°ƒç”¨æ€§èƒ½ä¼šå—å½±å“&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;synchronized å¦‚æœæ— æ³•è·å–é”æ—¶ï¼Œçº¿ç¨‹ä¼šé™·å…¥é˜»å¡ï¼Œå¼•èµ·çš„&lt;strong&gt;çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/strong&gt;æˆæœ¬é«˜&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;è™½ç„¶åšäº†ä¸€ç³»åˆ—ä¼˜åŒ–ï¼Œä½†&lt;strong&gt;è½»é‡çº§é”&lt;/strong&gt;ã€&lt;strong&gt;åå‘é”&lt;/strong&gt;éƒ½æ˜¯é’ˆå¯¹&lt;strong&gt;æ— æ•°æ®ç«äº‰åœºæ™¯&lt;/strong&gt;çš„&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;å¦‚æœæ•°æ®çš„åŸå­æ“ä½œæ—¶é—´è¾ƒé•¿ï¼Œä»åº”è¯¥è®©çº¿ç¨‹é˜»å¡ï¼Œæ— é”é€‚åˆçš„æ˜¯&lt;strong&gt;çŸ­é¢‘å¿«çš„å…±äº«æ•°æ®ä¿®æ”¹æ“ä½œ&lt;/strong&gt;ä¸»è¦ç”¨äº&lt;strong&gt;è®¡æ•°å™¨&lt;/strong&gt;ã€&lt;strong&gt;åœæ­¢æ ‡è®°&lt;/strong&gt;ã€æˆ–æ˜¯&lt;strong&gt;é˜»å¡å‰çš„æœ‰é™å°è¯•&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;varhandle&quot;&gt;VarHandle&lt;/h3&gt;
&lt;h4 id=&quot;ç›®å‰æ— é”é—®é¢˜å®ç°&quot;&gt;ç›®å‰æ— é”é—®é¢˜å®ç°&lt;/h4&gt;
&lt;p&gt;â€‹ ç›®å‰Java ä¸­çš„æ— é”æŠ€æœ¯ä¸»è¦ä½“ç°åœ¨ä»¥AtomicInteger ä¸ºä»£è¡¨çš„çš„åŸå­æ“ä½œç±»ï¼Œå®ƒçš„åº•å±‚ä½¿ç”¨Unsafe å®ç°ï¼Œè€ŒUnsafe çš„é—®é¢˜åœ¨äºå®‰å…¨æ€§å’Œå¯ç§»æ¤æ€§&lt;br/&gt;â€‹ æ­¤å¤–ï¼Œvolatile ä¸»è¦ä½¿ç”¨äº†Store-Load å±éšœæ¥æ§åˆ¶é¡ºåºï¼Œè¿™ä¸ªå±éšœè¿˜æ˜¯å¤ªå¼ºäº†ï¼Œæœ‰æ²¡æœ‰æ›´è½»é‡çº§çš„è§£å†³æ–¹æ³•å‘¢ï¼Ÿ&lt;/p&gt;
&lt;h4 id=&quot;varhandleå¿«é€Ÿä¸Šæ‰‹&quot;&gt;Varhandleå¿«é€Ÿä¸Šæ‰‹&lt;/h4&gt;
&lt;p&gt;â€‹ åœ¨Java9 ä¸­å¼•å…¥äº†VarHandleï¼Œæ¥æä¾›æ›´ç»†ç²’åº¦çš„å†…å­˜å±éšœï¼Œä¿è¯å…±äº«å˜é‡è¯»å†™å¯è§æ€§ã€æœ‰åºæ€§ã€åŸå­æ€§ã€‚æä¾›äº†æ›´å¥½çš„å®‰å…¨æ€§å’Œå¯ç§»æ¤æ€§ï¼Œæ›¿ä»£Unsafe çš„éƒ¨åˆ†åŠŸèƒ½&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»º&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public class TestVarHandle {
   int x;
   static VarHandle X;
   
   static {
       try {
           X = MethodHandles.lookup()
               .findVarHandle(TestVarHandle.class, &quot;x&quot;, int.class);
       } catch (NoSuchFieldException | IllegalAccessException e) {
           e.printStackTrace();
       }
   }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¯»å†™&lt;/p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;æ–¹æ³•å&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;&lt;/thead&gt;&lt;tbody readability=&quot;7&quot;&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;get&lt;/td&gt;
&lt;td&gt;è·å–å€¼&lt;/td&gt;
&lt;td&gt;ä¸æ™®é€šå˜é‡å–å€¼ä¸€æ ·ï¼Œä¼šé‡æ’ã€æœ‰ä¸å¯è§ç°è±¡&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;set&lt;/td&gt;
&lt;td&gt;è®¾ç½®å€¼&lt;/td&gt;
&lt;td/&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;getOpaque&lt;/td&gt;
&lt;td&gt;è·å–å€¼&lt;/td&gt;
&lt;td&gt;å¯¹å…¶ä¿æŠ¤çš„å˜é‡ï¼Œä¿è¯å…¶ä¸é‡æ’å’Œå¯è§æ€§ï¼Œä½†ä¸ä½¿ç”¨å±éšœï¼Œä¸é˜»ç¢å…¶å®ƒå˜é‡&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;setOpaque&lt;/td&gt;
&lt;td&gt;è®¾ç½®å€¼&lt;/td&gt;
&lt;td/&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;getAcquire&lt;/td&gt;
&lt;td&gt;è·å–å€¼&lt;/td&gt;
&lt;td&gt;ç›¸å½“äºget ä¹‹ååŠ LoadLoad + LoadStore&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;setRelease&lt;/td&gt;
&lt;td&gt;è®¾ç½®å€¼&lt;/td&gt;
&lt;td&gt;ç›¸å½“äºset ä¹‹å‰åŠ LoadStore + StoreStore&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;getVolatile&lt;/td&gt;
&lt;td&gt;è·å–å€¼&lt;/td&gt;
&lt;td&gt;è¯­ä¹‰åŒvolatileï¼Œç›¸å½“äºè·å–ä¹‹ååŠ LoadLoad + LoadStore&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;setVolatile&lt;/td&gt;
&lt;td&gt;è®¾ç½®å€¼&lt;/td&gt;
&lt;td&gt;è¯­ä¹‰åŒvolatileï¼Œç›¸å½“äºè®¾ç½®ä¹‹å‰åŠ LoadStore + StoreStoreï¼Œè®¾ç½®ä¹‹ååŠ StoreLoad&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;compareAndSet&lt;/td&gt;
&lt;td&gt;åŸå­èµ‹å€¼&lt;/td&gt;
&lt;td&gt;åŸå­èµ‹å€¼ï¼ŒæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;h2 id=&quot;æ›´å¤šå®‰å…¨é—®é¢˜&quot;&gt;æ›´å¤šå®‰å…¨é—®é¢˜&lt;/h2&gt;
&lt;h3 id=&quot;å•ä¸ªå˜é‡è¯»å†™åŸå­æ€§&quot;&gt;å•ä¸ªå˜é‡è¯»å†™åŸå­æ€§&lt;/h3&gt;
&lt;ul readability=&quot;0&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;64 ä½ç³»ç»Ÿvs 32 ä½ç³»ç»Ÿ&lt;br/&gt;å¦‚æœéœ€è¦ä¿è¯long å’Œdouble åœ¨32 ä½ç³»ç»Ÿä¸­åŸå­æ€§ï¼Œéœ€è¦ç”¨volatile ä¿®é¥°&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;JMM9 ä¹‹å‰&lt;br/&gt;JMM9 32 ä½ç³»ç»Ÿä¸‹double å’Œlong çš„é—®é¢˜ï¼Œdouble æ²¡æœ‰é—®é¢˜ï¼Œlong åœ¨-server -XX:+UnlockExperimentalVMOptions -XX:-AlwaysAtomicAccesses æ‰æœ‰é—®é¢˜&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;object-alignment&quot;&gt;Object alignment&lt;/h3&gt;
&lt;p&gt;â€‹ ä½ æˆ–è®¸å¬è¯´è¿‡å¯¹è±¡å¯¹é½ï¼Œå®ƒçš„ä¸€ä¸ªä¸»è¦ç›®çš„å°±æ˜¯ä¸ºäº†å•ä¸ªå˜é‡è¯»å†™çš„åŸå­æ€§ï¼Œå¯ä»¥ä½¿ç”¨jol å·¥å…·æŸ¥çœ‹java å¯¹è±¡çš„å†…å­˜å¸ƒå±€&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;dependency&amp;gt;
   &amp;lt;groupId&amp;gt;org.openjdk.jol&amp;lt;/groupId&amp;gt;
   &amp;lt;artifactId&amp;gt;jol-core&amp;lt;/artifactId&amp;gt;
   &amp;lt;version&amp;gt;0.10&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æµ‹è¯•ç±»&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public class TestJol {
   public static void main(String[] args) {
       String layout = ClassLayout.parseClass(Test.class).toPrintable();
       System.out.println(layout);
   }
   public static class Test {
       private byte a;
       private byte b;
       private byte c;
       private long e;
   }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¼€å¯å¯¹è±¡å¤´å‹ç¼©ï¼ˆé»˜è®¤ï¼‰è¾“å‡º&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;com.itheima.test.TestJol$Test object internals:
OFFSET  SIZE   TYPE DESCRIPTION                               VALUE
0    12        (object header)                           N/A
12     1   byte Test.a                                    N/A
13     1   byte Test.b                                    N/A
14     1   byte Test.c                                    N/A
15     1        (alignment/padding gap)             
16     8   long Test.e                                    N/A
Instance size: 24 bytes
Space losses: 1 bytes internal + 0 bytes external = 1 bytes total
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸å¼€å¯å¯¹è±¡å¤´å‹ç¼© -XX:-UseCompressedOops è¾“å‡º&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;com.itheima.test.TestJol$Test object internals:
OFFSET  SIZE   TYPE DESCRIPTION                               VALUE
0    16        (object header)                           N/A
16     8   long Test.e                                    N/A
24     1   byte Test.a                                    N/A
25     1   byte Test.b                                    N/A
26     1   byte Test.c                                    N/A
27     5        (loss due to the next object alignment)
Instance size: 32 bytes
Space losses: 0 bytes internal + 5 bytes external = 5 bytes total
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;å­—åˆ†è£‚&quot;&gt;å­—åˆ†è£‚&lt;/h3&gt;
&lt;p&gt;å‰é¢ä¹Ÿçœ‹åˆ°äº†ï¼ŒJava èƒ½å¤Ÿä¿è¯å•ä¸ªå…±äº«å˜é‡è¯»å†™æ˜¯åŸå­çš„ï¼Œç±»ä¼¼çš„æ•°ç»„å…ƒç´ çš„è¯»å†™ï¼Œä¹Ÿä¼šæä¾›è¿™æ ·çš„ä¿è¯&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;byte[8]
[0][1][2][3]
[0][1][2][3]
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¦‚æœä¸Šè¿°æ•ˆæœä¸èƒ½ä¿è¯ï¼Œåˆ™ç§°ä¹‹ä¸ºå‘ç”Ÿäº†å­—åˆ†è£‚ç°è±¡ï¼Œjava ä¸­æ²¡æœ‰å­—åˆ†è£‚ï¼Œä½†Java ä¸­æŸäº›å®ç°ä¼šæœ‰ç±»ä¼¼å­—åˆ†è£‚ç°è±¡ï¼Œä¾‹å¦‚BitSetã€Unsafe è¯»å†™ç­‰&lt;/p&gt;
&lt;h4 id=&quot;æ•°ç»„å…ƒç´ è¯»å†™æµ‹è¯•&quot;&gt;æ•°ç»„å…ƒç´ è¯»å†™æµ‹è¯•&lt;/h4&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;@JCStressTest
@Outcome(id = {&quot;0&quot;, &quot;-1&quot;}, expect = Expect.ACCEPTABLE, desc = &quot;ACCEPTABLE&quot;)
@Outcome(expect = Expect.FORBIDDEN, desc = &quot;FORBIDDEN&quot;)
@State
public static class Case4 {
   byte[] b = new byte[256];
   int off = ThreadLocalRandom.current().nextInt(256);
   @Actor
   public void actor1() {
       b[off] = (byte) 0xFF;
   }
   @Actor
   public void actor2(I_Result r) {
       r.r1 = b[off];
   }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;bigsetè¯»å†™æµ‹è¯•&quot;&gt;BigSetè¯»å†™æµ‹è¯•&lt;/h4&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;@JCStressTest
@Outcome(id = &quot;true, true&quot;, expect = Expect.ACCEPTABLE, desc = &quot;ACCEPTABLE&quot;)
@Outcome(expect = Expect.ACCEPTABLE_INTERESTING, desc = &quot;INTERESTING&quot;)
@State
public static class Case6 {
   BitSet b = new BitSet();
   @Actor
   public void a() {
       b.set(0);
   }
   @Actor
   public void b() {
       b.set(1);
   }
   @Arbiter
   public void c(ZZ_Result r) {
       r.r1 = b.get(0);
       r.r2 = b.get(1);
   }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;unsafe-ç›´æ¥æ“ä½œå†…å­˜&quot;&gt;Unsafe ç›´æ¥æ“ä½œå†…å­˜&lt;/h4&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public class TestUnsafe {
   public static final long ARRAY_BASE_OFFSET =
UnsafeHolder.U.arrayBaseOffset(byte[].class);
   static byte[] ss = new byte[8];
   public static void main(String[] args) {
       System.out.println(ARRAY_BASE_OFFSET);
       UnsafeHolder.U.putInt(ss, ARRAY_BASE_OFFSET, 0xFFFFFFFF);
       System.out.println(Arrays.toString(ss));
   }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¾“å‡º&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;16
[-1, -1, -1, -1, 0, 0, 0, 0]
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ¥ä¸ªå‹æµ‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;@JCStressTest
@Outcome(id = &quot;0&quot;, expect = Expect.ACCEPTABLE, desc = &quot;ACCEPTABLE&quot;)
@Outcome(id = &quot;-1&quot;, expect = Expect.ACCEPTABLE, desc = &quot;ACCEPTABLE&quot;)
@Outcome(expect = Expect.ACCEPTABLE_INTERESTING, desc = &quot;INTERESTING&quot;)
@State
public static class Case5 {
   byte[] ss = new byte[256];
   long base = UnsafeHolder.U.arrayBaseOffset(byte[].class);
   long off = base + ThreadLocalRandom.current().nextInt(256 - 4);
   @Actor
   public void writer() {
       UnsafeHolder.U.putInt(ss,  off, 0xFFFF_FFFF);
   }
   @Actor
   public void reader(I_Result r) {
       r.r1 = UnsafeHolder.U.getInt(ss, off);
   }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç»“æœ:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;Observed state   Occurrences              Expectation  Interpretation
-1    25,591,098               ACCEPTABLE  ACCEPTABLE
-16777216           877   ACCEPTABLE_INTERESTING  INTERESTING
-256           923   ACCEPTABLE_INTERESTING  INTERESTING
-65536           925   ACCEPTABLE_INTERESTING  INTERESTING
0     5,093,890               ACCEPTABLE  ACCEPTABLE
16777215         1,673   ACCEPTABLE_INTERESTING  INTERESTING
255         1,758   ACCEPTABLE_INTERESTING  INTERESTING
65535         1,707   ACCEPTABLE_INTERESTING  INTERESTING
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;å®‰å…¨å‘å¸ƒ&quot;&gt;å®‰å…¨å‘å¸ƒ&lt;/h3&gt;
&lt;h4 id=&quot;æ„é€ ä¹Ÿä¸å®‰å…¨&quot;&gt;æ„é€ ä¹Ÿä¸å®‰å…¨&lt;/h4&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;@JCStressTest
@Outcome(id = {&quot;16&quot;, &quot;-1&quot;}, expect = Expect.ACCEPTABLE, desc = &quot;ACCEPTABLE&quot;)
@Outcome(expect = Expect.ACCEPTABLE_INTERESTING, desc = &quot;INTERESTING&quot;)
@State
public static class Case1 {
   Holder f;
   int v = 1;
   @Actor
   public void a1() {
       f = new Holder(v);
   }
   @Actor
   void a2(I_Result r) {
       Holder o = this.f;
       if (o != null) {
           r.r1 = o.x8 + o.x7 + o.x6 + o.x5 + o.x4 + o.x3 + o.x2 + o.x1;
           r.r1 += o.y8 + o.y7 + o.y6 + o.y5 + o.y4 + o.y3 + o.y2 + o.y1;
       } else {
           r.r1 = -1;
       }
   }
   static class Holder {
       int x1, x2, x3, x4;
       int x5, x6, x7, x8;
       int y1, y2, y3, y4;
       int y5, y6, y7, y8;
       
       public Holder(int v) {
           x1 = v;
           x2 = v;
           x3 = v;
           x4 = v;
           x5 = v;
           x6 = v;
           x7 = v;
           x8 = v;
           y1 = v;
           y2 = v;
           y3 = v;
           y4 = v;
           y5 = v;
           y6 = v;
           y7 = v;
           y8 = v;
       }
   }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åŸå› åˆ†æ&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚æœ‰ä¸ªStudentç±»ä»£ç å¦‚ä¸‹:&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public class Student{
    final String name;
    int age;
    
    public Student(name,age){
        this.name =name;
        this.age = age;
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;Student stuä¸ºå…±äº«å˜é‡
stu = new Student(&quot;zhangsan&quot;,18);
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;nameå¦‚æœæ²¡æœ‰finalä¿®é¥°&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;t =new Student(name,age)
stu = t
this.name = name
this.age =age
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;nameå¦‚æœæœ‰finalä¿®é¥°,ä½ç½®ä»»æ„&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;t=new Student(name,age)
this.name=name
this.age=age
&amp;gt;----StoreStore----&amp;lt;
stu = t
&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;ä½¿ç”¨volatileæ”¹è¿›&quot;&gt;ä½¿ç”¨volatileæ”¹è¿›&lt;/h4&gt;
&lt;p&gt;name æœ‰volatile ä¿®é¥°ï¼Œæ³¨æ„ä½ç½®å¿…é¡»åœ¨æœ€å&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;t=new Student(name,age)
this.age=age
this.name=name
&amp;gt;----Store Load----&amp;lt;
stu =t
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;æ€»ç»“&quot;&gt;æ€»ç»“&lt;/h2&gt;
&lt;ol&gt;&lt;li&gt;JMM æ˜¯ç ”ç©¶çš„æ˜¯&lt;/li&gt;
&lt;/ol&gt;&lt;ul&gt;&lt;li&gt;å¤šçº¿ç¨‹ä¸‹Java ä»£ç çš„æ‰§è¡Œé¡ºåºï¼Œå®é™…ä»£ç çš„æ‰§è¡Œé¡ºåºä¸ä½ ç¼–å†™çš„ä»£ç é¡ºåºä¸åŒ&lt;/li&gt;
&lt;li&gt;å…±äº«å˜é‡çš„è¯»å†™æ“ä½œï¼Œåœ¨ç«æ€æ¡ä»¶ä¸‹ï¼Œéœ€è¦è€ƒè™‘å…±äº«å˜é‡è¯»å†™çš„åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§&lt;/li&gt;
&lt;/ul&gt;&lt;ol start=&quot;2&quot;&gt;&lt;li&gt;å…±äº«å˜é‡çš„é—®é¢˜èµ·å› &lt;/li&gt;
&lt;/ol&gt;&lt;ul&gt;&lt;li&gt;åŸå­æ€§æ˜¯ç”±äºæ“ä½œç³»ç»Ÿçš„åˆ†æ—¶æœºåˆ¶ï¼Œçº¿ç¨‹åˆ‡æ¢æ‰€è‡´&lt;/li&gt;
&lt;li&gt;æœ‰åºæ€§å’Œå¯è§æ€§å¯èƒ½æ¥è‡ªäºç¼–è¯‘å™¨ä¼˜åŒ–ã€å¤„ç†å™¨ä¼˜åŒ–ã€ç¼“å­˜ä¼˜åŒ–&lt;/li&gt;
&lt;/ul&gt;&lt;ol start=&quot;3&quot;&gt;&lt;li&gt;JMM åˆ¶å®šäº†ä¸€äº›è§„åˆ™ï¼Œç†è§£è¿™äº›è§„åˆ™ï¼Œæ‰èƒ½å†™å‡ºæ­£ç¡®çš„çº¿ç¨‹å®‰å…¨ä»£ç &lt;/li&gt;
&lt;/ol&gt;&lt;ul&gt;&lt;li&gt;ç«æ€æ¡ä»¶ä¼šå¯¼è‡´ä»£ç é¡ºåºè¢«é‡æ’&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨synchronizedã€volatile ä¸€äº›SAï¼Œå¯ä»¥æ§åˆ¶çº¿ç¨‹å†…ä»£ç çš„æ‰§è¡Œé¡ºåº&lt;/li&gt;
&lt;li&gt;çº¿ç¨‹åˆ‡æ¢æ—¶çš„æ‰§è¡Œé¡ºåºä¸å¯è§æ€§ï¼Œéµå®ˆHB è§„åˆ™&lt;/li&gt;
&lt;li&gt;HB è§„åˆ™è¿˜ä¸è¶³å¤Ÿï¼Œéœ€è¦å› æœå¾‹ä½œä¸ºè¡¥å……&lt;/li&gt;
&lt;li&gt;å¯ä»¥é€šè¿‡final æˆ–volatile å®ç°å¯¹è±¡çš„å®‰å…¨å‘å¸ƒ&lt;/li&gt;
&lt;/ul&gt;&lt;ol start=&quot;4&quot;&gt;&lt;li&gt;ä»åº•å±‚ç†è§£volatile ä¸synchronized&lt;/li&gt;
&lt;/ol&gt;&lt;ul&gt;&lt;li&gt;å†…å­˜å±éšœ&lt;/li&gt;
&lt;li&gt;synchronized æ˜¯å¦‚ä½•è§£å†³åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§é—®é¢˜çš„ï¼Œæœ‰å“ªäº›ä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;volatile æ˜¯å¦‚ä½•è§£å†³å¯è§æ€§ã€æœ‰åºæ€§é—®é¢˜çš„ï¼Œä¸cas ç»“åˆçš„å¨åŠ›&lt;/li&gt;
&lt;li&gt;VarHandle æ˜¯å¦‚ä½•è§£å†³å¯è§æ€§ã€æœ‰åºæ€§é—®é¢˜çš„&lt;/li&gt;
&lt;/ul&gt;&lt;ol start=&quot;5&quot;&gt;&lt;li&gt;æ›´å¤šå®‰å…¨é—®é¢˜&lt;/li&gt;
&lt;/ol&gt;&lt;ul&gt;&lt;li&gt;å•ä¸ªå˜é‡ã€æ•°ç»„å…ƒç´ çš„è¯»å†™åŸå­æ€§&lt;/li&gt;
&lt;li&gt;èƒ½å¤Ÿåˆ—ä¸¾å­—åˆ†è£‚çš„å‡ ä¸ªç›¸å…³ä¾‹å­&lt;/li&gt;
&lt;li&gt;æ„é€ æ–¹æ³•ä»€ä¹ˆæƒ…å†µä¸‹ä¼šçº¿ç¨‹ä¸å®‰å…¨ï¼Œå¦‚ä½•æ”¹è¿›&lt;/li&gt;
&lt;li&gt;å½»åº•æŒæ¡DCL å®‰å…¨å•ä¾‹&lt;/li&gt;
&lt;/ul&gt;</description>
<pubDate>Thu, 20 Aug 2020 13:26:00 +0000</pubDate>
<dc:creator>é“é˜»ä¸”é•¿å•Š</dc:creator>
<og:description>å‰è¨€ â€‹	JMMå³javaå†…å­˜æ¨¡å‹ï¼ŒJMMç ”ç©¶çš„å°±æ˜¯å¤šçº¿ç¨‹ä¸‹Javaä»£ç çš„æ‰§è¡Œé¡ºåºï¼Œå…±äº«å˜é‡çš„è¯»å†™ã€‚å®ƒå®šä¹‰äº†Javaè™šæ‹Ÿæœºåœ¨è®¡ç®—æœºå†…å­˜ä¸­çš„å·¥ä½œæ–¹å¼ã€‚ä»æŠ½è±¡è§’åº¦çœ‹ï¼ŒJMMå®šä¹‰äº†çº¿ç¨‹å’Œä¸»å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ï¼š</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/whgk/p/13534969.html</dc:identifier>
</item>
</channel>
</rss>