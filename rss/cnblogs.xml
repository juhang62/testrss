<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>åšå®¢å›­_é¦–é¡µ</title>
<link></link>
<description>ä»£ç æ”¹å˜ä¸–ç•Œ</description>
<item>
<title>TypeScript ä¸­éä»£ç æ¨¡å—çš„å¯¼å…¥ - åˆ˜å“‡å‹‡</title>
<link>http://www.cnblogs.com/Wayou/p/import_files_in_typescript.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/Wayou/p/import_files_in_typescript.html</guid>
<description>&lt;p&gt;éœ€è¦ç†è§£çš„æ˜¯ï¼ŒTypeScript ä½œä¸ºè¯­è¨€ï¼Œä»–åªå¤„ç†ä»£ç æ¨¡å—ã€‚å…¶ä»–ç±»å‹çš„æ–‡ä»¶è¿™ç§éä»£ç æ¨¡å—çš„å¯¼å…¥ï¼Œè®²é“ç†æ˜¯é€šè¿‡å¦å¤–çš„æ‰“åŒ…å·¥å…·æ¥å®Œæˆçš„ï¼Œæ¯”å¦‚ Web åº”ç”¨ä¸­çš„å›¾ç‰‡ï¼Œæ ·å¼ï¼ŒJSON è¿˜æœ‰ HTML æ¨¡æ¿æ–‡ä»¶ã€‚åªæ˜¯æˆ‘ä»¬éœ€è¦åœ¨ TypeScript å±‚é¢è§£å†³æ¨¡å—è§£ææŠ¥é”™çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2&gt;é€šé…ç¬¦æ¨¡å—å£°æ˜&lt;/h2&gt;
&lt;p&gt;ç›´æ¥å¯¼å…¥éä»£ç æ¨¡å—ï¼ŒTypeScript ä¼šæŠ¥é”™ã€‚&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-ts&quot; readability=&quot;7&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;/**&lt;/span&gt; ğŸš¨ Cannot find module './index.html'. &lt;span class=&quot;pl-c&quot;&gt;*/&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;./index.html&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;TypeScript æ–‡æ¡£ä¸­å…³äºè¿™éƒ¨åˆ†çš„æè¿°æ˜¯ &lt;a href=&quot;https://www.typescriptlang.org/docs/handbook/modules.html&quot; rel=&quot;nofollow&quot;&gt;Wildcard module declarations&lt;/a&gt;ï¼Œå³é€šè¿‡å®šä¹‰é€šé…ç¬¦æ¨¡å—ã€‚ä¸ &lt;a href=&quot;https://github.com/systemjs/systemjs/blob/master/docs/overview.md#plugin-syntax&quot;&gt;SystemJS&lt;/a&gt; å’Œ &lt;a href=&quot;https://github.com/amdjs/amdjs-api/blob/master/LoaderPlugins.md&quot;&gt;AMD&lt;/a&gt; ä¸€è‡´ï¼Œåœ¨å¯¼å…¥æ—¶è·¯å¾„ä¸ŠåŠ ä¸Šå®šä¹‰å¥½çš„æ–‡ä»¶ç±»å‹å‰åç¼€ï¼Œè¿™äº›è·¯å¾„ä¸Šçš„é¢å¤–ä¿¡æ¯åœ¨ç¼–è¯‘åå¯é€šè¿‡è¿è¡Œæ—¶å®é™…çš„åŠ è½½å™¨ä¸­ç›¸åº”çš„æ’ä»¶æ¥è§£æå¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;typings.d.ts&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-ts&quot; readability=&quot;8&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;declare&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;*!text&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; {
    &lt;span class=&quot;pl-k&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;const&lt;/span&gt;&lt;/span&gt; content&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;string&lt;/span&gt;;
    &lt;span class=&quot;pl-k&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;content&lt;/span&gt;;
}
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;//&lt;/span&gt; Some do it the other way around.&lt;/span&gt;
&lt;span class=&quot;pl-k&quot;&gt;declare&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;json!*&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; {
    &lt;span class=&quot;pl-k&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;const&lt;/span&gt;&lt;/span&gt; value&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;any&lt;/span&gt;;
    &lt;span class=&quot;pl-k&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;value&lt;/span&gt;;
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;main.ts&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-ts&quot; readability=&quot;9&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;fileContent&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;./xyz.txt!text&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;;
&lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;json!http://example.com/data.json&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;;
&lt;span class=&quot;pl-c1&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;pl-c1&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;pl-smi&quot;&gt;data&lt;/span&gt;, &lt;span class=&quot;pl-smi&quot;&gt;fileContent&lt;/span&gt;);
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä½¿ç”¨å®šä¹‰ç±»å‹å‰åç¼€çš„æ–¹å¼æ˜¯å¯ä»¥è§£å†³ä»£ç ä¸­ TypeScript æŠ¥é”™çš„é—®é¢˜ï¼Œä½†ç¼–è¯‘åå› ä¸ºæ¨¡å—åœ°å€ä¸­çš„ç±»å‹å‰ç¼€æˆ–åç¼€ï¼ˆ&lt;code&gt;!text&lt;/code&gt;,&lt;code&gt;json!&lt;/code&gt;ï¼‰æ²¡æœ‰å»æ‰ï¼Œè¿™å°±éœ€è¦å¯¹ &lt;code&gt;require&lt;/code&gt; å®šä¹‰ç›¸åº”çš„æ’ä»¶æ¥å¤„ç†ã€‚&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot; readability=&quot;8&quot;&gt;
&lt;pre&gt;
$ node main.js
internal/modules/cjs/loader.js:670
    throw err&lt;span class=&quot;pl-k&quot;&gt;;&lt;/span&gt;
    ^

Error: Cannot find module &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;./xyz.txt!text&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æœä½ çœ‹è¿‡ &lt;a href=&quot;https://github.com/Microsoft/vscode/blob/master/src/vs/editor/browser/viewParts/selections/selections.ts#L6&quot;&gt;VSCode çš„æºç &lt;/a&gt;ï¼Œä¼šå‘ç°é‡Œé¢å¤§é‡ä½¿ç”¨äº†æœ‰ç±»ä¼¼è¿™æ ·çš„æ–¹å¼å¯¼å…¥æ ·å¼æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-ts&quot; readability=&quot;7&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;vs/css!./selections&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™é‡Œ &lt;code&gt;vs/css!&lt;/code&gt; ä¾¿æ˜¯ä¸Šé¢æåˆ°çš„æ–¹å¼ï¼Œä½† VSCode æ˜¯ä½¿ç”¨äº†&lt;a href=&quot;https://github.com/Microsoft/vscode/blob/master/src/vs/loader.js#L1491&quot;&gt;è‡ªå®šä¹‰&lt;/a&gt;çš„ä¸€ä¸ªæ¨¡å—åŠ è½½å™¨ &lt;a href=&quot;https://github.com/Microsoft/vscode-loader&quot;&gt;Microsoft/vscode-loader&lt;/a&gt; æ¥å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜å¯ä»¥åƒä¸‹é¢è¿™æ ·æ¥è¿›è¡Œæ–‡ä»¶ç±»å‹çš„å£°æ˜ï¼š&lt;/p&gt;
&lt;p&gt;&lt;em&gt;typings.d.ts&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-ts&quot; readability=&quot;7&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;declare&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;*.html&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; {
  &lt;span class=&quot;pl-k&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;const&lt;/span&gt;&lt;/span&gt; value&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;string&lt;/span&gt;;
  &lt;span class=&quot;pl-k&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;value&lt;/span&gt;;
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç„¶åå†™æ­£å¸¸çš„è·¯å¾„æ¥å¯¼å…¥å³å¯ï¼Œç¼–è¯‘åçš„äº§å‡ºä¸­è·¯å¾„æ²¡æœ‰æ”¹å˜ã€‚&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-ts&quot; readability=&quot;7&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;/**&lt;/span&gt; âœ… ojbk &lt;span class=&quot;pl-c&quot;&gt;*/&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;./index.html&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¯¹äºå…¶ä»–ç±»å‹çš„åç¼€åŒç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;typings.d.ts&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-ts&quot; readability=&quot;8&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;declare&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;*.png&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; {
  &lt;span class=&quot;pl-k&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;const&lt;/span&gt;&lt;/span&gt; value&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;string&lt;/span&gt;;
  &lt;span class=&quot;pl-k&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;value&lt;/span&gt;;
}

&lt;span class=&quot;pl-k&quot;&gt;declare&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;*.scss&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt; {
  &lt;span class=&quot;pl-k&quot;&gt;&lt;span class=&quot;pl-k&quot;&gt;const&lt;/span&gt;&lt;/span&gt; content&lt;span class=&quot;pl-k&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;any&lt;/span&gt;;
  &lt;span class=&quot;pl-k&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;content&lt;/span&gt;;
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™åªæ˜¯è§£å†³äº† TypeScript çš„æ¨¡å—è§£ææŠ¥é”™çš„é—®é¢˜ï¼Œå®é™…æ–‡ä»¶çš„å¯¼å…¥å¹¶ä¸æ˜¯åœ¨ TypeScript ä¸­åšçš„ï¼Œè€Œéœ€è¦é¢å¤–çš„æ‰“åŒ…å·¥å…·ã€‚Webpack ä¸­åˆ™æ˜¯ç›¸åº”çš„æ ·å¼ loader å’Œ å›¾ç‰‡ loader æ¥è´Ÿè´£è¿™äº›æ–‡ä»¶çš„è§£æåŠ è½½ã€‚&lt;/p&gt;
&lt;h2&gt;JSON æ–‡ä»¶çš„å¯¼å…¥&lt;/h2&gt;
&lt;p&gt;å› ä¸º JSON æ ¼å¼å¤ªè¿‡å¸¸è§ï¼ŒTypeScript ç¡®å®åœ¨è‡ªå·±çš„ç¼–è¯‘å™¨ä¸­æä¾›äº†å¯¹å…¶åŠ è½½çš„æ”¯æŒï¼Œé€šè¿‡ç›¸åº”çš„ç¼–è¯‘å‚æ•° &lt;code&gt;--resolveJsonModul&lt;/code&gt; æ¥å¼€å¯ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»º &lt;code&gt;tsconfig.json&lt;/code&gt; å¼€å¯å¯¹ JSON æ–‡ä»¶å¯¼å…¥çš„æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;tsconfig.json&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-json&quot; readability=&quot;9&quot;&gt;
&lt;pre&gt;
{
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;compilerOptions&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: {
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;target&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;es5&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;module&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;commonjs&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;resolveJsonModule&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;true&lt;/span&gt;
  }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç„¶åä»£ç ä¸­å¯¼å…¥ JSON æ–‡ä»¶æ—¶æŒ‡å®šæ­£ç¡®çš„è·¯å¾„ï¼Œåƒå…¶ä»–æ­£å¸¸çš„ TypeScript æ¨¡å—ä¸€æ ·ã€‚æ— é¡»å‰ç¼€ï¼Œä¹Ÿæ— é¡»ç¼–å†™é¢å¤–çš„å£°æ˜æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;main.ts&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-ts&quot; readability=&quot;7&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;./bar.json&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;;
&lt;span class=&quot;pl-c1&quot;&gt;console&lt;/span&gt;.&lt;span class=&quot;pl-c1&quot;&gt;log&lt;/span&gt;(&lt;span class=&quot;pl-smi&quot;&gt;data&lt;/span&gt;);
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å½“å°è¯•ç¼–è¯‘ä¸Šé¢ä»£ç æ—¶ï¼Œä½ ä¼šå¾—åˆ°å¦‚ä¸‹çš„æŠ¥é”™ï¼š&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot; readability=&quot;8&quot;&gt;
&lt;pre&gt;
$ tsc
error TS5055: Cannot write file &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;/Users/wayou/Documents/dev/github/ts-wildcard-module/bar.json&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt; because it would overwrite input file.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å› ä¸ºç¼–è¯‘å JSON æ–‡ä»¶ä¹Ÿä¼šæœ‰ä¸€ä»½åŒåçš„äº§å‡ºï¼Œåœ¨æ²¡æœ‰æŒ‡å®šç¼–è¯‘è¾“å‡ºç›®å½•çš„æƒ…å†µä¸‹ï¼Œ tsc é»˜è®¤è¾“å‡ºåˆ°å½“å‰ç›®å½•ï¼Œæ‰€ä»¥ä¼šæœ‰ä¸Šé¢ JSON æ–‡ä»¶ä¼šè¢«è¦†ç›–çš„æç¤ºã€‚æ‰€ä»¥è§£å†³åŠæ³•å°±æ˜¯æ·»åŠ è¾“å‡ºç›®å½•çš„é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;tsconfig.json&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-diff&quot; readability=&quot;11&quot;&gt;
&lt;pre&gt;
{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;es5&quot;,
    &quot;module&quot;: &quot;commonjs&quot;,
    &quot;resolveJsonModule&quot;: true,
&lt;span class=&quot;pl-mi1&quot;&gt;&lt;span class=&quot;pl-mi1&quot;&gt;+&lt;/span&gt;    &quot;outDir&quot;: &quot;dist&quot;&lt;/span&gt;
  }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å†æ¬¡ç¼–è¯‘åå¯æ­£å¸¸è¿è¡Œã€‚&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot; readability=&quot;7&quot;&gt;
&lt;pre&gt;
$ tsc
$ node dist/main.js
{ data: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;blah&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é…åˆç€ &lt;code&gt;esModuleInterop&lt;/code&gt; é€‰é¡¹å¯ä»¥è®©å¯¼å…¥æ›´åŠ ç®€æ´ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;tsconfig.json&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-diff&quot; readability=&quot;12&quot;&gt;
&lt;pre&gt;
{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;es5&quot;,
    &quot;module&quot;: &quot;commonjs&quot;,
&lt;span class=&quot;pl-mi1&quot;&gt;&lt;span class=&quot;pl-mi1&quot;&gt;+&lt;/span&gt;    &quot;esModuleInterop&quot;: true,&lt;/span&gt;
    &quot;resolveJsonModule&quot;: true,
    &quot;outDir&quot;: &quot;dist&quot;
  }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;main.ts&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-diff&quot; readability=&quot;7&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-md&quot;&gt;&lt;span class=&quot;pl-md&quot;&gt;-&lt;/span&gt; import * as data from &quot;./bar.json&quot;;&lt;/span&gt;
&lt;span class=&quot;pl-mi1&quot;&gt;&lt;span class=&quot;pl-mi1&quot;&gt;+&lt;/span&gt; import data from &quot;./bar.json&quot;;&lt;/span&gt;
console.log(data);
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;ä¸€èˆ¬é¡¹ç›®ä¸­éƒ½ä½¿ç”¨ä¸“é—¨çš„æ‰“åŒ…å·¥å…·æ¯”å¦‚ Webpackï¼ŒParcel ç­‰ï¼Œèµ„æºçš„è§£æåŠ è½½éƒ½ä¼šè¢«å¾ˆå¥½åœ°å¤„ç†ã€‚åªæ˜¯æˆ‘ä»¬éœ€è¦è§£å†³ TypeScipt æ¨¡å—è§£ææŠ¥é”™çš„é—®é¢˜ï¼Œæ­¤æ—¶å¯é€šè¿‡å¯¹ç›¸åº”æ–‡ä»¶ç¼–å†™å£°æ˜æ–‡ä»¶çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;h2&gt;ç›¸å…³èµ„æº&lt;/h2&gt;
</description>
<pubDate>Sat, 13 Apr 2019 15:16:00 +0000</pubDate>
<dc:creator>åˆ˜å“‡å‹‡</dc:creator>
<og:description>éœ€è¦ç†è§£çš„æ˜¯ï¼ŒTypeScript ä½œä¸ºè¯­è¨€ï¼Œä»–åªå¤„ç†ä»£ç æ¨¡å—ã€‚å…¶ä»–ç±»å‹çš„æ–‡ä»¶è¿™ç§éä»£ç æ¨¡å—çš„å¯¼å…¥ï¼Œè®²é“ç†æ˜¯é€šè¿‡å¦å¤–çš„æ‰“åŒ…å·¥å…·æ¥å®Œæˆçš„ï¼Œæ¯”å¦‚ Web åº”ç”¨ä¸­çš„å›¾ç‰‡ï¼Œæ ·å¼ï¼ŒJSON è¿˜æœ‰ HTML æ¨¡æ¿</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/Wayou/p/import_files_in_typescript.html</dc:identifier>
</item>
<item>
<title>springbootä¸­HandlerMethodArgumentResolverçš„ä½¿ç”¨ - ç¥ä¿ä¹‰</title>
<link>http://www.cnblogs.com/baoyi/p/springboot_HandlerMethodArgumentResolver.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/baoyi/p/springboot_HandlerMethodArgumentResolver.html</guid>
<description>




&lt;p&gt;springbooté¡¹ç›®ä¸­åœ¨æ‰€æœ‰çš„controlleræ–¹æ³•ä¸­æƒ³å¢åŠ tokenéªŒè¯ï¼Œå³æ‰€æœ‰çš„æ–¹æ³•éƒ½å¿…é¡»ç™»é™†æœ‰tokenä¹‹åæ‰èƒ½è®¿é—®ã€‚springbootå°è£…äº†SpringMVCä¸­çš„HandlerMethodArgumentResolveræ¥å£ï¼Œé€šè¿‡å®ç°HandlerMethodArgumentResolverè¿™ä¸ªæ¥å£å¯ä»¥è¾¾åˆ°éœ€æ±‚ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;1. æ–°å»ºäº†ä¸€ä¸ªç±» å®ç°HandlerMethodArgumentResolveræ¥å£&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/384937/201904/384937-20190413230839731-63704443.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;2. è‡ªå®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼Œåé¢çš„æ‰€æœ‰æ–¹æ³•ç”¨è¿™ä¸ªæ³¨è§£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/384937/201904/384937-20190413230925204-1214532712.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;3. æ–°å»ºä¸€ä¸ªwebconfig å®ç°Â WebMvcConfigurer æ¥å£ï¼Œ éœ€è¦é‡å†™Â addArgumentResolvers è¿™ä¸ªæ–¹æ³•ï¼Œåˆå§‹åŒ–æˆ‘ä»¬åˆ›å»ºçš„æ“ä½œç±»&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/384937/201904/384937-20190413231243522-1726769213.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Â 4. æ–°å»ºä¸€ä¸ªæµ‹è¯•ç±»&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/384937/201904/384937-20190413231308760-1511616593.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæµ‹è¯•ç±»ä¸­ï¼Œå°±å¯ä»¥å–åˆ°æˆ‘ä»¬å†™çš„æ‹¦æˆªæ–¹æ³•ä¸­çš„å€¼ã€‚&lt;/p&gt;

</description>
<pubDate>Sat, 13 Apr 2019 15:15:00 +0000</pubDate>
<dc:creator>ç¥ä¿ä¹‰</dc:creator>
<og:description>springbooté¡¹ç›®ä¸­åœ¨æ‰€æœ‰çš„controlleræ–¹æ³•ä¸­æƒ³å¢åŠ tokenéªŒè¯ï¼Œå³æ‰€æœ‰çš„æ–¹æ³•éƒ½å¿…é¡»ç™»é™†æœ‰tokenä¹‹åæ‰èƒ½è®¿é—®ã€‚springbootå°è£…äº†SpringMVCä¸­çš„HandlerMeth</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/baoyi/p/springboot_HandlerMethodArgumentResolver.html</dc:identifier>
</item>
<item>
<title>Javaä¹‹å†’æ³¡æ’åº(å‡åº) - é¸¿ç¬å—³</title>
<link>http://www.cnblogs.com/honghuoai/p/10703473.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/honghuoai/p/10703473.html</guid>
<description>&lt;h2 id=&quot;javaä¹‹å†’æ³¡æ’åº&quot;&gt;Javaä¹‹å†’æ³¡æ’åº&lt;/h2&gt;
&lt;pre&gt;
&lt;code&gt; * ç¼–è¾‘è€…ï¼šé¸¿ç¬å—³
 * å®ç°åŠŸèƒ½ï¼š ä½¿ç”¨å†’æ³¡æ’åºå¯¹æ•°ç»„ï¼š{25ï¼Œ24ï¼Œ12ï¼Œ76ï¼Œ101ï¼Œ96ï¼Œ28} æ’åºã€‚
 */
package test05;

public class BubbleSort {
    public static void main(String[] args) {
        int[] arr = { 25, 24, 12, 76, 101, 96, 28 };
        System.out.println(&quot;å†’æ³¡æ’åºå‰æ•°ç»„ä¸ºï¼š&quot;);
        printArray(arr);
        Bubble(arr);
    }

    public static void printArray(int[] arr) {
        for (int i = 0; i &amp;lt; arr.length; i++) {
            System.out.println(arr[i]);
        }
    }

    public static void Bubble(int[] arr) {
        for (int i = 0,count=0; i &amp;lt; arr.length - 1; i++) {
            
            for (int j = 0; j &amp;lt; arr.length - i - 1; j++) {
                if (arr[j] &amp;gt; arr[j + 1]) {
                    int temp;
                    temp = arr[j];
                    arr[j] = arr[j + 1];
                    arr[j + 1] = temp;
                }

            }
            count++;
            System.out.println(&quot;ç¬¬&quot;+count+&quot;æ¬¡å†’æ³¡æ’åºï¼š&quot;);
            printArray(arr);
        }
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;è¿è¡Œç»“æœï¼š&lt;/strong&gt;&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1635446/201904/1635446-20190413195527209-627960156.png&quot; alt=&quot;bubbleSort&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;å†’æ³¡æ’åºéš¾ç‚¹&quot;&gt;å†’æ³¡æ’åºéš¾ç‚¹:&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»ºæ’åºæ–¹æ³•æ—¶éœ€è¦å®šä¹‰å¤–å±‚å’Œå†…å±‚å¾ªç¯å‡½æ•°&lt;/strong&gt;&lt;br/&gt;&lt;em&gt;å¤–å±‚å¾ªç¯ï¼šéå†çš„é•¿åº¦ä¸º&lt;strong&gt;å°äºarr.length-1,&lt;/strong&gt;è€Œä¸æ˜¯&lt;strong&gt;arr.length&lt;/strong&gt;&lt;/em&gt;ï¼Œ&lt;span&gt;åŸå› ï¼šå¤–å±‚å‡½æ•°dçš„å¾ªç¯å˜é‡æ˜¯ç”¨æ¥æ§åˆ¶å¤šå°‘è½®æ¯”è¾ƒï¼Œæ¯ä¸€è½®æ¯”è¾ƒå¯ä»¥ç¡®å®šä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œæœ‰å› ä¸ºæ¯”è¾ƒæ˜¯ä¸¤ä¸ªæ•°ä¹‹é—´ï¼Œè‡ªèº«ä¸è¦è‡ªèº«æ¯”è¾ƒï¼Œæ‰€ä»¥éœ€è¦å‡å»1ã€‚&lt;/span&gt;&lt;br/&gt;&lt;em&gt;å†…å±‚å¾ªç¯ï¼šéå†çš„é•¿åº¦ä¸º&lt;strong&gt;å°äºarr.length-i-1&lt;/strong&gt;è€Œä¸æ˜¯&lt;/em&gt;&lt;strong&gt;arr.length&lt;/strong&gt;*,&lt;br/&gt;&lt;span&gt;åŸå› ï¼šå†…å±‚å‡½æ•°æ˜¯ç”¨æ¥æ§åˆ¶æ¯è½®æ¯”è¾ƒçš„çš„æ¬¡æ•°ä»–è¢«ä½œä¸ºè§’æ ‡å»æ¯”è¾ƒæ•°ç»„çš„å…ƒç´ ï¼Œç”±äºå˜é‡åœ¨å¾ªç¯è¿‡ç¨‹ä¸­æ˜¯è‡ªåŠ çš„ï¼Œè¿™æ ·æ—¢å¯ä»¥å®ç°æ‰€æœ‰ç›¸é‚»å…ƒç´ ä¹‹é—´çš„å¿…è¾ƒï¼Œåœ¨ç¨‹åºä¸­æˆ‘å®šä¹‰çš„æ˜¯å‡åºäº¤æ¢ï¼Œæ‰€ä»¥ä¸€è½®å†…å¾ªç¯ç»“æŸåæœ€å¤§çš„å…ƒç´ ä¼šäº¤æ¢åˆ°æœ€åä¸€ä¸ªï¼Œæ¯è½®å†…å¾ªç¯ç»“æŸéƒ½ä¼šç¡®å®šä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼Œå¦‚æœå†…å¾ªç¯æ¬¡æ•°å†ç”¨length-1çš„è¯ï¼Œå°±å¤šæ¯”è¾ƒäº†ï¼Œé€ æˆèµ„æºæµªè´¹ï¼Œæ‰€ä»¥è¦å‡å»å¤–éƒ¨å¾ªç¯çš„å·²ç»éå†çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ä»£ç ä¸­çš„iå€¼ã€‚&lt;/span&gt;&lt;br/&gt;&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;&lt;strong&gt;ç¼–å†™ä½¿ç”¨çš„è½¯ä»¶ï¼š&lt;a href=&quot;https://www%5B.eclipse.org/downloads/packages/&quot;&gt;eclipse&lt;/a&gt;ï¼ŒJavaç¯å¢ƒï¼š&lt;a href=&quot;https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html&quot;&gt;Java SE Development Kit 8u201&lt;/a&gt;&lt;/strong&gt;&lt;br/&gt;&lt;em&gt;æ³¨æ„ï¼šæ–°æ‰‹ç¼–å†™è¯·å¤šå¤šå…³æ³¨æŒ‰ç…§ï¼Œæœ¬ä»£ç çš„bubbleæ–¹æ³•çš„å¤–å±‚å‡½æ•°éå†äº†6è¾¹ï¼Œå¯ä»¥è¿›è¡Œä¼˜åŒ–ï¼Œæœ¬æ¬¡æœªä¼˜åŒ–ï¼ˆå›¾ç‰‡æœªæ‹å…¨ï¼‰ï¼Œä¸‹æ¬¡å°†å‘å‡ºä¼˜åŒ–åçš„ä»£ç ã€‚&lt;/em&gt;&lt;/p&gt;
</description>
<pubDate>Sat, 13 Apr 2019 15:11:00 +0000</pubDate>
<dc:creator>é¸¿ç¬å—³</dc:creator>
<og:description>Javaä¹‹å†’æ³¡æ’åº è¿è¡Œç»“æœï¼š å†’æ³¡æ’åºéš¾ç‚¹: åˆ›å»ºæ’åºæ–¹æ³•æ—¶éœ€è¦å®šä¹‰å¤–å±‚å’Œå†…å±‚å¾ªç¯å‡½æ•° å¤–å±‚å¾ªç¯ï¼šéå†çš„é•¿åº¦ä¸º å°äºarr.length 1, è€Œä¸æ˜¯ arr.length ï¼ŒåŸå› ï¼šå¤–å±‚å‡½æ•°dçš„å¾ªç¯</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/honghuoai/p/10703473.html</dc:identifier>
</item>
<item>
<title>Javaä¸­çš„é˜Ÿåˆ—åŒæ­¥å™¨AQS - é£æ²™è¿·äº†çœ¼</title>
<link>http://www.cnblogs.com/fsmly/p/10701109.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/fsmly/p/10701109.html</guid>
<description>&lt;p&gt;ã€€ã€€1ã€é˜Ÿåˆ—åŒæ­¥å™¨æ˜¯ç”¨æ¥æ„å»ºé”æˆ–è€…å…¶ä»–åŒæ­¥ç»„ä»¶çš„åŸºç¡€æ¡†æ¶ï¼Œä½¿ç”¨ä¸€ä¸ªintå‹å˜é‡ä»£è¡¨åŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„é˜Ÿåˆ—æ¥å®Œæˆçº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€2ã€ä¸‹é¢æ˜¯JDK8æ–‡æ¡£ä¸­å¯¹äºAQSçš„éƒ¨åˆ†ä»‹ç»&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;ã€€ã€€public&lt;/span&gt; &lt;span&gt;abstract&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; AbstractQueuedSynchronizer &lt;span&gt;extends&lt;/span&gt; AbstractOwnableSynchronizer &lt;span&gt;implements&lt;/span&gt;&lt;span&gt; Serializable
&lt;/span&gt;&lt;span&gt;ã€€ã€€æä¾›ä¸€ä¸ªæ¡†æ¶ï¼Œç”¨äºå®ç°ä¾èµ–å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ç­‰å¾…é˜Ÿåˆ—çš„é˜»å¡é”å’Œç›¸å…³åŒæ­¥å™¨ï¼ˆä¿¡å·é‡ï¼Œäº‹ä»¶ç­‰ï¼‰ã€‚ è¯¥ç±»è¢«è®¾è®¡ä¸ºå¤§å¤šæ•°ç±»å‹çš„åŒæ­¥å™¨çš„æœ‰ç”¨ä¾æ®ï¼Œè¿™äº›åŒæ­¥å™¨ä¾èµ–äºå•ä¸ªåŸå­intå€¼æ¥è¡¨ç¤ºçŠ¶&lt;br/&gt;æ€ã€‚å­ç±»å¿…é¡»å®šä¹‰æ”¹å˜æ­¤çŠ¶æ€çš„protectedæ–¹æ³•ï¼Œä»¥åŠæ ¹æ®è¯¥å¯¹è±¡è¢«è·å–æˆ–é‡Šæ”¾æ¥å®šä¹‰è¯¥çŠ¶æ€çš„å«ä¹‰ã€‚ç»™å®šè¿™äº›ï¼Œè¿™ä¸ªç±»ä¸­çš„å…¶ä»–æ–¹æ³•æ‰§è¡Œæ‰€æœ‰æ’é˜Ÿå’Œé˜»å¡æœºåˆ¶ã€‚ å­ç±»å¯ä»¥ä¿æŒå…¶ä»–çŠ¶æ€å­—æ®µï¼Œä½†åªä»¥&lt;br/&gt;åŸå­æ–¹å¼æ›´æ–°intä½¿ç”¨æ–¹æ³•æ“çºµå€¼getState() ï¼Œ setState(int)å’ŒcompareAndSetState(int, int)è¢«è·Ÿè¸ªç›¸å¯¹äºåŒæ­¥ã€‚ 
ã€€ã€€&lt;/span&gt;&lt;span&gt;æ­¤ç±»æ”¯æŒé»˜è®¤ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼ã€‚ å½“ä»¥ç‹¬å æ¨¡å¼è·å–æ—¶ï¼Œå°è¯•é€šè¿‡å…¶ä»–çº¿ç¨‹è·å–ä¸èƒ½æˆåŠŸã€‚ å¤šçº¿ç¨‹è·å–çš„å…±äº«æ¨¡å¼å¯èƒ½ï¼ˆä½†ä¸éœ€è¦ï¼‰æˆåŠŸã€‚ é™¤äº†åœ¨æœºæ¢°æ„ä¹‰ä¸Šï¼Œè¿™ä¸ªç±»ä¸ç†è§£è¿™äº›å·®å¼‚ï¼Œå½“å…±äº«&lt;br/&gt;æ¨¡å¼è·å–æˆåŠŸæ—¶ï¼Œä¸‹ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ä¹Ÿå¿…é¡»ç¡®å®šå®ƒæ˜¯å¦ä¹Ÿå¯ä»¥è·å–ã€‚ åœ¨ä¸åŒæ¨¡å¼ä¸‹ç­‰å¾…çš„çº¿ç¨‹å…±äº«ç›¸åŒçš„FIFOé˜Ÿåˆ—ã€‚ é€šå¸¸ï¼Œå®ç°å­ç±»åªæ”¯æŒè¿™äº›æ¨¡å¼ä¹‹ä¸€ï¼Œä½†æ˜¯ä¸¤è€…éƒ½å¯ä»¥åœ¨&lt;br/&gt;ReadWriteLockä¸­å‘æŒ¥ä½œç”¨ã€‚ä»…æ”¯æŒç‹¬å æˆ–ä»…å…±äº«æ¨¡å¼çš„å­ç±»ä¸éœ€è¦å®šä¹‰æ”¯æŒæœªä½¿ç”¨æ¨¡å¼çš„æ–¹æ³•ã€‚&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æ€»ç»“æ¥è¯´å°±æ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;ã€€ã€€â‘ å­ç±»é€šè¿‡&lt;strong&gt;ç»§æ‰¿AQS&lt;/strong&gt;å¹¶å®ç°å…¶æŠ½è±¡æ–¹æ³•æ¥ç®¡ç†åŒæ­¥çŠ¶æ€ï¼Œå¯¹äºåŒæ­¥çŠ¶æ€çš„æ›´æ”¹é€šè¿‡æä¾›çš„&lt;strong&gt;getState()ã€setState(int state)ã€compareAndSetState(int expect, int update)&lt;/strong&gt;æ¥è¿›è¡Œæ“ä½œï¼Œå› ä¸ºä½¿ç”¨CASæ“ä½œä¿è¯åŒæ­¥çŠ¶æ€çš„æ”¹å˜æ˜¯&lt;strong&gt;åŸå­çš„&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€â‘¡å­ç±»è¢«æ¨èå®šä¹‰ä¸ºè‡ªå®šä¹‰åŒæ­¥ç»„ä»¶çš„é™æ€å†…éƒ¨ç±»ï¼ŒåŒæ­¥å™¨æœ¬èº«å¹¶æ²¡æœ‰å®ç°ä»»ä½•çš„åŒæ­¥æ¥å£ï¼Œä»…ä»…æ˜¯å®šä¹‰äº†è‹¥å¹²çŠ¶æ€è·å–å’Œé‡Šæ”¾çš„æ–¹æ³•æ¥æä¾›è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶çš„ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€â‘¢åŒæ­¥å™¨æ—¢å¯ä»¥æ”¯æŒç‹¬å å¼çš„è·å–åŒæ­¥çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥æ”¯æŒå…±äº«å¼çš„è·å–åŒæ­¥çŠ¶æ€ï¼ˆReentrantLockã€ReentrantReadWriteLockã€CountDownLatchç­‰ä¸åŒç±»å‹çš„åŒæ­¥ç»„ä»¶ï¼‰&lt;/p&gt;
&lt;p&gt;ã€€ã€€3ã€åŒæ­¥å™¨æ˜¯å®ç°é”çš„å…³é”®ï¼Œåœ¨é”çš„å®ç°ä¸­èšåˆåŒæ­¥å™¨ï¼Œåˆ©ç”¨åŒæ­¥å™¨å®ç°é”çš„è¯­ä¹‰ï¼›&lt;/p&gt;

&lt;h3&gt;1ã€åŒæ­¥å™¨çš„è®¾è®¡å®ç°åŸç†&lt;/h3&gt;
&lt;p&gt;ã€€ã€€ç»§æ‰¿åŒæ­¥å™¨å¹¶ä¸”é‡å†™æŒ‡å®šçš„æ–¹æ³•ï¼Œç„¶åå°†åŒæ­¥å™¨ç»„åˆåœ¨è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶çš„å®ç°ä¸­ï¼Œå¹¶ä¸”è°ƒç”¨åŒæ­¥å™¨æä¾›çš„æ¨¡æ¿æ–¹æ³•ï¼ˆè¿™äº›æ¨¡æ¿æ–¹æ³•ä¼šè°ƒç”¨é‡å†™çš„æ–¹æ³•ï¼‰ï¼›è€Œé‡å†™æŒ‡å®šçš„æ–¹æ³•çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨&lt;strong&gt;getState()ã€setState(int state)ã€compareAndSetState(int expect, int update)&lt;/strong&gt;æ¥è®¿é—®æˆ–è€…æ›´æ–°åŒæ­¥çŠ¶æ€ã€‚ä¸‹é¢æ˜¯æºç ä¸­stateå˜é‡å’Œä¸‰ä¸ªæ–¹æ³•çš„å®šä¹‰å£°æ˜å®ç°&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt;     &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;     * The synchronization state.(åŒæ­¥çŠ¶æ€)
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;      &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;volatile&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; state;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; 
&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;     * Returns the current value of synchronization state.(è¿”å›å½“å‰çš„åŒæ­¥çŠ¶æ€)
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;     * This operation has memory semantics of a {&lt;/span&gt;&lt;span&gt;@code&lt;/span&gt;&lt;span&gt; volatile} read.
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;     * æ­¤æ“ä½œçš„å†…å­˜è¯­ä¹‰ä¸º&lt;/span&gt;&lt;span&gt;@code&lt;/span&gt;&lt;span&gt; volatile read
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;     * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; current state value
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;      &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;12&lt;/span&gt;     &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getState() {
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; state;
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; 
&lt;span&gt;16&lt;/span&gt;     &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;17&lt;/span&gt; &lt;span&gt;     * Sets the value of synchronization state.(è®¾ç½®æ–°çš„åŒæ­¥çŠ¶æ€)
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt; &lt;span&gt;     * This operation has memory semantics of a {&lt;/span&gt;&lt;span&gt;@code&lt;/span&gt;&lt;span&gt; volatile} write.
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;     * æ­¤æ“ä½œçš„å†…å­˜è¯­ä¹‰ä¸º&lt;/span&gt;&lt;span&gt;@code&lt;/span&gt;&lt;span&gt; volatile read
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;     * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; newState the new state value
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt;      &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;22&lt;/span&gt;     &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; setState(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; newState) {
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;         state =&lt;span&gt; newState;
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; 
&lt;span&gt;26&lt;/span&gt;     &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;27&lt;/span&gt; &lt;span&gt;     * Atomically sets synchronization state to the given updated
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; &lt;span&gt;     * value if the current state value equals the expected value.(å¦‚æœè¦æ›´æ–°çš„çŠ¶æ€å’ŒæœŸæœ›çš„çŠ¶æ€ç›¸åŒï¼Œé‚£å°±é€šè¿‡åŸå­çš„æ–¹å¼æ›´æ–°çŠ¶æ€)
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt; &lt;span&gt;     * This operation has memory semantics of a {&lt;/span&gt;&lt;span&gt;@code&lt;/span&gt;&lt;span&gt; volatile} read
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; &lt;span&gt;     * and write.( æ­¤æ“ä½œçš„å†…å­˜è¯­ä¹‰ä¸º&lt;/span&gt;&lt;span&gt;@code&lt;/span&gt;&lt;span&gt; volatile read å’Œ write)
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt; &lt;span&gt;     *
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; &lt;span&gt;     * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; expect the expected value
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; &lt;span&gt;     * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; update the new value
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt; &lt;span&gt;     * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; {&lt;/span&gt;&lt;span&gt;@code&lt;/span&gt;&lt;span&gt; true} if successful. False return indicates that the actual
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt; &lt;span&gt;     *         value was not equal to the expected value.(å¦‚æœæ›´æ–°çš„çŠ¶æ€å’ŒæœŸæœ›çš„çŠ¶æ€ä¸åŒå°±è¿”å›false)
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;      &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;37&lt;/span&gt;     &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; compareAndSetState(&lt;span&gt;int&lt;/span&gt; expect, &lt;span&gt;int&lt;/span&gt;&lt;span&gt; update) {
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; See below for intrinsics setup to support this&lt;/span&gt;
&lt;span&gt;39&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; unsafe.compareAndSwapInt(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;, stateOffset, expect, update);
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt;     }
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2ã€ä¸‹é¢ä»‹ç»AQSæä¾›å¯è¢«é‡å†™çš„æ–¹æ³•&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt; * ç‹¬å å¼çš„è·å–åŒæ­¥çŠ¶æ€ï¼Œå®ç°è¯¥æ–¹æ³•éœ€è¦æŸ¥è¯¢å½“å‰çŠ¶æ€å¹¶åˆ¤æ–­åŒæ­¥çŠ¶æ€æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œç„¶åå†è¿›è¡ŒCASè®¾ç½®åŒæ­¥çŠ¶æ€
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt; *
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; tryAcquire(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; UnsupportedOperationException();
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; 
&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;10&lt;/span&gt; &lt;span&gt; * ç‹¬å å¼çš„é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œç­‰å¾…è·å–åŒæ­¥çŠ¶æ€çš„çº¿ç¨‹å¯ä»¥æœ‰æœºä¼šè·å–åŒæ­¥çŠ¶æ€
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt; *
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;13&lt;/span&gt; &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; tryRelease(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;     &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; UnsupportedOperationException();
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; 
&lt;span&gt;17&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;18&lt;/span&gt; &lt;span&gt; * å°è¯•ä»¥å…±äº«æ¨¡å¼è·å–ã€‚ è¯¥æ–¹æ³•åº”è¯¥æŸ¥è¯¢å¯¹è±¡çš„çŠ¶æ€æ˜¯å¦å…è®¸åœ¨å…±äº«æ¨¡å¼ä¸‹è·å–è¯¥å¯¹è±¡ï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼Œå°±å¯ä»¥è·å–å®ƒã€‚ è¯¥æ–¹æ³•æ€»æ˜¯ç”±æ‰§è¡Œè·å–çš„çº¿ç¨‹è°ƒç”¨ã€‚
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt; * å¦‚æœæ­¤æ–¹æ³•æŠ¥å‘Šå¤±è´¥ï¼Œåˆ™è·å–æ–¹æ³•å¯èƒ½å°†çº¿ç¨‹æ’é˜Ÿï¼ˆå¦‚æœå°šæœªæ’é˜Ÿï¼‰ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹é‡Šæ”¾ä¸ºæ­¢ã€‚ è·å–å¤±è´¥æ—¶è¿”å›è´Ÿå€¼ï¼Œå¦‚æœåœ¨è·å–æˆå…±äº«æ¨¡å¼ä¸‹åŠŸä½†æ²¡
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt; * æœ‰åç»­å…±äº«æ¨¡å¼è·å–å¯ä»¥æˆåŠŸï¼Œåˆ™ä¸ºé›¶; å¹¶ä¸”å¦‚æœä»¥å…±äº«æ¨¡å¼è·å–æˆåŠŸå¹¶ä¸”éšåçš„å…±äº«æ¨¡å¼è·å–å¯èƒ½æˆåŠŸï¼Œåˆ™ä¸ºæ­£å€¼ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåç»­ç­‰å¾…çº¿ç¨‹å¿…é¡»æ£€æŸ¥å¯ç”¨æ€§ã€‚
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;22&lt;/span&gt; &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; tryAcquireShared(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;     &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; UnsupportedOperationException(); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¦‚æœä¸æ”¯æŒå…±äº«æ¨¡å¼ ,ä¼šæŠ›å‡ºè¯¥å¼‚å¸¸&lt;/span&gt;
&lt;span&gt;24&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; 
&lt;span&gt;26&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;27&lt;/span&gt; &lt;span&gt; * å°è¯•å°†çŠ¶æ€è®¾ç½®ä¸ºä»¥å…±äº«æ¨¡å¼é‡Šæ”¾åŒæ­¥çŠ¶æ€ã€‚ è¯¥æ–¹æ³•æ€»æ˜¯ç”±æ‰§è¡Œé‡Šæ”¾çš„çº¿ç¨‹è°ƒç”¨ã€‚ 
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;29&lt;/span&gt; &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; tryReleaseShared(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt;     &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; UnsupportedOperationException(); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¦‚æœä¸æ”¯æŒå…±äº«æ¨¡å¼ ,ä¼šæŠ›å‡ºè¯¥å¼‚å¸¸&lt;/span&gt;
&lt;span&gt;31&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; 
&lt;span&gt;33&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;34&lt;/span&gt; &lt;span&gt; * å½“å‰åŒæ­¥å™¨æ˜¯å¦åœ¨ç‹¬å æ¨¡å¼ä¸‹è¢«çº¿ç¨‹å ç”¨ï¼Œä¸€èˆ¬è¯¥æ–¹æ³•è¡¨ç¤ºæ˜¯å¦è¢«å½“å‰çº¿ç¨‹æ‰€ç‹¬å 
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;36&lt;/span&gt; &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; isHeldExclusively(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;     &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; UnsupportedOperationException(); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¦‚æœä¸æ”¯æŒå…±äº«æ¨¡å¼ ,ä¼šæŠ›å‡ºè¯¥å¼‚å¸¸&lt;/span&gt;
&lt;span&gt;38&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;3ã€åŒæ­¥å™¨æä¾›çš„æ¨¡æ¿æ–¹æ³•&lt;/h3&gt;
&lt;p&gt;ã€€ã€€åœ¨å®ç°è‡ªå®šä¹‰åŒæ­¥ç»„ä»¶çš„æ—¶å€™ï¼Œéœ€è¦é‡å†™ä¸Šé¢çš„æ–¹æ³•ï¼Œè€Œä¸‹é¢çš„æ¨¡æ¿æ–¹æ³•ä¼šè°ƒç”¨ä¸Šé¢é‡å†™çš„æ–¹æ³•ã€‚ä¸‹é¢ä»‹ç»åŒæ­¥å™¨æä¾›çš„æ¨¡æ¿æ–¹æ³•&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt; * ä»¥ç‹¬å æ¨¡å¼è·å–ï¼Œå¿½ç•¥ä¸­æ–­ã€‚ é€šè¿‡è°ƒç”¨è‡³å°‘ä¸€æ¬¡tryAcquire(int)å®ç°ï¼ŒæˆåŠŸè¿”å›ã€‚ å¦åˆ™çº¿ 
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt; * ç¨‹æ’é˜Ÿï¼Œå¯èƒ½ä¼šé‡å¤é˜»å¡å’Œè§£é™¤é˜»å¡ï¼Œç›´åˆ°æˆåŠŸæ‰è°ƒç”¨tryAcquire(int) 
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; acquire(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {...}
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; 
&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt; 8&lt;/span&gt; &lt;span&gt; * ä»¥ç‹¬å æ–¹å¼è·å¾—ï¼Œå¦‚æœä¸­æ–­ï¼Œä¸­æ­¢ã€‚ é€šè¿‡é¦–å…ˆæ£€æŸ¥ä¸­æ–­çŠ¶æ€ï¼Œç„¶åè°ƒç”¨è‡³å°‘ä¸€æ¬¡
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt; * tryAcquire(int) ï¼ŒæˆåŠŸè¿”å›ã€‚ å¦åˆ™çº¿ç¨‹æ’é˜Ÿï¼Œå¯èƒ½ä¼šé‡å¤é˜»å¡å’Œè§£é™¤é˜»å¡ï¼Œè°ƒç”¨
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt; * tryAcquire(int)ç›´åˆ°æˆåŠŸæˆ–çº¿ç¨‹ä¸­æ–­ã€‚
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;12&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; acquireInterruptibly(&lt;span&gt;int&lt;/span&gt; arg) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; InterruptedException {...}
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; 
&lt;span&gt;14&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;15&lt;/span&gt; &lt;span&gt; * å°è¯•ä»¥ç‹¬å æ¨¡å¼è·å–ï¼Œå¦‚æœä¸­æ–­åˆ™ä¸­æ­¢ï¼Œå¦‚æœç»™å®šçš„è¶…æ—¶æ—¶é—´å¤±è´¥ã€‚ é¦–å…ˆæ£€æŸ¥ä¸­æ–­çŠ¶æ€ï¼Œç„¶
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt; * åè°ƒç”¨è‡³å°‘ä¸€æ¬¡tryAcquire(int) ï¼ŒæˆåŠŸè¿”å›ã€‚ å¦åˆ™ï¼Œçº¿ç¨‹æ’é˜Ÿï¼Œå¯èƒ½ä¼šé‡å¤é˜»å¡å’Œè§£é™¤é˜»
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt; * å¡ï¼Œè°ƒç”¨tryAcquire(int)ç›´åˆ°æˆåŠŸæˆ–çº¿ç¨‹ä¸­æ–­æˆ–è¶…æ—¶
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;19&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; tryAcquireNanos(&lt;span&gt;int&lt;/span&gt; arg, &lt;span&gt;long&lt;/span&gt; nanosTimeout) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; InterruptedException {...}
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; 
&lt;span&gt;21&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;22&lt;/span&gt; &lt;span&gt; * ä»¥å…±äº«æ¨¡å¼è·å–ï¼Œå¿½ç•¥ä¸­æ–­ã€‚ é€šè¿‡é¦–æ¬¡è°ƒç”¨è‡³å°‘ä¸€æ¬¡æ‰§è¡Œ tryAcquireShared(int)ï¼ŒæˆåŠŸè¿”
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; &lt;span&gt; * å›ã€‚ å¦åˆ™çº¿ç¨‹æ’é˜Ÿï¼Œå¯èƒ½ä¼šé‡å¤é˜»å¡å’Œè§£é™¤é˜»å¡ï¼Œç›´åˆ°æˆåŠŸè°ƒç”¨tryAcquireShared(int) ã€‚
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;25&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; acquireShared(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg){...}
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt; 
&lt;span&gt;27&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;28&lt;/span&gt; &lt;span&gt; * ä»¥å…±äº«æ–¹å¼è·å–ï¼Œå¦‚æœä¸­æ–­ï¼Œä¸­æ­¢ã€‚ é¦–å…ˆæ£€æŸ¥ä¸­æ–­çŠ¶æ€ï¼Œç„¶åè°ƒç”¨è‡³å°‘ä¸€æ¬¡
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt; &lt;span&gt; * tryAcquireShared(int) ï¼ŒæˆåŠŸè¿”å›ã€‚ å¦åˆ™çº¿ç¨‹æ’é˜Ÿï¼Œå¯èƒ½ä¼šé‡å¤é˜»å¡å’Œè§£é™¤é˜»å¡ï¼Œè°ƒç”¨
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; &lt;span&gt; * tryAcquireShared(int)ç›´åˆ°æˆåŠŸæˆ–çº¿ç¨‹ä¸­æ–­ã€‚
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;32&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; acquireSharedInterruptibly(&lt;span&gt;int&lt;/span&gt; arg) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; InterruptedException{...}
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; 
&lt;span&gt;34&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;35&lt;/span&gt; &lt;span&gt; * å°è¯•ä»¥å…±äº«æ¨¡å¼è·å–ï¼Œå¦‚æœä¸­æ–­åˆ™ä¸­æ­¢ï¼Œå¦‚æœç»™å®šçš„æ—¶é—´è¶…è¿‡ï¼Œåˆ™å¤±è´¥ã€‚ é€šè¿‡é¦–å…ˆæ£€æŸ¥ä¸­æ–­ 
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt; &lt;span&gt; * çŠ¶æ€ï¼Œç„¶åè°ƒç”¨è‡³å°‘ä¸€æ¬¡tryAcquireShared(int) ï¼ŒæˆåŠŸè¿”å›ã€‚ å¦åˆ™ï¼Œçº¿ç¨‹æ’é˜Ÿï¼Œå¯èƒ½ä¼šé‡ 
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt; &lt;span&gt; * å¤é˜»å¡å’Œè§£é™¤é˜»å¡ï¼Œè°ƒç”¨tryAcquireShared(int)ç›´åˆ°æˆåŠŸæˆ–çº¿ç¨‹ä¸­æ–­æˆ–è¶…æ—¶ã€‚ 
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;39&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; tryAcquireSharedNanos(&lt;span&gt;int&lt;/span&gt; arg, &lt;span&gt;long&lt;/span&gt; nanosTimeout) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; InterruptedException{...}
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt; 
&lt;span&gt;41&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;42&lt;/span&gt; &lt;span&gt; * ç‹¬å å¼çš„é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨é‡Šæ”¾åŒæ­¥çŠ¶æ€ä¹‹åï¼Œå°†åŒæ­¥é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹åŒ…å«çš„çº¿ç¨‹å”¤é†’
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;44&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; release(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg){...}
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt; 
&lt;span&gt;46&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;47&lt;/span&gt; &lt;span&gt; * å…±äº«å¼çš„é‡Šæ”¾åŒæ­¥çŠ¶æ€
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;49&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; releaseShared(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg){...}
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt; 
&lt;span&gt;51&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;52&lt;/span&gt; &lt;span&gt; * è·å–åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸Šçš„çº¿ç¨‹é›†åˆ
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;54&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Collection&amp;lt;Thread&amp;gt; getQueuedThreads(){...}
&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;Â 1ã€åŒæ­¥é˜Ÿåˆ—&lt;/h3&gt;
&lt;p&gt;a)tåŒæ­¥é˜Ÿåˆ—çš„å®ç°åŸç†&lt;/p&gt;
&lt;p&gt;ã€€ã€€AQSå†…éƒ¨&lt;strong&gt;ç»´æŠ¤ä¸€ä¸ªåŒæ­¥é˜Ÿåˆ—&lt;/strong&gt;æ¥å®ŒæˆåŒæ­¥çŠ¶æ€çš„ç®¡ç†ï¼Œå½“å‰çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€å¤±è´¥çš„æ—¶å€™ï¼ŒAQSä¼š&lt;strong&gt;å°†å½“å‰çº¿ç¨‹ä»¥åŠç­‰å¾…çŠ¶æ€ä¿¡æ¯æ„é€ æˆä¸€ä¸ªç»“ç‚¹Node&lt;/strong&gt;å¹¶å°†å…¶åŠ å…¥åŒæ­¥é˜Ÿåˆ—ä¸­ï¼ŒåŒæ—¶&lt;strong&gt;é˜»å¡å½“å‰çº¿ç¨‹&lt;/strong&gt;ï¼Œå½“åŒæ­¥çŠ¶æ€ç”±æŒæœ‰çº¿ç¨‹é‡Šæ”¾çš„æ—¶å€™ï¼Œä¼šå°†åŒæ­¥é˜Ÿåˆ—ä¸­çš„é¦–èŠ‚ç‚¹å”¤é†’ä½¿å…¶å†æ¬¡å°è¯•è·å–åŒæ­¥çŠ¶æ€ã€‚åŒæ­¥é˜Ÿåˆ—ä¸­çš„ç»“ç‚¹ç”¨æ¥ä¿å­˜è·å–åŒæ­¥çŠ¶æ€å¤±è´¥çš„çº¿ç¨‹çš„çº¿ç¨‹å¼•ç”¨ã€ç­‰å¾…çŠ¶æ€ä»¥åŠå‰é©±ç»“ç‚¹å’Œåç»§ç»“ç‚¹ã€‚ä¸‹é¢æ˜¯Nodeçš„å±æ€§åˆ†æ&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt;     &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; Node {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;         &lt;span&gt;/**&lt;/span&gt;&lt;span&gt; å…±äº«æ¨¡å¼ä¸‹æ„é€ ç»“ç‚¹ &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt; 3&lt;/span&gt;         &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Node SHARED = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Node();
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;         &lt;span&gt;/**&lt;/span&gt;&lt;span&gt; ç‹¬å æ¨¡å¼ä¸‹æ„é€ ç»“ç‚¹ &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt; 5&lt;/span&gt;         &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Node EXCLUSIVE = &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; 
&lt;span&gt; 7&lt;/span&gt;         &lt;span&gt;/**&lt;/span&gt;&lt;span&gt; ç”¨äºæŒ‡ç¤ºçº¿ç¨‹å·²ç»å–æ¶ˆçš„waitStatuså€¼ï¼ˆç”±äºåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ç­‰å¾…çš„çº¿ç¨‹ç­‰å¾…è¶…æ—¶æˆ–è€…å‘ç”Ÿä¸­æ–­ï¼Œéœ€è¦ä»åŒæ­¥é˜Ÿåˆ—ä¸­å–æ¶ˆç­‰å¾…ï¼Œç»“ç‚¹è¿›å…¥è¯¥çŠ¶æ€å°†ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼‰&lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt; 8&lt;/span&gt;         &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; CANCELLED =  1&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;         &lt;span&gt;/**&lt;/span&gt;&lt;span&gt; waitstatuså€¼æŒ‡ç¤ºåç»­çº¿ç¨‹éœ€è¦å–æ¶ˆç­‰å¾…ï¼ˆåç»§ç»“ç‚¹çš„çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œè€Œå½“å‰ç»“ç‚¹çš„çº¿ç¨‹å¦‚æœé‡Šæ”¾äº†åŒæ­¥çŠ¶æ€æˆ–è€…CANCELLï¼Œå°†ä¼šé€šçŸ¥åç»§ç»“ç‚¹çš„çº¿ç¨‹ä»¥è¿è¡Œï¼‰ &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;10&lt;/span&gt;         &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; SIGNAL    = -1&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         &lt;span&gt;/**&lt;/span&gt;&lt;span&gt;waitStatuså€¼è¡¨ç¤ºçº¿ç¨‹æ­£åœ¨ç­‰å¾…æ¡ä»¶ï¼ˆåŸæœ¬ç»“ç‚¹åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œç»“ç‚¹çº¿ç¨‹ç­‰å¾…åœ¨Conditionä¸Šï¼Œå½“å…¶ä»–çº¿ç¨‹å¯¹Conditionè°ƒç”¨äº†signal()æ–¹æ³•ä¹‹åï¼‰è¯¥ç»“ç‚¹ä¼šä»&lt;br/&gt;ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ ç­‰å¾…é˜Ÿåˆ—ä¸­è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œè¿›è¡ŒåŒæ­¥çŠ¶æ€çš„è·å– &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;12&lt;/span&gt;         &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; CONDITION = -2&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;         &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;14&lt;/span&gt; &lt;span&gt;         * waitStatuså€¼è¡¨ç¤ºä¸‹ä¸€ä¸ªå…±äº«å¼åŒæ­¥çŠ¶æ€çš„è·å–åº”è¯¥æ— æ¡ä»¶ä¼ æ’­ä¸‹å»
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;          &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;16&lt;/span&gt;         &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; PROPAGATE = -3&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; 
&lt;span&gt;18&lt;/span&gt;         &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;19&lt;/span&gt; &lt;span&gt;         * ä¸åŒçš„ç­‰åˆ°çŠ¶æ€çš„intå€¼
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;          &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;21&lt;/span&gt;         &lt;span&gt;volatile&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; waitStatus;
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; 
&lt;span&gt;23&lt;/span&gt;         &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;24&lt;/span&gt; &lt;span&gt;         * å‰é©±ç»“ç‚¹ï¼Œå½“ç»“ç‚¹åŠ å…¥åŒæ­¥é˜Ÿåˆ—å°†ä¼šè¢«è®¾ç½®å‰é©±ç»“ç‚¹ä¿¡æ¯
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;          &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;26&lt;/span&gt;         &lt;span&gt;volatile&lt;/span&gt;&lt;span&gt; Node prev;
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt; 
&lt;span&gt;28&lt;/span&gt;         &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;29&lt;/span&gt; &lt;span&gt;         * åç»§ç»“ç‚¹
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt;          &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;31&lt;/span&gt;         &lt;span&gt;volatile&lt;/span&gt;&lt;span&gt; Node next;
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; 
&lt;span&gt;33&lt;/span&gt;         &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;34&lt;/span&gt; &lt;span&gt;         * å½“å‰è·å–åˆ°åŒæ­¥çŠ¶æ€çš„çº¿ç¨‹
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;          &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;36&lt;/span&gt;         &lt;span&gt;volatile&lt;/span&gt;&lt;span&gt; Thread thread;
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt; 
&lt;span&gt;38&lt;/span&gt;         &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;39&lt;/span&gt; &lt;span&gt;         * ç­‰å¾…é˜Ÿåˆ—ä¸­çš„åç»§ç»“ç‚¹ï¼Œå¦‚æœå½“å‰ç»“ç‚¹æ˜¯å…±äº«çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—æ®µæ˜¯ä¸€ä¸ªSHAREDå¸¸é‡ï¼›ä¹Ÿå°±æ˜¯è¯´ç»“ç‚¹ç±»å‹ï¼ˆç‹¬å å’Œå…±äº«ï¼‰å’Œç­‰å¾…é˜Ÿåˆ—ä¸­çš„åç»§ç»“ç‚¹å…¬ç”¨ä¸€ä¸ªå­—æ®µ
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt;          &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;41&lt;/span&gt; &lt;span&gt;        Node nextWaiter;
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt; 
&lt;span&gt;43&lt;/span&gt;         &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;44&lt;/span&gt; &lt;span&gt;         * å¦‚æœæ˜¯å…±äº«æ¨¡å¼ä¸‹ç­‰å¾…ï¼Œé‚£ä¹ˆè¿”å›trueï¼ˆå› ä¸ºä¸Šé¢çš„Node nextWaiterå­—æ®µåœ¨å…±äº«æ¨¡å¼ä¸‹æ˜¯ä¸€ä¸ªSHAREDå¸¸é‡ï¼‰
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt;          &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;46&lt;/span&gt;         &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; isShared() {
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; nextWaiter ==&lt;span&gt; SHARED;
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt; 
&lt;span&gt;50&lt;/span&gt;         &lt;span&gt;final&lt;/span&gt; Node predecessor() &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; NullPointerException {
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt;             Node p =&lt;span&gt; prev;
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (p == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt;                 &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; NullPointerException();
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt;
&lt;span&gt;55&lt;/span&gt;                 &lt;span&gt;return&lt;/span&gt;&lt;span&gt; p;
&lt;/span&gt;&lt;span&gt;56&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;57&lt;/span&gt; 
&lt;span&gt;58&lt;/span&gt;         Node() {    &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç”¨äºå»ºç«‹åˆå§‹å¤´ç»“ç‚¹æˆ–SHAREDæ ‡è®°&lt;/span&gt;
&lt;span&gt;59&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;60&lt;/span&gt; 
&lt;span&gt;61&lt;/span&gt;         Node(Thread thread, Node mode) {     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç”¨äºæ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—&lt;/span&gt;
&lt;span&gt;62&lt;/span&gt;             &lt;span&gt;this&lt;/span&gt;.nextWaiter =&lt;span&gt; mode;
&lt;/span&gt;&lt;span&gt;63&lt;/span&gt;             &lt;span&gt;this&lt;/span&gt;.thread =&lt;span&gt; thread;
&lt;/span&gt;&lt;span&gt;64&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;65&lt;/span&gt; 
&lt;span&gt;66&lt;/span&gt;         Node(Thread thread, &lt;span&gt;int&lt;/span&gt; waitStatus) { &lt;span&gt;//&lt;/span&gt;&lt;span&gt; Used by Condition&lt;/span&gt;
&lt;span&gt;67&lt;/span&gt;             &lt;span&gt;this&lt;/span&gt;.waitStatus =&lt;span&gt; waitStatus;
&lt;/span&gt;&lt;span&gt;68&lt;/span&gt;             &lt;span&gt;this&lt;/span&gt;.thread =&lt;span&gt; thread;
&lt;/span&gt;&lt;span&gt;69&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;70&lt;/span&gt;     }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;bï¼‰åŒæ­¥é˜Ÿåˆ—ç¤ºæ„å›¾å’Œç®€å•åˆ†æ&lt;/p&gt;
&lt;p&gt;ã€€ã€€â‘ åŒæ­¥é˜Ÿåˆ—ç¤ºæ„å›¾ï¼šå½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†åŒæ­¥çŠ¶æ€åï¼Œå…¶ä»–çº¿ç¨‹ä¸èƒ½è·å–åˆ°è¯¥åŒæ­¥çŠ¶æ€ï¼Œå°±ä¼šè¢«æ„é€ ç§°ä¸ºNodeç„¶åæ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¹‹ä¸­ï¼Œè¿™ä¸ªæ·»åŠ çš„è¿‡ç¨‹åŸºäºCASä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1368768/201904/1368768-20190413160241164-1504985663.png&quot; alt=&quot;&quot; width=&quot;528&quot; height=&quot;174&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€â‘¡åŒæ­¥é˜Ÿåˆ—éµå¾ªå…ˆè¿›å…ˆå‡º(FIFO)ï¼Œé¦–èŠ‚ç‚¹æ˜¯è·å–åˆ°åŒæ­¥çŠ¶æ€çš„ç»“ç‚¹ï¼Œé¦–èŠ‚ç‚¹çš„çº¿ç¨‹åœ¨é‡Šæ”¾åŒæ­¥çŠ¶æ€çš„æ—¶å€™å°†ä¼šå”¤é†’åç»§ç»“ç‚¹ï¼ˆç„¶ååç»§ç»“ç‚¹å°±ä¼šå˜æˆæ–°çš„é¦–èŠ‚ç‚¹ç­‰å¾…è·å–åŒæ­¥çŠ¶æ€ï¼‰&lt;/p&gt;
&lt;h3&gt;2ã€ç‹¬å å¼åŒæ­¥çŠ¶æ€çš„è·å–å’Œé‡Šæ”¾&lt;/h3&gt;
&lt;p&gt;ã€€ã€€â‘ å‰é¢è¯´è¿‡ï¼ŒåŒæ­¥å™¨çš„acquire()æ–¹æ³•ä¼šè·å–åŒæ­¥çŠ¶æ€ï¼Œè¿™ä¸ªæ–¹æ³•å¯¹ä¸ä¼šå“åº”ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯è¯´å½“çº¿ç¨‹è·å–é€šåŒæ­¥çŠ¶æ€å¤±è´¥åä¼šè¢«æ„é€ æˆç»“ç‚¹åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œå½“çº¿ç¨‹è¢«ä¸­æ–­æ—¶ä¸ä¼šä»åŒæ­¥é˜Ÿåˆ—ä¸­ç§»é™¤ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt; * â‘ é¦–å…ˆè°ƒç”¨tryAcquireæ–¹æ³•å°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœè·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼Œå°±è¿›è¡Œä¸‹é¢çš„æ“ä½œ
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt; * â‘¡è·å–å¤±è´¥ï¼šæŒ‰ç…§ç‹¬å å¼çš„æ¨¡å¼æ„é€ åŒæ­¥ç»“ç‚¹å¹¶é€šè¿‡addWaiteræ–¹æ³•å°†ç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—çš„å°¾éƒ¨
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt; * â‘¢é€šè¿‡acquireQueueæ–¹æ³•è‡ªæ—‹è·å–åŒæ­¥çŠ¶æ€ã€‚
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt; * â‘£å¦‚æœè·å–ä¸åˆ°åŒæ­¥çŠ¶æ€ï¼Œå°±é˜»å¡ç»“ç‚¹ä¸­çš„çº¿ç¨‹ï¼Œè€Œç»“ç‚¹ä¸­çš„çº¿ç¨‹å”¤é†’ä¸»è¦æ˜¯é€šè¿‡å‰é©±ç»“ç‚¹çš„å‡ºé˜Ÿæˆ–è€…è¢«ä¸­æ–­æ¥å®ç°
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; acquire(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!tryAcquire(arg) &amp;amp;&amp;amp;&lt;span&gt; acquireQueued(addWaiter(Node.EXCLUSIVE), arg))
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;        selfInterrupt();
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Â ã€€ã€€â‘¡ä¸‹é¢æ˜¯addWaiterã€enqå’Œè‡ªæ—‹è·å–åŒæ­¥çŠ¶æ€acquireQueueæ–¹æ³•çš„å®ç°ï¼ˆè¯¥æ–¹æ³•çš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†è·å–åŒæ­¥çŠ¶æ€å¤±è´¥çš„çº¿ç¨‹æ„é€ æˆç»“ç‚¹ç„¶åæ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼‰&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;private&lt;/span&gt;&lt;span&gt; Node addWaiter(Node mode) {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;     Node node = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Node(Thread.currentThread(), mode);
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°è¯•ç›´æ¥æ”¾åœ¨é˜Ÿå°¾&lt;/span&gt;
&lt;span&gt; 4&lt;/span&gt;     Node pred = tail; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç›´æ¥è·å–åŒæ­¥å™¨çš„tailç»“ç‚¹&lt;/span&gt;
&lt;span&gt; 5&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (pred != &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) { 
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;         node.prev =&lt;span&gt; pred; 
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt;&lt;span&gt; (compareAndSetTail(pred, node)) {
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;é˜Ÿå°¾ç»“ç‚¹ä¸ä¸ºç©ºé€šè¿‡åŸå­æ“ä½œå°†æ„é€ çš„ç»“ç‚¹ç½®ä¸ºé˜Ÿå°¾ç»“ç‚¹&lt;/span&gt;
&lt;span&gt; 9&lt;/span&gt;             pred.next =&lt;span&gt; node;
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt;&lt;span&gt; node;
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;é‡‡ç”¨è‡ªæ—‹æ–¹å¼ä¿è¯æ„é€ çš„ç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­&lt;/span&gt;
&lt;span&gt;14&lt;/span&gt; &lt;span&gt;    enq(node);
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; node;
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt;private&lt;/span&gt; Node enq(&lt;span&gt;final&lt;/span&gt;&lt;span&gt; Node node) {
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;     &lt;span&gt;for&lt;/span&gt; (;;) { &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ­»å¾ªç¯çŸ¥é“æ·»åŠ æˆåŠŸ&lt;/span&gt;
&lt;span&gt;19&lt;/span&gt;         Node t =&lt;span&gt; tail;
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (t == &lt;span&gt;null&lt;/span&gt;) { &lt;span&gt;//&lt;/span&gt;&lt;span&gt; Must initialize&lt;/span&gt;
&lt;span&gt;21&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (compareAndSetHead(&lt;span&gt;new&lt;/span&gt;&lt;span&gt; Node()))
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;                 tail =&lt;span&gt; head;
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;         } &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt;             node.prev =&lt;span&gt; t;
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;é€šè¿‡CASæ–¹å¼å°†ç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¹‹åæ‰ä¼šè¿”å›ï¼Œå¦åˆ™å°±ä¼šä¸æ–­å°è¯•æ·»åŠ (è¿™æ ·å®é™…ä¸Šå°±æ˜¯åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼ŒæŠŠå‘åŒæ­¥é˜Ÿåˆ—æ·»åŠ Nodeå˜å¾—ä¸²è¡ŒåŒ–äº†)&lt;/span&gt;
&lt;span&gt;26&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt;&lt;span&gt; (compareAndSetTail(t, node)) {
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;                 t.next =&lt;span&gt; node;
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;                 &lt;span&gt;return&lt;/span&gt;&lt;span&gt; t;
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; &lt;span&gt;}    
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;34&lt;/span&gt; &lt;span&gt; *     é€šè¿‡tryAcquire()å’ŒaddWaiter()ï¼Œè¡¨ç¤ºè¯¥çº¿ç¨‹è·å–åŒæ­¥çŠ¶æ€å·²ç»å¤±è´¥ï¼Œè¢«æ”¾å…¥åŒæ­¥        
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt; &lt;span&gt; * é˜Ÿåˆ—å°¾éƒ¨äº†ã€‚çº¿ç¨‹é˜»å¡ç­‰å¾…ç›´åˆ°å…¶ä»–çº¿ç¨‹(å‰é©±ç»“ç‚¹è·å¾—åŒæ­¥è£…å¡«æˆ–è€…è¢«ä¸­æ–­)é‡Šæ”¾åŒæ­¥çŠ¶
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt; &lt;span&gt; * æ€åå”¤é†’è‡ªå·±ï¼Œè‡ªå·±æ‰èƒ½è·å¾—ã€‚
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;38&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; acquireQueued(&lt;span&gt;final&lt;/span&gt; Node node, &lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt;     &lt;span&gt;boolean&lt;/span&gt; failed = &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt;     &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt;         &lt;span&gt;boolean&lt;/span&gt; interrupted = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;çº¿ç¨‹åœ¨æ­»å¾ªç¯çš„æ–¹å¼ä¸­å°è¯•è·å–åŒæ­¥çŠ¶æ€&lt;/span&gt;
&lt;span&gt;43&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt;&lt;span&gt; (;;) {
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt;             &lt;span&gt;final&lt;/span&gt; Node p = node.predecessor(); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å–å‰é©±ç»“ç‚¹
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;åªæœ‰å‰é©±æ¥å¾…æ˜¯å¤´ç»“ç‚¹çš„æ—¶å€™æ‰èƒ½å°è¯•è·å–åŒæ­¥çŠ¶æ€&lt;/span&gt;
&lt;span&gt;46&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (p == head &amp;amp;&amp;amp;&lt;span&gt; tryAcquire(arg)) {
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt;                 setHead(node); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å–åˆ°åŒæ­¥çŠ¶æ€ä¹‹åï¼Œå°±å°†è‡ªå·±è®¾ç½®ä¸ºå¤´ç»“ç‚¹&lt;/span&gt;
&lt;span&gt;48&lt;/span&gt;                 p.next = &lt;span&gt;null&lt;/span&gt;; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å‰é©±ç»“ç‚¹å·²ç»è·å¾—åŒæ­¥çŠ¶æ€å»æ‰§è¡Œè‡ªå·±çš„ç¨‹åºäº†ï¼Œæ‰€ä»¥éœ€è¦é‡Šæ”¾æ‰å ç”¨çš„åŒæ­¥é˜Ÿåˆ—çš„èµ„æºï¼Œç”±JVMå›æ”¶&lt;/span&gt;
&lt;span&gt;49&lt;/span&gt;                 failed = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt;                 &lt;span&gt;return&lt;/span&gt;&lt;span&gt; interrupted;
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¦‚æœè·å–åŒæ­¥çŠ¶æ€å¤±è´¥ï¼Œåº”è¯¥è‡ªæ—‹ç­‰å¾…ç»§ç»­è·å–å¹¶ä¸”æ ¡éªŒè‡ªå·±çš„ä¸­æ–­æ ‡å¿—ä½ä¿¡æ¯&lt;/span&gt;
&lt;span&gt;53&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (shouldParkAfterFailedAcquire(p, node) &amp;amp;&amp;amp;
&lt;span&gt;54&lt;/span&gt; &lt;span&gt;                parkAndCheckInterrupt())
&lt;/span&gt;&lt;span&gt;55&lt;/span&gt;                 interrupted = &lt;span&gt;true&lt;/span&gt;; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¦‚æœè¢«ä¸­æ–­ï¼Œå°±æ”¹å˜è‡ªå·±çš„ä¸­æ–­æ ‡å¿—ä½çŠ¶æ€ä¿¡æ¯&lt;/span&gt;
&lt;span&gt;56&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;57&lt;/span&gt;     } &lt;span&gt;finally&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;58&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt;&lt;span&gt; (failed)
&lt;/span&gt;&lt;span&gt;59&lt;/span&gt; &lt;span&gt;            cancelAcquire(node);
&lt;/span&gt;&lt;span&gt;60&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;61&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€â‘¢ç‹¬å å¼è·å–åŒæ­¥çŠ¶æ€çš„æ•´ä¸ªæµç¨‹&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1368768/201904/1368768-20190413171216527-230259265.png&quot; alt=&quot;&quot; width=&quot;517&quot; height=&quot;327&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€â‘£ç‹¬å å¼åŒæ­¥å™¨çš„é‡Šæ”¾ï¼šreleaseæ–¹æ³•æ‰§è¡Œæ—¶ï¼Œä¼šå”¤é†’å¤´ç»“ç‚¹çš„åç»§ç»“ç‚¹çº¿ç¨‹&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; release(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; (tryRelease(arg)) {
        Node h &lt;/span&gt;= head;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¤´ç»“ç‚¹
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å”¤é†’å¤´ç»“ç‚¹çš„åç»§ç»“ç‚¹çº¿ç¨‹&lt;/span&gt;
        &lt;span&gt;if&lt;/span&gt; (h != &lt;span&gt;null&lt;/span&gt; &amp;amp;&amp;amp; h.waitStatus != 0&lt;span&gt;)
            unparkSuccessor(h);
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
    }
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;3ã€å…±äº«å¼åŒæ­¥çŠ¶æ€çš„è·å–å’Œé‡Šæ”¾Â &lt;/h3&gt;
&lt;p&gt;ã€€ã€€â‘ å…±äº«å¼è·å–å’Œç‹¬å å¼è·å–æœ€ä¸»è¦çš„åŒºåˆ«æ˜¯èƒ½å¦æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–åˆ°åŒæ­¥çŠ¶æ€ã€‚å¦‚å›¾æ‰€ç¤ºç®€æ˜“æè¿°äºŒè€…çš„åŒºåˆ«ï¼ˆå…±äº«å¼è®¿é—®çš„æ—¶å€™ï¼Œå¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹è®¿é—®èµ„æºï¼Œä½†æ˜¯å­˜åœ¨ç‹¬å å¼è®¿é—®çš„æ—¶å€™ï¼ŒåŒä¸€æ—¶åˆ»å…¶ä»–çš„ä¸ç®¡æ˜¯å…±äº«è¿˜æ˜¯ç‹¬å éƒ½ä¼šè¢«é˜»å¡ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1368768/201904/1368768-20190413204947517-1468253875.png&quot; alt=&quot;&quot; width=&quot;529&quot; height=&quot;131&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€&lt;strong&gt;â‘¡å…³äºå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€çš„æ–¹æ³•&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt; * æ­¤æ–¹æ³•æ˜¯å…±äº«æ¨¡å¼ä¸‹çº¿ç¨‹è·å–å…±äº«åŒæ­¥çŠ¶æ€çš„é¡¶å±‚å…¥å£ã€‚å®ƒä¼šå°è¯•å»è·å–åŒæ­¥çŠ¶æ€ï¼Œè·å–æˆåŠŸåˆ™ç›´æ¥è¿”å›ï¼Œ
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt; * è·å–å¤±è´¥åˆ™è¿›å…¥ç­‰å¾…é˜Ÿåˆ—ä¸€ç›´å°è¯•è·å–(æ‰§è¡ŒdoAcquireSharedæ–¹æ³•ä½“ä¸­çš„å†…å®¹)ï¼Œç›´åˆ°è·å–åˆ°èµ„æºä¸ºæ­¢(æ¡ä»¶å°±æ˜¯tryAcquireSharedæ–¹æ³•è¿”å›å€¼å¤§äºç­‰äº0)ï¼Œæ•´ä¸ªè¿‡ç¨‹å¿½ç•¥ä¸­æ–­
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; acquireShared(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (tryAcquireShared(arg) &amp;lt; 0&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;        doAcquireShared(arg);
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;} 
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;10&lt;/span&gt; &lt;span&gt; * &quot;è‡ªæ—‹&quot;å°è¯•è·å–åŒæ­¥çŠ¶æ€
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;12&lt;/span&gt; &lt;span&gt;private&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; doAcquireShared(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;é¦–å…ˆå°†è¯¥çº¿ç¨‹åŒ…æ‹¬çº¿ç¨‹å¼•ç”¨ã€ç­‰å¾…çŠ¶æ€ã€å‰é©±ç»“ç‚¹å’Œåç»§ç»“ç‚¹çš„ä¿¡æ¯å°è£…å°Nodeä¸­ï¼Œç„¶åæ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—é‡Œé¢(ä¸€å…±äº«æ¨¡å¼æ·»åŠ )&lt;/span&gt;
&lt;span&gt;14&lt;/span&gt;     &lt;span&gt;final&lt;/span&gt; Node node =&lt;span&gt; addWaiter(Node.SHARED);
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;     &lt;span&gt;boolean&lt;/span&gt; failed = &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;     &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;         &lt;span&gt;boolean&lt;/span&gt; interrupted = &lt;span&gt;false&lt;/span&gt;; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—&lt;/span&gt;
&lt;span&gt;18&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt;&lt;span&gt; (;;) {
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;             &lt;span&gt;final&lt;/span&gt; Node p = node.predecessor(); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å–å‰é©±ç»“ç‚¹&lt;/span&gt;
&lt;span&gt;20&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (p ==&lt;span&gt; head) {
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt;                 &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰é©±ç»“ç‚¹æ˜¯å¤´ç»“ç‚¹çš„æ—¶å€™å°±ä¼šä»¥å…±äº«çš„æ–¹å¼å»å°è¯•è·å–åŒæ­¥çŠ¶æ€&lt;/span&gt;
&lt;span&gt;22&lt;/span&gt;                 &lt;span&gt;int&lt;/span&gt; r =&lt;span&gt; tryAcquireShared(arg); 
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;                 &lt;span&gt;//&lt;/span&gt;&lt;span&gt;åˆ¤æ–­tryAcquireSharedçš„è¿”å›å€¼&lt;/span&gt;
&lt;span&gt;24&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt; (r &amp;gt;= 0&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;                     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¦‚æœè¿”å›å€¼å¤§äºç­‰äº0ï¼Œè¡¨ç¤ºè·å–åŒæ­¥çŠ¶æ€æˆåŠŸï¼Œå°±ä¿®æ”¹å½“å‰çš„å¤´ç»“ç‚¹å¹¶å°†ä¿¡æ¯ä¼ æ’­éƒ½åç»­çš„ç»“ç‚¹é˜Ÿåˆ—ä¸­&lt;/span&gt;
&lt;span&gt;26&lt;/span&gt; &lt;span&gt;                    setHeadAndPropagate(node, r);
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;                     p.next = &lt;span&gt;null&lt;/span&gt;; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; é‡Šæ”¾æ‰å·²ç»è·å–åˆ°åŒæ­¥çŠ¶æ€çš„å‰é©±ç»“ç‚¹çš„èµ„æº&lt;/span&gt;
&lt;span&gt;28&lt;/span&gt;                     &lt;span&gt;if&lt;/span&gt;&lt;span&gt; (interrupted)
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt;                         selfInterrupt(); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ£€æŸ¥ä¸­æ–­æ ‡å¿—&lt;/span&gt;
&lt;span&gt;30&lt;/span&gt;                     failed = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;                     &lt;span&gt;return&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (shouldParkAfterFailedAcquire(p, node) &amp;amp;&amp;amp;
&lt;span&gt;35&lt;/span&gt; &lt;span&gt;                parkAndCheckInterrupt())
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;                 interrupted = &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt;     } &lt;span&gt;finally&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt;&lt;span&gt; (failed)
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt; &lt;span&gt;            cancelAcquire(node);
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€&lt;strong&gt;æ ¹æ®æºä»£ç æˆ‘ä»¬å¯ä»¥äº†è§£å…±äº«å¼è·å–åŒæ­¥çŠ¶æ€çš„æ•´ä¸ªè¿‡ç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€é¦–å…ˆåŒæ­¥å™¨ä¼šè°ƒç”¨tryAcquireSharedæ–¹æ³•æ¥å°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œç„¶åæ ¹æ®è¿™ä¸ªè¿”å›å€¼æ¥åˆ¤æ–­æ˜¯å¦è·å–åˆ°åŒæ­¥çŠ¶æ€ï¼ˆå½“è¿”å›å€¼å¤§äºç­‰äº0å¯è§†ä¸ºè·å–åˆ°åŒæ­¥çŠ¶æ€ï¼‰ï¼›å¦‚æœç¬¬ä¸€æ¬¡è·å–å¤±è´¥çš„è¯ï¼Œå°±è¿›å…¥'è‡ªæ—‹'çŠ¶æ€ï¼ˆæ‰§è¡ŒdoAcquireSharedæ–¹æ³•ï¼‰ä¸€ç›´å°è¯•å»è·å–åŒæ­¥çŠ¶æ€ï¼›åœ¨è‡ªæ—‹è·å–ä¸­ï¼Œå¦‚æœæ£€æŸ¥åˆ°å½“å‰å‰é©±ç»“ç‚¹æ˜¯å¤´ç»“ç‚¹çš„è¯ï¼Œå°±ä¼šå°è¯•è·å–åŒæ­¥çŠ¶æ€ï¼Œè€Œä¸€æ—¦è·å–æˆåŠŸï¼ˆtryAcquireSharedæ–¹æ³•è¿”å›å€¼å¤§äºç­‰äº0ï¼‰å°±å¯ä»¥ä»è‡ªæ—‹çŠ¶æ€é€€å‡ºã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€å¦å¤–ï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ä¸Šé¢è¯´åˆ°çš„ä¸€ä¸ªå¤„äºç­‰å¾…é˜Ÿåˆ—çš„çº¿ç¨‹è¦æƒ³å¼€å§‹å°è¯•å»è·å–åŒæ­¥çŠ¶æ€ï¼Œéœ€è¦æ»¡è¶³çš„æ¡ä»¶å°±æ˜¯å‰é©±ç»“ç‚¹æ˜¯å¤´ç»“ç‚¹ï¼Œé‚£ä¹ˆå®ƒæœ¬èº«å°±æ˜¯æ•´ä¸ªé˜Ÿåˆ—ä¸­çš„ç¬¬äºŒä¸ªç»“ç‚¹ã€‚å½“å¤´ç»“ç‚¹é‡Šæ”¾æ‰æ‰€æœ‰çš„ä¸´ç•Œèµ„æºä¹‹åï¼Œæˆ‘ä»¬è€ƒè™‘æ¯ä¸ªçº¿ç¨‹è¿è¡Œæ‰€éœ€èµ„æºçš„ä¸åŒæ•°é‡é—®é¢˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1368768/201904/1368768-20190413212110839-1692189423.png&quot; alt=&quot;&quot; width=&quot;708&quot; height=&quot;272&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€â‘¢å…±äº«å¼åŒæ­¥çŠ¶æ€çš„é‡Šæ”¾&lt;/p&gt;
&lt;p&gt;ã€€ã€€å¯¹äºæ”¯æŒå…±äº«å¼çš„åŒæ­¥ç»„ä»¶(å³å¤šä¸ªçº¿ç¨‹åŒåŒæ—¶è®¿é—®)ï¼Œå®ƒä»¬å’Œç‹¬å å¼çš„ä¸»è¦åŒºåˆ«å°±æ˜¯tryReleaseSharedæ–¹æ³•å¿…é¡»ç¡®ä¿åŒæ­¥çŠ¶æ€çš„é‡Šæ”¾æ˜¯çº¿ç¨‹å®‰å…¨çš„(CASçš„æ¨¡å¼æ¥é‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œå› ä¸ºæ—¢ç„¶æ˜¯å¤šä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®ï¼Œé‚£ä¹ˆé‡Šæ”¾çš„æ—¶å€™ä¹Ÿä¼šæ˜¯å¤šä¸ªçº¿ç¨‹çš„ï¼Œå°±éœ€è¦ä¿è¯é‡Šæ”¾æ—¶å€™çš„çº¿ç¨‹å®‰å…¨)&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt; * è¯¥æ–¹æ³•æ˜¯å…±äº«æ¨¡å¼ä¸‹çº¿ç¨‹é‡Šæ”¾å…±äº«èµ„æºçš„é¡¶å±‚å…¥å£ã€‚å®ƒä¼šé‡Šæ”¾æŒ‡å®šé‡çš„èµ„æºï¼Œå¦‚æœæˆåŠŸé‡Šæ”¾ä¸”å…è®¸å”¤é†’ç­‰å¾…çº¿ç¨‹ï¼Œå®ƒä¼šå”¤é†’ç­‰å¾…é˜Ÿåˆ—é‡Œçš„å…¶ä»–çº¿ç¨‹æ¥è·å–èµ„æºã€‚
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; releaseShared(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt;&lt;span&gt; (tryReleaseShared(arg)) {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;         doReleaseShared(); &lt;span&gt;//
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ã€€ã€€1ã€å…±äº«å¼é”çš„å®ç°&lt;/p&gt;
&lt;p&gt;ã€€ã€€â‘ ã€è‡ªå®šä¹‰ä¸€ä¸ªåŒæ­¥ç»„ä»¶ï¼Œå¯ä»¥å…è®¸ä¸¤ä¸ªçº¿ç¨‹è®¿é—®ï¼ˆå…±äº«å¼åŒæ­¥ç»„ä»¶ï¼‰ï¼Œè¶…è¿‡ä¸¤ä¸ªçº¿ç¨‹å°±ä¼šè¢«é˜»å¡ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€â‘¡ã€æ—¢ç„¶æ˜¯å…±äº«å¼åŒæ­¥ç»„ä»¶ï¼ŒæŒ‰ç…§å‰é¢æ‰€è¯´çš„ï¼Œç»„ä»¶æœ¬èº«éœ€è¦ä½¿ç”¨AQSæä¾›çš„å…±äº«å¼æ¨¡æ¿æ–¹æ³•acquireSharedç­‰ï¼›ç»„ä»¶çš„å†…éƒ¨ç±»éœ€è¦å®ç°AQSï¼Œå¹¶ä¸”é‡å†™å…³äºå…±äº«å¼è·å–åŒæ­¥çŠ¶æ€çš„æ–¹æ³•(tryAcquireShared()ã€tryReleaseShared()ç­‰å…±äº«æ¨¡å¼ä¸‹çš„æ–¹æ³•)ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€â‘¢ã€æ—¢ç„¶æ˜¯ä¸¤ä¸ªçº¿ç¨‹èƒ½å¤ŸåŒæ—¶è®¿é—®çš„è¯ï¼Œé‚£ä¹ˆçŠ¶æ€æ•°çš„å–å€¼èŒƒå›´å°±æ˜¯0ã€1ã€2äº†ï¼Œæ¯å½“ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°åŒæ­¥çŠ¶æ€çš„æ—¶å€™stateå€¼å‡1ï¼Œåä¹‹å°±ä¼šå¢åŠ 1ï¼›å½“stateå€¼ä¸º0çš„æ—¶å€™å°±ä¼šé˜»å¡å…¶ä»–æƒ³è¦è·å–åŒæ­¥çŠ¶æ€çš„çº¿ç¨‹ã€‚å¯¹äºåŒæ­¥çŠ¶æ€çš„æ›´æ”¹éœ€è¦ä½¿ç”¨CASæ¥è¿›è¡Œä¿è¯åŸå­æ€§ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('6a822a59-1d8c-4d8d-bf75-f5604b09a312')&quot; readability=&quot;33.5&quot;&gt;&lt;img id=&quot;code_img_closed_6a822a59-1d8c-4d8d-bf75-f5604b09a312&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_6a822a59-1d8c-4d8d-bf75-f5604b09a312&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('6a822a59-1d8c-4d8d-bf75-f5604b09a312',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_6a822a59-1d8c-4d8d-bf75-f5604b09a312&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;62&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;package&lt;/span&gt;&lt;span&gt; cn.source.concurrent;
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.concurrent.TimeUnit;
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.concurrent.locks.AbstractQueuedSynchronizer;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.concurrent.locks.Condition;
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.concurrent.locks.Lock;
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; 
&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; TestAQS &lt;span&gt;implements&lt;/span&gt;&lt;span&gt; Lock{
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; 
&lt;span&gt;10&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; Sync sync = &lt;span&gt;new&lt;/span&gt; Sync(2&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;     
&lt;span&gt;12&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; Sync &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; AbstractQueuedSynchronizer {
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;         
&lt;span&gt;14&lt;/span&gt;         Sync(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; num) {
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt;(num &amp;lt;= 0&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;                 &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RuntimeException(&quot;numéœ€è¦å¤§äº0&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt; &lt;span&gt;            setState(num);
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; 
&lt;span&gt;21&lt;/span&gt; &lt;span&gt;        @Override
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;         &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; tryAcquireShared(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;             &lt;span&gt;for&lt;/span&gt;&lt;span&gt;(; ;) {
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt;                 &lt;span&gt;int&lt;/span&gt; currentState =&lt;span&gt; getState();
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;                 &lt;span&gt;int&lt;/span&gt; newState = currentState -&lt;span&gt; arg;
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt;(newState &amp;lt; 0 ||&lt;span&gt; compareAndSetState(currentState, newState)) {
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;                     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; newState;
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt; 
&lt;span&gt;32&lt;/span&gt; &lt;span&gt;        @Override
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;         &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; tryReleaseShared(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt;             &lt;span&gt;for&lt;/span&gt;&lt;span&gt;(; ;) {
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;                 &lt;span&gt;int&lt;/span&gt; currentState =&lt;span&gt; getState();
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;                 &lt;span&gt;int&lt;/span&gt; newState = currentState +&lt;span&gt; arg;
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt;&lt;span&gt;(compareAndSetState(currentState, newState)) {
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt;                     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt;         
&lt;span&gt;43&lt;/span&gt;         
&lt;span&gt;44&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; lock() {
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt;         sync.acquireShared(1&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt; 
&lt;span&gt;50&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; unlock() {
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt;         sync.releaseShared(1&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt; 
&lt;span&gt;55&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;......&lt;/span&gt;
&lt;span&gt;56&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;å…±äº«å¼é”&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('a4a09db9-53ba-4ab9-8dd2-dcdf4211911e')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_a4a09db9-53ba-4ab9-8dd2-dcdf4211911e&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_a4a09db9-53ba-4ab9-8dd2-dcdf4211911e&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('a4a09db9-53ba-4ab9-8dd2-dcdf4211911e',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_a4a09db9-53ba-4ab9-8dd2-dcdf4211911e&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt; * æµ‹è¯•ç»“æœï¼šè¾“å‡ºçš„çº¿ç¨‹åç§°æ˜¯æˆå¯¹çš„ï¼Œä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸¤ä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å–åˆ°é”
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt; *
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;         
&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; TestLockShare {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;    @Test
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; test() {
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;         Lock lock = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; TestAQS();
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;         &lt;span&gt;class&lt;/span&gt; Worker &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; Thread {
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; 
&lt;span&gt;11&lt;/span&gt; &lt;span&gt;            @Override
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;             &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; run() {
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;                 &lt;span&gt;while&lt;/span&gt;(&lt;span&gt;true&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;                    lock.lock();
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;                     &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;                         Thread.sleep(1000&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt;                        System.out.println(Thread.currentThread().getName());
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;                         Thread.sleep(1000&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;                     } &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;                        e.printStackTrace();
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt;                     } &lt;span&gt;finally&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt;                        lock.unlock();
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;             
&lt;span&gt;27&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;         
&lt;span&gt;29&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = 0; i &amp;lt; 8; i++&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt;             Worker worker = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Worker();
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;             worker.setDaemon(&lt;span&gt;true&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; &lt;span&gt;            worker.start();
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;             
&lt;span&gt;34&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = 0; i &amp;lt; 8; i++&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;             &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;                 Thread.sleep(1000&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt;             } &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (InterruptedException e) {
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt;                 &lt;span&gt;//&lt;/span&gt;&lt;span&gt; TODO Auto-generated catch block&lt;/span&gt;
&lt;span&gt;40&lt;/span&gt; &lt;span&gt;                e.printStackTrace();
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt; &lt;span&gt;            System.out.println();
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;å…±äº«å¼é”æµ‹è¯•&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€2ã€ç‹¬å å¼é”çš„å®ç°&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('0dcb2460-0937-4fe5-bd35-c53c1753af4d')&quot; readability=&quot;33.5&quot;&gt;&lt;img id=&quot;code_img_closed_0dcb2460-0937-4fe5-bd35-c53c1753af4d&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_0dcb2460-0937-4fe5-bd35-c53c1753af4d&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('0dcb2460-0937-4fe5-bd35-c53c1753af4d',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_0dcb2460-0937-4fe5-bd35-c53c1753af4d&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;62&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;package&lt;/span&gt;&lt;span&gt; cn.source.concurrent;
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.concurrent.TimeUnit;
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.concurrent.locks.AbstractQueuedSynchronizer;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.concurrent.locks.Condition;
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.concurrent.locks.Lock;
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; 
&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; Mutex &lt;span&gt;implements&lt;/span&gt;&lt;span&gt; Lock{
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; 
&lt;span&gt;10&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; Sync sync = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Sync();
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;     
&lt;span&gt;12&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; Sync &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; AbstractQueuedSynchronizer {
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; 
&lt;span&gt;14&lt;/span&gt;         &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;15&lt;/span&gt; &lt;span&gt;         * å°è¯•è·å–èµ„æºï¼Œç«‹å³è¿”å›ã€‚æˆåŠŸåˆ™è¿”å›trueï¼Œå¦åˆ™falseã€‚
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;          &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;17&lt;/span&gt; &lt;span&gt;        @Override
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;         &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; tryAcquire(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt;(compareAndSetState(0, 1)) {&lt;span&gt;//&lt;/span&gt;&lt;span&gt;stateä¸º0æ‰è®¾ç½®ä¸º1ï¼Œä¸å¯é‡å…¥ï¼&lt;/span&gt;
&lt;span&gt;20&lt;/span&gt;                 setExclusiveOwnerThread(Thread.currentThread());&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹ç‹¬å èµ„æº&lt;/span&gt;
&lt;span&gt;21&lt;/span&gt;                 &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; 
&lt;span&gt;26&lt;/span&gt;         &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;27&lt;/span&gt; &lt;span&gt;         * å°è¯•é‡Šæ”¾èµ„æºï¼Œç«‹å³è¿”å›ã€‚æˆåŠŸåˆ™ä¸ºtrueï¼Œå¦åˆ™falseã€‚
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;          &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;29&lt;/span&gt; &lt;span&gt;        @Override
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt;         &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; tryRelease(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; arg) {
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt;(getState() == 0) { &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ—¢ç„¶æ¥é‡Šæ”¾ï¼Œé‚£è‚¯å®šå°±æ˜¯å·²å æœ‰çŠ¶æ€äº†ã€‚åªæ˜¯ä¸ºäº†ä¿é™©ï¼Œå¤šå±‚åˆ¤æ–­ï¼&lt;/span&gt;
&lt;span&gt;32&lt;/span&gt;                 &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; IllegalMonitorStateException();
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt;             setExclusiveOwnerThread(&lt;span&gt;null&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;             setState(0&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt; 
&lt;span&gt;39&lt;/span&gt; &lt;span&gt;        @Override
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt;         &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; isHeldExclusively() {
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆ¤æ–­æ˜¯å¦é”å®šçŠ¶æ€&lt;/span&gt;
&lt;span&gt;42&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; getState() == 1&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt;         
&lt;span&gt;45&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt;     
&lt;span&gt;47&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; lock() {
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt;         sync.acquire(1&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt; 
&lt;span&gt;52&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; tryLock(&lt;span&gt;long&lt;/span&gt; time, TimeUnit unit) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; InterruptedException {
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; sync.tryAcquire(1&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;55&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;56&lt;/span&gt; 
&lt;span&gt;57&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt;58&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; unlock() {
&lt;/span&gt;&lt;span&gt;59&lt;/span&gt;         sync.release(1&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;60&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;61&lt;/span&gt; 
&lt;span&gt;62&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;ç‹¬å å¼é”&lt;/span&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; onclick=&quot;cnblogs_code_show('88a2b20a-517d-4b35-8415-812aaf709e5d')&quot; readability=&quot;32.5&quot;&gt;&lt;img id=&quot;code_img_closed_88a2b20a-517d-4b35-8415-812aaf709e5d&quot; class=&quot;code_img_closed&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; alt=&quot;&quot;/&gt;&lt;img id=&quot;code_img_opened_88a2b20a-517d-4b35-8415-812aaf709e5d&quot; class=&quot;code_img_opened&quot; onclick=&quot;cnblogs_code_hide('88a2b20a-517d-4b35-8415-812aaf709e5d',event)&quot; src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; alt=&quot;&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_88a2b20a-517d-4b35-8415-812aaf709e5d&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; TestMutex {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;    @Test
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; test() {
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;         Lock lock = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Mutex();
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;         &lt;span&gt;class&lt;/span&gt; Worker &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; Thread {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; 
&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;            @Override
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;             &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; run() {
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;                 &lt;span&gt;while&lt;/span&gt;(&lt;span&gt;true&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;                    lock.lock();
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;                     &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;                         Thread.sleep(1000&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; &lt;span&gt;                        System.out.println(Thread.currentThread().getName());
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;                         Thread.sleep(1000&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;                     } &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;                        e.printStackTrace();
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;                     } &lt;span&gt;finally&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt; &lt;span&gt;                        lock.unlock();
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;             
&lt;span&gt;23&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt;         
&lt;span&gt;25&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = 0; i &amp;lt; 8; i++&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;             Worker worker = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Worker();
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;             worker.setDaemon(&lt;span&gt;true&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; &lt;span&gt;            worker.start();
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt;             
&lt;span&gt;30&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = 0; i &amp;lt; 8; i++&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt;             &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;                 Thread.sleep(1000&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt;             } &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (InterruptedException e) {
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt; &lt;span&gt;                e.printStackTrace();
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt; &lt;span&gt;            System.out.println();
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;ç‹¬å å¼é”æµ‹è¯•&lt;/span&gt;&lt;/div&gt;
</description>
<pubDate>Sat, 13 Apr 2019 14:18:00 +0000</pubDate>
<dc:creator>é£æ²™è¿·äº†çœ¼</dc:creator>
<og:description>ä¸€ã€AQSæ¦‚å¿µ 1ã€é˜Ÿåˆ—åŒæ­¥å™¨æ˜¯ç”¨æ¥æ„å»ºé”æˆ–è€…å…¶ä»–åŒæ­¥ç»„ä»¶çš„åŸºç¡€æ¡†æ¶ï¼Œä½¿ç”¨ä¸€ä¸ªintå‹å˜é‡ä»£è¡¨åŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„é˜Ÿåˆ—æ¥å®Œæˆçº¿ç¨‹çš„æ’é˜Ÿå·¥ä½œã€‚ 2ã€ä¸‹é¢æ˜¯JDK8æ–‡æ¡£ä¸­å¯¹äºAQSçš„éƒ¨åˆ†ä»‹ç» æ€»ç»“æ¥è¯´å°±æ˜¯</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/fsmly/p/10701109.html</dc:identifier>
</item>
<item>
<title>è®¾è®¡æ¨¡å¼ä¹‹å‘½ä»¤æ¨¡å¼(è¡Œä¸ºå‹) - smileNicky</title>
<link>http://www.cnblogs.com/mzq123/p/10703070.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/mzq123/p/10703070.html</guid>
<description>&lt;h3 id=&quot;ä¸€æ¨¡å¼å®šä¹‰&quot;&gt;ä¸€ã€æ¨¡å¼å®šä¹‰&lt;/h3&gt;
&lt;p&gt;å‘½ä»¤æ¨¡å¼(Command Pattern)ï¼šå°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å‘å‡ºè¯·æ±‚çš„è´£ä»»å’Œæ‰§è¡Œè¯·æ±‚çš„è´£ä»»åˆ†ç¦»ï¼Œä¸¤è€…ä¹‹é—´é€šè¿‡å‘½ä»¤å¯¹è±¡è¿›è¡Œæ²Ÿé€šï¼Œæ–¹ä¾¿å°†å‘½ä»¤å¯¹è±¡è¿›è¡Œå‚¨å­˜ã€ä¼ é€’ã€è°ƒç”¨ã€å¢åŠ ä¸ç®¡ç†ã€‚å‘½ä»¤æ¨¡å¼åˆ«åä¸ºåŠ¨ä½œ(Action)æ¨¡å¼æˆ–äº‹åŠ¡(Transaction)æ¨¡å¼ï¼Œå±äºå¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ã€‚&lt;/p&gt;
&lt;h3 id=&quot;äºŒæ¨¡å¼è§’è‰²&quot;&gt;äºŒã€æ¨¡å¼è§’è‰²&lt;/h3&gt;
&lt;p&gt;å‘½ä»¤æ¨¡å¼åŒ…æ‹¬å¦‚ä¸‹è§’è‰²ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Clientï¼šå®¢æˆ·ç±»ï¼Œè´Ÿè´£è°ƒç”¨&lt;/li&gt;
&lt;li&gt;Commandï¼šæŠ½è±¡å‘½ä»¤ç±»ï¼Œå£°æ˜æ‰§è¡Œå‘½ä»¤çš„æ¥å£ï¼Œæ‹¥æœ‰æ‰§è¡Œå‘½ä»¤çš„æŠ½è±¡æ–¹æ³• execute()ã€‚&lt;/li&gt;
&lt;li&gt;ConcreteCommandï¼šå…·ä½“å‘½ä»¤ç±»ï¼Œæ˜¯æŠ½è±¡å‘½ä»¤ç±»çš„å…·ä½“å®ç°ç±»ï¼Œå®ƒæ‹¥æœ‰æ¥æ”¶è€…å¯¹è±¡ï¼Œå¹¶é€šè¿‡è°ƒç”¨æ¥æ”¶è€…çš„åŠŸèƒ½æ¥å®Œæˆå‘½ä»¤è¦æ‰§è¡Œçš„æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;Invokerï¼šè°ƒç”¨è€…ï¼Œè¯·æ±‚çš„å‘é€è€…ï¼Œé€šå¸¸æ‹¥æœ‰å¾ˆå¤šçš„å‘½ä»¤å¯¹è±¡ï¼Œå¹¶é€šè¿‡è®¿é—®å‘½ä»¤å¯¹è±¡æ¥æ‰§è¡Œç›¸å…³è¯·æ±‚ï¼Œå®ƒä¸ç›´æ¥è®¿é—®æ¥æ”¶è€…ã€‚&lt;/li&gt;
&lt;li&gt;Receiverï¼šæ¥æ”¶è€…ï¼Œæ‰§è¡Œå‘½ä»¤åŠŸèƒ½çš„ç›¸å…³æ“ä½œï¼Œæ˜¯å…·ä½“å‘½ä»¤å¯¹è±¡ä¸šåŠ¡çš„çœŸæ­£å®ç°è€…ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;ä¸‰æ¨¡å¼åˆ†æ&quot;&gt;ä¸‰ã€æ¨¡å¼åˆ†æ&lt;/h3&gt;
&lt;p&gt;å‘½ä»¤æ¨¡å¼çš„æœ¬è´¨ï¼šæ˜¯å¯¹å‘½ä»¤è¿›è¡Œå°è£…ï¼Œå°†å‘å‡ºå‘½ä»¤çš„è´£ä»»å’Œæ‰§è¡Œå‘½ä»¤çš„è´£ä»»åˆ†ç¦»ã€‚&lt;/p&gt;
&lt;p&gt;å‘½ä»¤æ¨¡å¼çš„å®é™…æ‰§è¡Œè€…æ˜¯æ¥æ”¶è€…(Receiver)ï¼Œè°ƒç”¨è€…å’Œæ¥æ”¶è€…ä¸¤è€…ä¹‹é—´é€šè¿‡å‘½ä»¤å¯¹è±¡è¿›è¡Œæ²Ÿé€šã€‚&lt;/p&gt;
&lt;p&gt;å‘½ä»¤æ¨¡å¼å…è®¸è¯·æ±‚çš„ä¸€æ–¹å’Œæ¥æ”¶çš„ä¸€æ–¹ç‹¬ç«‹å¼€æ¥ï¼Œä½¿å¾—è¯·æ±‚çš„ä¸€æ–¹ä¸å¿…çŸ¥é“æ¥æ”¶è¯·æ±‚çš„ä¸€æ–¹çš„æ¥å£ï¼Œæ›´ä¸å¿…çŸ¥é“è¯·æ±‚æ˜¯æ€ä¹ˆè¢«æ¥æ”¶ï¼Œä»¥åŠæ“ä½œæ˜¯å¦è¢«æ‰§è¡Œã€ä½•æ—¶è¢«æ‰§è¡Œï¼Œä»¥åŠæ˜¯æ€ä¹ˆè¢«æ‰§è¡Œçš„ã€‚&lt;/p&gt;
&lt;p&gt;å…¸å‹çš„å‘½ä»¤æ¨¡å¼ä»£ç &lt;/p&gt;
&lt;p&gt;æŠ½è±¡å‘½ä»¤ç±»ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public abstract class Command
{
    public abstract void execute();
} 
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å…·ä½“å‘½ä»¤ç±»ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public class ConcreteCommand extends Command
{
    private Receiver receiver;
    public void execute()
    {
        receiver.action();
    }
} 
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è°ƒç”¨è€…Invokerç±»ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public class Invoker
{
    private Command command;
    
    public Invoker(Command command)
    {
        this.command=command;
    }
    
    public void setCommand(Command command)
    {
        this.command=command;
    }
    
    //ä¸šåŠ¡æ–¹æ³•ï¼Œç”¨äºè°ƒç”¨å‘½ä»¤ç±»çš„æ–¹æ³•
    public void call()
    {
        command.execute();
    }
} &lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ¥æ”¶è€…(Receiver)ç±»ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public class Receiver
{
    public void action()
    {
        //å…·ä½“æ“ä½œ
    }
} 
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;å››å…¸å‹ä¾‹å­&quot;&gt;å››ã€å…¸å‹ä¾‹å­&lt;/h3&gt;
&lt;p&gt;ä¾‹å­æ¥è‡ª&lt;a href=&quot;https://baike.baidu.com/item/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/19696449&quot;&gt;ã€Šè®¾è®¡æ¨¡å¼ã€‹&lt;/a&gt;ä¸€ä¹¦&lt;/p&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;ç”µè§†æœºæ˜¯è¯·æ±‚çš„æ¥æ”¶è€…ï¼Œé¥æ§å™¨æ˜¯è¯·æ±‚çš„å‘é€è€…ï¼Œé¥æ§å™¨ä¸Šæœ‰ä¸€äº›æŒ‰é’®ï¼Œä¸åŒçš„æŒ‰é’®å¯¹åº”ç”µè§†æœºçš„ä¸åŒæ“ä½œã€‚æŠ½è±¡å‘½ä»¤è§’è‰²ç”±ä¸€ä¸ªå‘½ä»¤æ¥å£æ¥æ‰®æ¼”ï¼Œæœ‰ä¸‰ä¸ªå…·ä½“çš„å‘½ä»¤ç±»å®ç°äº†æŠ½è±¡å‘½ä»¤æ¥å£ï¼Œè¿™ä¸‰ä¸ªå…·ä½“å‘½ä»¤ç±»åˆ†åˆ«ä»£è¡¨ä¸‰ç§æ“ä½œï¼šæ‰“å¼€ç”µè§†æœºã€å…³é—­ç”µè§†æœºå’Œåˆ‡æ¢é¢‘é“ã€‚æ˜¾ç„¶ï¼Œç”µè§†æœºé¥æ§å™¨å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å‘½ä»¤æ¨¡å¼åº”ç”¨å®ä¾‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æŠ½è±¡å‘½ä»¤ç±»ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public interface AbstractCommand
{
    public void execute();
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å…·ä½“çš„å‘½ä»¤ç±»ï¼š&lt;/p&gt;
&lt;p&gt;æ¢å°&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public class TVChangeCommand implements AbstractCommand
{
    private Television tv;
    public TVChangeCommand()
    {
        tv = new Television();
    }
    public void execute()
    {
        tv.changeChannel();
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å…³æœº&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public class TVCloseCommand implements AbstractCommand
{
    private Television tv;
    public TVCloseCommand()
    {
        tv = new Television();
    }
    public void execute()
    {
        tv.close();
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¼€æœº&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public class TVOpenCommand implements AbstractCommand
{
    private Television tv;
    public TVOpenCommand()
    {
        tv = new Television();
    }
    public void execute()
    {
        tv.open();
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ¥æ”¶è€…Receiverç±»ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public class Television
{
    public void open()
    {
        System.out.println(&quot;æ‰“å¼€ç”µè§†æœºï¼&quot;);
    }
    
    public void close()
    {
        System.out.println(&quot;å…³é—­ç”µè§†æœºï¼&quot;);       
    }
    
    public void changeChannel()
    {
        System.out.println(&quot;åˆ‡æ¢ç”µè§†é¢‘é“ï¼&quot;);
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è°ƒç”¨è€…(Invoker)ç±»&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public class Controller
{
    private AbstractCommand openCommand,closeCommand,changeCommand;
    
    public Controller(AbstractCommand openCommand,AbstractCommand closeCommand,AbstractCommand changeCommand)
    {
        this.openCommand=openCommand;
        this.closeCommand=closeCommand;
        this.changeCommand=changeCommand;
    }
    
    public void open()
    {
        openCommand.execute();
    }
    
    public void change()
    {
        changeCommand.execute();
    }   

    public void close()
    {
         closeCommand.execute();    
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;äº”é€‚ç”¨åœºæ™¯&quot;&gt;äº”ã€é€‚ç”¨åœºæ™¯&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;ç³»ç»Ÿéœ€è¦æ”¯æŒå‘½ä»¤çš„æ’¤é”€(Undo)æ“ä½œå’Œæ¢å¤(Redo)æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿéœ€è¦å°†ä¸€ç»„æ“ä½œç»„åˆåœ¨ä¸€èµ·ï¼Œå³æ”¯æŒå®å‘½ä»¤ã€‚&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿéœ€è¦åœ¨ä¸åŒçš„æ—¶é—´æŒ‡å®šè¯·æ±‚ã€å°†è¯·æ±‚æ’é˜Ÿå’Œæ‰§è¡Œè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿéœ€è¦å°†è¯·æ±‚è°ƒç”¨è€…å’Œè¯·æ±‚æ¥æ”¶è€…è§£è€¦ï¼Œä½¿å¾—è°ƒç”¨è€…å’Œæ¥æ”¶è€…ä¸ç›´æ¥äº¤äº’ã€‚&lt;/li&gt;
&lt;/ul&gt;</description>
<pubDate>Sat, 13 Apr 2019 13:44:00 +0000</pubDate>
<dc:creator>smileNicky</dc:creator>
<og:description>[TOC] ä¸€ã€æ¨¡å¼å®šä¹‰ å‘½ä»¤æ¨¡å¼(Command Pattern)ï¼šå°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å‘å‡ºè¯·æ±‚çš„è´£ä»»å’Œæ‰§è¡Œè¯·æ±‚çš„è´£ä»»åˆ†ç¦»ï¼Œä¸¤è€…ä¹‹é—´é€šè¿‡å‘½ä»¤å¯¹è±¡è¿›è¡Œæ²Ÿé€šï¼Œæ–¹ä¾¿å°†å‘½ä»¤å¯¹è±¡è¿›è¡Œå‚¨å­˜ã€ä¼ é€’ã€è°ƒç”¨ã€</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/mzq123/p/10703070.html</dc:identifier>
</item>
<item>
<title>ä½ å¯ä»¥ä¸å¤Ÿèªæ˜ï¼Œä½†ä¸èƒ½æ²¡æœ‰çƒ­çˆ± - ç¾ç å¸ˆ</title>
<link>http://www.cnblogs.com/littleatp/p/10703011.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/littleatp/p/10703011.html</guid>
<description>&lt;h2 id=&quot;è€å…µçš„åå¹´èŒåœºä¹‹è·¯ä¸‰&quot;&gt;è€å…µçš„åå¹´èŒåœºä¹‹è·¯(ä¸‰)&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å‰æ–‡å†ç»­&lt;/strong&gt;&lt;br/&gt;&lt;a href=&quot;https://www.cnblogs.com/littleatp/p/10587932.html&quot;&gt;è€å…µçš„åå¹´èŒåœºä¹‹è·¯(ä¸€)&lt;/a&gt;&lt;br/&gt;&lt;a href=&quot;https://www.cnblogs.com/littleatp/p/10645408.html&quot;&gt;è€å…µçš„åå¹´èŒåœºä¹‹è·¯(äºŒ)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å‰é¢çš„æ–‡ç« é‡Œï¼Œå¦‚æœè¯´ç¬¬äºŒæ®µç»å†æ˜¯æˆ‘çš„å°é«˜å³°ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘è§‰å¾—ç®—æ˜¯ä¸€æ®µå¹³å³°æœŸå§ã€‚è‡³å°‘åœ¨æŠ€æœ¯æˆé•¿ä¸Šé¢æ˜¯å¦‚æ­¤ï¼Œè€Œè´¢å¯Œç§¯ç´¯æ›´æ˜¯è¿›å…¥äº†é»¯æ·¡æœŸã€‚&lt;br/&gt;æœ‰ä¸ªè¯è¯´çš„å¥½ï¼Œ&lt;strong&gt;é‡å¼ºåˆ™å¼º&lt;/strong&gt;ï¼Œå½“ä½ æ‰€åœ¨çš„ç¯å¢ƒè®©ä½ æ„Ÿåˆ°ä¸é€‚çš„æ—¶å€™ï¼Œå¯èƒ½å°±æ˜¯ä½ æˆé•¿çš„æ—¶å€™ï¼Œå½“ç„¶ä¹Ÿå¯èƒ½å¹¶ä¸æ˜¯ã€‚ä½†å¦‚æœä½ èº«è¾¹éƒ½æ˜¯æ¯”ä½ ç‰›çš„äººæ—¶ï¼Œä½ ä¸€å®šä¼šæœ‰å¾ˆå¤šæå‡çš„æœºä¼šã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å¼€å§‹åˆ›ä¸šä¹‹åï¼Œæˆ‘æ„Ÿå—åˆ°äº†å‰æ‰€æœªæœ‰çš„è‡ªç”±ï¼Œä¸Šç­ä¸æ‰“å¡ï¼Œç”¨ä»€ä¹ˆæŠ€æœ¯ä¹Ÿéƒ½æ˜¯è‡ªå·±è¯´äº†ç®—ï¼Œäº§å“å‘¢ï¼Œä¹Ÿéƒ½ä¼šè‡ªå·±å»åšäº›ç ”ç©¶ã€‚æ‰€æœ‰çš„ä¸€åˆ‡å…¨å‡­ç€å…´è¶£å’Œçƒ­å¿±åœ¨æ”¯æ’‘ç€ã€‚&lt;br/&gt;è‡³äºåœ¨æˆ‘åæ¥åšè‡ªæˆ‘æ£€è®¨çš„æ—¶å€™è§‰å¾—ï¼Œå¯¹äºåˆ›ä¸šæ¥è¯´è¿™è¿˜æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œæœ‰å¤ªå¤šçš„ä¸œè¥¿ä¼šè®©è¿™äº›æ¶ˆå¤±æ®†å°½äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/242916/201904/242916-20190413212715098-982088589.png&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;åˆ›ä¸šå›¢é˜Ÿ&quot;&gt;åˆ›ä¸šå›¢é˜Ÿ&lt;/h2&gt;
&lt;p&gt;ä¸€ä¸ªæœºç¼˜å·§åˆï¼Œå‡ ä½åŒäº‹è·Ÿæˆ‘ç»„æˆäº†ä¸€ä¸ªå¼€å‘å›¢é˜Ÿï¼Œä¸»è¦æƒ³åšçš„æ˜¯ä¸€æ¬¾å¼€æ”¾å¼çš„é¡¹ç›®ç®¡ç†å¹³å°ï¼Œå›¢é˜Ÿé‡Œæœ‰ä¸€ä¸ªå‰ç«¯åŠ ä¸¤ä¸ªåç«¯ç¨‹åºå‘˜ï¼Œå½“ç„¶æˆ‘æ˜¯åç«¯ä¹‹ä¸€ï¼Œå¹¶ä¸”ä¸»è¦è´Ÿè´£äº†é¡¹ç›®çš„å¼€å‘æ¡†æ¶æ­å»ºåŠæŠ€æœ¯æŠŠæ§ã€‚ä¹Ÿæ˜¯å› ä¸ºæ˜¯åˆæ¬¡åˆ›ä¸šå§ï¼ŒåŸºæœ¬ä¸Šå¤§å®¶éƒ½æ˜¯å¯è¶³äº†åŠ²ï¼Œæƒ³ç€æ€ä¹ˆæ›´å¿«çš„æŠŠäº§å“ç»™åšå‡ºæ¥ã€‚å½“æ—¶ä¹Ÿæ²¡æœ‰æ‰€è°“çš„ 996åˆ¶åº¦ä¹‹è¯´ï¼Œå› ä¸ºåŸºæœ¬ä¸Šé™¤äº†åƒé¥­ç¡è§‰å°±æ˜¯å†™ä»£ç äº†ï¼Œæ—¶é—´å˜å¾—å¾ˆä¸è§„å¾‹ã€‚ç„¶åå°±æ˜¯é¡¹ç›®ä¸­å‡ºäº†ä¸å°‘çš„é—®é¢˜ï¼Œæ¯”å¦‚äº§å“å®šä¹‰ä¸æ¸…æ™°ï¼ŒæŠ€æœ¯é€‰å‹åŠå®ç°ä¸Šäº§ç”Ÿä¸€äº›äº‰æ‰§ç­‰ç­‰ï¼Œè¿™äº›é—®é¢˜éƒ½&lt;strong&gt;ä½“ç°äº†ä½œä¸ºåˆåˆ›å›¢é˜Ÿçš„å„ç§ä¸æˆç†Ÿ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œæœ€ä¸ºå…³é”®çš„å¯èƒ½è¿˜æ˜¯å›¢é˜Ÿå¯¹å¸‚åœºçš„ç¼ºä¹æ€è€ƒï¼Œæ€»å¸Œæœ›åšä¸€ä¸ªå¤§è€Œå…¨çš„ä¸œè¥¿ï¼Œå› æ­¤æ²¡è¿‡å¤šä¹…ï¼Œè¿™ä¸ªé¡¹ç›®å°±å¤­æŠ˜äº†ã€‚&lt;br/&gt;ä¸æ­¤åŒæ—¶ï¼Œä¸€ä½æœ‹å‹çš„å…¬å¸æ‰¾åˆ°æˆ‘ä»¬ï¼Œå¸Œæœ›å¸®ä»–ä»¬å®Œæˆä¸€ä¸ªç§»åŠ¨å¤–åŒ…é¡¹ç›®ï¼Œè¿™æ—¶å€™ï¼Œä¸ºäº†èƒ½ç»§ç»­ä¸‹å»ï¼Œæˆ‘ä»¬å°±å¼€å§‹äº†ä¸€è¾¹å¤–åŒ…ï¼Œè€Œå¦ä¸€è¾¹åˆ™åšè‡ªä¸»äº§å“çš„æ—¥å­ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ‘¸çˆ¬æ»šæ‰“&quot;&gt;æ‘¸çˆ¬æ»šæ‰“&lt;/h2&gt;
&lt;p&gt;æ¥ä¸‹æ¥çš„ä¸€æ®µæ—¥å­é‡Œï¼Œå›¢é˜Ÿè¿‡çš„éå¸¸çš„è¾›è‹¦ï¼Œå¦‚æœè¦ç”¨æœ€åˆé€‚çš„è¯æ¥å½¢å®¹çš„è¯ï¼Œæˆ‘åªæƒ³åˆ°äº†&lt;strong&gt;æ‘¸çˆ¬æ»šæ‰“è¿™å››ä¸ªå­—&lt;/strong&gt;ã€‚å› ä¸ºä¸€æ—¦è¿›å…¥å¤–åŒ…çš„èŠ‚å¥ä¹‹åï¼Œå›¢é˜Ÿå‡ ä¹è¿ˆå…¥äº†ä¸€ä¸ªæŒç»­çš„æ¶æ€§å¾ªç¯ä¸­ï¼Œä¸ºäº†å…»æ´»å›¢é˜Ÿå°±å¾—ä¸åœçš„æ¥å•ï¼Œä¸ºäº†å®Œæˆè¿™äº›é¡¹ç›®ä½ å‡ ä¹å°±æ²¡æœ‰æ—¶é—´ç²¾åŠ›èƒ½è¿›è¡Œè‡ªä¸»äº§å“çš„å¼€å‘ã€‚&lt;br/&gt;å°½ç®¡æœ‰äº›é¡¹ç›®çœ‹ç€å¾ˆå¤§ï¼Œä½†å…¶å®æ˜¯å¤šæ‰‹è½¬åŒ…ï¼Œåœ¨æ”¯ä»˜å‘¨æœŸä¸Šå¾ˆå®¹æ˜“å°±æŠŠä½ æ‹–æ­»ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å¾®è¥é”€çš„é£&quot;&gt;å¾®è¥é”€çš„é£&lt;/h3&gt;
&lt;p&gt;ç„¶åæ˜¯å¤§çº¦åœ¨2013å¹´çš„æ—¶å€™ï¼Œå¾®ä¿¡è¥é”€ä¸€åº¦æˆäº†ç‚™æ‰‹å¯çƒ­çš„é£å£çƒ­ç‚¹ï¼ŒåŸºäºå¾®ä¿¡å…¬ä¼—å·å¼€æ”¾å¹³å°æ‰“é€ çš„å„ç§è¥é”€å¹³å°ä¹Ÿéåœ°å¼€èŠ±äº†ã€‚é‚£æ—¶å€™è§‰å¾—è¿™å—å¯èƒ½æ˜¯ä¸ªçªç ´å£ï¼Œäºæ˜¯ä¹Ÿåšäº†ä¸€ä¸ªå¾®è¥é”€çš„äº§å“ï¼Œç„¶åè¿™ä¹Ÿæˆäº†ä¸€æ¬¡å¤±è´¥çš„å°è¯•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/242916/201904/242916-20190413212756867-74325491.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æœ¬è´¨ä¸Šè¿™ç±»äº§å“çš„æŠ€æœ¯é—¨æ§›å¹¶ä¸é«˜ï¼Œä¸ä¼šæ¶‰åŠä»€ä¹ˆé«˜å¹¶å‘é«˜æ€§èƒ½çš„ä¸€äº›é—®é¢˜ï¼Œè€Œæ•´ä¸ªåç«¯åŸºæœ¬ä¸Šæ˜¯åŸºäºå¾®ä¿¡çš„å¼€æ”¾æ¥å£æ¥å®ç°å°±å¥½ï¼Œäº§å“ä¸Šå”¯ä¸€èƒ½äº§ç”Ÿä¸€äº›è¯†åˆ«åº¦çš„éƒ½æ˜¯ä¸€äº›å‰ç«¯å’ŒUIä¸Šçš„äº‹æƒ…ã€‚å¾ˆå¯æƒœçš„æ˜¯ï¼Œåæ¥å‘ç°å°±æ˜¯å„å®¶çš„å¾®ä¿¡è¥é”€å¹³å°çš„åŠŸèƒ½å’Œç•Œé¢éƒ½æ˜¯&lt;strong&gt;æˆ‘æŠ„ä½ ï¼Œä½ æŠ„æˆ‘&lt;/strong&gt;ï¼Œå¾ˆéš¾åŒºåˆ†ã€‚&lt;br/&gt;æ—¢ç„¶æŠ€æœ¯ä¸Šä¸èƒ½äº§ç”ŸåŒºåˆ†ï¼Œé‚£ä¹ˆè¿™ç±»äº§å“å°±åªèƒ½çœ‹æ€ä¹ˆåšå¥½æ¨å¹¿å’Œèµ„æºæ•´åˆäº†ã€‚&lt;/p&gt;
&lt;p&gt;æœ€ä»¤äººå°è±¡æ·±åˆ»çš„æ˜¯æœ‰ä¸€æ¬¡ç»™ä¸€å®¶é¤å…åšå¾®ä¿¡ç‚¹é¤çš„åŠŸèƒ½åï¼Œæˆ‘ä»¬ä¸€ä¼™äººè·‘åˆ°äº†äººå®¶å¨æˆ¿é‡Œæ‹äº†å¾ˆå¤šç…§ç‰‡ï¼Œç„¶åç»™æ¯ä¸ªé¤æ¡Œä¸Šéƒ½è´´ä¸Šäº†äºŒç»´ç ã€‚&lt;br/&gt;è€Œä¸”ï¼Œ&lt;strong&gt;æ¯æ¬¡éƒ½èƒ½å…è´¹åƒä¸Šå¨å¸ˆçš„è‡ªåˆ›ç”œç‚¹&lt;/strong&gt;â€¦&lt;/p&gt;
&lt;p&gt;å¦‚æœé‚£ä¼šèƒ½ç¢°ä¸Šé è°±çš„æ¨å¹¿åˆä½œä¼™ä¼´å…´è®¸è¿˜èƒ½èµšç‚¹é’±ï¼Œä½†æˆ‘ä»¬çš„è¿æ°”å¹¶ä¸å¤§å¥½ï¼Œåœ¨äº§å“å¼€å‘å‡ºæ¥ååªæœ‰å¯¥å¯¥å¯æ•°çš„å®¢æˆ·ã€‚&lt;br/&gt;è€Œå°½ç®¡å¾®ä¿¡è¥é”€å¾ˆç«ï¼Œä½†å¸‚é¢ä¸Šå´å¾ˆå°‘æœ‰æ­¤ç±»äº§å“æˆåŠŸèèµ„çš„æ¶ˆæ¯ï¼Œå”¯ä¸€æœ‰ä¸€ä¸ªè¢«è®¤ä¸ºæ˜¯å¾®è¥é”€é¢†åŸŸä½¼ä½¼è€…çš„äº§å“èäº†100Wï¼Œç›¸ä¿¡è¿™ä¹Ÿè®©è®¸å¤šäººçš„å¿ƒéƒ½å‡‰äº†ä¸€æˆªï¼Œç›¸æ¯”åŒæ—¶æœŸçš„ä¸€äº›ç§»åŠ¨äº’è”ç½‘äº§å“ï¼Œè¿™ç§å¹³å°å´å¦‚æ­¤çš„ä¸å€¼é’±ã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;è¿™æ°å¦‚é™ˆçš“(å·¦è€³æœµè€—å­)çš„åšå®¢é‡Œæ‰€è¯´çš„ï¼ŒæŠ€æœ¯ä¸€å®šè¦å…³æ³¨ä»·å€¼ç‚¹ï¼Œå¦‚æœéƒ½æ˜¯ä¼ªé€ å‡ºæ¥çš„éœ€æ±‚ï¼ŒåŠ ä¸Šæ»¡å¤§è¡—éƒ½ä¸€æ ·çš„ä¸œè¥¿ï¼Œé‚£å¯èƒ½å°±æ˜¯ä¾›å¤§äºæ±‚ï¼Œä½ çš„åŠªåŠ›å°±å¾ˆéš¾è·å¾—å›æŠ¥ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;å¾®ä¿¡è¥é”€æœ‰å¤šä¹ˆç«&lt;/strong&gt;&lt;br/&gt;æœ‰ä¸€æ¬¡ï¼Œé‚»å±…çš„ä¸€ä½é˜¿å©†é—®æˆ‘å·¥ä½œåœ¨åšä»€ä¹ˆï¼Œæˆ‘æƒ³äº†ä¸€ä¼šï¼Œå°±è¯´æˆ‘çš„å›¢é˜Ÿæœ€è¿‘åœ¨åšè·Ÿæ‰‹æœºå¾®ä¿¡ç›¸å…³çš„ç³»ç»Ÿã€‚&lt;br/&gt;é˜¿å©†ç«‹åˆ»å°±è¯´ï¼Œ&lt;strong&gt;â€œä½ ä»¬æ˜¯ä¸æ˜¯åšå¾®ä¿¡è¥é”€ï¼Œå‰æ®µæ—¶é—´æœè£…å¸‚åœºå°±æœ‰ä¸€ä¸ªå›¢é˜Ÿåœ¨æå¾®ä¿¡è¥é”€å‘¢ï¼Œåªæ˜¯åšäº†ä¸¤ä¸ªæ˜ŸæœŸäººå°±éƒ½æ•£äº†â€¦â€&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é‚£ä¸€åˆ»æˆ‘ç«Ÿç„¶æ— è¨€ä»¥å¯¹ï¼Œçœ‹å§ï¼Œè¿è€äººå®¶éƒ½çŸ¥é“å¾®ä¿¡è¥é”€äº†ï¼Œç¡®å®æ˜¯çƒ‚å¤§è¡—äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¾®è¥é”€çš„ç»å†è®©äººå¾ˆéš¾å¿˜ï¼Œè€Œè¿™äº›æ´»ä¸‹æ¥çš„äº§å“æ¼”åŒ–å‡ºäº†å„ç§èŠ±æ ·ï¼Œå°±åŒ…æ‹¬é‚£äº›åŸºäºä½ç½®çš„ç²¾å‡†è¥é”€ï¼Œå¾®ä¿¡æœºå™¨äººç­‰ç­‰ã€‚&lt;br/&gt;ç°åœ¨è¿™äº›æ—¶ä¸æ—¶ä¼šçªç„¶åŠ ä½ å¾®ä¿¡çš„ç¾å¥³å¤´åƒå¤§éƒ¨åˆ†éƒ½æ˜¯å‡ºè‡ªäºè¥é”€ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;h3 id=&quot;åšä¸å°½çš„å¤–åŒ…&quot;&gt;åšä¸å°½çš„å¤–åŒ…&lt;/h3&gt;
&lt;p&gt;å¤–åŒ…æ˜¯æ•´ä¸ªå›¢é˜Ÿçš„æ”¶å…¥æ¥æºï¼Œåœ¨å¾®è¥é”€äº§å“æ²‰å¯‚äº†ä¹‹åï¼ŒåŸºæœ¬ä¸Šæˆ‘ä»¬éƒ½åœ¨æ¥ä¸€äº›å•å­è¿‡æ´»ã€‚åœ¨è¿™ä¸ªæœŸé—´å¤§å¤§å°å°çš„é¡¹ç›®æ¥è§¦äº†è®¸å¤šï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‹é¢å‡ ç±»ï¼š&lt;/p&gt;
&lt;ul readability=&quot;4.5&quot;&gt;&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;ä¼ä¸šé¡¹ç›®ï¼Œè¿™ç±»é¡¹ç›®çš„é—¨æ§›æœ€é«˜ï¼Œä¹Ÿå°±æ˜¯æ‹¿åˆ°é¡¹ç›®çš„æ¡ä»¶éå¸¸è‹›åˆ»ã€‚å¾€å¾€å°å›¢é˜Ÿæ‹¿åˆ°çš„éƒ½æ˜¯ä¸€äº›æ¨¡å—çº§çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯åº•å±‚æ¡†æ¶æˆ–æ˜¯å¹³å°æ¥å£éƒ½å·²ç»åšå¥½äº†ï¼Œåªæœ‰ä¸€äº›å‰ç«¯æˆ–æ˜¯APPä¼šäº¤ç»™å¤–é¢çš„å›¢é˜Ÿã€‚è€Œä¸€èˆ¬æƒ…å†µä¸‹ä¼ä¸šå¯¹äºé¡¹ç›®è´¨é‡ï¼Œè¿›åº¦çš„å®¡æŸ¥æ–¹é¢ä¼šæŠŠæ§å¾—å¾ˆä¸¥æ ¼ï¼Œç»å¸¸éœ€è¦äººå‘˜é©»åœºï¼Œè¿™æ ·å¯¹äºåˆ›ä¸šäººå‘˜çš„èµ„æºæ¶ˆè€—éå¸¸çš„å¤§ã€‚æœ‰æ—¶å€™ä½ å‡­ç€èƒ½åŠ›æå‰å®Œæˆäº†ä»»åŠ¡è¿˜ä¸èƒ½èµ°ï¼Œä¼ä¸šçš„å¤–åŒ…è´Ÿè´£äººä¼šè¦æ±‚ä½ ä¸€å®šè¦åœ¨åŠå…¬å®¤å‘†ç€ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¼ä¸šé¡¹ç›®è½¬åŒ…çš„è¯åœ¨å›æ¬¾ä¸Šéƒ½å¾ˆæ‹–æ²“ï¼Œè¿™ä»¤å›¢é˜Ÿéå¸¸çš„éš¾å—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;æ”¿åºœé¡¹ç›®ï¼Œç›¸æ¯”ä¼ä¸šçº§çš„é¡¹ç›®æ¥è¯´ï¼Œè¿™ç±»é¡¹ç›®éš¾åº¦éƒ½è¾ƒå°ï¼Œæ¯”è¾ƒå¤šçš„æ˜¯ä¸€äº›ä¼ ç»Ÿå‹çš„ç³»ç»Ÿï¼Œæ¯”å¦‚ä¿¡æ¯ç½‘ç«™ï¼Œå…¬ä¼—å·æ±‚åŠ©ç³»ç»Ÿç­‰ç­‰ã€‚ä½†æ˜¯è·å¾—è¿™ç±»é¡¹ç›®æœºä¼šéœ€è¦å€ŸåŠ©ä¸€äº›èµ„æºï¼Œåœ¨å®¡æŸ¥æ–¹é¢çš„å·¥ä½œä¹Ÿå¾—åšåˆ°ä½äº†ã€‚å¾ˆå¤šé¡¹ç›®æ˜¯ä»¥æ‹›æ ‡çš„å½¢å¼è¿›è¡Œçš„ï¼Œä¸ºäº†è·å¾—èµ„è´¨å¾€å¾€è¿˜å¾—æ‰¾ä¸€äº›åŒè¡Œè¿›è¡ŒæŠ±å›¢ã€‚å½“æ—¶æ‰€æ¥è§¦åˆ°çš„å‡ ä¸ªé¡¹ç›®é¢åº¦éƒ½ä¸å¤§ï¼Œé™¤äº†æµç¨‹æ¯”è¾ƒæ…¢ä¹‹å¤–ï¼Œå…¶ä»–æ–¹é¢éƒ½è¿˜æ¯”è¾ƒé¡ºåˆ©ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;åˆ›ä¸šé¡¹ç›®ï¼Œè¿™ç±»çš„é¡¹ç›®æœ€å¤šï¼Œä½†ä¹Ÿæ˜¯&lt;strong&gt;é£é™©æœ€é«˜&lt;/strong&gt;çš„ã€‚åœ¨ç§»åŠ¨äº’è”ç½‘åˆ›ä¸šçƒ­æ½®ä¸­ï¼Œæœ‰&lt;strong&gt;å¤ªå¤šçš„äººå¸Œæœ›è‡ªå·±èƒ½ç¼”é€ ç¥è¯&lt;/strong&gt;äº†ã€‚è€Œå®¢æˆ·é‡Œé¢æœ‰è®¸å¤šæ¥è‡ªäºä¼ ç»Ÿä¼ä¸šï¼Œä¹Ÿæ˜¯å› ä¸ºå¦‚æ­¤ï¼Œå®¢æˆ·å¯¹äºäº’è”ç½‘çš„è®¤è¯†éƒ½å¾ˆæµ…ï¼Œæçš„è®¸å¤šéœ€æ±‚ç‚¹å­éƒ½æ¥è‡ªäºä¸€äº›ç«çˆ†çš„äº§å“ï¼Œè¿™å¯ä»¥ç”¨ä¸€ä¸ªè¯æ¥æè¿°å°±æ˜¯ï¼š&lt;strong&gt;æ··æ­ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;å°±æ¯”å¦‚ï¼Œå¸Œæœ›åšä¸€ä¸ªç†Ÿäººç¤¾äº¤çš„äº§å“ï¼Œå¸Œæœ›èƒ½æ­ä¸Šæ”¯ä»˜å®çš„è´·æ¬¾åŠŸèƒ½ï¼Œä¸€ä¸ªå•†åŸAPPé‡Œé¢è¦åŠ ä¸ªæœ‹å‹åœˆï¼Œè¿˜æœ‰åœ°å›¾å¯¼èˆªâ€¦&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/242916/201904/242916-20190413212947069-616443089.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç”Ÿå­˜ï¼Œæ‰€ä»¥è®¸å¤šé¡¹ç›®éƒ½ä¼šå…ˆæ¥ä¸‹æ¥ï¼Œå°¤å…¶æ˜¯åˆ›ä¸šç±»çš„é¡¹ç›®åšäº†å¾ˆå¤šï¼ŒåŸºæœ¬ä¸Šè¿™ç±»ç³»ç»Ÿçš„æ¶æ„éƒ½å¾ˆç®€å•ï¼ŒåŸºæœ¬ä¸Šæ˜¯å®‰å“APPä¸€ä¸ªã€è‹¹æœAPPä¸€ä¸ª ï¼Œåç«¯æŒ‚ä¸€ä¸ªJava Web Server å°±å¯ä»¥äº†ã€‚è®¸å¤šåŸºç¡€ç»„ä»¶ä¹Ÿéƒ½å¯ä»¥ä½¿ç”¨äº‘ä¸Šçš„æœåŠ¡ï¼Œæ¯”å¦‚æå…‰æ¨é€ï¼Œå‹ç›Ÿç­‰ï¼Œè¿™æ ·å¼€å‘éš¾åº¦å¤§å¤§é™ä½äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä½†å°½ç®¡å¦‚æ­¤ï¼Œå› ä¸ºåŒæ—¶è¿›è¡Œçš„é¡¹ç›®å¤ªå¤šï¼Œå¼€å‘å›¢é˜Ÿæ€»æ˜¯&lt;strong&gt;è´Ÿé‡ç´¯ç´¯&lt;/strong&gt;ï¼Œæœ€é«˜å³°çš„æ—¶å€™åŒæ—¶å¯åŠ¨äº†8ä¸ªé¡¹ç›®ï¼Œè€Œå¼€å‘äººå‘˜å´ä¸è¶³20äººï¼Œè€Œä¸”å›¢é˜Ÿé‡Œé¢æœ‰å¤§é‡éœ€è¦åŸ¹å…»çš„åº”å±Šç”Ÿï¼Œè¿™æ ·ä¸€æ¥è´¨é‡å’Œè¿›åº¦éƒ½æ²¡åŠæ³•ä¿è¯äº†ã€‚åœ¨è¿™ç§çŠ¶å†µä¸‹äººå‘˜æµåŠ¨ä¹Ÿéå¸¸çš„é¢‘ç¹ï¼Œè®¸å¤šäººå¹²äº†ä¸¤ä¸‰ä¸ªé¡¹ç›®å°±è¦æç¦»èŒäº†ï¼Œå°½ç®¡å›¢é˜Ÿä¸­ä¹Ÿæœ‰ä¸€äº›æ¯”è¾ƒå¥½çš„è‹—å­ï¼Œä½†å§‹ç»ˆè¿˜æ˜¯æ²¡èƒ½ç•™ä½ã€‚&lt;br/&gt;è¿™é‡Œæåˆ°äº†å‹åŠ›ï¼Œäººå‘˜æµåŠ¨ï¼Œå…¶ä¸­çš„æ ¹æºè¿˜æ˜¯æ¥è‡ª&lt;strong&gt;æˆæœ¬æ¨¡å¼çš„é—®é¢˜&lt;/strong&gt;ã€‚ä»å½“æ—¶çš„å¤–åŒ…å¸‚åœºä¸Šçœ‹ï¼Œå›¢é˜Ÿèƒ½æ‹¿åˆ°çš„éƒ½ä»¥åˆ›ä¸šå‹é¡¹ç›®ä¸ºä¸»ï¼Œé¢åº¦éƒ½è¾ƒå°ï¼ŒåŒæ—¶è¿˜è¦å¿å—æ¥è‡ªå¯¹æ‰‹çš„å‹ä»·ã€‚ä¸ºäº†å…»æ´»å›¢é˜Ÿåˆ™éœ€è¦å°½å¯èƒ½æ¥ä¸‹æ›´å¤šçš„å•å­ï¼Œé‚£ä¹ˆè¿™æ ·å°±ä¼šé€ æˆå‰é¢æ‰€è¯´çš„ç ”å‘å‹åŠ›è¿‡è½½ï¼Œäºæ˜¯ä¹å°±ä¼šäº§ç”Ÿè®¸å¤šè´¨é‡é—®é¢˜ï¼Œè¿™äº›éƒ½éœ€è¦&lt;strong&gt;å¼€å‘å›¢é˜Ÿåœ¨åé¢å»å…œåº•&lt;/strong&gt;ï¼Œé•¿æœŸæŒç»­ä¸‹æ¥å°±æˆäº†æ¶æ€§å¾ªç¯ã€‚&lt;/p&gt;
&lt;h2 id=&quot;è¾—è½¬&quot;&gt;è¾—è½¬&lt;/h2&gt;
&lt;p&gt;è¿™äº›ç³Ÿç³•çš„çŠ¶å†µå¤§çº¦æŒç»­äº†è¿‘ä¸¤å¹´ï¼Œä¹‹åæˆ‘é€‰æ‹©é€€å‡ºï¼Œä¸»è¦çš„åŸå› è¿˜æ˜¯æ¥æºäºè‡ªå·±ï¼Œä¸€æ–¹é¢è¿™æ®µæ—¶æœŸå†…è‡ªå·±åŸºæœ¬ä¸Šæ²¡æœ‰äº†æ”¶å…¥ä¸Šçš„ç§¯ç´¯ï¼Œå¦ä¸€æ–¹é¢åˆ™æ˜¯å¯¹äºè‡ªèº«æˆé•¿ä¸Šçš„ç„¦è™‘ï¼Œçš„ç¡®é¡¹ç›®æ˜¯åšäº†éå¸¸å¤šï¼Œä¹Ÿä¸€ç›´åœ¨æ‰¿æ‹…ç€ç®¡ç†è€…çš„è§’è‰²ï¼Œä½†æ˜¯åœ¨ä¸ªäººèƒ½åŠ›ä¸Šè§‰å¾—å·²ç»åˆ°äº†ç“¶é¢ˆã€‚&lt;br/&gt;å†è€…å°±æ˜¯å®¶é‡Œäººå¯¹äºæˆ‘ç¦»èŒåˆ›ä¸šè¿™ä»¶äº‹æƒ…æ— æ³•ç†è§£ï¼Œä¹Ÿæ˜¯å› ä¸ºè¿™ä¸ªäº‹æƒ…è·Ÿå®¶é‡Œçš„å…³ç³»é—¹åƒµäº†ã€‚&lt;br/&gt;&lt;strong&gt;åœ¨æˆ‘è§‰å¾—æœ€å›°éš¾çš„æ—¶å€™å¾ˆéš¾å¾—åˆ°ä¸€äº›ç²¾ç¥ä¸Šçš„æ”¯æŒ&lt;/strong&gt;ï¼ŒåŒæ—¶è¿˜æ„å¤–å‘ç°è‡ªå·±äº§ç”Ÿäº†ä¸€äº›ç„¦è™‘ç—‡ã€‚ä¸ºäº†æ‘†è„±è¿™äº›ç°çŠ¶ï¼Œè‡ªå·±å†³å®šå»å¯»æ‰¾ä¸€ä¸ªæ–°èµ·ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç¦»å¼€å›¢é˜Ÿä¹‹åï¼Œæˆ‘å…ˆæ˜¯åœ¨ä¸€å®¶å°å…¬å¸æ‹…ä»»æŠ€æœ¯è´Ÿè´£äººï¼Œåœ¨é‚£è¾¹è´Ÿè´£å¼€å‘äº†ä¸€å¥—ç‰©è”åå°ç³»ç»Ÿï¼Œä¸»è¦ç”¨äºæœåŠ¡å…¶é”€å”®çš„ç©¿æˆ´ç±»è®¾å¤‡äº§å“(åä¸‡çº§)ã€‚&lt;br/&gt;é™¤äº†æŠ€æœ¯é€‰å‹ã€æ¶æ„è®¾è®¡ä¸æ™®é€šçš„Web é¡¹ç›®å­˜åœ¨è¾ƒå¤§ä¸åŒä¹‹å¤–ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æˆ‘è§‰å¾—ä¼šæ˜¯æœªæ¥æŒç»­å¢é•¿çš„ä¸€ä¸ªé¢†åŸŸã€‚&lt;br/&gt;åªæ˜¯åæ¥ç”±äºå¸‚åœºé”€å”®åŠäº§å“è¿ä½œæ–¹é¢çš„é—®é¢˜ï¼Œè¿™å—ä¸šåŠ¡ä¹Ÿå¾ˆå¿«èµ°å‘äº†ä¸‹å¡ï¼Œæˆ‘ä¹Ÿè¢«è¿«æ’¤ç¦»äº†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å¯»æ±‚æ·±é€ &quot;&gt;å¯»æ±‚æ·±é€ &lt;/h2&gt;
&lt;p&gt;æ­¤åçš„æ—¶é—´é‡Œï¼Œæˆ‘é¢è¯•äº†ä¸€äº›å…¬å¸ï¼Œå…¶ä¸­ä¸ä¹ä¸€äº›æŒ‚ç¾Šå¤´å–ç‹—è‚‰çš„ï¼Œä½†æœ€ç»ˆæˆ‘è¿˜æ˜¯å»äº†ä¸€å®¶å¤§å‹ä¼ä¸šçš„ç‰©è”ç½‘ä¸šåŠ¡éƒ¨é—¨ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨æ‰€åœ¨çš„åœ°æ–¹ï¼Œæƒ³åœ¨è¿™é‡Œè¾¹ç»§ç»­å­¦ä¹ å’Œæ·±é€ ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿›å…¥è¿™å®¶å…¬å¸ä¹‹æ—¶ï¼Œä¹Ÿå¬è¯´è¿‡å…¶ç‹¼æ€§æ–‡åŒ–å’Œä¸€äº›æ··ä¹±ä¸å ªçš„é¡¹ç›®ç®¡ç†ï¼Œå…¶ä¸­ä¸€ç‚¹å°±æ˜¯åŠ ç­å¤šä¸”ä¼šå¾ˆç´¯ï¼Œè¿èº«è¾¹çš„æœ‹å‹ä¹Ÿå¾ˆéš¾ç†è§£æˆ‘åšè¿™æ ·çš„é€‰æ‹©ã€‚&lt;br/&gt;å½“ç„¶ï¼Œè¿™äº›æƒ…å†µåœ¨åé¢çš„å·¥ä½œä¸­éƒ½é‡åˆ°äº†ï¼Œä½†åœ¨é€‚å½“çš„è°ƒæ•´ä¹‹åå‘ç°å¹¶ä¸ä¼šé€ æˆå¾ˆå¤§çš„å½±å“ã€‚å…³é”®çš„ä¸€ç‚¹åœ¨äº&lt;strong&gt;è‡ªå·±è¦çŸ¥é“ä¸ºä»€ä¹ˆè‡ªå·±ä¼šåšè¿™ä¸ªé€‰æ‹©&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿‡å»çš„åå¹´é‡Œï¼Œæˆ‘ç»å†äº†ä»æŠ€æœ¯åˆ°ç®¡ç†ï¼Œå†å›å½’åˆ°æŠ€æœ¯çš„è·¯çº¿ã€‚è€Œæ­£å¦‚è®¸å¤šæ–‡ç« éƒ½æåˆ°çš„ï¼ŒæŠ€æœ¯äººåˆ°äº†ä¸­å¹´ä¼šæœ‰å¾ˆå¤šæ— å¥ˆï¼Œé™¤äº†èº«ä½“å’ŒæŠ€èƒ½çš„è€åŒ–ï¼Œä½ çš„ç”Ÿæ´»å‹åŠ›ä¹Ÿä¼šéª¤å¢ä¸å°‘ã€‚&lt;br/&gt;è™½ç„¶çš„ç¡®æ˜¯å¦‚æ­¤ï¼Œä½†æ˜¯ä½œä¸ºä¸€åæŠ€æœ¯äººæ¥è¯´ï¼Œæˆ‘è®¤ä¸ºåªè¦&lt;strong&gt;é•¿æœŸçš„è¿›è¡Œå­¦ä¹ ï¼Œä¿æŒä½ä¸€ç§å·¥åŒ ç²¾ç¥&lt;/strong&gt;ï¼Œé‚£ä¹ˆå¤§é¾„æŠ€æœ¯äººçš„ç«äº‰åŠ›å°±ä¸€å®šè¿˜åœ¨ã€‚&lt;/p&gt;
&lt;p&gt;åå¹´çš„æ„Ÿæ‚Ÿæµ“ç¼©ä¸ºä¸€å¥ï¼š&lt;br/&gt;&lt;strong&gt;ä½ å¯ä»¥ä¸å¤Ÿèªæ˜ï¼Œä½†ä¸èƒ½æ²¡æœ‰çƒ­çˆ±&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/242916/201904/242916-20190413213001761-1748420783.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;(å®Œ)&lt;/p&gt;
</description>
<pubDate>Sat, 13 Apr 2019 13:30:00 +0000</pubDate>
<dc:creator>ç¾ç å¸ˆ</dc:creator>
<og:description>è€å…µçš„åå¹´èŒåœºä¹‹è·¯(ä¸‰) å‰æ–‡å†ç»­ 'è€å…µçš„åå¹´èŒåœºä¹‹è·¯(ä¸€)' 'è€å…µçš„åå¹´èŒåœºä¹‹è·¯(äºŒ)' åœ¨å‰é¢çš„æ–‡ç« é‡Œï¼Œå¦‚æœè¯´ç¬¬äºŒæ®µç»å†æ˜¯æˆ‘çš„å°é«˜å³°ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘è§‰å¾—ç®—æ˜¯ä¸€æ®µå¹³å³°æœŸå§ã€‚è‡³å°‘åœ¨æŠ€æœ¯æˆé•¿ä¸Šé¢æ˜¯å¦‚æ­¤</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/littleatp/p/10703011.html</dc:identifier>
</item>
<item>
<title>Kaggleä¹‹è·¯ï¼Œä¸å¼ºè€…ä¸ºä¼â€”â€”è®°Santanderäº¤æ˜“é¢„æµ‹ - è½å¶æœ‰å£°</title>
<link>http://www.cnblogs.com/fugeny/p/10702812.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/fugeny/p/10702812.html</guid>
<description>&lt;h2 id=&quot;é¢˜ç›®-description&quot;&gt;é¢˜ç›® Description&lt;/h2&gt;
&lt;hr/&gt;&lt;p&gt;é¢„æµ‹ä¸€ä¸ªä¹˜å®¢åœ¨æœªæ¥ä¼šä¸ä¼šäº¤æ˜“ï¼Œä¸è®¡äº¤æ˜“æ¬¡æ•°ï¼Œåªè¦æœ‰äº¤æ˜“å³ä¸º1ï¼Œå¦åˆ™ä¸º0.&lt;/p&gt;
&lt;p&gt;Identify which customers will make a specific transaction in the future, irrespective of the amount of money transacted.&lt;/p&gt;
&lt;p&gt;You are provided with an anonymized dataset containing numeric feature variables, the binary &lt;code&gt;target&lt;/code&gt; column, and a string &lt;code&gt;ID_code&lt;/code&gt;column.&lt;/p&gt;
&lt;p&gt;The task is to predict the value of &lt;code&gt;target&lt;/code&gt; column in the test set.&lt;/p&gt;
&lt;h2 id=&quot;data&quot;&gt;Data&lt;/h2&gt;
&lt;hr/&gt;&lt;p&gt;æä¾›äº† &lt;span class=&quot;math inline&quot;&gt;\(200k \times 202\)&lt;/span&gt; çš„æ•°æ®ï¼Œ200ç»´çš„ç‰¹å¾ï¼Œé€šè¿‡EDAå‘ç°ç‰¹å¾å‘é‡åŸºæœ¬æœä»é«˜æ–¯åˆ†å¸ƒï¼Œä¸”å„ä¸ªå˜é‡ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œç–‘ä¼¼ç»è¿‡ PCA å¤„ç†åçš„ç‰¹å¾ã€‚targetä¸º0 å’Œ 1ï¼Œå…¶ä¸­å¤„äº1çš„å æ¯”ä¸º 0.1117ï¼Œä¸å¹³è¡¡ç°è±¡æ˜æ˜¾ã€‚&lt;/p&gt;
&lt;p&gt;æµ‹è¯•é›†ä¸º &lt;span class=&quot;math inline&quot;&gt;\(200k \times 201\)&lt;/span&gt;ï¼Œå«æœ‰ä¸€è¡ŒIDï¼Œä¸200ç»´æ•°æ®ã€‚ç›®æ ‡ä¸ºé¢„æµ‹è¯¥ç”¨æˆ·çš„targetï¼ˆ0/1ï¼‰&lt;/p&gt;
&lt;h2 id=&quot;nd-è§£å†³æ–¹æ³•&quot;&gt;1nd è§£å†³æ–¹æ³•&lt;/h2&gt;
&lt;hr/&gt;&lt;p&gt;discussion&lt;a href=&quot;https://www.kaggle.com/c/santander-customer-transaction-prediction/discussion/89003#latest-515846&quot;&gt;é“¾æ¥&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å…±ä½¿ç”¨600ä¸ªç‰¹å¾ï¼Œä½¿ç”¨agumentationæŠ€å·§æ‰©å……æ•°æ®é›†ï¼Œ2.1NN/1LGBMèåˆã€‚&lt;/p&gt;
&lt;p&gt;magicç‰¹å¾ä¸ºuniqueç‰¹å¾ï¼Œä½œè€…ç§°å…¶é€šè¿‡EDAè§‚å¯Ÿ LGB æ ‘å‘ç°å…¶åªä½¿ç”¨uniqueç‰¹å¾ï¼Œä»è€Œæ³¨é‡æŒ–æ˜æ•°æ®çš„uniqueä¿¡æ¯ã€‚å¹¶æ ¹æ®å…¶å‡ºç°æ¬¡æ•°æ„å»ºäº†5ä¸ªç±»åˆ«ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;valueåœ¨ target=1 çš„train dataä¸­å‡ºç°å¤šæ¬¡&lt;/li&gt;
&lt;li&gt;valueåœ¨ target=0 çš„train dataä¸­å‡ºç°å¤šæ¬¡&lt;/li&gt;
&lt;li&gt;valueåœ¨ target=0å’Œtarget=1 çš„ train dataä¸­éƒ½å‡ºç°å¤šæ¬¡&lt;/li&gt;
&lt;li&gt;valueåœ¨train dataä¸­åªå‡ºç°ä¸€æ¬¡&lt;/li&gt;
&lt;li&gt;valueåœ¨train dataå’Œtest dataï¼ˆä»…åŒ…å«çœŸå®æ•°æ®ï¼‰ ä¸­éƒ½æ˜¯unique&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;ç”±æ­¤å¯ä»¥æ„å»º200ä¸ªç‰¹å¾ï¼ˆå¯¹æ¯ä¸ªåŸå§‹ç‰¹å¾transformï¼‰ï¼Œå¦å¤–200ä¸ªç‰¹å¾æ˜¯æ•°å€¼ç‰¹å¾ï¼Œå…¶å°†test+dataä¸­çš„uniqueæ•°æ®æ›¿æ¢ä¸ºç‰¹å¾çš„å‡å€¼ã€‚åœ¨æ²¡æœ‰å¤„ç†æ‰fakeæ—¶ï¼Œä½œè€…ç”¨å‰200ä¸ªç‰¹å¾ç”¨LGBMå–å¾—äº†0.910LBï¼ˆå¤§è‡´å‰è¿›0.09ï¼‰ï¼Œå¢åŠ å200ä¸ªç‰¹å¾åå–å¾—0.914LBã€‚å¤„ç†æ‰fakeä¹‹åï¼Œç”¨LGBMå–å¾—0.921LBã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“æ¥è¯´ï¼šä½œè€…ä½¿ç”¨10æŠ˜äº¤å‰éªŒè¯ï¼Œå¹¶ç”¨ä¸åŒçš„seedå¹¶åœ¨æœ€åè¿›è¡Œèåˆã€‚é‡‡ç”¨augmentationæŠ€å·§ï¼Œå³å°†åŒæ ·targetçš„è¡Œçš„ç‰¹å¾è¿›è¡Œshuffleåä½œä¸ºæ–°çš„æ•°æ®è¿›è¡Œé¢„æµ‹ï¼Œå¯¹target=1çš„æ•°æ®è¿›è¡Œ16æ¬¡shuffleï¼Œå¯¹target=0çš„è¡Œè¿›è¡Œ4æ¬¡shuffleï¼ŒåŒæ—¶ç›¸åº”æ‰“ä¸Šä¼ªæ ‡ç­¾ï¼ˆtestæ•°æ®ä¹Ÿè¢«åŠ å…¥åˆ°é‡Œé¢è¿›è¡Œè®­ç»ƒï¼Œå…¶ä¸­å‰2700ä¸ªè¢«è®¾ä¸º1ï¼Œå2000ä¸ªä½œä¸º0ï¼‰ï¼Œç”¨LGBMé¢„æµ‹ï¼Œ0.92522 LBã€‚&lt;/p&gt;
&lt;p&gt;ä½œè€…åŒæ—¶è®­ç»ƒäº†ä¸€ä¸ªNNæ¨¡å‹ï¼Œå°† val ç‰¹å¾çš„åŸå§‹valueï¼Œuniqueç±»ä¸æ•°å€¼ç‰¹å¾å…ˆæ˜ å°„åˆ°embeddingï¼Œå¯ä»¥æ„å»º200ä¸ªembeddingsï¼Œç„¶åå°†200ä¸ªembeddingåŠ æƒå¹³å‡åœ¨è¾“å…¥åˆ°ä¸€ä¸²å…¨è¿æ¥ç½‘ç»œä¸­å¯¼å‡ºæœ€ç»ˆè¾“å‡ºã€‚åŠ æƒçš„æ€æƒ³ç±»ä¼¼ä¸attentionï¼ŒåŠ æƒæƒé‡ä¸ºå‰ç½®çš„ä¸€ä¸ªç‹¬ç«‹NNæ¨¡å—ï¼Œè¿™æ ·ä¿è¯æœ€ç»ˆæ¯ä¸ªç‰¹å¾ç”¨åŒæ ·çš„æ–¹å¼è®­ç»ƒã€‚è®­ç»ƒæ—¶å¯¹æ¯ä¸ªbatchè¿›è¡Œç‹¬ç«‹çš„augmentationï¼Œç»“æœä¸º0.92497PBï¼Œå†æŠŠ test åŠ å…¥è®­ç»ƒåï¼Œ0.92546PBã€‚å¤§è‡´æ‰«äº†ä¸‹ä½œè€…çš„æºç ï¼ŒNNçš„å…¨è¿æ¥ä¸º32å±‚ï¼Œé¢‘ç¹ä½¿ç”¨å°é‡çš„dropoutï¼ˆ0.08ï¼‰å’Œ BN å±‚ã€‚NNçš„å¥½å¤„æ˜¯å¯ä»¥æå–åˆ°ç‰¹å¾ä¹‹é—´çš„å…³ç³»ï¼Œä»¥åŠç‰¹å¾å†…éƒ¨æ•°æ®ä¹‹é—´çš„groupå…³ç³»ï¼ŒåŒæ—¶NNéœ€è¦è®­ç»ƒçš„è¶…å‚æ•°æ›´å°‘ã€‚&lt;/p&gt;
&lt;h2 id=&quot;nd-è§£å†³æ–¹æ³•-1&quot;&gt;2nd è§£å†³æ–¹æ³•&lt;/h2&gt;
&lt;hr/&gt;&lt;p&gt;discussion&lt;a href=&quot;https://www.kaggle.com/c/santander-customer-transaction-prediction/discussion/88939#latest-515844&quot;&gt;é“¾æ¥&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;1. ç§»é™¤fakeæµ‹è¯•é›†ï¼Œä¿ç•™100kçš„çœŸå®æµ‹è¯•é›†ï¼ŒçœŸå®æµ‹è¯•é›†çš„å®šä¹‰ä¸ºå…¶å­˜åœ¨ä»…å‡ºç° 1 æ¬¡çš„ç‰¹å¾ï¼Œfakeè¡Œæ˜¯çœŸå®è¡Œæ‹¼å‡‘èµ·æ¥çš„ï¼Œä¼šå¯¹ç»“æœé€ æˆå½±å“ã€‚
2. åŒæ—¶å¯¹è®­ç»ƒé›†ä¸æµ‹è¯•é›†çš„å„ä¸ªç‰¹å¾è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†
3. æ„å»ºé¢‘ç‡ç‰¹å¾ï¼ŒæŒ‰ç…§å°æ•°ç‚¹ç²¾åº¦ï¼Œæ„å»º4ç§é¢‘ç‡ç‰¹å¾
4. å°†æ¯ä¸€ä¸ªåŸå§‹ç‰¹å¾ä¸å…¶é¢‘ç‡ç‰¹å¾å–å‡ºæ¥è¿›è¡Œæ‹¼æ¥ï¼Œå¹¶å¢åŠ ç±»åˆ«ç‰¹å¾ï¼ˆ200ä¸ªç±»åˆ«ï¼‰ï¼Œæ„æˆæ–°çš„è®­ç»ƒé›†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ç›¸å½“äºä»…ç”¨åŸå§‹ä¸€ä¸ªç‰¹å¾æ¥è¿›è¡Œè®­ç»ƒï¼Œè€ŒåŸå§‹æ¯ä¸ªç‰¹å¾éƒ½æ˜¯å‡ç­‰çš„ï¼ˆç‹¬ç«‹æ€§å‡è®¾ï¼‰
5. ç”¨ lightgbm è®­ç»ƒå’Œé¢„æµ‹
6. å°†200ä¸ªé¢„æµ‹ç»“æœè¿›è¡Œæ‹¼æ¥ï¼Œæ‹¼æ¥å…¬å¼è§å…¬å¼5
7. joinçœŸæµ‹è¯•é›†çš„é¢„æµ‹ç»“æœï¼Œå°†å‡æµ‹è¯•é›†çš„ç»“æœç½®ä¸º0ï¼Œè¿›è¡Œæäº¤&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¯¥å‚èµ›é˜Ÿä¼&lt;a href=&quot;https://github.com/KazukiOnodera/santander-customer-transaction-prediction/blob/master/py/990_2nd_place_solution_golf.py&quot;&gt;ä»£ç é“¾æ¥&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¯¹ &lt;strong&gt;#1&lt;/strong&gt; è§£é‡Šï¼š &lt;strong&gt;magic&lt;/strong&gt;ä¹‹ä¸€ï¼Œåœ¨æŸ¥çœ‹è®­ç»ƒé›†ä¸æµ‹è¯•é›†çš„uniqueè®¡æ•°åˆ†å¸ƒæ—¶ï¼Œå‘ç°äºŒè€…å­˜åœ¨è¾ƒå¤§å·®è·ï¼Œæ‰€ä»¥æµ‹è¯•é›†ç”±çœŸçš„æµ‹è¯•é›†ä¸å‡çš„æµ‹è¯•é›†ç»„æˆï¼Œå‡çš„æµ‹è¯•é›†æ˜¯é˜²æ­¢ç”¨æˆ·è¿›è¡ŒLB Probeï¼ŒçœŸçš„æµ‹è¯•é›†ç”¨æ¥è¯„åˆ†ã€‚å‡çš„æµ‹è¯•é›†æ˜¯çœŸæµ‹è¯•é›†æ‹¼å‡‘çš„ï¼Œæ‰€ä»¥ç‰¹å¾ä¸å”¯ä¸€ï¼Œä»¥æ­¤æ¥æ’é™¤å®ƒã€‚è¿ç”¨è¯¥magicï¼Œå¤§è‡´å¯ä»¥ä»0.901æå‡åˆ° LB 0.91ï¼ŒPB 0.907&lt;/p&gt;
&lt;p&gt;å¯¹ &lt;strong&gt;#4&lt;/strong&gt; è§£é‡Šï¼šç”¨å•ä¸ªç‰¹å¾æ¥è¿›è¡Œé¢„æµ‹ï¼Œå¯ä»¥æœ‰æ›´å¤šçš„è®­ç»ƒæ•°æ®ï¼ˆ&lt;span class=&quot;math inline&quot;&gt;\(200k \times 200\)&lt;/span&gt; è¡Œï¼‰ï¼Œè®­ç»ƒæ—¶å¯¹å•ä¸ªç‰¹å¾çš„å…³æ³¨åº¦ä¹Ÿæ›´é«˜ï¼Œä¸ªäººç†è§£è¯¥æ–¹å¼ä¸æ¯”èµ›æœŸé—´çš„augmentationæŠ€å·§ç±»ä¼¼ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;åŸå§‹çš„å•ä¸ªç‰¹å¾ä¸º value
é€šè¿‡ round+è®¡æ•° æ‰©å±•ç‰¹å¾ï¼Œæœ€åå†åŠ ä¸Š ç‰¹å¾ç±»åˆ«ï¼ˆ200ä¸ªç±»åˆ«ï¼‰ï¼Œå½¢æˆçš„æ–°çš„trainæ•°æ®ä¸ºï¼š
value, count_org, count_2, count_3, count_4, varnum ---&amp;gt; target
testæ•°æ®é›†åšåŒæ ·å¤„ç†&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¯¹ &lt;strong&gt;#6&lt;/strong&gt; è§£é‡Šï¼šå‡è®¾å•ä¸ªç‰¹å¾æ˜¯ä¾ target ç‹¬ç«‹çš„ï¼Œä¹Ÿå³æ»¡è¶³ä¸‹è¿°å‡å®šï¼š&lt;br/&gt;&lt;span class=&quot;math display&quot;&gt;\[ f(n)= \begin{cases} P({\bf x} \,|\, y=1)= \prod_i P(x_i \,|\, y=1) \\ P({\bf x} \,|\, y=0)= \prod_i P(x_i \,|\, y=0) \end{cases} \tag 1 \]&lt;/span&gt;&lt;br/&gt;æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç”± &lt;span class=&quot;math inline&quot;&gt;\(P(y=1 \,|\, x_i)\)&lt;/span&gt; å¯¼å‡º &lt;span class=&quot;math inline&quot;&gt;\(P(y=1 \,|\, {\bf x})\)&lt;/span&gt;ï¼Œå…¶ä¸­ &lt;span class=&quot;math inline&quot;&gt;\({\bf x} = \{x_1, x_2,\dots,x_{200}\}\)&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;math display&quot;&gt;\[ \zeta = \frac{P(y=1 \,|\, {\bf x})}{P(y=0 \,|\, {\bf x})} = \frac{P({\bf x} \,|\, y=1)\cdot P(y=1)}{P({\bf x} \,|\, y=0) \cdot P(y=0)}=\frac{P(y=1) \prod_i P(x_i \,|\, y=1)}{P(y=0) \prod_i P(x_i \,|\, y=0)} \tag 2 \]&lt;/span&gt;&lt;br/&gt;æŒ‰ç…§è®­ç»ƒé›†çš„ç»Ÿè®¡ï¼Œå¯è®¾&lt;br/&gt;&lt;span class=&quot;math display&quot;&gt;\[ \lambda = \frac {P(y=1)} {P(y=0)} = \frac 1 9 \tag 3 \]&lt;/span&gt;&lt;br/&gt;åŒæ—¶ç”±æœ´ç´ è´å¶æ–¯å¯çŸ¥ï¼š&lt;br/&gt;&lt;span class=&quot;math display&quot;&gt;\[ \begin{align} &amp;amp;P(x_i \,|\, y=1) = \frac {P(y=1 \,|\, x_i) \cdot P(x_i)}{P(y=1)} \tag 4 \\ \zeta &amp;amp; =\frac 1 9 \cdot \prod_i \frac {P(y=1 \,|\, x_i) \cdot P(y=0)} {P(y=0 \,|\, x_i) \cdot P(y=1)} \\ &amp;amp; =\frac 1 9 \cdot \prod_i \frac {9 \cdot P(y=1 \,|\, x_i)} {P(y=0 \,|\, x_i)} \tag 5 \end{align} \]&lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;nd-è§£å†³æ–¹æ³•-2&quot;&gt;3nd è§£å†³æ–¹æ³•&lt;/h2&gt;
&lt;hr/&gt;&lt;p&gt;å…ˆå–å‡ºæµ‹è¯•é›†fake æ•°æ®ï¼Œå†æŠŠtrainå’Œfakeæ‹¼æ¥åœ¨ä¸€èµ·ï¼Œç„¶ååšç‰¹å¾å·¥ç¨‹ï¼Œå…¶ä½¿ç”¨äº†uniqueè®¡æ•°ã€å¯†åº¦ï¼ˆcountå¹³æ»‘åçš„ç»“æœï¼‰ã€å‰äºŒè€…ç›¸é™¤ï¼Œæ•…å…±800ç»´ç‰¹å¾ã€‚ç”¨LGBMè®­ç»ƒï¼Œå–å¾—0.9225 LBï¼Œä½œè€…è§‚å¯Ÿåˆ°å•ç”¨ä¸€äº›ç‰¹å¾è®­ç»ƒçš„aucæ¥è¿‘0.5ï¼Œå¯¹æœ€ç»ˆçš„ç»“æœæ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œæ‰€ä»¥é‡‡ç”¨ Lasso æ¥è‡ªåŠ¨å‰Šå‡è¯¥ç±»ç‰¹å¾ã€‚CVæ—¶ä¼˜åŒ–äº†reg_alphaï¼Œ max_binï¼Œ learning_rateï¼Œ num_leaves 4ä¸ªå‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;ä½œè€…å…³é”®æ€§çš„æ“ä½œæ˜¯ç”¨ CNN è¿›è¡ŒäºŒé˜¶æ®µçš„è®­ç»ƒã€‚å°†LGBMçš„é¢„æµ‹ç»“æœä½œä¸ºä¸€ä¸ªç‰¹å¾åŠ å…¥åˆ°CNNä¸­ï¼Œå¯¹æ¯ä¸ªç‰¹å¾åˆ—ä¿æŒç›¸åŒçš„å·ç§¯æ ¸ï¼Œæœ€åå†è¿ä¸€ä¸ªå…¨è¿æ¥å±‚ï¼Œåœ¨NNé‡Œä½¿ç”¨BNé¿å…è¿‡æ‹Ÿåˆã€‚æœ€ç»ˆå¹³å‡7ä¸ªCNNçš„ç»“æœä½œä¸ºæœ€ç»ˆç»“æœã€‚&lt;/p&gt;
&lt;h2 id=&quot;å…¶å®ƒmagic&quot;&gt;å…¶å®ƒmagic&lt;/h2&gt;
&lt;hr/&gt;&lt;p&gt;æœ‰çœ‹åˆ°å¯ä»¥é€šè¿‡å°†ç‰¹å¾åˆ— groupby åæ±‚ æ–¹å·®varï¼Œå¹¶å°†æ–¹å·®åŠ å‡åŸç‰¹å¾æ„æˆæ–°çš„ç‰¹å¾ï¼Œ400ç»´ç»Ÿä¸€æ”¾å…¥åˆ° lgb ä¸­è®­ç»ƒï¼Œå½“åŒæ—¶è€ƒè™‘åŠ å‡å¹¶æ¶ˆå» fake åå¯ä»¥å–å¾— 0.922çš„æˆç»©ã€‚å…¶å®æ˜¯å˜ç›¸çš„countï¼Œå› ä¸ºåœ¨groupbyä¹‹åï¼Œuniqueçš„æ•°æ®æ–¹å·®ä¸º0ï¼Œåªæœ‰countæ•°è¾ƒå¤§çš„å€¼æ‰ä¼šæœ‰æ–¹å·®ï¼Œanywayï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰è¶£çš„æ€è·¯ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ”¶è·&quot;&gt;æ”¶è·&lt;/h2&gt;
&lt;hr/&gt;&lt;p&gt;ç¬¬ä¸€æ¬¡å°è¯•å‚èµ›ï¼Œåœ¨æœ«å°¾å‡ å¤©å¼€å§‹å…¥åœºï¼Œè‡ªç„¶æ²¡æ‰“ç®—å»å–å¾—å¥½æˆç»©ï¼Œä¸»è¦æ˜¯ç–¯ç‹‚å»è¿½ kernels å’Œçœ‹ Discussionï¼Œåœ¨æ¯”èµ›æ—¶æ®µçœ‹å’Œåœ¨ç»“æŸä¹‹åçœ‹æ˜¯ä¸¤ç§ä¸åŒçš„å¿ƒæ€ã€‚åœ¨&lt;strong&gt;æ¯”èµ›ç»“æŸä¹‹å‰&lt;/strong&gt;ï¼Œå¤§éƒ¨åˆ†äººæ˜¯æ¯”è¾ƒç„¦è™‘çš„ï¼ŒDiscussion é‡Œæœ‰å¾ˆå¤šäººå‘è¨€ï¼Œä½†æ˜¯ä½ ä¹Ÿä¸èƒ½ç¡®å®šä»–ä»¬çš„ideaæ˜¯ä¸æ˜¯å¯¹çš„ï¼Œåªèƒ½ç”¨è‡ªå·±çš„çŸ¥è¯†å’Œå®è·µå»æ¨æ–­ï¼Œåœ¨è¿™ä¸€æœŸé—´ï¼ŒåŠ¡å¿…è¦ä¿è¯è‡ªå·±çš„ç†æ™ºï¼Œå¤šå°è¯•ä¸åˆ›æ–°ï¼Œè€Œä¸è¦è¢«è¯¯å¯¼åˆ°å»é’»ç‰›è§’å°–ï¼åœ¨&lt;strong&gt;æ¯”èµ›å&lt;/strong&gt;è¦åšå¥½æ¯”èµ›çš„å›é¡¾ï¼Œå› ä¸ºæ¯”èµ›åæœ‰å¾ˆå¤šäººä¼šå…¬å¸ƒä»–ä»¬çš„æ€è·¯å’Œä»£ç ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦å»æ½œå¿ƒå­¦ä¹ ä¸‹æ¯”ä½ åšçš„å¥½çš„äººçš„åšæ³•ï¼Œåæ€ä¸è¶³ï¼Œè¿™æ ·æ‰èƒ½äº‰å–åœ¨ä¹‹åçš„æ¯”èµ›ä¸­æ›´è¿›ä¸€æ­¥ã€‚&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;æœ€åæ¨èå‡ ä¸ªkernelsï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ç¬¬ä¸€åçš„ &lt;a href=&quot;https://www.kaggle.com/fl2ooo/nn-wo-pseudo-1-fold-seed&quot;&gt;kernelé“¾æ¥&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å·ç§°actual winnerçš„æœ€æ—©fake testæå‡ºè€…ï¼š&lt;a href=&quot;https://www.kaggle.com/yag320/list-of-fake-samples-and-public-private-lb-split&quot;&gt;kernelé“¾æ¥&lt;/a&gt; ï¼Œå¯ä»¥è¯´æ¯”èµ›æ—¶æ³¨æ„åˆ°è¿™ä¸ªkernelï¼Œé“¶ç‰Œä¸æ˜¯é—®é¢˜äº†&lt;/li&gt;
&lt;li&gt;å‚èµ›æœŸé—´çœ‹å¾—ä¸€ä¸ª&lt;a href=&quot;https://www.kaggle.com/hjd810/keras-lgbm-aug-feature-eng-sampling-prediction&quot;&gt;kernel&lt;/a&gt; ï¼Œé‡Œé¢åŒ…è¡Œaugmentationï¼Œä»£ç é£æ ¼ä¸é”™ï¼Œè¯»èµ·æ¥æŒºèˆ’æœï¼Œå¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šåšè‡ªå·±çš„ä¿®æ”¹ä¸å°è¯•&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰åçš„ &lt;a href=&quot;https://www.kaggle.com/nawidsayed/lightgbm-and-cnn-3rd-place-solution&quot;&gt;kernelé“¾æ¥&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
<pubDate>Sat, 13 Apr 2019 12:49:00 +0000</pubDate>
<dc:creator>è½å¶æœ‰å£°</dc:creator>
<og:description>8000å¤šäººçš„Kaggleæ¯”èµ›ï¼Œå¯»æ‰¾magicçš„æ¯”èµ›ï¼ŒSantander Customer Transaction Predictionå‰3åç®—æ³•è§£è¯»ã€‚</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/fugeny/p/10702812.html</dc:identifier>
</item>
<item>
<title>å­—ä½“åçˆ¬ - ç¥ä¸€æ ·äº†</title>
<link>http://www.cnblogs.com/shenyiyangle/p/10702693.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/shenyiyangle/p/10702693.html</guid>
<description>&lt;h3&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;æœ€è¿‘çœ‹åˆ°å­—ä½“åçˆ¬ï¼Œè¯•äº†ä¸€ä¸‹&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;ä¸œæ–¹è´¢å¯Œç½‘&lt;/span&gt;&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1581786/201904/1581786-20190413155736655-260747389.png&quot; alt=&quot;&quot; width=&quot;916&quot; height=&quot;366&quot;/&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;strong&gt;æ•°æ®å†…å®¹æ˜¯æ–¹å—ï¼Œå³è¾¹styleçš„font-familyæ˜¯stonefontï¼Œctrl-Fæœç´¢ï¼Œå‘ç°å­—ä½“æ–‡ä»¶ã€‚&lt;br/&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Â &lt;img src=&quot;https://img2018.cnblogs.com/blog/1581786/201904/1581786-20190413161225540-1655664962.png&quot; alt=&quot;&quot; width=&quot;858&quot; height=&quot;259&quot;/&gt;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;&lt;span&gt;&lt;strong&gt;æ¸…é™¤networkè®°å½•ï¼Œæ¢ä¸€ä¸ªæˆªè‡³æ—¥æœŸï¼Œnetworké‡Œåªæœ‰ä¸‰æ¡è¯·æ±‚ï¼Œç¬¬ä¸€æ¡jsé‡Œæœ‰é¡µé¢ä¸Šçš„åŠ è½½æ•°æ®å’Œå­—ä½“ç±»å‹&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;å­—ä½“åœ°å€ç­‰ï¼Œ&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;ç¬¬ä¸‰æ¡æ˜¯å­—ä½“æ–‡ä»¶ã€‚åœ¨æºç ctrl-Fæœç´¢å‘ç°æºç é‡ŒåŒæ ·æœ‰æ•°æ®ï¼Œå†…å®¹å’Œjsé‡Œæ˜¯ä¸€æ ·çš„ï¼Œæ„Ÿè§‰ä¸¤ç§éƒ½å¯ä»¥çˆ¬ã€‚&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1581786/201904/1581786-20190413161757998-1116133176.png&quot; alt=&quot;&quot; width=&quot;864&quot; height=&quot;196&quot;/&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;&lt;strong&gt;ç”¨requestsè¯·æ±‚æ•°æ®ï¼ŒæŠ„ä¸€éheadersç”¨postå‘é€æ‹¿åˆ°æ•°æ®ï¼Œæ•°å­—å†…å®¹è¿˜æ˜¯ä¹±ç ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥éœ€è¦æŠŠä¹±ç æ”¹æˆèƒ½æ˜¾ç¤ºçš„æ•°å­—&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;57&quot;&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;#æŠŠheadersé‡Œçš„querystringæŠ„åˆ°dadaé‡Œç”¨postå‘é€&lt;/strong&gt;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;url=&quot;http://dcfm.eastmoney.com/em_mutisvcexpandinterface/api/js&quot;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;headers={&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&quot;Referer&quot;: &quot;http://data.eastmoney.com/bbsj/201903/yjbb.html&quot;,&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36&quot;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;span&gt;data={&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&quot;type&quot;: &quot;YJBB21_YJBB&quot;,&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&quot;token&quot;: &quot;70f12f2f4f091e459a279469fe49eca5&quot;,&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&quot;st&quot;: &quot;latestnoticedate&quot;,&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&quot;sr&quot;: &quot;-1&quot;,&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&quot;p&quot;: &quot;1&quot;,&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&quot;ps&quot;: &quot;50&quot;,&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&quot;js&quot;: &quot;var rIKyuApR={pages:(tp),data: (x),font:(font)}&quot;,&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&quot;filter&quot;: &quot;(securitytypecode in ('058001001','058001002'))(reportdate=^2018-09-30^)&quot;,&lt;/span&gt;&lt;br/&gt;&lt;span&gt;&quot;rt&quot;: &quot;51838114&quot;&lt;/span&gt;&lt;br/&gt;&lt;span&gt;}&lt;/span&gt;&lt;br/&gt;&lt;span&gt;r=requests.post(url=url,headers=headers,data=data)&lt;/span&gt;&lt;br/&gt;&lt;span&gt;r.encoding=r.apparent_encoding&lt;/span&gt;&lt;br/&gt;&lt;span&gt;print(r.text)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;r.encoding=r.apparent_encoding&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;print&lt;/span&gt;(r.text)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;#ç”¨jupyteræ‰“å¼€æ¯”è¾ƒæ–¹ä¾¿&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;&lt;span&gt;&lt;strong&gt;å¤„ç†æ•°æ®ï¼ŒæŠŠå­—ç¬¦ä¸²å˜æˆpythonèƒ½å¤„ç†çš„å­—å…¸&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt;org_data=r.text[r.text.index(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;):]
json_str &lt;/span&gt;= or_data.replace(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;data:&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;&quot;data&quot;:&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;).replace(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;pages:&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;&quot;pages&quot;:&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;).replace(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;font:&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;&quot;font&quot;:&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
json_data &lt;/span&gt;= json.loads(json_str)&lt;/span&gt;&lt;p&gt;&lt;span&gt;#æ‹¿åˆ°å­—ä½“æ–‡ä»¶&lt;/span&gt;
&lt;/p&gt;&lt;/pre&gt;
&lt;p&gt;&lt;span&gt;ã€€font_url = json_data['font']['WoffUrl']&lt;/span&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div readability=&quot;67.801202806549&quot;&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;å¤„ç†ç»“æœï¼š&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Â &lt;img src=&quot;https://img2018.cnblogs.com/blog/1581786/201904/1581786-20190413185205608-1450568277.png&quot; alt=&quot;&quot; width=&quot;825&quot; height=&quot;214&quot;/&gt;Â &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;&lt;span&gt;å…³äºå­—ä½“&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;ã€€ã€€å­—ä½“æ–‡ä»¶é‡Œè®°å½•æœ‰å­—å½¢ç´¢å¼•å’Œå­—å½¢çš„æ˜ å°„å…³ç³»ï¼Œä¿å­˜åœ¨å­—ä½“çš„cmapè¡¨é‡Œï¼Œæœ‰å…³&lt;/strong&gt;&lt;/span&gt;&lt;span&gt;&lt;strong&gt;å­—ä½“è¯¦ç»†èµ„æ–™çœ‹ä¸‹é¢é“¾æ¥ï¼š&lt;/strong&gt;&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/shenyiyangle/p/10700156.html&quot;&gt;https://www.cnblogs.com/shenyiyangle/p/10700156.html&lt;/a&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;&lt;span&gt;&lt;strong&gt;ä¹±ç åŸå› &lt;/strong&gt;&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;æˆ‘ä»¬åœ¨æµè§ˆå™¨çœ‹åˆ°ä¹±ç æ˜¯å› ä¸ºç½‘ç«™åŠ è½½äº†è‡ªå®šä¹‰å­—ä½“ï¼Œå­—ä½“å­—å½¢dindexå’Œglphyæ˜ å°„å…³ç³»å’Œé»˜è®¤å­—ä½“çš„æ˜ å°„ä¸ä¸€æ ·ï¼Œç½‘ç«™æŒ‰ç…§è‡ªå®šä¹‰å­—ä½“é‡Œçš„æ˜ å°„å…³ç³»æ¥è¡¨ç¤ºæ•°æ®ï¼Œè€Œæˆ‘ä»¬æŠ“åˆ°çš„æ•°æ®ç”¨é»˜è®¤å­—ä½“è§£æï¼Œå› ä¸ºæ˜ å°„å…³ç³»ä¸åŒï¼Œç½‘ç«™çš„unicodeç´¢å¼•æŒ‡å‘é»˜è®¤å­—ä½“é‡Œçš„å…¶ä»–å­—å½¢ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°çš„æ•°æ®æ˜¯é”™çš„ã€‚&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;&lt;span&gt;&lt;strong&gt;è§£å†³æ–¹æ³•&lt;/strong&gt;&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;è§£å†³é—®é¢˜éœ€è¦å»ºä¸€å¼ å…³ç³»è¡¨ï¼Œå¦‚æœå­—å½¢ä¸å˜å¯ä»¥è®©è‡ªå®šä¹‰å­—ä½“çš„unicodeç´¢å¼•ä¸é»˜è®¤å­—ç¬¦å¯¹åº”ï¼Œç„¶åç”¨é»˜è®¤å­—ç¬¦æ›¿æ¢è‡ªå®šä¹‰å­—ä½“çš„unicodeç´¢å¼•ï¼Œè¿™æ ·å°±èƒ½åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºæ­£å¸¸æ•°æ®ã€‚&lt;/strong&gt;&lt;strong&gt;å…³ç³»å¦‚ä¸‹å›¾ï¼š&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1581786/201904/1581786-20190413180247724-2115815292.png&quot; alt=&quot;&quot; width=&quot;606&quot; height=&quot;237&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;&lt;span&gt;æ‰¾å…³ç³»&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;ç”¨åˆ°äº†TTFontåº“ï¼Œå¯ä»¥è§£æå­—ä½“&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;51&quot;&gt;
&lt;pre&gt;
&lt;span&gt;font = requests.get(font_url, headers=header, timeout=30&lt;span&gt;)
font_name &lt;/span&gt;= font_url.split(&quot;/&quot;)[-1]&lt;span&gt;
with codecs.open(font_name, &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;wb&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;) as f:
ã€€ã€€f.write(font.content)
font_map &lt;/span&gt;= TTFont(font_name).getBestCmap()#ç”¨getBestCmap()å¯ä»¥å¾—åˆ°å­—ä½“indexå’Œglphyçš„æ˜ å°„å…³ç³»&lt;/span&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;â€œâ€â€œ{120: 'x',
 57960: 'bgldyy',
 57971: 'qqdwzl',
 58817: 'whyhyx',
 59299: 'wqqdzs',
 60397: 'zbxtdyc',
 60633: 'zwdxtdy',
 60650: 'zrwqqdl',
 61125: 'bdzypyc',
 62069: 'sxyzdxn',
 62669: 'nhpdjl'}â€â€œâ€&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;font_mapé‡Œçš„å°±æ˜¯è‡ªå®šä¹‰å­—ä½“ç´¢å¼•å’Œå­—å½¢çš„å…³ç³»ï¼Œkeyæ˜¯indexï¼Œvalueè¡¨ç¤ºå­—å½¢ã€‚&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;unicodeä»£ç å°±æ˜¯å­—ä½“indexè¿›è¡Œåå…­è¿›åˆ¶è½¬åŒ–åå°†0X'æ›¿æ¢æˆ '&amp;amp;#x'ï¼Œfont_mapé‡Œçš„indexè½¬æ¢æˆunicodeå¦‚ä¸‹ï¼š&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;46&quot;&gt;
&lt;pre&gt;
&lt;span&gt;font_index = [hex(key).upper().replace(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;0X&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;amp;#x&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;) +&lt;span&gt;'&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; &lt;span&gt;for&lt;/span&gt; key &lt;span&gt;in&lt;/span&gt; font_map.keys()]&lt;/span&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;â€œâ€â€œ['&amp;amp;#x78;',
 '&amp;amp;#xE268;',
 '&amp;amp;#xE273;',
 '&amp;amp;#xE5C1;',
 '&amp;amp;#xE7A3;',
 '&amp;amp;#xEBED;',
 '&amp;amp;#xECD9;',
 '&amp;amp;#xECEA;',
 '&amp;amp;#xEEC5;',
 '&amp;amp;#xF275;',
 '&amp;amp;#xF4CD;']â€â€œâ€&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;&lt;span&gt;ä¸Šé¢ä»£ç å¾—åˆ°äº†è‡ªå®šä¹‰å­—ä½“çš„å…³ç³»ï¼Œè¿˜éœ€è¦unicodeç´¢å¼•å’Œå’Œé»˜è®¤å­—ç¬¦çš„å…³ç³»ï¼Œä¸œæ–¹è´¢å¯Œç½‘ç›´æ¥å†™åœ¨é¡µé¢ä¸Šäº†ã€‚&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;45&quot;&gt;
&lt;pre&gt;
&lt;span&gt;ã€€font_mapping = json_data[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;font&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;][&lt;span&gt;'&lt;/span&gt;&lt;span&gt;FontMapping&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;]&lt;/span&gt;&lt;br/&gt;&lt;span&gt;  font_mapping = {i['code']: str(i['value']) for i in font_map}&lt;/span&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;â€â€œâ€&lt;/span&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;{'&amp;amp;#xE268;': '7',
 '&amp;amp;#xE273;': '1',
 '&amp;amp;#xE5C1;': '9',
 '&amp;amp;#xE7A3;': '3',
 '&amp;amp;#xEBED;': '4',
 '&amp;amp;#xECD9;': '8',
 '&amp;amp;#xECEA;': '2',
 '&amp;amp;#xEEC5;': '0',
 '&amp;amp;#xF275;': '6',
 '&amp;amp;#xF4CD;': '5'}&lt;/span&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;â€â€œâ€&lt;br/&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;div class=&quot;cnblogs_code&quot; readability=&quot;47&quot;&gt;
&lt;pre&gt;
replace_dict= {hex(k).upper().replace(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;0X&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;amp;#x&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;) + &lt;span&gt;'&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: str(font_mapping[hex(k).upper().replace(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;0X&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;amp;#x&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;) + &lt;span&gt;'&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;])&lt;span&gt;for&lt;/span&gt; k &lt;span&gt;in&lt;/span&gt;&lt;span&gt; font_map.keys()}
â€œâ€â€œ{&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;amp;#x78;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
 &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;amp;#xE268;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;7&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
 &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;amp;#xE273;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
 &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;amp;#xE5C1;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;9&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
 &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;amp;#xE7A3;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
 &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;amp;#xEBED;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;4&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
 &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;amp;#xECD9;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;8&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
 &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;amp;#xECEA;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
 &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;amp;#xEEC5;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
 &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;amp;#xF275;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;6&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;,
 &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;&amp;amp;#xF4CD;&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: &lt;span&gt;'&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;}â€â€œâ€&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;&lt;span&gt;#æœ€åç›´æ¥åœ¨æ–‡ç« ä¸­æ›¿æ¢ï¼Œkeyæ¢æˆvalueã€‚&lt;/span&gt;&lt;/h3&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;for&lt;/span&gt; k, v &lt;span&gt;in&lt;/span&gt; replace_dict.items(): ã€€ã€€&lt;br/&gt;ã€€ã€€json_str = json_str.replace(k, v) &lt;br/&gt;finall_data = json.loads(json_str)
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;span&gt;ç»“æœï¼š&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1581786/201904/1581786-20190413185028523-391376649.png&quot; alt=&quot;&quot; width=&quot;404&quot; height=&quot;369&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;å·²å¾—åˆ°æ­£ç¡®æ•°å­—äº†ã€‚&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;æœ€åç­›é€‰éœ€è¦çš„å­—æ®µç­›é€‰æ•°æ®å¹¶å°†æ•°æ®å­˜å…¥æ•°æ®åº“ï¼Œå¯¼å‡ºæ•°æ®ä¿å­˜æˆcsvç”¨excelæ‰“å¼€ç»“æœã€‚&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;&lt;span&gt;Â &lt;img src=&quot;https://img2018.cnblogs.com/blog/1581786/201904/1581786-20190413190615493-1740607220.png&quot; alt=&quot;&quot; width=&quot;986&quot; height=&quot;241&quot;/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Sat, 13 Apr 2019 12:14:00 +0000</pubDate>
<dc:creator>ç¥ä¸€æ ·äº†</dc:creator>
<og:description>æœ€è¿‘çœ‹åˆ°å­—ä½“åçˆ¬ï¼Œè¯•äº†ä¸€ä¸‹ä¸œæ–¹è´¢å¯Œç½‘ æ•°æ®å†…å®¹æ˜¯æ–¹å—ï¼Œå³è¾¹styleçš„font-familyæ˜¯stonefontï¼Œctrl-Fæœç´¢ï¼Œå‘ç°å­—ä½“æ–‡ä»¶ã€‚ æ¸…é™¤networkè®°å½•ï¼Œæ¢ä¸€ä¸ªæˆªè‡³æ—¥æœŸï¼Œnetwor</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/shenyiyangle/p/10702693.html</dc:identifier>
</item>
<item>
<title>ææ‡‚Redis RDBå’ŒAOFæŒä¹…åŒ–åŠå·¥ä½œåŸç† - GrimMjx</title>
<link>http://www.cnblogs.com/GrimMjx/p/10695512.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/GrimMjx/p/10695512.html</guid>
<description>&lt;h2&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ã€€ã€€å› ä¸ºRedisçš„æ•°æ®éƒ½å‚¨å­˜åœ¨å†…å­˜ä¸­ï¼Œ&lt;span&gt;å½“è¿›ç¨‹é€€å‡ºæ—¶ï¼Œæ‰€æœ‰æ•°æ®éƒ½å°†ä¸¢å¤±ã€‚&lt;/span&gt;ä¸ºäº†ä¿è¯æ•°æ®å®‰å…¨ï¼ŒRedisæ”¯æŒ&lt;span&gt;RDB&lt;/span&gt;å’Œ&lt;span&gt;AOF&lt;/span&gt;ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶æœ‰æ•ˆé¿å…æ•°æ®ä¸¢å¤±é—®é¢˜ã€‚RDBå¯ä»¥çœ‹ä½œåœ¨æŸä¸€æ—¶åˆ»Redisçš„å¿«ç…§ï¼ˆsnapshotï¼‰ï¼Œéå¸¸é€‚åˆç¾éš¾æ¢å¤ã€‚AOFåˆ™æ˜¯å†™å…¥æ“ä½œçš„æ—¥å¿—ã€‚æœ¬æ–‡ä¸»è¦è®²è§£RDBã€AOFå’Œæ··åˆç»“åˆä½¿ç”¨ã€‚&lt;/p&gt;

&lt;h2&gt;ä¸€.æ¢ç´¢RDB&lt;/h2&gt;
&lt;p&gt;ã€€ã€€&lt;span&gt;RDBå°±åƒæ˜¯ä¸€å°ç»™Rediså†…å­˜æ•°æ®å­˜å‚¨æ‹ç…§çš„ç…§ç›¸æœºï¼Œç”Ÿæˆå¿«ç…§ä¿å­˜åˆ°ç£ç›˜çš„è¿‡ç¨‹ã€‚&lt;/span&gt;è§¦å‘RDBæŒä¹…åŒ–åˆ†ä¸ºæ‰‹åŠ¨è§¦å‘å’Œè‡ªåŠ¨è§¦å‘ã€‚Redisé‡å¯è¯»å–RDBé€Ÿåº¦å¿«ï¼Œä½†æ˜¯æ— æ³•åšåˆ°å®æ—¶æŒä¹…åŒ–ï¼Œå› æ­¤ä¸€èˆ¬ç”¨äº&lt;span&gt;æ•°æ®å†·å¤‡&lt;/span&gt;å’Œ&lt;span&gt;å¤åˆ¶ä¼ è¾“&lt;/span&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;æ‰‹åŠ¨è§¦å‘&lt;/h3&gt;
&lt;p&gt;ã€€ã€€ä½¿ç”¨saveå‘½ä»¤ï¼šæ­¤å‘½ä»¤ä¼šä½¿ç”¨Redisçš„ä¸»çº¿ç¨‹è¿›ç¨‹åŒæ­¥å­˜å‚¨ï¼Œ&lt;span&gt;é˜»å¡å½“å‰çš„RedisæœåŠ¡å™¨ï¼Œé€ æˆæœåŠ¡ä¸å¯ç”¨ï¼Œç›´åˆ°RDBè¿‡ç¨‹å®Œæˆã€‚&lt;/span&gt;æ— è®ºå½“å‰æœåŠ¡å™¨æ•°æ®é‡å¤§å°ï¼Œ&lt;span&gt;çº¿ä¸Šä¸è¦ç”¨ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;6379&lt;/span&gt;&amp;gt;&lt;span&gt; save
OK&lt;br/&gt;(1.14s)
&lt;/span&gt;&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;13&lt;/span&gt;:&lt;span&gt;34&lt;/span&gt;:&lt;span&gt;51.948&lt;/span&gt; * DB saved on disk
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€ä½¿ç”¨bgsaveå‘½ä»¤ï¼šæ­¤å‘½ä»¤ä¼šé€šè¿‡fork()åˆ›å»ºå­è¿›ç¨‹ï¼Œåœ¨åå°è¿›ç¨‹å­˜å‚¨ã€‚&lt;span&gt;åªæœ‰forké˜¶æ®µä¼šé˜»å¡å½“å‰RedisæœåŠ¡å™¨ï¼Œä¸å¿…åˆ°æ•´ä¸ªRDBè¿‡ç¨‹ç»“æŸï¼Œä¸€èˆ¬æ—¶é—´å¾ˆçŸ­ã€‚&lt;/span&gt;å› æ­¤Rediså†…éƒ¨æ¶‰åŠåˆ°RDBéƒ½é‡‡ç”¨bgsaveå‘½ä»¤ã€‚è¿™é‡Œæ³¨æ„ä¸€ç‚¹ï¼Œæ— è®ºRDBè¿˜æ˜¯AOFï¼Œ&lt;strong&gt;&lt;span&gt;ç”±äºä½¿ç”¨äº†å†™æ—¶å¤åˆ¶ï¼Œforkå‡ºæ¥çš„å­è¿›ç¨‹ä¸éœ€è¦æ‹·è´çˆ¶è¿›ç¨‹çš„ç‰©ç†å†…å­˜ç©ºé—´&lt;/span&gt;&lt;/strong&gt;ï¼Œä½†æ˜¯ä¼šå¤åˆ¶çˆ¶è¿›ç¨‹çš„ç©ºé—´å†…å­˜é¡µè¡¨ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;6379&lt;/span&gt;&amp;gt;&lt;span&gt; bgsave
Background saving started
&lt;/span&gt;&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;13&lt;/span&gt;:&lt;span&gt;44&lt;/span&gt;:&lt;span&gt;40.312&lt;/span&gt; * Background saving started by pid &lt;span&gt;59180&lt;/span&gt;
&lt;span&gt;59180&lt;/span&gt;:C &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;13&lt;/span&gt;:&lt;span&gt;44&lt;/span&gt;:&lt;span&gt;40.314&lt;/span&gt; *&lt;span&gt; DB saved on disk
&lt;/span&gt;&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;13&lt;/span&gt;:&lt;span&gt;44&lt;/span&gt;:&lt;span&gt;40.317&lt;/span&gt; * Background saving terminated with success
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;è‡ªåŠ¨è§¦å‘&lt;/h3&gt;
&lt;p&gt;ã€€ã€€ä¸€èˆ¬æˆ‘ä»¬æ˜¯ä¸ä¼šç›´æ¥ç”¨å‘½ä»¤ç”ŸæˆRDBæ–‡ä»¶çš„ï¼Œ&lt;span&gt;Redisæ”¯æŒè‡ªåŠ¨è§¦å‘RDBæŒä¹…åŒ–æœºåˆ¶&lt;/span&gt;ï¼Œé…ç½®éƒ½åœ¨&lt;span&gt;redis.conf&lt;/span&gt;æ–‡ä»¶é‡Œé¢ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æ–‡ä»¶é‡Œå…³äºrdbçš„é»˜è®¤é…ç½®ï¼Œè¿™è¾¹éƒ½ç”¨çº¢è‰²å­—ä½“æ ‡æ³¨å‡ºæ¥äº†ï¼Œè‹±æ–‡çš„æ–‡æ¡£è§£é‡Šçš„ååˆ†æ¸…æ¥šï¼Œæ³¨é‡Šä¹Ÿå†™çš„å¾ˆä¸é”™ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;42&quot;&gt;
&lt;pre&gt;
&lt;span&gt;################################ SNAPSHOTTING  ################################
#
# Save the DB on disk:
#
#   save &lt;/span&gt;&amp;lt;seconds&amp;gt; &amp;lt;changes&amp;gt;&lt;span&gt;
#
#   Will save the DB &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; both the given number of seconds and the given
#   number of &lt;/span&gt;&lt;span&gt;write&lt;/span&gt;&lt;span&gt; operations against the DB occurred.
#
#   In the example below the behaviour will be to save:
#   after &lt;/span&gt;&lt;span&gt;900&lt;/span&gt; sec (&lt;span&gt;15&lt;/span&gt; min) &lt;span&gt;if&lt;/span&gt; at least &lt;span&gt;1&lt;/span&gt;&lt;span&gt; key changed
#   after &lt;/span&gt;&lt;span&gt;300&lt;/span&gt; sec (&lt;span&gt;5&lt;/span&gt; min) &lt;span&gt;if&lt;/span&gt; at least &lt;span&gt;10&lt;/span&gt;&lt;span&gt; keys changed
#   after &lt;/span&gt;&lt;span&gt;60&lt;/span&gt; sec &lt;span&gt;if&lt;/span&gt; at least &lt;span&gt;10000&lt;/span&gt;&lt;span&gt; keys changed
#
#   Note: you can disable saving completely by commenting out all &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;save&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; lines.
#
#   It is also possible to remove all the previously configured save
#   points by adding a save directive with a single empty &lt;/span&gt;&lt;span&gt;string&lt;/span&gt;&lt;span&gt; argument
#   like &lt;/span&gt;&lt;span&gt;in&lt;/span&gt;&lt;span&gt; the following example:
#
#   save &lt;/span&gt;&lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;span&gt;

save 900 1
save 300 10
save 60 10000&lt;/span&gt;&lt;span&gt;

# By default Redis will stop accepting writes &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; RDB snapshots are enabled
# (at least one save point) and the latest background save failed.
# This will &lt;/span&gt;&lt;span&gt;make&lt;/span&gt; the user aware (&lt;span&gt;in&lt;/span&gt;&lt;span&gt; a hard way) that data is not persisting
# on disk properly, otherwise chances are that no one will notice and some
# disaster will happen.
#
# If the background saving process will start working again Redis will
# automatically allow writes again.
#
# However &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; you have setup your proper monitoring of the Redis server
# and persistence, you may want to disable this feature so that Redis will
# continue to work as usual even &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; there are problems with disk,
# permissions, and so forth.
&lt;span&gt;stop&lt;/span&gt;&lt;/span&gt;&lt;span&gt;-writes-on-bgsave-&lt;/span&gt;&lt;span&gt;&lt;span&gt;error yes&lt;/span&gt;

# Compress &lt;/span&gt;&lt;span&gt;string&lt;/span&gt; objects using LZF when dump .rdb databases?&lt;span&gt;
# For default that&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;s set to &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;yes&lt;span&gt;'&lt;/span&gt;&lt;span&gt; as it&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;s almost always a win.
# If you want to save some CPU &lt;/span&gt;&lt;span&gt;in&lt;/span&gt; the saving child set it to &lt;span&gt;'&lt;/span&gt;&lt;span&gt;no&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt; but
# the dataset will likely be bigger &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; you have compressible values or keys.
&lt;span&gt;rdbcompression yes&lt;/span&gt;

# Since version &lt;/span&gt;&lt;span&gt;5&lt;/span&gt; of RDB a CRC64 checksum is placed at the end of the &lt;span&gt;file&lt;/span&gt;&lt;span&gt;.
# This makes the format &lt;/span&gt;&lt;span&gt;more&lt;/span&gt;&lt;span&gt; resistant to corruption but there is a performance
# hit to pay (around &lt;/span&gt;&lt;span&gt;10&lt;/span&gt;%&lt;span&gt;) when saving and loading RDB files, so you can disable it
# &lt;/span&gt;&lt;span&gt;for&lt;/span&gt;&lt;span&gt; maximum performances.
#
# RDB files created with checksum disabled have a checksum of zero that will
# tell the loading code to skip the check.
&lt;span&gt;rdbchecksum yes&lt;/span&gt;

# The filename where to dump the DB
&lt;span&gt;dbfilename dump.rdb&lt;/span&gt;

# The working directory.
#
# The DB will be written inside this directory, with the filename specified
# above using the &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;dbfilename&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt; configuration directive.
#
# The Append Only File will also be created inside this directory.
#
# Note that you must specify a directory here, not a &lt;/span&gt;&lt;span&gt;file&lt;/span&gt;&lt;span&gt; name.
&lt;/span&gt;&lt;span&gt;dir /usr/local/var/db/redis/&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;&lt;li&gt;&lt;span&gt;save m nï¼šä»£è¡¨RedisæœåŠ¡å™¨åœ¨mç§’å†…æ•°æ®å­˜åœ¨næ¬¡ä¿®æ”¹æ—¶ï¼Œè‡ªåŠ¨è§¦å‘rdbã€‚è¿™ä¸ªå‚æ•°æ¯”è¾ƒå…³é”®ã€‚&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;stop-writes-on-bgsave-errorï¼šå¦‚æœæ˜¯yesï¼Œå½“bgsaveå‘½ä»¤å¤±è´¥æ—¶Rediså°†åœæ­¢å†™å…¥æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;rdbcompressionï¼šæ˜¯å¦å¯¹RDBæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œä½†æ˜¯åœ¨LZFå‹ç¼©æ¶ˆè€—æ›´å¤šCPU&lt;/li&gt;
&lt;li&gt;rdbchecksumï¼šæ˜¯å¦å¯¹RDBæ–‡ä»¶è¿›ç¨‹æ ¡éªŒ&lt;/li&gt;
&lt;li&gt;&lt;span&gt;dbfilenameï¼šé…ç½®æ–‡ä»¶åç§°ï¼Œé»˜è®¤dump.rdb&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;dirï¼šé…ç½®rdbæ–‡ä»¶å­˜æ”¾çš„è·¯åŠ²ï¼Œè¿™ä¸ªå‚æ•°æ¯”è¾ƒé‡è¦ã€‚&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;h3&gt;å·¥ä½œåŸç†&lt;/h3&gt;
&lt;p&gt;ã€€ã€€é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹server.hæ–‡ä»¶å†…saveparamså‚æ•°ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œsecondså°±æ˜¯ç§’æ•°ï¼Œchangeså°±æ˜¯æ”¹å˜é‡ã€‚æ˜¯ä¸æ˜¯å°±&lt;span&gt;å¯¹åº”ç€åˆšåˆšè¯´çš„save m nçš„é…ç½®&lt;/span&gt;å‘¢ï¼Ÿ&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;struct&lt;/span&gt;&lt;span&gt; redisServer {
    ....
    &lt;/span&gt;&lt;span&gt;struct&lt;/span&gt; saveparam *saveparams;   &lt;span&gt;/*&lt;/span&gt;&lt;span&gt; Save points array for RDB &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    ...
};

&lt;/span&gt;&lt;span&gt;struct&lt;/span&gt;&lt;span&gt; saveparam {
    time_t seconds;
    &lt;/span&gt;&lt;span&gt;int&lt;/span&gt;&lt;span&gt; changes;
};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹è¿™ä¸ªredis.cæ–‡ä»¶ï¼Œæœ‰ä¸ªå‘¨æœŸæ€§å‡½æ•°ï¼Œå«åš&lt;span&gt;serverCron&lt;/span&gt;ï¼Œå®ƒä¼šå‘¨æœŸè°ƒç”¨ï¼Œå¤§æ¦‚åšè¿™å‡ ä»¶äº‹æƒ…ï¼Œè§æ³¨é‡Šã€‚ç”¨çº¢è‰²æ ‡æ³¨çš„è¯´æ˜ä¼šè§¦å‘bgsaveå’Œaof rewriteã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/*&lt;/span&gt;&lt;span&gt; This is our timer interrupt, called server.hz times per second.
 * Here is where we do a number of things that need to be done asynchronously.
 * For instance:
 *
 * - Active expired keys collection (it is also performed in a lazy way on
 *   lookup).
 * - Software watchdog.
 * - Update some statistic.
 * - Incremental rehashing of the DBs hash tables.
&lt;span&gt; * - Triggering BGSAVE / AOF rewrite, and handling of terminated children.&lt;/span&gt;
 * - Clients timeout of different kinds.
 * - Replication reconnection.
 * - Many more...
 *
 * Everything directly called here will be called server.hz times per second,
 * so in order to throttle execution of things we want to do less frequently
 * a macro is used: run_with_period(milliseconds) { .... }
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;

&lt;span&gt;int&lt;/span&gt; serverCron(&lt;span&gt;struct&lt;/span&gt; aeEventLoop *eventLoop, &lt;span&gt;long&lt;/span&gt; &lt;span&gt;long&lt;/span&gt; id, &lt;span&gt;void&lt;/span&gt; *clientData) {
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼Œè¿™è¾¹å•ç‹¬æ‹¿å‡ºæ¥ï¼Œè¿™æ®µä»£ç çš„æ„æ€æ˜¯&lt;span&gt;åˆ¤æ–­changesæ˜¯å¦æ»¡è¶³&lt;/span&gt;å¹¶æ‰§è¡Œsaveæ“ä½œã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;42&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/*&lt;/span&gt;&lt;span&gt; If there is not a background saving/rewrite in progress check if
         * we have to save/rewrite now &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
         &lt;span&gt;for&lt;/span&gt; (j = &lt;span&gt;0&lt;/span&gt;; j &amp;lt; server.saveparamslen; j++&lt;span&gt;) {
            &lt;/span&gt;&lt;span&gt;struct&lt;/span&gt; saveparam *sp = server.saveparams+&lt;span&gt;j;

            &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt; Save if we reached the given amount of changes,
             * the given amount of seconds, and if the latest bgsave was
             * successful or if, in case of an error, at least
             * CONFIG_BGSAVE_RETRY_DELAY seconds already elapsed. &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
            &lt;span&gt;if&lt;/span&gt; (server.dirty &amp;gt;= sp-&amp;gt;changes &amp;amp;&amp;amp;&lt;span&gt;
                server.unixtime&lt;/span&gt;-server.lastsave &amp;gt; sp-&amp;gt;seconds &amp;amp;&amp;amp;&lt;span&gt;
                (server.unixtime&lt;/span&gt;-server.lastbgsave_try &amp;gt;&lt;span&gt;
                 CONFIG_BGSAVE_RETRY_DELAY &lt;/span&gt;||&lt;span&gt;
                 server.lastbgsave_status &lt;/span&gt;==&lt;span&gt; C_OK))
            {
                serverLog(LL_NOTICE,&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;%d changes in %d seconds. Saving...&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
                    sp&lt;/span&gt;-&amp;gt;changes, (&lt;span&gt;int&lt;/span&gt;)sp-&amp;gt;&lt;span&gt;seconds);
                &lt;span&gt;rdbSaveBackground(server.rdb_filename);
                &lt;/span&gt;&lt;/span&gt;&lt;span&gt;break&lt;/span&gt;&lt;span&gt;;
            }
         }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æ¥ç€ç»§ç»­çœ‹è¿™ä¸ªæ–¹æ³•çš„éƒ¨åˆ†ä»£ç ç‰‡æ®µï¼Œåœ¨rdb.cæ–‡ä»¶é‡Œã€‚&lt;span&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å­è¿›ç¨‹åä¸º&quot;redis-rdb-bgsave&quot;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;int&lt;/span&gt; rdbSaveBackground(&lt;span&gt;char&lt;/span&gt; *&lt;span&gt;filename) {
    pid_t childpid;
    &lt;/span&gt;&lt;span&gt;long&lt;/span&gt; &lt;span&gt;long&lt;/span&gt;&lt;span&gt; start;

    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (server.aof_child_pid != -&lt;span&gt;1&lt;/span&gt; || server.rdb_child_pid != -&lt;span&gt;1&lt;/span&gt;) &lt;span&gt;return&lt;/span&gt;&lt;span&gt; C_ERR;

    server.dirty_before_bgsave &lt;/span&gt;=&lt;span&gt; server.dirty;
    server.lastbgsave_try &lt;/span&gt;=&lt;span&gt; time(NULL);

    start &lt;/span&gt;=&lt;span&gt; ustime();
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; ((&lt;span&gt;childpid = fork()&lt;/span&gt;) == &lt;span&gt;0&lt;/span&gt;&lt;span&gt;) {
        &lt;/span&gt;&lt;span&gt;int&lt;/span&gt;&lt;span&gt; retval;

        &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt; Child &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
        closeListeningSockets(&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
&lt;span&gt;        redisSetProcTitle(&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&quot;redis-rdb-bgsave&quot;&lt;/span&gt;&lt;span&gt;&lt;span&gt;);&lt;/span&gt;
        retval &lt;/span&gt;=&lt;span&gt; rdbSave(filename);
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (retval ==&lt;span&gt; C_OK) {
            size_t private_dirty &lt;/span&gt;=&lt;span&gt; zmalloc_get_private_dirty();

            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; (private_dirty) {
                serverLog(LL_NOTICE,
                    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;RDB: %zu MB of memory used by copy-on-write&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
                    private_dirty&lt;/span&gt;/(&lt;span&gt;1024&lt;/span&gt;*&lt;span&gt;1024&lt;/span&gt;&lt;span&gt;));
            }
        }
        exitFromChild((retval &lt;/span&gt;== C_OK) ? &lt;span&gt;0&lt;/span&gt; : &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
    }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æœ€åæˆ‘ä»¬çœ‹ä¸€ä¸‹RDBçš„è¿ä½œæµç¨‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1465200/201904/1465200-20190413150710994-650893113.png&quot; alt=&quot;&quot; width=&quot;525&quot; height=&quot;434&quot;/&gt;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;redisæ‰§è¡Œbgsaveå‘½ä»¤ï¼ŒRedisåˆ¤æ–­å½“å‰å­˜åœ¨æ­£åœ¨è¿›è¡Œæ‰§è¡Œçš„å­è¿›ç¨‹ï¼Œå¦‚RDB/AOFå­è¿›ç¨‹ï¼Œå­˜åœ¨bgsaveå‘½ä»¤ç›´æ¥è¿”å›&lt;/li&gt;
&lt;li&gt;forkå‡ºå­è¿›ç¨‹ï¼Œ&lt;span&gt;forkæ“ä½œä¸­Redisçˆ¶è¿›ç¨‹ä¼šé˜»å¡&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;forkå®Œæˆè¿”å›ã€€ã€€59117:M 13 Apr 13:44:40.312 * Background saving started by pid 59180&lt;/li&gt;
&lt;li&gt;å­è¿›ç¨‹è¿›ç¨‹å¯¹å†…å­˜æ•°æ®ç”Ÿæˆå¿«æ‰¾æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;å­è¿›ç¨‹å‘Šè¯‰çˆ¶è¿›ç¨‹å¤„ç†å®Œæˆ&lt;/li&gt;
&lt;/ol&gt;&lt;h3&gt;æ¢ç´¢RDBæ–‡ä»¶&lt;/h3&gt;
&lt;p&gt;Â ã€€ã€€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;span&gt;redis-rdb-tools&lt;/span&gt;æ¥åˆ†ærdbå¿«ç…§æ–‡ä»¶ï¼Œä»–å¯ä»¥æŠŠrdbå¿«ç…§æ–‡ä»¶ç”Ÿæˆjsonæ–‡ä»¶ï¼Œçœ‹èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
rdb -c memory dump.rdb &amp;gt; testMjx.csv
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€ç„¶åæˆ‘ä»¬çœ‹ä¸‹ç”Ÿæˆçš„æ–‡ä»¶é•¿å•¥æ ·&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;76&quot;&gt;
&lt;pre&gt;
&lt;span&gt;database,type,key,size_in_bytes,encoding,num_elements,len_largest_element,expiry
&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;,&lt;span&gt;string&lt;/span&gt;,mjx3,&lt;span&gt;56&lt;/span&gt;,&lt;span&gt;string&lt;/span&gt;,&lt;span&gt;4&lt;/span&gt;,&lt;span&gt;4&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;,&lt;span&gt;string&lt;/span&gt;,mjx5,&lt;span&gt;56&lt;/span&gt;,&lt;span&gt;string&lt;/span&gt;,&lt;span&gt;4&lt;/span&gt;,&lt;span&gt;4&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;,&lt;span&gt;string&lt;/span&gt;,mjx2,&lt;span&gt;56&lt;/span&gt;,&lt;span&gt;string&lt;/span&gt;,&lt;span&gt;4&lt;/span&gt;,&lt;span&gt;4&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;,&lt;span&gt;string&lt;/span&gt;,mjx,&lt;span&gt;48&lt;/span&gt;,&lt;span&gt;string&lt;/span&gt;,&lt;span&gt;8&lt;/span&gt;,&lt;span&gt;8&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;,&lt;span&gt;string&lt;/span&gt;,mjx4,&lt;span&gt;56&lt;/span&gt;,&lt;span&gt;string&lt;/span&gt;,&lt;span&gt;4&lt;/span&gt;,&lt;span&gt;4&lt;/span&gt;,
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€ç”Ÿæˆçš„æ•°æ®æœ‰databaseï¼ˆkeyåœ¨Redisçš„dbï¼‰ã€typeï¼ˆkeyç±»å‹ï¼‰ã€keyï¼ˆkeyå€¼ï¼‰ã€size_in_bytesï¼ˆkeyçš„å†…å­˜å¤§å°ï¼‰ã€encodingï¼ˆvalueçš„å­˜å‚¨ç¼–ç å½¢å¼ï¼‰ã€num_elementsï¼ˆkeyä¸­çš„valueçš„ä¸ªæ•°ï¼‰ã€len_largest_elementï¼ˆkeyä¸­çš„valueçš„é•¿åº¦ï¼‰ã€è¶…æ—¶æ—¶é—´ã€‚&lt;/p&gt;
&lt;h3&gt;ä¼˜ç¼ºç‚¹&lt;/h3&gt;
&lt;p&gt;ã€€ã€€RDBæŒä¹…åŒ–æ–¹å¼çš„ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;éå¸¸é€‚åˆ&lt;span&gt;å…¨é‡å¤‡ä»½&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;æ¢å¤é€Ÿåº¦æ¯”AOFå¿«&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;ã€€ã€€RDBæŒä¹…åŒ–æ–¹å¼çš„ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;RDBæ–¹å¼&lt;span&gt;æ²¡æœ‰åŠæ³•åšåˆ°å®æ—¶æŒä¹…åŒ–&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;ç‰ˆæœ¬å…¼å®¹RDBæ ¼å¼é—®é¢˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;äºŒ.æ¢ç´¢AOF&lt;/h2&gt;
&lt;p&gt;Â ã€€ã€€RDBæ–¹å¼ä¸èƒ½æä¾›å¼ºä¸€è‡´æ€§ï¼Œå¦‚æœRedisè¿›ç¨‹å´©æºƒï¼Œé‚£ä¹ˆ&lt;span&gt;ä¸¤æ¬¡RDBä¹‹é—´çš„æ•°æ®ä¹Ÿéšä¹‹æ¶ˆå¤±&lt;/span&gt;ã€‚é‚£ä¹ˆAOFçš„å‡ºç°å¾ˆå¥½çš„è§£å†³äº†æ•°æ®æŒä¹…åŒ–çš„å®æ—¶æ€§ï¼ŒAOFä»¥ç‹¬ç«‹æ—¥å¿—çš„æ–¹å¼è®°å½•æ¯æ¬¡å†™å‘½ä»¤ï¼Œé‡å¯æ—¶å†é‡æ–°æ‰§è¡ŒAOFæ–‡ä»¶ä¸­çš„å‘½ä»¤æ¥æ¢å¤æ•°æ®ã€‚&lt;strong&gt;&lt;span&gt;AOFä¼šå…ˆæŠŠå‘½ä»¤è¿½åŠ åœ¨AOFç¼“å†²åŒºï¼Œç„¶åæ ¹æ®å¯¹åº”ç­–ç•¥å†™å…¥ç¡¬ç›˜ï¼ˆappendfsyncï¼‰&lt;/span&gt;&lt;/strong&gt;ï¼Œå…·ä½“å‚æ•°åé¢æœ‰è®²ã€‚æ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹&lt;span&gt;AOFé‡å†™å‘½ä»¤&lt;/span&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;æ‰‹åŠ¨è§¦å‘&lt;/h3&gt;
&lt;p&gt;ã€€ã€€ä½¿ç”¨bgrewriteaofå‘½ä»¤ï¼š&lt;span&gt;Redisä¸»è¿›ç¨‹forkå­è¿›ç¨‹æ¥æ‰§è¡ŒAOFé‡å†™ï¼Œè¿™ä¸ªå­è¿›ç¨‹åˆ›å»ºæ–°çš„AOFæ–‡ä»¶æ¥å­˜å‚¨é‡å†™ç»“æœï¼Œé˜²æ­¢å½±å“æ—§æ–‡ä»¶ã€‚&lt;strong&gt;å› ä¸ºforké‡‡ç”¨äº†å†™æ—¶å¤åˆ¶æœºåˆ¶ï¼Œå­è¿›ç¨‹ä¸èƒ½è®¿é—®åœ¨å…¶è¢«åˆ›å»ºå‡ºæ¥ä¹‹åäº§ç”Ÿçš„æ–°æ•°æ®ã€‚&lt;/strong&gt;Redisä½¿ç”¨â€œ&lt;/span&gt;&lt;span&gt;&lt;strong&gt;AOFé‡å†™ç¼“å†²åŒº&lt;/strong&gt;â€ä¿å­˜è¿™éƒ¨åˆ†æ–°æ•°æ®ï¼Œæœ€åçˆ¶è¿›ç¨‹å°†AOFé‡å†™ç¼“å†²åŒºçš„æ•°æ®å†™å…¥æ–°çš„AOFæ–‡ä»¶ä¸­ç„¶åä½¿ç”¨æ–°AOFæ–‡ä»¶æ›¿æ¢è€æ–‡ä»¶ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;6379&lt;/span&gt;&amp;gt;&lt;span&gt; bgrewriteoaf
OK&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;&lt;span&gt;è‡ªåŠ¨è§¦å‘&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;ã€€ã€€å’ŒRDBä¸€æ ·ï¼Œé…ç½®åœ¨redis.confæ–‡ä»¶é‡Œï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨CONFIG SETå‘½ä»¤è®¾ç½®ã€‚æˆ‘ä»¬å…ˆçœ‹æ¥çœ‹AOFç›¸å…³é…ç½®ï¼š&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;64&quot;&gt;
&lt;pre&gt;
&lt;span&gt;############################## APPEND ONLY MODE ###############################

# By default Redis asynchronously dumps the dataset on disk. This mode is
# good enough &lt;/span&gt;&lt;span&gt;in&lt;/span&gt;&lt;span&gt; many applications, but an issue with the Redis process or
# a power outage may result into a few minutes of writes lost (depending on
# the configured save points).
#
# The Append Only File is an alternative persistence mode that provides
# much better durability. For instance using the default data fsync policy
# (see later &lt;/span&gt;&lt;span&gt;in&lt;/span&gt; the config &lt;span&gt;file&lt;/span&gt;) Redis can lose just one second of writes &lt;span&gt;in&lt;/span&gt;&lt;span&gt; a
# dramatic event like a server power outage, or a single &lt;/span&gt;&lt;span&gt;write&lt;/span&gt; &lt;span&gt;if&lt;/span&gt;&lt;span&gt; something
# wrong with the Redis process itself happens, but the operating system is
# still running correctly.
#
# AOF and RDB persistence can be enabled at the same &lt;/span&gt;&lt;span&gt;time&lt;/span&gt;&lt;span&gt; without problems.
# If the AOF is enabled on startup Redis will load the AOF, that is the &lt;/span&gt;&lt;span&gt;file&lt;/span&gt;&lt;span&gt;
# with the better durability guarantees.
#
# Please check http:&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;redis.io/topics/persistence for more information.&lt;/span&gt;
&lt;span&gt;&lt;span&gt;
appendonly no&lt;/span&gt;

# The name of the append only &lt;/span&gt;&lt;span&gt;file&lt;/span&gt; (default: &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;appendonly.aof&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

&lt;span&gt;appendfilename &lt;/span&gt;&lt;/span&gt;&lt;span&gt;&quot;appendonly.aof&quot;&lt;/span&gt;&lt;span&gt;

# The fsync() call tells the Operating System to actually &lt;/span&gt;&lt;span&gt;write&lt;/span&gt;&lt;span&gt; data on disk
# instead of waiting &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; &lt;span&gt;more&lt;/span&gt; data &lt;span&gt;in&lt;/span&gt;&lt;span&gt; the output buffer. Some OS will really flush
# data on disk, some other OS will just try to &lt;/span&gt;&lt;span&gt;do&lt;/span&gt;&lt;span&gt; it ASAP.
#
# Redis supports three different modes:
#
# no: don&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;t fsync, just let the OS flush the data when it wants. Faster.&lt;/span&gt;
# always: fsync after every &lt;span&gt;write&lt;/span&gt;&lt;span&gt; to the append only log. Slow, Safest.
# everysec: fsync only one &lt;/span&gt;&lt;span&gt;time&lt;/span&gt;&lt;span&gt; every second. Compromise.
#
# The default is &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;everysec&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, as that&lt;span&gt;'&lt;/span&gt;&lt;span&gt;s usually the right compromise between&lt;/span&gt;
# speed and data safety. It&lt;span&gt;'&lt;/span&gt;&lt;span&gt;s up to you to understand if you can relax this to&lt;/span&gt;
# &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;no&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; that will let the operating system flush the output buffer when
# it wants, &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; better performances (but &lt;span&gt;if&lt;/span&gt;&lt;span&gt; you can live with the idea of
# some data loss consider the default persistence mode that&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;s snapshotting),&lt;/span&gt;
# or on the contrary, use &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;always&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; that&lt;span&gt;'&lt;/span&gt;&lt;span&gt;s very slow but a bit safer than&lt;/span&gt;
&lt;span&gt;# everysec.
#
# More details please check the following article:
# http:&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;antirez.com/post/redis-persistence-demystified.html&lt;/span&gt;
&lt;span&gt;#
# If unsure, use &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;everysec&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;.

# appendfsync always
&lt;span&gt;appendfsync everysec&lt;/span&gt;
# appendfsync no

# When the AOF fsync policy is set to always or everysec, and a background
# saving process (a background save or AOF log background rewriting) is
# performing a lot of I&lt;/span&gt;/O against the disk, &lt;span&gt;in&lt;/span&gt;&lt;span&gt; some Linux configurations
# Redis may block too &lt;/span&gt;&lt;span&gt;long&lt;/span&gt; on the fsync() call. Note that there is no fix &lt;span&gt;for&lt;/span&gt;&lt;span&gt;
# this currently, as even performing fsync &lt;/span&gt;&lt;span&gt;in&lt;/span&gt;&lt;span&gt; a different thread will block
# our synchronous &lt;/span&gt;&lt;span&gt;write&lt;/span&gt;(&lt;span&gt;2&lt;/span&gt;&lt;span&gt;) call.
#
# In order to mitigate this problem it&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;s possible to use the following option&lt;/span&gt;
# that will prevent fsync() from being called &lt;span&gt;in&lt;/span&gt; the main process &lt;span&gt;while&lt;/span&gt;&lt;span&gt; a
# BGSAVE or BGREWRITEAOF is &lt;/span&gt;&lt;span&gt;in&lt;/span&gt;&lt;span&gt; progress.
#
# This means that &lt;/span&gt;&lt;span&gt;while&lt;/span&gt;&lt;span&gt; another child is saving, the durability of Redis is
# the same as &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;appendfsync none&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;. In practical terms, this means that it is
# possible to lose up to &lt;/span&gt;&lt;span&gt;30&lt;/span&gt; seconds of log &lt;span&gt;in&lt;/span&gt;&lt;span&gt; the worst scenario (with the
# default Linux settings).
#
# If you have latency problems turn this to &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;yes&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;. Otherwise leave it as
# &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;no&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; that is the safest pick from the point of view of durability.

&lt;span&gt;no&lt;/span&gt;&lt;/span&gt;&lt;span&gt;-appendfsync-on-&lt;/span&gt;&lt;span&gt;&lt;span&gt;rewrite no&lt;/span&gt;

# Automatic rewrite of the append only &lt;/span&gt;&lt;span&gt;file&lt;/span&gt;&lt;span&gt;.
# Redis is able to automatically rewrite the log &lt;/span&gt;&lt;span&gt;file&lt;/span&gt;&lt;span&gt; implicitly calling
# BGREWRITEAOF when the AOF log size grows by the specified percentage.
#
# This is how it works: Redis remembers the size of the AOF &lt;/span&gt;&lt;span&gt;file&lt;/span&gt;&lt;span&gt; after the
# latest rewrite (&lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; no rewrite has happened since the restart, the size of
# the AOF at startup is used).
#
# This base size is compared to the current size. If the current size is
# bigger than the specified percentage, the rewrite is triggered. Also
# you need to specify a minimal size &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; the AOF &lt;span&gt;file&lt;/span&gt;&lt;span&gt; to be rewritten, this
# is useful to avoid rewriting the AOF &lt;/span&gt;&lt;span&gt;file&lt;/span&gt; even &lt;span&gt;if&lt;/span&gt;&lt;span&gt; the percentage increase
# is reached but it is still pretty small.
#
# Specify a percentage of zero &lt;/span&gt;&lt;span&gt;in&lt;/span&gt;&lt;span&gt; order to disable the automatic AOF
# rewrite feature.

&lt;span&gt;auto&lt;/span&gt;&lt;/span&gt;&lt;span&gt;-aof-rewrite-percentage 100
auto-aof-rewrite-min-&lt;/span&gt;&lt;span&gt;&lt;span&gt;size 64mb&lt;/span&gt;

# An AOF &lt;/span&gt;&lt;span&gt;file&lt;/span&gt;&lt;span&gt; may be found to be truncated at the end during the Redis
# startup process, when the AOF data gets loaded back into memory.
# This may happen when the system where Redis is running
# crashes, especially when an ext4 filesystem is mounted without the
# data&lt;/span&gt;=ordered option (however this can&lt;span&gt;'&lt;/span&gt;&lt;span&gt;t happen when Redis itself&lt;/span&gt;
&lt;span&gt;# crashes or aborts but the operating system still works correctly).
#
# Redis can either exit with an error when this happens, or load as much
# data as possible (the default now) and start &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; the AOF &lt;span&gt;file&lt;/span&gt;&lt;span&gt; is found
# to be truncated at the end. The following option controls this behavior.
#
# If aof&lt;/span&gt;-load-truncated is set to yes, a truncated AOF &lt;span&gt;file&lt;/span&gt;&lt;span&gt; is loaded and
# the Redis server starts emitting a log to inform the user of the event.
# Otherwise &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; the option is set to no, the server aborts with an error
# and refuses to start. When the option is set to no, the user requires
# to fix the AOF &lt;/span&gt;&lt;span&gt;file&lt;/span&gt; using the &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;redis-check-aof&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; utility before to restart
# the server.
#
# Note that &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; the AOF &lt;span&gt;file&lt;/span&gt; will be found to be corrupted &lt;span&gt;in&lt;/span&gt;&lt;span&gt; the middle
# the server will still exit with an error. This option only applies when
# Redis will try to read &lt;/span&gt;&lt;span&gt;more&lt;/span&gt; data from the AOF &lt;span&gt;file&lt;/span&gt;&lt;span&gt; but not enough bytes
# will be found.
&lt;span&gt;aof&lt;/span&gt;&lt;/span&gt;&lt;span&gt;-load-&lt;/span&gt;&lt;span&gt;&lt;span&gt;truncated yes&lt;/span&gt;

# When rewriting the AOF &lt;/span&gt;&lt;span&gt;file&lt;/span&gt;, Redis is able to use an RDB preamble &lt;span&gt;in&lt;/span&gt;&lt;span&gt; the
# AOF &lt;/span&gt;&lt;span&gt;file&lt;/span&gt; &lt;span&gt;for&lt;/span&gt;&lt;span&gt; faster rewrites and recoveries. When this option is turned
# on the rewritten AOF &lt;/span&gt;&lt;span&gt;file&lt;/span&gt;&lt;span&gt; is composed of two different stanzas:
#
#   [RDB &lt;/span&gt;&lt;span&gt;file&lt;/span&gt;][AOF &lt;span&gt;tail&lt;/span&gt;&lt;span&gt;]
#
# When loading Redis recognizes that the AOF &lt;/span&gt;&lt;span&gt;file&lt;/span&gt; starts with the &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;REDIS&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
# &lt;/span&gt;&lt;span&gt;string&lt;/span&gt; and loads the prefixed RDB &lt;span&gt;file&lt;/span&gt;&lt;span&gt;, and continues loading the AOF
# &lt;/span&gt;&lt;span&gt;tail&lt;/span&gt;&lt;span&gt;.
#
# This is currently turned off by default &lt;/span&gt;&lt;span&gt;in&lt;/span&gt;&lt;span&gt; order to avoid the surprise
# of a format change, but will at some point be used as the default.
&lt;span&gt;aof&lt;/span&gt;&lt;/span&gt;&lt;span&gt;-use-rdb-preamble no&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;&lt;li&gt;appendonlyï¼šæ˜¯å¦æ‰“å¼€AOFæŒä¹…åŒ–åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;appendfilenameï¼šAOFæ–‡ä»¶åç§°&lt;/li&gt;
&lt;li&gt;appendfsyncï¼šåŒæ­¥é¢‘ç‡&lt;/li&gt;
&lt;li&gt;&lt;span&gt;auto-aof-rewrite-min-sizeï¼šå¦‚æœæ–‡ä»¶å¤§å°å°äºæ­¤å€¼ä¸ä¼šè§¦å‘AOFï¼Œé»˜è®¤64MB&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;auto-aof-rewrite-percentageï¼šRedisè®°å½•æœ€è¿‘çš„ä¸€æ¬¡AOFæ“ä½œçš„æ–‡ä»¶å¤§å°ï¼Œå¦‚æœå½“å‰AOFæ–‡ä»¶å¤§å°å¢é•¿è¶…è¿‡è¿™ä¸ªç™¾åˆ†æ¯”åˆ™è§¦å‘ä¸€æ¬¡é‡å†™ï¼Œé»˜è®¤100&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;span&gt;ã€€ã€€&lt;span&gt;è¿™é‡Œä»‹ç»ä¸€ä¸‹appendfsyncå‚æ•°çš„å¯é…ç½®å€¼&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;span&gt;&lt;span&gt;alwaysï¼šå‘½ä»¤å†™å…¥aofç¼“å†²åŒºåï¼Œæ¯ä¸€æ¬¡å†™å…¥éƒ½éœ€è¦åŒæ­¥ï¼Œ&lt;span&gt;ç›´åˆ°å†™å…¥ç£ç›˜ï¼ˆé˜»å¡ï¼Œç³»ç»Ÿè°ƒç”¨fsyncï¼‰ç»“æŸåè¿”å›&lt;/span&gt;ã€‚æ˜¾ç„¶å’ŒRedisé«˜æ€§èƒ½èƒŒé“è€Œé©°ï¼Œä¸å»ºè®®é…ç½®&lt;/span&gt;&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;&lt;span&gt;everysecï¼šå‘½ä»¤å†™å…¥aofç¼“å†²åŒºåï¼Œ&lt;span&gt;åœ¨å†™å…¥ç³»ç»Ÿç¼“å†²åŒº&lt;strong&gt;ç›´æ¥è¿”å›ï¼ˆç³»ç»Ÿè°ƒç”¨writeï¼‰&lt;/strong&gt;ï¼Œç„¶åæœ‰ä¸“é—¨çº¿ç¨‹æ¯ç§’æ‰§è¡Œå†™å…¥ç£ç›˜ï¼ˆé˜»å¡ï¼Œç³»ç»Ÿè°ƒç”¨fsyncï¼‰åè¿”å›&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;&lt;span&gt;noï¼šå‘½ä»¤å†™å…¥aofç¼“å†²åŒºåï¼Œ&lt;span&gt;åœ¨å†™å…¥ç³»ç»Ÿç¼“å†²åŒº&lt;strong&gt;ç›´æ¥è¿”å›&lt;/strong&gt;ï¼ˆç³»ç»Ÿè°ƒç”¨writeï¼‰&lt;/span&gt;&lt;/span&gt;ã€‚ä¹‹åå†™å…¥ç£ç›˜ï¼ˆé˜»å¡ï¼Œç³»ç»Ÿè°ƒç”¨fsyncï¼‰çš„æ“ä½œç”±æ“ä½œç³»ç»Ÿè´Ÿè´£ï¼Œ&lt;span&gt;é€šå¸¸æœ€é•¿30s&lt;/span&gt;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;h3&gt;å·¥ä½œåŸç†&lt;/h3&gt;
&lt;p&gt;&lt;span&gt;ã€€ã€€è¿™é‡Œçœ‹ä¸€æ®µaof.cçš„ä»£ç ï¼Œ&lt;span&gt;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°forkå‡ºåä¸º&quot;redis-aof-rewrite&quot;çš„å­è¿›ç¨‹&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;44&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/*&lt;/span&gt;&lt;span&gt; This is how rewriting of the append only file in background works:
 *
 * 1) The user calls BGREWRITEAOF
 * 2) Redis calls this function, that forks():
 *    2a) the child rewrite the append only file in a temp file.
 *    2b) the parent accumulates differences in server.aof_rewrite_buf.
 * 3) When the child finished '2a' exists.
 * 4) The parent will trap the exit code, if it's OK, will append the
 *    data accumulated into server.aof_rewrite_buf into the temp file, and
 *    finally will rename(2) the temp file in the actual file name.
 *    The the new file is reopened as the new append only file. Profit!
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;int&lt;/span&gt; rewriteAppendOnlyFileBackground(&lt;span&gt;void&lt;/span&gt;&lt;span&gt;) {
    pid_t childpid;
    &lt;/span&gt;&lt;span&gt;long&lt;/span&gt; &lt;span&gt;long&lt;/span&gt;&lt;span&gt; start;

    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (server.aof_child_pid != -&lt;span&gt;1&lt;/span&gt; || server.rdb_child_pid != -&lt;span&gt;1&lt;/span&gt;) &lt;span&gt;return&lt;/span&gt;&lt;span&gt; C_ERR;
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (aofCreatePipes() != C_OK) &lt;span&gt;return&lt;/span&gt;&lt;span&gt; C_ERR;
    start &lt;/span&gt;=&lt;span&gt; ustime();
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (&lt;span&gt;(childpid = fork()&lt;/span&gt;) == &lt;span&gt;0&lt;/span&gt;&lt;span&gt;) {
        &lt;/span&gt;&lt;span&gt;char&lt;/span&gt; tmpfile[&lt;span&gt;256&lt;/span&gt;&lt;span&gt;];

        &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt; Child &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
        closeListeningSockets(&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
&lt;span&gt;        redisSetProcTitle(&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&quot;redis-aof-rewrite&quot;&lt;/span&gt;&lt;span&gt;&lt;span&gt;);&lt;/span&gt;
        snprintf(tmpfile,&lt;/span&gt;&lt;span&gt;256&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;temp-rewriteaof-bg-%d.aof&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, (&lt;span&gt;int&lt;/span&gt;&lt;span&gt;) getpid());
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (rewriteAppendOnlyFile(tmpfile) ==&lt;span&gt; C_OK) {
            size_t private_dirty &lt;/span&gt;=&lt;span&gt; zmalloc_get_private_dirty();

            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; (private_dirty) {
                serverLog(LL_NOTICE,
                    &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;AOF rewrite: %zu MB of memory used by copy-on-write&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
                    private_dirty&lt;/span&gt;/(&lt;span&gt;1024&lt;/span&gt;*&lt;span&gt;1024&lt;/span&gt;&lt;span&gt;));
            }
            exitFromChild(&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
        } &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
            exitFromChild(&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
        }
    }&lt;br/&gt;...&lt;br/&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€åŒæ ·æˆ‘ä»¬ä¹Ÿçœ‹ä¸€ä¸‹AOFçš„è¿ä½œæµç¨‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1465200/201904/1465200-20190413190314966-1704443449.png&quot; alt=&quot;&quot; width=&quot;660&quot; height=&quot;573&quot;/&gt;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;æ‰€æœ‰çš„å†™å…¥å‘½ä»¤è¿½åŠ åˆ°&lt;span&gt;aofç¼“å†²åŒº&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;AOFç¼“å†²åŒº&lt;strong&gt;&lt;span&gt;æ ¹æ®å¯¹åº”appendfsyncé…ç½®å‘ç¡¬ç›˜åšåŒæ­¥æ“ä½œ&lt;/span&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å®šæœŸå¯¹AOFæ–‡ä»¶è¿›è¡Œé‡å†™&lt;/li&gt;
&lt;li&gt;Redisé‡å¯æ—¶ï¼Œå¯ä»¥åŠ è½½AOFæ–‡ä»¶è¿›è¡Œæ•°æ®æ¢å¤&lt;/li&gt;
&lt;/ol&gt;&lt;h3&gt;æ¢ç´¢AOFæ–‡ä»¶&lt;/h3&gt;
&lt;p&gt;ã€€ã€€é¦–å…ˆæ‰“å¼€aofåŠŸèƒ½&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;6379&lt;/span&gt;&amp;gt;&lt;span&gt; CONFIG SET appendonly yes
OK

&lt;/span&gt;&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;24&lt;/span&gt;:&lt;span&gt;53.940&lt;/span&gt; * Background append only &lt;span&gt;file&lt;/span&gt; rewriting started by pid &lt;span&gt;59895&lt;/span&gt;
&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;24&lt;/span&gt;:&lt;span&gt;53.964&lt;/span&gt; *&lt;span&gt; AOF rewrite child asks to stop sending diffs.
&lt;/span&gt;&lt;span&gt;59895&lt;/span&gt;:C &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;24&lt;/span&gt;:&lt;span&gt;53.965&lt;/span&gt; *&lt;span&gt; Parent agreed to stop sending diffs. Finalizing AOF...
&lt;/span&gt;&lt;span&gt;59895&lt;/span&gt;:C &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;24&lt;/span&gt;:&lt;span&gt;53.965&lt;/span&gt; * Concatenating &lt;span&gt;0.00&lt;/span&gt; MB of AOF &lt;span&gt;diff&lt;/span&gt;&lt;span&gt; received from parent.
&lt;/span&gt;&lt;span&gt;59895&lt;/span&gt;:C &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;24&lt;/span&gt;:&lt;span&gt;53.966&lt;/span&gt; * SYNC append only &lt;span&gt;file&lt;/span&gt;&lt;span&gt; rewrite performed
&lt;/span&gt;&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;24&lt;/span&gt;:&lt;span&gt;53.996&lt;/span&gt; *&lt;span&gt; Background AOF rewrite terminated with success
&lt;/span&gt;&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;24&lt;/span&gt;:&lt;span&gt;53.996&lt;/span&gt; * Residual parent &lt;span&gt;diff&lt;/span&gt; successfully flushed to the rewritten AOF (&lt;span&gt;0.00&lt;/span&gt;&lt;span&gt; MB)
&lt;/span&gt;&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;24&lt;/span&gt;:&lt;span&gt;53.997&lt;/span&gt; * Background AOF rewrite finished successfully
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€ç„¶åæˆ‘ä»¬æ”¾ä¸€äº›æ•°æ®ï¼Œå¹¶æ‰§è¡Œbgrewriteaofå‘½ä»¤&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;6379&lt;/span&gt;&amp;gt;&lt;span&gt; CONFIG SET appendonly yes
OK
&lt;/span&gt;&lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;6379&lt;/span&gt;&amp;gt; set miao &lt;span&gt;24&lt;/span&gt;&lt;span&gt;
OK
&lt;/span&gt;&lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;6379&lt;/span&gt;&amp;gt; set miao &lt;span&gt;177&lt;/span&gt;&lt;span&gt;
OK
&lt;/span&gt;&lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;6379&lt;/span&gt;&amp;gt; lpush mlist &lt;span&gt;1&lt;/span&gt;&lt;span&gt;
(integer) &lt;/span&gt;&lt;span&gt;1&lt;/span&gt;
&lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;6379&lt;/span&gt;&amp;gt; lpush mlist &lt;span&gt;2&lt;/span&gt;&lt;span&gt;
(integer) &lt;/span&gt;&lt;span&gt;2&lt;/span&gt;
&lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;6379&lt;/span&gt;&amp;gt; lpush mlist &lt;span&gt;3&lt;/span&gt;&lt;span&gt;
(integer) &lt;/span&gt;&lt;span&gt;3&lt;/span&gt;
&lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;6379&lt;/span&gt;&amp;gt; keys *
&lt;span&gt;1&lt;/span&gt;) &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;miao&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;
&lt;span&gt;2&lt;/span&gt;) &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;mlist&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹aofæ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
*&lt;span&gt;2&lt;/span&gt;&lt;span&gt;
$&lt;/span&gt;&lt;span&gt;6&lt;/span&gt;&lt;span&gt;
SELECT
$&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;
&lt;span&gt;0&lt;/span&gt;
*&lt;span&gt;3&lt;/span&gt;&lt;span&gt;
$&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;&lt;span&gt;
SET
$&lt;/span&gt;&lt;span&gt;4&lt;/span&gt;&lt;span&gt;
miao
$&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;
&lt;span&gt;177&lt;/span&gt;
*&lt;span&gt;2&lt;/span&gt;&lt;span&gt;
$&lt;/span&gt;&lt;span&gt;6&lt;/span&gt;&lt;span&gt;
SELECT
$&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;
&lt;span&gt;0&lt;/span&gt;
*&lt;span&gt;3&lt;/span&gt;&lt;span&gt;
$&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;&lt;span&gt;
lpush
$&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;&lt;span&gt;
mlist
$&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;
&lt;span&gt;1&lt;/span&gt;
*&lt;span&gt;3&lt;/span&gt;&lt;span&gt;
$&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;&lt;span&gt;
lpush
$&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;&lt;span&gt;
mlist
$&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;
&lt;span&gt;2&lt;/span&gt;
*&lt;span&gt;3&lt;/span&gt;&lt;span&gt;
$&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;&lt;span&gt;
lpush
$&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;&lt;span&gt;
mlist
$&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;
&lt;span&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€è¿™æ—¶å€™æˆ‘ä»¬æ‰‹åŠ¨æ‰§è¡Œaofé‡å†™å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;127.0&lt;/span&gt;.&lt;span&gt;0.1&lt;/span&gt;:&lt;span&gt;6379&lt;/span&gt;&amp;gt;&lt;span&gt; bgrewriteaof
Background append only &lt;/span&gt;&lt;span&gt;file&lt;/span&gt;&lt;span&gt; rewriting started

&lt;/span&gt;&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;29&lt;/span&gt;:&lt;span&gt;31.017&lt;/span&gt; * &lt;span&gt;10&lt;/span&gt; changes &lt;span&gt;in&lt;/span&gt; &lt;span&gt;300&lt;/span&gt;&lt;span&gt; seconds. Saving...
&lt;/span&gt;&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;29&lt;/span&gt;:&lt;span&gt;31.017&lt;/span&gt; * Background saving started by pid &lt;span&gt;59905&lt;/span&gt;
&lt;span&gt;59905&lt;/span&gt;:C &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;29&lt;/span&gt;:&lt;span&gt;31.020&lt;/span&gt; *&lt;span&gt; DB saved on disk
&lt;/span&gt;&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;29&lt;/span&gt;:&lt;span&gt;31.120&lt;/span&gt; *&lt;span&gt; Background saving terminated with success
&lt;/span&gt;&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;29&lt;/span&gt;:&lt;span&gt;49.409&lt;/span&gt; * Background append only &lt;span&gt;file&lt;/span&gt; rewriting started by pid &lt;span&gt;59906&lt;/span&gt;
&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;29&lt;/span&gt;:&lt;span&gt;49.433&lt;/span&gt; *&lt;span&gt; AOF rewrite child asks to stop sending diffs.
&lt;/span&gt;&lt;span&gt;59906&lt;/span&gt;:C &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;29&lt;/span&gt;:&lt;span&gt;49.433&lt;/span&gt; *&lt;span&gt; Parent agreed to stop sending diffs. Finalizing AOF...
&lt;/span&gt;&lt;span&gt;59906&lt;/span&gt;:C &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;29&lt;/span&gt;:&lt;span&gt;49.434&lt;/span&gt; * Concatenating &lt;span&gt;0.00&lt;/span&gt; MB of AOF &lt;span&gt;diff&lt;/span&gt;&lt;span&gt; received from parent.
&lt;/span&gt;&lt;span&gt;59906&lt;/span&gt;:C &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;29&lt;/span&gt;:&lt;span&gt;49.434&lt;/span&gt; * SYNC append only &lt;span&gt;file&lt;/span&gt;&lt;span&gt; rewrite performed
&lt;/span&gt;&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;29&lt;/span&gt;:&lt;span&gt;49.533&lt;/span&gt; *&lt;span&gt; Background AOF rewrite terminated with success
&lt;/span&gt;&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;29&lt;/span&gt;:&lt;span&gt;49.533&lt;/span&gt; * Residual parent &lt;span&gt;diff&lt;/span&gt; successfully flushed to the rewritten AOF (&lt;span&gt;0.00&lt;/span&gt;&lt;span&gt; MB)
&lt;/span&gt;&lt;span&gt;59117&lt;/span&gt;:M &lt;span&gt;13&lt;/span&gt; Apr &lt;span&gt;19&lt;/span&gt;:&lt;span&gt;29&lt;/span&gt;:&lt;span&gt;49.534&lt;/span&gt; * Background AOF rewrite finished successfully
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€ç„¶åå†çœ‹ä¸€ä¸‹æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
*&lt;span&gt;2&lt;/span&gt;&lt;span&gt;
$&lt;/span&gt;&lt;span&gt;6&lt;/span&gt;&lt;span&gt;
SELECT
$&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;
&lt;span&gt;0&lt;/span&gt;
*&lt;span&gt;3&lt;/span&gt;&lt;span&gt;
$&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;&lt;span&gt;
SET
$&lt;/span&gt;&lt;span&gt;4&lt;/span&gt;&lt;span&gt;
miao
$&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;
&lt;span&gt;177&lt;/span&gt;
*&lt;span&gt;5&lt;/span&gt;&lt;span&gt;
$&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;&lt;span&gt;
RPUSH
$&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;&lt;span&gt;
mlist
$&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;
&lt;span&gt;3&lt;/span&gt;&lt;span&gt;
$&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;
&lt;span&gt;2&lt;/span&gt;&lt;span&gt;
$&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;
&lt;span&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€ä¸ºä»€ä¹ˆAOFæ–‡ä»¶ä¼šå˜å°ï¼Ÿä¸ºäº†è§£å†³AOFæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼ŒRediså¼•å…¥é‡å†™æœºåˆ¶æ¥ç¼©å°æ–‡ä»¶ä½“ç§¯ï¼Œä½“ç§¯å˜å°å› ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;span&gt;å¤šæ¡å†™å…¥å‘½ä»¤å¯ä»¥åˆå¹¶æˆä¸€æ¡&lt;/span&gt;ã€‚æ¯”å¦‚ä¸Šé¢çš„lpushå‘½ä»¤äº†3æ¬¡ï¼Œæœ€ååˆå¹¶æˆ1æ¡&lt;/li&gt;
&lt;li&gt;é‡å†™åAOFæ–‡ä»¶&lt;span&gt;åªä¿ç•™æœ€ç»ˆæ•°æ®çš„å†™å…¥å‘½ä»¤&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;h3&gt;ä¼˜ç¼ºç‚¹&lt;/h3&gt;
&lt;p&gt;ã€€ã€€AOFæŒä¹…åŒ–æ–¹å¼çš„ä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;åšåˆ°æœ€å¤šä¸¢å¤±1-2så†…çš„æ•°æ®ï¼ˆ&lt;span&gt;æœ€å¤šä¸¢å¤±2sæ•°æ®ï¼Œå› ä¸º&lt;strong&gt;AOFè¿½åŠ é˜»å¡&lt;/strong&gt;&lt;/span&gt;ï¼‰&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;ã€€ã€€AOFæŒä¹…åŒ–æ–¹å¼çš„ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;AOFæ–‡ä»¶æ¯”RDBæ–‡ä»¶å¤§&lt;/li&gt;
&lt;li&gt;å¯èƒ½å¯¼è‡´&lt;strong&gt;&lt;span&gt;è¿½åŠ é˜»å¡&lt;/span&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;span&gt;ä¹¦ç±å‚è€ƒå’Œä¸Šæ–‡ä¸€æ ·&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;a href=&quot;https://www.cnblogs.com/huangxincheng/p/5010795.html&quot;&gt;https://www.cnblogs.com/huangxincheng/p/5010795.html&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Sat, 13 Apr 2019 12:01:00 +0000</pubDate>
<dc:creator>GrimMjx</dc:creator>
<og:description>å‰è¨€ å› ä¸ºRedisçš„æ•°æ®éƒ½å‚¨å­˜åœ¨å†…å­˜ä¸­ï¼Œå½“è¿›ç¨‹é€€å‡ºæ—¶ï¼Œæ‰€æœ‰æ•°æ®éƒ½å°†ä¸¢å¤±ã€‚ä¸ºäº†ä¿è¯æ•°æ®å®‰å…¨ï¼ŒRedisæ”¯æŒRDBå’ŒAOFä¸¤ç§æŒä¹…åŒ–æœºåˆ¶æœ‰æ•ˆé¿å…æ•°æ®ä¸¢å¤±é—®é¢˜ã€‚RDBå¯ä»¥çœ‹ä½œåœ¨æŸä¸€æ—¶åˆ»Redisçš„å¿«ç…§ï¼ˆ</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/GrimMjx/p/10695512.html</dc:identifier>
</item>
<item>
<title>MySQLè‡ªå®šä¹‰å‡½æ•°ä¸å­˜å‚¨è¿‡ç¨‹ - ç§¦æ— æ®‡</title>
<link>http://www.cnblogs.com/webDepOfQWS/p/10691557.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/webDepOfQWS/p/10691557.html</guid>
<description>&lt;h3 id=&quot;å‰ç½®æ¡ä»¶&quot;&gt;1ã€å‰ç½®æ¡ä»¶&lt;/h3&gt;
&lt;p&gt;MySQLæ•°æ®åº“ä¸­å­˜åœ¨è¡¨user_infoï¼Œå…¶ç»“æ„å’Œæ•°æ®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;mysql&amp;gt; desc  user_info;
+-----------+----------+------+-----+---------+-------+
| Field     | Type     | Null | Key | Default | Extra |
+-----------+----------+------+-----+---------+-------+
| id        | int(10)  | NO   | PRI | NULL    |       |
| name      | char(20) | NO   |     | NULL    |       |
| passwd    | char(40) | NO   |     | NULL    |       |
| email     | char(20) | NO   |     | NULL    |       |
| phone     | char(20) | NO   |     | NULL    |       |
| role      | char(10) | NO   |     | NULL    |       |
| sex       | char(10) | NO   |     | NULL    |       |
| status    | int(10)  | NO   |     | NULL    |       |
| createAt  | datetime | NO   |     | NULL    |       |
| exprAt    | datetime | NO   |     | NULL    |       |
| validDays | int(10)  | NO   |     | NULL    |       |
| delAt     | datetime | YES  |     | NULL    |       |
+-----------+----------+------+-----+---------+-------+
12 rows in set (0.10 sec)

mysql&amp;gt; select  * from  user_info;
+----+--------------+----------+------------+-------------+--------+------+--------+---------------------+---------------------+-----------+-------+
| id | name         | passwd   | email      | phone       | role   | sex  | status | createAt            | exprAt              | validDays | delAt |
+----+--------------+----------+------------+-------------+--------+------+--------+---------------------+---------------------+-----------+-------+
|  1 | StephenWang7 | py123456 | 123@qq.com | 15103887470 | admin  | male |    200 | 2019-04-12 20:11:30 | 2019-04-19 20:11:30 |        30 | NULL  |
|  2 | StephenWang8 | 123456   | 123@qq.com | 15103887470 | viewer | male |    200 | 2019-04-12 20:11:30 | 2019-04-19 20:11:30 |        30 | NULL  |
+----+--------------+----------+------------+-------------+--------+------+--------+---------------------+---------------------+-----------+-------+
2 rows in set (0.00 sec)&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;è‡ªå®šä¹‰å‡½æ•°&quot;&gt;2ã€è‡ªå®šä¹‰å‡½æ•°&lt;/h3&gt;
&lt;p&gt;å‡½æ•°ï¼šå¯ä»¥å®Œæˆç‰¹å®šåŠŸèƒ½çš„ä¸€æ®µSQLé›†åˆã€‚MySQLæ”¯æŒè‡ªå®šä¹‰å‡½æ•°æ¥å®Œæˆç‰¹å®šçš„ä¸šåŠ¡åŠŸèƒ½ã€‚&lt;br/&gt;åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°ï¼ˆUser Defined Function ç®€ç§°UDFï¼‰çš„è¯­æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;create function &amp;lt;å‡½æ•°åç§°&amp;gt; ï¼ˆ[å‚æ•°1] [ç±»å‹1], [å‚æ•°N] [ç±»å‹N]ï¼‰
returns &amp;lt;ç±»å‹&amp;gt;
return 
&amp;lt;å‡½æ•°ä¸»ä½“&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è°ƒç”¨UDFçš„è¯­æ³•å¦‚ä¸‹ï¼š&lt;br/&gt;&lt;code&gt;select &amp;lt;å‡½æ•°åç§°&amp;gt; ([å‚æ•°])&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;åˆ›å»ºæ— å‚çš„udf&quot;&gt;åˆ›å»ºæ— å‚çš„UDF&lt;/h4&gt;
&lt;p&gt;ç¤ºä¾‹1ï¼šæŸ¥è¯¢user_infoè¡¨ä¸­æœ‰å¤šå°‘æ¡è®°å½•&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;#å®šä¹‰å‡½æ•°
mysql&amp;gt; create function  user_info_count()
    -&amp;gt; returns int(10)
    -&amp;gt; return
    -&amp;gt; (select  count(*) from user_info);
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è°ƒç”¨å‡½æ•°user_info_count()&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;mysql&amp;gt; select  user_info_count();
+-------------------+
| user_info_count() |
+-------------------+
|                 2 |
+-------------------+
1 row in set (0.00 sec)
&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;åˆ›å»ºæœ‰å‚udf&quot;&gt;åˆ›å»ºæœ‰å‚UDF&lt;/h4&gt;
&lt;p&gt;ç¤ºä¾‹2ï¼šæ ¹æ®idæŸ¥è¯¢ç”¨æˆ·nameã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;#å®šä¹‰å‡½æ•°
mysql&amp;gt; create function  queryNameById(uid int(10))
    -&amp;gt; returns char(20)
    -&amp;gt; return
    -&amp;gt; (select  name  from   user_info  where id=uid);
Query OK, 0 rows affected (0.01 sec)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è°ƒç”¨å‡½æ•°ï¼ŒæŸ¥è¯¢idä¸º1çš„ç”¨æˆ·åç§°ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;mysql&amp;gt; select  queryNameById(1);
+------------------+
| queryNameById(1) |
+------------------+
| StephenWang7     |
+------------------+
1 row in set (0.00 sec)
&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;æŸ¥çœ‹udf&quot;&gt;æŸ¥çœ‹UDF&lt;/h4&gt;
&lt;p&gt;æŸ¥è¯¢ç³»ç»Ÿä¸­æ‰€æœ‰çš„UDF&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;show function status;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æŸ¥è¯¢æŒ‡å®šçš„UDF&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;#
show   create function   å‡½æ•°åç§°;
mysql&amp;gt; show  function   queryNameById;
ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'queryNameById' at line 1
mysql&amp;gt; show  function   queryNameById();
ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'queryNameById()' at line 1
mysql&amp;gt; show   create function   queryNameById();
ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '()' at line 1
mysql&amp;gt; show   create function   queryNameById;
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------+
| Function      | sql_mode                                                                                                                                  | Create Function                                                                                                                                               | character_set_client | collation_connection | Database Collation |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------+
| queryNameById | ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION | CREATE DEFINER=`root`@`localhost` FUNCTION `queryNameById`(uid int(10)) RETURNS char(20) CHARSET latin1
return (select  name  from   user_info  where id=uid) | utf8                 | utf8_general_ci      | latin1_swedish_ci  |
+---------------+-------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------+
1 row in set (0.00 sec
&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;ä¿®æ”¹udf&quot;&gt;ä¿®æ”¹UDF&lt;/h4&gt;
&lt;p&gt;å¦‚æœæƒ³è¦ä¿®æ”¹å‡½æ•°çš„å†…å®¹ï¼Œå…ˆåˆ é™¤åå†é‡æ–°åˆ›å»ºã€‚&lt;/p&gt;
&lt;h4 id=&quot;åˆ é™¤udf&quot;&gt;åˆ é™¤UDF&lt;/h4&gt;
&lt;p&gt;åˆ é™¤UDFè¯­æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;drop function  &amp;lt;å‡½æ•°åç§°&amp;gt;;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç¤ºä¾‹3ï¼šåˆ é™¤å‡½æ•°queryNameIdåå†æ¬¡è°ƒç”¨å¹¶è§‚å¯Ÿç°è±¡ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;mysql&amp;gt; drop  function queryNameById;
Query OK, 0 rows affected (0.45 sec)

mysql&amp;gt; select queryNameById(1);
ERROR 1305 (42000): FUNCTION rms.queryNameById does not exist
mysql&amp;gt; 

&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;å­˜å‚¨è¿‡ç¨‹&quot;&gt;3ã€å­˜å‚¨è¿‡ç¨‹&lt;/h3&gt;
&lt;p&gt;å­˜å‚¨åŠŸèƒ½å’Œè‡ªå®šä¹‰å‡½æ•°ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ç»„å®Œæˆç‰¹å®šåŠŸèƒ½çš„SQLè¯­å¥é›†åˆã€‚æŠŠå¤æ‚æˆ–é¢‘ç¹è°ƒç”¨çš„SQLæå‰å†™å¥½å¹¶æŒ‡å®šä¸€ä¸ªåç§°ã€‚å¾…åˆ°è¦ä½¿ç”¨æ—¶ï¼Œç›´æ¥è°ƒç”¨å³å¯ã€‚&lt;br/&gt;å®šä¹‰å­˜å‚¨è¿‡ç¨‹çš„è¯­æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;CREATE PROCEDURE &amp;lt;è¿‡ç¨‹å&amp;gt; ( [è¿‡ç¨‹å‚æ•°[,â€¦] ] ) &amp;lt;è¿‡ç¨‹ä½“&amp;gt;
[è¿‡ç¨‹å‚æ•°[,â€¦] ] æ ¼å¼
[ IN | OUT | INOUT ] &amp;lt;å‚æ•°å&amp;gt; &amp;lt;ç±»å‹&amp;gt;
#è¯­æ³•å®šä¹‰æ¥è‡ªï¼šhttp://c.biancheng.net/view/2593.html&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;åˆ›å»ºæ— å‚çš„å­˜å‚¨è¿‡ç¨‹&quot;&gt;åˆ›å»ºæ— å‚çš„å­˜å‚¨è¿‡ç¨‹&lt;/h4&gt;
&lt;p&gt;ç¤ºä¾‹4ï¼šæŸ¥è¯¢ç”¨æˆ·nameã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;mysql&amp;gt; DELIMITER //
mysql&amp;gt; craete procedure queryName()
    -&amp;gt; begin
    -&amp;gt; select  name from user_info;
    -&amp;gt; end //&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å…³äºDELIMITERå‘½ä»¤ï¼Œä¿®æ”¹MySQLç»“æŸå‘½ä»¤çš„å­—ç¬¦ã€‚é»˜è®¤çš„ç»“æŸå‘½ä»¤å­—ç¬¦ä¸ºåˆ†å·ï¼Œå½“å­˜å‚¨è¿‡ç¨‹ä¸­åŒ…å«å¤šæ¡è¯­å¥æ—¶ï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªåˆ†å·ä¼šä½œä¸ºå­˜å‚¨è¿‡ç¨‹ç»“æŸçš„æ ‡å¿—ã€‚è¿™æ ·ä¸ç¬¦åˆé¢„æœŸï¼Œå› æ­¤éœ€è¦ä¿®æ”¹é»˜è®¤ç»“æŸå‘½ä»¤å­—ç¬¦ã€‚ DELIMITER //å°±æ˜¯å°†ç»“æŸå‘½ä»¤å­—ç¬¦ä¿®æ”¹ä¸º//ã€‚è°ƒç”¨å­˜å‚¨è¿‡ç¨‹çš„å‘½ä»¤ä¸ºï¼šcall å­˜å‚¨è¿‡ç¨‹åç§°ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;#æ­¤æ—¶çš„å‘½ä»¤çš„ç»“æŸç¬¦å·ä¸º// ä¸æ˜¯;
mysql&amp;gt; call  queryName()//
+--------------+
| name         |
+--------------+
| StephenWang7 |
| StephenWang8 |
+--------------+
2 rows in set (0.00 sec)

Query OK, 0 rows affected (0.00 sec)
&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;åˆ›å»ºå¸¦å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹&quot;&gt;åˆ›å»ºå¸¦å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹&lt;/h4&gt;
&lt;p&gt;ç¤ºä¾‹5ï¼šæ ¹æ®idæŸ¥è¯¢nameã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;mysql&amp;gt; create procedure  queryNameById
    -&amp;gt; (In uid int(15))
    -&amp;gt; begin
    -&amp;gt; select  name  from  user_info where id=uid;
    -&amp;gt; end
    -&amp;gt; //
Query OK, 0 rows affected (0.03 sec)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è°ƒç”¨å­˜å‚¨è¿‡ç¨‹queryNameById&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;mysql&amp;gt; call queryNameById(1);
    -&amp;gt; //
+--------------+
| name         |
+--------------+
| StephenWang7 |
+--------------+
1 row in set (0.03 sec)

Query OK, 0 rows affected (0.04 sec)&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹&quot;&gt;ä¿®æ”¹å­˜å‚¨è¿‡ç¨‹&lt;/h4&gt;
&lt;p&gt;å¦‚æœæƒ³åˆ›å»ºå­˜å‚¨è¿‡ç¨‹çš„å†…å®¹å¯ä»¥å…ˆåˆ é™¤å†é‡æ–°åˆ›å»ºå­˜å‚¨è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h4 id=&quot;æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹&quot;&gt;æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹&lt;/h4&gt;
&lt;pre&gt;
&lt;code&gt;show create procedure &amp;lt;è¿‡ç¨‹åç§°&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;mysql&amp;gt; show create procedure queryNameById; -&amp;gt; // +---------------+-------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------+ | Procedure | sql_mode | Create Procedure | character_set_client | collation_connection | Database Collation | +---------------+-------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------+ | queryNameById | ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION | CREATE DEFINER=`root`@`localhost` PROCEDURE `queryNameById`(In uid int(15)) begin select name from user_info where id=uid; end | utf8 | utf8_general_ci | latin1_swedish_ci | +---------------+-------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+--------------------+ 1 row in set (0.04 sec)&lt;/code&gt;&lt;/p&gt;
&lt;h4 id=&quot;åˆ é™¤å­˜å‚¨è¿‡ç¨‹&quot;&gt;åˆ é™¤å­˜å‚¨è¿‡ç¨‹&lt;/h4&gt;
&lt;pre&gt;
&lt;code&gt;drop procedure &amp;lt;è¿‡ç¨‹åç§°&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åˆ é™¤å­˜å‚¨è¿‡ç¨‹queryNameById&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;mysql&amp;gt; drop procedure  queryNameById//
Query OK, 0 rows affected (0.02 sec)


mysql&amp;gt; call  queryNameById(1)//
ERROR 1305 (42000): PROCEDURE rms.queryNameById does not exist
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;æ€»ç»“&quot;&gt;4ã€æ€»ç»“&lt;/h3&gt;
&lt;p&gt;è‡ªå®šä¹‰å‡½æ•°å’Œå­˜å‚¨è¿‡ç¨‹éƒ½æ˜¯å®Œæˆç‰¹å®šåŠŸèƒ½çš„SQLé›†åˆï¼Œé‚£ä¹ˆä»–ä»¬æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ&lt;br/&gt;aã€è°ƒç”¨æ–¹å¼ä¸åŒ&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;#è‡ªå®šä¹‰å‡½æ•°
select  &amp;lt;å‡½æ•°å&amp;gt;
#å­˜å‚¨è¿‡ç¨‹
call &amp;lt;å­˜å‚¨è¿‡ç¨‹å&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;bã€è‡ªå®šä¹‰å‡½æ•°ä¸èƒ½æœ‰è¾“å‡ºå‚æ•°ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹å¯ä»¥ã€‚&lt;br/&gt;cã€è‡ªå®šä¹‰å‡½æ•°å¿…é¡»è¦åŒ…å«returnè¯­å¥ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹åˆ™ä¸éœ€è¦ã€‚&lt;/p&gt;
</description>
<pubDate>Sat, 13 Apr 2019 12:01:00 +0000</pubDate>
<dc:creator>ç§¦æ— æ®‡</dc:creator>
<og:description>MySQLè‡ªå®šä¹‰å‡½æ•°çš„åˆ›å»ºä¸ä½¿ç”¨ï¼›å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»ºä¸è°ƒç”¨ã€‚</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/webDepOfQWS/p/10691557.html</dc:identifier>
</item>
</channel>
</rss>