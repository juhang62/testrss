<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>åšå®¢å›­_é¦–é¡µ</title>
<link></link>
<description>ä»£ç æ”¹å˜ä¸–ç•Œ</description>
<item>
<title>Js~å¯¹é”®å€¼å¯¹æ“ä½œ - å¼ å å²­</title>
<link>http://www.cnblogs.com/lori/p/13488618.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/lori/p/13488618.html</guid>
<description>&lt;p&gt;é”®å€¼å¯¹ä¸»è¦æ˜¯é¢å‘å¯¹è±¡è¯­è¨€é‡Œçš„å­—å…¸ï¼Œæˆ–è€…å«å“ˆå¸Œè¡¨ï¼Œå®ƒé€šè¿‡é”®(key)å¯ä»¥ç›´æ¥è®¿é—®åˆ°å€¼(value)ï¼Œæ‰€ä»¥å®ƒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œå³ä¸€æ¬¡æŸ¥æ‰¾å³å¯æ‰¾åˆ°ç›®æ ‡ï¼›åœ¨.neté‡Œæœ‰Dictionaryï¼Œè€Œåœ¨javaé‡Œæœ‰HashMapç­‰ç»“æ„æ¥å®ç°ï¼Œè€Œåœ¨NoSQLé‡Œä¹Ÿæœ‰redisä¸ºä»£è¡¨çš„é”®å€¼å­˜å‚¨æ•°æ®åº“ï¼›è€Œåœ¨jsé‡Œå¥½åƒæ²¡æœ‰ä¸€ç§å“ˆå¸Œçš„æ•°æ®ç»“æ„ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥å€ŸåŠ©å¯¹è±¡çš„æ¦‚å¿µæ¥å®ç°ï¼Œé”®ç›¸å½“äºå¯¹è±¡é‡Œçš„å±æ€§ï¼Œè€Œå€¼ç›¸å½“äºå±æ€§çš„å€¼ã€‚&lt;/p&gt;

&lt;pre&gt;
&lt;code&gt;var color={};
//åŠ¨æ€æ·»åŠ é”®å€¼å¯¹è±¡
color[&quot;red&quot;]=1;
color[&quot;blue&quot;]=2;
&lt;/code&gt;
&lt;/pre&gt;

&lt;pre&gt;
&lt;code&gt;console.log(color.red);
console.log(color[&quot;blue&quot;]);
&lt;/code&gt;
&lt;/pre&gt;

&lt;pre&gt;
&lt;code&gt;Object.keys(color).forEach(function(key){
     console.log(key,obj[key]);
});
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/118538/202008/118538-20200812084219012-213865261.png&quot; alt=&quot;pic&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 12 Aug 2020 00:42:00 +0000</pubDate>
<dc:creator>å¼ å å²­</dc:creator>
<og:description>é”®å€¼å¯¹ä¸»è¦æ˜¯é¢å‘å¯¹è±¡è¯­è¨€é‡Œçš„å­—å…¸ï¼Œæˆ–è€…å«å“ˆå¸Œè¡¨ï¼Œå®ƒé€šè¿‡é”®(key)å¯ä»¥ç›´æ¥è®¿é—®åˆ°å€¼(value)ï¼Œæ‰€ä»¥å®ƒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œå³ä¸€æ¬¡æŸ¥æ‰¾å³å¯æ‰¾åˆ°ç›®æ ‡ï¼›åœ¨.neté‡Œæœ‰Dictionaryï¼Œè€Œåœ¨ja</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/lori/p/13488618.html</dc:identifier>
</item>
<item>
<title>PowerJob çš„è‡ªå®ç°é«˜å¯ç”¨æ–¹æ¡ˆï¼Œå¦™å¦™å¦™ï¼ - å‰Šå¾®å¯’</title>
<link>http://www.cnblogs.com/xueweihan/p/13477189.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/xueweihan/p/13477189.html</guid>
<description>&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;æœ¬æ–‡é€‚åˆæœ‰ Java åŸºç¡€çŸ¥è¯†çš„äººç¾¤&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200811174153483-2110529700.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä½œè€…ï¼šHelloGitHub-&lt;strong&gt;Salieri&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;HelloGitHub æ¨å‡ºçš„&lt;a href=&quot;https://github.com/HelloGitHub-Team/Article&quot; title=&quot;ã€Šè®²è§£å¼€æºé¡¹ç›®ã€‹&quot;&gt;ã€Šè®²è§£å¼€æºé¡¹ç›®ã€‹&lt;/a&gt;ç³»åˆ—ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç¢ç¢å¿µ&quot;&gt;ç¢ç¢å¿µ&lt;/h2&gt;
&lt;p&gt;é«˜å¯ç”¨æ”¾åˆ°ä»Šå¤©å·²ç»ä¸æ˜¯ä¸€ä¸ªæ–°é¢–çš„è¯æ±‡äº†ï¼Œæ€ä¹ˆå®ç°é«˜å¯ç”¨å¤§å®¶ä¹Ÿå·²ç»äº†ç„¶äºå¿ƒã€‚å¤šå®ä¾‹éƒ¨ç½² + æœåŠ¡æ³¨å†Œ + æœåŠ¡å‘ç°è¿™ä¸€å¥—ç»„åˆæ‹³æ‰“ä¸‹æ¥ï¼Œå®ç°é«˜å¯ç”¨é‚£è¿˜ä¸æ˜¯åˆ†åˆ†é’Ÿçš„äº‹æƒ…ã€‚æ‰€ä»¥å¾ˆå¤šäººçœ‹åˆ° PowerJob çš„ä»‹ç»é¡µé¢ä¸­å†™äº†&lt;strong&gt;ä»»æ„ç»„ä»¶æ”¯æŒé›†ç¾¤éƒ¨ç½²ä»¥å®ç°é«˜å¯ç”¨&lt;/strong&gt;ï¼Œæƒ³å½“ç„¶çš„ä»¥ä¸ºä¹Ÿæ˜¯èµ°äº†ä¸Šè¿°çš„é‚£å¥—æµç¨‹ã€‚ç„¶åçœ‹åˆ°ç³»ç»Ÿä¾èµ–ç»„ä»¶æ—¶ï¼Œå‘ç°......emmm...... Zookeeper å‘¢ï¼Ÿæ²¡çœ‹ç€ã€‚é‚£æ‰¾æ‰¾ Nacos ï¼Ÿemmm......ä¹Ÿæ²¡æ‰¾ç€......ä¸ä»…æ²¡æ‰¾ç€ï¼Œè¿˜å‘ç°æ–‡æ¡£ä¸­æ˜æ˜ç™½ç™½çš„å†™ç€ï¼Œ&lt;strong&gt;æœ€å°ä¾èµ–ä»…ä¸ºå…³ç³»å‹æ•°æ®åº“&lt;/strong&gt;ã€‚è®¸å¤šç”¨æˆ·çœ‹åˆ°è¿™é‡Œå°±æœ‰ç‚¹ç™¾æ€ä¸å¾—å…¶è§£äº†ï¼Œæ­£å¸¸æ¥è®²éƒ½ä¼šæœ‰ä¸¤ä¸ªç–‘æƒ‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200811174206230-461704799.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œä¸ºä»€ä¹ˆä¸ç”¨æ³¨å†Œä¸­å¿ƒå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¦åšåˆ°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„é«˜å¯ç”¨ï¼Œè‚¯å®šæ˜¯éœ€è¦æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°è¿™æ ·çš„æ¦‚å¿µçš„ã€‚æ²¡æœ‰å¤–éƒ¨æ³¨å†Œä¸­å¿ƒï¼Œè¯´ç™½äº†å°±æ˜¯è‡ªå·±å»å®ç°äº†ä¸€å¥—ç±»ä¼¼çš„æœºåˆ¶ã€‚é‚£ä¸ºä»€ä¹ˆè¦æ€ä¹ˆåšå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å…¶å®ç­”æ¡ˆå¾ˆç®€å•â€”â€”æˆæœ¬ã€‚è¿™ä¸ªæˆæœ¬æŒ‡çš„æ˜¯ç”¨æˆ·çš„æ¥å…¥æˆæœ¬ã€‚å¯¹äºä¸€ä¸ªéœ€è¦éƒ¨ç½²çš„é‡å‹å¼€æºé¡¹ç›®æ¥è¯´ï¼Œæ¯å°‘ä¸€ä¸ªå¤–éƒ¨ä¾èµ–ï¼Œå°±å¤šä¸€ä»½æ½œåœ¨çš„ç”¨æˆ·ã€‚é¢å¤–çš„ç³»ç»Ÿä¾èµ–ä»£è¡¨ç€é¢å¤–çš„æŠ€æœ¯æ ˆå’Œé¢å¤–çš„ç»´æŠ¤æˆæœ¬ï¼Œå¦‚æœä¼ä¸šæœ¬èº«æ²¡æœ‰è¿™ä¸€å¥—æŠ€æœ¯ä½“ç³»ï¼ˆæ¯”å¦‚æ²¡ç”¨åˆ° zookeeperï¼‰ï¼Œè€Œ PowerJob åˆå¼ºä¾èµ– zookeeperï¼Œé‚£å¤§æ¦‚ç‡åªèƒ½è¯´å†è§å–½ï½&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªé—®é¢˜è§£å†³äº†ï¼Œæ¥ä¸‹æ¥è¿›å…¥ç¬¬äºŒä¸ªé—®é¢˜ï½&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200811174212090-1262721412.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;ç®€å•é«˜å¯ç”¨&quot;&gt;ç®€å•é«˜â€œå¯ç”¨â€&lt;/h2&gt;
&lt;p&gt;PowerJob ç³»ç»Ÿä¸­çš„åŸºç¡€ç»„ä»¶ä¸ºè°ƒåº¦æœåŠ¡å™¨ server å’Œæ‰§è¡Œå™¨ workerï¼Œserver è´Ÿè´£è°ƒåº¦å®šæ—¶ä»»åŠ¡ï¼Œå¹¶æ´¾å‘åˆ° worker æ‰§è¡Œï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„ C/S æ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;C/S æ¶æ„ä¸‹ï¼Œå¦‚æœç›®æ ‡æ˜¯ server å’Œ client å¯ä»¥ç›¸äº’è”é€šçš„â€œé«˜å¯ç”¨â€ï¼Œé‚£ä¹ˆå®ç°èµ·æ¥å…¶å®éå¸¸å®¹æ˜“ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œå¯åŠ¨å¤šä¸ª server åº”ç”¨å®ä¾‹ï¼Œé›†ç¾¤éƒ¨ç½²ã€‚ç„¶åå°†å¤šä¸ª server çš„ IP åœ°å€ç»Ÿç»Ÿå¡«å…¥ worker çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œworker å¯åŠ¨æ—¶ï¼Œéšæœºæ‰¾ä¸€ä¸ª IP è¿›è¡Œè¿æ¥ï¼Œå¤±è´¥åˆ™é‡è¯•ã€‚ä¸€æ—¦æˆåŠŸè¿æ¥åˆ°æŸä¸€å° serverï¼Œå°±å¼€å§‹ä¸ŠæŠ¥è‡ªå·±çš„åœ°å€ä¿¡æ¯ã€‚server é€šè¿‡æŒæœ‰è¿™ä¸ªä¿¡æ¯ä¹Ÿå¯ä»¥å’Œ worker è¿›è¡Œé€šè®¯ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä¸€ä¸ªæœ€ç®€å•ç‰ˆæœ¬çš„â€œé«˜å¯ç”¨â€é›†ç¾¤å°±æ­å»ºå®Œæˆäº†ã€‚ä½†æ˜¯......å®ƒçœŸçš„å¯ç”¨å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200811174218071-918137946.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ç­”æ¡ˆæ˜¾ç„¶æ˜¯å¦å®šçš„ï¼ˆå¦åˆ™ä¹Ÿä¸ä¼šæœ‰è¿™ç¯‡æ–‡ç« äº†æ˜¯ä¸æ˜¯ï½ï¼‰ã€‚ä»¥ä¸Šæ–¹æ¡ˆä¸»è¦å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ä»»åŠ¡è°ƒåº¦éœ€è¦ä¿è¯å”¯ä¸€æ€§ï¼Œå³æŸä¸ªä»»åŠ¡åœ¨æŸä¸€ä¸ªæ—¶åˆ»åªèƒ½è¢«ä¸€å°æœºå™¨è°ƒåº¦ï¼Œå¦åˆ™å°±ä¼šå¯¼è‡´é‡å¤æ‰§è¡Œã€‚è€Œå‰æ–‡æåŠçš„æ–¹æ¡ˆä¸­ï¼Œæ¯ä¸€å° server éƒ½æ˜¯å®Œå…¨ç­‰ä»·çš„ï¼Œå› æ­¤åªèƒ½ä¾é åˆ†å¸ƒå¼é”æ¥ä¿è¯å”¯ä¸€æ€§ï¼Œå³æŠ¢åˆ°é”çš„ server æ‰§è¡Œè°ƒåº¦ï¼Œå…¶ä»– server åªèƒ½å……å½“æˆ˜åœ°è®°è€…ï¼Œé»˜é»˜åœ°è¾¹ç¼˜ OBã€‚è¿™ç§æ–¹æ¡ˆä¸‹ï¼Œæ— è®ºéƒ¨ç½²å¤šå°‘å° serverï¼Œç³»ç»Ÿæ•´ä½“çš„è°ƒåº¦æ€§èƒ½å…¶å®æ˜¯å›ºå®šçš„ï¼Œå¤šå®ä¾‹éƒ¨ç½²åªèƒ½åšåˆ°é«˜å¯ç”¨ï¼Œè€Œä¸èƒ½åšåˆ°é«˜æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;server æ— æ³•æŒæœ‰å®Œæ•´çš„ worker é›†ç¾¤ä¿¡æ¯ã€‚PowerJob çš„å®šä½æ˜¯&lt;strong&gt;ä»»åŠ¡è°ƒåº¦ä¸­é—´ä»¶&lt;/strong&gt;ï¼Œæ—¨åœ¨ä¸ºä¼ä¸šä¸‹å„éƒ¨é—¨å„ä¸šåŠ¡çº¿æä¾›ç²¾å‡†çš„è°ƒåº¦å’Œåˆ†å¸ƒå¼è®¡ç®—èƒ½åŠ›ã€‚å› æ­¤è‚¯å®šä¼šæœ‰é›†ç¾¤åˆ†ç»„çš„æ¦‚å¿µï¼Œå°±åƒ RocketMQ ä¸­å­˜åœ¨ ProducerGroup å’Œ ConsumerGroup ä¸€æ ·ï¼ŒPowerJob æœ‰ç€ AppName çš„æ¦‚å¿µã€‚ä¸€ä¸ª AppName é€»è¾‘ä¸Šå¯¹åº”äº†æŸä¸ªåº”ç”¨ä¸‹çš„ä¸€ç»„ä»»åŠ¡ï¼Œç‰©ç†ä¸Šå¯¹åº”äº†è¿™ä¸ªåº”ç”¨æ‰€éƒ¨ç½²çš„é›†ç¾¤ã€‚ä¸ºäº†ä¾¿äº server ç»Ÿä¸€ç®¡ç†ä»¥åŠä¸€äº›é¢å¤–åŠŸèƒ½çš„å®ç°ï¼ˆåˆ†å¸ƒå¼è®¡ç®—ï¼‰ï¼Œserver æŒæœ‰æŸä¸€ä¸ª AppName ä¸‹å®Œæ•´çš„é›†ç¾¤ä¿¡æ¯æ˜¯ä¸€ä¸ªå¼ºè¯‰æ±‚ï¼Œè€Œå‰æ–‡æåŠçš„â€œççŒ«æ’ä¸Šæ­»è€—å­â€å¼æ–¹æ¡ˆï¼Œæ˜¾ç„¶æ²¡åŠæ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;åŸºäºä»¥ä¸Šä¸¤ç‚¹ï¼Œå¾é€”æ˜¯æ˜Ÿè¾°å¤§æµ·çš„ PowerJob éœ€è¦æ¢ç´¢å‡ºä¸€ç§æ›´åˆç†ã€æ›´å¼ºå¤§çš„é«˜å¯ç”¨æ¶æ„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åˆ†ç»„éš”ç¦»&quot;&gt;åˆ†ç»„éš”ç¦»&lt;/h2&gt;
&lt;p&gt;å…¶å®æ ¹æ®å‰é¢é‡åˆ°çš„é—®é¢˜ï¼Œè¿™ä¸€å¥—æœºåˆ¶çš„é›å½¢ä¹Ÿå·®ä¸å¤šå‡ºæ¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;server æ—¢ç„¶éœ€è¦æŒæœ‰æŸä¸€ä¸ªåˆ†ç»„ä¸‹å®Œæ•´çš„é›†ç¾¤ä¿¡æ¯ï¼Œé‚£ä¹ˆå¯ä»¥é¡ºå…¶è‡ªç„¶çš„æƒ³åˆ°ï¼Œèƒ½ä¸èƒ½è®©æŸä¸€ä¸ªåˆ†ç»„çš„æ‰€æœ‰ worker éƒ½è¿æ¥åˆ°æŸä¸€å° server å‘¢ï¼Ÿä¸€æ—¦æŸä¸ªåˆ†ç»„ä¸‹æ‰€æœ‰æœºå™¨å…¨éƒ¨è¿æ¥åˆ°äº†æŸä¸€å° serverï¼Œé‚£ä¹ˆå…¶å®è¿™å°±å½¢æˆäº†ä¸€ä¸ªå°å‹çš„å­ç³»ç»Ÿã€‚è™½ç„¶æ•´ä¸ª PowerJob ç³»ç»Ÿä¸­å­˜åœ¨ç€å¤šå° server å’Œå¤šä¸ª worker é›†ç¾¤ï¼Œä½†æ˜¯å¯¹äºè¿™ä¸ªåˆ†ç»„çš„è¿è¡Œæ¥è¯´ï¼Œåªè¦æœ‰è¿™ä¸ªåˆ†ç»„å¯¹åº”çš„ worker é›†ç¾¤ä»¥åŠå®ƒä»¬è¿æ¥çš„é‚£ä¸€å° server å°±å¤Ÿäº†ã€‚é‚£ä¹ˆåœ¨è¿™ä¸ªå°å‹â€œå­ç³»ç»Ÿâ€å†…éƒ¨ï¼Œåªå­˜åœ¨ç€ä¸€å° serverï¼Œä¹Ÿå°±ä¸å­˜åœ¨é‡å¤è°ƒåº¦é—®é¢˜äº†ï¼ˆserver åªè°ƒåº¦è¿æ¥åˆ°å®ƒçš„ AppName ä¸‹é¢çš„ä»»åŠ¡å°±èƒ½å®ç°è¿™ä¸€ç‚¹ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œç»è¿‡ä¸€å±‚å±‚çš„å‰¥ä¸æŠ½èŒ§ï¼Œé—®é¢˜å·²ç»è½¬åŒ–ä¸ºäº†ï¼š&lt;strong&gt;å¦‚ä½•è®©æŸä¸ªåˆ†ç»„ä¸‹çš„æ‰€æœ‰æœºå™¨éƒ½è¿æ¥åˆ°åŒä¸€å° server ä¸Šå»å‘¢ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œç›¸ä¿¡å¾ˆå¤šäººä¼šæœ‰å’Œæˆ‘å½“æ—¶ä¸€æ ·çš„æƒ³æ³•ï¼Œé‚£å°±æ˜¯ï¼šå°±è¿™ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200811174228020-98463098.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;â€œè®©æ‰€æœ‰æœºå™¨éƒ½è¿æ¥åˆ°åŒä¸€å° server ä¸Šå»ï¼Œé‚£ä¹Ÿå¤ªç®€å•äº†å§ï¼Œä½ åªé…ç½®ä¸€ä¸ª IP ä¸å°±è¡Œäº†å—ï¼Ÿâ€&lt;/p&gt;
&lt;p&gt;â€œé…ç½®ä¸€ä¸ª IP æ€ä¹ˆåšé«˜å¯ç”¨ï¼Œæ€ä¹ˆåˆ©ç”¨å¤šå° server èµ„æºï¼Ÿâ€&lt;/p&gt;
&lt;p&gt;â€œğŸ¤”å¥½åƒæœ‰ç‚¹é“ç†ï¼Œé‚£å°± hash(appName) å–ä½™ä½œä¸ºä¸‹æ ‡ï¼Œè¿™æ ·å°±èƒ½ä¿è¯åŒä¸€ä¸ªåŒä¸€ä¸ªåˆ†ç»„ä¸‹æ‰€æœ‰æœºå™¨çš„åˆå§‹ IP ç›¸åŒï¼Œä¸åŒåˆ†ç»„ä¹Ÿèƒ½è¿æ¥åˆ°ä¸åŒçš„ serverâ€&lt;/p&gt;
&lt;p&gt;â€œé‚£ï¼Œä¸‡ä¸€è¿æ¥çš„ server æŒ‚äº†æ€ä¹ˆåŠï¼Ÿâ€&lt;/p&gt;
&lt;p&gt;â€œè¿™å¥½åŠï¼Œå¯ä»¥é‡‡å–ç±»ä¼¼äºè§£å†³å“ˆå¸Œå†²çªçš„é‚£ä¸ªä»€ä¹ˆå¼€æ”¾å®šå€æ³•ï¼Œä»æŒ‚æ‰çš„ server ä¸‹æ ‡å¼€å§‹ï¼Œä¾æ¬¡å‘åé‡è¯•å°±è¡Œäº†ï¼ŒåŒä¸€ä¸ªåˆ†ç»„é›†ç¾¤å†…æ‰€æœ‰çš„æœºå™¨éƒ½ä»æŸä¸ªä¸‹æ ‡ä¾æ¬¡å‘åé‡è¯•ï¼Œè¿˜æ˜¯èƒ½è¿æ¥åˆ°åŒä¸€å° server çš„â€&lt;/p&gt;
&lt;p&gt;â€œğŸ¤”å¥½åƒå¾ˆæœ‰é“ç†ï¼Œå“¼ï¼Œworker é€‰ä¸»ä¹Ÿå°±ä¸è¿‡å¦‚æ­¤ï¼Œæ–¹æ¡ˆæå®šï¼Œè‹±é›„è”ç›Ÿ å¯åŠ¨ï¼â€&lt;/p&gt;
&lt;p&gt;æ­£å½“æˆ‘æµ´è¡€å¥‹æˆ˜ç›´æŒ‡æ•Œå°†é¦–çº§æ—¶ï¼Œç”»é¢...æ°¸è¿œå®šæ ¼åœ¨äº†è§è¡€å‰çš„é‚£ä¸€ç¬ã€‚â€œæ­£åœ¨å°è¯•é‡æ–°è¿æ¥â€å‡ ä¸ªå¤§å­—æ˜ å…¥çœ¼å¸˜ï¼Œä¹ŸæŠŠæˆ‘å¸¦å…¥äº†æ·±æ·±çš„æ²‰æ€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200811174236046-1342870927.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è™½è¯´æ¯æ¬¡ç©æ¸¸æˆå¿…éª‚è…¾è®¯é‚£***çš„åœŸè±†æœåŠ¡å™¨ï¼Œä½†éª‚å½’éª‚ï¼Œå¿ƒé‡Œå…¶å®è¿˜æ˜¯æ˜ç™½ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯è‡ªå·±ç½‘ç»œæ³¢åŠ¨å¯¼è‡´æ¸¸æˆæ‰çº¿ï¼ˆ&lt;s&gt;è°å«æˆ‘è´ªä¾¿å®œåŠäº†ä¸ªç§»åŠ¨å®½å¸¦å‘¢ï¼Œå“ï¼Œé›·ç”µæ³•ç‹æ¨æ°¸ä¿¡ä¹Ÿå°±å›¾ä¸€ä¹ï¼ŒçœŸè¦æˆ’ç½‘ç˜¾è¿˜å¾—çœ‹ç§»åŠ¨å®½å¸¦&lt;/s&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å—¯ï¼Ÿè‡ªå·±çš„åŸå› ï¼Ÿç½‘ç»œæ³¢åŠ¨ï¼Ÿæ‰çº¿ï¼Ÿé‡è¿ï¼Ÿè¿™ä¸€è¿ä¸²è¯æ±‡ï¼ŒæŠŠæˆ‘æ‹‰å›äº†åˆšåˆšè®¾è®¡çš„æ–¹æ¡ˆä¹‹ä¸­ï¼Œç„¶åç»™æˆ‘å½“å¤´ä¸€æ£’ã€‚ä¸€æ—¦ worker å› ä¸ºè‡ªå·±çš„ç½‘ç»œæ³¢åŠ¨å¯¼è‡´å®ƒä»¥ä¸º server ä¸å¯ç”¨ï¼Œè€Œé‡æ–°è¿æ¥å¦ä¸€å° serverï¼Œå°±ä¼šå¯¼è‡´æ‰€æœ‰ worker éƒ½è¿æ¥åŒä¸€å° server è¿™ä¸ªçº¦æŸè¢«ç ´å......å› æ­¤ï¼Œè¿™ä¸ªæ–¹æ¡ˆè‡ªç„¶ä¹Ÿå°±æ˜¯ä¸€ä¸ªå……æ»¡æ¼æ´çš„ä¸å¯è¡Œæ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200811174241896-611866715.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¹‹åçš„ä¸€å‘¨ï¼Œå¯ä»¥è¯´æ˜¯æ”¯ç¦»ç ´ç¢çš„ä¸€å‘¨ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è®¾è®¡äº†æ— æ•°ä¸ªå ªç§°â€œå¥‡çå¼‚å…½â€çš„æ–¹æ¡ˆï¼Œç„¶åå†ä¸€ä¸ªä¸ªå¦å®šå’Œæªæ¯™ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®è¿™æ®µç»å†ç°åœ¨å›è¿‡å¤´æ¥æƒ³ç‰¹åˆ«æç¬‘ï¼Œä¹Ÿæœ‰è¢«è‡ªå·±è ¢åˆ°ã€‚é‚£æ— æ•°ä¸ªæ–¹æ¡ˆçš„å¤±è´¥åŸå› å…¶å®éƒ½æ˜¯åŒä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯&lt;strong&gt;å‡ºå‘ç‚¹é”™äº†&lt;/strong&gt;ã€‚æˆ‘ä¸€ç›´åœ¨å°è¯•è®© worker å†³å®šè¿æ¥å“ªå° serverï¼Œå´ä¸€è€Œå†å†è€Œä¸‰å¿½ç•¥ worker æ°¸è¿œä¸å¯èƒ½è·å– server çœŸæ­£çš„å­˜æ´»ä¿¡æ¯ï¼ˆæ¯”å¦‚å¿ƒè·³æ— æ³•ä¼ è¾¾ï¼Œå¯èƒ½æ˜¯ worker æœ¬èº«çš„ç½‘ç»œæ•…éšœï¼‰ï¼Œå› æ­¤ &lt;strong&gt;worker ä¸åº”è¯¥å†³å®šè¿æ¥å“ªå° serverï¼Œè¿™åº”è¯¥ç”± server æ¥å†³å®šã€‚worker èƒ½åšçš„ï¼Œåªæœ‰æœåŠ¡å‘ç°&lt;/strong&gt;ã€‚æƒ³æ˜ç™½äº†è¿™ç‚¹ï¼Œå…·ä½“çš„æ–¹æ¡ˆä¹Ÿå°±åº”è¿è€Œç”Ÿäº†ã€‚&lt;/p&gt;
&lt;p&gt;PSï¼šè¿™ä¸ªæ–¹æ¡ˆçš„è¯ç”Ÿï¼Œæˆ‘å¤§æ¦‚ä»˜å‡ºäº†1æ–¤è„‘ç»†èƒçš„ä»£ä»·ï¼ˆä¸å¾—ä¸è¯´è¿™ä¸ªå‡è‚¥æ–¹æ³•è¿˜è›®å¥½çš„ï¼‰...è„‘ç»†èƒä¸èƒ½ç™½æ­»ï¼Œå°½ç®¡é‚£äº›å¥‡å¥‡æ€ªæ€ªå¾—æ–¹æ¡ˆæ²¡æœ‰æ´»åˆ°æ­£å¼ç‰ˆæœ¬ï¼Œä½†æ²¡æœ‰ä»–ä»¬å°±æ— æ³•é€šå¾€çœŸç†çš„å¤§é—¨ã€‚ä¸ºäº†è¡¨è¾¾çºªå¿µå’Œâ€œå“€æ‚¼â€ä¹‹æƒ…ï¼Œæˆ‘å°†æœ€ç»ˆçš„è®¾è®¡å‘½åä¸ºâ€”â€”V4ï¼šä¸§é’Ÿä¸ºè°é¸£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200811174247553-1789021703.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;v4ï¼šä¸§é’Ÿä¸ºè°é¸£&quot;&gt;V4ï¼šä¸§é’Ÿä¸ºè°é¸£&lt;/h2&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;æƒ³æ˜ç™½äº†ä¸èƒ½ç”± Worker å‘èµ· Server çš„é‡æ–°é€‰ä¸¾ï¼Œè¿™ä¸ªé—®é¢˜å°±åŸºæœ¬ä¸Šè§£å†³äº†......ç”±äºç¯‡å¹…åŸå› ä»¥åŠç½‘ä¸Šå·²ç»æœ‰å°ä¼™ä¼´å†™äº†è¿™ä¸€å—æºç åˆ†æçš„åšå®¢ï¼Œæˆ‘è¿™é‡Œå°±ä¸é‡å¤â€œé€ è½®å­â€äº†ï¼Œåœ¨è¿™é‡Œä¸»è¦è®²ä¸€ä¸‹è®¾è®¡æ€è·¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å°±åƒå‰é¢è¯´çš„é‚£æ ·ï¼Œworker å› ä¸ºæ²¡åŠæ³•è·å– server çš„å‡†ç¡®çŠ¶æ€ï¼Œæ‰€ä»¥ä¸èƒ½ç”± worker æ¥å†³å®šè¿æ¥å“ªä¸€å° serverã€‚å› æ­¤ï¼Œworker éœ€è¦åšçš„ï¼Œåªæ˜¯&lt;strong&gt;æœåŠ¡å‘ç°&lt;/strong&gt;ã€‚å³å®šæ—¶ä½¿ç”¨ HTTP è¯·æ±‚ä»»æ„ä¸€å° serverï¼Œè¯·æ±‚è·å–å½“å‰è¯¥åˆ†ç»„ï¼ˆappNameï¼‰å¯¹åº”çš„ serverã€‚&lt;/p&gt;
&lt;p&gt;è€Œ server æ”¶åˆ°æ¥è‡ª worker çš„æœåŠ¡å‘ç°è¯·æ±‚åï¼Œå…¶å®å°±æ˜¯è¿›è¡Œäº†ä¸€åœºå°å‹çš„åˆ†å¸ƒå¼é€‰ä¸»ï¼šserver ä¾èµ–çš„æ•°æ®åº“ä¸­å­˜åœ¨ç€ server_info è¡¨ï¼Œå…¶ä¸­è®°å½•äº†æ¯ä¸€ä¸ªåˆ†ç»„ï¼ˆappNameï¼‰æ‰€å¯¹åº”çš„ server ä¿¡æ¯ã€‚å¦‚æœè¯¥ server å‘ç°è¡¨ä¸­å­˜åœ¨è®°å½•ï¼Œé‚£å°±è¯´æ˜è¯¥ worker é›†ç¾¤ä¸­å·²ç»æœ‰åˆ«çš„ worker äº‹å…ˆè¯·æ±‚ server è¿›è¡Œé€‰ä¸¾ï¼Œé‚£ä¹ˆæ­¤æ—¶åªéœ€è¦å‘é€ PING è¯·æ±‚æ£€æµ‹è¯¥ server æ˜¯å¦å­˜æ´»ã€‚å¦‚æœå‘ç°è¯¥ server å­˜æ´»ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›è¯¥ server çš„ä¿¡æ¯ä½œä¸ºè¯¥åˆ†ç»„çš„ serverã€‚å¦åˆ™å°±å®Œæˆç¯¡ä½ï¼Œå°†è‡ªå·±çš„ä¿¡æ¯å†™å…¥æ•°æ®åº“è¡¨ä¸­ï¼Œæˆä¸ºè¯¥åˆ†ç»„çš„ serverã€‚&lt;/p&gt;
&lt;p&gt;ç»†å¿ƒçš„å°ä¼™ä¼´å¯èƒ½åˆè¦é—®äº†ï¼Ÿå‘é€ PING è¯·æ±‚æ£€æµ‹è¯¥ server æ˜¯å¦å­˜æ´»ï¼Œä¸è¿˜æ˜¯æœ‰å’Œåˆšæ‰ä¸€æ ·çš„é—®é¢˜å—ï¼Ÿè¯·æ±‚ä¸åŒï¼Œå‘é€æ–¹å’Œæ¥æ”¶æ–¹éƒ½æœ‰å¯èƒ½å‡ºé—®é¢˜ï¼Œå‡­ä»€ä¹ˆè®¤ä¸ºæ˜¯åŸå…ˆçš„ server æŒ‚äº†å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç¡®å®ï¼Œåœ¨è¿™ä¸ªæ–¹æ¡ˆä¸‹ï¼Œä¾æ—§æ²¡åŠæ³•è§£å†³ server åˆ°åº•æŒ‚æ²¡æŒ‚è¿™ä¸ªå ªæ¯”â€œçœŸå‡ç¾çŒ´ç‹â€çš„ç„å­¦é—®é¢˜ã€‚ä½†æ˜¯ï¼Œè¿™è¿˜é‡è¦å—ï¼Ÿæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æŸä¸ªåˆ†ç»„ä¸‹æ‰€æœ‰çš„ worker éƒ½è¿æ¥åˆ°åŒä¸€å° serverï¼Œå› æ­¤ï¼Œå³ä¾¿äº§ç”Ÿé‚£ç§è¯¯æ‰“è¯¯æ’ç¯¡ä½çš„æƒ…å†µï¼Œåœ¨æœåŠ¡å‘ç°æœºåˆ¶çš„åŠ æŒä¸‹ï¼Œæ•´ä¸ªé›†ç¾¤æœ€ç»ˆè¿˜æ˜¯ä¼šè¿æ¥åˆ°åŒä¸€å° serverï¼Œå®Œç¾å®ç°æˆ‘ä»¬çš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;è‡³æ­¤ï¼Œè€—æ—¶ 6 å¤©ï¼Œä»åŸæ¥çš„æ€€ç–‘äººç”Ÿï¼Œåˆ°å®Œç¾æ–¹æ¡ˆçš„è½åœ°å®ç°ï¼ŒçœŸæ˜¯æ›²æŠ˜ï½&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200811174253681-370079560.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;æœ€å&quot;&gt;æœ€å&lt;/h2&gt;
&lt;p&gt;æœ€åï¼Œè´´ä¸Šä¸¤ä½å°ä¼™ä¼´è´¡çŒ®çš„æºç åˆ†ææ–‡ç« ï¼Œæˆ‘äº²è‡ª check è¿‡ï¼Œæ²¡æœ‰è´¨é‡é—®é¢˜ï¼ˆ&lt;s&gt;è¿™è¯è¯´çš„æˆ‘æ„Ÿè§‰è‡ªå·±å¥½é£˜å“ˆå“ˆå“ˆ&lt;/s&gt;ï¼‰ï¼Œè¯·å„ä½è§‚ä¼—è€çˆ·æ”¾å¿ƒæŸ¥çœ‹ï½&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆä»¥ä¸Šå°±æ˜¯æœ¬ç¯‡æ–‡ç« å…¨éƒ¨çš„å†…å®¹äº†ï½ç›¸ä¿¡é€šè¿‡è¿™ç¯‡æ–‡ç« å’Œä¸Šç¯‡æ–‡ç« ï¼Œå¤§å®¶å·²ç»å¯¹ PowerJob çš„è°ƒåº¦å±‚å’Œé«˜å¯ç”¨é«˜æ€§èƒ½æ¶æ„æœ‰äº†ä¸€å®šçš„äº†è§£äº†ã€‚æ¥ä¸‹æ¥å°±æ˜¯ä¸‹æœŸé¢„å‘Šç¯èŠ‚äº†ï½&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä¿ç•™ç¥ç§˜æ„Ÿï¼Œè¿™æ¬¡å°±é€‰æ‹©ä¸é¢„å‘Šäº†ï¼ˆ&lt;s&gt;æ‰ä¸ä¼šå‘Šè¯‰ä½ æ˜¯æˆ‘è¿˜æ²¡æƒ³å¥½å…·ä½“å†™ä»€ä¹ˆ&lt;/s&gt;ï¼‰ï½&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰æƒŠå–œï¼Œä¸‹æœŸå†è§ï½&lt;/p&gt;
&lt;blockquote readability=&quot;1.5686274509804&quot;&gt;
&lt;p&gt;é¡¹ç›®åœ°å€ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/KFCFans/PowerJob&quot;&gt;https://github.com/KFCFans/PowerJob&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr/&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/759200/202008/759200-20200811174133674-930116231.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å…³æ³¨å…¬ä¼—å·åŠ å…¥äº¤æµç¾¤ï¼ˆä½œè€…åœ¨ Java ç¾¤ï¼‰&lt;/p&gt;
</description>
<pubDate>Wed, 12 Aug 2020 00:33:00 +0000</pubDate>
<dc:creator>å‰Šå¾®å¯’</dc:creator>
<og:description>æœ¬æ–‡é€‚åˆæœ‰ Java åŸºç¡€çŸ¥è¯†çš„äººç¾¤ ä½œè€…ï¼šHelloGitHub-Salieri HelloGitHub æ¨å‡ºçš„ã€Šè®²è§£å¼€æºé¡¹ç›®ã€‹ç³»åˆ—ã€‚ ç¢ç¢å¿µ é«˜å¯ç”¨æ”¾åˆ°ä»Šå¤©å·²ç»ä¸æ˜¯ä¸€ä¸ªæ–°é¢–çš„è¯æ±‡äº†ï¼Œæ€ä¹ˆå®ç°é«˜å¯ç”¨</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/xueweihan/p/13477189.html</dc:identifier>
</item>
<item>
<title>Aspnet Zeroä¸­ä½¿ç”¨Windows service (Topshelf)æ¥æ‰¿è½½Quartz.netä»»åŠ¡ - Thinking110</title>
<link>http://www.cnblogs.com/FocusNet/p/13474785.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/FocusNet/p/13474785.html</guid>
<description>&lt;p&gt;ç½‘ä¸Šæœ‰å¾ˆå¤šå…³äºå¦‚ä½•ä½¿ç”¨Topshelfåˆ›å»ºABPçš„Quartz windowsæœåŠ¡ï¼Œä½†å¾ˆå°‘(æ²¡æœ‰)æœ‰ä»‹ç»å¦‚ä½•é…åˆAspnet Zeroä½¿ç”¨çš„æ–‡ç« ï¼Œæœ¬æ–‡è®°å½•é›†æˆè¿‡ç¨‹ï¼Œä»¥ä¾›å‚è€ƒã€‚&lt;/p&gt;
&lt;ol readability=&quot;19&quot;&gt;&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;åœ¨å®˜æ–¹Aspnet Zeroæ¨¡æ¿è§£å†³æ–¹æ¡ˆä¸­å»ºç«‹Consoleç±»å‹çš„é¡¹ç›®ï¼Œå¹¶å®‰è£…ä»¥ä¸‹buget package:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Topshelf&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Abp.Quartz&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Abp.Castle.Log4Net&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Abp.AspnetCore&lt;/code&gt; (åé¢æœ‰ç”¨åˆ°)&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;æ·»åŠ å¼•ç”¨&lt;code&gt;MyCompanyName.AbpZeroTemplate.Core&lt;/code&gt;å’Œ&lt;code&gt;MyCompanyName.AbpZeroTemplate.Core&lt;/code&gt;é¡¹ç›®&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ€ç»ˆå¼•ç”¨å¦‚å›¾ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/28427/202008/28427-20200811115713876-1347830211.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;5&quot;&gt;
&lt;p&gt;åˆ›å»ºModuleæ–‡ä»¶,&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æ·»åŠ ç›¸å…³DependsOnå±æ€§;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;abpZeroTemplateEntityFrameworkCoreModule.SkipDbSeed = true;&lt;/code&gt; è¿™é‡Œæˆ‘ä»¬éœ€è¦ç¦ç”¨æ•°æ®åº“åˆå§‹åŒ–åŠ¨ä½œï¼Œå› ä¸ºæ‰€æœ‰çš„åˆå§‹åŒ–åŠ¨ä½œéƒ½åœ¨Hostç«¯å®Œæˆ;&lt;/li&gt;
&lt;li&gt;è®¾ç½®æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²&lt;code&gt;Configuration.DefaultNameOrConnectionString = _appConfiguration.GetConnectionString( AbpZeroTemplateConsts.ConnectionStringName );&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;æœ€ç»ˆæ–‡ä»¶å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;namespace MyCompanyName.AbpZeroTemplate.WinService
{
    [DependsOn(typeof(AbpZeroTemplateCoreModule),
        typeof(AbpZeroTemplateEntityFrameworkCoreModule),
        typeof(AbpQuartzModule)
        )]
    public class AbpZeroWinServiceModule : AbpModule
    {
        private readonly IConfigurationRoot _appConfiguration;

        public AbpZeroWinServiceModule(AbpZeroTemplateEntityFrameworkCoreModule abpZeroTemplateEntityFrameworkCoreModule)
        {
            abpZeroTemplateEntityFrameworkCoreModule.SkipDbSeed = true;

            _appConfiguration = AppConfigurations.Get(
                typeof(AbpZeroWinServiceModule).GetAssembly().GetDirectoryPathOrNull(),
                addUserSecrets: true
            );
        }

        public override void PreInitialize()
        {
            //Set default connection string
            Configuration.DefaultNameOrConnectionString = _appConfiguration.GetConnectionString(
                AbpZeroTemplateConsts.ConnectionStringName
            );
        }

        public override void Initialize()
        {
            this.IocManager.RegisterAssemblyByConvention(Assembly.GetExecutingAssembly());

        }
    }
}
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;10&quot;&gt;
&lt;p&gt;ä¿®æ”¹Program.csæ–‡ä»¶&lt;/p&gt;
&lt;ul readability=&quot;1&quot;&gt;&lt;li&gt;è®¾ç½®å·¥ä½œç›®å½• &lt;code&gt;Directory.SetCurrentDirectory(currentDirectory);&lt;/code&gt;, ç›®çš„æ˜¯ä¸ºäº†ä¿è¯å·¥ä½œåœ¨windows serviceæ—¶logæ–‡ä»¶å­˜æ”¾ç›®å½•æ­£ç¡®ï¼Œå¦‚æœä¸è®¾ç½®, å·¥ä½œåœ¨windows serviceæ—¶logæ–‡ä»¶å°†ä¼šå­˜æ”¾åœ¨system32ç›®å½•ä¸­&lt;/li&gt;
&lt;li readability=&quot;5&quot;&gt;&lt;strong&gt;æ³¨å†ŒIdentityRegistrarä»¥åŠæ·»åŠ abpä¾èµ–&lt;/strong&gt;ï¼Œè¿™ä¸€æ­¥æ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™ä¼šå‡ºç°ä¾èµ–é”™è¯¯ï¼š&lt;br/&gt;&lt;code&gt;Castle.MicroKernel.Handlers.HandlerException: 'Can't create component 'Portal.Authorization.Users.UserManager' as it has dependencies to be satisfied.&lt;/code&gt;&lt;br/&gt;æ·»åŠ abpä¾èµ–çš„åŒæ—¶æˆ‘ä»¬åŒæ—¶æ·»åŠ log4netå’Œæ’ä»¶æ”¯æŒ.(æ³¨æ„è·¯å¾„)
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;var services = new ServiceCollection();
IdentityRegistrar.Register(services);

services.AddAbp&amp;lt;AbpZeroWinServiceModule&amp;gt;(options =&amp;gt;
{
    //Configure Log4Net logging
    options.IocManager.IocContainer.AddFacility&amp;lt;LoggingFacility&amp;gt;(
        f =&amp;gt; f.UseAbpLog4Net().WithConfig(Path.Combine(currentDirectory, $&quot;log4net.config&quot;))
    );

    options.PlugInSources.AddFolder(Path.Combine(currentDirectory, &quot;Plugins&quot;), SearchOption.AllDirectories);
});
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;å®Œæ•´Program.csä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;class Program
{
    static void Main(string[] args)
    {
        var currentDirectory = typeof(Program).GetAssembly().GetDirectoryPathOrNull();
        // è®¾ç½®å·¥ä½œç›®å½•. ä¿è¯å·¥ä½œåœ¨windows serviceæ—¶logæ–‡ä»¶å­˜æ”¾ç›®å½•æ­£ç¡®
        // å¦‚æœä¸è®¾ç½®, å·¥ä½œåœ¨windows serviceæ—¶logæ–‡ä»¶å°†ä¼šå­˜æ”¾åœ¨system32ç›®å½•ä¸­
        Directory.SetCurrentDirectory(currentDirectory);

        var services = new ServiceCollection();
        IdentityRegistrar.Register(services);
        
        services.AddAbp&amp;lt;AbpZeroWinServiceModule&amp;gt;(options =&amp;gt;
        {
            //Configure Log4Net logging
            options.IocManager.IocContainer.AddFacility&amp;lt;LoggingFacility&amp;gt;(
                f =&amp;gt; f.UseAbpLog4Net().WithConfig(Path.Combine(currentDirectory, $&quot;log4net.config&quot;))
            );

            options.PlugInSources.AddFolder(Path.Combine(currentDirectory, &quot;Plugins&quot;), SearchOption.AllDirectories);
        });

        HostFactory.Run(x =&amp;gt;
        {
            x.Service&amp;lt;AbpZeroWinService&amp;gt;(s =&amp;gt;
            {
                s.ConstructUsing(name =&amp;gt; new AbpZeroWinService());
                s.WhenStarted((tc, hostControl) =&amp;gt; tc.Start(hostControl));
                s.WhenStopped((tc, hostControl) =&amp;gt; tc.Stop(hostControl));
            });

            x.RunAsLocalSystem();
            x.StartAutomatically();

            x.SetDescription(&quot;ABPæœåŠ¡æµ‹è¯•&quot;);
            x.SetDisplayName(&quot;ABPTestService&quot;);
            x.SetServiceName(&quot;ABPTestService&quot;);
        });
    }
}
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;6&quot;&gt;
&lt;p&gt;å¯åŠ¨ABP. Windows serviceå¯åŠ¨æ—¶ä¼šè°ƒç”¨&lt;code&gt;s.ConstructUsing(name =&amp;gt; new AbpZeroWinService());&lt;/code&gt;, å› æ­¤æˆ‘ä»¬åœ¨&lt;code&gt;AbpZeroWinService&lt;/code&gt;ä¸­å¯åŠ¨ABP.&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;åˆ›å»º&lt;code&gt;AbpZeroWinService&lt;/code&gt;ç±»ç»§æ‰¿è‡ª&lt;code&gt;ServiceControl&lt;/code&gt;, åœ¨&lt;code&gt;Start&lt;/code&gt;ä¸­åˆå§‹åŒ–&lt;code&gt;AbpBootstrapper&lt;/code&gt;, åŒæ—¶åœ¨åœæ­¢&lt;code&gt;Stop&lt;/code&gt;ä¸­é”€æ¯&lt;code&gt;AbpBootstrapper&lt;/code&gt;. ä»£ç å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;pre&gt;
&lt;code class=&quot;language-c#&quot;&gt;public class AbpZeroWinService : ServiceControl
{
    private AbpBootstrapper _bootstrapper;
    public bool Start(HostControl hostControl)
    {
        _bootstrapper = IocManager.Instance.Resolve&amp;lt;AbpBootstrapper&amp;gt;();
        _bootstrapper.Initialize();
        return true;
    }

    public bool Stop(HostControl hostControl)
    {
        _bootstrapper.Dispose();
        return true;
    }
}
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;quartz.netçš„é…ç½®&lt;code&gt;quartz.config&lt;/code&gt;ä¸­å¿…é¡»ä½¿ç”¨&lt;code&gt;AdoJobStore&lt;/code&gt;ç±»å‹ï¼Œå¹¶ä¸”ä½¿ç”¨å’ŒHostä¸€æ ·çš„Quartzæ•°æ®åº“è¿æ¥ï¼Œè¿™æ ·æ‰èƒ½å®ç°åœ¨hostä¸Šæ·»åŠ ä»»åŠ¡ï¼Œæœ€ç»ˆç”±windows serviceæ¥æ‰§è¡Œä»»åŠ¡ã€‚&lt;br/&gt;(&lt;strong&gt;è¯·åœ¨HostModuleçš„&lt;code&gt;PreInitialize&lt;/code&gt;æ–¹æ³•ä¸­ç¦ç”¨Jobæ‰§è¡Œ&lt;code&gt;Configuration.BackgroundJobs.IsJobExecutionEnabled = false;&lt;/code&gt;&lt;/strong&gt;)&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;è¿è¡Œå‰ç¡®ä¿Quartz.netæ•°æ®åº“å·²å»ºç«‹ï¼Œå¦‚ä½•å»ºç«‹è¯·å‚è€ƒQuartz.netå®˜æ–¹æ–‡æ¡£&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;ä»¥ä¸Šå¦‚æœ‰é”™è¯¯çš„åœ°æ–¹è¯·å¤§å®¶æŒ‡æ­£ï¼ å¦‚æœæ›´å¥½çš„å®ç°æ–¹å¼ï¼Œä¹Ÿè¯·åˆ†äº«ä¸€ä¸‹ã€‚&lt;br/&gt;æœ€åç»™å‡ºWindowServiceé¡¹ç›®çš„æºç ï¼ŒAspnet Zeroçš„é¡¹ç›®è‡ªè¡Œè§£å†³ã€‚&lt;br/&gt;&lt;a href=&quot;https://files.cnblogs.com/files/FocusNet/MyCompanyName.AbpZeroTemplate.WinService.zip&quot;&gt;source code&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 12 Aug 2020 00:01:00 +0000</pubDate>
<dc:creator>Thinking110</dc:creator>
<og:description>Aspnet Zeroä½¿ç”¨Windows service (Topshelf)æ¥æ‰¿è½½Quartz.netä»»åŠ¡ ç½‘ä¸Šæœ‰å¾ˆå¤šå…³äºå¦‚ä½•ä½¿ç”¨Topshelfåˆ›å»ºABPçš„Quartz windowsæœåŠ¡ï¼Œä½†å¾ˆå°‘</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/FocusNet/p/13474785.html</dc:identifier>
</item>
<item>
<title>æ•°æ®æºç®¡ç† | åˆ†å¸ƒå¼NoSQLç³»ç»Ÿï¼ŒCassandraé›†ç¾¤ç®¡ç† - çŸ¥äº†ä¸€ç¬‘</title>
<link>http://www.cnblogs.com/cicada-smile/p/13488035.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/cicada-smile/p/13488035.html</guid>
<description>&lt;p&gt;æœ¬æ–‡æºç ï¼š&lt;a href=&quot;https://github.com/cicadasmile/data-manage-parent&quot;&gt;GitHubÂ·ç‚¹è¿™é‡Œ&lt;/a&gt; || &lt;a href=&quot;https://gitee.com/cicadasmile/data-manage-parent&quot;&gt;GitEEÂ·ç‚¹è¿™é‡Œ&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;1ã€åŸºç¡€æè¿°&quot;&gt;1ã€åŸºç¡€æè¿°&lt;/h2&gt;
&lt;p&gt;Cassandraæ˜¯ä¸€å¥—å¼€æºåˆ†å¸ƒå¼NoSQLæ•°æ®åº“ç³»ç»Ÿã€‚å®ƒæœ€åˆç”±Facebookå¼€å‘ï¼Œç”¨äºå‚¨å­˜æ”¶ä»¶ç®±ç­‰ç®€å•æ ¼å¼æ•°æ®ï¼Œæ­¤åï¼Œç”±äºCassandraè‰¯å¥½çš„å¯æ‰©å±•æ€§ï¼Œé€æ¸å‘å±•æˆä¸ºäº†ä¸€ç§æµè¡Œçš„åˆ†å¸ƒå¼ç»“æ„åŒ–æ•°æ®å­˜å‚¨æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id=&quot;2ã€ç‰¹ç‚¹åˆ†æ&quot;&gt;2ã€ç‰¹ç‚¹åˆ†æ&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å¼¹æ€§å¯æ‰©å±•æ€§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Cassandraæ˜¯é«˜åº¦å¯æ‰©å±•çš„;å®ƒå…è®¸æ·»åŠ æ›´å¤šçš„ç¡¬ä»¶ä»¥é€‚åº”æ›´å¤šçš„å®¢æˆ·å’Œæ›´å¤šçš„æ•°æ®æ ¹æ®è¦æ±‚ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡çš„æ•°æ®æµé‡è½»æ¾æ‰©å±•é›†ç¾¤è§„æ¨¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¶æ„ç‰¹ç‚¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Cassandraå¯ä»¥åŸºäºåˆ†å¸ƒå¼è¿è¡Œï¼Œå¹¶é‡‡ç”¨äº†è®¸å¤šå®¹é”™æœºåˆ¶ã€‚ç”±äºå»ä¸­å¿ƒåŒ–æ— ä¸»çš„ç­–ç•¥ï¼Œæ‰€ä»¥æ²¡æœ‰å•ç‚¹æ•…éšœã€‚å¯ä»¥åšåˆ°ä¸åœæœæ»šåŠ¨å‡çº§ã€‚è¿™æ˜¯å› ä¸ºCassandraå¯ä»¥æ”¯æŒå¤šä¸ªèŠ‚ç‚¹çš„ä¸´æ—¶å¤±æ•ˆï¼ˆå–å†³äºç¾¤é›†å¤§å°ï¼‰ï¼Œå¯¹ç¾¤é›†çš„æ•´ä½“æ€§èƒ½å½±å“å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚å¹¶ä¸”Cassandraæä¾›å¤šåœ°åŸŸå®¹ç¾ã€‚Cassandraå…è®¸å°†æ•°æ®å¤åˆ¶åˆ°å…¶ä»–æ•°æ®ä¸­å¿ƒï¼Œå¹¶åœ¨å¤šä¸ªåœ°åŸŸä¿ç•™å¤šå‰¯æœ¬ï¼Œååˆ†é€‚ç”¨äºä¸èƒ½æ‰¿æ‹…æ•…éšœçš„å…³é”®ä¸šåŠ¡ï¼Œå¿…é¡»æŒç»­æä¾›æœåŠ¡çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®å­˜å‚¨æœºåˆ¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Cassandraé€‚åº”æ‰€æœ‰å¯èƒ½çš„æ•°æ®æ ¼å¼ï¼ŒåŒ…æ‹¬ï¼šç»“æ„åŒ–ï¼ŒåŠç»“æ„åŒ–å’Œéç»“æ„åŒ–ã€‚å¯ä»¥æ ¹æ®ä¸šåŠ¡çš„éœ€è¦åŠ¨æ€åœ°é€‚åº”å˜åŒ–çš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”é€šè¿‡åœ¨å¤šä¸ªæ•°æ®ä¸­å¿ƒä¹‹é—´å¤åˆ¶æ•°æ®ï¼Œå¯ä»¥çµæ´»åœ°åœ¨éœ€è¦æ—¶åˆ†å‘æ•°æ®ã€‚æœ‰è®¸å¤šæ¡ˆä¾‹è¯æ˜Cassandraå¯ä»¥åœ¨é‡‘èï¼ŒåŒ»ç–—ï¼Œç‰©è”ç½‘ç­‰é¢†åŸŸä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;èµ„æºæ•´åˆèƒ½åŠ›&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Cassandraå¯ä»¥å¾ˆå®¹æ˜“çš„è·Ÿå…¶ä»–å¼€æºç»„ä»¶åšé›†æˆï¼Œå…¶ä¸­åŒ…æ‹¬Hadoopï¼ŒSparkï¼ŒKafkaï¼ŒSolrç­‰ç³»åˆ—ç»„ä»¶ï¼Œæˆä¸ºå¤§æ•°æ®ä¸šåŠ¡å¤„ç†é‡Œé¢é‡è¦çš„ä¸€ä¸ªè§’è‰²ã€‚&lt;/p&gt;

&lt;h2 id=&quot;1ã€ç¯å¢ƒæ¦‚è§ˆ&quot;&gt;1ã€ç¯å¢ƒæ¦‚è§ˆ&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;jdk1.8&lt;/li&gt;
&lt;li&gt;apache-cassandra-3.11.7-bin.tar.gz&lt;/li&gt;
&lt;li&gt;centos7&lt;/li&gt;
&lt;li&gt;ä¸‰å°æœåŠ¡ï¼šhop01ã€hop02ã€hop03èŠ‚ç‚¹&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;2ã€å®‰è£…åŒ…å¤„ç†&quot;&gt;2ã€å®‰è£…åŒ…å¤„ç†&lt;/h2&gt;
&lt;pre&gt;
&lt;code&gt;tar -zxvf apache-cassandra-3.11.7-bin.tar.gz
mv apache-cassandra-3.11.7 cassandra3.11
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;3ã€ç¯å¢ƒå˜é‡&quot;&gt;3ã€ç¯å¢ƒå˜é‡&lt;/h2&gt;
&lt;pre&gt;
&lt;code&gt;[root@hop01 opt]# vim /etc/profile

export CASSANDRA_HOME=/opt/cassandra3.11
export PATH=$PATH:$CASSANDRA_HOME/bin

[root@hop01 opt]# source /etc/profile
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;4ã€åˆ›å»ºç›®å½•&quot;&gt;4ã€åˆ›å»ºç›®å½•&lt;/h2&gt;
&lt;pre&gt;
&lt;code&gt;# æ•°æ®ç›®å½•
mkdir -p /data/cassandra/data
# æ—¥å¿—ç›®å½•
mkdir -p /data/cassandra/log
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;5ã€é›†ç¾¤é…ç½®&quot;&gt;5ã€é›†ç¾¤é…ç½®&lt;/h2&gt;
&lt;pre&gt;
&lt;code&gt;vim /opt/cassandra3.11/conf/cassandra.yaml

# é…ç½®é›†ç¾¤åç§°
cluster_name: 'CasCluster'
# é…ç½®æ•°æ®ç›®å½•
data_file_directories:
     - /data/cassandra/data
# é…ç½®æ—¥å¿—ç›®å½•
commitlog_directory: /data/cassandra/log
# è®¾ç½®ç›‘å¬åœ°å€ï¼Œå½“å‰æœåŠ¡IP
listen_address: 192.168.72.132
# é…ç½®RPCæœåŠ¡
start_rpc: true
rpc_address: 192.168.72.132
# é…ç½®é›†ç¾¤èŠ‚ç‚¹
seed_provider:
    - class_name: org.apache.cassandra.locator.SimpleSeedProvider
      parameters:
          - seeds: &quot;192.168.72.132,192.168.72.138,192.168.72.139&quot;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å°†è¯¥é…ç½®åˆ†å‘åˆ°é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œæ³¨æ„listen_addresså’Œrpc_addressæ˜¯èŠ‚ç‚¹è‡ªå·±çš„IPåœ°å€å³å¯ã€‚&lt;/p&gt;
&lt;h2 id=&quot;6ã€å¯åŠ¨é›†ç¾¤&quot;&gt;6ã€å¯åŠ¨é›†ç¾¤&lt;/h2&gt;
&lt;pre&gt;
&lt;code&gt;# é›†ç¾¤ä¸‹èŠ‚ç‚¹ä¾æ¬¡æ‰§è¡Œå¯åŠ¨å‘½ä»¤
cassandra -R
# æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€
nodetool status
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;7ã€åŸºç¡€æ“ä½œ&quot;&gt;7ã€åŸºç¡€æ“ä½œ&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;è¿›å…¥å‘½ä»¤è¡Œ&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;cqlsh hop01
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»ºkeyspace,å¹¶é€‰æ‹©&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;CREATE KEYSPACE IF NOT EXISTS castest WITH REPLICATION = {'class': 'SimpleStrategy','replication_factor':3};

use castest ;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;åˆ›å»ºè¡¨ï¼Œå†™å…¥æ•°æ®&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;CREATE TABLE user_info (id int, user_name varchar, PRIMARY KEY (id) );
INSERT INTO user_info (id,user_name) VALUES (1,'user01');
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;æŸ¥è¯¢æ•°æ®&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;select * from user_info ;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åŸºäºå…¶ä»–æœåŠ¡æŸ¥çœ‹æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®å·²ç»åœ¨é›†ç¾¤é—´åšäº†åŒæ­¥è¿‡ç¨‹:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1691717/202008/1691717-20200811232054862-717716414.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;h2 id=&quot;1ã€æ ¸å¿ƒä¾èµ–&quot;&gt;1ã€æ ¸å¿ƒä¾èµ–&lt;/h2&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;${spring.boot.version}&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-starter-data-cassandra&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;${spring.boot.version}&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-starter-data-jpa&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;${spring.boot.version}&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œæ ¸å¿ƒéœ€è¦cassandraä¾èµ–å’Œæ“ä½œçš„APIä¾èµ–ã€‚&lt;/p&gt;
&lt;h2 id=&quot;2ã€æ ¸å¿ƒé…ç½®&quot;&gt;2ã€æ ¸å¿ƒé…ç½®&lt;/h2&gt;
&lt;pre&gt;
&lt;code&gt;spring:
  data:
    cassandra:
      keyspace-name: castest
      contact-points: 192.168.72.138,192.168.72.132,192.168.72.139
      port: 9042
      cluster-name: CasCluster
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;keyspace-name&lt;/strong&gt;ï¼šç±»ä¼¼å…³ç³»å‹æ•°æ®åº“çš„åç§°ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;contact-points&lt;/strong&gt;ï¼šé›†ç¾¤ä¸‹èŠ‚ç‚¹çš„IPåœ°å€ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;port&lt;/strong&gt;ï¼šé»˜è®¤ç«¯å£ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;cluster-name&lt;/strong&gt;ï¼šä¸Šè¿°é…ç½®çš„é›†ç¾¤åç§°ï¼›&lt;/p&gt;
&lt;h2 id=&quot;3ã€åŸºäºtemplateå‘½ä»¤&quot;&gt;3ã€åŸºäºTemplateå‘½ä»¤&lt;/h2&gt;
&lt;p&gt;CassandraTemplateæ¨¡æ¿ç±»ï¼Œå®ç°äº†ä¸€ç³»åˆ—æ“ä½œCassandraæ•°æ®åº“çš„åŸºæœ¬æ–¹æ³•ï¼Œç›´æ¥æ³¨å…¥å³å¯ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;@Repository
public class UserInfoTemplate {

    @Resource
    private CassandraTemplate cassandraTemplate ;

    // æŸ¥è¯¢å…¨éƒ¨æ•°æ®
    public List&amp;lt;UserInfo&amp;gt; getList (){
        return cassandraTemplate.select(&quot;SELECT * FROM user_info&quot;,UserInfo.class) ;
    }

    // æ·»åŠ æ•°æ®
    public UserInfo insert (UserInfo userInfo){
        return cassandraTemplate.insert(userInfo) ;
    }

    // æ ¹æ®ä¸»é”®æŸ¥è¯¢
    public UserInfo selectOneById (Integer id){
        return cassandraTemplate.selectOneById(id,UserInfo.class) ;
    }

    // ä¿®æ”¹æ•°æ®
    public UserInfo update (UserInfo userInfo){
        return cassandraTemplate.update(userInfo) ;
    }

    // åˆ é™¤æ•°æ®
    public Boolean deleteById (Integer id){
        return cassandraTemplate.deleteById(id,UserInfo.class) ;
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;4ã€åŸºäºrepositoryæ¥å£&quot;&gt;4ã€åŸºäºRepositoryæ¥å£&lt;/h2&gt;
&lt;p&gt;SpringBootæ¡†æ¶ä¸­å®šä¹‰çš„æ•°æ®åº“è®¿é—®æ ¸å¿ƒæ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¥å£å®ç°&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;import com.cassand.cluster.entity.UserInfo;
import org.springframework.data.repository.CrudRepository;

public interface UserInfoRepository extends CrudRepository&amp;lt;UserInfo,Integer&amp;gt; {

}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;æ¥å£ç”¨æ³•&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;@Service
public class RepositoryService {

    @Resource
    private UserInfoRepository userInfoRepository ;

    // ä¿å­˜
    public UserInfo save (UserInfo userInfo){
        return userInfoRepository.save(userInfo) ;
    }

    // æŸ¥è¯¢
    public UserInfo getById (Integer id){
        return userInfoRepository.findById(id).get() ;
    }

    // ä¿®æ”¹
    public UserInfo update (UserInfo userInfo){
        // ä¸»é”®IDå­˜åœ¨çš„æƒ…å†µå³ä¸ºä¿®æ”¹
        return userInfoRepository.save(userInfo);
    }

    // åˆ é™¤
    public void deleteById (Integer id){
        userInfoRepository.deleteById(id);
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;5ã€å®ä½“è¡¨ç»“æ„&quot;&gt;5ã€å®ä½“è¡¨ç»“æ„&lt;/h2&gt;
&lt;p&gt;æ³¨æ„è¿™é‡Œçš„æ³¨è§£æ˜¯åŸºäºcassandraç‰¹å®šçš„ä¸€å¥—ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;import org.springframework.data.cassandra.core.mapping.Column;
import org.springframework.data.cassandra.core.mapping.PrimaryKey;
import org.springframework.data.cassandra.core.mapping.Table;

@Table(&quot;user_info&quot;)
public class UserInfo {

    public UserInfo(Integer id, String userName) {
        this.id = id;
        this.userName = userName;
    }

    @PrimaryKey
    private Integer id ;

    @Column(value = &quot;user_name&quot;)
    private String userName ;
}
&lt;/code&gt;
&lt;/pre&gt;

&lt;pre&gt;
&lt;code&gt;GitHubÂ·åœ°å€
https://github.com/cicadasmile/data-manage-parent
GitEEÂ·åœ°å€
https://gitee.com/cicadasmile/data-manage-parent
&lt;/code&gt;
&lt;/pre&gt;
&lt;img width=&quot;100%&quot; height=&quot;400px&quot; src=&quot;https://img2020.cnblogs.com/blog/1691717/202008/1691717-20200811231321146-174169065.png&quot;/&gt;&lt;p&gt;&lt;strong&gt;æ¨èé˜…è¯»ï¼šæ•°æ®æºç®¡ç†ç³»åˆ—&lt;/strong&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 12 Aug 2020 00:01:00 +0000</pubDate>
<dc:creator>çŸ¥äº†ä¸€ç¬‘</dc:creator>
<og:description>æœ¬æ–‡æºç ï¼šGitHub&amp;amp;#183;ç‚¹è¿™é‡Œ || GitEE&amp;amp;#183;ç‚¹è¿™é‡Œ ä¸€ã€Cassandraç®€ä»‹ 1ã€åŸºç¡€æè¿° Cassandraæ˜¯ä¸€å¥—å¼€æºåˆ†å¸ƒå¼NoSQLæ•°æ®åº“ç³»ç»Ÿã€‚å®ƒæœ€åˆç”±</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/cicada-smile/p/13488035.html</dc:identifier>
</item>
<item>
<title>[æºç è§£æ] Flink UDAF èƒŒååšäº†ä»€ä¹ˆ - ç½—è¥¿çš„æ€è€ƒ</title>
<link>http://www.cnblogs.com/rossiXYZ/p/13460408.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/rossiXYZ/p/13460408.html</guid>
<description>&lt;p&gt;æœ¬æ–‡æ¶‰åŠåˆ°Flink SQL UDAFï¼ŒWindow çŠ¶æ€ç®¡ç†ç­‰éƒ¨åˆ†ï¼Œå¸Œæœ›èƒ½èµ·åˆ°æŠ›ç –å¼•ç‰çš„ä½œç”¨ï¼Œè®©å¤§å®¶å¯ä»¥å€Ÿæ­¤æ·±å…¥äº†è§£è¿™ä¸ªé¢†åŸŸã€‚&lt;/p&gt;&lt;div id=&quot;cnblogs_post_body&quot; readability=&quot;292.61059965165&quot;&gt;


&lt;h2 id=&quot;0x00-æ‘˜è¦&quot;&gt;0x00 æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡æ¶‰åŠåˆ°Flink SQL UDAFï¼ŒWindow çŠ¶æ€ç®¡ç†ç­‰éƒ¨åˆ†ï¼Œå¸Œæœ›èƒ½èµ·åˆ°æŠ›ç –å¼•ç‰çš„ä½œç”¨ï¼Œè®©å¤§å®¶å¯ä»¥å€Ÿæ­¤æ·±å…¥äº†è§£è¿™ä¸ªé¢†åŸŸã€‚&lt;/p&gt;
&lt;h2 id=&quot;0x01-æ¦‚å¿µ&quot;&gt;0x01 æ¦‚å¿µ&lt;/h2&gt;
&lt;h3 id=&quot;11-æ¦‚å¿µ&quot;&gt;1.1 æ¦‚å¿µ&lt;/h3&gt;
&lt;p&gt;å¤§å®¶çŸ¥é“ï¼ŒFlinkçš„è‡ªå®šä¹‰èšåˆå‡½æ•°ï¼ˆUDAFï¼‰å¯ä»¥å°†å¤šæ¡è®°å½•èšåˆæˆ1æ¡è®°å½•ï¼Œè¿™åŠŸèƒ½æ˜¯é€šè¿‡accumulateæ–¹æ³•æ¥å®Œæˆçš„ï¼Œå®˜æ–¹å‚è€ƒæŒ‡å‡ºï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;åœ¨ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œåº•å±‚runtimeä»£ç ä¼šæŠŠå†å²çŠ¶æ€accumulatorï¼Œå’Œæ‚¨æŒ‡å®šçš„ä¸Šæ¸¸æ•°æ®ï¼ˆæ”¯æŒä»»æ„æ•°é‡ï¼Œä»»æ„ç±»å‹çš„æ•°æ®ï¼‰ä½œä¸ºå‚æ•°ï¼Œä¸€èµ·å‘é€ç»™accumulateè®¡ç®—ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½†æ˜¯å®æ—¶è®¡ç®—è¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ï¼Œåœ¨æ­¤åœºæ™¯ä¸‹ï¼Œè¿˜éœ€è¦æä¾›mergeæ–¹æ³•æ‰èƒ½å®Œæˆã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;åœ¨å®æ—¶è®¡ç®—ä¸­ä¸€äº›åœºæ™¯éœ€è¦mergeï¼Œä¾‹å¦‚session windowã€‚ ç”±äºå®æ—¶è®¡ç®—å…·æœ‰out of orderçš„ç‰¹æ€§ï¼Œåè¾“å…¥çš„æ•°æ®æœ‰å¯èƒ½ä½äº2ä¸ªåŸæœ¬åˆ†å¼€çš„sessionä¸­é—´ï¼Œè¿™æ ·å°±æŠŠ2ä¸ªsessionåˆä¸º1ä¸ªsessionã€‚æ­¤æ—¶ï¼Œéœ€è¦ä½¿ç”¨mergeæ–¹æ³•æŠŠå¤šä¸ªaccumulatoråˆä¸º1ä¸ªaccumulatorã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;12-ç–‘é—®&quot;&gt;1.2 ç–‘é—®&lt;/h3&gt;
&lt;p&gt;ä¹‹å‰å› ä¸ºæ²¡äº²èº«æ“ä½œï¼Œæ‰€ä»¥ä¸€ç›´å¿½ç•¥mergeçš„ç‰¹æ®Šæ€§ã€‚æœ€è¿‘æ— æ„ä¸­çœ‹åˆ°äº†ä¸€ä¸ªUDAFçš„å®ç°ï¼Œçªç„¶è§‰å¾—æœ‰ä¸€ä¸ªåœ°æ–¹å¾ˆå¥‡æ€ªï¼Œå³ accumulate å’Œ merge è¿™ä¸¤ä¸ªå‡½æ•°ä¸åº”è¯¥å®šä¹‰åœ¨ä¸€ä¸ªç±»ä¸­ã€‚å› ä¸ºè¿™æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„å¤„ç†æ–¹æ³•ã€‚åº”è¯¥å®šä¹‰åœ¨ä¸¤ä¸ªä¸åŒçš„ç±»ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ç”¨UDAFåšword countï¼Œåˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;accumulate æ˜¯åœ¨ä¸€ä¸ªtaskä¸­ç´¯ç§¯æ•°å­—ï¼Œå…¶å®å°±ç›¸å½“äº mapï¼›&lt;/li&gt;
&lt;li&gt;merge æ˜¯æŠŠå¾ˆå¤štaskçš„ç»“æœå†æ¬¡ç´¯ç§¯èµ·æ¥ï¼Œå°±ç›¸å½“äº reduceï¼›&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;ç„¶ååˆæƒ³å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼šFlinkæ˜¯å¦‚ä½•ç®¡ç† UDAFçš„accumulatorï¼Ÿå…¶çŠ¶æ€å­˜åœ¨å“ªé‡Œï¼Ÿ&lt;/p&gt;
&lt;p&gt;çœ‹èµ·æ¥åº”è¯¥æ˜¯Flinkåœ¨èƒŒååšäº†ä¸€äº›é»‘é­”æ³•ï¼ŒæŠŠè¿™ä¸¤ä¸ªå‡½æ•°ä»ä¸€ä¸ªç±»ä¸­æ‹†åˆ†äº†ã€‚ä¸ºäº†éªŒè¯æˆ‘ä»¬çš„æ¨æµ‹ï¼Œè®©æˆ‘ä»¬ä»æºç å…¥æ‰‹æ¥çœ‹çœ‹è¿™äº›é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Flink SQLè½¬æ¢/æ‰§è¡Œè®¡åˆ’ç”Ÿæˆé˜¶æ®µï¼Œå¦‚ä½•å¤„ç†åœ¨ &quot;åŒä¸€ä¸ªç±»ä¸­&quot; çš„ä¸åŒç±»å‹åŠŸèƒ½å‡½æ•° accumulate å’Œ mergeï¼Ÿ&lt;/li&gt;
&lt;li&gt;Flink runtime å¦‚ä½•å¤„ç† mergeï¼Ÿ&lt;/li&gt;
&lt;li&gt;Flink runtime å¦‚ä½•å¤„ç† UDAFçš„accumulatorçš„å†å²çŠ¶æ€ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;13-udafç¤ºä¾‹ä»£ç &quot;&gt;1.3 UDAFç¤ºä¾‹ä»£ç &lt;/h3&gt;
&lt;p&gt;ç¤ºä¾‹ä»£ç æ‘˜è¦å¦‚ä¸‹ ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public class CountUdaf extends AggregateFunction&amp;lt;Long, CountUdaf.CountAccum&amp;gt; {
    //å®šä¹‰å­˜æ”¾count UDAFçŠ¶æ€çš„accumulatorçš„æ•°æ®çš„ç»“æ„ã€‚
    public static class CountAccum {
        public long total;
    }
  
    //åˆå§‹åŒ–count UDAFçš„accumulatorã€‚
    public CountAccum createAccumulator() {
        CountAccum acc = new CountAccum();
        acc.total = 0;
        return acc;
    }
  
    //accumulateæä¾›äº†ï¼Œå¦‚ä½•æ ¹æ®è¾“å…¥çš„æ•°æ®ï¼Œæ›´æ–°count UDAFå­˜æ”¾çŠ¶æ€çš„accumulatorã€‚
    public void accumulate(CountAccum accumulator, Object iValue) {
        accumulator.total++;
    }

    public void merge(CountAccum accumulator, Iterable&amp;lt;CountAccum&amp;gt; its) {
        for (CountAccum other : its) {
            accumulator.total += other.total;
        }
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;0x02-æ‰¹å¤„ç†&quot;&gt;0x02 æ‰¹å¤„ç†&lt;/h2&gt;
&lt;p&gt;æ‰¹å¤„ç†ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºæ•°æ®æ˜¯æœ‰è¾¹ç•Œçš„ï¼Œå…¶é€»è¾‘æ¯”è¾ƒæ¸…æ™°ã€‚&lt;/p&gt;
&lt;h3 id=&quot;21-ä»£ç &quot;&gt;2.1 ä»£ç &lt;/h3&gt;
&lt;p&gt;é¦–å…ˆç»™å‡ºæµ‹è¯•ä»£ç &lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-scala&quot;&gt;val input = env.fromElements(WC(&quot;hello&quot;, 1), WC(&quot;hello&quot;, 1), WC(&quot;ciao&quot;, 1))

// register the DataSet as a view &quot;WordCount&quot;
tEnv.createTemporaryView(&quot;WordCount&quot;, input, 'word, 'frequency)
tEnv.registerFunction(&quot;countUdaf&quot;, new CountUdaf())

// run a SQL query on the Table and retrieve the result as a new Table
val table = tEnv.sqlQuery(&quot;SELECT word, countUdaf(frequency), SUM(frequency) FROM WordCount GROUP BY word&quot;)

case class WC(word: String, frequency: Long)
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;22-è®¡åˆ’ç”Ÿæˆ&quot;&gt;2.2 è®¡åˆ’ç”Ÿæˆ&lt;/h3&gt;
&lt;p&gt;åœ¨ &lt;code&gt;DataSetAggregate.translateToPlan&lt;/code&gt; ä¸­ç”Ÿæˆäº†æ‰§è¡Œè®¡åˆ’ã€‚åŸæ¥FlinkæŠŠ SQL è¯­å¥åˆ†å‰²æˆä¸¤ä¸ªé˜¶æ®µï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;combineGroup&lt;/li&gt;
&lt;li&gt;reduceGroup&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;äºæ˜¯æˆ‘ä»¬æ¨æ–­ï¼Œ&lt;u&gt;è¿™å¾ˆæœ‰å¯èƒ½å°±æ˜¯ combineGroup è°ƒç”¨accumulateï¼ŒreduceGroup è°ƒç”¨ merge&lt;/u&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºcombineGroupï¼Œå¦‚æœæœ‰å…´è¶£ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘ä¹‹å‰æ–‡ç«  &lt;a href=&quot;https://www.cnblogs.com/rossiXYZ/p/13080429.html&quot;&gt;[æºç è§£æ] Flinkçš„groupByå’Œreduceç©¶ç«Ÿåšäº†ä»€ä¹ˆ&lt;/a&gt; ä»¥åŠ &lt;a href=&quot;https://www.cnblogs.com/rossiXYZ/p/13148695.html&quot;&gt;æºç è§£æ] GroupReduceï¼ŒGroupCombine å’Œ Flink SQL group by&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;override def translateToPlan(tableEnv: BatchTableEnvImpl,
    queryConfig: BatchQueryConfig): DataSet[Row] = {
    if (grouping.length &amp;gt; 0) {
      // grouped aggregation

      if (preAgg.isDefined) {
        // æ‰§è¡Œåˆ°è¿™é‡Œ
        inputDS
          // pre-aggregation
          .groupBy(grouping: _*)
          .combineGroup(preAgg.get) // ç¬¬ä¸€é˜¶æ®µ
          .returns(preAggType.get)
          .name(aggOpName)
          
          // final aggregation
          .groupBy(grouping.indices: _*)
          .reduceGroup(finalAgg.right.get) // ç¬¬äºŒé˜¶æ®µ
          .returns(rowTypeInfo)
          .name(aggOpName)
      }
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;SQLè¯­å¥å¯¹åº”çš„æ‰§è¡Œè®¡åˆ’å¤§è‡´ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1850883/202008/1850883-20200808212536018-1739987680.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;23-æ‰§è¡Œ&quot;&gt;2.3 æ‰§è¡Œ&lt;/h3&gt;
&lt;p&gt;åœ¨æ‰§è¡Œçœ‹ï¼Œç¡®å®å¯¹åº”äº†ä¸¤ä¸ªé˜¶æ®µã€‚&lt;/p&gt;
&lt;p&gt;é˜¶æ®µ 1 ç¡®å®æ˜¯ GroupReduceCombineDriver è°ƒç”¨åˆ°äº† accumulateã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;//å †æ ˆå¦‚ä¸‹
accumulate:25, CountUdaf (mytest)
accumulate:-1, DataSetAggregatePrepareMapHelper$5
combine:71, DataSetPreAggFunction (org.apache.flink.table.runtime.aggregate)
sortAndCombine:213, GroupReduceCombineDriver (org.apache.flink.runtime.operators)
run:188, GroupReduceCombineDriver (org.apache.flink.runtime.operators)
  
//SQL UDAFç”Ÿæˆçš„ä»£ç å¦‚ä¸‹  
function = {DataSetAggregatePrepareMapHelper$5@10085} 
 function_mytest$CountUdaf$5ae272a09e5f36214da5c4e5436c4c48 = {CountUdaf@10079} &quot;CountUdaf&quot;
 function_org$apache$flink$table$functions$aggfunctions$LongSumAggFunction$a5214701531789b3139223681d = {LongSumAggFunction@10087} &quot;LongSumAggFunction&quot;  
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;é˜¶æ®µ 2 ä¸­ GroupReduceDriver è°ƒç”¨åˆ°äº† merge&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;//å †æ ˆå¦‚ä¸‹
merge:29, CountUdaf (mytest)
mergeAccumulatorsPair:-1, DataSetAggregateFinalHelper$6
reduce:71, DataSetFinalAggFunction (org.apache.flink.table.runtime.aggregate)
run:131, GroupReduceDriver (org.apache.flink.runtime.operators)
  
//SQL UDAFç”Ÿæˆçš„ä»£ç å¦‚ä¸‹   
function = {DataSetAggregateFinalHelper$6@10245} 
 function_mytest$CountUdaf$5ae272a09e5f36214da5c4e5436c4c48 = {CountUdaf@10238} &quot;CountUdaf&quot;
 function_org$apache$flink$table$functions$aggfunctions$LongSumAggFunction$a5214701531789b3139223681d = {LongSumAggFunction@10247} &quot;LongSumAggFunction&quot;  
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;u&gt;Flinkå¯¹ç”¨æˆ·å®šä¹‰çš„UDAFä»£ç åˆ†åˆ«ç”Ÿæˆäº†ä¸¤ä¸ªä¸åŒçš„åŠŸèƒ½ç±»&lt;/u&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;DataSetAggregatePrepareMapHelper ï¼š ç”¨äºCombineé˜¶æ®µï¼Œè°ƒç”¨äº†accumulate&lt;/li&gt;
&lt;li&gt;DataSetAggregateFinalHelper ï¼šç”¨äºReduceé˜¶æ®µï¼Œè°ƒç”¨äº†merge&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;24-çŠ¶æ€ç®¡ç†&quot;&gt;2.4 çŠ¶æ€ç®¡ç†&lt;/h3&gt;
&lt;p&gt;UDAFæœ‰ä¸€ä¸ªaccumulatorï¼Œè¿™ä¸ªä¼šåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å§‹ç»ˆå­˜åœ¨ï¼ŒFlinkæ˜¯å¦‚ä½•ç®¡ç†è¿™ä¸ªaccumulatorå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;GroupReduceCombineDriverç±»æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ combinerï¼Œ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public class GroupReduceCombineDriver&amp;lt;IN, OUT&amp;gt; implements Driver&amp;lt;GroupCombineFunction&amp;lt;IN, OUT&amp;gt;, OUT&amp;gt; {
        private GroupCombineFunction&amp;lt;IN, OUT&amp;gt; combiner;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è€Œ combiner è¢«èµ‹äºˆäº† DataSetPreAggFunction ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;class DataSetPreAggFunction(genAggregations: GeneratedAggregationsFunction)
  extends AbstractRichFunction{
  private var accumulators: Row = _ //è¿™é‡Œå­˜å‚¨å†å²çŠ¶æ€
  private var function: GeneratedAggregations = _
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Flinkå°±æ˜¯æŠŠ UDAFçš„accumulator å­˜å‚¨åœ¨ &lt;code&gt;combiner.accumulators&lt;/code&gt; ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ&lt;u&gt;æ— è®ºç”¨æˆ·å®šä¹‰äº†ä»€ä¹ˆç±»å‹ä½œä¸º accumulatorï¼ŒFlinkéƒ½ç”¨ä¸‡èƒ½ç±»å‹ Row æå®š&lt;/u&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;combiner = {DataSetPreAggFunction@10063} 
 genAggregations = {GeneratedAggregationsFunction@10070} 
 accumulators = {Row@10117} &quot;mytest.CountUdaf$CountAccum@1e343db7,(0,false)&quot;
 function = {DataSetAggregatePrepareMapHelper$5@10066}  // functionæ˜¯åŒ…å«ç”¨æˆ·ä»£ç çš„åŠŸèƒ½ç±»ã€‚
  function_mytest$CountUdaf$5ae272a09e5f36214da5c4e5436c4c48 = {CountUdaf@10076} &quot;CountUdaf&quot; 
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;25-æ€»ç»“&quot;&gt;2.5 æ€»ç»“&lt;/h3&gt;
&lt;p&gt;è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ï¼Œæ‰¹å¤„ç†è¢«åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;combineGroup ï¼šæ ¹æ®ç”¨æˆ·UDAFä»£ç ç”ŸæˆåŠŸèƒ½ç±» DataSetAggregatePrepareMapHelperï¼Œç”¨äºCombineé˜¶æ®µï¼Œè°ƒç”¨äº†accumulateï¼›&lt;/li&gt;
&lt;li&gt;reduceGroup ï¼šæ ¹æ®ç”¨æˆ·UDAFä»£ç ç”ŸæˆåŠŸèƒ½ç±» DataSetAggregateFinalHelperï¼Œç”¨äºReduceé˜¶æ®µï¼Œè°ƒç”¨äº† mergeï¼›&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;Flinkåœ¨GroupReduceCombineDriverç±»çš„æˆå‘˜å˜é‡ combiner ä¸­å­˜å‚¨ accumulatorå†å²çŠ¶æ€ã€‚&lt;/p&gt;
&lt;h2 id=&quot;0x03-æµå¤„ç†&quot;&gt;0x03 æµå¤„ç†&lt;/h2&gt;
&lt;p&gt;æµå¤„ç†åˆ™æ˜¯å’Œæ‰¹å¤„ç†å®Œå…¨ä¸åŒçš„ä¸–ç•Œï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹æµå¤„ç†èƒŒåæœ‰ä»€ä¹ˆå¥¥ç§˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æµè®¡ç®—åœºæ™¯ä¸­ï¼Œæ•°æ®æ²¡æœ‰è¾¹ç•Œæºæºä¸æ–­çš„æµå…¥çš„ï¼Œæ¯æ¡æ•°æ®æµå…¥éƒ½å¯èƒ½ä¼šè§¦å‘è®¡ç®—ï¼Œæ¯”å¦‚åœ¨è¿›è¡Œcountæˆ–sumè¿™äº›æ“ä½œæ˜¯å¦‚ä½•è®¡ç®—çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æ˜¯é€‰æ‹©æ¯æ¬¡è§¦å‘è®¡ç®—å°†æ‰€æœ‰æµå…¥çš„å†å²æ•°æ®é‡æ–°è®¡ç®—ä¸€éï¼Ÿ&lt;/li&gt;
&lt;li&gt;è¿˜æ˜¯æ¯æ¬¡è®¡ç®—éƒ½åŸºäºä¸Šæ¬¡è®¡ç®—ç»“æœè¿›è¡Œå¢é‡è®¡ç®—å‘¢ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚æœé€‰æ‹©å¢é‡è®¡ç®—ï¼Œé‚£ä¹ˆä¸Šä¸€æ¬¡çš„ä¸­é—´è®¡ç®—ç»“æœä¿å­˜åœ¨å“ªé‡Œï¼Ÿå†…å­˜ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;31-ç¤ºä¾‹ä»£ç &quot;&gt;3.1 ç¤ºä¾‹ä»£ç &lt;/h3&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;val query: Table = tableEnv.sqlQuery(
  &quot;&quot;&quot;
    |SELECT
    |countUdaf(num)
    |FROM tb_num
    |GROUP BY TUMBLE(proctime, INTERVAL '10' SECOND)
   &quot;&quot;&quot;.stripMargin)
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;32-è®¡åˆ’ç”Ÿæˆ&quot;&gt;3.2 è®¡åˆ’ç”Ÿæˆ&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;DataStreamGroupWindowAggregateBase.translateToPlan&lt;/code&gt; å‡½æ•°ä¸­å®Œæˆäº†è®¡åˆ’ç”Ÿæˆã€‚æ ¹æ®Streamçš„ç±»å‹ï¼ˆæ˜¯å¦æœ‰keyï¼‰ï¼Œä¼šèµ°ä¸åŒçš„é€»è¾‘ä¸šåŠ¡ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;WindowedStream&lt;/code&gt;ä»£è¡¨äº†&lt;u&gt;æ ¹æ®keyåˆ†ç»„&lt;/u&gt;ï¼Œå¹¶ä¸”åŸºäº&lt;code&gt;WindowAssigner&lt;/code&gt;åˆ‡åˆ†çª—å£çš„æ•°æ®æµã€‚æ‰€ä»¥&lt;code&gt;WindowedStream&lt;/code&gt;éƒ½æ˜¯ä»&lt;code&gt;KeyedStream&lt;/code&gt;è¡ç”Ÿè€Œæ¥çš„ã€‚åœ¨keyåˆ†ç»„çš„æµä¸Šè¿›è¡Œçª—å£åˆ‡åˆ†æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„åœºæ™¯ï¼Œä¹Ÿèƒ½å¤Ÿå¾ˆå¥½åœ°å¹¶è¡ŒåŒ–ï¼ˆä¸åŒçš„keyä¸Šçš„çª—å£èšåˆå¯ä»¥åˆ†é…åˆ°ä¸åŒçš„taskå»å¤„ç†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å½“åœ¨æ™®é€šæµï¼ˆæ²¡æœ‰keyï¼‰ä¸Šè¿›è¡Œçª—å£æ“ä½œæ—¶ï¼Œå°±è¦ç”¨åˆ° &lt;code&gt;AllWindowedStream&lt;/code&gt;ã€‚&lt;code&gt;AllWindowedStream&lt;/code&gt;æ˜¯ç›´æ¥åœ¨&lt;code&gt;DataStream&lt;/code&gt;ä¸Šè¿›è¡Œ&lt;code&gt;windowAll(...)&lt;/code&gt;æ“ä½œã€‚åœ¨æ™®é€šæµä¸Šè¿›è¡Œçª—å£æ“ä½œï¼Œå°±åŠ¿å¿…éœ€è¦å°†æ‰€æœ‰åˆ†åŒºçš„æµéƒ½æ±‡é›†åˆ°å•ä¸ªçš„Taskä¸­ï¼Œè€Œè¿™ä¸ªå•ä¸ªçš„Taskå¾ˆæ˜¾ç„¶å°±ä¼šæˆä¸ºæ•´ä¸ªJobçš„ç“¶é¢ˆã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;æˆ‘ä»¬çš„ç¤ºä¾‹ä»£ç æ˜¯åŸºäºKeyçš„ï¼Œæ‰€ä»¥èµ° &lt;code&gt;WindowedStream&lt;/code&gt; åˆ†æ”¯ï¼Œ&lt;u&gt;å³ä¸€ä¸ª window ä¸­å³åšaccumulateï¼Œåˆåšmerge&lt;/u&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-scala&quot;&gt;// grouped / keyed aggregation
if (grouping.length &amp;gt; 0) {
      // æœ‰keyï¼Œæ‰€ä»¥æ˜¯ WindowedStreamï¼Œæˆ‘ä»¬ç¤ºä¾‹èµ°è¿™é‡Œ
      val windowFunction = AggregateUtil.createAggregationGroupWindowFunction(...)

      val keySelector = new CRowKeySelector(grouping, inputSchema.projectedTypeInfo(grouping))
      val keyedStream = timestampedInput.keyBy(keySelector)
      val windowedStream =
        createKeyedWindowedStream(queryConfig, window, keyedStream)
          .asInstanceOf[WindowedStream[CRow, Row, DataStreamWindow]]

      val (aggFunction, accumulatorRowType) =
        AggregateUtil.createDataStreamGroupWindowAggregateFunction(...)

      windowedStream
        .aggregate(aggFunction, windowFunction, accumulatorRowType, outRowType)
        .name(keyedAggOpName)
}
// global / non-keyed aggregation
else {
      // æ²¡æœ‰keyï¼Œæ‰€ä»¥æ˜¯AllWindowedStream 
      val windowFunction = AggregateUtil.createAggregationAllWindowFunction(...)

      val windowedStream =
        createNonKeyedWindowedStream(queryConfig, window, timestampedInput)
          .asInstanceOf[AllWindowedStream[CRow, DataStreamWindow]]

      val (aggFunction, accumulatorRowType) =
        AggregateUtil.createDataStreamGroupWindowAggregateFunction(...)

      windowedStream
        .aggregate(aggFunction, windowFunction, accumulatorRowType, outRowType)
        .name(nonKeyedAggOpName)
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;SQLè¯­å¥å¯¹åº”çš„æ‰§è¡Œè®¡åˆ’å¤§è‡´å¦‚ä¸‹ï¼Œæˆ‘ä»¬èƒ½çœ‹å‡ºæ¥ accumulate &amp;amp; merge éƒ½åœ¨ Window ä¸­å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1850883/202008/1850883-20200808212611349-1697751025.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;33-æ‰§è¡Œ--çŠ¶æ€ç®¡ç†&quot;&gt;3.3 æ‰§è¡Œ &amp;amp; çŠ¶æ€ç®¡ç†&lt;/h3&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œæµå¤„ç†å¯¹UDAFçš„ç®¡ç†ï¼Œå°±å®Œå…¨æ˜¯è¿›å…¥äº†Windowçš„åœ°ç›˜ï¼Œè€ŒUDAFå†å²çŠ¶æ€ç®¡ç†å…¶å®å°±æ˜¯&lt;u&gt;Flink WindowçŠ¶æ€ç®¡ç†çš„é¢†åŸŸ&lt;/u&gt;äº†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä»¥åŸºäºkeyçš„WindowedStreamä¸ºä¾‹ç»§ç»­è¿›è¡Œç ”ç©¶ã€‚&lt;/p&gt;
&lt;h4 id=&quot;331-æ¥å—åˆ°ä¸€ä¸ªæ–°è¾“å…¥&quot;&gt;3.3.1 æ¥å—åˆ°ä¸€ä¸ªæ–°è¾“å…¥&lt;/h4&gt;
&lt;p&gt;å½“Windowæ¥å—åˆ°ä¸€ä¸ªè¾“å…¥itemæ—¶å€™ï¼Œitemä¼šè¢«åˆ†é…åˆ°ä¸€ä¸ªkeyï¼Œç”±KeySelectorå®Œæˆã€‚WindowOperator ç±»é¦–å…ˆä½¿ç”¨ç”¨æˆ·é€‰æ‹©çš„ windowAssigner å°†æµå…¥çš„æ•°æ®åˆ†é…åˆ°å“åº”çš„windowä¸­ï¼Œæœ‰å¯èƒ½æ˜¯1ä¸ªï¼Œ0ä¸ªç”šè‡³å¤šä¸ªwindowã€‚&lt;u&gt;è¿™é‡Œå°±ä¼šåšaccumulate&lt;/u&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ä¾‹ &lt;code&gt;windowAssigner = {TumblingProcessingTimeWindows}&lt;/code&gt; ï¼Œè¿›å…¥åˆ°processElementå‡½æ•°çš„ &lt;u&gt;&lt;strong&gt;é MergingWindowéƒ¨åˆ†&lt;/strong&gt;&lt;/u&gt;ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;éå†elementWindowsï¼Œè¿›è¡Œä¸šåŠ¡å¤„ç†
&lt;ul&gt;&lt;li&gt;1)åˆ¤æ–­è¯¥windowæ˜¯å¦å·²è¿‡æœŸï¼ŒisWindowLate(window)&lt;/li&gt;
&lt;li&gt;2)è·å–è¯¥windowçš„contextï¼ŒwindowState.setCurrentNamespace(window); è¿™é‡Œæ˜¯ HeapAggregatingStateã€‚&lt;/li&gt;
&lt;li&gt;3)å°†æ•°æ®åŠ å…¥ï¼Œ&lt;strong&gt;windowState.add&lt;/strong&gt;(element.getValue());
&lt;ul&gt;&lt;li&gt;3.1)è°ƒç”¨ &lt;strong&gt;stateTable.transform&lt;/strong&gt;();å¤„ç†è¾“å…¥
&lt;ul&gt;&lt;li&gt;3.1.1)StateMap&amp;lt;K, N, S&amp;gt; stateMap = getMapForKeyGroup(keyGroup); è¿™é‡Œè·å–åˆ°CopyOnWriteStateMap&lt;/li&gt;
&lt;li&gt;3.1.2)stateMap.transform(key, namespace, value, transformation);
&lt;ul&gt;&lt;li&gt;3.1.2.1)è°ƒç”¨ AggregateTransformation.applyï¼Œå…¶åˆè°ƒç”¨ aggFunction.add(value, accumulator);
&lt;ul&gt;&lt;li&gt;3.1.2.1.1)è°ƒç”¨ GroupingWindowAggregateHelper.accumulate(accumulatorRow, value.row)ï¼Œ&lt;u&gt;å…¶åˆè°ƒç”¨ ç”¨æˆ·å®šä¹‰çš„ accumulate&lt;/u&gt;ï¼›&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯ &lt;u&gt;windowState æ·»åŠ å…ƒç´ æ—¶å€™ï¼Œè°ƒç”¨åˆ°Stateçš„APIï¼Œç„¶åé—´æ¥è°ƒç”¨åˆ°äº†UDAF&lt;/u&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&quot;332-windowstate--udafæ‰§è¡Œ&quot;&gt;3.3.2 windowState &amp;amp; UDAFæ‰§è¡Œ&lt;/h4&gt;
&lt;p&gt;windowState ä»¥ window ä¸º namespaceï¼Œä»¥éš”ç¦»ä¸åŒçš„windowçš„contextã€‚è¿™é‡Œè™½ç„¶å«åš windowState ã€‚ä½†æ˜¯å¯ä»¥å‘ç°ï¼Œè¯¥ç±»å­˜å‚¨çš„æ˜¯ä¸åŒwindowä¸­çš„å¯¹åº”çš„åŸå§‹æ•°æ®ï¼ˆprocessWindowFunctionæƒ…å†µï¼‰æˆ–ç»“æœï¼ˆReduceFunction/AggregateFunctionæƒ…å†µï¼‰ã€‚&lt;u&gt;æˆ‘ä»¬æ­¤ä¾‹ä¸­ï¼Œå­˜å‚¨çš„æ˜¯æ‰§è¡Œç»“æœ&lt;/u&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ä¾‹ç”¨åˆ°çš„ window process æ˜¯ Incremental Aggregation Functionsã€‚å³ ReduceFunction ä¸ AggregateFunction ï¼Œå…¶ç‰¹ç‚¹æ˜¯æ— éœ€ä¿å­˜ window ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œä¸€æ—¦æ–°æ•°æ®è¿›å…¥ï¼Œä¾¿å¯ä¸ä¹‹å‰çš„ä¸­é—´ç»“æœè¿›è¡Œè®¡ç®—ï¼Œå› æ­¤è¿™ç§ window ä¸­å…¶çŠ¶æ€ä»…éœ€ä¿å­˜ä¸€ä¸ªç»“æœä¾¿å¯ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤è¿™é‡Œæˆ‘ä»¬æ‹¿åˆ°çš„æ˜¯ HeapReducingStateï¼Œ HeapAggregatingStateï¼Œå½“æ‰§è¡Œåˆ° &lt;code&gt;windowState.add(element.getValue());&lt;/code&gt;è¯­å¥æ—¶ï¼Œ&lt;u&gt;ä¾¿è°ƒç”¨UDAFå¾—å‡ºç»“æœ&lt;/u&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&quot;333-state--ç»“æœå­˜å‚¨&quot;&gt;3.3.3 State &amp;amp; ç»“æœå­˜å‚¨&lt;/h4&gt;
&lt;p&gt;&lt;u&gt;åœ¨flinkä¸­stateç”¨æ¥å­˜æ”¾è®¡ç®—è¿‡ç¨‹çš„èŠ‚ç‚¹ä¸­é—´ç»“æœæˆ–å…ƒæ•°æ®&lt;/u&gt;ã€‚åœ¨flinkå†…éƒ¨æä¾›ä¸‰ç§stateå­˜å‚¨å®ç°&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å†…å­˜HeapStateBackendï¼šå­˜æ”¾æ•°æ®é‡å°ï¼Œç”¨äºå¼€å‘æµ‹è¯•ä½¿ç”¨ï¼›ç”Ÿäº§ä¸å»ºè®®ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;HDFSçš„FsStateBackend ï¼šåˆ†å¸ƒå¼æ–‡ä»¶æŒä¹…åŒ–ï¼Œæ¯æ¬¡éƒ½ä¼šäº§ç”Ÿç½‘ç»œioï¼Œå¯ç”¨äºå¤§stateï¼Œä¸æ”¯æŒå¢é‡ï¼›å¯ç”¨äºç”Ÿäº§&lt;/li&gt;
&lt;li&gt;RocksDBçš„RocksDBStateBackendï¼šæœ¬åœ°æ–‡ä»¶ + å¼‚æ­¥hdfsæŒä¹…åŒ–ï¼Œä¹Ÿå¯ç”¨äºå¤§stateæ•°æ®é‡ï¼Œå”¯ä¸€æ”¯æŒå¢é‡ï¼Œå¯ç”¨äºç”Ÿäº§ï¼›&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;u&gt;æˆ‘ä»¬è¿™é‡Œæ‹¿åˆ°çš„æ˜¯ HeapAggregatingState&lt;/u&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&quot;334-state-å­˜å‚¨ç»“æ„&quot;&gt;3.3.4 State å­˜å‚¨ç»“æ„&lt;/h4&gt;
&lt;p&gt;&lt;u&gt;ä»¥ä¸‰å…ƒç»„çš„å½¢å¼å­˜å‚¨ä¿å­˜æ•°æ®ï¼Œå³ key, namespace, value&lt;/u&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public abstract class StateTable&amp;lt;K, N, S&amp;gt;
        implements StateSnapshotRestore, Iterable&amp;lt;StateEntry&amp;lt;K, N, S&amp;gt;&amp;gt; {
   /**
   * Map for holding the actual state objects. The outer array represents the key-groups.
   * All array positions will be initialized with an empty state map.
   */
        protected final StateMap&amp;lt;K, N, S&amp;gt;[] keyGroupedStateMaps;
}

// çœŸå®ä¸­å˜é‡æ‘˜å½•å¦‚ä¸‹
keyGroupedStateMaps = {StateMap[1]@9266} 
 0 = {CopyOnWriteStateMap@9262} // è¿™é‡Œå°±æ˜¯å°†è¦ä¿å­˜ç”¨æˆ·accumulatorçš„åœ°æ–¹
  stateSerializer = {RowSerializer@9254} 
  snapshotVersions = {TreeSet@9277}  size = 0
  primaryTable = {CopyOnWriteStateMap$StateMapEntry[128]@9278} 
  incrementalRehashTable = {CopyOnWriteStateMap$StateMapEntry[2]@9280} 
  lastNamespace = {TimeWindow@9239} &quot;TimeWindow{start=1593934200000, end=1593934210000}&quot;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨ä¸Šé¢æåŠçš„ &lt;code&gt;3.1.2)stateMap.transform(key, namespace, value, transformation);&lt;/code&gt; ä¸­&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;@Override
public &amp;lt;T&amp;gt; void transform(
   K key,
   N namespace,
   T value,
   StateTransformationFunction&amp;lt;S, T&amp;gt; transformation) throws Exception {

   final StateMapEntry&amp;lt;K, N, S&amp;gt; entry = putEntry(key, namespace);

   // copy-on-write check for state
   entry.state = transformation.apply(
      (entry.stateVersion &amp;lt; highestRequiredSnapshotVersion) ?
         getStateSerializer().copy(entry.state) : entry.state,
         value); 
   // å½“æ‰§è¡Œå®Œç”¨æˆ·ä»£ç ä¹‹åï¼Œæ•°æ®ä¼šå­˜å‚¨åœ¨è¿™é‡Œï¼Œè¿™ä¸ªå°±æ˜¯CopyOnWriteStateMapçš„ä¸€ä¸ªEntry
   entry.stateVersion = stateMapVersion;
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;34-æ€»ç»“&quot;&gt;3.4 æ€»ç»“&lt;/h3&gt;
&lt;p&gt;æµå¤„ç†å¯¹UDAFçš„ç®¡ç†ï¼Œå°±å®Œå…¨æ˜¯è¿›å…¥äº†Windowçš„åœ°ç›˜ï¼Œè€ŒUDAFå†å²çŠ¶æ€ç®¡ç†å…¶å®å°±æ˜¯&lt;u&gt;Flink WindowçŠ¶æ€ç®¡ç†çš„é¢†åŸŸ&lt;/u&gt;äº†ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;windowæ¥å—åˆ°æ–°è¾“å…¥ï¼Œå°±ä¼šå¾€ windowState æ·»åŠ å…ƒç´ ã€‚&lt;/li&gt;
&lt;li&gt;windowState æ·»åŠ å…ƒç´ æ—¶å€™ï¼Œè°ƒç”¨åˆ°Stateçš„APIï¼Œç„¶åé—´æ¥è°ƒç”¨åˆ°äº†UDAF&lt;/li&gt;
&lt;li&gt;windowState åœ¨æœ¬ä¾‹å­˜å‚¨çš„æ˜¯UDAFæ‰§è¡Œç»“æœã€‚å…·ä½“å­˜å‚¨æ˜¯åœ¨HeapAggregatingStateä¸­å®Œæˆã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;0xff-å‚è€ƒ&quot;&gt;0xFF å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.jianshu.com/p/b9b23a7cb880&quot;&gt;Flink - å½“æ•°æ®æµå…¥windowæ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.jianshu.com/p/f283cf30508c&quot;&gt;Flink SQL è‡ªå®šä¹‰UDAF&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://help.aliyun.com/document_detail/69553.html&quot;&gt;è‡ªå®šä¹‰èšåˆå‡½æ•°ï¼ˆUDAFï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/ooffff/p/9522440.html&quot;&gt;Apache Flink - å¸¸è§æ•°æ®æµç±»å‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/weixin_38499215/article/details/99709265&quot;&gt;Flink-SQLæºç è§£è¯»ï¼ˆä¸€ï¼‰windowç®—å­çš„åˆ›å»ºçš„æºç åˆ†æ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/lighten/p/13195042.html&quot;&gt;ä»udafè°ˆflinkçš„state&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/ooffff/p/9522440.html&quot;&gt;Apache Flink - å¸¸è§æ•°æ®æµç±»å‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/xianzhen376/article/details/89889728&quot;&gt;FlinkçŠ¶æ€ç®¡ç†ï¼ˆäºŒï¼‰çŠ¶æ€æ•°æ®ç»“æ„å’Œæ³¨å†Œæµç¨‹&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;</description>
<pubDate>Tue, 11 Aug 2020 23:50:00 +0000</pubDate>
<dc:creator>ç½—è¥¿çš„æ€è€ƒ</dc:creator>
<og:description>æœ¬æ–‡æ¶‰åŠåˆ°Flink SQL UDAFï¼ŒWindow çŠ¶æ€ç®¡ç†ç­‰éƒ¨åˆ†ï¼Œå¸Œæœ›èƒ½èµ·åˆ°æŠ›ç –å¼•ç‰çš„ä½œç”¨ï¼Œè®©å¤§å®¶å¯ä»¥å€Ÿæ­¤æ·±å…¥äº†è§£è¿™ä¸ªé¢†åŸŸã€‚</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/rossiXYZ/p/13460408.html</dc:identifier>
</item>
<item>
<title>ã€ŠT-GCN: A Temporal Graph Convolutional Network for Trafï¬c Predictionã€‹ ä»£ç è§£è¯» - é‚£ä¸å¤ªå¯èƒ½</title>
<link>http://www.cnblogs.com/missouter/p/13488342.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/missouter/p/13488342.html</guid>
<description>&lt;p&gt;è®ºæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://arxiv.org/abs/1811.05320&quot;&gt;https://arxiv.org/abs/1811.05320&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åšå®¢åŸä½œè€…Missouterï¼Œåšå®¢é“¾æ¥&lt;a href=&quot;https://www.cnblogs.com/missouter/&quot;&gt;https://www.cnblogs.com/missouter/&lt;/a&gt;ï¼Œæ¬¢è¿äº¤æµã€‚&lt;/p&gt;
&lt;p&gt;è§£è¯»äº†ä¸€ä¸‹è¿™ç¯‡è®ºæ–‡githubä¸Šå…³äºT-GCNçš„ä»£ç ï¼Œä¸»è¦åˆ†ä¸ºmainæ–‡ä»¶ä¸TGCNæ–‡ä»¶ä¸¤éƒ¨åˆ†ï¼Œåç»­æœ‰ç©ºå°†ä¼šæ›´æ–°å…¶ä»–éƒ¨åˆ†ä½œä¸ºbaselineä»£ç çš„è§£è¯»ï¼ˆé¸½ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;1ã€main.py&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;57&quot;&gt;
&lt;pre&gt;
&lt;span&gt;#&lt;/span&gt;&lt;span&gt; -*- coding: utf-8 -*-&lt;/span&gt;
&lt;span&gt;import&lt;/span&gt;&lt;span&gt; pickle as pkl
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; tensorflow as tf
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; pandas as pd
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; numpy as np
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; math
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; os
&lt;/span&gt;&lt;span&gt;import&lt;/span&gt;&lt;span&gt; numpy.linalg as la
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; input_data &lt;span&gt;import&lt;/span&gt;&lt;span&gt; preprocess_data,load_sz_data,load_los_data
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; tgcn &lt;span&gt;import&lt;/span&gt;&lt;span&gt; tgcnCell
&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;from gru import GRUCell &lt;/span&gt;

&lt;span&gt;from&lt;/span&gt; visualization &lt;span&gt;import&lt;/span&gt;&lt;span&gt; plot_result,plot_error
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; sklearn.metrics &lt;span&gt;import&lt;/span&gt;&lt;span&gt; mean_squared_error,mean_absolute_error
&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;import matplotlib.pyplot as plt&lt;/span&gt;
&lt;span&gt;import&lt;/span&gt;&lt;span&gt; time

time_start &lt;/span&gt;=&lt;span&gt; time.time()
&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;##### Settings ######&lt;/span&gt;
flags =&lt;span&gt; tf.app.flags
FLAGS &lt;/span&gt;=&lt;span&gt; flags.FLAGS
flags.DEFINE_float(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;learning_rate&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, 0.001, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Initial learning rate.&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
flags.DEFINE_integer(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;training_epoch&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, 1, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;Number of epochs to train.&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
flags.DEFINE_integer(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;gru_units&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, 64, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;hidden units of gru.&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
flags.DEFINE_integer(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;seq_len&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,12 , &lt;span&gt;'&lt;/span&gt;&lt;span&gt;  time length of inputs.&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
flags.DEFINE_integer(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;pre_len&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, 3, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;time length of prediction.&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
flags.DEFINE_float(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;train_rate&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, 0.8, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;rate of training set.&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
flags.DEFINE_integer(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;batch_size&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, 32, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;batch size.&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
flags.DEFINE_string(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;dataset&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;los&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;sz or los.&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
flags.DEFINE_string(&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;model_name&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;tgcn&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;tgcn&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
model_name &lt;/span&gt;=&lt;span&gt; FLAGS.model_name
data_name &lt;/span&gt;=&lt;span&gt; FLAGS.dataset
train_rate &lt;/span&gt;=&lt;span&gt;  FLAGS.train_rate
seq_len &lt;/span&gt;=&lt;span&gt; FLAGS.seq_len
output_dim &lt;/span&gt;= pre_len =&lt;span&gt; FLAGS.pre_len
batch_size &lt;/span&gt;=&lt;span&gt; FLAGS.batch_size
lr &lt;/span&gt;=&lt;span&gt; FLAGS.learning_rate
training_epoch &lt;/span&gt;=&lt;span&gt; FLAGS.training_epoch
gru_units &lt;/span&gt;= FLAGS.gru_units
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¼€å¤´éƒ¨åˆ†ç”¨äºè®¾ç½®è®­ç»ƒåŸºæœ¬å‚æ•°ï¼›ä½¿ç”¨flagå¯¹å‚æ•°è¿›è¡Œè®¾ç½®ä¸è¯´æ˜ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;45&quot;&gt;
&lt;pre&gt;
&lt;span&gt;if&lt;/span&gt; data_name == &lt;span&gt;'&lt;/span&gt;&lt;span&gt;sz&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
    data, adj &lt;/span&gt;= load_sz_data(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;sz&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;if&lt;/span&gt; data_name == &lt;span&gt;'&lt;/span&gt;&lt;span&gt;los&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
    data, adj &lt;/span&gt;= load_los_data(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;los&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)

time_len &lt;/span&gt;=&lt;span&gt; data.shape[0]
num_nodes &lt;/span&gt;= data.shape[1&lt;span&gt;]
data1 &lt;/span&gt;=np.mat(data,dtype=&lt;span&gt;np.float32)

&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;### normalization&lt;/span&gt;
max_value =&lt;span&gt; np.max(data1)
data1  &lt;/span&gt;= data1/max_value
trainX, trainY, testX, testY =&lt;span&gt; preprocess_data(data1, time_len, train_rate, seq_len, pre_len)

totalbatch &lt;/span&gt;= int(trainX.shape[0]/&lt;span&gt;batch_size)
training_data_count &lt;/span&gt;= len(trainX)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™éƒ¨åˆ†å¯¼å…¥æ•°æ®é›†å¹¶å¯¹æ•°æ®è¿›è¡Œå½’ä¸€åŒ–ï¼Œinput_dataæ–‡ä»¶ä¸­å¯¼å…¥å‡½æ•°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt;def&lt;/span&gt;&lt;span&gt; load_sz_data(dataset):
    sz_adj &lt;/span&gt;= pd.read_csv(r&lt;span&gt;'&lt;/span&gt;&lt;span&gt;data/sz_adj.csv&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,header=&lt;span&gt;None)
    adj &lt;/span&gt;=&lt;span&gt; np.mat(sz_adj)
    sz_tf &lt;/span&gt;= pd.read_csv(r&lt;span&gt;'&lt;/span&gt;&lt;span&gt;data/sz_speed.csv&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; sz_tf, adj

&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; load_los_data(dataset):
    los_adj &lt;/span&gt;= pd.read_csv(r&lt;span&gt;'&lt;/span&gt;&lt;span&gt;data/los_adj.csv&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,header=&lt;span&gt;None)
    adj &lt;/span&gt;=&lt;span&gt; np.mat(los_adj)
    los_tf &lt;/span&gt;= pd.read_csv(r&lt;span&gt;'&lt;/span&gt;&lt;span&gt;data/los_speed.csv&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; los_tf, adj
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å…¶ä¸­preprocess_dataå‡½æ•°æ ¹æ®mainå‡½æ•°å¼€å¤´è®¾ç½®çš„è®­ç»ƒé›†ã€æµ‹è¯•é›†æ¯”ä¾‹å¯¹æ•°æ®é›†è¿›è¡Œåˆ†å‰²ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;48&quot;&gt;
&lt;pre&gt;
&lt;span&gt;def&lt;/span&gt;&lt;span&gt; preprocess_data(data, time_len, rate, seq_len, pre_len):
    train_size &lt;/span&gt;= int(time_len *&lt;span&gt; rate)
    train_data &lt;/span&gt;=&lt;span&gt; data[0:train_size]
    test_data &lt;/span&gt;=&lt;span&gt; data[train_size:time_len]
    
    trainX, trainY, testX, testY &lt;/span&gt;=&lt;span&gt; [], [], [], []
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; i &lt;span&gt;in&lt;/span&gt; range(len(train_data) - seq_len -&lt;span&gt; pre_len):
        a &lt;/span&gt;= train_data[i: i + seq_len +&lt;span&gt; pre_len]
        trainX.append(a[0 : seq_len])
        trainY.append(a[seq_len : seq_len &lt;/span&gt;+&lt;span&gt; pre_len])
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; i &lt;span&gt;in&lt;/span&gt; range(len(test_data) - seq_len -&lt;span&gt;pre_len):
        b &lt;/span&gt;= test_data[i: i + seq_len +&lt;span&gt; pre_len]
        testX.append(b[0 : seq_len])
        testY.append(b[seq_len : seq_len &lt;/span&gt;+&lt;span&gt; pre_len])
      
    trainX1 &lt;/span&gt;=&lt;span&gt; np.array(trainX)
    trainY1 &lt;/span&gt;=&lt;span&gt; np.array(trainY)
    testX1 &lt;/span&gt;=&lt;span&gt; np.array(testX)
    testY1 &lt;/span&gt;=&lt;span&gt; np.array(testY)
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; trainX1, trainY1, testX1, testY1
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ¥ç€å®šä¹‰äº†TGCNå‡½æ•°ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt;def&lt;/span&gt;&lt;span&gt; TGCN(_X, _weights, _biases):
    &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;##&lt;/span&gt;
    cell_1 = tgcnCell(gru_units, adj, num_nodes=&lt;span&gt;num_nodes)
    cell &lt;/span&gt;= tf.nn.rnn_cell.MultiRNNCell([cell_1], state_is_tuple=&lt;span&gt;True)
    _X &lt;/span&gt;= tf.unstack(_X, axis=1&lt;span&gt;)
    outputs, states &lt;/span&gt;= tf.nn.static_rnn(cell, _X, dtype=&lt;span&gt;tf.float32)
    m &lt;/span&gt;=&lt;span&gt; []
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; i &lt;span&gt;in&lt;/span&gt;&lt;span&gt; outputs:
        o &lt;/span&gt;= tf.reshape(i,shape=[-1&lt;span&gt;,num_nodes,gru_units])
        o &lt;/span&gt;= tf.reshape(o,shape=[-1&lt;span&gt;,gru_units])
        m.append(o)
    last_output &lt;/span&gt;= m[-1&lt;span&gt;]
    output &lt;/span&gt;= tf.matmul(last_output, _weights[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;out&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;]) + _biases[&lt;span&gt;'&lt;/span&gt;&lt;span&gt;out&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;]
    output &lt;/span&gt;= tf.reshape(output,shape=[-1&lt;span&gt;,num_nodes,pre_len])
    output &lt;/span&gt;= tf.transpose(output, perm=[0,2,1&lt;span&gt;])
    output &lt;/span&gt;= tf.reshape(output, shape=[-1&lt;span&gt;,num_nodes])
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; output, m, states
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å‡½æ•°å¼€å¤´é¦–å…ˆå¼•å…¥äº†TGCNçš„è®¡ç®—å•å…ƒï¼ŒtgcnCellçš„è§£è¯»å°†åœ¨åæ–‡è¿›è¡Œï¼›ä½¿ç”¨tf.nn.rnn_cell.MultiRNNCellå®ç°å¤šå±‚ç¥ç»ç½‘ç»œï¼›å¯¹è¾“å…¥æ•°æ®è¿›è¡Œå¤„ç†ï¼Œåˆ›å»ºç”±RNNCellæŒ‡å®šçš„å¾ªç¯ç¥ç»ç½‘ç»œã€‚æ¥ç€å¯¹æ¯ä¸ªå¾ªç¯ç¥ç»ç½‘ç»œçš„è¾“å‡ºè¿›è¡Œå¤„ç†ï¼Œé¦–å…ˆé‡å¡‘ç»“æœå¼ é‡ï¼Œtf.reshapeä¸­å‚æ•°-1è¡¨ç¤ºè®¡ç®—è¯¥ç»´åº¦çš„å¤§å°,ä»¥ä½¿æ€»å¤§å°ä¿æŒä¸å˜ï¼›ç¬¬äºŒç»´ä¸ºç‚¹çš„æ•°é‡ï¼Œç¬¬ä¸‰ç»´ä¸ºGRUå•å…ƒçš„æ•°é‡ï¼Œå†ç´§æ¥ä¸Šä¸€å±‚å¼ é‡é‡å¡‘çš„ç»“æœç»§ç»­è¿›è¡Œé‡å¡‘ï¼Œå¾—åˆ°ç”±é•¿åº¦ä¸ºGRUæ•°é‡åˆ—è¡¨ç»„æˆçš„åˆ—è¡¨ï¼Œä½¿ç”¨tf.matmulå°†è¾“å‡ºçŸ©é˜µä¹˜ä»¥æƒé‡çŸ©é˜µï¼Œbiasesä¸ºåå·®ï¼Œæ¥ç€é‡å¡‘è¾“å‡ºå¼ é‡ä¸ºç¬¬äºŒç»´ä¸ºæ•°æ®ç‚¹çš„æ•°é‡ï¼Œç¬¬ä¸‰ç»´ä¸ºé¢„æµ‹é•¿åº¦çš„çŸ©é˜µï¼Œå†ç½®æ¢è¾“å‡ºçŸ©é˜µ,ä½¿ç”¨transposeæŒ‰ç…§[0,2,1]é‡æ–°æ’åˆ—å°ºå¯¸ï¼Œè¿›ä¸€æ­¥é‡å¡‘ä¸ºç”±æ•°æ®ç‚¹æ•°ç›®é•¿åº¦åˆ—è¡¨ç»„æˆçš„åˆ—è¡¨ï¼Œå¾—åˆ°æœ€ç»ˆè¾“å‡ºç»“æœã€‚&lt;/p&gt;
&lt;p&gt;ç´§æ¥ç€ä¸‹ä¸€æ®µä½¿ç”¨å ä½ç¬¦å®šä¹‰è¾“å…¥ä¸æ ‡ç­¾ï¼Œéšæœºåˆå§‹åŒ–æƒé‡ä¸åå·®ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;45&quot;&gt;
&lt;pre&gt;
inputs = tf.placeholder(tf.float32, shape=&lt;span&gt;[None, seq_len, num_nodes])
labels &lt;/span&gt;= tf.placeholder(tf.float32, shape=&lt;span&gt;[None, pre_len, num_nodes])

weights &lt;/span&gt;=&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;out&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: tf.Variable(tf.random_normal([gru_units, pre_len], mean=1.0), name=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;weight_o&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)}
biases &lt;/span&gt;=&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;out&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;: tf.Variable(tf.random_normal([pre_len]),name=&lt;span&gt;'&lt;/span&gt;&lt;span&gt;bias_o&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;)}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è°ƒç”¨TGCNæ¨¡å‹ï¼Œå¾—åˆ°æœ€ç»ˆè¾“å‡ºã€æ¯å±‚è¾“å‡ºä¸æœ€ç»ˆçŠ¶æ€ï¼š&lt;/p&gt;
&lt;div readability=&quot;10&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;if&lt;/span&gt; model_name == &lt;span&gt;'&lt;/span&gt;&lt;span&gt;tgcn&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;:
    pred,ttts,ttto &lt;/span&gt;=&lt;span&gt; TGCN(inputs, weights, biases)

y_pred &lt;/span&gt;= pred
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å®šä¹‰ä¼˜åŒ–å™¨ï¼Œæ ¹æ®è®­ç»ƒæ•°æ®æ–¹å·®è®¾ç½®åå·®ï¼š&lt;/p&gt;
&lt;div readability=&quot;9.5&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
lambda_loss = 0.0015&lt;span&gt;
Lreg &lt;/span&gt;= lambda_loss * sum(tf.nn.l2_loss(tf_var) &lt;span&gt;for&lt;/span&gt; tf_var &lt;span&gt;in&lt;/span&gt;&lt;span&gt; tf.trainable_variables())
label &lt;/span&gt;= tf.reshape(labels, [-1,num_nodes])
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å®šä¹‰æŸå¤±å‡½æ•°ï¼š&lt;/p&gt;
&lt;div readability=&quot;26.5&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
loss = tf.reduce_mean(tf.nn.l2_loss(y_pred-label) + Lreg)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¯¹åº”è®ºæ–‡å…¬å¼ï¼ˆè¯¦è§ä¸Šç¯‡åšå®¢ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1829854/202008/1829854-20200812003532034-1388116081.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Â å®šä¹‰å‡æ–¹æ ¹è¯¯å·®ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
error = tf.sqrt(tf.reduce_mean(tf.square(y_pred-label)))
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å®šä¹‰ä¼˜åŒ–è¿­ä»£å™¨ï¼š&lt;/p&gt;
&lt;div readability=&quot;100.5&quot;&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
optimizer = tf.train.AdamOptimizer(lr).minimize(loss)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¯¹è¿­ä»£è®­ç»ƒè¿‡ç¨‹è¿›è¡Œåˆå§‹åŒ–ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;44&quot;&gt;
&lt;pre&gt;
variables =&lt;span&gt; tf.global_variables()
saver &lt;/span&gt;= tf.train.Saver(tf.global_variables()) &lt;span&gt;#
#&lt;/span&gt;&lt;span&gt;sess = tf.Session()&lt;/span&gt;
gpu_options = tf.GPUOptions(per_process_gpu_memory_fraction=0.333&lt;span&gt;)
sess &lt;/span&gt;= tf.Session(config=tf.ConfigProto(gpu_options=&lt;span&gt;gpu_options))
sess.run(tf.global_variables_initializer())
out &lt;/span&gt;= &lt;span&gt;'&lt;/span&gt;&lt;span&gt;out/%s&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;%&lt;span&gt;(model_name)
&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;out = 'out/%s_%s'%(model_name,'perturbation')&lt;/span&gt;
path1 = &lt;span&gt;'&lt;/span&gt;&lt;span&gt;%s_%s_lr%r_batch%r_unit%r_seq%r_pre%r_epoch%r&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;%&lt;span&gt;(model_name,data_name,lr,batch_size,gru_units,seq_len,pre_len,training_epoch)
path &lt;/span&gt;=&lt;span&gt; os.path.join(out,path1)
&lt;/span&gt;&lt;span&gt;if&lt;/span&gt; &lt;span&gt;not&lt;/span&gt;&lt;span&gt; os.path.exists(path):
    os.makedirs(path)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å…¶ä¸­global_variablesç”¨äºè·å–ç¨‹åºä¸­çš„å˜é‡ï¼Œé…åˆtrain.Saverå°†è®­ç»ƒå¥½çš„æ¨¡å‹å‚æ•°ä¿å­˜èµ·æ¥ï¼Œä»¥ä¾¿ä»¥åè¿›è¡ŒéªŒè¯æˆ–æµ‹è¯•ã€‚tf.GPUOptionsç”¨äºé™åˆ¶GPUèµ„æºçš„ä½¿ç”¨ï¼Œä¸è¿‡ä¸ºä»€ä¹ˆè¦é™åˆ¶ä½¿ç”¨ä¸‰åˆ†ä¹‹ä¸€çš„æ˜¾å­˜å°šä¸æ¸…æ¥šï¼Œç®—è®­ç»ƒå°æŠ€å·§å˜›ï¼Ÿåˆå§‹åŒ–æ¨¡å‹çš„å‚æ•°åè®¾ç½®è¾“å‡ºè·¯å¾„ä¸æ–‡ä»¶åï¼Œä¸è¯¦ç»†è®¨è®ºã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶ä¸­çš„è¯„ä¼°æ¨¡å—å®šä¹‰äº†è®ºæ–‡å®éªŒéƒ¨åˆ†çš„æŒ‡æ ‡ï¼šå‡æ–¹æ ¹è¯¯å·®ã€å¹³å‡ç»å¯¹è¯¯å·®ã€å‡†ç¡®ç‡ã€ç¡®å®šç³»æ•°ä¸å¯æ–¹å·®å€¼ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;43&quot;&gt;
&lt;pre&gt;
&lt;span&gt;def&lt;/span&gt;&lt;span&gt; evaluation(a,b):
    rmse &lt;/span&gt;=&lt;span&gt; math.sqrt(mean_squared_error(a,b))
    mae &lt;/span&gt;=&lt;span&gt; mean_absolute_error(a, b)
    F_norm &lt;/span&gt;= la.norm(a-b,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;fro&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;)/la.norm(a,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;fro&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
    r2 &lt;/span&gt;= 1-((a-b)**2).sum()/((a-a.mean())**2&lt;span&gt;).sum()
    var &lt;/span&gt;= 1-(np.var(a-b))/&lt;span&gt;np.var(a)
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; rmse, mae, 1-F_norm, r2, var
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°±æ˜¯å¸¸è§çš„è®­ç»ƒéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;63&quot;&gt;
&lt;pre&gt;
&lt;span&gt;for&lt;/span&gt; epoch &lt;span&gt;in&lt;/span&gt;&lt;span&gt; range(training_epoch):
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; m &lt;span&gt;in&lt;/span&gt;&lt;span&gt; range(totalbatch):
        mini_batch &lt;/span&gt;= trainX[m * batch_size : (m+1) *&lt;span&gt; batch_size]
        mini_label &lt;/span&gt;= trainY[m * batch_size : (m+1) *&lt;span&gt; batch_size]
        _, loss1, rmse1, train_output &lt;/span&gt;=&lt;span&gt; sess.run([optimizer, loss, error, y_pred],
                                                 feed_dict &lt;/span&gt;=&lt;span&gt; {inputs:mini_batch, labels:mini_label})
        batch_loss.append(loss1)
        batch_rmse.append(rmse1 &lt;/span&gt;*&lt;span&gt; max_value)

     &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt; Test completely at every epoch&lt;/span&gt;
    loss2, rmse2, test_output =&lt;span&gt; sess.run([loss, error, y_pred],
                                         feed_dict &lt;/span&gt;=&lt;span&gt; {inputs:testX, labels:testY})
    test_label &lt;/span&gt;= np.reshape(testY,[-1&lt;span&gt;,num_nodes])
    rmse, mae, acc, r2_score, var_score &lt;/span&gt;=&lt;span&gt; evaluation(test_label, test_output)
    test_label1 &lt;/span&gt;= test_label * max_value&lt;span&gt;#&lt;/span&gt;&lt;span&gt;åå½’ä¸€åŒ–&lt;/span&gt;
    test_output1 = test_output *&lt;span&gt; max_value
    test_loss.append(loss2)
    test_rmse.append(rmse &lt;/span&gt;*&lt;span&gt; max_value)
    test_mae.append(mae &lt;/span&gt;*&lt;span&gt; max_value)
    test_acc.append(acc)
    test_r2.append(r2_score)
    test_var.append(var_score)
    test_pred.append(test_output1)
    
    &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Iter:{}&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;.format(epoch),
          &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;train_rmse:{:.4}&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;.format(batch_rmse[-1&lt;span&gt;]),
          &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;test_loss:{:.4}&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;.format(loss2),
          &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;test_rmse:{:.4}&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;.format(rmse),
          &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;test_acc:{:.4}&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;.format(acc))&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt; (epoch % 500 ==&lt;span&gt; 0):        
        saver.save(sess, path&lt;/span&gt;+&lt;span&gt;'&lt;/span&gt;&lt;span&gt;/model_100/TGCN_pre_%r&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;%epoch, global_step =&lt;span&gt; epoch)
        
time_end &lt;/span&gt;=&lt;span&gt; time.time()
&lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(time_end-time_start,&lt;span&gt;'&lt;/span&gt;&lt;span&gt;s&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é™„å¸¦å¯¹æ¯ä¸ªå‘¨æœŸè®­ç»ƒç»“æœçš„æµ‹è¯•ã€å¯¹ç»“æœçš„åå½’ä¸€åŒ–ï¼Œè®­ç»ƒè®¾ç½®ä¸ºæ¯è®­ç»ƒ500å±‚ä¿å­˜ä¸€æ¬¡æ¨¡å‹ï¼Œå¹¶å¯¹è®­ç»ƒå¾—åˆ°çš„å‚æ•°æŒ‡æ ‡è¿›è¡Œæ‰“å°ä¸ä¿å­˜ã€‚ä»£ç æœ€åè¿˜ç»™å‡ºäº†å¯è§†åŒ–æ•°æ®æŒ‡æ ‡çš„æ–¹æ³•ï¼Œå³å°†æ•°æ®æŒ‡æ ‡å†™å…¥csvæ–‡ä»¶ä¸­ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;48&quot;&gt;
&lt;pre&gt;
b = int(len(batch_rmse)/&lt;span&gt;totalbatch)
batch_rmse1 &lt;/span&gt;= [i &lt;span&gt;for&lt;/span&gt; i &lt;span&gt;in&lt;/span&gt;&lt;span&gt; batch_rmse]
train_rmse &lt;/span&gt;= [(sum(batch_rmse1[i*totalbatch:(i+1)*totalbatch])/totalbatch) &lt;span&gt;for&lt;/span&gt; i &lt;span&gt;in&lt;/span&gt;&lt;span&gt; range(b)]
batch_loss1 &lt;/span&gt;= [i &lt;span&gt;for&lt;/span&gt; i &lt;span&gt;in&lt;/span&gt;&lt;span&gt; batch_loss]
train_loss &lt;/span&gt;= [(sum(batch_loss1[i*totalbatch:(i+1)*totalbatch])/totalbatch) &lt;span&gt;for&lt;/span&gt; i &lt;span&gt;in&lt;/span&gt;&lt;span&gt; range(b)]

index &lt;/span&gt;=&lt;span&gt; test_rmse.index(np.min(test_rmse))
test_result &lt;/span&gt;=&lt;span&gt; test_pred[index]
var &lt;/span&gt;=&lt;span&gt; pd.DataFrame(test_result)
var.to_csv(path&lt;/span&gt;+&lt;span&gt;'&lt;/span&gt;&lt;span&gt;/test_result.csv&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;,index = False,header =&lt;span&gt; False)
&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;plot_result(test_result,test_label1,path)&lt;/span&gt;&lt;span&gt;
#&lt;/span&gt;&lt;span&gt;plot_error(train_rmse,train_loss,test_rmse,test_acc,test_mae,path)&lt;/span&gt;

&lt;span&gt;print&lt;/span&gt;(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;min_rmse:%r&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;%&lt;span&gt;(np.min(test_rmse)),
      &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;min_mae:%r&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;%&lt;span&gt;(test_mae[index]),
      &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;max_acc:%r&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;%&lt;span&gt;(test_acc[index]),
      &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;r2:%r&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;%&lt;span&gt;(test_r2[index]),
      &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;var:%r&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;%test_var[index])
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è‡³æ­¤å¯¹è®ºæ–‡å¯¹åº”ä»£ç mainæ–‡ä»¶çš„è§£è¯»å°±ç»“æŸäº†ã€‚&lt;/p&gt;
&lt;p&gt;2ã€tgcn.py&lt;/p&gt;
&lt;p&gt;æ­¤æ–‡ä»¶åªå®šä¹‰äº†ä¸€ä¸ªTGCNè®¡ç®—å•å…ƒçš„ç±»ï¼Œåˆå§‹åŒ–éƒ¨åˆ†ä¸ä½œè¯¦è°ˆï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;44&quot;&gt;
&lt;pre&gt;
&lt;span&gt;#&lt;/span&gt;&lt;span&gt; -*- coding: utf-8 -*-&lt;/span&gt;

&lt;span&gt;#&lt;/span&gt;&lt;span&gt;import numpy as np&lt;/span&gt;
&lt;span&gt;import&lt;/span&gt;&lt;span&gt; tensorflow as tf
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; tensorflow.contrib.rnn &lt;span&gt;import&lt;/span&gt;&lt;span&gt; RNNCell
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; utils &lt;span&gt;import&lt;/span&gt;&lt;span&gt; calculate_laplacian

&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; tgcnCell(RNNCell):
    &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span&gt;Temporal Graph Convolutional Network &lt;/span&gt;&lt;span&gt;&quot;&quot;&quot;&lt;/span&gt;

    &lt;span&gt;def&lt;/span&gt; call(self, inputs, **&lt;span&gt;kwargs):
        &lt;/span&gt;&lt;span&gt;pass&lt;/span&gt;
-
    &lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;(self, num_units, adj, num_nodes, input_size=&lt;span&gt;None,
                 act&lt;/span&gt;=tf.nn.tanh, reuse=&lt;span&gt;None):


        super(tgcnCell, self).&lt;/span&gt;&lt;span&gt;__init__&lt;/span&gt;(_reuse=&lt;span&gt;reuse)
        self._act &lt;/span&gt;=&lt;span&gt; act
        self._nodes &lt;/span&gt;=&lt;span&gt; num_nodes
        self._units &lt;/span&gt;=&lt;span&gt; num_units
        self._adj &lt;/span&gt;=&lt;span&gt; []
        self._adj.append(calculate_laplacian(adj))


    @property
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; state_size(self):
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; self._nodes *&lt;span&gt; self._units

    @property
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; output_size(self):
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; self._units
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é‡ç‚¹ä¹‹ä¸€åœ¨äºå¯¹GRUå•å…ƒçš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;49&quot;&gt;
&lt;pre&gt;
&lt;span&gt;def&lt;/span&gt; &lt;span&gt;__call__&lt;/span&gt;(self, inputs, state, scope=&lt;span&gt;None):
        with tf.variable_scope(scope &lt;/span&gt;&lt;span&gt;or&lt;/span&gt; &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;tgcn&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;):
            with tf.variable_scope(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;gates&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;):  
                value &lt;/span&gt;=&lt;span&gt; tf.nn.sigmoid(
                    self._gc(inputs, state, &lt;/span&gt;2 * self._units, bias=1.0, scope=&lt;span&gt;scope))
                r, u &lt;/span&gt;= tf.split(value=value, num_or_size_splits=2, axis=1&lt;span&gt;)
            with tf.variable_scope(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;candidate&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;):
                r_state &lt;/span&gt;= r *&lt;span&gt; state
                c &lt;/span&gt;= self._act(self._gc(inputs, r_state, self._units, scope=&lt;span&gt;scope))
            new_h &lt;/span&gt;= u * state + (1 - u) *&lt;span&gt; c
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; new_h, new_h
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä»£ç è¿˜åŸè®ºæ–‡ä¸­tgcnå•å…ƒçš„è®¡ç®—è¿‡ç¨‹ï¼ˆè¯¦è§ä¸Šä¸€ç¯‡åšå®¢ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1829854/202008/1829854-20200812010330549-328720828.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;


&lt;p&gt;å‚æ•°ä¸­stateå¯¹åº”è®ºæ–‡ä¸­ä¸Šä¸€æ—¶åˆ»çš„çŠ¶æ€ï¼Œå³h&lt;sub&gt;t-1ã€‚&lt;/sub&gt;variable_scopeä½¿å¾—å¤šä¸ªå˜é‡å¾—ä»¥æœ‰ç›¸åŒçš„å‘½åï¼›ä¸Šè¿°ä»£ç ä¸­tf.nn.sigmoidè¯­å¥ä¸ºæ¿€æ´»å‡½æ•°ï¼Œç”¨äºè¿›è¡Œå›¾å·ç§¯GCï¼›tf.splitè¯­å¥ç”¨äº&lt;/p&gt;
&lt;p&gt;åˆ†å‰²å·ç§¯åçš„å¼ é‡ï¼Œé‡ç½®é—¨rç”¨äºæ§åˆ¶å…ˆå‰æ—¶åˆ»çŠ¶æ€ä¿¡æ¯çš„åº¦é‡ï¼Œä¸Šä¼ é—¨uç”¨äºæ§åˆ¶ä¸Šä¼ åˆ°ä¸‹ä¸€çŠ¶æ€çš„ä¿¡æ¯åº¦é‡ï¼›Â candidateéƒ¨åˆ†çš„cå¯¹åº”å…¬å¼ï¼š&lt;/p&gt;
&lt;div readability=&quot;45.5&quot;&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1829854/202008/1829854-20200812011938473-740273465.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;
&lt;p&gt;Â å‡½æ•°æœ€åè¿”å›æœ€æ–°çŠ¶æ€h&lt;sub&gt;t&lt;/sub&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å›¾å·ç§¯è¿‡ç¨‹æœ€åè¢«å®šä¹‰ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;79&quot;&gt;
&lt;pre&gt;
    &lt;span&gt;def&lt;/span&gt; _gc(self, inputs, state, output_size, bias=0.0, scope=&lt;span&gt;None):
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;# inputs:(-1,num_nodes)&lt;/span&gt;
&lt;span&gt;        
        inputs &lt;/span&gt;= tf.expand_dims(inputs, 2&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;# state:(batch,num_node,gru_units)&lt;/span&gt;
        state = tf.reshape(state, (-1&lt;span&gt;, self._nodes, self._units))
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;# concat&lt;/span&gt;
        x_s = tf.concat([inputs, state], axis=2&lt;span&gt;)
        input_size &lt;/span&gt;= x_s.get_shape()[2&lt;span&gt;].value
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;# (num_node,input_size,-1)&lt;/span&gt;
        x0 = tf.transpose(x_s, perm=[1, 2&lt;span&gt;, 0])  
        x0 &lt;/span&gt;= tf.reshape(x0, shape=[self._nodes, -1&lt;span&gt;])
  
        scope &lt;/span&gt;=&lt;span&gt; tf.get_variable_scope()
        with tf.variable_scope(scope):
            &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; m &lt;span&gt;in&lt;/span&gt;&lt;span&gt; self._adj:
                x1 &lt;/span&gt;=&lt;span&gt; tf.sparse_tensor_dense_matmul(m, x0)
&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;                print(x1)&lt;/span&gt;
            x = tf.reshape(x1, shape=[self._nodes, input_size,-1&lt;span&gt;])
            x &lt;/span&gt;= tf.transpose(x,perm=[2,0,1&lt;span&gt;])
            x &lt;/span&gt;= tf.reshape(x, shape=[-1&lt;span&gt;, input_size])
            weights &lt;/span&gt;=&lt;span&gt; tf.get_variable(
                &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;weights&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;, [input_size, output_size], initializer=&lt;span&gt;tf.contrib.layers.xavier_initializer())
            x &lt;/span&gt;= tf.matmul(x, weights)  &lt;span&gt;#&lt;/span&gt;&lt;span&gt; (batch_size * self._nodes, output_size)&lt;/span&gt;
            biases =&lt;span&gt; tf.get_variable(
                &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;biases&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, [output_size], initializer=tf.constant_initializer(bias, dtype=&lt;span&gt;tf.float32))
            x &lt;/span&gt;=&lt;span&gt; tf.nn.bias_add(x, biases)
            x &lt;/span&gt;= tf.reshape(x, shape=[-1&lt;span&gt;, self._nodes, output_size])
            x &lt;/span&gt;= tf.reshape(x, shape=[-1, self._nodes *&lt;span&gt; output_size])
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; x
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å‡½æ•°å¼€å¤´å¯¹ç‰¹å¾çŸ©é˜µè¿›è¡Œæ„å»ºï¼šä½¿ç”¨expand_dimså¢åŠ è¾“å…¥ç»´åº¦ï¼Œå†ä½¿ç”¨å°†å½“å‰çŠ¶æ€è½¬åŒ–ä¸ºç¬¬äºŒç»´ä¸ºæ•°æ®ç‚¹æ•°é‡ï¼Œç¬¬ä¸‰ç»´ä¸ºgruå•å…ƒæ•°é‡çš„åˆ—è¡¨ï¼Œä½¿ç”¨concatåœ¨ç¬¬äºŒä¸ªç»´åº¦æ‹¼æ¥å¼ é‡ï¼Œæœ€åå¾—åˆ°ä¸€ä¸ªé•¿åº¦ä¸ºæ•°æ®ç‚¹æ•°é‡çš„åˆ—è¡¨ã€‚get_variable_scopeè·å–å˜é‡åï¼Œå°†å¾—åˆ°çš„ç‰¹å¾çŸ©é˜µä¸é‚»æ¥çŸ©é˜µç›¸ä¹˜ã€‚åœ¨tf.nn.bias_addå¤„æ¿€æ´»å¾—åˆ°ä¸¤å±‚GCNï¼Œå¯¹åº”å…¬å¼ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1829854/202008/1829854-20200812013536560-354778843.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;


&lt;p&gt;æœ€ç»ˆè¿”å›è¾“å‡ºå€¼xã€‚æ­¤å‡½æ•°ç»å†äº†å¾ˆå¤šå¼ é‡çš„å½¢å¼è½¬æ¢ï¼Œå¯¹åº”è®ºæ–‡ç©ºé—´å…³ç³»å»ºæ¨¡è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºè®ºæ–‡ä¸­TGCNéƒ¨åˆ†ä»£ç çš„è§£è¯»ç»“æŸäº†ï¼Œæ¨¡å—åŒ–çš„ç¼–ç¨‹å¯¹äºå­¦ä¹ å®éªŒæ‰‹æ³•æœ‰å¾ˆå¤šå€¼å¾—å­¦ä¹ çš„åœ°æ–¹ï¼Œå¯¹äºTGCNæœ¬èº«çš„å®ç°ã€æ¶‰åŠå¼ é‡çš„å¤„ç†å˜æ¢ä¹Ÿæœ‰å¾ˆå¤šå¯ä»¥å€Ÿé‰´çš„åœ°æ–¹ã€‚&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
<pubDate>Tue, 11 Aug 2020 17:38:00 +0000</pubDate>
<dc:creator>é‚£ä¸å¤ªå¯èƒ½</dc:creator>
<og:description>è®ºæ–‡é“¾æ¥ï¼šhttps://arxiv.org/abs/1811.05320 åšå®¢åŸä½œè€…Missouterï¼Œåšå®¢é“¾æ¥https://www.cnblogs.com/missouter/ï¼Œæ¬¢è¿äº¤æµã€‚ è§£è¯»</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/missouter/p/13488342.html</dc:identifier>
</item>
<item>
<title>DRFå†…ç½®è®¤è¯ç»„ä»¶ä¹‹è‡ªå®šä¹‰è®¤è¯ç³»ç»Ÿ - å—¨ï¼Œé˜¿è‰¯</title>
<link>http://www.cnblogs.com/fengting0913/p/13488205.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/fengting0913/p/13488205.html</guid>
<description>&lt;p&gt;æ–‡ä¸­è¯¦ç»†è®°å½•äº†DRFå†…ç½®è®¤è¯ç»„ä»¶çš„è®¤è¯ä¸šåŠ¡ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¦‚ä½•è‡ªå®šä¹‰è®¤è¯ç³»ç»Ÿçš„æµç¨‹&lt;/p&gt;&lt;div id=&quot;cnblogs_post_body&quot; readability=&quot;197.5&quot;&gt;
&lt;h2 id=&quot;è‡ªå®šä¹‰tokenè®¤è¯&quot;&gt;è‡ªå®šä¹‰tokenè®¤è¯&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨djangoé¡¹ç›®ä¸­ä¸ç®¡è·¯ç”±ä»¥åŠå¯¹åº”çš„è§†å›¾ç±»æ˜¯å¦‚ä½•å†™çš„ï¼Œéƒ½ä¼šèµ°åˆ° &lt;code&gt;dispatch&lt;/code&gt; æ–¹æ³•ï¼Œè¿›è¡Œè·¯ç”±åˆ†å‘ï¼Œ&lt;/p&gt;
&lt;p&gt;åœ¨é˜…è¯» &lt;code&gt;APIViewç±»ä¸­çš„dispatch&lt;/code&gt; æ–¹æ³•çš„æºç ä¸­ï¼Œæœ‰ä¸ª &lt;code&gt;self.initial(request, *args, **kwargs)&lt;/code&gt;ï¼Œå¯ä»¥å‘ç°è®¤è¯ã€æƒé™ã€é¢‘ç‡è¿™ä¸‰ä¸ªé»˜è®¤ç»„ä»¶éƒ½åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±æ²¡æœ‰å®šä¹‰è¿™ä¸‰ä¸ªç»„ä»¶çš„é…ç½®ï¼Œé‚£ä¹ˆå°±ä¼šä½¿ç”¨æºç ä¸­é»˜è®¤çš„ä¸€äº›é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æºç ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-python&quot;&gt;# Ensure that the incoming request is permitted

#å®ç°è®¤è¯
self.perform_authentication(request)

#æƒé™åˆ¤æ–­
self.check_permissions(request)

#æ§åˆ¶è®¿é—®é¢‘ç‡
elf.check_throttles(request)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç›®å‰ä¸ºæ­¢å¤§å®¶çŸ¥é“çš„è®¤è¯æœºåˆ¶æ˜¯ä¸æ˜¯æœ‰cookieã€sessionå•Šï¼Œsessionæ›´å®‰å…¨ä¸€äº›ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°sessionçš„ä¿¡æ¯éƒ½å­˜åˆ°å’±ä»¬çš„æœåŠ¡å™¨ä¸Šäº†ï¼Œå¦‚æœç”¨æˆ·é‡å¾ˆå¤§çš„è¯ï¼ŒæœåŠ¡å™¨å‹åŠ›æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œå¹¶ä¸”djangoçš„sessionå­˜åˆ°äº†django_sessionè¡¨ä¸­ï¼Œä¸æ˜¯å¾ˆå¥½æ“ä½œï¼Œä½†æ˜¯ä¸€èˆ¬çš„åœºæ™¯éƒ½æ˜¯æ²¡æœ‰å•¥é—®é¢˜çš„ï¼Œç°åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨çš„ä¸€ä¸ªå«åštokenæœºåˆ¶çš„æ–¹å¼æ¯”è¾ƒå¤šï¼Œç°åœ¨æˆ‘ä»¬æ˜¯ä¸æ˜¯å°±çŸ¥é“ä¸ªcsrf_tokenå•Šï¼Œå…¶å®tokenæœ‰å¾ˆå¤šç§å†™æ³•ï¼Œå¦‚ä½•åŠ å¯†ï¼Œä½ æ˜¯hashlibå•Šè¿˜æ˜¯base64å•Šè¿˜æ˜¯hmacå•Šç­‰ï¼Œæ˜¯ä¸æ˜¯åŠ ä¸Šè¿‡æœŸæ—¶é—´å•Šï¼Œæ˜¯ä¸æ˜¯è¦åŠ ä¸Šä¸€ä¸ªsecret_key(å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åå•†å¥½çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½œä¸ºåŒæ–¹çš„è®¤è¯ä¾æ®)ï¼Œæ˜¯ä¸æ˜¯è¦æŒç»­åˆ·æ–°å•Š(æœ‰æ•ˆæ—¶é—´è¦çŸ­ï¼Œä¸æ–­çš„æ›´æ–°tokenï¼Œå¦‚æœåœ¨è¿™ä¹ˆçŸ­çš„æ—¶é—´å†…è¿˜æ˜¯è¢«åˆ«äººæ‹¿èµ°äº†tokenï¼Œæ¨¡æ‹Ÿäº†ç”¨æˆ·çŠ¶æ€ï¼Œé‚£è¿™ä¸ªåŸºæœ¬æ˜¯æ²¡æœ‰åŠæ³•çš„ï¼Œä½†æ˜¯ä½ å¯ä»¥åœ¨ç½‘ç»œæˆ–è€…ç½‘ç»œè®¾å¤‡ä¸­åŠ å®‰å…¨ï¼Œå­˜å®¢æˆ·çš„ipåœ°å€ç­‰ï¼Œé˜²é»‘å®¢)ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¤§è‡´æµç¨‹å›¾è§£ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€ã€€ã€€ã€€ã€€&lt;img src=&quot;https://img2018.cnblogs.com/blog/988061/201904/988061-20190418154106265-841821011.png&quot; alt=&quot;img&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;p&gt;é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œç”¨æˆ·è¡¨ï¼Œé‡Œé¢æ”¾ä¸€ä¸ªtokenå­—æ®µï¼Œå…¶å®ä¸€èˆ¬æˆ‘éƒ½æ˜¯æ”¾åˆ°ä¸¤ä¸ªè¡¨é‡Œé¢ï¼Œå’Œç”¨æˆ·è¡¨æ˜¯ä¸€ä¸ªä¸€å¯¹ä¸€å…³ç³»çš„è¡¨ï¼Œçœ‹ä»£ç ï¼š&lt;/p&gt;
&lt;p&gt;models.pyå†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-python&quot;&gt;################################# userè¡¨ ###############################
class User(models.Model):
    user = models.CharField(max_length=32)
    pwd = models.CharField(max_length=32)
    type_choice=((1,&quot;VIP&quot;),(2,&quot;SVIP&quot;),(3,&quot;SSVIP&quot;))
    user_type = models.IntegerField(choices=type_choice)

    
class UserToken(models.Model):
    user = models.OneToOneField(to=User) #ä¸€å¯¹ä¸€åˆ°ç”¨æˆ·è¡¨
    token = models.CharField(max_length=128) #è®¾ç½®çš„é•¿åº¦å¤§ä¸€äº›
    # expire_time = models.DateTimeField() #å¦‚æœåšè¶…æ—¶æ—¶é—´é™åˆ¶ï¼Œå¯ä»¥åœ¨è¿™é‡ŒåŠ ä¸ªå­—æ®µ
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;urls.pyå†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-python&quot;&gt;#ç™»é™†è®¤è¯æ¥å£
url(r'^login/$', views.LoginView.as_view(),), #åˆ«å¿˜äº†$ç¬¦å·ç»“å°¾
&lt;/code&gt;
&lt;/pre&gt;

&lt;p&gt;views.pyå†…å®¹å¦‚ä¸‹ï¼š&lt;strong&gt;æ¯æ¬¡ç™»é™†æˆåŠŸä¹‹ååˆ·æ–°tokenå€¼&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-python&quot;&gt;###################loginé€»è¾‘æ¥å£#######################
#å…³äºé€»è¾‘æ¥å£è€Œä¸æ˜¯æä¾›æ•°æ®çš„æ¥å£ï¼Œæˆ‘ä»¬ä¸ç”¨ModelViewSetï¼Œè€Œæ˜¯ç›´æ¥å†™ä¸ªç±»ï¼Œç»§æ‰¿APIViewï¼Œç„¶ååœ¨ç±»é‡Œé¢ç›´æ¥å†™å’±çš„é€»è¾‘

import uuid
import os
import json


class LoginView(APIView):
    
    
    #ä»å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®æ¥è®²ï¼Œgetè¯·æ±‚ä¸éœ€è¦å†™ï¼Œå› ä¸ºgetå°±æ˜¯ä¸ªè¦ç™»é™†é¡µé¢çš„æ“ä½œï¼Œvueå°±æå®šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç›´æ¥å†™postè¯·æ±‚å°±å¯ä»¥äº†
    def post(self,request):
        # ä¸€èˆ¬ï¼Œè¯·æ±‚è¿‡æ¥ä¹‹åï¼Œæˆ‘ä»¬åç«¯åšå‡ºçš„å“åº”ï¼Œéƒ½æ˜¯ä¸ªå­—å…¸ï¼Œä¸ä»…åŒ…å«é”™è¯¯ä¿¡æ¯ï¼Œè¿˜æœ‰è¦çŠ¶æ€ç ç­‰ï¼Œè®©å®¢æˆ·ç«¯æ˜ç™½åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…
        # 'code'çš„å€¼ï¼Œ1è¡¨ç¤ºæˆåŠŸï¼Œ0è¡¨ç¤ºå¤±è´¥,2è¡¨ç¤ºå…¶ä»–é”™è¯¯(è‡ªå·±å¯ä»¥åšæ›´ç»†è‡´çš„é”™è¯¯ä»£ç æ˜‚)
        res = {'code': 1, 'msg': None, 'user': None,'token':None}
        print(request.data)
        try:
            user = request.data.get('user')
            pwd = request.data.get('pwd')
            # æ•°æ®åº“ä¸­æŸ¥è¯¢
            user_obj = models.User.objects.filter(user=user, pwd=pwd).first()
            if user_obj:
                res['user'] = user_obj.user
                # æ·»åŠ tokenï¼Œç”¨åˆ°å’±ä»¬usertokenè¡¨
                # models.UserToken.objects.create(user=user,token='123456')
                # åˆ›å»ºtokenéšæœºå­—ç¬¦ä¸²ï¼Œæˆ‘å†™äº†ä¸¤ä¸ªæ–¹å¼ï¼Œç®€å†™çš„æ˜‚ï¼Œæœ€å¥½å†åŠ å¯†ä¸€ä¸‹
                random_str = uuid.uuid4()
                # random_str = os.urandom(16) bytesç±»å‹çš„16ä½çš„éšæœºå­—ç¬¦ä¸²
                models.UserToken.objects.update_or_create(
                    user=user_obj,  # æŸ¥æ‰¾ç­›é€‰æ¡ä»¶
                    defaults={  # æ·»åŠ æˆ–è€…æ›´æ–°çš„æ•°æ®
                        &quot;token&quot;: random_str,
                    }
                )
                res['token'] = random_str
                res['msg'] = 'ç™»é™†æˆåŠŸ'
            else:
                res['code'] = 0
                res['msg'] = 'ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯'
                return Response(res)
        except Exception as e:
            res['code'] = 2
            res['msg'] = str(e)

        return Response(res)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;é€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å°†tokenè¿”å›ç»™äº†ç”¨æˆ·ï¼Œé‚£ä¹ˆä»¥åç”¨æˆ·ä¸ç®¡å‘é€ä»€ä¹ˆè¯·æ±‚ï¼Œéƒ½è¦å¸¦ç€æˆ‘ç»™å®ƒçš„tokenå€¼æ¥è®¿é—®ï¼Œè®¤è¯tokené€šè¿‡æ‰è¡Œï¼Œå¹¶ä¸”æ›´æ–°tokenã€‚&lt;/p&gt;
&lt;p&gt;å°†æ¥æœ‰äº›æ•°æ®æ¥å£æ˜¯å¿…é¡»è¦æ±‚ç”¨æˆ·ç™»é™†ä¹‹åæ‰èƒ½è·å–åˆ°æ•°æ®ï¼Œæ‰€ä»¥å°†æ¥ç”¨æˆ·ç™»é™†å®Œæˆä¹‹åï¼Œæ¯æ¬¡å†è¿‡æ¥è¯·æ±‚ï¼Œéƒ½è¦å¸¦ç€tokenæ¥ï¼Œä½œä¸ºèº«ä»½è®¤è¯çš„ä¾æ®ã€‚&lt;/p&gt;
&lt;h2 id=&quot;drfå†…ç½®çš„è®¤è¯ç»„ä»¶&quot;&gt;DRFå†…ç½®çš„è®¤è¯ç»„ä»¶&lt;/h2&gt;
&lt;p&gt;åœ¨DRFçš„å…¨å±€é…ç½®ä¿¡æ¯ä¸­ï¼Œæœ‰DRFå†…ç½®ç»„ä»¶çš„ç›¸å…³é…ç½® ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-python&quot;&gt;# åŸºäºdjangoåŸºç¡€é…ç½®ä¿¡æ¯ä¸Šçš„drfæ¡†æ¶çš„é…ç½®ä¿¡æ¯

REST_FRAMEWORK = {
    
    ...
    
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework.authentication.SessionAuthentication',
    ),
    
    ...
    
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;è¡¥å……ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;12&quot;&gt;
&lt;p&gt;djangoé¡¹ç›®çš„requestå¯¹è±¡ä¸­æœ‰ä¸€ä¸ªuserå±æ€§ï¼Œæ˜¯ä¸€ä¸ªé»˜è®¤çš„å‡ç”¨æˆ· &lt;code&gt;AnonymousUser&lt;/code&gt; ï¼Œå½“ç”¨æˆ·æœªç™»å½•adminåå°ç®¡ç†ç³»ç»Ÿæ—¶ï¼Œ&lt;code&gt;request.user = AnonymousUser&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è‹¥ç™»å½•äº†adminåå°ï¼Œåœ¨djangoå†…ç½®çš„è®¤è¯ç³»ç»Ÿä¸­ï¼Œrequest.user = å½“å‰ç™»å½•ç”¨æˆ·&lt;/p&gt;
&lt;p&gt;DRFä¸­å†…ç½®çš„è®¤è¯ç³»ç»Ÿ &lt;code&gt;'rest_framework.authentication.SessionAuthentication'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è·Ÿdjangoä¸­çš„è®¤è¯ç³»ç»ŸæŒ‚é’©çš„ï¼Œä½¿ç”¨çš„ä¹Ÿæ˜¯adminåå°çš„ç”¨æˆ·ä¿¡æ¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;DRFå†…ç½®ç»„ä»¶ä¾æ®sessionä¿¡æ¯åšè®¤è¯ï¼Œæ ¹æ®ä¸Šé¢çš„å™è¿°ï¼Œsessionä¸é€‚åˆåšå¤§å‹é¡¹ç›®çš„è®¤è¯è½½ä½“ï¼Œå¤ªé‡äº†ï¼æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å€ŸåŠ©DRFå†…ç½®çš„è®¤è¯ç³»ç»Ÿè¿›è¡Œè‡ªå®šä¹‰è®¤è¯ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä»¥ä¸‹æ˜¯å…¶è®¤è¯æœºåˆ¶çš„éƒ¨åˆ†æºç å®ç°ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-python&quot;&gt;def _authenticate(self):
        &quot;&quot;&quot;
        Attempt to authenticate the request using each authentication instance
        in turn.
        &quot;&quot;&quot;
        for authenticator in self.authenticators:
            try:
                user_auth_tuple = authenticator.authenticate(self) 
            except exceptions.APIException:
                self._not_authenticated()
                raise

            if user_auth_tuple is not None:
                self._authenticator = authenticator
                #å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œselfæ˜¯APIViewå°è£…çš„æ–°çš„requestå¯¹è±¡
                self.user, self.auth = user_auth_tuple 
                return   #é€€å‡ºäº†è¿™ä¸ªå‡½æ•°ï¼Œå‡½æ•°å°±ä¸ä¼šæ‰§è¡Œäº†ï¼Œä¸ä¼šå†å¾ªç¯äº†ï¼Œæ‰€ä»¥å¦‚æœä½ çš„ç¬¬ä¸€ä¸ªè®¤è¯ç±»æœ‰è¿”å›å€¼ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªè®¤è¯ç±»å°±ä¸ä¼šæ‰§è¡Œäº†ï¼Œæ‰€ä»¥åˆ«å¿˜äº†returnæ˜¯ç»“æŸå‡½æ•°çš„æ„æ€ï¼Œæ‰€ä»¥å¦‚æœä½ æœ‰å¤šä¸ªè®¤è¯ç±»ï¼Œé‚£ä¹ˆè¿”å›å€¼æ”¾åˆ°æœ€åä¸€ä¸ªç±»é‡Œé¢
&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code class=&quot;language-python&quot;&gt;from rest_framework.authentication import BaseAuthentication

# 'BaseAuthentication'è¿™ä¸ªç±»æºç å®ç°ä¸­æœ‰ä¸ª'authenticate'æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™è¿™ä¸ªç±»è¿›è¡Œè‡ªå®šåˆ¶å’±ä»¬çš„è®¤è¯ç³»ç»Ÿã€‚
&quot;&quot;&quot;
    def authenticate(self, request):
        &quot;&quot;&quot;
        Authenticate the request and return a two-tuple of (user, token).
        &quot;&quot;&quot;
        raise NotImplementedError(&quot;.authenticate() must be overridden.&quot;)
&quot;&quot;&quot;  
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;ä¸€ã€åŸºäºdrfæä¾›çš„è®¤è¯ç±»BaseAuthenticationè¿›è¡Œè‡ªå®šåˆ¶è®¤è¯ç³»ç»Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;1ã€è‡ªå®šä¹‰è®¤è¯ç±»MyAuthenticationï¼Œç»§æ‰¿è‡ªBaseAuthenticationç±»ä¸”é‡å†™å…¶authenticateæ–¹æ³•&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-python&quot;&gt;# utils.auth.py

from rest_framework.authentication import BaseAuthentication
from rest_framework.exceptions import AuthenticationFailed


class MyAuthentication(BaseAuthentication):
    
    def authenticate(self, request):
        
        if 1:
            return &quot;aliang&quot;, &quot;fengting007&quot;
        
        else:
            return AuthenticationFailed(&quot;è®¤è¯å¤±è´¥ï¼&quot;)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;2ã€å…¨å±€é…ç½®&lt;/p&gt;
&lt;p&gt;å¯¹è‡ªå®šä¹‰çš„è®¤è¯ç±»MyAuthenticationä¸­çš„è®¤è¯æµç¨‹è¿›è¡Œå…¨å±€é…ç½®ï¼Œå³åœ¨è®¿é—®æ¯ä¸ªurlæ—¶éƒ½è¦ç»è¿‡è‡ªå®šä¹‰çš„è®¤è¯é€»è¾‘&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;åœ¨settings.pyé…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®&lt;/li&gt;
&lt;/ul&gt;&lt;pre&gt;
&lt;code class=&quot;language-python&quot;&gt;# åŸºäºdjangoåŸºç¡€é…ç½®ä¿¡æ¯ä¸Šçš„drfæ¡†æ¶çš„é…ç½®ä¿¡æ¯

REST_FRAMEWORK = {
    
    ...
    
    'DEFAULT_AUTHENTICATION_CLASSES': (
        
        # è‡ªå®šä¹‰è®¤è¯ç±»çš„è·¯å¾„
        'four.utils.auth.MyAuthentication',
        
        # æ³¨é‡Šæ‰drfå†…ç½®çš„sessionè®¤è¯ç³»ç»Ÿï¼Œä½¿ç”¨è‡ªå·±å®šåˆ¶çš„ï¼
        # 'rest_framework.authentication.SessionAuthentication',
    ),
    
    ...
    
}

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;3ã€å±€éƒ¨é…ç½®&lt;/p&gt;
&lt;p&gt;å³åœ¨è®¿é—®æŸä¸ªæŒ‡å®šçš„urlæ—¶ï¼Œéœ€è¦è®¤è¯åæ‰å¯ä»¥è·å–åˆ°å“åº”é¡µé¢ï¼Œè€Œä¸æ˜¯è®¿é—®æ‰€æœ‰urléƒ½éœ€è¦è®¤è¯ï¼Œè¿™å°±è¦åœ¨æŒ‡å®šçš„urlæ‰€æ˜ å°„çš„ç±»è§†å›¾ä¸­è¿›è¡Œå®šåˆ¶&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-python&quot;&gt;from rest_framework.views import APIView
from rest_framework.response import Response
from four.utils.auth import MyAuthentication

class AuthAPIView(APIView):
    
    # è®¿é—®AuthAPIViewç±»è§†å›¾æ‰€å¯¹åº”çš„urlè¯·æ±‚å“åº”é¡µé¢æ—¶ï¼Œè¦ç»è¿‡è‡ªå®šåˆ¶çš„MyAuthenticationç±»çš„è®¤è¯é€»è¾‘ï¼
    authentication_classes = [MyAuthentication,]
    
    def get(self, request):
        
        print(request.user)  # 'aliang'
        print(request.auth)  # 'fengting007'
        
        return Response({'msg':'å—¨ï¼Œman!'})
    

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;äºŒã€ä¸ç»§æ‰¿drfæä¾›çš„è®¤è¯ç±»BaseAuthenticationè‡ªå®šåˆ¶è®¤è¯ç±»&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-python&quot;&gt;class MyAuthentication():
    
    def authenticate_header(self,request):
         pass
    
    # authenticateæ–¹æ³•æ˜¯å›ºå®šçš„,å¹¶ä¸”å¿…é¡»æœ‰ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯æ–°çš„requestå¯¹è±¡
    def authenticate(self, request):
        
        if 1:
            
            # æºç ä¸­ä¼šå‘ç°ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæœ‰ä¸¤ä¸ªè¿”å›å€¼ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªè¿”å›å€¼å°è£…åˆ°äº†æ–°çš„requestå¯¹è±¡ä¸­äº†ï¼Œrequest.user--&amp;gt;ç”¨æˆ·å å’Œ request.auth--&amp;gt;tokenå€¼ï¼Œè¿™ä¸¤ä¸ªå€¼ä½œä¸ºè®¤è¯ç»“æŸåçš„è¿”å›ç»“æœ
                
            # å¦‚ä¸‹æ“ä½œå³ï¼š
                # request.user = 'aliang'
                # request.auth = 'fengting007'
                
            return &quot;aliang&quot;, &quot;fengting007&quot;
 
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è‡³äºæ­¤è‡ªå®šä¹‰è®¤è¯ç±»çš„å…¨å±€é…ç½®ä»¥åŠå±€éƒ¨é…ç½®çš„æ–¹æ³•ä¸ä¸Šé¢çš„æµç¨‹æ˜¯ä¸€è‡´çš„ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-python&quot;&gt;# å±€éƒ¨é…ç½®ç¤ºä¾‹ï¼š
from app01.serializer import BookSerializers
from four.utils.auth import MyAuthentication


class BookView(APIView):
    
    #è®¤è¯ç»„ä»¶è‚¯å®šæ˜¯åœ¨getã€postç­‰æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œçš„ï¼Œæºç ä¸­è¿™ä¸ªç»„ä»¶æ˜¯åœ¨dispatchçš„åœ°æ–¹è°ƒç”¨çš„
    authentication_classes = [MyAuthentication,] #è®¤è¯ç±»å¯ä»¥å†™å¤šä¸ªï¼Œä¸€ä¸ªä¸€ä¸ªçš„é¡ºåºéªŒè¯
    
    def get(self,request):
 
        #è¿™æ ·å°±æ‹¿åˆ°äº†ä¸Šé¢MyAuthenticationç±»çš„authenticateæ–¹æ³•çš„ä¸¤ä¸ªè¿”å›å€¼
        print(request.user)  
        print(request.auth)
        
        book_obj_list = models.Book.objects.all()
        s_books = BookSerializers(book_obj_list,many=True)
        return Response(s_books.data)

&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;</description>
<pubDate>Tue, 11 Aug 2020 16:08:00 +0000</pubDate>
<dc:creator>å—¨ï¼Œé˜¿è‰¯</dc:creator>
<og:description>æ–‡ä¸­è¯¦ç»†è®°å½•äº†DRFå†…ç½®è®¤è¯ç»„ä»¶çš„è®¤è¯ä¸šåŠ¡ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¦‚ä½•è‡ªå®šä¹‰è®¤è¯ç³»ç»Ÿçš„æµç¨‹</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/fengting0913/p/13488205.html</dc:identifier>
</item>
<item>
<title>ROS å…«å‰æ ‘åœ°å›¾æ„å»º - ç»™ octomap_server å¢åŠ åŠå¾„æ»¤æ³¢å™¨ï¼ - ç™»é¾™</title>
<link>http://www.cnblogs.com/dlonng/p/13488150.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/dlonng/p/13488150.html</guid>
<description>&lt;p&gt;ä¸ºäº†åœ¨æ¯å¸§ç‚¹äº‘ä¸­æ»¤é™¤å™ªå£°ç‚¹ï¼Œé€‰æ‹©äº†åŠå¾„æ»¤æ³¢å™¨ï¼Œä¹Ÿç”¨é«˜æ–¯æ»¤æ³¢å™¨æµ‹è¯•è¿‡ï¼Œä½†æ˜¯æ²¡æœ‰åŠå¾„æ•ˆæœå¥½ï¼Œè¿™é‡Œè®°å½•ä¸‹åœ¨ octomap_server ä¸­å¢åŠ åŠå¾„æ»¤æ³¢å™¨çš„æ­¥éª¤ï¼Œå¹¶åœ¨ launch ä¸­é…ç½®æ»¤æ³¢å™¨å‚æ•°ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä¸€ã€åŠå¾„æ»¤æ³¢å™¨åŸºæœ¬åŸç†&quot;&gt;ä¸€ã€åŠå¾„æ»¤æ³¢å™¨åŸºæœ¬åŸç†&lt;/h2&gt;
&lt;p&gt;æ”¾ä¸€å¼ æ±‡æŠ¥ç”¨çš„ PPT æˆªå›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://dlonng.oss-cn-shenzhen.aliyuncs.com/blog/banjing_filter.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;åŸç†å¾ˆç®€å•å°±æ˜¯åˆ¤æ–­ä¸€ä¸ªç‚¹äº‘å‘¨å›´ï¼ˆåŠå¾„ Rï¼‰æœ‰æ²¡æœ‰è¶³å¤Ÿå¤šï¼ˆKï¼‰çš„é‚»å±…ç‚¹ï¼Œå¦‚æœæ²¡æœ‰å°±åˆ é™¤è¿™ä¸ªç‚¹ï¼Œå¦åˆ™å°±ä¿ç•™ã€‚&lt;/p&gt;
&lt;h2 id=&quot;äºŒã€åŸºæœ¬ç”¨æ³•&quot;&gt;äºŒã€åŸºæœ¬ç”¨æ³•&lt;/h2&gt;
&lt;p&gt;æˆ‘ä¸€èˆ¬å­¦ä¹ æŠ€æœ¯å–œæ¬¢åˆ°å®˜ç½‘çœ‹æœ€åŸå§‹çš„æ•™ç¨‹ï¼š&lt;a href=&quot;https://pcl.readthedocs.io/projects/tutorials/en/latest/remove_outliers.html#remove-outliers&quot;&gt;Removing outliers using a Conditional or RadiusOutlier removal&lt;/a&gt;ï¼Œè¿™ä¸ªæ•™ç¨‹ä»‹ç»äº†åŠå¾„æ»¤æ³¢å™¨ï¼ˆæˆ‘ä¸æ¸…æ¥šä¸­æ–‡ååˆ°åº•å«ä»€ä¹ˆæ»¤æ³¢å™¨ï¼‰çš„åŸºæœ¬ç”¨æ³•ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;#include &amp;lt;pcl/point_types.h&amp;gt;
#include &amp;lt;pcl/filters/radius_outlier_removal.h&amp;gt;

// è¾“å…¥å¾…æ»¤æ³¢çš„åŸå§‹ç‚¹äº‘æŒ‡é’ˆ
pcl::PointCloud&amp;lt;pcl::PointXYZ&amp;gt;::Ptr cloud (new pcl::PointCloud&amp;lt;pcl::PointXYZ&amp;gt;);

// ä¿å­˜æ»¤æ³¢åçš„ç‚¹äº‘æŒ‡é’ˆ
pcl::PointCloud&amp;lt;pcl::PointXYZ&amp;gt;::Ptr cloud_filtered (new pcl::PointCloud&amp;lt;pcl::PointXYZ&amp;gt;);

// åˆ›å»ºæ»¤æ³¢å™¨å¯¹è±¡
pcl::RadiusOutlierRemoval&amp;lt;pcl::PointXYZ&amp;gt; outrem;

// è®¾ç½®è¦æ»¤æ³¢çš„ç‚¹äº‘
outrem.setInputCloud(cloud);

// è®¾ç½®æ»¤æ³¢åŠå¾„
outrem.setRadiusSearch(0.8);

// è®¾ç½®æ»¤æ³¢æœ€å°‘è¿‘é‚»æ•°
outrem.setMinNeighborsInRadius (2);

// æ‰§è¡ŒåŠå¾„æ»¤æ³¢
outrem.filter (*cloud_filtered);
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¦‚æœç¬¬ä¸€æ¬¡ä½¿ç”¨ PCL çš„æ»¤æ³¢å™¨ï¼Œå¯ä»¥æŠŠè¿™ä¸ªæ•™ç¨‹è‡ªå·±è¿è¡Œä¸€éï¼Œæˆ‘ä¹‹å‰è¿è¡Œè¿‡äº†ï¼Œè¿™æ¬¡å°±ä¸è´´ä»£ç äº†ï¼Œä¸‹é¢åˆ†äº«ä¸‹æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­å¦‚æœä½¿ç”¨è¿™ä¸ªåŠå¾„æ»¤æ³¢å™¨å¯¹æˆ‘çš„ octomap_server æ„å»ºçš„å…«å‰æ ‘åœ°å›¾è¿›è¡Œæ»¤æ³¢ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä¸‰ã€ç»™æˆ‘çš„åœ°å›¾æ»¤æ³¢&quot;&gt;ä¸‰ã€ç»™æˆ‘çš„åœ°å›¾æ»¤æ³¢&lt;/h2&gt;
&lt;h3 id=&quot;31-å®šä¹‰åŠå¾„æ»¤æ³¢å™¨å‚æ•°&quot;&gt;3.1 å®šä¹‰åŠå¾„æ»¤æ³¢å™¨å‚æ•°&lt;/h3&gt;
&lt;p&gt;åŠå¾„æ»¤æ³¢å™¨æœ‰ 2 ä¸ªå‚æ•°ï¼šæ»¤æ³¢åŠå¾„å’ŒåŠå¾„å†…éƒ¨é‚»å±…æ•°ï¼Œæ³¨æ„æ•°æ®ç±»å‹&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;// æ»¤æ³¢åŠå¾„
double m_outrem_radius;

// åŠå¾„å†…çš„é‚»å±…æ•°
int m_outrem_neighbors;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨ä¸­åˆå§‹åŒ–ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;OctomapServer::OctomapServer(const ros::NodeHandle private_nh_, const ros::NodeHandle &amp;amp;nh_)
: ...,
  m_outrem_radius(-std::numeric_limits&amp;lt;double&amp;gt;::max()),
  m_outrem_neighbors(-std::numeric_limits&amp;lt;int&amp;gt;::max()),
  ...
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä» launch ä¸­è¯»å–å¯åŠ¨å‚æ•°ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;// add outrem filter
m_nh_private.param(&quot;outrem_radius&quot;, m_outrem_radius, m_outrem_radius);
m_nh_private.param(&quot;outrem_neighbors&quot;, m_outrem_neighbors, m_outrem_neighbors);
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;32-æ‰§è¡ŒåŠå¾„æ»¤æ³¢&quot;&gt;3.2 æ‰§è¡ŒåŠå¾„æ»¤æ³¢&lt;/h3&gt;
&lt;p&gt;åœ¨ InsertPointCloudCallBack å‡½æ•°çš„ PassThough å‰æ‰§è¡ŒåŠå¾„æ»¤æ³¢ï¼Œå³å¯¹æ¯ä¸€å¸§ç‚¹äº‘åœ¨æ„å»ºå…«å‰æ ‘åœ°å›¾å‰è¿›è¡Œæ»¤æ³¢ï¼Œä¸»è¦æ˜¯ä¸ºäº†å»æ‰å•ç‹¬çš„ç¦»ç¾¤ç‚¹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;// å¯¹ä¸€å¸§ pc ç‚¹äº‘è¿›è¡ŒåŠå¾„æ»¤æ³¢
pcl::RadiusOutlierRemoval&amp;lt;pcl::PointXYZRGB&amp;gt; outrem;

// è¿™é‡Œéœ€è¦ä¼ é€’æŒ‡é’ˆï¼Œå› ä¸ºæˆ‘çš„ pc ä¸æ˜¯æŒ‡é’ˆï¼Œæ‰€ä»¥è¿™é‡Œåšäº† makeShared
outrem.setInputCloud(pc.makeShared());

// è®¾ç½®æ»¤æ³¢åŠå¾„ï¼Œè¿™é‡Œè®¾ç½®ä¸º 1m
outrem.setRadiusSearch(m_outrem_radius); 

// è®¾ç½®æ»¤æ³¢è¿‘é‚»æ•°ï¼Œè¿™é‡Œè®¾ç½®ä¸º 10 ä¸ª
outrem.setMinNeighborsInRadius (m_outrem_neighbors);

// æ‰§è¡Œæ»¤æ³¢
outrem.filter(pc);
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;33-åœ¨-launch-ä¸­é…ç½®åŠå¾„æ»¤æ³¢å™¨å‚æ•°&quot;&gt;3.3 åœ¨ launch ä¸­é…ç½®åŠå¾„æ»¤æ³¢å™¨å‚æ•°&lt;/h3&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;param name = &quot;outrem_radius&quot; type = &quot;double&quot; value = &quot;1.0&quot;&amp;gt;
&amp;lt;param name = &quot;outrem_neighbors&quot; type = &quot;int&quot; value = &quot;10&quot;&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™æ ·ä»¥åå°±å¯ä»¥ä» launch ä¸­ç›´æ¥é…ç½®æ»¤æ³¢å™¨çš„å‚æ•°äº†ï¼Œä¸ç”¨æ¯æ¬¡ä¿®æ”¹å†é‡æ–°ç¼–è¯‘ï¼Œè¿™æ ·è°ƒè¯•èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;h3 id=&quot;34-æ»¤æ³¢ç»“æœ&quot;&gt;3.4 æ»¤æ³¢ç»“æœ&lt;/h3&gt;
&lt;p&gt;è¿™æ˜¯åŸå§‹åœ°å›¾ï¼Œ15cm åˆ†è¾¨ç‡ï¼Œçº¢æ¡†å†…éƒ¨æœ‰å¾ˆå¤šå•ä¸ªçš„ç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://dlonng.oss-cn-shenzhen.aliyuncs.com/blog/banjing_filter_before.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯æ»¤æ³¢åçš„æ•ˆæœï¼Œæ»¤æ³¢åŠå¾„ 1mï¼Œè¿‘é‚»ç‚¹ 10 ä¸ªï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://dlonng.oss-cn-shenzhen.aliyuncs.com/blog/banjing_filter_after.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ•ˆæœè¿˜æ˜¯å¯ä»¥çš„ï¼Œå¸Œæœ›èƒ½å¯¹ä½ æœ‰å¸®åŠ©ï¼Œå¦‚æœä½¿ç”¨å…¶ä»–çš„æ»¤æ³¢å™¨ï¼ŒæŒ‰ç…§å®˜æ–¹çš„æ•™ç¨‹æ¥å°±è¡Œäº†ï¼ŒæŒæ¡å­¦ä¹ æ–¹æ³•æ‰æ˜¯æœ€é‡è¦çš„ï¼šï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://dlonng.oss-cn-shenzhen.aliyuncs.com/yingliu_code/yinliu_code.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Tue, 11 Aug 2020 15:51:00 +0000</pubDate>
<dc:creator>ç™»é¾™</dc:creator>
<og:description>ä¸ºäº†åœ¨æ¯å¸§ç‚¹äº‘ä¸­æ»¤é™¤å™ªå£°ç‚¹ï¼Œé€‰æ‹©äº†åŠå¾„æ»¤æ³¢å™¨ï¼Œä¹Ÿç”¨é«˜æ–¯æ»¤æ³¢å™¨æµ‹è¯•è¿‡ï¼Œä½†æ˜¯æ²¡æœ‰åŠå¾„æ•ˆæœå¥½ï¼Œè¿™é‡Œè®°å½•ä¸‹åœ¨ octomap_server ä¸­å¢åŠ åŠå¾„æ»¤æ³¢å™¨çš„æ­¥éª¤ï¼Œå¹¶åœ¨ launch ä¸­é…ç½®æ»¤æ³¢å™¨å‚æ•°ã€‚ ä¸€ã€</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/dlonng/p/13488150.html</dc:identifier>
</item>
<item>
<title>goå¾®æœåŠ¡ç³»åˆ—(å››) - gRPCå…¥é—¨ - å®æ ‘å‘</title>
<link>http://www.cnblogs.com/baoshu/p/13488106.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/baoshu/p/13488106.html</guid>
<description>&lt;h2 id=&quot;1-å‰è¨€&quot;&gt;&lt;span id=&quot;head1&quot;&gt;1. å‰è¨€&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;ä¹‹å‰å­¦ä¹ çš„goçš„å¾®æœåŠ¡ä¹‹é—´è¿˜æ˜¯é€šè¿‡&lt;code&gt;REST API&lt;/code&gt;çš„æ–¹å¼äº’ç›¸è°ƒç”¨çš„ï¼Œä½†æ—¢ç„¶è¦å­¦ä¹ å¾®æœåŠ¡ï¼Œ&lt;code&gt;gRPC&lt;/code&gt;è‚¯å®šæ˜¯ä¸€ä¸ªç»•ä¸è¿‡å»çš„éœ€è¦å­¦ä¹ çš„æŠ€æœ¯, æ‰€ä»¥å°±å¼€æå§&lt;/p&gt;
&lt;h2 id=&quot;2-grpcä¸protobufç®€ä»‹&quot;&gt;&lt;span id=&quot;head2&quot;&gt;2. gRPCä¸Protobufç®€ä»‹&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;gRPC&lt;/code&gt;æ˜¯ä¸€æ¬¾&lt;strong&gt;è¯­è¨€ä¸­ç«‹&lt;/strong&gt;ã€&lt;strong&gt;å¹³å°ä¸­ç«‹&lt;/strong&gt;ã€å¼€æºçš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ç³»ç»Ÿ&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;å³ï¼š&lt;code&gt;gRPC&lt;/code&gt;å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥åœ¨å¤šç§ç¯å¢ƒä¸­è¿è¡Œå’Œäº¤äº’ï¼Œä¾‹å¦‚ç”¨&lt;code&gt;java&lt;/code&gt;å†™ä¸€ä¸ªæœåŠ¡ç«¯ï¼Œå¯ä»¥ç”¨goè¯­è¨€å†™å®¢æˆ·ç«¯è°ƒç”¨&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œç”±äºæ¯ä¸ªæœåŠ¡å¯¹åº”çš„ä»£ç åº“æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œæ— æ³•ç›´æ¥è°ƒç”¨ï¼Œå½¼æ­¤é—´çš„é€šä¿¡å°±æ˜¯ä¸ªå¤§é—®é¢˜.&lt;/p&gt;
&lt;p&gt;gRPCå¯ä»¥å®ç°å°†å¤§çš„é¡¹ç›®æ‹†åˆ†ä¸ºå¤šä¸ªå°ä¸”ç‹¬ç«‹çš„ä¸šåŠ¡æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡ã€‚å„æœåŠ¡é—´ä½¿ç”¨é«˜æ•ˆçš„&lt;code&gt;protobuf&lt;/code&gt;åè®®è¿›è¡ŒRPCè°ƒç”¨ï¼ŒgRPCé»˜è®¤ä½¿ç”¨&lt;code&gt;protocol buffers&lt;/code&gt;ï¼Œè¿™æ˜¯googleå¼€æºçš„ä¸€å¥—æˆç†Ÿçš„ç»“æ„æ•°æ®åºåˆ—åŒ–æœºåˆ¶&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æ•°æ®æ ¼å¼å¦‚JSON&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯ä»¥ç”¨proto filesåˆ›å»ºgRPCæœåŠ¡ï¼Œç”¨messageç±»å‹æ¥å®šä¹‰æ–¹æ³•å‚æ•°å’Œè¿”å›ç±»å‹&lt;/p&gt;
&lt;h2 id=&quot;3-å®‰è£…&quot;&gt;&lt;span id=&quot;head3&quot;&gt;3. å®‰è£…&lt;/span&gt;&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;ç¬¬ä¸€æ­¥ï¼šä¸‹è½½grpcé€šç”¨ç¼–è¯‘å™¨&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;å¦‚ä¸‹å›¾ï¼Œè§£å‹å‡ºæ¥å› å¹³å°è€Œå¼‚ä¼šæ˜¯ä¸€ä¸ª&lt;code&gt;protoc&lt;/code&gt;æˆ–è€…&lt;code&gt;protoc.exe&lt;/code&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;0&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/protocolbuffers/protobuf/releases&quot;&gt;https://github.com/protocolbuffers/protobuf/releases&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1ghn71b14sxj312l0g0di1.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;ç¬¬äºŒæ­¥ï¼šæŠŠä¸‹è½½çš„äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­&lt;/strong&gt;(ä¸ºäº†èƒ½å…¨å±€è®¿é—®protoc)
&lt;ul&gt;&lt;li&gt;è¿™é‡Œä»¥ä¸ºmacä¸ºä¾‹å­&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;# æ‰“å¼€å­˜æ”¾ç¯å¢ƒå˜é‡çš„æ–‡ä»¶
vim ~/.bash_profile

# æ·»åŠ å¦‚ä¸‹ï¼Œåé¢æ˜¯è·¯å¾„
alias protoc=&quot;/Users/emm/others/protoc-3.12.4-osx-x86_64/bin/protoc&quot;

# åˆ·æ–°ç¯å¢ƒå˜é‡
source ./.bash_profile
&lt;/code&gt;
&lt;/pre&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;ç¬¬ä¸‰æ­¥: å®‰è£…goä¸“ç”¨çš„protocçš„ç”Ÿæˆå™¨&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;go get github.com/golang/protobuf/protoc-gen-go&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å®‰è£…åä¼šåœ¨&lt;code&gt;GOPATH&lt;/code&gt;ç›®å½•ä¸‹ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œprotobufçš„ç¼–è¯‘å™¨æ’ä»¶&lt;code&gt;protoc-gen-go&lt;/code&gt;ï¼Œç­‰ä¸‹æ‰§è¡Œ&lt;code&gt;protoc&lt;/code&gt;å‘½ä»¤ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ’ä»¶&lt;/p&gt;
&lt;h2 id=&quot;4-ä¸­é—´æ–‡ä»¶æ¼”ç¤º&quot;&gt;&lt;span id=&quot;head4&quot;&gt;4. ä¸­é—´æ–‡ä»¶æ¼”ç¤º&lt;/span&gt;&lt;/h2&gt;
&lt;h3 id=&quot;41-ç¼–å†™ä¸­é—´æ–‡ä»¶&quot;&gt;&lt;span id=&quot;head5&quot;&gt;4.1 ç¼–å†™ä¸­é—´æ–‡ä»¶&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;è¿™é‡Œæ–°å»ºä¸€ä¸ªpbfilesæ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾&lt;code&gt;protoc&lt;/code&gt;æ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-protoc&quot;&gt;// è¿™ä¸ªå°±æ˜¯protobufçš„ä¸­é—´æ–‡ä»¶

// æŒ‡å®šçš„å½“å‰protoè¯­æ³•çš„ç‰ˆæœ¬ï¼Œæœ‰2å’Œ3
syntax = &quot;proto3&quot;;

// æŒ‡å®šç­‰ä¼šæ–‡ä»¶ç”Ÿæˆå‡ºæ¥çš„package
package service;

// å®šä¹‰request
message ProductRequest{
  int32 prod_id = 1; // 1ä»£è¡¨é¡ºåº
}

// å®šä¹‰response
message ProductResponse{
  int32 prod_stock = 1; // 1ä»£è¡¨é¡ºåº
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1ghn8eityngj30me0cp0uu.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;42-è¿è¡Œprotocå‘½ä»¤ç¼–è¯‘æˆgoä¸­é—´æ–‡ä»¶&quot;&gt;&lt;span id=&quot;head6&quot;&gt;4.2 è¿è¡Œprotocå‘½ä»¤ç¼–è¯‘æˆgoä¸­é—´æ–‡ä»¶&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;ç„¶åè¿è¡Œä»¥ä¸‹çš„å‘½ä»¤æ¥ç”Ÿæˆ&lt;code&gt;.go&lt;/code&gt;ç»“å°¾çš„æ–‡ä»¶&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä¸‹é¢çš„å‘½ä»¤å°±æ˜¯æˆ‘ä»¬åˆšåˆšä¸‹çš„&lt;code&gt;protoc&lt;/code&gt;åŒ…ä»¥åŠ&lt;code&gt;protoc-gen-go&lt;/code&gt;æ’ä»¶çš„ä½œç”¨&lt;/li&gt;
&lt;/ul&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;# ç¼–è¯‘Product.protoä¹‹åè¾“å‡ºåˆ°serviceæ–‡ä»¶å¤¹
protoc --go_out=../service Product.proto
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¦‚ä¸‹å°±åœ¨serviceæ–‡ä»¶å¤¹è‡ªåŠ¨ç”Ÿæˆäº†ä¸€ä¸ªgoæ–‡ä»¶ï¼Œå¹¶ä¸”å®ƒæç¤ºæˆ‘ä»¬ä¸è¦å»ä¿®æ”¹å®ƒ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1ghn8jpg8uzj31gk0k50wx.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;5-åˆ›å»ºgrpcæœåŠ¡ç«¯&quot;&gt;&lt;span id=&quot;head7&quot;&gt;5. åˆ›å»ºgRPCæœåŠ¡ç«¯&lt;/span&gt;&lt;/h2&gt;
&lt;h3 id=&quot;51-æ–°å»ºproductprotoc&quot;&gt;&lt;span id=&quot;head8&quot;&gt;5.1 æ–°å»ºProduct.protoc&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªprotocæ–‡ä»¶æ¯”ä¸Šé¢çš„å¤šå‡ºäº†ä¸€ä¸ªserviceçš„å®šä¹‰å’Œé‡Œé¢çš„ä¸€ä¸ªæ–¹æ³•çš„å®šä¹‰&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-protoc&quot;&gt;// è¿™ä¸ªå°±æ˜¯protobufçš„ä¸­é—´æ–‡ä»¶

// æŒ‡å®šçš„å½“å‰protoè¯­æ³•çš„ç‰ˆæœ¬ï¼Œæœ‰2å’Œ3
syntax = &quot;proto3&quot;;

// æŒ‡å®šç­‰ä¼šæ–‡ä»¶ç”Ÿæˆå‡ºæ¥çš„package
package service;

// å®šä¹‰request model
message ProductRequest{
  int32 prod_id = 1; // 1ä»£è¡¨é¡ºåº
}

// å®šä¹‰response model
message ProductResponse{
  int32 prod_stock = 1; // 1ä»£è¡¨é¡ºåº
}

// å®šä¹‰æœåŠ¡ä¸»ä½“
service ProdService{
  // å®šä¹‰æ–¹æ³•
  rpc GetProductStock(ProductRequest) returns(ProductResponse);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;52-è¿è¡Œprotocå‘½ä»¤&quot;&gt;&lt;span id=&quot;head9&quot;&gt;5.2 è¿è¡Œprotocå‘½ä»¤&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;è¿™é‡Œçš„protocå‘½ä»¤å’Œä¹‹å‰çš„å‘½ä»¤ç›¸æ¯”æœ‰ç‚¹ä¸ä¸€æ ·&lt;/li&gt;
&lt;/ul&gt;&lt;pre&gt;
&lt;code&gt;protoc --go_out=plugins=grpc:../service Product.proto
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç„¶åè¿˜æ˜¯ä¼šåœ¨serviceæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä¸ª&lt;code&gt;.go&lt;/code&gt;çš„æ–‡ä»¶&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ‰ä¸¤ä¸ªæ¯”è¾ƒéœ€è¦æ³¨æ„çš„&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;RegisterProdServiceServer&lt;/li&gt;
&lt;/ol&gt;&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;åé¢éœ€è¦åœ¨serverä¸­è°ƒç”¨è¿™ä¸ªæ¥æ³¨å†Œ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1ghn9mmp3j2j30nd0d776h.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;&lt;li&gt;ProdServiceServerçš„æ¥å£å®šä¹‰&lt;/li&gt;
&lt;/ol&gt;&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦ç»§æ‰¿è¿™ä¸ªæ¥å£ï¼Œå³å®ç°å®ƒæ‰€æœ‰çš„æ–¹æ³•&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1ghn9nq5pd4j30p50ccmyx.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;53-å®ç°registerprodserviceserveræ¥å£&quot;&gt;&lt;span id=&quot;head10&quot;&gt;5.3 å®ç°RegisterProdServiceServeræ¥å£&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢æˆ‘ä»¬åœ¨&lt;code&gt;protoc&lt;/code&gt;æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ª&lt;code&gt;ProdService&lt;/code&gt;ä¸­åŒ…å«äº†ä¸€ä¸ª&lt;code&gt;GetProductStock&lt;/code&gt;çš„æ–¹æ³•&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬è¦å®ç°è‡ªåŠ¨ç”Ÿæˆçš„goæ–‡ä»¶ä¸­çš„æ¥å£&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-go&quot;&gt;package service

import &quot;context&quot;

type ProdService struct {
}

func (ps *ProdService) GetProductStock(ctx context.Context, request *ProductRequest) (*ProductResponse, error) {
        return &amp;amp;ProductResponse{ProdStock: request.ProdId}, nil
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1ghn9q844nuj30zn0efjtz.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;54-å‡†å¤‡å·¥ä½œå®Œæˆï¼Œåˆ›å»ºmainå‡½æ•°å°†æœåŠ¡ç«¯è·‘èµ·æ¥&quot;&gt;&lt;span id=&quot;head11&quot;&gt;5.4 å‡†å¤‡å·¥ä½œå®Œæˆï¼Œåˆ›å»ºmainå‡½æ•°å°†æœåŠ¡ç«¯è·‘èµ·æ¥&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;å‰é¢çš„éƒ½æ˜¯å‡†å¤‡å·¥ä½œï¼Œè¿™é‡Œæ˜¯çœŸæ­£æŠŠæœåŠ¡ç«¯è·‘èµ·æ¥çš„æ“ä½œ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸‹é¢æ˜¯æœåŠ¡ç«¯ä»£ç ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-go&quot;&gt;package main

import (
        &quot;gomicro-quickstart/grpc_demo/service&quot;
        &quot;google.golang.org/grpc&quot;
        &quot;log&quot;
        &quot;net&quot;
)

func main() {
        // 1. newä¸€ä¸ªgrpcçš„server
        rpcServer := grpc.NewServer()

        // 2. å°†åˆšåˆšæˆ‘ä»¬æ–°å»ºçš„ProdServiceæ³¨å†Œè¿›å»
        service.RegisterProdServiceServer(rpcServer, new(service.ProdService))

        // 3. æ–°å»ºä¸€ä¸ªlistenerï¼Œä»¥tcpæ–¹å¼ç›‘å¬8082ç«¯å£
        listener, err := net.Listen(&quot;tcp&quot;, &quot;:8082&quot;)
        if err != nil {
                log.Fatal(&quot;æœåŠ¡ç›‘å¬ç«¯å£å¤±è´¥&quot;, err)
        }

        // 4. è¿è¡ŒrpcServerï¼Œä¼ å…¥listener
        _ = rpcServer.Serve(listener)
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;æ’å‘&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å¦‚æœé‡è§ç±»ä¼¼&lt;code&gt;undefined: grpc.SupportPackageIsVersion6&lt;/code&gt;å’Œ&lt;code&gt;undefined: grpc.ClientConnInterface&lt;/code&gt;çš„é”™è¯¯ï¼Œå¯ä»¥ä¿®æ”¹go.modå°†grpcç‰ˆæœ¬æ”¹åˆ°1.27.0&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1ghn9v5g03mj30ni0aw0ua.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;hr/&gt;&lt;h2 id=&quot;6-åˆ›å»ºgrpcå®¢æˆ·ç«¯&quot;&gt;&lt;span id=&quot;head12&quot;&gt;6. åˆ›å»ºgRPCå®¢æˆ·ç«¯&lt;/span&gt;&lt;/h2&gt;
&lt;ul&gt;&lt;li&gt;æ–°å»ºä¸€ä¸ª&lt;code&gt;grpc_client&lt;/code&gt;æ–‡ä»¶å¤¹å­˜æ”¾å®¢æˆ·ç«¯ç›¸å…³çš„&lt;/li&gt;
&lt;li&gt;å¹¶åœ¨&lt;code&gt;grpc_client&lt;/code&gt;æ–‡ä»¶å¤¹ä¸‹å†æ–°å»ºä¸€ä¸ª&lt;code&gt;service&lt;/code&gt;æ–‡ä»¶å¤¹&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;61-æ‹·è´productpbgoåˆ°å®¢æˆ·ç«¯serviceæ–‡ä»¶å¤¹ä¸‹&quot;&gt;&lt;span id=&quot;head13&quot;&gt;6.1 æ‹·è´Product.pb.goåˆ°å®¢æˆ·ç«¯serviceæ–‡ä»¶å¤¹ä¸‹&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1ghna79yhtbj308g02owef.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;62-ç¼–å†™clientçš„mainå‡½æ•°&quot;&gt;&lt;span id=&quot;head14&quot;&gt;6.2 ç¼–å†™clientçš„mainå‡½æ•°&lt;/span&gt;&lt;/h3&gt;
&lt;pre&gt;
&lt;code class=&quot;language-go&quot;&gt;package main

import (
        &quot;context&quot;
        &quot;fmt&quot;
        &quot;gomicro-quickstart/grpc_client/service&quot;
        &quot;google.golang.org/grpc&quot;
        &quot;log&quot;
)

func main() {
        // 1. æ–°å»ºè¿æ¥ï¼Œç«¯å£æ˜¯æœåŠ¡ç«¯å¼€æ”¾çš„8082ç«¯å£
        // å¹¶ä¸”æ·»åŠ grpc.WithInsecure()ï¼Œä¸ç„¶æ²¡æœ‰è¯ä¹¦ä¼šæŠ¥é”™
        conn, err := grpc.Dial(&quot;:8082&quot;, grpc.WithInsecure())
        if err != nil {
                log.Fatal(err)
        }

        // é€€å‡ºæ—¶å…³é—­é“¾æ¥
        defer conn.Close()

        // 2. è°ƒç”¨Product.pb.goä¸­çš„NewProdServiceClientæ–¹æ³•
        productServiceClient := service.NewProdServiceClient(conn)

        // 3. ç›´æ¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨GetProductStockæ–¹æ³•
        resp, err := productServiceClient.GetProductStock(context.Background(), &amp;amp;service.ProductRequest{ProdId: 233})
        if err != nil {
                log.Fatal(&quot;è°ƒç”¨gRPCæ–¹æ³•é”™è¯¯: &quot;, err)
        }

        fmt.Println(&quot;è°ƒç”¨gRPCæ–¹æ³•æˆåŠŸï¼ŒProdStock = &quot;, resp.ProdStock)
}

&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;63-è¿è¡Œå¹¶æ˜¾ç¤ºç»“æœ&quot;&gt;&lt;span id=&quot;head15&quot;&gt;6.3 è¿è¡Œå¹¶æ˜¾ç¤ºç»“æœ&lt;/span&gt;&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;å…ˆæŠŠæœåŠ¡ç«¯è¿è¡Œèµ·æ¥&lt;/li&gt;
&lt;li&gt;å†æŠŠå®¢æˆ·ç«¯è¿è¡Œèµ·æ¥&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;ç„¶åå®¢æˆ·ç«¯è¾“å‡ºæ­£ç¡®çš„ç»“æœï¼Œç¬¬ä¸€ä¸ªgoçš„gRPCè°ƒç”¨è¿è¡ŒæˆåŠŸ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://tva1.sinaimg.cn/large/007S8ZIlgy1ghnalvrgw4j31c10pzgqu.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Tue, 11 Aug 2020 15:39:00 +0000</pubDate>
<dc:creator>å®æ ‘å‘</dc:creator>
<og:description>1. å‰è¨€ 2. gRPCä¸Protobufç®€ä»‹ 3. å®‰è£… 4. ä¸­é—´æ–‡ä»¶æ¼”ç¤º 4.1 ç¼–å†™ä¸­é—´æ–‡ä»¶ 4.2 è¿è¡Œprotocå‘½ä»¤ç¼–è¯‘æˆgoä¸­é—´æ–‡ä»¶ 5. åˆ›å»ºgRPCæœåŠ¡ç«¯ 5.1 æ–°å»ºProdu</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/baoshu/p/13488106.html</dc:identifier>
</item>
<item>
<title>.NETæˆ–.NET Core Web APiåŸºäºtusåè®®å®ç°æ–­ç‚¹ç»­ä¼  - Jeffcky</title>
<link>http://www.cnblogs.com/CreateMyself/p/13466457.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/CreateMyself/p/13466457.html</guid>
<description>&lt;h2&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;å‰ä¸¤å¤©æˆ‘é‡‡ç”¨æŠ€å·§å¼æ–¹æ¡ˆåŸºæœ¬å®ç°å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼Œè¿™é‡Œåªæ˜¯é‡ç‚¹åœ¨äºä¸ªäººæ€è·¯å’Œäº²èº«å®è·µï¼Œè‹¥åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒè¦æ±‚æ¯”è¾ƒé«˜çš„è¯è‚¯å®šä¸è¡Œï¼Œä»å­˜åœ¨ä¸€äº›é—®é¢˜éœ€è¦æ·±å…¥å¤„ç†ï¼Œæœ¬æ–‡ç»§ç»­åœ¨ä¹‹å‰åŸºç¡€ä¸Šç»™å‡ºåŸºäºtusåè®®çš„è½®å­æ–¹æ¡ˆï¼Œæœ¬æ‰“ç®—å†æ¬¡å°è¯•åˆ©ç”¨.NET Coreå®ç°æ­¤åè®®ï¼Œä½†åœ¨githubä¸Šä¸€æœç´¢æ—©åœ¨2016å¹´å°±å·²æœ‰æ­¤åè®®å¯¹åº”çš„.NETå’Œ.NET Coreæ–¹æ¡ˆï¼Œå¹¶ä¸”ä¸€ç›´æ›´æ–°åˆ°æœ€è¿‘çš„.NET Core 3.xç‰ˆæœ¬ï¼Œå®Œå…¨æ»¡è¶³å„ä½æ‰€éœ€ï¼Œæœ¬æ–‡æ˜¯æˆ‘å†™å‡ºçš„ä¸€ç‚¹demoã€‚&lt;/p&gt;
&lt;h2&gt;åŸºäºtusåè®®å®ç°æ–­ç‚¹ç»­ä¼ æ¼”ç¤º&lt;/h2&gt;
&lt;p&gt;Â &lt;img src=&quot;https://img2020.cnblogs.com/blog/589642/202008/589642-20200811232109725-1158285860.gif&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h2&gt;åŸºäºtusåè®®tusdotnetæ–¹æ¡ˆåŸºæœ¬demo&lt;/h2&gt;
&lt;p&gt;å…³äºæ­¤åè®®å®ç°åŸç†è¿™é‡Œä¸åšé˜è¿°ï¼Œè¯·å‚ç…§ä¸Šè¿°githubåœ°å€è‡ªè¡Œäº†è§£ï¼Œæœ¬æ–‡åªæ˜¯ç»™å‡º.NET Coreæ–¹æ¡ˆä¸‹çš„åŸºæœ¬demoï¼Œæˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªå¤§æ–‡ä»¶ç„¶åé€šè¿‡è¿›åº¦æ˜¾ç¤ºä¸Šä¼ è¿›åº¦ä»¥åŠå¯¹ä¸Šä¼ å¯æš‚åœå¯ç»§ç»­ï¼Œä¸“ä¸šç‚¹è®²å°±æ˜¯æ–­ç‚¹ç»­ä¼ ï¼Œé¦–å…ˆè‚¯å®šæ˜¯å¼•å…¥tusè„šæœ¬å’Œéœ€è¦ç”¨åˆ°çš„bootstrapæ ·å¼ï¼Œæˆ‘ä»¬å°†è¿›åº¦æ¡é»˜è®¤éšè—ï¼Œå½“ä¸Šä¼ æ—¶æ‰æ˜¾ç¤ºï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™å‡ºå¦‚ä¸‹HTMLã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;form-horizontal&quot;&lt;/span&gt;&lt;span&gt; style&lt;/span&gt;&lt;span&gt;=&quot;margin-top:80px;&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;form-group&quot;&lt;/span&gt;&lt;span&gt; id&lt;/span&gt;&lt;span&gt;=&quot;progress-group&quot;&lt;/span&gt;&lt;span&gt; style&lt;/span&gt;&lt;span&gt;=&quot;display:none;&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;id&lt;/span&gt;&lt;span&gt;=&quot;size&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;progress&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;id&lt;/span&gt;&lt;span&gt;=&quot;progress&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;progress-bar progress-bar-success progress-bar-animated progress-bar-striped&quot;&lt;/span&gt;&lt;span&gt; role&lt;/span&gt;&lt;span&gt;=&quot;progressbar&quot;&lt;/span&gt;&lt;span&gt;
                 aria-valuemin&lt;/span&gt;&lt;span&gt;=&quot;0&quot;&lt;/span&gt;&lt;span&gt; aria-valuemax&lt;/span&gt;&lt;span&gt;=&quot;100&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
                &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;span &lt;/span&gt;&lt;span&gt;id&lt;/span&gt;&lt;span&gt;=&quot;percentage&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;span&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;form-group&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;col-md-10&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;input &lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;=&quot;file&quot;&lt;/span&gt;&lt;span&gt; id&lt;/span&gt;&lt;span&gt;=&quot;file&quot;&lt;/span&gt;&lt;span&gt; type&lt;/span&gt;&lt;span&gt;=&quot;file&quot;&lt;/span&gt; &lt;span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;form-group&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;div &lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;=&quot;col-md-offset-2 col-md-10&quot;&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;input &lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;=&quot;submit&quot;&lt;/span&gt;&lt;span&gt; id&lt;/span&gt;&lt;span&gt;=&quot;submit&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;ä¸Šä¼ &quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;btn btn-success&quot;&lt;/span&gt; &lt;span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;input &lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;=&quot;button&quot;&lt;/span&gt;&lt;span&gt; id&lt;/span&gt;&lt;span&gt;=&quot;pause&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;æš‚åœ&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;btn btn-danger&quot;&lt;/span&gt; &lt;span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;input &lt;/span&gt;&lt;span&gt;type&lt;/span&gt;&lt;span&gt;=&quot;button&quot;&lt;/span&gt;&lt;span&gt; id&lt;/span&gt;&lt;span&gt;=&quot;continue&quot;&lt;/span&gt;&lt;span&gt; value&lt;/span&gt;&lt;span&gt;=&quot;ç»§ç»­&quot;&lt;/span&gt;&lt;span&gt; class&lt;/span&gt;&lt;span&gt;=&quot;btn btn-info&quot;&lt;/span&gt; &lt;span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
    &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;div&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/589642/202008/589642-20200811222352317-1894875198.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥å°±æ˜¯ä½¿ç”¨å¼•å…¥çš„tusè„šæœ¬ï¼Œä¹Ÿæ²¡ä»€ä¹ˆå¤ªå¤šè¦è®²è§£çš„ï¼Œç›´æ¥ä¸Šä»£ç ï¼Œè¿™é‡Œç¨å¾®æ³¨æ„çš„æ˜¯åœ¨å¦‚ä¸‹å…ƒæ•°æ®ï¼ˆmetadataï¼‰å±æ€§å¯¹è±¡å®šä¹‰ç»™å‡ºå®é™…æ–‡ä»¶åï¼Œä¾¿äºåœ¨åå°æœ€ç»ˆå°†ä¸Šä¼ çš„æ–‡ä»¶è½¬æ¢ä¸ºç›®æ ‡æ–‡ä»¶ï¼Œè‡³å°‘å¾—çŸ¥é“æ–‡ä»¶æ‰©å±•åï¼Œå¯¹å§ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&amp;lt;script type=&quot;text/javascript&quot;&amp;gt;&lt;span&gt;
    $(&lt;/span&gt;&lt;span&gt;function&lt;/span&gt;&lt;span&gt; () {
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt;&lt;span&gt; upload;

        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¸Šä¼ &lt;/span&gt;
        $('#submit').click(&lt;span&gt;function&lt;/span&gt;&lt;span&gt; () {

            $(&lt;/span&gt;'#progress-group'&lt;span&gt;).show();

            &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; file = $('#file')[0].files[0&lt;span&gt;];

            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆ›å»ºtusä¸Šä¼ å¯¹è±¡&lt;/span&gt;
            upload = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; tus.Upload(file, {
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ–‡ä»¶æœåŠ¡å™¨ä¸Šä¼ ç»ˆç»“ç‚¹åœ°å€è®¾ç½®&lt;/span&gt;
                endpoint: &quot;files/&quot;&lt;span&gt;,
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; é‡è¯•å»¶è¿Ÿè®¾ç½®&lt;/span&gt;
                retryDelays: [0, 3000, 5000, 10000, 20000&lt;span&gt;],
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; é™„ä»¶æœåŠ¡å™¨æ‰€éœ€çš„å…ƒæ•°æ®&lt;/span&gt;
&lt;span&gt;                metadata: {
                    name: file.name,
                    contentType: file.type &lt;/span&gt;|| 'application/octet-stream'&lt;span&gt;,
                    emptyMetaKey: &lt;/span&gt;''&lt;span&gt;
                },
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å›è°ƒæ— æ³•é€šè¿‡é‡è¯•è§£å†³çš„é”™è¯¯&lt;/span&gt;
                onError: &lt;span&gt;function&lt;/span&gt;&lt;span&gt; (error) {
                    console.log(&lt;/span&gt;&quot;Failed because: &quot; +&lt;span&gt; error)
                },
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¸Šä¼ è¿›åº¦å›è°ƒ&lt;/span&gt;
&lt;span&gt;                onProgress: onProgress,
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¸Šä¼ å®Œæˆåå›è°ƒ&lt;/span&gt;
                onSuccess: &lt;span&gt;function&lt;/span&gt;&lt;span&gt; () {
                    console.log(&lt;/span&gt;&quot;Download %s from %s&quot;&lt;span&gt;, upload.file.name, upload.url)
                }
            })

            upload.start()
        });

        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æš‚åœ&lt;/span&gt;
        $('#pause').click(&lt;span&gt;function&lt;/span&gt;&lt;span&gt; () {
            upload.abort()
        });

        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç»§ç»­&lt;/span&gt;
        $('#continue').click(&lt;span&gt;function&lt;/span&gt;&lt;span&gt; () {
            upload.start()
        });

        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¸Šä¼ è¿›åº¦å±•ç¤º&lt;/span&gt;
        &lt;span&gt;function&lt;/span&gt;&lt;span&gt; onProgress(bytesUploaded, bytesTotal) {
            &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; percentage = (bytesUploaded / bytesTotal * 100).toFixed(2&lt;span&gt;);
            $(&lt;/span&gt;'#progress').attr('aria-valuenow'&lt;span&gt;, percentage);
            $(&lt;/span&gt;'#progress').css('width', percentage + '%'&lt;span&gt;);

            $(&lt;/span&gt;'#percentage').html(percentage + '%'&lt;span&gt;);

            &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; uploadBytes =&lt;span&gt; byteToSize(bytesUploaded);
            &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; totalBytes =&lt;span&gt; byteToSize(bytesTotal);

            $(&lt;/span&gt;'#size').html(uploadBytes + '/' +&lt;span&gt; totalBytes);
        }

        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°†å­—èŠ‚è½¬æ¢ä¸ºByteã€KBã€MBç­‰&lt;/span&gt;
        &lt;span&gt;function&lt;/span&gt; byteToSize(bytes, separator = '', postFix = ''&lt;span&gt;) {
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; (bytes) {
                const sizes &lt;/span&gt;= ['Bytes', 'KB', 'MB', 'GB', 'TB'&lt;span&gt;];
                const i &lt;/span&gt;= Math.min(parseInt(Math.floor(Math.log(bytes) / Math.log(1024)).toString(), 10), sizes.length - 1&lt;span&gt;);
                &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; `${(bytes / (1024 ** i)).toFixed(i ? 1 : 0&lt;span&gt;)}${separator}${sizes[i]}${postFix}`;
            }
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; 'n/a'&lt;span&gt;;
        }
    });

&lt;/span&gt;&amp;lt;/script&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ¥ä¸‹æ¥è¿›å…¥åå°ï¼Œé¦–å…ˆå®‰è£…å¯¹åº”tusåè®®å®ç°åŒ…ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/589642/202008/589642-20200811223327609-243814895.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥åˆ™æ˜¯æ·»åŠ tusä¸­é—´ä»¶ï¼Œè¯´ç™½äº†å°±æ˜¯å¯¹tusçš„é…ç½®ï¼Œå„ç§é…ç½®éƒ½å¯æ»¡è¶³ä½ æ‰€éœ€ï¼Œè¿™é‡Œæˆ‘åªå®ç°äº†æ–‡ä»¶ä¸Šä¼ å®Œæˆåå°†ä¸Šä¼ æ–‡ä»¶è½¬æ¢ä¸ºç›®æ ‡æ–‡ä»¶çš„å¤„ç†ï¼Œç´§æ¥ç€å°†å¦‚ä¸‹å®ç°tusé…ç½®ä»¥å•ä¾‹å½¢å¼æ³¨å…¥å³å¯&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;43&quot;&gt;
&lt;pre&gt;
&lt;span&gt;private&lt;/span&gt;&lt;span&gt; DefaultTusConfiguration CreateTusConfiguration(IServiceProvider serviceProvider)
{
    &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; env = (IWebHostEnvironment)serviceProvider.GetRequiredService(&lt;span&gt;typeof&lt;/span&gt;&lt;span&gt;(IWebHostEnvironment));

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ–‡ä»¶ä¸Šä¼ è·¯å¾„&lt;/span&gt;
    &lt;span&gt;var&lt;/span&gt; tusFiles = Path.Combine(env.WebRootPath, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;tusfiles&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);

    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; DefaultTusConfiguration
    {
        UrlPath &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;/files&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ–‡ä»¶å­˜å‚¨è·¯å¾„&lt;/span&gt;
        Store = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; TusDiskStore(tusFiles),
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å…ƒæ•°æ®æ˜¯å¦å…è®¸ç©ºå€¼&lt;/span&gt;
        MetadataParsingStrategy =&lt;span&gt; MetadataParsingStrategy.AllowEmptyValues,
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ–‡ä»¶è¿‡æœŸåä¸å†æ›´æ–°&lt;/span&gt;
        Expiration = &lt;span&gt;new&lt;/span&gt; AbsoluteExpiration(TimeSpan.FromMinutes(&lt;span&gt;5&lt;/span&gt;&lt;span&gt;)),
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;äº‹ä»¶å¤„ç†ï¼ˆå„ç§äº‹ä»¶ï¼Œæ»¡è¶³ä½ æ‰€éœ€ï¼‰&lt;/span&gt;
        Events = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Events
        {
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¸Šä¼ å®Œæˆäº‹ä»¶å›è°ƒ&lt;/span&gt;
            OnFileCompleteAsync = &lt;span&gt;async&lt;/span&gt; ctx =&amp;gt;&lt;span&gt;
            {
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å–ä¸Šä¼ æ–‡ä»¶&lt;/span&gt;
                &lt;span&gt;var&lt;/span&gt; file = &lt;span&gt;await&lt;/span&gt;&lt;span&gt; ctx.GetFileAsync();

                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å–ä¸Šä¼ æ–‡ä»¶å…ƒæ•°æ®&lt;/span&gt;
                &lt;span&gt;var&lt;/span&gt; metadatas = &lt;span&gt;await&lt;/span&gt;&lt;span&gt; file.GetMetadataAsync(ctx.CancellationToken);
                
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å–ä¸Šè¿°æ–‡ä»¶å…ƒæ•°æ®ä¸­çš„ç›®æ ‡æ–‡ä»¶åç§°&lt;/span&gt;
                &lt;span&gt;var&lt;/span&gt; fileNameMetadata = metadatas[&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;];

                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç›®æ ‡æ–‡ä»¶åä»¥base64ç¼–ç ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦è§£ç &lt;/span&gt;
                &lt;span&gt;var&lt;/span&gt; fileName =&lt;span&gt; fileNameMetadata.GetString(Encoding.UTF8);

                &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; extensionName =&lt;span&gt; Path.GetExtension(fileName);

                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°†ä¸Šä¼ æ–‡ä»¶è½¬æ¢ä¸ºå®é™…ç›®æ ‡æ–‡ä»¶&lt;/span&gt;
                File.Move(Path.Combine(tusFiles, ctx.FileId), Path.Combine(tusFiles, $&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;{ctx.FileId}{extensionName}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;));
            }
        }
    };
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç„¶åè·å–å¹¶ä½¿ç”¨ä¸Šè¿°æ·»åŠ çš„tusé…ç½®æœåŠ¡&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
app.UseTus(httpContext =&amp;gt; Task.FromResult(httpContext.RequestServices.GetService&amp;lt;DefaultTusConfiguration&amp;gt;()));
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;åœ¨è„šæœ¬ä¸­æˆ‘ä»¬çœ‹åˆ°æœ‰ä¸ªendpointå±æ€§ï¼Œæ­¤å±æ€§è¡¨ç¤ºä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ä¸Šä¼ ç»“ç‚¹åœ°å€ï¼Œå› ä¸ºåœ¨ä¸Šåˆ°æœåŠ¡å™¨æ—¶æˆ‘ä»¬å¯èƒ½éœ€å¯¹æ­¤è¯·æ±‚è¿›è¡Œé¢å¤–å¤„ç†ï¼Œæ¯”å¦‚å…ƒæ•°æ®ä¸­çš„æ–‡ä»¶åæ˜¯å¦å·²æä¾›ç­‰ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨ç»“ç‚¹æ˜ å°„æ—¶ï¼Œæ·»åŠ å¯¹ä¸Šè¿°ç»“ç‚¹åç§°çš„æ˜ å°„ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
endpoints.MapGet(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;/files/{fileId}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, DownloadFileEndpoint.HandleRoute);
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¯¥æ˜ å°„ç¬¬äºŒä¸ªå‚æ•°ä¸ºRequestDelegateï¼Œè¿™ä¸ªå‚æ•°ç”¨è¿‡.NET Coreçš„ç«¥é‹éƒ½çŸ¥é“ï¼Œè¿™é‡Œæˆ‘æ˜¯ç›´æ¥æ‹·è´è¯¥åŒ…çš„è·¯ç”±å®ç°ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;43&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; DownloadFileEndpoint
{
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;async&lt;/span&gt;&lt;span&gt; Task HandleRoute(HttpContext context)
    {
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; config = context.RequestServices.GetRequiredService&amp;lt;DefaultTusConfiguration&amp;gt;&lt;span&gt;();

        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (!(config.Store &lt;span&gt;is&lt;/span&gt;&lt;span&gt; ITusReadableStore store))
        {
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt;;
        }

        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; fileId = (&lt;span&gt;string&lt;/span&gt;)context.Request.RouteValues[&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;fileId&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;];
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; file = &lt;span&gt;await&lt;/span&gt;&lt;span&gt; store.GetFileAsync(fileId, context.RequestAborted);

        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (file == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;)
        {
            context.Response.StatusCode &lt;/span&gt;= &lt;span&gt;404&lt;/span&gt;&lt;span&gt;;
            &lt;/span&gt;&lt;span&gt;await&lt;/span&gt; context.Response.WriteAsync($&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;File with id {fileId} was not found.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, context.RequestAborted);
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt;;
        }

        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; fileStream = &lt;span&gt;await&lt;/span&gt;&lt;span&gt; file.GetContentAsync(context.RequestAborted);
        &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; metadata = &lt;span&gt;await&lt;/span&gt;&lt;span&gt; file.GetMetadataAsync(context.RequestAborted);

        context.Response.ContentType &lt;/span&gt;=&lt;span&gt; GetContentTypeOrDefault(metadata);
        context.Response.ContentLength &lt;/span&gt;=&lt;span&gt; fileStream.Length;

        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (metadata.TryGetValue(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;name&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;out&lt;/span&gt; &lt;span&gt;var&lt;/span&gt;&lt;span&gt; nameMeta))
        {
            context.Response.Headers.Add(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Content-Disposition&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
                &lt;/span&gt;&lt;span&gt;new&lt;/span&gt;[] { $&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;attachment; filename=\&quot;{nameMeta.GetString(Encoding.UTF8)}\&quot;&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; });
        }

        &lt;/span&gt;&lt;span&gt;using&lt;/span&gt;&lt;span&gt; (fileStream)
        {
            &lt;/span&gt;&lt;span&gt;await&lt;/span&gt; fileStream.CopyToAsync(context.Response.Body, &lt;span&gt;81920&lt;/span&gt;&lt;span&gt;, context.RequestAborted);
        }
    }

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;string&lt;/span&gt; GetContentTypeOrDefault(Dictionary&amp;lt;&lt;span&gt;string&lt;/span&gt;, Metadata&amp;gt;&lt;span&gt; metadata)
    {
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (metadata.TryGetValue(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;contentType&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;out&lt;/span&gt; &lt;span&gt;var&lt;/span&gt;&lt;span&gt; contentType))
        {
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; contentType.GetString(Encoding.UTF8);
        }

        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;application/octet-stream&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶è¯´æ˜&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“æ— è®ºæ˜¯.NETè¿˜æ˜¯.NET Coreå¯¹äºæ–‡ä»¶ä¸Šä¼ å¤§å°éƒ½æœ‰é»˜è®¤é™åˆ¶å¤§å°ï¼Œè¿™é‡Œå¯¹.NET Coreä¸­æ–‡ä»¶å¤§å°å„ç§ç¯å¢ƒé…ç½®åšä¸€ä¸ªç»Ÿä¸€è¯´æ˜ï¼Œå¦‚æœä½ å°†.NET Coreå¯„å®¿åœ¨IISä¸Šè¿è¡Œï¼Œé‚£ä¹ˆè¯·ä¿®æ”¹web.configé…ç½®æ–‡ä»¶å¤§å°é™åˆ¶&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&amp;lt;system.webServer&amp;gt;
  &amp;lt;security&amp;gt;
    &amp;lt;requestFiltering&amp;gt;
      &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è‹¥ä¸é…ç½®ï¼Œé»˜è®¤æ˜¯28.6å…†&lt;/span&gt;
      &amp;lt;requestLimits maxAllowedContentLength=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;1073741824&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; /&amp;gt;
    &amp;lt;/requestFiltering&amp;gt;
  &amp;lt;/security&amp;gt;
&amp;lt;/system.webServer&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æœåœ¨å¼€å‘ç¯å¢ƒé»˜è®¤ä½¿ç”¨IISè¿è¡Œåº”ç”¨ç¨‹åºï¼Œè¯·é€šè¿‡å¦‚ä¸‹æ ¹æ®å®é™…æƒ…å†µé…ç½®æ–‡ä»¶ä¸Šä¼ å¤§å°&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
services.Configure&amp;lt;IISServerOptions&amp;gt;(options =&amp;gt;&lt;span&gt;
 {
      options.MaxRequestBodySize &lt;/span&gt;= &lt;span&gt;int&lt;/span&gt;&lt;span&gt;.MaxValue;
 });&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æœç¨‹åºè¿è¡Œåœ¨KestrelæœåŠ¡å™¨ï¼Œé‚£ä¹ˆè¯·é€šè¿‡å¦‚ä¸‹æ ¹æ®å®é™…æƒ…å†µé…ç½®æ–‡ä»¶ä¸Šä¼ å¤§å°&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
services.Configure&amp;lt;KestrelServerOptions&amp;gt;(options =&amp;gt;&lt;span&gt;
{
     &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è‹¥ä¸é…ç½®ï¼Œé»˜è®¤æ˜¯30å…†ï¼ˆæ²¡è®°é”™çš„è¯ï¼‰&lt;/span&gt;
     options.Limits.MaxRequestBodySize = &lt;span&gt;int&lt;/span&gt;&lt;span&gt;.MaxValue; 
});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æœæ˜¯é€šè¿‡è¡¨å•ä¸Šä¼ æ–‡ä»¶ï¼Œé‚£ä¹ˆè¯·é€šè¿‡å¦‚ä¸‹æ ¹æ®å®é™…æƒ…å†µé…ç½®æ–‡ä»¶ä¸Šä¼ å¤§å°&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
services.Configure&amp;lt;FormOptions&amp;gt;(x =&amp;gt;&lt;span&gt;
{
     x.ValueLengthLimit &lt;/span&gt;= &lt;span&gt;int&lt;/span&gt;&lt;span&gt;.MaxValue;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¦‚æœä¸é…ç½®ï¼Œé»˜è®¤æ˜¯128å…†ï¼ˆæ²¡è®°é”™çš„è¯ï¼‰&lt;/span&gt;
     x.MultipartBodyLengthLimit = &lt;span&gt;int&lt;/span&gt;&lt;span&gt;.MaxValue; 
     x.MultipartHeadersLengthLimit &lt;/span&gt;= &lt;span&gt;int&lt;/span&gt;&lt;span&gt;.MaxValue;
});&lt;/span&gt; 
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;æ€»ç»“Â &lt;/h2&gt;
&lt;p&gt;ä¸ºäº†æ›´å¥½ä½“éªŒå¯ä»¥å†åŠ ä¸Šå½“å‰ç½‘ç»œå®½å¸¦æƒ…å†µæˆ–å‰©ä½™å¤šå°‘åˆ†é’Ÿï¼Œæ›´è¯¦ç»†å†…å®¹è¯·å‚è€ƒï¼š&lt;a title=&quot;https://github.com/tusdotnet/tusdotnet&quot; href=&quot;https://github.com/tusdotnet/tusdotnet&quot; target=&quot;_blank&quot;&gt;https://github.com/tusdotnet/tusdotnetÂ &lt;/a&gt;ã€&lt;a title=&quot;https://github.com/tus/tus-js-client&quot; href=&quot;https://github.com/tus/tus-js-client&quot; target=&quot;_blank&quot;&gt;https://github.com/tus/tus-js-client&lt;/a&gt;ï¼Œå…³äºå¤§æ–‡ä»¶ä¸Šä¼ å¤„ç†åˆ°æ­¤ç»“æŸï¼Œå¸Œæœ›å¯¹é‚£äº›è‹¦è‹¦å¯»æ‰¾æœ€ç»ˆè§£å†³æ–¹æ¡ˆè€Œæ— åŠ©çš„ç«¥é‹ä»¬æä¾›æœ€ä½³è½®å­ï¼Œè°¢è°¢ã€‚&lt;/p&gt;
</description>
<pubDate>Tue, 11 Aug 2020 15:38:00 +0000</pubDate>
<dc:creator>Jeffcky</dc:creator>
<og:description>å‰è¨€ å‰ä¸¤å¤©æˆ‘é‡‡ç”¨æŠ€å·§å¼æ–¹æ¡ˆåŸºæœ¬å®ç°å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼Œè¿™é‡Œåªæ˜¯é‡ç‚¹åœ¨äºä¸ªäººæ€è·¯å’Œäº²èº«å®è·µï¼Œè‹¥åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒè¦æ±‚æ¯”è¾ƒé«˜çš„è¯è‚¯å®šä¸è¡Œï¼Œä»å­˜åœ¨ä¸€äº›é—®é¢˜éœ€è¦æ·±å…¥å¤„ç†ï¼Œæœ¬æ–‡ç»§ç»­åœ¨ä¹‹å‰åŸºç¡€ä¸Šç»™å‡ºåŸºäºtusåè®®çš„è½®å­</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/CreateMyself/p/13466457.html</dc:identifier>
</item>
</channel>
</rss>