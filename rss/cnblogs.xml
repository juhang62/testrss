<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>åšå®¢å›­_é¦–é¡µ</title>
<link></link>
<description>ä»£ç æ”¹å˜ä¸–ç•Œ</description>
<item>
<title>æ·±åº¦å­¦ä¹ åœ¨æ¨èç³»ç»Ÿçš„åº”ç”¨(äºŒ) - æ··æ²Œæˆ˜ç¥é˜¿ç‘æ–¯</title>
<link>http://www.cnblogs.com/arachis/p/DL4REC2.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/arachis/p/DL4REC2.html</guid>
<description>&lt;h3 id=&quot;afmæ¨¡å‹attentional-factorization-machine&quot;&gt;AFMæ¨¡å‹(Attentional Factorization Machine)&lt;/h3&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ Å·_{AFM}(x)=Ï‰_0+âˆ‘_{i=1}^{n}Ï‰_{i}x_{i}+p^Tâˆ‘^{n}_{i=1}âˆ‘^{n}_{j=i+1}a_{ij}(v_iâŠ™v_j)x_ix_j \]&lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;fwfmæ¨¡å‹field-weighted-factorization-machines&quot;&gt;FwFMæ¨¡å‹(Field-weighted Factorization Machines)&lt;/h3&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ Î¦_{FwFMs}((w,v), x) = w_{0} +âˆ‘_{i=1}^{m}x_iw_i +âˆ‘_{i=1}^{m}âˆ‘_{j=i+1}^{m}x_ix_jâŸ¨v_i,v_jâŸ©r_{F (i),F (j)} \]&lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;fwfmæ¨¡å‹field-weighted-factorization-machines-1&quot;&gt;FwFMæ¨¡å‹(Field-weighted Factorization Machines)&lt;/h3&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ Î¦_{FwFMs}((w,v), x) = w_{0} +âˆ‘_{i=1}^{m}x_iw_i +âˆ‘_{i=1}^{m}âˆ‘_{j=i+1}^{m}x_ix_jâŸ¨v_i,v_jâŸ©r_{F (i),F (j)} \]&lt;/span&gt;&lt;/p&gt;
&lt;ul readability=&quot;1.4017632241814&quot;&gt;&lt;li readability=&quot;4&quot;&gt;
&lt;p&gt;æ¨¡å‹ç‰¹ç‚¹&lt;br/&gt;FwFMæ˜¯åœ¨WWW'18ä¸Šç”±Oathå…¬å¸æå‡ºçš„ç‚¹å‡»ç‡é¢„ä¼°æ¨¡å‹ï¼Œé’ˆå¯¹FFMå‚æ•°é‡å¤§çš„ä¸è¶³æå‡ºäº†æ”¹è¿›å¹¶åœ¨è‘—åçš„å…¬å¼€æ•°æ®é›†Criteoä¸ŠéªŒè¯æœ‰æ•ˆã€‚ä»æ¨¡å‹å½¢å¼ä¸Šå¯ä»¥çœ‹å‡ºFwFMä¸FMåŒºåˆ«ä»…åœ¨äºFwFMç»™æ¯ä¸ªäºŒé˜¶äº¤å‰é¡¹å¼•å…¥äº†ä¸€ä¸ªå®æ•°weight:&lt;br/&gt;&lt;span class=&quot;math display&quot;&gt;\[ r_{F (i),F (j)} \]&lt;/span&gt;&lt;br/&gt;æ€»è®¡å¤šå‡ºm*(m-1)/2ä¸ªå‚æ•°,mæ˜¯fieldä¸ªæ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-0.31578947368421&quot;&gt;
&lt;p&gt;æ¨¡å‹æ¡ˆä¾‹&lt;br/&gt;&lt;a href=&quot;https://github.com/Tongzhenguo/Python-Project/blob/master/ctr_model/FwFM.py&quot;&gt;Tongzhenguo/Python-Project&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;xdeepfmææ·±å› å­åˆ†è§£æœºæ¨¡å‹&quot;&gt;xDeepFM(ææ·±å› å­åˆ†è§£æœºæ¨¡å‹)&lt;/h3&gt;
&lt;p&gt;1.CINç»“æ„:&lt;br/&gt;&lt;img src=&quot;https://yangxudong.github.io/xdeepfm/CIN.png&quot; alt=&quot;CINç»“æ„&quot;/&gt;&lt;/p&gt;
&lt;p&gt;2.çŸ©é˜µ&lt;span class=&quot;math display&quot;&gt;\[ğ‘‹^ğ‘˜\]&lt;/span&gt;ä¸­çš„ç¬¬â„è¡Œçš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š&lt;br/&gt;&lt;span class=&quot;math display&quot;&gt;\[ X_{h,*}^k = \sum_{i=1}^{H_{k-1}}\sum_{j=1}^m{W_{ij}^{k,h}(X_{i,*}^{k-1} \circ X_{j,*}^0)} \]&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Sat, 06 Apr 2019 15:16:00 +0000</pubDate>
<dc:creator>æ··æ²Œæˆ˜ç¥é˜¿ç‘æ–¯</dc:creator>
<og:description>### AFMæ¨¡å‹(Attentional Factorization Machine) ### FwFMæ¨¡å‹(Field-weighted Factorization Machines) #</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/arachis/p/DL4REC2.html</dc:identifier>
</item>
<item>
<title>çº¿ç¨‹æ± ä¼˜åŒ–ä¹‹å……åˆ†åˆ©ç”¨çº¿ç¨‹æ± èµ„æº - å°çœ¼å„¿</title>
<link>http://www.cnblogs.com/hujunzheng/p/10660479.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/hujunzheng/p/10660479.html</guid>
<description>&lt;h2&gt;ä¸€ã€å‰è¨€&lt;/h2&gt;
&lt;p&gt;ã€€ã€€æœ€è¿‘åšäº†ç”µå­å‘ç¥¨çš„éœ€æ±‚ï¼Œåˆ†çœå¼€ç¥¨æ¥å£å’Œå‘ç¥¨ä¸‹è½½æ¥å£éƒ½æœ‰ä¸€å®šçš„å»¶è¿Ÿã€‚ä¸ºäº†å®Œæˆå¼€ç¥¨åè‡ªåŠ¨å°†å‘ç¥¨æ’å…¥ç”¨æˆ·å¾®ä¿¡å¡åŒ…ï¼Œç›®å‰çš„è§£å†³æ–¹æ¡ˆæ˜¯åˆ©ç”¨çº¿ç¨‹æ± ï¼Œå°†å¼€ç¥¨åæ’å…¥å¡åŒ…çš„ä»»åŠ¡ï¼ˆè½®è¯¢åˆ†çœå‘ç¥¨æ¥å£ï¼Œç›´åˆ°è·å–åˆ°å‘ç¥¨ç›¸å…³ä¿¡æ¯æˆ–è€…è½®è¯¢æ¬¡æ•°ç”¨å®Œï¼Œå¦‚æœè·å–åˆ°å‘ç¥¨ä¿¡æ¯ï¼Œæ‰§è¡Œå‘ç¥¨æ’å…¥å¾®ä¿¡å¡åŒ…ï¼Œç»“æŸä»»åŠ¡ï¼‰æ”¾å…¥çº¿ç¨‹æ± å¼‚æ­¥æ‰§è¡Œã€‚ä»”ç»†æƒ³ä¸€æƒ³ï¼Œè¿™ç§å®ç°æ–¹æ¡ˆå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œçº¿ç¨‹æ± æ²¡æœ‰å……åˆ†çš„åˆ©ç”¨ã€‚ä¸ºä»€ä¹ˆæ²¡æœ‰å……åˆ†çš„åˆ©ç”¨ï¼Ÿä¸‹é¢è¯¦ç»†çš„åˆ†æã€‚&lt;/p&gt;
&lt;h2&gt;äºŒã€å¼‚æ­¥çº¿ç¨‹æ± å’Œå¼‚æ­¥ä»»åŠ¡åŒ…è£…&lt;/h2&gt;
&lt;p&gt;ã€€ã€€AsyncConfigurerSupportå¯ä»¥å¸®æˆ‘ä»¬æŒ‡å®šå¼‚æ­¥ä»»åŠ¡ï¼ˆæ³¨æœ‰@Asyncæ³¨è§£ï¼‰å¯¹åº”çš„çº¿ç¨‹æ± ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt;@Configuration
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; MyAsyncConfigurer &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; AsyncConfigurerSupport {
    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; Logger LOGGER = LoggerFactory.getLogger(MyAsyncConfigurer.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;);

    @Override
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; Executor getAsyncExecutor() {
        ThreadPoolTaskExecutor taskExecutor &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ThreadPoolTaskExecutor();
        taskExecutor.setCorePoolSize(&lt;/span&gt;2&lt;span&gt;);
        taskExecutor.setMaxPoolSize(&lt;/span&gt;4&lt;span&gt;);
        taskExecutor.setQueueCapacity(&lt;/span&gt;10&lt;span&gt;);
        taskExecutor.setRejectedExecutionHandler((runnable, executor) &lt;/span&gt;-&amp;gt; LOGGER.error(&quot;å¼‚æ­¥çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡...&quot; +&lt;span&gt; runnable));
        taskExecutor.setThreadFactory(&lt;/span&gt;&lt;span&gt;new&lt;/span&gt;&lt;span&gt; MyAsyncThreadFactory());
        taskExecutor.initialize();
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; taskExecutor;
    }

    &lt;/span&gt;&lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; MyAsyncThreadFactory &lt;span&gt;implements&lt;/span&gt;&lt;span&gt; ThreadFactory {
        &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; AtomicInteger poolNumber = &lt;span&gt;new&lt;/span&gt; AtomicInteger(1&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; ThreadGroup group;
        &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; AtomicInteger threadNumber = &lt;span&gt;new&lt;/span&gt; AtomicInteger(1&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; String namePrefix;

        MyAsyncThreadFactory() {
            SecurityManager s &lt;/span&gt;=&lt;span&gt; System.getSecurityManager();
            group &lt;/span&gt;= (s != &lt;span&gt;null&lt;/span&gt;) ?&lt;span&gt; s.getThreadGroup() :
                    Thread.currentThread().getThreadGroup();
            namePrefix &lt;/span&gt;= &quot;myasync-pool-&quot; +&lt;span&gt;
                    poolNumber.getAndIncrement() &lt;/span&gt;+
                    &quot;-thread-&quot;&lt;span&gt;;
        }

        @Override
        &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; Thread newThread(Runnable r) {
            Thread t &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Thread(group, r,
                    namePrefix &lt;/span&gt;+&lt;span&gt; threadNumber.getAndIncrement(),
                    &lt;/span&gt;0&lt;span&gt;);
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; (t.isDaemon())
                t.setDaemon(&lt;/span&gt;&lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (t.getPriority() !=&lt;span&gt; Thread.NORM_PRIORITY)
                t.setPriority(Thread.NORM_PRIORITY);
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; t;
        }
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€å¼‚æ­¥ä»»åŠ¡åŒ…è£…ï¼Œé™¤äº†å¼‚æ­¥ï¼Œè¿˜åŠ å…¥äº†retryåŠŸèƒ½ï¼Œå®ç°æŒ‡å®šæ¬¡æ•°çš„æ¥å£è½®è¯¢ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt;@Component
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; AsyncWrapped {
    &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; Logger LOGGER = LoggerFactory.getLogger(AsyncWrapped.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;);

    @Async
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; asyncProcess(Runnable runnable, Callback callback, Retry retry) {
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (retry == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
                retry &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt; Retry(1&lt;span&gt;);
            }
            retry.execute(ctx &lt;/span&gt;-&amp;gt;&lt;span&gt; {
                runnable.run();
                &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
            }, ctx &lt;/span&gt;-&amp;gt;&lt;span&gt; {
                &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (callback != &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
                    callback.call();
                }
                &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
            });
        } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
            LOGGER.error(&lt;/span&gt;&quot;å¼‚æ­¥è°ƒç”¨å¼‚å¸¸...&quot;&lt;span&gt;, e);
        }
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€ä¸šåŠ¡ä»£ç å¤§è‡´é€»è¾‘å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
asyncWrapped.asyncProcess(() -&amp;gt;&lt;span&gt; {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è°ƒç”¨åˆ†çœæ¥å£è·å–å‘ç¥¨ä¿¡æ¯
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¦‚æœå‘ç¥¨ä¿¡æ¯å¼‚å¸¸ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼ˆè¿›å…¥ä¸‹æ¬¡é‡è¯•ï¼‰
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¦åˆ™ï¼Œæ’å…¥ç”¨æˆ·å¾®ä¿¡å¡åŒ…&lt;/span&gt;
    }, () -&amp;gt;&lt;span&gt; {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è½®è¯¢æ¬¡æ•°ç”¨å°½ï¼Œç”¨æˆ·æ’å…¥å¡åŒ…å¤±è´¥&lt;/span&gt;
&lt;span&gt;    }
    , &lt;/span&gt;&lt;span&gt;new&lt;/span&gt; Retry(2, 1000&lt;span&gt;)
);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€è¿™é‡Œè¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆçº¿ç¨‹æ± æ²¡æœ‰å……åˆ†çš„åˆ©ç”¨ã€‚å¼‚æ­¥ä»»åŠ¡ä¸­åŒ…å«è½®è¯¢æ“ä½œï¼Œè½®è¯¢æœ‰ä¸€å®šçš„æ—¶é—´é—´éš”ï¼Œå¯¼è‡´åœ¨è¿™æ®µæ—¶é—´é—´éš”å†…ï¼Œçº¿ç¨‹ä¸€ç›´å¤„äºè¢«é—²ç½®çš„çŠ¶æ€ã€‚æ‰€ä»¥ä¸ºäº†èƒ½æ›´å¥½çš„åˆ©ç”¨çº¿ç¨‹æ± èµ„æºï¼Œæˆ‘ä»¬å¾—æƒ³åŠæ³•è§£å†³æ—¶é—´é—´éš”çš„é—®é¢˜ã€‚å‡å¦‚æœ‰ä¸ªå»¶è¿Ÿé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é‡Œæ”¾ç€æˆ‘ä»¬çš„å¼‚æ­¥ä»»åŠ¡ï¼ˆä¸åŒ…å«é‡è¯•æœºåˆ¶ï¼‰ï¼Œç„¶åå»¶è¿Ÿï¼ˆè½®è¯¢çš„æ—¶é—´é—´éš”ï¼‰ä¸€å®šæ—¶é—´ä¹‹åï¼Œå°†ä»»åŠ¡æ”¾å…¥çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åæ ¹æ®æ˜¯å¦éœ€è¦å†æ¬¡æ‰§è¡Œå†³å®šæ˜¯å¦å†æ¬¡æ”¾å…¥åˆ°å»¶è¿Ÿé˜Ÿåˆ—å»ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹éƒ½ä¸ä¼šé—²ç€ï¼Œè¾¾åˆ°äº†å……åˆ†åˆ©ç”¨çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;h2&gt;ä¸‰ã€å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± å’Œå®ç°è½®è¯¢æœºåˆ¶&lt;/h2&gt;
&lt;p&gt;ã€€ã€€@EnableScheduling å¸®åŠ©å¼€å¯@Scheduledæ³¨è§£è§£æã€‚æ³¨å†Œä¸€ä¸ªåå­—æ˜¯ScheduledAnnotationBeanPostProcessor.DEFAULT_TASK_SCHEDULER_BEAN_NAMEçš„å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt;@Configuration
@EnableScheduling
@Role(BeanDefinition.ROLE_INFRASTRUCTURE)
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; TaskConfiguration {

    @Bean(name &lt;/span&gt;=&lt;span&gt; ScheduledAnnotationBeanPostProcessor.DEFAULT_TASK_SCHEDULER_BEAN_NAME)
    @Role(BeanDefinition.ROLE_INFRASTRUCTURE)
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; ScheduledExecutorService scheduledAnnotationProcessor() {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; Executors.newScheduledThreadPool(5, &lt;span&gt;new&lt;/span&gt;&lt;span&gt; DefaultThreadFactory());
    }

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; DefaultThreadFactory &lt;span&gt;implements&lt;/span&gt;&lt;span&gt; ThreadFactory {
        &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; AtomicInteger poolNumber = &lt;span&gt;new&lt;/span&gt; AtomicInteger(1&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; ThreadGroup group;
        &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; AtomicInteger threadNumber = &lt;span&gt;new&lt;/span&gt; AtomicInteger(1&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; String namePrefix;

        DefaultThreadFactory() {
            SecurityManager s &lt;/span&gt;=&lt;span&gt; System.getSecurityManager();
            group &lt;/span&gt;= (s != &lt;span&gt;null&lt;/span&gt;) ?&lt;span&gt; s.getThreadGroup() :
                    Thread.currentThread().getThreadGroup();
            namePrefix &lt;/span&gt;= &quot;pool-&quot; +&lt;span&gt;
                    poolNumber.getAndIncrement() &lt;/span&gt;+
                    &quot;-schedule-&quot;&lt;span&gt;;
        }

        @Override
        &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; Thread newThread(Runnable r) {
            Thread t &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Thread(group, r,
                    namePrefix &lt;/span&gt;+&lt;span&gt; threadNumber.getAndIncrement(),
                    &lt;/span&gt;0&lt;span&gt;);
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; (t.isDaemon()) {
                t.setDaemon(&lt;/span&gt;&lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
            }
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (t.getPriority() !=&lt;span&gt; Thread.NORM_PRIORITY) {
                t.setPriority(Thread.NORM_PRIORITY);
            }
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; t;
        }
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Â ã€€ã€€å®ç°è½®è¯¢ä»»åŠ¡ï¼Œå®ç°æ¥å£SchedulingConfigurerï¼Œè·å–ScheduledTaskRegistrar å¹¶æŒ‡å®šå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;@Override
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; configureTasks(ScheduledTaskRegistrar registrar) {
    &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.registrar =&lt;span&gt; registrar;
    &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.registrar.setScheduler(&lt;span&gt;this&lt;/span&gt;.applicationContext.getBean(DEFAULT_TASK_SCHEDULER_BEAN_NAME, ScheduledExecutorService.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;));
    scheduledTaskRegistrarHelper &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ScheduledTaskRegistrarHelper();
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€scheduledFuturesæäº¤å®šæ—¶ä»»åŠ¡æ—¶è¿”å›ç»“æœé›†ï¼ŒperiodTasks å®šæ—¶ä»»åŠ¡ç»“æœé›†ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; ConcurrentHashMap&amp;lt;String, ScheduledFuture&amp;lt;?&amp;gt;&amp;gt; scheduledFutures = &lt;span&gt;new&lt;/span&gt; ConcurrentHashMap&amp;lt;&amp;gt;&lt;span&gt;();
&lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; ConcurrentHashMap&amp;lt;String, TimingTask&amp;gt; periodTasks = &lt;span&gt;new&lt;/span&gt; ConcurrentHashMap&amp;lt;&amp;gt;();
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€å®šæ—¶ä»»åŠ¡åŒ…è£…ç±»ï¼ŒåŒ…å«ä»»åŠ¡çš„æ‰§è¡Œæ¬¡æ•°ï¼ˆé‡è¯•æ¬¡æ•°ï¼‰ã€é‡è¯•é—´éš”ã€å…·ä½“ä»»åŠ¡ã€é‡è¯•æ¬¡æ•°ç”¨å°½ä¹‹åçš„å›è°ƒç­‰ï¼Œä»¥åŠè‡ªåŠ¨ç»“æŸå®šæ—¶ä»»åŠ¡ã€é‡è¯•è®¡æ•°é‡ç½®åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;47&quot;&gt;
&lt;pre&gt;
&lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; TimingTask {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;é‡è¯•æ¬¡æ•°&lt;/span&gt;
    &lt;span&gt;private&lt;/span&gt;&lt;span&gt; Integer retry;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä»»åŠ¡æ ‡è¯†&lt;/span&gt;
    &lt;span&gt;private&lt;/span&gt;&lt;span&gt; String taskId;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;é‡è¯•é—´éš”&lt;/span&gt;
    &lt;span&gt;private&lt;/span&gt;&lt;span&gt; Long period;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å…·ä½“ä»»åŠ¡&lt;/span&gt;
    &lt;span&gt;private&lt;/span&gt;&lt;span&gt; ScheduledRunnable task;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç»“æŸå›è°ƒ&lt;/span&gt;
    &lt;span&gt;private&lt;/span&gt;&lt;span&gt; ScheduledCallback callback;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;é‡è¯•è®¡æ•°&lt;/span&gt;
    &lt;span&gt;private&lt;/span&gt; AtomicInteger count = &lt;span&gt;new&lt;/span&gt; AtomicInteger(0&lt;span&gt;);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;çˆ¶çº¿ç¨‹MDC&lt;/span&gt;
    &lt;span&gt;private&lt;/span&gt; Map&amp;lt;String, String&amp;gt;&lt;span&gt; curContext;

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; TimingTask(Integer retry, String taskId, Long period, ScheduledRunnable task, ScheduledCallback callback) {
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.retry =&lt;span&gt; retry;
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.taskId =&lt;span&gt; taskId;
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.period =&lt;span&gt; period;
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.task =&lt;span&gt; task;
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.callback =&lt;span&gt; callback;
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.curContext =&lt;span&gt; MDC.getCopyOfContextMap();
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; Long getPeriod() {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; period;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; setPeriod(Long period) {
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.period =&lt;span&gt; period;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; String getTaskId() {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; taskId;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; setTaskId(String taskId) {
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.taskId =&lt;span&gt; taskId;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; Integer getRetry() {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; retry;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; setRetry(Integer retry) {
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.retry =&lt;span&gt; retry;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; AtomicInteger getCount() {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; count;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; reset() {
        &lt;/span&gt;&lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; cnt = &lt;span&gt;this&lt;/span&gt;.count.intValue(); cnt &amp;lt; &lt;span&gt;this&lt;/span&gt;.retry; cnt = &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.count.intValue()) {
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (&lt;span&gt;this&lt;/span&gt;.count.compareAndSet(cnt, 0&lt;span&gt;)) {
                &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
            }
        }
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; process() {
        Map&lt;/span&gt;&amp;lt;String, String&amp;gt; preContext =&lt;span&gt; MDC.getCopyOfContextMap();
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (&lt;span&gt;this&lt;/span&gt;.curContext == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
                MDC.clear();
            } &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å°†çˆ¶çº¿ç¨‹çš„MDCå†…å®¹ä¼ ç»™å­çº¿ç¨‹&lt;/span&gt;
                MDC.setContextMap(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.curContext);
            }
            &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.task.run();
            exitTask(&lt;/span&gt;&lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
        } &lt;/span&gt;&lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
            LOGGER.error(&lt;/span&gt;&quot;å®šæ—¶ä»»åŠ¡å¼‚å¸¸...&quot; + &lt;span&gt;this&lt;/span&gt;&lt;span&gt;, e);
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (count.incrementAndGet() &amp;gt;= &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.retry) {
                exitTask(&lt;/span&gt;&lt;span&gt;true&lt;/span&gt;&lt;span&gt;);
            }
        } &lt;/span&gt;&lt;span&gt;finally&lt;/span&gt;&lt;span&gt; {
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (preContext == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
                MDC.clear();
            } &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
                MDC.setContextMap(preContext);
            }
        }
    }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å®šæ—¶ä»»åŠ¡é€€å‡º&lt;/span&gt;
    &lt;span&gt;private&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; exitTask(&lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; execCallback) {
        scheduledFutures.get(&lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.taskId).cancel(&lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
        scheduledFutures.remove(&lt;/span&gt;&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.getTaskId());
        periodTasks.remove(&lt;/span&gt;&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.getTaskId());
        LOGGER.info(&lt;/span&gt;&quot;ç»“æŸå®šæ—¶ä»»åŠ¡: &quot; + &lt;span&gt;this&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (execCallback &amp;amp;&amp;amp; callback != &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
            callback.call();
        }
    }

    @Override
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; String toString() {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; ReflectionToStringBuilder.toString(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;
                , ToStringStyle.JSON_STYLE
                , &lt;/span&gt;&lt;span&gt;false&lt;/span&gt;&lt;span&gt;
                , &lt;/span&gt;&lt;span&gt;false&lt;/span&gt;&lt;span&gt;
                , TimingTask.&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt;);
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æ³¨æ„ä¸Šé¢å®šæ—¶ä»»åŠ¡æ˜¯å¦‚ä½•é€€å‡ºçš„ï¼Œæ˜¯åœ¨æŸä¸€æ¬¡ä»»åŠ¡æ‰§è¡ŒæˆåŠŸä¹‹åï¼ˆæ²¡æœ‰å¼‚å¸¸æŠ›å‡ºï¼‰æˆ–è€…å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ¬¡æ•°ç”¨å°½æ‰é€€å‡ºçš„ã€‚ç›´æ¥è°ƒç”¨ScheduledFutureçš„cancelæ–¹æ³•å¯ä»¥é€€å‡ºå®šæ—¶ä»»åŠ¡ã€‚è¿˜æœ‰å°±æ˜¯å®šæ—¶ä»»åŠ¡ä¸­çš„æ—¥å¿—éœ€è¦çˆ¶çº¿ç¨‹ä¸­çš„æ—¥å¿—å˜é‡ï¼Œæ‰€ä»¥éœ€è¦å¯¹MDCè¿›è¡Œä¸€ä¸‹å¤„ç†ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
@Scope(&quot;prototype&quot;&lt;span&gt;)
@Bean
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; AspectTimingTask aspectTimingTask() {
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; AspectTimingTask();
}

@Aspect
@Component
&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; ScheduledAspect {
    @Around(&lt;/span&gt;&quot;target(AspectTimingTask)&quot;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; Object executeScheduledWrapped(ProceedingJoinPoint proceedingJoinPoint) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Throwable {
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (proceedingJoinPoint &lt;span&gt;instanceof&lt;/span&gt;&lt;span&gt; MethodInvocationProceedingJoinPoint) {
            MethodInvocationProceedingJoinPoint methodJoinPoint &lt;/span&gt;=&lt;span&gt; (MethodInvocationProceedingJoinPoint) proceedingJoinPoint;
            Method method &lt;/span&gt;=&lt;span&gt; ((MethodSignature) methodJoinPoint.getSignature()).getMethod();
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (AnnotatedElementUtils.isAnnotated(method, ScheduledTask.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)) {
                LOGGER.info(&lt;/span&gt;&quot;ç”µå­å‘ç¥¨å®šæ—¶ä»»åŠ¡æ—¥å¿—åŒæ­¥...&quot;&lt;span&gt;);
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å…¶ä»–å¤„ç†&lt;/span&gt;
&lt;span&gt;            }
        }
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; proceedingJoinPoint.proceed();
    }
}

&lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; AspectTimingTask &lt;span&gt;implements&lt;/span&gt;&lt;span&gt; Runnable {
    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt;&lt;span&gt; TimingTask timingTask;

    @Override
    @ScheduledTask
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; run() {
        timingTask.process();
    }

    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; setTimingTask(TimingTask timingTask) {
        &lt;/span&gt;&lt;span&gt;this&lt;/span&gt;.timingTask =&lt;span&gt; timingTask;
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€AspectTimingTask æ˜¯å¯¹TimingTask çš„åŒ…è£…ç±»ï¼Œå®ç°äº†Runnableæ¥å£ã€‚ä¸»è¦æ˜¯ä¸ºäº†å¯¹runæ¥å£åšä¸€å±‚åˆ‡é¢ï¼Œè·å–ProceedingJoinPoint å®ä¾‹ï¼ˆå…¬å¸ä¸­çš„æ—¥å¿—è°ƒç”¨é“¾ç³»ç»Ÿéœ€è¦è¿™ä¸ªå‚æ•°ï¼‰ã€‚AspectTimingTask çš„beanå®ä¾‹çš„scopeæ˜¯prototypeï¼Œè¿™ä¸ªæ³¨æ„ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;54&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; register(Integer retry
        , Long period
        , String taskId
        , ScheduledRunnable task
        , ScheduledCallback callback) {
    scheduledTaskRegistrarHelper.register(retry, taskId, period, task, callback);
}

&lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; ScheduledTaskRegistrarHelper {
    &lt;/span&gt;&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; register(Integer retry
            , String taskId
            , Long period
            , ScheduledRunnable task
            , ScheduledCallback callback) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ˜¯å¦å¯ä»¥é‡ç½®å®šæ—¶ä»»åŠ¡&lt;/span&gt;
        TimingTask preTask =&lt;span&gt; periodTasks.get(taskId);
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (&lt;span&gt;null&lt;/span&gt; !=&lt;span&gt; preTask
                &lt;/span&gt;&amp;amp;&amp;amp;&lt;span&gt; preTask.reset()
                &lt;/span&gt;&amp;amp;&amp;amp;&lt;span&gt; existTask(taskId)) {
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt;;
        }

        TimingTask curTask &lt;/span&gt;= &lt;span&gt;new&lt;/span&gt;&lt;span&gt; TimingTask(retry, taskId, period, task, callback);
        AspectTimingTask aspectTimingTask &lt;/span&gt;= applicationContext.getBean(AspectTimingTask.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;);
        aspectTimingTask.setTimingTask(curTask);
        ScheduledFuture&lt;/span&gt;&amp;lt;?&amp;gt; scheduledFuture =&lt;span&gt; registrar.getScheduler().scheduleAtFixedRate(aspectTimingTask, period);
        scheduledFutures.put(taskId, scheduledFuture);
        periodTasks.put(taskId, curTask);
        LOGGER.info(&lt;/span&gt;&quot;æ³¨å†Œå®šæ—¶ä»»åŠ¡: &quot; +&lt;span&gt; curTask);
    }

    &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; existTask(String taskId) {
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; scheduledFutures.containsKey(taskId) &amp;amp;&amp;amp;&lt;span&gt; periodTasks.containsKey(taskId);
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€å¦‚æœtaskIdçš„å®šæ—¶ä»»åŠ¡å·²ç»å­˜åœ¨åˆ™é‡ç½®å®šæ—¶ä»»åŠ¡ï¼Œå¦åˆ™æ³¨å†Œæ–°çš„å®šæ—¶ä»»åŠ¡ã€‚AspectTimingTask å®ä¾‹é€šè¿‡ApplicationContextè·å–ï¼Œæ¯æ¬¡è·å–éƒ½æ˜¯ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ç”± å¼‚æ­¥è½®è¯¢ä»»åŠ¡ ä¼˜åŒ–æˆ å®šæ—¶ä»»åŠ¡ï¼Œå……åˆ†åˆ©ç”¨äº†çº¿ç¨‹æ± ã€‚ä¿®æ”¹ä¹‹åçš„ä¸šåŠ¡ä»£ç å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
ScheduledTaskRegistrarHelper.register(10&lt;span&gt;
    , 5*&lt;/span&gt;1000L&lt;span&gt;
    , &lt;/span&gt;&quot;taskId&quot;&lt;span&gt;
    , () &lt;/span&gt;-&amp;gt;&lt;span&gt; {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è°ƒç”¨åˆ†çœæ¥å£è·å–å‘ç¥¨ä¿¡æ¯
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¦‚æœå‘ç¥¨ä¿¡æ¯å¼‚å¸¸ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼ˆè¿›å…¥ä¸‹æ¬¡é‡è¯•ï¼‰
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¦åˆ™ï¼Œæ’å…¥ç”¨æˆ·å¾®ä¿¡å¡åŒ…&lt;/span&gt;
&lt;span&gt;    }
    () &lt;/span&gt;-&amp;gt;&lt;span&gt; {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è½®è¯¢æ¬¡æ•°ç”¨å°½ï¼Œç”¨æˆ·æ’å…¥å¡åŒ…å¤±è´¥&lt;/span&gt;
&lt;span&gt;    }
);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€é’ˆå¯¹ç”µå­å‘ç¥¨æ’å…¥å¾®ä¿¡å¡åŒ…å®šæ—¶ä»»åŠ¡ï¼Œé‡è¯•æ‰§è¡Œæ¬¡æ•°10æ¬¡ï¼Œæ¯éš”5ç§’æ‰§è¡Œä¸€æ¬¡ã€‚ä»»åŠ¡å®Œæˆä¹‹åç»“æŸå®šæ—¶ä»»åŠ¡ï¼Œæ‰§è¡Œæ¬¡æ•°ç”¨å°½ä¹‹åè§¦å‘æ’å…¥å¡åŒ…å¤±è´¥åŠ¨ä½œã€‚&lt;/p&gt;
&lt;h2&gt;å››ã€å‚è€ƒã€€ã€€&lt;/h2&gt;
&lt;p&gt;&lt;span&gt;Â  Â  Â &lt;a id=&quot;homepage1_HomePageDays_DaysList_ctl00_DayList_TitleUrl_0&quot; class=&quot;postTitle2&quot; href=&quot;https://www.cnblogs.com/hujunzheng/p/10549849.html&quot;&gt;Springå¼‚æ­¥è°ƒç”¨åŸç†åŠSpringAopæ‹¦æˆªå™¨é“¾åŸç†&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Â  Â  Â &lt;a id=&quot;homepage1_HomePageDays_DaysList_ctl04_DayList_TitleUrl_0&quot; class=&quot;postTitle2&quot; href=&quot;https://www.cnblogs.com/hujunzheng/p/10353390.html&quot;&gt;Springbootå®šæ—¶ä»»åŠ¡åŸç†åŠå¦‚ä½•åŠ¨æ€åˆ›å»ºå®šæ—¶ä»»åŠ¡&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
</description>
<pubDate>Sat, 06 Apr 2019 15:08:00 +0000</pubDate>
<dc:creator>å°çœ¼å„¿</dc:creator>
<og:description>ä¸€ã€å‰è¨€ æœ€è¿‘åšäº†ç”µå­å‘ç¥¨çš„éœ€æ±‚ï¼Œåˆ†çœå¼€ç¥¨æ¥å£å’Œå‘ç¥¨ä¸‹è½½æ¥å£éƒ½æœ‰ä¸€å®šçš„å»¶è¿Ÿã€‚ä¸ºäº†å®Œæˆå¼€ç¥¨åè‡ªåŠ¨å°†å‘ç¥¨æ’å…¥ç”¨æˆ·å¾®ä¿¡å¡åŒ…ï¼Œç›®å‰çš„è§£å†³æ–¹æ¡ˆæ˜¯åˆ©ç”¨çº¿ç¨‹æ± ï¼Œå°†å¼€ç¥¨åæ’å…¥å¡åŒ…çš„ä»»åŠ¡ï¼ˆè½®è¯¢åˆ†çœå‘ç¥¨æ¥å£ï¼Œç›´åˆ°è·å–åˆ°å‘</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/hujunzheng/p/10660479.html</dc:identifier>
</item>
<item>
<title>SpringBootä¸­å¼‚æ­¥è¯·æ±‚å’Œå¼‚æ­¥è°ƒç”¨ï¼ˆçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼‰ - ä¼šç‚¼é’¢çš„å°ç™½é¾™</title>
<link>http://www.cnblogs.com/baixianlong/p/10661591.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/baixianlong/p/10661591.html</guid>
<description>&lt;h2 id=&quot;å¼‚æ­¥è¯·æ±‚ä¸åŒæ­¥è¯·æ±‚&quot;&gt;1ã€å¼‚æ­¥è¯·æ±‚ä¸åŒæ­¥è¯·æ±‚&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://github.com/xianlongbai/Static-Resources/blob/master/image/22906052.png?raw=true&quot; alt=&quot;åŒæ­¥è¯·æ±‚&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;https://github.com/xianlongbai/Static-Resources/blob/master/image/71641059.png?raw=true&quot; alt=&quot;å¼‚æ­¥è¯·æ±‚&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;ç‰¹ç‚¹&quot;&gt;ç‰¹ç‚¹ï¼š&lt;/h3&gt;
&lt;ul readability=&quot;6&quot;&gt;&lt;li readability=&quot;15&quot;&gt;
&lt;p&gt;å¯ä»¥å…ˆé‡Šæ”¾å®¹å™¨åˆ†é…ç»™è¯·æ±‚çš„çº¿ç¨‹ä¸ç›¸å…³èµ„æºï¼Œå‡è½»ç³»ç»Ÿè´Ÿæ‹…ï¼Œé‡Šæ”¾äº†å®¹å™¨æ‰€åˆ†é…çº¿ç¨‹çš„è¯·æ±‚ï¼Œå…¶å“åº”å°†è¢«å»¶åï¼Œå¯ä»¥åœ¨è€—æ—¶å¤„ç†å®Œæˆï¼ˆä¾‹å¦‚é•¿æ—¶é—´çš„è¿ç®—ï¼‰æ—¶å†å¯¹å®¢æˆ·ç«¯è¿›è¡Œå“åº”ã€‚&lt;span&gt;ä¸€å¥è¯ï¼šå¢åŠ äº†æœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„ååé‡&lt;/span&gt;ï¼ˆå®é™…ç”Ÿäº§ä¸Šæˆ‘ä»¬ç”¨çš„æ¯”è¾ƒå°‘ï¼Œå¦‚æœå¹¶å‘è¯·æ±‚é‡å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€šè¿‡nginxæŠŠè¯·æ±‚è´Ÿè½½åˆ°é›†ç¾¤æœåŠ¡çš„å„ä¸ªèŠ‚ç‚¹ä¸Šæ¥åˆ†æ‘Šè¯·æ±‚å‹åŠ›ï¼Œå½“ç„¶è¿˜å¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æ¥åšè¯·æ±‚çš„ç¼“å†²ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å¼‚æ­¥è¯·æ±‚çš„å®ç°&quot;&gt;2ã€å¼‚æ­¥è¯·æ±‚çš„å®ç°&lt;/h2&gt;
&lt;h3 id=&quot;æ–¹å¼ä¸€servletæ–¹å¼å®ç°å¼‚æ­¥è¯·æ±‚&quot;&gt;æ–¹å¼ä¸€ï¼šServletæ–¹å¼å®ç°å¼‚æ­¥è¯·æ±‚&lt;/h3&gt;
&lt;pre&gt;
&lt;code&gt;  @RequestMapping(value = &quot;/email/servletReq&quot;, method = GET)
  public void servletReq (HttpServletRequest request, HttpServletResponse response) {
      AsyncContext asyncContext = request.startAsync();
      //è®¾ç½®ç›‘å¬å™¨:å¯è®¾ç½®å…¶å¼€å§‹ã€å®Œæˆã€å¼‚å¸¸ã€è¶…æ—¶ç­‰äº‹ä»¶çš„å›è°ƒå¤„ç†
      asyncContext.addListener(new AsyncListener() {
          @Override
          public void onTimeout(AsyncEvent event) throws IOException {
              System.out.println(&quot;è¶…æ—¶äº†...&quot;);
              //åšä¸€äº›è¶…æ—¶åçš„ç›¸å…³æ“ä½œ...
          }
          @Override
          public void onStartAsync(AsyncEvent event) throws IOException {
              System.out.println(&quot;çº¿ç¨‹å¼€å§‹&quot;);
          }
          @Override
          public void onError(AsyncEvent event) throws IOException {
              System.out.println(&quot;å‘ç”Ÿé”™è¯¯ï¼š&quot;+event.getThrowable());
          }
          @Override
          public void onComplete(AsyncEvent event) throws IOException {
              System.out.println(&quot;æ‰§è¡Œå®Œæˆ&quot;);
              //è¿™é‡Œå¯ä»¥åšä¸€äº›æ¸…ç†èµ„æºçš„æ“ä½œ...
          }
      });
      //è®¾ç½®è¶…æ—¶æ—¶é—´
      asyncContext.setTimeout(20000);
      asyncContext.start(new Runnable() {
          @Override
          public void run() {
              try {
                  Thread.sleep(10000);
                  System.out.println(&quot;å†…éƒ¨çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName());
                  asyncContext.getResponse().setCharacterEncoding(&quot;utf-8&quot;);
                  asyncContext.getResponse().setContentType(&quot;text/html;charset=UTF-8&quot;);
                  asyncContext.getResponse().getWriter().println(&quot;è¿™æ˜¯å¼‚æ­¥çš„è¯·æ±‚è¿”å›&quot;);
              } catch (Exception e) {
                  System.out.println(&quot;å¼‚å¸¸ï¼š&quot;+e);
              }
              //å¼‚æ­¥è¯·æ±‚å®Œæˆé€šçŸ¥
              //æ­¤æ—¶æ•´ä¸ªè¯·æ±‚æ‰å®Œæˆ
              asyncContext.complete();
          }
      });
      //æ­¤æ—¶ä¹‹ç±» requestçš„çº¿ç¨‹è¿æ¥å·²ç»é‡Šæ”¾äº†
      System.out.println(&quot;ä¸»çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName());
  }&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;æ–¹å¼äºŒä½¿ç”¨å¾ˆç®€å•ç›´æ¥è¿”å›çš„å‚æ•°åŒ…è£¹ä¸€å±‚callableå³å¯å¯ä»¥ç»§æ‰¿webmvcconfigureradapterç±»æ¥è®¾ç½®é»˜è®¤çº¿ç¨‹æ± å’Œè¶…æ—¶å¤„ç†&quot;&gt;æ–¹å¼äºŒï¼šä½¿ç”¨å¾ˆç®€å•ï¼Œç›´æ¥è¿”å›çš„å‚æ•°åŒ…è£¹ä¸€å±‚callableå³å¯ï¼Œå¯ä»¥ç»§æ‰¿WebMvcConfigurerAdapterç±»æ¥è®¾ç½®é»˜è®¤çº¿ç¨‹æ± å’Œè¶…æ—¶å¤„ç†&lt;/h3&gt;
&lt;pre&gt;
&lt;code&gt;  @RequestMapping(value = &quot;/email/callableReq&quot;, method = GET)
  @ResponseBody
  public Callable&amp;lt;String&amp;gt; callableReq () {
      System.out.println(&quot;å¤–éƒ¨çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName());

      return new Callable&amp;lt;String&amp;gt;() {

          @Override
          public String call() throws Exception {
              Thread.sleep(10000);
              System.out.println(&quot;å†…éƒ¨çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName());
              return &quot;callable!&quot;;
          }
      };
  }

  @Configuration
  public class RequestAsyncPoolConfig extends WebMvcConfigurerAdapter {

  @Resource
  private ThreadPoolTaskExecutor myThreadPoolTaskExecutor;

  @Override
  public void configureAsyncSupport(final AsyncSupportConfigurer configurer) {
      //å¤„ç† callableè¶…æ—¶
      configurer.setDefaultTimeout(60*1000);
      configurer.setTaskExecutor(myThreadPoolTaskExecutor);
      configurer.registerCallableInterceptors(timeoutCallableProcessingInterceptor());
  }

  @Bean
  public TimeoutCallableProcessingInterceptor timeoutCallableProcessingInterceptor() {
      return new TimeoutCallableProcessingInterceptor();
  }&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;æ–¹å¼ä¸‰å’Œæ–¹å¼äºŒå·®ä¸å¤šåœ¨callableå¤–åŒ…ä¸€å±‚ç»™webasynctaskè®¾ç½®ä¸€ä¸ªè¶…æ—¶å›è°ƒå³å¯å®ç°è¶…æ—¶å¤„ç†&quot;&gt;æ–¹å¼ä¸‰ï¼šå’Œæ–¹å¼äºŒå·®ä¸å¤šï¼Œåœ¨Callableå¤–åŒ…ä¸€å±‚ï¼Œç»™WebAsyncTaskè®¾ç½®ä¸€ä¸ªè¶…æ—¶å›è°ƒï¼Œå³å¯å®ç°è¶…æ—¶å¤„ç†&lt;/h3&gt;
&lt;pre&gt;
&lt;code&gt;    @RequestMapping(value = &quot;/email/webAsyncReq&quot;, method = GET)
    @ResponseBody
    public WebAsyncTask&amp;lt;String&amp;gt; webAsyncReq () {
        System.out.println(&quot;å¤–éƒ¨çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName());
        Callable&amp;lt;String&amp;gt; result = () -&amp;gt; {
            System.out.println(&quot;å†…éƒ¨çº¿ç¨‹å¼€å§‹ï¼š&quot; + Thread.currentThread().getName());
            try {
                TimeUnit.SECONDS.sleep(4);
            } catch (Exception e) {
                // TODO: handle exception
            }
            logger.info(&quot;å‰¯çº¿ç¨‹è¿”å›&quot;);
            System.out.println(&quot;å†…éƒ¨çº¿ç¨‹è¿”å›ï¼š&quot; + Thread.currentThread().getName());
            return &quot;success&quot;;
        };
        WebAsyncTask&amp;lt;String&amp;gt; wat = new WebAsyncTask&amp;lt;String&amp;gt;(3000L, result);
        wat.onTimeout(new Callable&amp;lt;String&amp;gt;() {

            @Override
            public String call() throws Exception {
                // TODO Auto-generated method stub
                return &quot;è¶…æ—¶&quot;;
            }
        });
        return wat;
    }&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;æ–¹å¼å››deferredresultå¯ä»¥å¤„ç†ä¸€äº›ç›¸å¯¹å¤æ‚ä¸€äº›çš„ä¸šåŠ¡é€»è¾‘æœ€ä¸»è¦è¿˜æ˜¯å¯ä»¥åœ¨å¦ä¸€ä¸ªçº¿ç¨‹é‡Œé¢è¿›è¡Œä¸šåŠ¡å¤„ç†åŠè¿”å›å³å¯åœ¨ä¸¤ä¸ªå®Œå…¨ä¸ç›¸å¹²çš„çº¿ç¨‹é—´çš„é€šä¿¡&quot;&gt;æ–¹å¼å››ï¼šDeferredResultå¯ä»¥å¤„ç†ä¸€äº›ç›¸å¯¹å¤æ‚ä¸€äº›çš„ä¸šåŠ¡é€»è¾‘ï¼Œæœ€ä¸»è¦è¿˜æ˜¯å¯ä»¥åœ¨å¦ä¸€ä¸ªçº¿ç¨‹é‡Œé¢è¿›è¡Œä¸šåŠ¡å¤„ç†åŠè¿”å›ï¼Œå³å¯åœ¨ä¸¤ä¸ªå®Œå…¨ä¸ç›¸å¹²çš„çº¿ç¨‹é—´çš„é€šä¿¡ã€‚&lt;/h3&gt;
&lt;pre&gt;
&lt;code&gt;@RequestMapping(value = &quot;/email/deferredResultReq&quot;, method = GET)
    @ResponseBody
    public DeferredResult&amp;lt;String&amp;gt; deferredResultReq () {
        System.out.println(&quot;å¤–éƒ¨çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName());
        //è®¾ç½®è¶…æ—¶æ—¶é—´
        DeferredResult&amp;lt;String&amp;gt; result = new DeferredResult&amp;lt;String&amp;gt;(60*1000L);
        //å¤„ç†è¶…æ—¶äº‹ä»¶ é‡‡ç”¨å§”æ‰˜æœºåˆ¶
        result.onTimeout(new Runnable() {

            @Override
            public void run() {
                System.out.println(&quot;DeferredResultè¶…æ—¶&quot;);
                result.setResult(&quot;è¶…æ—¶äº†!&quot;);
            }
        });
        result.onCompletion(new Runnable() {

            @Override
            public void run() {
                //å®Œæˆå
                System.out.println(&quot;è°ƒç”¨å®Œæˆ&quot;);
            }
        });
        myThreadPoolTaskExecutor.execute(new Runnable() {

            @Override
            public void run() {
                //å¤„ç†ä¸šåŠ¡é€»è¾‘
                System.out.println(&quot;å†…éƒ¨çº¿ç¨‹ï¼š&quot; + Thread.currentThread().getName());
                //è¿”å›ç»“æœ
                result.setResult(&quot;DeferredResult!!&quot;);
            }
        });
       return result;
    }&lt;/code&gt;
&lt;/pre&gt;

&lt;h2 id=&quot;ä»‹ç»&quot;&gt;1ã€ä»‹ç»&lt;/h2&gt;
&lt;blockquote readability=&quot;5.5&quot;&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;å¼‚æ­¥è¯·æ±‚çš„å¤„ç†ã€‚é™¤äº†å¼‚æ­¥è¯·æ±‚ï¼Œä¸€èˆ¬ä¸Šæˆ‘ä»¬ç”¨çš„æ¯”è¾ƒå¤šçš„åº”è¯¥æ˜¯å¼‚æ­¥è°ƒç”¨ã€‚é€šå¸¸åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¼šé‡åˆ°ä¸€ä¸ªæ–¹æ³•æ˜¯å’Œå®é™…ä¸šåŠ¡æ— å…³çš„ï¼Œæ²¡æœ‰ç´§å¯†æ€§çš„ã€‚æ¯”å¦‚è®°å½•æ—¥å¿—ä¿¡æ¯ç­‰ä¸šåŠ¡ã€‚è¿™ä¸ªæ—¶å€™æ­£å¸¸å°±æ˜¯å¯ä¸€ä¸ªæ–°çº¿ç¨‹å»åšä¸€äº›ä¸šåŠ¡å¤„ç†ï¼Œè®©ä¸»çº¿ç¨‹å¼‚æ­¥çš„æ‰§è¡Œå…¶ä»–ä¸šåŠ¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ä½¿ç”¨æ–¹å¼åŸºäºspringä¸‹&quot;&gt;2ã€ä½¿ç”¨æ–¹å¼ï¼ˆåŸºäºspringä¸‹ï¼‰&lt;/h2&gt;
&lt;ul readability=&quot;0.5&quot;&gt;&lt;li&gt;éœ€è¦åœ¨å¯åŠ¨ç±»åŠ å…¥@EnableAsyncä½¿å¼‚æ­¥è°ƒç”¨@Asyncæ³¨è§£ç”Ÿæ•ˆ&lt;/li&gt;
&lt;li&gt;åœ¨éœ€è¦å¼‚æ­¥æ‰§è¡Œçš„æ–¹æ³•ä¸ŠåŠ å…¥æ­¤æ³¨è§£å³å¯@Async(&quot;threadPool&quot;),threadPoolä¸ºè‡ªå®šä¹‰çº¿ç¨‹æ± &lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;ä»£ç ç•¥ã€‚ã€‚ã€‚å°±ä¿©æ ‡ç­¾ï¼Œè‡ªå·±è¯•ä¸€æŠŠå°±å¯ä»¥äº†&lt;/p&gt;
&lt;h2 id=&quot;æ³¨æ„äº‹é¡¹&quot;&gt;3ã€æ³¨æ„äº‹é¡¹&lt;/h2&gt;
&lt;/li&gt;
&lt;li&gt;åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæœªè®¾ç½®TaskExecutoræ—¶ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨SimpleAsyncTaskExecutorè¿™ä¸ªçº¿ç¨‹æ± ï¼Œä½†æ­¤çº¿ç¨‹ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„çº¿ç¨‹æ± ï¼Œå› ä¸ºçº¿ç¨‹ä¸é‡ç”¨ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚å¯é€šè¿‡æ§åˆ¶å°æ—¥å¿—è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œæ¯æ¬¡è¾“å‡ºçº¿ç¨‹åéƒ½æ˜¯é€’å¢çš„ã€‚æ‰€ä»¥æœ€å¥½æˆ‘ä»¬æ¥è‡ªå®šä¹‰ä¸€ä¸ªçº¿ç¨‹æ± ã€‚&lt;/li&gt;
&lt;li readability=&quot;2&quot;&gt;
&lt;p&gt;è°ƒç”¨çš„å¼‚æ­¥æ–¹æ³•ï¼Œä¸èƒ½ä¸ºåŒä¸€ä¸ªç±»çš„æ–¹æ³•ï¼ˆåŒ…æ‹¬åŒä¸€ä¸ªç±»çš„å†…éƒ¨ç±»ï¼‰ï¼Œç®€å•æ¥è¯´ï¼Œå› ä¸ºSpringåœ¨å¯åŠ¨æ‰«ææ—¶ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼Œè€ŒåŒç±»è°ƒç”¨æ—¶ï¼Œè¿˜æ˜¯è°ƒç”¨æœ¬èº«çš„ä»£ç†ç±»çš„ï¼Œæ‰€ä»¥å’Œå¹³å¸¸è°ƒç”¨æ˜¯ä¸€æ ·çš„ã€‚å…¶ä»–çš„æ³¨è§£å¦‚@Cacheç­‰ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ï¼Œè¯´ç™½äº†ï¼Œå°±æ˜¯Springçš„ä»£ç†æœºåˆ¶é€ æˆçš„ã€‚æ‰€ä»¥åœ¨å¼€å‘ä¸­ï¼Œæœ€å¥½æŠŠå¼‚æ­¥æœåŠ¡å•ç‹¬æŠ½å‡ºä¸€ä¸ªç±»æ¥ç®¡ç†ã€‚ä¸‹é¢ä¼šé‡ç‚¹è®²è¿°ã€‚ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´asyncå¼‚æ­¥æ–¹æ³•ä¼šå¤±æ•ˆ&quot;&gt;4ã€ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå¯¼è‡´@Asyncå¼‚æ­¥æ–¹æ³•ä¼šå¤±æ•ˆï¼Ÿ&lt;/h2&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;ol readability=&quot;7.5&quot;&gt;&lt;li&gt;&lt;span&gt;è°ƒç”¨åŒä¸€ä¸ªç±»ä¸‹æ³¨æœ‰@Asyncå¼‚æ­¥æ–¹æ³•&lt;/span&gt;ï¼šåœ¨springä¸­åƒ@Asyncå’Œ@Transactionalã€cacheç­‰æ³¨è§£æœ¬è´¨ä½¿ç”¨çš„æ˜¯åŠ¨æ€ä»£ç†ï¼Œå…¶å®Springå®¹å™¨åœ¨åˆå§‹åŒ–çš„æ—¶å€™Springå®¹å™¨ä¼šå°†å«æœ‰AOPæ³¨è§£çš„ç±»å¯¹è±¡â€œæ›¿æ¢â€ä¸ºä»£ç†å¯¹è±¡ï¼ˆç®€å•è¿™ä¹ˆç†è§£ï¼‰ï¼Œé‚£ä¹ˆæ³¨è§£å¤±æ•ˆçš„åŸå› å°±å¾ˆæ˜æ˜¾äº†ï¼Œå°±æ˜¯å› ä¸ºè°ƒç”¨æ–¹æ³•çš„æ˜¯å¯¹è±¡æœ¬èº«è€Œä¸æ˜¯ä»£ç†å¯¹è±¡ï¼Œå› ä¸ºæ²¡æœ‰ç»è¿‡Springå®¹å™¨ï¼Œé‚£ä¹ˆè§£å†³æ–¹æ³•ä¹Ÿä¼šæ²¿ç€è¿™ä¸ªæ€è·¯æ¥è§£å†³ã€‚&lt;/li&gt;
&lt;li&gt;&lt;span&gt;è°ƒç”¨çš„æ˜¯é™æ€(static )æ–¹æ³•&lt;/span&gt;&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;&lt;span&gt;è°ƒç”¨(private)ç§æœ‰åŒ–æ–¹æ³•&lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;è§£å†³4ä¸­é—®é¢˜1çš„æ–¹å¼å…¶å®ƒ23ä¸¤ä¸ªé—®é¢˜è‡ªå·±æ³¨æ„ä¸‹å°±å¯ä»¥äº†&quot;&gt;5ã€è§£å†³4ä¸­é—®é¢˜1çš„æ–¹å¼ï¼ˆå…¶å®ƒ2,3ä¸¤ä¸ªé—®é¢˜è‡ªå·±æ³¨æ„ä¸‹å°±å¯ä»¥äº†ï¼‰&lt;/h2&gt;
&lt;/li&gt;
&lt;li&gt;&lt;span&gt;å°†è¦å¼‚æ­¥æ‰§è¡Œçš„æ–¹æ³•å•ç‹¬æŠ½å–æˆä¸€ä¸ªç±»&lt;/span&gt;ï¼ŒåŸç†å°±æ˜¯å½“ä½ æŠŠæ‰§è¡Œå¼‚æ­¥çš„æ–¹æ³•å•ç‹¬æŠ½å–æˆä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œè¿™ä¸ªç±»è‚¯å®šæ˜¯è¢«Springç®¡ç†çš„ï¼Œå…¶ä»–Springç»„ä»¶éœ€è¦è°ƒç”¨çš„æ—¶å€™è‚¯å®šä¼šæ³¨å…¥è¿›å»ï¼Œè¿™æ—¶å€™å®é™…ä¸Šæ³¨å…¥è¿›å»çš„å°±æ˜¯ä»£ç†ç±»äº†ã€‚&lt;/li&gt;
&lt;li readability=&quot;16&quot;&gt;
&lt;p&gt;å…¶å®æˆ‘ä»¬çš„æ³¨å…¥å¯¹è±¡éƒ½æ˜¯ä»Springå®¹å™¨ä¸­ç»™å½“å‰Springç»„ä»¶è¿›è¡Œæˆå‘˜å˜é‡çš„èµ‹å€¼ï¼Œç”±äºæŸäº›ç±»ä½¿ç”¨äº†AOPæ³¨è§£ï¼Œé‚£ä¹ˆå®é™…ä¸Šåœ¨Springå®¹å™¨ä¸­å®é™…å­˜åœ¨çš„æ˜¯å®ƒçš„ä»£ç†å¯¹è±¡ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥&lt;span&gt;é€šè¿‡ä¸Šä¸‹æ–‡è·å–è‡ªå·±çš„ä»£ç†å¯¹è±¡è°ƒç”¨å¼‚æ­¥æ–¹æ³•&lt;/span&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@Controller
@RequestMapping(&quot;/app&quot;)
public class EmailController {

    //è·å–ApplicationContextå¯¹è±¡æ–¹å¼æœ‰å¤šç§,è¿™ç§æœ€ç®€å•,å…¶å®ƒçš„å¤§å®¶è‡ªè¡Œäº†è§£ä¸€ä¸‹
    @Autowired
    private ApplicationContext applicationContext;

    @RequestMapping(value = &quot;/email/asyncCall&quot;, method = GET)
    @ResponseBody
    public Map&amp;lt;String, Object&amp;gt; asyncCall () {
        Map&amp;lt;String, Object&amp;gt; resMap = new HashMap&amp;lt;String, Object&amp;gt;();
        try{
            //è¿™æ ·è°ƒç”¨åŒç±»ä¸‹çš„å¼‚æ­¥æ–¹æ³•æ˜¯ä¸èµ·ä½œç”¨çš„
            //this.testAsyncTask();
            //é€šè¿‡ä¸Šä¸‹æ–‡è·å–è‡ªå·±çš„ä»£ç†å¯¹è±¡è°ƒç”¨å¼‚æ­¥æ–¹æ³•
            EmailController emailController = (EmailController)applicationContext.getBean(EmailController.class);
            emailController.testAsyncTask();
            resMap.put(&quot;code&quot;,200);
        }catch (Exception e) {
            resMap.put(&quot;code&quot;,400);
            logger.error(&quot;error!&quot;,e);
        }
        return resMap;
    }

    //æ³¨æ„ä¸€å®šæ˜¯public,ä¸”æ˜¯éstaticæ–¹æ³•
    @Async
    public void testAsyncTask() throws InterruptedException {
        Thread.sleep(10000);
        System.out.println(&quot;å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼&quot;);
    }

}&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;span&gt;å¼€å¯cglibä»£ç†ï¼Œæ‰‹åŠ¨è·å–Springä»£ç†ç±»&lt;/span&gt;,ä»è€Œè°ƒç”¨åŒç±»ä¸‹çš„å¼‚æ­¥æ–¹æ³•ã€‚
&lt;ul readability=&quot;1&quot;&gt;&lt;li&gt;é¦–å…ˆï¼Œåœ¨å¯åŠ¨ç±»ä¸ŠåŠ ä¸Š&lt;span&gt;@EnableAspectJAutoProxy(exposeProxy = true)&lt;/span&gt;æ³¨è§£ã€‚&lt;/li&gt;
&lt;li readability=&quot;5&quot;&gt;
&lt;p&gt;ä»£ç å®ç°ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;@Service
@Transactional(value = &quot;transactionManager&quot;, readOnly = false, propagation = Propagation.REQUIRED, rollbackFor = Throwable.class)
public class EmailService {

    @Autowired
    private ApplicationContext applicationContext;

    @Async
    public void testSyncTask() throws InterruptedException {
        Thread.sleep(10000);
        System.out.println(&quot;å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼&quot;);
    }


    public void asyncCallTwo() throws InterruptedException {
        //this.testSyncTask();
//        EmailService emailService = (EmailService)applicationContext.getBean(EmailService.class);
//        emailService.testSyncTask();
        boolean isAop = AopUtils.isAopProxy(EmailController.class);//æ˜¯å¦æ˜¯ä»£ç†å¯¹è±¡ï¼›
        boolean isCglib = AopUtils.isCglibProxy(EmailController.class);  //æ˜¯å¦æ˜¯CGLIBæ–¹å¼çš„ä»£ç†å¯¹è±¡ï¼›
        boolean isJdk = AopUtils.isJdkDynamicProxy(EmailController.class);  //æ˜¯å¦æ˜¯JDKåŠ¨æ€ä»£ç†æ–¹å¼çš„ä»£ç†å¯¹è±¡ï¼›
        //ä»¥ä¸‹æ‰æ˜¯é‡ç‚¹!!!
        EmailService emailService = (EmailService)applicationContext.getBean(EmailService.class);
        EmailService proxy = (EmailService) AopContext.currentProxy();
        System.out.println(emailService == proxy ? true : false);
        proxy.testSyncTask();
        System.out.println(&quot;end!!!&quot;);
    }
}&lt;/code&gt;
&lt;/pre&gt;

&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;ul&gt;&lt;li&gt;ä¸¤è€…çš„ä½¿ç”¨åœºæ™¯ä¸åŒï¼Œå¼‚æ­¥è¯·æ±‚ç”¨æ¥è§£å†³å¹¶å‘è¯·æ±‚å¯¹æœåŠ¡å™¨é€ æˆçš„å‹åŠ›ï¼Œä»è€Œæé«˜å¯¹è¯·æ±‚çš„ååé‡ï¼›è€Œå¼‚æ­¥è°ƒç”¨æ˜¯ç”¨æ¥åšä¸€äº›éä¸»çº¿æµç¨‹ä¸”ä¸éœ€è¦å®æ—¶è®¡ç®—å’Œå“åº”çš„ä»»åŠ¡ï¼Œæ¯”å¦‚åŒæ­¥æ—¥å¿—åˆ°kafkaä¸­åšæ—¥å¿—åˆ†æç­‰ã€‚&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥è¯·æ±‚æ˜¯ä¼šä¸€ç›´ç­‰å¾…responseç›¸åº”çš„ï¼Œéœ€è¦è¿”å›ç»“æœç»™å®¢æˆ·ç«¯çš„ï¼›è€Œå¼‚æ­¥è°ƒç”¨æˆ‘ä»¬å¾€å¾€ä¼šé©¬ä¸Šè¿”å›ç»™å®¢æˆ·ç«¯å“åº”ï¼Œå®Œæˆè¿™æ¬¡æ•´ä¸ªçš„è¯·æ±‚ï¼Œè‡³äºå¼‚æ­¥è°ƒç”¨çš„ä»»åŠ¡åå°è‡ªå·±æ…¢æ…¢è·‘å°±è¡Œï¼Œå®¢æˆ·ç«¯ä¸ä¼šå…³å¿ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;&lt;li&gt;å¼‚æ­¥è¯·æ±‚å’Œå¼‚æ­¥è°ƒç”¨çš„ä½¿ç”¨åˆ°è¿™é‡ŒåŸºæœ¬å°±å·®ä¸å¤šäº†ï¼Œæœ‰é—®é¢˜è¿˜å¸Œæœ›å¤§å®¶å¤šå¤šæŒ‡å‡ºã€‚&lt;/li&gt;
&lt;li&gt;è¿™è¾¹æ–‡ç« æåˆ°äº†åŠ¨æ€ä»£ç†ï¼Œè€Œspringä¸­Aopçš„å®ç°åŸç†å°±æ˜¯åŠ¨æ€ä»£ç†ï¼Œåç»­ä¼šå¯¹åŠ¨æ€ä»£ç†åšè¯¦ç»†è§£è¯»ï¼Œè¿˜æœ›å¤šå¤šæ”¯æŒå“ˆ~&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;2.0412371134021&quot;&gt;
&lt;p&gt;ä¸ªäººåšå®¢åœ°å€ï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;2.3023255813953&quot;&gt;
&lt;p&gt;csdn:&lt;a href=&quot;https://blog.csdn.net/tiantuo6513&quot; class=&quot;uri&quot;&gt;https://blog.csdn.net/tiantuo6513&lt;/a&gt;&lt;br/&gt;cnblogs:&lt;a href=&quot;https://www.cnblogs.com/baixianlong&quot; class=&quot;uri&quot;&gt;https://www.cnblogs.com/baixianlong&lt;/a&gt;&lt;br/&gt;segmentfault:&lt;a href=&quot;https://segmentfault.com/u/baixianlong&quot; class=&quot;uri&quot;&gt;https://segmentfault.com/u/baixianlong&lt;/a&gt;&lt;br/&gt;github:https://github.com/xianlongbai&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
</description>
<pubDate>Sat, 06 Apr 2019 14:33:00 +0000</pubDate>
<dc:creator>ä¼šç‚¼é’¢çš„å°ç™½é¾™</dc:creator>
<og:description>ä¸€ã€SpringBootä¸­å¼‚æ­¥è¯·æ±‚çš„ä½¿ç”¨ 1ã€å¼‚æ­¥è¯·æ±‚ä¸åŒæ­¥è¯·æ±‚ ç‰¹ç‚¹ï¼š å¯ä»¥å…ˆé‡Šæ”¾å®¹å™¨åˆ†é…ç»™è¯·æ±‚çš„çº¿ç¨‹ä¸ç›¸å…³èµ„æºï¼Œå‡è½»ç³»ç»Ÿè´Ÿæ‹…ï¼Œé‡Šæ”¾äº†å®¹å™¨æ‰€åˆ†é…çº¿ç¨‹çš„è¯·æ±‚ï¼Œå…¶å“åº”å°†è¢«å»¶åï¼Œå¯ä»¥åœ¨è€—æ—¶å¤„ç†å®Œæˆï¼ˆä¾‹å¦‚é•¿</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/baixianlong/p/10661591.html</dc:identifier>
</item>
<item>
<title>Effective Java ç¬¬ä¸‰ç‰ˆâ€”â€”88. é˜²å¾¡æ€§åœ°ç¼–å†™READOBJECTæ–¹æ³• - æ—æœ¬æ‰˜</title>
<link>http://www.cnblogs.com/IcanFixIt/p/10663149.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/IcanFixIt/p/10663149.html</guid>
<description>&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;Tips&lt;br/&gt;ä¹¦ä¸­çš„æºä»£ç åœ°å€ï¼šhttps://github.com/jbloch/effective-java-3e-source-code&lt;br/&gt;æ³¨æ„ï¼Œä¹¦ä¸­çš„æœ‰äº›ä»£ç é‡Œæ–¹æ³•æ˜¯åŸºäºJava 9 APIä¸­çš„ï¼Œæ‰€ä»¥JDK æœ€å¥½ä¸‹è½½ JDK 9ä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/4366140-8966e457a14bc8b9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;Effective Java, Third Edition&quot;/&gt;&lt;/p&gt;

&lt;p&gt;æ¡ç›® 50 é‡Œæœ‰ä¸€ä¸ªä¸å¯å˜çš„æ—¥æœŸèŒƒå›´ç±»ï¼Œå®ƒåŒ…å«ä¸€ä¸ªå¯å˜çš„ç§æœ‰Dateå±æ€§ã€‚ è¯¥ç±»é€šè¿‡åœ¨å…¶æ„é€ æ–¹æ³•å’Œè®¿é—®å™¨ä¸­é˜²å¾¡æ€§åœ°æ‹·è´Dateå¯¹è±¡ï¼Œç«­å°½å…¨åŠ›ç»´æŒå…¶ä¸å˜æ€§ï¼ˆinvariants and immutabilityï¼‰ã€‚ ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;// Immutable class that uses defensive copying
public final class Period {

    private final Date start;
    private final Date end;

    /**
     * @param  start the beginning of the period
     * @param  end the end of the period; must not precede start
     * @throws IllegalArgumentException if start is after end
     * @throws NullPointerException if start or end is null
     */
    public Period(Date start, Date end) {
        this.start = new Date(start.getTime());
        this.end   = new Date(end.getTime());
        if (this.start.compareTo(this.end) &amp;gt; 0)
            throw new IllegalArgumentException(
                          start + &quot; after &quot; + end);
    }

    public Date start () { return new Date(start.getTime()); }

    public Date end () { return new Date(end.getTime()); }

    public String toString() { return start + &quot; - &quot; + end; }

    ... // Remainder omitted
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å‡è®¾è¦æŠŠè¿™ä¸ªç±»å¯åºåˆ—åŒ–ã€‚ç”±äº&lt;code&gt;Period&lt;/code&gt;å¯¹è±¡çš„ç‰©ç†è¡¨ç¤ºç²¾ç¡®åœ°åæ˜ äº†å®ƒçš„é€»è¾‘æ•°æ®å†…å®¹ï¼Œæ‰€ä»¥ä½¿ç”¨é»˜è®¤çš„åºåˆ—åŒ–å½¢å¼æ˜¯åˆç†çš„(æ¡ç›® 87)ã€‚å› æ­¤ï¼Œè¦ä½¿ç±»å¯åºåˆ—åŒ–ï¼Œä¼¼ä¹åªéœ€å°†implements Serializable æ·»åŠ åˆ°ç±»å£°æ˜ä¸­å°±å¯ä»¥äº†ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™æ ·åšï¼Œè¯¥ç±»ä¸å†ä¿è¯å®ƒçš„å…³é”®ä¸å˜æ€§äº†ã€‚&lt;/p&gt;
&lt;p&gt;é—®é¢˜æ˜¯readObjectæ–¹æ³•å®é™…ä¸Šæ˜¯å¦ä¸€ä¸ªå…¬å…±æ„é€ æ–¹æ³•ï¼Œå®ƒéœ€è¦ä¸ä»»ä½•å…¶ä»–æ„é€ æ–¹æ³•ä¸€æ ·çš„å°å¿ƒè­¦æƒ•ã€‚ æ­£å¦‚æ„é€ æ–¹æ³•å¿…é¡»æ£€æŸ¥å…¶å‚æ•°çš„æœ‰æ•ˆæ€§ï¼ˆæ¡ç›® 49ï¼‰å¹¶åœ¨é€‚å½“çš„åœ°æ–¹å¯¹å‚æ•°é˜²å¾¡æ€§æ‹·è´ï¼ˆæ¡ç›® 50ï¼‰ï¼ŒreadObjectæ–¹æ³•ä¹Ÿè¦è¿™æ ·åšã€‚ å¦‚æœreadObjectæ–¹æ³•æ— æ³•æ‰§è¡Œè¿™ä¸¤ä¸ªæ“ä½œä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œåˆ™æ”»å‡»è€…è¿åç±»çš„ä¸å˜æ€§æ˜¯ç›¸å¯¹ç®€å•çš„äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼ŒreadObjectæ˜¯ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œå®ƒå°†å­—èŠ‚æµä½œä¸ºå”¯ä¸€å‚æ•°ã€‚ åœ¨æ­£å¸¸ä½¿ç”¨ä¸­ï¼Œå­—èŠ‚æµæ˜¯é€šè¿‡åºåˆ—åŒ–æ­£å¸¸æ„é€ çš„å®ä¾‹ç”Ÿæˆçš„ã€‚å½“readObjectå±•ç°ä¸€ä¸ªå­—èŠ‚æµæ—¶ï¼Œé—®é¢˜å°±å‡ºç°äº†ï¼Œè¿™ä¸ªå­—èŠ‚æµæ˜¯äººä¸ºæ„é€ çš„ï¼Œç”¨æ¥ç”Ÿæˆä¸€ä¸ªè¿åç±»ä¸å˜æ€§çš„å¯¹è±¡ã€‚ è¿™æ ·çš„å­—èŠ‚æµå¯ç”¨äºåˆ›å»ºä¸€ä¸ªä¸å¯èƒ½çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ— æ³•ä½¿ç”¨æ™®é€šæ„é€ æ–¹æ³•åˆ›å»ºã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾æˆ‘ä»¬åªæ˜¯å°†&lt;code&gt;implements Serializablet&lt;/code&gt;æ·»åŠ åˆ°&lt;code&gt;Period&lt;/code&gt;ç±»å£°æ˜ä¸­ã€‚ ç„¶åï¼Œè¿™ä¸ªä¸‘é™‹çš„ç¨‹åºç”Ÿæˆä¸€ä¸ªPeriodå®ä¾‹ï¼Œå…¶ç»“æŸæ—¶é—´åœ¨å…¶å¼€å§‹æ—¶é—´ä¹‹å‰ã€‚ å¯¹byteç±»å‹çš„å€¼è¿›è¡Œå¼ºåˆ¶è½¬æ¢ï¼Œå…¶é«˜é˜¶ä½è¢«è®¾ç½®ï¼Œè¿™æ˜¯ç”±äºJavaç¼ºä¹byteå­—é¢é‡ï¼Œå¹¶ä¸”é”™è¯¯åœ°å†³å®šå¯¹byteç±»å‹è¿›è¡Œç­¾å:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public class BogusPeriod {
  // Byte stream couldn't have come from a real Period instance!
  private static final byte[] serializedForm = {
    (byte)0xac, (byte)0xed, 0x00, 0x05, 0x73, 0x72, 0x00, 0x06,
    0x50, 0x65, 0x72, 0x69, 0x6f, 0x64, 0x40, 0x7e, (byte)0xf8,
    0x2b, 0x4f, 0x46, (byte)0xc0, (byte)0xf4, 0x02, 0x00, 0x02,
    0x4c, 0x00, 0x03, 0x65, 0x6e, 0x64, 0x74, 0x00, 0x10, 0x4c,
    0x6a, 0x61, 0x76, 0x61, 0x2f, 0x75, 0x74, 0x69, 0x6c, 0x2f,
    0x44, 0x61, 0x74, 0x65, 0x3b, 0x4c, 0x00, 0x05, 0x73, 0x74,
    0x61, 0x72, 0x74, 0x71, 0x00, 0x7e, 0x00, 0x01, 0x78, 0x70,
    0x73, 0x72, 0x00, 0x0e, 0x6a, 0x61, 0x76, 0x61, 0x2e, 0x75,
    0x74, 0x69, 0x6c, 0x2e, 0x44, 0x61, 0x74, 0x65, 0x68, 0x6a,
    (byte)0x81, 0x01, 0x4b, 0x59, 0x74, 0x19, 0x03, 0x00, 0x00,
    0x78, 0x70, 0x77, 0x08, 0x00, 0x00, 0x00, 0x66, (byte)0xdf,
    0x6e, 0x1e, 0x00, 0x78, 0x73, 0x71, 0x00, 0x7e, 0x00, 0x03,
    0x77, 0x08, 0x00, 0x00, 0x00, (byte)0xd5, 0x17, 0x69, 0x22,
    0x00, 0x78
  };

  public static void main(String[] args) {
    Period p = (Period) deserialize(serializedForm);
    System.out.println(p);
  }

  // Returns the object with the specified serialized form
  static Object deserialize(byte[] sf) {
    try {
      return new ObjectInputStream(
          new ByteArrayInputStream(sf)).readObject();
    } catch (IOException | ClassNotFoundException e) {
      throw new IllegalArgumentException(e);
    }
  }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç”¨äºåˆå§‹åŒ–serializedFormçš„å­—èŠ‚æ•°ç»„å­—é¢é‡ï¼ˆliteralï¼‰æ˜¯é€šè¿‡åºåˆ—åŒ–æ­£å¸¸çš„Periodå®ä¾‹ï¼Œå¹¶æ‰‹åŠ¨ç¼–è¾‘ç”Ÿæˆçš„å­—èŠ‚æµç”Ÿæˆçš„ã€‚ æµçš„ç»†èŠ‚å¯¹äºè¯¥ç¤ºä¾‹å¹¶ä¸é‡è¦ï¼Œä½†æ˜¯å¦‚æœå¥½å¥‡ï¼Œåˆ™åœ¨ã€ŠJava Object Serialization Specificationã€‹[åºåˆ—åŒ–ï¼Œ6]ä¸­æè¿°äº†åºåˆ—åŒ–å­—èŠ‚æµæ ¼å¼ã€‚ å¦‚æœè¿è¡Œæ­¤ç¨‹åºï¼Œå®ƒä¼šæ‰“å°&lt;code&gt;Fri Jan 01 12:00:00 PST 1999 - Sun Jan 01 12:00:00 PST 1984&lt;/code&gt;ã€‚åªéœ€å£°æ˜&lt;code&gt;Period&lt;/code&gt;ç±»ä¸ºå¯åºåˆ—åŒ–ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªè¿åå…¶ç±»ä¸å˜æ€§çš„å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;è¦è§£å†³æ­¤é—®é¢˜ï¼Œè¯·ä¸ºPeriodæä¾›ä¸€ä¸ªreadObjectæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è°ƒç”¨defaultReadObjectï¼Œç„¶åæ£€æŸ¥ååºåˆ—åŒ–å¯¹è±¡çš„æœ‰æ•ˆæ€§ã€‚å¦‚æœæœ‰æ•ˆæ€§æ£€æŸ¥å¤±è´¥ï¼ŒreadObjectæ–¹æ³•æŠ›å‡ºInvalidObjectExceptionå¼‚å¸¸ï¼Œé˜»æ­¢ååºåˆ—åŒ–å®Œæˆ:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;// readObject method with validity checking - insufficient!
private void readObject(ObjectInputStream s)
        throws IOException, ClassNotFoundException {
    s.defaultReadObject();

    // Check that our invariants are satisfied
    if (start.compareTo(end) &amp;gt; 0)
        throw new InvalidObjectException(start +&quot; after &quot;+ end);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è™½ç„¶è¿™æ ·å¯ä»¥é˜²æ­¢æ”»å‡»è€…åˆ›å»ºæ— æ•ˆçš„Periodå®ä¾‹ï¼Œä½†ä»ç„¶å­˜åœ¨æ½œåœ¨çš„æ›´å¾®å¦™çš„é—®é¢˜ã€‚ å¯ä»¥é€šè¿‡æ„é€ ä»¥æœ‰æ•ˆPeriodå®ä¾‹å¼€å¤´çš„å­—èŠ‚æµæ¥åˆ›å»ºå¯å˜Periodå®ä¾‹ï¼Œç„¶åå°†é¢å¤–å¼•ç”¨é™„åŠ åˆ°Periodå®ä¾‹å†…éƒ¨çš„ç§æœ‰Dateå±æ€§ã€‚ æ”»å‡»è€…ä»ObjectInputStreamä¸­è¯»å–Periodå®ä¾‹ï¼Œç„¶åè¯»å–é™„åŠ åˆ°æµçš„â€œæ¶æ„å¯¹è±¡å¼•ç”¨â€ã€‚ è¿™äº›å¼•ç”¨ä½¿æ”»å‡»è€…å¯ä»¥è®¿é—®Periodå¯¹è±¡ä¸­ç§æœ‰Dateå±æ€§å¼•ç”¨çš„å¯¹è±¡ã€‚ é€šè¿‡æ”¹å˜è¿™äº›Dateå®ä¾‹ï¼Œæ”»å‡»è€…å¯ä»¥æ”¹å˜Periodå®ä¾‹ã€‚ ä»¥ä¸‹ç±»æ¼”ç¤ºäº†è¿™ç§æ”»å‡»ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public class MutablePeriod {
    // A period instance
    public final Period period;

    // period's start field, to which we shouldn't have access
    public final Date start;

    // period's end field, to which we shouldn't have access
    public final Date end;

    public MutablePeriod() {
        try {
            ByteArrayOutputStream bos =
                new ByteArrayOutputStream();
            ObjectOutputStream out =
                new ObjectOutputStream(bos);
            // Serialize a valid Period instance
            out.writeObject(new Period(new Date(), new Date()));

            /*
             * Append rogue &quot;previous object refs&quot; for internal
             * Date fields in Period. For details, see &quot;Java
             * Object Serialization Specification,&quot; Section 6.4.
             */
            byte[] ref = { 0x71, 0, 0x7e, 0, 5 };  // Ref #5
            bos.write(ref); // The start field
            ref[4] = 4;     // Ref # 4
            bos.write(ref); // The end field

            // Deserialize Period and &quot;stolen&quot; Date references
            ObjectInputStream in = new ObjectInputStream(
                new ByteArrayInputStream(bos.toByteArray()));
            period = (Period) in.readObject();
            start  = (Date)   in.readObject();
            end    = (Date)   in.readObject();
        } catch (IOException | ClassNotFoundException e) {
            throw new AssertionError(e);
        }
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¦æŸ¥çœ‹æ­£åœ¨è¿›è¡Œçš„æ”»å‡»ï¼Œè¯·è¿è¡Œä»¥ä¸‹ç¨‹åºï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;public static void main(String[] args) {
    MutablePeriod mp = new MutablePeriod();
    Period p = mp.period;
    Date pEnd = mp.end;

    // Let's turn back the clock
    pEnd.setYear(78);
    System.out.println(p);

    // Bring back the 60s!
    pEnd.setYear(69);
    System.out.println(p);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨æˆ‘çš„è¯­è¨€ç¯å¢ƒä¸­ï¼Œè¿è¡Œæ­¤ç¨‹åºä¼šäº§ç”Ÿä»¥ä¸‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Wed Nov 22 00:21:29 PST 2017 - Wed Nov 22 00:21:29 PST 1978
Wed Nov 22 00:21:29 PST 2017 - Sat Nov 22 00:21:29 PST 1969&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è™½ç„¶åˆ›å»ºäº†Periodå®ä¾‹ä¸”ä¿æŒäº†å…¶ä¸å˜æ€§ï¼Œä½†å¯ä»¥éšæ„ä¿®æ”¹å…¶å†…éƒ¨ç»„ä»¶ã€‚ ä¸€æ—¦æ‹¥æœ‰å¯å˜çš„Periodå®ä¾‹ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šé€šè¿‡å°†å®ä¾‹ä¼ é€’ç»™ä¾èµ–äºPeriodçš„å®‰å…¨æ€§ä¸å˜æ€§çš„ç±»æ¥é€ æˆå·¨å¤§çš„ä¼¤å®³ã€‚ è¿™å¹¶éå¦‚æ­¤ç‰µå¼ºï¼šæœ‰äº›ç±»å°±æ˜¯ä¾èµ–äºStringçš„ä¸å˜æ€§æ¥ä¿è¯å®‰å…¨æ€§çš„ã€‚&lt;/p&gt;
&lt;p&gt;é—®é¢˜çš„æ ¹æºæ˜¯Periodç±»çš„readObjectæ–¹æ³•æ²¡æœ‰åšè¶³å¤Ÿçš„é˜²å¾¡æ€§æ‹·è´ã€‚ &lt;strong&gt;å¯¹è±¡ååºåˆ—åŒ–æ—¶ï¼Œé˜²å¾¡æ€§åœ°æ‹·è´åŒ…å«å®¢æˆ·ç«¯ä¸èƒ½æ‹¥æœ‰çš„å¯¹è±¡å¼•ç”¨çš„å±æ€§ï¼Œæ˜¯è‡³å…³é‡è¦çš„&lt;/strong&gt;ã€‚ å› æ­¤ï¼Œæ¯ä¸ªåŒ…å«ç§æœ‰å¯å˜ç»„ä»¶çš„å¯åºåˆ—åŒ–ä¸å¯å˜ç±»ï¼Œå¿…é¡»åœ¨å…¶readObjectæ–¹æ³•ä¸­é˜²å¾¡æ€§åœ°æ‹·è´è¿™äº›ç»„ä»¶ã€‚ ä»¥ä¸‹readObjectæ–¹æ³•è¶³ä»¥ç¡®ä¿Periodçš„ä¸å˜æ€§å¹¶ä¿æŒå…¶ä¸å˜æ€§ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;// readObject method with defensive copying and validity checking
private void readObject(ObjectInputStream s)
        throws IOException, ClassNotFoundException {
    s.defaultReadObject();

    // Defensively copy our mutable components
    start = new Date(start.getTime());
    end   = new Date(end.getTime());

    // Check that our invariants are satisfied
    if (start.compareTo(end) &amp;gt; 0)
        throw new InvalidObjectException(start +&quot; after &quot;+ end);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¯·æ³¨æ„ï¼Œé˜²å¾¡æ€§æ‹·è´åœ¨æœ‰æ•ˆæ€§æ£€æŸ¥ä¹‹å‰æ‰§è¡Œï¼Œå¹¶ä¸”æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨Dateçš„cloneæ–¹æ³•æ¥æ‰§è¡Œé˜²å¾¡æ€§æ‹·è´ã€‚ éœ€è¦è¿™ä¸¤ä¸ªç»†èŠ‚æ¥ä¿æŠ¤Periodå…å—æ”»å‡»ï¼ˆæ¡ç›® 50ï¼‰ã€‚ å¦è¯·æ³¨æ„ï¼Œfinalå±æ€§æ— æ³•è¿›è¡Œé˜²å¾¡æ€§æ‹·è´ã€‚ è¦ä½¿ç”¨readObjectæ–¹æ³•ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿startå’Œendå±æ€§ä¸èƒ½æ˜¯finalç±»å‹çš„ã€‚ è¿™æ˜¯ä¸å¹¸çš„ï¼Œä½†å®ƒæ˜¯è¿™ä¸¤ä¸ªä¸­è¾ƒå¥½çš„ä¸€ä¸ªåšæ³•ã€‚ ä½¿ç”¨æ–°çš„readObjectæ–¹æ³•å¹¶ä»&lt;code&gt;start&lt;/code&gt;å’Œ&lt;code&gt;end&lt;/code&gt;å±æ€§ä¸­åˆ é™¤finalä¿®é¥°ç¬¦åï¼Œ&lt;code&gt;MutablePeriod&lt;/code&gt;ç±»ä¸å†æ— æ•ˆã€‚ ä¸Šé¢çš„æ”»å‡»ç¨‹åºç°åœ¨ç”Ÿæˆå¦‚ä¸‹è¾“å‡ºï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Wed Nov 22 00:23:41 PST 2017 - Wed Nov 22 00:23:41 PST 2017
Wed Nov 22 00:23:41 PST 2017 - Wed Nov 22 00:23:41 PST 2017&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„çŸ³è•Šæµ‹è¯•(litmus test)ï¼Œç”¨äºç¡®å®šç±»çš„é»˜è®¤readObjectæ–¹æ³•æ˜¯å¦å¯æ¥å—ï¼šä½ æ˜¯å¦æ„¿æ„æ·»åŠ ä¸€ä¸ªå…¬å…±æ„é€ æ–¹æ³•ï¼Œè¯¥æ„é€ æ–¹æ³•æŠŠå¯¹è±¡ä¸­æ¯ä¸ªéç¬æ—¶çŠ¶æ€çš„å±æ€§å€¼ä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨æ²¡æœ‰ä»»ä½•éªŒè¯çš„æƒ…å†µä¸‹ï¼Œå°†å€¼ä¿å­˜åœ¨å±æ€§ä¸­ï¼Ÿå¦‚æœæ²¡æœ‰ï¼Œåˆ™å¿…é¡»æä¾›readObjectæ–¹æ³•ï¼Œå¹¶ä¸”å®ƒå¿…é¡»æ‰§è¡Œæ„é€ æ–¹æ³•æ‰€éœ€çš„æ‰€æœ‰æœ‰æ•ˆæ€§æ£€æŸ¥å’Œé˜²å¾¡æ€§æ‹·è´ã€‚æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨åºåˆ—åŒ–ä»£ç†æ¨¡å¼ï¼ˆserialization proxy patternï¼‰ï¼‰(æ¡ç›® 90)ã€‚å¼ºçƒˆæ¨èä½¿ç”¨è¿™ç§æ¨¡å¼ï¼Œå› ä¸ºå®ƒåœ¨å®‰å…¨ååºåˆ—åŒ–æ–¹é¢èŠ±è´¹äº†å¤§é‡ç²¾åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;readObjectæ–¹æ³•å’Œæ„é€ æ–¹æ³•è¿˜æœ‰ä¸€ä¸ªç›¸ä¼¼ä¹‹å¤„ï¼Œå®ƒä»¬é€‚ç”¨äºéfinalå¯åºåˆ—åŒ–ç±»ã€‚ ä¸æ„é€ æ–¹æ³•ä¸€æ ·ï¼ŒreadObjectæ–¹æ³•ä¸èƒ½ç›´æ¥æˆ–é—´æ¥è°ƒç”¨å¯é‡å†™çš„æ–¹æ³•ï¼ˆæ¡ç›® 19ï¼‰ã€‚ å¦‚æœè¿åæ­¤è§„åˆ™å¹¶ä¸”é‡å†™äº†ç›¸å…³æ–¹æ³•ï¼Œåˆ™é‡å†™æ–¹æ³•ä¼šåœ¨å­ç±»çŠ¶æ€è¢«ååºåˆ—åŒ–ä¹‹å‰è¿è¡Œã€‚ ç¨‹åºå¯èƒ½ä¼šå¯¼è‡´å¤±è´¥[Bloch05ï¼ŒPuzzle 91]ã€‚&lt;/p&gt;
&lt;p&gt;æ€»è€Œè¨€ä¹‹ï¼Œæ— è®ºä½•æ—¶ç¼–å†™readObjectæ–¹æ³•ï¼Œéƒ½è¦é‡‡ç”¨è¿™æ ·ä¸€ç§æ€ç»´æ–¹å¼ï¼Œå³æ­£åœ¨ç¼–å†™ä¸€ä¸ªå…¬å…±æ„é€ æ–¹æ³•ï¼Œè¯¥æ„é€ æ–¹æ³•å¿…é¡»ç”Ÿæˆä¸€ä¸ªæœ‰æ•ˆçš„å®ä¾‹ï¼Œè€Œä¸ç®¡ç»™å®šçš„æ˜¯ä»€ä¹ˆå­—èŠ‚æµã€‚ä¸è¦å‡è®¾å­—èŠ‚æµä¸€å®šè¡¨ç¤ºå®é™…çš„åºåˆ—åŒ–å®ä¾‹ã€‚è™½ç„¶æœ¬æ¡ç›®ä¸­çš„ç¤ºä¾‹æ¶‰åŠä½¿ç”¨é»˜è®¤åºåˆ—åŒ–å½¢å¼çš„ç±»ï¼Œä½†æ˜¯æ‰€å¼•å‘çš„æ‰€æœ‰é—®é¢˜éƒ½åŒæ ·é€‚ç”¨äºå…·æœ‰è‡ªå®šä¹‰åºåˆ—åŒ–å½¢å¼çš„ç±»ã€‚ä¸‹é¢æ˜¯ç¼–å†™readObjectæ–¹æ³•çš„æŒ‡å¯¼åŸåˆ™:&lt;/p&gt;
&lt;ul readability=&quot;2.5&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;å¯¹äºå…·æœ‰å¿…é¡»ä¿æŒç§æœ‰çš„å¯¹è±¡å¼•ç”¨å±æ€§çš„ç±»ï¼Œé˜²å¾¡æ€§åœ°æ‹·è´è¯¥å±æ€§ä¸­çš„æ¯ä¸ªå¯¹è±¡ã€‚ä¸å¯å˜ç±»çš„å¯å˜ç»„ä»¶å±äºè¿™ä¸€ç±»åˆ«ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;æ£€æŸ¥ä»»ä½•ä¸å˜æ€§ï¼Œå¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œåˆ™æŠ›å‡ºInvalidObjectExceptionå¼‚å¸¸ã€‚ æ£€æŸ¥åº”å†ä»»ä½•é˜²å¾¡æ€§æ‹·è´ä¹‹åã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;å¦‚æœå¿…é¡»åœ¨ååºåˆ—åŒ–åéªŒè¯æ•´ä¸ªå¯¹è±¡å›¾ï¼ˆobject graphï¼‰ï¼Œé‚£ä¹ˆä½¿ç”¨ObjectInputValidationæ¥å£(åœ¨æœ¬ä¹¦ä¸­æ²¡æœ‰è®¨è®º)ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;ä¸è¦ç›´æ¥æˆ–é—´æ¥è°ƒç”¨ç±»ä¸­ä»»ä½•å¯é‡å†™çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</description>
<pubDate>Sat, 06 Apr 2019 14:16:00 +0000</pubDate>
<dc:creator>æ—æœ¬æ‰˜</dc:creator>
<og:description>Tips ä¹¦ä¸­çš„æºä»£ç åœ°å€ï¼šhttps://github.com/jbloch/effective java 3e source code æ³¨æ„ï¼Œä¹¦ä¸­çš„æœ‰äº›ä»£ç é‡Œæ–¹æ³•æ˜¯åŸºäºJava 9 APIä¸­çš„ï¼Œæ‰€</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/IcanFixIt/p/10663149.html</dc:identifier>
</item>
<item>
<title>æœåŠ¡ç«¯é¢„æ¸²æŸ“ä¹‹Nuxt(ä»‹ç»ç¯‡) - Aaron-æ”»åŸç‹®</title>
<link>http://www.cnblogs.com/aaron---blog/p/10663069.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/aaron---blog/p/10663069.html</guid>
<description>&lt;p&gt;ç°åœ¨å‰ç«¯å¼€å‘ä¸€èˆ¬éƒ½æ˜¯å‰åç«¯åˆ†ç¦»ï¼Œ&lt;code&gt;mvvm&lt;/code&gt;å’Œ&lt;code&gt;mvc&lt;/code&gt;çš„å¼€å‘æ¡†æ¶ï¼Œå¦‚&lt;code&gt;Angular&lt;/code&gt;ã€&lt;code&gt;React&lt;/code&gt;å’Œ&lt;code&gt;Vue&lt;/code&gt;ç­‰ï¼Œè™½ç„¶å†™æ¡†æ¶èƒ½å¤Ÿä½¿æˆ‘ä»¬å¿«é€Ÿçš„å®Œæˆå¼€å‘ï¼Œä½†æ˜¯ç”±äºå‰åå°åˆ†ç¦»ï¼Œç»™é¡¹ç›®&lt;code&gt;SEO&lt;/code&gt;å¸¦æ¥å¾ˆå¤§çš„ä¸ä¾¿ï¼Œæœç´¢å¼•æ“åœ¨æ£€ç´¢çš„æ—¶å€™æ˜¯åœ¨ç½‘é¡µä¸­çˆ¬å–æ•°æ®ï¼Œç”±äºå•é¡µé¢åº”ç”¨è¯»å–åˆ°çš„é¡µé¢æ˜¯å‡ ä¹ç©ºç™½çš„ï¼Œæ— æ³•çˆ¬å–åˆ°ä»»ä½•æ•°æ®ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html&amp;gt;
    &amp;lt;head&amp;gt;
        &amp;lt;meta charset=utf-8&amp;gt;
        &amp;lt;meta name=viewport content=&quot;width=device-width,initial-scale=1&quot;&amp;gt;
        &amp;lt;title&amp;gt;authorization_web&amp;lt;/title&amp;gt;
    &amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
    &amp;lt;div id=app&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¦‚ä¸Šä»£ç ï¼Œå•é¡µé¢åº”ç”¨æŸ¥çœ‹æºä»£ç çš„æ—¶å€™å¦‚ä¸Šæ‰€ç¤ºï¼Œæ‰€ä»¥æœç´¢å¼•æ“æ— æ³•çˆ¬å–åˆ°ä»»ä½•ä¿¡æ¯ï¼Œæœç´¢å¼•æ“ä¼šè®¤ä¸ºå½“å‰é¡µé¢ä¸ºä¸€ä¸ªç©ºé¡µé¢ã€‚ä¸ºäº†è§£å†³&lt;code&gt;SEO&lt;/code&gt;é—®é¢˜ï¼Œæ¨å‡ºäº†&lt;code&gt;SSR&lt;/code&gt;æœåŠ¡ç«¯é¢„æ¸²æŸ“ï¼Œä»¥ä¾¿æé«˜å¯¹&lt;code&gt;SEO&lt;/code&gt;ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯SSR&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨è®¤è¯†&lt;code&gt;SSR&lt;/code&gt;ä¹‹å‰ï¼Œé¦–å…ˆå¯¹&lt;code&gt;CSR&lt;/code&gt;ä¸&lt;code&gt;SSR&lt;/code&gt;ä¹‹é—´åšä¸ªå¯¹æ¯”ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆçœ‹ä¸€ä¸‹ä¼ ç»Ÿçš„webå¼€å‘ï¼Œä¼ ç»Ÿçš„webå¼€å‘æ˜¯ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡ç«¯æŸ¥è¯¢æ•°æ®åº“ï¼Œæ‹¼æ¥&lt;code&gt;HTML&lt;/code&gt;å­—ç¬¦ä¸²ï¼ˆæ¨¡æ¿ï¼‰ï¼Œé€šè¿‡ä¸€ç³»åˆ—çš„æ•°æ®å¤„ç†ä¹‹åï¼ŒæŠŠæ•´ç†å¥½çš„&lt;code&gt;HTML&lt;/code&gt;è¿”å›ç»™å®¢æˆ·ç«¯,æµè§ˆå™¨ç›¸å½“äºæ‰“å¼€äº†ä¸€ä¸ªé¡µé¢ã€‚è¿™ç§æ¯”å¦‚æˆ‘ä»¬ç»å¸¸å¬è¯´è¿‡çš„&lt;code&gt;jsp&lt;/code&gt;,&lt;code&gt;PHP&lt;/code&gt;,&lt;code&gt;aspx&lt;/code&gt;ä¹Ÿå°±æ˜¯ä¼ ç»Ÿçš„&lt;code&gt;MVC&lt;/code&gt;çš„å¼€å‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;SPA&lt;/code&gt;åº”ç”¨ï¼Œåˆ°äº†&lt;code&gt;Vue&lt;/code&gt;ã€&lt;code&gt;React&lt;/code&gt;ï¼Œå•é¡µé¢åº”ç”¨ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒï¼Œé€æ¸æˆä¸ºäº†ä¸»æµï¼Œé¡µé¢æ•´ä½“å¼&lt;code&gt;javaScript&lt;/code&gt;æ¸²æŸ“å‡ºæ¥çš„ï¼Œç§°ä¹‹ä¸ºå®¢æˆ·ç«¯æ¸²æŸ“&lt;code&gt;CSR&lt;/code&gt;ã€‚&lt;code&gt;SPA&lt;/code&gt;æ¸²æŸ“è¿‡ç¨‹ã€‚ç”±å®¢æˆ·ç«¯è®¿é—®&lt;code&gt;URL&lt;/code&gt;å‘é€è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œè¿”å›&lt;code&gt;HTML&lt;/code&gt;ç»“æ„ï¼ˆä½†æ˜¯&lt;code&gt;SPA&lt;/code&gt;çš„è¿”å›çš„&lt;code&gt;HTML&lt;/code&gt;ç»“æ„æ˜¯éå¸¸çš„å°çš„ï¼Œåªæœ‰ä¸€ä¸ªåŸºæœ¬çš„ç»“æ„ï¼Œå¦‚ç¬¬ä¸€æ®µä»£ç æ‰€ç¤ºï¼‰ã€‚å®¢æˆ·ç«¯æ¥æ”¶åˆ°è¿”å›ç»“æœä¹‹åï¼Œåœ¨å®¢æˆ·ç«¯å¼€å§‹æ¸²æŸ“&lt;code&gt;HTML&lt;/code&gt;ï¼Œæ¸²æŸ“æ—¶æ‰§è¡Œå¯¹åº”&lt;code&gt;javaScript&lt;/code&gt;ï¼Œæœ€åæ¸²æŸ“&lt;code&gt;template&lt;/code&gt;ï¼Œæ¸²æŸ“å®Œæˆä¹‹åï¼Œå†æ¬¡å‘æœåŠ¡ç«¯å‘é€æ•°æ®è¯·æ±‚ï¼Œæ³¨æ„è¿™é‡Œæ—¶æ•°æ®è¯·æ±‚ï¼ŒæœåŠ¡ç«¯è¿”å›&lt;code&gt;json&lt;/code&gt;æ ¼å¼æ•°æ®ã€‚å®¢æˆ·ç«¯æ¥æ”¶æ•°æ®ï¼Œç„¶åå®Œæˆæœ€ç»ˆæ¸²æŸ“ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;SPA&lt;/code&gt;è™½ç„¶ç»™æœåŠ¡å™¨å‡è½»äº†å‹åŠ›ï¼Œä½†æ˜¯ä¹Ÿæ˜¯æœ‰ç¼ºç‚¹çš„ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;é¦–å±æ¸²æŸ“æ—¶é—´æ¯”è¾ƒé•¿ï¼šå¿…é¡»ç­‰å¾…&lt;code&gt;JavaScript&lt;/code&gt;åŠ è½½å®Œæ¯•ï¼Œå¹¶ä¸”æ‰§è¡Œå®Œæ¯•ï¼Œæ‰èƒ½æ¸²æŸ“å‡ºé¦–å±ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SEO&lt;/code&gt;ä¸å‹å¥½ï¼šçˆ¬è™«åªèƒ½æ‹¿åˆ°ä¸€ä¸ª&lt;code&gt;div&lt;/code&gt;å…ƒç´ ï¼Œè®¤ä¸ºé¡µé¢æ˜¯ç©ºçš„ï¼Œä¸åˆ©äº&lt;code&gt;SEO&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;ä¸ºäº†è§£å†³å¦‚ä¸Šä¸¤ä¸ªé—®é¢˜ï¼Œå‡ºç°äº†&lt;code&gt;SSR&lt;/code&gt;è§£å†³æ–¹æ¡ˆï¼Œåç«¯æ¸²æŸ“å‡ºé¦–å±çš„&lt;code&gt;DOM&lt;/code&gt;ç»“æ„è¿”å›ï¼Œå‰ç«¯æ‹¿åˆ°å†…å®¹å¸¦ä¸Šé¦–å±ï¼Œåç»­çš„é¡µé¢æ“ä½œï¼Œå†ç”¨å•é¡µé¢è·¯ç”±å’Œæ¸²æŸ“ï¼Œç§°ä¹‹ä¸ºæœåŠ¡ç«¯æ¸²æŸ“(&lt;code&gt;SSR&lt;/code&gt;)ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;SSR&lt;/code&gt;æ¸²æŸ“æµç¨‹æ˜¯è¿™æ ·çš„ï¼Œå®¢æˆ·ç«¯å‘é€&lt;code&gt;URL&lt;/code&gt;è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯è¯»å–å¯¹åº”çš„&lt;code&gt;url&lt;/code&gt;çš„æ¨¡æ¿ä¿¡æ¯ï¼Œåœ¨æœåŠ¡ç«¯åšå‡º&lt;code&gt;html&lt;/code&gt;å’Œ&lt;code&gt;æ•°æ®&lt;/code&gt;çš„æ¸²æŸ“ï¼Œæ¸²æŸ“å®Œæˆä¹‹åè¿”å›&lt;code&gt;html&lt;/code&gt;ç»“æ„ï¼Œå®¢æˆ·ç«¯è¿™æ—¶æ‹¿åˆ°çš„ä¹‹åé¦–å±é¡µé¢çš„&lt;code&gt;html&lt;/code&gt;ç»“æ„ã€‚æ‰€ä»¥ç”¨æˆ·åœ¨æµè§ˆé¦–å±çš„æ—¶å€™é€Ÿåº¦ä¼šå¾ˆå¿«ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¸éœ€è¦å†æ¬¡å‘é€&lt;code&gt;ajax&lt;/code&gt;è¯·æ±‚ã€‚å¹¶ä¸æ˜¯åšäº†&lt;code&gt;SSR&lt;/code&gt;æˆ‘ä»¬çš„é¡µé¢å°±ä¸å±äº&lt;code&gt;SPA&lt;/code&gt;åº”ç”¨äº†ï¼Œå®ƒä»ç„¶æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„&lt;code&gt;spa&lt;/code&gt;åº”ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;SSR&lt;/code&gt;æ˜¯å¤„äº&lt;code&gt;CSR&lt;/code&gt;ä¸&lt;code&gt;SPA&lt;/code&gt;åº”ç”¨ä¹‹é—´çš„ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œåœ¨æ¸²æŸ“é¦–å±çš„æ—¶å€™åœ¨æœåŠ¡ç«¯åšå‡ºäº†æ¸²æŸ“ï¼Œæ³¨æ„ä»…ä»…æ˜¯é¦–å±ï¼Œå…¶ä»–é¡µé¢è¿˜æ˜¯éœ€è¦åœ¨å®¢æˆ·ç«¯æ¸²æŸ“çš„ï¼Œåœ¨&lt;code&gt;æœåŠ¡ç«¯&lt;/code&gt;æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åå¹¶ä¸”æ¸²æŸ“å‡ºé¦–å±é¡µé¢ï¼Œä¼šæºå¸¦ç€å‰©ä½™çš„è·¯ç”±ä¿¡æ¯é¢„ç•™ç»™&lt;code&gt;å®¢æˆ·ç«¯&lt;/code&gt;å»æ¸²æŸ“å…¶ä»–è·¯ç”±çš„é¡µé¢ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Nuxt.js ä»‹ç»&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨&lt;code&gt;Nuxt&lt;/code&gt;å®˜æ–¹ç½‘ç«™æœ‰ä¸€å¥è¿™æ ·çš„è¯ï¼š&lt;code&gt;Nuxt.js&lt;/code&gt;é¢„è®¾äº†ä½¿æ‚¨å¼€å‘&lt;code&gt;Vue.js&lt;/code&gt;åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰é…ç½®ã€‚&lt;code&gt;Nuxt&lt;/code&gt;æ˜¯ä¸€ä¸ªåŸºäº&lt;code&gt;Vue.js&lt;/code&gt;çš„é€šç”¨åº”ç”¨æ¡†æ¶ã€‚é€šè¿‡å¯¹&lt;code&gt;å®¢æˆ·ç«¯/æœåŠ¡ç«¯&lt;/code&gt;åŸºç¡€æ¡†æ¶çš„æŠ½è±¡ç»„ç»‡ï¼Œ&lt;code&gt;Nuxt&lt;/code&gt;ä¸»è¦å…³æ³¨çš„æ˜¯åº”ç”¨çš„&lt;code&gt;ui&lt;/code&gt;æ¸²æŸ“ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¸Šé¢çš„è¿™äº›ä»‹ç»å¯ä»¥ç®€å•çš„å¾—å‡ºï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;&lt;code&gt;Nuxt&lt;/code&gt;ä¸ä»…ä»…ç”¨äºæœåŠ¡ç«¯æ¸²æŸ“ä¹Ÿå¯ä»¥ç”¨äº&lt;code&gt;SPA&lt;/code&gt;åº”ç”¨çš„å¼€å‘&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨&lt;code&gt;Nuxt&lt;/code&gt;æä¾›çš„é¡¹ç›®ç»“æ„ã€å¼‚æ­¥æ•°æ®åŠ è½½ï¼Œä¸­é—´ä»¶çš„æ”¯æŒï¼Œå¸ƒå±€ç­‰ç‰¹æ€§å¯å¤§å¹…æå‡å¼€å‘æ•ˆç‡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Nuxt&lt;/code&gt;å¯ç”¨äºç½‘ç«™é™æ€åŒ–ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤å°†æ•´ä¸ªç½‘é¡µæ‰“åŒ…æˆé™æ€é¡µé¢ï¼Œä½¿&lt;code&gt;SEO&lt;/code&gt;æ›´åŠ å‹å¥½&lt;/li&gt;
&lt;/ol&gt;&lt;blockquote&gt;
&lt;p&gt;Nuxt.js ç‰¹æ€§&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;&lt;li&gt;åŸºäº&lt;code&gt;Vue&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨ä»£ç åˆ†å±‚&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯æ¸²æŸ“&lt;/li&gt;
&lt;li&gt;å¼ºå¤§çš„è·¯ç”±åŠŸèƒ½ï¼Œæ”¯æŒå¼‚æ­¥æ•°æ®&lt;/li&gt;
&lt;li&gt;é™æ€æ–‡ä»¶æœåŠ¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;EcmaScript6&lt;/code&gt;å’Œ&lt;code&gt;EcmaScript7&lt;/code&gt;çš„è¯­æ³•æ”¯æŒ&lt;/li&gt;
&lt;li&gt;æ‰“åŒ…å’Œå‹ç¼©&lt;code&gt;JavaScript&lt;/code&gt;å’Œ&lt;code&gt;Css&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;HTML&lt;/code&gt;å¤´éƒ¨æ ‡ç­¾ç®¡ç†&lt;/li&gt;
&lt;li&gt;æœ¬åœ°å¼€å‘æ”¯æŒçƒ­åŠ è½½&lt;/li&gt;
&lt;li&gt;é›†æˆ&lt;code&gt;ESLint&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ”¯æŒå„ç§æ ·å¼é¢„ç¼–è¯‘å™¨&lt;code&gt;SASS&lt;/code&gt;ã€&lt;code&gt;LESS&lt;/code&gt;ç­‰ç­‰&lt;/li&gt;
&lt;li&gt;æ”¯æŒ&lt;code&gt;HTTP/2&lt;/code&gt;æ¨é€&lt;/li&gt;
&lt;/ol&gt;&lt;blockquote&gt;
&lt;p&gt;Nuxt æ¸²æŸ“æµç¨‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸€ä¸ªå®Œæ•´çš„æœåŠ¡å™¨è¯·æ±‚åˆ°æ¸²æŸ“çš„æµç¨‹&lt;/p&gt;
&lt;img src=&quot;https://zh.nuxtjs.org/nuxt-schema.svg&quot;/&gt;&lt;p&gt;é€šè¿‡ä¸Šé¢çš„æµç¨‹å›¾å¯ä»¥çœ‹å‡ºï¼Œå½“ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚è¿›å…¥çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯æœ‰é€šè¿‡&lt;code&gt;nuxtServerInit&lt;/code&gt;è¿™ä¸ªå‘½ä»¤æ‰§è¡Œåœ¨&lt;code&gt;Store&lt;/code&gt;çš„&lt;code&gt;action&lt;/code&gt;ä¸­ï¼Œåœ¨è¿™é‡Œæ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™ï¼Œå¯ä»¥å°†ä¸€äº›å®¢æˆ·ç«¯ä¿¡æ¯å­˜å‚¨åˆ°&lt;code&gt;Store&lt;/code&gt;ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥æŠŠåœ¨æœåŠ¡ç«¯å­˜å‚¨çš„ä¸€äº›å®¢æˆ·ç«¯çš„ä¸€äº›ç™»å½•ä¿¡æ¯å­˜å‚¨åˆ°&lt;code&gt;Store&lt;/code&gt;ä¸­ã€‚ä¹‹åä½¿ç”¨äº†&lt;code&gt;ä¸­é—´ä»¶&lt;/code&gt;æœºåˆ¶ï¼Œä¸­é—´ä»¶å…¶å®å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šåœ¨æ¯ä¸ªè·¯ç”±æ‰§è¡Œä¹‹å‰å»æ‰§è¡Œï¼Œåœ¨è¿™é‡Œå¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œæˆ–è€…è¯´å¯ä»¥ç†è§£ä¸ºæ˜¯è·¯ç”±å™¨çš„æ‹¦æˆªå™¨çš„ä½œç”¨ã€‚ç„¶åå†&lt;code&gt;validate&lt;/code&gt;æ‰§è¡Œçš„æ—¶å€™å¯¹å®¢æˆ·ç«¯æºå¸¦çš„å‚æ•°è¿›è¡Œæ ¡éªŒï¼Œåœ¨&lt;code&gt;asyncData&lt;/code&gt;ä¸&lt;code&gt;fetch&lt;/code&gt;è¿›å…¥æ­£å¼çš„æ¸²æŸ“å‘¨æœŸï¼Œ&lt;code&gt;asyncData&lt;/code&gt;å‘æœåŠ¡ç«¯è·å–æ•°æ®ï¼ŒæŠŠè¯·æ±‚åˆ°çš„æ•°æ®åˆå¹¶åˆ°&lt;code&gt;Vue&lt;/code&gt;ä¸­çš„&lt;code&gt;data&lt;/code&gt;ä¸­ï¼Œ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Nuxtè¯´æ˜&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;Nuxt&lt;/code&gt;å®‰è£…ï¼š&lt;/p&gt;
&lt;p&gt;ç¡®ä¿å®‰è£…äº†npxï¼ˆnpxåœ¨NPMç‰ˆæœ¬5.2.0é»˜è®¤å®‰è£…äº†ï¼‰ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;npx create-nuxt-app &amp;lt;é¡¹ç›®å&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å®‰è£…å‘å¯¼ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Project name                                //  é¡¹ç›®åç§°
Project description                         //  é¡¹ç›®æè¿°
Use a custom server framework               //  é€‰æ‹©æœåŠ¡å™¨æ¡†æ¶
Choose features to install                  //  é€‰æ‹©å®‰è£…çš„ç‰¹æ€§
Use a custom UI framework                   //  é€‰æ‹©UIæ¡†æ¶
Use a custom test framework                 //  æµ‹è¯•æ¡†æ¶
Choose rendering mode                       //  æ¸²æŸ“æ¨¡å¼
    Universal                                   //  æ¸²æŸ“æ‰€æœ‰è¿æ¥é¡µé¢
    Single Page App                             //  åªæ¸²æŸ“å½“å‰é¡µé¢&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™äº›éƒ½æ˜¯æ¯”è¾ƒé‡è¦çš„å…¶ä»–çš„é…ç½®å†…å®¹å°±ä¸åšä»‹ç»äº†ï¼Œä¸€è·¯å›è½¦å³å¯ã€‚&lt;/p&gt;
&lt;h5 id=&quot;ç›®å½•ç»“æ„ä»‹ç»&quot;&gt;# ç›®å½•ç»“æ„ä»‹ç»&lt;/h5&gt;
&lt;pre&gt;
&lt;code&gt;assets              //  å­˜æ”¾ç´ æ(éœ€è¦æ‰§è¡Œwebpacké¢„å¤„ç†æ“ä½œ)
components          //  ç»„ä»¶
layouts             //  å¸ƒå±€æ–‡ä»¶
static              //  é™æ€æ–‡ä»¶(ä¸éœ€è¦webpacké¢„å¤„ç†æ“ä½œ)
middleware          //  ä¸­é—´ä»¶
pages               //  æ‰€æœ‰é¡µé¢
plugins             //  æ’ä»¶
server              //  æœåŠ¡ç«¯ä»£ç 
store               //  vuex&lt;/code&gt;
&lt;/pre&gt;
&lt;h5 id=&quot;é…ç½®æ–‡ä»¶&quot;&gt;# é…ç½®æ–‡ä»¶&lt;/h5&gt;
&lt;pre class=&quot;javascript&quot;&gt;
&lt;code&gt;const pkg = require('./package')
module.exports = {
  mode: 'universal',    //  å½“å‰æ¸²æŸ“ä½¿ç”¨æ¨¡å¼
  head: {       //  é¡µé¢headé…ç½®ä¿¡æ¯
    title: pkg.name,        //  title
    meta: [         //  meat
      { charset: 'utf-8' },
      { name: 'viewport', content: 'width=device-width, initial-scale=1' },
      { hid: 'description', name: 'description', content: pkg.description }
    ],
    link: [     //  faviconï¼Œè‹¥å¼•ç”¨cssä¸ä¼šè¿›è¡Œæ‰“åŒ…å¤„ç†
      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }
    ]
  },
  loading: { color: '#fff' },   //  é¡µé¢è¿›åº¦æ¡
  css: [    //  å…¨å±€cssï¼ˆä¼šè¿›è¡Œwebpackæ‰“åŒ…å¤„ç†ï¼‰
    'element-ui/lib/theme-chalk/index.css'  
  ],
  plugins: [        //  æ’ä»¶
    '@/plugins/element-ui'
  ],
  modules: [        //  æ¨¡å—
    '@nuxtjs/axios',
  ],
  axios: {},
  build: {      //  æ‰“åŒ…
    transpile: [/^element-ui/],
    extend(config, ctx) {       //  webpackè‡ªå®šä¹‰é…ç½®
    }
  }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h5 id=&quot;nuxtè¿è¡Œå‘½ä»¤&quot;&gt;# Nuxtè¿è¡Œå‘½ä»¤&lt;/h5&gt;
&lt;pre class=&quot;javascript&quot;&gt;
&lt;code&gt;{
  &quot;scripts&quot;: {
    //  å¼€å‘ç¯å¢ƒ
    &quot;dev&quot;: &quot;cross-env NODE_ENV=development nodemon server/index.js --watch server&quot;,
    //  æ‰“åŒ…
    &quot;build&quot;: &quot;nuxt build&quot;,
    //  åœ¨æœåŠ¡ç«¯è¿è¡Œ
    &quot;start&quot;: &quot;cross-env NODE_ENV=production node server/index.js&quot;,
    //  ç”Ÿæˆé™æ€é¡µé¢
    &quot;generate&quot;: &quot;nuxt generate&quot;
  }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;ç»“è¯­&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™é‡Œç®€å•çš„å¯¹&lt;code&gt;Nuxt&lt;/code&gt;åšäº†ä¸€äº›ä»‹ç»ï¼Œä¼šæŒç»­æ›´æ–°å¯¹&lt;code&gt;Nuxt&lt;/code&gt;çš„è·Ÿè¿›ï¼Œå¸Œæœ›ä¼šå¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ï¼Œå¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¯ä»¥åœ¨ä¸‹é¢ç•™è¨€ã€‚&lt;/p&gt;
</description>
<pubDate>Sat, 06 Apr 2019 13:56:00 +0000</pubDate>
<dc:creator>Aaron-æ”»åŸç‹®</dc:creator>
<og:description>ç°åœ¨å‰ç«¯å¼€å‘ä¸€èˆ¬éƒ½æ˜¯å‰åç«¯åˆ†ç¦»ï¼Œ å’Œ`mvc Angular React Vue SEO`å¸¦æ¥å¾ˆå¤§çš„ä¸ä¾¿ï¼Œæœç´¢å¼•æ“åœ¨æ£€ç´¢çš„æ—¶å€™æ˜¯åœ¨ç½‘é¡µä¸­çˆ¬å–æ•°æ®ï¼Œç”±äºå•é¡µé¢åº”ç”¨è¯»å–åˆ°çš„é¡µé¢æ˜¯å‡ ä¹ç©ºç™½çš„ï¼Œæ— æ³•çˆ¬å–åˆ°ä»»ä½•</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/aaron---blog/p/10663069.html</dc:identifier>
</item>
<item>
<title>Androidä¹‹Realmè¯¦è§£ - æ•…äº‹çˆ±äºº</title>
<link>http://www.cnblogs.com/WUXIAOCHANG/p/10662998.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/WUXIAOCHANG/p/10662998.html</guid>
<description>&lt;h2&gt;æ–‡ç« å¤§çº²&lt;/h2&gt;
&lt;p&gt;ä¸€ã€Realmä»‹ç»&lt;br/&gt;äºŒã€Realmå®æˆ˜&lt;br/&gt;ä¸‰ã€Realmå®˜æ–¹æ–‡æ¡£&lt;br/&gt;å››ã€é¡¹ç›®æºç ä¸‹è½½&lt;br/&gt;äº”ã€å‚è€ƒæ–‡ç« &lt;/p&gt;
&lt;div class=&quot;image-package&quot;&gt;
&lt;div class=&quot;image-container&quot;&gt;

&lt;div class=&quot;image-view&quot; data-width=&quot;714&quot; data-height=&quot;551&quot;&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/16598307-96c8b3b63629a3bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/714/format/webp&quot; alt=&quot;&quot; data-original-src=&quot;//upload-images.jianshu.io/upload_images/16598307-96c8b3b63629a3bc.png&quot; data-original-width=&quot;714&quot; data-original-height=&quot;551&quot; data-original-format=&quot;image/png&quot; data-original-filesize=&quot;63963&quot;/&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;ä¸€ã€Realmä»‹ç»&lt;/h2&gt;
&lt;h3&gt;1. ä»€ä¹ˆæ˜¯Realm&lt;/h3&gt;
&lt;p&gt;â€ƒâ€ƒRealm æ˜¯ä¸€ä¸ªæ‰‹æœºæ•°æ®åº“ï¼Œæ˜¯ç”¨æ¥æ›¿ä»£ SQlite çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯” SQlite æ›´è½»é‡çº§ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œå› ä¸ºå®ƒæœ‰ä¸€å¥—è‡ªå·±çš„æ•°æ®åº“æœç´¢å¼•æ“ï¼Œå¹¶ä¸”è¿˜å…·æœ‰å¾ˆå¤šç°ä»£æ•°æ®åº“çš„ä¼˜ç‚¹ï¼Œæ”¯æŒ JSONï¼Œæµå¼ API è°ƒç”¨ï¼Œæ•°æ®å˜æ›´é€šçŸ¥ï¼Œè‡ªåŠ¨æ•°æ®åŒæ­¥ï¼Œç®€å•èº«ä»½éªŒè¯ï¼Œè®¿é—®æ§åˆ¶ï¼Œäº‹ä»¶å¤„ç†ï¼Œæœ€é‡è¦çš„æ˜¯è·¨å¹³å°ï¼Œç›®å‰å·²ç»æ”¯æŒ Javaã€Swiftã€Object - Cã€React - Native ç­‰å¤šç§å®ç°ã€‚&lt;/p&gt;
&lt;h3&gt;2. Realmä¼˜åŠ¿&lt;/h3&gt;
&lt;p&gt;æ˜“ç”¨&lt;br/&gt;â€ƒâ€ƒReam ä¸æ˜¯åœ¨SQLiteåŸºç¡€ä¸Šçš„ORMï¼Œå®ƒæœ‰è‡ªå·±çš„æ•°æ®æŸ¥è¯¢å¼•æ“ã€‚å¹¶ä¸”ååˆ†å®¹æ˜“ä½¿ç”¨ã€‚&lt;br/&gt;å¿«é€Ÿ&lt;br/&gt;â€ƒâ€ƒç”±äºå®ƒæ˜¯å®Œå…¨é‡æ–°å¼€å§‹å¼€å‘çš„æ•°æ®åº“å®ç°ï¼Œæ‰€ä»¥å®ƒæ¯”ä»»ä½•çš„ORMé€Ÿåº¦éƒ½å¿«å¾ˆå¤šï¼Œç”šè‡³æ¯”SLiteé€Ÿåº¦éƒ½è¦å¿«ã€‚&lt;br/&gt;è·¨å¹³å°&lt;br/&gt;â€ƒâ€ƒRealm æ”¯æŒ iOS &amp;amp; OS X (Objectiveâ€‘C &amp;amp; Swift) &amp;amp; Androidã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™äº›å¹³å°ä¸Šå…±äº«Realmæ•°æ®åº“æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸Šå±‚é€»è¾‘å¯ä»¥ä¸ç”¨ä»»ä½•æ”¹åŠ¨çš„æƒ…å†µä¸‹å®ç°ç§»æ¤ã€‚&lt;br/&gt;é«˜çº§&lt;br/&gt;â€ƒâ€ƒReamæ”¯æŒåŠ å¯†ï¼Œæ ¼å¼åŒ–æŸ¥è¯¢ï¼Œæ˜“äºç§»æ¤ï¼Œæ”¯æŒJSONï¼Œæµå¼apiï¼Œæ•°æ®å˜æ›´é€šçŸ¥ç­‰é«˜çº§ç‰¹æ€§&lt;br/&gt;å¯è§†åŒ–&lt;br/&gt;â€ƒâ€ƒRealm è¿˜æä¾›äº†ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®åº“æŸ¥çœ‹å·¥å…·ï¼Œåœ¨Mac Appstore å¯ä»¥ä¸‹è½½â€œRealm Browserâ€è¿™ä¸ªå·¥å…·ï¼Œå¼€å‘è€…å¯ä»¥æŸ¥çœ‹æ•°æ®åº“å½“ä¸­çš„å†…å®¹ï¼Œæ‰§è¡Œç®€å•çš„æ’å…¥å’Œåˆ é™¤æ•°æ®çš„æ“ä½œã€‚ï¼ˆwindowsä¸Šè¿˜ä¸æ¸…æ¥šï¼‰&lt;/p&gt;
&lt;h4&gt;3. ä½¿ç”¨è¦æ±‚&lt;/h4&gt;
&lt;p&gt;ï¼ˆ1ï¼‰ç›®å‰ä¸æ”¯æŒAndroidä»¥å¤–çš„Java&lt;br/&gt;ï¼ˆ2ï¼‰Android Studio &amp;gt;= 1.5.1ï¼ˆä¸æ”¯æŒEclipseï¼‰&lt;br/&gt;ï¼ˆ3ï¼‰JDK version &amp;gt;=7.&lt;br/&gt;ï¼ˆ4ï¼‰æ”¯æŒAPI 9(Android 2.3)ä»¥åŠä¹‹åçš„ç‰ˆæœ¬&lt;/p&gt;
&lt;h2&gt;äºŒã€Realmå®æˆ˜&lt;/h2&gt;
&lt;h3&gt;1. æ·»åŠ ä¾èµ–&lt;/h3&gt;
&lt;p&gt;åœ¨projectçš„buildä¸­åŠ å…¥ä¾èµ–&lt;/p&gt;
&lt;pre class=&quot;hljs bash&quot;&gt;
&lt;code class=&quot;bash&quot;&gt;buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath &lt;span class=&quot;hljs-string&quot;&gt;&quot;io.realm:realm-gradle-plugin:2.2.1&quot;
    }
}
&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;div class=&quot;image-package&quot;&gt;
&lt;div class=&quot;image-container&quot;&gt;

&lt;div class=&quot;image-view&quot; data-width=&quot;682&quot; data-height=&quot;872&quot;&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/1638147-efd0042285b22de4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/682/format/webp&quot; alt=&quot;&quot; data-original-src=&quot;//upload-images.jianshu.io/upload_images/1638147-efd0042285b22de4.png&quot; data-original-width=&quot;682&quot; data-original-height=&quot;872&quot; data-original-format=&quot;&quot; data-original-filesize=&quot;187617&quot;/&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;image&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;åœ¨moduleä¸­åŠ å…¥&lt;/p&gt;
&lt;pre class=&quot;hljs bash&quot;&gt;
&lt;code class=&quot;bash&quot;&gt;apply plugin: &lt;span class=&quot;hljs-string&quot;&gt;'realm-android'
&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;div class=&quot;image-package&quot;&gt;
&lt;div class=&quot;image-container&quot;&gt;

&lt;div class=&quot;image-view&quot; data-width=&quot;638&quot; data-height=&quot;504&quot;&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/1638147-75617c94f75a302f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/638/format/webp&quot; alt=&quot;&quot; data-original-src=&quot;//upload-images.jianshu.io/upload_images/1638147-75617c94f75a302f.png&quot; data-original-width=&quot;638&quot; data-original-height=&quot;504&quot; data-original-format=&quot;&quot; data-original-filesize=&quot;142054&quot;/&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;2. åˆ›å»ºmodel&lt;/h3&gt;
&lt;p&gt;â€ƒâ€ƒåˆ›å»ºä¸€ä¸ªUserç±»ï¼Œéœ€è¦ç»§æ‰¿RealmObjectã€‚æ”¯æŒpublic, protectedå’Œ privateçš„ç±»ä»¥åŠæ–¹æ³•&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class &lt;span class=&quot;hljs-title&quot;&gt;User &lt;span class=&quot;hljs-keyword&quot;&gt;extends &lt;span class=&quot;hljs-title&quot;&gt;RealmObject {
    &lt;span class=&quot;hljs-keyword&quot;&gt;private String name;
    &lt;span class=&quot;hljs-keyword&quot;&gt;private &lt;span class=&quot;hljs-keyword&quot;&gt;int age;

    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public String &lt;span class=&quot;hljs-title&quot;&gt;getName&lt;span class=&quot;hljs-params&quot;&gt;() {
        &lt;span class=&quot;hljs-keyword&quot;&gt;return name;
    }

    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;setName&lt;span class=&quot;hljs-params&quot;&gt;(String name) {
        &lt;span class=&quot;hljs-keyword&quot;&gt;this.name = name;
    }

    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;int &lt;span class=&quot;hljs-title&quot;&gt;getAge&lt;span class=&quot;hljs-params&quot;&gt;() {
        &lt;span class=&quot;hljs-keyword&quot;&gt;return age;
    }

    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;setAge&lt;span class=&quot;hljs-params&quot;&gt;(&lt;span class=&quot;hljs-keyword&quot;&gt;int age) {
        &lt;span class=&quot;hljs-keyword&quot;&gt;this.age = age;
    }
}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;â€ƒâ€ƒé™¤äº†ç›´æ¥ç»§æ‰¿äºRealmObjectæ¥å£°æ˜ Realm æ•°æ®æ¨¡å‹ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å®ç° RealmModelæ¥å£å¹¶æ·»åŠ  @RealmClassä¿®é¥°ç¬¦æ¥å£°æ˜ã€‚&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@RealmClass
&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class &lt;span class=&quot;hljs-title&quot;&gt;User &lt;span class=&quot;hljs-keyword&quot;&gt;implements &lt;span class=&quot;hljs-title&quot;&gt;RealmModel {
    ...
}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ”¯æŒçš„å±æ€§&lt;br/&gt;boolean, byte, short,int,long,float, double,String, Date å’Œï¼Œbyte[], RealmObject, RealmList&amp;lt;? extends RealmObject&amp;gt;&lt;br/&gt;è¿˜æ”¯æŒBoolean, Byte, Short, Integer, Long, Float å’Œ Double&lt;br/&gt;æç¤ºï¼šæ•´æ•°ç±»å‹ shortã€int å’Œ long éƒ½è¢«æ˜ å°„åˆ° Realm å†…çš„ç›¸åŒç±»å‹ï¼ˆå®é™…ä¸Šä¸º long ï¼‰&lt;br/&gt;ï¼ˆ1ï¼‰@PrimaryKeyâ€”â€”è¡¨ç¤ºè¯¥å­—æ®µæ˜¯ä¸»é”®&lt;br/&gt;â€ƒâ€ƒä½¿ç”¨è¿‡æ•°æ®åº“çš„åŒå­¦åº”è¯¥çœ‹å‡ºæ¥äº†ï¼ŒPrimaryKeyå°±æ˜¯ä¸»é”®ã€‚ä½¿ç”¨@PrimaryKeyæ¥æ ‡æ³¨ï¼Œå­—æ®µç±»å‹å¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼ˆStringï¼‰æˆ–æ•´æ•°ï¼ˆbyteï¼Œshortï¼Œintæˆ–longï¼‰ä»¥åŠå®ƒä»¬çš„åŒ…è£…ç±»å‹ï¼ˆByte,Short, Integer, æˆ– Longï¼‰ã€‚ä¸å¯ä»¥å­˜åœ¨å¤šä¸ªä¸»é”®ï¼Œä½¿ç”¨å­—ç¬¦ä¸²å­—æ®µä½œä¸ºä¸»é”®æ„å‘³ç€å­—æ®µè¢«ç´¢å¼•ï¼ˆæ³¨é‡Š@PrimaryKeyéšå¼åœ°è®¾ç½®æ³¨é‡Š@Indexï¼‰ã€‚&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@PrimaryKey
&lt;span class=&quot;hljs-keyword&quot;&gt;private String id;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ï¼ˆ2ï¼‰@Requiredâ€”â€”è¡¨ç¤ºè¯¥å­—æ®µéç©º&lt;br/&gt;â€ƒâ€ƒåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæœ‰ä¸€äº›å±æ€§æ˜¯ä¸èƒ½ä¸ºnullçš„ã€‚ä½¿ç”¨@Requiredå¯ç”¨äºç”¨äºå¼ºè¡Œè¦æ±‚å…¶å±æ€§ä¸èƒ½ä¸ºç©ºï¼Œåªèƒ½ç”¨äºBoolean, Byte, Short, Integer, Long, Float, Double, String, byte[] å’Œ Dateã€‚åœ¨å…¶å®ƒç±»å‹å±æ€§ä¸Šä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆ3ï¼‰@Requiredä¿®é¥°ä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚&lt;br/&gt;â€ƒâ€ƒæç¤ºï¼šåŸºæœ¬æ•°æ®ç±»å‹ä¸éœ€è¦ä½¿ç”¨æ³¨è§£ @Requiredï¼Œå› ä¸ºä»–ä»¬æœ¬èº«å°±ä¸å¯ä¸ºç©ºã€‚&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@Required
&lt;span class=&quot;hljs-keyword&quot;&gt;private String name;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ï¼ˆ4ï¼‰@Ignoreâ€”â€”è¡¨ç¤ºå¿½ç•¥è¯¥å­—æ®µ&lt;br/&gt;â€ƒâ€ƒè¢«æ·»åŠ @Ignoreæ ‡ç­¾åï¼Œå­˜å‚¨æ•°æ®æ—¶ä¼šå¿½ç•¥è¯¥å­—æ®µã€‚&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@Ignore
&lt;span class=&quot;hljs-keyword&quot;&gt;private String name;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ï¼ˆ5ï¼‰@Indexâ€”â€”æ·»åŠ æœç´¢ç´¢å¼•&lt;br/&gt;â€ƒâ€ƒä¸ºå­—æ®µæ·»åŠ æœç´¢ç´¢å¼•ï¼Œè¿™æ ·ä¼šä½¿å¾—æ’å…¥çš„é€Ÿåº¦å˜æ…¢ï¼Œæ•°æ®é‡ä¹Ÿå˜å¾—æ›´å¤§ã€‚ä¸è¿‡åœ¨æŸ¥è¯¢é€Ÿåº¦å°†å˜å¾—æ›´å¿«ï¼Œå»ºè®®åªåœ¨ä¼˜åŒ–è¯»å–æ€§èƒ½çš„ç‰¹å®šæƒ…å†µæ—¶æ·»åŠ ç´¢å¼•ã€‚æ”¯æŒç´¢å¼•ï¼šStringï¼Œbyteï¼Œshortï¼Œintï¼Œlongï¼Œbooleanå’ŒDateå­—æ®µã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;æ³¨æ„ï¼šå¦‚æœä½ åˆ›å»ºModelå¹¶è¿è¡Œè¿‡ï¼Œç„¶åä¿®æ”¹äº†Modelã€‚é‚£ä¹ˆå°±éœ€è¦å‡çº§æ•°æ®åº“ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ã€‚å‡çº§æ–¹å¼åé¢ä¼šæåˆ°&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;3. åˆå§‹åŒ–Realm&lt;/h3&gt;
&lt;p&gt;é‡å†™Applicationç±»&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class &lt;span class=&quot;hljs-title&quot;&gt;MyApp &lt;span class=&quot;hljs-keyword&quot;&gt;extends &lt;span class=&quot;hljs-title&quot;&gt;Application {
    &lt;span class=&quot;hljs-meta&quot;&gt;@Override
    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;onCreate&lt;span class=&quot;hljs-params&quot;&gt;() {
        &lt;span class=&quot;hljs-keyword&quot;&gt;super.onCreate();
}
}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;AndroidManifest.xmlä¸­é…ç½®MyApp&lt;/p&gt;
&lt;div class=&quot;image-package&quot;&gt;
&lt;div class=&quot;image-container&quot;&gt;

&lt;div class=&quot;image-view&quot; data-width=&quot;791&quot; data-height=&quot;296&quot;&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/16598307-debc38c55beb9688.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/791/format/webp&quot; alt=&quot;&quot; data-original-src=&quot;//upload-images.jianshu.io/upload_images/16598307-debc38c55beb9688.png&quot; data-original-width=&quot;791&quot; data-original-height=&quot;296&quot; data-original-format=&quot;image/png&quot; data-original-filesize=&quot;65913&quot;/&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;åˆ›å»ºæ–¹å¼1&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class &lt;span class=&quot;hljs-title&quot;&gt;MyApp &lt;span class=&quot;hljs-keyword&quot;&gt;extends &lt;span class=&quot;hljs-title&quot;&gt;Application {
    &lt;span class=&quot;hljs-meta&quot;&gt;@Override
    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;onCreate&lt;span class=&quot;hljs-params&quot;&gt;() {
        &lt;span class=&quot;hljs-keyword&quot;&gt;super.onCreate();

        Realm.init(&lt;span class=&quot;hljs-keyword&quot;&gt;this);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;â€ƒâ€ƒè¿™æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªå«åš default.realmçš„Realmæ–‡ä»¶ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶ä½äº/data/data/åŒ…å/files/ã€‚é€šè¿‡realm.getPath()æ¥è·å¾—è¯¥Realmçš„ç»å¯¹è·¯å¾„ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºæ–¹å¼2&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class &lt;span class=&quot;hljs-title&quot;&gt;MyApp &lt;span class=&quot;hljs-keyword&quot;&gt;extends &lt;span class=&quot;hljs-title&quot;&gt;Application {
    &lt;span class=&quot;hljs-meta&quot;&gt;@Override
    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;onCreate&lt;span class=&quot;hljs-params&quot;&gt;() {
        &lt;span class=&quot;hljs-keyword&quot;&gt;super.onCreate();

        Realm.init(&lt;span class=&quot;hljs-keyword&quot;&gt;this);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åˆ›å»ºæ–¹å¼3&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class &lt;span class=&quot;hljs-title&quot;&gt;MyApp &lt;span class=&quot;hljs-keyword&quot;&gt;extends &lt;span class=&quot;hljs-title&quot;&gt;Application {
    &lt;span class=&quot;hljs-meta&quot;&gt;@Override
    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;onCreate&lt;span class=&quot;hljs-params&quot;&gt;() {
        &lt;span class=&quot;hljs-keyword&quot;&gt;super.onCreate();

        Realm.init(&lt;span class=&quot;hljs-keyword&quot;&gt;this);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åˆ›å»ºæ–¹å¼4&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class &lt;span class=&quot;hljs-title&quot;&gt;MyApp &lt;span class=&quot;hljs-keyword&quot;&gt;extends &lt;span class=&quot;hljs-title&quot;&gt;Application {
    &lt;span class=&quot;hljs-meta&quot;&gt;@Override
    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;onCreate&lt;span class=&quot;hljs-params&quot;&gt;() {
        &lt;span class=&quot;hljs-keyword&quot;&gt;super.onCreate();

        Realm.init(&lt;span class=&quot;hljs-keyword&quot;&gt;this);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ€»ç»“ï¼š&lt;br/&gt;RealmConfigurationæ”¯æŒçš„æ–¹æ³•ï¼š&lt;br/&gt;Builder.name : æŒ‡å®šæ•°æ®åº“çš„åç§°ã€‚å¦‚ä¸æŒ‡å®šé»˜è®¤åä¸ºdefaultã€‚&lt;br/&gt;Builder.schemaVersion : æŒ‡å®šæ•°æ®åº“çš„ç‰ˆæœ¬å·ã€‚&lt;br/&gt;Builder.encryptionKey : æŒ‡å®šæ•°æ®åº“çš„å¯†é’¥ã€‚&lt;br/&gt;Builder.migration : æŒ‡å®šè¿ç§»æ“ä½œçš„è¿ç§»ç±»ã€‚&lt;br/&gt;Builder.deleteRealmIfMigrationNeeded : å£°æ˜ç‰ˆæœ¬å†²çªæ—¶è‡ªåŠ¨åˆ é™¤åŸæ•°æ®åº“ã€‚&lt;br/&gt;Builder.inMemory : å£°æ˜æ•°æ®åº“åªåœ¨å†…å­˜ä¸­æŒä¹…åŒ–ã€‚&lt;br/&gt;build : å®Œæˆé…ç½®æ„å»ºã€‚&lt;/p&gt;
&lt;h3&gt;4. å…³é—­Realm&lt;/h3&gt;
&lt;p&gt;è®°å¾—ä½¿ç”¨å®Œåï¼Œåœ¨onDestroyä¸­å…³é—­Realm&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@Override 
&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;protected &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;onDestroy&lt;span class=&quot;hljs-params&quot;&gt;() { 
    &lt;span class=&quot;hljs-keyword&quot;&gt;super.onDestroy();
    &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h3&gt;5. è·å–realmå¯¹è±¡&lt;/h3&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class &lt;span class=&quot;hljs-title&quot;&gt;RealmHelper {
    &lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;static &lt;span class=&quot;hljs-keyword&quot;&gt;final String DB_NAME = &lt;span class=&quot;hljs-string&quot;&gt;&quot;myRealm.realm&quot;;
    &lt;span class=&quot;hljs-keyword&quot;&gt;private Realm mRealm;


    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-title&quot;&gt;RealmHelper&lt;span class=&quot;hljs-params&quot;&gt;(Context context) {

        mRealm = Realm.getDefaultInstance();
    }

&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public Realm &lt;span class=&quot;hljs-title&quot;&gt;getRealm&lt;span class=&quot;hljs-params&quot;&gt;(){

        &lt;span class=&quot;hljs-keyword&quot;&gt;return mRealm;
    }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h3&gt;6. å¢åŠ æ•°æ®&lt;/h3&gt;
&lt;p&gt;â€ƒâ€ƒå†™å…¥æ“ä½œéœ€è¦åœ¨äº‹åŠ¡ä¸­è¿›è¡Œï¼Œå¯ä»¥ä½¿ç”¨executeTransactionæ–¹æ³•æ¥å¼€å¯äº‹åŠ¡ã€‚&lt;br/&gt;ï¼ˆ1ï¼‰ä½¿ç”¨executeTransactionæ–¹æ³•æ’å…¥æ•°æ®&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;mRealm.executeTransaction(&lt;span class=&quot;hljs-keyword&quot;&gt;new Realm.Transaction() {
            &lt;span class=&quot;hljs-meta&quot;&gt;@Override
            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;execute&lt;span class=&quot;hljs-params&quot;&gt;(Realm realm) {
                User user = realm.createObject(User.class);
                user.setName(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Gavin&quot;);
                user.setAge(&lt;span class=&quot;hljs-number&quot;&gt;23);
            }
        });
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;â€ƒâ€ƒæ³¨æ„ï¼šå¦‚æœåœ¨UIçº¿ç¨‹ä¸­æ’å…¥è¿‡å¤šçš„æ•°æ®ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸»çº¿ç¨‹æ‹¥å¡ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆ2ï¼‰ä½¿ç”¨copyToRealmOrUpdateæˆ–copyToRealmæ–¹æ³•æ’å…¥æ•°æ®&lt;br/&gt;å½“Modelä¸­å­˜åœ¨ä¸»é”®çš„æ—¶å€™ï¼Œæ¨èä½¿ç”¨copyToRealmOrUpdateæ–¹æ³•æ’å…¥æ•°æ®ã€‚å¦‚æœå¯¹è±¡å­˜åœ¨ï¼Œå°±æ›´æ–°è¯¥å¯¹è±¡ï¼›åä¹‹ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚è‹¥è¯¥Modelæ²¡æœ‰ä¸»é”®ï¼Œä½¿ç”¨copyToRealmæ–¹æ³•ï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt; &lt;span class=&quot;hljs-keyword&quot;&gt;final User user = &lt;span class=&quot;hljs-keyword&quot;&gt;new User();
        user.setName(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Jack&quot;);
        user.setId(&lt;span class=&quot;hljs-string&quot;&gt;&quot;2&quot;);
        mRealm.executeTransaction(&lt;span class=&quot;hljs-keyword&quot;&gt;new Realm.Transaction() {
            &lt;span class=&quot;hljs-meta&quot;&gt;@Override
            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;execute&lt;span class=&quot;hljs-params&quot;&gt;(Realm realm) {
                realm.copyToRealmOrUpdate(user);
            }
        });
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¦‚æœä½ ç”¨çš„æ˜¯è¿™æ ·çš„modle&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class &lt;span class=&quot;hljs-title&quot;&gt;User2 &lt;span class=&quot;hljs-keyword&quot;&gt;extends &lt;span class=&quot;hljs-title&quot;&gt;RealmObject {
      &lt;span class=&quot;hljs-keyword&quot;&gt;public String name;
      &lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;int age;
}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å°±è¿™æ ·å†™&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;mRealm.executeTransaction(&lt;span class=&quot;hljs-keyword&quot;&gt;new Realm.Transaction() {
            &lt;span class=&quot;hljs-meta&quot;&gt;@Override
            &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;execute&lt;span class=&quot;hljs-params&quot;&gt;(Realm realm) {
                User2 user = realm.createObject(User2.class);
                user.name = &lt;span class=&quot;hljs-string&quot;&gt;&quot;Micheal&quot;;
                user.age = &lt;span class=&quot;hljs-number&quot;&gt;30;
            }
        });
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ï¼ˆ3ï¼‰ä¸Šé¢éƒ½æ˜¯ç”¨å¯executeTransactionæ–¹æ³•æ’å…¥æ•°æ®ï¼Œè¿˜æœ‰å¦ä¸€ç§æ–¹æ³•å¯ä»¥ç”¨äºæ’å…¥æ•°æ®â€”â€”beginTransactionå’ŒcommitTransaction&lt;/p&gt;
&lt;pre class=&quot;hljs ruby&quot;&gt;
&lt;code class=&quot;ruby&quot;&gt;mRealm.beginTransaction();&lt;span class=&quot;hljs-regexp&quot;&gt;//å¼€å¯äº‹åŠ¡
User user = mRealm.createObject(User.&lt;span class=&quot;hljs-keyword&quot;&gt;class);
user.setName(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Gavin&quot;);
user.setId(&lt;span class=&quot;hljs-string&quot;&gt;&quot;3&quot;);
mRealm.commitTransaction();&lt;span class=&quot;hljs-regexp&quot;&gt;//æäº¤äº‹åŠ¡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;â€ƒâ€ƒåœ¨æ’å…¥å‰ï¼Œå…ˆè°ƒç”¨beginTransaction()ï¼Œå®Œæˆåè°ƒç”¨commitTransaction()å³å¯ã€‚&lt;br/&gt;â€ƒâ€ƒæ³¨æ„ï¼šåœ¨UIå’Œåå°çº¿ç¨‹åŒæ—¶å¼€å¯åˆ›å»ºwriteçš„äº‹åŠ¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ANRé”™è¯¯ã€‚ä¸ºäº†é¿å…è¯¥é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨executeTransactionAsyncæ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆ4ï¼‰ä½¿ç”¨executeTransactionAsync&lt;br/&gt;è¯¥æ–¹æ³•ä¼šå¼€å¯ä¸€ä¸ªå­çº¿ç¨‹æ¥æ‰§è¡Œäº‹åŠ¡ï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œå®Œæˆåè¿›è¡Œç»“æœé€šçŸ¥ã€‚&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;RealmAsyncTask transaction = mRealm.executeTransactionAsync(&lt;span class=&quot;hljs-keyword&quot;&gt;new Realm.Transaction() {
    &lt;span class=&quot;hljs-meta&quot;&gt;@Override
    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;execute&lt;span class=&quot;hljs-params&quot;&gt;(Realm realm) {
        User user = realm.createObject(User.class);
        user.setName(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Eric&quot;);
        user.setId(&lt;span class=&quot;hljs-string&quot;&gt;&quot;4&quot;);
      }
});
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿˜å¯ä»¥åŠ å…¥ç›‘å¬&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;RealmAsyncTask transaction =  mRealm.executeTransactionAsync(&lt;span class=&quot;hljs-keyword&quot;&gt;new Realm.Transaction() {
    &lt;span class=&quot;hljs-meta&quot;&gt;@Override
    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;execute&lt;span class=&quot;hljs-params&quot;&gt;(Realm realm) {
        User user = realm.createObject(User.class);
        user.setName(&lt;span class=&quot;hljs-string&quot;&gt;&quot;Eric&quot;);
        user.setId(&lt;span class=&quot;hljs-string&quot;&gt;&quot;4&quot;);
      }
}, &lt;span class=&quot;hljs-keyword&quot;&gt;new Realm.Transaction.OnSuccess() {
    &lt;span class=&quot;hljs-meta&quot;&gt;@Override
    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;onSuccess&lt;span class=&quot;hljs-params&quot;&gt;() {
        &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;â€ƒâ€ƒæ³¨æ„ï¼šå¦‚æœå½“Acitivityæˆ–Fragmentè¢«é”€æ¯æ—¶ï¼Œåœ¨OnSuccessæˆ–OnErrorä¸­æ‰§è¡ŒUIæ“ä½œï¼Œå°†å¯¼è‡´ç¨‹åºå¥”æºƒ ã€‚ç”¨RealmAsyncTask .cancel();å¯ä»¥å–æ¶ˆäº‹åŠ¡åœ¨onStopä¸­è°ƒç”¨ï¼Œé¿å…crash&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;onStop &lt;span class=&quot;hljs-params&quot;&gt;() {
    &lt;span class=&quot;hljs-keyword&quot;&gt;if (transaction != &lt;span class=&quot;hljs-keyword&quot;&gt;null &amp;amp;&amp;amp; !transaction.isCancelled()) {
        transaction.cancel();
      }
}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ï¼ˆ5ï¼‰Realmè¿˜æ˜¯ä¸ªå¾ˆå¥½çš„åŠŸèƒ½å°±æ˜¯å°†Jsonå­—ç¬¦ä¸²è½¬åŒ–ä¸ºå¯¹è±¡&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;/&gt;
&lt;/pre&gt;
&lt;p&gt;Realm è§£æ JSON æ—¶éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š&lt;br/&gt;ä½¿ç”¨åŒ…å«ç©ºå€¼ï¼ˆnullï¼‰çš„ JSON åˆ›å»ºå¯¹è±¡ï¼š&lt;br/&gt;å¯¹äºéå¿…é¡»ï¼ˆå¯ä¸ºç©ºå€¼çš„å±æ€§ï¼‰ï¼Œè®¾ç½®å…¶å€¼ä¸º nullï¼›&lt;br/&gt;å¯¹äºå¿…é¡»ï¼ˆä¸å¯ä¸ºç©ºå€¼çš„å±æ€§ï¼‰ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼›&lt;br/&gt;ä½¿ç”¨åŒ…å«ç©ºå€¼ï¼ˆnullï¼‰çš„ JSON æ›´æ–°å¯¹è±¡ï¼š&lt;br/&gt;å¯¹äºéå¿…é¡»ï¼ˆå¯ä¸ºç©ºå€¼çš„å±æ€§ï¼‰ï¼Œè®¾ç½®å…¶å€¼ä¸º nullï¼›&lt;br/&gt;å¯¹äºå¿…é¡»ï¼ˆä¸å¯ä¸ºç©ºå€¼çš„å±æ€§ï¼‰ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼›&lt;br/&gt;ä½¿ç”¨ä¸åŒ…å«å¯¹åº”å±æ€§çš„ JSONï¼š * è¯¥å±æ€§ä¿æŒä¸å˜&lt;/p&gt;
&lt;h3&gt;7. æŸ¥è¯¢æ•°æ®&lt;/h3&gt;
&lt;p&gt;æŸ¥æ‰¾æ“ä½œå°±æ¯”æ’å…¥æ–¹ä¾¿å¤šäº†ï¼Œå¹¶ä¸éœ€åœ¨äº‹åŠ¡ä¸­æ“ä½œï¼Œç›´æ¥æŸ¥è¯¢å³å¯ã€‚&lt;br/&gt;ï¼ˆ1ï¼‰findAll â€”â€”æŸ¥è¯¢&lt;br/&gt;ä¾‹ï¼šæŸ¥è¯¢æ‰€æœ‰çš„User&lt;/p&gt;
&lt;pre class=&quot;hljs python&quot;&gt;
&lt;code class=&quot;python&quot;&gt;RealmResults&amp;lt;User&amp;gt; userList = mRealm.where(User.&lt;span class=&quot;hljs-keyword&quot;&gt;class).findAll();
&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;(2)findAllAsyncâ€”â€”å¼‚æ­¥æŸ¥è¯¢&lt;br/&gt;å½“æ•°æ®é‡è¾ƒå¤§ï¼Œå¯èƒ½ä¼šå¼•èµ·ANRçš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨findAllAsync&lt;/p&gt;
&lt;pre class=&quot;hljs python&quot;&gt;
&lt;code class=&quot;python&quot;&gt;RealmResults&amp;lt;User&amp;gt; userList = mRealm.where(User.&lt;span class=&quot;hljs-keyword&quot;&gt;class)
                .equalTo(&lt;span class=&quot;hljs-string&quot;&gt;&quot;name&quot;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;Gavin&quot;)
                .findAllAsync();
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;(3)findFirst â€”â€”æŸ¥è¯¢ç¬¬ä¸€æ¡æ•°æ®&lt;br/&gt;ä¾‹ï¼šæŸ¥è¯¢Userè¡¨ä¸­çš„ç¬¬ä¸€æ¡æ•°æ®&lt;/p&gt;
&lt;pre class=&quot;hljs python&quot;&gt;
&lt;code class=&quot;python&quot;&gt;User user2 = mRealm.where(User.&lt;span class=&quot;hljs-keyword&quot;&gt;class).findFirst();
&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;(4)equalTo â€”â€”æ ¹æ®æ¡ä»¶æŸ¥è¯¢&lt;br/&gt;ä¾‹ï¼šå¾—åˆ°nameä¸ºGavinçš„ç”¨æˆ·åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;pre class=&quot;hljs python&quot;&gt;
&lt;code class=&quot;python&quot;&gt;RealmResults&amp;lt;User&amp;gt; userList = mRealm.where(User.&lt;span class=&quot;hljs-keyword&quot;&gt;class)
            .equalTo(&lt;span class=&quot;hljs-string&quot;&gt;&quot;name&quot;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;Gavin&quot;).findAll();
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¦‚æœUserä¸­è¿˜æœ‰Dogå±æ€§ï¼Œå¸Œæœ›æ ¹æ®Dogçš„æ¡ä»¶æ¥è·å–ç”¨æˆ·ï¼š&lt;br/&gt;ä¾‹ï¼šæŸ¥è¯¢dogs.nameä¸ºäºŒå“ˆçš„User&lt;/p&gt;
&lt;pre class=&quot;hljs python&quot;&gt;
&lt;code class=&quot;python&quot;&gt;RealmResults&amp;lt;User&amp;gt; userList = mRealm.where(User.&lt;span class=&quot;hljs-keyword&quot;&gt;class)
             .equalTo(&lt;span class=&quot;hljs-string&quot;&gt;&quot;dogs.name&quot;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;äºŒå“ˆ&quot;).findAll();
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;â€ƒâ€ƒå¾—åˆ°æœ‰å…»æœ‰dogs.nameä¸ºâ€äºŒå“ˆâ€çš„ç”¨æˆ·åˆ—è¡¨ï¼ˆè¿™é‡Œçš„dogsæ˜¯Userè¡¨ä¸­çš„å±æ€§åï¼‰&lt;/p&gt;
&lt;p&gt;(5)equalTo â€”â€”å¤šæ¡ä»¶æŸ¥è¯¢&lt;br/&gt;å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜ç»å¸¸è¦ç”¨åˆ°å¤šæ¡ä»¶çš„æŸ¥è¯¢çš„åŠŸèƒ½ã€‚&lt;br/&gt;ä¾‹ï¼šæ‰¾åˆ°ç”¨æˆ·åä¸ºâ€œGavinâ€ï¼Œä¸”dogs.nameä¸ºâ€œäºŒå“ˆâ€çš„User&lt;/p&gt;
&lt;pre class=&quot;hljs python&quot;&gt;
&lt;code class=&quot;python&quot;&gt;RealmResults&amp;lt;User&amp;gt; userList = mRealm.where(User.&lt;span class=&quot;hljs-keyword&quot;&gt;class)
            .equalTo(&lt;span class=&quot;hljs-string&quot;&gt;&quot;name&quot;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;Gavin&quot;).findAll();
RealmResults&amp;lt;User&amp;gt; userList = user5.where()
            .equalTo(&lt;span class=&quot;hljs-string&quot;&gt;&quot;dogs.name&quot;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;äºŒå“ˆ&quot;).findAll();
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ï¼ˆ6ï¼‰æ’åº&lt;br/&gt;æŸ¥è¯¢ç»“æŸåï¼Œè¿˜å¯ä»¥è¿›è¡Œæ’åºï¼Œå°±åƒè¿™æ ·ï¼š&lt;/p&gt;
&lt;pre class=&quot;hljs ruby&quot;&gt;
&lt;code class=&quot;ruby&quot;&gt;RealmResults&amp;lt;User&amp;gt; userList = mRealm.where(User.&lt;span class=&quot;hljs-keyword&quot;&gt;class) .findAll();
userList = result.sort(&lt;span class=&quot;hljs-string&quot;&gt;&quot;age&quot;); &lt;span class=&quot;hljs-regexp&quot;&gt;//æ ¹æ®ageï¼Œæ­£åºæ’åˆ—
userList = result.sort(&lt;span class=&quot;hljs-string&quot;&gt;&quot;age&quot;, Sort.DESCENDING);&lt;span class=&quot;hljs-regexp&quot;&gt;//é€†åºæ’åˆ—
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ï¼ˆ7ï¼‰èšåˆ&lt;br/&gt;RealmResultè‡ªå¸¦ä¸€äº›èšåˆæ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre class=&quot;hljs cpp&quot;&gt;
&lt;code class=&quot;cpp&quot;&gt;RealmResults&amp;lt;User&amp;gt; results = realm.where(User.class).findAll();
&lt;span class=&quot;hljs-keyword&quot;&gt;long   sum     = results.sum(&lt;span class=&quot;hljs-string&quot;&gt;&quot;age&quot;).longValue();
&lt;span class=&quot;hljs-keyword&quot;&gt;long   min     = results.min(&lt;span class=&quot;hljs-string&quot;&gt;&quot;age&quot;).longValue();
&lt;span class=&quot;hljs-keyword&quot;&gt;long   max     = results.max(&lt;span class=&quot;hljs-string&quot;&gt;&quot;age&quot;).longValue();
&lt;span class=&quot;hljs-keyword&quot;&gt;double average = results.average(&lt;span class=&quot;hljs-string&quot;&gt;&quot;age&quot;);
&lt;span class=&quot;hljs-keyword&quot;&gt;long   matches = results.size();
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ï¼ˆ8ï¼‰æ›´å¤šæŸ¥è¯¢æ¡ä»¶&lt;br/&gt;â€ƒâ€ƒä¸Šé¢å°±å±•ç¤ºäº†equalToçš„ç”¨æ³•ã€‚å½“ç„¶ï¼ŒæŸ¥è¯¢è¿˜æœ‰æ›´å¤šçš„ç”¨æ³•ï¼Œæˆ‘å°±ä¸ä¸€ä¸€ç¤ºä¾‹äº†ã€‚å·²çŸ¥çš„æ–¹æ³•å¦‚ä¸‹ï¼š&lt;br/&gt;sum()ï¼šå¯¹æŒ‡å®šå­—æ®µæ±‚å’Œã€‚&lt;br/&gt;average()ï¼šå¯¹æŒ‡å®šå­—æ®µæ±‚å¹³å‡å€¼ã€‚&lt;br/&gt;min(): å¯¹æŒ‡å®šå­—æ®µæ±‚æœ€å°å€¼ã€‚&lt;br/&gt;max() : å¯¹æŒ‡å®šå­—æ®µæ±‚æœ€å¤§å€¼ã€‚count : æ±‚ç»“æœé›†çš„è®°å½•æ•°é‡ã€‚&lt;br/&gt;findAll(): è¿”å›ç»“æœé›†æ‰€æœ‰å­—æ®µï¼Œè¿”å›å€¼ä¸ºRealmResultsé˜Ÿåˆ—&lt;br/&gt;findAllSorted() : æ’åºè¿”å›ç»“æœé›†æ‰€æœ‰å­—æ®µï¼Œè¿”å›å€¼ä¸ºRealmResultsé˜Ÿåˆ—&lt;br/&gt;between(), greaterThan(),lessThan(), greaterThanOrEqualTo() &amp;amp; lessThanOrEqualTo()&lt;br/&gt;equalTo() &amp;amp; notEqualTo()&lt;br/&gt;contains(), beginsWith() &amp;amp; endsWith()&lt;br/&gt;isNull() &amp;amp; isNotNull()&lt;br/&gt;isEmpty()&amp;amp; isNotEmpty()&lt;/p&gt;
&lt;h4&gt;8. ä¿®æ”¹æ•°æ®&lt;/h4&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;mRealm.executeTransaction(&lt;span class=&quot;hljs-keyword&quot;&gt;new Realm.Transaction() {
    &lt;span class=&quot;hljs-meta&quot;&gt;@Override
    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;execute&lt;span class=&quot;hljs-params&quot;&gt;(Realm realm) {
        &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¿®æ”¹ä¹Ÿæ˜¯éœ€è¦åœ¨äº‹åŠ¡ä¸­æ“ä½œã€‚ä½¿ç”¨æŸ¥è¯¢è¯­å¥å¾—åˆ°æ•°æ®ï¼Œç„¶åå°†å†…å®¹æ”¹äº†å³å¯ã€‚&lt;/p&gt;
&lt;h3&gt;9. åˆ é™¤æ•°æ®&lt;/h3&gt;
&lt;p&gt;(1)ä½¿ç”¨deleteFromRealm()&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;/&gt;
&lt;/pre&gt;
&lt;p&gt;(2)ä½¿ç”¨deleteFromRealm(int index)&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;mRealm.executeTransaction(&lt;span class=&quot;hljs-keyword&quot;&gt;new Realm.Transaction() {
    &lt;span class=&quot;hljs-meta&quot;&gt;@Override
    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;execute&lt;span class=&quot;hljs-params&quot;&gt;(Realm realm) {
        userList.deleteFromRealm(&lt;span class=&quot;hljs-number&quot;&gt;0);
    }
});
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;(3)å…¶ä»–æ–¹æ³•&lt;/p&gt;
&lt;pre class=&quot;hljs cpp&quot;&gt;
&lt;code class=&quot;cpp&quot;&gt;userList.deleteFirstFromRealm(); &lt;/code&gt;
&lt;/pre&gt;
&lt;h3&gt;10. å¼‚æ­¥ä»»åŠ¡æ³¨æ„ç‚¹&lt;/h3&gt;
&lt;p&gt;æœ€ååœ¨é”€æ¯Activityæˆ–Fragmentæ—¶ï¼Œè¦å–æ¶ˆæ‰å¼‚æ­¥ä»»åŠ¡&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@Override
    &lt;span class=&quot;hljs-function&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;protected &lt;span class=&quot;hljs-keyword&quot;&gt;void &lt;span class=&quot;hljs-title&quot;&gt;onDestroy&lt;span class=&quot;hljs-params&quot;&gt;() {
        &lt;span class=&quot;hljs-keyword&quot;&gt;super.onDestroy();
       &lt;span class=&quot;hljs-keyword&quot;&gt;if (deleteTask!=&lt;span class=&quot;hljs-keyword&quot;&gt;null&amp;amp;&amp;amp;!addTask.isCancelled()){
            deleteTask.cancel();
        }
    }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h3&gt;11. å…¶ä»–å¸¸è§æ“ä½œ&lt;/h3&gt;
&lt;p&gt;API:RealmObjectSchema&lt;br/&gt;ï¼ˆ1ï¼‰å–æ¶ˆidå¿…å¡«&lt;/p&gt;
&lt;pre class=&quot;hljs bash&quot;&gt;
&lt;code class=&quot;bash&quot;&gt;personSchema.setNullable(&lt;span class=&quot;hljs-string&quot;&gt;&quot;id&quot;, &lt;span class=&quot;hljs-literal&quot;&gt;true):
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ï¼ˆ2ï¼‰ç§»é™¤idå­—æ®µ&lt;/p&gt;
&lt;pre class=&quot;hljs bash&quot;&gt;
&lt;code class=&quot;bash&quot;&gt;personSchema.removeField(&lt;span class=&quot;hljs-string&quot;&gt;&quot;id&quot;);
&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ï¼ˆ3ï¼‰é‡å‘½å&lt;/p&gt;
&lt;pre class=&quot;hljs bash&quot;&gt;
&lt;code class=&quot;bash&quot;&gt;personSchema..renameField(&lt;span class=&quot;hljs-string&quot;&gt;&quot;id&quot;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;userId&quot;);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;API:DynamicRealmObject&lt;br/&gt;ï¼ˆ4ï¼‰è·å–id&lt;/p&gt;
&lt;pre class=&quot;hljs javascript&quot;&gt;
&lt;code class=&quot;javascript&quot;&gt;&lt;span class=&quot;hljs-built_in&quot;&gt;String id = obj.getString(&lt;span class=&quot;hljs-string&quot;&gt;&quot;id&quot;);
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ï¼ˆ5ï¼‰ä¸ºå­—æ®µè®¾ç½®å€¼&lt;/p&gt;
&lt;pre class=&quot;hljs bash&quot;&gt;
&lt;code class=&quot;bash&quot;&gt;obj.setString(&lt;span class=&quot;hljs-string&quot;&gt;&quot;name&quot;, &lt;span class=&quot;hljs-string&quot;&gt;&quot;Gavin&quot;);
obj.setInt(&lt;span class=&quot;hljs-string&quot;&gt;&quot;id&quot;, 1);
obj.setLong(&lt;span class=&quot;hljs-string&quot;&gt;&quot;id&quot;, 1);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h3&gt;12. æ•°æ®åº“ç‰ˆæœ¬å‡çº§&lt;/h3&gt;
&lt;p&gt;â€ƒâ€ƒå½“æ•°æ®ç»“æ„å‘ç”Ÿå˜åŒ–æ˜¯ï¼Œéœ€è¦å‡çº§æ•°æ®åº“ã€‚å¯¹äºRealmæ¥è¯´ï¼Œæ•°æ®åº“å‡çº§å°±æ˜¯è¿ç§»æ“ä½œï¼ŒæŠŠåŸæ¥çš„æ•°æ®åº“è¿ç§»åˆ°æ–°ç»“æ„çš„æ•°æ®åº“&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒä¾‹1ï¼šUserç±»å‘ç”Ÿå˜åŒ–ï¼Œç§»é™¤ageï¼Œæ–°å¢ä¸ª@Requiredçš„idå­—æ®µã€‚&lt;br/&gt;Userç‰ˆæœ¬ï¼šversion 0&lt;/p&gt;
&lt;pre class=&quot;hljs cpp&quot;&gt;
&lt;code class=&quot;cpp&quot;&gt;String name;
&lt;span class=&quot;hljs-keyword&quot;&gt;int    age;
&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Userç‰ˆæœ¬ï¼šversion 1&lt;/p&gt;
&lt;pre class=&quot;hljs javascript&quot;&gt;
&lt;code class=&quot;javascript&quot;&gt;@Required
&lt;span class=&quot;hljs-built_in&quot;&gt;String    id;
&lt;span class=&quot;hljs-built_in&quot;&gt;String name;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åˆ›å»ºè¿ç§»ç±»CustomMigrationï¼Œéœ€è¦å®ç°RealmMigrationæ¥å£ã€‚æ‰§è¡Œç‰ˆæœ¬å‡çº§æ—¶çš„å¤„ç†ï¼š&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt; &lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨Builder.migrationå‡çº§æ•°æ®åº“ï¼Œå°†ç‰ˆæœ¬å·æ”¹ä¸º1ï¼ˆåŸç‰ˆæœ¬å·ï¼š0ï¼‰ã€‚å½“Realmå‘ç°æ–°æ—§ç‰ˆæœ¬å·ä¸ä¸€è‡´æ—¶ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨è¯¥è¿ç§»ç±»å®Œæˆè¿ç§»æ“ä½œã€‚&lt;/p&gt;
&lt;pre class=&quot;hljs cpp&quot;&gt;
&lt;code class=&quot;cpp&quot;&gt;RealmConfiguration config = &lt;span class=&quot;hljs-keyword&quot;&gt;new RealmConfiguration.Builder() 
            .name(&lt;span class=&quot;hljs-string&quot;&gt;&quot;myrealm.realm&quot;) &lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¾‹2ï¼šåŠ å…¥Dogç±»ï¼ŒUserä¸­åŠ å…¥Dogé›†åˆã€‚&lt;br/&gt;Userç‰ˆæœ¬ï¼šversion 1&lt;/p&gt;
&lt;pre class=&quot;hljs javascript&quot;&gt;
&lt;code class=&quot;javascript&quot;&gt;@Required
&lt;span class=&quot;hljs-built_in&quot;&gt;String    id;
&lt;span class=&quot;hljs-built_in&quot;&gt;String name;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Userç‰ˆæœ¬ï¼šversion 2&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-meta&quot;&gt;@Required
&lt;span class=&quot;hljs-keyword&quot;&gt;private String id;
&lt;span class=&quot;hljs-keyword&quot;&gt;private String name;
&lt;span class=&quot;hljs-keyword&quot;&gt;private RealmList&amp;lt;Dog&amp;gt; dogs;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Dogç±»&lt;/p&gt;
&lt;pre class=&quot;hljs java&quot;&gt;
&lt;code class=&quot;java&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;public &lt;span class=&quot;hljs-class&quot;&gt;&lt;span class=&quot;hljs-keyword&quot;&gt;class &lt;span class=&quot;hljs-title&quot;&gt;Dog &lt;span class=&quot;hljs-keyword&quot;&gt;extends &lt;span class=&quot;hljs-title&quot;&gt;RealmObject {
        &lt;span class=&quot;hljs-keyword&quot;&gt;private String name;
        &lt;span class=&quot;hljs-keyword&quot;&gt;private &lt;span class=&quot;hljs-keyword&quot;&gt;int age;
}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨è¿ç§»ç±»CustomMigrationä¸­ï¼Œç»§ç»­æ·»åŠ å¤„ç†æ–¹æ³•ã€‚&lt;/p&gt;
&lt;pre class=&quot;hljs cpp&quot;&gt;
&lt;code class=&quot;cpp&quot;&gt;(oldVersion == &lt;span class=&quot;hljs-number&quot;&gt;1 &amp;amp;&amp;amp; newVersion == &lt;span class=&quot;hljs-number&quot;&gt;2) {
                &lt;/span&gt;&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h2&gt;ä¸‰ã€Realmå®˜æ–¹æ–‡æ¡£&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://links.jianshu.com/go?to=https%3A%2F%2Frealm.io%2Fcn%2Fdocs%2Fjava%2Flatest%2F&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;https://realm.io/cn/docs/java/latest/&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;å››ã€é¡¹ç›®æºç ä¸‹è½½&lt;/h2&gt;
&lt;p&gt;é“¾æ¥:&lt;a href=&quot;https://links.jianshu.com/go?to=https%3A%2F%2Fpan.baidu.com%2Fs%2F1wSoXuclZ-Nwntnw_79xkLA&quot; rel=&quot;nofollow&quot; target=&quot;_blank&quot;&gt;https://pan.baidu.com/s/1wSoXuclZ-Nwntnw_79xkLA&lt;/a&gt;&lt;br/&gt;å¯†ç :oc95&lt;/p&gt;
&lt;h2&gt;äº”ã€å‚è€ƒæ–‡ç« &lt;/h2&gt;

</description>
<pubDate>Sat, 06 Apr 2019 13:37:00 +0000</pubDate>
<dc:creator>æ•…äº‹çˆ±äºº</dc:creator>
<og:description>æ–‡ç« å¤§çº² ä¸€ã€Realmä»‹ç»äºŒã€Realmå®æˆ˜ä¸‰ã€Realmå®˜æ–¹æ–‡æ¡£å››ã€é¡¹ç›®æºç ä¸‹è½½äº”ã€å‚è€ƒæ–‡ç«  ä¸€ã€Realmä»‹ç» 1. ä»€ä¹ˆæ˜¯Realm Realm æ˜¯ä¸€ä¸ªæ‰‹æœºæ•°æ®åº“ï¼Œæ˜¯ç”¨æ¥æ›¿ä»£ SQlite çš„</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/WUXIAOCHANG/p/10662998.html</dc:identifier>
</item>
<item>
<title>å®¹å™¨åŒ–æ—¶ä»£æˆ‘ä»¬åº”å½“é€‰æ‹©Kubernetes - å¼ å–„å‹</title>
<link>http://www.cnblogs.com/shanyou/p/10662958.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/shanyou/p/10662958.html</guid>
<description>&lt;p&gt;å‰å¤©å‘çš„æ–‡ç« ã€Š&lt;a href=&quot;https://www.cnblogs.com/shanyou/p/10658110.html&quot;&gt;åŸºäºKubernetes æ„å»º.NET Core çš„æŠ€æœ¯ä½“ç³»&lt;/a&gt;ã€‹ï¼Œæœ‰åŒå­¦é—®.NET Coreä¸Šæœ‰Spring Cloudç±»ä¼¼çš„å¹³å°å—ï¼Ÿ .NET Coreå‡ºç°è¿™ä¹ˆä¹…äº†ï¼Œè¿™ä¸ªä¸ºäº‘åŸç”Ÿåº”ç”¨å¼€å‘è€Œå‡†å¤‡çš„ç³»ç»Ÿéœ€è¦Spring cloudè¿™æ ·çš„å…¨å®¶æ¡¶å—ï¼Ÿä»Šå¤©å†™ä¸‹è¿™ç¯‡æ–‡ç« çš„ç›®çš„å°±æ˜¯é™ˆè¿°ä¸€ä¸‹å®¹å™¨åŒ–æ—¶ä»£è¿˜éœ€è¦Spring Cloudè¿™æ ·çš„åŸºç¡€è®¾æ–½å—ï¼Ÿ å¤§å®¶å¸Œæœ›ä½¿ç”¨Spring Cloudçš„åˆè¡·éƒ½æ˜¯ä¸ºäº†å®ç°åº”ç”¨çš„å¾®æœåŠ¡åŒ–ã€‚ç„¶è€Œå¯¹äºå¾®æœåŠ¡è€Œè¨€ï¼Œæœ‰å…­ä¸ªåŸºæœ¬å¿…é¡»å®ç°çš„ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;è¿›ç¨‹é€šè®¯&lt;/li&gt;
&lt;li&gt;æœåŠ¡æ³¨å†Œä¸å‘ç°&lt;/li&gt;
&lt;li&gt;è´Ÿè½½å‡è¡¡&lt;/li&gt;
&lt;li&gt;é…ç½®ä¸­å¿ƒ&lt;/li&gt;
&lt;li&gt;ç†”æ–­å™¨&lt;/li&gt;
&lt;li&gt;ç½‘å…³è·¯ç”±&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;æˆ‘ä»¬å·²ç»è¿›å…¥åˆ°å®¹å™¨åŒ–æ—¶ä»£ï¼ŒKubernetesæˆä¸ºäº†å¸‚åœºä¸Šå®¹å™¨ç¼–æ’çš„äº‹å®æ ‡å‡†ï¼Œè€Œä¸”k8S åŒæ ·å…·å¤‡äº†å¾®æœåŠ¡æ‰€éœ€è¦çš„æœåŠ¡æ³¨å†Œä¸å‘ç°ã€è´Ÿè½½å‡è¡¡ã€é…ç½®ä¸­å¿ƒã€‚Spring cloud çš„æ ¸å¿ƒæ˜¯Netflixå¾®æœåŠ¡æ¡†æ¶ï¼Œéå¸¸æˆç†Ÿï¼Œä½†æ˜¯åœ¨netflix osså¼€å‘åˆæœŸï¼Œé‚£ä¸ªæ—¶å€™è¿˜æ²¡æœ‰dockerï¼Œæˆ‘ä»¬ç°åœ¨æ‰€æœ‰çš„æœåŠ¡éƒ½æ˜¯é€šè¿‡è™šæ‹Ÿå®¹å™¨æ‰¿è½½çš„ã€‚&lt;/p&gt;
&lt;p&gt;Netflix OSSçš„è®¸å¤šå†…å®¹éƒ½æ˜¯åœ¨ä¸€ä¸ªå·²ç»è¿‡å»çš„å¹´ä»£å†™å‡ºæ¥çš„ï¼Œé‚£æ—¶æ‰€æœ‰ä¸œè¥¿éƒ½åªèƒ½è¿è¡Œåœ¨AWSäº‘ä¸Šè€Œæ²¡æœ‰å…¶å®ƒé€‰æ‹©ã€‚å…³äºé‚£ä¸ªå¹´ä»£çš„è®¸å¤šå®è´µé—äº§å’Œå‰æå‡è®¾éƒ½å·²ç»è¢«å°è£…åˆ°äº†Netflixçš„åº“é‡Œé¢ï¼Œå¯¹äºç°åœ¨ä½ è¿è¡Œçš„ç¯å¢ƒï¼ˆæ¯”å¦‚Linuxå®¹å™¨ï¼‰å·²ç»ä¸é€‚ç”¨äº†ã€‚åœ¨Linuxå®¹å™¨ã€Dockerã€å®¹å™¨ç®¡ç†ç³»ç»Ÿç­‰ç­‰å‡ºç°ä¹‹åï¼Œæˆ‘ä»¬è¶Šæ¥è¶Šçœ‹åˆ°æŠŠæˆ‘ä»¬çš„å¾®æœåŠ¡è¿è¡Œåœ¨Linuxå®¹å™¨ï¼ˆå…¬æœ‰äº‘ã€ç§æœ‰äº‘ï¼Œæˆ–è€…éƒ½è¦ç­‰ç­‰ï¼‰é‡Œçš„å·¨å¤§ä»·å€¼ã€‚å¦å¤–ï¼Œå› ä¸ºè¿™äº›å®¹å™¨éƒ½æ˜¯ç›´æ¥æŠŠè¿™äº›æœåŠ¡æ‰“åŒ…èµ·æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å€¾å‘äºä¸è¦è¿‡å¤šå…³å¿ƒåœ¨å®¹å™¨é‡Œé¢è¿è¡Œçš„åˆ°åº•æ˜¯ä»€ä¹ˆæŠ€æœ¯ï¼ˆæ˜¯Javaï¼Ÿè¿˜æ˜¯Node.jsï¼Ÿæˆ–è€…Goï¼Ÿæˆ–è€….NET Core?ï¼‰&lt;/p&gt;
&lt;p&gt;Kubernetesæ˜¯å¤šè¯­è¨€çš„ï¼Œä¸ä»…ä»…é’ˆå¯¹Javaå¹³å°ï¼Œè€Œæ˜¯ä»¥é€šç”¨çš„æ–¹å¼ä¸ºæ‰€æœ‰è¯­è¨€è§£å†³åˆ†å¸ƒå¼è®¡ç®—é—®é¢˜ã€‚Kubernetesæä¾›äº†é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€è·Ÿè¸ªã€ç»Ÿè®¡ã€å•å®ä¾‹ã€å¹³å°çº§å’Œåº”ç”¨æ ˆä¹‹å¤–çš„è°ƒåº¦å·¥ä½œã€‚è¯¥åº”ç”¨ä¸éœ€è¦ä»»ä½•å®¢æˆ·ç«¯é€»è¾‘çš„åº“æˆ–ä»£ç†ç¨‹åºï¼Œå¯ä»¥ç”¨ä»»ä½•è¯­è¨€ç¼–å†™ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªå¹³å°å¯ä»¥è¢«å¤šä¸ªå›¢é˜Ÿï¼ˆåŒ…æ‹¬ä½¿ç”¨&lt;code&gt;Spring&lt;/code&gt;çš„&lt;code&gt;Java&lt;/code&gt;å¼€å‘äººå‘˜ï¼‰ä½¿ç”¨ï¼Œå¹¶æä¾›å¤šç§ç”¨é€”ï¼šåº”â€‹â€‹ç”¨ç¨‹åºå¼€å‘ã€æµ‹è¯•ç¯å¢ƒã€æ„å»ºç¯å¢ƒï¼ˆæºç è¿è¡Œã€æ„å»ºæœåŠ¡ã€ä¾èµ–ä»“åº“ï¼‰ç­‰ã€‚&lt;code&gt;Kubernetes&lt;/code&gt;è§£å†³äº†æ›´å¹¿çš„å¾®æœåŠ¡æ¶æ„é—®é¢˜ã€‚é™¤äº†æä¾›è¿è¡Œæ—¶æœåŠ¡ï¼Œ&lt;code&gt;Kubernetes&lt;/code&gt;ä¹Ÿå¯ä»¥è®©ä½ åˆ¶å®šç¯å¢ƒã€è®¾ç½®èµ„æºé™åˆ¶ã€RBACã€ç®¡ç†åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸã€å…è®¸è‡ªåŠ¨æ‰©å®¹å’Œè‡ªæˆ‘ä¿®å¤ï¼ˆå‡ ä¹è¡¨ç°å¾—åƒä¸€ä¸ªæŠ—è„†å¼±å¹³å°ï¼‰ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;åœ¨K8sé›†ç¾¤ä¸­ï¼Œæ²¡æœ‰å¿…è¦æ‹¥æœ‰Eurekaã€‚K8sä¸­çš„ETCDæ‹¥æœ‰æ‰€æœ‰å¿…è¦çš„ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;æ‚¨çš„åº”ç”¨ç¨‹åºå°†é€šè¿‡æŒ‡å®šçš„K8sæœåŠ¡åç§°è”ç³»K8s APIæœåŠ¡å™¨ä»¥è·å–ç«¯ç‚¹ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes å¯ä»¥è§£å†³ä½ æ‰€é‡åˆ°çš„é—®é¢˜ï¼Œå¯èƒ½å¯ä»¥å–ä»£netflixçš„æ•´å¥—æŠ€æœ¯&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;.NET Core å°±æ˜¯ä¸ºäº‘åŸç”Ÿåº”ç”¨çš„å¼€å‘è€Œå‡†å¤‡çš„å¹³å°ï¼Œ.NET Coreç›¸è¾ƒäºä»–çš„å“¥å“¥.NETçš„ä¼˜åŠ¿ä¹Ÿæ­£æ˜¯æˆ‘ä»¬å¾ˆå®¹æ˜“çš„ä½¿ç”¨C# è¯­è¨€å»æ„å»ºé«˜å†…èšä½è€¦åˆçš„äº‘åŸç”Ÿç³»ç»Ÿã€‚å€ŸåŠ©äºK8Sï¼Œservice fabric, æˆ‘ä»¬å¾ˆå®¹æ˜“æ„å»ºä¸€ä¸ª.NET Coreçš„å¾®æœåŠ¡ç”Ÿæ€ã€‚ç»“åˆ.NET Coreå’Œk8s å®¹å™¨æœåŠ¡åœ¨è…¾è®¯äº‘ä¸Šåˆ¶ä½œäº†ä¸€ä¸ªæ•™ç¨‹ ã€Š.NET å¾®æœåŠ¡å®æˆ˜ â€” å¾®ä¿¡å…¬ä¼—å·å¼€å‘ï¼ˆ &lt;a href=&quot;https://cloud.tencent.com/developer/edu/major-100017&quot;&gt;https://cloud.tencent.com/developer/edu/major-100017&lt;/a&gt;ï¼‰ã€‹ï¼Œæ•™ç¨‹é‡Œä¾‹å­-å…¬ä¼—å·å¼€å‘è™½ç„¶ç®€å•ï¼Œæˆ‘åªæ˜¯ä½¿ç”¨è¿™ä¸ªç®€å•ä¾‹å­æ¥é˜è¿°ä¸€ä¸ªç®€å•çš„é—®é¢˜ï¼Œäº‘æ—¶ä»£çš„.NET æ˜¯æ€ä¹ˆæ ·çš„ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆæ ·ä½¿ç”¨.NET Coreã€‚&lt;/p&gt;
</description>
<pubDate>Sat, 06 Apr 2019 13:27:00 +0000</pubDate>
<dc:creator>å¼ å–„å‹</dc:creator>
<og:description>å‰å¤©å‘çš„æ–‡ç« ã€ŠåŸºäºKubernetes æ„å»º.NET Core çš„æŠ€æœ¯ä½“ç³»ã€‹ï¼Œæœ‰åŒå­¦é—®.NET Coreä¸Šæœ‰Spring Cloudç±»ä¼¼çš„å¹³å°å—ï¼Ÿ .NET Coreå‡ºç°è¿™ä¹ˆä¹…äº†ï¼Œè¿™ä¸ªä¸ºäº‘åŸç”Ÿåº”ç”¨å¼€å‘</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/shanyou/p/10662958.html</dc:identifier>
</item>
<item>
<title>Akka-CQRSï¼ˆ5ï¼‰- CQRS Writer Actor éƒ¨ç½²å’Œæµ‹è¯• - é›ªå·å¤§è™«</title>
<link>http://www.cnblogs.com/tiger-xc/p/10662854.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/tiger-xc/p/10662854.html</guid>
<description>&lt;p&gt;&lt;span&gt;Â  Â ä¸Šç¯‡æˆ‘ä»¬åšäº†ä¸€ä¸ªWriterActorçš„ä¾‹å­ï¼Œä¸»è¦ç›®çš„æ˜¯ç¤ºèŒƒWriterActorå¦‚ä½•ä½œä¸ºé›†ç¾¤åˆ†ç‰‡ç”¨persistentActorç‰¹æ€§åŠevent-sourcingæ¨¡å¼å®ç°CQRSçš„å†™åŠŸèƒ½ã€‚æ—¢ç„¶æ˜¯é›†ç¾¤åˆ†ç‰‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨è¿™ç¯‡è®²è®²WriterActorçš„éƒ¨ç½²å’Œæµ‹è¯•ï¼Œå› ä¸ºè¿™ä¸ªé‡Œé¢è¿˜æ˜¯æœ‰äº›å€¼å¾—æ³¨æ„çš„åœ°æ–¹ã€‚ä¸‹é¢æ˜¯ä¸€æ®µWriteActorï¼Œå³é›†ç¾¤åˆ†ç‰‡ï¼ˆcluster-shardingï¼‰çš„éƒ¨ç½²ä»£ç ï¼š&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&lt;span&gt;    ClusterSharding(system).start(
      typeName &lt;/span&gt;=&lt;span&gt; shardName,
      entityProps &lt;/span&gt;=&lt;span&gt; writerProps,
      settings &lt;/span&gt;=&lt;span&gt; cpsSettings,
      extractEntityId &lt;/span&gt;=&lt;span&gt; getPOSId,
      extractShardId &lt;/span&gt;=&lt;span&gt; getShopId,
      allocationStrategy &lt;/span&gt;=&lt;span&gt; ClusterSharding(system).defaultShardAllocationStrategy(cpsSettings),
      handOffStopMessage &lt;/span&gt;=&lt;span&gt; PassivatePOS
    )&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;æ³¨æ„å¸¦handOffStopMessageå‚æ•°çš„startå‡½æ•°å¿…é¡»åŒæ—¶æä¾›allocationStrategyã€‚è¿™ä¸ªå‚æ•°æä¾›äº†passivationæ¶ˆæ¯ç±»å‹ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;æ•´ä¸ªé›†ç¾¤åˆ†ç‰‡éƒ¨ç½²ä»£ç å¦‚ä¸‹ï¼š&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;50&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; POSRouter extends LogSupport {
  def main(args: Array[String]) {
    import WriterActor._
    import Commands._

    val argsPat &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;(.*):(.*)&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;.r
    val (host, port) &lt;/span&gt;= args(&lt;span&gt;0&lt;/span&gt;&lt;span&gt;) match {
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; argsPat(h, p) =&amp;gt;&lt;span&gt; (h, p)
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; _ =&amp;gt; (&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;2551&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    }

    val config &lt;/span&gt;= ConfigFactory.parseString(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;akka.remote.netty.tcp.port=\&quot;&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; + port + &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;\&quot;&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
      .withFallback(ConfigFactory.parseString(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;akka.remote.netty.tcp.hostname=\&quot;&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; + host + &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;\&quot;&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))
      &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;roles can be deployed on this node&lt;/span&gt;
      .withFallback(ConfigFactory.parseString(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;akka.cluster.roles = [poswriter]&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))
      .withFallback(ConfigFactory.load())

    log.info(s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;******* hostname = $host,  port = $port *******&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

    val shardName &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;POSShard&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;

    &lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; POSMessage(id: Long, cmd: POSCommand) {
      def shopId &lt;/span&gt;=&lt;span&gt; id.toString.head.toString

      def posId &lt;/span&gt;=&lt;span&gt; id.toString
    }

    val getPOSId: ShardRegion.ExtractEntityId &lt;/span&gt;=&lt;span&gt; {
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; posCommand: POSMessage =&amp;gt;&lt;span&gt; (posCommand.posId, posCommand.cmd)
    }
    val getShopId: ShardRegion.ExtractShardId &lt;/span&gt;=&lt;span&gt; {
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; posCommand: POSMessage =&amp;gt;&lt;span&gt; posCommand.shopId
    }


    val system &lt;/span&gt;= ActorSystem(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cloud-pos-server&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, config)
    val role &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;poswriter&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;role of this shard&lt;/span&gt;
    val cpsSettings = ClusterShardingSettings(system).withRole(role) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;.withPassivateIdleAfter(10 minutes)&lt;/span&gt;
&lt;span&gt;
    ClusterSharding(system).start(
      typeName &lt;/span&gt;=&lt;span&gt; shardName,
      entityProps &lt;/span&gt;=&lt;span&gt; writerProps,
      settings &lt;/span&gt;=&lt;span&gt; cpsSettings,
      extractEntityId &lt;/span&gt;=&lt;span&gt; getPOSId,
      extractShardId &lt;/span&gt;=&lt;span&gt; getShopId,
      allocationStrategy &lt;/span&gt;=&lt;span&gt; ClusterSharding(system).defaultShardAllocationStrategy(cpsSettings),
      handOffStopMessage &lt;/span&gt;=&lt;span&gt; PassivatePOS
    )

    system.actorOf(ClusterMonitor.props, &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cps-cluster-monitor&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

  }
}&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;ä»¥ä¸Šæœ‰å‡ ä¸ªå‚æ•°éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼šhostå’Œportæ˜¯ä»mainçš„å‚æ•°è§£æå‡ºæ¥çš„å¦‚192.168.11.162:2551ï¼Œä»£è¡¨æœ¬èŠ‚ç‚¹çš„hostå’Œportã€‚akka.cluster.rolesä»£è¡¨æœ¬èŠ‚ç‚¹æ”¯æŒçš„è§’è‰²ï¼Œè¿™é‡Œposwriteræ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚è€ŒClusterShardingSettings(system).withRole(&quot;poswriter&quot;)ä»£è¡¨è¿™ä¸ªåˆ†ç‰‡shardåªèƒ½åœ¨æ”¯æŒposwriterè§’è‰²çš„èŠ‚ç‚¹ä¸Šéƒ¨ç½²ã€‚å¦‚æœæé”™äº†è¿è¡Œæ—¶ä½ ä¼šå‘ç°Shardingæ— æ³•å¯åŠ¨ã€‚ä¸Šé¢è¿™æ®µç¨‹åºä»£è¡¨æœ¬èŠ‚ç‚¹æ”¯æŒposwriterè§’è‰²ã€‚åœ¨æœ¬èŠ‚ç‚¹ï¼ˆè¾“å…¥çš„IPåœ°å€ï¼‰éƒ¨ç½²äº†ä¸€ä¸ªåç§°ä¸ºâ€œPOSShardâ€çš„cluster-shardingï¼Œå®ƒå…·å¤‡poswriterè§’è‰²ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;å¦‚æœæˆ‘åœ¨å¤šéƒ¨æœºå™¨ä¸Šè¿è¡Œè¿™æ®µä»£ç ï¼Œè¾“å…¥å½“å‰æœºå™¨çš„IP+PORTå°±ä»£è¡¨åœ¨è¿™ä¹ˆå¤šå°æœºå™¨ä¸Šéƒ½éƒ¨ç½²äº†â€œPOSShardâ€åˆ†ç‰‡ã€‚ä¸Šé¢çš„ClusterMonitoræ˜¯ä¸ªé›†ç¾¤çŠ¶æ€ç›‘æ§actor:&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&lt;span&gt;package sdp.cluster.monitor

import akka.actor._
import akka.cluster.ClusterEvent._
import akka.cluster._
import sdp.logging.LogSupport

&lt;/span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; ClusterMonitor {
  def props &lt;/span&gt;= Props(&lt;span&gt;new&lt;/span&gt;&lt;span&gt; ClusterMonitor)
}

&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; ClusterMonitor extends Actor with LogSupport {
  val cluster &lt;/span&gt;=&lt;span&gt; Cluster(context.system)
  &lt;/span&gt;&lt;span&gt;override&lt;/span&gt; def preStart(): Unit =&lt;span&gt; {
    cluster.subscribe(self,initialStateMode &lt;/span&gt;=&lt;span&gt; InitialStateAsEvents
      ,classOf[MemberEvent],classOf[UnreachableMember])  &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è®¢é˜…é›†ç¾¤çŠ¶æ€è½¬æ¢ä¿¡æ¯&lt;/span&gt;
&lt;span&gt;    super.preStart()
  }

  &lt;/span&gt;&lt;span&gt;override&lt;/span&gt; def postStop(): Unit =&lt;span&gt; {
    cluster.unsubscribe(self)    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–æ¶ˆè®¢é˜…&lt;/span&gt;
&lt;span&gt;    super.postStop()
  }

  &lt;/span&gt;&lt;span&gt;override&lt;/span&gt; def receive: Receive =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; MemberJoined(member) =&amp;gt;&lt;span&gt;
      log.info(s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Member is Joining: {${member.address}}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; MemberUp(member) =&amp;gt;&lt;span&gt;
      log.info(s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Member is Up: {${member.address}}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; MemberLeft(member) =&amp;gt;&lt;span&gt;
      log.info(s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Member is Leaving: {${member.address}}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; MemberExited(member) =&amp;gt;&lt;span&gt;
      log.info(s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Member is Exiting: {${member.address}}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; MemberRemoved(member, previousStatus) =&amp;gt;&lt;span&gt;
      log.info(
        s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Member is Removed: {${member.address}} after {${previousStatus}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; UnreachableMember(member) =&amp;gt;&lt;span&gt;
      log.info(s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Member detected as unreachable: {${member.address}}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
      cluster.down(member.address)      &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ‰‹å·¥é©±é™¤ï¼Œä¸ç”¨auto-down&lt;/span&gt;
    &lt;span&gt;case&lt;/span&gt; _: MemberEvent =&amp;gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ignore&lt;/span&gt;
&lt;span&gt;  }

}&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;æœ‰äº†å®ƒæˆ‘ä»¬å¯ä»¥ç›‘è§†é›†ç¾¤èŠ‚ç‚¹è¿æ¥çŠ¶æ€ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;å¥½äº†ï¼Œç°åœ¨å‡è®¾æˆ‘ä»¬åœ¨å‡ å°æœºå™¨ç»„æˆçš„é›†ç¾¤å„èŠ‚ç‚¹ä¸Šéƒ½éƒ¨ç½²äº†â€œPOSShardâ€åˆ†ç‰‡ï¼Œé‚£ä¹ˆå°±è®¾è®¡ä¸ªå®¢æˆ·ç«¯æ¥å‘è¿™ä¸ªâ€œPOSShardâ€åˆ†ç‰‡å‘é€POSMessageï¼š&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;    &lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; POSMessage(id: Long, cmd: POSCommand) {
      def shopId &lt;/span&gt;=&lt;span&gt; id.toString.head.toString

      def posId &lt;/span&gt;=&lt;span&gt; id.toString
    }

    val getPOSId: ShardRegion.ExtractEntityId &lt;/span&gt;=&lt;span&gt; {
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; posCommand: POSMessage =&amp;gt;&lt;span&gt; (posCommand.posId, posCommand.cmd)
    }
    val getShopId: ShardRegion.ExtractShardId &lt;/span&gt;=&lt;span&gt; {
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; posCommand: POSMessage =&amp;gt;&lt;span&gt; posCommand.shopId
    }&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;è¿™ä¸ªå®¢æˆ·ç«¯å¿…é¡»è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼šå®ƒå¿…é¡»åœ¨åŒä¸€ä¸ªé›†ç¾¤ï¼Œä¹Ÿå°±æ˜¯å®ƒä¹Ÿæ˜¯é›†ç¾¤å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™æ— æ³•å’Œå…¶å®ƒéƒ¨ç½²äº†â€œPOSShardâ€åˆ†ç‰‡çš„èŠ‚ç‚¹è¿›è¡Œä¿¡æ¯äº¤æµã€‚ä½†å®ƒåˆä¸èƒ½åŒå¤„ä¸éƒ¨ç½²äº†â€œPOSShardâ€çš„èŠ‚ç‚¹ï¼Œå› ä¸ºremoteçš„hostnameå’Œportå·²ç»è¢«å ç”¨ã€‚æ‰€ä»¥åªèƒ½æŠŠå®¢æˆ·ç«¯æ”¾åœ¨ä¸€ä¸ªæ²¡æœ‰éƒ¨ç½²â€œPOSShardâ€çš„èŠ‚ç‚¹ä¸Šï¼Œç„¶åç”¨ClusterSharding(system).startProxyæ¥å¯åŠ¨ä¸€ä¸ªåˆ†ç‰‡ä¸­ä»‹ï¼š&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt;   &lt;span&gt;//&lt;/span&gt;&lt;span&gt;no shard deployed on this node  2558, use proxy&lt;/span&gt;
    val posHandler =&lt;span&gt; ClusterSharding(system).startProxy(
      typeName &lt;/span&gt;=&lt;span&gt; shardName,
      role &lt;/span&gt;= Some(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;poswriter&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;),
      extractEntityId &lt;/span&gt;=&lt;span&gt; getPOSId,
      extractShardId &lt;/span&gt;=&lt;span&gt; getShopId
    )

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;val posHandler = ClusterSharding(system).shardRegion(shardName)&lt;/span&gt;
&lt;span&gt;
    system.actorOf(POSClient.props(posHandler), &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;pos-client&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;æ³¨æ„è¿™ä¸ªproxyçš„roleå¿…é¡»æ˜¯Some(&quot;poswriter&quot;)ï¼Œåªæœ‰è¿™æ ·æ‰èƒ½è°ƒç”¨å…¶å®ƒèŠ‚ç‚¹ä¸Šçš„â€POSShardâ€œï¼Œå› ä¸ºå®ƒä»¬çš„è§’è‰²éƒ½æ˜¯â€œposwriterâ€ã€‚ä¸WriterActoräº¤äº’çš„å¿…é¡»æ˜¯ä¸ªactorï¼Œå› ä¸ºWriterActorä¼šç”¨sender()è¿”å›ç»“æœï¼Œè¿™ä¸ªsender()æ˜¯ä¸ªActorRefï¼š&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; POSClient {
  def props(pos: ActorRef) &lt;/span&gt;= Props(&lt;span&gt;new&lt;/span&gt;&lt;span&gt; POSClient(pos))
}
&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; POSClient(posHandler: ActorRef)  extends Actor with LogSupport {

  &lt;/span&gt;&lt;span&gt;override&lt;/span&gt; def receive: Receive =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; msg @ POSMessage(_,_) =&amp;gt; posHandler !&lt;span&gt; msg
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; resp: POSResponse  =&amp;gt;&lt;span&gt;
      log.info(s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;response from server: $resp&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
  }
}&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;æˆ‘ä»¬å¯ç”¨ä¸‹é¢çš„æ–¹å¼æ¥æŒ‡æŒ¥WriterActor:&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;57&quot;&gt;
&lt;pre&gt;
&lt;span&gt;    val posref = system.actorOf(POSClient.props(posHandler), &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;pos-client&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    
    posref &lt;/span&gt;! POSMessage(&lt;span&gt;1021&lt;/span&gt;, LogSales(SALESTYPE.plu, &lt;span&gt;&quot;&quot;&lt;/span&gt;, apple.code, &lt;span&gt;1&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;))
    posref &lt;/span&gt;! POSMessage(&lt;span&gt;2021&lt;/span&gt;, LogSales(SALESTYPE.plu, &lt;span&gt;&quot;&quot;&lt;/span&gt;, pineapple.code, &lt;span&gt;2&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;))
    posref &lt;/span&gt;! POSMessage(&lt;span&gt;3021&lt;/span&gt;, LogSales(SALESTYPE.plu, &lt;span&gt;&quot;&quot;&lt;/span&gt;, banana.code, &lt;span&gt;1&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;))
    posref &lt;/span&gt;! POSMessage(&lt;span&gt;4021&lt;/span&gt;, LogSales(SALESTYPE.plu, &lt;span&gt;&quot;&quot;&lt;/span&gt;, grape.code, &lt;span&gt;3&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;))
    posref &lt;/span&gt;! POSMessage(&lt;span&gt;4021&lt;/span&gt;,Subtotal)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸‹é¢æ˜¯æœåŠ¡ç«¯åˆ†ç‰‡éƒ¨ç½²æºä»£ç ï¼š&lt;/p&gt;
&lt;p&gt;resources/application.conf&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
akka.actor.warn-about-java-serializer-usage =&lt;span&gt; off
akka.log&lt;/span&gt;-dead-letters-during-shutdown =&lt;span&gt; off
akka.log&lt;/span&gt;-dead-letters =&lt;span&gt; off

akka {
  loglevel &lt;/span&gt;=&lt;span&gt; INFO
  actor {
    provider &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cluster&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
  }

  remote {
    log&lt;/span&gt;-remote-lifecycle-events =&lt;span&gt; off
    netty.tcp {
      hostname &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;127.0.0.1&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
      port &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;
    }
  }

  cluster {
    seed&lt;/span&gt;-nodes =&lt;span&gt; [
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;akka.tcp://cloud-pos-server@192.168.11.162:2551&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;]
    log&lt;/span&gt;-info =&lt;span&gt; off
    sharding {
      role &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;poswriter&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
      passivate&lt;/span&gt;-idle-entity-after = &lt;span&gt;5&lt;/span&gt;&lt;span&gt; m
    }
  }

  persistence {
    journal.plugin &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cassandra-journal&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
    snapshot&lt;/span&gt;-store.plugin = &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cassandra-snapshot-store&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
  }

}

cassandra&lt;/span&gt;-&lt;span&gt;journal {
  contact&lt;/span&gt;-points = [&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;192.168.11.162&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;]
}

cassandra&lt;/span&gt;-snapshot-&lt;span&gt;store {
  contact&lt;/span&gt;-points = [&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;192.168.11.162&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;]
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;POSRouter.scala&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;50&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package cloud.pos.server

import akka.actor._
import akka.cluster.sharding._
import akka.cluster.sharding.ClusterSharding
import com.typesafe.config.ConfigFactory
import sdp.cluster.monitor._
import sdp.logging._

&lt;/span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; POSRouter extends LogSupport {
  def main(args: Array[String]) {
    import WriterActor._
    import Commands._

    val argsPat &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;(.*):(.*)&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;.r
    val (host, port) &lt;/span&gt;= args(&lt;span&gt;0&lt;/span&gt;&lt;span&gt;) match {
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; argsPat(h, p) =&amp;gt;&lt;span&gt; (h, p)
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; _ =&amp;gt; (&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;localhost&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;2551&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    }


    val config &lt;/span&gt;= ConfigFactory.parseString(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;akka.remote.netty.tcp.port=\&quot;&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; + port + &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;\&quot;&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
      .withFallback(ConfigFactory.parseString(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;akka.remote.netty.tcp.hostname=\&quot;&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; + host + &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;\&quot;&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))
      &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;roles can be deployed on this node&lt;/span&gt;
      .withFallback(ConfigFactory.parseString(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;akka.cluster.roles = [poswriter]&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))
      .withFallback(ConfigFactory.load())


    log.info(s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;******* hostname = $host,  port = $port *******&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

    val shardName &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;POSShard&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;

    &lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; POSMessage(id: Long, cmd: POSCommand) {
      def shopId &lt;/span&gt;=&lt;span&gt; id.toString.head.toString

      def posId &lt;/span&gt;=&lt;span&gt; id.toString
    }

    val getPOSId: ShardRegion.ExtractEntityId &lt;/span&gt;=&lt;span&gt; {
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; posCommand: POSMessage =&amp;gt;&lt;span&gt; (posCommand.posId, posCommand.cmd)
    }
    val getShopId: ShardRegion.ExtractShardId &lt;/span&gt;=&lt;span&gt; {
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; posCommand: POSMessage =&amp;gt;&lt;span&gt; posCommand.shopId
    }


    val system &lt;/span&gt;= ActorSystem(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cloud-pos-server&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;, config)
    val role &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;poswriter&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;role of this shard&lt;/span&gt;
    val cpsSettings = ClusterShardingSettings(system).withRole(role) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;.withPassivateIdleAfter(10 minutes)&lt;/span&gt;
&lt;span&gt;
    ClusterSharding(system).start(
      typeName &lt;/span&gt;=&lt;span&gt; shardName,
      entityProps &lt;/span&gt;=&lt;span&gt; writerProps,
      settings &lt;/span&gt;=&lt;span&gt; cpsSettings,
      extractEntityId &lt;/span&gt;=&lt;span&gt; getPOSId,
      extractShardId &lt;/span&gt;=&lt;span&gt; getShopId,
      allocationStrategy &lt;/span&gt;=&lt;span&gt; ClusterSharding(system).defaultShardAllocationStrategy(cpsSettings),
      handOffStopMessage &lt;/span&gt;=&lt;span&gt; PassivatePOS
    )

    system.actorOf(ClusterMonitor.props, &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cps-cluster-monitor&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

  }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸‹é¢æ˜¯è¿™ä¸ªæµ‹è¯•é¡¹ç›®çš„æºä»£ç ï¼š&lt;/p&gt;
&lt;p&gt;build.sbt&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
name := &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cloud-pos-client&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;

version :&lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;0.1&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;

scalaVersion :&lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;2.12.8&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;

libraryDependencies :&lt;/span&gt;=&lt;span&gt; Seq(
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;com.typesafe.akka&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %% &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;akka-cluster-sharding&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; % &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;2.5.19&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;com.typesafe.akka&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %% &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;akka-persistence&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; % &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;2.5.19&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;com.typesafe.akka&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %% &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;akka-persistence-cassandra&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; % &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;0.93&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;com.typesafe.akka&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %% &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;akka-persistence-cassandra-launcher&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; % &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;0.93&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %&lt;span&gt; Test,
  &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ch.qos.logback&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;  %  &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;logback-classic&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;   % &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;1.2.3&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;resources/application.conf&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
akka.actor.warn-about-java-serializer-usage =&lt;span&gt; off
akka.log&lt;/span&gt;-dead-letters-during-shutdown =&lt;span&gt; off
akka.log&lt;/span&gt;-dead-letters =&lt;span&gt; off

akka {
  loglevel &lt;/span&gt;=&lt;span&gt; INFO
  actor {
    provider &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cluster&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
  }

  remote {
    log&lt;/span&gt;-remote-lifecycle-events =&lt;span&gt; off
    netty.tcp {
      hostname &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;192.168.11.162&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
      port &lt;/span&gt;= &lt;span&gt;2558&lt;/span&gt;&lt;span&gt;
    }
  }

  cluster {
    seed&lt;/span&gt;-nodes =&lt;span&gt; [
      &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;akka.tcp://cloud-pos-server@192.168.11.162:2551&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;]
    log&lt;/span&gt;-info =&lt;span&gt; off
  }

}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;resources/logback.xml&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&amp;lt;?xml version=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;1.0&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; encoding=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;UTF-8&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;configuration&amp;gt;
    &amp;lt;appender name=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;STDOUT&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ch.qos.logback.core.ConsoleAppender&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;encoder&amp;gt;
            &amp;lt;Pattern&amp;gt;
                %d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{&lt;span&gt;36&lt;/span&gt;} - %msg%&lt;span&gt;n
            &lt;/span&gt;&amp;lt;/Pattern&amp;gt;
        &amp;lt;/encoder&amp;gt;
    &amp;lt;/appender&amp;gt;

    &amp;lt;root level=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;debug&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;appender-&lt;span&gt;ref&lt;/span&gt; &lt;span&gt;ref&lt;/span&gt;=&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;STDOUT&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; /&amp;gt;
    &amp;lt;/root&amp;gt;
&amp;lt;/configuration&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ClientDemo.scala&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;63&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package cloud.pos.client
import akka.actor._
import akka.cluster.sharding.ClusterSharding
import sdp.cluster.monitor._
import sdp.logging._
import Commands._
import States._
import Items._
import akka.cluster.sharding._


&lt;/span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; POSClientDemo extends LogSupport {
  def main(args: Array[String]) {

    val system &lt;/span&gt;= ActorSystem(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cloud-pos-server&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

    val shardName &lt;/span&gt;= &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;POSShard&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;

    val getPOSId: ShardRegion.ExtractEntityId &lt;/span&gt;=&lt;span&gt; {
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; posCommand: POSMessage =&amp;gt;&lt;span&gt; (posCommand.posId, posCommand.cmd)
    }
    val getShopId: ShardRegion.ExtractShardId &lt;/span&gt;=&lt;span&gt; {
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; posCommand: POSMessage =&amp;gt;&lt;span&gt; posCommand.shopId
    }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;no shard deployed on this node  2558, use proxy&lt;/span&gt;
    val posHandler =&lt;span&gt; ClusterSharding(system).startProxy(
      typeName &lt;/span&gt;=&lt;span&gt; shardName,
      role &lt;/span&gt;= Some(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;poswriter&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;),
      extractEntityId &lt;/span&gt;=&lt;span&gt; getPOSId,
      extractShardId &lt;/span&gt;=&lt;span&gt; getShopId
    )

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;val posHandler = ClusterSharding(system).shardRegion(shardName)&lt;/span&gt;
&lt;span&gt;
    system.actorOf(ClusterMonitor.props, &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cps-cluster-monitor&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

    val posref &lt;/span&gt;= system.actorOf(POSClient.props(posHandler), &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;pos-client&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

    posref &lt;/span&gt;! POSMessage(&lt;span&gt;1021&lt;/span&gt;, LogSales(SALESTYPE.plu, &lt;span&gt;&quot;&quot;&lt;/span&gt;, apple.code, &lt;span&gt;1&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;))
    posref &lt;/span&gt;! POSMessage(&lt;span&gt;2021&lt;/span&gt;, LogSales(SALESTYPE.plu, &lt;span&gt;&quot;&quot;&lt;/span&gt;, pineapple.code, &lt;span&gt;2&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;))
    posref &lt;/span&gt;! POSMessage(&lt;span&gt;3021&lt;/span&gt;, LogSales(SALESTYPE.plu, &lt;span&gt;&quot;&quot;&lt;/span&gt;, banana.code, &lt;span&gt;1&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;))
    posref &lt;/span&gt;! POSMessage(&lt;span&gt;4021&lt;/span&gt;, LogSales(SALESTYPE.plu, &lt;span&gt;&quot;&quot;&lt;/span&gt;, grape.code, &lt;span&gt;3&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;))
    posref &lt;/span&gt;! POSMessage(&lt;span&gt;4021&lt;/span&gt;&lt;span&gt;,Subtotal)



    scala.io.StdIn.readLine()

    system.terminate()

  }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;client/Commands.scala&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;57&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package cloud.pos.client

&lt;/span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; Commands {

  &lt;/span&gt;&lt;span&gt;sealed&lt;/span&gt;&lt;span&gt; trait POSCommand {}

  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; LogOn(opr: String, passwd: String) extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;object&lt;/span&gt;&lt;span&gt; LogOff extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; SuperOn(su: String, passwd: String) extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;object&lt;/span&gt;&lt;span&gt; SuperOff extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; MemberOn(cardnum: String, passwd: String) extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;object&lt;/span&gt; MemberOff extends POSCommand   &lt;span&gt;//&lt;/span&gt;&lt;span&gt;remove member status for the voucher&lt;/span&gt;
  &lt;span&gt;case&lt;/span&gt; &lt;span&gt;object&lt;/span&gt;&lt;span&gt; RefundOn extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;object&lt;/span&gt;&lt;span&gt; RefundOff extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;object&lt;/span&gt;&lt;span&gt; VoidOn extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;object&lt;/span&gt;&lt;span&gt; VoidOff extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;object&lt;/span&gt;&lt;span&gt; VoidAll extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;object&lt;/span&gt;&lt;span&gt; Suspend extends POSCommand

  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; VoucherNum(vnum: Int) extends POSCommand


  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; LogSales(salesType: Int, dpt: String, code: String, qty: Int, price: Int) extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;object&lt;/span&gt;&lt;span&gt; Subtotal extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; Discount(code: String, percent: Int) extends POSCommand

  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; OfflinePay(acct: String, num: String, amount: Int) extends POSCommand          &lt;span&gt;//&lt;/span&gt;&lt;span&gt;settlement   ç»“ç®—æ”¯ä»˜
  &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;read only command, no event process&lt;/span&gt;
  &lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; VCBalance(acct: String, num: String, passwd: String) extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; VCPay(acct: String, num: String, passwd: String, amount: Int) extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; AliPay(acct: String, num: String, amount: Int) extends POSCommand
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; WxPay(acct: String, num: String, amount: Int) extends POSCommand


  &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; read only command, no update event&lt;/span&gt;
  &lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; Plu(itemCode: String) extends POSCommand  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;read only&lt;/span&gt;

  &lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; POSMessage(id: Long, cmd: POSCommand) {
    def shopId &lt;/span&gt;=&lt;span&gt; id.toString.head.toString
    def posId &lt;/span&gt;=&lt;span&gt; id.toString
  }


}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;client/States.scala&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;64&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package cloud.pos.client

&lt;/span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; States {

  &lt;/span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; TXNTYPE {
    val sales: Int &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;
    val refund: Int &lt;/span&gt;= &lt;span&gt;1&lt;/span&gt;&lt;span&gt;
    val &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;: Int = &lt;span&gt;2&lt;/span&gt;&lt;span&gt;
    val voided: Int &lt;/span&gt;= &lt;span&gt;3&lt;/span&gt;&lt;span&gt;
    val voidall: Int &lt;/span&gt;= &lt;span&gt;4&lt;/span&gt;&lt;span&gt;
    val subtotal: Int &lt;/span&gt;= &lt;span&gt;5&lt;/span&gt;&lt;span&gt;
    val logon: Int &lt;/span&gt;= &lt;span&gt;6&lt;/span&gt;&lt;span&gt;
    val supon: Int &lt;/span&gt;= &lt;span&gt;7&lt;/span&gt;       &lt;span&gt;//&lt;/span&gt;&lt;span&gt; super user on/off&lt;/span&gt;
    val suspend: Int = &lt;span&gt;8&lt;/span&gt;&lt;span&gt;

  }

  &lt;/span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; SALESTYPE {
    val plu: Int &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;
    val dpt: Int &lt;/span&gt;= &lt;span&gt;1&lt;/span&gt;&lt;span&gt;
    val cat: Int &lt;/span&gt;= &lt;span&gt;2&lt;/span&gt;&lt;span&gt;
    val brd: Int &lt;/span&gt;= &lt;span&gt;3&lt;/span&gt;&lt;span&gt;
    val ra:  Int &lt;/span&gt;= &lt;span&gt;4&lt;/span&gt;&lt;span&gt;
    val sub: Int &lt;/span&gt;= &lt;span&gt;5&lt;/span&gt;&lt;span&gt;
    val ttl: Int &lt;/span&gt;= &lt;span&gt;6&lt;/span&gt;&lt;span&gt;
    val dsc: Int &lt;/span&gt;= &lt;span&gt;7&lt;/span&gt;&lt;span&gt;
    val crd: Int &lt;/span&gt;= &lt;span&gt;8&lt;/span&gt;&lt;span&gt;
  }


  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; TxnItem(
                      txndate: String &lt;/span&gt;= &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;span&gt;
                      ,txntime: String &lt;/span&gt;= &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;span&gt;
                      ,opr: String &lt;/span&gt;= &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å·¥å·&lt;/span&gt;
                      ,num: Int = &lt;span&gt;0&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;é”€å”®å•å·&lt;/span&gt;
                      ,seq: Int = &lt;span&gt;1&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;äº¤æ˜“åºå·&lt;/span&gt;
                      ,txntype: Int = TXNTYPE.sales&lt;span&gt;//&lt;/span&gt;&lt;span&gt;äº¤æ˜“ç±»å‹&lt;/span&gt;
                      ,salestype: Int = SALESTYPE.plu &lt;span&gt;//&lt;/span&gt;&lt;span&gt;é”€å”®ç±»å‹&lt;/span&gt;
                      ,qty: Int =  &lt;span&gt;1&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;äº¤æ˜“æ•°é‡&lt;/span&gt;
                      ,price: Int = &lt;span&gt;0&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å•ä»·ï¼ˆåˆ†ï¼‰&lt;/span&gt;
                      ,amount: Int = &lt;span&gt;0&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç æ´‹ï¼ˆåˆ†ï¼‰&lt;/span&gt;
                      ,dscamt: Int = &lt;span&gt;0&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æŠ˜æ‰£ï¼šè´Ÿå€¼  netå®æ´‹ = amount + dscamt&lt;/span&gt;
                      ,member: String = &lt;span&gt;&quot;&quot;&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¼šå‘˜å¡å·&lt;/span&gt;
                      ,code: String = &lt;span&gt;&quot;&quot;&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç¼–å·ï¼ˆå•†å“ã€è´¦å·...ï¼‰&lt;/span&gt;
                      ,desc: String = &lt;span&gt;&quot;&quot;&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;é¡¹ç›®åç§°&lt;/span&gt;
                      ,dpt: String = &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;span&gt;
                      ,department: String &lt;/span&gt;= &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;span&gt;
                      ,cat: String &lt;/span&gt;= &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;span&gt;
                      ,category: String &lt;/span&gt;= &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;span&gt;
                      ,brd: String &lt;/span&gt;= &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;span&gt;
                      ,brand: String &lt;/span&gt;= &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;span&gt;
                    )


  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; VchStatus( &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ“ä½œçŠ¶æ€é”ç•™ç»™å‰ç«¯ç»´æŠ¤&lt;/span&gt;
                        qty: Int = &lt;span&gt;1&lt;/span&gt;&lt;span&gt;,
                        refund: Boolean &lt;/span&gt;= &lt;span&gt;false&lt;/span&gt;&lt;span&gt;,
                        &lt;/span&gt;&lt;span&gt;void&lt;/span&gt;: Boolean = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)

  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; VchStates(
                        opr: String &lt;/span&gt;= &lt;span&gt;&quot;&quot;&lt;/span&gt;,      &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ”¶æ¬¾å‘˜&lt;/span&gt;
                        jseq: BigInt = &lt;span&gt;0&lt;/span&gt;,      &lt;span&gt;//&lt;/span&gt;&lt;span&gt;begin journal sequence for read-side replay&lt;/span&gt;
                        num: Int = &lt;span&gt;0&lt;/span&gt;,          &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰å•å·&lt;/span&gt;
                        seq: Int = &lt;span&gt;1&lt;/span&gt;,          &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰åºå·&lt;/span&gt;
                        &lt;span&gt;void&lt;/span&gt;: Boolean = &lt;span&gt;false&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–æ¶ˆæ¨¡å¼&lt;/span&gt;
                        refd: Boolean = &lt;span&gt;false&lt;/span&gt;, &lt;span&gt;//&lt;/span&gt;&lt;span&gt;é€€æ¬¾æ¨¡å¼&lt;/span&gt;
                        due: Boolean = &lt;span&gt;true&lt;/span&gt;,   &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰ä½™é¢&lt;/span&gt;
                        su: String = &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;span&gt;,
                        mbr: String &lt;/span&gt;= &lt;span&gt;&quot;&quot;&lt;/span&gt;&lt;span&gt;
                      )


}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;client/POSClient.scala&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package cloud.pos.client

import akka.actor._
import sdp.logging._
import Responses._
import Commands._

&lt;/span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; POSClient {
  def props(pos: ActorRef) &lt;/span&gt;= Props(&lt;span&gt;new&lt;/span&gt;&lt;span&gt; POSClient(pos))
}
&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; POSClient(posHandler: ActorRef)  extends Actor with LogSupport {

  &lt;/span&gt;&lt;span&gt;override&lt;/span&gt; def receive: Receive =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; msg @ POSMessage(_,_) =&amp;gt; posHandler !&lt;span&gt; msg
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; resp: POSResponse  =&amp;gt;&lt;span&gt;
      log.info(s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;response from server: $resp&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
  }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;client/Responses.scala&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package cloud.pos.client

import States._
&lt;/span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; Responses {

  &lt;/span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; STATUS {
    val OK: Int &lt;/span&gt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;
    val FAIL: Int &lt;/span&gt;= -&lt;span&gt;1&lt;/span&gt;&lt;span&gt;
  }

  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; POSResponse (sts: Int, msg: String, voucher: VchStates, txnItems: List[TxnItem])
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;client/DataAccess.scala&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;115&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package cloud.pos.client

import java.time.LocalDate
import java.time.format.DateTimeFormatter


&lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; Item(
                 brd: String
                 ,dpt: String
                 ,cat: String
                 ,code: String
                 ,name: String
                 ,price: Int

               )
&lt;/span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; Items {
  val apple &lt;/span&gt;= Item(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;02&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;001&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;green apple&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;820&lt;/span&gt;&lt;span&gt;)
  val grape &lt;/span&gt;= Item(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;02&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;002&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;red grape&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;1050&lt;/span&gt;&lt;span&gt;)
  val orage &lt;/span&gt;= Item(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;02&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;003&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;sunkist orage&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;350&lt;/span&gt;&lt;span&gt;)
  val banana &lt;/span&gt;= Item(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;02&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;004&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;demon banana&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;300&lt;/span&gt;&lt;span&gt;)
  val pineapple &lt;/span&gt;= Item(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;02&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;005&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;hainan pineapple&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;1300&lt;/span&gt;&lt;span&gt;)
  val peach &lt;/span&gt;= Item(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;02&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;006&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;xinjiang peach&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;2390&lt;/span&gt;&lt;span&gt;)

  val tblItems &lt;/span&gt;=&lt;span&gt; List(apple, grape, orage, banana, pineapple, peach)

  &lt;/span&gt;&lt;span&gt;sealed&lt;/span&gt;&lt;span&gt; trait QueryItemsResult {}

  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; QueryItemsOK(items: List[Item]) extends QueryItemsResult

  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; QueryItemsFail(msg: String) extends QueryItemsResult

}


&lt;/span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; Codes {
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; User(code: String, name: String, passwd: String)
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; Department(code: String, name: String)
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; Category(code: String, name: String)
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; Brand(code: String, name: String)
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; Ra(code: String, name: String)
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; Account(code: String, name: String)
  &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; Disc(code: String, best: Boolean, aggr: Boolean, group: Boolean)

  val ras &lt;/span&gt;= List(Ra(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Delivery&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;),Ra(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;02&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Cooking&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))
  val dpts &lt;/span&gt;= List(Department(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Fruit&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;),Department(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;02&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Grocery&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))
  val cats &lt;/span&gt;= List(Category(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;0101&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Fresh Fruit&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;),Category(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;0201&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Dry Grocery&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))
  val brds &lt;/span&gt;= List(Brand(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;01&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Sunkist&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;),Brand(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;02&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Demon&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))
  val accts &lt;/span&gt;= List(Account(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;001&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Cash&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;),Account(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;002&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Value Card&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;), Account(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;003&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Visa&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    ,Account(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;004&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Alipay&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;),Account(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;005&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;WXPay&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))

  val users &lt;/span&gt;= List(User(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;1001&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Tiger&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;123&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;),User(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;1002&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;John&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;123&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;),User(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;1003&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Maria&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;123&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;))

  def getDpt(code: String) &lt;/span&gt;= dpts.find(d =&amp;gt; d.code ==&lt;span&gt; code)
  def getCat(code: String) &lt;/span&gt;= cats.find(d =&amp;gt; d.code ==&lt;span&gt; code)
  def getBrd(code: String) &lt;/span&gt;= brds.find(b =&amp;gt; b.code ==&lt;span&gt; code)
  def getAcct(code: String) &lt;/span&gt;= accts.find(a =&amp;gt; a.code ==&lt;span&gt; code)
  def getRa(code: String) &lt;/span&gt;= ras.find(a =&amp;gt; a.code ==&lt;span&gt; code)
}

&lt;/span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; DAO {
  import Items._
  import Codes._

  def getItem(code: String): QueryItemsResult &lt;/span&gt;=&lt;span&gt; {
    val optItem &lt;/span&gt;= tblItems.find(it =&amp;gt; it.code ==&lt;span&gt; code)
    optItem match {
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; Some(item) =&amp;gt;&lt;span&gt; QueryItemsOK(List(item))
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; None =&amp;gt; QueryItemsFail(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Invalid item code!&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    }
  }

  def validateDpt(code: String) &lt;/span&gt;= dpts.find(d =&amp;gt; d.code ==&lt;span&gt; code)
  def validateCat(code: String) &lt;/span&gt;= cats.find(d =&amp;gt; d.code ==&lt;span&gt; code)
  def validateBrd(code: String) &lt;/span&gt;= brds.find(b =&amp;gt; b.code ==&lt;span&gt; code)
  def validateRa(code: String) &lt;/span&gt;= ras.find(ac =&amp;gt; ac.code ==&lt;span&gt; code)
  def validateAcct(code: String) &lt;/span&gt;= accts.find(ac =&amp;gt; ac.code ==&lt;span&gt; code)

  def validateUser(userid: String, passwd: String) &lt;/span&gt;= users.find(u =&amp;gt; (u.code == userid &amp;amp;&amp;amp; u.passwd ==&lt;span&gt; passwd))

  def lastSecOfDateStr(ldate: LocalDate): String &lt;/span&gt;=&lt;span&gt; {
    ldate.format(DateTimeFormatter.ofPattern( &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;yyyy-MM-dd&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;))+&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; 23:59:59&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;
  }


}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;logging/Log.scala&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;44&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package sdp.logging

import org.slf4j.Logger

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
  * Logger which just wraps org.slf4j.Logger internally.
  *
  * @param logger logger
  &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;class&lt;/span&gt;&lt;span&gt; Log(logger: Logger) {

  &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; use var consciously to enable squeezing later&lt;/span&gt;
  &lt;span&gt;var&lt;/span&gt; isDebugEnabled: Boolean =&lt;span&gt; logger.isDebugEnabled
  &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; isInfoEnabled: Boolean =&lt;span&gt; logger.isInfoEnabled
  &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; isWarnEnabled: Boolean =&lt;span&gt; logger.isWarnEnabled
  &lt;/span&gt;&lt;span&gt;var&lt;/span&gt; isErrorEnabled: Boolean =&lt;span&gt; logger.isErrorEnabled

  def withLevel(level: Symbol)(msg: &lt;/span&gt;=&amp;gt; String, e: Throwable = &lt;span&gt;null&lt;/span&gt;): Unit =&lt;span&gt; {
    level match {
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;&lt;span&gt;debug | &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;DEBUG =&amp;gt;&lt;span&gt; debug(msg)
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;&lt;span&gt;info | &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;INFO =&amp;gt;&lt;span&gt; info(msg)
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;&lt;span&gt;warn | &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;WARN =&amp;gt;&lt;span&gt; warn(msg)
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;&lt;span&gt;error | &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;ERROR =&amp;gt;&lt;span&gt; error(msg)
      &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; _ =&amp;gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; nothing to do&lt;/span&gt;
&lt;span&gt;    }
  }

  def debug(msg: &lt;/span&gt;=&amp;gt; String): Unit =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (isDebugEnabled &amp;amp;&amp;amp;&lt;span&gt; logger.isDebugEnabled) {
      logger.debug(msg)
    }
  }

  def debug(msg: &lt;/span&gt;=&amp;gt; String, e: Throwable): Unit =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (isDebugEnabled &amp;amp;&amp;amp;&lt;span&gt; logger.isDebugEnabled) {
      logger.debug(msg, e)
    }
  }

  def info(msg: &lt;/span&gt;=&amp;gt; String): Unit =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (isInfoEnabled &amp;amp;&amp;amp;&lt;span&gt; logger.isInfoEnabled) {
      logger.info(msg)
    }
  }

  def info(msg: &lt;/span&gt;=&amp;gt; String, e: Throwable): Unit =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (isInfoEnabled &amp;amp;&amp;amp;&lt;span&gt; logger.isInfoEnabled) {
      logger.info(msg, e)
    }
  }

  def warn(msg: &lt;/span&gt;=&amp;gt; String): Unit =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (isWarnEnabled &amp;amp;&amp;amp;&lt;span&gt; logger.isWarnEnabled) {
      logger.warn(msg)
    }
  }

  def warn(msg: &lt;/span&gt;=&amp;gt; String, e: Throwable): Unit =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (isWarnEnabled &amp;amp;&amp;amp;&lt;span&gt; logger.isWarnEnabled) {
      logger.warn(msg, e)
    }
  }

  def error(msg: &lt;/span&gt;=&amp;gt; String): Unit =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (isErrorEnabled &amp;amp;&amp;amp;&lt;span&gt; logger.isErrorEnabled) {
      logger.error(msg)
    }
  }

  def error(msg: &lt;/span&gt;=&amp;gt; String, e: Throwable): Unit =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (isErrorEnabled &amp;amp;&amp;amp;&lt;span&gt; logger.isErrorEnabled) {
      logger.error(msg, e)
    }
  }

}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;logging/LogSupport.scala&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package sdp.logging

import org.slf4j.LoggerFactory

trait LogSupport {

  &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
    * Logger
    &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
  &lt;span&gt;protected&lt;/span&gt; val log = &lt;span&gt;new&lt;/span&gt; Log(LoggerFactory.getLogger(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.getClass))

}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;logging/ClusterMonitor.scala&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt;package sdp.cluster.monitor

import akka.actor._
import akka.cluster.ClusterEvent._
import akka.cluster._
import sdp.logging.LogSupport

&lt;/span&gt;&lt;span&gt;object&lt;/span&gt;&lt;span&gt; ClusterMonitor {
  def props &lt;/span&gt;= Props(&lt;span&gt;new&lt;/span&gt;&lt;span&gt; ClusterMonitor())
}

&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; ClusterMonitor extends Actor with LogSupport {
  val cluster &lt;/span&gt;=&lt;span&gt; Cluster(context.system)
  &lt;/span&gt;&lt;span&gt;override&lt;/span&gt; def preStart(): Unit =&lt;span&gt; {
    cluster.subscribe(self,initialStateMode &lt;/span&gt;=&lt;span&gt; InitialStateAsEvents
      ,classOf[MemberEvent],classOf[UnreachableMember])  &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è®¢é˜…é›†ç¾¤çŠ¶æ€è½¬æ¢ä¿¡æ¯&lt;/span&gt;
&lt;span&gt;    super.preStart()
  }

  &lt;/span&gt;&lt;span&gt;override&lt;/span&gt; def postStop(): Unit =&lt;span&gt; {
    cluster.unsubscribe(self)    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–æ¶ˆè®¢é˜…&lt;/span&gt;
&lt;span&gt;    super.postStop()
  }

  &lt;/span&gt;&lt;span&gt;override&lt;/span&gt; def receive: Receive =&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; MemberJoined(member) =&amp;gt;&lt;span&gt;
      log.info(s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Member is Joining: {${member.address}}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; MemberUp(member) =&amp;gt;&lt;span&gt;
      log.info(s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Member is Up: {${member.address}}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; MemberLeft(member) =&amp;gt;&lt;span&gt;
      log.info(s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Member is Leaving: {${member.address}}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; MemberExited(member) =&amp;gt;&lt;span&gt;
      log.info(s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Member is Exiting: {${member.address}}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; MemberRemoved(member, previousStatus) =&amp;gt;&lt;span&gt;
      log.info(
        s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Member is Removed: {${member.address}} after {${previousStatus}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;case&lt;/span&gt; UnreachableMember(member) =&amp;gt;&lt;span&gt;
      log.info(s&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Member detected as unreachable: {${member.address}}&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
      cluster.down(member.address)      &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ‰‹å·¥é©±é™¤ï¼Œä¸ç”¨auto-down&lt;/span&gt;
    &lt;span&gt;case&lt;/span&gt; _: MemberEvent =&amp;gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ignore&lt;/span&gt;
&lt;span&gt;  }

}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

</description>
<pubDate>Sat, 06 Apr 2019 12:55:00 +0000</pubDate>
<dc:creator>é›ªå·å¤§è™«</dc:creator>
<og:description>ä¸Šç¯‡æˆ‘ä»¬åšäº†ä¸€ä¸ªWriterActorçš„ä¾‹å­ï¼Œä¸»è¦ç›®çš„æ˜¯ç¤ºèŒƒWriterActorå¦‚ä½•ä½œä¸ºé›†ç¾¤åˆ†ç‰‡ç”¨persistentActorç‰¹æ€§åŠevent-sourcingæ¨¡å¼å®ç°CQRSçš„å†™åŠŸèƒ½ã€‚æ—¢ç„¶æ˜¯é›†ç¾¤</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/tiger-xc/p/10662854.html</dc:identifier>
</item>
<item>
<title>Spring Boot é¡¹ç›®å®æˆ˜ï¼ˆå…­ï¼‰é›†æˆ Apollo - æ«æœ¬éå‡¡</title>
<link>http://www.cnblogs.com/orzlin/p/10662492.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/orzlin/p/10662492.html</guid>
<description>&lt;h3 id=&quot;ä¸€å‰è¨€&quot;&gt;ä¸€ã€å‰è¨€&lt;/h3&gt;
&lt;p&gt;ä¸Šç¯‡ä»‹ç»äº† Spring Boot é›†æˆ Dubboï¼Œä½¿æˆ‘ä»¬çš„ç³»ç»Ÿæ‰“ä¸‹äº†åˆ†å¸ƒå¼çš„åŸºç¡€ã€‚éšç€ç¨‹åºåŠŸèƒ½çš„æ—¥ç›Šå¤æ‚ï¼Œç¨‹åºçš„é…ç½®æ—¥ç›Šå¢å¤šï¼šå„ç§åŠŸèƒ½å¼€å…³ã€å‚æ•°é…ç½®ã€æœåŠ¡å™¨åœ°å€ç­‰ï¼›å¯¹ç¨‹åºé…ç½®çš„æœŸæœ›å€¼ä¹Ÿè¶Šæ¥è¶Šé«˜ï¼šé…ç½®ä¿®æ”¹åå®æ—¶ç”Ÿæ•ˆï¼Œç°åº¦å‘å¸ƒï¼Œåˆ†ç¯å¢ƒã€åˆ†é›†ç¾¤ç®¡ç†é…ç½®ï¼Œå®Œå–„çš„æƒé™ã€å®¡æ ¸æœºåˆ¶ç­‰ï¼›åœ¨è¿™æ ·çš„å¤§ç¯å¢ƒä¸‹ï¼Œä¼ ç»Ÿçš„é€šè¿‡é…ç½®æ–‡ä»¶ã€æ•°æ®åº“ç­‰æ–¹å¼å·²ç»è¶Šæ¥è¶Šæ— æ³•æ»¡è¶³å¼€å‘äººå‘˜å¯¹é…ç½®ç®¡ç†çš„éœ€æ±‚ã€‚åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒåº”è¿è€Œç”Ÿã€‚æœ¬ç¯‡å°†ä¸»è¦ä»‹ç»åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ Apollo çš„é›†æˆè¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;hr/&gt;&lt;h3 id=&quot;äºŒéƒ¨ç½²-apollo&quot;&gt;äºŒã€éƒ¨ç½² Apollo&lt;/h3&gt;
&lt;p&gt;â‘  éƒ¨ç½²æ•™ç¨‹è§å®˜æ–¹æ–‡æ¡£ï¼š&lt;a href=&quot;https://github.com/ctripcorp/apollo/wiki/%E5%88%86%E5%B8%83%E5%BC%8F%E9%83%A8%E7%BD%B2%E6%8C%87%E5%8D%97&quot; class=&quot;uri&quot;&gt;https://github.com/ctripcorp/apollo/wiki/åˆ†å¸ƒå¼éƒ¨ç½²æŒ‡å—&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;â‘¡ æ¶æ„å‰–æï¼š&lt;a href=&quot;https://mp.weixin.qq.com/s/-hUaQPzfsl9Lm3IqQW3VDQ&quot; class=&quot;uri&quot;&gt;https://mp.weixin.qq.com/s/-hUaQPzfsl9Lm3IqQW3VDQ&lt;/a&gt;&lt;br/&gt;&lt;img src=&quot;http://blog.shoegaze.com/SpringBoot_6_0.png&quot; alt=&quot;SpringBoot_6_0.png&quot;/&gt;&lt;/p&gt;
&lt;hr/&gt;&lt;h3 id=&quot;ä¸‰ä½¿ç”¨-apollo&quot;&gt;ä¸‰ã€ä½¿ç”¨ Apollo&lt;/h3&gt;
&lt;p&gt;â‘  ç™»å½• Apollo ç®¡ç†æ§åˆ¶å°ååˆ›å»ºé¡¹ç›®ï¼Œå…¶ä¸­åº”ç”¨ ID å…¨å±€å”¯ä¸€ã€‚&lt;br/&gt;&lt;img src=&quot;http://blog.shoegaze.com/SpringBoot_6_1.png&quot; alt=&quot;SpringBoot_6_1.png&quot;/&gt;&lt;br/&gt;â‘¡ åˆ›å»ºæˆåŠŸåè·³è½¬åˆ°é¡¹ç›®ç»´æŠ¤ç•Œé¢ï¼Œå·¦ä¾§ä¸Šæ–¹ä¸ºç¯å¢ƒåˆ—è¡¨ï¼Œä¸­é—´åŒºåŸŸä¸ºé¡¹ç›®ä¿¡æ¯ï¼Œä¸‹æ–¹å¯æ“ä½œé›†ç¾¤åŠ namespace ã€‚å³ä¾§ä¸ºé»˜è®¤ namespace ï¼š&lt;strong&gt;application&lt;/strong&gt; ï¼Œå…·ä½“é…ç½®é¡¹åœ¨æ­¤åŒºåŸŸç»´æŠ¤ã€‚&lt;br/&gt;&lt;img src=&quot;http://blog.shoegaze.com/SpringBoot_6_2.png&quot; alt=&quot;SpringBoot_6_2.png&quot;/&gt;&lt;/p&gt;
&lt;hr/&gt;&lt;h3 id=&quot;å››spring-boot-é›†æˆ-apollo&quot;&gt;å››ã€Spring Boot é›†æˆ Apollo&lt;/h3&gt;
&lt;h4 id=&quot;å¼•å…¥-apollo-ä¾èµ–åŒ…&quot;&gt;4.1 å¼•å…¥ Apollo ä¾èµ–åŒ…&lt;/h4&gt;
&lt;p&gt;â‘  é¦–å…ˆåœ¨é¡¹ç›®çˆ¶ pom æ–‡ä»¶ä¸­å£°æ˜ Apollo ä¾èµ–ã€‚&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;dependencyManagement&amp;gt;
    &amp;lt;dependencies&amp;gt;
        ...çœç•¥å…¶ä½™éƒ¨åˆ†...
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;com.ctrip.framework.apollo&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;apollo-client&amp;lt;/artifactId&amp;gt;
            &amp;lt;version&amp;gt;1.2.0&amp;lt;/version&amp;gt;
        &amp;lt;/dependency&amp;gt;
    &amp;lt;/dependencies&amp;gt;
&amp;lt;/dependencyManagement&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;â‘¡ å…¶æ¬¡åœ¨ demo-biz å±‚ä¸­çš„ pom æ–‡ä»¶æ·»åŠ ä¸Šè¿° Apollo ä¾èµ–ã€‚&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;dependencies&amp;gt;
    ...çœç•¥å…¶ä½™éƒ¨åˆ†...
    &amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;com.ctrip.framework.apollo&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;apollo-client&amp;lt;/artifactId&amp;gt;
    &amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;æ·»åŠ -apollo-é…ç½®é¡¹&quot;&gt;4.2 æ·»åŠ  Apollo é…ç½®é¡¹&lt;/h4&gt;
&lt;p&gt;â‘  åœ¨ application.properties æ–‡ä»¶ä¸­çš„æ·»åŠ  Apollo ç›¸å…³çš„é…ç½®é¡¹ï¼š&lt;/p&gt;
&lt;pre class=&quot;yml&quot;&gt;
&lt;code&gt;# åº”ç”¨å…¨å±€å”¯ä¸€çš„èº«ä»½æ ‡è¯†
app.id = 20000
# Apollo Meta Server åœ°å€
apollo.meta = http://xxx.xxx.xxx.xxx:7881
# è‡ªå®šä¹‰æœ¬åœ°é…ç½®æ–‡ä»¶ç¼“å­˜è·¯å¾„
apollo.cacheDir = ./config
# è®¾ç½®åœ¨åº”ç”¨å¯åŠ¨é˜¶æ®µå°±åŠ è½½ Apollo é…ç½®
apollo.bootstrap.enabled = true
# æ³¨å…¥ application namespace
apollo.bootstrap.namespaces = application&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;â‘¡ å°† application.properties æ–‡ä»¶ä¸­çš„é™¤äº† Apollo åŠ Logback çš„å…¶ä»–é…ç½®é¡¹éƒ½è½¬ç§»åˆ° Apollo æ§åˆ¶å°ä¸­ç»´æŠ¤ã€‚&lt;br/&gt;&lt;img src=&quot;http://blog.shoegaze.com/SpringBoot_6_3.png&quot; alt=&quot;SpringBoot_6_3.png&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;éªŒè¯-apollo&quot;&gt;4.3 éªŒè¯ Apollo&lt;/h4&gt;
&lt;p&gt;â‘  å¯åŠ¨æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ° Apollo ä» Meta Server æ‹‰å–é…ç½®é¡¹ï¼Œå¹¶ç¼“å­˜åˆ°æœ¬åœ° config ç›®å½•ã€‚&lt;br/&gt;&lt;img src=&quot;http://blog.shoegaze.com/SpringBoot_6_4.png&quot; alt=&quot;SpringBoot_6_4.png&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;http://blog.shoegaze.com/SpringBoot_6_5.png&quot; alt=&quot;SpringBoot_6_5.png&quot;/&gt;&lt;br/&gt;â‘¡ è®¿é—® &lt;a href=&quot;http://localhost:8080/demo/test?id=1&quot; class=&quot;uri&quot;&gt;http://localhost:8080/demo/test?id=1&lt;/a&gt; æ¥å£æ­£å¸¸è¿”å›ã€‚&lt;/p&gt;
&lt;h4 id=&quot;æ‰˜ç®¡-logback-é…ç½®é¡¹&quot;&gt;4.4 æ‰˜ç®¡ Logback é…ç½®é¡¹&lt;/h4&gt;
&lt;p&gt;â‘  Apollo 1.2.0 ç‰ˆæœ¬åæ”¯æŒæ‰˜ç®¡æ—¥å¿—ç›¸å…³é…ç½®é¡¹ï¼Œåªéœ€è¦åœ¨ application.properties æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹ Apollo é…ç½®é¡¹ã€‚&lt;/p&gt;
&lt;pre class=&quot;yml&quot;&gt;
&lt;code&gt;# å°† Apollo é…ç½®åŠ è½½æåˆ°åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿä¹‹å‰ï¼Œéœ€è¦æ‰˜ç®¡æ—¥å¿—é…ç½®æ—¶å¼€å¯
apollo.bootstrap.eagerLoad.enabled = true&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;â‘¡ å°† Logback é…ç½®é¡¹è½¬ç§»åˆ° Apollo æ§åˆ¶å°ä¸­ç»´æŠ¤ã€‚&lt;/p&gt;
&lt;h4 id=&quot;æœ¬åœ°å¼€å‘æ¨¡å¼&quot;&gt;4.5 æœ¬åœ°å¼€å‘æ¨¡å¼&lt;/h4&gt;
&lt;p&gt;æŸäº›æƒ…å†µä¸‹æ¯”å¦‚ Dubbo æ¥å£æœ¬åœ°è”è°ƒï¼Œéœ€è¦ä¿®æ”¹ä¾èµ–æ–¹çš„æ¥å£ç‰ˆæœ¬ï¼Œæ­¤æ—¶å¯ä»¥å¼€å¯æœ¬åœ°å¼€å‘æ¨¡å¼ï¼Œåœ¨æœ¬åœ°å¼€å‘æ¨¡å¼ä¸‹ï¼ŒApollo åªä¼šä»æœ¬åœ°æ–‡ä»¶è¯»å–é…ç½®ä¿¡æ¯ï¼Œä¸ä¼šä» Apollo æœåŠ¡å™¨è¯»å–é…ç½®ã€‚é€šè¿‡&lt;strong&gt;è®¾ç½® JVM å‚æ•°&lt;/strong&gt;å¼€å¯ã€‚&lt;br/&gt;&lt;img src=&quot;http://blog.shoegaze.com/SpringBoot_6_6.png&quot; alt=&quot;SpringBoot_6_6.png&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;dubbo-åŠ-apollo-çš„å…¼å®¹é—®é¢˜&quot;&gt;4.6 Dubbo åŠ Apollo çš„å…¼å®¹é—®é¢˜&lt;/h4&gt;
&lt;p&gt;å®˜æ–¹åœ¨é›†æˆ Dubbo åŠ Apollo æ—¶æä¾›äº†ä¸¤ç§æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;â‘  çº¯ Spring Boot æ–¹å¼ï¼›å³ä¾èµ– dubbo-spring-boot-starter åŒ…ã€‚&lt;/li&gt;
&lt;li&gt;â‘¡ åŸç”Ÿ Dubbo æ–¹å¼ï¼›å³ä¾èµ– dubbo ã€zookeeper ã€ zkclient ã€curator-framework åŒ…ï¼Œç„¶åé€šè¿‡ XML æ–¹å¼é…ç½®ï¼Œé…ç½®é¡¹ç”¨ ${} å ä½ç¬¦ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;è€Œæˆ‘å½“æ—¶ä¸ºäº†èƒ½æ¸…æ¥šçŸ¥é“ï¼Œå¯¹å¤–æä¾›äº†å“ªäº› Dubbo æ¥å£ä»¥åŠä¾èµ–äº†å“ªäº›å¤–éƒ¨ Dubbo æ¥å£ï¼Œä½¿ç”¨ Spring XML çš„å½¢å¼é…ç½® Dubboï¼ŒåŒæ—¶åˆä¾èµ–äº† dubbo-spring-boot-starter åŒ…ï¼Œç»“æœå°† Dubbo é…ç½®é¡¹æ‰˜ç®¡è‡³ Apollo åï¼Œå‡ºç°æ— æ³•æ‰¾åˆ° Dubbo é…ç½®é¡¹çš„æƒ…å†µã€‚åŸå› æ˜¯&lt;strong&gt;é€šè¿‡ Spring XML æ–¹å¼é…ç½® Dubbo æ—¶æ‰€ä¾èµ–çš„ OverrideDubboConfigApplicationListener æ‰§è¡Œæ—¶æœºå¤ªæ—©äº†ï¼ˆè¿œæ—©äº Apollo é…ç½®åŠ è½½çš„æ—¶æœºï¼‰&lt;/strong&gt;ã€‚Apollo 1.2.0 ç‰ˆæœ¬æ”¯æŒã€Œ apollo.bootstrap.eagerLoad.enabled ã€é…ç½®é¡¹åè™½ç„¶èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†è¿˜æ˜¯ä¸æ¨è dubbo-spring-boot-starter + XML è¿™ç§å½¢å¼çš„é…ç½®æ–¹å¼ï¼Œæ¨èçº¯ Spring Boot æ–¹å¼ã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;1.0833333333333&quot;&gt;
&lt;p&gt;æ³¨ï¼šè¯¦è§ &lt;a href=&quot;https://github.com/ctripcorp/apollo/issues/1600&quot; class=&quot;uri&quot;&gt;https://github.com/ctripcorp/apollo/issues/1600&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr/&gt;&lt;h3 id=&quot;äº”ç»“è¯­&quot;&gt;äº”ã€ç»“è¯­&lt;/h3&gt;
&lt;p&gt;è‡³æ­¤ Spring Boot é›†æˆ Apollo çš„è¿‡ç¨‹ä»‹ç»å®Œæ¯•ï¼Œç›¸å…³ä»£ç å·²åŒæ­¥è‡³ GitHub ã€‚&lt;/p&gt;
</description>
<pubDate>Sat, 06 Apr 2019 10:29:00 +0000</pubDate>
<dc:creator>æ«æœ¬éå‡¡</dc:creator>
<og:description>ä¸€ã€å‰è¨€ ä¸Šç¯‡ä»‹ç»äº† Spring Boot é›†æˆ Dubboï¼Œä½¿æˆ‘ä»¬çš„ç³»ç»Ÿæ‰“ä¸‹äº†åˆ†å¸ƒå¼çš„åŸºç¡€ã€‚éšç€ç¨‹åºåŠŸèƒ½çš„æ—¥ç›Šå¤æ‚ï¼Œç¨‹åºçš„é…ç½®æ—¥ç›Šå¢å¤šï¼šå„ç§åŠŸèƒ½å¼€å…³ã€å‚æ•°é…ç½®ã€æœåŠ¡å™¨åœ°å€ç­‰ï¼›å¯¹ç¨‹åºé…ç½®çš„æœŸæœ›å€¼ä¹Ÿè¶Š</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/orzlin/p/10662492.html</dc:identifier>
</item>
<item>
<title>es6å¸¸ç”¨åŠŸèƒ½ä¸å¼‚æ­¥è¯¦è§£ï¼ˆJSé«˜çº§é¢è¯•é¢˜ï¼‰ - èŠ™è“‰0504</title>
<link>http://www.cnblogs.com/hibiscus-ben/p/10662245.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/hibiscus-ben/p/10662245.html</guid>
<description>&lt;p&gt;&lt;strong&gt;callback hellæ–¹æ³•çš„ä½¿ç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¯è¯»æ€§ä¸å‹å¥½&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;function loadImg(src,callback,fail){
    var img = document.createElement('img');
    img.onload = function(){
        callback(img);
    }
    img.onerror = function(){
        fail();
    }
    img.src = src;
}
var src = &quot;https://www.baidu.com/img/baidu_jgylogo3.gif&quot;;

loadImg(src,function(img){
    console.log('img width',img.width)
},function(){
    console.log('faild')
})&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;ç”¨promise å»æ”¹é€ &lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç”¨å¤šä¸ª.thenå»åˆ†æ‰¹å¤„ç†&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;function loadImg(src){
    return new Promise(function(resolve,reject){
        var img = document.createElement('img');
        img.onload = function(){
            resolve(img);
        }
        img.onerror = function(){
            reject();
        }
        img.src = src;
    })
}
var src=&quot;https://www.baidu.com/img/baidu_jgylogo3.gif&quot;;
var result = loadImg(src);
result.then(function(img){
    console.log('img width',img.width)
},function(){
    console.log('faild')
})
result.then(function(img){
    console.log('img height',img.height)
})&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;é—®é¢˜è§£ç­”ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;new promiseå®ä¾‹ï¼Œè€Œä¸”è¦ä¼ å…¥return&lt;/li&gt;
&lt;li&gt;new promiseæ—¶è¦ä¼ å…¥å‡½æ•°ï¼Œå‡½æ•°æœ‰resolve rejectå‡½æ•°&lt;/li&gt;
&lt;li&gt;æˆåŠŸæ—¶æ‰§è¡Œresolve()å¤±è´¥æ—¶æ‰§è¡Œreject()&lt;/li&gt;
&lt;li&gt;.thenç›‘å¬ç»“æœ&lt;/li&gt;
&lt;/ol&gt;&lt;h2 id=&quot;es6å¸¸ç”¨åŠŸèƒ½&quot;&gt;ES6å¸¸ç”¨åŠŸèƒ½&lt;/h2&gt;
&lt;ol&gt;&lt;li&gt;let å®šä¹‰å˜é‡ï¼Œå¯ä»¥é‡æ–°èµ‹å€¼&lt;/li&gt;
&lt;li&gt;const å®šä¹‰å¸¸é‡ï¼Œä¸å¯ä»¥é‡æ–°èµ‹å€¼&lt;/li&gt;
&lt;li&gt;å¤šè¡Œå­—ç¬¦ä¸²/æ¨¡æ¿å˜é‡&lt;/li&gt;
&lt;li&gt;è§£æ„èµ‹å€¼ï¼ˆè¯¦æƒ…è§es6ï¼‰&lt;/li&gt;
&lt;li&gt;å—çº§ä½œç”¨åŸŸï¼ˆå¾ˆå¤§çš„æ”¹åŠ¨ï¼‰&lt;/li&gt;
&lt;li&gt;å‡½æ•°é»˜è®¤å‚æ•°&lt;/li&gt;
&lt;li&gt;ç®­å¤´å‡½æ•°&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;&lt;strong&gt;å—çº§ä½œç”¨åŸŸ&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;lt;!-- åœ¨jsé‡Œé¢ --&amp;gt;
var obj = {a:100,b:200}
for (var key in obj) {
    console.log(key,'for in')
}
console.log(key)  // 100,200

&amp;lt;!-- åœ¨es6 --&amp;gt;
var obj = {a:100,b:200}
for (let key in obj) {
    console.log(key,'for in')
}
console.log(key); // undefine&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;ç®­å¤´å‡½æ•°æ”¹å˜thisæŒ‡å‘çš„é—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;&amp;lt;!-- ç”¨ç®­å¤´å‡½æ•°ï¼ŒæŒ‡å‘æœ¬èº«å‡½æ•°å¯¹è±¡ --&amp;gt;
function fn(){
    console.log('real',this); // {a:100}

    var arr = [1,2,3];
    arr.map(item=&amp;gt;{
        console.log(this); // {a:100}
    })
}
fn.call({a:100}); // callæ˜¯å¼ºåˆ¶è®©fnå‡½æ•°å¯¹è±¡æŒ‡å‘{a:100}

&amp;lt;!-- ä¸ç”¨ç®­å¤´å‡½æ•°,thisæŒ‡å‘window --&amp;gt;
function fn(){
    console.log('real',this); // {a:100}

    var arr = [1,2,3];
    arr.map(function(item){
        console.log(this); // window;
    })
}
fn.call({a:100});&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;åŸå‹&quot;&gt;åŸå‹&lt;/h2&gt;
&lt;p&gt;æè¿°ä¸€ä¸‹zeptoæ˜¯å¦‚ä½•ä½¿ç”¨åŸå‹&lt;br/&gt;æè¿°ä¸€ä¸‹jqueryå¦‚ä½•ä½¿ç”¨åŸå‹&lt;br/&gt;å†ç»“åˆè‡ªå·±çš„é¡¹ç›®ç»éªŒï¼Œè¯´ä¸€ä¸ªè‡ªå·±å¼€å‘çš„åˆ—å­&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;$p.css('color','red'); // cssæ˜¯åŸå‹æ–¹æ³•
$p.html(); // htmlæ˜¯åŸå‹æ–¹æ³•&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åŸå‹å¦‚ä½•ä½“ç°ä»–çš„æ‰©å±•æ€§&lt;/p&gt;
&lt;h2 id=&quot;å¼‚æ­¥&quot;&gt;å¼‚æ­¥&lt;/h2&gt;
&lt;p&gt;é—®é¢˜ï¼š&lt;/p&gt;
&lt;h5 id=&quot;ä¸€.-ä»€ä¹ˆæ˜¯å•çº¿ç¨‹å’Œå¼‚æ­¥æœ‰ä»€ä¹ˆå…³ç³»&quot;&gt;ä¸€. ä»€ä¹ˆæ˜¯å•çº¿ç¨‹ï¼Œå’Œå¼‚æ­¥æœ‰ä»€ä¹ˆå…³ç³»&lt;/h5&gt;
&lt;ol&gt;&lt;li&gt;å•çº¿ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼ŒåŒä¸€æ—¶é—´åªèƒ½åšä¸€ä»¶äº‹æƒ…&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code&gt;var i,sum = 0;
for(i=0;i&amp;lt;100000;i++){
    sum+=i;
}
console.log(sum);

&amp;lt;!-- alertä¸å¤„ç†ï¼Œjsæ‰§è¡Œå’Œdomæ¸²æŸ“æš‚æ—¶å¡é¡¿ --&amp;gt;
console.log(1);
alert('hello');
console.log(2);&lt;/code&gt;
&lt;/pre&gt;
&lt;ol readability=&quot;3&quot;&gt;&lt;li readability=&quot;7&quot;&gt;
&lt;p&gt;ç”¨å•çº¿ç¨‹çš„åŸå› -é¿å…DOMæ¸²æŸ“çš„å†²çª&lt;br/&gt;A. æµè§ˆå™¨éœ€è¦æ¸²æŸ“DOM&lt;/p&gt;
&lt;p&gt;B. jså¯ä»¥ä¿®æ”¹DOMç»“æ„&lt;/p&gt;
&lt;p&gt;C. JSæ‰§è¡Œçš„æ—¶å€™ï¼Œæµè§ˆå™¨DOMæ¸²æŸ“ä¼šæš‚åœ&lt;/p&gt;
&lt;p&gt;D. ä¸¤æ®µJSä¹Ÿä¸èƒ½åŒæ—¶æ‰§è¡Œï¼ˆéƒ½ä¿®æ”¹DOMå°±å†²çªäº†ï¼‰&lt;/p&gt;
&lt;p&gt;E. webworderæ”¯æŒå¤šçº¿ç¨‹ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®DOM&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;å•çº¿ç¨‹çš„è§£å†³å•çº¿ç¨‹æ–¹æ¡ˆ-å¼‚æ­¥&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code&gt;    console.log(100)
    setTimeout(function(){
        console.log(200);
    },1000)
    console.log(300);
    console.log(400);
    // 100
    // 300
    // 400
    // 200  ä¸€ç§’åæ‰§è¡Œ&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code&gt;console.log(100)
$.ajax({
    url:'XXXX',
    success:function(res){
        console.log(res) // æœ€åæ‰§è¡Œ
    }
});
console.log(300)
cobsole.log(400)&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¼‚æ­¥çš„é—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;é—®é¢˜ä¸€ï¼šæ²¡æœ‰æŒ‰ç…§ä¹¦å†™çš„æ–¹å¼æ‰§è¡Œï¼Œå¯è¯»æ€§å·®&lt;/p&gt;
&lt;p&gt;é—®é¢˜äºŒï¼šcallbackä¸­ä¸å®¹æ˜“æ¨¡å—åŒ–ï¼ˆsetTimeoutå’Œajaxé‡Œé¢çš„å‡½æ•°ï¼‰&lt;/p&gt;
&lt;h5 id=&quot;äºŒ.-ä»€ä¹ˆæ˜¯event-loop-å¼‚æ­¥çš„è§£å†³æ–¹æ¡ˆ&quot;&gt;äºŒ. ä»€ä¹ˆæ˜¯event-loop å¼‚æ­¥çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/h5&gt;
&lt;ol&gt;&lt;li&gt;äº‹ä»¶è½®è¯¢ï¼Œjså®ç°å¼‚æ­¥çš„å…·ä½“è§£å†³æ–¹æ¡ˆ&lt;/li&gt;
&lt;li&gt;åŒæ­¥ä»£ç ï¼Œç›´æ¥æ‰§è¡Œ&lt;/li&gt;
&lt;li&gt;å¼‚æ­¥å‡½æ•°å…ˆæ”¾åœ¨å¼‚æ­¥é˜Ÿåˆ—ä¸­ï¼›æœ‰setTimeoutç­‰å¾…æ—¶é—´è¿‡åï¼Œæ‰æ”¾å…¥å¼‚æ­¥é˜Ÿåˆ—ä¸­ã€‚ajaxæ‰§è¡Œå®Œæ¯•è¿‡åæ”¾å…¥å¼‚æ­¥é˜Ÿåˆ—&lt;/li&gt;
&lt;li&gt;å¾…åŒæ­¥å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œè½®è¯¢æ‰§è¡Œå¼‚æ­¥é˜Ÿåˆ—çš„å‡½æ•°&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;å›ç­”ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ä»€ä¹ˆæ˜¯å¼‚æ­¥é˜Ÿåˆ—ï¼Œä½•æ—¶è¢«æ”¾å…¥å¼‚æ­¥é˜Ÿåˆ—&lt;/li&gt;
&lt;li&gt;è½®è¯¢çš„è¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;h5 id=&quot;ä¸‰.-æ˜¯å¦ç”¨è¿‡jqueryçš„deferred&quot;&gt;ä¸‰. æ˜¯å¦ç”¨è¿‡jqueryçš„deferred&lt;/h5&gt;
&lt;p&gt;é—®é¢˜è§£ç­”ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;1. å¯ä»¥æ‹¿jquery1.5 å¯¹ajaxçš„æ”¹å˜ä¸¾ä¾‹

2. è¯´æ˜å¦‚ä½•ç®€å•çš„å°è£…ã€ä½¿ç”¨deferredï¼Œè¯´å‡ºå®ƒçš„å¥½å¤„

3. è¯´æ˜promiseå’Œdeferredçš„åŒºåˆ«&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;jQuery1.5çš„å˜åŒ–â€”â€”1.5ä¹‹å‰&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;var ajax = $.ajax({
    url:'./data.json',
    success:function(){
        console.log('success 1');
        console.log('success 2');
        console.log('success 3');
    },
    error:function(){
        console.log('error');
    }
})&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;jQuery1.5çš„å˜åŒ–â€”â€”1.5ä¹‹å&lt;br/&gt;&lt;strong&gt;è¿™æ ·å†™çš„å¥½å¤„ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;è¿™æ ·å¯¹ä¿®æ”¹å°é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾ï¼Œ&lt;/li&gt;
&lt;li&gt;å¢åŠ ä¸€ä¸ªå‡½æ•°ï¼Œä¸ç”¨å†ä¿®æ”¹åŸæ¥çš„å‡½æ•°&lt;/li&gt;
&lt;li&gt;å¤šäººå¼€å‘ï¼Œä¸€äººç»´æŠ¤ä¸€ä¸ªå‡½æ•°ã€‚&lt;/li&gt;
&lt;li&gt;æµ‹è¯•ä¹Ÿåªæµ‹è¯•æ–°çš„å‡½æ•°ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹ä»£ç ç®¡ç†å’Œç»´æŠ¤æœ‰å¥½å¤„çš„&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code&gt;// æ¯ä¸€ä¸ªæ–¹æ³•éƒ½ä¼šæ‰§è¡Œ
var ajax = $.ajax('data.json');
ajax.done(function(){
    console.log('success 1');  
}).fail(function(){
  console.log('fail 1');  
}).done(function(){
    console.log('success 2');  
}).fail(function(){
  console.log('fail 2');  
}).done(function(){
    console.log('success 3');  
}).fail(function(){
  console.log('fail 3');  
})
&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code&gt;&amp;lt;!-- ä¸promiseå¾ˆç›¸è¿‘äº† --&amp;gt;
var ajax = $.ajax('data.json')
ajax.then(function(){
   console.log('success 1'); 
},function(){
    console.log('error 1');
}).then(function(){
   console.log('success 2'); 
},function(){
    console.log('error 2');
})&lt;/code&gt;
&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;æ— æ³•æ”¹å˜jså¼‚æ­¥å’Œå•çº¿ç¨‹çš„æœ¬è´¨&lt;/li&gt;
&lt;li&gt;åªèƒ½ä»å†™æ³•ä¸Šæœç»callbackè¿™ç§å½¢å¼&lt;/li&gt;
&lt;li&gt;å®ƒæ˜¯ä¸€ç§è¯­æ³•ç³–å½¢å¼ï¼Œä½†æ˜¯è§£è€¦äº†ä»£ç &lt;/li&gt;
&lt;li&gt;å¾ˆå¥½çš„ä½“ç°ï¼šå¼€æ”¾å°é—­åŸåˆ™&lt;/li&gt;
&lt;li&gt;å‡å°‘äº†å›å½’æµ‹è¯•çš„æˆæœ¬ã€‚å¤šäººå¼€å‘æ–¹ä¾¿ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;ä½¿ç”¨jquery deferredä¸¾ä¾‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;var wait = function(){
    var task = function(){
        console.log('æ‰§è¡Œå®Œæˆ');
    }
    setTimeout(task,20000)
}
wait();&lt;/code&gt;
&lt;/pre&gt;
&lt;pre&gt;
&lt;code&gt;function waitHandle(){
    // å®šä¹‰ 
    var dtd = $.Deferred();
    
    var wait = function(dtd){
    
        var task = function(){
            console.log('æ‰§è¡Œå®Œæ¯•');
            // æˆåŠŸ
            dtd.resolve()
            // å¤±è´¥
            // dtd.reject()
        }
        setTimeout(task,2000);
        
        // waitè¿”å›
        return dtd;
    }
    
    // æœ€ç»ˆè¿”å›
    return wait(dtd);
}

var w = waitHandle();
w.then(function(){
    console.log('ok 1');
},function(){
    console.log('err 1');
})
w.then(function(){
    console.log('ok 2');
},function(){
    console.log('err 2');
})
w.then(function(){
    console.log('ok 3');
},function(){
    console.log('err 3');
})

w.reject();  //  ä¸ä¼šæŠ¥é”™


// å¼€æ”¾å°é—­åŸåˆ™ï¼ï¼ï¼&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ€»ç»“ï¼š&lt;br/&gt;dtdçš„APIå¯åˆ†æˆä¸¤ç±»ï¼Œç”¨æ„ä¸åŒ&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ç¬¬ä¸€ç±»ï¼šdtd.reolve  dtd.reject  ä¸»åŠ¨è§¦å‘

ç¬¬äºŒç±»ï¼šdtd.then  dtd.done  dtd.fail  è¢«åŠ¨ç›‘å¬&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åˆæ­¥å¼•å…¥promiseæ¦‚å¿µï¼Œæ˜¯ jquery deferred å¼•å…¥è¿‡æ¥çš„&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;promiseå’Œjquery deferredçš„åŒºåˆ«ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;promiseå¯¹è±¡åªèƒ½è¢«åŠ¨ç›‘å¬ï¼Œä¸èƒ½ä¸»åŠ¨ä¿®æ”¹ï¼Œæ‰€ä»¥åœ¨w.reject()ä¼šæŠ¥é”™ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;function waitHandle(){
    // å®šä¹‰ 
    var dtd = $.Deferred();
    
    var wait = function(dtd){
    
        var task = function(){
            console.log('æ‰§è¡Œå®Œæ¯•');
            // æˆåŠŸ
            dtd.resolve()
            // å¤±è´¥
            // dtd.reject()
        }
        setTimeout(task,2000);
        
        // waitè¿”å›
        return dtd.promise(); // è¿™é‡Œè¿”å›çš„æ˜¯promiseå¯¹è±¡
    }
    
    // æœ€ç»ˆè¿”å›
    return wait(dtd);
}
var w = waitHandle();
$.when(w).then(function(){
    console.log('ok 1');
},function(){
    console.log('err 1');
}).then(function(){
    console.log('ok 2');
},function(){
    console.log('err 2');
})

w.reject();  // è¿™é‡Œå°±ä¼šç›´æ¥æŠ¥é”™ã€‚
&lt;/code&gt;
&lt;/pre&gt;
&lt;h5 id=&quot;å››.-promiseçš„åŸºæœ¬ä½¿ç”¨å’ŒåŸç†&quot;&gt;å››. promiseçš„åŸºæœ¬ä½¿ç”¨å’ŒåŸç†&lt;/h5&gt;
&lt;p&gt;åŸºæœ¬è¯­æ³•å›é¡¾&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. å¼‚å¸¸æ•è·&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;function loadImg(src){
    return new Promise(resolve,reject){
        var img = document.createElement('img');
        img.onload = function(){
            resolve(img);
        }
        img.onerror = function(){
            reject('å›¾ç‰‡åŠ è½½å¤±è´¥');
        }
        img.src=  src;
    }
}

var src=&quot;https://wwww.img.address&quot;;
var result = loadimg(src);
// è§„å®šï¼šthenåªæ¥å—ä¸€ä¸ªæˆåŠŸçš„å‚æ•°ï¼Œæœ€åç»Ÿä¸€ç”¨catchæ¥æ•è·é”™è¯¯
result.then(function(img){
    console.log(1,img.width);
    return img;
}).then(function(img){
    console.log(2,img.width);
}).catch(function(ex){
    // ç»Ÿä¸€æ•è·å¼‚å¸¸ï¼Œä¹Ÿä¼šæ•è·åˆ°rejectæ–¹æ³•
    console.log(ex);
})
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;2. å¤šä¸ªä¸²è”&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;// åœºæ™¯ï¼šå¸Œæœ›åŠ è½½å®Œç¬¬ä¸€ä¸ªï¼Œå†åŠ è½½ç¬¬äºŒä¸ª
var src1 = 'img.address';
var result1 = loadImg(src1);
var src2 = 'img.address';
var result2 = loadImg(src2);

result1.then(function(img1){
    console.log('åŠ è½½ç¬¬ä¸€ç« å›¾ç‰‡',img1.width);
    return result2  // é‡è¦ï¼ï¼ï¼
}).then(function(img2){
    console.log('åŠ è½½ç¬¬äºŒç« å›¾ç‰‡',img2.width);  
}).catch(function(ex){
    console.log(ex);
})&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;3. promise.allå’Œpromise.race&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;// Promise.allæ¥æ”¶ä¸€ä¸ªpromiseå¯¹è±¡çš„æ•°ç»„
// å¾…å…¨éƒ¨å®Œæˆä¹‹åï¼Œç»Ÿä¸€æ‰§è¡Œsuccess
Promise.all([result1,result2]).then(datas=&amp;gt;{
    // æ¥æ”¶åˆ°çš„datasæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¾æ¬¡åŒ…å«äº†å¤šä¸ªpromiseè¿”å›çš„å†…å®¹
    console.log(datas[0]);
    console.log(datas[1]);
})

// Promise.race æ¥æ”¶ä¸€ä¸ªåŒ…å«å¤šä¸ªpromiseå¯¹è±¡çš„æ•°ç»„
// åªè¦æœ‰ä¸€ä¸ªå®Œæˆï¼Œå°±æ‰§è¡Œsuccess
Promise.race([result1,result2]).then(data=&amp;gt;{
    // data æ˜¯æœ€å…ˆæ‰§è¡Œå®Œæˆçš„ promiseå¯¹è±¡çš„è¿”å›å€¼
    console.log(datas);
})&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;4. promiseæ ‡å‡†&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å…³äºâ€œæ ‡å‡†â€çš„é—²è°ˆï¼Œæ ‡å‡†å¾ˆé‡è¦&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;    ä»»ä½•æŠ€æœ¯æ¨å¹¿ä½¿ç”¨éƒ½éœ€è¦ä¸€å¥—æ ‡å‡†æ¥æ”¯æ’‘
    å¦‚ html js css httpç­‰ï¼Œæ— è§„åˆ™ä¸æˆæ–¹åœ†
    ä»»ä½•ä¸ç¬¦åˆæ ‡å‡†çš„ä¸œè¥¿ï¼Œç»ˆå°†ä¼šè¢«ç”¨æˆ·æŠ›å¼ƒ&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;çŠ¶æ€å˜åŒ–&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;    ä¸‰ç§çŠ¶æ€ï¼špending fulfilled rejected
    åˆå§‹çŠ¶æ€pending
    pending å˜æˆfulfilledï¼Œæˆ–è€…pendingå˜ä¸ºrejected
    çŠ¶æ€ä¸å¯é€†&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;then&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;promise å®ä¾‹å¿…é¡»å®ç°thenè¿™ä¸ªæ–¹æ³•
then()å¿…é¡»å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‡½æ•°ä½œå‚æ•°
then()è¿”å›çš„å¿…é¡»æ˜¯ä¸€ä¸ªpromiseå®ä¾‹&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;é—®é¢˜è§£ç­”æ€»ç»“ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;1. åŸºæœ¬è¯­æ³•å¤ä¹ 
2. å¦‚ä½•å¼‚å¸¸æ•è·ï¼ˆerrorå’Œrejectéƒ½è¦è€ƒè™‘ï¼‰
3. å¤šä¸ªä¸²è”-é“¾å¼æ‰§è¡Œçš„å¥½å¤„
4. promise.allå’Œpromise.race
5. promiseæ ‡å‡†-çŠ¶æ€å˜åŒ–ï¼Œthenå‡½æ•°&lt;/code&gt;
&lt;/pre&gt;
&lt;h5 id=&quot;äº”.-ä»‹ç»ä¸€ä¸‹-asyncawait&quot;&gt;äº”. ä»‹ç»ä¸€ä¸‹ async/await&lt;/h5&gt;
&lt;p&gt;æ˜¯es7ä½“éªŒä¸­çš„ã€‚&lt;/p&gt;
&lt;p&gt;thenåªæ˜¯å°†callbackæ‹†åˆ†äº†&lt;/p&gt;
&lt;p&gt;async/awaitæ˜¯æœ€ç›´æ¥çš„åŒæ­¥å†™æ³•&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;const load = async function(){
    const result1 = await loadImg(src1);
    console.log(result1);
    const result2 = await loadImg(src1);
    console.log(result2);
}
load()&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¯­æ³•ï¼ˆå’Œpromiseçš„åŒºåˆ«å’Œè”ç³»ï¼‰&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;1. ä½¿ç”¨awaitï¼Œå‡½æ•°å¿…é¡»ç”¨asyncæ ‡è¯†
2. await åé¢è·Ÿçš„æ˜¯ä¸€ä¸ªpromiseå®ä¾‹
    ä½¿ç”¨äº†promiseï¼Œå¹¶æ²¡æœ‰å’Œpromiseå†²çª
    å®Œå…¨æ˜¯åŒæ­¥çš„å†™æ³•ï¼Œå†ä¹Ÿæ²¡æœ‰å›è°ƒå‡½æ•°
    ä½†æ˜¯ï¼šæ”¹å˜ä¸äº†JSå•çº¿ç¨‹ã€å¼‚æ­¥çš„æœ¬è´¨
3. éœ€è¦å®‰è£…babel-polyfillå¹¶ï¼Œå¼•å…¥&lt;/code&gt;
&lt;/pre&gt;
&lt;h5 id=&quot;å…­.-æ€»ç»“å½“å‰jså¼‚æ­¥è§£å†³æ–¹æ¡ˆ&quot;&gt;å…­. æ€»ç»“å½“å‰jså¼‚æ­¥è§£å†³æ–¹æ¡ˆ&lt;/h5&gt;
&lt;pre&gt;
&lt;code&gt;1. jQuery Deferred
2. Promise
3. async/await
4. generatorï¼ˆå¹¶ä¸æ˜¯è§£å†³å¼‚æ­¥çš„ï¼ŒåŸç†æ¯”è¾ƒå¤æ‚ï¼Œå¿½ç•¥ï¼‰&lt;/code&gt;
&lt;/pre&gt;</description>
<pubDate>Sat, 06 Apr 2019 09:05:00 +0000</pubDate>
<dc:creator>èŠ™è“‰0504</dc:creator>
<og:description>callback hellæ–¹æ³•çš„ä½¿ç”¨ å¯è¯»æ€§ä¸å‹å¥½ ç”¨promise å»æ”¹é€  ç”¨å¤šä¸ª.thenå»åˆ†æ‰¹å¤„ç† é—®é¢˜è§£ç­”ï¼š 1. new promiseå®ä¾‹ï¼Œè€Œä¸”è¦ä¼ å…¥return 1. new promi</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>http://www.cnblogs.com/hibiscus-ben/p/10662245.html</dc:identifier>
</item>
</channel>
</rss>