<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>åšå®¢å›­_é¦–é¡µ</title>
<link></link>
<description>ä»£ç æ”¹å˜ä¸–ç•Œ</description>
<item>
<title>Elasticsearchç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†æ–¹æ¡ˆ - zlt2000</title>
<link>http://www.cnblogs.com/zlt2000/p/14209665.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/zlt2000/p/14209665.html</guid>
<description>&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1769816/202012/1769816-20201230084209655-1454406711.png&quot; alt=&quot;file&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;ä¸€ã€å‰è¨€&quot;&gt;ä¸€ã€å‰è¨€&lt;/h2&gt;
&lt;p&gt;åœ¨ &lt;code&gt;Elasticsearch&lt;/code&gt; çš„æ—¥å¸¸ä¸­ï¼Œæœ‰å¾ˆå¤šå¦‚å­˜å‚¨ &lt;strong&gt;ç³»ç»Ÿæ—¥å¿—&lt;/strong&gt;ã€&lt;strong&gt;è¡Œä¸ºæ•°æ®&lt;/strong&gt;ç­‰æ–¹é¢çš„åº”ç”¨åœºæ™¯ï¼Œè¿™äº›åœºæ™¯çš„ç‰¹ç‚¹æ˜¯æ•°æ®é‡éå¸¸å¤§ï¼Œå¹¶ä¸”éšç€æ—¶é—´çš„å¢é•¿ &lt;code&gt;ç´¢å¼•&lt;/code&gt; çš„æ•°é‡ä¹Ÿä¼šæŒç»­å¢é•¿ï¼Œç„¶è€Œè¿™äº›åœºæ™¯åŸºæœ¬ä¸Šåªæœ‰æœ€è¿‘ä¸€æ®µæ—¶é—´çš„æ•°æ®æœ‰ä½¿ç”¨ä»·å€¼æˆ–è€…ä¼šè¢«ç»å¸¸ä½¿ç”¨ï¼ˆçƒ­æ•°æ®ï¼‰ï¼Œè€Œå†å²æ•°æ®å‡ ä¹æ²¡æœ‰ä½œç”¨æˆ–è€…å¾ˆå°‘ä¼šè¢«ä½¿ç”¨ï¼ˆå†·æ•°æ®ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å¯¹ &lt;code&gt;ç´¢å¼•&lt;/code&gt; è¿›è¡Œä¸€å®šç­–ç•¥çš„ç»´æŠ¤ç®¡ç†ç”šè‡³æ˜¯åˆ é™¤æ¸…ç†ï¼Œå¦åˆ™éšç€æ•°æ®é‡è¶Šæ¥è¶Šå¤šé™¤äº†æµªè´¹ç£ç›˜ä¸å†…å­˜ç©ºé—´ä¹‹å¤–ï¼Œè¿˜ä¼šä¸¥é‡å½±å“ &lt;code&gt;Elasticsearch&lt;/code&gt; çš„æ€§èƒ½ï¼›&lt;/p&gt;

&lt;p&gt;åœ¨ &lt;code&gt;Elastic Stack 6.6&lt;/code&gt; ç‰ˆæœ¬åæ¨å‡ºäº†æ–°åŠŸèƒ½ &lt;code&gt;Index Lifecycle Management(ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†)&lt;/code&gt;ï¼Œæ”¯æŒé’ˆå¯¹ç´¢å¼•çš„å…¨ç”Ÿå‘½å‘¨æœŸæ‰˜ç®¡ç®¡ç†ï¼Œå¹¶ä¸”åœ¨ &lt;code&gt;Kibana&lt;/code&gt; ä¸Šä¹Ÿæä¾›äº†ä¸€å¥— UI ç•Œé¢æ¥é…ç½®ç­–ç•¥ã€‚æœ¬æ–‡ä¸»è¦ä»‹ç» &lt;code&gt;Elasticsearch&lt;/code&gt; ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†å¦‚ä½•é…ç½®å’Œä½¿ç”¨ã€‚&lt;/p&gt;

&lt;h2 id=&quot;äºŒã€ç”Ÿå‘½å‘¨æœŸ&quot;&gt;äºŒã€ç”Ÿå‘½å‘¨æœŸ&lt;/h2&gt;
&lt;h3 id=&quot;21-é˜¶æ®µä»‹ç»&quot;&gt;2.1. é˜¶æ®µä»‹ç»&lt;/h3&gt;
&lt;p&gt;ç´¢å¼•ç”Ÿå‘½å‘¨æœŸåˆ†ä¸º4ä¸ªé˜¶æ®µï¼šhotã€warmã€coldã€deleteï¼Œå…¶ä¸­hotä¸»è¦è´Ÿè´£å¯¹ç´¢å¼•è¿›è¡Œrolloveræ“ä½œã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;rolloverï¼šæ»šåŠ¨æ›´æ–°åˆ›å»ºçš„æ–°ç´¢å¼•å°†æ·»åŠ åˆ°ç´¢å¼•åˆ«åï¼Œå¹¶è¢«æŒ‡å®šä¸ºå†™ç´¢å¼•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;PS&lt;/strong&gt;ï¼š4ä¸ªé˜¶æ®µä¸­åªæœ‰hoté˜¶æ®µæ˜¯å¿…é¡»çš„&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1769816/202012/1769816-20201230084210166-9053356.png&quot; alt=&quot;file&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ç´¢å¼•æ ¹æ®æ—¶é—´å‚æ•°min_ageè¿›å…¥ç”Ÿå‘½å‘¨æœŸé˜¶æ®µï¼Œè‹¥æœªè®¾ç½®ï¼Œé»˜è®¤æ˜¯0msã€‚min_ageé€šå¸¸æ˜¯ä»åˆ›å»ºç´¢å¼•çš„æ—¶é—´å¼€å§‹è®¡ç®—ï¼Œå¦‚æœç´¢å¼•è¢«è®¾ç½®ä¸ºæ»šåŠ¨ç´¢å¼•ï¼Œé‚£ä¹ˆmin_ageæ˜¯ä»ç´¢å¼•æ»šåŠ¨å¼€å§‹è®¡ç®—ã€‚æ³¨æ„ï¼Œåœ¨æ£€æŸ¥min_ageå‚æ•°å¹¶è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µå‰ï¼Œå½“å‰é˜¶æ®µçš„æ“ä½œå¿…é¡»å®Œæˆã€‚&lt;/p&gt;

&lt;h3 id=&quot;22-é˜¶æ®µåŠ¨ä½œ&quot;&gt;2.2. é˜¶æ®µåŠ¨ä½œ&lt;/h3&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;é˜¶æ®µ/action&lt;/th&gt;
&lt;th&gt;ä¼˜å…ˆçº§è®¾ç½®&lt;/th&gt;
&lt;th&gt;å–æ¶ˆè·Ÿéš&lt;/th&gt;
&lt;th&gt;æ»šåŠ¨ç´¢å¼•&lt;/th&gt;
&lt;th&gt;åˆ†ç‰‡åˆ†é…&lt;/th&gt;
&lt;th&gt;åªè¯»&lt;/th&gt;
&lt;th&gt;å¼ºåˆ¶æ®µåˆå¹¶&lt;/th&gt;
&lt;th&gt;æ”¶ç¼©ç´¢å¼•&lt;/th&gt;
&lt;th&gt;å†»ç»“ç´¢å¼•&lt;/th&gt;
&lt;th&gt;åˆ é™¤&lt;/th&gt;
&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;hot&lt;/td&gt;
&lt;td&gt;âˆš&lt;/td&gt;
&lt;td&gt;âˆš&lt;/td&gt;
&lt;td&gt;âˆš&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;warm&lt;/td&gt;
&lt;td&gt;âˆš&lt;/td&gt;
&lt;td&gt;âˆš&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;âˆš&lt;/td&gt;
&lt;td&gt;âˆš&lt;/td&gt;
&lt;td&gt;âˆš&lt;/td&gt;
&lt;td&gt;âˆš&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;cold&lt;/td&gt;
&lt;td&gt;âˆš&lt;/td&gt;
&lt;td&gt;âˆš&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;âˆš&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;âˆš&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;delete&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;Ã—&lt;/td&gt;
&lt;td&gt;âˆš&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;
&lt;h3 id=&quot;23-ä¾‹å­&quot;&gt;2.3. ä¾‹å­&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢ä»¥ç´¢å¼• &lt;code&gt;syslog-2020.10.01&lt;/code&gt; ä¸ºä¾‹å­ï¼Œåœ¨ç´¢å¼•åˆ›å»º 1 å¤©åè½¬ä¸º Warm é˜¶æ®µï¼Œ30 å¤©åè½¬ä¸º Cold é˜¶æ®µï¼Œ30 å¤©ååˆ é™¤&lt;/p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;æ—¥æœŸ&lt;/th&gt;
&lt;th&gt;åŠ¨ä½œ&lt;/th&gt;
&lt;th&gt;é˜¶æ®µ&lt;/th&gt;
&lt;/tr&gt;&lt;/thead&gt;&lt;tbody readability=&quot;4&quot;&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;2020-10-01&lt;/td&gt;
&lt;td&gt;åˆ›å»ºç´¢å¼• &lt;code&gt;syslog-2020.10.01&lt;/code&gt; ï¼Œå¤„ç†è¯»å†™è¯·æ±‚&lt;/td&gt;
&lt;td&gt;hoté˜¶æ®µ&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;2020-10-02&lt;/td&gt;
&lt;td&gt;&lt;code&gt;syslog-2020.10.01&lt;/code&gt; æ”¹ä¸ºåªè¯»&lt;/td&gt;
&lt;td&gt;warmé˜¶æ®µ&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;2020-11-01&lt;/td&gt;
&lt;td&gt;&lt;code&gt;syslog-2020.10.01&lt;/code&gt; ä¸ºåªè¯»ï¼Œå¹¶è¿ç§»åˆ°å†·èŠ‚ç‚¹å‚¨å­˜&lt;/td&gt;
&lt;td&gt;coldé˜¶æ®µ&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;2020-12-01&lt;/td&gt;
&lt;td&gt;åˆ é™¤ç´¢å¼• &lt;code&gt;syslog-2020.10.01&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;deleteé˜¶æ®µ&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;
&lt;h2 id=&quot;ä¸‰ã€æ¨¡æ‹Ÿè¿‡ç¨‹&quot;&gt;ä¸‰ã€æ¨¡æ‹Ÿè¿‡ç¨‹&lt;/h2&gt;
&lt;h3 id=&quot;31-åˆ›å»ºç´¢å¼•ç”Ÿå‘½å‘¨æœŸç­–ç•¥&quot;&gt;3.1. åˆ›å»ºç´¢å¼•ç”Ÿå‘½å‘¨æœŸç­–ç•¥&lt;/h3&gt;
&lt;p&gt;å‡è®¾ &lt;code&gt;Policy&lt;/code&gt; è®¾å®šå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ç´¢å¼•ä»¥æ¯10ä¸ªæ–‡æ¡£åšä¸€æ¬¡ &lt;code&gt;Rollover&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Rollover&lt;/code&gt; å 5 ç§’è½¬ä¸º &lt;code&gt;Warm&lt;/code&gt; é˜¶æ®µ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Rollover&lt;/code&gt; å 20 ç§’è½¬ä¸º &lt;code&gt;Cold&lt;/code&gt; é˜¶æ®µ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Rollover&lt;/code&gt; å 40 ç§’åˆ é™¤&lt;/li&gt;
&lt;/ul&gt;&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;curl -XPUT &quot;http://$IP:9200/_ilm/policy/my_ilm_policy&quot; \
    -H 'Content-Type: application/json' \
    -u elastic:changeme \
    -d '{
      &quot;policy&quot;: {
        &quot;phases&quot;: {
          &quot;hot&quot;: {
            &quot;actions&quot;: {
              &quot;rollover&quot;: {
                &quot;max_docs&quot;: &quot;10&quot;
              }
            }
          },
          &quot;warm&quot;: {
            &quot;min_age&quot;: &quot;5s&quot;,
            &quot;actions&quot;: {
              &quot;allocate&quot;: {
                &quot;include&quot;: {
                  &quot;box_type&quot;: &quot;warm&quot;
                }
              }
            }
          },
          &quot;cold&quot;: {
            &quot;min_age&quot;: &quot;20s&quot;,
            &quot;actions&quot;: {
              &quot;allocate&quot;: {
                &quot;include&quot;: {
                  &quot;box_type&quot;: &quot;cold&quot;
                }
              }
            }
          },
          &quot;delete&quot;: {
            &quot;min_age&quot;: &quot;40s&quot;,
            &quot;actions&quot;: {
              &quot;delete&quot;: {}
            }
          }
        }
      }
    }'
&lt;/code&gt;
&lt;/pre&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;ipã€ç”¨æˆ·åå’Œå¯†ç æŒ‰å®é™…æƒ…å†µä¿®æ”¹&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;32-å…³è”ç­–ç•¥&quot;&gt;3.2. å…³è”ç­–ç•¥&lt;/h3&gt;
&lt;p&gt;å…³è”ç­–ç•¥æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ä½¿ç”¨ç´¢å¼•æ¨¡æ¿å…³è”å’Œç´¢å¼•ç›´æ¥å…³è”&lt;/p&gt;
&lt;h4 id=&quot;321-ç´¢å¼•æ¨¡æ¿å…³è”&quot;&gt;3.2.1. ç´¢å¼•æ¨¡æ¿å…³è”&lt;/h4&gt;
&lt;p&gt;ç´¢å¼•æ¨¡æ¿æ¥åˆ›å»ºæ‰€éœ€çš„ç´¢å¼•ï¼Œå¹¶å…³è”ilmç­–ç•¥&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;curl -XPUT &quot;http://$IP:9200/_template/my_test_template&quot; \
    -H 'Content-Type: application/json' \
    -u elastic:changeme \
    -d '{
        &quot;index_patterns&quot;: [&quot;my-test-*&quot;], 
        &quot;settings&quot;: {
            &quot;number_of_shards&quot;: 1,
            &quot;number_of_replicas&quot;: 0,
            &quot;index.lifecycle.name&quot;: &quot;my_ilm_policy&quot;, 
            &quot;index.lifecycle.rollover_alias&quot;: &quot;my-test&quot;,
            &quot;index.routing.allocation.include.box_type&quot;: &quot;hot&quot;
        }
    }'
&lt;/code&gt;
&lt;/pre&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;ipã€ç”¨æˆ·åå’Œå¯†ç æŒ‰å®é™…æƒ…å†µä¿®æ”¹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;index.lifecycle.nameï¼šæŒ‡æ˜è¯¥ç´¢å¼•åº”ç”¨çš„ ILM Policy&lt;br/&gt;index.lifecycle.rollover_aliasï¼šæŒ‡æ˜åœ¨ Rollover çš„æ—¶å€™ä½¿ç”¨çš„ alias&lt;br/&gt;index.routing.allocation.include.box_typeï¼šæŒ‡æ˜æ–°å»ºçš„ç´¢å¼•éƒ½åˆ†é…åœ¨ hot èŠ‚ç‚¹ä¸Š&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;322-ç´¢å¼•ç›´æ¥å…³è”&quot;&gt;3.2.2. ç´¢å¼•ç›´æ¥å…³è”&lt;/h4&gt;
&lt;p&gt;ä¸ºç°æœ‰çš„ç´¢å¼•å•ç‹¬å…³è”ç­–ç•¥&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;curl -XPUT &quot;http://$IP:9200/my-test-*/_settings&quot; \
    -H 'Content-Type: application/json' \
    -u elastic:changeme \
    -d '{
      &quot;index&quot;: {
        &quot;lifecycle&quot;: {
          &quot;name&quot;: &quot;my_ilm_policy&quot;
        }
      }
    }'
&lt;/code&gt;
&lt;/pre&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;ipã€ç”¨æˆ·åå’Œå¯†ç æŒ‰å®é™…æƒ…å†µä¿®æ”¹&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;33-æŸ¥çœ‹ç´¢å¼•æ‰€å¤„é˜¶æ®µ&quot;&gt;3.3. æŸ¥çœ‹ç´¢å¼•æ‰€å¤„é˜¶æ®µ&lt;/h3&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;http://$IP:9200/my-test-*/_ilm/explain
&lt;/code&gt;
&lt;/pre&gt;

&lt;h3 id=&quot;34-æ›´æ–°ç­–ç•¥&quot;&gt;3.4. æ›´æ–°ç­–ç•¥&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;å¦‚æœæ²¡æœ‰indexåº”ç”¨è¿™ä»½ç­–ç•¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥æ›´æ–°è¯¥ç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæœ‰indexåº”ç”¨äº†è¿™ä»½ç­–ç•¥ï¼Œé‚£ä¹ˆå½“å‰æ­£åœ¨æ‰§è¡Œçš„é˜¶æ®µä¸ä¼šåŒæ­¥ä¿®æ”¹ï¼Œå½“å½“å‰é˜¶æ®µç»“æŸåï¼Œä¼šè¿›å…¥æ–°ç‰ˆæœ¬ç­–ç•¥çš„ä¸‹ä¸ªé˜¶æ®µã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ›´æ¢äº†ç­–ç•¥ï¼Œå½“å‰æ­£åœ¨æ‰§è¡Œçš„é˜¶æ®µä¸ä¼šå˜åŒ–ï¼Œåœ¨ç»“æŸå½“å‰é˜¶æ®µåï¼Œå°†ä¼šç”±æ–°çš„ç­–ç•¥ç®¡ç†ä¸‹ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;35-kibanaå›¾å½¢åŒ–æ“ä½œ&quot;&gt;3.5. kibanaå›¾å½¢åŒ–æ“ä½œ&lt;/h3&gt;
&lt;p&gt;ä¸Šè¿°çš„æ­¥éª¤ï¼Œå¤§éƒ¨åˆ†éƒ½å¯ä»¥åœ¨ &lt;code&gt;Kibana&lt;/code&gt; ä¸­ä»¥å›¾å½¢åŒ–ç•Œé¢çš„æ–¹å¼è¿›è¡Œæ“ä½œ&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1769816/202012/1769816-20201230084210456-1227497607.png&quot; alt=&quot;file&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1769816/202012/1769816-20201230084210633-488915121.png&quot; alt=&quot;file&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šå¦‚æœä½¿ç”¨å›¾å½¢åŒ–ç•Œé¢æ¥åˆ›å»ºç­–ç•¥ï¼Œåˆ é™¤é˜¶æ®µä¼šç¼ºå¤± &lt;code&gt;actions&lt;/code&gt; å†…å®¹è€Œå¯¼è‡´æ— æ³•åˆ é™¤&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;å››ã€ä¿®æ”¹è½®è¯¢é—´éš”å¯é€‰&quot;&gt;å››ã€ä¿®æ”¹è½®è¯¢é—´éš”(å¯é€‰)&lt;/h2&gt;
&lt;p&gt;ILM Service ä¼šåœ¨åå°è½®è¯¢æ‰§è¡Œ Policyï¼Œé»˜è®¤é—´éš”æ—¶é—´ä¸º 10 åˆ†é’Ÿï¼Œä¸ºäº†æµ‹è¯•æ›´å¿«åœ°çœ‹åˆ°æ•ˆæœï¼Œå¯å°†å…¶ä¿®æ”¹ä¸º1ç§’ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;curl -XPUT &quot;http://$IP:9200/_cluster/settings&quot; \
    -H 'Content-Type: application/json' \
    -u elastic:changeme \
    -d '{
        &quot;persistent&quot;: {
          &quot;indices.lifecycle.poll_interval&quot;:&quot;1s&quot;
        }
    }'
&lt;/code&gt;
&lt;/pre&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;ipã€ç”¨æˆ·åå’Œå¯†ç æŒ‰å®é™…æƒ…å†µä¿®æ”¹&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;äº”ã€å¯åŠ¨å’Œåœæ­¢ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†&quot;&gt;äº”ã€å¯åŠ¨å’Œåœæ­¢ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;ILM é»˜è®¤å¼€å¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç”±ILMç®¡ç†çš„æ‰€æœ‰ç´¢å¼•å°†ç»§ç»­æ‰§è¡Œå…¶ç­–ç•¥ã€‚æœ‰æ—¶å¯èƒ½ä¸éœ€è¦æŸäº›ç´¢å¼•ï¼Œç”šè‡³é›†ç¾¤ä¸­çš„æ‰€æœ‰ç´¢å¼•éƒ½ä¸éœ€è¦ã€‚ä¾‹å¦‚ï¼Œå½“éœ€è¦é›†ç¾¤æ‹“æ‰‘æ›´æ”¹æ—¶ï¼Œå¯èƒ½ä¼šæœ‰è®¡åˆ’çš„ç»´æŠ¤çª—å£ï¼Œè¿™å¯èƒ½ä¼šå½±å“æ­£åœ¨è¿è¡Œçš„ILMæ“ä½œã€‚å› æ­¤ï¼ŒILMæœ‰ä¸¤ç§ç¦ç”¨æ“ä½œçš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;åœæ­¢ILMæ—¶ï¼Œå¿«ç…§ç”Ÿå‘½å‘¨æœŸç®¡ç†æ“ä½œä¹Ÿä¼šåœæ­¢ï¼Œè¿™æ„å‘³ç€ä¸ä¼šåˆ›å»ºè®¡åˆ’çš„å¿«ç…§ï¼ˆå½“å‰æ­£åœ¨è¿›è¡Œçš„å¿«ç…§ä¸å—å½±å“ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸ï¼ŒILMå°†é»˜è®¤è¿è¡Œã€‚è¦æŸ¥çœ‹ILMçš„å½“å‰è¿è¡ŒçŠ¶æ€ï¼Œè¯·ä½¿ç”¨&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.4/ilm-get-status.html&quot; target=&quot;_blank&quot;&gt;Get Status API&lt;/a&gt; æ¥æŸ¥çœ‹ILMçš„å½“å‰çŠ¶æ€ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;GET  _ilm/status
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¦‚æœè¯·æ±‚æ²¡æœ‰é‡åˆ°é”™è¯¯ï¼Œæ‚¨å°†æ”¶åˆ°ä»¥ä¸‹ç»“æœï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-json&quot;&gt;{
    &quot;operation_mode&quot;: &quot;RUNNING&quot;
}
&lt;/code&gt;
&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;ILMçš„æ“ä½œæ¨¡å¼&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;é˜¶æ®µ/action&lt;/th&gt;
&lt;th&gt;ä¼˜å…ˆçº§è®¾ç½®&lt;/th&gt;
&lt;/tr&gt;&lt;/thead&gt;&lt;tbody readability=&quot;3&quot;&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;æ­£åœ¨è¿è¡Œ&lt;/td&gt;
&lt;td&gt;æ­£å¸¸è¿è¡Œï¼Œæ‰€æœ‰ç­–ç•¥å‡æ­£å¸¸æ‰§è¡Œ&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;åœæ­¢&lt;/td&gt;
&lt;td&gt;ILMå·²æ”¶åˆ°åœæ­¢è¯·æ±‚ï¼Œä½†ä»åœ¨å¤„ç†æŸäº›ç­–ç•¥&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;2&quot;&gt;&lt;td&gt;å·²åœæ­¢&lt;/td&gt;
&lt;td&gt;è¿™è¡¨ç¤ºæ²¡æœ‰æ‰§è¡Œä»»ä½•ç­–ç•¥çš„çŠ¶æ€&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;
&lt;h3 id=&quot;51-åœæ­¢ilm&quot;&gt;5.1. åœæ­¢ILM&lt;/h3&gt;
&lt;p&gt;å¯ä»¥æš‚åœILMæœåŠ¡ï¼Œä»¥ä¾¿ä½¿ç”¨&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.4/ilm-stop.html&quot; target=&quot;_blank&quot;&gt;Stop API&lt;/a&gt;ä¸å†æ‰§è¡Œå…¶ä»–æ­¥éª¤ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;POST  _ilm/stop
&lt;/code&gt;
&lt;/pre&gt;

&lt;p&gt;åœæ­¢åï¼Œæ‰€æœ‰å…¶ä»–æ”¿ç­–æªæ–½éƒ½å°†åœæ­¢ã€‚è¿™å°†åæ˜ åœ¨çŠ¶æ€APIä¸­&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-json&quot;&gt;{
    &quot;operation_mode&quot;: &quot;STOPPING&quot;
}
&lt;/code&gt;
&lt;/pre&gt;

&lt;p&gt;ç„¶åï¼ŒILMæœåŠ¡å°†å¼‚æ­¥åœ°å°†æ‰€æœ‰ç­–ç•¥è¿è¡Œåˆ°å¯ä»¥å®‰å…¨åœæ­¢çš„ä½ç½®ã€‚åœ¨ILMç¡®è®¤å®ƒæ˜¯å®‰å…¨çš„ä¹‹åï¼Œå®ƒå°†ç§»è‡³è¯¥&lt;code&gt;STOPPED&lt;/code&gt;æ¨¡å¼&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-json&quot;&gt;{
    &quot;operation_mode&quot;: &quot;STOPPED&quot;
}
&lt;/code&gt;
&lt;/pre&gt;

&lt;h3 id=&quot;52-å¯åŠ¨ilm&quot;&gt;5.2. å¯åŠ¨ILM&lt;/h3&gt;
&lt;p&gt;è¦å¯åŠ¨ILMå¹¶ç»§ç»­æ‰§è¡Œç­–ç•¥ï¼Œè¯·ä½¿ç”¨&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.4/ilm-start.html&quot; target=&quot;_blank&quot;&gt;Start API&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;POST  _ilm/start
&lt;/code&gt;
&lt;/pre&gt;

&lt;p&gt;Start APIå°†å‘ILMæœåŠ¡å‘é€è¯·æ±‚ï¼Œä»¥ç«‹å³å¼€å§‹æ­£å¸¸æ“ä½œã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-json&quot;&gt;{
  &quot;operation_mode&quot;: &quot;RUNNING&quot;
}
&lt;/code&gt;
&lt;/pre&gt;

&lt;h2 id=&quot;å…­ã€apiæ¸…å•&quot;&gt;å…­ã€APIæ¸…å•&lt;/h2&gt;
&lt;p&gt;å¯ä»¥ä½¿ç”¨ä»¥ä¸‹APIæ¥ç®¡ç†ç´¢å¼•ç­–ç•¥ã€‚å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.4/index-lifecycle-management.html&quot; target=&quot;_blank&quot;&gt;ç®¡ç†ç´¢å¼•ç”Ÿå‘½å‘¨æœŸ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;
&lt;p&gt;æ”¿ç­–ç®¡ç†API&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç´¢å¼•ç®¡ç†API&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿è¥ç®¡ç†API&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ‰«ç å…³æ³¨æœ‰æƒŠå–œï¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/1769816/202012/1769816-20201230084210827-860915113.png&quot; alt=&quot;file&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 30 Dec 2020 00:42:00 +0000</pubDate>
<dc:creator>zlt2000</dc:creator>
<og:description>ä¸€ã€å‰è¨€ åœ¨ Elasticsearch çš„æ—¥å¸¸ä¸­ï¼Œæœ‰å¾ˆå¤šå¦‚å­˜å‚¨ ç³»ç»Ÿæ—¥å¿—ã€è¡Œä¸ºæ•°æ®ç­‰æ–¹é¢çš„åº”ç”¨åœºæ™¯ï¼Œè¿™äº›åœºæ™¯çš„ç‰¹ç‚¹æ˜¯æ•°æ®é‡éå¸¸å¤§ï¼Œå¹¶ä¸”éšç€æ—¶é—´çš„å¢é•¿ ç´¢å¼• çš„æ•°é‡ä¹Ÿä¼šæŒç»­å¢é•¿ï¼Œç„¶è€Œè¿™äº›åœºæ™¯åŸºæœ¬ä¸Šåªæœ‰</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/zlt2000/p/14209665.html</dc:identifier>
</item>
<item>
<title>SpringBoot çš„å¤šæ•°æ®æºé…ç½® - æœªè¯»ä»£ç </title>
<link>http://www.cnblogs.com/niumoo/p/14209663.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/niumoo/p/14209663.html</guid>
<description>&lt;p&gt;æœ€è¿‘åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œéœ€è¦ä¸ºä¸€ä¸ªä½¿ç”¨ MySQL æ•°æ®åº“çš„ SpringBoot é¡¹ç›®ï¼Œæ–°æ·»åŠ ä¸€ä¸ª PLSQL æ•°æ®åº“æ•°æ®æºï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œ SpringBoot çš„å¤šæ•°æ®æºå¼€å‘ã€‚ä»£ç å¾ˆç®€å•ï¼Œä¸‹é¢æ˜¯å®ç°çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç¯å¢ƒå‡†å¤‡&quot;&gt;ç¯å¢ƒå‡†å¤‡&lt;/h2&gt;
&lt;p&gt;å®éªŒç¯å¢ƒï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;JDK 1.8&lt;/li&gt;
&lt;li&gt;SpringBoot 2.4.1&lt;/li&gt;
&lt;li&gt;Maven 3.6.3&lt;/li&gt;
&lt;li&gt;MySQL 5.7&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;å› ä¸ºæˆ‘æœ¬åœ°åªæœ‰ MySQL æ•°æ®åº“ï¼Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä¼šåœ¨å¯åŠ¨ä¸€ä¸ªæœ¬åœ° MySQLï¼Œåœ¨ MySQL åˆ›å»ºä¸¤ä¸ªæ•°æ®åº“ï¼Œæ¯ä¸ªåº“ä¸­å‡æœ‰ä¸€ä¸ªè¡¨ï¼Œä»¥æ­¤è¿›è¡Œæ¼”ç¤ºã€‚&lt;/p&gt;
&lt;h3 id=&quot;æ•°æ®å‡†å¤‡&quot;&gt;æ•°æ®å‡†å¤‡&lt;/h3&gt;
&lt;p&gt;æœ¬åœ° MySQL ç«¯å£é»˜è®¤ä¸åšæ”¹åŠ¨ï¼Œç«¯å£å· 3306ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºæ•°æ®åº“ demo1ï¼Œdemo2ã€‚åœ¨ demo1 æ•°æ®åº“ä¸­åˆ›å»ºè¡¨ bookã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-sql&quot;&gt;-- create table
create table Book
(
    id          int auto_increment
        primary key,
    author      varchar(64)  not null comment 'ä½œè€…ä¿¡æ¯',
    name        varchar(64)  not null comment 'ä¹¦ç±åç§°',
    price       decimal      not null comment 'ä»·æ ¼',
    createTime  datetime     null comment 'ä¸Šæ¶æ—¶é—´',
    description varchar(128) null comment 'ä¹¦ç±æè¿°'
);
-- insert data
INSERT INTO demo1.Book (id, author, name, price, createTime, description) VALUES (1, 'é‡‘åº¸', 'ç¬‘å‚²æ±Ÿæ¹–', 13, '2020-12-19 15:26:51', 'æ­¦ä¾ å°è¯´');
INSERT INTO demo1.Book (id, author, name, price, createTime, description) VALUES (2, 'ç½—è´¯ä¸­', 'ä¸‰å›½æ¼”ä¹‰', 14, '2020-12-19 15:28:36', 'å†å²å°è¯´');
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨ demo2 æ•°æ®åº“ä¸­åˆ›å»ºè¡¨ userã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-sql&quot;&gt;-- create table
create table User
(
    id       int auto_increment
        primary key,
    name     varchar(32) null comment 'ç”¨æˆ·åç§°',
    birthday date        null comment 'å‡ºç”Ÿæ—¥æœŸ'
)
    comment 'ç”¨æˆ·ä¿¡æ¯è¡¨';
-- insert data
INSERT INTO demo2.User (id, name, birthday) VALUES (1, 'é‡‘åº¸', '1924-03-10');
INSERT INTO demo2.User (id, name, birthday) VALUES (2, 'ç½—è´¯ä¸­', '1330-01-10');
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ•°æ®å‡†å¤‡å®Œæ¯•ï¼Œè¡¨ä¸­éƒ½æ–°å¢äº†ä¸¤æ¡æ•°æ®ã€‚&lt;/p&gt;
&lt;h3 id=&quot;é¡¹ç›®å‡†å¤‡&quot;&gt;é¡¹ç›®å‡†å¤‡&lt;/h3&gt;
&lt;p&gt;è¿™é‡Œç›´æ¥ä» Spring å®˜æ–¹ä¸Šåˆå§‹åŒ–ä¸€ä¸ªæ·»åŠ äº† webã€lombokã€mybatisã€mysql ä¾èµ–çš„ SpringBoot é¡¹ç›®ã€‚&lt;/p&gt;
&lt;p&gt;è®¿é—®ç›´æ¥ä¸‹è½½ï¼š&lt;a href=&quot;https://start.spring.io/starter.zip?type=maven-project&amp;amp;language=java&amp;amp;bootVersion=2.4.1.RELEASE&amp;amp;baseDir=demo&amp;amp;groupId=com&amp;amp;artifactId=wdbyte&amp;amp;name=demo&amp;amp;description=Demo%20project%20for%20Spring%20Boot&amp;amp;packageName=com.wdbyte.demo&amp;amp;packaging=jar&amp;amp;javaVersion=1.8&amp;amp;dependencies=mybatis,lombok,web,mysql&quot; target=&quot;_blank&quot;&gt;https://start.spring.io/starter.zip?type=maven-project&amp;amp;language=java&amp;amp;bootVersion=2.4.1.RELEASE&amp;amp;baseDir=demo&amp;amp;groupId=com&amp;amp;artifactId=wdbyte&amp;amp;name=demo&amp;amp;description=Demo%20project%20for%20Spring%20Boot&amp;amp;packageName=com.wdbyte.demo&amp;amp;packaging=jar&amp;amp;javaVersion=1.8&amp;amp;dependencies=mybatis,lombok,web,mysql&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ‰‹ä¸Šå·²ç»æœ‰äº†ä¸€ä¸ª SpringBoot é¡¹ç›®ï¼Œæ—¢ç„¶ä½ æƒ³æ”¹é€ æˆå¤šæ•°æ®æºï¼Œé‚£ä¹ˆä½ åº”è¯¥å·²ç»æœ‰äº†ä¸€ä¸ªæ•°æ®æºäº†ï¼Œå¦‚æœæ–°å¢çš„æ•°æ®æºæ•°æ®åº“å’Œç›®å‰çš„ä¸€è‡´ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ä½ çš„é¡¹ç›®è¿›è¡Œæ”¹é€ æµ‹è¯•ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å¤šæ•°æ®æº&quot;&gt;å¤šæ•°æ®æº&lt;/h2&gt;
&lt;p&gt;SpringBoot çš„å¤šæ•°æ®æºå¼€å‘ååˆ†ç®€å•ï¼Œå¦‚æœå¤šä¸ªæ•°æ®æºçš„æ•°æ®åº“ç›¸åŒï¼Œæ¯”å¦‚éƒ½æ˜¯ MySQLï¼Œé‚£ä¹ˆä¾èµ–æ˜¯ä¸éœ€è¦ä»»ä½•æ”¹åŠ¨çš„ï¼Œåªéœ€è¦è¿›è¡Œå¤šæ•°æ®æºé…ç½®å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ–°å¢çš„æ•°æ®åº“æ•°æ®æºå’Œç›®å‰çš„æ•°æ®åº“ä¸åŒï¼Œè®°å¾—å¼•å…¥æ–°æ•°æ®åº“çš„é©±åŠ¨ä¾èµ–ï¼Œæ¯”å¦‚ MySQL å’Œ PGSQLã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;dependency&amp;gt;
        &amp;lt;groupId&amp;gt;mysql&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;mysql-connector-java&amp;lt;/artifactId&amp;gt;
        &amp;lt;scope&amp;gt;runtime&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.postgresql&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;postgresql&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;42.2.7&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;è¿æ¥é…ç½®&quot;&gt;è¿æ¥é…ç½®&lt;/h3&gt;
&lt;p&gt;æ—¢ç„¶æœ‰å¤šä¸ªæ•°æ®æºï¼Œå› ä¸ºæ•°æ®åº“ç”¨æˆ·åå¯†ç å¯èƒ½ä¸ç›¸åŒï¼Œæ‰€ä»¥æ˜¯éœ€è¦é…ç½®å¤šä¸ªæ•°æ®æºä¿¡æ¯çš„ï¼Œç›´æ¥åœ¨ &lt;code&gt;properties/yml&lt;/code&gt; ä¸­é…ç½®å³å¯ã€‚è¿™é‡Œè¦æ³¨æ„æ ¹æ®é…ç½®çš„å±æ€§åè¿›è¡ŒåŒºåˆ†ï¼ŒåŒæ—¶å› ä¸ºæ•°æ®æºè¦æœ‰ä¸€ä¸ªé»˜è®¤ä½¿ç”¨çš„æ•°æ®æºï¼Œæœ€å¥½åœ¨åç§°ä¸Šæœ‰æ‰€åŒºåˆ†ï¼ˆè¿™é‡Œä½¿ç”¨ &lt;strong&gt;primary&lt;/strong&gt; ä½œä¸ºä¸»æ•°æ®æºæ ‡è¯†ï¼‰ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-properties&quot;&gt;########################## ä¸»æ•°æ®æº ##################################
spring.datasource.primary.jdbc-url=jdbc:mysql://127.0.0.1:3306/demo1?characterEncoding=utf-8&amp;amp;serverTimezone=GMT%2B8
spring.datasource.primary.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.primary.username=root
spring.datasource.primary.password=

########################## ç¬¬äºŒä¸ªæ•°æ®æº ###############################
spring.datasource.datasource2.jdbc-url=jdbc:mysql://127.0.0.1:3306/demo2?characterEncoding=utf-8&amp;amp;serverTimezone=GMT%2B8
spring.datasource.datasource2.driver-class-name=com.mysql.jdbc.Driver
spring.datasource.datasource2.username=root
spring.datasource.datasource2.password=

# mybatis
mybatis.mapper-locations=classpath:mapper/*.xml
mybatis.type-aliases-package=com.wdbyte.domain
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ³¨æ„ï¼Œé…ç½®ä¸­çš„æ•°æ®æºè¿æ¥ url æœ«å°¾ä½¿ç”¨çš„æ˜¯ &lt;code&gt;jdbc-url&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;å› ä¸ºä½¿ç”¨äº† Mybatis æ¡†æ¶ï¼Œæ‰€ä»¥ Mybatis æ¡†æ¶çš„é…ç½®ä¿¡æ¯ä¹Ÿæ˜¯å°‘ä¸äº†çš„ï¼ŒæŒ‡å®šæ‰«æç›®å½• &lt;code&gt;mapper&lt;/code&gt; ä¸‹çš„&lt;code&gt;mapper xml&lt;/code&gt; é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h3 id=&quot;mybatis-é…ç½®&quot;&gt;Mybatis é…ç½®&lt;/h3&gt;
&lt;p&gt;å¦‚ä½•ç¼–å†™ Mybatis Mapper æˆ–è€…å¦‚ä½•ä½¿ç”¨å·¥å…·ç”Ÿæˆ &lt;code&gt;Mybatis Mapper&lt;/code&gt; ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œå¦‚æœä½ ä¸çŸ¥é“å¯ä»¥å‚è€ƒ Mybatis å®˜æ–¹æ–‡æ¡£æˆ–è€…æˆ‘ä¹‹å‰çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;é“¾æ¥ä¸€ï¼š&lt;a href=&quot;https://mp.weixin.qq.com/s/-8ytSdjKGmukdNKx_f0jLw&quot; target=&quot;_blank&quot;&gt;ä½¿ç”¨ Mybatisï¼ˆè‡ªåŠ¨ç”Ÿæˆæ’ä»¶ï¼‰ è®¿é—®æ•°æ®åº“&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é“¾æ¥äºŒï¼š&lt;a href=&quot;https://mp.weixin.qq.com/s/Eij-GU3yQijyYmQcsghsgg&quot; target=&quot;_blank&quot;&gt;ä½¿ç”¨ Mybatis é›†æˆ pagehelper åˆ†é¡µæ’ä»¶å’Œ mapper æ’ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘å·²ç»æŒ‰ç…§ä¸Šé¢çš„ä¸¤ä¸ªåº“ä¸­çš„ä¸¤ä¸ªè¡¨ï¼ŒBook å’Œ User è¡¨åˆ†åˆ«ç¼–å†™ç›¸åº”çš„ Mybatis é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»º &lt;code&gt;BookMapper.xml&lt;/code&gt; å’Œ &lt;code&gt;UserMapper.xml&lt;/code&gt; æ”¾åˆ°é…ç½®æ–‡ä»¶é…ç½®çš„è·¯å¾„ mapper ç›®å½•ä¸‹ã€‚åˆ›å»º UserMapper å’Œ BookMapper æ¥å£æ“ä½œç±»æ”¾åœ¨ä¸åŒçš„ç›®å½•ã€‚è¿™é‡Œæ³¨æ„ Mapper æ¥å£è¦æŒ‰æ•°æ®æºåˆ†å¼€æ”¾åœ¨ä¸åŒçš„ç›®å½•ä¸­ã€‚åç»­å¥½ä½¿ç”¨ä¸åŒçš„æ•°æ®æºé…ç½®æ‰«æä¸åŒçš„ç›®å½•ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°ä¸åŒçš„ Mapper ä½¿ç”¨ä¸åŒçš„æ•°æ®æºé…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5cb53a35fe94b08ba85d1e45bdc716f~tplv-k3u1fbpfcp-zoom-1.image&quot; alt=&quot;Mybatis æ–‡ä»¶é…ç½®&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;Service å±‚æ²¡æœ‰å˜åŒ–ï¼Œè¿™é‡Œ BookMapper å’Œ UserMapper éƒ½æœ‰ä¸€ä¸ª &lt;code&gt;selectAll()&lt;/code&gt; æ–¹æ³•ç”¨äºæŸ¥è¯¢æµ‹è¯•ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å¤šæ•°æ®æºé…ç½®&quot;&gt;å¤šæ•°æ®æºé…ç½®&lt;/h3&gt;
&lt;p&gt;ä¸Šé¢ä½ åº”è¯¥çœ‹åˆ°äº†ï¼Œåˆ°ç›®å‰ä¸ºæ­¢å’Œ Mybatis å•æ•°æ®æºå†™æ³•å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ Mapper æ¥å£ä½¿ç”¨ä¸åŒçš„ç›®å½•åˆ†å¼€äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªä¸åŒç‚¹ä¸€å®šä¼šåœ¨æ•°æ®æºé…ç½®ä¸­ä½“ç°ã€‚&lt;/p&gt;
&lt;h4 id=&quot;ä¸»æ•°æ®æº&quot;&gt;ä¸»æ•°æ®æº&lt;/h4&gt;
&lt;p&gt;å¼€å§‹é…ç½®ä¸¤ä¸ªæ•°æ®æºä¿¡æ¯ï¼Œå…ˆé…ç½®ä¸»æ•°æ®æºï¼Œé…ç½®æ‰«æçš„ &lt;code&gt;MapperScan&lt;/code&gt; ç›®å½•ä¸º &lt;code&gt;com.wdbyte.mapper.primary&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;/**
 * ä¸»æ•°æ®æºé…ç½®
 *
 * @author niujinpeng
 * @website: https://www.wdbyte.com
 * @date 2020/12/19
 */
@Configuration
@MapperScan(basePackages = {&quot;com.wdbyte.mapper.primary&quot;}, sqlSessionFactoryRef = &quot;sqlSessionFactory&quot;)
public class PrimaryDataSourceConfig {

    @Bean(name = &quot;dataSource&quot;)
    @ConfigurationProperties(prefix = &quot;spring.datasource.primary&quot;)
    @Primary
    public DataSource dataSource() {
        return DataSourceBuilder.create().build();
    }

    @Bean(name = &quot;sqlSessionFactory&quot;)
    @Primary
    public SqlSessionFactory sqlSessionFactory(@Qualifier(&quot;dataSource&quot;) DataSource dataSource) throws Exception {
        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();
        bean.setDataSource(dataSource);
        bean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources(&quot;classpath:mapper/*.xml&quot;));
        return bean.getObject();
    }

    @Bean(name = &quot;transactionManager&quot;)
    @Primary
    public DataSourceTransactionManager transactionManager(@Qualifier(&quot;dataSource&quot;) DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }

    @Bean(name = &quot;sqlSessionTemplate&quot;)
    @Primary
    public SqlSessionTemplate sqlSessionTemplate(@Qualifier(&quot;sqlSessionFactory&quot;) SqlSessionFactory sqlSessionFactory) {
        return new SqlSessionTemplate(sqlSessionFactory);
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å’Œå•æ•°æ®æºä¸åŒçš„æ˜¯è¿™é‡ŒæŠŠ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;dataSource&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sqlSessionFactory&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;transactionManager&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sqlSessionTemplate&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;éƒ½å•ç‹¬è¿›è¡Œäº†é…ç½®ï¼Œç®€å•çš„ bean åˆ›å»ºï¼Œä¸‹é¢æ˜¯ç”¨åˆ°çš„ä¸€äº›æ³¨è§£è¯´æ˜ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;@ConfigurationProperties(prefix = &quot;spring.datasource.primary&quot;)&lt;/code&gt;ï¼šä½¿ç”¨spring.datasource.primary å¼€å¤´çš„é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@Primary&lt;/code&gt; ï¼šå£°æ˜è¿™æ˜¯ä¸€ä¸ªä¸»æ•°æ®æºï¼ˆé»˜è®¤æ•°æ®æºï¼‰ï¼Œå¤šæ•°æ®æºé…ç½®æ—¶&lt;strong&gt;å¿…ä¸å¯å°‘&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;@Qualifier&lt;/code&gt;ï¼šæ˜¾å¼é€‰æ‹©ä¼ å…¥çš„ Beanã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;ç¬¬äºŒä¸ªæ•°æ®æº&quot;&gt;ç¬¬äºŒä¸ªæ•°æ®æº&lt;/h4&gt;
&lt;p&gt;ç¬¬äºŒä¸ªæ•°æ®æºå’Œä¸»æ•°æ®æºå”¯ä¸€ä¸åŒçš„åªæ˜¯ &lt;code&gt;MapperScan&lt;/code&gt; æ‰«æè·¯å¾„å’Œåˆ›å»ºçš„ Bean åç§°ï¼ŒåŒæ—¶æ²¡æœ‰ &lt;code&gt;@Primary&lt;/code&gt; ä¸»æ•°æ®æºçš„æ³¨è§£ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;/**
 * ç¬¬äºŒä¸ªæ•°æ®æºé…ç½®
 * 
 * @author niujinpeng
 * @website: https://www.wdbyte.com
 * @date 2020/12/19
 */
@Configuration
@MapperScan(basePackages = {&quot;com.wdbyte.mapper.datasource2&quot;}, sqlSessionFactoryRef = &quot;sqlSessionFactory2&quot;)
public class SecondDataSourceConfig {

    @Bean(name = &quot;dataSource2&quot;)
    @ConfigurationProperties(prefix = &quot;spring.datasource.datasource2&quot;)
    public DataSource dataSource() {
        return DataSourceBuilder.create().build();
    }

    @Bean(name = &quot;sqlSessionFactory2&quot;)
    public SqlSessionFactory sqlSessionFactory(@Qualifier(&quot;dataSource2&quot;) DataSource dataSource) throws Exception {
        SqlSessionFactoryBean bean = new SqlSessionFactoryBean();
        bean.setDataSource(dataSource);
        bean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources(&quot;classpath:mapper/*.xml&quot;));
        return bean.getObject();
    }

    @Bean(name = &quot;transactionManager2&quot;)
    public DataSourceTransactionManager transactionManager(@Qualifier(&quot;dataSource2&quot;) DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }

    @Bean(name = &quot;sqlSessionTemplate2&quot;)
    public SqlSessionTemplate sqlSessionTemplate(@Qualifier(&quot;sqlSessionFactory2&quot;) SqlSessionFactory sqlSessionFactory) {
        return new SqlSessionTemplate(sqlSessionFactory);
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ³¨æ„ï¼šå› ä¸ºå·²ç»åœ¨ä¸¤ä¸ªæ•°æ®æºä¸­åˆ†åˆ«é…ç½®äº†æ‰«æçš„ Mapper è·¯å¾„ï¼Œå¦‚æœä½ ä¹‹å‰åœ¨ SpringBoot å¯åŠ¨ç±»ä¸­ä¹Ÿä½¿ç”¨äº† Mapper æ‰«ææ³¨è§£ï¼Œ&lt;strong&gt;éœ€è¦åˆ æ‰&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&quot;è®¿é—®æµ‹è¯•&quot;&gt;è®¿é—®æµ‹è¯•&lt;/h3&gt;
&lt;p&gt;ç¼–å†™ä¸¤ä¸ªç®€å•çš„æŸ¥è¯¢ Controller ç„¶åè¿›è¡Œè®¿é—®æµ‹è¯•ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;// BookController
@RestController
public class BookController {

    @Autowired
    private BookService bookService;

    @GetMapping(value = &quot;/books&quot;)
    public Response selectAll() throws Exception {
        List&amp;lt;Book&amp;gt; books = bookService.selectAll();
        return ResponseUtill.success(books);
    }
}

// UserController
@RestController
public class UserController {

    @Autowired
    private UserService userService;

    @ResponseBody
    @GetMapping(value = &quot;/users&quot;)
    public Response selectAll() {
        List&amp;lt;User&amp;gt; userList = userService.selectAll();
        return ResponseUtill.success(userList);
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è®¿é—®æµ‹è¯•ï¼Œæˆ‘è¿™é‡Œç›´æ¥ CURL è¯·æ±‚ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;âœ  ~ curl localhost:8080/books 
{
  &quot;code&quot;: &quot;0000&quot;,
  &quot;message&quot;: &quot;success&quot;,
  &quot;data&quot;: [
    {
      &quot;id&quot;: 1,
      &quot;author&quot;: &quot;é‡‘åº¸&quot;,
      &quot;name&quot;: &quot;ç¬‘å‚²æ±Ÿæ¹–&quot;,
      &quot;price&quot;: 13,
      &quot;createtime&quot;: &quot;2020-12-19T07:26:51.000+00:00&quot;,
      &quot;description&quot;: &quot;æ­¦ä¾ å°è¯´&quot;
    },
    {
      &quot;id&quot;: 2,
      &quot;author&quot;: &quot;ç½—è´¯ä¸­&quot;,
      &quot;name&quot;: &quot;ä¸‰å›½æ¼”ä¹‰&quot;,
      &quot;price&quot;: 14,
      &quot;createtime&quot;: &quot;2020-12-19T07:28:36.000+00:00&quot;,
      &quot;description&quot;: &quot;å†å²å°è¯´&quot;
    }
  ]
}
âœ  ~ curl localhost:8080/users 
{
  &quot;code&quot;: &quot;0000&quot;,
  &quot;message&quot;: &quot;success&quot;,
  &quot;data&quot;: [
    {
      &quot;id&quot;: 1,
      &quot;name&quot;: &quot;é‡‘åº¸&quot;,
      &quot;birthday&quot;: &quot;1924-03-09T16:00:00.000+00:00&quot;
    },
    {
      &quot;id&quot;: 2,
      &quot;name&quot;: &quot;ç½—è´¯ä¸­&quot;,
      &quot;birthday&quot;: &quot;1330-01-09T16:00:00.000+00:00&quot;
    }
  ]
}
âœ  ~
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è‡³æ­¤ï¼Œå¤šæ•°æ®æºé…ç½®å®Œæˆï¼Œæµ‹è¯•æˆåŠŸã€‚&lt;/p&gt;
&lt;h2 id=&quot;è¿æ¥æ± &quot;&gt;è¿æ¥æ± &lt;/h2&gt;
&lt;p&gt;å…¶å®åœ¨å¤šæ•°æ®æºæ”¹é€ ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¸ä¼šä½¿ç”¨é»˜è®¤çš„ JDBC è¿æ¥æ–¹å¼ï¼Œå¾€å¾€éƒ½éœ€è¦å¼•å…¥è¿æ¥æ± è¿›è¡Œè¿æ¥ä¼˜åŒ–ï¼Œä¸ç„¶ä½ å¯èƒ½ä¼šç»å¸¸é‡åˆ°æ•°æ®æºè¿æ¥è¢«æ–­å¼€ç­‰æŠ¥é”™æ—¥å¿—ã€‚å…¶å®æ•°æ®æºåˆ‡æ¢è¿æ¥æ± æ•°æ®æºä¹Ÿæ˜¯ååˆ†ç®€å•çš„ï¼Œç›´æ¥å¼•å…¥è¿æ¥æ± ä¾èµ–ï¼Œç„¶åæŠŠåˆ›å»º dataSource çš„éƒ¨åˆ†æ¢æˆè¿æ¥æ± æ•°æ®æºåˆ›å»ºå³å¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢ä»¥é˜¿é‡Œçš„ Druid ä¸ºä¾‹ï¼Œå…ˆå¼•å…¥è¿æ¥æ± æ•°æ®æºä¾èµ–ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;dependency&amp;gt;
   &amp;lt;groupId&amp;gt;com.alibaba&amp;lt;/groupId&amp;gt;
   &amp;lt;artifactId&amp;gt;druid&amp;lt;/artifactId&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ·»åŠ  Druid çš„ä¸€äº›é…ç½®ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-properties&quot;&gt;spring.datasource.datasource2.initialSize=3 # æ ¹æ®è‡ªå·±æƒ…å†µè®¾ç½®
spring.datasource.datasource2.minIdle=3
spring.datasource.datasource2.maxActive=20
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ”¹å†™ dataSource Bean çš„åˆ›å»ºä»£ç éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;@Value(&quot;${spring.datasource.datasource2.jdbc-url}&quot;)
private String url;
@Value(&quot;${spring.datasource.datasource2.driver-class-name}&quot;)
private String driverClassName;
@Value(&quot;${spring.datasource.datasource2.username}&quot;)
private String username;
@Value(&quot;${spring.datasource.datasource2.password}&quot;)
private String password;
@Value(&quot;${spring.datasource.datasource2.initialSize}&quot;)
private int initialSize;
@Value(&quot;${spring.datasource.datasource2.minIdle}&quot;)
private int minIdle;
@Value(&quot;${spring.datasource.datasource2.maxActive}&quot;)
private int maxActive;

@Bean(name = &quot;dataSource2&quot;)
public DataSource dataSource() {
    DruidDataSource dataSource = new DruidDataSource();
    dataSource.setUrl(url);
    dataSource.setDriverClassName(driverClassName);
    dataSource.setUsername(username);
    dataSource.setPassword(password);
    dataSource.setInitialSize(initialSize);
    dataSource.setMinIdle(minIdle);
    dataSource.setMaxActive(maxActive);
    return dataSource;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿™é‡Œåªæ˜¯ç®€å•çš„æä¸€ä¸‹ä½¿ç”¨è¿æ¥æ± çš„é‡è¦æ€§ï¼ŒDruid çš„è¯¦ç»†ç”¨æ³•è¿˜è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ä¸­ä»£ç å·²ç»ä¸Šä¼ åˆ° Github: &lt;a href=&quot;https://github.com/niumoo/springboot&quot; target=&quot;_blank&quot;&gt;https://github.com/niumoo/springboot&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æœ€åçš„è¯&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ–‡ç« æœ‰å¸®åŠ©å¯ä»¥ç‚¹ä¸ªã€Œ&lt;strong&gt;èµ&lt;/strong&gt;ã€æˆ–ã€Œ&lt;strong&gt;åˆ†äº«&lt;/strong&gt;ã€ï¼Œéƒ½æ˜¯æ”¯æŒï¼&lt;br/&gt;æ–‡ç« æ¯å‘¨æŒç»­æ›´æ–°ï¼Œå¯ä»¥å…³æ³¨ã€Œ &lt;strong&gt;æœªè¯»ä»£ç &lt;/strong&gt; ã€å…¬ä¼—å·æˆ–è€…&lt;a href=&quot;https://www.wdbyte.com/&quot; target=&quot;_blank&quot;&gt;æˆ‘çš„åšå®¢&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/47de355947494602bde836515b35617b~tplv-k3u1fbpfcp-zoom-1.image&quot; alt=&quot;å…¬ä¼—å·&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Wed, 30 Dec 2020 00:41:00 +0000</pubDate>
<dc:creator>æœªè¯»ä»£ç </dc:creator>
<og:description>æœ€è¿‘åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œéœ€è¦ä¸ºä¸€ä¸ªä½¿ç”¨ MySQL æ•°æ®åº“çš„ SpringBoot é¡¹ç›®ï¼Œæ–°æ·»åŠ ä¸€ä¸ª PLSQL æ•°æ®åº“æ•°æ®æºï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œ SpringBoot çš„å¤šæ•°æ®æºå¼€å‘ã€‚ä»£ç å¾ˆç®€å•ï¼Œä¸‹é¢æ˜¯å®ç°çš„</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/niumoo/p/14209663.html</dc:identifier>
</item>
<item>
<title>[æ•°æ®åº“]000 - ğŸ³Sysbench æ•°æ®åº“å‹åŠ›æµ‹è¯•å·¥å…· - AnonyStar</title>
<link>http://www.cnblogs.com/i-code/p/14209648.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/i-code/p/14209648.html</guid>
<description>&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/2024393/202012/2024393-20201230083309640-1446375969.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;sysbench&lt;/code&gt; æ˜¯ä¸€ä¸ªå¼€æºçš„ã€æ¨¡å—åŒ–çš„ã€è·¨å¹³å°çš„å¤šçº¿ç¨‹æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡ŒCPUã€å†…å­˜ã€ç£ç›˜&lt;code&gt;I/O&lt;/code&gt;ã€çº¿ç¨‹ã€æ•°æ®åº“çš„æ€§èƒ½æµ‹è¯•ã€‚ç›®å‰æ”¯æŒçš„æ•°æ®åº“æœ‰&lt;code&gt;MySQL&lt;/code&gt;ã€&lt;code&gt;Oracle&lt;/code&gt;å’Œ&lt;code&gt;PostgreSQL&lt;/code&gt;ã€‚ä»¥ä¸‹æ“ä½œéƒ½å°†ä»¥æ”¯æŒ&lt;code&gt;MySQL&lt;/code&gt;æ•°æ®åº“ä¸ºä¾‹è¿›è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;1-linux-ä¸Šå®‰è£…-sysbench-å·¥å…·&quot;&gt;1. Linux ä¸Šå®‰è£… sysbench å·¥å…·&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;å®‰è£…æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯é€šè¿‡ &lt;code&gt;yum&lt;/code&gt;/&lt;code&gt;apt&lt;/code&gt; ç­‰æ¥å®‰è£…ï¼Œå¦ä¸€ç§è‡ªå·±ä¸‹è½½æºç åŒ…æ¥å®‰è£…ï¼Œç¬”è€…è¿™é‡Œé‡‡ç”¨çš„æ˜¯&lt;code&gt;centos&lt;/code&gt; ,é‡‡ç”¨&lt;code&gt;yum&lt;/code&gt; å®‰è£…&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sysbench&lt;/code&gt; çš„æºç åŒ…ä¸‹è½½åœ°å€ï¼š &lt;a href=&quot;http://sourceforge.net/projects/sysbench&quot; target=&quot;_blank&quot;&gt;http://sourceforge.net/projects/sysbench&lt;/a&gt; ï¼Œé‡‡ç”¨æºç å®‰è£…çš„å¯è½¬è¿™é‡Œ&lt;/li&gt;
&lt;li&gt;é€šè¿‡ &lt;code&gt;yum&lt;/code&gt; å®‰è£…å¦‚ä¸‹ï¼š
&lt;ul&gt;&lt;li&gt;è®¾ç½® &lt;code&gt;yum repo&lt;/code&gt; ä»“åº“&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;1.0416666666667&quot;&gt;
&lt;p&gt;curl -s &lt;a href=&quot;https://packagecloud.io/install/repositories/akopytov/sysbench/script.rpm.sh&quot; target=&quot;_blank&quot;&gt;https://packagecloud.io/install/repositories/akopytov/sysbench/script.rpm.sh&lt;/a&gt; | sudo bash&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;sudo yum -y install sysbench&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;&lt;li&gt;å®‰è£…å®Œæ£€æŸ¥æ˜¯å¦æˆåŠŸ&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote&gt;
&lt;p&gt;sysbench --version&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/2024393/202012/2024393-20201230083310706-18219576.png&quot; alt=&quot;image.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;2-æ•°æ®åº“æµ‹è¯•ç”¨ä¾‹å‡†å¤‡&quot;&gt;2. æ•°æ®åº“æµ‹è¯•ç”¨ä¾‹å‡†å¤‡&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;æˆ‘ä»¬è¿™é‡Œæµ‹è¯•çš„æ˜¯ &lt;code&gt;MySQL&lt;/code&gt; ï¼Œé¦–å…ˆæˆ‘ä»¬åœ¨æ•°æ®åº“åˆ›å»ºä¸€ä¸ªä¸“é—¨ç”¨æ¥æµ‹è¯•çš„åº“ &lt;code&gt;test_db&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/2024393/202012/2024393-20201230083311232-521136475.png&quot; alt=&quot;image.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;é€šè¿‡&lt;code&gt;sysbench&lt;/code&gt; åˆ›å»º20ä¸ªæµ‹è¯•è¡¨ï¼Œæ¯ä¸ªè¡¨ä¸­åˆ›å»º100ä¸‡æ•°æ®ï¼Œå†é€šè¿‡10ä¸ªçº¿ç¨‹å¯¹æµ‹è¯•åº“å‘èµ·è®¿é—®ï¼ŒæŒç»­5åˆ†é’Ÿï¼Œå¯¹å…¶è¿›è¡Œå‹æµ‹&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;3-sysbench-æ„å»ºè¡¨ä¸æ•°æ®&quot;&gt;3. sysbench æ„å»ºè¡¨ä¸æ•°æ®&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;æ‰§è¡Œä¸‹é¢å‘½ä»¤å‡†å¤‡æ•°æ®&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;sysbench --db-driver=mysql --time=300 --threads=10 --report-interval=1 --mysql-host=192.168.56.10 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=test_db --tables=20 --table_size=1000000 oltp_read_write --db-ps-mode=disable prepare&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;&lt;li&gt;ä¸Šé¢å‘½ä»¤çš„å‚æ•°è¯´æ˜ï¼š
&lt;ul&gt;&lt;li&gt;&lt;code&gt;--db-driver=mysql&lt;/code&gt; : è¡¨ç¤ºæ•°æ®åº“çš„é©±åŠ¨ç±»å‹ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ &lt;code&gt;MySQL&lt;/code&gt; æ‰€ä»¥å¡«&lt;code&gt;mysql&lt;/code&gt; ,å¦‚æœä½¿ç”¨ &lt;code&gt;Oracle&lt;/code&gt; åˆ™å¡«å†™ç›¸åº”çš„&lt;code&gt;oracle&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--time=300&lt;/code&gt; : è¿™ä¸ªå‚æ•°è¡¨ç¤ºæŒç»­è®¿é—®çš„æ—¶é—´ 300ç§’&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--threads=10&lt;/code&gt; : è¡¨ç¤ºä½¿ç”¨10ä¸ªçº¿ç¨‹æ¨¡æ‹Ÿå¹¶å‘è®¿é—®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--report-interval=1&lt;/code&gt; : è¡¨ç¤ºæ¯éš”ä¸€ç§’è¾“å‡ºä»¥æ­¤å‹æµ‹æƒ…å†µ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--mysql-host=192.168.56.10 --mysql-port=3306 --mysql-user=root --mysql-password=root&lt;/code&gt; : è¿™ä¸€å—çš„é…ç½®ï¼Œå°±æ˜¯åŸºæœ¬çš„æ•°æ®åº“é“¾æ¥ä¿¡æ¯ï¼ŒæŒ‡å®šæ•°æ®åº“&lt;code&gt;IP&lt;/code&gt; ï¼Œç«¯å£ï¼Œè´¦å·å¯†ç &lt;/li&gt;
&lt;li&gt;&lt;code&gt;--mysql-db=test_db --tables=20 --table_size=1000000&lt;/code&gt; : è¿™ä¸‰ä¸ªå‚æ•°è®¾ç½®ï¼Œè¡¨ç¤ºæŒ‡å®šæµ‹è¯•çš„åº“ä¸º&lt;code&gt;test_db&lt;/code&gt; , åŒæ—¶åœ¨è¿™ä¸ªåº“ä¸­æ„å»º20ä¸ªè¡¨ï¼Œå¹¶ä¸”æ¯ä¸ªè¡¨ä¸­æ„å»ºå‡º 100ä¸‡æ¡æµ‹è¯•æ•°æ®ï¼Œè¡¨çš„åå­—ä¼šç±»ä¼¼ &lt;code&gt;sbtest1&lt;/code&gt;,&lt;code&gt;sbtest2&lt;/code&gt; è¿™ç§æ ¼å¼&lt;/li&gt;
&lt;li&gt;&lt;code&gt;oltp_read_write&lt;/code&gt; : è¡¨ç¤ºæ‰§è¡Œ&lt;code&gt;oltp&lt;/code&gt; æ•°æ®åº“çš„è¯»å†™æµ‹è¯•&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--db-ps-mode=disable&lt;/code&gt; : ç¦æ­¢ &lt;code&gt;ps&lt;/code&gt; æ¨¡å¼&lt;/li&gt;
&lt;li&gt;&lt;code&gt;prepare&lt;/code&gt; : è¡¨ç¤ºæŒ‰ç…§å‘½ä»¤è®¾ç½®å»æ„å»ºå‡ºæˆ‘ä»¬çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å¯¹å‰é¢æ‰€æœ‰å‘½ä»¤çš„æ‰§è¡Œæ–¹æ¡ˆ&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;h4 id=&quot;4-å…¨æ–¹ä½æµ‹è¯•&quot;&gt;4. å…¨æ–¹ä½æµ‹è¯•&lt;/h4&gt;
&lt;h5 id=&quot;1-ç»¼åˆè¯»å†™æµ‹è¯•&quot;&gt;1. ç»¼åˆè¯»å†™æµ‹è¯•&lt;/h5&gt;
&lt;ul&gt;&lt;li&gt;æµ‹è¯•æ•°æ®åº“çš„ç»¼åˆè¯»å†™&lt;code&gt;TPS&lt;/code&gt; ,ä½¿ç”¨ &lt;code&gt;oltp_read_write&lt;/code&gt; æ¨¡å¼&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;sysbench --db-driver=mysql --time=300 --threads=10 --report-interval=1 --mysql-host=192.168.56.10 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=test_db --tables=20 --table_size=1000000 oltp_read_write --db-ps-mode=disable run&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;æ³¨æ„ï¼šå‘½ä»¤æœ€åä¸å†æ˜¯ ä¹‹å‰çš„ prepareï¼Œè¿™é‡Œæ˜¯ run ï¼Œè¡¨ç¤ºè¿è¡Œå‹æµ‹ï¼Œå‰é¢çš„æ˜¯å‡†å¤‡æ•°æ®&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/2024393/202012/2024393-20201230083312179-585469253.png&quot; alt=&quot;image.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;ä¸Šé¢æ˜¯ç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å…¶å…¨éƒ¨è®°å½•åœ¨æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ç®¡é“ï¼Œ&lt;code&gt;| tee /tmp/mysysbench.log&lt;/code&gt; æ•´ä¸ªå‘½ä»¤å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;sysbench --db-driver=mysql --time=300 --threads=10 --report-interval=1 --mysql-host=192.168.56.10 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=test_db --tables=20 --table_size=1000000 oltp_read_write --db-ps-mode=disable run | tee /tmp/mysysbench.log&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&quot;2-åªè¯»æ€§èƒ½æµ‹è¯•&quot;&gt;2. åªè¯»æ€§èƒ½æµ‹è¯•&lt;/h5&gt;
&lt;ul&gt;&lt;li&gt;æµ‹è¯•æ•°æ®åº“çš„åªè¯»æ€§èƒ½ï¼Œä½¿ç”¨ &lt;code&gt;oltp_read_only&lt;/code&gt; æ¨¡å¼ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;sysbench --db-driver=mysql --time=300 --threads=10 --report-interval=1 --mysql-host=192.168.56.10 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=test_db --tables=20 --table_size=1000000 oltp_read_only --db-ps-mode=disable run&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/2024393/202012/2024393-20201230083312957-151946034.png&quot; alt=&quot;image.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å¦‚æœè¦è¾“å‡ºåˆ°æ–‡ä»¶å¦‚ä¸Š&lt;/li&gt;
&lt;/ul&gt;&lt;h5 id=&quot;3-åˆ é™¤æ€§èƒ½æµ‹è¯•&quot;&gt;3. åˆ é™¤æ€§èƒ½æµ‹è¯•&lt;/h5&gt;
&lt;ul&gt;&lt;li&gt;æµ‹è¯•æ•°æ®åº“çš„åˆ é™¤æ€§èƒ½ï¼Œä½¿ç”¨æ¨¡å¼ï¼š&lt;code&gt;oltp_delete&lt;/code&gt; ,å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;sysbench --db-driver=mysql --time=300 --threads=10 --report-interval=1 --mysql-host=192.168.56.10 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=test_db --tables=20 --table_size=1000000 oltp_delete --db-ps-mode=disable run&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&quot;4-æ›´æ–°ç´¢å¼•å­—æ®µæµ‹è¯•&quot;&gt;4. æ›´æ–°ç´¢å¼•å­—æ®µæµ‹è¯•&lt;/h5&gt;
&lt;ul&gt;&lt;li&gt;æµ‹è¯•æ•°æ®åº“çš„æ›´æ–°ç´¢å¼•å­—æ®µçš„æ€§èƒ½ï¼Œä½¿ç”¨æ¨¡å¼ï¼š&lt;code&gt;oltp_update_index&lt;/code&gt; , å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;sysbench --db-driver=mysql --time=300 --threads=10 --report-interval=1 --mysql-host=192.168.56.10 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=test_db --tables=20 --table_size=1000000 oltp_update_index --db-ps-mode=disable run&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&quot;5-æ›´æ–°éç´¢å¼•å­—æ®µæµ‹è¯•&quot;&gt;5. æ›´æ–°éç´¢å¼•å­—æ®µæµ‹è¯•&lt;/h5&gt;
&lt;ul&gt;&lt;li&gt;æµ‹è¯•æ•°æ®åº“ä¸­æ›´æ–°éç´¢å¼•å­—æ®µçš„æ€§èƒ½ï¼Œä½¿ç”¨æ¨¡å¼ï¼š&lt;code&gt;oltp_update_non_index&lt;/code&gt;, å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;sysbench --db-driver=mysql --time=300 --threads=10 --report-interval=1 --mysql-host=192.168.56.10 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=test_db --tables=20 --table_size=1000000 oltp_update_non_index --db-ps-mode=disable run&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&quot;6-æ’å…¥æ€§èƒ½æµ‹è¯•&quot;&gt;6. æ’å…¥æ€§èƒ½æµ‹è¯•&lt;/h5&gt;
&lt;ul&gt;&lt;li&gt;æµ‹è¯•æ•°æ®åº“çš„æ•°æ®æ’å…¥æ€§èƒ½ï¼Œä½¿ç”¨æ¨¡å¼ï¼š&lt;code&gt;oltp_insert&lt;/code&gt;,å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;sysbench --db-driver=mysql --time=300 --threads=10 --report-interval=1 --mysql-host=192.168.56.10 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=test_db --tables=20 --table_size=1000000 oltp_insert --db-ps-mode=disable run&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&quot;7-å†™å…¥æ€§èƒ½æµ‹è¯•&quot;&gt;7. å†™å…¥æ€§èƒ½æµ‹è¯•&lt;/h5&gt;
&lt;ul&gt;&lt;li&gt;æµ‹è¯•æ•°æ®åº“çš„å†™å…¥æ€§èƒ½ï¼Œä½¿ç”¨æ¨¡å¼ï¼š&lt;code&gt;oltp_write_only&lt;/code&gt;, å‘½ä»¤å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;sysbench --db-driver=mysql --time=300 --threads=10 --report-interval=1 --mysql-host=192.168.56.10 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=test_db --tables=20 --table_size=1000000 oltp_write_only --db-ps-mode=disable run&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&quot;8-æ¸…ç†æ•°æ®&quot;&gt;8. æ¸…ç†æ•°æ®&lt;/h5&gt;
&lt;ul&gt;&lt;li&gt;å‰é¢å‘½ä»¤è¿›è¡Œäº†å„ç§æµ‹è¯•ï¼Œåœ¨æµ‹è¯•å®Œä¹‹åæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ &lt;code&gt;cleanup&lt;/code&gt; å‘½ä»¤æ¥æ¸…é™¤æ„å»ºçš„æµ‹è¯•æ•°æ®&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;sysbench --db-driver=mysql --time=300 --threads=10 --report-interval=1 --mysql-host=192.168.56.10 --mysql-port=3306 --mysql-user=root --mysql-password=root --mysql-db=test_db --tables=20 --table_size=1000000 oltp_read_write --db-ps-mode=disable cleanup&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;9-å‹æµ‹ç»“æœåˆ†æ&quot;&gt;9. å‹æµ‹ç»“æœåˆ†æ&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;é€šè¿‡ä¸Šé¢çš„å‘½ä»¤æˆ‘ä»¬å¯ä»¥å…¨æ–¹ä½çš„å¾—åˆ°æµ‹è¯•çš„ç»“æœï¼Œæˆ‘ä»¬ç›´æ¥æ¯ä¸ªä¸€ç§’è¾“å‡ºä¸€æ¬¡ç»“æœï¼Œåœ¨æ§åˆ¶å°ä¼šè¾“å‡ºç±»ä¼¼ä¸‹é¢çš„ä¸œè¥¿ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;[ 31s ] thds: 10 tps: 350.35 qps: 5575.50 (r/w/o: 4874.81/0.00/700.69) lat (ms,95%): 36.89 err/s: 0.00 reconn/s: 0.00&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul readability=&quot;-0.5&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹å…¶ä¸­çš„å«ä¹‰ï¼Œé¦–å…ˆ&lt;code&gt;[31s]&lt;/code&gt; è¡¨ç¤ºè¿™æ˜¯åœ¨ç¬¬31ç§’çš„æ—¶å€™è¾“å‡ºçš„ä¸€æ®µå‹æµ‹ç»Ÿè®¡ç»“æœï¼Œå…¶ä»–å­—æ®µå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;thds:10&lt;/code&gt; : è¡¨ç¤ºå½“å‰æœ‰&lt;code&gt;10&lt;/code&gt;ä¸ªçº¿ç¨‹æ­£åœ¨å‹æµ‹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;tps:350.35&lt;/code&gt; : è¡¨ç¤ºå½“å‰æ¯ç§’æ‰§è¡Œäº† &lt;code&gt;350.35&lt;/code&gt; ä¸ªäº‹åŠ¡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;qps:5575.50&lt;/code&gt;: è¡¨ç¤ºå½“å‰æ¯ç§’å¯ä»¥æ‰§è¡Œ &lt;code&gt;5575.50&lt;/code&gt; ä¸ªè¯·æ±‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;(r/w/o: 4874.81/0.00/700.69)&lt;/code&gt; : è¡¨ç¤ºåœ¨æ¯ç§’ &lt;code&gt;5575.50&lt;/code&gt; ä¸ªè¯·æ±‚ä¸­ï¼Œæœ‰ &lt;code&gt;4874.81&lt;/code&gt; ä¸ªè¯»è¯·æ±‚ï¼Œ&lt;code&gt;0.00&lt;/code&gt; ä¸ªå†™è¯·æ±‚ï¼Œ&lt;code&gt;700.69&lt;/code&gt; ä¸ªå…¶ä»–è¯·æ±‚ï¼Œå…¶å®å°±æ˜¯å¯¹ &lt;code&gt;qps&lt;/code&gt; çš„ç»†åŒ–&lt;/li&gt;
&lt;li&gt;&lt;code&gt;lat (ms,95%): 36.89&lt;/code&gt;ï¼šè¡¨ç¤º 95% çš„è¯·æ±‚çš„å»¶è¿Ÿéƒ½åœ¨36.89 æ¯«ç§’ä»¥ä¸‹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;err/s: 0.00 reconn/s: 0.00&lt;/code&gt;ï¼šè¡¨ç¤ºæœ‰0ä¸ªè¯·æ±‚å¤±è´¥ï¼Œå‘ç”Ÿäº†0æ¬¡çš„ç½‘ç»œé‡è¿&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;åœ¨å‹æµ‹ç»“æŸåä¼šè¾“å‡ºä¸€ä¸ªæ€»çš„å‹æµ‹ç»“æœï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/2024393/202012/2024393-20201230083313544-127209051.png&quot; alt=&quot;image.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å…¶ä¸­çš„å‚æ•°çš„è§£é‡Šï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/2024393/202012/2024393-20201230083317082-1864416318.png&quot; alt=&quot;image.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;10-å¸¸ç”¨ç›‘æ§å‘½ä»¤&quot;&gt;10. å¸¸ç”¨ç›‘æ§å‘½ä»¤&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;åœ¨å‹æµ‹è¿‡ç¨‹ä¸­æˆ‘ä»¬è¦æ—¶åˆ»å…³æ³¨æœåŠ¡å™¨çš„ &lt;code&gt;CPU&lt;/code&gt; ã€ç£ç›˜&lt;code&gt;I/O&lt;/code&gt; ã€ç½‘ç»œè´Ÿè½½ç­‰ä¿¡æ¯ï¼Œä¸€æ—¦å‘ç°ä»»ä½•ä¸€ä¸ªè¶…å‡ºä¸€å®šè´Ÿè·ï¼Œåˆ™ä¸é€‚åˆå†ç»§ç»­åŠ å¤§çº¿ç¨‹æ•°æ¥å‹æµ‹äº†&lt;/li&gt;
&lt;li&gt;ä¸€å®šè¦æ³¨æ„ï¼Œå‹æµ‹çš„è¿‡ç¨‹æ˜¯è¦ä¿è¯æœºå™¨å„é¡¹æŒ‡æ ‡åœ¨æ­£å¸¸èŒƒå›´å†…çš„æœ€å¤§è´Ÿè½½ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬ä¸æ–­çš„å¢å¤§ &lt;code&gt;sysbench&lt;/code&gt; çš„çº¿ç¨‹æ•°ï¼Œä¸å…³ç³»å…¶ä»–æŒ‡æ ‡ï¼Œè¿™æ ·å³ä½¿æœºå™¨æ¯ç§’æŠ—ä½äº†å¾ˆé«˜çš„&lt;code&gt;qps&lt;/code&gt; ,ä½†æ˜¯è¿™æ—¶å€™çš„æœºå™¨å·²ç»æ˜¯æ»¡è´Ÿè·è¿è¡Œäº†ï¼Œå†…å­˜ï¼Œ&lt;code&gt;cpu&lt;/code&gt;ï¼Œç½‘ç»œå¸¦å®½ç­‰éƒ½å‡ ä¹è¢«æ‰“æ»¡ï¼Œè¿™ç§æƒ…å†µæœºå™¨éšæ—¶å¯èƒ½æŒ‚æ‰ï¼Œè¿™æ—¶å€™çš„æµ‹å‹å°±æ²¡æœ‰ä»€ä¹ˆä»£è¡¨æ€§äº†ï¼Œå› ä¸ºä½ ä¸å¯èƒ½åœ¨ç”Ÿäº§è€…è®©å®ƒè¾¾åˆ°è¿™æ ·çš„è´Ÿè·&lt;/li&gt;
&lt;/ul&gt;&lt;h5 id=&quot;è§‚å¯Ÿ-cpu-çš„çš„è´Ÿè·&quot;&gt;è§‚å¯Ÿ CPU çš„çš„è´Ÿè·&lt;/h5&gt;
&lt;ul&gt;&lt;li&gt;åœ¨&lt;code&gt;Linux&lt;/code&gt;ä¸‹æœ€å¸¸è§çš„å‘½ä»¤å°±æ˜¯&lt;code&gt;top&lt;/code&gt; å‘½ä»¤ï¼Œå¯ä»¥è¾“å‡ºè¯¦ç»†çš„æƒ…å†µï¼Œå¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/2024393/202012/2024393-20201230083317991-1134280414.png&quot; alt=&quot;image.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å¯¹äºä¸Šé¢çš„è¾“å‡ºï¼Œæˆ‘ä»¬è¯¦ç»†æ¥åˆ†æä¸€ä¸‹ï¼Œé¦–å…ˆçœ‹ç¬¬ä¸€è¡Œçš„è¾“å‡º&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;9&quot;&gt;
&lt;p&gt;top - 16:24:21 up 13:41, 4 users, load average: 0.11, 3.10, 3.72&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;16:24:21&lt;/code&gt; : è¡¨ç¤ºå½“å‰çš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;up 13:41&lt;/code&gt;ï¼šè¡¨ç¤ºå·²ç»è¿è¡Œäº†å¤šé•¿æ—¶é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;4 users&lt;/code&gt;ï¼šå½“å‰æœºå™¨æœ‰å‡ ä¸ªç”¨æˆ·åœ¨ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;load average: 0.11, 3.10, 3.72&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™æ˜¯æ ¸å¿ƒã€‚è¡¨ç¤º &lt;code&gt;CPU&lt;/code&gt; åœ¨ ä¸€åˆ†é’Ÿã€äº”åˆ†é’Ÿã€åäº”åˆ†é’Ÿ å†…çš„å¹³å‡è´Ÿè½½æƒ…å†µï¼Œç®€å•è§£é‡Šä¸€ä¸‹ï¼Œå‡è®¾æˆ‘ä»¬æ˜¯ä¸€ä¸ªå››æ ¸çš„&lt;code&gt;CPU&lt;/code&gt; ï¼Œæ­¤æ—¶å¦‚æœæˆ‘ä»¬çš„&lt;code&gt;CPU&lt;/code&gt; è´Ÿè½½æ˜¯ &lt;code&gt;0.15&lt;/code&gt; ï¼Œé‚£ä¹ˆè¡¨ç¤ºè¿™å››ä¸ªæ ¸å¿ƒä¸­è¿ä¸€ä¸ªæ ¸å¿ƒéƒ½æ²¡ä½¿ç”¨æ»¡ï¼Œè¡¨æ˜æ•´ä½“æ¯”è¾ƒç©ºé—²ï¼›å¦‚æœæ•´ä¸ªè´Ÿè½½æ˜¯1ï¼Œåˆ™è¡¨ç¤ºå››ä¸ªæ ¸ä¸­æœ‰ä¸€ä¸ªå·²ç»ä½¿ç”¨çš„æ¯”è¾ƒç¹å¿™äº†ï¼Œä½†æ˜¯å…¶ä»–ä¸‰ä¸ªè¿˜æ˜¯æ¯”è¾ƒç©ºé—²çš„ï¼›å¦‚æœè´Ÿè½½æ˜¯4ï¼Œåˆ™è¯´æ˜å½“å‰å››ä¸ªæ ¸å¿ƒéƒ½å¤„äºè·‘æ»¡çš„çŠ¶æ€ï¼Œå¦‚æœè´Ÿè½½å¤§äºå››ï¼Œå‡è®¾6ï¼Œé‚£è¯´æ˜å››æ ¸çš„&lt;code&gt;CPU&lt;/code&gt; è¢«è¶…è´Ÿè·ä½¿ç”¨ä¹Ÿæ— æ³•å¤„ç†å®Œå½“å‰çš„ä»»åŠ¡ï¼Œæœ‰å¾ˆå¤šçº¿ç¨‹ä¸è¦ç­‰å¾…&lt;code&gt;CPU&lt;/code&gt; èµ„æº&lt;/li&gt;
&lt;li&gt;åé¢æœ‰å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œ&lt;/li&gt;
&lt;/ul&gt;&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;KiB Mem : 498684 total, 6216 free, 366620 used, 125848 buff/cache&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;498684 total&lt;/code&gt; ï¼š æ€»çš„å†…å­˜ï¼Œå·®ä¸å¤š &lt;code&gt;490M&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;6216 free&lt;/code&gt;ï¼šå½“å‰å¯ç”¨å†…å­˜ï¼Œ&lt;code&gt;6M&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;366620 used&lt;/code&gt;ï¼šå·²ä½¿ç”¨å†…å­˜&lt;/li&gt;
&lt;li&gt;&lt;code&gt;125848 buff/cache&lt;/code&gt;ï¼šç”¨äº&lt;code&gt;IO&lt;/code&gt; ç¼“å†²çš„å†…å­˜&lt;/li&gt;
&lt;/ul&gt;&lt;h5 id=&quot;ç£ç›˜ioæ£€æµ‹&quot;&gt;ç£ç›˜IOæ£€æµ‹&lt;/h5&gt;
&lt;ul&gt;&lt;li&gt;åœ¨æ£€æµ‹&lt;code&gt;CPU&lt;/code&gt; å’Œå†…å­˜ä½¿ç”¨çš„åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ£€æµ‹ç£ç›˜çš„ä½¿ç”¨çŠ¶å†µï¼ŒåŒ…æ‹¬&lt;code&gt;IO&lt;/code&gt; ååé‡ï¼Œ&lt;code&gt;IOPS&lt;/code&gt; ç­‰ä¿¡æ¯&lt;/li&gt;
&lt;li&gt;ä¸»è¦é€šè¿‡ &lt;code&gt;dstat&lt;/code&gt; å‘½ä»¤æ¥æŸ¥çœ‹ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰è£…å¯ä»¥é€šè¿‡ &lt;code&gt;yum install dstat&lt;/code&gt; è¿›è¡Œå®‰è£…&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œ &lt;code&gt;dstat -d&lt;/code&gt; å‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/2024393/202012/2024393-20201230083318439-1862326864.png&quot; alt=&quot;image.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;ä¸Šé¢æ˜¾ç¤ºçš„å†…å­˜å¯ä»¥çœ‹åˆ°å­˜å‚¨çš„IOååé‡çš„è¯¦ç»†æ•°æ®ï¼Œæ¯ç§’è¯»&lt;code&gt;19M&lt;/code&gt;æ•°æ®ï¼Œæ¯ç§’å†™ &lt;code&gt;6521K&lt;/code&gt;çš„æ•°æ®ï¼Œè¿™ä¸ªååé‡å¹¶ä¸æ˜¯å¾ˆé«˜ï¼Œä¸€èˆ¬æ™®é€šçš„æœºæ¢°ç¡¬ç›˜å¯ä»¥åˆ°è¾¾ä¸Šç™¾&lt;code&gt;MB&lt;/code&gt;çš„è¯»å†™é‡&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;&lt;li&gt;ä½¿ç”¨å‘½ä»¤ &lt;code&gt;dstat -r&lt;/code&gt; æ¥æŸ¥çœ‹&lt;code&gt;IOPS&lt;/code&gt; çš„æƒ…å†µï¼Œå¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/2024393/202012/2024393-20201230083319003-304051172.png&quot; alt=&quot;image.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;å¦‚ä¸Šé¢ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè¯»å†™åˆ†åˆ«çš„&lt;code&gt;IOPS&lt;/code&gt; çš„å€¼ï¼Œ&lt;strong&gt;ä¹Ÿå°±æ˜¯è¯´éšå³ç£ç›˜è¯»å–/å†™å…¥æ¯ç§’å¤šå°‘æ¬¡&lt;/strong&gt;ï¼Œé€šå¸¸æ¥è¯´ç£ç›˜çš„è¯»å†™æ¯ç§’åœ¨ä¸¤ä¸‰ç™¾æ¬¡æ˜¯å¯æ¥å—çš„&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&quot;ç½‘å¡æµé‡æ£€æµ‹&quot;&gt;ç½‘å¡æµé‡æ£€æµ‹&lt;/h5&gt;
&lt;ul&gt;&lt;li&gt;åŒæ ·æˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code&gt;dstat -n&lt;/code&gt; æ¥æŸ¥çœ‹ç½‘å¡çš„å…·ä½“æµé‡æƒ…å†µï¼Œå¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/2024393/202012/2024393-20201230083319328-8897079.png&quot; alt=&quot;image.png&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ä¸Šé¢æ‰€ç¤ºï¼Œç½‘å¡æ¯ç§’æ¥æ”¶å’Œå‘é€çš„æ•°æ®é‡ã€‚é€šå¸¸æ¥è¯´å¦‚æœæˆ‘ä»¬ç”µè„‘æ˜¯åƒå…†ç½‘å¡ï¼Œé‚£ä¹ˆæ¯ç§’é’Ÿç½‘å¡çš„æ€»æµé‡ä¹Ÿå°±åœ¨&lt;code&gt;100M&lt;/code&gt; å·¦å³ï¼Œç”šè‡³æ›´ä½&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr/&gt;&lt;blockquote readability=&quot;6.0520833333333&quot;&gt;
&lt;p&gt;æœ¬æ–‡ç”±AnonyStar å‘å¸ƒ,å¯è½¬è½½ä½†éœ€å£°æ˜åŸæ–‡å‡ºå¤„ã€‚&lt;br/&gt;æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬è´¦å· ï¼šäº‘æ –ç®€ç  è·å–æ›´å¤šä¼˜è´¨æ–‡ç« &lt;br/&gt;æ›´å¤šæ–‡ç« å…³æ³¨ç¬”è€…åšå®¢ ï¼š&lt;a href=&quot;https://i-code.online/&quot; target=&quot;_blank&quot;&gt;äº‘æ –ç®€ç  i-code.online&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</description>
<pubDate>Wed, 30 Dec 2020 00:33:00 +0000</pubDate>
<dc:creator>AnonyStar</dc:creator>
<og:description>000 - &amp;amp;#127859;Sysbench æ•°æ®åº“å‹åŠ›æµ‹è¯•å·¥å…· sysbench æ˜¯ä¸€ä¸ªå¼€æºçš„ã€æ¨¡å—åŒ–çš„ã€è·¨å¹³å°çš„å¤šçº¿ç¨‹æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡ŒCPUã€å†…å­˜ã€ç£ç›˜I/Oã€çº¿ç¨‹ã€æ•°æ®åº“çš„æ€§</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/i-code/p/14209648.html</dc:identifier>
</item>
<item>
<title>ä½ è¯´ä¸€ä¸‹Redisä¸ºä»€ä¹ˆå¿«å§ï¼Œæ€ä¹ˆå®ç°é«˜å¯ç”¨ï¼Œè¿˜æœ‰æŒä¹…åŒ–æ€ä¹ˆåšçš„ï¼Ÿ - çºªè«</title>
<link>http://www.cnblogs.com/jimoer/p/14204650.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/jimoer/p/14204650.html</guid>
<description>&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ä½œä¸ºJavaç¨‹åºå‘˜ï¼Œåœ¨é¢è¯•è¿‡ç¨‹ä¸­ï¼Œç¼“å­˜ç›¸å…³çš„é—®é¢˜æ˜¯èº²ä¸æ‰çš„ï¼Œè‚¯å®šä¼šé—®ï¼Œä¾‹å¦‚ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Œç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€ç­‰ã€‚è¯´åˆ°ç¼“å­˜ï¼Œé‚£è‚¯å®šå°‘ä¸äº†Redisï¼Œæˆ‘åœ¨é¢è¯•çš„æ—¶å€™ä¹Ÿæ˜¯è¢«é—®äº†å¾ˆå¤šå…³äºRedisç›¸å…³çš„çŸ¥è¯†ï¼Œä½†æ˜¯Redisçš„åŠŸèƒ½å¤ªå¼ºå¤§äº†ï¼Œå¹¶ä¸æ˜¯ä¸€æ—¶åŠä¼šå„¿èƒ½æŒæ¡å¥½çš„ï¼Œå› ä¸ºæœ‰äº›é«˜çº§ç‰¹æ€§æˆ–æ˜¯çŸ¥è¯†å¹³æ—¶å¹¶ä¸ä¼šç”¨åˆ°ã€‚&lt;br/&gt;æ‰€ä»¥å›ç­”çš„ä¸å¥½ï¼Œäººå®¶å°±ä¼šè§‰å¾—ä½ å¯¹è‡ªå·±å¹³æ—¶ä½¿ç”¨çš„å·¥å…·éƒ½æ²¡æœ‰äº†è§£ï¼Œè‡ªç„¶å°±å‡‰å‡‰äº†ã€‚å…¶å®å¾ˆæ—©å°±æœ‰è¿™ä¸ªæ‰“ç®—ï¼Œæ‰“ç®—å¥½å¥½æ€»ç»“ä¸€ä¸‹Redisçš„çŸ¥è¯†ï¼Œä½†ä¹Ÿæ˜¯ç”±äºè‡ªå·±éƒ½æ²¡æœ‰å¥½å¥½çš„äº†è§£Rediså‘¢ï¼Œæ‰€ä»¥ä¸€ç›´æ²¡æœ‰å¼€å§‹ã€‚è¿™æ¬¡å‡†å¤‡æ…¢æ…¢çš„æ¥æ€»ç»“ã€‚&lt;/p&gt;
&lt;h2 id=&quot;redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«&quot;&gt;Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«&lt;/h2&gt;
&lt;p&gt;Redisæ˜¯ä¸€ä¸ªç”±Cè¯­è¨€ç¼–å†™çš„å¼€æºçš„ï¼ŒåŸºäºå†…å­˜ï¼Œæ”¯æŒå¤šç§æ•°æ®ç»“æ„å¯æŒä¹…åŒ–çš„NoSQLæ•°æ®åº“ã€‚&lt;br/&gt;å®ƒé€Ÿåº¦å¿«ä¸»è¦æ˜¯æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;åŸºäºå†…å­˜è¿è¡Œï¼Œæ€§èƒ½é«˜æ•ˆï¼›&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®ç»“æ„è®¾è®¡é«˜æ•ˆï¼Œä¾‹å¦‚Stringæ˜¯ç”±åŠ¨æ€å­—ç¬¦æ•°ç»„æ„æˆï¼Œzsetå†…éƒ¨çš„è·³è¡¨ï¼›&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡‡ç”¨å•çº¿ç¨‹ï¼Œé¿å…äº†çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¹Ÿé¿å…äº†çº¿ç¨‹ç«äº‰äº§ç”Ÿçš„æ­»é”ç­‰é—®é¢˜ï¼›&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨I/Oå¤šè·¯å¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡IOï¼›&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;å®˜ç½‘ä¸Šç»™å‡ºå•å°Redisçš„å¯ä»¥è¾¾åˆ°10w+çš„QPSçš„ï¼Œ ä¸€å°æœåŠ¡å™¨ä¸Šåœ¨ä½¿ç”¨Redisçš„æ—¶å€™å•æ ¸çš„å°±å¤Ÿäº†ï¼Œä½†æ˜¯ç›®å‰æœåŠ¡å™¨éƒ½æ˜¯å¤šæ ¸CPUï¼Œè¦æƒ³ä¸æµªè´¹èµ„æºï¼Œåˆèƒ½æäº¤æ•ˆç‡ï¼Œå¯ä»¥åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šéƒ¨ç½²å¤šä¸ªRediså®ä¾‹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;é«˜å¯ç”¨æ–¹æ¡ˆ&quot;&gt;é«˜å¯ç”¨æ–¹æ¡ˆ&lt;/h2&gt;
&lt;p&gt;è™½ç„¶å•å°Redisçš„çš„æ€§èƒ½å¾ˆå¥½ï¼Œä½†æ˜¯Redisçš„å•èŠ‚ç‚¹å¹¶ä¸èƒ½ä¿è¯å®ƒä¸ä¼šæŒ‚äº†å•Šï¼Œæ¯•ç«Ÿå•èŠ‚ç‚¹çš„Redisæ˜¯æœ‰ä¸Šé™çš„ï¼Œè€Œä¸”äººå®¶å•èŠ‚ç‚¹åˆè¦è¯»åˆè¦å†™ï¼Œå°èº«æ¿æ‰›ä¸ä½å’‹åŠï¼Œæ‰€ä»¥ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œä¸€èˆ¬éƒ½æ˜¯åšæˆé›†ç¾¤ã€‚&lt;/p&gt;
&lt;h3 id=&quot;ä¸»ä»ï¼ˆmaster-slaveï¼‰&quot;&gt;ä¸»ä»ï¼ˆMaster-Slaveï¼‰&lt;/h3&gt;
&lt;p&gt;Rediså®˜æ–¹æ˜¯æ”¯æŒä¸»ä»åŒæ­¥çš„ï¼Œè€Œä¸”è¿˜æ”¯æŒä»ä»åŒæ­¥ï¼Œä»ä»åŒæ­¥ä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸»ä»åŒæ­¥ï¼Œåªä¸è¿‡ä»ä»åŒæ­¥çš„ä¸»èŠ‚ç‚¹æ˜¯å¦ä¸€ä¸ªä¸»ä»çš„ä»èŠ‚ç‚¹ã€‚&lt;br/&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20201221231623140.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmlNb2Vy,size_30,color_FFFFFF,t_70&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;æœ‰äº†ä¸»ä»åŒæ­¥çš„é›†ç¾¤ï¼Œé‚£ä¹ˆä¸»èŠ‚ç‚¹å°±è´Ÿè´£æä¾›å†™æ“ä½œï¼Œè€Œä»èŠ‚ç‚¹å°±è´Ÿè´£æ”¯æŒè¯»æ“ä½œã€‚&lt;/p&gt;
&lt;h4 id=&quot;é‚£ä¹ˆä»–ä»¬ä¹‹é—´æ˜¯å¦‚ä½•è¿›è¡Œæ•°æ®åŒæ­¥çš„å‘¢ï¼Ÿ&quot;&gt;é‚£ä¹ˆä»–ä»¬ä¹‹é—´æ˜¯å¦‚ä½•è¿›è¡Œæ•°æ®åŒæ­¥çš„å‘¢ï¼Ÿ&lt;/h4&gt;
&lt;p&gt;å¦‚æœSlaveï¼ˆä»èŠ‚ç‚¹ï¼‰æ˜¯ç¬¬ä¸€æ¬¡è·ŸMasterè¿›è¡Œè¿æ¥ï¼Œ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;é‚£ä¹ˆä¼šé¦–å…ˆä¼šå‘Masterå‘é€åŒæ­¥è¯·æ±‚&lt;code&gt;psync&lt;/code&gt;ï¼›&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°åŒæ­¥è¯·æ±‚ï¼Œå¼€å§‹forkä¸»å­è¿›ç¨‹å¼€å§‹è¿›è¡Œå…¨é‡åŒæ­¥ï¼Œç„¶åç”ŸæˆRDBæ–‡ä»¶ï¼›&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿™ä¸ªæ—¶å€™ä¸»èŠ‚ç‚¹åŒæ—¶ä¼šå°†æ–°çš„å†™è¯·æ±‚ï¼Œä¿å­˜åˆ°ç¼“å­˜åŒºï¼ˆbufferï¼‰ä¸­ï¼›&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»èŠ‚ç‚¹æ¥æ”¶åˆ°RDBæ–‡ä»¶åï¼Œå…ˆæ¸…ç©ºè€æ•°æ®ï¼Œç„¶åå°†RDBä¸­æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼›&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç­‰åˆ°ä»èŠ‚ç‚¹å°†RDBæ–‡ä»¶åŒæ­¥å®Œæˆåå†åŒæ­¥ç¼“å­˜åŒºä¸­çš„å†™è¯·æ±‚ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„å°±æ˜¯ï¼Œä¸»èŠ‚ç‚¹çš„ç¼“å­˜åŒºæ˜¯æœ‰é™çš„ï¼Œå†…éƒ¨ç»“æ„æ˜¯ä¸€ä¸ªç¯å½¢æ•°ç»„ï¼Œå½“æ•°ç»„è¢«å æ»¡ä¹‹åå°±ä¼šè¦†ç›–æ‰æœ€æ—©ä¹‹å‰çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å¦‚æœç”±äºç½‘ç»œæˆ–æ˜¯å…¶ä»–åŸå› ï¼Œé€ æˆç¼“å­˜åŒºä¸­çš„æ•°æ®è¢«è¦†ç›–äº†ï¼Œé‚£ä¹ˆå½“ä»èŠ‚ç‚¹å¤„ç†å®Œä¸»èŠ‚ç‚¹çš„RDBæ–‡ä»¶åï¼Œå°±ä¸å¾—ä¸åˆè¦è¿›è¡Œä¸€å…¨é‡çš„RDBæ–‡ä»¶çš„å¤åˆ¶ï¼Œæ‰èƒ½ä¿è¯ä¸»ä»èŠ‚ç‚¹çš„æ•°æ®ä¸€è‡´ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸è®¾ç½®å¥½åˆç†çš„bufferåŒºç©ºé—´ï¼Œæ˜¯ä¼šé€ æˆä¸€ä¸ªRDBå¤åˆ¶çš„æ­»å¾ªç¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å½“ä¸»ä»é—´çš„æ•°æ®åŒæ­¥å®Œæˆä¹‹åï¼Œåé¢ä¸»èŠ‚ç‚¹çš„æ¯æ¬¡å†™æ“ä½œå°±éƒ½ä¼šåŒæ­¥åˆ°ä»èŠ‚ç‚¹ï¼Œè¿™æ ·è¿›è¡Œå¢é‡åŒæ­¥äº†ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç”±äºè´Ÿè½½çš„ä¸æ–­ä¸Šå‡å°±å¯¼è‡´äº†ä¸»ä»ä¹‹é—´çš„å»¶æ—¶å˜å¤§ï¼Œæ‰€ä»¥å°±æœ‰äº†ä¸Šé¢æˆ‘è¯´çš„ä»ä»åŒæ­¥äº†ï¼Œä¸»èŠ‚ç‚¹å…ˆåŒæ­¥åˆ°ä¸€éƒ¨åˆ†ä»èŠ‚ç‚¹ï¼Œç„¶åç”±ä»èŠ‚ç‚¹å»åŒæ­¥å…¶ä»–çš„ä»èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;åœ¨Redisä»2.8.18å¼€å§‹æ”¯æŒæ— ç›˜å¤åˆ¶ï¼Œä¸»èŠ‚ç‚¹é€šè¿‡å¥—æ¥å­—ï¼Œä¸€è¾¹éå†å†…å­˜ä¸­çš„æ•°æ®ï¼Œä¸€è¾¹è®©æ•°æ®å‘é€ç»™ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹å’Œä¹‹å‰ä¸€æ ·ï¼Œå…ˆå°†æ•°æ®å­˜å‚¨åœ¨ç£ç›˜æ–‡ä»¶ä¸­ï¼Œç„¶åå†ä¸€æ¬¡æ€§åŠ è½½ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;å¦å¤–ç”±äºä¸»ä»åŒæ­¥æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥ä»Redis3.0ä¹‹åå‡ºç°äº†åŒæ­¥å¤åˆ¶ï¼Œå°±æ˜¯é€šè¿‡waitå‘½ä»¤æ¥è¿›è¡Œæ§åˆ¶ï¼Œwaitå‘½ä»¤æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ä»åº“æ•°é‡ï¼Œç¬¬äºŒä¸ªæ˜¯ç­‰å¾…ä»åº“çš„å¤åˆ¶æ—¶é—´ï¼Œå¦‚æœç¬¬äºŒä¸ªå‚æ•°è®¾ç½®ä¸º0ï¼Œé‚£ä¹ˆå°±æ˜¯ä»£è¡¨è¦ç­‰å¾…æ‰€æœ‰ä»åº“éƒ½å¤åˆ¶å®Œæ‰å»æ‰§è¡Œåé¢çš„å‘½ä»¤ã€‚&lt;br/&gt;ä½†æ˜¯è¿™æ ·å°±ä¼šå­˜åœ¨ä¸€ä¸ªéšæ‚£ï¼Œå½“ç½‘ç»œå¼‚å¸¸åï¼Œwaitå‘½ä»¤ä¼šä¸€ç›´é˜»å¡ä¸‹å»ï¼Œå¯¼è‡´Redisä¸å¯ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;å“¨å…µï¼ˆsentinelï¼‰&quot;&gt;å“¨å…µï¼ˆSentinelï¼‰&lt;/h3&gt;
&lt;p&gt;å“¨å…µå¯ä»¥ç›‘æ§Redisé›†ç¾¤çš„å¥åº·çŠ¶æ€ï¼Œå½“ä¸»èŠ‚ç‚¹æŒ‚æ‰ä¹‹åï¼Œé€‰ä¸¾å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ã€‚å®¢æˆ·ç«¯åœ¨ä½¿ç”¨Redisçš„æ—¶å€™ä¼šå…ˆé€šè¿‡Sentinelæ¥è·å–ä¸»èŠ‚ç‚¹åœ°å€ï¼Œç„¶åå†é€šè¿‡ä¸»èŠ‚ç‚¹æ¥è¿›è¡Œæ•°æ®äº¤äº’ã€‚å½“ä¸»èŠ‚ç‚¹æŒ‚æ‰ä¹‹åï¼Œå®¢æˆ·ç«¯ä¼šå†æ¬¡å‘Sentinelè·å–ä¸»èŠ‚ç‚¹ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±å¯ä»¥æ— æ„ŸçŸ¥çš„ç»§ç»­ä½¿ç”¨äº†ã€‚&lt;br/&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20201225224935698.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmlNb2Vy,size_60,color_FFFFFF,t_70&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;&lt;strong&gt;å“¨å…µé›†ç¾¤å·¥ä½œè¿‡ç¨‹ï¼Œä¸»èŠ‚ç‚¹æŒ‚æ‰ä¹‹åä¼šé€‰ä¸¾å‡ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œç„¶åç›‘æ§æŒ‚æ‰çš„èŠ‚ç‚¹ï¼Œå½“æŒ‚æ‰çš„èŠ‚ç‚¹æ¢å¤åï¼ŒåŸå…ˆçš„ä¸»èŠ‚ç‚¹å°±ä¼šå˜æˆä»èŠ‚ç‚¹ï¼Œä»æ–°çš„ä¸»èŠ‚ç‚¹é‚£é‡Œå»ºç«‹ä¸»ä»å…³ç³»ã€‚&lt;/strong&gt;&lt;br/&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/202012252321072.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmlNb2Vy,size_60,color_FFFFFF,t_70&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;é›†ç¾¤åˆ†ç‰‡ï¼ˆredis-clusterï¼‰&quot;&gt;é›†ç¾¤åˆ†ç‰‡ï¼ˆRedis Clusterï¼‰&lt;/h3&gt;
&lt;p&gt;Redis Clusteræ˜¯Rediså®˜æ–¹æ¨èçš„é›†ç¾¤æ¨¡å¼ï¼ŒRedis Clusterå°†æ‰€æœ‰æ•°æ®åˆ’åˆ†åˆ°16384ä¸ªæ§½ï¼ˆ&lt;code&gt;slots&lt;/code&gt;ï¼‰ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†æ§½ä½çš„è¯»å†™æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/2020122716591125.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmlNb2Vy,size_16,color_FFFFFF,t_70&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;å­˜å‚¨&quot;&gt;å­˜å‚¨&lt;/h4&gt;
&lt;p&gt;Redis Clusteré»˜è®¤æ˜¯é€šè¿‡CRC16ç®—æ³•è·å–åˆ°keyçš„hashå€¼ï¼Œç„¶åå†å¯¹16384è¿›è¡Œå–ä½™ï¼ˆ&lt;code&gt;CRC16(key)%16384&lt;/code&gt;ï¼‰ï¼Œè·å–åˆ°çš„æ§½ä½åœ¨å“ªä¸ªèŠ‚ç‚¹è´Ÿè´£çš„èŒƒå›´å†…ï¼ˆ&lt;strong&gt;è¿™é‡Œä¸€èˆ¬æ˜¯ä¼šæœ‰ä¸€ä¸ªæ§½ä½å’ŒèŠ‚ç‚¹çš„æ˜ å°„è¡¨æ¥è¿›è¡Œå¿«é€Ÿå®šä½èŠ‚ç‚¹çš„ï¼Œé€šå¸¸ä½¿ç”¨bitmapæ¥å®ç°&lt;/strong&gt;ï¼‰ï¼Œå°±å­˜å‚¨åœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šã€‚&lt;/p&gt;
&lt;h4 id=&quot;é‡å®šå‘&quot;&gt;é‡å®šå‘&lt;/h4&gt;
&lt;p&gt;å½“Redis Clusterçš„å®¢æˆ·ç«¯åœ¨å’Œé›†ç¾¤å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œä¹Ÿä¼šè·å¾—ä¸€ä»½æ§½ä½å’ŒèŠ‚ç‚¹çš„é…ç½®å…³ç³»ï¼ˆ&lt;strong&gt;æ§½ä½å’ŒèŠ‚ç‚¹çš„æ˜ å°„è¡¨&lt;/strong&gt;ï¼‰ï¼Œè¿™æ ·å½“å®¢æˆ·ç«¯è¦æŸ¥æ‰¾æŸä¸ªkeyæ—¶ï¼Œå¯ä»¥ç›´æ¥å®šä½åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å½“å®¢æˆ·ç«¯å‘é€è¯·æ±‚æ—¶ï¼Œå¦‚æœæ¥æ”¶è¯·æ±‚çš„èŠ‚ç‚¹å‘ç°è¯¥æ•°æ®çš„æ§½ä½å¹¶ä¸åœ¨å½“å‰èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆä¼šè¿”å›&lt;code&gt;MOVED&lt;/code&gt;æŒ‡ä»¤å°†æ­£ç¡®çš„æ§½ä½å’ŒèŠ‚ç‚¹ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·æ¥ç€è¯·æ±‚æ­£ç¡®çš„èŠ‚ç‚¹è·å–æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬å®¢æˆ·ç«¯åœ¨æ¥æ”¶åˆ°&lt;code&gt;MOVED&lt;/code&gt;æŒ‡ä»¤åï¼Œä¹Ÿä¼šæ›´æ–°è‡ªå·±æœ¬åœ°çš„æ§½ä½å’ŒèŠ‚ç‚¹çš„æ˜ å°„è¡¨ï¼Œè¿™æ ·ä¸‹æ¬¡è·å–æ•°æ®æ—¶å°±å¯ä»¥ç›´æ¥å‘½ä¸­äº†ã€‚è¿™æ•´ä¸ªé‡å®šå‘çš„è¿‡ç¨‹å¯¹å®¢æˆ·ç«¯æ˜¯é€æ˜çš„ã€‚&lt;/p&gt;
&lt;h4 id=&quot;æ•°æ®è¿ç§»&quot;&gt;æ•°æ®è¿ç§»&lt;/h4&gt;
&lt;p&gt;å½“é›†ç¾¤ä¸­æ–°å¢èŠ‚ç‚¹æˆ–åˆ é™¤èŠ‚ç‚¹åï¼ŒèŠ‚ç‚¹é—´çš„æ•°æ®è¿ç§»æ˜¯æŒ‰æ§½ä½ä¸ºå•ä½çš„ï¼Œä¸€ä¸ªæ§½ä½ä¸€ä¸ªæ§½ä½çš„è¿ç§»ï¼Œå½“è¿ç§»æ—¶åŸèŠ‚ç‚¹çŠ¶æ€å¤„äºï¼š&lt;code&gt;magrating&lt;/code&gt;ï¼Œç›®æ ‡èŠ‚ç‚¹å¤„äºï¼š&lt;code&gt;importing&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿ç§»è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯é¦–å…ˆè®¿é—®æ—§èŠ‚ç‚¹ï¼Œå¦‚æœæ•°æ®è¿˜åœ¨æ—§èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ—§èŠ‚ç‚¹æ­£å¸¸å¤„ç†ï¼Œå¦‚æœä¸åœ¨æ—§èŠ‚ç‚¹ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ª&lt;code&gt;-ASK + ç›®æ ‡èŠ‚ç‚¹åœ°å€&lt;/code&gt;çš„æŒ‡ä»¤ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°è¿™ä¸ª&lt;code&gt;-ASK&lt;/code&gt;æŒ‡ä»¤åï¼Œå‘ç›®æ ‡èŠ‚ç‚¹æ‰§è¡Œä¸€ä¸ª&lt;code&gt;asking&lt;/code&gt;æŒ‡ä»¤ï¼ˆå‘Šè¯‰æ–°èŠ‚ç‚¹ï¼Œå¿…é¡»å¤„ç†å®¢æˆ·ç«¯è¿™ä¸ªæ•°æ®ï¼‰ï¼Œç„¶åå†å‘ç›®æ ‡èŠ‚ç‚¹æ‰§è¡Œå®¢æˆ·ç«¯çš„è®¿é—®æ•°æ®çš„æŒ‡ä»¤ã€‚&lt;br/&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20201227200044891.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmlNb2Vy,size_30,color_FFFFFF,t_70&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h4 id=&quot;å®¹é”™&quot;&gt;å®¹é”™&lt;/h4&gt;
&lt;p&gt;Redis Clusterå¯ä»¥ä¸ºæ¯ä¸ªä¸»èŠ‚ç‚¹è®¾ç½®å¤šä¸ªä»èŠ‚ç‚¹ï¼Œå½“å•ä¸ªä¸»èŠ‚ç‚¹æŒ‚æ‰åï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨å°†å…¶ä¸­æŸä¸ªä»èŠ‚ç‚¹æå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œè‹¥æ²¡æœ‰ä»èŠ‚ç‚¹ï¼Œé‚£ä¹ˆé›†ç¾¤å°†å¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚&lt;br/&gt;Redisæä¾›äº†ä¸€ä¸ªå‚æ•°ï¼š&lt;code&gt;cluster-require-full-coverage&lt;/code&gt;ï¼Œç”¨æ¥é…ç½®å¯ä»¥å…è®¸éƒ¨åˆ†èŠ‚ç‚¹å‡ºé—®é¢˜åï¼Œè¿˜æœ‰å…¶ä»–èŠ‚ç‚¹åœ¨è¿è¡Œæ—¶å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€ç‚¹æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯ï¼ŒClusterä¸­å½“ä¸€ä¸ªèŠ‚ç‚¹å‘ç°æŸä¸ªå…¶ä»–èŠ‚ç‚¹å‡ºç°å¤±è”äº†ï¼Œè¿™ä¸ªæ—¶å€™é—®é¢˜èŠ‚ç‚¹åªæ˜¯&lt;code&gt;PFail&lt;/code&gt;ï¼ˆ&lt;code&gt;Possibly&lt;/code&gt;-å¯èƒ½ä¸‹çº¿ï¼‰ï¼Œç„¶åå®ƒä¼šæŠŠè¿™ä¸ªå¤±è”ä¿¡æ¯å¹¿æ’­ç»™å…¶ä»–èŠ‚ç‚¹ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹æ¥æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¤±è”ä¿¡æ¯è¾¾åˆ°é›†ç¾¤çš„å¤§å¤šæ•°æ—¶ï¼Œå°±å¯ä»¥å°†å¤±è”èŠ‚ç‚¹æ ‡è®°ä¸ºä¸‹çº¿ï¼Œç„¶åå°†ä¸‹çº¿ä¿¡æ¯å¹¿æ’­ç»™å…¶ä»–èŠ‚ç‚¹ã€‚è‹¥å¤±è”èŠ‚ç‚¹ä¸ºä¸»èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°†ç«‹å³å¯¹è¯¥èŠ‚ç‚¹è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;8&quot;&gt;
&lt;p&gt;&lt;strong&gt;Redisé«˜å¯ç”¨å°±å…ˆè¯´åˆ°è¿™é‡Œå§ï¼Œåé¢å…¶å®è¿˜æœ‰Codisï¼Œä½†æ˜¯ç›®å‰Clusteré€æ¸æµè¡Œèµ·æ¥äº†ï¼ŒCodisçš„ç«äº‰åŠ›é€æ¸è¢«èš•é£Ÿï¼Œè€Œä¸”å¯¹æ–°ç‰ˆæœ¬çš„æ”¯æŒï¼Œæ›´æ–°çš„ä¹Ÿæ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸è¯´å®ƒäº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±å»äº†è§£ä¸€ä¸‹ï¼Œå›½äººå¼€æºçš„Redisé›†ç¾¤æ¨¡å¼Codisã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;æŒä¹…åŒ–&quot;&gt;æŒä¹…åŒ–&lt;/h2&gt;
&lt;p&gt;RedisæŒä¹…åŒ–çš„æ„ä¹‰åœ¨äºï¼Œå½“å‡ºç°å®•æœºé—®é¢˜åï¼Œèƒ½å°†æ•°æ®æ¢å¤åˆ°ç¼“å­˜ä¸­ï¼Œå®ƒæä¾›äº†ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ï¼š&lt;strong&gt;ä¸€ç§æ˜¯å¿«ç…§ï¼ˆRDBï¼‰ï¼Œä¸€ç§æ˜¯AOFæ—¥å¿—ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¿«ç…§æ˜¯ä¸€æ¬¡å…¨é‡å¤‡ä»½ï¼Œè€ŒAOFæ˜¯å¢é‡å¤‡ä»½ã€‚å¿«ç…§æ˜¯å†…å­˜æ•°æ®çš„äºŒè¿›åˆ¶åºåˆ—åŒ–å½¢å¼ï¼Œå­˜å‚¨ä¸Šéå¸¸ç´§å‡‘ï¼Œè€ŒAOFæ—¥å¿—è®°å½•çš„æ˜¯å†…å­˜æ•°æ®ä¿®æ”¹çš„æŒ‡ä»¤è®°å½•æ–‡æœ¬ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å¿«ç…§å¤‡ä»½ï¼ˆrdbï¼‰&quot;&gt;å¿«ç…§å¤‡ä»½ï¼ˆRDBï¼‰&lt;/h3&gt;
&lt;p&gt;å› ä¸ºRedisæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥åœ¨åšå¿«ç…§æŒä¹…åŒ–çš„æ—¶å€™ï¼Œé€šå¸¸æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œ&lt;strong&gt;saveå‘½ä»¤ï¼Œä¼šé˜»å¡çº¿ç¨‹ï¼Œç›´åˆ°å¤‡ä»½å®Œæˆ&lt;/strong&gt;ï¼›bgsaveä¼šå¼‚æ­¥çš„æ‰§è¡Œå¤‡ä»½ï¼Œå…¶å®æ˜¯forkå‡ºäº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œç”¨å­è¿›ç¨‹å»æ‰§è¡Œå¿«ç…§æŒä¹…åŒ–æ“ä½œï¼Œå°†æ•°æ®ä¿å­˜åœ¨ä¸€ä¸ª.rdbæ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;å­è¿›ç¨‹åˆšåˆšäº§ç”Ÿçš„æ—¶å€™ï¼Œæ˜¯å’Œçˆ¶è¿›ç¨‹å…±äº«å†…å­˜ä¸­çš„æ•°æ®çš„ï¼Œä½†æ˜¯å­è¿›ç¨‹åšæŒä¹…åŒ–æ—¶ï¼Œæ˜¯ä¸ä¼šä¿®æ”¹æ•°æ®çš„ï¼Œè€Œçˆ¶è¿›ç¨‹æ˜¯è¦æŒç»­æä¾›æœåŠ¡çš„ï¼Œæ‰€ä»¥çˆ¶è¿›ç¨‹å°±ä¼šæŒç»­çš„ä¿®æ”¹å†…å­˜ä¸­çš„æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™çˆ¶è¿›ç¨‹å°±ä¼šå°†å†…å­˜ä¸­çš„æ•°æ®ï¼ŒCopyå‡ºä¸€ä»½æ¥è¿›è¡Œä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;çˆ¶è¿›ç¨‹copyçš„æ•°æ®æ˜¯ä»¥æ•°æ®é¡µä¸ºå•ä½çš„ï¼ˆ4kä¸€é¡µï¼‰ï¼Œå¯¹é‚£ä¸€é¡µæ•°æ®è¿›è¡Œä¿®æ”¹å°±copyå“ªä¸€é¡µçš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å­è¿›ç¨‹ç”±äºæ•°æ®æ²¡æœ‰å˜åŒ–å°±ä¼šä¸€ç›´çš„å»éå†æ•°æ®ï¼Œè¿›ç¨‹æŒä¹…åŒ–æ“ä½œäº†ï¼Œè¿™å°±æ˜¯åªä¿ç•™äº†åˆ›å»ºå­è¿›ç¨‹çš„æ—¶å€™çš„å¿«ç…§ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆRDBæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è§¦å‘çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;# save &amp;lt;seconds&amp;gt; &amp;lt;changes&amp;gt;
save 60 10000
save 300 10 
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¸Šè¿™æ®µé…ç½®å°±æ˜¯åœ¨redis.confæ–‡ä»¶ä¸­é…ç½®çš„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ—¶é—´å•ä½æ˜¯ç§’ï¼Œç¬¬äºŒä¸ªå‚æ•°æ‰§è¡Œæ•°æ®å˜åŒ–çš„æ¬¡æ•°ã€‚&lt;br/&gt;æ„æ€å°±æ˜¯è¯´ï¼š&lt;strong&gt;300ç§’ä¹‹å†…è‡³å°‘å‘ç”Ÿ10æ¬¡å†™æ“ä½œã€&lt;br/&gt;60ç§’ä¹‹å†…å‘ç”Ÿè‡³å°‘10000æ¬¡å†™æ“ä½œï¼Œåªè¦æ»¡è¶³ä»»ä¸€æ¡ä»¶ï¼Œå‡ä¼šè§¦å‘bgsave&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&quot;å¢é‡æ—¥å¿—å¤‡ä»½ï¼ˆaofï¼‰&quot;&gt;å¢é‡æ—¥å¿—å¤‡ä»½ï¼ˆAOFï¼‰&lt;/h3&gt;
&lt;p&gt;Redisåœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚æŒ‡ä»¤åï¼Œä¼šå…ˆè¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒæˆåŠŸåï¼Œç«‹å³å°†æŒ‡ä»¤å­˜å‚¨åˆ°AOFæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå°±æ˜¯è¯´ï¼ŒRedisæ˜¯å…ˆè®°å½•æ—¥å¿—ï¼Œå†æ‰§è¡Œå‘½ä»¤ã€‚è¿™æ ·å³ä½¿å‘½ä»¤è¿˜æ²¡æ‰§è¡Œçªç„¶å®•æœºäº†ï¼Œé€šè¿‡AOFæ—¥å¿—æ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥æ¢å¤çš„ã€‚&lt;/p&gt;
&lt;h4 id=&quot;aofé‡å†™&quot;&gt;AOFé‡å†™&lt;/h4&gt;
&lt;p&gt;AOFæ—¥å¿—æ–‡ä»¶ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œä¼šè¶Šæ¥è¶Šå¤§ï¼Œæ‰€ä»¥å°±éœ€è¦è¿›è¡Œé‡å†™ç˜¦èº«ã€‚AOFé‡å†™çš„åŸç†å°±æ˜¯ï¼Œ&lt;strong&gt;forkä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¯¹å†…å­˜è¿›è¡Œéå†ï¼Œç„¶åç”Ÿæˆä¸€ç³»åˆ—çš„RedisæŒ‡ä»¤ï¼Œç„¶ååºåˆ—åŒ–åˆ°ä¸€ä¸ªæ–°çš„aofæ–‡ä»¶ä¸­ã€‚ç„¶åå†å°†éå†å†…å­˜é˜¶æ®µçš„å¢é‡æ—¥å¿—ï¼Œè¿½åŠ åˆ°æ–°çš„aofæ–‡ä»¶ä¸­ï¼Œè¿½åŠ å®Œæˆåç«‹å³æ›¿æ¢æ—§çš„aofæ–‡ä»¶ï¼Œè¿™æ ·å°±å®Œæˆäº†AOFçš„ç˜¦èº«é‡å†™&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&quot;fsync&quot;&gt;fsync&lt;/h4&gt;
&lt;p&gt;å› ä¸ºAOFæ˜¯ä¸€ä¸ªå†™æ–‡ä»¶çš„IOæ“ä½œï¼Œæ˜¯æ¯”è¾ƒè€—æ—¶ã€‚æ‰€ä»¥AOFæ—¥å¿—å¹¶ä¸æ˜¯ç›´æ¥å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶çš„ï¼Œè€Œæ˜¯å…ˆå†™åˆ°ä¸€ä¸ªå†…æ ¸çš„ç¼“å­˜ä¸­ï¼Œç„¶åé€šè¿‡å¼‚æ­¥åˆ·è„ï¼Œæ¥å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜çš„ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºè¿™ä¸ªæƒ…å†µï¼Œå°±å¯¼è‡´äº†ä¼šæœ‰è¿˜æ²¡æ¥å¾—æ€¥åˆ·è„ç„¶åå°±å®•æœºäº†ï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥Redisæä¾›äº†ä¸€ä¸ªé…ç½®ï¼Œå¯ä»¥æ‰‹åŠ¨çš„æ¥é€‰æ‹©åˆ·è„çš„é¢‘ç‡ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;mark&gt;&lt;strong&gt;always&lt;/strong&gt;&lt;/mark&gt;ï¼šæ¯ä¸€æ¡AOFè®°å½•éƒ½ç«‹å³åŒæ­¥åˆ°æ–‡ä»¶ï¼Œæ€§èƒ½å¾ˆä½ï¼Œä½†è¾ƒä¸ºå®‰å…¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;mark&gt;&lt;strong&gt;everysec&lt;/strong&gt;&lt;/mark&gt;ï¼š&lt;strong&gt;æ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œæ€§èƒ½å’Œå®‰å…¨éƒ½æ¯”è¾ƒä¸­åº¸çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯redisæ¨èçš„æ–¹å¼ã€‚å¦‚æœé‡åˆ°ç‰©ç†æœåŠ¡å™¨æ•…éšœï¼Œå¯èƒ½å¯¼è‡´æœ€å¤š1ç§’çš„AOFè®°å½•ä¸¢å¤±ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;mark&gt;&lt;strong&gt;no&lt;/strong&gt;&lt;/mark&gt;ï¼šRedisæ°¸ä¸ç›´æ¥è°ƒç”¨æ–‡ä»¶åŒæ­¥ï¼Œè€Œæ˜¯è®©æ“ä½œç³»ç»Ÿæ¥å†³å®šä½•æ—¶åŒæ­¥ç£ç›˜ã€‚æ€§èƒ½è¾ƒå¥½ï¼Œä½†å¾ˆä¸å®‰å…¨ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;AOFé»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰‹åŠ¨å¼€å¯ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-bash&quot;&gt;# åªæœ‰åœ¨â€œyesâ€ä¸‹ï¼Œaofé‡å†™/æ–‡ä»¶åŒæ­¥ç­‰ç‰¹æ€§æ‰ä¼šç”Ÿæ•ˆ  
appendonly yes  
## æŒ‡å®šaofæ–‡ä»¶åç§°  
appendfilename appendonly.aof  
## æŒ‡å®šaofæ“ä½œä¸­æ–‡ä»¶åŒæ­¥ç­–ç•¥ï¼Œæœ‰ä¸‰ä¸ªåˆæ³•å€¼ï¼šalways everysec no,é»˜è®¤ä¸ºeverysec  
appendfsync everysec 
## åœ¨aof-rewriteæœŸé—´ï¼Œappendfsyncæ˜¯å¦æš‚ç¼“æ–‡ä»¶åŒæ­¥ï¼Œ&quot;no&quot;è¡¨ç¤ºâ€œä¸æš‚ç¼“â€ï¼Œâ€œyesâ€è¡¨ç¤ºâ€œæš‚ç¼“â€ï¼Œé»˜è®¤ä¸ºâ€œnoâ€  
no-appendfsync-on-rewrite no  
## aofæ–‡ä»¶rewriteè§¦å‘çš„æœ€å°æ–‡ä»¶å°ºå¯¸(mb,gb),åªæœ‰å¤§äºæ­¤aofæ–‡ä»¶å¤§äºæ­¤å°ºå¯¸æ˜¯æ‰ä¼šè§¦å‘rewriteï¼Œé»˜è®¤â€œ64mbâ€ï¼Œå»ºè®®â€œ512mbâ€  
auto-aof-rewrite-min-size 64mb 
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;redis40æ··åˆæŒä¹…åŒ–&quot;&gt;Redis4.0æ··åˆæŒä¹…åŒ–&lt;/h3&gt;
&lt;p&gt;Redis4.0æä¾›äº†ä¸€ç§æ–°çš„æŒä¹…åŒ–æœºåˆ¶ï¼Œå°±æ˜¯RDBå’ŒAOFç»“åˆä½¿ç”¨ï¼Œå°†rdbæ–‡ä»¶å†…å®¹å’Œaofæ–‡ä»¶å­˜åœ¨ä¸€èµ·ï¼ŒAOFä¸­ä¿å­˜çš„ä¸å†æ˜¯å…¨éƒ¨æ•°æ®äº†ï¼Œè€Œæ˜¯ä»RDBå¼€å§‹çš„åˆ°ç»“æŸçš„å¢é‡æ—¥å¿—ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·åœ¨Redisæ¢å¤æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆå‡è£…RDBæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œç„¶ååœ¨é¡ºåºæ‰§è¡ŒAOFæ—¥å¿—ä¸­æŒ‡ä»¤ï¼Œè¿™æ ·å°±å°†Redisé‡å¯æ—¶æ¢å¤æ•°æ®çš„æ•ˆç‡å¾—åˆ°äº†å¤§å¹…åº¦æå‡ã€‚&lt;/p&gt;
&lt;h2 id=&quot;ç»“å°¾&quot;&gt;ç»“å°¾&lt;/h2&gt;
&lt;p&gt;æ©ï¼Œè¿™æ¬¡å°±å…ˆæ€»ç»“åˆ°è¿™é‡Œå§ï¼Œåé¢ä¼šç»§ç»­æ€»ç»“Redisç›¸å…³çŸ¥è¯†ï¼ŒLRUã€LFUã€å†…å­˜æ·˜æ±°ç­–ç•¥ï¼Œç®¡é“ç­‰ç­‰ã€‚&lt;/p&gt;
</description>
<pubDate>Wed, 30 Dec 2020 00:32:00 +0000</pubDate>
<dc:creator>çºªè«</dc:creator>
<og:description>å‰è¨€ ä½œä¸ºJavaç¨‹åºå‘˜ï¼Œåœ¨é¢è¯•è¿‡ç¨‹ä¸­ï¼Œç¼“å­˜ç›¸å…³çš„é—®é¢˜æ˜¯èº²ä¸æ‰çš„ï¼Œè‚¯å®šä¼šé—®ï¼Œä¾‹å¦‚ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Œç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€ç­‰ã€‚è¯´åˆ°ç¼“å­˜ï¼Œé‚£è‚¯å®šå°‘ä¸äº†Redisï¼Œæˆ‘åœ¨é¢è¯•çš„æ—¶å€™ä¹Ÿæ˜¯è¢«é—®äº†å¾ˆå¤šå…³äºRedisç›¸å…³</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/jimoer/p/14204650.html</dc:identifier>
</item>
<item>
<title>å¿«é€Ÿæ²ƒå°”ä»€å˜æ¢ (FWT)å­¦ä¹ ç¬”è®° - liuchanglc</title>
<link>http://www.cnblogs.com/liuchanglc/p/14209640.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/liuchanglc/p/14209640.html</guid>
<description>&lt;p&gt;è¯æ˜å‡æ¥è‡ª&lt;a href=&quot;https://www.luogu.com.cn/blog/xht37/solution-p4717&quot; target=&quot;_blank&quot;&gt;xht37 çš„æ´›è°·åšå®¢&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;ä½œç”¨&quot;&gt;ä½œç”¨&lt;/h2&gt;
&lt;p&gt;åœ¨ &lt;span class=&quot;math inline&quot;&gt;\(OI\)&lt;/span&gt; ä¸­ï¼Œ&lt;span class=&quot;math inline&quot;&gt;\(FWT\)&lt;/span&gt; æ˜¯ç”¨äºè§£å†³å¯¹ä¸‹æ ‡è¿›è¡Œä½è¿ç®—å·ç§¯é—®é¢˜çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math inline&quot;&gt;\(c_{i}=\sum_{i=j \oplus k} a_{j} b_{k}\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ &lt;span class=&quot;math inline&quot;&gt;\(\oplus\)&lt;/span&gt; æ˜¯äºŒå…ƒä½è¿ç®—ä¸­çš„ä¸€ç§ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å®ç°&quot;&gt;å®ç°&lt;/h2&gt;
&lt;h3 id=&quot;è¿ç®—&quot;&gt;&lt;span class=&quot;math inline&quot;&gt;\(or\)&lt;/span&gt; è¿ç®—&lt;/h3&gt;
&lt;p&gt;æ„é€  &lt;span class=&quot;math inline&quot;&gt;\(fwt[a]_i = \sum_{j|i=i} a_j\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;åˆ™&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math inline&quot;&gt;\(\begin{aligned} fwt[a] \times fwt[b] &amp;amp;= \left(\sum_{j|i=i} a_j\right)\left(\sum_{k|i=i} b_k\right) \\\\ &amp;amp;= \sum_{j|i=i} \sum_{k|i=i} a_jb_k \\\\ &amp;amp;= \sum_{(j|k)|i = i} a_jb_k \\\\ &amp;amp;= fwt[c] \end{aligned}\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ä» &lt;span class=&quot;math inline&quot;&gt;\([a]\)&lt;/span&gt; åˆ° &lt;span class=&quot;math inline&quot;&gt;\(fwt[a]\)&lt;/span&gt; å¯ä»¥åˆ†æ²»è§£å†³&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä»å°åˆ°å¤§ä¾æ¬¡æšä¸¾é•¿åº¦ä¸º &lt;span class=&quot;math inline&quot;&gt;\(2^i\)&lt;/span&gt; çš„åŒºé—´&lt;/p&gt;
&lt;p&gt;è®¾æœ€é«˜ä½ä¸ºç¬¬ &lt;span class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; ä½&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶æˆ‘ä»¬å·²ç»æ±‚å‡ºäº†å‰ &lt;span class=&quot;math inline&quot;&gt;\(i-1\)&lt;/span&gt; ä½çš„è´¡çŒ®&lt;/p&gt;
&lt;p&gt;å¹¶ä¸”åŒºé—´çš„å·¦åŠéƒ¨åˆ†æœ€é«˜ä½ä¸Šçš„æ•°å­—ä¸º &lt;span class=&quot;math inline&quot;&gt;\(0\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;åŒºé—´çš„å³åŠéƒ¨åˆ†æœ€é«˜ä½ä¸Šçš„æ•°å­—ä¸º &lt;span class=&quot;math inline&quot;&gt;\(1\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºå·¦è¾¹çš„è¿™äº›æ•°ï¼Œå³è¾¹çš„æ•°æ˜¾ç„¶ä¸å¯èƒ½æ˜¯å·¦è¾¹çš„æ•°çš„å­é›†&lt;/p&gt;
&lt;p&gt;åªèƒ½ç”±è‡ªå·± &lt;span class=&quot;math inline&quot;&gt;\(i-1\)&lt;/span&gt; ä½çš„è´¡çŒ®è½¬ç§»è¿‡æ¥&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å·¦è¾¹çš„æ•°ä¼šç»™ç›¸åº”ä½ç½®çš„å³è¾¹çš„æ•°åšå‡ºè´¡çŒ®&lt;/p&gt;
&lt;p&gt;å› æ­¤æˆ‘ä»¬åœ¨è¿›è¡Œå˜æ¢çš„æ—¶å€™è¦æŠŠè¿™ä¸ªè´¡çŒ®åŠ ä¸Š&lt;/p&gt;
&lt;p&gt;åŒæ ·åœ¨è¿›è¡Œé€†å˜æ¢çš„æ—¶å€™ç›¸åº”åœ°å‡å»å³å¯&lt;/p&gt;
&lt;h4 id=&quot;ä»£ç &quot;&gt;ä»£ç &lt;/h4&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;void fwtor(rg int A[],rg int typ){
        for(rg int k=1,o=2;o&amp;lt;=mmax;k&amp;lt;&amp;lt;=1,o&amp;lt;&amp;lt;=1){
                for(rg int j=0;j&amp;lt;mmax;j+=o){
                        for(rg int i=0;i&amp;lt;k;i++){
                                A[i+j+k]+=typ*A[i+j];
                                A[i+j+k]=getmod(A[i+j+k]);
                        }
                }
        }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;è¿ç®—-1&quot;&gt;&lt;span class=&quot;math inline&quot;&gt;\(and\)&lt;/span&gt; è¿ç®—&lt;/h3&gt;
&lt;p&gt;å’Œ &lt;span class=&quot;math inline&quot;&gt;\(or\)&lt;/span&gt; è¿ç®—åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯è¿™æ¬¡å˜æˆäº†å³åŒºé—´å¯¹å·¦åŒºé—´æœ‰è´¡çŒ®&lt;/p&gt;
&lt;h4 id=&quot;ä»£ç -1&quot;&gt;ä»£ç &lt;/h4&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;void fwtand(rg int A[],rg int typ){
        for(rg int k=1,o=2;o&amp;lt;=mmax;k&amp;lt;&amp;lt;=1,o&amp;lt;&amp;lt;=1){
                for(rg int j=0;j&amp;lt;mmax;j+=o){
                        for(rg int i=0;i&amp;lt;k;i++){
                                A[i+j]+=typ*A[i+j+k];
                                A[i+j]=getmod(A[i+j]);
                        }
                }
        }
}

&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;è¿ç®—-2&quot;&gt;&lt;span class=&quot;math inline&quot;&gt;\(xor\)&lt;/span&gt; è¿ç®—&lt;/h3&gt;
&lt;p&gt;è¿™ç§è¿ç®—æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºä¸å†æ˜¯ç®€å•çš„å­é›†çš„å…³ç³»äº†&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥ç”¨ä»¥ä¸Šä¸¤ç§è¿ç®—çš„æ€æƒ³&lt;/p&gt;
&lt;p&gt;å®šä¹‰ &lt;span class=&quot;math inline&quot;&gt;\(x\otimes y=\text{popcount}(x \&amp;amp; y) \bmod 2\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ &lt;span class=&quot;math inline&quot;&gt;\(\text{popcount}\)&lt;/span&gt; è¡¨ç¤ºã€ŒäºŒè¿›åˆ¶ä¸‹ &lt;span class=&quot;math inline&quot;&gt;\(1\)&lt;/span&gt; çš„ä¸ªæ•°ã€&lt;/p&gt;
&lt;p&gt;æ»¡è¶³ &lt;span class=&quot;math inline&quot;&gt;\((i \otimes j) \operatorname{xor} (i \otimes k) = i \otimes (j \operatorname{xor} k)\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;æ„é€  &lt;span class=&quot;math inline&quot;&gt;\(fwt[a]_i = \sum_{i\otimes j = 0} a_j - \sum_{i\otimes j = 1} a_j\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;åˆ™æœ‰&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math inline&quot;&gt;\(\begin{aligned} fwt[a] \times fwt[b] &amp;amp;= \left(\sum_{i\otimes j = 0} a_j - \sum_{i\otimes j = 1} a_j\right)\left(\sum_{i\otimes k = 0} b_k - \sum_{i\otimes k = 1} b_k\right) \\ &amp;amp;=\left(\sum_{i\otimes j=0}a_j\right)\left(\sum_{i\otimes k=0}b_k\right)-\left(\sum_{i\otimes j=0}a_j\right)\left(\sum_{i\otimes k=1}b_k\right)-\left(\sum_{i\otimes j=1}a_j\right)\left(\sum_{i\otimes k=0}b_k\right)+\left(\sum_{i\otimes j=1}a_j\right)\left(\sum_{i\otimes k=1}b_k\right) \\ &amp;amp;=\sum_{i\otimes(j \operatorname{xor} k)=0}a_jb_k-\sum_{i\otimes(j\operatorname{xor} k)=1}a_jb_k \\ &amp;amp;= fwt[c] \end{aligned} \)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å½“æœ€é«˜ä½æ˜¯ &lt;span class=&quot;math inline&quot;&gt;\(0\)&lt;/span&gt; æ—¶ï¼Œå› ä¸º &lt;span class=&quot;math inline&quot;&gt;\(0\&amp;amp;1=0\)&lt;/span&gt;ï¼Œ&lt;span class=&quot;math inline&quot;&gt;\(0\&amp;amp;0=0\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;äºŒè¿›åˆ¶ä¸‹ &lt;span class=&quot;math inline&quot;&gt;\(1\)&lt;/span&gt; çš„ä¸ªæ•°ä¸å˜&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å·¦è¾¹åŒºé—´çš„ä»·å€¼åº”ä¸ºåªè€ƒè™‘å‰ &lt;span class=&quot;math inline&quot;&gt;\(i-1\)&lt;/span&gt; ä½æ—¶å·¦è¾¹åŒºé—´çš„ä»·å€¼åŠ ä¸Šåªè€ƒè™‘å‰ &lt;span class=&quot;math inline&quot;&gt;\(i-1\)&lt;/span&gt; ä½æ—¶å³è¾¹åŒºé—´çš„ä»·å€¼&lt;/p&gt;
&lt;p&gt;è€Œå¯¹äºå³è¾¹åŒºé—´ï¼Œå½“ &lt;span class=&quot;math inline&quot;&gt;\(1\&amp;amp;1=1\)&lt;/span&gt; æ—¶ï¼ŒäºŒè¿›åˆ¶ä¸‹ä¸€çš„ä¸ªæ•°ä¼šå‘ç”Ÿå˜åŒ–&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥åº”è¯¥æ˜¯åªè€ƒè™‘å‰ &lt;span class=&quot;math inline&quot;&gt;\(i-1\)&lt;/span&gt; ä½æ—¶å·¦è¾¹åŒºé—´çš„ä»·å€¼å‡å»åªè€ƒè™‘å‰ &lt;span class=&quot;math inline&quot;&gt;\(i-1\)&lt;/span&gt; ä½æ—¶å³è¾¹åŒºé—´çš„ä»·å€¼&lt;/p&gt;
&lt;p&gt;é€†å˜æ¢å°±æ˜¯åè¿™æ¥ï¼Œä¹˜ä¸Š &lt;span class=&quot;math inline&quot;&gt;\(\frac{1}{2}\)&lt;/span&gt; å³å¯&lt;/p&gt;
&lt;h4 id=&quot;ä»£ç -2&quot;&gt;ä»£ç &lt;/h4&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;void fwtxor(rg int A[],rg int typ){
        for(rg int k=1,o=2;o&amp;lt;=mmax;k&amp;lt;&amp;lt;=1,o&amp;lt;&amp;lt;=1){
                for(rg int j=0;j&amp;lt;mmax;j+=o){
                        for(rg int i=0;i&amp;lt;k;i++){
                                rg int x=1LL*A[i+j]*typ%mod,y=1LL*A[i+j+k]*typ%mod;
                                A[i+j]=getmod(x+y);
                                A[i+j+k]=getmod(x-y);
                        }
                }
        }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;é¢˜ç›®&quot;&gt;é¢˜ç›®&lt;/h2&gt;
&lt;h3 id=&quot;p5366-snoi2017é—å¤±çš„ç­”æ¡ˆ&quot;&gt;P5366 [SNOI2017]é—å¤±çš„ç­”æ¡ˆ&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://www.luogu.com.cn/problem/P5366&quot; target=&quot;_blank&quot;&gt;é¢˜ç›®ä¼ é€é—¨&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;åˆ†æ&quot;&gt;åˆ†æ&lt;/h3&gt;
&lt;p&gt;å…ˆç‰¹åˆ¤æ‰ &lt;span class=&quot;math inline&quot;&gt;\(G\)&lt;/span&gt; ä¸èƒ½æ•´é™¤ &lt;span class=&quot;math inline&quot;&gt;\(L\)&lt;/span&gt; çš„æƒ…å†µ&lt;/p&gt;
&lt;p&gt;ç„¶åæŠŠ &lt;span class=&quot;math inline&quot;&gt;\(L\)&lt;/span&gt; å’Œ &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; åŒæ—¶é™¤ä»¥ &lt;span class=&quot;math inline&quot;&gt;\(G\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ ·é—®é¢˜å°±è½¬åŒ–ä¸ºäº†åœ¨ &lt;span class=&quot;math inline&quot;&gt;\(1\)&lt;/span&gt; åˆ° &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; ä¸­é€‰æ‹©ä¸€äº›æ•°&lt;/p&gt;
&lt;p&gt;ä½¿å¾—ä»–ä»¬çš„æœ€å¤§å…¬å› æ•°ä¸º &lt;span class=&quot;math inline&quot;&gt;\(1\)&lt;/span&gt;ï¼Œæœ€å°å…¬å€æ•°ä¸º &lt;span class=&quot;math inline&quot;&gt;\(L\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å°† &lt;span class=&quot;math inline&quot;&gt;\(L\)&lt;/span&gt; è¿›è¡Œè´¨å› æ•°åˆ†è§£ï¼Œè®¾ &lt;span class=&quot;math inline&quot;&gt;\(L=p_1^{a_1}p_2^{a_2}...p_n^{a_n}\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœè¦æ»¡è¶³æ¡ä»¶&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå¯¹äºä»»æ„ä¸€ä¸ªè´¨å› æ•° &lt;span class=&quot;math inline&quot;&gt;\(p_i\)&lt;/span&gt; ï¼Œé€‰æ‹©çš„æ•°ä¸­å¿…é¡»è‡³å°‘å­˜åœ¨ä¸€ä¸ªæ•°ï¼Œä½¿å¾—å®ƒåˆ†è§£è´¨å› æ•°å &lt;span class=&quot;math inline&quot;&gt;\(p_i\)&lt;/span&gt; çš„æŒ‡æ•°ç­‰äº &lt;span class=&quot;math inline&quot;&gt;\(a_i\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;åŒç†ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªè´¨å› æ•° &lt;span class=&quot;math inline&quot;&gt;\(p_i\)&lt;/span&gt; ï¼Œé€‰æ‹©çš„æ•°ä¸­å¿…é¡»è‡³å°‘å­˜åœ¨ä¸€ä¸ªæ•°ï¼Œä¸å«æœ‰ &lt;span class=&quot;math inline&quot;&gt;\(p_i\)&lt;/span&gt; è¿™ä¸ªè´¨å› æ•°&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªæ¡ä»¶å¯ä»¥çœ‹åšæ˜¯å¦æ»¡è¶³ä¸Šç•Œï¼Œç¬¬äºŒä¸ªæ¡ä»¶å¯ä»¥çœ‹ä½œæ˜¯å¦æ»¡è¶³ä¸‹ç•Œ&lt;/p&gt;
&lt;p&gt;å› ä¸º &lt;span class=&quot;math inline&quot;&gt;\(L\)&lt;/span&gt; å°äºç­‰äº &lt;span class=&quot;math inline&quot;&gt;\(10^{8}\)&lt;/span&gt;ï¼Œæ‰€ä»¥æœ€å¤šå«æœ‰ &lt;span class=&quot;math inline&quot;&gt;\(8\)&lt;/span&gt; ä¸ªä¸åŒçš„è´¨å› æ•°&lt;/p&gt;
&lt;p&gt;å› æ­¤å¯ä»¥çŠ¶å‹&lt;/p&gt;
&lt;p&gt;è®¾ &lt;span class=&quot;math inline&quot;&gt;\(11\)&lt;/span&gt; è¡¨ç¤ºåŒæ—¶æ»¡è¶³ä¸Šç•Œå’Œä¸‹ç•Œï¼Œ&lt;span class=&quot;math inline&quot;&gt;\(10\)&lt;/span&gt; è¡¨ç¤ºåªæ»¡è¶³ä¸Šç•Œï¼Œ&lt;span class=&quot;math inline&quot;&gt;\(01\)&lt;/span&gt; è¡¨ç¤ºåªæ»¡è¶³ä¸‹ç•Œï¼Œ&lt;span class=&quot;math inline&quot;&gt;\(00\)&lt;/span&gt; è¡¨ç¤ºä¸Šç•Œå’Œä¸‹ç•Œéƒ½ä¸æ»¡è¶³&lt;/p&gt;
&lt;p&gt;æ˜¾ç„¶æ»¡è¶³æ¡ä»¶çš„åªèƒ½æ˜¯ &lt;span class=&quot;math inline&quot;&gt;\(L\)&lt;/span&gt; çš„å› æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ &lt;span class=&quot;math inline&quot;&gt;\(L\)&lt;/span&gt; çš„æ‰€æœ‰å› æ•°éƒ½ç­›å‡ºæ¥&lt;/p&gt;
&lt;p&gt;ç„¶åæ±‚å‡ºè¿™äº›å› æ•°æ‰€ä»£è¡¨çš„çŠ¶æ€&lt;/p&gt;
&lt;p&gt;å› æ•°ä¸ä¼šå¤ªå¤šï¼Œæœ€å¤šåªæœ‰ &lt;span class=&quot;math inline&quot;&gt;\(768\)&lt;/span&gt; ä¸ª&lt;/p&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰å¿…é¡»é€‰æ‹© &lt;span class=&quot;math inline&quot;&gt;\(x\)&lt;/span&gt; çš„é™åˆ¶ï¼Œé‚£ä¹ˆç›´æ¥è®¾ &lt;span class=&quot;math inline&quot;&gt;\(f[i][j]\)&lt;/span&gt; è¡¨ç¤ºè€ƒè™‘å‰ &lt;span class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; ä¸ªæ•°ï¼ŒçŠ¶æ€ä¸º &lt;span class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt; çš„æ–¹æ¡ˆæ•°è¿›è¡Œ &lt;span class=&quot;math inline&quot;&gt;\(dp\)&lt;/span&gt; å³å¯&lt;/p&gt;
&lt;p&gt;å¦‚æœè€ƒè™‘ &lt;span class=&quot;math inline&quot;&gt;\(x\)&lt;/span&gt; çš„é™åˆ¶ï¼Œæˆ‘ä»¬å°±éœ€è¦ç»´æŠ¤ä¸€ä¸ªå‰ç¼€ &lt;span class=&quot;math inline&quot;&gt;\(dp\)&lt;/span&gt; æ•°ç»„ &lt;span class=&quot;math inline&quot;&gt;\(pre\)&lt;/span&gt; å’Œåç¼€ &lt;span class=&quot;math inline&quot;&gt;\(dp\)&lt;/span&gt; æ•°ç»„ &lt;span class=&quot;math inline&quot;&gt;\(suf\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å¯¹äºç¬¬ &lt;span class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; ä¸ªæ•°ï¼Œæˆ‘ä»¬æŠŠ &lt;span class=&quot;math inline&quot;&gt;\(pre[i-1]\)&lt;/span&gt; å’Œ &lt;span class=&quot;math inline&quot;&gt;\(suf[i+1]\)&lt;/span&gt; è¿›è¡Œæˆ–è¿ç®—å·ç§¯&lt;/p&gt;
&lt;p&gt;æœ€ååªè¦ç¬¬ &lt;span class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; ä¸ªæ•°çš„çŠ¶æ€ä¸æŸä¸ªçŠ¶æ€è¿›è¡Œæˆ–è¿ç®—ç­‰äºå…¨é›†&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå°±å¯ä»¥ç´¯åŠ è¿™ä¸ªçŠ¶æ€çš„ç­”æ¡ˆ&lt;/p&gt;
&lt;h3 id=&quot;ä»£ç -3&quot;&gt;ä»£ç &lt;/h3&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;#include&amp;lt;cstdio&amp;gt;
#include&amp;lt;cmath&amp;gt;
#include&amp;lt;cstring&amp;gt;
#include&amp;lt;algorithm&amp;gt;
#define rg register
inline int read(){
        rg int x=0,fh=1;
        rg char ch=getchar();
        while(ch&amp;lt;'0' || ch&amp;gt;'9'){
                if(ch=='-') fh=-1;
                ch=getchar();
        }
        while(ch&amp;gt;='0' &amp;amp;&amp;amp; ch&amp;lt;='9'){
                x=(x&amp;lt;&amp;lt;1)+(x&amp;lt;&amp;lt;3)+(ch^48);
                ch=getchar();
        }
        return x*fh;
}
const int mod=1e9+7,maxn=70005,maxm=1005;
int n,g,l,q,x,mmax;
int getmod(rg int now){
        return now&amp;gt;=mod?now-mod:now&amp;lt;0?now+mod:now;
}
void fwtor(rg int A[],rg int typ){
        for(rg int o=2,k=1;o&amp;lt;=mmax;o&amp;lt;&amp;lt;=1,k&amp;lt;&amp;lt;=1){
                for(rg int i=0;i&amp;lt;mmax;i+=o){
                        for(rg int j=0;j&amp;lt;k;j++){
                                A[i+j+k]+=A[i+j]*typ;
                                A[i+j+k]=getmod(A[i+j+k]);
                        }
                }
        }
}
int pri[maxn],mi[maxn];
void divid(rg int now){
        rg int m=sqrt(now),ncnt=0;
        for(rg int i=2;i&amp;lt;=m;i++){
                if(now%i==0){
                        ncnt=0;
                        pri[++pri[0]]=i;
                        while(now%i==0){
                                now/=i;
                                ncnt++;
                        }
                        mi[pri[0]]=ncnt;
                }
        }
        if(now&amp;gt;1){
                pri[++pri[0]]=now;
                mi[pri[0]]=1;
        }
}
int sta[maxn],tp,zt[maxn];
void getit(){
        rg int m=sqrt(l);
        for(rg int i=1;i&amp;lt;=m;i++){
                if(l%i==0){
                        if(i&amp;lt;=n) sta[++tp]=i;
                        if(i*i!=l &amp;amp;&amp;amp; l/i&amp;lt;=n) sta[++tp]=l/i;
                }
        }
}
int pre[maxm][maxn],suf[maxm][maxn],tmp[maxn],ans[maxn];
int getzt(rg int now){
        rg int zt0=0,zt1=0;
        for(rg int i=1;i&amp;lt;=pri[0];i++){
                rg int ncnt=0;
                while(now%pri[i]==0){
                        now/=pri[i];
                        ncnt++;
                }
                if(ncnt==0) zt0|=(1&amp;lt;&amp;lt;(i-1));
                else if(ncnt==mi[i]) zt1|=(1&amp;lt;&amp;lt;(i-1));
        }
        return zt0|(zt1&amp;lt;&amp;lt;pri[0]);
}
int main(){
        n=read(),g=read(),l=read(),q=read();
        if(l%g){
                for(rg int i=1;i&amp;lt;=q;i++){
                        x=read();
                        printf(&quot;0\n&quot;);
                }
        } else {
                l/=g,n/=g;
                divid(l);
                mmax=1&amp;lt;&amp;lt;(2*pri[0]);
                getit();
                std::sort(sta+1,sta+1+tp);
                for(rg int i=1;i&amp;lt;=tp;i++) zt[i]=getzt(sta[i]);
                pre[0][0]=suf[tp+1][0]=1;
                for(rg int i=1;i&amp;lt;=tp;i++){
                        memcpy(pre[i],pre[i-1],sizeof(pre[i-1]));
                        for(rg int j=0;j&amp;lt;mmax;j++){
                                pre[i][j|zt[i]]=getmod(pre[i][j|zt[i]]+pre[i-1][j]);
                        }
                }
                for(rg int i=tp;i&amp;gt;=1;i--){
                        memcpy(suf[i],suf[i+1],sizeof(suf[i+1]));
                        for(rg int j=0;j&amp;lt;mmax;j++){
                                suf[i][j|zt[i]]=getmod(suf[i][j|zt[i]]+suf[i+1][j]);
                        }
                }
                for(rg int i=0;i&amp;lt;=tp+1;i++){
                        fwtor(pre[i],1);
                        fwtor(suf[i],1);
                }
                for(rg int i=1;i&amp;lt;=tp;i++){
                        for(rg int j=0;j&amp;lt;mmax;j++){
                                tmp[j]=1LL*pre[i-1][j]*suf[i+1][j]%mod;
                        }
                        fwtor(tmp,-1);
                        for(rg int j=0;j&amp;lt;mmax;j++){
                                if((zt[i]|j)==mmax-1) ans[i]=getmod(ans[i]+tmp[j]);
                        }
                }
                for(rg int i=1;i&amp;lt;=q;i++){
                        x=read();
                        if(x%g) printf(&quot;0\n&quot;);
                        else {
                                x/=g;
                                if(l%x) printf(&quot;0\n&quot;);
                                else {
                                        rg int wz=std::lower_bound(sta+1,sta+1+tp,x)-sta;
                                        printf(&quot;%d\n&quot;,ans[wz]);
                                }
                        }
                }
        }
        return 0;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;p3175-haoi2015æŒ‰ä½æˆ–&quot;&gt;P3175 [HAOI2015]æŒ‰ä½æˆ–&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://www.luogu.com.cn/problem/P3175&quot; target=&quot;_blank&quot;&gt;é¢˜ç›®ä¼ é€é—¨&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;åˆ†æ-1&quot;&gt;åˆ†æ&lt;/h3&gt;
&lt;p&gt;è¦ç”¨åˆ° &lt;span class=&quot;math inline&quot;&gt;\(min\)&lt;/span&gt;âˆ’&lt;span class=&quot;math inline&quot;&gt;\(max\)&lt;/span&gt; å®¹æ–¥&lt;/p&gt;
&lt;p&gt;ä¸ä¼šçš„å¯ä»¥çœ‹æˆ‘çš„&lt;a href=&quot;https://www.cnblogs.com/liuchanglc/p/13858476.html&quot; target=&quot;_blank&quot;&gt;å®¹æ–¥åŸç†å­¦ä¹ ç¬”è®°&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;$max(S)=\sum_{T\subseteq S}(-1)^{|T|+1}min(T) $&lt;/p&gt;
&lt;p&gt;$min(S)=\sum_{T\subseteq S}(-1)^{|T|+1}max(T) $&lt;/p&gt;
&lt;p&gt;è®¾ &lt;span class=&quot;math inline&quot;&gt;\(max(S)\)&lt;/span&gt; ä¸º &lt;span class=&quot;math inline&quot;&gt;\(S\)&lt;/span&gt; ä¸­æœ€æ™šçš„å…ƒç´ å‡ºç°çš„æœŸæœ›æ¬¡æ•°&lt;/p&gt;
&lt;p&gt;è®¾ &lt;span class=&quot;math inline&quot;&gt;\(min(S)\)&lt;/span&gt; ä¸º &lt;span class=&quot;math inline&quot;&gt;\(S\)&lt;/span&gt; ä¸­æœ€æ—©çš„å…ƒç´ å‡ºç°çš„æœŸæœ›æ¬¡æ•°&lt;/p&gt;
&lt;p&gt;é—®é¢˜è½¬æ¢ä¸ºå¦‚ä½•æ±‚ &lt;span class=&quot;math inline&quot;&gt;\(min(T)\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;è®¾ &lt;span class=&quot;math inline&quot;&gt;\(P=\sum\limits_{S\subseteq\complement_UT}P(S)\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math inline&quot;&gt;\(E(\min(T))=P\sum\limits^{+\infty}_{i=1}i(1-p)^{i-1}\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;æœ‰è¾¹æ˜¯ä¸€ä¸ªç­‰æ¯”æ•°åˆ—ä¹˜ç­‰å·®æ•°åˆ—çš„æ±‚å’Œå…¬å¼&lt;/p&gt;
&lt;p&gt;åŒ–ç®€ä¹‹åæ˜¯&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math inline&quot;&gt;\(\frac{1-(1-P)^n}{P^2}-\frac{n(1-P)^n}{P}\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å½“ &lt;span class=&quot;math inline&quot;&gt;\(n\)&lt;/span&gt; è¶‹è¿›äºæ— ç©·å¤§æ—¶&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math inline&quot;&gt;\((1-P)^n\)&lt;/span&gt; è¶‹è¿›äº &lt;span class=&quot;math inline&quot;&gt;\(0\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å› æ­¤æœ€ç»ˆçš„ç»“æœæ˜¯ &lt;span class=&quot;math inline&quot;&gt;\(\frac{1}{P^2}\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å†ä¹˜ä¸Šå¤–é¢çš„ä¸€ä¸ª &lt;span class=&quot;math inline&quot;&gt;\(P\)&lt;/span&gt;ï¼Œå°±æ˜¯ &lt;span class=&quot;math inline&quot;&gt;\(\frac{1}{P}\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å‰©ä¸‹çš„å†ç”¨ä¸€ä¸ªæˆ–è¿ç®—å·ç§¯å³å¯&lt;/p&gt;
&lt;h3 id=&quot;ä»£ç -4&quot;&gt;ä»£ç &lt;/h3&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;#include&amp;lt;cstdio&amp;gt;
#include&amp;lt;iostream&amp;gt;
#include&amp;lt;cmath&amp;gt;
#include&amp;lt;cstring&amp;gt;
#define rg register
inline int read(){
        rg int x=0,fh=1;
        rg char ch=getchar();
        while(ch&amp;lt;'0' || ch&amp;gt;'9'){
                if(ch=='-') fh=-1;
                ch=getchar();
        }
        while(ch&amp;gt;='0' &amp;amp;&amp;amp; ch&amp;lt;='9'){
                x=(x&amp;lt;&amp;lt;1)+(x&amp;lt;&amp;lt;3)+(ch^48);
                ch=getchar();
        }
        return x*fh;
}
const int maxn=2e6+5,mod=998244353;
const double eps=1e-10;
int n,mmax,siz[maxn];
double a[maxn];
void fwtor(rg double A[],rg int typ){
        for(rg int i=1;i&amp;lt;=n;i++){
                for(rg int j=0;j&amp;lt;mmax;j+=(1&amp;lt;&amp;lt;i)){
                        for(rg int k=0;k&amp;lt;1&amp;lt;&amp;lt;(i-1);k++){
                                A[j|(1&amp;lt;&amp;lt;(i-1))|k]+=A[j|k]*typ;
                        }
                }
        }
}
int main(){
        n=read();
        mmax=1&amp;lt;&amp;lt;n;
        for(rg int i=0;i&amp;lt;mmax;i++){
                scanf(&quot;%lf&quot;,&amp;amp;a[i]);
        }
        fwtor(a,1);
        for(rg int i=0;i&amp;lt;mmax;i++){
                siz[i]=siz[i&amp;gt;&amp;gt;1]+(i&amp;amp;1);
        }
        rg double nans=0;
        for(rg int i=1;i&amp;lt;mmax;i++){
                if(1.0-a[(mmax-1)^i]&amp;lt;eps){
                        printf(&quot;INF\n&quot;);
                        return 0;
                }
                nans+=((siz[i]&amp;amp;1)?(1.0):(-1.0))/(1.0-a[(mmax-1)^i]);
        }
        printf(&quot;%.8f\n&quot;,nans);
        return 0;
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;p5643-pkuwc2018éšæœºæ¸¸èµ°&quot;&gt;P5643 [PKUWC2018]éšæœºæ¸¸èµ°&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://www.luogu.com.cn/problem/P5643&quot; target=&quot;_blank&quot;&gt;é¢˜ç›®ä¼ é€é—¨&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;åˆ†æ-2&quot;&gt;åˆ†æ&lt;/h3&gt;
&lt;p&gt;åŒæ ·æ˜¯ &lt;span class=&quot;math inline&quot;&gt;\(min\)&lt;/span&gt;-&lt;span class=&quot;math inline&quot;&gt;\(max\)&lt;/span&gt; å®¹æ–¥ï¼Œå…ˆæ±‚å‡ºè‡³å°‘ç»è¿‡ä¸€ä¸ªç‚¹çš„æœŸæœ›æ­¥æ•°&lt;/p&gt;
&lt;p&gt;ç„¶åå†æ±‚å‡ºå…¨éƒ¨ç»è¿‡çš„æœŸæœ›æ­¥æ•°&lt;/p&gt;
&lt;p&gt;$max(S)=\sum_{T\subseteq S}(-1)^{|T|+1}min(T) $&lt;/p&gt;
&lt;p&gt;è®¾ &lt;span class=&quot;math inline&quot;&gt;\(f_i\)&lt;/span&gt; è¡¨ç¤ºä» &lt;span class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; å‡ºå‘ï¼Œç»è¿‡ &lt;span class=&quot;math inline&quot;&gt;\(S\)&lt;/span&gt; ä¸­çš„è‡³å°‘ä¸€ä¸ªç‚¹çš„æœŸæœ›æ­¥æ•°&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math inline&quot;&gt;\(deg_i\)&lt;/span&gt; ä¸ºç‚¹ &lt;span class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; çš„åº¦æ•°ï¼Œ&lt;span class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt; ä¸º &lt;span class=&quot;math inline&quot;&gt;\(i\)&lt;/span&gt; çš„å„¿å­èŠ‚ç‚¹&lt;/p&gt;
&lt;p&gt;å¯ä»¥å¾—åˆ°è¿™æ ·çš„é€’æ¨å¼ï¼š&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math inline&quot;&gt;\(f_i=\frac1{deg_i}(f_{fa_i}+\sum f_j)+1\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;è®¾ &lt;span class=&quot;math inline&quot;&gt;\(f_i=k_if_{fa_i}+b_i\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;åŒ–ç®€ä¹‹åå¯ä»¥å¾—åˆ°&lt;/p&gt;
&lt;p&gt;$f_i=\frac1{deg_i-\sum k_j}f_{fa_i}+\frac{deg_i+\sum b_j}{deg_i-\sum k_j} $&lt;/p&gt;
&lt;p&gt;å³&lt;/p&gt;
&lt;p&gt;$k_i=\frac 1{deg_i-\sum k_j},b_i=\frac{deg_i+\sum b_j}{deg_i-\sum k_j} $&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªä¸œè¥¿å¯ä»¥ &lt;span class=&quot;math inline&quot;&gt;\(dfs\)&lt;/span&gt; æ±‚å‡ºæ¥&lt;/p&gt;
&lt;p&gt;ç„¶åå°±å¯ä»¥ç”¨æˆ–è¿ç®—å·ç§¯åˆå¹¶é¢„å¤„ç†å‡ºæ¯ä¸€ä¸ªé›†åˆçš„ç­”æ¡ˆ&lt;/p&gt;
&lt;h3 id=&quot;ä»£ç -5&quot;&gt;ä»£ç &lt;/h3&gt;
&lt;pre&gt;
&lt;code class=&quot;language-cpp&quot;&gt;#include&amp;lt;cstdio&amp;gt;
#include&amp;lt;iostream&amp;gt;
#include&amp;lt;cmath&amp;gt;
#include&amp;lt;cstring&amp;gt;
#define rg register
inline int read(){
        rg int x=0,fh=1;
        rg char ch=getchar();
        while(ch&amp;lt;'0' || ch&amp;gt;'9'){
                if(ch=='-') fh=-1;
                ch=getchar();
        }
        while(ch&amp;gt;='0' &amp;amp;&amp;amp; ch&amp;lt;='9'){
                x=(x&amp;lt;&amp;lt;1)+(x&amp;lt;&amp;lt;3)+(ch^48);
                ch=getchar();
        }
        return x*fh;
}
const int maxn=1e6+5,maxm=25,mod=998244353;
int n,q,x,mmax,h[maxm],k[maxm],a[maxm],tot=1,du[maxm],ans[maxn],siz[maxn];
int ksm(rg int ds,rg int zs){
        rg int nans=1;
        while(zs){
                if(zs&amp;amp;1) nans=1LL*nans*ds%mod;
                ds=1LL*ds*ds%mod;
                zs&amp;gt;&amp;gt;=1;
        }
        return nans;
}
struct asd{
        int to,nxt;
}b[maxm&amp;lt;&amp;lt;1];
void ad(rg int aa,rg int bb){
        b[tot].to=bb;
        b[tot].nxt=h[aa];
        h[aa]=tot++;
}
int getmod(rg int now){
        return (now&amp;gt;=mod)?(now-mod):((now&amp;lt;0)?(now+mod):now);
}
void fwtor(rg int A[],rg int typ){
        for(rg int o=2,k=1;o&amp;lt;=mmax;o&amp;lt;&amp;lt;=1,k&amp;lt;&amp;lt;=1){
                for(rg int i=0;i&amp;lt;mmax;i+=o){
                        for(rg int j=0;j&amp;lt;k;j++){
                                A[i+j+k]+=A[i+j]*typ;
                                A[i+j+k]=getmod(A[i+j+k]);
                        }
                }
        }
}
void dfs(rg int now,rg int lat,rg int zt){
        if(zt&amp;amp;(1&amp;lt;&amp;lt;(now-1))) return;
        rg int ans1=0,ans2=0;
        for(rg int i=h[now];i!=-1;i=b[i].nxt){
                rg int u=b[i].to;
                if(u==lat) continue;
                dfs(u,now,zt);
                ans1+=k[u];
                ans2+=a[u];
                ans1=getmod(ans1);
                ans2=getmod(ans2);
        }
        k[now]=ksm(getmod(du[now]-ans1),mod-2);
        a[now]=1LL*k[now]*getmod(du[now]+ans2)%mod;
}
int main(){
        memset(h,-1,sizeof(h));
        n=read(),q=read(),x=read();
        rg int aa,bb,cc;
        for(rg int i=1;i&amp;lt;n;i++){
                aa=read(),bb=read();
                ad(aa,bb);
                ad(bb,aa);
                du[aa]++,du[bb]++;
        }
        mmax=1&amp;lt;&amp;lt;n;
        for(rg int i=0;i&amp;lt;mmax;i++) siz[i]=siz[i&amp;gt;&amp;gt;1]+(i&amp;amp;1);
        for(rg int i=0;i&amp;lt;mmax;i++){
                memset(k,0,sizeof(k));
                memset(a,0,sizeof(a));
                dfs(x,0,i);
                ans[i]=a[x]*((siz[i]&amp;amp;1)?1:(-1));
                ans[i]=getmod(ans[i]);
        }
        fwtor(ans,1);
        for(rg int i=1;i&amp;lt;=q;i++){
                aa=read();
                cc=0;
                for(rg int j=1;j&amp;lt;=aa;j++){
                        bb=read();
                        cc|=(1&amp;lt;&amp;lt;(bb-1));
                }
                printf(&quot;%d\n&quot;,ans[cc]);
        }
        return 0;
}
&lt;/code&gt;
&lt;/pre&gt;</description>
<pubDate>Wed, 30 Dec 2020 00:28:00 +0000</pubDate>
<dc:creator>liuchanglc</dc:creator>
<og:description>è¯æ˜å‡æ¥è‡ªxht37 çš„æ´›è°·åšå®¢ ä½œç”¨ åœ¨ \(OI\) ä¸­ï¼Œ\(FWT\) æ˜¯ç”¨äºè§£å†³å¯¹ä¸‹æ ‡è¿›è¡Œä½è¿ç®—å·ç§¯é—®é¢˜çš„æ–¹æ³•ã€‚ \(c_{i}=\sum_{i=j \oplus k} a_{j} b_{k}</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/liuchanglc/p/14209640.html</dc:identifier>
</item>
<item>
<title>Node.jsèº¬è¡Œè®°ï¼ˆ5ï¼‰â€”â€”å®šæ—¶ä»»åŠ¡çš„è°ƒè¯• - å’–å•¡æœºï¼ˆK.F.Jï¼‰</title>
<link>http://www.cnblogs.com/strick/p/14185714.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/strick/p/14185714.html</guid>
<description>&lt;p&gt;ã€€ã€€æœ€è¿‘åšä¸€ä¸ªæ´»åŠ¨ï¼Œéœ€è¦ç”¨åˆ°å®šæ—¶ä»»åŠ¡ï¼Œäºæ˜¯ä½¿ç”¨äº†Â &lt;span&gt;&lt;a href=&quot;https://github.com/node-schedule/node-schedule&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;node-schedule&lt;/span&gt;&lt;/a&gt;&lt;/span&gt; åº“ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ç”¨æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯å¯é…ç½®å¼€å§‹ã€ç»“æŸæ—¶é—´ï¼Œä»¥åŠé‡å¤æ‰§è¡Œçš„æ—¶é—´ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œä»2020-12-23T09:00:00Zå¼€å§‹ï¼Œæ¯10åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œç›´è‡³2020-12-23T09:30:30Zç»“æŸã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;schedule.scheduleJob({ 
  start: &lt;/span&gt;'2020-12-23T09:00:00Z'&lt;span&gt;, 
  end: &lt;/span&gt;'2020-12-23T09:30:30Z'&lt;span&gt;, 
  rule: &lt;/span&gt;'* */10 * * * *'&lt;span&gt; 
}, test);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ã€€ã€€å¦‚æœæ˜¯éœ€è¦åœ¨æœªæ¥æŸä¸ªæ—¶é—´æ®µæ‰§è¡Œçš„å®šæ—¶ä»»åŠ¡ï¼Œé‚£ä¹ˆè¦è¿˜åŸçœŸå®åœºæ™¯ï¼Œå°±å¾—ä¿®æ”¹æœåŠ¡å™¨æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€æµ‹è¯•ç¯å¢ƒè™½ç„¶å¯ä»¥æ”¹æ—¶é—´ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™è¾¹æ˜¯å‡ ä¸ªç»„å…±ç”¨å‡ å°æœåŠ¡å™¨ï¼Œä¿®æ”¹äº†æ—¶é—´åï¼Œå¯èƒ½ä¼šå½±å“å…¶ä»–ç»„çš„ä¸šåŠ¡ï¼Œå¹¶ä¸”æ­£å¼ç¯å¢ƒçš„æ—¶é—´æ˜¯ä¸èƒ½ä¿®æ”¹çš„ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä¸€å¼€å§‹æµ‹è¯•çš„æ—¶å€™ï¼Œæ”¹è¿‡å‡ æ¬¡æ—¶é—´ï¼Œæ”¹æ—¶é—´æ¯•ç«Ÿå¤ªç¹çï¼Œæ¯æ¬¡ä»£ç å‘å¸ƒï¼ŒæœåŠ¡å™¨çš„æ—¶é—´å°±åˆä¼šé‡ç½®ï¼Œåˆè¦ä¿®æ­£ä¸€æ¬¡ï¼Œè¿˜æ”¶åˆ°äº†å…¶ä»–ç»„çš„æŠ•è¯‰ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€åé¢å°±æ”¹æˆä»Šå¤©çš„æ—¶é—´æ®µï¼Œè¿™æ¬¡çš„å®šæ—¶ä»»åŠ¡çš„æ—¶é—´æ®µæœ‰7ä¸ªï¼Œæ¯æ¬¡ä¿®æ”¹å¥½åï¼Œå°±è¦æäº¤ä¸€éä»£ç ï¼Œç„¶ååˆå¹¶åˆ†æ”¯ï¼Œæœ€åå‘å¸ƒä¸€ä¸‹ä»£ç ï¼ŒæœåŠ¡ä¹Ÿä¼šé‡æ–°å¯åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€è¿™ç§çº¯æ‰‹å·¥æ–¹å¼è¿‡äºè´¹æ—¶ï¼Œåé¢æƒ³åˆ°å¯ä»¥åœ¨åå°åšä¸ªé€šç”¨é…ç½®ï¼ˆä¸‹å›¾æ˜¯ä¸ªé…ç½®åˆ—è¡¨ï¼‰ï¼Œå°†è¿™äº›å¸¸é‡ï¼ˆä¾‹å¦‚æ—¶é—´å‚æ•°ï¼‰å­˜åœ¨æ•°æ®åº“ï¼ˆä¾‹å¦‚MongoDBæˆ–MySQLï¼‰ä¸­ï¼Œå¯éšæ—¶è¯»å†™ã€‚&lt;/p&gt;
&lt;p&gt;Â ã€€ã€€&lt;img src=&quot;https://img2020.cnblogs.com/blog/211606/202012/211606-20201225110712813-1920678763.png&quot; width=&quot;800&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä¸‹å›¾æ˜¯ä¸ªå¢å’Œæ”¹çš„å¼¹æ¡†ï¼Œåœ¨æ–°å¢çš„æ—¶å€™éœ€è¦æ ¼å¼åŒ–å¤šè¡Œæ–‡æœ¬ä¸­çš„JSONæ•°æ®ï¼Œå…ˆç”¨ eval()ï¼Œå†ç”¨JSON.stringify()ï¼Œè¿™æ ·çš„è¯åœ¨è°ƒç”¨JSON.parse()çš„æ—¶å€™å°±ä¸ä¼šå‡ºé”™ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
JSON.stringify(eval(`(${values.content})`))
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€&lt;img src=&quot;https://img2020.cnblogs.com/blog/211606/202012/211606-20201225111030125-1152467946.png&quot; width=&quot;400&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä¸ºäº†è®©JSONæ•°æ®çš„å±•ç¤ºæ›´å‹å¥½ï¼Œå°±éœ€è¦æ ¼å¼åŒ–æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¦æœ‰ç©ºæ ¼ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
JSON.stringify(JSON.parse(record.content), &lt;span&gt;null&lt;/span&gt;, 2)
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ã€€ã€€åœ¨æµ‹è¯•ç¯å¢ƒæˆ–æ­£å¼ç¯å¢ƒï¼Œå¦‚æœå®šæ—¶ä»»åŠ¡å¤„ç†çš„æ•°æ®é”™è¯¯äº†ï¼Œé‚£ä¹ˆåªèƒ½é€šè¿‡æ—¥å¿—æ¥æ’æŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€è€Œä¸€å°è·‘ç€çš„æœåŠ¡å™¨ä¸­ä¼šæœ‰å¾ˆå¤šå…¶ä»–çš„å®šæ—¶ä»»åŠ¡ï¼Œåœ¨æµ‹è¯•ç¯å¢ƒä¸­ï¼Œä¸ºäº†èƒ½çœ‹æ¸…æ¥šæ—¥å¿—ï¼Œå¯ä»¥åªè¿è¡Œä¸€ä¸ªä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä½†æ˜¯åœ¨æ­£å¼ç¯å¢ƒä¸­ï¼Œæ˜¯ä¸èƒ½åœæ­¢ä»»åŠ¡çš„ï¼Œåƒç›®å‰è¿è¡Œçš„å®šæ—¶ä»»åŠ¡ï¼Œå¯èƒ½å‡ ç§’å†…å°±æœ‰å‡ ç™¾è¡Œçš„æ—¥å¿—ï¼Œç”¨è‚‰çœ¼è§‚å¯Ÿæœ‰ç‚¹ç´¯ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€å¥½åœ¨æˆ‘ä»¬è¿™è¾¹æ¥å…¥äº†é˜¿é‡Œäº‘çš„æ—¥å¿—æœåŠ¡ï¼Œå¯ä»¥æŸ¥çœ‹æ—¥å¿—æ§åˆ¶å°ï¼Œé‡Œé¢æœ‰ä¸°å¯Œçš„æŸ¥è¯¢è¿‡æ»¤æ¡ä»¶ï¼Œå¯ä»¥å‡†ç¡®çš„å®šä½åˆ°æŸæ¡æ—¥å¿—ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€&lt;img src=&quot;https://img2020.cnblogs.com/blog/211606/202012/211606-20201225111244963-978980070.png&quot; width=&quot;800&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€å¦‚æœä½ æœ‰æ›´å¥½çš„è°ƒè¯•æ–¹æ³•ï¼Œæ¬¢è¿ç•™è¨€è®¨è®ºã€‚&lt;/p&gt;

&lt;p&gt;ã€€ã€€åœ¨çº¿ä¸Šè¿è¡Œçš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå› ä¸ºè¿™ä¸ªé‚£ä¸ªçš„é—®é¢˜å¯¼è‡´ä»»åŠ¡æ²¡æœ‰åœ¨æŒ‡å®šæ—¶é—´è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€é‚£ä¹ˆå°±å¾—å¼€æ”¾ä¸€ä¸ªå…¥å£ï¼Œæ¥æ‰‹åŠ¨æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯å†™ä¸ªä¸´æ—¶æ¥å£ï¼Œç„¶åç”¨postmanæ‰‹åŠ¨è®¿é—®ï¼Œä¸è¿‡è¿™æ ·çš„è¯å¯¹è¿è¥ä¸å¤ªå‹å¥½ï¼Œæ¯•ç«Ÿè¿è¥ä¼šæœ‰äººåŠå¤œå€¼ç­ç›¯ç€æ´»åŠ¨ï¼Œä½†å¼€å‘äººå‘˜æ˜¯ä¸ä¼šåŠå¤œè¿˜ç›¯ç€æœåŠ¡å™¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€äºæ˜¯åˆå¿«é€Ÿæ­äº†ä¸ªåå°æ‰§è¡Œé¡µé¢ï¼Œæœ‰ä¸ªä¸‹æ‹‰æ¡†å¯é€‰æ‹©ä»»åŠ¡æ—¶é—´æ®µï¼Œè¿˜æœ‰ä¸ªè¿è¡ŒæŒ‰é’®ï¼Œåˆ°æ—¶å€™å‡ºé—®é¢˜çš„è¯ï¼Œå°±æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€&lt;img src=&quot;https://img2020.cnblogs.com/blog/211606/202012/211606-20201225113549272-925835210.png&quot; width=&quot;400&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

</description>
<pubDate>Wed, 30 Dec 2020 00:05:00 +0000</pubDate>
<dc:creator>å’–å•¡æœºï¼ˆK.F.Jï¼‰</dc:creator>
<og:description>æœ€è¿‘åšä¸€ä¸ªæ´»åŠ¨ï¼Œéœ€è¦ç”¨åˆ°å®šæ—¶ä»»åŠ¡ï¼Œäºæ˜¯ä½¿ç”¨äº†&amp;#160;node-schedule åº“ã€‚ ç”¨æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯å¯é…ç½®å¼€å§‹ã€ç»“æŸæ—¶é—´ï¼Œä»¥åŠé‡å¤æ‰§è¡Œçš„æ—¶é—´ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œä»2020-12-23T09:00:00</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/strick/p/14185714.html</dc:identifier>
</item>
<item>
<title>æµ…è°ˆIATåŠ å¯†åŸç†åŠè¿‡ç¨‹ - __é˜¿é˜¿é˜¿æ€ª</title>
<link>http://www.cnblogs.com/aaaguai/p/14207468.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/aaaguai/p/14207468.html</guid>
<description>&lt;pre&gt;
&lt;span&gt;   1&lt;/span&gt; #include&amp;lt;iostream&amp;gt;
&lt;span&gt;   2&lt;/span&gt; #include&amp;lt;Windows.h&amp;gt;
&lt;span&gt;   3&lt;/span&gt; #include&amp;lt;map&amp;gt;
&lt;span&gt;   4&lt;/span&gt; #include&amp;lt;vector&amp;gt;
&lt;span&gt;   5&lt;/span&gt; #include &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Asmjit\\asmjit.h&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;
&lt;span&gt;   6&lt;/span&gt; 
&lt;span&gt;   7&lt;/span&gt; &lt;span&gt;using&lt;/span&gt; &lt;span&gt;namespace&lt;/span&gt;&lt;span&gt; std;
&lt;/span&gt;&lt;span&gt;   8&lt;/span&gt; &lt;span&gt;using&lt;/span&gt; &lt;span&gt;namespace&lt;/span&gt;&lt;span&gt; asmjit;
&lt;/span&gt;&lt;span&gt;   9&lt;/span&gt; &lt;span&gt;using&lt;/span&gt; &lt;span&gt;namespace&lt;/span&gt;&lt;span&gt; asmjit::x86;
&lt;/span&gt;&lt;span&gt;  10&lt;/span&gt; 
&lt;span&gt;  11&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; g_iFileSize = &lt;span&gt;0&lt;/span&gt;;        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ–‡ä»¶å¤§å°&lt;/span&gt;
&lt;span&gt;  12&lt;/span&gt; UCHAR *g_pFileSrc = NULL;  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ–‡ä»¶å†…å®¹  (æ­¤å¤„å¿…é¡»ä¸ºæ— ç¬¦å·å­—ç¬¦æŒ‡é’ˆï¼Œå› ä¸ºcharä¼šå°†åå…­è¿›åˆ¶çš„æœ€é«˜ä½é»˜è®¤ä¸ºç¬¦å·ä½)&lt;/span&gt;
&lt;span&gt;  13&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; g_iSectionAlignment = &lt;span&gt;0&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å†…å­˜å¯¹é½å¤§å°&lt;/span&gt;
&lt;span&gt;  14&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; g_iFileAlignment = &lt;span&gt;0&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ–‡ä»¶å¯¹é½å¤§å°&lt;/span&gt;
&lt;span&gt;  15&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; g_iImageBase = &lt;span&gt;0&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç¨‹åºåŸºå€&lt;/span&gt;
&lt;span&gt;  16&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; g_iNewOEP = &lt;span&gt;0&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ–°å…¥å£ç‚¹&lt;/span&gt;
&lt;span&gt;  17&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; g_iOldOEP = &lt;span&gt;0&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ—§å…¥å£ç‚¹&lt;/span&gt;
&lt;span&gt;  18&lt;/span&gt; 
&lt;span&gt;  19&lt;/span&gt; &lt;span&gt;struct&lt;/span&gt;&lt;span&gt; FuncTag
&lt;/span&gt;&lt;span&gt;  20&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt;  21&lt;/span&gt;     BYTE iFuncNameLenth;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å‡½æ•°åç§°é•¿åº¦&lt;/span&gt;
&lt;span&gt;  22&lt;/span&gt;     &lt;span&gt;char&lt;/span&gt; *&lt;span&gt;szFuncName;
&lt;/span&gt;&lt;span&gt;  23&lt;/span&gt; &lt;span&gt;};
&lt;/span&gt;&lt;span&gt;  24&lt;/span&gt; &lt;span&gt;struct&lt;/span&gt;&lt;span&gt; DLLFuncTag
&lt;/span&gt;&lt;span&gt;  25&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt;  26&lt;/span&gt;     &lt;span&gt;byte&lt;/span&gt; bDllNameLenth;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;DLLåé•¿åº¦&lt;/span&gt;
&lt;span&gt;  27&lt;/span&gt;     &lt;span&gt;char&lt;/span&gt; *&lt;span&gt;szDllName;
&lt;/span&gt;&lt;span&gt;  28&lt;/span&gt;     WORD wFuncNum;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰DLLçš„å‡½æ•°æ•°é‡&lt;/span&gt;
&lt;span&gt;  29&lt;/span&gt;     &lt;span&gt;byte&lt;/span&gt; bTab;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¯¼å…¥æ–¹å¼ï¼š0ä¸ºåºå·å¯¼å…¥ 1ä¸ºåç§°&lt;/span&gt;
&lt;span&gt;  30&lt;/span&gt;     vector&amp;lt;FuncTag&amp;gt;vFuncNAMEorNo;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ³¨æ„ï¼šæ­¤æ—¶çš„åºå·å·²ç»å»æ‰æœ€é«˜ä½&lt;/span&gt;
&lt;span&gt;  31&lt;/span&gt; &lt;span&gt;};
&lt;/span&gt;&lt;span&gt;  32&lt;/span&gt; vector&amp;lt;DLLFuncTag&amp;gt;g_tagDllFunc;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å­˜æ”¾IATä¿¡æ¯çš„ç»“æ„ä½“ï¼Œæˆå‘˜ä¸ºDLLåé•¿åº¦ï¼ŒDLLåï¼Œå‡½æ•°æ•°é‡ï¼Œæ ‡å¿—(æœ€é«˜ä½ä¸º1åˆ™æ˜¯åºå·ï¼Œå¦åˆ™ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²çš„åœ°å€)ï¼Œå‡½æ•°ååˆ—è¡¨
&lt;/span&gt;&lt;span&gt;  33&lt;/span&gt; 
&lt;span&gt;  34&lt;/span&gt; 
&lt;span&gt;  35&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å…ˆé€šè¿‡éå†è·å¾—ä¸‹é¢ç»“æ„ä½“ä¸­å„ä¸ªæˆå‘˜çš„å€¼  æ³¨ï¼šæˆå‘˜çš„ä½ç½®çš†ä¸ºRVA&lt;/span&gt;
&lt;span&gt;  36&lt;/span&gt; &lt;span&gt;/*&lt;/span&gt;
&lt;span&gt;  37&lt;/span&gt; &lt;span&gt;1.å°†dwRelocAddrè¿™4å­—èŠ‚çš„åœ°å€æ”¾å…¥é‡å®šä½è¡¨ä¸­ï¼Œä½¿å…¶åœ¨è¿è¡Œåè¯¥ä½ç½®çš„å€¼å˜ä¸ºç¨‹åºåŸºå€
&lt;/span&gt;&lt;span&gt;  38&lt;/span&gt; &lt;span&gt;2.å…ˆå»dwCallAddrçš„ä½ç½®ï¼Œå°†é‚£è¡Œä»£ç ä¿®æ”¹ä¸ºjmp dwJmpAddr(å¦‚æœæ˜¯mov eaxï¼Œåˆ™ç›´æ¥ä¿®æ”¹å³å¯ï¼Œå…¶ä»–çš„åˆ™è¦å¡«å……å¤šä¸€ä¸ªnop(0x90)ï¼Œä»¥ä¾¿å¯¹é½æŒ‡ä»¤é•¿åº¦)
&lt;/span&gt;&lt;span&gt;  39&lt;/span&gt; &lt;span&gt;3.æ‰§è¡Œshellcodeæ—¶ï¼Œä¼šå°†2çš„è°ƒç”¨åœ°å€+5/+6ä½œä¸ºè¿”å›åœ°å€å‹æ ˆ ï¼ˆjmpæŒ‡ä»¤é™¤å¤–ï¼‰
&lt;/span&gt;&lt;span&gt;  40&lt;/span&gt; &lt;span&gt;4.å°†NewLatAddrçš„å€¼ï¼ŒåŠ ä¸ŠåŸºå€åï¼Œåœ¨å¾—åˆ°çš„åœ°å€ä¸Šå–å€¼ï¼Œè¯¥åœ°å€ä¸Šçš„å€¼ä¸åŸIATæ‰€æŒ‡å‘çš„å€¼ç›¸åŒ
&lt;/span&gt;&lt;span&gt;  41&lt;/span&gt; &lt;span&gt;5.æ‰§è¡Œå®Œåï¼Œæ ¹æ®3å¾—åˆ°çš„å€¼ï¼Œè¿”å›åˆ°è°ƒç”¨æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ä¸Š
&lt;/span&gt;&lt;span&gt;  42&lt;/span&gt; &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;  43&lt;/span&gt; &lt;span&gt;struct&lt;/span&gt;&lt;span&gt; IatAddrTab
&lt;/span&gt;&lt;span&gt;  44&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt;  45&lt;/span&gt;     DWORD dwCallAddr;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä»¥ä¾¿åŒºåˆ†å½“å‰æ˜¯ä»€ä¹ˆç±»å‹ä¸‹ä½¿ç”¨äº†è¿™ä¸ªIATåœ°å€  æ³¨æ„ï¼Œè¿™é‡Œä¸ºæ•´ä¸ªè°ƒç”¨ä»£ç çš„ä½ç½®ï¼Œè€Œéè°ƒç”¨çš„ä»£ç çš„å‡½æ•°åœ°å€çš„ä½ç½®    &lt;/span&gt;
&lt;span&gt;  46&lt;/span&gt;     BYTE bType;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è¯¥è°ƒç”¨ç±»å‹ 0-7ä¸ºmov eaxã€edxã€espã€esiã€ecxã€ebxã€ebpã€edi  8ä¸ºcall 9ä¸ºjmp (å…¶ä¸­8å’Œ9å¯ä»¥å½’ç±»æˆä¸€ä¸ªå¤„ç†æ–¹å¼) 10ä¸ºpush  &lt;/span&gt;
&lt;span&gt;  47&lt;/span&gt;     DWORD dwRelocAddr;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç”¨äºæ·»åŠ åˆ°é‡å®šä½å—ä¸­ï¼Œè¯¥ä½ç½®å­˜æ”¾çš„ä¸ºåŸºå€&lt;/span&gt;
&lt;span&gt;  48&lt;/span&gt;     WORD wIndex;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰IATä½äºåŠ è½½è¡¨çš„ä¸‹æ ‡ æ¯ä¸ªåœ°å€å 4å­—èŠ‚&lt;/span&gt;
&lt;span&gt;  49&lt;/span&gt;     DWORD dwOldIatAddr;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;åŸIATåœ°å€&lt;/span&gt;
&lt;span&gt;  50&lt;/span&gt;     DWORD dwNewIatAddr;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°†è¦æ›¿æ¢æˆçš„æ–°IATåœ°å€&lt;/span&gt;
&lt;span&gt;  51&lt;/span&gt;     DWORD dwJmpAddr;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;shellcodeæ‰€åœ¨çš„èµ·å§‹ä½ç½®RVA     &lt;/span&gt;
&lt;span&gt;  52&lt;/span&gt; &lt;span&gt;};  
&lt;/span&gt;&lt;span&gt;  53&lt;/span&gt; vector&amp;lt;IatAddrTab&amp;gt;g_tagIAT;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å­˜æ”¾IATæ›¿æ¢åœ°å€çš„ç»“æ„ä½“ï¼Œæˆå‘˜ä¸ºIATåœ°å€ï¼Œä»¥åŠä¸€ä¸ªè°ƒç”¨åœ°å€ä½ç½®ï¼Œè¿˜æœ‰ä¸€ä¸ªè¯¥IATç±»å‹&lt;/span&gt;
&lt;span&gt;  54&lt;/span&gt; 
&lt;span&gt;  55&lt;/span&gt; 
&lt;span&gt;  56&lt;/span&gt; vector&amp;lt;DWORD&amp;gt;&lt;span&gt;g_IATaddrList;
&lt;/span&gt;&lt;span&gt;  57&lt;/span&gt; 
&lt;span&gt;  58&lt;/span&gt; &lt;span&gt;struct&lt;/span&gt;&lt;span&gt; tagRelocation
&lt;/span&gt;&lt;span&gt;  59&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt;  60&lt;/span&gt; &lt;span&gt;    DWORD wR_Head;
&lt;/span&gt;&lt;span&gt;  61&lt;/span&gt;     vector&amp;lt;WORD&amp;gt;&lt;span&gt;wR_Offset;
&lt;/span&gt;&lt;span&gt;  62&lt;/span&gt; &lt;span&gt;};
&lt;/span&gt;&lt;span&gt;  63&lt;/span&gt; vector&amp;lt;tagRelocation&amp;gt;&lt;span&gt;vOldReloction;
&lt;/span&gt;&lt;span&gt;  64&lt;/span&gt; 
&lt;span&gt;  65&lt;/span&gt; 
&lt;span&gt;  66&lt;/span&gt; VOID GetKernel32Base(X86Assembler &amp;amp;&lt;span&gt;a)
&lt;/span&gt;&lt;span&gt;  67&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt;  68&lt;/span&gt;     Label GetInfoBegin =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt;  69&lt;/span&gt;     Label cmpDllName =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt;  70&lt;/span&gt;     Label cmpChar =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt;  71&lt;/span&gt;     Label GetNextModule =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt;  72&lt;/span&gt;     Label GetBaseOver =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt;  73&lt;/span&gt; 
&lt;span&gt;  74&lt;/span&gt; &lt;span&gt;    a.push(ebx);
&lt;/span&gt;&lt;span&gt;  75&lt;/span&gt; &lt;span&gt;    a.push(ecx);
&lt;/span&gt;&lt;span&gt;  76&lt;/span&gt; &lt;span&gt;    a.push(edx);
&lt;/span&gt;&lt;span&gt;  77&lt;/span&gt; &lt;span&gt;    a.push(esi);
&lt;/span&gt;&lt;span&gt;  78&lt;/span&gt; &lt;span&gt;    a.push(edi);
&lt;/span&gt;&lt;span&gt;  79&lt;/span&gt; &lt;span&gt;    a.mov(edx, esp);
&lt;/span&gt;&lt;span&gt;  80&lt;/span&gt;     a.sub(esp, &lt;span&gt;0x18&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;  81&lt;/span&gt;     
&lt;span&gt;  82&lt;/span&gt;     a.mov(dword_ptr(esp, &lt;span&gt;0x00&lt;/span&gt;), &lt;span&gt;0x0065006B&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;  83&lt;/span&gt;     a.mov(dword_ptr(esp, &lt;span&gt;0x04&lt;/span&gt;), &lt;span&gt;0x006E0072&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;  84&lt;/span&gt;     a.mov(dword_ptr(esp, &lt;span&gt;0x08&lt;/span&gt;), &lt;span&gt;0x006C0065&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;  85&lt;/span&gt;     a.mov(dword_ptr(esp, &lt;span&gt;0x0C&lt;/span&gt;), &lt;span&gt;0x00320033&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;  86&lt;/span&gt;     a.mov(dword_ptr(esp, &lt;span&gt;0x10&lt;/span&gt;), &lt;span&gt;0x0064002E&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;  87&lt;/span&gt;     a.mov(dword_ptr(esp, &lt;span&gt;0x14&lt;/span&gt;), &lt;span&gt;0x006C006C&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;  88&lt;/span&gt; &lt;span&gt;    a.xor_(eax, eax);
&lt;/span&gt;&lt;span&gt;  89&lt;/span&gt;     a.mov(esi, dword_ptr_abs(&lt;span&gt;0x30&lt;/span&gt;).setSegment(fs));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å¾—PEB åŒç†mov esi,fs:[30]&lt;/span&gt;
&lt;span&gt;  90&lt;/span&gt;     a.mov(esi, dword_ptr(esi, &lt;span&gt;0x0C&lt;/span&gt;));            &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–åˆ°dllçš„åˆ—è¡¨æŒ‡é’ˆ&lt;/span&gt;
&lt;span&gt;  91&lt;/span&gt;     a.mov(esi, dword_ptr(esi, &lt;span&gt;0x1C&lt;/span&gt;));             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–åˆ°åˆå§‹åŒ–åºæ¨¡å—åŒ–&lt;/span&gt;
&lt;span&gt;  92&lt;/span&gt; 
&lt;span&gt;  93&lt;/span&gt;     a.bind(GetInfoBegin);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;éå†æ¨¡å—ä¿¡æ¯&lt;/span&gt;
&lt;span&gt;  94&lt;/span&gt;     a.mov(edi, dword_ptr(esi, &lt;span&gt;8&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–åˆ°å½“å‰æ¨¡å—åŸºå€&lt;/span&gt;
&lt;span&gt;  95&lt;/span&gt;     a.lea(ebx, dword_ptr(esi, &lt;span&gt;0x1c&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–åˆ°UNICODE STRINGç»“æ„&lt;/span&gt;
&lt;span&gt;  96&lt;/span&gt;     a.movzx(ecx, word_ptr(ebx));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–å‡ºé•¿åº¦&lt;/span&gt;
&lt;span&gt;  97&lt;/span&gt;     a.cmp (ecx, &lt;span&gt;24&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¯¹æ¯”é•¿åº¦&lt;/span&gt;
&lt;span&gt;  98&lt;/span&gt;     a.jne(GetNextModule);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¸ç­‰åˆ™è·å–ä¸‹ä¸€ä¸ªæ¨¡å—&lt;/span&gt;
&lt;span&gt;  99&lt;/span&gt;     a.mov(ebx, dword_ptr(ebx , &lt;span&gt;4&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–åˆ°å­—ç¬¦ä¸²åœ°å€  æ­¤æ—¶ebxä¸å†ä¸ºç»“æ„åœ°å€&lt;/span&gt;
&lt;span&gt; 100&lt;/span&gt;     a.mov(ecx, &lt;span&gt;0&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç”¨äºéå†&lt;/span&gt;
&lt;span&gt; 101&lt;/span&gt; 
&lt;span&gt; 102&lt;/span&gt;     a.bind(cmpDllName);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¯¹æ¯”æ¨¡å—åå­—&lt;/span&gt;
&lt;span&gt; 103&lt;/span&gt;     a.cmp(ecx, &lt;span&gt;24&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 104&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;éå†åˆ°å­—ç¬¦æœ«å°¾ æ‰¾åˆ°ç›®æ ‡æ¨¡å—(å…ˆå¯¹çš„é•¿åº¦å†å¯¹çš„å­—ç¬¦ï¼Œæ’é™¤äº†å‰é¢åŒååé¢A/Wçš„æƒ…å†µ)&lt;/span&gt;
&lt;span&gt; 105&lt;/span&gt;     a.jnl(GetBaseOver);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å–åŸºå€ç»“æŸ&lt;/span&gt;
&lt;span&gt; 106&lt;/span&gt;     a.xor_ (eax, eax);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ¸…ç©ºå®¹å™¨&lt;/span&gt;
&lt;span&gt; 107&lt;/span&gt; &lt;span&gt;    a.movzx(eax, word_ptr(ebx, ecx));
&lt;/span&gt;&lt;span&gt; 108&lt;/span&gt;     a.cmp(eax, &lt;span&gt;0x41&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¦‚æœæ˜¯å¤§å†™å­—ç¬¦(41~5A)èŒƒå›´å†…ï¼Œè½¬æˆå°å†™&lt;/span&gt;
&lt;span&gt; 109&lt;/span&gt; &lt;span&gt;    a.jna(cmpChar);
&lt;/span&gt;&lt;span&gt; 110&lt;/span&gt;     a.cmp(eax, &lt;span&gt;0x5A&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 111&lt;/span&gt; &lt;span&gt;    a.ja(cmpChar);
&lt;/span&gt;&lt;span&gt; 112&lt;/span&gt;     a.add(eax, &lt;span&gt;0x20&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¤§å†™å­—ç¬¦çš„å€¼+0x20å³è½¬æˆå°å†™å­—ç¬¦&lt;/span&gt;
&lt;span&gt; 113&lt;/span&gt;     
&lt;span&gt; 114&lt;/span&gt;     a.bind(cmpChar);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¯¹æ¯”æ¯ä¸ªå­—ç¬¦&lt;/span&gt;
&lt;span&gt; 115&lt;/span&gt;     a.cmp(ax, word_ptr(esp, ecx));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¯¹æ¯”å­—ç¬¦ä¸²å†…å®¹&lt;/span&gt;
&lt;span&gt; 116&lt;/span&gt;     a.jne(GetNextModule);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¸ç­‰åˆ™è·å–ä¸‹ä¸€ä¸ªæ¨¡å—&lt;/span&gt;
&lt;span&gt; 117&lt;/span&gt;     a.add(ecx, &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 118&lt;/span&gt; &lt;span&gt;    a.jmp(cmpDllName);
&lt;/span&gt;&lt;span&gt; 119&lt;/span&gt; 
&lt;span&gt; 120&lt;/span&gt;     a.bind(GetNextModule);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å¾—ä¸‹ä¸€ä¸ªæ¨¡å—ä¿¡æ¯&lt;/span&gt;
&lt;span&gt; 121&lt;/span&gt;     a.mov(esi, dword_ptr(esi));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–å¾—ä¸‹ä¸€ä¸ªåˆå§‹åŒ–æ¨¡å—&lt;/span&gt;
&lt;span&gt; 122&lt;/span&gt; &lt;span&gt;    a.test(esi, esi);
&lt;/span&gt;&lt;span&gt; 123&lt;/span&gt;     a.jnz(GetInfoBegin);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¸ä¸ºç©ºåˆ™ç»§ç»­éå†&lt;/span&gt;
&lt;span&gt; 124&lt;/span&gt; 
&lt;span&gt; 125&lt;/span&gt; &lt;span&gt;    a.bind(GetBaseOver);
&lt;/span&gt;&lt;span&gt; 126&lt;/span&gt; &lt;span&gt;    a.mov(eax, edi);
&lt;/span&gt;&lt;span&gt; 127&lt;/span&gt;     a.add(esp, &lt;span&gt;0x18&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 128&lt;/span&gt; &lt;span&gt;    a.pop(edi);
&lt;/span&gt;&lt;span&gt; 129&lt;/span&gt; &lt;span&gt;    a.pop(esi);
&lt;/span&gt;&lt;span&gt; 130&lt;/span&gt; &lt;span&gt;    a.pop(edx);
&lt;/span&gt;&lt;span&gt; 131&lt;/span&gt; &lt;span&gt;    a.pop(ecx);
&lt;/span&gt;&lt;span&gt; 132&lt;/span&gt; &lt;span&gt;    a.pop(ebx);
&lt;/span&gt;&lt;span&gt; 133&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 134&lt;/span&gt; 
&lt;span&gt; 135&lt;/span&gt; VOID GetLoadLibraryAAddr(X86Assembler &amp;amp;&lt;span&gt;a)
&lt;/span&gt;&lt;span&gt; 136&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt; 137&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·³è½¬æ ‡è®°&lt;/span&gt;
&lt;span&gt; 138&lt;/span&gt;     Label FindFuncAddr =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt; 139&lt;/span&gt;     Label FindFuncAddrOver =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt; 140&lt;/span&gt; 
&lt;span&gt; 141&lt;/span&gt; &lt;span&gt;    a.push(ebx);
&lt;/span&gt;&lt;span&gt; 142&lt;/span&gt; &lt;span&gt;    a.push(ecx);
&lt;/span&gt;&lt;span&gt; 143&lt;/span&gt; &lt;span&gt;    a.push(esi);
&lt;/span&gt;&lt;span&gt; 144&lt;/span&gt; &lt;span&gt;    a.push(ebp);
&lt;/span&gt;&lt;span&gt; 145&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è®°å¾—å¼€å§‹è·å–å‡ºæ¥çš„éƒ½æ˜¯RVA  è¦åŠ ä¸ŠDLLçš„åŸºå€ediæ¥å–å€¼&lt;/span&gt;
&lt;span&gt; 146&lt;/span&gt;     a.mov(eax, dword_ptr(edi, &lt;span&gt;0x3c&lt;/span&gt;&lt;span&gt;));
&lt;/span&gt;&lt;span&gt; 147&lt;/span&gt;     a.mov(ebx, dword_ptr(edi, eax, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;0x78&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;NTå¤´+0x78 = å¯¼å…¥è¡¨RVA
&lt;/span&gt;&lt;span&gt; 148&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¸Šé¢ç­‰ä»·äº[edi + eax + 0x78]ï¼Œå¦‚æœæ²¡æœ‰0çš„è¯ï¼Œä»–ä¼šæŠŠç¬¬ä¸‰ä¸ªå‚æ•°å½“æˆ2çš„Næ¬¡æ–¹å˜æˆäº†edi + eax * 2çš„0x78æ¬¡æ–¹&lt;/span&gt;
&lt;span&gt; 149&lt;/span&gt;     a.add(ebx, edi);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ebx=å¯¼å…¥è¡¨&lt;/span&gt;
&lt;span&gt; 150&lt;/span&gt;     a.mov(ecx, dword_ptr(ebx, &lt;span&gt;0x18&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ecx=æŒ‰åç§°å¯¼å‡ºä¸ªæ•°&lt;/span&gt;
&lt;span&gt; 151&lt;/span&gt;     a.mov(esi, dword_ptr(ebx, &lt;span&gt;0x20&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;esi=å¯¼å‡ºå‡½æ•°åç§°è¡¨rva&lt;/span&gt;
&lt;span&gt; 152&lt;/span&gt; &lt;span&gt;    a.add(esi, edi);
&lt;/span&gt;&lt;span&gt; 153&lt;/span&gt; 
&lt;span&gt; 154&lt;/span&gt; &lt;span&gt;    a.bind(FindFuncAddr);
&lt;/span&gt;&lt;span&gt; 155&lt;/span&gt;     a.sub(ecx, &lt;span&gt;1&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä»åé¢å¾€å‰éå† èƒ½å°‘å ç”¨ä¸€ä¸ªå¯„å­˜å™¨ï¼Œä½†è¦è®°å¾—å…ˆ-1å†éå†&lt;/span&gt;
&lt;span&gt; 156&lt;/span&gt;     a.jz(FindFuncAddrOver);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å‡åˆ°0å³éå†å®Œ&lt;/span&gt;
&lt;span&gt; 157&lt;/span&gt;     a.mov(ebp, dword_ptr(esi, ecx, &lt;span&gt;2&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–åˆ°å‡½æ•°åç§°æ¯”æ‹—æœ€åä¸€ä¸ªå‡½æ•°åçš„RVA ç­‰ä»·äº[esi,ecx*(2çš„næ¬¡æ–¹)]&lt;/span&gt;
&lt;span&gt; 158&lt;/span&gt; &lt;span&gt;    a.add(ebp, edi);
&lt;/span&gt;&lt;span&gt; 159&lt;/span&gt;     a.cmp(dword_ptr(ebp), &lt;span&gt;0x64616F4C&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 160&lt;/span&gt; &lt;span&gt;    a.jne(FindFuncAddr);
&lt;/span&gt;&lt;span&gt; 161&lt;/span&gt;     a.cmp(dword_ptr(ebp, &lt;span&gt;4&lt;/span&gt;), &lt;span&gt;0x7262694C&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 162&lt;/span&gt; &lt;span&gt;    a.jne(FindFuncAddr);
&lt;/span&gt;&lt;span&gt; 163&lt;/span&gt;     a.cmp(dword_ptr(ebp, &lt;span&gt;8&lt;/span&gt;), &lt;span&gt;0x41797261&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 164&lt;/span&gt; &lt;span&gt;    a.jne(FindFuncAddr);
&lt;/span&gt;&lt;span&gt; 165&lt;/span&gt;     a.cmp(byte_ptr(ebp, &lt;span&gt;12&lt;/span&gt;), &lt;span&gt;0&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç»“æŸç¬¦  é˜²æ­¢ç±»ä¼¼LoadLibraryå’ŒLoadLibraryAæ‰©å±•å‡½æ•°ååå·®å‡ºç°&lt;/span&gt;
&lt;span&gt; 166&lt;/span&gt; &lt;span&gt;    a.jne(FindFuncAddr);
&lt;/span&gt;&lt;span&gt; 167&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ­¤æ—¶ecxä¸ºéå†çš„ä¸‹æ ‡ &lt;/span&gt;
&lt;span&gt; 168&lt;/span&gt;     a.mov(esi, dword_ptr(ebx, &lt;span&gt;0x24&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;esi=å¯¼å‡ºå‡½æ•°åºå·è¡¨RVA(ä¸Šé¢åç§°å¯¹æ¯”å®Œ å›æ”¶esi)&lt;/span&gt;
&lt;span&gt; 169&lt;/span&gt; &lt;span&gt;    a.add(esi, edi);
&lt;/span&gt;&lt;span&gt; 170&lt;/span&gt;     a.movzx(ebp, word_ptr(esi, ecx, &lt;span&gt;1&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ebp=å‡½æ•°åºå· ebp=[esi+ecx*2ä¸€æ¬¡æ–¹]
&lt;/span&gt;&lt;span&gt; 171&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;EBP:Get=2b0 Load=3c2&lt;/span&gt;
&lt;span&gt; 172&lt;/span&gt;     a.mov(esi, dword_ptr(ebx, &lt;span&gt;0x1c&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;esi=å‡½æ•°åœ°å€è¡¨RVA&lt;/span&gt;
&lt;span&gt; 173&lt;/span&gt; &lt;span&gt;    a.add(esi, edi);
&lt;/span&gt;&lt;span&gt; 174&lt;/span&gt;     a.mov(eax, dword_ptr(esi, ebp, &lt;span&gt;2&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;åœ°å€=åœ°å€è¡¨+åºå·*2çš„2æ¬¡æ–¹&lt;/span&gt;
&lt;span&gt; 175&lt;/span&gt; &lt;span&gt;    a.add(eax, edi);
&lt;/span&gt;&lt;span&gt; 176&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ­¤æ—¶eaxä¸ºloadlibraryAåœ°å€&lt;/span&gt;
&lt;span&gt; 177&lt;/span&gt; &lt;span&gt;    a.bind(FindFuncAddrOver);
&lt;/span&gt;&lt;span&gt; 178&lt;/span&gt; &lt;span&gt;    a.pop(ebp);
&lt;/span&gt;&lt;span&gt; 179&lt;/span&gt; &lt;span&gt;    a.pop(esi);
&lt;/span&gt;&lt;span&gt; 180&lt;/span&gt; &lt;span&gt;    a.pop(ecx);
&lt;/span&gt;&lt;span&gt; 181&lt;/span&gt; &lt;span&gt;    a.pop(ebx);
&lt;/span&gt;&lt;span&gt; 182&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 183&lt;/span&gt; 
&lt;span&gt; 184&lt;/span&gt; VOID GetGetProcAddressAddr(X86Assembler &amp;amp;&lt;span&gt;a)
&lt;/span&gt;&lt;span&gt; 185&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt; 186&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·³è½¬æ ‡è®°&lt;/span&gt;
&lt;span&gt; 187&lt;/span&gt;     Label FindFuncAddr =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt; 188&lt;/span&gt;     Label FindFuncAddrOver =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt; 189&lt;/span&gt; 
&lt;span&gt; 190&lt;/span&gt; &lt;span&gt;    a.push(ebx);
&lt;/span&gt;&lt;span&gt; 191&lt;/span&gt; &lt;span&gt;    a.push(ecx);
&lt;/span&gt;&lt;span&gt; 192&lt;/span&gt; &lt;span&gt;    a.push(esi);
&lt;/span&gt;&lt;span&gt; 193&lt;/span&gt; &lt;span&gt;    a.push(ebp);
&lt;/span&gt;&lt;span&gt; 194&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è®°å¾—å¼€å§‹è·å–å‡ºæ¥çš„éƒ½æ˜¯RVA  è¦åŠ ä¸ŠDLLçš„åŸºå€ediæ¥å–å€¼&lt;/span&gt;
&lt;span&gt; 195&lt;/span&gt;     a.mov(eax, dword_ptr(edi, &lt;span&gt;0x3c&lt;/span&gt;&lt;span&gt;));
&lt;/span&gt;&lt;span&gt; 196&lt;/span&gt;     a.mov(ebx, dword_ptr(edi, eax, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;0x78&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;NTå¤´+0x78 = å¯¼å…¥è¡¨RVA
&lt;/span&gt;&lt;span&gt; 197&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¸Šé¢ç­‰ä»·äº[edi + eax + 0x78]ï¼Œå¦‚æœæ²¡æœ‰0çš„è¯ï¼Œä»–ä¼šæŠŠç¬¬ä¸‰ä¸ªå‚æ•°å½“æˆ2çš„Næ¬¡æ–¹å˜æˆäº†edi + eax * 2çš„0x78æ¬¡æ–¹&lt;/span&gt;
&lt;span&gt; 198&lt;/span&gt;     a.add(ebx, edi);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ebx=å¯¼å…¥è¡¨&lt;/span&gt;
&lt;span&gt; 199&lt;/span&gt;     a.mov(ecx, dword_ptr(ebx, &lt;span&gt;0x18&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ecx=æŒ‰åç§°å¯¼å‡ºä¸ªæ•°&lt;/span&gt;
&lt;span&gt; 200&lt;/span&gt;     a.mov(esi, dword_ptr(ebx, &lt;span&gt;0x20&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;esi=å¯¼å‡ºå‡½æ•°åç§°è¡¨rva&lt;/span&gt;
&lt;span&gt; 201&lt;/span&gt; &lt;span&gt;    a.add(esi, edi);
&lt;/span&gt;&lt;span&gt; 202&lt;/span&gt; 
&lt;span&gt; 203&lt;/span&gt; &lt;span&gt;    a.bind(FindFuncAddr);
&lt;/span&gt;&lt;span&gt; 204&lt;/span&gt;     a.sub(ecx, &lt;span&gt;1&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä»åé¢å¾€å‰éå† èƒ½å°‘å ç”¨ä¸€ä¸ªå¯„å­˜å™¨ï¼Œä½†è¦è®°å¾—å…ˆ-1å†éå†&lt;/span&gt;
&lt;span&gt; 205&lt;/span&gt;     a.jz(FindFuncAddrOver);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å‡åˆ°0å³éå†å®Œ&lt;/span&gt;
&lt;span&gt; 206&lt;/span&gt;     a.mov(ebp, dword_ptr(esi, ecx, &lt;span&gt;2&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–åˆ°å‡½æ•°åç§°æ¯”æ‹—æœ€åä¸€ä¸ªå‡½æ•°åçš„RVA ç­‰ä»·äº[esi,ecx*(2çš„næ¬¡æ–¹)]&lt;/span&gt;
&lt;span&gt; 207&lt;/span&gt; &lt;span&gt;    a.add(ebp, edi);
&lt;/span&gt;&lt;span&gt; 208&lt;/span&gt;     a.cmp(dword_ptr(ebp), &lt;span&gt;0x50746547&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 209&lt;/span&gt; &lt;span&gt;    a.jne(FindFuncAddr);
&lt;/span&gt;&lt;span&gt; 210&lt;/span&gt;     a.cmp(dword_ptr(ebp, &lt;span&gt;4&lt;/span&gt;), &lt;span&gt;0x41636f72&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 211&lt;/span&gt; &lt;span&gt;    a.jne(FindFuncAddr);
&lt;/span&gt;&lt;span&gt; 212&lt;/span&gt;     a.cmp(dword_ptr(ebp, &lt;span&gt;8&lt;/span&gt;), &lt;span&gt;0x65726464&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 213&lt;/span&gt; &lt;span&gt;    a.jne(FindFuncAddr);
&lt;/span&gt;&lt;span&gt; 214&lt;/span&gt;     a.cmp(word_ptr(ebp, &lt;span&gt;12&lt;/span&gt;), &lt;span&gt;0x7373&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 215&lt;/span&gt; &lt;span&gt;    a.jne(FindFuncAddr);
&lt;/span&gt;&lt;span&gt; 216&lt;/span&gt;     a.cmp(byte_ptr(ebp, &lt;span&gt;14&lt;/span&gt;), &lt;span&gt;0&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç»“æŸç¬¦  é˜²æ­¢ç±»ä¼¼LoadLibraryå’ŒLoadLibraryAæ‰©å±•å‡½æ•°ååå·®å‡ºç°&lt;/span&gt;
&lt;span&gt; 217&lt;/span&gt; &lt;span&gt;    a.jne(FindFuncAddr);
&lt;/span&gt;&lt;span&gt; 218&lt;/span&gt; 
&lt;span&gt; 219&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ­¤æ—¶ecxä¸ºéå†çš„ä¸‹æ ‡ &lt;/span&gt;
&lt;span&gt; 220&lt;/span&gt;     a.mov(esi, dword_ptr(ebx, &lt;span&gt;0x24&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;esi=å¯¼å‡ºå‡½æ•°åºå·è¡¨RVA(ä¸Šé¢åç§°å¯¹æ¯”å®Œ å›æ”¶esi)&lt;/span&gt;
&lt;span&gt; 221&lt;/span&gt; &lt;span&gt;    a.add(esi, edi);
&lt;/span&gt;&lt;span&gt; 222&lt;/span&gt;     a.movzx(ebp, word_ptr(esi, ecx, &lt;span&gt;1&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ebp=å‡½æ•°åºå· ebp=[esi+ecx*2ä¸€æ¬¡æ–¹]
&lt;/span&gt;&lt;span&gt; 223&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;EBP:Get=2b0 Load=3c2&lt;/span&gt;
&lt;span&gt; 224&lt;/span&gt;     a.mov(esi, dword_ptr(ebx, &lt;span&gt;0x1c&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;esi=å‡½æ•°åœ°å€è¡¨RVA&lt;/span&gt;
&lt;span&gt; 225&lt;/span&gt; &lt;span&gt;    a.add(esi, edi);
&lt;/span&gt;&lt;span&gt; 226&lt;/span&gt;     a.mov(eax, dword_ptr(esi, ebp, &lt;span&gt;2&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;åœ°å€=åœ°å€è¡¨+åºå·*2çš„2æ¬¡æ–¹&lt;/span&gt;
&lt;span&gt; 227&lt;/span&gt; &lt;span&gt;    a.add(eax, edi);
&lt;/span&gt;&lt;span&gt; 228&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ­¤æ—¶eaxä¸ºloadlibraryAåœ°å€&lt;/span&gt;
&lt;span&gt; 229&lt;/span&gt; &lt;span&gt;    a.bind(FindFuncAddrOver);
&lt;/span&gt;&lt;span&gt; 230&lt;/span&gt; &lt;span&gt;    a.pop(ebp);
&lt;/span&gt;&lt;span&gt; 231&lt;/span&gt; &lt;span&gt;    a.pop(esi);
&lt;/span&gt;&lt;span&gt; 232&lt;/span&gt; &lt;span&gt;    a.pop(ecx);
&lt;/span&gt;&lt;span&gt; 233&lt;/span&gt; &lt;span&gt;    a.pop(ebx);
&lt;/span&gt;&lt;span&gt; 234&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 235&lt;/span&gt; DWORD RVAtoFA(DWORD dwRVA)        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;RVAè½¬æ–‡ä»¶åœ°å€&lt;/span&gt;
&lt;span&gt; 236&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt; 237&lt;/span&gt;     PIMAGE_DOS_HEADER pDosHead =&lt;span&gt; PIMAGE_DOS_HEADER(g_pFileSrc);
&lt;/span&gt;&lt;span&gt; 238&lt;/span&gt;     PIMAGE_NT_HEADERS pNtHead = PIMAGE_NT_HEADERS((DWORD)pDosHead + pDosHead-&amp;gt;&lt;span&gt;e_lfanew);
&lt;/span&gt;&lt;span&gt; 239&lt;/span&gt;     PIMAGE_SECTION_HEADER pSection = (PIMAGE_SECTION_HEADER)(pNtHead-&amp;gt;FileHeader.SizeOfOptionalHeader + (DWORD)&amp;amp;pNtHead-&amp;gt;&lt;span&gt;OptionalHeader);
&lt;/span&gt;&lt;span&gt; 240&lt;/span&gt;     &lt;span&gt;int&lt;/span&gt; iSectionNum = pNtHead-&amp;gt;&lt;span&gt;FileHeader.NumberOfSections;
&lt;/span&gt;&lt;span&gt; 241&lt;/span&gt; 
&lt;span&gt; 242&lt;/span&gt;     &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; iSectionNum; i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 243&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 244&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (dwRVA &amp;gt;= pSection-&amp;gt;VirtualAddress &amp;amp;&amp;amp; dwRVA &amp;lt; (pSection-&amp;gt;VirtualAddress + pSection-&amp;gt;&lt;span&gt;Misc.VirtualSize))
&lt;/span&gt;&lt;span&gt; 245&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 246&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; (DWORD)g_pFileSrc + dwRVA - pSection-&amp;gt;VirtualAddress + pSection-&amp;gt;&lt;span&gt;PointerToRawData;
&lt;/span&gt;&lt;span&gt; 247&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 248&lt;/span&gt;         pSection++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 249&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 250&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è½¬æ¢å¤±è´¥&lt;/span&gt;
&lt;span&gt; 251&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 252&lt;/span&gt; 
&lt;span&gt; 253&lt;/span&gt; DWORD FAtoRVA(DWORD dwFA)        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ–‡ä»¶åœ°å€è½¬RVA&lt;/span&gt;
&lt;span&gt; 254&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt; 255&lt;/span&gt;     PIMAGE_DOS_HEADER pDosHead =&lt;span&gt; PIMAGE_DOS_HEADER(g_pFileSrc);
&lt;/span&gt;&lt;span&gt; 256&lt;/span&gt;     PIMAGE_NT_HEADERS pNtHead = PIMAGE_NT_HEADERS((DWORD)pDosHead + pDosHead-&amp;gt;&lt;span&gt;e_lfanew);
&lt;/span&gt;&lt;span&gt; 257&lt;/span&gt;     PIMAGE_SECTION_HEADER pSection = (PIMAGE_SECTION_HEADER)(pNtHead-&amp;gt;FileHeader.SizeOfOptionalHeader + (DWORD)&amp;amp;pNtHead-&amp;gt;&lt;span&gt;OptionalHeader);
&lt;/span&gt;&lt;span&gt; 258&lt;/span&gt;     &lt;span&gt;int&lt;/span&gt; iSectionNum = pNtHead-&amp;gt;&lt;span&gt;FileHeader.NumberOfSections;
&lt;/span&gt;&lt;span&gt; 259&lt;/span&gt; 
&lt;span&gt; 260&lt;/span&gt;     &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; iSectionNum; i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 261&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 262&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (dwFA &amp;gt;= pSection-&amp;gt;PointerToRawData &amp;amp;&amp;amp; dwFA &amp;lt; (pSection-&amp;gt;PointerToRawData + pSection-&amp;gt;&lt;span&gt;SizeOfRawData))
&lt;/span&gt;&lt;span&gt; 263&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 264&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; (DWORD)dwFA - pSection-&amp;gt;PointerToRawData + pSection-&amp;gt;&lt;span&gt;VirtualAddress;
&lt;/span&gt;&lt;span&gt; 265&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 266&lt;/span&gt;         pSection++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 267&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 268&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è½¬æ¢å¤±è´¥&lt;/span&gt;
&lt;span&gt; 269&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 270&lt;/span&gt; 
&lt;span&gt; 271&lt;/span&gt; 
&lt;span&gt; 272&lt;/span&gt; BOOL LoadFile(&lt;span&gt;char&lt;/span&gt; *pFileName)    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å–æ–‡ä»¶å†…å®¹&lt;/span&gt;
&lt;span&gt; 273&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt; 274&lt;/span&gt;     HANDLE hFile =&lt;span&gt; CreateFileA(pFileName,
&lt;/span&gt;&lt;span&gt; 275&lt;/span&gt; &lt;span&gt;        GENERIC_READ,
&lt;/span&gt;&lt;span&gt; 276&lt;/span&gt; &lt;span&gt;        FILE_SHARE_READ,
&lt;/span&gt;&lt;span&gt; 277&lt;/span&gt; &lt;span&gt;        NULL,
&lt;/span&gt;&lt;span&gt; 278&lt;/span&gt; &lt;span&gt;        OPEN_EXISTING,
&lt;/span&gt;&lt;span&gt; 279&lt;/span&gt; &lt;span&gt;        FILE_ATTRIBUTE_NORMAL,
&lt;/span&gt;&lt;span&gt; 280&lt;/span&gt;         &lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 281&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!&lt;span&gt;hFile)
&lt;/span&gt;&lt;span&gt; 282&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 283&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 284&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 285&lt;/span&gt;     g_iFileSize =&lt;span&gt; GetFileSize(hFile, NULL);
&lt;/span&gt;&lt;span&gt; 286&lt;/span&gt; 
&lt;span&gt; 287&lt;/span&gt;     g_pFileSrc = (UCHAR*)&lt;span&gt;malloc&lt;/span&gt;&lt;span&gt;(g_iFileSize);
&lt;/span&gt;&lt;span&gt; 288&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!&lt;span&gt;g_pFileSrc)
&lt;/span&gt;&lt;span&gt; 289&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 290&lt;/span&gt;         cout &amp;lt;&amp;lt; &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ç”³è¯·å†…å­˜å¤±è´¥&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; &amp;lt;&amp;lt;&lt;span&gt; endl;
&lt;/span&gt;&lt;span&gt; 291&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 292&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 293&lt;/span&gt; 
&lt;span&gt; 294&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!&lt;span&gt;ReadFile(hFile, g_pFileSrc, g_iFileSize, NULL, NULL))
&lt;/span&gt;&lt;span&gt; 295&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 296&lt;/span&gt;         cout &amp;lt;&amp;lt; &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;è¯»å–æ–‡ä»¶å¤±è´¥&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; &amp;lt;&amp;lt;&lt;span&gt; endl;
&lt;/span&gt;&lt;span&gt; 297&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 298&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 299&lt;/span&gt; 
&lt;span&gt; 300&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 301&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 302&lt;/span&gt; 
&lt;span&gt; 303&lt;/span&gt; 
&lt;span&gt; 304&lt;/span&gt; BOOL CheckPE()        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ£€æŸ¥PEæ–‡ä»¶æ ¼å¼&lt;/span&gt;
&lt;span&gt; 305&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt; 306&lt;/span&gt;     PIMAGE_DOS_HEADER pDosHead =&lt;span&gt; PIMAGE_DOS_HEADER(g_pFileSrc);
&lt;/span&gt;&lt;span&gt; 307&lt;/span&gt;     PIMAGE_NT_HEADERS pNtHead = PIMAGE_NT_HEADERS((DWORD)pDosHead + pDosHead-&amp;gt;&lt;span&gt;e_lfanew);
&lt;/span&gt;&lt;span&gt; 308&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (pDosHead-&amp;gt;e_magic != &lt;span&gt;0x5a4d&lt;/span&gt; || pNtHead-&amp;gt;Signature != &lt;span&gt;0x4550&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 309&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 310&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 311&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 312&lt;/span&gt;     g_iImageBase = pNtHead-&amp;gt;&lt;span&gt;OptionalHeader.ImageBase;
&lt;/span&gt;&lt;span&gt; 313&lt;/span&gt;     g_iFileAlignment = pNtHead-&amp;gt;&lt;span&gt;OptionalHeader.FileAlignment;
&lt;/span&gt;&lt;span&gt; 314&lt;/span&gt;     g_iSectionAlignment = pNtHead-&amp;gt;&lt;span&gt;OptionalHeader.SectionAlignment;
&lt;/span&gt;&lt;span&gt; 315&lt;/span&gt;     g_iOldOEP = pNtHead-&amp;gt;&lt;span&gt;OptionalHeader.AddressOfEntryPoint;
&lt;/span&gt;&lt;span&gt; 316&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 317&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 318&lt;/span&gt; 
&lt;span&gt; 319&lt;/span&gt; 
&lt;span&gt; 320&lt;/span&gt; 
&lt;span&gt; 321&lt;/span&gt; BOOL FindCodeAddr()         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ‰¾åˆ°è°ƒç”¨äº†IATä¸­çš„åœ°å€çš„ä»£ç ä½ç½®&lt;/span&gt;
&lt;span&gt; 322&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt; 323&lt;/span&gt;     PIMAGE_DOS_HEADER pDosHead =&lt;span&gt; (PIMAGE_DOS_HEADER)g_pFileSrc;
&lt;/span&gt;&lt;span&gt; 324&lt;/span&gt;     PIMAGE_NT_HEADERS pNtHead = (PIMAGE_NT_HEADERS)((DWORD)pDosHead + pDosHead-&amp;gt;&lt;span&gt;e_lfanew);
&lt;/span&gt;&lt;span&gt; 325&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!pNtHead-&amp;gt;OptionalHeader.DataDirectory[&lt;span&gt;1&lt;/span&gt;&lt;span&gt;].VirtualAddress)
&lt;/span&gt;&lt;span&gt; 326&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 327&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 328&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 329&lt;/span&gt; 
&lt;span&gt; 330&lt;/span&gt;     PIMAGE_IMPORT_DESCRIPTOR pImpotrList = (PIMAGE_IMPORT_DESCRIPTOR)RVAtoFA(pNtHead-&amp;gt;OptionalHeader.DataDirectory[&lt;span&gt;1&lt;/span&gt;].VirtualAddress);  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;IAT&lt;/span&gt;
&lt;span&gt; 331&lt;/span&gt;     &lt;span&gt;while&lt;/span&gt; (pImpotrList-&amp;gt;FirstThunk)&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å¾—è¯¥ç¨‹åºçš„IATåœ°å€&lt;/span&gt;
&lt;span&gt; 332&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 333&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 334&lt;/span&gt;         &lt;span&gt;while&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 335&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 336&lt;/span&gt;             DWORD iIatAddr = *(DWORD*)RVAtoFA(pImpotrList-&amp;gt;FirstThunk + i * &lt;span&gt;sizeof&lt;/span&gt;&lt;span&gt;(DWORD));
&lt;/span&gt;&lt;span&gt; 337&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (!&lt;span&gt;iIatAddr)
&lt;/span&gt;&lt;span&gt; 338&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt; 339&lt;/span&gt;                 &lt;span&gt;break&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 340&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt; 341&lt;/span&gt;             DWORD dwIatAddr = pImpotrList-&amp;gt;FirstThunk + i * &lt;span&gt;sizeof&lt;/span&gt;&lt;span&gt;(DWORD);
&lt;/span&gt;&lt;span&gt; 342&lt;/span&gt; &lt;span&gt;            g_IATaddrList.push_back(dwIatAddr);
&lt;/span&gt;&lt;span&gt; 343&lt;/span&gt;             i++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 344&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 345&lt;/span&gt;         pImpotrList++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 346&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 347&lt;/span&gt; 
&lt;span&gt; 348&lt;/span&gt; 
&lt;span&gt; 349&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å–è°ƒç”¨è¿™äº›IATåœ°å€çš„ä»£ç åœ°å€&lt;/span&gt;
&lt;span&gt; 350&lt;/span&gt;     &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; g_iFileSize - &lt;span&gt;5&lt;/span&gt;; i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 351&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 352&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;mov eax&lt;/span&gt;
&lt;span&gt; 353&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (g_pFileSrc[i] == &lt;span&gt;0xA1&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 354&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 355&lt;/span&gt;             DWORD IatAddr = *(DWORD*)(g_pFileSrc + i + &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 356&lt;/span&gt;             &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; iNum = &lt;span&gt;0&lt;/span&gt;; iNum &amp;lt; g_IATaddrList.size(); iNum++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 357&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt; 358&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt; (g_IATaddrList[iNum] == (IatAddr^&lt;span&gt;g_iImageBase))
&lt;/span&gt;&lt;span&gt; 359&lt;/span&gt; &lt;span&gt;                {
&lt;/span&gt;&lt;span&gt; 360&lt;/span&gt; &lt;span&gt;                    IatAddrTab IatInfo;
&lt;/span&gt;&lt;span&gt; 361&lt;/span&gt;                     IatInfo.dwCallAddr =&lt;span&gt; FAtoRVA(i);
&lt;/span&gt;&lt;span&gt; 362&lt;/span&gt;                     IatInfo.bType = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 363&lt;/span&gt;                     IatInfo.wIndex =&lt;span&gt; iNum;
&lt;/span&gt;&lt;span&gt; 364&lt;/span&gt;                     IatInfo.dwOldIatAddr =&lt;span&gt; g_IATaddrList[iNum];
&lt;/span&gt;&lt;span&gt; 365&lt;/span&gt; &lt;span&gt;                    g_tagIAT.push_back(IatInfo);
&lt;/span&gt;&lt;span&gt; 366&lt;/span&gt;                     i += &lt;span&gt;4&lt;/span&gt;;   &lt;span&gt;//&lt;/span&gt;&lt;span&gt;forå¾ªç¯ä¼šåŠ 1ï¼Œæ“ä½œç¬¦+åœ°å€å…±5å­—èŠ‚&lt;/span&gt;
&lt;span&gt; 367&lt;/span&gt;                     &lt;span&gt;continue&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 368&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt; 369&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt; 370&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 371&lt;/span&gt; 
&lt;span&gt; 372&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;mov edxã€espã€esiã€ecxã€ebxã€ebpã€edi&lt;/span&gt;
&lt;span&gt; 373&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (g_pFileSrc[i] == &lt;span&gt;0x8B&lt;/span&gt; &amp;amp;&amp;amp; (g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x15&lt;/span&gt; || g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x25&lt;/span&gt; || g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x35&lt;/span&gt; ||
&lt;span&gt; 374&lt;/span&gt;             g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x0D&lt;/span&gt; || g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x1D&lt;/span&gt; || g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x2D&lt;/span&gt; || g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x3D&lt;/span&gt;&lt;span&gt;))
&lt;/span&gt;&lt;span&gt; 375&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 376&lt;/span&gt;             DWORD IatAddr = *(DWORD*)(g_pFileSrc + i + &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 377&lt;/span&gt;             &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; iNum = &lt;span&gt;0&lt;/span&gt;; iNum &amp;lt; g_IATaddrList.size(); iNum++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 378&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt; 379&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt; (g_IATaddrList[iNum] == (IatAddr^&lt;span&gt;g_iImageBase))
&lt;/span&gt;&lt;span&gt; 380&lt;/span&gt; &lt;span&gt;                {
&lt;/span&gt;&lt;span&gt; 381&lt;/span&gt;                     DWORD ddddd =&lt;span&gt; FAtoRVA(i);
&lt;/span&gt;&lt;span&gt; 382&lt;/span&gt;                     &lt;span&gt;if&lt;/span&gt; (g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x15&lt;/span&gt;)    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;edx&lt;/span&gt;
&lt;span&gt; 383&lt;/span&gt; &lt;span&gt;                    {
&lt;/span&gt;&lt;span&gt; 384&lt;/span&gt; &lt;span&gt;                        IatAddrTab IatInfo;
&lt;/span&gt;&lt;span&gt; 385&lt;/span&gt;                         IatInfo.dwCallAddr =&lt;span&gt; FAtoRVA(i);
&lt;/span&gt;&lt;span&gt; 386&lt;/span&gt;                         IatInfo.bType = &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 387&lt;/span&gt;                         IatInfo.wIndex =&lt;span&gt; iNum;
&lt;/span&gt;&lt;span&gt; 388&lt;/span&gt;                         IatInfo.dwOldIatAddr =&lt;span&gt; g_IATaddrList[iNum];
&lt;/span&gt;&lt;span&gt; 389&lt;/span&gt; &lt;span&gt;                        g_tagIAT.push_back(IatInfo);
&lt;/span&gt;&lt;span&gt; 390&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt; 391&lt;/span&gt;                     &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x25&lt;/span&gt;)  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;esp&lt;/span&gt;
&lt;span&gt; 392&lt;/span&gt; &lt;span&gt;                    {
&lt;/span&gt;&lt;span&gt; 393&lt;/span&gt; &lt;span&gt;                        IatAddrTab IatInfo;
&lt;/span&gt;&lt;span&gt; 394&lt;/span&gt;                         IatInfo.dwCallAddr =&lt;span&gt; FAtoRVA(i);
&lt;/span&gt;&lt;span&gt; 395&lt;/span&gt;                         IatInfo.bType = &lt;span&gt;2&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 396&lt;/span&gt;                         IatInfo.wIndex =&lt;span&gt; iNum;
&lt;/span&gt;&lt;span&gt; 397&lt;/span&gt;                         IatInfo.dwOldIatAddr =&lt;span&gt; g_IATaddrList[iNum];
&lt;/span&gt;&lt;span&gt; 398&lt;/span&gt; &lt;span&gt;                        g_tagIAT.push_back(IatInfo);
&lt;/span&gt;&lt;span&gt; 399&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt; 400&lt;/span&gt;                     &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x35&lt;/span&gt;)        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;esi&lt;/span&gt;
&lt;span&gt; 401&lt;/span&gt; &lt;span&gt;                    {
&lt;/span&gt;&lt;span&gt; 402&lt;/span&gt; &lt;span&gt;                        IatAddrTab IatInfo;
&lt;/span&gt;&lt;span&gt; 403&lt;/span&gt;                         IatInfo.dwCallAddr =&lt;span&gt; FAtoRVA(i);
&lt;/span&gt;&lt;span&gt; 404&lt;/span&gt;                         IatInfo.bType = &lt;span&gt;3&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 405&lt;/span&gt;                         IatInfo.wIndex =&lt;span&gt; iNum;
&lt;/span&gt;&lt;span&gt; 406&lt;/span&gt;                         IatInfo.dwOldIatAddr =&lt;span&gt; g_IATaddrList[iNum];
&lt;/span&gt;&lt;span&gt; 407&lt;/span&gt; &lt;span&gt;                        g_tagIAT.push_back(IatInfo);
&lt;/span&gt;&lt;span&gt; 408&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt; 409&lt;/span&gt;                     &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x0D&lt;/span&gt;)        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ecx&lt;/span&gt;
&lt;span&gt; 410&lt;/span&gt; &lt;span&gt;                    {
&lt;/span&gt;&lt;span&gt; 411&lt;/span&gt; &lt;span&gt;                        IatAddrTab IatInfo;
&lt;/span&gt;&lt;span&gt; 412&lt;/span&gt;                         IatInfo.dwCallAddr =&lt;span&gt; FAtoRVA(i);
&lt;/span&gt;&lt;span&gt; 413&lt;/span&gt;                         IatInfo.bType = &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 414&lt;/span&gt;                         IatInfo.wIndex =&lt;span&gt; iNum;
&lt;/span&gt;&lt;span&gt; 415&lt;/span&gt;                         IatInfo.dwOldIatAddr =&lt;span&gt; g_IATaddrList[iNum];
&lt;/span&gt;&lt;span&gt; 416&lt;/span&gt; &lt;span&gt;                        g_tagIAT.push_back(IatInfo);
&lt;/span&gt;&lt;span&gt; 417&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt; 418&lt;/span&gt;                     &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x1D&lt;/span&gt;)        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ebx&lt;/span&gt;
&lt;span&gt; 419&lt;/span&gt; &lt;span&gt;                    {
&lt;/span&gt;&lt;span&gt; 420&lt;/span&gt; &lt;span&gt;                        IatAddrTab IatInfo;
&lt;/span&gt;&lt;span&gt; 421&lt;/span&gt;                         IatInfo.dwCallAddr =&lt;span&gt; FAtoRVA(i);
&lt;/span&gt;&lt;span&gt; 422&lt;/span&gt;                         IatInfo.bType = &lt;span&gt;5&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 423&lt;/span&gt;                         IatInfo.wIndex =&lt;span&gt; iNum;
&lt;/span&gt;&lt;span&gt; 424&lt;/span&gt;                         IatInfo.dwOldIatAddr =&lt;span&gt; g_IATaddrList[iNum];
&lt;/span&gt;&lt;span&gt; 425&lt;/span&gt; &lt;span&gt;                        g_tagIAT.push_back(IatInfo);
&lt;/span&gt;&lt;span&gt; 426&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt; 427&lt;/span&gt;                     &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x2D&lt;/span&gt;)        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ebp&lt;/span&gt;
&lt;span&gt; 428&lt;/span&gt; &lt;span&gt;                    {
&lt;/span&gt;&lt;span&gt; 429&lt;/span&gt; &lt;span&gt;                        IatAddrTab IatInfo;
&lt;/span&gt;&lt;span&gt; 430&lt;/span&gt;                         IatInfo.dwCallAddr =&lt;span&gt; FAtoRVA(i);
&lt;/span&gt;&lt;span&gt; 431&lt;/span&gt;                         IatInfo.bType = &lt;span&gt;6&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 432&lt;/span&gt;                         IatInfo.wIndex =&lt;span&gt; iNum;
&lt;/span&gt;&lt;span&gt; 433&lt;/span&gt;                         IatInfo.dwOldIatAddr =&lt;span&gt; g_IATaddrList[iNum];
&lt;/span&gt;&lt;span&gt; 434&lt;/span&gt; &lt;span&gt;                        g_tagIAT.push_back(IatInfo);
&lt;/span&gt;&lt;span&gt; 435&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt; 436&lt;/span&gt;                     &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x3D&lt;/span&gt;)        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;edi&lt;/span&gt;
&lt;span&gt; 437&lt;/span&gt; &lt;span&gt;                    {
&lt;/span&gt;&lt;span&gt; 438&lt;/span&gt; &lt;span&gt;                        IatAddrTab IatInfo;
&lt;/span&gt;&lt;span&gt; 439&lt;/span&gt;                         IatInfo.dwCallAddr =&lt;span&gt; FAtoRVA(i);
&lt;/span&gt;&lt;span&gt; 440&lt;/span&gt;                         IatInfo.bType = &lt;span&gt;7&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 441&lt;/span&gt;                         IatInfo.wIndex =&lt;span&gt; iNum;
&lt;/span&gt;&lt;span&gt; 442&lt;/span&gt;                         IatInfo.dwOldIatAddr =&lt;span&gt; g_IATaddrList[iNum];
&lt;/span&gt;&lt;span&gt; 443&lt;/span&gt; &lt;span&gt;                        g_tagIAT.push_back(IatInfo);
&lt;/span&gt;&lt;span&gt; 444&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt; 445&lt;/span&gt;                     i += &lt;span&gt;5&lt;/span&gt;;   &lt;span&gt;//&lt;/span&gt;&lt;span&gt;forå¾ªç¯ä¼šåŠ 1ï¼Œæ“ä½œç¬¦+åœ°å€å…±6å­—èŠ‚&lt;/span&gt;
&lt;span&gt; 446&lt;/span&gt;                     &lt;span&gt;continue&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 447&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt; 448&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt; 449&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 450&lt;/span&gt; 
&lt;span&gt; 451&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;call jmp push&lt;/span&gt;
&lt;span&gt; 452&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (g_pFileSrc[i] == &lt;span&gt;0xFF&lt;/span&gt; &amp;amp;&amp;amp; (g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x15&lt;/span&gt; || g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x25&lt;/span&gt; || g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x35&lt;/span&gt;&lt;span&gt;))
&lt;/span&gt;&lt;span&gt; 453&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 454&lt;/span&gt;             DWORD IatAddr = *(DWORD*)(g_pFileSrc + i + &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 455&lt;/span&gt;             &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; iNum = &lt;span&gt;0&lt;/span&gt;; iNum &amp;lt; g_IATaddrList.size(); iNum++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 456&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt; 457&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt; (g_IATaddrList[iNum] == (IatAddr^&lt;span&gt;g_iImageBase))
&lt;/span&gt;&lt;span&gt; 458&lt;/span&gt; &lt;span&gt;                {
&lt;/span&gt;&lt;span&gt; 459&lt;/span&gt;                     DWORD ddddd =&lt;span&gt; FAtoRVA(i);
&lt;/span&gt;&lt;span&gt; 460&lt;/span&gt;                     &lt;span&gt;if&lt;/span&gt; (g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x15&lt;/span&gt;) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;call&lt;/span&gt;
&lt;span&gt; 461&lt;/span&gt; &lt;span&gt;                    {
&lt;/span&gt;&lt;span&gt; 462&lt;/span&gt; &lt;span&gt;                        IatAddrTab IatInfo;
&lt;/span&gt;&lt;span&gt; 463&lt;/span&gt;                         IatInfo.dwCallAddr =&lt;span&gt; FAtoRVA(i);
&lt;/span&gt;&lt;span&gt; 464&lt;/span&gt;                         IatInfo.bType = &lt;span&gt;8&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 465&lt;/span&gt;                         IatInfo.wIndex =&lt;span&gt; iNum;
&lt;/span&gt;&lt;span&gt; 466&lt;/span&gt;                         IatInfo.dwOldIatAddr =&lt;span&gt; g_IATaddrList[iNum];
&lt;/span&gt;&lt;span&gt; 467&lt;/span&gt; &lt;span&gt;                        g_tagIAT.push_back(IatInfo);
&lt;/span&gt;&lt;span&gt; 468&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt; 469&lt;/span&gt;                     &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x25&lt;/span&gt;)  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;jmp&lt;/span&gt;
&lt;span&gt; 470&lt;/span&gt; &lt;span&gt;                    {
&lt;/span&gt;&lt;span&gt; 471&lt;/span&gt; &lt;span&gt;                        IatAddrTab IatInfo;
&lt;/span&gt;&lt;span&gt; 472&lt;/span&gt;                         IatInfo.dwCallAddr =&lt;span&gt; FAtoRVA(i);
&lt;/span&gt;&lt;span&gt; 473&lt;/span&gt;                         IatInfo.bType = &lt;span&gt;9&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 474&lt;/span&gt;                         IatInfo.wIndex =&lt;span&gt; iNum;
&lt;/span&gt;&lt;span&gt; 475&lt;/span&gt;                         IatInfo.dwOldIatAddr =&lt;span&gt; g_IATaddrList[iNum];
&lt;/span&gt;&lt;span&gt; 476&lt;/span&gt; &lt;span&gt;                        g_tagIAT.push_back(IatInfo);
&lt;/span&gt;&lt;span&gt; 477&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt; 478&lt;/span&gt;                     &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_pFileSrc[i + &lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0x35&lt;/span&gt;)        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;push&lt;/span&gt;
&lt;span&gt; 479&lt;/span&gt; &lt;span&gt;                    {
&lt;/span&gt;&lt;span&gt; 480&lt;/span&gt; &lt;span&gt;                        IatAddrTab IatInfo;
&lt;/span&gt;&lt;span&gt; 481&lt;/span&gt;                         IatInfo.dwCallAddr =&lt;span&gt; FAtoRVA(i);
&lt;/span&gt;&lt;span&gt; 482&lt;/span&gt;                         IatInfo.bType = &lt;span&gt;10&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 483&lt;/span&gt;                         IatInfo.wIndex =&lt;span&gt; iNum;
&lt;/span&gt;&lt;span&gt; 484&lt;/span&gt;                         IatInfo.dwOldIatAddr =&lt;span&gt; g_IATaddrList[iNum];
&lt;/span&gt;&lt;span&gt; 485&lt;/span&gt; &lt;span&gt;                        g_tagIAT.push_back(IatInfo);
&lt;/span&gt;&lt;span&gt; 486&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt; 487&lt;/span&gt;                     i += &lt;span&gt;5&lt;/span&gt;;   &lt;span&gt;//&lt;/span&gt;&lt;span&gt;forå¾ªç¯ä¼šåŠ 1ï¼Œæ“ä½œç¬¦+åœ°å€å…±6å­—èŠ‚&lt;/span&gt;
&lt;span&gt; 488&lt;/span&gt;                     &lt;span&gt;continue&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 489&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt; 490&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt; 491&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 492&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 493&lt;/span&gt; 
&lt;span&gt; 494&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 495&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 496&lt;/span&gt; 
&lt;span&gt; 497&lt;/span&gt; 
&lt;span&gt; 498&lt;/span&gt; &lt;span&gt;bool&lt;/span&gt; SaveDll() &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¿å­˜DLLç›¸å…³æ•°æ®&lt;/span&gt;
&lt;span&gt; 499&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt; 500&lt;/span&gt;     PIMAGE_DOS_HEADER pDosHead =&lt;span&gt; (PIMAGE_DOS_HEADER)g_pFileSrc;
&lt;/span&gt;&lt;span&gt; 501&lt;/span&gt;     PIMAGE_NT_HEADERS pNtHead = (PIMAGE_NT_HEADERS)((DWORD)pDosHead + pDosHead-&amp;gt;&lt;span&gt;e_lfanew);
&lt;/span&gt;&lt;span&gt; 502&lt;/span&gt;     DWORD dwImportRVA = pNtHead-&amp;gt;OptionalHeader.DataDirectory[&lt;span&gt;1&lt;/span&gt;&lt;span&gt;].VirtualAddress;
&lt;/span&gt;&lt;span&gt; 503&lt;/span&gt;     PIMAGE_IMPORT_DESCRIPTOR pImport =&lt;span&gt; (PIMAGE_IMPORT_DESCRIPTOR)RVAtoFA(dwImportRVA);
&lt;/span&gt;&lt;span&gt; 504&lt;/span&gt;     &lt;span&gt;while&lt;/span&gt; (pImport-&amp;gt;&lt;span&gt;FirstThunk)
&lt;/span&gt;&lt;span&gt; 505&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 506&lt;/span&gt;         DLLFuncTag tagDllList;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;Dllä¿¡æ¯ç»“æ„&lt;/span&gt;
&lt;span&gt; 507&lt;/span&gt; 
&lt;span&gt; 508&lt;/span&gt;         &lt;span&gt;char&lt;/span&gt; *szDllName = (&lt;span&gt;char&lt;/span&gt;*)RVAtoFA(pImport-&amp;gt;&lt;span&gt;Name);
&lt;/span&gt;&lt;span&gt; 509&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iDllNameLen = strlen(szDllName) + &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 510&lt;/span&gt;         &lt;span&gt;char&lt;/span&gt; *szNewDllName = (&lt;span&gt;char&lt;/span&gt;*)&lt;span&gt;malloc&lt;/span&gt;&lt;span&gt;(iDllNameLen);
&lt;/span&gt;&lt;span&gt; 511&lt;/span&gt; &lt;span&gt;        memcpy(szNewDllName, szDllName, iDllNameLen);
&lt;/span&gt;&lt;span&gt; 512&lt;/span&gt; 
&lt;span&gt; 513&lt;/span&gt;         tagDllList.szDllName =&lt;span&gt; szNewDllName;
&lt;/span&gt;&lt;span&gt; 514&lt;/span&gt;         tagDllList.bDllNameLenth =&lt;span&gt; iDllNameLen;
&lt;/span&gt;&lt;span&gt; 515&lt;/span&gt; 
&lt;span&gt; 516&lt;/span&gt;         PIMAGE_THUNK_DATA pIAT = (PIMAGE_THUNK_DATA)RVAtoFA(pImport-&amp;gt;&lt;span&gt;FirstThunk);
&lt;/span&gt;&lt;span&gt; 517&lt;/span&gt;         &lt;span&gt;while&lt;/span&gt; (pIAT-&amp;gt;&lt;span&gt;u1.Function)
&lt;/span&gt;&lt;span&gt; 518&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 519&lt;/span&gt;             FuncTag tagFuncInfo;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å‡½æ•°ä¿¡æ¯ç»“æ„&lt;/span&gt;
&lt;span&gt; 520&lt;/span&gt;             DWORD dwFuncAddr = pIAT-&amp;gt;&lt;span&gt;u1.Function;
&lt;/span&gt;&lt;span&gt; 521&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (dwFuncAddr &amp;amp; &lt;span&gt;0x80000000&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 522&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt; 523&lt;/span&gt;                 tagDllList.bTab = &lt;span&gt;0&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æŒ‰åºå·å¯¼å…¥&lt;/span&gt;
&lt;span&gt; 524&lt;/span&gt;                 tagFuncInfo.iFuncNameLenth = &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 525&lt;/span&gt;                 tagFuncInfo.szFuncName = (&lt;span&gt;char&lt;/span&gt;*)(dwFuncAddr ^ &lt;span&gt;0x80000000&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 526&lt;/span&gt; &lt;span&gt;                tagDllList.vFuncNAMEorNo.push_back(tagFuncInfo);
&lt;/span&gt;&lt;span&gt; 527&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt; 528&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt;
&lt;span&gt; 529&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt; 530&lt;/span&gt;                 tagDllList.bTab = &lt;span&gt;1&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æŒ‰åç§°å¯¼å…¥&lt;/span&gt;
&lt;span&gt; 531&lt;/span&gt;                 PIMAGE_IMPORT_BY_NAME pFunc = (PIMAGE_IMPORT_BY_NAME)RVAtoFA(pIAT-&amp;gt;&lt;span&gt;u1.Function);
&lt;/span&gt;&lt;span&gt; 532&lt;/span&gt;                 &lt;span&gt;int&lt;/span&gt; iFuncNameLen = strlen(pFunc-&amp;gt;Name) + &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 533&lt;/span&gt;                 &lt;span&gt;char&lt;/span&gt; *szFuncName = (&lt;span&gt;char&lt;/span&gt;*)&lt;span&gt;malloc&lt;/span&gt;&lt;span&gt;(iFuncNameLen);
&lt;/span&gt;&lt;span&gt; 534&lt;/span&gt;                 memcpy(szFuncName, pFunc-&amp;gt;&lt;span&gt;Name, iFuncNameLen);
&lt;/span&gt;&lt;span&gt; 535&lt;/span&gt;                 tagFuncInfo.iFuncNameLenth =&lt;span&gt; iFuncNameLen;
&lt;/span&gt;&lt;span&gt; 536&lt;/span&gt;                 tagFuncInfo.szFuncName =&lt;span&gt; szFuncName;
&lt;/span&gt;&lt;span&gt; 537&lt;/span&gt; &lt;span&gt;                tagDllList.vFuncNAMEorNo.push_back(tagFuncInfo);
&lt;/span&gt;&lt;span&gt; 538&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt; 539&lt;/span&gt;             pIAT++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 540&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 541&lt;/span&gt;         tagDllList.wFuncNum =&lt;span&gt; tagDllList.vFuncNAMEorNo.size();
&lt;/span&gt;&lt;span&gt; 542&lt;/span&gt; &lt;span&gt;        g_tagDllFunc.push_back(tagDllList);
&lt;/span&gt;&lt;span&gt; 543&lt;/span&gt;         pImport++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 544&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 545&lt;/span&gt; 
&lt;span&gt; 546&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°†IATè¡¨ä¿¡æ¯éšè—(æ¯ä¸ªDLLåªæœ‰ä¸€ä¸ªå¯¼å…¥å‡½æ•°)&lt;/span&gt;
&lt;span&gt; 547&lt;/span&gt;     PIMAGE_IMPORT_DESCRIPTOR pImpotrList = (PIMAGE_IMPORT_DESCRIPTOR)RVAtoFA(pNtHead-&amp;gt;OptionalHeader.DataDirectory[&lt;span&gt;1&lt;/span&gt;&lt;span&gt;].VirtualAddress);
&lt;/span&gt;&lt;span&gt; 548&lt;/span&gt;     &lt;span&gt;while&lt;/span&gt; (pImpotrList-&amp;gt;&lt;span&gt;FirstThunk)
&lt;/span&gt;&lt;span&gt; 549&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 550&lt;/span&gt;         PIMAGE_THUNK_DATA pIAT = (PIMAGE_THUNK_DATA)RVAtoFA(pImpotrList-&amp;gt;&lt;span&gt;FirstThunk);
&lt;/span&gt;&lt;span&gt; 551&lt;/span&gt;         PIMAGE_THUNK_DATA pINT = (PIMAGE_THUNK_DATA)RVAtoFA(pImpotrList-&amp;gt;&lt;span&gt;OriginalFirstThunk);
&lt;/span&gt;&lt;span&gt; 552&lt;/span&gt;         pIAT++;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¿ç•™ç¬¬ä¸€ä¸ª&lt;/span&gt;
&lt;span&gt; 553&lt;/span&gt;         pINT++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 554&lt;/span&gt;         &lt;span&gt;while&lt;/span&gt; (pIAT-&amp;gt;u1.Function)&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°†IATæ¸…ç©º&lt;/span&gt;
&lt;span&gt; 555&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 556&lt;/span&gt;             pIAT-&amp;gt;u1.Function = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 557&lt;/span&gt;             pIAT++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 558&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 559&lt;/span&gt;         &lt;span&gt;while&lt;/span&gt; (pINT-&amp;gt;u1.Function)&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°†INTæ¸…ç©º&lt;/span&gt;
&lt;span&gt; 560&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 561&lt;/span&gt;             pINT-&amp;gt;u1.Function = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 562&lt;/span&gt;             pINT++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 563&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 564&lt;/span&gt;         pImpotrList++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 565&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 566&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 567&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 568&lt;/span&gt; 
&lt;span&gt; 569&lt;/span&gt; 
&lt;span&gt; 570&lt;/span&gt; 
&lt;span&gt; 571&lt;/span&gt; 
&lt;span&gt; 572&lt;/span&gt; &lt;span&gt;bool&lt;/span&gt;&lt;span&gt; NewIat()
&lt;/span&gt;&lt;span&gt; 573&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt; 574&lt;/span&gt;     PIMAGE_DOS_HEADER pDosHead =&lt;span&gt; (PIMAGE_DOS_HEADER)g_pFileSrc;
&lt;/span&gt;&lt;span&gt; 575&lt;/span&gt;     PIMAGE_NT_HEADERS pNtHead = (PIMAGE_NT_HEADERS)((DWORD)pDosHead + pDosHead-&amp;gt;&lt;span&gt;e_lfanew);
&lt;/span&gt;&lt;span&gt; 576&lt;/span&gt;     PIMAGE_SECTION_HEADER pSection = (PIMAGE_SECTION_HEADER)((DWORD)&amp;amp;pNtHead-&amp;gt;OptionalHeader + pNtHead-&amp;gt;&lt;span&gt;FileHeader.SizeOfOptionalHeader);
&lt;/span&gt;&lt;span&gt; 577&lt;/span&gt;     &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; pNtHead-&amp;gt;FileHeader.NumberOfSections; i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 578&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 579&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°†æ¯ä¸ªèŠ‚éƒ½æ”¹ä¸ºå¯å†™å±æ€§ï¼Œä»¥ä¾¿åœ¨åç»­ä¿®æ”¹ã€‚
&lt;/span&gt;&lt;span&gt; 580&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æœ¬æ¥åªä¿®æ”¹.textèŠ‚çš„å±æ€§å³å¯ï¼Œä½†ç”±äºè¯¥èŠ‚çš„ä½ç½®ä¸åœ¨dataæ•°ç»„é‡Œé¢è®°å½•ï¼Œå•å‡­èŠ‚ååˆ¤æ–­æœªå¿…å‡†ç¡®ï¼Œæ‰€ä»¥å°†æ‰€ä»¥èŠ‚éƒ½æ”¹ä¸ºå¯å†™-&lt;/span&gt;
&lt;span&gt; 581&lt;/span&gt;         pSection-&amp;gt;Characteristics += &lt;span&gt;0x80000000&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 582&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 583&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!(pNtHead-&amp;gt;OptionalHeader.DataDirectory[&lt;span&gt;5&lt;/span&gt;].VirtualAddress))&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å½“å‰ç¨‹åºæ²¡æœ‰é‡å®šä½è¡¨&lt;/span&gt;
&lt;span&gt; 584&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 585&lt;/span&gt;         PIMAGE_SECTION_HEADER pSection = (PIMAGE_SECTION_HEADER)((DWORD)&amp;amp;pNtHead-&amp;gt;OptionalHeader + pNtHead-&amp;gt;&lt;span&gt;FileHeader.SizeOfOptionalHeader);
&lt;/span&gt;&lt;span&gt; 586&lt;/span&gt;         pSection += pNtHead-&amp;gt;FileHeader.NumberOfSections - &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 587&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iNewSectionFileAddr = pSection-&amp;gt;PointerToRawData + pSection-&amp;gt;&lt;span&gt;SizeOfRawData;
&lt;/span&gt;&lt;span&gt; 588&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iNewSectionFileMapAddr = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 589&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (!(pSection-&amp;gt;Misc.VirtualSize %&lt;span&gt; g_iSectionAlignment))
&lt;/span&gt;&lt;span&gt; 590&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 591&lt;/span&gt;             iNewSectionFileMapAddr = pSection-&amp;gt;VirtualAddress + pSection-&amp;gt;&lt;span&gt;Misc.VirtualSize;
&lt;/span&gt;&lt;span&gt; 592&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 593&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;
&lt;span&gt; 594&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 595&lt;/span&gt;             iNewSectionFileMapAddr = pSection-&amp;gt;VirtualAddress + pSection-&amp;gt;&lt;span&gt;Misc.VirtualSize
&lt;/span&gt;&lt;span&gt; 596&lt;/span&gt;                 + g_iSectionAlignment - (pSection-&amp;gt;Misc.VirtualSize %&lt;span&gt; g_iSectionAlignment);
&lt;/span&gt;&lt;span&gt; 597&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 598&lt;/span&gt; 
&lt;span&gt; 599&lt;/span&gt;         pSection++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 600&lt;/span&gt;         memcpy(pSection-&amp;gt;Name, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;.KD&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;3&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 601&lt;/span&gt;         pSection-&amp;gt;VirtualAddress =&lt;span&gt; iNewSectionFileMapAddr;
&lt;/span&gt;&lt;span&gt; 602&lt;/span&gt;         pSection-&amp;gt;PointerToRawData =&lt;span&gt; iNewSectionFileAddr;
&lt;/span&gt;&lt;span&gt; 603&lt;/span&gt;         pSection-&amp;gt;Characteristics = (&lt;span&gt;0x20000000&lt;/span&gt; | &lt;span&gt;0x40000000&lt;/span&gt; | &lt;span&gt;0x80000000&lt;/span&gt; | &lt;span&gt;0x40&lt;/span&gt;); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;èŠ‚å±æ€§ å¯è¯»å¯å†™å¯æ‰§è¡Œå·²è¢«åˆå§‹åŒ–&lt;/span&gt;
&lt;span&gt; 604&lt;/span&gt;         pNtHead-&amp;gt;FileHeader.NumberOfSections += &lt;span&gt;1&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;èŠ‚è¡¨æ•°é‡+1
&lt;/span&gt;&lt;span&gt; 605&lt;/span&gt; 
&lt;span&gt; 606&lt;/span&gt; 
&lt;span&gt; 607&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°†IATçš„æ•°æ®å‹å…¥æ–°èŠ‚ä¸­æ•°æ®æ’åˆ—åˆ†åˆ«ä¸ºDLLæ•°é‡(2å­—èŠ‚)ã€DLLåå­—é•¿åº¦ã€è¯¥&lt;/span&gt;
&lt;span&gt; 608&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iAddIatLenth = &lt;span&gt;0&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å·²ç»å¢åŠ çš„iatæ•°æ®é•¿åº¦
&lt;/span&gt;&lt;span&gt; 609&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å…ˆæ·»åŠ 2å­—èŠ‚æ•°æ®è¯´æ˜è¯¥ç¨‹åºçš„DLLæ•°é‡&lt;/span&gt;
&lt;span&gt; 610&lt;/span&gt;         g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth + &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 611&lt;/span&gt;         &lt;span&gt;byte&lt;/span&gt; bDllNum =&lt;span&gt; g_tagDllFunc.size();
&lt;/span&gt;&lt;span&gt; 612&lt;/span&gt;         memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, &amp;amp;bDllNum, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 613&lt;/span&gt;         iAddIatLenth += &lt;span&gt;2&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 614&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; bDllNum; i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 615&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 616&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ·»åŠ DLLåé•¿åº¦&lt;/span&gt;
&lt;span&gt; 617&lt;/span&gt;             &lt;span&gt;int&lt;/span&gt; bDllNameLenth =&lt;span&gt; g_tagDllFunc[i].bDllNameLenth;
&lt;/span&gt;&lt;span&gt; 618&lt;/span&gt;             g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth + &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 619&lt;/span&gt;             memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, &amp;amp;bDllNameLenth, &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 620&lt;/span&gt;             iAddIatLenth += &lt;span&gt;2&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 621&lt;/span&gt; 
&lt;span&gt; 622&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ·»åŠ DLLå&lt;/span&gt;
&lt;span&gt; 623&lt;/span&gt;             g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth +&lt;span&gt; bDllNameLenth);
&lt;/span&gt;&lt;span&gt; 624&lt;/span&gt;             memcpy(g_pFileSrc + g_iFileSize +&lt;span&gt; iAddIatLenth, g_tagDllFunc[i].szDllName, bDllNameLenth);
&lt;/span&gt;&lt;span&gt; 625&lt;/span&gt;             iAddIatLenth +=&lt;span&gt; bDllNameLenth;
&lt;/span&gt;&lt;span&gt; 626&lt;/span&gt; 
&lt;span&gt; 627&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ·»åŠ è¯¥DLLä¸­çš„å¯¼å…¥å‡½æ•°æ•°é‡  æ–¹ä¾¿åç»­éå†&lt;/span&gt;
&lt;span&gt; 628&lt;/span&gt;             g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth + &lt;span&gt;4&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 629&lt;/span&gt;             memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, (DWORD*)&amp;amp;g_tagDllFunc[i].wFuncNum, &lt;span&gt;4&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 630&lt;/span&gt;             iAddIatLenth += &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 631&lt;/span&gt; 
&lt;span&gt; 632&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ·»åŠ è¯¥DLLçš„å¯¼å…¥æ–¹å¼ 0ä¸ºåºå·1ä¸ºåç§°&lt;/span&gt;
&lt;span&gt; 633&lt;/span&gt;             g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth + &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 634&lt;/span&gt;             memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, (&lt;span&gt;byte&lt;/span&gt;*)&amp;amp;g_tagDllFunc[i].bTab, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 635&lt;/span&gt;             iAddIatLenth += &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 636&lt;/span&gt;             &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; j = &lt;span&gt;0&lt;/span&gt;; j &amp;lt; g_tagDllFunc[i].wFuncNum; j++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 637&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt; 638&lt;/span&gt;                 &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ·»åŠ å‡½æ•°åæˆ–åºå·&lt;/span&gt;
&lt;span&gt; 639&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt; (!(g_tagDllFunc[i].bTab)) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;åºå·&lt;/span&gt;
&lt;span&gt; 640&lt;/span&gt; &lt;span&gt;                {
&lt;/span&gt;&lt;span&gt; 641&lt;/span&gt;                     g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth + &lt;span&gt;6&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;2é•¿åº¦4åºå·&lt;/span&gt;
&lt;span&gt; 642&lt;/span&gt;                     memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, (WORD*)&amp;amp;g_tagDllFunc[i].vFuncNAMEorNo[j].iFuncNameLenth, &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 643&lt;/span&gt;                     iAddIatLenth += &lt;span&gt;2&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 644&lt;/span&gt;                     memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, (DWORD*)&amp;amp;g_tagDllFunc[i].vFuncNAMEorNo[j].szFuncName, &lt;span&gt;4&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 645&lt;/span&gt;                     iAddIatLenth += &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 646&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt; 647&lt;/span&gt;                 &lt;span&gt;else&lt;/span&gt;  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;åå­—&lt;/span&gt;
&lt;span&gt; 648&lt;/span&gt; &lt;span&gt;                {
&lt;/span&gt;&lt;span&gt; 649&lt;/span&gt;                     &lt;span&gt;int&lt;/span&gt; iFuncNameLenth = g_tagDllFunc[i].vFuncNAMEorNo[j].iFuncNameLenth;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;é•¿åº¦&lt;/span&gt;
&lt;span&gt; 650&lt;/span&gt;                     g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth + &lt;span&gt;2&lt;/span&gt; + iFuncNameLenth);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å‰2å­—èŠ‚å­˜æ”¾é•¿åº¦ åé¢ä¸ºå‡½æ•°åç§°&lt;/span&gt;
&lt;span&gt; 651&lt;/span&gt;                     memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, (WORD*)&amp;amp;iFuncNameLenth, &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 652&lt;/span&gt;                     iAddIatLenth += &lt;span&gt;2&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 653&lt;/span&gt;                     memcpy(g_pFileSrc + g_iFileSize +&lt;span&gt; iAddIatLenth, g_tagDllFunc[i].vFuncNAMEorNo[j].szFuncName, iFuncNameLenth);
&lt;/span&gt;&lt;span&gt; 654&lt;/span&gt;                     iAddIatLenth +=&lt;span&gt; iFuncNameLenth;
&lt;/span&gt;&lt;span&gt; 655&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt; 656&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt; 657&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 658&lt;/span&gt; 
&lt;span&gt; 659&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å–æ–°çš„OEPå¹¶ä¿®æ”¹æ—§çš„OEP&lt;/span&gt;
&lt;span&gt; 660&lt;/span&gt;         g_iNewOEP = iNewSectionFileMapAddr + iAddIatLenth;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ–°èŠ‚çš„&lt;/span&gt;
&lt;span&gt; 661&lt;/span&gt;         pDosHead =&lt;span&gt; (PIMAGE_DOS_HEADER)g_pFileSrc;
&lt;/span&gt;&lt;span&gt; 662&lt;/span&gt;         pNtHead = (PIMAGE_NT_HEADERS)((DWORD)pDosHead + pDosHead-&amp;gt;&lt;span&gt;e_lfanew);
&lt;/span&gt;&lt;span&gt; 663&lt;/span&gt;         pNtHead-&amp;gt;OptionalHeader.AddressOfEntryPoint =&lt;span&gt; g_iNewOEP;
&lt;/span&gt;&lt;span&gt; 664&lt;/span&gt; 
&lt;span&gt; 665&lt;/span&gt; &lt;span&gt;        JitRuntime        _x86RunTimeObject;
&lt;/span&gt;&lt;span&gt; 666&lt;/span&gt;         X86Assembler    a(&amp;amp;&lt;span&gt;_x86RunTimeObject);
&lt;/span&gt;&lt;span&gt; 667&lt;/span&gt; 
&lt;span&gt; 668&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“ç¨‹åºæ²¡æœ‰é‡å®šä½è¡¨æ—¶ï¼Œæ ¹æ®call 0000 0000æ¥è·å¾—è¿›ç¨‹åŸºå€ï¼Œæœ‰é‡å®šä½è¡¨æ—¶åˆ™æ ¹æ®é‡å®šä½è¡¨&lt;/span&gt;
&lt;span&gt; 669&lt;/span&gt;         &lt;span&gt;char&lt;/span&gt; szGetOEP[] = { &lt;span&gt;0xE8&lt;/span&gt;, &lt;span&gt;0x00&lt;/span&gt;, &lt;span&gt;0x00&lt;/span&gt;, &lt;span&gt;0x00&lt;/span&gt;, &lt;span&gt;0x00&lt;/span&gt; }; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;åŒç†jit.call(0x00000000);&lt;/span&gt;
&lt;span&gt; 670&lt;/span&gt; &lt;span&gt;        a.pop(eax);
&lt;/span&gt;&lt;span&gt; 671&lt;/span&gt;         a.sub(eax, &lt;span&gt;5&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ­¤æ—¶å¾—åˆ°oepæ‰€åœ¨çš„åœ°å€ oepè·ç¦»åŸºå€éš”ç€&lt;/span&gt;
&lt;span&gt; 672&lt;/span&gt;         a.sub(eax, g_iNewOEP);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;OEPæ‰€åœ¨çš„åŸºå€-åç§»  å¾—åˆ°åŸºå€&lt;/span&gt;
&lt;span&gt; 673&lt;/span&gt;         a.mov(ebp, eax);    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¿å­˜è¿›ç¨‹åŸºå€åˆ°ebp&lt;/span&gt;
&lt;span&gt; 674&lt;/span&gt; &lt;span&gt;        a.add(eax, g_iOldOEP);
&lt;/span&gt;&lt;span&gt; 675&lt;/span&gt; &lt;span&gt;        a.jmp(eax);
&lt;/span&gt;&lt;span&gt; 676&lt;/span&gt; 
&lt;span&gt; 677&lt;/span&gt;         PVOID szJit =&lt;span&gt; a.make();
&lt;/span&gt;&lt;span&gt; 678&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iJitLenth = a.getCodeSize() + &lt;span&gt;5&lt;/span&gt;; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;åŒ…æ‹¬e8 0000 0000ï¼›&lt;/span&gt;
&lt;span&gt; 679&lt;/span&gt; 
&lt;span&gt; 680&lt;/span&gt;         g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth +&lt;span&gt; iJitLenth);
&lt;/span&gt;&lt;span&gt; 681&lt;/span&gt;         memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, szGetOEP, &lt;span&gt;5&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 682&lt;/span&gt;         memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth + &lt;span&gt;5&lt;/span&gt;&lt;span&gt;, szJit, iJitLenth);
&lt;/span&gt;&lt;span&gt; 683&lt;/span&gt; 
&lt;span&gt; 684&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iAddSrcLen = iAddIatLenth + iJitLenth;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¸€å…±å¢åŠ çš„ä»£ç 
&lt;/span&gt;&lt;span&gt; 685&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å®Œå–„èŠ‚é•¿åº¦ç­‰æ•°æ®  ä¿å®ˆèµ·è§é‡æ–°è·å–èŠ‚è¡¨ä¿¡æ¯&lt;/span&gt;
&lt;span&gt; 686&lt;/span&gt;         pDosHead =&lt;span&gt; (PIMAGE_DOS_HEADER)g_pFileSrc;
&lt;/span&gt;&lt;span&gt; 687&lt;/span&gt;         pNtHead = (PIMAGE_NT_HEADERS)((DWORD)pDosHead + pDosHead-&amp;gt;&lt;span&gt;e_lfanew);
&lt;/span&gt;&lt;span&gt; 688&lt;/span&gt;         pSection = (PIMAGE_SECTION_HEADER)((DWORD)&amp;amp;pNtHead-&amp;gt;OptionalHeader + pNtHead-&amp;gt;&lt;span&gt;FileHeader.SizeOfOptionalHeader);
&lt;/span&gt;&lt;span&gt; 689&lt;/span&gt;         pSection += pNtHead-&amp;gt;FileHeader.NumberOfSections - &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 690&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (!(iAddSrcLen%&lt;span&gt;g_iFileAlignment))
&lt;/span&gt;&lt;span&gt; 691&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 692&lt;/span&gt;             pSection-&amp;gt;SizeOfRawData =&lt;span&gt; iAddSrcLen;
&lt;/span&gt;&lt;span&gt; 693&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 694&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;
&lt;span&gt; 695&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 696&lt;/span&gt;             pSection-&amp;gt;SizeOfRawData = iAddSrcLen + g_iFileAlignment - (iAddSrcLen%&lt;span&gt;g_iFileAlignment);
&lt;/span&gt;&lt;span&gt; 697&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 698&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (!(iAddSrcLen%&lt;span&gt;g_iSectionAlignment))
&lt;/span&gt;&lt;span&gt; 699&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 700&lt;/span&gt;             pSection-&amp;gt;Misc.VirtualSize =&lt;span&gt; iAddSrcLen;
&lt;/span&gt;&lt;span&gt; 701&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 702&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;
&lt;span&gt; 703&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 704&lt;/span&gt;             pSection-&amp;gt;Misc.VirtualSize = iAddSrcLen + g_iSectionAlignment - (iAddSrcLen%&lt;span&gt;g_iSectionAlignment);
&lt;/span&gt;&lt;span&gt; 705&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 706&lt;/span&gt;         pNtHead-&amp;gt;OptionalHeader.SizeOfImage += pSection-&amp;gt;&lt;span&gt;Misc.VirtualSize;
&lt;/span&gt;&lt;span&gt; 707&lt;/span&gt; 
&lt;span&gt; 708&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (iAddSrcLen != pSection-&amp;gt;SizeOfRawData)&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“æ–°å¢é•¿åº¦ä¸å¯¹é½åçš„èŠ‚é•¿åº¦ä¸ç›¸ç­‰æ—¶ï¼Œå°†å…¶è¡¥å…¨&lt;/span&gt;
&lt;span&gt; 709&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 710&lt;/span&gt;             &lt;span&gt;int&lt;/span&gt; iLenth = pSection-&amp;gt;SizeOfRawData;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å…ˆä¿å­˜ï¼Œä»¥å…æ‰©å®¹ååŸåœ°å€è¢«å›æ”¶
&lt;/span&gt;&lt;span&gt; 711&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;g_pFileSrc = (UCHAR*)realloc(g_pFileSrc, g_iFileSize + iLenth);&lt;/span&gt;
&lt;span&gt; 712&lt;/span&gt;             UCHAR *uuu = (UCHAR*)&lt;span&gt;malloc&lt;/span&gt;(g_iFileSize +&lt;span&gt; iAddSrcLen);
&lt;/span&gt;&lt;span&gt; 713&lt;/span&gt;             memcpy(uuu, g_pFileSrc, g_iFileSize +&lt;span&gt; iAddSrcLen);
&lt;/span&gt;&lt;span&gt; 714&lt;/span&gt;             g_pFileSrc = (UCHAR*)&lt;span&gt;malloc&lt;/span&gt;(g_iFileSize +&lt;span&gt; iLenth);
&lt;/span&gt;&lt;span&gt; 715&lt;/span&gt;             memcpy(g_pFileSrc, uuu, g_iFileSize +&lt;span&gt; iAddSrcLen);
&lt;/span&gt;&lt;span&gt; 716&lt;/span&gt;             memset(g_pFileSrc + g_iFileSize + iAddSrcLen, &lt;span&gt;0&lt;/span&gt;, iLenth -&lt;span&gt; iAddSrcLen);
&lt;/span&gt;&lt;span&gt; 717&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 718&lt;/span&gt;         g_iFileSize += pSection-&amp;gt;&lt;span&gt;SizeOfRawData;
&lt;/span&gt;&lt;span&gt; 719&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 720&lt;/span&gt; 
&lt;span&gt; 721&lt;/span&gt; 
&lt;span&gt; 722&lt;/span&gt; 
&lt;span&gt; 723&lt;/span&gt;     &lt;span&gt;///////////////////////////////////////////////////////////////////////////&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;
&lt;span&gt; 724&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“æœ‰é‡å®šä½è¡¨æ—¶ï¼Œå…ˆä¿å­˜ç›¸å…³æ•°æ®ï¼Œåˆ é™¤é‡å®šä½è¡¨ï¼Œæ–°å¢èŠ‚ï¼Œå†åœ¨åé¢è¿˜åŸé‡å®šä½è¡¨&lt;/span&gt;
&lt;span&gt; 725&lt;/span&gt;     &lt;span&gt;else&lt;/span&gt;
&lt;span&gt; 726&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt; 727&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æŠŠé‡å®šä½è¡¨æ•°æ®ç§»åŠ¨åˆ°æ–°èŠ‚å½“ä¸­
&lt;/span&gt;&lt;span&gt; 728&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å–ä½ç½®å’Œé•¿åº¦&lt;/span&gt;
&lt;span&gt; 729&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iRelocationAddr = pNtHead-&amp;gt;OptionalHeader.DataDirectory[&lt;span&gt;5&lt;/span&gt;&lt;span&gt;].VirtualAddress;
&lt;/span&gt;&lt;span&gt; 730&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iRelocationLenth = pNtHead-&amp;gt;OptionalHeader.DataDirectory[&lt;span&gt;5&lt;/span&gt;].Size;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ•°æ®é•¿åº¦&lt;/span&gt;
&lt;span&gt; 731&lt;/span&gt;         &lt;span&gt;char&lt;/span&gt; *szR_Src = (&lt;span&gt;char&lt;/span&gt;*)&lt;span&gt;malloc&lt;/span&gt;&lt;span&gt;(iRelocationLenth);
&lt;/span&gt;&lt;span&gt; 732&lt;/span&gt;         memcpy(szR_Src, (&lt;span&gt;char&lt;/span&gt;*&lt;span&gt;)RVAtoFA(iRelocationAddr), iRelocationLenth);
&lt;/span&gt;&lt;span&gt; 733&lt;/span&gt;         
&lt;span&gt; 734&lt;/span&gt;         PIMAGE_SECTION_HEADER pSection = (PIMAGE_SECTION_HEADER)((DWORD)&amp;amp;pNtHead-&amp;gt;OptionalHeader + pNtHead-&amp;gt;&lt;span&gt;FileHeader.SizeOfOptionalHeader);
&lt;/span&gt;&lt;span&gt; 735&lt;/span&gt;         &lt;span&gt;char&lt;/span&gt; szR_Name[&lt;span&gt;8&lt;/span&gt;] = { &lt;span&gt;0&lt;/span&gt;&lt;span&gt; };
&lt;/span&gt;&lt;span&gt; 736&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iR_MapLenth = &lt;span&gt;0&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;èŠ‚ä¸­æ˜ å°„é•¿åº¦&lt;/span&gt;
&lt;span&gt; 737&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iR_FileLenth = &lt;span&gt;0&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;èŠ‚ä¸­æ–‡ä»¶é•¿åº¦&lt;/span&gt;
&lt;span&gt; 738&lt;/span&gt;         &lt;span&gt;while&lt;/span&gt; (&lt;span&gt;1&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 739&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 740&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (pSection-&amp;gt;VirtualAddress == iRelocationAddr) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å®šä½åˆ°é‡å®šä½è¡¨èŠ‚è¡¨&lt;/span&gt;
&lt;span&gt; 741&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt; 742&lt;/span&gt;                 strcpy(szR_Name, (&lt;span&gt;char&lt;/span&gt;*)pSection-&amp;gt;&lt;span&gt;Name);
&lt;/span&gt;&lt;span&gt; 743&lt;/span&gt;                 iR_MapLenth = pSection-&amp;gt;&lt;span&gt;Misc.VirtualSize;
&lt;/span&gt;&lt;span&gt; 744&lt;/span&gt;                 iR_FileLenth = pSection-&amp;gt;&lt;span&gt;SizeOfRawData;
&lt;/span&gt;&lt;span&gt; 745&lt;/span&gt;                 &lt;span&gt;break&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 746&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt; 747&lt;/span&gt;             pSection++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 748&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 749&lt;/span&gt; 
&lt;span&gt; 750&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;åˆ é™¤é‡å®šä½è¡¨ç›¸å…³ä¿¡æ¯&lt;/span&gt;
&lt;span&gt; 751&lt;/span&gt;         memset(g_pFileSrc + g_iFileSize - iR_FileLenth, &lt;span&gt;0&lt;/span&gt;, iR_FileLenth);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æŠŠé‡å®šä½è¡¨æ•°æ®ç”¨0è¦†ç›–&lt;/span&gt;
&lt;span&gt; 752&lt;/span&gt;         memset(pSection, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;sizeof&lt;/span&gt;&lt;span&gt;(IMAGE_SECTION_HEADER));
&lt;/span&gt;&lt;span&gt; 753&lt;/span&gt;         pNtHead-&amp;gt;FileHeader.NumberOfSections--&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 754&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è°ƒæ•´æ–‡ä»¶å†…å­˜å¤§å°&lt;/span&gt;
&lt;span&gt; 755&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iAlignmentSize = iR_MapLenth %&lt;span&gt; g_iSectionAlignment;
&lt;/span&gt;&lt;span&gt; 756&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (!&lt;span&gt;iAlignmentSize)
&lt;/span&gt;&lt;span&gt; 757&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 758&lt;/span&gt;             pNtHead-&amp;gt;OptionalHeader.SizeOfImage -= iR_MapLenth;        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è°ƒæ•´æ–‡ä»¶å†…å­˜å¤§å°&lt;/span&gt;
&lt;span&gt; 759&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 760&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;
&lt;span&gt; 761&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 762&lt;/span&gt;             pNtHead-&amp;gt;OptionalHeader.SizeOfImage =
&lt;span&gt; 763&lt;/span&gt;                 pNtHead-&amp;gt;&lt;span&gt;OptionalHeader.SizeOfImage
&lt;/span&gt;&lt;span&gt; 764&lt;/span&gt;                 - (iR_MapLenth - iAlignmentSize +&lt;span&gt; g_iSectionAlignment);
&lt;/span&gt;&lt;span&gt; 765&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 766&lt;/span&gt;         g_iFileSize -=&lt;span&gt; iR_FileLenth;
&lt;/span&gt;&lt;span&gt; 767&lt;/span&gt; 
&lt;span&gt; 768&lt;/span&gt; 
&lt;span&gt; 769&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ–°å¢èŠ‚&lt;/span&gt;
&lt;span&gt; 770&lt;/span&gt;         pSection = (PIMAGE_SECTION_HEADER)((DWORD)&amp;amp;pNtHead-&amp;gt;OptionalHeader + pNtHead-&amp;gt;&lt;span&gt;FileHeader.SizeOfOptionalHeader);
&lt;/span&gt;&lt;span&gt; 771&lt;/span&gt;         pSection += pNtHead-&amp;gt;FileHeader.NumberOfSections - &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 772&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iNewSectionFileAddr = pSection-&amp;gt;PointerToRawData + pSection-&amp;gt;&lt;span&gt;SizeOfRawData;
&lt;/span&gt;&lt;span&gt; 773&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iNewSectionFileMapAddr = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 774&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (!(pSection-&amp;gt;Misc.VirtualSize %&lt;span&gt; g_iSectionAlignment))
&lt;/span&gt;&lt;span&gt; 775&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 776&lt;/span&gt;             iNewSectionFileMapAddr = pSection-&amp;gt;VirtualAddress + pSection-&amp;gt;&lt;span&gt;Misc.VirtualSize;
&lt;/span&gt;&lt;span&gt; 777&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 778&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;
&lt;span&gt; 779&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 780&lt;/span&gt;             iNewSectionFileMapAddr = pSection-&amp;gt;VirtualAddress + pSection-&amp;gt;&lt;span&gt;Misc.VirtualSize
&lt;/span&gt;&lt;span&gt; 781&lt;/span&gt;                 + g_iSectionAlignment - (pSection-&amp;gt;Misc.VirtualSize %&lt;span&gt; g_iSectionAlignment);
&lt;/span&gt;&lt;span&gt; 782&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 783&lt;/span&gt; 
&lt;span&gt; 784&lt;/span&gt;         pSection++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 785&lt;/span&gt;         memcpy(pSection-&amp;gt;Name, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;.KD&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;3&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 786&lt;/span&gt;         pSection-&amp;gt;VirtualAddress =&lt;span&gt; iNewSectionFileMapAddr;
&lt;/span&gt;&lt;span&gt; 787&lt;/span&gt;         pSection-&amp;gt;PointerToRawData =&lt;span&gt; iNewSectionFileAddr;
&lt;/span&gt;&lt;span&gt; 788&lt;/span&gt;         pSection-&amp;gt;Characteristics = (&lt;span&gt;0x20000000&lt;/span&gt; | &lt;span&gt;0x40000000&lt;/span&gt; | &lt;span&gt;0x80000000&lt;/span&gt; | &lt;span&gt;0x40&lt;/span&gt;); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;èŠ‚å±æ€§ å¯è¯»å¯å†™å¯æ‰§è¡Œå·²è¢«åˆå§‹åŒ–&lt;/span&gt;
&lt;span&gt; 789&lt;/span&gt;         pNtHead-&amp;gt;FileHeader.NumberOfSections += &lt;span&gt;1&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;èŠ‚è¡¨æ•°é‡+1
&lt;/span&gt;&lt;span&gt; 790&lt;/span&gt; 
&lt;span&gt; 791&lt;/span&gt; 
&lt;span&gt; 792&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°†IATçš„æ•°æ®å‹å…¥æ–°èŠ‚ä¸­æ•°æ®æ’åˆ—åˆ†åˆ«ä¸ºDLLæ•°é‡(2å­—èŠ‚)ã€DLLåå­—é•¿åº¦ã€è¯¥&lt;/span&gt;
&lt;span&gt; 793&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iAddIatLenth = &lt;span&gt;0&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å·²ç»å¢åŠ çš„iatæ•°æ®é•¿åº¦
&lt;/span&gt;&lt;span&gt; 794&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å…ˆæ·»åŠ 1å­—èŠ‚æ•°æ®è¯´æ˜è¯¥ç¨‹åºçš„DLLæ•°é‡&lt;/span&gt;
&lt;span&gt; 795&lt;/span&gt;         g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth + &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 796&lt;/span&gt;         &lt;span&gt;byte&lt;/span&gt; bDllNum =&lt;span&gt; g_tagDllFunc.size();
&lt;/span&gt;&lt;span&gt; 797&lt;/span&gt;         memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, &amp;amp;bDllNum, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 798&lt;/span&gt;         iAddIatLenth += &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 799&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; bDllNum; i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 800&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 801&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ·»åŠ DLLåé•¿åº¦&lt;/span&gt;
&lt;span&gt; 802&lt;/span&gt;             &lt;span&gt;byte&lt;/span&gt; bDllNameLenth =&lt;span&gt; g_tagDllFunc[i].bDllNameLenth;
&lt;/span&gt;&lt;span&gt; 803&lt;/span&gt;             g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth + &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 804&lt;/span&gt;             memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, &amp;amp;bDllNameLenth, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 805&lt;/span&gt;             iAddIatLenth += &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 806&lt;/span&gt; 
&lt;span&gt; 807&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ·»åŠ DLLå&lt;/span&gt;
&lt;span&gt; 808&lt;/span&gt;             g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth +&lt;span&gt; bDllNameLenth);
&lt;/span&gt;&lt;span&gt; 809&lt;/span&gt;             memcpy(g_pFileSrc + g_iFileSize +&lt;span&gt; iAddIatLenth, g_tagDllFunc[i].szDllName, bDllNameLenth);
&lt;/span&gt;&lt;span&gt; 810&lt;/span&gt;             iAddIatLenth +=&lt;span&gt; bDllNameLenth;
&lt;/span&gt;&lt;span&gt; 811&lt;/span&gt; 
&lt;span&gt; 812&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ·»åŠ è¯¥DLLä¸­çš„å¯¼å…¥å‡½æ•°æ•°é‡  æ–¹ä¾¿åç»­éå†&lt;/span&gt;
&lt;span&gt; 813&lt;/span&gt;             g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth + &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 814&lt;/span&gt;             memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, (DWORD*)&amp;amp;g_tagDllFunc[i].wFuncNum, &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 815&lt;/span&gt;             iAddIatLenth += &lt;span&gt;2&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 816&lt;/span&gt; 
&lt;span&gt; 817&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ·»åŠ è¯¥DLLçš„å¯¼å…¥æ–¹å¼ 0ä¸ºåºå·1ä¸ºåç§°&lt;/span&gt;
&lt;span&gt; 818&lt;/span&gt;             g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth + &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 819&lt;/span&gt;             memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, (&lt;span&gt;byte&lt;/span&gt;*)&amp;amp;g_tagDllFunc[i].bTab, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 820&lt;/span&gt;             iAddIatLenth += &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 821&lt;/span&gt;             &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; j = &lt;span&gt;0&lt;/span&gt;; j &amp;lt; g_tagDllFunc[i].wFuncNum; j++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 822&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt; 823&lt;/span&gt;                 &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ·»åŠ å‡½æ•°åæˆ–åºå·&lt;/span&gt;
&lt;span&gt; 824&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt; (!(g_tagDllFunc[i].bTab)) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;åºå·&lt;/span&gt;
&lt;span&gt; 825&lt;/span&gt; &lt;span&gt;                {
&lt;/span&gt;&lt;span&gt; 826&lt;/span&gt;                     g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth + &lt;span&gt;5&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;1é•¿åº¦4åºå·&lt;/span&gt;
&lt;span&gt; 827&lt;/span&gt;                     memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, (BYTE*)&amp;amp;g_tagDllFunc[i].vFuncNAMEorNo[j].iFuncNameLenth, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 828&lt;/span&gt;                     iAddIatLenth += &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 829&lt;/span&gt;                     memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, (DWORD*)&amp;amp;g_tagDllFunc[i].vFuncNAMEorNo[j].szFuncName, &lt;span&gt;4&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 830&lt;/span&gt;                     iAddIatLenth += &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 831&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt; 832&lt;/span&gt;                 &lt;span&gt;else&lt;/span&gt;  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;åå­—&lt;/span&gt;
&lt;span&gt; 833&lt;/span&gt; &lt;span&gt;                {
&lt;/span&gt;&lt;span&gt; 834&lt;/span&gt;                     &lt;span&gt;int&lt;/span&gt; iFuncNameLenth = g_tagDllFunc[i].vFuncNAMEorNo[j].iFuncNameLenth;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;é•¿åº¦&lt;/span&gt;
&lt;span&gt; 835&lt;/span&gt;                     g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth + &lt;span&gt;1&lt;/span&gt; + iFuncNameLenth);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å‰2å­—èŠ‚å­˜æ”¾é•¿åº¦ åé¢ä¸ºå‡½æ•°åç§°&lt;/span&gt;
&lt;span&gt; 836&lt;/span&gt;                     memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth, (BYTE*)&amp;amp;iFuncNameLenth, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 837&lt;/span&gt;                     iAddIatLenth += &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 838&lt;/span&gt;                     memcpy(g_pFileSrc + g_iFileSize +&lt;span&gt; iAddIatLenth, g_tagDllFunc[i].vFuncNAMEorNo[j].szFuncName, iFuncNameLenth);
&lt;/span&gt;&lt;span&gt; 839&lt;/span&gt;                     iAddIatLenth +=&lt;span&gt; iFuncNameLenth;
&lt;/span&gt;&lt;span&gt; 840&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt; 841&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt; 842&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 843&lt;/span&gt; 
&lt;span&gt; 844&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å­˜æ”¾åŠ è½½çš„å‡½æ•°åœ°å€è¡¨çš„RVA&lt;/span&gt;
&lt;span&gt; 845&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iLoadAddressTabRVA = iNewSectionFileMapAddr +&lt;span&gt; iAddIatLenth;
&lt;/span&gt;&lt;span&gt; 846&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iLoadIatLenth = g_IATaddrList.size() * &lt;span&gt;4&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç”¨äºå­˜æ”¾åŠ è½½çš„å‡½æ•°åœ°å€è¡¨é•¿åº¦  æ­¤å¤„å¤š4å­—èŠ‚æ¥å­˜æ”¾åŸºå€
&lt;/span&gt;&lt;span&gt; 847&lt;/span&gt; 
&lt;span&gt; 848&lt;/span&gt; 
&lt;span&gt; 849&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å–æ–°çš„OEPå¹¶ä¿®æ”¹æ—§çš„OEP&lt;/span&gt;
&lt;span&gt; 850&lt;/span&gt;         g_iNewOEP = iNewSectionFileMapAddr + iAddIatLenth +&lt;span&gt; iLoadIatLenth;
&lt;/span&gt;&lt;span&gt; 851&lt;/span&gt;         pDosHead =&lt;span&gt; (PIMAGE_DOS_HEADER)g_pFileSrc;
&lt;/span&gt;&lt;span&gt; 852&lt;/span&gt;         pNtHead = (PIMAGE_NT_HEADERS)((DWORD)pDosHead + pDosHead-&amp;gt;&lt;span&gt;e_lfanew);
&lt;/span&gt;&lt;span&gt; 853&lt;/span&gt;          pNtHead-&amp;gt;OptionalHeader.AddressOfEntryPoint =&lt;span&gt; g_iNewOEP;
&lt;/span&gt;&lt;span&gt; 854&lt;/span&gt; 
&lt;span&gt; 855&lt;/span&gt; &lt;span&gt;        JitRuntime        _x86RunTimeObject;
&lt;/span&gt;&lt;span&gt; 856&lt;/span&gt;         X86Assembler    a(&amp;amp;&lt;span&gt;_x86RunTimeObject);
&lt;/span&gt;&lt;span&gt; 857&lt;/span&gt; 
&lt;span&gt; 858&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·³è½¬æ ‡è®°&lt;/span&gt;
&lt;span&gt; 859&lt;/span&gt;         Label LoadDllBegin =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt; 860&lt;/span&gt;         Label LoadDllOver =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt; 861&lt;/span&gt;         
&lt;span&gt; 862&lt;/span&gt;         Label NameExport =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt; 863&lt;/span&gt;         Label NameExportBegin =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt; 864&lt;/span&gt;         Label NameExportOver =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt; 865&lt;/span&gt;         Label NoExportBegin =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt; 866&lt;/span&gt;         Label NoExportOver =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt; 867&lt;/span&gt; 
&lt;span&gt; 868&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;test&lt;/span&gt;
&lt;span&gt; 869&lt;/span&gt;         Label lTest =&lt;span&gt; a.newLabel();
&lt;/span&gt;&lt;span&gt; 870&lt;/span&gt;         
&lt;span&gt; 871&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“æœ‰é‡å®šä½è¡¨æ—¶ï¼Œå°†NewOEP+1æ–°å¢åˆ°é‡å®šä½é¡¹ä¸­ï¼Œé‡å®šä½åçš„åœ°å€-OldOEPå³å¯å¾—åˆ°æ–°çš„åŸºå€
&lt;/span&gt;&lt;span&gt; 872&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è¿™é‡Œpush g_iOldOEP + g_iImageBaseè€Œä¸æ˜¯g_iImageBase(ç›´æ¥å¾—åˆ°æ–°åŸºå€ ä¸ç”¨å†-æ—§OEP)ï¼Œæ˜¯å› ä¸ºpushå®Œè¿˜è¦retåˆ°æ—§OEP
&lt;/span&gt;&lt;span&gt; 873&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ‰§è¡Œå®Œè¿™æ®µåï¼Œæ ˆä¸Šæ˜¯æ—§OEPçš„åœ°å€ï¼Œebxæ˜¯ç¨‹åºåŸºå€&lt;/span&gt;
&lt;span&gt; 874&lt;/span&gt;         a.push(g_iOldOEP +&lt;span&gt; g_iImageBase);
&lt;/span&gt;&lt;span&gt; 875&lt;/span&gt; &lt;span&gt;        a.mov(ebx, dword_ptr(esp));
&lt;/span&gt;&lt;span&gt; 876&lt;/span&gt; &lt;span&gt;        a.sub(ebx, g_iOldOEP);
&lt;/span&gt;&lt;span&gt; 877&lt;/span&gt;         
&lt;span&gt; 878&lt;/span&gt;         &lt;span&gt;/*&lt;/span&gt;&lt;span&gt;a.call(lTest);
&lt;/span&gt;&lt;span&gt; 879&lt;/span&gt; &lt;span&gt;        a.bind(lTest);
&lt;/span&gt;&lt;span&gt; 880&lt;/span&gt; &lt;span&gt;        a.pop(eax);&lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt; 881&lt;/span&gt; 
&lt;span&gt; 882&lt;/span&gt; &lt;span&gt;        a.pusha();
&lt;/span&gt;&lt;span&gt; 883&lt;/span&gt;         a.push(ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°†ç¨‹åºåŸºå€ä¿å­˜åˆ°æ ˆä¸Š&lt;/span&gt;
&lt;span&gt; 884&lt;/span&gt;         a.sub(esp, &lt;span&gt;0x8&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 885&lt;/span&gt;         a.mov(ebp, esp); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ebpä»ä¸Šå¾€ä¸‹åˆ†åˆ«æ˜¯LoadLibraryAå‡½æ•°åœ°å€ã€GetProcAddresså‡½æ•°åœ°å€å’Œç¨‹åºåŸºå€  ebp-4ä¸ºDllåŸºå€ -8ä¸ºå¡«å……å‡½æ•°åŠ è½½åœ°å€èµ·å§‹åœ°å€&lt;/span&gt;
&lt;span&gt; 886&lt;/span&gt;         a.sub(esp, &lt;span&gt;0x8&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 887&lt;/span&gt;         
&lt;span&gt; 888&lt;/span&gt; &lt;span&gt;        GetKernel32Base(a);
&lt;/span&gt;&lt;span&gt; 889&lt;/span&gt;         a.mov(edi, eax);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ediä¸ºæ‰€éå†åˆ°çš„DLLåŸºå€
&lt;/span&gt;&lt;span&gt; 890&lt;/span&gt; 
&lt;span&gt; 891&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è®¡ç®—å‡½æ•°åœ°å€&lt;/span&gt;
&lt;span&gt; 892&lt;/span&gt; &lt;span&gt;        GetLoadLibraryAAddr(a);
&lt;/span&gt;&lt;span&gt; 893&lt;/span&gt;         a.mov(dword_ptr(ebp, &lt;span&gt;0&lt;/span&gt;), eax);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¿å­˜LoadLibraryAçš„å€¼åˆ°æ ˆä¸Š&lt;/span&gt;
&lt;span&gt; 894&lt;/span&gt; &lt;span&gt;        GetGetProcAddressAddr(a);
&lt;/span&gt;&lt;span&gt; 895&lt;/span&gt;         a.mov(dword_ptr(ebp, &lt;span&gt;4&lt;/span&gt;), eax);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¿å­˜GetProcAddressçš„å€¼åˆ°æ ˆä¸Š&lt;/span&gt;
&lt;span&gt; 896&lt;/span&gt; &lt;span&gt;        a.mov(eax, iLoadAddressTabRVA);
&lt;/span&gt;&lt;span&gt; 897&lt;/span&gt;         a.add(eax, dword_ptr(ebp, &lt;span&gt;8&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¡«å……å‡½æ•°åœ°å€RVA+ç¨‹åºåŸºå€&lt;/span&gt;
&lt;span&gt; 898&lt;/span&gt;         a.mov(dword_ptr(ebp, -&lt;span&gt;8&lt;/span&gt;), eax);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ”¾åˆ°ebp-8çš„åœ°å€ä¸Š
&lt;/span&gt;&lt;span&gt; 899&lt;/span&gt; 
&lt;span&gt; 900&lt;/span&gt; 
&lt;span&gt; 901&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¼€å§‹éå†IATæ•°æ®ï¼Œå¡«å……å‡½æ•°åŠ è½½åœ°å€è¡¨&lt;/span&gt;
&lt;span&gt; 902&lt;/span&gt; &lt;span&gt;        a.mov(esi, iNewSectionFileMapAddr);
&lt;/span&gt;&lt;span&gt; 903&lt;/span&gt;         a.add(esi, dword_ptr(ebp, &lt;span&gt;8&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;esiä¸ºIATæ•°æ®èµ·ç‚¹&lt;/span&gt;
&lt;span&gt; 904&lt;/span&gt;         a.mov(ebx, &lt;span&gt;1&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä»¥ebxå¼€å§‹éå†  è¾¾åˆ°é•¿åº¦ é€€å‡º
&lt;/span&gt;&lt;span&gt; 905&lt;/span&gt; 
&lt;span&gt; 906&lt;/span&gt; 
&lt;span&gt; 907&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;åŠ è½½DLL&lt;/span&gt;
&lt;span&gt; 908&lt;/span&gt; &lt;span&gt;        a.bind(LoadDllBegin);
&lt;/span&gt;&lt;span&gt; 909&lt;/span&gt;         a.cmp(ebx, iAddIatLenth);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¦‚æœéå†é•¿åº¦å¤§äºç­‰äºIATæ•°æ®é•¿åº¦&lt;/span&gt;
&lt;span&gt; 910&lt;/span&gt; &lt;span&gt;        a.jnl(LoadDllOver);
&lt;/span&gt;&lt;span&gt; 911&lt;/span&gt;         a.movzx(ecx, byte_ptr(esi, ebx));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–å¾—DLLåé•¿åº¦&lt;/span&gt;
&lt;span&gt; 912&lt;/span&gt;         a.add(ebx, &lt;span&gt;1&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;+Dllåé•¿åº¦çš„å˜é‡1&lt;/span&gt;
&lt;span&gt; 913&lt;/span&gt;         a.lea(eax, dword_ptr(esi,ebx));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å¾—å‡½æ•°ååœ°å€&lt;/span&gt;
&lt;span&gt; 914&lt;/span&gt; &lt;span&gt;        a.push(eax);
&lt;/span&gt;&lt;span&gt; 915&lt;/span&gt;         a.add(ebx, ecx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;+DLLåé•¿åº¦&lt;/span&gt;
&lt;span&gt; 916&lt;/span&gt;         a.mov(eax, dword_ptr(ebp));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å¾—loadlibraryåœ°å€&lt;/span&gt;
&lt;span&gt; 917&lt;/span&gt; &lt;span&gt;        a.call(eax);
&lt;/span&gt;&lt;span&gt; 918&lt;/span&gt;         a.mov(dword_ptr(ebp,-&lt;span&gt;4&lt;/span&gt;),eax);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ebpä¸ºload.. +4ä¸ºget.. +8ä¸ºç¨‹åºåŸºå€  -4ä¸ºå½“å‰DllåŸºå€ -8ä¸ºå¡«å……å‡½æ•°åŠ è½½åœ°å€ä½ç½®&lt;/span&gt;
&lt;span&gt; 919&lt;/span&gt;         a.movzx(edi, word_ptr(esi, ebx));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–å‡ºè¯¥DLLå¯¼å‡ºå‡½æ•°æ•°é‡&lt;/span&gt;
&lt;span&gt; 920&lt;/span&gt;         a.add(ebx, &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 921&lt;/span&gt;         a.movzx(edx, byte_ptr(esi, ebx));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–å‡ºå¯¼å‡ºæ–¹å¼&lt;/span&gt;
&lt;span&gt; 922&lt;/span&gt;         a.add(ebx, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 923&lt;/span&gt;         a.cmp(edx, &lt;span&gt;1&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¸º1æ—¶ï¼Œåç§°å¯¼å‡º&lt;/span&gt;
&lt;span&gt; 924&lt;/span&gt; &lt;span&gt;        a.je(NameExportBegin);
&lt;/span&gt;&lt;span&gt; 925&lt;/span&gt; 
&lt;span&gt; 926&lt;/span&gt; 
&lt;span&gt; 927&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;åºå·å¯¼å‡º&lt;/span&gt;
&lt;span&gt; 928&lt;/span&gt;         a.bind(NoExportBegin);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;åºå·å¯¼å‡ºå¾ªç¯èµ·ç‚¹&lt;/span&gt;
&lt;span&gt; 929&lt;/span&gt;         a.cmp(edi, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 930&lt;/span&gt; &lt;span&gt;        a.je(NoExportOver);
&lt;/span&gt;&lt;span&gt; 931&lt;/span&gt;         a.add(ebx, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 932&lt;/span&gt;         a.mov(eax, dword_ptr(esi, ebx));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–å¾—åºå·&lt;/span&gt;
&lt;span&gt; 933&lt;/span&gt;         a.add(ebx, &lt;span&gt;4&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 934&lt;/span&gt; &lt;span&gt;        a.push(eax);
&lt;/span&gt;&lt;span&gt; 935&lt;/span&gt;         a.push(dword_ptr(ebp, -&lt;span&gt;4&lt;/span&gt;&lt;span&gt;));
&lt;/span&gt;&lt;span&gt; 936&lt;/span&gt;         a.mov(eax, dword_ptr(ebp, &lt;span&gt;4&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å¾—GetProcAddress&lt;/span&gt;
&lt;span&gt; 937&lt;/span&gt; &lt;span&gt;        a.call(eax);
&lt;/span&gt;&lt;span&gt; 938&lt;/span&gt;         a.mov(edx, dword_ptr(ebp, -&lt;span&gt;8&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–å¾—è£…è½½å‡½æ•°è¡¨&lt;/span&gt;
&lt;span&gt; 939&lt;/span&gt; &lt;span&gt;        a.mov(dword_ptr(edx), eax);
&lt;/span&gt;&lt;span&gt; 940&lt;/span&gt;         a.add(dword_ptr(ebp, -&lt;span&gt;8&lt;/span&gt;), &lt;span&gt;4&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è£…è½½å‡½æ•°è¡¨RVA+4&lt;/span&gt;
&lt;span&gt; 941&lt;/span&gt;         a.sub(edi, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 942&lt;/span&gt; &lt;span&gt;        a.jmp(NoExportBegin);
&lt;/span&gt;&lt;span&gt; 943&lt;/span&gt;         a.bind(NoExportOver);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;åºå·å¯¼å‡ºå¾ªç¯ç»ˆç‚¹&lt;/span&gt;
&lt;span&gt; 944&lt;/span&gt;         a.jmp(LoadDllBegin); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;é‡æ–°åŠ è½½æ–°DLL
&lt;/span&gt;&lt;span&gt; 945&lt;/span&gt; 
&lt;span&gt; 946&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;åç§°å¯¼å‡º&lt;/span&gt;
&lt;span&gt; 947&lt;/span&gt;         a.bind(NameExportBegin);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;åç§°å¯¼å‡ºå¾ªç¯èµ·ç‚¹&lt;/span&gt;
&lt;span&gt; 948&lt;/span&gt;         a.cmp(edi, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 949&lt;/span&gt; &lt;span&gt;        a.je(NameExportOver);
&lt;/span&gt;&lt;span&gt; 950&lt;/span&gt;         a.movzx(ecx, byte_ptr(esi, ebx));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–å¾—åç§°é•¿åº¦&lt;/span&gt;
&lt;span&gt; 951&lt;/span&gt;         a.add(ebx, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 952&lt;/span&gt;         a.lea(eax, dword_ptr(esi, ebx));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;åç§°åœ°å€&lt;/span&gt;
&lt;span&gt; 953&lt;/span&gt; &lt;span&gt;        a.push(eax);
&lt;/span&gt;&lt;span&gt; 954&lt;/span&gt; &lt;span&gt;        a.add(ebx, ecx);
&lt;/span&gt;&lt;span&gt; 955&lt;/span&gt;         a.push(dword_ptr(ebp, -&lt;span&gt;4&lt;/span&gt;&lt;span&gt;));
&lt;/span&gt;&lt;span&gt; 956&lt;/span&gt;         a.mov(eax, dword_ptr(ebp, &lt;span&gt;4&lt;/span&gt;&lt;span&gt;));
&lt;/span&gt;&lt;span&gt; 957&lt;/span&gt; &lt;span&gt;        a.call(eax);
&lt;/span&gt;&lt;span&gt; 958&lt;/span&gt;         a.mov(edx, dword_ptr(ebp, -&lt;span&gt;8&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–å¾—è£…è½½å‡½æ•°è¡¨&lt;/span&gt;
&lt;span&gt; 959&lt;/span&gt; &lt;span&gt;        a.mov(dword_ptr(edx), eax);
&lt;/span&gt;&lt;span&gt; 960&lt;/span&gt;         a.add(dword_ptr(ebp, -&lt;span&gt;8&lt;/span&gt;), &lt;span&gt;4&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è£…è½½å‡½æ•°è¡¨RVA+4&lt;/span&gt;
&lt;span&gt; 961&lt;/span&gt;         a.sub(edi, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 962&lt;/span&gt; &lt;span&gt;        a.jmp(NameExportBegin);
&lt;/span&gt;&lt;span&gt; 963&lt;/span&gt;         a.bind(NameExportOver);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;åç§°å¯¼å‡ºå¾ªç¯ç»ˆç‚¹&lt;/span&gt;
&lt;span&gt; 964&lt;/span&gt;         a.jmp(LoadDllBegin); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;é‡æ–°åŠ è½½æ–°DLL&lt;/span&gt;
&lt;span&gt; 965&lt;/span&gt;         
&lt;span&gt; 966&lt;/span&gt; 
&lt;span&gt; 967&lt;/span&gt;         
&lt;span&gt; 968&lt;/span&gt;         &lt;span&gt;/////////&lt;/span&gt;&lt;span&gt;//å¼€å§‹æ„é€ æ›¿æ¢è°ƒç”¨ä»£ç çš„shellcode&lt;/span&gt;&lt;span&gt;////////////&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;
&lt;span&gt; 969&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ³¨æ„espä¸ºå½“å‰æ“ä½œçš„æ ˆé¡¶  ebp+8ä¸ºç¨‹åºæ‰€åœ¨åŸºå€&lt;/span&gt;
&lt;span&gt; 970&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iNewJitBeginAddrRva = iNewSectionFileMapAddr + iAddIatLenth + iLoadIatLenth; &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ›¿æ¢çš„shellcodeå¼€å§‹çš„åœ°å€&lt;/span&gt;
&lt;span&gt; 971&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iNewJitLenth =&lt;span&gt; a.getCodeSize();
&lt;/span&gt;&lt;span&gt; 972&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; g_tagIAT.size(); i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 973&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt; 974&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (g_tagIAT[i].bType == &lt;span&gt;0&lt;/span&gt;)    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;EAX&lt;/span&gt;
&lt;span&gt; 975&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt; 976&lt;/span&gt;                 g_tagIAT[i].dwNewIatAddr = iNewSectionFileMapAddr + iAddIatLenth + g_tagIAT[i].wIndex * &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 977&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt; 978&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt; 979&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt; 980&lt;/span&gt; &lt;span&gt;                a.push(esi);
&lt;/span&gt;&lt;span&gt; 981&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;)g_tagIAT[i].dwCallAddr + &lt;span&gt;5&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 982&lt;/span&gt;                 a.mov(esi, g_iImageBase);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç¨‹åºåŸºå€ åç»­ä¼šå°†è¿™ä¸ªä½ç½®æ·»åŠ åˆ°é‡å®šä½å—å¤„ï¼Œè¿è¡Œæ—¶å³å˜ä¸ºç¨‹åºåŸºå€äº†&lt;/span&gt;
&lt;span&gt; 983&lt;/span&gt;                 g_tagIAT[i].dwRelocAddr = iNewJitBeginAddrRva + a.getCodeSize() - &lt;span&gt;4&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;shellcodeå¼€å§‹çš„ä½ç½®+å½“å‰jité•¿åº¦ å†å¾€å›4å­—èŠ‚  å³ä¸ºå­˜æ”¾åŸºå€çš„ä½ç½®&lt;/span&gt;
&lt;span&gt; 984&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt; 985&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0xC&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰æŒ‡ä»¤æ‰€åœ¨RVA+5+ç¨‹åºåŸºå€ =è¿”å›åœ°å€&lt;/span&gt;
&lt;span&gt; 986&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;&lt;span&gt;)g_tagIAT[i].dwNewIatAddr);
&lt;/span&gt;&lt;span&gt; 987&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt; 988&lt;/span&gt; &lt;span&gt;                a.mov(ebx, dword_ptr(ebx));
&lt;/span&gt;&lt;span&gt; 989&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0x8&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä»£æ›¿åŸå‡½æ•°åœ°å€çš„åœ°å€&lt;/span&gt;
&lt;span&gt; 990&lt;/span&gt; &lt;span&gt;                a.pop(esi);
&lt;/span&gt;&lt;span&gt; 991&lt;/span&gt; &lt;span&gt;                a.pop(ebx);
&lt;/span&gt;&lt;span&gt; 992&lt;/span&gt; &lt;span&gt;                a.pop(eax);
&lt;/span&gt;&lt;span&gt; 993&lt;/span&gt; &lt;span&gt;                a.ret();
&lt;/span&gt;&lt;span&gt; 994&lt;/span&gt;                 g_tagIAT[i].dwJmpAddr = iNewJitBeginAddrRva +&lt;span&gt; iNewJitLenth;
&lt;/span&gt;&lt;span&gt; 995&lt;/span&gt;                 iNewJitLenth =&lt;span&gt; a.getCodeSize();
&lt;/span&gt;&lt;span&gt; 996&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt; 997&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_tagIAT[i].bType == &lt;span&gt;1&lt;/span&gt;) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;EDX&lt;/span&gt;
&lt;span&gt; 998&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt; 999&lt;/span&gt;                 g_tagIAT[i].dwNewIatAddr = iNewSectionFileMapAddr + iAddIatLenth + g_tagIAT[i].wIndex * &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1000&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1001&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1002&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1003&lt;/span&gt; &lt;span&gt;                a.push(esi);
&lt;/span&gt;&lt;span&gt;1004&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;)g_tagIAT[i].dwCallAddr + &lt;span&gt;6&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1005&lt;/span&gt;                 a.mov(esi, g_iImageBase);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç¨‹åºåŸºå€ åç»­ä¼šå°†è¿™ä¸ªä½ç½®æ·»åŠ åˆ°é‡å®šä½å—å¤„ï¼Œè¿è¡Œæ—¶å³å˜ä¸ºç¨‹åºåŸºå€äº†&lt;/span&gt;
&lt;span&gt;1006&lt;/span&gt;                 g_tagIAT[i].dwRelocAddr = iNewJitBeginAddrRva + a.getCodeSize() - &lt;span&gt;4&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;shellcodeå¼€å§‹çš„ä½ç½®+å½“å‰jité•¿åº¦ å†å¾€å›4å­—èŠ‚  å³ä¸ºå­˜æ”¾åŸºå€çš„ä½ç½®&lt;/span&gt;
&lt;span&gt;1007&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1008&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0xC&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰æŒ‡ä»¤æ‰€åœ¨RVA+5+ç¨‹åºåŸºå€ =è¿”å›åœ°å€&lt;/span&gt;
&lt;span&gt;1009&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;&lt;span&gt;)g_tagIAT[i].dwNewIatAddr);
&lt;/span&gt;&lt;span&gt;1010&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1011&lt;/span&gt; &lt;span&gt;                a.mov(ebx, dword_ptr(ebx));
&lt;/span&gt;&lt;span&gt;1012&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0x8&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä»£æ›¿åŸå‡½æ•°åœ°å€çš„åœ°å€&lt;/span&gt;
&lt;span&gt;1013&lt;/span&gt; &lt;span&gt;                a.pop(esi);
&lt;/span&gt;&lt;span&gt;1014&lt;/span&gt; &lt;span&gt;                a.pop(ebx);
&lt;/span&gt;&lt;span&gt;1015&lt;/span&gt; &lt;span&gt;                a.pop(edx);
&lt;/span&gt;&lt;span&gt;1016&lt;/span&gt; &lt;span&gt;                a.ret();
&lt;/span&gt;&lt;span&gt;1017&lt;/span&gt;                 g_tagIAT[i].dwJmpAddr = iNewJitBeginAddrRva +&lt;span&gt; iNewJitLenth;
&lt;/span&gt;&lt;span&gt;1018&lt;/span&gt;                 iNewJitLenth =&lt;span&gt; a.getCodeSize();
&lt;/span&gt;&lt;span&gt;1019&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1020&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_tagIAT[i].bType == &lt;span&gt;2&lt;/span&gt;)    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ESP&lt;/span&gt;
&lt;span&gt;1021&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1022&lt;/span&gt;                 g_tagIAT[i].dwNewIatAddr = iNewSectionFileMapAddr + iAddIatLenth + g_tagIAT[i].wIndex * &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1023&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1024&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1025&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1026&lt;/span&gt; &lt;span&gt;                a.push(esi);
&lt;/span&gt;&lt;span&gt;1027&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;)g_tagIAT[i].dwCallAddr + &lt;span&gt;6&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1028&lt;/span&gt;                 a.mov(esi, g_iImageBase);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç¨‹åºåŸºå€ åç»­ä¼šå°†è¿™ä¸ªä½ç½®æ·»åŠ åˆ°é‡å®šä½å—å¤„ï¼Œè¿è¡Œæ—¶å³å˜ä¸ºç¨‹åºåŸºå€äº†&lt;/span&gt;
&lt;span&gt;1029&lt;/span&gt;                 g_tagIAT[i].dwRelocAddr = iNewJitBeginAddrRva + a.getCodeSize() - &lt;span&gt;4&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;shellcodeå¼€å§‹çš„ä½ç½®+å½“å‰jité•¿åº¦ å†å¾€å›4å­—èŠ‚  å³ä¸ºå­˜æ”¾åŸºå€çš„ä½ç½®&lt;/span&gt;
&lt;span&gt;1030&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1031&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0xC&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰æŒ‡ä»¤æ‰€åœ¨RVA+6+ç¨‹åºåŸºå€ =è¿”å›åœ°å€&lt;/span&gt;
&lt;span&gt;1032&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;&lt;span&gt;)g_tagIAT[i].dwNewIatAddr);
&lt;/span&gt;&lt;span&gt;1033&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1034&lt;/span&gt; &lt;span&gt;                a.mov(ebx, dword_ptr(ebx));
&lt;/span&gt;&lt;span&gt;1035&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0x8&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä»£æ›¿åŸå‡½æ•°åœ°å€çš„åœ°å€&lt;/span&gt;
&lt;span&gt;1036&lt;/span&gt; &lt;span&gt;                a.pop(esi);
&lt;/span&gt;&lt;span&gt;1037&lt;/span&gt; &lt;span&gt;                a.pop(ebx);
&lt;/span&gt;&lt;span&gt;1038&lt;/span&gt; &lt;span&gt;                a.pop(esp);
&lt;/span&gt;&lt;span&gt;1039&lt;/span&gt; &lt;span&gt;                a.ret();
&lt;/span&gt;&lt;span&gt;1040&lt;/span&gt;                 g_tagIAT[i].dwJmpAddr = iNewJitBeginAddrRva +&lt;span&gt; iNewJitLenth;
&lt;/span&gt;&lt;span&gt;1041&lt;/span&gt;                 iNewJitLenth =&lt;span&gt; a.getCodeSize();
&lt;/span&gt;&lt;span&gt;1042&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1043&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_tagIAT[i].bType == &lt;span&gt;3&lt;/span&gt;)    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ESI&lt;/span&gt;
&lt;span&gt;1044&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1045&lt;/span&gt;                 g_tagIAT[i].dwNewIatAddr = iNewSectionFileMapAddr + iAddIatLenth + g_tagIAT[i].wIndex * &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1046&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1047&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1048&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1049&lt;/span&gt; &lt;span&gt;                a.push(esi);
&lt;/span&gt;&lt;span&gt;1050&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;&lt;span&gt;)g_tagIAT[i].dwNewIatAddr);
&lt;/span&gt;&lt;span&gt;1051&lt;/span&gt;                 a.mov(esi, g_iImageBase);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç¨‹åºåŸºå€ åç»­ä¼šå°†è¿™ä¸ªä½ç½®æ·»åŠ åˆ°é‡å®šä½å—å¤„ï¼Œè¿è¡Œæ—¶å³å˜ä¸ºç¨‹åºåŸºå€äº†&lt;/span&gt;
&lt;span&gt;1052&lt;/span&gt;                 g_tagIAT[i].dwRelocAddr = iNewJitBeginAddrRva + a.getCodeSize() - &lt;span&gt;4&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;shellcodeå¼€å§‹çš„ä½ç½®+å½“å‰jité•¿åº¦ å†å¾€å›4å­—èŠ‚  å³ä¸ºå­˜æ”¾åŸºå€çš„ä½ç½®&lt;/span&gt;
&lt;span&gt;1053&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1054&lt;/span&gt; &lt;span&gt;                a.mov(ebx, dword_ptr(ebx));
&lt;/span&gt;&lt;span&gt;1055&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0x8&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä»£æ›¿åŸå‡½æ•°åœ°å€çš„åœ°å€&lt;/span&gt;
&lt;span&gt;1056&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;)g_tagIAT[i].dwCallAddr + &lt;span&gt;6&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1057&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1058&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0xC&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰æŒ‡ä»¤æ‰€åœ¨RVA+6+ç¨‹åºåŸºå€ =è¿”å›åœ°å€&lt;/span&gt;
&lt;span&gt;1059&lt;/span&gt; &lt;span&gt;                a.pop(esi);
&lt;/span&gt;&lt;span&gt;1060&lt;/span&gt; &lt;span&gt;                a.pop(ebx);
&lt;/span&gt;&lt;span&gt;1061&lt;/span&gt; &lt;span&gt;                a.pop(esi);
&lt;/span&gt;&lt;span&gt;1062&lt;/span&gt; &lt;span&gt;                a.ret();
&lt;/span&gt;&lt;span&gt;1063&lt;/span&gt;                 g_tagIAT[i].dwJmpAddr = iNewJitBeginAddrRva +&lt;span&gt; iNewJitLenth;
&lt;/span&gt;&lt;span&gt;1064&lt;/span&gt;                 iNewJitLenth =&lt;span&gt; a.getCodeSize();
&lt;/span&gt;&lt;span&gt;1065&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1066&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_tagIAT[i].bType == &lt;span&gt;4&lt;/span&gt;)    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ECX&lt;/span&gt;
&lt;span&gt;1067&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1068&lt;/span&gt;                 g_tagIAT[i].dwNewIatAddr = iNewSectionFileMapAddr + iAddIatLenth + g_tagIAT[i].wIndex * &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1069&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1070&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1071&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1072&lt;/span&gt; &lt;span&gt;                a.push(esi);
&lt;/span&gt;&lt;span&gt;1073&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;)g_tagIAT[i].dwCallAddr + &lt;span&gt;6&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1074&lt;/span&gt;                 a.mov(esi, g_iImageBase);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç¨‹åºåŸºå€ åç»­ä¼šå°†è¿™ä¸ªä½ç½®æ·»åŠ åˆ°é‡å®šä½å—å¤„ï¼Œè¿è¡Œæ—¶å³å˜ä¸ºç¨‹åºåŸºå€äº†&lt;/span&gt;
&lt;span&gt;1075&lt;/span&gt;                 g_tagIAT[i].dwRelocAddr = iNewJitBeginAddrRva + a.getCodeSize() - &lt;span&gt;4&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;shellcodeå¼€å§‹çš„ä½ç½®+å½“å‰jité•¿åº¦ å†å¾€å›4å­—èŠ‚  å³ä¸ºå­˜æ”¾åŸºå€çš„ä½ç½®&lt;/span&gt;
&lt;span&gt;1076&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1077&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0xC&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰æŒ‡ä»¤æ‰€åœ¨RVA+6+ç¨‹åºåŸºå€ =è¿”å›åœ°å€&lt;/span&gt;
&lt;span&gt;1078&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;&lt;span&gt;)g_tagIAT[i].dwNewIatAddr);
&lt;/span&gt;&lt;span&gt;1079&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1080&lt;/span&gt; &lt;span&gt;                a.mov(ebx, dword_ptr(ebx));
&lt;/span&gt;&lt;span&gt;1081&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0x8&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä»£æ›¿åŸå‡½æ•°åœ°å€çš„åœ°å€&lt;/span&gt;
&lt;span&gt;1082&lt;/span&gt; &lt;span&gt;                a.pop(esi);
&lt;/span&gt;&lt;span&gt;1083&lt;/span&gt; &lt;span&gt;                a.pop(ebx);
&lt;/span&gt;&lt;span&gt;1084&lt;/span&gt; &lt;span&gt;                a.pop(ecx);
&lt;/span&gt;&lt;span&gt;1085&lt;/span&gt; &lt;span&gt;                a.ret();
&lt;/span&gt;&lt;span&gt;1086&lt;/span&gt;                 g_tagIAT[i].dwJmpAddr = iNewJitBeginAddrRva +&lt;span&gt; iNewJitLenth;
&lt;/span&gt;&lt;span&gt;1087&lt;/span&gt;                 iNewJitLenth =&lt;span&gt; a.getCodeSize();
&lt;/span&gt;&lt;span&gt;1088&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1089&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_tagIAT[i].bType == &lt;span&gt;5&lt;/span&gt;)    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;EBX&lt;/span&gt;
&lt;span&gt;1090&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1091&lt;/span&gt;                 g_tagIAT[i].dwNewIatAddr = iNewSectionFileMapAddr + iAddIatLenth + g_tagIAT[i].wIndex * &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1092&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1093&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1094&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1095&lt;/span&gt; &lt;span&gt;                a.push(esi);
&lt;/span&gt;&lt;span&gt;1096&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;)g_tagIAT[i].dwCallAddr + &lt;span&gt;6&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1097&lt;/span&gt;                 a.mov(esi, g_iImageBase);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç¨‹åºåŸºå€ åç»­ä¼šå°†è¿™ä¸ªä½ç½®æ·»åŠ åˆ°é‡å®šä½å—å¤„ï¼Œè¿è¡Œæ—¶å³å˜ä¸ºç¨‹åºåŸºå€äº†&lt;/span&gt;
&lt;span&gt;1098&lt;/span&gt;                 g_tagIAT[i].dwRelocAddr = iNewJitBeginAddrRva + a.getCodeSize() - &lt;span&gt;4&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;shellcodeå¼€å§‹çš„ä½ç½®+å½“å‰jité•¿åº¦ å†å¾€å›4å­—èŠ‚  å³ä¸ºå­˜æ”¾åŸºå€çš„ä½ç½®&lt;/span&gt;
&lt;span&gt;1099&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1100&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0xC&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰æŒ‡ä»¤æ‰€åœ¨RVA+6+ç¨‹åºåŸºå€ =è¿”å›åœ°å€&lt;/span&gt;
&lt;span&gt;1101&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;&lt;span&gt;)g_tagIAT[i].dwNewIatAddr);
&lt;/span&gt;&lt;span&gt;1102&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1103&lt;/span&gt; &lt;span&gt;                a.mov(ebx, dword_ptr(ebx));
&lt;/span&gt;&lt;span&gt;1104&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0x8&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä»£æ›¿åŸå‡½æ•°åœ°å€çš„åœ°å€&lt;/span&gt;
&lt;span&gt;1105&lt;/span&gt; &lt;span&gt;                a.pop(esi);
&lt;/span&gt;&lt;span&gt;1106&lt;/span&gt; &lt;span&gt;                a.pop(ebx);
&lt;/span&gt;&lt;span&gt;1107&lt;/span&gt; &lt;span&gt;                a.pop(ebx);
&lt;/span&gt;&lt;span&gt;1108&lt;/span&gt; &lt;span&gt;                a.ret();
&lt;/span&gt;&lt;span&gt;1109&lt;/span&gt;                 g_tagIAT[i].dwJmpAddr = iNewJitBeginAddrRva +&lt;span&gt; iNewJitLenth;
&lt;/span&gt;&lt;span&gt;1110&lt;/span&gt;                 iNewJitLenth =&lt;span&gt; a.getCodeSize();
&lt;/span&gt;&lt;span&gt;1111&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1112&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_tagIAT[i].bType == &lt;span&gt;6&lt;/span&gt;)    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;EBP&lt;/span&gt;
&lt;span&gt;1113&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1114&lt;/span&gt;                 g_tagIAT[i].dwNewIatAddr = iNewSectionFileMapAddr + iAddIatLenth + g_tagIAT[i].wIndex * &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1115&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1116&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1117&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1118&lt;/span&gt; &lt;span&gt;                a.push(esi);
&lt;/span&gt;&lt;span&gt;1119&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;)g_tagIAT[i].dwCallAddr + &lt;span&gt;6&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1120&lt;/span&gt;                 a.mov(esi, g_iImageBase);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç¨‹åºåŸºå€ åç»­ä¼šå°†è¿™ä¸ªä½ç½®æ·»åŠ åˆ°é‡å®šä½å—å¤„ï¼Œè¿è¡Œæ—¶å³å˜ä¸ºç¨‹åºåŸºå€äº†&lt;/span&gt;
&lt;span&gt;1121&lt;/span&gt;                 g_tagIAT[i].dwRelocAddr = iNewJitBeginAddrRva + a.getCodeSize() - &lt;span&gt;4&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;shellcodeå¼€å§‹çš„ä½ç½®+å½“å‰jité•¿åº¦ å†å¾€å›4å­—èŠ‚  å³ä¸ºå­˜æ”¾åŸºå€çš„ä½ç½®&lt;/span&gt;
&lt;span&gt;1122&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1123&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0xC&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰æŒ‡ä»¤æ‰€åœ¨RVA+6+ç¨‹åºåŸºå€ =è¿”å›åœ°å€&lt;/span&gt;
&lt;span&gt;1124&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;&lt;span&gt;)g_tagIAT[i].dwNewIatAddr);
&lt;/span&gt;&lt;span&gt;1125&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1126&lt;/span&gt; &lt;span&gt;                a.mov(ebx, dword_ptr(ebx));
&lt;/span&gt;&lt;span&gt;1127&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0x8&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä»£æ›¿åŸå‡½æ•°åœ°å€çš„åœ°å€&lt;/span&gt;
&lt;span&gt;1128&lt;/span&gt; &lt;span&gt;                a.pop(esi);
&lt;/span&gt;&lt;span&gt;1129&lt;/span&gt; &lt;span&gt;                a.pop(ebx);
&lt;/span&gt;&lt;span&gt;1130&lt;/span&gt; &lt;span&gt;                a.pop(ebp);
&lt;/span&gt;&lt;span&gt;1131&lt;/span&gt; &lt;span&gt;                a.ret();
&lt;/span&gt;&lt;span&gt;1132&lt;/span&gt;                 g_tagIAT[i].dwJmpAddr = iNewJitBeginAddrRva +&lt;span&gt; iNewJitLenth;
&lt;/span&gt;&lt;span&gt;1133&lt;/span&gt;                 iNewJitLenth =&lt;span&gt; a.getCodeSize();
&lt;/span&gt;&lt;span&gt;1134&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1135&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_tagIAT[i].bType == &lt;span&gt;7&lt;/span&gt;)    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;EDI&lt;/span&gt;
&lt;span&gt;1136&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1137&lt;/span&gt;                 g_tagIAT[i].dwNewIatAddr = iNewSectionFileMapAddr + iAddIatLenth + g_tagIAT[i].wIndex * &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1138&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1139&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1140&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1141&lt;/span&gt; &lt;span&gt;                a.push(esi);
&lt;/span&gt;&lt;span&gt;1142&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;)g_tagIAT[i].dwCallAddr + &lt;span&gt;6&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1143&lt;/span&gt;                 a.mov(esi, g_iImageBase);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç¨‹åºåŸºå€ åç»­ä¼šå°†è¿™ä¸ªä½ç½®æ·»åŠ åˆ°é‡å®šä½å—å¤„ï¼Œè¿è¡Œæ—¶å³å˜ä¸ºç¨‹åºåŸºå€äº†&lt;/span&gt;
&lt;span&gt;1144&lt;/span&gt;                 g_tagIAT[i].dwRelocAddr = iNewJitBeginAddrRva + a.getCodeSize() - &lt;span&gt;4&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;shellcodeå¼€å§‹çš„ä½ç½®+å½“å‰jité•¿åº¦ å†å¾€å›4å­—èŠ‚  å³ä¸ºå­˜æ”¾åŸºå€çš„ä½ç½®&lt;/span&gt;
&lt;span&gt;1145&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1146&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0xC&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“å‰æŒ‡ä»¤æ‰€åœ¨RVA+6+ç¨‹åºåŸºå€ =è¿”å›åœ°å€&lt;/span&gt;
&lt;span&gt;1147&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;&lt;span&gt;)g_tagIAT[i].dwNewIatAddr);
&lt;/span&gt;&lt;span&gt;1148&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1149&lt;/span&gt; &lt;span&gt;                a.mov(ebx, dword_ptr(ebx));
&lt;/span&gt;&lt;span&gt;1150&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0x8&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä»£æ›¿åŸå‡½æ•°åœ°å€çš„åœ°å€&lt;/span&gt;
&lt;span&gt;1151&lt;/span&gt; &lt;span&gt;                a.pop(esi);
&lt;/span&gt;&lt;span&gt;1152&lt;/span&gt; &lt;span&gt;                a.pop(ebx);
&lt;/span&gt;&lt;span&gt;1153&lt;/span&gt; &lt;span&gt;                a.pop(edi);
&lt;/span&gt;&lt;span&gt;1154&lt;/span&gt; &lt;span&gt;                a.ret();
&lt;/span&gt;&lt;span&gt;1155&lt;/span&gt;                 g_tagIAT[i].dwJmpAddr = iNewJitBeginAddrRva +&lt;span&gt; iNewJitLenth;
&lt;/span&gt;&lt;span&gt;1156&lt;/span&gt;                 iNewJitLenth =&lt;span&gt; a.getCodeSize();
&lt;/span&gt;&lt;span&gt;1157&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1158&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_tagIAT[i].bType == &lt;span&gt;8&lt;/span&gt;)    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;Call&lt;/span&gt;
&lt;span&gt;1159&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1160&lt;/span&gt;                 g_tagIAT[i].dwNewIatAddr = iNewSectionFileMapAddr + iAddIatLenth + g_tagIAT[i].wIndex * &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1161&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1162&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1163&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1164&lt;/span&gt; &lt;span&gt;                a.push(esi);
&lt;/span&gt;&lt;span&gt;1165&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;&lt;span&gt;)g_tagIAT[i].dwNewIatAddr);
&lt;/span&gt;&lt;span&gt;1166&lt;/span&gt;                 a.mov(esi, g_iImageBase);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç¨‹åºåŸºå€ åç»­ä¼šå°†è¿™ä¸ªä½ç½®æ·»åŠ åˆ°é‡å®šä½å—å¤„ï¼Œè¿è¡Œæ—¶å³å˜ä¸ºç¨‹åºåŸºå€äº†&lt;/span&gt;
&lt;span&gt;1167&lt;/span&gt;                 g_tagIAT[i].dwRelocAddr = iNewJitBeginAddrRva + a.getCodeSize() - &lt;span&gt;4&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;shellcodeå¼€å§‹çš„ä½ç½®+å½“å‰jité•¿åº¦ å†å¾€å›4å­—èŠ‚  å³ä¸ºå­˜æ”¾åŸºå€çš„ä½ç½®&lt;/span&gt;
&lt;span&gt;1168&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1169&lt;/span&gt; &lt;span&gt;                a.mov(ebx, dword_ptr(ebx));
&lt;/span&gt;&lt;span&gt;1170&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;8&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å­˜æ”¾ç›®æ ‡å‡½æ•°åœ°å€çš„åœ°å€çš„RVA&lt;/span&gt;
&lt;span&gt;1171&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;)g_tagIAT[i].dwCallAddr + &lt;span&gt;6&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è¿”å›åœ°å€RVA&lt;/span&gt;
&lt;span&gt;1172&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1173&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0xC&lt;/span&gt;&lt;span&gt;), ebx); 
&lt;/span&gt;&lt;span&gt;1174&lt;/span&gt; &lt;span&gt;                a.pop(esi);
&lt;/span&gt;&lt;span&gt;1175&lt;/span&gt; &lt;span&gt;                a.pop(ebx);
&lt;/span&gt;&lt;span&gt;1176&lt;/span&gt; &lt;span&gt;                a.ret();
&lt;/span&gt;&lt;span&gt;1177&lt;/span&gt;                 g_tagIAT[i].dwJmpAddr = iNewJitBeginAddrRva +&lt;span&gt; iNewJitLenth;
&lt;/span&gt;&lt;span&gt;1178&lt;/span&gt;                 iNewJitLenth =&lt;span&gt; a.getCodeSize();
&lt;/span&gt;&lt;span&gt;1179&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1180&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_tagIAT[i].bType == &lt;span&gt;9&lt;/span&gt;) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;JMP&lt;/span&gt;
&lt;span&gt;1181&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1182&lt;/span&gt;                 g_tagIAT[i].dwNewIatAddr = iNewSectionFileMapAddr + iAddIatLenth + g_tagIAT[i].wIndex * &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1183&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1184&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1185&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1186&lt;/span&gt; &lt;span&gt;                a.push(esi);
&lt;/span&gt;&lt;span&gt;1187&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;&lt;span&gt;)g_tagIAT[i].dwNewIatAddr);
&lt;/span&gt;&lt;span&gt;1188&lt;/span&gt;                 a.mov(esi, g_iImageBase);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç¨‹åºåŸºå€ åç»­ä¼šå°†è¿™ä¸ªä½ç½®æ·»åŠ åˆ°é‡å®šä½å—å¤„ï¼Œè¿è¡Œæ—¶å³å˜ä¸ºç¨‹åºåŸºå€äº†&lt;/span&gt;
&lt;span&gt;1189&lt;/span&gt;                 g_tagIAT[i].dwRelocAddr = iNewJitBeginAddrRva + a.getCodeSize() - &lt;span&gt;4&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;shellcodeå¼€å§‹çš„ä½ç½®+å½“å‰jité•¿åº¦ å†å¾€å›4å­—èŠ‚  å³ä¸ºå­˜æ”¾åŸºå€çš„ä½ç½®&lt;/span&gt;
&lt;span&gt;1190&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1191&lt;/span&gt;                 a.mov(dword_ptr(esp,&lt;span&gt;4&lt;/span&gt;), &lt;span&gt;0x3535&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¡«å……åƒåœ¾æ•°æ®&lt;/span&gt;
&lt;span&gt;1192&lt;/span&gt; &lt;span&gt;                a.mov(ebx, dword_ptr(ebx));
&lt;/span&gt;&lt;span&gt;1193&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0xC&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å­˜æ”¾ç›®æ ‡å‡½æ•°åœ°å€çš„åœ°å€çš„RVA&lt;/span&gt;
&lt;span&gt;1194&lt;/span&gt; &lt;span&gt;                a.pop(esi);
&lt;/span&gt;&lt;span&gt;1195&lt;/span&gt; &lt;span&gt;                a.pop(ebx);
&lt;/span&gt;&lt;span&gt;1196&lt;/span&gt; &lt;span&gt;                a.pop(ebx);
&lt;/span&gt;&lt;span&gt;1197&lt;/span&gt; &lt;span&gt;                a.ret();
&lt;/span&gt;&lt;span&gt;1198&lt;/span&gt;                 g_tagIAT[i].dwJmpAddr = iNewJitBeginAddrRva +&lt;span&gt; iNewJitLenth;
&lt;/span&gt;&lt;span&gt;1199&lt;/span&gt;                 iNewJitLenth =&lt;span&gt; a.getCodeSize();
&lt;/span&gt;&lt;span&gt;1200&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1201&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (g_tagIAT[i].bType == &lt;span&gt;10&lt;/span&gt;) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;PUSH&lt;/span&gt;
&lt;span&gt;1202&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1203&lt;/span&gt;                 g_tagIAT[i].dwNewIatAddr = iNewSectionFileMapAddr + iAddIatLenth + g_tagIAT[i].wIndex * &lt;span&gt;4&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1204&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1205&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1206&lt;/span&gt; &lt;span&gt;                a.push(ebx);
&lt;/span&gt;&lt;span&gt;1207&lt;/span&gt; &lt;span&gt;                a.push(esi);
&lt;/span&gt;&lt;span&gt;1208&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;&lt;span&gt;)g_tagIAT[i].dwNewIatAddr);
&lt;/span&gt;&lt;span&gt;1209&lt;/span&gt;                 a.mov(esi, g_iImageBase);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç¨‹åºåŸºå€ åç»­ä¼šå°†è¿™ä¸ªä½ç½®æ·»åŠ åˆ°é‡å®šä½å—å¤„ï¼Œè¿è¡Œæ—¶å³å˜ä¸ºç¨‹åºåŸºå€äº†&lt;/span&gt;
&lt;span&gt;1210&lt;/span&gt;                 g_tagIAT[i].dwRelocAddr = iNewJitBeginAddrRva + a.getCodeSize() - &lt;span&gt;4&lt;/span&gt;;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;shellcodeå¼€å§‹çš„ä½ç½®+å½“å‰jité•¿åº¦ å†å¾€å›4å­—èŠ‚  å³ä¸ºå­˜æ”¾åŸºå€çš„ä½ç½®&lt;/span&gt;
&lt;span&gt;1211&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1212&lt;/span&gt; &lt;span&gt;                a.mov(ebx, dword_ptr(ebx));
&lt;/span&gt;&lt;span&gt;1213&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;0xC&lt;/span&gt;), ebx);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å­˜æ”¾ç›®æ ‡å‡½æ•°åœ°å€çš„åœ°å€çš„RVA&lt;/span&gt;
&lt;span&gt;1214&lt;/span&gt;                 a.mov(ebx, (&lt;span&gt;int&lt;/span&gt;)g_tagIAT[i].dwCallAddr + &lt;span&gt;6&lt;/span&gt;); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è¿”å›åœ°å€RVA&lt;/span&gt;
&lt;span&gt;1215&lt;/span&gt; &lt;span&gt;                a.lea(ebx, dword_ptr(ebx, esi));
&lt;/span&gt;&lt;span&gt;1216&lt;/span&gt;                 a.mov(dword_ptr(esp, &lt;span&gt;8&lt;/span&gt;&lt;span&gt;), ebx);
&lt;/span&gt;&lt;span&gt;1217&lt;/span&gt; &lt;span&gt;                a.pop(esi);
&lt;/span&gt;&lt;span&gt;1218&lt;/span&gt; &lt;span&gt;                a.pop(ebx);
&lt;/span&gt;&lt;span&gt;1219&lt;/span&gt; &lt;span&gt;                a.ret();
&lt;/span&gt;&lt;span&gt;1220&lt;/span&gt;                 g_tagIAT[i].dwJmpAddr = iNewJitBeginAddrRva +&lt;span&gt; iNewJitLenth;
&lt;/span&gt;&lt;span&gt;1221&lt;/span&gt;                 iNewJitLenth =&lt;span&gt; a.getCodeSize();
&lt;/span&gt;&lt;span&gt;1222&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1223&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1224&lt;/span&gt;         a.bind(LoadDllOver);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;åŠ è½½å‡½æ•°åœ°å€è¡¨ä»¥åŠæ„å»ºæ›¿ä»£IATçš„ShellCodeå®Œæˆ&lt;/span&gt;
&lt;span&gt;1225&lt;/span&gt;         a.mov(edi, dword_ptr(ebp, &lt;span&gt;8&lt;/span&gt;));&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å¾—åŸºå€&lt;/span&gt;
&lt;span&gt;1226&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; g_tagIAT.size(); i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;1227&lt;/span&gt; &lt;span&gt;        {    
&lt;/span&gt;&lt;span&gt;1228&lt;/span&gt; &lt;span&gt;            a.lea(ecx, dword_ptr(edi, g_tagIAT[i].dwCallAddr));
&lt;/span&gt;&lt;span&gt;1229&lt;/span&gt;             a.mov(byte_ptr(ecx), &lt;span&gt;0xE9&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1230&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç”±äºè¿™é‡Œçš„E9åé¢çš„å€¼ï¼Œæ˜¯åç§»ï¼Œæ‰€ä»¥ä¸ç”¨åŠ ä¸ŠåŸºå€ã€‚åç§»é‡=ç›®æ ‡åœ°å€-å½“å‰æŒ‡ä»¤åœ°å€-æŒ‡ä»¤é•¿åº¦&lt;/span&gt;
&lt;span&gt;1231&lt;/span&gt;             a.mov(dword_ptr(ecx, &lt;span&gt;1&lt;/span&gt;), (&lt;span&gt;int&lt;/span&gt;)(g_tagIAT[i].dwJmpAddr - g_tagIAT[i].dwCallAddr - &lt;span&gt;5&lt;/span&gt;&lt;span&gt;));
&lt;/span&gt;&lt;span&gt;1232&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (g_tagIAT[i].bType == &lt;span&gt;0&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;1233&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1234&lt;/span&gt;                 &lt;span&gt;continue&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1235&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1236&lt;/span&gt;             a.mov(byte_ptr(ecx, &lt;span&gt;5&lt;/span&gt;), &lt;span&gt;0x90&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1237&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1238&lt;/span&gt;         a.add(esp, &lt;span&gt;0x10&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;8+8&lt;/span&gt;
&lt;span&gt;1239&lt;/span&gt; &lt;span&gt;        a.pop(ebx);
&lt;/span&gt;&lt;span&gt;1240&lt;/span&gt; &lt;span&gt;        a.popa();
&lt;/span&gt;&lt;span&gt;1241&lt;/span&gt; &lt;span&gt;        a.ret();
&lt;/span&gt;&lt;span&gt;1242&lt;/span&gt; 
&lt;span&gt;1243&lt;/span&gt;         PVOID szJit =&lt;span&gt; a.make();
&lt;/span&gt;&lt;span&gt;1244&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iJitLenth =&lt;span&gt; a.getCodeSize(); 
&lt;/span&gt;&lt;span&gt;1245&lt;/span&gt;          g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize + iAddIatLenth + iLoadIatLenth +&lt;span&gt; iJitLenth);
&lt;/span&gt;&lt;span&gt;1246&lt;/span&gt;         memcpy(g_pFileSrc + g_iFileSize + iAddIatLenth +&lt;span&gt; iLoadIatLenth , szJit, iJitLenth);
&lt;/span&gt;&lt;span&gt;1247&lt;/span&gt; 
&lt;span&gt;1248&lt;/span&gt; 
&lt;span&gt;1249&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;ä¸€å…±å¢åŠ çš„ä»£ç =IATç›¸å…³æ•°æ®+åŠ è½½åçš„å‡½æ•°åœ°å€è¡¨å¤§å°+JITä»£ç é•¿åº¦&lt;/span&gt;
&lt;span&gt;1250&lt;/span&gt;          &lt;span&gt;int&lt;/span&gt; iAddSrcLen = iAddIatLenth + iLoadIatLenth +&lt;span&gt; iJitLenth;
&lt;/span&gt;&lt;span&gt;1251&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å®Œå–„èŠ‚é•¿åº¦ç­‰æ•°æ®  ä¿å®ˆèµ·è§é‡æ–°è·å–èŠ‚è¡¨ä¿¡æ¯&lt;/span&gt;
&lt;span&gt;1252&lt;/span&gt;         pDosHead =&lt;span&gt; (PIMAGE_DOS_HEADER)g_pFileSrc;
&lt;/span&gt;&lt;span&gt;1253&lt;/span&gt;         pNtHead = (PIMAGE_NT_HEADERS)((DWORD)pDosHead + pDosHead-&amp;gt;&lt;span&gt;e_lfanew);
&lt;/span&gt;&lt;span&gt;1254&lt;/span&gt;         pSection = (PIMAGE_SECTION_HEADER)((DWORD)&amp;amp;pNtHead-&amp;gt;OptionalHeader + pNtHead-&amp;gt;&lt;span&gt;FileHeader.SizeOfOptionalHeader);
&lt;/span&gt;&lt;span&gt;1255&lt;/span&gt;         pSection += pNtHead-&amp;gt;FileHeader.NumberOfSections - &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1256&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (!(iAddSrcLen%&lt;span&gt;g_iFileAlignment))
&lt;/span&gt;&lt;span&gt;1257&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1258&lt;/span&gt;             pSection-&amp;gt;SizeOfRawData =&lt;span&gt; iAddSrcLen;
&lt;/span&gt;&lt;span&gt;1259&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1260&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;
&lt;span&gt;1261&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1262&lt;/span&gt;             pSection-&amp;gt;SizeOfRawData = iAddSrcLen + g_iFileAlignment - (iAddSrcLen%&lt;span&gt;g_iFileAlignment);
&lt;/span&gt;&lt;span&gt;1263&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1264&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (!(iAddSrcLen%&lt;span&gt;g_iSectionAlignment))
&lt;/span&gt;&lt;span&gt;1265&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1266&lt;/span&gt;             pSection-&amp;gt;Misc.VirtualSize =&lt;span&gt; iAddSrcLen;
&lt;/span&gt;&lt;span&gt;1267&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1268&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;
&lt;span&gt;1269&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1270&lt;/span&gt;             pSection-&amp;gt;Misc.VirtualSize = iAddSrcLen + g_iSectionAlignment - (iAddSrcLen%&lt;span&gt;g_iSectionAlignment);
&lt;/span&gt;&lt;span&gt;1271&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1272&lt;/span&gt;         pNtHead-&amp;gt;OptionalHeader.SizeOfImage += pSection-&amp;gt;&lt;span&gt;Misc.VirtualSize;
&lt;/span&gt;&lt;span&gt;1273&lt;/span&gt; 
&lt;span&gt;1274&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (iAddSrcLen != pSection-&amp;gt;SizeOfRawData)&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“æ–°å¢é•¿åº¦ä¸å¯¹é½åçš„èŠ‚é•¿åº¦ä¸ç›¸ç­‰æ—¶ï¼Œå°†å…¶è¡¥å…¨&lt;/span&gt;
&lt;span&gt;1275&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1276&lt;/span&gt;             &lt;span&gt;int&lt;/span&gt; iLenth = pSection-&amp;gt;SizeOfRawData;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å…ˆä¿å­˜ï¼Œä»¥å…æ‰©å®¹ååŸåœ°å€è¢«å›æ”¶&lt;/span&gt;
&lt;span&gt;1277&lt;/span&gt;             g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize +&lt;span&gt; iLenth);
&lt;/span&gt;&lt;span&gt;1278&lt;/span&gt;             memset(g_pFileSrc + g_iFileSize + iAddSrcLen, &lt;span&gt;0&lt;/span&gt;, iLenth -&lt;span&gt; iAddSrcLen);
&lt;/span&gt;&lt;span&gt;1279&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1280&lt;/span&gt;           g_iFileSize += pSection-&amp;gt;&lt;span&gt;SizeOfRawData;
&lt;/span&gt;&lt;span&gt;1281&lt;/span&gt; 
&lt;span&gt;1282&lt;/span&gt;         
&lt;span&gt;1283&lt;/span&gt; 
&lt;span&gt;1284&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°†åŸé‡å®šä½ä¸­  æ¶‰åŠIATçš„é‡å®šä½é¡¹åˆ æ‰
&lt;/span&gt;&lt;span&gt;1285&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;1.å…ˆç»Ÿè®¡IATä¸­çš„åœ°å€ä½ç½®ä»£ç (é™¤äº†mov eaxçš„åœ°å€ä½ç½®åœ¨æŒ‡ä»¤ä½ç½®+1å¤„ï¼Œå…¶ä»–çš†ä¸º+2)&lt;/span&gt;
&lt;span&gt;1286&lt;/span&gt;         vector&amp;lt;WORD&amp;gt;vDeleteIatAddr;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;éœ€è¦åˆ é™¤çš„é‡å®šä½ä¿¡æ¯&lt;/span&gt;
&lt;span&gt;1287&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; g_tagIAT.size(); i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;1288&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1289&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (g_tagIAT[i].bType==&lt;span&gt;0&lt;/span&gt;) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;mov eax  é‡å®šä½åœ°å€ä½äºè°ƒç”¨åœ°å€+1å¤„&lt;/span&gt;
&lt;span&gt;1290&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1291&lt;/span&gt;                 vDeleteIatAddr.push_back(g_tagIAT[i].dwCallAddr + &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1292&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1293&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt;
&lt;span&gt;1294&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1295&lt;/span&gt;                 vDeleteIatAddr.push_back(g_tagIAT[i].dwCallAddr + &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1296&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1297&lt;/span&gt;             
&lt;span&gt;1298&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1299&lt;/span&gt; 
&lt;span&gt;1300&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;2.ç»Ÿè®¡å‡ºé‡å®šä½è¡¨æœ‰å‡ ä¸ªé‡å®šä½å—ï¼Œæ¯ä¸ªå—çš„åŸºå€æ˜¯å¤šå°‘ï¼Œé‡Œé¢æœ‰å¤šå°‘ä¸ªåç§»&lt;/span&gt;
&lt;span&gt;1301&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; iRelocationLenth; i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;1302&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1303&lt;/span&gt; &lt;span&gt;            tagRelocation addR;
&lt;/span&gt;&lt;span&gt;1304&lt;/span&gt;             addR.wR_Head = *(&lt;span&gt;int&lt;/span&gt;*)(szR_Src +&lt;span&gt; i);
&lt;/span&gt;&lt;span&gt;1305&lt;/span&gt;             &lt;span&gt;int&lt;/span&gt; iR_Lenth = *(&lt;span&gt;int&lt;/span&gt;*)(szR_Src + i + &lt;span&gt;4&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1306&lt;/span&gt;             &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; j = &lt;span&gt;8&lt;/span&gt;; j &amp;lt; iR_Lenth; j+=&lt;span&gt;2&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;1307&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1308&lt;/span&gt;                 WORD ccc = *(WORD*)(szR_Src + i +&lt;span&gt; j);
&lt;/span&gt;&lt;span&gt;1309&lt;/span&gt; &lt;span&gt;                addR.wR_Offset.push_back(ccc);
&lt;/span&gt;&lt;span&gt;1310&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1311&lt;/span&gt; &lt;span&gt;            vOldReloction.push_back(addR);
&lt;/span&gt;&lt;span&gt;1312&lt;/span&gt;             i += iR_Lenth - &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1313&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1314&lt;/span&gt; 
&lt;span&gt;1315&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;3.æ ¹æ®IATé‡Œçš„åœ°å€ï¼Œåœ¨é‡å®šä½åœ°å€è¡¨æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ä¹‹åå°†å…¶åˆ é™¤ &lt;/span&gt;
&lt;span&gt;1316&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; vDeleteIatAddr.size(); i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;1317&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1318&lt;/span&gt;             &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; j = &lt;span&gt;0&lt;/span&gt;; j &amp;lt; vOldReloction.size(); j++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;1319&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1320&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt; ((vDeleteIatAddr[i] &amp;amp; &lt;span&gt;0xFFF000&lt;/span&gt;) &amp;gt; vOldReloction[j].wR_Head) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“è°ƒç”¨åœ°å€çš„é‡å®šä½å—å¤§äºå½“å‰é‡å®šä½è¡¨å—æ—¶&lt;/span&gt;
&lt;span&gt;1321&lt;/span&gt; &lt;span&gt;                {
&lt;/span&gt;&lt;span&gt;1322&lt;/span&gt;                     &lt;span&gt;continue&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1323&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;1324&lt;/span&gt;                 &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; ((vDeleteIatAddr[i] &amp;amp; &lt;span&gt;0xFFF000&lt;/span&gt;) &amp;lt;&lt;span&gt; vOldReloction[j].wR_Head)
&lt;/span&gt;&lt;span&gt;1325&lt;/span&gt; &lt;span&gt;                {
&lt;/span&gt;&lt;span&gt;1326&lt;/span&gt;                     &lt;span&gt;break&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1327&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;1328&lt;/span&gt;                 &lt;span&gt;else&lt;/span&gt;        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ‰¾åˆ°å¯¹åº”é‡å®šä½å—&lt;/span&gt;
&lt;span&gt;1329&lt;/span&gt; &lt;span&gt;                {
&lt;/span&gt;&lt;span&gt;1330&lt;/span&gt;                     &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; k = &lt;span&gt;0&lt;/span&gt;; k &amp;lt; vOldReloction[j].wR_Offset.size(); k++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;1331&lt;/span&gt; &lt;span&gt;                    {
&lt;/span&gt;&lt;span&gt;1332&lt;/span&gt;                         &lt;span&gt;if&lt;/span&gt; ((vDeleteIatAddr[i] &amp;amp; &lt;span&gt;0xFFF&lt;/span&gt;) == (vOldReloction[j].wR_Offset[k] &amp;amp; &lt;span&gt;0xFFF&lt;/span&gt;&lt;span&gt;))
&lt;/span&gt;&lt;span&gt;1333&lt;/span&gt; &lt;span&gt;                        {
&lt;/span&gt;&lt;span&gt;1334&lt;/span&gt;                             vOldReloction[j].wR_Offset.erase(vOldReloction[j].wR_Offset.begin() +&lt;span&gt; k);
&lt;/span&gt;&lt;span&gt;1335&lt;/span&gt;                             &lt;span&gt;goto&lt;/span&gt;&lt;span&gt; NextIatAddr;
&lt;/span&gt;&lt;span&gt;1336&lt;/span&gt; &lt;span&gt;                        }
&lt;/span&gt;&lt;span&gt;1337&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt;1338&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;1339&lt;/span&gt; 
&lt;span&gt;1340&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1341&lt;/span&gt; &lt;span&gt;        NextIatAddr:;    
&lt;/span&gt;&lt;span&gt;1342&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1343&lt;/span&gt; 
&lt;span&gt;1344&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;4.å¯¹é½é‡å®šä½è¡¨æ•°æ®ï¼Œ&lt;/span&gt;
&lt;span&gt;1345&lt;/span&gt;         &lt;span&gt;/*&lt;/span&gt;&lt;span&gt;å¦‚æœé‡å®šä½å—ä¸­é¡¹ç›®ä¸ºå¶æ•°ä¸ªï¼Œåˆ™è·³è¿‡
&lt;/span&gt;&lt;span&gt;1346&lt;/span&gt; &lt;span&gt;        å¦‚æœæ˜¯å¥‡æ•°ä¸ªï¼Œçœ‹æœ€åä¸€ä¸ªæ˜¯å¦ä¸º0ã€‚å¦‚æœä¸º0ï¼Œåˆ æ‰ï¼›å¦‚æœä¸ä¸º0ï¼Œè¡¥0&lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;1347&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; vOldReloction.size(); i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;1348&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1349&lt;/span&gt;             &lt;span&gt;int&lt;/span&gt; iReloctionNum =&lt;span&gt; vOldReloction[i].wR_Offset.size();
&lt;/span&gt;&lt;span&gt;1350&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (iReloctionNum % &lt;span&gt;2&lt;/span&gt;) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å–ä½™  å¦‚æœèƒ½å–åˆ° è¯´æ˜ä¸ºå¥‡æ•°&lt;/span&gt;
&lt;span&gt;1351&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1352&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt; (vOldReloction[i].wR_Offset[iReloctionNum-&lt;span&gt;1&lt;/span&gt;] == &lt;span&gt;0&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;1353&lt;/span&gt; &lt;span&gt;                {
&lt;/span&gt;&lt;span&gt;1354&lt;/span&gt; &lt;span&gt;                    vOldReloction[i].wR_Offset.pop_back();
&lt;/span&gt;&lt;span&gt;1355&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;1356&lt;/span&gt;                 &lt;span&gt;else&lt;/span&gt;
&lt;span&gt;1357&lt;/span&gt; &lt;span&gt;                {
&lt;/span&gt;&lt;span&gt;1358&lt;/span&gt;                     vOldReloction[i].wR_Offset.push_back(&lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1359&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;1360&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1361&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1362&lt;/span&gt; 
&lt;span&gt;1363&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ¢å¤é‡å®šä½è¡¨&lt;/span&gt;
&lt;span&gt;1364&lt;/span&gt;         szR_Src =&lt;span&gt; NULL;
&lt;/span&gt;&lt;span&gt;1365&lt;/span&gt;         iRelocationLenth = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1366&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; vOldReloction.size(); i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;1367&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1368&lt;/span&gt;             szR_Src = (&lt;span&gt;char&lt;/span&gt;*)&lt;span&gt;realloc&lt;/span&gt;(szR_Src, iRelocationLenth + &lt;span&gt;8&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1369&lt;/span&gt;             memcpy(szR_Src + iRelocationLenth, &amp;amp;vOldReloction[i].wR_Head, &lt;span&gt;4&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1370&lt;/span&gt;             &lt;span&gt;int&lt;/span&gt; iR_Lenth = vOldReloction[i].wR_Offset.size() * &lt;span&gt;2&lt;/span&gt; + &lt;span&gt;8&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1371&lt;/span&gt;             memcpy(szR_Src + iRelocationLenth + &lt;span&gt;4&lt;/span&gt;, &amp;amp;iR_Lenth, &lt;span&gt;4&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1372&lt;/span&gt;             iRelocationLenth += &lt;span&gt;8&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1373&lt;/span&gt;             &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; j = &lt;span&gt;0&lt;/span&gt;; j &amp;lt; vOldReloction[i].wR_Offset.size(); j++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;1374&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1375&lt;/span&gt;                 szR_Src = (&lt;span&gt;char&lt;/span&gt;*)&lt;span&gt;realloc&lt;/span&gt;(szR_Src, iRelocationLenth + &lt;span&gt;8&lt;/span&gt; + j*&lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1376&lt;/span&gt;                 memcpy(szR_Src + iRelocationLenth + j*&lt;span&gt;2&lt;/span&gt;, &amp;amp;vOldReloction[i].wR_Offset[j], &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);            
&lt;/span&gt;&lt;span&gt;1377&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1378&lt;/span&gt;             iRelocationLenth += vOldReloction[i].wR_Offset.size() * &lt;span&gt;2&lt;/span&gt;&lt;span&gt; ;
&lt;/span&gt;&lt;span&gt;1379&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1380&lt;/span&gt;         
&lt;span&gt;1381&lt;/span&gt; 
&lt;span&gt;1382&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¢åŠ æ–°çš„é‡å®šä½é¡¹&lt;/span&gt;
&lt;span&gt;1383&lt;/span&gt;         &lt;span&gt;char&lt;/span&gt; *szAddRelocSrc = NULL;    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ€»æ–°å¢é‡å®šä½æ•°æ®&lt;/span&gt;
&lt;span&gt;1384&lt;/span&gt;         &lt;span&gt;char&lt;/span&gt; *szNowAddrelocSrc = NULL;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å­æ–°å¢é‡å®šä½æ•°æ®&lt;/span&gt;
&lt;span&gt;1385&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iAddRelocLen = &lt;span&gt;0&lt;/span&gt;;        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ€»é‡å®šä½æ•°æ®é•¿åº¦&lt;/span&gt;
&lt;span&gt;1386&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iNowAddRelocLen = &lt;span&gt;0&lt;/span&gt;;    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å­é‡å®šä½æ•°æ®é•¿åº¦&lt;/span&gt;
&lt;span&gt;1387&lt;/span&gt;         
&lt;span&gt;1388&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iPage = &lt;span&gt;0&lt;/span&gt;;        &lt;span&gt;//&lt;/span&gt;&lt;span&gt;é¡µå¤§å°&lt;/span&gt;
&lt;span&gt;1389&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iPageOffset = &lt;span&gt;0&lt;/span&gt;;    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;é¡µå†…åç§»
&lt;/span&gt;&lt;span&gt;1390&lt;/span&gt; 
&lt;span&gt;1391&lt;/span&gt; 
&lt;span&gt;1392&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å…ˆå¢åŠ æ–°OEPç”¨äºæ±‚å¾—åŸºå€çš„é‡å®šä½é¡¹&lt;/span&gt;
&lt;span&gt;1393&lt;/span&gt;         iNowAddRelocLen = &lt;span&gt;10&lt;/span&gt;;  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å­é•¿åº¦&lt;/span&gt;
&lt;span&gt;1394&lt;/span&gt;         szNowAddrelocSrc = (&lt;span&gt;char&lt;/span&gt;*)&lt;span&gt;malloc&lt;/span&gt;(iNowAddRelocLen);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å­æ•°æ®&lt;/span&gt;
&lt;span&gt;1395&lt;/span&gt;         iPage = (g_iNewOEP + &lt;span&gt;1&lt;/span&gt;) &amp;amp; &lt;span&gt;0xfff000&lt;/span&gt;;    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;PUSH 0000 0000  é‡å®šä½æ•°æ®ä¸ºåœ°å€ åç§»+1&lt;/span&gt;
&lt;span&gt;1396&lt;/span&gt;         iPageOffset = ((g_iNewOEP + &lt;span&gt;1&lt;/span&gt;) &amp;amp; &lt;span&gt;0xfff&lt;/span&gt;) | &lt;span&gt;0x3000&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1397&lt;/span&gt;         memcpy(szNowAddrelocSrc, &amp;amp;iPage, &lt;span&gt;4&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;é¡µåç§»&lt;/span&gt;
&lt;span&gt;1398&lt;/span&gt;         memcpy(szNowAddrelocSrc + &lt;span&gt;4&lt;/span&gt;, &amp;amp;iNowAddRelocLen, &lt;span&gt;4&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;é¡µå¤§å°&lt;/span&gt;
&lt;span&gt;1399&lt;/span&gt;         memcpy(szNowAddrelocSrc + &lt;span&gt;8&lt;/span&gt;, &amp;amp;iPageOffset, &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1400&lt;/span&gt; 
&lt;span&gt;1401&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¼€å§‹æ–°å¢shellcodeä¸­çš„é‡å®šä½é¡¹&lt;/span&gt;
&lt;span&gt;1402&lt;/span&gt;         &lt;span&gt;for&lt;/span&gt; (&lt;span&gt;int&lt;/span&gt; i = &lt;span&gt;0&lt;/span&gt;; i &amp;lt; g_tagIAT.size(); i++&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;1403&lt;/span&gt; &lt;span&gt;        {            
&lt;/span&gt;&lt;span&gt;1404&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (iPage == ((g_tagIAT[i].dwRelocAddr) &amp;amp; &lt;span&gt;0xfff000&lt;/span&gt;))  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;åˆ¤æ–­æ˜¯å¦ä¸å½“å‰é¡µå¤§å°ä¸€è‡´&lt;/span&gt;
&lt;span&gt;1405&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1406&lt;/span&gt;                 szNowAddrelocSrc = (&lt;span&gt;char&lt;/span&gt;*)&lt;span&gt;realloc&lt;/span&gt;(szNowAddrelocSrc, iNowAddRelocLen + &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1407&lt;/span&gt;                 iPageOffset = (g_tagIAT[i].dwRelocAddr &amp;amp; &lt;span&gt;0xfff&lt;/span&gt;) | &lt;span&gt;0x3000&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1408&lt;/span&gt;                 memcpy(szNowAddrelocSrc + iNowAddRelocLen, &amp;amp;iPageOffset, &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1409&lt;/span&gt;                 iNowAddRelocLen += &lt;span&gt;2&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1410&lt;/span&gt;                 memcpy(szNowAddrelocSrc + &lt;span&gt;4&lt;/span&gt;, &amp;amp;iNowAddRelocLen, &lt;span&gt;4&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;é¡µå¤§å°&lt;/span&gt;
&lt;span&gt;1411&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1412&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt;   &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¼€å¯æ–°é¡µ&lt;/span&gt;
&lt;span&gt;1413&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1414&lt;/span&gt;                 &lt;span&gt;if&lt;/span&gt; ((iNowAddRelocLen % &lt;span&gt;4&lt;/span&gt;))  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ˜¯å¦4å­—èŠ‚å¯¹é½&lt;/span&gt;
&lt;span&gt;1415&lt;/span&gt; &lt;span&gt;                {
&lt;/span&gt;&lt;span&gt;1416&lt;/span&gt;                     szNowAddrelocSrc = (&lt;span&gt;char&lt;/span&gt;*)&lt;span&gt;realloc&lt;/span&gt;(szNowAddrelocSrc, iNowAddRelocLen + &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1417&lt;/span&gt;                     memset(szNowAddrelocSrc + iNowAddRelocLen, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1418&lt;/span&gt;                     iNowAddRelocLen += &lt;span&gt;2&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1419&lt;/span&gt;                     memcpy(szNowAddrelocSrc + &lt;span&gt;4&lt;/span&gt;, &amp;amp;iNowAddRelocLen, &lt;span&gt;4&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;é¡µå¤§å°&lt;/span&gt;
&lt;span&gt;1420&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;1421&lt;/span&gt;                 
&lt;span&gt;1422&lt;/span&gt;                 szAddRelocSrc = (&lt;span&gt;char&lt;/span&gt;*)&lt;span&gt;realloc&lt;/span&gt;(szAddRelocSrc, iAddRelocLen + iNowAddRelocLen);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°†æ€»é‡å®šä½æ•°æ®æ‰©å®¹&lt;/span&gt;
&lt;span&gt;1423&lt;/span&gt;                 memcpy(szAddRelocSrc + iAddRelocLen, szNowAddrelocSrc, iNowAddRelocLen);    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¤åˆ¶å­é‡å®šä½å—åˆ°æ€»é‡å®šä½å—ä¸­&lt;/span&gt;
&lt;span&gt;1424&lt;/span&gt;                 iAddRelocLen += iNowAddRelocLen;    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ›´æ–°æ€»é‡å®šä½å—å¤§å°&lt;/span&gt;
&lt;span&gt;1425&lt;/span&gt; 
&lt;span&gt;1426&lt;/span&gt;                 iNowAddRelocLen = &lt;span&gt;10&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1427&lt;/span&gt;                 szNowAddrelocSrc = (&lt;span&gt;char&lt;/span&gt;*)&lt;span&gt;malloc&lt;/span&gt;(iNowAddRelocLen);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å­æ•°æ®&lt;/span&gt;
&lt;span&gt;1428&lt;/span&gt;                 iPage = g_tagIAT[i].dwRelocAddr &amp;amp; &lt;span&gt;0xfff000&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1429&lt;/span&gt;                 iPageOffset = (g_tagIAT[i].dwRelocAddr &amp;amp; &lt;span&gt;0xfff&lt;/span&gt;) | &lt;span&gt;0x3000&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1430&lt;/span&gt;                 memcpy(szNowAddrelocSrc, &amp;amp;iPage, &lt;span&gt;4&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;é¡µåç§»&lt;/span&gt;
&lt;span&gt;1431&lt;/span&gt;                 memcpy(szNowAddrelocSrc + &lt;span&gt;4&lt;/span&gt;, &amp;amp;iNowAddRelocLen, &lt;span&gt;4&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;é¡µå¤§å°&lt;/span&gt;
&lt;span&gt;1432&lt;/span&gt;                 memcpy(szNowAddrelocSrc + &lt;span&gt;8&lt;/span&gt;, &amp;amp;iPageOffset, &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1433&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1434&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1435&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ­¤æ—¶ ç”±äºå·²ç»éå†åˆ°tagIATç»“æ„æœ€å ä½†å½“å‰é‡å®šä½å—å¹¶ä¸ºæ·»åŠ åˆ°æ€»é‡å®šä½å—ä¸­ï¼Œæ•…éœ€è¦å†è¿›è¡Œå¡«å……&lt;/span&gt;
&lt;span&gt;1436&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; ((iNowAddRelocLen % &lt;span&gt;4&lt;/span&gt;))  &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ˜¯å¦4å­—èŠ‚å¯¹é½&lt;/span&gt;
&lt;span&gt;1437&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1438&lt;/span&gt;             szNowAddrelocSrc = (&lt;span&gt;char&lt;/span&gt;*)&lt;span&gt;realloc&lt;/span&gt;(szNowAddrelocSrc, iNowAddRelocLen + &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1439&lt;/span&gt;             memset(szNowAddrelocSrc + iNowAddRelocLen, &lt;span&gt;0&lt;/span&gt;, &lt;span&gt;2&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1440&lt;/span&gt;             iNowAddRelocLen += &lt;span&gt;2&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1441&lt;/span&gt;             memcpy(szNowAddrelocSrc + &lt;span&gt;4&lt;/span&gt;, &amp;amp;iNowAddRelocLen, &lt;span&gt;4&lt;/span&gt;);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;é¡µå¤§å°&lt;/span&gt;
&lt;span&gt;1442&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1443&lt;/span&gt; 
&lt;span&gt;1444&lt;/span&gt;         szAddRelocSrc = (&lt;span&gt;char&lt;/span&gt;*)&lt;span&gt;realloc&lt;/span&gt;(szAddRelocSrc, iAddRelocLen + iNowAddRelocLen);&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°†æ€»é‡å®šä½æ•°æ®æ‰©å®¹&lt;/span&gt;
&lt;span&gt;1445&lt;/span&gt;         memcpy(szAddRelocSrc + iAddRelocLen, szNowAddrelocSrc, iNowAddRelocLen);    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¤åˆ¶å­é‡å®šä½å—åˆ°æ€»é‡å®šä½å—ä¸­&lt;/span&gt;
&lt;span&gt;1446&lt;/span&gt;         iAddRelocLen += iNowAddRelocLen;    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ›´æ–°æ€»é‡å®šä½å—å¤§å°&lt;/span&gt;
&lt;span&gt;1447&lt;/span&gt; 
&lt;span&gt;1448&lt;/span&gt; 
&lt;span&gt;1449&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; ((iR_FileLenth - iRelocationLenth) &amp;lt; iAddRelocLen) &lt;span&gt;//&lt;/span&gt;&lt;span&gt;èŠ‚è¡¨é•¿åº¦å’Œå®é™…æ•°æ®é•¿åº¦æ˜¯å¦è¶³å¤Ÿå¡«å……æ–°çš„é‡å®šä½å—&lt;/span&gt;
&lt;span&gt;1450&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1451&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ‰©å……é‡å®šä½æ•°æ®
&lt;/span&gt;&lt;span&gt;1452&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ•´æ•°å–ä½™ = (æ–°å¢æ•°æ®æ€»å¤§å°- ä¹‹å‰å‰©ä½™ç©ºé—´é—´éš™)%å¯¹é½å¤§å°&lt;/span&gt;
&lt;span&gt;1453&lt;/span&gt;             &lt;span&gt;int&lt;/span&gt; iZeroLenth = (iAddRelocLen - (iR_FileLenth - iRelocationLenth)) %&lt;span&gt; g_iFileAlignment;
&lt;/span&gt;&lt;span&gt;1454&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt;&lt;span&gt; (iZeroLenth)
&lt;/span&gt;&lt;span&gt;1455&lt;/span&gt; &lt;span&gt;            { 
&lt;/span&gt;&lt;span&gt;1456&lt;/span&gt;                 iR_FileLenth = iRelocationLenth + iAddRelocLen + g_iFileAlignment -&lt;span&gt; iZeroLenth;
&lt;/span&gt;&lt;span&gt;1457&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1458&lt;/span&gt;             &lt;span&gt;else&lt;/span&gt;
&lt;span&gt;1459&lt;/span&gt; &lt;span&gt;            {
&lt;/span&gt;&lt;span&gt;1460&lt;/span&gt;                 iR_FileLenth = iRelocationLenth +&lt;span&gt; iAddRelocLen;
&lt;/span&gt;&lt;span&gt;1461&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;1462&lt;/span&gt;             szR_Src = (&lt;span&gt;char&lt;/span&gt;*)&lt;span&gt;realloc&lt;/span&gt;&lt;span&gt;(szR_Src, iR_FileLenth);
&lt;/span&gt;&lt;span&gt;1463&lt;/span&gt;             memcpy(szR_Src +&lt;span&gt; iRelocationLenth, szAddRelocSrc, iAddRelocLen);
&lt;/span&gt;&lt;span&gt;1464&lt;/span&gt;             memset(szR_Src + iRelocationLenth + iAddRelocLen, &lt;span&gt;0&lt;/span&gt;, iR_FileLenth - iRelocationLenth -&lt;span&gt; iAddRelocLen);
&lt;/span&gt;&lt;span&gt;1465&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1466&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;
&lt;span&gt;1467&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1468&lt;/span&gt;             szR_Src = (&lt;span&gt;char&lt;/span&gt;*)&lt;span&gt;realloc&lt;/span&gt;&lt;span&gt;(szR_Src, iR_FileLenth);
&lt;/span&gt;&lt;span&gt;1469&lt;/span&gt;             memcpy(szR_Src +&lt;span&gt; iRelocationLenth, szAddRelocSrc, iAddRelocLen);
&lt;/span&gt;&lt;span&gt;1470&lt;/span&gt;             iRelocationLenth +=&lt;span&gt; iAddRelocLen;
&lt;/span&gt;&lt;span&gt;1471&lt;/span&gt;             memset(szR_Src + iRelocationLenth, &lt;span&gt;0&lt;/span&gt;, iR_FileLenth -&lt;span&gt; iRelocationLenth);
&lt;/span&gt;&lt;span&gt;1472&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1473&lt;/span&gt; 
&lt;span&gt;1474&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;è¿˜åŸé‡å®šä½&lt;/span&gt;
&lt;span&gt;1475&lt;/span&gt;         g_pFileSrc = (UCHAR*)&lt;span&gt;realloc&lt;/span&gt;(g_pFileSrc, g_iFileSize +&lt;span&gt; iR_FileLenth);
&lt;/span&gt;&lt;span&gt;1476&lt;/span&gt;         memcpy(g_pFileSrc +&lt;span&gt; g_iFileSize, szR_Src, iR_FileLenth);
&lt;/span&gt;&lt;span&gt;1477&lt;/span&gt;         g_iFileSize +=&lt;span&gt; iR_FileLenth;
&lt;/span&gt;&lt;span&gt;1478&lt;/span&gt;         
&lt;span&gt;1479&lt;/span&gt;         &lt;span&gt;///&lt;/span&gt;&lt;span&gt;/ç›´æ¥ç”¨reallocåˆæŠ½é£ ç”¨å…¶ä»–è½¬ç§»å§&lt;/span&gt;
&lt;span&gt;1480&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;char *szCopyBuff = (char*)malloc(g_iFileSize + iR_FileLenth);
&lt;/span&gt;&lt;span&gt;1481&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;memcpy(szCopyBuff, g_pFileSrc, g_iFileSize);
&lt;/span&gt;&lt;span&gt;1482&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;memcpy(szCopyBuff + g_iFileSize, szR_Src, iR_FileLenth);
&lt;/span&gt;&lt;span&gt;1483&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;g_iFileSize += iR_FileLenth;
&lt;/span&gt;&lt;span&gt;1484&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;memcpy(g_pFileSrc, szCopyBuff, g_iFileSize);&lt;/span&gt;
&lt;span&gt;1485&lt;/span&gt;         
&lt;span&gt;1486&lt;/span&gt; 
&lt;span&gt;1487&lt;/span&gt;         pDosHead =&lt;span&gt; (PIMAGE_DOS_HEADER)g_pFileSrc;
&lt;/span&gt;&lt;span&gt;1488&lt;/span&gt;         pNtHead = (PIMAGE_NT_HEADERS)((DWORD)pDosHead + pDosHead-&amp;gt;&lt;span&gt;e_lfanew);
&lt;/span&gt;&lt;span&gt;1489&lt;/span&gt;         pSection = (PIMAGE_SECTION_HEADER)((DWORD)&amp;amp;pNtHead-&amp;gt;OptionalHeader + pNtHead-&amp;gt;&lt;span&gt;FileHeader.SizeOfOptionalHeader);
&lt;/span&gt;&lt;span&gt;1490&lt;/span&gt;         pSection += pNtHead-&amp;gt;FileHeader.NumberOfSections - &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1491&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iR_FileAddr = pSection-&amp;gt;PointerToRawData + pSection-&amp;gt;&lt;span&gt;SizeOfRawData;
&lt;/span&gt;&lt;span&gt;1492&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iR_MapAddr = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1493&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (!(pSection-&amp;gt;Misc.VirtualSize %&lt;span&gt; g_iSectionAlignment))
&lt;/span&gt;&lt;span&gt;1494&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1495&lt;/span&gt;             iR_MapAddr = pSection-&amp;gt;VirtualAddress + pSection-&amp;gt;&lt;span&gt;Misc.VirtualSize;
&lt;/span&gt;&lt;span&gt;1496&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1497&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;
&lt;span&gt;1498&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1499&lt;/span&gt;             iR_MapAddr = pSection-&amp;gt;VirtualAddress + pSection-&amp;gt;&lt;span&gt;Misc.VirtualSize
&lt;/span&gt;&lt;span&gt;1500&lt;/span&gt;                 + g_iSectionAlignment - (pSection-&amp;gt;Misc.VirtualSize %&lt;span&gt; g_iSectionAlignment);
&lt;/span&gt;&lt;span&gt;1501&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1502&lt;/span&gt; 
&lt;span&gt;1503&lt;/span&gt;         pSection++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1504&lt;/span&gt;         strcpy((&lt;span&gt;char&lt;/span&gt;*)pSection-&amp;gt;&lt;span&gt;Name, szR_Name);
&lt;/span&gt;&lt;span&gt;1505&lt;/span&gt;         pSection-&amp;gt;Characteristics = (&lt;span&gt;0x20000000&lt;/span&gt; | &lt;span&gt;0x40000000&lt;/span&gt; | &lt;span&gt;0x80000000&lt;/span&gt; | &lt;span&gt;0x40&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1506&lt;/span&gt;         pSection-&amp;gt;VirtualAddress =&lt;span&gt; iR_MapAddr;
&lt;/span&gt;&lt;span&gt;1507&lt;/span&gt;         pSection-&amp;gt;Misc.VirtualSize =&lt;span&gt; iR_FileLenth;
&lt;/span&gt;&lt;span&gt;1508&lt;/span&gt;         pSection-&amp;gt;PointerToRawData =&lt;span&gt; iR_FileAddr;
&lt;/span&gt;&lt;span&gt;1509&lt;/span&gt;         pSection-&amp;gt;SizeOfRawData =&lt;span&gt; iR_FileLenth;
&lt;/span&gt;&lt;span&gt;1510&lt;/span&gt;         pNtHead-&amp;gt;OptionalHeader.DataDirectory[&lt;span&gt;5&lt;/span&gt;].VirtualAddress =&lt;span&gt; iR_MapAddr;
&lt;/span&gt;&lt;span&gt;1511&lt;/span&gt;         pNtHead-&amp;gt;OptionalHeader.DataDirectory[&lt;span&gt;5&lt;/span&gt;].Size =&lt;span&gt; iRelocationLenth;
&lt;/span&gt;&lt;span&gt;1512&lt;/span&gt;         pNtHead-&amp;gt;FileHeader.NumberOfSections += &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1513&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (!(iR_FileLenth%&lt;span&gt;g_iSectionAlignment))
&lt;/span&gt;&lt;span&gt;1514&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1515&lt;/span&gt;             pNtHead-&amp;gt;OptionalHeader.SizeOfImage +=&lt;span&gt; iR_FileLenth;
&lt;/span&gt;&lt;span&gt;1516&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1517&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;
&lt;span&gt;1518&lt;/span&gt; &lt;span&gt;        {
&lt;/span&gt;&lt;span&gt;1519&lt;/span&gt;             pNtHead-&amp;gt;OptionalHeader.SizeOfImage += iR_FileLenth + g_iSectionAlignment - (iR_FileLenth%&lt;span&gt;g_iSectionAlignment);
&lt;/span&gt;&lt;span&gt;1520&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;1521&lt;/span&gt; 
&lt;span&gt;1522&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;1523&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1524&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;1525&lt;/span&gt; 
&lt;span&gt;1526&lt;/span&gt; 
&lt;span&gt;1527&lt;/span&gt; 
&lt;span&gt;1528&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; main()
&lt;/span&gt;&lt;span&gt;1529&lt;/span&gt; &lt;span&gt;{
&lt;/span&gt;&lt;span&gt;1530&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;&quot;C:\\Users\\Admin\\Desktop\\å¼¹çª—.exe&lt;/span&gt;
&lt;span&gt;1531&lt;/span&gt;     &lt;span&gt;char&lt;/span&gt; FileName[] = { &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;C:\\Users\\Admin\\Desktop\\å¼¹çª—.exe&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt; };
&lt;/span&gt;&lt;span&gt;1532&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!&lt;span&gt;LoadFile(FileName))
&lt;/span&gt;&lt;span&gt;1533&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt;1534&lt;/span&gt;         cout &amp;lt;&amp;lt; &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;æ–‡ä»¶æ‰“å¼€å¤±è´¥&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; &amp;lt;&amp;lt;&lt;span&gt; endl;
&lt;/span&gt;&lt;span&gt;1535&lt;/span&gt;         system(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;pause&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1536&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; -&lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1537&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;1538&lt;/span&gt; 
&lt;span&gt;1539&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!&lt;span&gt;CheckPE())
&lt;/span&gt;&lt;span&gt;1540&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt;1541&lt;/span&gt;         cout &amp;lt;&amp;lt; &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;è¯¥ç¨‹åºä¸æ˜¯PEæ–‡ä»¶&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; &amp;lt;&amp;lt;&lt;span&gt; endl;
&lt;/span&gt;&lt;span&gt;1542&lt;/span&gt;         system(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;pause&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1543&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; -&lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1544&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;1545&lt;/span&gt; 
&lt;span&gt;1546&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!FindCodeAddr())    &lt;span&gt;//&lt;/span&gt;&lt;span&gt;æ‰¾åˆ°å¯¹åº”è°ƒç”¨IATçš„åœ°å€&lt;/span&gt;
&lt;span&gt;1547&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt;1548&lt;/span&gt;         cout &amp;lt;&amp;lt; &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;è¯¥ç¨‹åºæ²¡æœ‰å¯¼å…¥è¡¨ï¼Œè¯·æ£€æŸ¥&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; &amp;lt;&amp;lt;&lt;span&gt; endl;
&lt;/span&gt;&lt;span&gt;1549&lt;/span&gt;         system(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;pause&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1550&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; -&lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1551&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;1552&lt;/span&gt; 
&lt;span&gt;1553&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!&lt;span&gt;SaveDll())
&lt;/span&gt;&lt;span&gt;1554&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt;1555&lt;/span&gt;         cout &amp;lt;&amp;lt; &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;ä¿å­˜DLLä¿¡æ¯å¤±è´¥&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; &amp;lt;&amp;lt;&lt;span&gt; endl;
&lt;/span&gt;&lt;span&gt;1556&lt;/span&gt;         system(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;pause&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1557&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; -&lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1558&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;1559&lt;/span&gt; 
&lt;span&gt;1560&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!&lt;span&gt;NewIat())
&lt;/span&gt;&lt;span&gt;1561&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt;1562&lt;/span&gt;         cout &amp;lt;&amp;lt; &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;æ–°å»ºIATè¡¨å¤±è´¥&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; &amp;lt;&amp;lt;&lt;span&gt; endl;
&lt;/span&gt;&lt;span&gt;1563&lt;/span&gt;         system(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;pause&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1564&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; -&lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1565&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;1566&lt;/span&gt; 
&lt;span&gt;1567&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;C:\\Users\\Admin\\Desktop\\å¼¹çª—IATåŠ å¯†æµ‹è¯•.exe&lt;/span&gt;
&lt;span&gt;1568&lt;/span&gt;     &lt;span&gt;char&lt;/span&gt; NewFilePath[] = &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;C:\\Users\\Admin\\Desktop\\å¼¹çª—IATåŠ å¯†æµ‹è¯•.exe&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1569&lt;/span&gt;     HANDLE hNewFile =&lt;span&gt; CreateFileA(NewFilePath,
&lt;/span&gt;&lt;span&gt;1570&lt;/span&gt;         GENERIC_READ |&lt;span&gt; GENERIC_WRITE,
&lt;/span&gt;&lt;span&gt;1571&lt;/span&gt;         FILE_SHARE_READ |&lt;span&gt; FILE_SHARE_WRITE,
&lt;/span&gt;&lt;span&gt;1572&lt;/span&gt; &lt;span&gt;        NULL,
&lt;/span&gt;&lt;span&gt;1573&lt;/span&gt;         CREATE_ALWAYS,   &lt;span&gt;//&lt;/span&gt;&lt;span&gt;åˆ›å»ºå¹¶è¦†ç›–ä¸Šä¸€ä¸ªæ–‡ä»¶&lt;/span&gt;
&lt;span&gt;1574&lt;/span&gt; &lt;span&gt;        FILE_ATTRIBUTE_ARCHIVE,
&lt;/span&gt;&lt;span&gt;1575&lt;/span&gt; &lt;span&gt;        NULL);
&lt;/span&gt;&lt;span&gt;1576&lt;/span&gt; 
&lt;span&gt;1577&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (hNewFile ==&lt;span&gt; INVALID_HANDLE_VALUE)
&lt;/span&gt;&lt;span&gt;1578&lt;/span&gt; &lt;span&gt;    {
&lt;/span&gt;&lt;span&gt;1579&lt;/span&gt;         printf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;æ–‡ä»¶ä¿å­˜å¤±è´¥\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1580&lt;/span&gt;         &lt;span&gt;int&lt;/span&gt; iError =&lt;span&gt; GetLastError();
&lt;/span&gt;&lt;span&gt;1581&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1582&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;1583&lt;/span&gt; 
&lt;span&gt;1584&lt;/span&gt;     LPDWORD iNum =&lt;span&gt; NULL;
&lt;/span&gt;&lt;span&gt;1585&lt;/span&gt;     WriteFile(hNewFile, g_pFileSrc, g_iFileSize, iNum, NULL); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;å†™å…¥æ–‡ä»¶&lt;/span&gt;
&lt;span&gt;1586&lt;/span&gt; &lt;span&gt;    CloseHandle(hNewFile);
&lt;/span&gt;&lt;span&gt;1587&lt;/span&gt;     &lt;span&gt;char&lt;/span&gt; *NewFileName1 = strrchr(NewFilePath, &lt;span&gt;'&lt;/span&gt;&lt;span&gt;\\&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;) + &lt;span&gt;1&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;1588&lt;/span&gt;     &lt;span&gt;char&lt;/span&gt; *NewFileName = strtok(NewFileName1, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1589&lt;/span&gt;     MessageBoxA(&lt;span&gt;0&lt;/span&gt;, NewFileName, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;åŠ å¯†æˆåŠŸ&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1590&lt;/span&gt;     MessageBoxA(&lt;span&gt;0&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;by:é˜¿æ€ª\n          2020.12.26&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;IATåŠ å¯†&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1591&lt;/span&gt; 
&lt;span&gt;1592&lt;/span&gt;     system(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;pause&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;1593&lt;/span&gt; }
&lt;/pre&gt;</description>
<pubDate>Tue, 29 Dec 2020 20:16:00 +0000</pubDate>
<dc:creator>__é˜¿é˜¿é˜¿æ€ª</dc:creator>
<og:description>ä¸Šä¸€æ¬¡åšå®Œä»£ç æ®µåŠ å¯†åï¼Œåˆæ¥è§¦åˆ°äº†æ–°çš„åŠ å¯†æ–¹å¼ï¼šIATåŠ å¯† IATåŠ å¯†æ˜¯é€šè¿‡éšè—ç¨‹åºçš„å¯¼å…¥è¡¨ä¿¡æ¯ï¼Œä»¥è¾¾åˆ°å¢åŠ åˆ†æç¨‹åºçš„éš¾åº¦ã€‚å› ä¸ºæ²¡æœ‰å¯¼å…¥è¡¨ï¼Œå°±æ— æ³•å•çº¯çš„ä»é™æ€çŠ¶æ€ä¸‹åˆ†æè°ƒç”¨äº†ä»€ä¹ˆå‡½æ•°ï¼ŒåŠ¨æ€è°ƒè¯•æ—¶ï¼Œä¹Ÿæ— </og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/aaaguai/p/14207468.html</dc:identifier>
</item>
<item>
<title>å®¹å™¨ç¼–æ’ç³»ç»ŸK8sä¹‹è®¿é—®æ§åˆ¶--ç”¨æˆ·è®¤è¯ - Linux-1874</title>
<link>http://www.cnblogs.com/qiuhom-1874/p/14207381.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/qiuhom-1874/p/14207381.html</guid>
<description>&lt;p&gt;ã€€ã€€å‰æ–‡æˆ‘ä»¬èŠåˆ°äº†k8sçš„statefulsetæ§åˆ¶å™¨ç›¸å…³ä½¿ç”¨è¯´æ˜ï¼Œå›é¡¾è¯·å‚è€ƒï¼š&lt;a href=&quot;https://www.cnblogs.com/qiuhom-1874/p/14201103.html&quot; target=&quot;_blank&quot;&gt;https://www.cnblogs.com/qiuhom-1874/p/14201103.html&lt;/a&gt;ï¼›ä»Šå¤©æˆ‘ä»¬æ¥èŠä¸€ä¸‹k8så®‰å…¨ç›¸å…³è¯é¢˜ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€æˆ‘ä»¬çŸ¥é“åœ¨k8sä¸ŠAPIserveræ˜¯æ•´ä¸ªé›†ç¾¤çš„è®¿é—®å…¥å£ï¼Œetcdæ˜¯ä¿å­˜æ•´ä¸ªé›†ç¾¤æ‰€æœ‰èµ„æºçŠ¶æ€é…ç½®ä¿¡æ¯çš„kvé”®å€¼å­˜å‚¨æ•°æ®åº“ï¼Œä¸€æ—¦etcdå®•æœºï¼Œk8sæ•´ä¸ªé›†ç¾¤å°†æ— æ³•æ­£å¸¸å·¥ä½œï¼Œä¸ºæ­¤æˆ‘ä»¬éœ€è¦å¯¹etcdåšé«˜å¯ç”¨ï¼›é™¤æ­¤ä¹‹å¤–ä¸ºäº†ä¿è¯etcdä¸­çš„æ•°æ®å®‰å…¨ï¼Œk8såªå…è®¸APIserverå»è®¿é—®/æ“ä½œetcd;è¿™ä¹Ÿæ˜¯APIserverä¸ºä»€ä¹ˆæ˜¯æ•´ä¸ªé›†ç¾¤çš„è®¿é—®å…¥å£çš„åŸå› ï¼›ç®€å•è®²etcdçš„å®¢æˆ·ç«¯åªæœ‰APIserverï¼Œæˆ‘ä»¬ç”¨å®¢æˆ·ç«¯æƒ³è¦æŸ¥çœ‹å¯¹åº”èµ„æºçš„çŠ¶æ€æˆ–è€…ä¿®æ”¹å¯¹åº”èµ„æºå±æ€§ç­‰ç­‰æ“ä½œï¼Œéƒ½éœ€è¦æŠŠè¯·æ±‚å‘é€ç»™APIserverï¼Œç”±APIserverå†æŠŠå®¢æˆ·ç«¯çš„è¯·æ±‚ä»£ç†åˆ°etcdä¸Šï¼Œä»è€Œå®ç°å®¢æˆ·ç«¯è®¿é—®/æ“ä½œetcdä¸­å¯¹åº”èµ„æºçš„çŠ¶æ€æˆ–å±æ€§ä¿¡æ¯ï¼›è¿™æ ·ä¸€æ¥APIserverå°±æ‰¿æ‹…äº†æ•´ä¸ªetcdçš„æ•°æ®è®¿é—®å®‰å…¨ï¼›ä¸€æ—¦APIserverå‡ºç°é—®é¢˜ï¼ŒæŠŠæ¶æ„è¯·æ±‚æ”¾è¿›æ¥ï¼Œå¯¹åº”etcdçš„ä¸­çš„æ•°æ®å®‰å…¨å°†æ— ä»ä¿è¯ï¼›ä¸ºæ­¤APIserverå°±å¿…é¡»æ‹¥æœ‰ä¸€å¥—å¯¹å®¢æˆ·ç«¯è¯·æ±‚è¿›è¡ŒéªŒè¯ç®¡æ§çš„æœºåˆ¶ï¼›å¦‚ä¸‹å›¾&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1503305/202012/1503305-20201229204516954-634489976.jpg&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€1ã€ç”¨æˆ·è®¤è¯&lt;/p&gt;
&lt;p&gt;ã€€ã€€é¦–å…ˆAPIserverè¦éªŒè¯å®¢æˆ·ç«¯æ˜¯å¦æ˜¯åˆæ³•å®¢æˆ·ç«¯ï¼Œåœ¨k8sä¸Šæˆ‘ä»¬ç”¨kubectlå·¥å…·å»ç®¡ç†k8sé›†ç¾¤ï¼ŒAPIserveré¦–å…ˆè¦éªŒè¯kubectlå®¢æˆ·ç«¯çš„è¯ä¹¦ï¼ŒåŒæ—¶kubectlä¹Ÿè¦éªŒè¯å¯¹åº”APIserverçš„è¯ä¹¦ï¼›è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬å«k8sç”¨æˆ·è®¤è¯çš„è¿‡ç¨‹ï¼›åœ¨k8sä¸Šé™¤äº†æœ‰é€šè¿‡è¯ä¹¦æ–¹å¼è®¤è¯å®¢æˆ·ç«¯ï¼Œè¿˜æœ‰å…¶ä»–æœºåˆ¶ï¼Œæ¯”å¦‚ç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ©ç”¨tokenæœºåˆ¶å»éªŒè¯å¯¹åº”å®¢æˆ·ç«¯ï¼›å…¶ä¸­åˆ©ç”¨tokenæœºåˆ¶ä¸­æœ‰æ˜æ–‡tokenï¼ˆplain tokenï¼‰å’Œå¼•å¯¼tokenï¼ˆbootstrap tokenï¼‰ï¼›ä¸ç®¡æ˜¯ç”¨æˆ·åå¯†ç è¿˜æ˜¯tokenæ–¹å¼è®¤è¯ç”¨æˆ·ï¼Œåœ¨å‘é€ç»™APIserveræ—¶éƒ½æ˜¯é€šè¿‡æŠŠå¯¹åº”çš„ä¿¡æ¯è½¬åŒ–æˆhttpåè®®å¤´éƒ¨ä¿¡æ¯ä¼ é€’ç»™APIserverï¼›å¯¹åº”APIserveræ”¶åˆ°å¯¹åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå°±ä¼šæŠŠå¯¹åº”å¤´éƒ¨ä¿¡æ¯æ£€ç´¢ä¸‹æ¥ï¼Œè¿›è¡ŒéªŒè¯ï¼›ä¸åŒçš„æ˜¯plain tokenä¸»è¦ç”¨äºéªŒè¯å¯¹åº”å®¢æˆ·ç«¯æ˜¯å¦åˆæ³•ï¼Œæ˜¯å¦èƒ½å¤Ÿç™»é™†APIserverï¼›è€Œå¯¹åº”bootstrap tokenæ˜¯ç”¨æ¥éªŒè¯å¯¹åº”èŠ‚ç‚¹æ˜¯å¦èƒ½å¤ŸåŠ å…¥åˆ°k8sé›†ç¾¤ï¼Œå¦‚æœbootstrapè®¤è¯é€šè¿‡åï¼Œå¯¹åº”APIserverä¼šè°ƒç”¨caç»™å¯¹åº”èŠ‚ç‚¹ä¸Šçš„kubeletå’Œkubeproxyé¢å‘è¯ä¹¦ï¼›æ­¤åkubeletå’Œkubeproxyå°±å¯ä»¥é€šè¿‡APIserverè®¤å¯çš„caé¢å‘çš„è¯ä¹¦åˆ°APIserverè®¤è¯ï¼Œè®¿é—®å¯¹åº”èµ„æºçš„ä¿¡æ¯äº†ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€ç”¨æˆ·è®¤è¯åªæ˜¯éªŒè¯å¯¹åº”å®¢æˆ·ç«¯æ˜¯å¦æ˜¯åˆæ³•å®¢æˆ·ç«¯ï¼Œè¿™é‡Œçš„éªŒè¯çš„æœºåˆ¶æ˜¯ä¸€ç¥¨é€šè¿‡çš„æœºåˆ¶ï¼›æ‰€è°“ä¸€ç¥¨é€šè¿‡æ˜¯æŒ‡åœ¨APIserverä¸Šæœ‰å¤šç§éªŒè¯æœºåˆ¶ï¼ˆæ–¹æ³•ï¼‰ï¼Œå®ƒä¼šä»ä¸Šè‡³ä¸‹ä¾æ¬¡è¿›è¡ŒéªŒè¯ï¼Œå¦‚æœå¯¹åº”éªŒè¯æ–¹æ³•æ²¡æœ‰æ˜ç¡®æ‹’ç»ï¼Œæ¥ç€å®ƒä¼šç”¨ä¸‹ä¸€ä¸ªéªŒè¯æ–¹æ³•ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªæœºåˆ¶é€šè¿‡ä»¥åï¼Œä½™ä¸‹çš„å°±ä¸éªŒè¯äº†ï¼›æ¯”å¦‚ï¼Œåœ¨k8sä¸Šæœ‰è¯ä¹¦éªŒè¯ï¼Œç”¨æˆ·åå¯†ç éªŒè¯ï¼ŒtokenéªŒè¯ï¼Œå¦‚æœæ­¤æ—¶æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯æ‹¿ç€ä¸€ä¸ªtokenæ¥ç™»é™†APIserverï¼Œæ­¤æ—¶APIserverå°±ä¼šå…ˆç”¨è¯ä¹¦éªŒè¯çš„æ–¹æ³•éªŒè¯å®¢æˆ·ç«¯ï¼Œå¦‚æœå¯¹åº”éªŒè¯æ–¹æ³•æ²¡æœ‰æ˜ç¡®æ‹’ç»ï¼Œè¯´æ˜æ­¤æ–¹æ³•ä¸è¯†åˆ«å¯¹åº”çš„å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œæ¥ç€å®ƒä¼šç”¨ç”¨æˆ·åå¯†ç çš„æ–¹æ³•è¿›è¡ŒéªŒè¯ï¼Œå¦‚æœå¯¹åº”æ–¹æ³•ä¹Ÿæ²¡æœ‰æ˜ç¡®æ‹’ç»ï¼Œæ¥ç€å®ƒä¼šç”¨tokenæ–¹æ³•è¿›è¡ŒéªŒè¯ï¼Œå¦‚æœå¯¹åº”æ–¹æ³•é€šè¿‡äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„å…¶ä»–æ–¹æ³•éªŒè¯å°±ä¸ä¼šå†è¿›è¡Œä¸‹å»ï¼›å¦‚æœæ‰€æœ‰éªŒè¯æ–¹æ³•éƒ½æ²¡æœ‰æ‹’ç»ï¼Œè¯´æ˜è¯¥å®¢æˆ·ç«¯æä¾›çš„è®¤è¯ä¿¡æ¯åœ¨k8sä¸Šä¸é€‚é…ï¼Œæ­¤æ—¶apiserver å°±ä¼šæŠŠå¯¹åº”å®¢æˆ·ç«¯å½’çº³ä¸ºåŒ¿åç”¨æˆ·ï¼›å½“ç„¶æ­¤ç±»ç”¨æˆ·è™½ç„¶ç™»é™†åˆ°APIserverä¸Šï¼Œä½†å®ƒæ²¡æœ‰æƒé™æ“ä½œèµ„æºï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€2ã€éªŒè¯æˆæƒ&lt;/p&gt;
&lt;p&gt;ã€€ã€€åªæœ‰éªŒè¯é€šè¿‡çš„å®¢æˆ·ç«¯ï¼Œæ‰ä¼šæœ‰æœºä¼šè¿›è¡Œæƒé™éªŒè¯ï¼Œæ‰€è°“æƒé™éªŒè¯æ˜¯æŒ‡éªŒè¯å¯¹åº”å®¢æˆ·ç«¯æ˜¯å¦æ‹¥æœ‰å¯¹åº”k8sä¸Šçš„èµ„æºè®¿é—®/æ“ä½œæƒé™ï¼›éªŒè¯æƒé™ä¹Ÿæ˜¯ä¸€ç¥¨é€šè¿‡çš„æœºåˆ¶ï¼›åªè¦å¯¹åº”å®¢æˆ·ç«¯æœ‰å¯¹åº”èµ„æºçš„æ“ä½œ/è®¿é—®æƒé™ï¼Œåˆ™å…¶ä»–èµ„æºçš„æƒé™éªŒè¯å°±ä¸ä¼šå†è¿›è¡Œä¸‹å»ï¼›å¦‚æœæ²¡æœ‰å¯¹åº”èµ„æºè®¿é—®/æ“ä½œæƒé™ï¼Œæ­¤æ—¶APIserverå°±ç›´æ¥å“åº”å¯¹åº”çš„å®¢æˆ·ç«¯è¯·æ±‚æ²¡æœ‰æƒé™è®¿é—®ï¼›å¦‚æœå¯¹åº”å®¢æˆ·ç«¯æœ‰å¯¹èµ„æºçš„è®¿é—®/æ“ä½œæ“ä½œæƒé™ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯è¯·æ±‚ä¼šè¿›å…¥åˆ°ä¸‹ä¸€ä¸ªæ­¥éª¤ï¼Œå‡†å…¥æ§åˆ¶ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€3ã€å‡†å…¥æ§åˆ¶&lt;/p&gt;
&lt;p&gt;ã€€ã€€æ‰€è°“å‡†å…¥æ§åˆ¶æ˜¯æŒ‡æ£€æŸ¥å¯¹åº”å®¢æˆ·ç«¯çš„è¯·æ±‚æ˜¯å¦ç¬¦åˆå¯¹åº”è¯·æ±‚/æ“ä½œAPIè§„èŒƒï¼›ä¼ é€’å‚æ•°æ˜¯å¦æ˜¯æ­£ç¡®çš„ï¼›æ¯”å¦‚æˆ‘ä»¬è¦æƒ³k8sä¸Šåˆ›å»ºä¸€ä¸ªpodï¼Œæ­¤æ—¶å‡†å…¥æ§åˆ¶ä¼šæ£€æŸ¥æˆ‘ä»¬æäº¤çš„ä¿¡æ¯æ˜¯å¦ç¬¦åˆåˆ›å»ºå¯¹åº”èµ„æºçš„è§„èŒƒï¼Œå¦‚æœç¬¦åˆè§„èŒƒå°±åˆ›å»ºï¼Œä¸ç¬¦åˆè§„èŒƒå°±æ‹’ç»ï¼›å‡†å…¥æ§åˆ¶è¿™ä¸ªç¯èŠ‚æ˜¯ä½¿ç”¨çš„ä¸€ç¥¨å¦å†³çš„æœºåˆ¶ï¼Œæ‰€è°“ä¸€ç¥¨å¦å†³æ˜¯æŒ‡åªè¦æœ‰ä¸€é¡¹ä¸é€šè¿‡ï¼Œåˆ™æ•´ä¸ªè¯·æ±‚éƒ½å°†æ˜¯æ‹’ç»çš„ï¼Œå³ä¾¿ä½™ä¸‹çš„æ£€æŸ¥éƒ½æ˜¯é€šè¿‡çš„ï¼›å½“ç„¶åªè¦æœ‰ä¸€é¡¹æ²¡æœ‰é€šè¿‡ï¼Œä½™ä¸‹çš„éªŒè¯å°±ä¸ä¼šå†è¿›è¡Œï¼›é™¤äº†æ£€æŸ¥å¯¹åº”å®¢æˆ·ç«¯æäº¤çš„ä¿¡æ¯æ˜¯å¦ç¬¦åˆå¯¹åº”APIèµ„æºçš„è§„èŒƒï¼Œå‡†å…¥æ§åˆ¶è¿˜ä¼šå¸®åŠ©æˆ‘ä»¬æŠŠæˆ‘ä»¬æ²¡æœ‰æ˜ç¡®æŒ‡å®šçš„å­—æ®µä¿¡æ¯ï¼Œé€šè¿‡é»˜è®¤å€¼çš„æ–¹å¼æŠŠå¯¹åº”çš„å­—æ®µå¡«å……åˆ°å®¢æˆ·ç«¯è¯·æ±‚ä¸­ï¼›ç„¶åæŠŠå¡«å……å¥½çš„ä¿¡æ¯ä¸€å¹¶ç”±APIserveræŠŠå®¢æˆ·ç«¯è¯·æ±‚æ›´æ–°åˆ°å¯¹åº”èµ„æºåœ¨etcdä¸­çš„å¯¹åº”ä¿¡æ¯ä¸Šï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€k8sä¸Šçš„ç”¨æˆ·&lt;/p&gt;
&lt;p&gt;ã€€ã€€åœ¨k8sä¸Šç”¨æˆ·æœ‰ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯å¸¸è§„ç”¨æˆ·ï¼ˆnormal usersï¼‰ï¼Œä¸€ç±»æ˜¯æœåŠ¡å¸å·ï¼ˆService Accountï¼‰ï¼›æ‰€è°“å¸¸è§„ç”¨æˆ·å°±æ˜¯æŒ‡å¯¹åº”å®¢æˆ·ç«¯ç°å®ç”Ÿæ´»ä¸­çš„æ“ä½œè€…ï¼Œè¿™ä¸ªæœ‰ç‚¹ç±»ä¼¼Linuxä¸Šçš„ç™»å½•ç”¨æˆ·ï¼›å®ƒæŠŠå¯¹åº”æ“ä½œè¯¥å®¢æˆ·ç«¯çš„äººï¼Œæ˜ å°„åˆ°å¯¹åº”å®¢æˆ·ç«¯çš„åç§°ä¸Šï¼›æ¯”å¦‚æˆ‘ä»¬ç”¨kubectlå»æ“ä½œk8sé›†ç¾¤ï¼Œåœ¨k8sä¸Šæˆ‘ä»¬è‡ªå·±å°±æ˜¯å¯¹åº”kubecltæŒæœ‰çš„è¯ä¹¦ä¿¡æ¯ä¸­çš„/CNå¯¹åº”çš„å­—ç¬¦ä¸²ï¼›æœåŠ¡å¸å·æ˜¯æŒ‡éäººç±»æ“ä½œçš„å®¢æˆ·ç«¯æ‰€ç”¨åˆ°çš„ç”¨æˆ·åï¼Œæœ‰ç‚¹ç±»ä¼¼Linuxç³»ç»Ÿä¸Šçš„ç³»ç»Ÿè´¦å·ï¼›å®ƒçš„å­˜åœ¨åªæ˜¯ä¸ºäº†åœ¨k8sä¸Šæ–¹ä¾¿æƒé™çš„åˆ’åˆ†ï¼›ç®€å•è®²æœåŠ¡å¸å·å°±æ˜¯ç”¨æ¥é’ˆå¯¹é‚£äº›ç¨‹åºè‡ªèº«å‘apiserverå‘èµ·è¿æ¥æ—¶ï¼Œé™„åŠ çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä¸»è¦ä½œç”¨æ˜¯apiserverå¯ä»¥æ ¹æ®å¯¹åº”çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæ¥åˆ¤æ–­å¯¹åº”å®¢æˆ·ç«¯åœ¨apiserverä¸Šçš„æƒé™ï¼›å¦‚ä¸‹æ‰€ç¤º&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1503305/202012/1503305-20201229231027945-642057254.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼šä¸Šå›¾æ˜¯ä¸€ä¸ªpodçš„è¯¦ç»†ä¿¡æ¯ï¼Œå…¶ä¸­æˆ‘ä»¬å¹¶æ²¡æœ‰å®šä¹‰å­˜å‚¨å·ï¼Œåˆ›å»ºpodåï¼Œå®ƒé»˜è®¤ä¼šç”Ÿæˆè¿™ä¸ªå­˜å‚¨å·ï¼›è¿™ä¸ªå­˜å‚¨å·è¢«æŒ‚è½½åˆ°å¯¹åº”podå®¹å™¨å†…éƒ¨çš„//var/run/secrets/kubernetes.io/serviceaccount è¿™ä¸ªè·¯å¾„ï¼›å…¶å®è¿™ä¸ªå°±æ˜¯å¯¹åº”podæ£€ç´¢/æ›´æ–°è‡ªå·±çš„çŠ¶æ€ä¿¡æ¯ï¼Œè¦åœ¨apiserverä¸Šè¿›è¡Œè®¤è¯çš„serviceaccountä¿¡æ¯ï¼Œä¿å­˜åœ¨secretå­˜å‚¨å·ä¸­ï¼›å¦‚ä¸‹å›¾æ‰€ç¤º&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/1503305/202012/1503305-20201229231529979-368258502.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼šå¯¹åº”podæŒ‚è½½secretå­˜å‚¨å·ï¼Œä¸»è¦ä½œç”¨æ˜¯åœ¨æ£€ç´¢/æ›´æ–°è‡ªå·±çš„çŠ¶æ€ä¿¡æ¯æ—¶ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªtokenå‘é€ç»™apiserverè¿›è¡ŒéªŒè¯ï¼›apiserverè®¤è¯é€šè¿‡åå°±æŠŠå¯¹åº”çŠ¶æ€ä¿¡æ¯æ›´æ–°åˆ°etcdä¸­è¿›è¡Œä¿å­˜ï¼›æ­£æ˜¯å› ä¸ºpodæä¾›äº†saï¼ˆserviceaccountçš„ç®€å†™ï¼‰è´¦å·tokenä¿¡æ¯ï¼Œä½¿å¾—apiserveræ‰èƒ½æ­£å¸¸åˆ¤æ–­å‡ºå¯¹åº”tokenå¯¹åº”ç”¨æˆ·çš„æƒé™ï¼›è¿™ä¸ªtokenæ˜¯åœ¨åˆ›å»ºpodæ—¶ï¼Œå¯¹åº”å‡†å…¥æ§åˆ¶å™¨è‡ªåŠ¨ç”Ÿæˆsaè´¦å·ï¼Œå¹¶æŠŠå¯¹åº”çš„saè´¦å·çš„tokenä¿¡æ¯ä»¥secretå­˜å‚¨å·çš„æ–¹å¼æŒ‚è½½è‡³å¯¹åº”podçš„å¯¹åº”ä½ç½®ï¼Œpodæ›´æ–°æˆ–æ£€ç´¢è‡ªå·±çš„ä¿¡æ¯æ—¶ï¼Œå®ƒä¼šæŠŠ/var/run/secrets/kubernetes.io/serviceaccountè¿™ä¸ªæ–‡ä»¶ä¸­çš„ä¿¡æ¯å‘é€ç»™apiserverè¿›è¡ŒéªŒè¯ï¼›æ­¤æ—¶apiserverä¸€éªŒè¯å¯¹åº”tokenä¿¡æ¯ï¼Œå°±èƒ½çŸ¥é“è¿™ä¸ªtokenæ˜¯å¯¹åº”saè´¦å·çš„tokenä¿¡æ¯ï¼Œä»è€Œè¯†åˆ«åˆ°å¯¹åº”saè´¦å·çš„æƒé™ï¼›æ‰€ä»¥podæ‰èƒ½å¤Ÿæ­£å¸¸çš„é€šè¿‡apiserveræ›´æ–°/æ£€ç´¢è‡ªå·±çš„çŠ¶æ€ä¿¡æ¯ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶kubeconfig&lt;/p&gt;
&lt;p&gt;ã€€ã€€åœ¨k8sä¸Šå„ä¸ªå®¢æˆ·ç«¯éƒ½æ˜¯ä¼˜å…ˆä½¿ç”¨è¯ä¹¦æ¥åšè®¤è¯ï¼Œapiserveré€šè¿‡éªŒè¯å„å®¢æˆ·ç«¯çš„è¯ä¹¦æ¥ç¡®è®¤å¯¹åº”çš„å®¢æˆ·ç«¯æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸è®¿é—®apiserverï¼›åœ¨k8sä¸Šè¯ä¹¦éªŒè¯æ˜¯åŒå‘çš„ï¼Œapiserverä¼šéªŒè¯å®¢æˆ·ç«¯çš„è¯ä¹¦ä¸­çš„subjä¸­çš„CNï¼ˆcommon nameï¼‰çš„ä¿¡æ¯ï¼Œæ˜¯å¦ç¬¦åˆå¯¹åº”å®¢æˆ·ç«¯æŒæœ‰çš„èº«ä»½ä¿¡æ¯ï¼Œå³ç”¨æˆ·åç§°ï¼›æŠŠè¯ä¹¦ä¸­çš„subjä¸­çš„Oï¼ˆorganizationï¼‰ä¿¡æ¯è§†ä¸ºå¯¹åº”ç”¨æˆ·ç»„ï¼›é™¤æ­¤ä¹‹å¤–apiserverè¿˜ä¼šéªŒè¯å¯¹åº”å®¢æˆ·ç«¯è¯ä¹¦æ˜¯å¦æ˜¯è‡ªå·±ä¿¡ä»»çš„CAæ‰€é¢å‘çš„è¯ä¹¦ï¼›å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œä¹Ÿæ˜¯åŒæ ·çš„é€»è¾‘ï¼Œå®ƒä¹Ÿéœ€è¦éªŒè¯apiserverçš„è¯ä¹¦æ˜¯å¦å»åˆå¯¹åº”apiserverçš„åç§°ï¼Œæ˜¯å¦æ˜¯åŒä¸€CAé¢å‘çš„è¯ä¹¦ï¼›é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ¯æ¬¡å®¢æˆ·ç«¯æ˜¯æ€ä¹ˆå‘apiserverå‘é€è‡ªå·±çš„çš„è¯ä¹¦ä¿¡æ¯çš„å‘¢ï¼Ÿåœ¨k8sä¸Šæ¯ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶ä¸»è¦ç”¨æ¥è®°å½•å®¢æˆ·ç«¯è¯ä¹¦éªŒè¯ç›¸å…³ä¿¡æ¯ï¼›è¿™ä¸ªé…ç½®æ–‡ä»¶æœ‰ä¸€ä¸ªç»Ÿä¸€çš„ç§°å‘¼å«kubeconfigï¼›ä¿å­˜åœ¨/etc/kubernetes/ç›®å½•ä¸‹ï¼›&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 ~]# ll /etc/kubernetes/
total 32
-rw------- 1 root root 5567 Dec 22 20:00 admin.conf
-rw------- 1 root root 5599 Dec 22 20:00 controller-manager.conf
-rw------- 1 root root 1955 Dec 22 20:01 kubelet.conf
drwxr-xr-x 2 root root  113 Dec 22 20:00 manifests
drwxr-xr-x 3 root root 4096 Dec 22 20:00 pki
-rw------- 1 root root 5547 Dec 22 20:00 scheduler.conf
[root@master01 ~]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼šæˆ‘ä»¬ä½¿ç”¨kubectlå®¢æˆ·ç«¯å·¥å…·å»è®¿é—®å¯¹åº”apiserveræ—¶ï¼Œé»˜è®¤æ²¡æœ‰æŒ‡å®šå…¶é…ç½®æ–‡ä»¶ï¼Œä¸»è¦åŸå› æ˜¯åœ¨å¯¹åº”Linuxç”¨æˆ·çš„å®¶ç›®å½•ä¸‹æœ‰ä¸€ä¸ª.kubeçš„ç›®å½•é‡Œæœ‰ä¸€ä¸ªconfigæ–‡ä»¶ï¼›è¿™ä¸ªæ–‡ä»¶æ˜¯æˆ‘ä»¬åœ¨åˆå§‹åŒ–é›†ç¾¤åï¼Œä»/etc/kubernetes/admin.confæ–‡ä»¶å¤åˆ¶è¿‡æ¥çš„ï¼Œä¸¤è€…å†…å®¹ä¸€æ ·ï¼›é»˜è®¤ä¸æŒ‡å®šå…¶é…ç½®æ–‡ä»¶kubectlä¼šåˆ°å½“å‰Linuxç”¨æˆ·æ‰€åœ¨å®¶ç›®å½•ä¸‹çš„.kube/configæ–‡ä»¶ä½œä¸ºå¯¹åº”è®¿é—®apiserverçš„è®¤è¯æ–‡ä»¶ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€æŸ¥çœ‹kubctlçš„é…ç½®æ–‡ä»¶å†…å®¹&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 manifests]# kubectl config view
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: DATA+OMITTED
    server: https://192.168.0.41:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
preferences: {}
users:
- name: kubernetes-admin
  user:
    client-certificate-data: REDACTED
    client-key-data: REDACTED
[root@master01 manifests]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼›k8sä¸Šçš„å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸»è¦æœ‰4éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼Œusersã€clustersã€contextsã€current-contextï¼›usersæ˜¯æŒ‡å®šç”¨æˆ·å¸å·ä»¥åŠç›¸å…³è®¤è¯åˆ—è¡¨ï¼›clustersç”¨æ¥æŒ‡å®šç›®æ ‡é›†ç¾¤åˆ—è¡¨ï¼›contextsç”¨æ¥æŒ‡å®šä»¥å“ªä¸ªuseræ¥å…¥é‚£ä¸ªclusterçš„å¯¹åº”è¿æ¥ç»„åˆï¼›curren-contextæ˜¯ç”¨æ¥æŒ‡å®šå½“å‰ä½¿ç”¨çš„contextï¼›ä»ä¸Šé¢çš„ä¿¡æ¯å¯ä»¥çœ‹åˆ°å½“å‰ä½¿ç”¨çš„æ˜¯kubernetes-admin@kubernetes contextè¿æ¥k8sé›†ç¾¤ï¼Œå¯¹åº”contextä¸­ï¼Œé›†ç¾¤åå«kubernetes,ä½¿ç”¨çš„ç”¨æˆ·æ˜¯kubernetes-adminï¼›è€Œå¯¹åº”é›†ç¾¤çš„åœ°å€æ˜¯https://192.168.0.41:6443,å¯¹åº”ç”¨æˆ·çš„çš„è¯ä¹¦å’Œç§é’¥è¿™é‡Œè¢«éšè—äº†ï¼›&lt;/p&gt;
&lt;p&gt;Â ã€€ã€€æŸ¥çœ‹é›†ç¾¤åˆ—è¡¨&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 manifests]# kubectl config get-clusters
NAME
kubernetes
[root@master01 manifests]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;33&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 manifests]# kubectl config get-users
NAME
kubernetes-admin
[root@master01 manifests]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æŸ¥çœ‹contextåˆ—è¡¨&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;33&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 manifests]# kubectl config get-contexts
CURRENT   NAME                          CLUSTER      AUTHINFO           NAMESPACE
*         kubernetes-admin@kubernetes   kubernetes   kubernetes-admin   
[root@master01 manifests]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„context&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;33&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 manifests]# kubectl config current-context
kubernetes-admin@kubernetes
[root@master01 manifests]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€ç¤ºä¾‹ï¼šåˆ›å»ºä¸€ä¸ªé›†ç¾¤ã€å¸¸è§„ç”¨æˆ·ã€contextï¼ŒæŠŠå¯¹åº”ä¿¡æ¯ä¿å­˜åˆ°ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œç”¨å¯¹åº”é…ç½®æ–‡ä»¶å»apiserverä¸Šè¯·æ±‚èµ„æºï¼Œçœ‹çœ‹æ˜¯å¦èƒ½å¤Ÿè¯·æ±‚åˆ°å¯¹åº”èµ„æºä¿¡æ¯ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ã€€ã€€åˆ›å»ºç§é’¥&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;36&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 manifests]# cd /etc/kubernetes/pki/
[root@master01 pki]# ls
apiserver.crt              apiserver-kubelet-client.crt  etcd                    front-proxy-client.key
apiserver-etcd-client.crt  apiserver-kubelet-client.key  front-proxy-ca.crt      sa.key
apiserver-etcd-client.key  ca.crt                        front-proxy-ca.key      sa.pub
apiserver.key              ca.key                        front-proxy-client.crt
[root@master01 pki]# openssl genrsa -out tom.key 2048
Generating RSA private key, 2048 bit long modulus
..............+++
..........................................................................................................................................................................................................................................+++
e is 65537 (0x10001)
[root@master01 pki]# ls
apiserver.crt              apiserver-kubelet-client.crt  etcd                    front-proxy-client.key
apiserver-etcd-client.crt  apiserver-kubelet-client.key  front-proxy-ca.crt      sa.key
apiserver-etcd-client.key  ca.crt                        front-proxy-ca.key      sa.pub
apiserver.key              ca.key                        front-proxy-client.crt  tom.key
[root@master01 pki]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€ä½¿ç”¨tom.keyä¸ºtomç”¨æˆ·ç”Ÿæˆç­¾ç½²è¯·æ±‚æ–‡ä»¶tom.csr&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 pki]# openssl req -new -key ./tom.key -out tom.csr -subj &quot;/CN=tom/O=myuser&quot;
[root@master01 pki]# ls
apiserver.crt                 apiserver-kubelet-client.key  front-proxy-ca.key      tom.csr
apiserver-etcd-client.crt     ca.crt                        front-proxy-client.crt  tom.key
apiserver-etcd-client.key     ca.key                        front-proxy-client.key
apiserver.key                 etcd                          sa.key
apiserver-kubelet-client.crt  front-proxy-ca.crt            sa.pub
[root@master01 pki]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€ä½¿ç”¨apiserverä¿¡ä»»çš„caç»™tomç”¨æˆ·ç­¾å‘è¯ä¹¦&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 pki]# openssl x509 -req -in tom.csr -CA ./ca.crt -CAkey ./ca.key  -CAcreateserial -out tom.crt -days 365
Signature ok
subject=/CN=tom/O=myuser
Getting CA Private Key
[root@master01 pki]# ls
apiserver.crt                 apiserver-kubelet-client.key  front-proxy-ca.key      tom.crt
apiserver-etcd-client.crt     ca.crt                        front-proxy-client.crt  tom.csr
apiserver-etcd-client.key     ca.key                        front-proxy-client.key  tom.key
apiserver.key                 etcd                          sa.key
apiserver-kubelet-client.crt  front-proxy-ca.crt            sa.pub
[root@master01 pki]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼šè¿™é‡Œä½¿ç”¨çš„CAå¿…é¡»è¦ç”¨apiserverä¿¡ä»»çš„caæ¥ç­¾å‘è¯ä¹¦ï¼Œå¦åˆ™apiserverå®ƒä¸è®¤ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€åˆ›å»ºé›†ç¾¤ï¼ŒæŒ‡å®šå¯¹åº”caçš„è¯ä¹¦ä¿¡æ¯ï¼Œé›†ç¾¤åå­—ä»¥åŠé›†ç¾¤çš„åœ°å€&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;34&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 ~]# kubectl config set-cluster myk8s --server=&quot;https://192.168.0.41:6443&quot; --certificate-authority=/etc/kubernetes/pki/ca.crt --embed-certs=true
Cluster &quot;myk8s&quot; set.
[root@master01 ~]# kubectl config get-clusters
NAME
myk8s
kubernetes
[root@master01 ~]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼š--embed-certs=tureè¡¨ç¤ºéšè—è¯ä¹¦ä¿¡æ¯ï¼›è¿™é‡Œé»˜è®¤æ²¡æœ‰æŒ‡å®šå°†é…ç½®ä¿¡æ¯ä¿å­˜åœ¨é‚£ä¸ªé…ç½®æ–‡ä»¶ï¼Œé»˜è®¤å°±ä¿å­˜åœ¨å½“å‰é…ç½®æ–‡ä»¶ï¼ˆç”¨æˆ·å®¶ç›®å½•çš„./kube/configæ–‡ä»¶ä¸­ï¼‰ï¼›å¦‚æœè¦æƒ³æŒ‡å®šä¿å­˜åœ¨æŸä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥åœ¨åé¢åŠ ä¸Š--kubeconfigé€‰é¡¹æ¥æŒ‡å®šå¯¹åº”çš„é…ç½®æ–‡ä»¶å³å¯ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€æŠŠåˆ›å»ºé›†ç¾¤çš„é…ç½®ä¿å­˜åœ¨/tmp/myk8s.configæ–‡ä»¶ä¸­&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 ~]# kubectl config set-cluster myk8s --server=&quot;https://192.168.0.41:6443&quot; --certificate-authority=/etc/kubernetes/pki/ca.crt --embed-certs=true --kubeconfig=/tmp/myk8s.config
Cluster &quot;myk8s&quot; set.
[root@master01 ~]# kubectl config get-clusters --kubeconfig=/tmp/myk8s.config
NAME
myk8s
[root@master01 ~]# cat /tmp/myk8s.config             
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM1ekNDQWMrZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJd01USXdPREEyTXpnMU5Gb1hEVE13TVRJd05qQTJNemcxTkZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBSzZXCjl5Mkc5YUxFc3h1Q3dNQllBbEdtRys5TG5nMU9OWm9aRDZDd2ZLUUY3Y3lHSStuN1BwSDJFT2o1K292WlBNWG0KckpNaVFHOXB2bVNDZC9FRkxod05YRWNOREZDbGF6Y0cvQ1B0QjlCRlQ1ZGdVMXJnMGxvRUxEVXduUk16eU43QwozRkdacW9maW9kMXJZaGhRaHpDc2N6a0w3dWJjcTBOS2NFQjY0OTB1N0hyeVZ5Y0pGSmwzR0ZKVnN0d0pYZkV1CmtVQ2s2bVlYNFFWb2NObHlKVWZLaWZUMFBZSVQwVVBqZWwvc2NrTnJIUjFFTU5sVXJOWXlHMkJ1cTFhSENhZ2oKRGNrUWh5dU44cTZqNERiSGwrS0pJUTNtN0dxL29vTzBSMm5LNFlKUVMyZjI4bkFhWkRlRWZZcDEwdmg0ditUQwpjaXI5RStmYm1EYWFUQXNsVGdrQ0F3RUFBYU5DTUVBd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZMNVRSSG9QUGJDWk4vUFRVcjdCZGVidmdkMFRNQTBHQ1NxR1NJYjMKRFFFQkN3VUFBNElCQVFBQTRxa3prejNsTGFRYlQ3a0x3SnBoTXZnczJUdzU1b01VYWlzdlBJczVwSk1aZmNwNQpDcFdiRnc1VzR6R0RqWFBpRUExb3BvOEFEQzlXTERZem01eHV3V1ZQeWlWZzRmWjYxK3hISU9KMnlnQW4rWEo1CjRVUHMzYUl3RUJ3OHNPdTM4c1N0a29HNDJTY1gzTXR5cDRjRHJDakFGYnVrMUR5U3E5RytOWG9iL3FVdWxDWC8KSkdzSUJZd3pHVmVDSzVweVJDdHUwY0VRWkp4N1pQc2RhOXcwWXVBdGt5dFN3YkxVakU5MWpMNDV4blRHdllpMwo4eC9ocmJOYVBKUjVlNStpZlZqQVR1TDNHM3liNkduaVNsMGNBSDlNeEUzNE50MStwUFlOTmduVk9HdC9SZTdwClVubzVocXd4RTB2cmQxanU2YlVmVDZ6U0ozb1hpejI5Ri93RwotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    server: https://192.168.0.41:6443
  name: myk8s
contexts: null
current-context: &quot;&quot;
kind: Config
preferences: {}
users: null
[root@master01 ~]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼šè¿™é‡Œçš„è¯ä¹¦ä¿¡æ¯æ˜¯ä¸€base64ç¼–ç å¤„ç†ä»¥åçš„ä¿¡æ¯ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€åˆ›å»ºç”¨æˆ·ï¼ŒæŒ‡å®šå¯¹åº”ç”¨æˆ·åç§°ï¼Œç”¨æˆ·è¯ä¹¦å’Œç§é’¥ä¿¡æ¯&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 ~]# kubectl config set-credentials tom --client-certificate=/etc/kubernetes/pki/tom.crt --client-key=/etc/kubernetes/pki/tom.key --username=tom --embed-certs=true
User &quot;tom&quot; set.
[root@master01 ~]# kubectl config set-credentials tom --client-certificate=/etc/kubernetes/pki/tom.crt --client-key=/etc/kubernetes/pki/tom.key --username=tom --embed-certs=true --kubeconfig=/tmp/myk8s.config
User &quot;tom&quot; set.
[root@master01 ~]# kubectl config view --kubeconfig=/tmp/myk8s.config
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: DATA+OMITTED
    server: https://192.168.0.41:6443
  name: myk8s
contexts: null
current-context: &quot;&quot;
kind: Config
preferences: {}
users:
- name: tom
  user:
    client-certificate-data: REDACTED
    client-key-data: REDACTED
    username: tom
[root@master01 ~]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼š--usernameæŒ‡å®šçš„åå­—å°½é‡åŒè¯ä¹¦ä¸­çš„CNåç§°ç›¸åŒï¼Œå› ä¸ºapiserverä¼šæŠŠCNçš„ä¿¡æ¯è¯†åˆ«ä¸ºå¯¹åº”ç”¨æˆ·ä¿¡æ¯ï¼›è¿™é‡Œè¡¥å……ä¸€ç‚¹ï¼Œåœ¨k8sä¸Šæ²¡æœ‰çœŸæ­£çš„äººç±»ç”¨æˆ·ï¼Œå®ƒæ˜¯æŠŠå¯¹åº”å®¢æˆ·ç«¯çš„è¯ä¹¦ä¸­çš„CNä¿¡æ¯è¯†åˆ«æˆå¯¹åº”æ“ä½œè¯¥å®¢æˆ·ç«¯çš„ç”¨æˆ·ï¼›åªè¦å¯¹åº”çš„è¯ä¹¦èƒ½å¤Ÿé€šè¿‡è®¤è¯ï¼Œä¸ç®¡å¯¹åº”æ“ä½œè€…æ˜¯è°ï¼Œk8så¹¶ä¸å…³å¿ƒï¼›å°±åƒæˆ‘ä»¬åœ¨ä½¿ç”¨Linuxæ—¶ï¼Œæ‹¿ç€rootç”¨æˆ·ç™»å½•äº†ç³»ç»Ÿï¼Œåªè¦å¯†ç æ­£ç¡®ï¼ŒLinuxå†…æ ¸å°±è®¤ä¸ºæ˜¯rootåœ¨æ“ä½œï¼›è¿™é‡Œçš„è¯ä¹¦å°±å¥½æ¯”Linuxrootçš„å¯†ç ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€åˆ›å»ºcontextï¼ŒæŠŠtomç”¨æˆ·å’Œmyk8sé›†ç¾¤åšå…³è”ï¼Œå¹¶æŒ‡å®šå¯¹åº”contextçš„åç§°&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 ~]# kubectl config set-context tom@myk8s --cluster=myk8s --user=tom
Context &quot;tom@myk8s&quot; created.
[root@master01 ~]# kubectl config set-context tom@myk8s --cluster=myk8s --user=tom --kubeconfig=/tmp/myk8s.config             
Context &quot;tom@myk8s&quot; created.
[root@master01 ~]# kubectl config view --kubeconfig=/tmp/myk8s.config                                          
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: DATA+OMITTED
    server: https://192.168.0.41:6443
  name: myk8s
contexts:
- context:
    cluster: myk8s
    user: tom
  name: tom@myk8s
current-context: &quot;&quot;
kind: Config
preferences: {}
users:
- name: tom
  user:
    client-certificate-data: REDACTED
    client-key-data: REDACTED
    username: tom
[root@master01 ~]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼šåˆ›å»ºcontextå°½é‡åšåˆ°è§åçŸ¥æ„ï¼›ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨ç”¨æˆ·å@é›†ç¾¤åçš„æ ¼å¼ä¸ºcontextå‘½åï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€åˆ°æ­¤ï¼Œå¯¹åº”tomç”¨æˆ·çš„é…ç½®æ–‡ä»¶å°±åšå¥½äº†ï¼Œæˆ‘ä»¬åœ¨/tmp/myk8s.configæ–‡ä»¶ä¸­ä¿å­˜äº†å¯¹åº”æ–°å»ºçš„ç”¨æˆ·ã€é›†ç¾¤ã€contextä¿¡æ¯ï¼Œåœ¨å½“å‰é…ç½®æ–‡ä»¶ä¸­ä¹Ÿä¿å­˜äº†ç›¸åº”çš„é…ç½®ä¿¡æ¯ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€æµ‹è¯•ï¼šåœ¨æ²¡æœ‰åˆ‡æ¢é…ç½®ä¹‹å‰ï¼ŒæŸ¥çœ‹é›†ç¾¤è¿è¡Œåœ¨defaultåç§°ç©ºé—´è¿è¡Œçš„pod&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 ~]# kubectl config get-contexts
CURRENT   NAME                          CLUSTER      AUTHINFO           NAMESPACE
*         kubernetes-admin@kubernetes   kubernetes   kubernetes-admin   
          tom@myk8s                     myk8s        tom                
[root@master01 ~]# kubectl get pods
NAME             READY   STATUS    RESTARTS   AGE
nginx-pod-demo   1/1     Running   0          117m
web-0            1/1     Running   1          27h
web-1            1/1     Running   1          27h
web-2            1/1     Running   1          27h
web-3            1/1     Running   2          27h
[root@master01 ~]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼šå½“å‰é…ç½®è¿˜æ˜¯ç”¨çš„kubernetes-admin@kubernetesè¿™ä¸ªcontextï¼ŒæŸ¥çœ‹defaultåç§°ç©ºé—´ä¸‹çš„podèƒ½å¤Ÿæ­£å¸¸æŸ¥è¯¢åˆ°ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€åˆ‡æ¢contextåˆ°tom@myk8s contextä¸Šï¼Œçœ‹çœ‹æ˜¯å¦è¿˜èƒ½çœ‹åˆ°defaultåç§°ç©ºé—´ä¸‹çš„pod å‘¢ï¼Ÿ&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 ~]# kubectl config use-context tom@myk8s   
Switched to context &quot;tom@myk8s&quot;.
[root@master01 ~]# kubectl config get-contexts         
CURRENT   NAME                          CLUSTER      AUTHINFO           NAMESPACE
          kubernetes-admin@kubernetes   kubernetes   kubernetes-admin   
*         tom@myk8s                     myk8s        tom                
[root@master01 ~]# kubectl get pods
Error from server (Forbidden): pods is forbidden: User &quot;tom&quot; cannot list resource &quot;pods&quot; in API group &quot;&quot; in the namespace &quot;default&quot;
[root@master01 ~]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼šå¯ä»¥çœ‹åˆ°åˆ‡æ¢åˆ°tom@myk8sè¿™ä¸ªcontextåï¼Œå†æ¬¡æŸ¥çœ‹defaultåç§°ç©ºé—´ä¸‹podåˆ—è¡¨å°±çœ‹ä¸åˆ°ï¼›è¿™é‡Œæç¤ºæˆ‘ä»¬æƒé™æ‹’ç»ï¼›å…¶å®çœ‹ä¸åˆ°æ‰æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºæˆ‘ä»¬åªæ˜¯æŠŠtomç”¨æˆ·æ¥å…¥åˆ°apiserverä¸Šè¿›è¡Œè®¤è¯ï¼Œå¹¶æ²¡æœ‰ç»™ä»–æˆæƒï¼Œæ‰€ä»¥tomç”¨æˆ·ç›®å‰åªæ˜¯é€šè¿‡äº†éªŒè¯ï¼Œå¹¶æ²¡æœ‰å¯¹èµ„æºçš„æ“ä½œæƒé™ï¼Œåœ¨æƒé™éªŒè¯æ—¶ç»™æ‹’ç»äº†ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä½¿ç”¨/tmp/myk8s.configé…ç½®æ–‡ä»¶æŸ¥çœ‹defaultåç§°ç©ºé—´ä¸‹çš„podåˆ—è¡¨&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 ~]# kubectl config get-contexts --kubeconfig=/tmp/myk8s.config
CURRENT   NAME        CLUSTER   AUTHINFO   NAMESPACE
          tom@myk8s   myk8s     tom        
[root@master01 ~]# kubectl config use-context tom@myk8s --kubeconfig=/tmp/myk8s.config 
Switched to context &quot;tom@myk8s&quot;.
[root@master01 ~]# kubectl config get-contexts --kubeconfig=/tmp/myk8s.config         
CURRENT   NAME        CLUSTER   AUTHINFO   NAMESPACE
*         tom@myk8s   myk8s     tom        
[root@master01 ~]# kubectl get pods --kubeconfig=/tmp/myk8s.config
Error from server (Forbidden): pods is forbidden: User &quot;tom&quot; cannot list resource &quot;pods&quot; in API group &quot;&quot; in the namespace &quot;default&quot;
[root@master01 ~]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼šä½¿ç”¨/tmp/myk8s.configé…ç½®æ–‡ä»¶å»apiserverä¸ŠéªŒè¯ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„æƒ…å†µçœ‹ä¸åˆ°podï¼Œå“åº”æˆ‘ä»¬å¯¹åº”èµ„æºç¦æ­¢è®¿é—®ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€åˆ‡å›kubernetes-admin@kubernetes contextå†æ¬¡æŸ¥çœ‹defaultåç§°ç©ºé—´ä¸‹çš„podåˆ—è¡¨&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 ~]# kubectl config use-context kubernetes-admin@kubernetes
Switched to context &quot;kubernetes-admin@kubernetes&quot;.
[root@master01 ~]# kubectl config get-contexts
CURRENT   NAME                          CLUSTER      AUTHINFO           NAMESPACE
*         kubernetes-admin@kubernetes   kubernetes   kubernetes-admin   
          tom@myk8s                     myk8s        tom                
[root@master01 ~]# kubectl get pods
NAME             READY   STATUS    RESTARTS   AGE
nginx-pod-demo   1/1     Running   0          132m
web-0            1/1     Running   1          27h
web-1            1/1     Running   1          27h
web-2            1/1     Running   1          27h
web-3            1/1     Running   2          27h
[root@master01 ~]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼šåˆ‡å›kubernetes-admin@kubernetes contextåï¼ŒæŸ¥çœ‹defaultåç§°ç©ºé—´ä¸‹çš„podåˆ—è¡¨ï¼Œèƒ½å¤Ÿæ­£å¸¸æŸ¥çœ‹åˆ°ï¼Œè¿™æ˜¯å› ä¸ºåˆ‡æ¢contextä»¥åï¼Œå¯¹åº”çš„ç”¨æˆ·è®¤è¯åœ¨apiserveræœ‰æŸ¥çœ‹å¯¹åº”èµ„æºçš„æƒé™ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€åˆ›å»ºä¸€ä¸ªsaè´¦å·&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;33&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 ~]# cat sa-demo.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: sa-demo
  namespace: default
[root@master01 ~]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼šsaæ˜¯k8sä¸Šçš„ä¸€ä¸ªæ ‡å‡†èµ„æºï¼Œå…¶ç¾¤ç»„ä¸ºv1ï¼Œç±»å‹ä¸ºServiceAccountï¼›å…¶ä¸­metadata.nameæ˜¯ç”¨æ¥æŒ‡å®šsaè´¦å·çš„åç§°ï¼Œnamespaceç”¨æ¥æŒ‡å®šå…¶åç§°ç©ºé—´ä¿¡æ¯ï¼›åˆ›å»ºä¸€ä¸ªsaèµ„æºç”¨æˆ·åªéœ€è¦å®šä¹‰å¯¹åº”çš„åç§°å’Œåç§°ç©ºé—´å°±å¯ä»¥äº†ï¼›å¯¹åº”secretèµ„æºä¼šè‡ªåŠ¨åˆ›å»ºå¹¶ç”Ÿæˆçš„å¯¹åº”çš„tokenä¿¡æ¯ï¼›è¿™æ ·ä¸€æ¥å°±æ„å‘³ç€åªè¦æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªsaè´¦å·ï¼Œåœ¨k8sä¸Šå°±èƒ½å¤Ÿè¢«è®¤è¯é€šè¿‡ï¼›å› ä¸ºåˆ›å»ºsaå®ƒè‡ªåŠ¨åˆ›å»ºsecretå¹¶å°†å¯¹åº”çš„tokenç”Ÿæˆå¥½ï¼›æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºåˆ›å»ºsecretå¹¶ç”Ÿæˆtokençš„è¿‡ç¨‹å°±æ˜¯åœ¨æŠŠå¯¹åº”saè´¦å·å’Œå¯¹åº”tokenè¿›è¡Œå…³è”ï¼›&lt;/p&gt;
&lt;p&gt;ã€€ã€€åº”ç”¨èµ„æºæ¸…å•&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:bash;gutter:true;&quot;&gt;
[root@master01 ~]# kubectl apply -f sa-demo.yaml
serviceaccount/sa-demo created
[root@master01 ~]# kubectl get sa 
NAME      SECRETS   AGE
default   1         21d
sa-demo   1         5s
[root@master01 ~]# kubectl describe sa sa-demo
Name:                sa-demo
Namespace:           default
Labels:              &amp;lt;none&amp;gt;
Annotations:         &amp;lt;none&amp;gt;
Image pull secrets:  &amp;lt;none&amp;gt;
Mountable secrets:   sa-demo-token-8kjhc
Tokens:              sa-demo-token-8kjhc
Events:              &amp;lt;none&amp;gt;
[root@master01 ~]# kubectl get secret
NAME                           TYPE                                  DATA   AGE
default-token-xvd4c            kubernetes.io/service-account-token   3      21d
docker-registry.io             kubernetes.io/dockerconfigjson        1      3d1h
mysql-auth                     Opaque                                2      3d
sa-demo-token-8kjhc            kubernetes.io/service-account-token   3      26s
test-secret-demo               Opaque                                2      2d23h
test-secret-demo1              Opaque                                2      2d23h
test-tls                       kubernetes.io/tls                     2      3d
www-myapp-com-ingress-secret   kubernetes.io/tls                     2      7d23h
[root@master01 ~]# kubectl describe secret sa-demo-token-8kjhc
Name:         sa-demo-token-8kjhc
Namespace:    default
Labels:       &amp;lt;none&amp;gt;
Annotations:  kubernetes.io/service-account.name: sa-demo
              kubernetes.io/service-account.uid: 34cb62e8-23bd-4f2b-be82-4a8c9afc4037

Type:  kubernetes.io/service-account-token

Data
====
ca.crt:     1066 bytes
namespace:  7 bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IjM4WnU0Z1Q1c0hBNmR5Q1V0ejRaMFk4d2J2WncwWjNiUTAxZk02SGN4OTgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6InNhLWRlbW8tdG9rZW4tOGtqaGMiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoic2EtZGVtbyIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjM0Y2I2MmU4LTIzYmQtNGYyYi1iZTgyLTRhOGM5YWZjNDAzNyIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OnNhLWRlbW8ifQ.XyYaqpeZXexal1wr1aiBaZOelRJtlQ2drElDcvWIep1yj4TNYKhqsEUA11fzazStUahpLzuTMXGHMDG7AKA8MqBgBUxRW7UPNBxF7_radK4dfUxig_049Dp7nBYpPKl3sRyPfZcm_R0bXrnXfiMj7KEsfenx3_Skr7R0Wtc4asuVcLgYR1PGFMKbAqi_FDLlZYsledP74fGs3pGNnQ46LNaZ7-ZrsDuIOCxsaJ-QKR_zUQni8wmmKYzGmuVTRvSmlk79DCjMhmVJ6B-AOtXLc8N8yoZ35_ZtXc5VyBTdGTYtIE6x7O6kUlNMFZQLwYgRnUQJdwbfSEUAJXD4b7KMQw
[root@master01 ~]# 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€æç¤ºï¼šå¯ä»¥çœ‹åˆ°åº”ç”¨èµ„æºæ¸…å•ä»¥åï¼Œå¯¹åº”saå°±æˆåŠŸè¢«åˆ›å»ºï¼ŒåŒæ—¶æŸ¥çœ‹saçš„è¯¦ç»†ä¿¡æ¯ï¼Œå®ƒå…³è”äº†ä¸€ä¸ªsecretèµ„æºï¼Œå¯¹åº”secretèµ„æºçš„è¯¦ç»†ä¿¡æ¯ä¸­æ˜ç¡®æ ‡æ³¨äº†å¯¹åº”saç”¨æˆ·åç§°ä¸ºsa-demoï¼›ä»ä¸Šé¢åé¦ˆçš„ä¿¡æ¯æˆ‘ä»¬ä¸éš¾ç†è§£ï¼Œåˆ›å»ºsaè´¦å·ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªsecretï¼Œå¹¶ä¸”æŠŠå¯¹åº”çš„secretä¸­çš„tokenä¸saè´¦å·åšç»‘å®šï¼›è¿™å°±æ„å‘³ç€ï¼Œæˆ‘ä»¬åªè¦æ‹¿ç€å¯¹åº”çš„tokenå»apiserverè®¤è¯ï¼Œå¯¹åº”apiserverä¸€å®šèƒ½å¤Ÿåœ¨etcdä¸­æŸ¥åˆ°å¯¹åº”çš„tokenç»‘å®šçš„saè´¦å·ï¼›ä»è€Œå¯¹åº”saè´¦å·å°±èƒ½é¡ºåˆ©çš„é€šè¿‡apiserverä¸­çš„è®¤è¯æœºåˆ¶ï¼›&lt;/p&gt;
</description>
<pubDate>Tue, 29 Dec 2020 18:15:00 +0000</pubDate>
<dc:creator>Linux-1874</dc:creator>
<og:description>å‰æ–‡æˆ‘ä»¬èŠåˆ°äº†k8sçš„statefulsetæ§åˆ¶å™¨ç›¸å…³ä½¿ç”¨è¯´æ˜ï¼Œå›é¡¾è¯·å‚è€ƒï¼šhttps://www.cnblogs.com/qiuhom-1874/p/14201103.htmlï¼›ä»Šå¤©æˆ‘ä»¬æ¥èŠä¸€ä¸‹k8</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/qiuhom-1874/p/14207381.html</dc:identifier>
</item>
<item>
<title>ç¨‹åºå‘˜ä½ æ˜¯å¦‚ä½•ä½¿ç”¨é•œåƒä¸­å¿ƒHarborçš„ï¼Ÿ - æç¦æ˜¥</title>
<link>http://www.cnblogs.com/snidget/p/14209453.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/snidget/p/14209453.html</guid>
<description>&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/268922/202012/268922-20201230000616833-218626247.png&quot; alt=&quot;file&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;p&gt;harborå³dockerçš„ç§æœï¼›ç®¡ç†å…¬å¸å†…éƒ¨è¾“å‡ºçš„é•œåƒåˆ¶å“ï¼›&lt;/p&gt;
&lt;p&gt;æ˜¯VMwareå…¬å¸ä¸­å›½å›¢é˜Ÿä¸ºä¼ä¸šç”¨æˆ·è®¾è®¡çš„é•œåƒæ³¨å†ŒæœåŠ¡å™¨ï¼Œç”¨é€”ï¼šå­˜å‚¨å’Œåˆ†å‘dockeré•œåƒï¼›&lt;/p&gt;
&lt;p&gt;åœ¨å®˜æ–¹çš„docker registryæœåŠ¡ä¸­å¢åŠ äº†å®‰å…¨ï¼Œè®¿é—®æ§åˆ¶ï¼Œå®¡è®¡ï¼Œç®¡ç†é¡µé¢ï¼Œå‘ç°ï¼Œé«˜å¯ç”¨ç­‰åŠŸèƒ½ï¼›&lt;/p&gt;

&lt;p&gt;æ‰¾ä¸€å°linuxæœºå™¨ï¼šæå‰å®‰è£…å¥½docker-compose;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ä¸‹è½½harborå®‰è£…åŒ…&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;ä¸‹è½½ä¸ä¸‹æ¥å¯åˆ°csdnä¸Šæ‰¾ä¸€ä¸ªå›½å†…çš„èµ„æºä¸‹è½½ï¼›&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;wget https://github.com/goharbor/harbor/releases/download/v2.1.2/harbor-offline-installer-v2.1.2.tgz
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;2&quot;&gt;&lt;li&gt;è§£å‹&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;tar -xzvf harbor-offline-installer-v2.1.2.tgz
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;3&quot;&gt;&lt;li&gt;ä¿®æ”¹é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;vim harbor.cfg
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä¿®æ”¹:&lt;/p&gt;
&lt;p&gt;harbor_admin_passwordï¼› é»˜è®¤å¯†ç &lt;/p&gt;
&lt;p&gt;hostnameï¼šè®¿é—®ip&lt;/p&gt;
&lt;ol start=&quot;4&quot;&gt;&lt;li&gt;å¯åŠ¨harbor&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;./install.sh
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;5&quot;&gt;&lt;li&gt;æŸ¥çœ‹å®¹å™¨&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;docker ps
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;6&quot;&gt;&lt;li&gt;å¯åœharbor,é€šè¿‡docker-composeçš„æ–¹å¼è¿›è¡Œ&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;docker-compose stop
docker-compose start
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;harboré»˜è®¤ä¿¡ä»»httpsåè®®ï¼Œæ‰€ä»¥å¦‚æœdockerå‘½ä»¤ç™»å½•å’Œæ¨é€é•œåƒï¼Œéœ€è¦æ·»åŠ  --insecure-registryåˆ°dockeré…ç½®æ–‡ä»¶ï¼›&lt;/p&gt;
&lt;p&gt;ä¿®æ”¹é…ç½®æ–¹æ³•ï¼š&lt;/p&gt;

&lt;p&gt;æ‰“å¼€ï¼š &lt;a href=&quot;http://hostname/harbor&quot; target=&quot;_blank&quot;&gt;http://hostname/harbor&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è´¦å·ï¼š admin&lt;/p&gt;
&lt;p&gt;å¯†ç : ä½ é¢„è®¾çš„ç®¡ç†å‘˜å¯†ç &lt;/p&gt;
&lt;p&gt;å·²ç»æ­å»ºå¥½çš„harborç¯å¢ƒï¼š&lt;/p&gt;

&lt;ol&gt;&lt;li&gt;dockerç™»å½•æ³¨å†Œä¸­å¿ƒ&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;docker login  -u admin -password-stdin xxxx   xxx.com
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;2&quot;&gt;&lt;li&gt;æœ¬åœ°dockeré•œåƒæ‰“tagï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;docker tag repox:tagName xxx.com/project/repox:tagName
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;3&quot;&gt;&lt;li&gt;æœ¬åœ°é•œåƒæ¨é€ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;docker push  xxx.com/myproject/myrepo:mytag
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;4&quot;&gt;&lt;li&gt;è¿œç¨‹è·å–é•œåƒå¹¶è¿è¡Œï¼›&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;å…ˆç™»å½•ï¼Œç„¶åç›´æ¥ä»é•œåƒä¸­å¿ƒè·å–é•œåƒå³å¯ï¼›&lt;/p&gt;
&lt;p&gt;è§æ­¥éª¤1ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;docker pull xxx.com/project/repox:tagName
&lt;/code&gt;
&lt;/pre&gt;

&lt;p&gt;åŸºäºdockerå’Œdocker-composeæ¥è¿è¡Œæœ¬åœ°å¼€å‘å¥½çš„ç¨‹åºï¼›&lt;/p&gt;
&lt;ol readability=&quot;0&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;æœ¬åœ°ä½œä¸ºciçš„ç¯å¢ƒï¼Œåˆ¶ä½œé•œåƒæ¨é€åˆ°harbor;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;è¿œç¨‹æœåŠ¡å™¨ä½œä¸ºCDçš„ç¯å¢ƒï¼Œé€šè¿‡harboræ‹‰å–é•œåƒæ¥è¿è¡Œç¨‹åºï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;æ‰©å±•ä½œä¸ºk8sçš„é•œåƒä»“åº“ï¼Œæ”¯æŒk8séƒ¨ç½²ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/268922/202012/268922-20201230000617163-562944413.png&quot; alt=&quot;file&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;

&lt;p&gt;æºç ï¼š &lt;a href=&quot;https://github.com/goharbor/harbor&quot; target=&quot;_blank&quot;&gt;https://github.com/goharbor/harbor&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å®˜ç½‘ï¼š &lt;a href=&quot;https://goharbor.io/&quot; target=&quot;_blank&quot;&gt;https://goharbor.io/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;harborå®‰è£…å’Œä½¿ç”¨ï¼š &lt;a href=&quot;https://www.toutiao.com/a6840826675383501320/&quot; target=&quot;_blank&quot;&gt;https://www.toutiao.com/a6840826675383501320/&lt;/a&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;åŸåˆ›ä¸æ˜“ï¼Œå…³æ³¨è¯šå¯è´µï¼Œè½¬å‘ä»·æ›´é«˜ï¼è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œè®©æˆ‘ä»¬äº’é€šæœ‰æ— ï¼Œå…±åŒè¿›æ­¥ï¼Œæ¬¢è¿æ²Ÿé€šäº¤æµã€‚&lt;/p&gt;
&lt;/blockquote&gt;
</description>
<pubDate>Tue, 29 Dec 2020 16:06:00 +0000</pubDate>
<dc:creator>æç¦æ˜¥</dc:creator>
<og:description>èƒŒæ™¯ harborå³dockerçš„ç§æœï¼›ç®¡ç†å…¬å¸å†…éƒ¨è¾“å‡ºçš„é•œåƒåˆ¶å“ï¼› æ˜¯VMwareå…¬å¸ä¸­å›½å›¢é˜Ÿä¸ºä¼ä¸šç”¨æˆ·è®¾è®¡çš„é•œåƒæ³¨å†ŒæœåŠ¡å™¨ï¼Œç”¨é€”ï¼šå­˜å‚¨å’Œåˆ†å‘dockeré•œåƒï¼› åœ¨å®˜æ–¹çš„docker registr</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/snidget/p/14209453.html</dc:identifier>
</item>
<item>
<title>Gitlab Runnerçš„åˆ†å¸ƒå¼ç¼“å­˜å®æˆ˜ - ç¨‹åºå‘˜æ¬£å®¸</title>
<link>http://www.cnblogs.com/bolingcavalry/p/14209386.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/bolingcavalry/p/14209386.html</guid>
<description>&lt;h3 id=&quot;æ¬¢è¿è®¿é—®æˆ‘çš„github&quot;&gt;æ¬¢è¿è®¿é—®æˆ‘çš„GitHub&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/zq2599/blog_demos&quot; target=&quot;_blank&quot;&gt;https://github.com/zq2599/blog_demos&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å†…å®¹ï¼šæ‰€æœ‰åŸåˆ›æ–‡ç« åˆ†ç±»æ±‡æ€»åŠé…å¥—æºç ï¼Œæ¶‰åŠJavaã€Dockerã€Kubernetesã€DevOPSç­‰ï¼›&lt;/p&gt;
&lt;h3 id=&quot;å…³äºæœ¬æ–‡&quot;&gt;å…³äºæœ¬æ–‡&lt;/h3&gt;
&lt;p&gt;æœ¬æ–‡ç›®æ ‡æ˜¯ä¸ºK8Sç¯å¢ƒçš„Gitlab Runnerå‡†å¤‡å¥½åˆ†å¸ƒå¼ç¼“å­˜ï¼Œå¹¶åœ¨pipelineè„šæœ¬ä¸­ä½¿ç”¨è¯¥ç¼“å­˜ï¼Œå› æ­¤ï¼Œåœ¨é˜…è¯»æœ¬æ–‡å‰å»ºè®®æ‚¨å¯¹GitLab CIæœ‰ä¸€å®šäº†è§£ï¼Œæœ€å¥½æ˜¯é˜…è¯»è¿‡ç”šè‡³ç¼–å†™è¿‡pipelineè„šæœ¬ï¼›&lt;/p&gt;
&lt;h3 id=&quot;å…³äºgitlab-runner&quot;&gt;å…³äºGitLab Runner&lt;/h3&gt;
&lt;p&gt;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¼€å‘è€…å°†ä»£ç æäº¤åˆ°GitLabåï¼Œå¯ä»¥è§¦å‘CIè„šæœ¬åœ¨GitLab Runnerä¸Šæ‰§è¡Œï¼Œé€šè¿‡ç¼–å†™CIè„šæœ¬æˆ‘ä»¬å¯ä»¥å®Œæˆå¾ˆå¤šä½¿ç”¨çš„åŠŸèƒ½ï¼šç¼–è¯‘ã€æ„å»ºã€ç”Ÿæˆdockeré•œåƒã€æ¨é€åˆ°ç§æœ‰ä»“åº“ç­‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201229234505598-2116260564.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;gitlab-runnerçš„åˆ†å¸ƒå¼ç¼“å­˜&quot;&gt;Gitlab Runnerçš„åˆ†å¸ƒå¼ç¼“å­˜&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;å®˜æ–¹æ–‡æ¡£åœ°å€ï¼Œæœ‰å…³ç¼“å­˜çš„è¯¦æƒ…å¯ä»¥å‚è€ƒæ­¤æ–‡ï¼š&lt;a href=&quot;https://docs.gitlab.com/runner/configuration/autoscale.html#distributed-runners-caching&quot; target=&quot;_blank&quot;&gt;https://docs.gitlab.com/runner/configuration/autoscale.html#distributed-runners-caching&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¦‚ä¸‹æ˜¯å®˜æ–¹çš„åˆ†å¸ƒå¼ç¼“å­˜ç¤ºä¾‹(config.toml æ–‡ä»¶)ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;[[runners]]
  limit = 10
  executor = &quot;docker+machine&quot;
  [runners.cache]
    Type = &quot;s3&quot;
    Path = &quot;path/to/prefix&quot;
    Shared = false
    [runners.cache.s3]
      ServerAddress = &quot;s3.example.com&quot;
      AccessKey = &quot;access-key&quot;
      SecretKey = &quot;secret-key&quot;
      BucketName = &quot;runner&quot;
      Insecure = false
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;3&quot;&gt;&lt;li&gt;æ¥ä¸‹æ¥é€šè¿‡å®æˆ˜å®Œæˆåˆ†å¸ƒå¼ç¼“å­˜é…ç½®ï¼›&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;ç¯å¢ƒå’Œç‰ˆæœ¬ä¿¡æ¯&quot;&gt;ç¯å¢ƒå’Œç‰ˆæœ¬ä¿¡æ¯&lt;/h3&gt;
&lt;p&gt;æœ¬æ¬¡å®æˆ˜æ¶‰åŠåˆ°å¤šä¸ªæœåŠ¡ï¼Œä¸‹é¢ç»™å‡ºå®ƒä»¬çš„ç‰ˆæœ¬ä¿¡æ¯ä¾›æ‚¨å‚è€ƒï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;GitLabï¼šCommunity Edition 13.0.6&lt;/li&gt;
&lt;li&gt;GilLab Runnerï¼š13.1.0&lt;/li&gt;
&lt;li&gt;kubernetesï¼š1.15.3&lt;/li&gt;
&lt;li&gt;Harborï¼š1.1.3&lt;/li&gt;
&lt;li&gt;Minioï¼š2020-06-18T02:23:35Z&lt;/li&gt;
&lt;li&gt;Helmï¼š2.16.1&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;éƒ¨ç½²åˆ†å¸ƒå¼ç¼“å­˜&quot;&gt;éƒ¨ç½²åˆ†å¸ƒå¼ç¼“å­˜&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;minioæ˜¯å…¼ç”¨S3çš„åˆ†å¸ƒå¼ç¼“å­˜ï¼Œä¹Ÿæ˜¯å®˜æ–¹æ¨èä½¿ç”¨çš„ï¼Œå¦‚ä¸‹å›¾ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201229234505894-1202508441.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;/li&gt;
&lt;li&gt;minioä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡éƒ¨ç½²ï¼Œæˆ‘å°†ç”¨dockeréƒ¨ç½²åœ¨æœåŠ¡å™¨ï¼š&lt;span&gt;192.168.50.43&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;åœ¨æœåŠ¡å™¨ä¸Šå‡†å¤‡ä¸¤ä¸ªç›®å½•ï¼Œåˆ†åˆ«å­˜å‚¨minioçš„é…ç½®å’Œæ–‡ä»¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;mkdir -p /var/services/homes/zq2599/minio/gitlab_runner \
&amp;amp;&amp;amp; chmod -R 777 /var/services/homes/zq2599/minio/gitlab_runner \
&amp;amp;&amp;amp; mkdir -p /var/services/homes/zq2599/minio/config \
&amp;amp;&amp;amp; chmod -R 777 /var/services/homes/zq2599/minio/config
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;4&quot;&gt;&lt;li&gt;æ‰§è¡Œdockerå‘½ä»¤åˆ›å»ºminioæœåŠ¡ï¼ŒæŒ‡å®šæœåŠ¡ç«¯å£æ˜¯9000ï¼Œå¹¶ä¸”æŒ‡å®šäº†access key(æœ€çŸ­ä¸‰ä½)å’Œsecret key(æœ€çŸ­å…«ä½)ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;sudo docker run -p 9000:9000 --name minio \
-d --restart=always \
-e &quot;MINIO_ACCESS_KEY=access&quot; \
-e &quot;MINIO_SECRET_KEY=secret123456&quot; \
-v /var/services/homes/zq2599/minio/gitlab_runner:/gitlab_runner \
-v /var/services/homes/zq2599/minio/config:/root/.minio \
minio/minio server /gitlab_runner
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;5&quot;&gt;&lt;li&gt;æµè§ˆå™¨è®¿é—®ï¼Œè¾“å…¥access keyå’Œsecret keyåç™»å½•æˆåŠŸï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201229234506359-1361573367.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;/li&gt;
&lt;li&gt;å¦‚ä¸‹å›¾ï¼Œç‚¹å‡»çº¢æ¡†ä¸­çš„å›¾æ ‡ï¼Œåˆ›å»ºä¸€ä¸ªbucketï¼Œåä¸ºrunnerï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201229234506679-1244729008.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;/li&gt;
&lt;li&gt;è‡³æ­¤ï¼Œminioå·²å¤‡å¥½ï¼Œæ¥ä¸‹æ¥åœ¨GitLab Runnerä¸Šé…ç½®ï¼›&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;gitlab-runnerä¸Šé…ç½®ç¼“å­˜&quot;&gt;GitLab Runnerä¸Šé…ç½®ç¼“å­˜&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;æˆ‘è¿™é‡Œæ˜¯ç”¨helméƒ¨ç½²çš„GitLab Runnerï¼Œå› æ­¤ä¿®æ”¹çš„æ˜¯helmçš„valueé…ç½®ï¼Œå¦‚æœæ‚¨æ²¡æœ‰ç”¨helmï¼Œå¯ä»¥å‚è€ƒæ¥ä¸‹æ¥çš„æ“ä½œç›´æ¥å»é…ç½®&lt;span&gt;config.toml&lt;/span&gt;æ–‡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;helmä¸‹è½½äº†&lt;span&gt;GitLab Runner&lt;/span&gt;çš„åŒ…åï¼Œè§£å¼€å¯è§é…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201229234510559-1339990107.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;3. æ‰“å¼€&lt;span&gt;values.yaml&lt;/span&gt;ï¼Œæ‰¾åˆ°cacheçš„é…ç½®ï¼Œå½“å‰cacheçš„é…ç½®å¦‚ä¸‹å›¾ï¼Œå¯è§å€¼ä¸ºç©ºå†…å®¹çš„å¤§æ‹¬å·ï¼Œå…¶ä½™ä¿¡æ¯å…¨éƒ¨è¢«æ³¨é‡Šäº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201229234511530-2131422184.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;4. ä¿®æ”¹åçš„cacheé…ç½®å¦‚ä¸‹å›¾ï¼Œçº¢æ¡†1ä¸­åŸå…ˆçš„å¤§æ‹¬å·å·²å»æ‰ï¼Œçº¢æ¡†2ä¸­çš„æ˜¯å»æ‰äº†æ³¨é‡Šç¬¦å·ï¼Œå†…å®¹ä¸å˜ï¼Œçº¢æ¡†3ä¸­å¡«å†™çš„æ˜¯minioçš„è®¿é—®åœ°å€ï¼Œçº¢æ¡†4ä¸­çš„æ˜¯å»æ‰äº†æ³¨é‡Šç¬¦å·ï¼Œå†…å®¹ä¸å˜ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201229234512306-430415507.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;5. ä¸Šå›¾çº¢æ¡†4ä¸­çš„&lt;span&gt;s3CacheInsecure&lt;/span&gt;å‚æ•°ç­‰äº&lt;span&gt;false&lt;/span&gt;è¡¨ç¤ºå¯¹minioçš„è¯·æ±‚ä¸ºhttp(å¦‚æœæ˜¯trueå°±æ˜¯https)ï¼Œä½†å®é™…è¯æ˜ï¼Œ&lt;span&gt;å½“å‰ç‰ˆæœ¬çš„chartä¸­è¯¥é…ç½®æ˜¯æ— æ•ˆçš„&lt;/span&gt;ï¼Œç­‰åˆ°è¿è¡Œæ—¶è¿˜æ˜¯ä¼šä»¥httpsåè®®è®¿é—®ï¼Œè§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•æ˜¯ä¿®æ”¹templatesç›®å½•ä¸‹çš„_cache.tplæ–‡ä»¶ï¼Œæ‰“å¼€æ­¤æ–‡ä»¶ï¼Œæ‰¾åˆ°ä¸‹å›¾çº¢æ¡†ä¸­çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201229234513001-345901984.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;6. å°†ä¸Šå›¾çº¢æ¡†ä¸­çš„å†…å®¹æ›¿æ¢æˆä¸‹é¢çº¢æ¡†ä¸­çš„æ ·å­ï¼Œå³åˆ é™¤åŸå…ˆçš„ifåˆ¤æ–­å’Œå¯¹åº”çš„endè¿™ä¸¤è¡Œï¼Œç›´æ¥ç»™CACHE_S3_INSECUREèµ‹å€¼ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201229234513975-1667451224.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;7. ä»¥ä¸Šåªæ˜¯cacheç›¸å…³çš„é…ç½®ï¼Œhelméƒ¨ç½²GitLab Runnerçš„å…¶ä»–è®¾ç½®è¿˜è¯·è‡ªè¡Œå¤„ç†ï¼Œæ‰€æœ‰è®¾ç½®å®Œæˆåå›åˆ°values.yamæ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯åˆ›å»ºGitLab Runnerï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;helm install \
--name-template gitlab-runner \
-f values.yaml . \
--namespace gitlab-runner
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;8&quot;&gt;&lt;li&gt;é…ç½®å®Œæ¯•ï¼Œå¯åŠ¨Riglab RunneræˆåŠŸåï¼Œä¸€èµ·æ¥éªŒè¯ä¸€ä¸‹ï¼›&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;éªŒè¯&quot;&gt;éªŒè¯&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;åœ¨GitLabä»“åº“ä¸­ï¼Œå¢åŠ åä¸º.gitlab-ci.ymlçš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;# è®¾ç½®æ‰§è¡Œé•œåƒ
image: busybox:latest

# æ•´ä¸ªpipelineæœ‰ä¸¤ä¸ªstage
stages:
- build
- test

# å®šä¹‰å…¨å±€ç¼“å­˜ï¼Œç¼“å­˜çš„keyæ¥è‡ªåˆ†æ”¯ä¿¡æ¯ï¼Œç¼“å­˜ä½ç½®æ˜¯vendoræ–‡ä»¶å¤¹
cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
  - vendor/

before_script:
  - echo &quot;Before script section&quot;

after_script:
  - echo &quot;After script section&quot;

build1:
  stage: build
    tags:
  - k8s
  script:
    - echo &quot;å°†å†…å®¹å†™å…¥ç¼“å­˜&quot;
    - echo &quot;build&quot; &amp;gt; vendor/hello.txt

test1:
  stage: test
  script:
    - echo &quot;ä»ç¼“å­˜è¯»å–å†…å®¹&quot;
    - cat vendor/hello.txt
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;2&quot;&gt;&lt;li&gt;æäº¤ä¸Šè¿°è„šæœ¬åˆ°GitLabï¼Œå¦‚ä¸‹å›¾ï¼Œå¯è§pipelineä¼šè¢«è§¦å‘ï¼ŒçŠ¶æ€ä¸ºpendingæ˜¯å› ä¸ºæ­£åœ¨ç­‰å¾…runneråˆ›å»ºexecutor podï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201229234514524-576525885.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ol start=&quot;3&quot;&gt;&lt;li&gt;ç¨åå°±ä¼šæ‰§è¡ŒæˆåŠŸï¼Œç‚¹å¼€çœ‹ç»“æœï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201229234516378-1664829661.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;4. ç‚¹å¼€build1çš„å›¾æ ‡ï¼Œå¯è§æ­¤jobçš„è¾“å‡ºä¿¡æ¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201229234518034-464627937.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;5. ç‚¹å¼€test1çš„å›¾æ ‡ï¼Œå¯è§å¯¹åº”çš„æ§åˆ¶å°è¾“å‡ºï¼Œä¸Šä¸€ä¸ªjobå†™å…¥çš„æ•°æ®è¢«æˆåŠŸè¯»å–ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201229234519978-210448719.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ol start=&quot;6&quot;&gt;&lt;li&gt;è‡³æ­¤ï¼Œå¯è§åˆ†å¸ƒå¼ç¼“å­˜å·²ç»ç”Ÿæ•ˆï¼Œåœ¨å¤šå°æœºå™¨çš„ç¯å¢ƒä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨pipelineè¯­æ³•çš„ç¼“å­˜åŠŸèƒ½äº†ï¼›&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;ä½ ä¸å­¤å•ï¼Œæ¬£å®¸åŸåˆ›ä¸€è·¯ç›¸ä¼´&quot;&gt;ä½ ä¸å­¤å•ï¼Œæ¬£å®¸åŸåˆ›ä¸€è·¯ç›¸ä¼´&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;&lt;a href=&quot;https://xinchen.blog.csdn.net/article/details/105068742&quot; target=&quot;_blank&quot;&gt;Javaç³»åˆ—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://xinchen.blog.csdn.net/article/details/105086498&quot; target=&quot;_blank&quot;&gt;Springç³»åˆ—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://xinchen.blog.csdn.net/article/details/105086732&quot; target=&quot;_blank&quot;&gt;Dockerç³»åˆ—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://xinchen.blog.csdn.net/article/details/105086794&quot; target=&quot;_blank&quot;&gt;kubernetesç³»åˆ—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://xinchen.blog.csdn.net/article/details/105086850&quot; target=&quot;_blank&quot;&gt;æ•°æ®åº“+ä¸­é—´ä»¶ç³»åˆ—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://xinchen.blog.csdn.net/article/details/105086920&quot; target=&quot;_blank&quot;&gt;DevOpsç³»åˆ—&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;æ¬¢è¿å…³æ³¨å…¬ä¼—å·ï¼šç¨‹åºå‘˜æ¬£å®¸&quot;&gt;æ¬¢è¿å…³æ³¨å…¬ä¼—å·ï¼šç¨‹åºå‘˜æ¬£å®¸&lt;/h3&gt;
&lt;blockquote readability=&quot;4.258064516129&quot;&gt;
&lt;p&gt;å¾®ä¿¡æœç´¢ã€Œç¨‹åºå‘˜æ¬£å®¸ã€ï¼Œæˆ‘æ˜¯æ¬£å®¸ï¼ŒæœŸå¾…ä¸æ‚¨ä¸€åŒç•…æ¸¸Javaä¸–ç•Œ...&lt;br/&gt;&lt;a href=&quot;https://github.com/zq2599/blog_demos&quot; target=&quot;_blank&quot;&gt;https://github.com/zq2599/blog_demos&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</description>
<pubDate>Tue, 29 Dec 2020 15:45:00 +0000</pubDate>
<dc:creator>ç¨‹åºå‘˜æ¬£å®¸</dc:creator>
<og:description>æ¬¢è¿è®¿é—®æˆ‘çš„GitHub https://github.com/zq2599/blog_demos å†…å®¹ï¼šæ‰€æœ‰åŸåˆ›æ–‡ç« åˆ†ç±»æ±‡æ€»åŠé…å¥—æºç ï¼Œæ¶‰åŠJavaã€Dockerã€Kubernetesã€DevOPS</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/bolingcavalry/p/14209386.html</dc:identifier>
</item>
</channel>
</rss>