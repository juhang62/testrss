<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>åšå®¢å›­_é¦–é¡µ</title>
<link></link>
<description>ä»£ç æ”¹å˜ä¸–ç•Œ</description>
<item>
<title>MySQLå¦‚ä½•è®¡ç®—ç»Ÿè®¡redo logå¤§å° - æ½‡æ¹˜éšè€…</title>
<link>http://www.cnblogs.com/kerrycode/p/14187235.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/kerrycode/p/14187235.html</guid>
<description>&lt;p class=&quot;MsoNormal&quot; align=&quot;center&quot;&gt;&lt;strong&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;åœ¨MySQLä¸­å¦‚ä½•è®¡ç®—ã€ç»Ÿè®¡é‡åšæ—¥å¿—ï¼ˆredo log)çš„ç”Ÿæˆæƒ…å†µå‘¢ï¼Ÿ ä¾‹å¦‚10åˆ†é’Ÿå†…ï¼Œç”Ÿæˆäº†å¤šå°‘Mçš„redo logå‘¢?30åˆ†é’Ÿå†…åˆç”Ÿæˆäº†å¤šå°‘Mçš„redo log.....ã€‚MySQLæ²¡æœ‰åƒOracleä¸­é‚£æ ·çš„ç³»ç»Ÿè§†å›¾ç»Ÿè®¡è¿™äº›æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›æ–¹æ³•æ›²çº¿çš„ç»Ÿè®¡äºŒè¿›åˆ¶æ—¥å¿—çš„ç”Ÿæˆé‡ã€‚&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;è™½ç„¶æˆ‘åœ¨è¿™ç¯‡åšå®¢&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;â€œ&lt;a href=&quot;https://www.cnblogs.com/kerrycode/p/13814012.html&quot; target=&quot;_blank&quot;&gt;&lt;span&gt;&lt;strong&gt;MySQLä¸­Redo Logç›¸å…³çš„é‡è¦å‚æ•°æ€»ç»“&lt;/strong&gt;&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;â€&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;ä¸­ä»‹ç»äº†ï¼ŒMySQL 8.0å¼•å…¥äº†innodb_dedicated_serverè‡ªé€‚åº”å‚æ•°ï¼Œå¯åŸºäºæœåŠ¡å™¨çš„å†…å­˜æ¥åŠ¨æ€è®¾ç½®innodb_buffer_pool_sizeï¼Œinnodb_log_file_sizeå’Œinnodb_flush_methodã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤å‚æ•°æ˜¯å…³é—­çš„ã€‚ä½†æ˜¯åœ¨MySQL 8.0ä¹‹å‰ï¼Œé€šè¿‡è®¡ç®—é‡åšæ—¥å¿—ï¼ˆredo logï¼‰çš„ç”Ÿæˆé‡æ¥åˆ¤æ–­åˆ¤æ–­innodb_log_buffer_sizeå’Œinnodb_log_file_sizeçš„å¤§å°æ˜¯å¦åˆé€‚æ˜¯éå¸¸å¿…è¦çš„ï¼Œä¸ªäººè®¤ä¸ºå³ä½¿MySQL 8.0ç‰ˆæœ¬ä¸‹ï¼Œè¿™ä¸ªä¹Ÿæ˜¯éå¸¸æœ‰å‚è€ƒå’Œç ”ç©¶æ„ä¹‰çš„ã€‚æˆ‘ä»¬é€šè¿‡ç»Ÿè®¡ã€åˆ†æè®¡ç®—é‡åšæ—¥å¿—ï¼ˆredo logï¼‰çš„ç”Ÿæˆé‡ï¼Œä»è€Œåˆ¤æ–­InnoDBçš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶å¤§æ¦‚èƒ½æ”¯æ’‘å¤šé•¿æ—¶é—´å°±ä¼šåˆ‡æ¢ã€‚æœ‰å…·ä½“æ•°æ®æ”¯æ’‘ï¼Œä½ æ‰å¥½åˆ†æåˆ¤æ–­ï¼Œå¦åˆ™å·§å¦‡ä¹Ÿéš¾ä¸ºæ— ç±³ä¹‹ç‚Šã€‚&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;åœ¨MySQLçš„information_schema.global_statusæˆ–performance_schema.global_statusä¸­æœ‰ä¸ªæœåŠ¡å™¨çŠ¶æ€å˜é‡(Server Status Variablesï¼‰Innodb_os_log_written,å®ƒè®°å½•äº†Innodbçš„é‡åšæ—¥å¿—ï¼ˆredo logï¼‰çš„ç”Ÿæˆé‡ï¼Œå®ƒè®°å½•å†™å…¥InnoDBé‡åšæ—¥å¿—æ–‡ä»¶çš„å­—èŠ‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¯ç§¯å€¼ã€‚å®˜æ–¹æ–‡æ¡£å…³äºæ­¤æœåŠ¡å™¨çŠ¶æ€å˜é‡çš„æè¿°å¦‚ä¸‹&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Innodb_os_log_written&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;The number of bytes written to the&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;InnoDB&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;redo log&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;files.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;æˆ‘ä»¬ä¸»è¦é€šè¿‡ä¸€ä¸ªè®¡åˆ’ä»»åŠ¡/äº‹ä»¶è°ƒåº¦å®šæœŸçš„å»é‡‡é›†Innodb_os_log_writtenæœåŠ¡å™¨çŠ¶æ€å˜é‡è·å–é‡åšæ—¥å¿—çš„å¤§å°ï¼Œå°†å…¶å­˜å‚¨åœ¨innodb_log_size_hisè¡¨ä¸­ï¼Œæ–¹ä¾¿åˆ†æç»Ÿè®¡ã€‚å…·ä½“è„šæœ¬å¦‚ä¸‹ï¼š&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;æ³¨æ„ï¼šperformance_schema.global_statusæ˜¯MySQL 5.7å¼•å…¥çš„ï¼Œè€ŒMySQL 8.0å¼€å§‹ï¼Œinformation_schema.global_statusç›´æ¥è¢«ä¸¢å¼ƒäº†ã€‚æ‰€ä»¥æ³¨æ„MySQLç‰ˆæœ¬ï¼Œé€‰æ‹©åˆé€‚è„šæœ¬ã€‚&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div id=&quot;codeSnippetWrapper&quot; readability=&quot;30&quot;&gt;
&lt;div id=&quot;codeSnippet&quot; readability=&quot;55&quot;&gt;
&lt;pre&gt;
&lt;span&gt;USE&lt;/span&gt; mysqls;
&lt;/pre&gt;
&lt;pre&gt;
 
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;CREATE&lt;/span&gt; &lt;span&gt;TABLE&lt;/span&gt; &lt;span&gt;IF&lt;/span&gt; &lt;span&gt;NOT&lt;/span&gt; &lt;span&gt;EXISTS&lt;/span&gt; innodb_log_size_his
&lt;/pre&gt;
&lt;pre&gt;
(
&lt;/pre&gt;
&lt;pre&gt;
    log_id          &lt;span&gt;INT&lt;/span&gt; AUTO_INCREMENT &lt;span&gt;PRIMARY&lt;/span&gt; &lt;span&gt;KEY&lt;/span&gt; COMMENT &lt;span&gt;'æ—¥å¿—ç¼–å·'&lt;/span&gt;,
&lt;/pre&gt;
&lt;pre&gt;
    log_date        DATETIME COMMENT &lt;span&gt;'è®°å½•å½“å‰æ•°æ®çš„æ—¶é—´'&lt;/span&gt;,
&lt;/pre&gt;
&lt;pre&gt;
    log_size        &lt;span&gt;DOUBLE&lt;/span&gt; COMMENT &lt;span&gt;'redo logçš„å¤§å°,å•ä½ä¸ºmb'&lt;/span&gt;
&lt;/pre&gt;
&lt;pre&gt;
) ENGINE=InnoDB &lt;span&gt;DEFAULT&lt;/span&gt; CHARSET=utf8mb4 &lt;span&gt;COLLATE&lt;/span&gt;=utf8mb4_0900_ai_ci COMMENT &lt;span&gt;'redoæ—¥å¿—å¤§å°ä¿¡æ¯è¡¨'&lt;/span&gt;;
&lt;/pre&gt;
&lt;pre&gt;
 
&lt;/pre&gt;
&lt;pre&gt;
 
&lt;/pre&gt;
&lt;pre&gt;
--MySQL 5.*ç‰ˆæœ¬ç”¨ä¸‹é¢è„šæœ¬
&lt;/pre&gt;
&lt;pre&gt;
DELIMITER &amp;amp;&amp;amp;
&lt;/pre&gt;
&lt;pre&gt;
 
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;DROP&lt;/span&gt; &lt;span&gt;PROCEDURE&lt;/span&gt; &lt;span&gt;IF&lt;/span&gt; &lt;span&gt;EXISTS&lt;/span&gt; `Record_Innodb_Log_Size`&amp;amp;&amp;amp;
&lt;/pre&gt;
&lt;pre&gt;
 
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;CREATE&lt;/span&gt; &lt;span&gt;PROCEDURE&lt;/span&gt; Record_Innodb_Log_Size()
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;BEGIN&lt;/span&gt;
&lt;/pre&gt;
&lt;pre&gt;
      INSERT &lt;span&gt;INTO&lt;/span&gt; mysql.`innodb_log_size_his`
&lt;/pre&gt;
&lt;pre&gt;
      (
&lt;/pre&gt;
&lt;pre&gt;
          log_date,
&lt;/pre&gt;
&lt;pre&gt;
          log_size
&lt;/pre&gt;
&lt;pre&gt;
      )
&lt;/pre&gt;
&lt;pre&gt;
      &lt;span&gt;SELECT&lt;/span&gt; now() &lt;span&gt;AS&lt;/span&gt; log_date,
&lt;/pre&gt;
&lt;pre&gt;
             ROUND(&lt;span&gt;CAST&lt;/span&gt;(VARIABLE_VALUE &lt;span&gt;AS&lt;/span&gt; &lt;span&gt;DOUBLE&lt;/span&gt; )/1024/1024, 1) &lt;span&gt;as&lt;/span&gt; log_size
&lt;/pre&gt;
&lt;pre&gt;
      &lt;span&gt;FROM&lt;/span&gt; information_schema.global_status
&lt;/pre&gt;
&lt;pre&gt;
      &lt;span&gt;WHERE&lt;/span&gt; VARIABLE_NAME = &lt;span&gt;'innodb_os_log_written'&lt;/span&gt;;
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;END&lt;/span&gt; &amp;amp;&amp;amp;
&lt;/pre&gt;
&lt;pre&gt;
 
&lt;/pre&gt;
&lt;pre&gt;
DELIMITER ;
&lt;/pre&gt;
&lt;pre&gt;
 
&lt;/pre&gt;
&lt;pre&gt;
 
&lt;/pre&gt;
&lt;pre&gt;
--MySQL 8.0ä»¥ä¸Šç‰ˆæœ¬ä½¿ç”¨ä¸‹é¢è„šæœ¬
&lt;/pre&gt;
&lt;pre&gt;
DELIMITER &amp;amp;&amp;amp;
&lt;/pre&gt;
&lt;pre&gt;
 
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;DROP&lt;/span&gt; &lt;span&gt;PROCEDURE&lt;/span&gt; &lt;span&gt;IF&lt;/span&gt; &lt;span&gt;EXISTS&lt;/span&gt; `Record_Innodb_Log_Size`&amp;amp;&amp;amp;
&lt;/pre&gt;
&lt;pre&gt;
 
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;CREATE&lt;/span&gt; &lt;span&gt;PROCEDURE&lt;/span&gt; Record_Innodb_Log_Size()
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;BEGIN&lt;/span&gt;
&lt;/pre&gt;
&lt;pre&gt;
      INSERT &lt;span&gt;INTO&lt;/span&gt; mysql.`innodb_log_size_his`
&lt;/pre&gt;
&lt;pre&gt;
      (
&lt;/pre&gt;
&lt;pre&gt;
          log_date,
&lt;/pre&gt;
&lt;pre&gt;
          log_size
&lt;/pre&gt;
&lt;pre&gt;
      )
&lt;/pre&gt;
&lt;pre&gt;
      &lt;span&gt;SELECT&lt;/span&gt; now() &lt;span&gt;AS&lt;/span&gt; log_date,
&lt;/pre&gt;
&lt;pre&gt;
             ROUND(&lt;span&gt;CAST&lt;/span&gt;(VARIABLE_VALUE &lt;span&gt;AS&lt;/span&gt; &lt;span&gt;DOUBLE&lt;/span&gt; )/1024/1024, 1) &lt;span&gt;as&lt;/span&gt; log_size
&lt;/pre&gt;
&lt;pre&gt;
      &lt;span&gt;FROM&lt;/span&gt; performance_schema.global_status
&lt;/pre&gt;
&lt;pre&gt;
      &lt;span&gt;WHERE&lt;/span&gt; VARIABLE_NAME = &lt;span&gt;'innodb_os_log_written'&lt;/span&gt;;
&lt;/pre&gt;
&lt;pre&gt;
    
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;END&lt;/span&gt; &amp;amp;&amp;amp;
&lt;/pre&gt;
&lt;pre&gt;
 
&lt;/pre&gt;
&lt;pre&gt;
DELIMITER ;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;ç„¶ååˆ›å»ºMySQLçš„è®¡åˆ’ä»»åŠ¡/äº‹ä»¶è°ƒåº¦ï¼Œè¿™ä¸ªå¯ä»¥æ ¹æ®éœ€æ±‚å¼¹æ€§è®¾å®šã€‚&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div id=&quot;codeSnippetWrapper&quot; readability=&quot;8&quot;&gt;
&lt;div id=&quot;codeSnippet&quot; readability=&quot;11&quot;&gt;
&lt;pre&gt;
&lt;span&gt;CREATE&lt;/span&gt; EVENT DPA_BINGLOG_SIZE 
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;ON&lt;/span&gt; SCHEDULE &lt;span&gt;EVERY&lt;/span&gt; 10 &lt;span&gt;MINUTE&lt;/span&gt; STARTS &lt;span&gt;'2020-10-16 08:00:00'&lt;/span&gt; 
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;ON&lt;/span&gt; &lt;span&gt;COMPLETION&lt;/span&gt; &lt;span&gt;PRESERVE&lt;/span&gt; 
&lt;/pre&gt;
&lt;pre&gt;
DO &lt;span&gt;CALL&lt;/span&gt; mysql.Record_Innodb_Log_Size;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;ç„¶åä½ å°±å¯ä»¥åŸºäºè¿™ä¸ªè¡¨åšä¸€äº›ç®€å•çš„åˆ†æå’Œç»Ÿè®¡äº†ï¼Œä¾‹å¦‚ï¼Œç»Ÿè®¡10åˆ†é’Ÿå†…ç”Ÿæˆé‡åšæ—¥å¿—ç”Ÿæˆäº†å¤šå°‘ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div id=&quot;codeSnippetWrapper&quot; readability=&quot;10&quot;&gt;
&lt;div id=&quot;codeSnippet&quot; readability=&quot;15&quot;&gt;
&lt;pre&gt;
&lt;span&gt;SELECT&lt;/span&gt; m.*
&lt;/pre&gt;
&lt;pre&gt;
      ,@lag  &lt;span&gt;AS&lt;/span&gt; last_redo_size
&lt;/pre&gt;
&lt;pre&gt;
      ,ROUND(m.log_size - @lag,2) &lt;span&gt;AS&lt;/span&gt; gen_redo_size
&lt;/pre&gt;
&lt;pre&gt;
      ,@lag:=log_size
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;FROM&lt;/span&gt; mysql.`innodb_log_size_his` m, (&lt;span&gt;SELECT&lt;/span&gt; @lag :=&lt;span&gt;''&lt;/span&gt;) &lt;span&gt;AS&lt;/span&gt; n
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;WHERE&lt;/span&gt; m.log_date &amp;gt;= date_add(now(), &lt;span&gt;interval&lt;/span&gt; -1 &lt;span&gt;day&lt;/span&gt;)
&lt;/pre&gt;
&lt;pre&gt;
&lt;span&gt;ORDER&lt;/span&gt; &lt;span&gt;BY&lt;/span&gt; m.log_id;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;a href=&quot;https://img2020.cnblogs.com/blog/73542/202012/73542-20201225083544048-872912856.png&quot;&gt;&lt;img title=&quot;clip_image001&quot; border=&quot;0&quot; alt=&quot;clip_image001&quot; src=&quot;https://img2020.cnblogs.com/blog/73542/202012/73542-20201225083544600-1193319352.png&quot; width=&quot;696&quot; height=&quot;422&quot;/&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span lang=&quot;X-NONE&quot;&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p class=&quot;MsoNormal&quot; align=&quot;left&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;Â &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;

</description>
<pubDate>Fri, 25 Dec 2020 00:36:00 +0000</pubDate>
<dc:creator>æ½‡æ¹˜éšè€…</dc:creator>
<og:description>åœ¨MySQLä¸­å¦‚ä½•è®¡ç®—ã€ç»Ÿè®¡é‡åšæ—¥å¿—ï¼ˆredo log)çš„ç”Ÿæˆæƒ…å†µå‘¢ï¼Ÿ ä¾‹å¦‚10åˆ†é’Ÿå†…ï¼Œç”Ÿæˆäº†å¤šå°‘Mçš„redo logå‘¢?30åˆ†é’Ÿå†…åˆç”Ÿæˆäº†å¤šå°‘Mçš„redo log.....ã€‚MySQLæ²¡æœ‰åƒOrac</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/kerrycode/p/14187235.html</dc:identifier>
</item>
<item>
<title>C#ä¸­çš„æ·±åº¦å­¦ä¹ ï¼ˆäº”ï¼‰ï¼šåœ¨ML.NETä¸­ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œç¡¬å¸è¯†åˆ« - ç å†œè¯‘ç«™</title>
<link>http://www.cnblogs.com/hhhnicvscs/p/14187225.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/hhhnicvscs/p/14187225.html</guid>
<description>&lt;p&gt;åœ¨æœ¬ç³»åˆ—çš„æœ€åï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦ä¸€ç§æ–¹æ³•ï¼Œå³åˆ©ç”¨ä¸€ä¸ªé¢„å…ˆè®­ç»ƒå¥½çš„CNNæ¥è§£å†³æˆ‘ä»¬ä¸€ç›´åœ¨ç ”ç©¶çš„ç¡¬å¸è¯†åˆ«é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è½¬ç§»å­¦ä¹ ï¼Œè°ƒæ•´é¢„å®šä¹‰çš„CNNï¼Œå¹¶ä½¿ç”¨Model Builderè®­ç»ƒæˆ‘ä»¬çš„ç¡¬å¸è¯†åˆ«æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨ML.NETä»£æ›¿Keras.NETã€‚ä¸ºä»€ä¹ˆä¸ä½¿ç”¨Keras.NETå‘¢?å°½ç®¡Keras.NETéå¸¸ç®€å•ï¼Œæ˜“äºå­¦ä¹ ï¼Œè™½ç„¶å®ƒåŒ…å«å‰é¢æåˆ°çš„é¢„å®šä¹‰æ¨¡å‹ï¼Œä½†å®ƒçš„ç®€å•æ€§ä½¿æˆ‘ä»¬æ— æ³•è‡ªå®šä¹‰CNNæ¶æ„æ¥é€‚åº”æˆ‘ä»¬çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ML.NETæ˜¯ä¸€ä¸ªå¾®è½¯çš„å…è´¹æœºå™¨å­¦ä¹ æ¡†æ¶ï¼Œæ—¨åœ¨ä½¿ç”¨C#å’ŒF#è¿›è¡Œå¼€å‘ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†ML.NETä¸Azureç»“åˆä½¿ç”¨ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸºäºäº‘çš„åŸºç¡€è®¾æ–½æ¥è®­ç»ƒæˆ‘ä»¬çš„æ¨¡å‹ã€‚è®©å¤šä¸ªè™šæ‹Ÿæœºä»¥åˆ†å¸ƒå¼æ–¹å¼è¿è¡Œæˆ‘ä»¬çš„ä»£ç å¯ä»¥ä½¿è®­ç»ƒæ›´å¿«ã€æ›´å‡†ç¡®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆé¢„è®­ç»ƒçš„CNNå¦‚æ­¤æœ‰ä»·å€¼?å› ä¸ºæœ‰äººèŠ±äº†å¾ˆå¤šæ—¶é—´å’Œèµ„æºåŸ¹è®­ä»–ä»¬ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬å¯ä»¥é‡ç”¨åµŒå…¥åœ¨ä¸ºç½‘ç»œè®¡ç®—çš„æƒå€¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬é‡æ–°åº”ç”¨åˆ°ç±»ä¼¼çš„é—®é¢˜ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬ä¸ä»…å¯ä»¥åº”ç”¨äºCNNæœ€åˆè®­ç»ƒè§£å†³çš„é—®é¢˜ã€‚è¿™ç§æ–¹æ³•å°±è¢«ç§°ä¸ºè¿ç§»å­¦ä¹ ã€‚å®ƒå¯ä»¥ä¸ºæˆ‘ä»¬èŠ‚çœå¤§é‡çš„åŸ¹è®­æ—¶é—´ï¼Œå¹¶å¤§å¤§æé«˜æ‰€è·å¾—çš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿ç§»å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬ä¸åƒä»¥å‰é‚£æ ·ä»é›¶å¼€å§‹ã€‚ç›¸åï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªå·²çŸ¥çš„æ¨¡å‹å¼€å§‹ï¼Œè¯¥æ¨¡å‹å…·æœ‰é¢„å®šä¹‰çš„ä½“ç³»ç»“æ„å’Œåœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ¨¡å‹æ—¶ä¸‹è½½çš„è®¡ç®—æƒé‡ã€‚æµè¡Œçš„æ¨¡å‹åŒ…æ‹¬Inceptionã€ResNetå’ŒVGG16ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;è¦é’ˆå¯¹æˆ‘ä»¬çš„é—®é¢˜è°ƒæ•´é¢„å®šä¹‰çš„CNNï¼Œæˆ‘ä»¬å¿…é¡»åšä¸‰ä»¶äº‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»å°†è¾“å…¥å±‚çš„å½¢çŠ¶æ›´æ”¹ä¸ºæ•°æ®é›†ä¸­å›¾åƒçš„ç»´åº¦ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬è‡³å°‘éœ€è¦æ›´æ”¹è¾“å‡ºå±‚ï¼Œä»¥ä¾¿æ¨¡å‹æ‹¥æœ‰ä¸æ•°æ®é›†ç›¸åŒæ•°é‡çš„ç±»ã€‚ç¬¬ä¸‰ï¼Œæˆ‘ä»¬å¿…é¡»è°ƒæ•´æ¨¡å‹ï¼Œè®©å®ƒçŸ¥é“æˆ‘ä»¬å¯¹è®­ç»ƒé¢„å®šä¹‰æ¨¡å‹çš„å±‚ä¸æ„Ÿå…´è¶£ã€‚&lt;/p&gt;
&lt;p&gt;å®Œæˆè¿™äº›æ­¥éª¤åï¼Œæˆ‘ä»¬å¯ä»¥è®­ç»ƒæˆ–ä½¿æˆ‘ä»¬çš„æ¨¡å‹é€‚åˆäºç»™å®šçš„æ•°æ®é›†ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬å¼€å§‹å§ã€‚åœ¨Visual Studioä¸­ï¼Œè½¬åˆ°&lt;strong&gt;Extensions&lt;/strong&gt;Â &amp;gt;Â &lt;strong&gt;Manage Extensions&lt;/strong&gt;ï¼Œæµè§ˆ&lt;strong&gt;ML.NET Model Builder&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/2248030/202012/2248030-20201225082757285-1134362653.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜éœ€è¦å®‰è£…NugetåŒ…ML.NETã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/2248030/202012/2248030-20201225082810011-1343448714.png&quot; alt=&quot;&quot; width=&quot;452&quot; height=&quot;58&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®­ç»ƒæˆ‘ä»¬çš„æ¨¡å‹æ¥è§£å†³ç¡¬å¸è¯†åˆ«é—®é¢˜ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Â Model BuilderÂ æ‰©å±•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/2248030/202012/2248030-20201225082840532-2082255805.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨è¿™ä¸ªå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°è®¾ç½®æ•°æ®é›†å¹¶è®­ç»ƒæ¨¡å‹ï¼Œå®ƒé€šè¿‡Â Model Builderä¸­æ·»åŠ çš„Auto MLç‰¹æ€§è‡ªåŠ¨é€‰æ‹©æ¨¡å‹ã€‚è‡ªåŠ¨æœºå™¨å­¦ä¹ (automatic Machine Learning, Auto ML)æ˜¯ä¸€ç§è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ æ¨¡å‹å¼€å‘ä¸­çš„è€—æ—¶ä»»åŠ¡ã€‚æ‰€ä»¥Model Builderå°†ä¸ºæˆ‘ä»¬ç®€åŒ–å‡†å¤‡æ•°æ®é›†çš„è¿‡ç¨‹ï¼Œä»¥åŠé€‰æ‹©é¢„å…ˆè®­ç»ƒå¥½çš„æ¨¡å‹å’Œæ‰€æœ‰æ¶‰åŠçš„å‚æ•°ã€‚å…³äºæ‰€é€‰çš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œæœ‰ä¸€ç‚¹æ˜¯åªæœ‰æœ€åä¸€å±‚ä¼šè¢«é‡æ–°è®­ç»ƒ;å…¶ä»–æ‰€æœ‰äººéƒ½ä¿æŒæƒé‡ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæ•°æ®é›†çš„æƒ…å†µï¼Œå”¯ä¸€çš„è¦æ±‚æ˜¯å°†å…¶ç»„ç»‡åœ¨æ–‡ä»¶å¤¹ä¸­ï¼Œè¿™æ ·æ–‡ä»¶å¤¹åå°±æ˜¯å…¶ä¸­æ‰€æœ‰å›¾åƒçš„ç±»æˆ–æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢ä½¿ç”¨çš„ç¡¬å¸æ•°æ®é›†è¢«è¾“å…¥åˆ°æ¨¡å‹æ„å»ºå™¨ä¸­æ—¶ï¼ŒAutoMLå¼•æ“é€‰æ‹©ResNetä½œä¸ºé¢„å…ˆè®­ç»ƒå¥½çš„æ¶æ„æ¥ç”¨äºæˆ‘ä»¬çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/2248030/202012/2248030-20201225082915205-1411817318.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦è®­ç»ƒç»“æŸï¼Œæˆ‘ä»¬å°±å¯ä»¥é¢„æµ‹æ–°çš„è¾“å…¥æ•°æ®ï¼Œç”šè‡³å¯ä»¥å¾—åˆ°ä¸ä¸ºé¢„æµ‹è€Œç”Ÿæˆçš„æ¨¡å‹ç›¸å¯¹åº”çš„ä»£ç ã€‚åªéœ€è¿™ä¹ˆå°‘çš„å·¥ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å‡ ä¹æ²¡æœ‰ä»»ä½•ç›¸å…³çŸ¥è¯†çš„æƒ…å†µä¸‹ä½¿ç”¨MLï¼Œé€šè¿‡UIç®€å•åœ°å®Œæˆæ‰€æœ‰å·¥ä½œï¼Œé€‰æ‹©ã€å•å‡»å¹¶åœ¨æœ€åè·å¾—ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºä½¿ç”¨C#è¿›è¡Œç¡¬å¸è¯†åˆ«çš„ç³»åˆ—æ–‡ç« åˆ°æ­¤ç»“æŸã€‚å¸Œæœ›ä½ å–œæ¬¢ï¼å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œä¸è¦å¿˜è®°ç•™è¨€æˆ–å‘ä¿¡æ¯ã€‚æ„Ÿè°¢ä½ çš„é˜…è¯»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼Œå¦‚æœä½ æœ‰å–œæ¬¢çš„å¤–æ–‡æŠ€æœ¯æ–‡ç« ï¼Œå¯ä»¥é€šè¿‡å…¬ä¼—å·ç•™è¨€æ¨èç»™æˆ‘ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/2248030/202012/2248030-20201225082936825-1260437882.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åŸæ–‡é“¾æ¥ï¼šhttps://www.codeproject.com/Articles/5284231/Deep-Learning-in-Csharp-Coin-Recognition-with-a-Pr&lt;/p&gt;

</description>
<pubDate>Fri, 25 Dec 2020 00:30:00 +0000</pubDate>
<dc:creator>ç å†œè¯‘ç«™</dc:creator>
<og:description>åœ¨æœ¬ç³»åˆ—çš„æœ€åï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦ä¸€ç§æ–¹æ³•ï¼Œå³åˆ©ç”¨ä¸€ä¸ªé¢„å…ˆè®­ç»ƒå¥½çš„CNNæ¥è§£å†³æˆ‘ä»¬ä¸€ç›´åœ¨ç ”ç©¶çš„ç¡¬å¸è¯†åˆ«é—®é¢˜ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹è½¬ç§»å­¦ä¹ ï¼Œè°ƒæ•´é¢„å®šä¹‰çš„CNNï¼Œå¹¶ä½¿ç”¨Model Builderè®­ç»ƒæˆ‘ä»¬çš„ç¡¬å¸è¯†</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/hhhnicvscs/p/14187225.html</dc:identifier>
</item>
<item>
<title>springbootçš„jarä¸ºä½•èƒ½ç‹¬ç«‹è¿è¡Œ - ç¨‹åºå‘˜æ¬£å®¸</title>
<link>http://www.cnblogs.com/bolingcavalry/p/14187202.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/bolingcavalry/p/14187202.html</guid>
<description>&lt;h3 id=&quot;æ¬¢è¿è®¿é—®æˆ‘çš„github&quot;&gt;æ¬¢è¿è®¿é—®æˆ‘çš„GitHub&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/zq2599/blog_demos&quot; target=&quot;_blank&quot;&gt;https://github.com/zq2599/blog_demos&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å†…å®¹ï¼šæ‰€æœ‰åŸåˆ›æ–‡ç« åˆ†ç±»æ±‡æ€»åŠé…å¥—æºç ï¼Œæ¶‰åŠJavaã€Dockerã€Kubernetesã€DevOPSç­‰ï¼›&lt;/p&gt;
&lt;h3 id=&quot;æ¬¢è¿è®¿é—®æˆ‘çš„github-1&quot;&gt;æ¬¢è¿è®¿é—®æˆ‘çš„GitHub&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/zq2599/blog_demos&quot; target=&quot;_blank&quot;&gt;https://github.com/zq2599/blog_demos&lt;/a&gt;&lt;br/&gt;å†…å®¹ï¼šæ‰€æœ‰åŸåˆ›æ–‡ç« åˆ†ç±»æ±‡æ€»åŠé…å¥—æºç ï¼Œæ¶‰åŠJavaã€Dockerã€Kubernetesã€DevOPSç­‰ï¼›&lt;/p&gt;
&lt;h3 id=&quot;èƒ½ç‹¬ç«‹è¿è¡Œçš„jaræ–‡ä»¶&quot;&gt;èƒ½ç‹¬ç«‹è¿è¡Œçš„jaræ–‡ä»¶&lt;/h3&gt;
&lt;p&gt;åœ¨å¼€å‘springbootåº”ç”¨æ—¶ï¼Œé€šè¿‡&lt;span&gt;java -jar&lt;/span&gt;å‘½ä»¤å¯åŠ¨åº”ç”¨æ˜¯å¸¸ç”¨çš„æ–¹å¼ï¼Œä»Šå¤©å°±æ¥ä¸€èµ·äº†è§£è¿™ä¸ªç®€å•æ“ä½œèƒŒåçš„æŠ€æœ¯ï¼›&lt;/p&gt;
&lt;h3 id=&quot;å¼€å‘demo&quot;&gt;å¼€å‘demo&lt;/h3&gt;
&lt;p&gt;å¼€å‘ä¸€ä¸ªspringbootåº”ç”¨ä½œä¸ºæœ¬æ¬¡ç ”ç©¶çš„å¯¹è±¡ï¼Œå¯¹åº”çš„ç‰ˆæœ¬ä¿¡æ¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;JDKï¼š1.8.0_211&lt;/li&gt;
&lt;li&gt;springbootï¼š2.3.1.RELEASE&lt;/li&gt;
&lt;li&gt;mavenï¼š3.6.0&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;æ¥ä¸‹æ¥å¼€å‘springbootåº”ç”¨ï¼Œè¿™ä¸ªåº”ç”¨éå¸¸ç®€å•ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;springbootåº”ç”¨åä¸º&lt;span&gt;springbootstarterdemo&lt;/span&gt;ï¼Œpom.xmlæ–‡ä»¶å†…å®¹ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
&amp;lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&amp;gt;
    &amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;
    &amp;lt;parent&amp;gt;
        &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;spring-boot-starter-parent&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;2.3.1.RELEASE&amp;lt;/version&amp;gt;
        &amp;lt;relativePath/&amp;gt; &amp;lt;!-- lookup parent from repository --&amp;gt;
    &amp;lt;/parent&amp;gt;
    &amp;lt;groupId&amp;gt;com.bolingcavalry&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;springbootstarterdemo&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;0.0.1-SNAPSHOT&amp;lt;/version&amp;gt;
    &amp;lt;name&amp;gt;springbootstarterdemo&amp;lt;/name&amp;gt;
    &amp;lt;description&amp;gt;Demo project for Spring Boot&amp;lt;/description&amp;gt;
    &amp;lt;properties&amp;gt;
        &amp;lt;java.version&amp;gt;1.8&amp;lt;/java.version&amp;gt;
    &amp;lt;/properties&amp;gt;
    &amp;lt;dependencies&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;
        &amp;lt;/dependency&amp;gt;
    &amp;lt;/dependencies&amp;gt;
    &amp;lt;build&amp;gt;
        &amp;lt;plugins&amp;gt;
            &amp;lt;plugin&amp;gt;
                &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
                &amp;lt;artifactId&amp;gt;spring-boot-maven-plugin&amp;lt;/artifactId&amp;gt;
            &amp;lt;/plugin&amp;gt;
        &amp;lt;/plugins&amp;gt;
    &amp;lt;/build&amp;gt;
&amp;lt;/project&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;2&quot;&gt;&lt;li&gt;åªæœ‰ä¸€ä¸ªjavaç±»ï¼Œé‡Œé¢æœ‰ä¸ªhttpæ¥å£ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;package com.bolingcavalry.springbootstarterdemo;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.Date;

@SpringBootApplication
@RestController
public class SpringbootstarterdemoApplication {

    public static void main(String[] args) {
        SpringApplication.run(SpringbootstarterdemoApplication.class, args);
    }
    @RequestMapping(value = &quot;/hello&quot;)
    public String hello(){
        return &quot;hello &quot; + new Date();
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;3&quot;&gt;&lt;li&gt;ç¼–ç å®Œæˆï¼Œåœ¨pom.xmlæ‰€åœ¨ç›®å½•æ‰§è¡Œå‘½ä»¤&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-shell&quot;&gt;mvn clean package -U -DskipTests
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;4&quot;&gt;&lt;li&gt;æ„å»ºæˆåŠŸåï¼Œåœ¨targetç›®å½•ä¸‹å¾—åˆ°æ–‡ä»¶&lt;span&gt;springbootstarterdemo-0.0.1-SNAPSHOT.jar&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;å°±æ˜¯è¿™ä¸ª&lt;span&gt;springbootstarterdemo-0.0.1-SNAPSHOT.jar&lt;/span&gt;ï¼Œæ­¤æ—¶æ‰§è¡Œ&lt;span&gt;java -jar springbootstarterdemo-0.0.1-SNAPSHOT.jar&lt;/span&gt;å°±èƒ½å¯åŠ¨åº”ç”¨ï¼Œå¦‚ä¸‹å›¾ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201225080520492-624470586.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;æ¥ä¸‹æ¥å°±ç”¨è¿™ä¸ª&lt;span&gt;springbootstarterdemo-0.0.1-SNAPSHOT.jar&lt;/span&gt;æ¥åˆ†æjaræ–‡ä»¶èƒ½å¤Ÿç‹¬ç«‹å¯åŠ¨çš„åŸå› ï¼›&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;java--jaråšäº†ä»€ä¹ˆ&quot;&gt;java -jaråšäº†ä»€ä¹ˆ&lt;/h3&gt;
&lt;ul readability=&quot;0.96581196581197&quot;&gt;&lt;li readability=&quot;2.8842443729904&quot;&gt;
&lt;p&gt;å…ˆè¦å¼„æ¸…æ¥š&lt;span&gt;java -jar&lt;/span&gt;å‘½ä»¤åšäº†ä»€ä¹ˆï¼Œåœ¨&lt;a href=&quot;https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html&quot; target=&quot;_blank&quot;&gt;oracleå®˜ç½‘&lt;/a&gt;æ‰¾åˆ°äº†è¯¥å‘½ä»¤çš„æè¿°ï¼š&lt;br/&gt;&lt;span&gt;&lt;br/&gt;If the -jar option is specified, its argument is the name of the JAR file containing class and resource files for the application. The startup class must be indicated by the Main-Class manifest header in its source code.&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;å†æ¬¡ç§€å‡ºæˆ‘è¹©è„šçš„è‹±æ–‡ç¿»è¯‘ï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;ol&gt;&lt;li&gt;ä½¿ç”¨&lt;span&gt;-jar&lt;/span&gt;å‚æ•°æ—¶ï¼Œåé¢çš„å‚æ•°æ˜¯çš„jaræ–‡ä»¶å(æœ¬ä¾‹ä¸­æ˜¯springbootstarterdemo-0.0.1-SNAPSHOT.jar)ï¼›&lt;/li&gt;
&lt;li&gt;è¯¥jaræ–‡ä»¶ä¸­åŒ…å«çš„æ˜¯classå’Œèµ„æºæ–‡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨manifestæ–‡ä»¶ä¸­æœ‰&lt;span&gt;Main-Class&lt;/span&gt;çš„å®šä¹‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;span&gt;Main-Class&lt;/span&gt;çš„æºç ä¸­æŒ‡å®šäº†æ•´ä¸ªåº”ç”¨çš„å¯åŠ¨ç±»ï¼›(in its source code)&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;å°ç»“ä¸€ä¸‹ï¼š&lt;br/&gt;&lt;span&gt;java -jar&lt;/span&gt;ä¼šå»æ‰¾jarä¸­çš„manifestæ–‡ä»¶ï¼Œåœ¨é‚£é‡Œé¢æ‰¾åˆ°çœŸæ­£çš„å¯åŠ¨ç±»ï¼›&lt;/p&gt;
&lt;h3 id=&quot;æ¢æŸ¥springbootstarterdemo-001-snapshotjar&quot;&gt;æ¢æŸ¥springbootstarterdemo-0.0.1-SNAPSHOT.jar&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;&lt;span&gt;springbootstarterdemo-0.0.1-SNAPSHOT.jar&lt;/span&gt;æ˜¯å‰é¢çš„springbootå·¥ç¨‹çš„æ„å»ºç»“æœï¼Œæ˜¯ä¸ªå‹ç¼©åŒ…ï¼Œç”¨å¸¸è§çš„å‹ç¼©å·¥å…·å°±èƒ½è§£å‹ï¼Œæˆ‘è¿™é‡Œçš„ç¯å¢ƒæ˜¯MacBook Proï¼Œç”¨unzipå³å¯è§£å‹ï¼›&lt;/li&gt;
&lt;li&gt;è§£å‹åæœ‰å¾ˆå¤šå†…å®¹ï¼Œæˆ‘ä»¬å…ˆå…³æ³¨manifestç›¸å…³çš„ï¼Œä¸‹å›¾çº¢æ¡†ä¸­å°±æ˜¯manifestæ–‡ä»¶ï¼š&lt;br/&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201225080520861-705981578.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;/li&gt;
&lt;li&gt;æ‰“å¼€ä¸Šå›¾çº¢æ¡†ä¸­çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-properties&quot;&gt;Spring-Boot-Classpath-Index: BOOT-INF/classpath.idx
Implementation-Title: springbootstarterdemo
Implementation-Version: 0.0.1-SNAPSHOT
Start-Class: com.bolingcavalry.springbootstarterdemo.Springbootstarter
 demoApplication
Spring-Boot-Classes: BOOT-INF/classes/
Spring-Boot-Lib: BOOT-INF/lib/
Build-Jdk-Spec: 1.8
Spring-Boot-Version: 2.3.1.RELEASE
Created-By: Maven Jar Plugin 3.2.0
Implementation-Vendor: Pivotal Software, Inc.
Main-Class: org.springframework.boot.loader.JarLauncher
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;4&quot;&gt;&lt;li&gt;åœ¨ä¸Šè¿°å†…å®¹å¯è§Main-Classçš„å€¼&lt;span&gt;org.springframework.boot.loader.JarLauncher&lt;/span&gt;ï¼Œè¿™ä¸ªå’Œå‰é¢çš„javaå®˜æ–¹æ–‡æ¡£å¯¹åº”ä¸Šäº†ï¼Œæ­£æ˜¯è¿™ä¸ªJarLauncherç±»çš„ä»£ç ä¸­æŒ‡å®šäº†çœŸæ­£çš„å¯åŠ¨ç±»ï¼›&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;ç–‘æƒ‘å‡ºç°&quot;&gt;ç–‘æƒ‘å‡ºç°&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;åœ¨MANIFEST.MFæ–‡ä»¶ä¸­æœ‰è¿™ä¹ˆä¸€è¡Œå†…å®¹ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-properties&quot;&gt;Start-Class: com.bolingcavalry.springbootstarterdemo.Springbootstarter
 demoApplication
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;2&quot;&gt;&lt;li&gt;å‰é¢çš„javaå®˜æ–¹æ–‡æ¡£ä¸­ï¼Œåªæåˆ°è¿‡&lt;span&gt;Main-Class&lt;/span&gt; ï¼Œå¹¶æ²¡æœ‰æåˆ°&lt;span&gt;Start-Class&lt;/span&gt;ï¼›&lt;/li&gt;
&lt;li&gt;Start-Classçš„å€¼æ˜¯SpringbootstarterdemoApplicationï¼Œè¿™æ˜¯æˆ‘ä»¬çš„javaä»£ç ä¸­çš„å”¯ä¸€ç±»ï¼Œä¹ŸåªçœŸæ­£çš„åº”ç”¨å¯åŠ¨ç±»ï¼›&lt;/li&gt;
&lt;li&gt;æ‰€ä»¥é—®é¢˜å°±æ¥äº†ï¼šç†è®ºä¸Šçœ‹ï¼Œæ‰§è¡Œjava -jarå‘½ä»¤æ—¶JarLauncherç±»ä¼šè¢«æ‰§è¡Œï¼Œä½†å®é™…ä¸Šæ˜¯SpringbootstarterdemoApplicationè¢«æ‰§è¡Œäº†ï¼Œè¿™å…¶ä¸­å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;çŒœæµ‹&quot;&gt;çŒœæµ‹&lt;/h3&gt;
&lt;p&gt;åŠ¨æ‰‹ä¹‹å‰å…ˆçŒœä¸€ä¸‹ï¼Œä¸ªäººè§‰å¾—åŸå› åº”è¯¥å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;java -jarå‘½ä»¤ä¼šå¯åŠ¨JarLauncherï¼›&lt;/li&gt;
&lt;li&gt;&lt;span&gt;Start-Class&lt;/span&gt;æ˜¯ç»™JarLauncherç”¨çš„ï¼›&lt;/li&gt;
&lt;li&gt;JarLauncheræ ¹æ®&lt;span&gt;Start-Class&lt;/span&gt;æ‰¾åˆ°äº†SpringbootstarterdemoApplicationï¼Œç„¶åæ‰§è¡Œå®ƒï¼›&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;åˆ†æjarlauncher&quot;&gt;åˆ†æJarLauncher&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;å…ˆä¸‹è½½SpringBootæºç ï¼Œæˆ‘ä¸‹è½½çš„æ˜¯2.3.1ç‰ˆæœ¬ï¼Œåœ°å€ï¼š&lt;a href=&quot;https://github.com/spring-projects/spring-boot/releases/tag/v2.3.1.RELEASE&quot; target=&quot;_blank&quot;&gt;https://github.com/spring-projects/spring-boot/releases/tag/v2.3.1.RELEASE&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;JarLauncheræ‰€åœ¨çš„å·¥ç¨‹æ˜¯spring-boot-loaderï¼Œå…ˆå¼„æ˜ç™½JarLauncherçš„ç»§æ‰¿å…³ç³»ï¼Œå¦‚ä¸‹å›¾ï¼Œå¯è§JarLauncherç»§æ‰¿è‡ªExecutableArchiveLauncherï¼Œè€ŒExecutableArchiveLauncherçš„çˆ¶ç±»Launcherä½äºæœ€é¡¶å±‚ï¼Œæ˜¯ä¸ªæŠ½è±¡ç±»ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201225080521038-971967716.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;3. java -jaræ‰§è¡Œçš„æ˜¯JarLauncherçš„mainæ–¹æ³•ï¼Œå¦‚ä¸‹ï¼Œä¼šå®ä¾‹åŒ–ä¸€ä¸ªJarLauncherå¯¹è±¡ï¼Œç„¶åæ‰§è¡Œå…¶launchæ–¹æ³•ï¼Œå¹¶ä¸”å°†æ‰€æœ‰å…¥å‚éƒ½å¸¦å…¥ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public static void main(String[] args) throws Exception {
        new JarLauncher().launch(args);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;4&quot;&gt;&lt;li&gt;ä¸Šé¢çš„launchæ–¹æ³•åœ¨çˆ¶ç±»Launcherä¸­ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;protected void launch(String[] args) throws Exception {
    // å°†jarè§£å‹åè¿è¡Œçš„æ–¹å¼å«åšexploded mode
    // å¦‚æœæ˜¯exploded modeï¼Œå°±ä¸èƒ½æ”¯æŒé€šè¿‡URLåŠ è½½jar
    // å¦‚æœä¸æ˜¯exploded mode,å°±å¯ä»¥é€šè¿‡URLåŠ è½½jar
        if (!isExploded()) {
            // å¦‚æœå…è®¸é€šè¿‡URLåŠ è½½jarï¼Œå°±åœ¨æ­¤æ³¨å†Œå¯¹åº”çš„å¤„ç†ç±»
                JarFile.registerUrlProtocolHandler();
        }
        // åˆ›å»ºclassLoader
        ClassLoader classLoader = createClassLoader(getClassPathArchivesIterator());
        // jarmodeæ˜¯åˆ›å»ºdockeré•œåƒæ—¶ç”¨åˆ°çš„å‚æ•°ï¼Œä½¿ç”¨è¯¥å‚æ•°æ˜¯ä¸ºäº†ç”Ÿæˆå¸¦æœ‰å¤šä¸ªlayerä¿¡æ¯çš„é•œåƒ
        // è¿™é‡Œæš‚æ—¶ä¸å…³æ³¨jarmode
        String jarMode = System.getProperty(&quot;jarmode&quot;);
        //å¦‚æœæ²¡æœ‰jarmodeå‚æ•°ï¼ŒlaunchClassçš„å€¼å°±æ¥è‡ªgetMainClass()è¿”å›
        String launchClass = (jarMode != null &amp;amp;&amp;amp; !jarMode.isEmpty()) ? JAR_MODE_LAUNCHER : getMainClass();
        launch(args, launchClass, classLoader);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;5&quot;&gt;&lt;li&gt;å¯è§è¦é‡ç‚¹å…³æ³¨çš„æ˜¯&lt;span&gt;getMainClass()&lt;/span&gt;æ–¹æ³•ï¼Œåœ¨çœ‹è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå»å…³æ³¨ä¸€ä¸ªé‡è¦çš„æˆå‘˜å˜é‡&lt;span&gt;archive&lt;/span&gt;ï¼Œæ˜¯JarLauncherçš„çˆ¶ç±»ExecutableArchiveLauncherçš„archiveï¼Œå¦‚ä¸‹å¯è§ï¼Œè¯¥å˜é‡åˆæ¥è‡ªæ–¹æ³•&lt;span&gt;createArchive&lt;/span&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public ExecutableArchiveLauncher() {
                try {
                        this.archive = createArchive();
                        this.classPathIndex = getClassPathIndex(this.archive);
                }
                catch (Exception ex) {
                        throw new IllegalStateException(ex);
                }
        }
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;6&quot;&gt;&lt;li&gt;æ–¹æ³•æ¥è‡ªLauncher.createArchiveï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå¯è§æˆå‘˜å˜é‡&lt;span&gt;archive&lt;/span&gt;å®é™…ä¸Šæ˜¯ä¸ªJarFileArchiveå¯¹è±¡ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;protected final Archive createArchive() throws Exception {
                ProtectionDomain protectionDomain = getClass().getProtectionDomain();
                CodeSource codeSource = protectionDomain.getCodeSource();
                URI location = (codeSource != null) ? codeSource.getLocation().toURI() : null;
                String path = (location != null) ? location.getSchemeSpecificPart() : null;
                if (path == null) {
                        throw new IllegalStateException(&quot;Unable to determine code source archive&quot;);
                }
                File root = new File(path);
                if (!root.exists()) {
                        throw new IllegalStateException(&quot;Unable to determine code source archive from &quot; + root);
                }
                return (root.isDirectory() ? new ExplodedArchive(root) : new JarFileArchive(root));
        }
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;7&quot;&gt;&lt;li&gt;ç°åœ¨å›åˆ°getMainClass()æ–¹æ³•ï¼Œå¯è§&lt;span&gt;this.archive.getManifest&lt;/span&gt;æ–¹æ³•è¿”å›çš„æ˜¯&lt;span&gt;META-INF/MANIFEST.MF&lt;/span&gt;æ–‡ä»¶çš„å†…å®¹ï¼Œç„¶ågetValue(START_CLASS_ATTRIBUTE)æ–¹æ³•å®é™…ä¸Šå°±æ˜¯ä»META-INF/MANIFEST.MFä¸­å–å¾—äº†Start-Classçš„å±æ€§ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;@Override
        protected String getMainClass() throws Exception {
            // å¯¹åº”çš„æ˜¯JarFileArchive.getManifestæ–¹æ³•ï¼Œ
            // è¿›å»åå‘ç°å¯¹åº”çš„å°±æ˜¯JarFile.getManifestæ–¹æ³•ï¼Œ
            // JarFile.getManifestå¯¹åº”çš„å°±æ˜¯META-INF/MANIFEST.MFæ–‡ä»¶çš„å†…å®¹
                Manifest manifest = this.archive.getManifest();
                String mainClass = null;
                if (manifest != null) {
                    // å¯¹åº”çš„æ˜¯META-INF/MANIFEST.MFæ–‡ä»¶ä¸­çš„Start-Classçš„å±æ€§
                        mainClass = manifest.getMainAttributes().getValue(START_CLASS_ATTRIBUTE);
                }
                if (mainClass == null) {
                        throw new IllegalStateException(&quot;No 'Start-Class' manifest entry specified in &quot; + this);
                }
                return mainClass;
        }
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;8&quot;&gt;&lt;li&gt;ä»ä¸Šè¿°åˆ†æå¯çŸ¥ï¼šgetMainClass()æ–¹æ³•è¿”å›çš„æ˜¯META-INF/MANIFEST.MFä¸­å–å¾—äº†&lt;span&gt;Start-Class&lt;/span&gt;çš„å±æ€§com.bolingcavalry.springbootstarterdemo.SpringbootstarterdemoApplicationï¼Œå†æ¬¡å›åˆ°launchæ–¹æ³•ä¸­ï¼Œå¯è§æœ€ç»ˆè¿è¡Œçš„ä»£ç æ˜¯launch(args, launchClass, classLoader)ï¼Œå®ƒçš„launchClasså‚æ•°å°±æ˜¯com.bolingcavalry.springbootstarterdemo.SpringbootstarterdemoApplicationï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;protected void launch(String[] args) throws Exception {
                if (!isExploded()) {
                        JarFile.registerUrlProtocolHandler();
                }
                ClassLoader classLoader = createClassLoader(getClassPathArchivesIterator());
                String jarMode = System.getProperty(&quot;jarmode&quot;);
                // è¿™é‡Œçš„launchClassç­‰äº&quot;com.bolingcavalry.springbootstarterdemo.SpringbootstarterdemoApplication&quot;
                String launchClass = (jarMode != null &amp;amp;&amp;amp; !jarMode.isEmpty()) ? JAR_MODE_LAUNCHER : getMainClass();
                // è¿™é‡Œå°±æ˜¯å¯åŠ¨SpringbootstarterdemoApplicationçš„åœ°æ–¹
                launch(args, launchClass, classLoader);
        }
&lt;/code&gt;
&lt;/pre&gt;
&lt;ol start=&quot;9&quot;&gt;&lt;li&gt;å±•å¼€launch(args, launchClass, classLoader)ï¼Œæœ€ç»ˆæŸ¥åˆ°äº†MainMethodRunnerç±»ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;pre&gt;
&lt;code class=&quot;language-java&quot;&gt;public class MainMethodRunner {

        private final String mainClassName;

        private final String[] args;

        /**
         * Create a new {@link MainMethodRunner} instance.
         * @param mainClass the main class
         * @param args incoming arguments
         */
        public MainMethodRunner(String mainClass, String[] args) {
            // mainClassNameè¢«èµ‹å€¼ä¸º&quot;com.bolingcavalry.springbootstarterdemo.SpringbootstarterdemoApplication&quot;
                this.mainClassName = mainClass;
                this.args = (args != null) ? args.clone() : null;
        }

        public void run() throws Exception {
            // å¾—åˆ°SpringbootstarterdemoApplicationçš„Classå¯¹è±¡
                Class&amp;lt;?&amp;gt; mainClass = Class.forName(this.mainClassName, false, Thread.currentThread().getContextClassLoader());
                // å¾—åˆ°SpringbootstarterdemoApplicationçš„mainæ–¹æ³•å¯¹è±¡
                Method mainMethod = mainClass.getDeclaredMethod(&quot;main&quot;, String[].class);
                mainMethod.setAccessible(true);
                // é€šè¿‡åå°„æ‰§è¡Œmainæ–¹æ³•
                mainMethod.invoke(null, new Object[] { this.args });
        }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç»ˆäºï¼ŒçœŸç›¸å¤§ç™½äº†ï¼›&lt;/p&gt;
&lt;h3 id=&quot;å°ç»“&quot;&gt;å°ç»“&lt;/h3&gt;
&lt;p&gt;æœ€åå°½å¯èƒ½ç®€çŸ­åšä¸ªå°ç»“ï¼Œå…ˆçœ‹jaræ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼Œå¦‚ä¸‹å›¾ï¼Œmavenæ’ä»¶ç”Ÿæˆçš„jaræ–‡ä»¶ä¸­ï¼Œæœ‰å¸¸è§çš„classã€jarï¼Œä¹Ÿæœ‰ç¬¦åˆjavaè§„èŒƒçš„MANIFEST.MFæ–‡ä»¶ï¼Œå¹¶ä¸”ï¼Œè¿˜åœ¨MANIFEST.MFæ–‡ä»¶ä¸­é¢å¤–ç”Ÿæˆäº†åä¸º&lt;span&gt;Start-Class&lt;/span&gt;çš„é…ç½®ï¼Œè¿™é‡Œé¢æ˜¯æˆ‘ä»¬ç¼–å†™çš„åº”ç”¨å¯åŠ¨ç±»&lt;span&gt;SpringbootstarterdemoApplication&lt;/span&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201225080521441-1610169076.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å¯åŠ¨ç±»æ˜¯&lt;span&gt;JarLauncher&lt;/span&gt;ï¼Œå®ƒæ˜¯å¦‚ä½•ä¸MANIFEST.MFæ–‡ä»¶å…³è”çš„å‘¢ï¼Ÿä»ä¸‹å›¾å¯ä»¥çœ‹å‡ºï¼Œæœ€ç»ˆæ˜¯é€šè¿‡JarFileç±»çš„æˆå‘˜å˜é‡&lt;span&gt;manifestSupplier&lt;/span&gt;å…³è”ä¸Šçš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201225080521891-511653638.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;å†æ¥çœ‹çœ‹å…³é”®ä»£ç çš„æ‰§è¡Œæƒ…å†µï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201225080522494-954278508.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è‡³æ­¤ï¼ŒSpringBootçš„jarç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬åŸç†å·²ç»æ¸…æ¥šï¼Œæ¢ç©¶çš„è¿‡ç¨‹ä¸­ï¼Œé™¤äº†ç†Ÿæ‚‰å…³é”®ä»£ç æµç¨‹ï¼Œè¿˜å¯¹jarä¸­çš„æ–‡ä»¶æœ‰äº†æ›´å¤šäº†è§£ï¼Œå¦‚æœæ‚¨æ­£åœ¨å­¦ä¹ SpringBootï¼Œå¸Œæœ›æœ¬æ–‡èƒ½ç»™æ‚¨ä¸€äº›å‚è€ƒï¼›&lt;/p&gt;
&lt;h3 id=&quot;å®˜æ–¹æ–‡æ¡£&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;æœ€åé™„ä¸Š&lt;a href=&quot;https://docs.spring.io/spring-boot/docs/2.3.1.RELEASE/reference/htmlsingle/#executable-jar-launching&quot; target=&quot;_blank&quot;&gt;SpringBootå®˜æ–¹æ–‡æ¡£&lt;/a&gt;ï¼Œå¯ä»¥çœ‹åˆ°&lt;span&gt;Start-Class&lt;/span&gt;æè¿°ä¿¡æ¯ï¼š&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/other/485422/202012/485422-20201225080522840-362743251.png&quot; alt=&quot;åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;ol start=&quot;2&quot;&gt;&lt;li&gt;ä¸Šè¿°æ–‡æ¡£æ˜ç¡®æåˆ°ï¼šStart-Classå®šä¹‰çš„æ˜¯å®é™…çš„å¯åŠ¨ç±»ï¼Œæ­¤æ—¶çš„æ‚¨åº”è¯¥å¯¹ä¸€åˆ‡éƒ½äº†ç„¶äºèƒ¸ï¼Œäº§ç”Ÿæœ¬è¯¥å¦‚æ­¤çš„æ„Ÿæ…¨ï¼›&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;ä½ ä¸å­¤å•ï¼Œæ¬£å®¸åŸåˆ›ä¸€è·¯ç›¸ä¼´&quot;&gt;ä½ ä¸å­¤å•ï¼Œæ¬£å®¸åŸåˆ›ä¸€è·¯ç›¸ä¼´&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;&lt;a href=&quot;https://xinchen.blog.csdn.net/article/details/105068742&quot; target=&quot;_blank&quot;&gt;Javaç³»åˆ—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://xinchen.blog.csdn.net/article/details/105086498&quot; target=&quot;_blank&quot;&gt;Springç³»åˆ—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://xinchen.blog.csdn.net/article/details/105086732&quot; target=&quot;_blank&quot;&gt;Dockerç³»åˆ—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://xinchen.blog.csdn.net/article/details/105086794&quot; target=&quot;_blank&quot;&gt;kubernetesç³»åˆ—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://xinchen.blog.csdn.net/article/details/105086850&quot; target=&quot;_blank&quot;&gt;æ•°æ®åº“+ä¸­é—´ä»¶ç³»åˆ—&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://xinchen.blog.csdn.net/article/details/105086920&quot; target=&quot;_blank&quot;&gt;DevOpsç³»åˆ—&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;h3 id=&quot;æ¬¢è¿å…³æ³¨å…¬ä¼—å·ï¼šç¨‹åºå‘˜æ¬£å®¸&quot;&gt;æ¬¢è¿å…³æ³¨å…¬ä¼—å·ï¼šç¨‹åºå‘˜æ¬£å®¸&lt;/h3&gt;
&lt;blockquote readability=&quot;4.258064516129&quot;&gt;
&lt;p&gt;å¾®ä¿¡æœç´¢ã€Œç¨‹åºå‘˜æ¬£å®¸ã€ï¼Œæˆ‘æ˜¯æ¬£å®¸ï¼ŒæœŸå¾…ä¸æ‚¨ä¸€åŒç•…æ¸¸Javaä¸–ç•Œ...&lt;br/&gt;&lt;a href=&quot;https://github.com/zq2599/blog_demos&quot; target=&quot;_blank&quot;&gt;https://github.com/zq2599/blog_demos&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</description>
<pubDate>Fri, 25 Dec 2020 00:05:00 +0000</pubDate>
<dc:creator>ç¨‹åºå‘˜æ¬£å®¸</dc:creator>
<og:description>æ¬¢è¿è®¿é—®æˆ‘çš„GitHub https://github.com/zq2599/blog_demos å†…å®¹ï¼šæ‰€æœ‰åŸåˆ›æ–‡ç« åˆ†ç±»æ±‡æ€»åŠé…å¥—æºç ï¼Œæ¶‰åŠJavaã€Dockerã€Kubernetesã€DevOPS</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/bolingcavalry/p/14187202.html</dc:identifier>
</item>
<item>
<title>C#ä¸­çƒ¦äººçš„Nullå€¼åˆ¤æ–­ç«Ÿç„¶è¿™æ ·å°±è¢«æ¶ˆç­äº† - ä¾ä¹ç¥</title>
<link>http://www.cnblogs.com/yilezhu/p/14177595.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/yilezhu/p/14177595.html</guid>
<description>&lt;blockquote readability=&quot;3.2884615384615&quot;&gt;
&lt;p&gt;ä½œè€…ï¼šä¾ä¹ç¥&lt;br/&gt;é¦–å‘è‡ªï¼šDotNetCoreå®æˆ˜ å…¬ä¼—å·&lt;br/&gt;&lt;a href=&quot;https://www.cnblogs.com/yilezhu/p/14177595.html&quot; target=&quot;_blank&quot;&gt;https://www.cnblogs.com/yilezhu/p/14177595.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Nullå€¼æ£€æŸ¥åº”è¯¥ç®—æ˜¯å¼€å‘ä¸­æœ€å¸¸è§ä¸”çƒ¦äººçš„å·¥ä½œäº†å§ï¼Œæœ‰äººåå¯¹å—ï¼Ÿåå¯¹çš„è¯è¯·å³ä¸Šè§’å…³é—¨ä¸é€ã€‚è¿™ç¯‡æ–‡ç« å°±æ•™å¤§å®¶ä¸€æ‹›æ¥ç®€åŒ–è¿™ä¸ªçƒ¦äººåˆä¸å¯é¿å…çš„å·¥ä½œã€‚&lt;br/&gt;ç½—å—¦è¯ä¸å¤šè¯´ï¼Œå…ˆçœ‹ä¸‹é¢ä¸€æ®µç®€å•çš„ä¸èƒ½å†ç®€å•çš„nullå€¼åˆ¤æ–­ä»£ç ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;public void DoSomething(string message)
{
  if(message == null)
    throw new ArgumentNullException();
    
    // ...
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ–¹æ³•ä½“çš„æ¯ä¸ªå‚æ•°éƒ½å°†ç”¨ifè¯­å¥è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶é€ä¸ªæŠ›å‡º &lt;code&gt;ArgumentNullException&lt;/code&gt;Â çš„å¼‚å¸¸ã€‚&lt;br/&gt;å…³æ³¨æˆ‘çš„æœ‹å‹ï¼Œåº”è¯¥çœ‹è¿‡æˆ‘ä¸Šç¯‡ã€Š&lt;a href=&quot;https://www.cnblogs.com/yilezhu/p/14174990.html&quot; target=&quot;_blank&quot;&gt;ä¸€ä¸ªå°æŠ€å·§åŠ©æ‚¨å‡å°‘ifè¯­å¥çš„çŠ¶æ€åˆ¤æ–­&lt;/a&gt;ã€‹çš„æ–‡ç« ï¼Œå®ƒä¹Ÿæ˜¯ç®€åŒ–Nullå€¼åˆ¤æ–­çš„ä¸€ç§æ–¹å¼ã€‚ç®€åŒ–åå¯ä»¥å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;
public void DoSomething(string message)
{
  Assert.That&amp;lt;ArgumentNullException&amp;gt;(message == null, nameof(DoSomething));
    // ...
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ä½†æ˜¯è¿˜æ˜¯å¾ˆå·®å¼ºäººæ„ã€‚&lt;br/&gt;&lt;img src=&quot;https://cdn.nlark.com/yuque/0/2020/jpeg/266699/1608693683209-4ad2d9c1-979f-4a09-aee2-ea41f1e93ab4.jpeg#align=left&amp;amp;display=inline&amp;amp;height=333&amp;amp;margin=%5Bobject%20Object%5D&amp;amp;originHeight=333&amp;amp;originWidth=500&amp;amp;size=0&amp;amp;status=done&amp;amp;style=none&amp;amp;width=500&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;**&lt;/p&gt;
&lt;h3 id=&quot;notnullattribute&quot;&gt;NotNullAttribute&lt;/h3&gt;
&lt;p&gt;è¿™é‡Œä½ å¯èƒ½æƒ³åˆ°äº† &lt;code&gt;_System.Diagnostics.CodeAnalysis_&lt;/code&gt; å‘½åç©ºé—´ä¸‹çš„è¿™ä¸ª [NotNull] ç‰¹æ€§ã€‚è¿™ä¸ä¼šåœ¨è¿è¡Œæ—¶æ£€æŸ¥ä»»ä½•å†…å®¹ã€‚å®ƒåªé€‚ç”¨äºCodeAnalysisï¼Œå¹¶åœ¨ç¼–è¯‘æ—¶è€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶å‘å‡ºè­¦å‘Šæˆ–é”™è¯¯ï¼&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;public void DoSomething([NotNull]string message) // Does not affect anything at runtime.
{
}

public void AnotherMethod()
{
  DoSomething(null); // MsBuild doesn't allow to build.
  string parameter = null;
  DoSomething(parameter); // MsBuild allows build. But nothing happend at runtime.
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;è‡ªå®šä¹‰è§£å†³æ–¹æ¡ˆ&quot;&gt;è‡ªå®šä¹‰è§£å†³æ–¹æ¡ˆ&lt;/h3&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä»¬å°†å»æ‰ç”¨äºNullæ£€æŸ¥çš„ifè¯­å¥ã€‚å¦‚ä½•å¤„ç†csharpä¸­æ–¹æ³•å‚æ•°çš„èµ‹å€¼ï¼Ÿç­”æ¡ˆæ˜¯ä½ ä¸èƒ½ï¼. ä½†ä½ å¯ä»¥ä½¿ç”¨å¦ä¸€ç§æ–¹æ³•æ¥å¤„ç†éšå¼è¿ç®—ç¬¦çš„èµ‹å€¼ã€‚è®©æˆ‘ä»¬åˆ›å»º &lt;code&gt;NotNull&amp;lt;T&amp;gt;&lt;/code&gt;Â ç±»å¹¶å®šä¹‰ä¸€ä¸ªéšå¼è¿ç®—ç¬¦ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥å¤„ç†èµ‹å€¼ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;public class NotNull&amp;lt;T&amp;gt;
{
    public NotNull(T value)
    {
        this.Value = value;
    }

    public T Value { get; set; }

    public static implicit operator NotNull&amp;lt;T&amp;gt;(T value)
    {
        if (value == null)
            throw new ArgumentNullException();
        return new NotNull&amp;lt;T&amp;gt;(value);
    }
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨NotNullå¯¹è±¡ä½œä¸ºæ–¹æ³•å‚æ•°.&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;static void Main(string[] args)
{
  DoSomething(&quot;Hello World!&quot;); // Works perfectly ğŸ‘Œ
  
  DoSomething(null); // Throws ArgumentNullException at runtime.
  
  string parameter = null;
  DoSomething(parameter); // Throws ArgumentNullException at runtime.
}

public static void DoSomething(NotNull&amp;lt;string&amp;gt; message) // &amp;lt;--- NotNull is used here
{
    Console.WriteLine(message.Value);
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¦‚æ‚¨æ‰€è§ï¼Œ &lt;code&gt;DoSomething()&lt;/code&gt;Â æ–¹æ³•çš„ä»£ç æ¯”ä»¥å‰æ›´ç®€æ´ã€‚ä¹Ÿå¯ä»¥å°†NotNullç±»ä¸ä»»ä½•ç±»å‹ä¸€èµ·ä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-csharp&quot;&gt;public void DoSomething(NotNull&amp;lt;string&amp;gt; message, NotNull&amp;lt;int&amp;gt; id, NotNull&amp;lt;Product&amp;gt; product)
{
  // ...
}
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼Œæˆ‘ä»¬ä¸‹ç¯‡æ–‡ç« è§ï¼Œæˆ‘æ˜¯ä¾ä¹ç¥ï¼Œæˆ‘ä¸ºåˆè‚¥.NETæŠ€æœ¯ç¤¾åŒºâ€œå¸¦ç›â€~&lt;br/&gt;å‚è€ƒè‡ªï¼š&lt;a href=&quot;https://enisn.medium.com/never-null-check-again-in-c-bd5aae27a48e&quot; target=&quot;_blank&quot;&gt;https://enisn.medium.com/never-null-check-again-in-c-bd5aae27a48e&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Thu, 24 Dec 2020 23:45:00 +0000</pubDate>
<dc:creator>ä¾ä¹ç¥</dc:creator>
<og:description>ä½œè€…ï¼šä¾ä¹ç¥ é¦–å‘è‡ªï¼šDotNetCoreå®æˆ˜ å…¬ä¼—å· https://www.cnblogs.com/yilezhu/p/14177595.html Nullå€¼æ£€æŸ¥åº”è¯¥ç®—æ˜¯å¼€å‘ä¸­æœ€å¸¸è§ä¸”çƒ¦äººçš„å·¥ä½œäº†</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/yilezhu/p/14177595.html</dc:identifier>
</item>
<item>
<title>ã€Tomcatã€‘TomcatæœåŠ¡å™¨æ ¸å¿ƒé…ç½®è¯´æ˜åŠæ ‡ç­¾ - é‚“æ™“æ™–</title>
<link>http://www.cnblogs.com/isdxh/p/14187129.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/isdxh/p/14187129.html</guid>
<description>&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;é¦–å…ˆå¸¦ç€ç–‘é—®&lt;/p&gt;
&lt;p&gt;é—®é¢˜ä¸€ï¼šå»å“ªé…ç½®?&lt;br/&gt;æ ¸å¿ƒé…ç½®åœ¨Tomcatç›®å½•ä¸‹ &lt;code&gt;conf/&lt;/code&gt;ç›®å½•ä¸‹çš„&lt;code&gt;server.xml&lt;/code&gt;æ–‡ä»¶ä¸­&lt;/p&gt;
&lt;p&gt;é—®é¢˜äºŒï¼šæ€ä¹ˆé…ç½®ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;&lt;li&gt;Tomcat ä½œä¸ºæœåŠ¡å™¨çš„é…ç½®ï¼Œä¸»è¦æ˜¯ server.xml â½‚ä»¶çš„é…ç½®ï¼›&lt;/li&gt;
&lt;li&gt;server.xmlä¸­åŒ…å«äº† Servletå®¹å™¨çš„ç›¸å…³é…ç½®ï¼Œå³ Catalina çš„é…ç½®ï¼›&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://typora-files.oss-cn-beijing.aliyuncs.com/file/2020-12-24_230624.png&quot; alt=&quot;2020-12-24_230624&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h2 id=&quot;ä¸€ï¼Œä¸»è¦æ ‡ç­¾ç»“æ„&quot;&gt;ä¸€ï¼Œä¸»è¦æ ‡ç­¾ç»“æ„&lt;/h2&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;!--
        Server æ ¹å…ƒç´ ï¼Œåˆ›å»ºâ¼€ä¸ªServerå®ä¾‹ï¼Œâ¼¦æ ‡ç­¾æœ‰ Listenerã€GlobalNamingResourcesã€Service
--&amp;gt;
&amp;lt;Server&amp;gt;
     &amp;lt;!--å®šä¹‰ç›‘å¬å™¨--&amp;gt;
     &amp;lt;Listener/&amp;gt;
     &amp;lt;!--å®šä¹‰æœåŠ¡å™¨çš„å…¨å±€JNDIèµ„æº --&amp;gt;
     &amp;lt;GlobalNamingResources/&amp;gt;
     &amp;lt;!-- å®šä¹‰â¼€ä¸ªServiceæœåŠ¡ï¼Œâ¼€ä¸ªServeræ ‡ç­¾å¯ä»¥æœ‰å¤šä¸ªServiceæœåŠ¡å®ä¾‹ --&amp;gt;
        &amp;lt;Service/&amp;gt;
&amp;lt;/Server&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;h2 id=&quot;äºŒï¼Œserveræ ‡ç­¾&quot;&gt;äºŒï¼ŒServeræ ‡ç­¾&lt;/h2&gt;
&lt;h3 id=&quot;æ ‡ç­¾å±æ€§ï¼š&quot;&gt;æ ‡ç­¾å±æ€§ï¼š&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;port&lt;/li&gt;
&lt;li&gt;shutdown&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;è¯´æ˜Tomcatæ¥ç›‘å¬portç«¯å£æ¥æ‰§è¡Œå…³é—­&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;!--
        portï¼šå…³é—­æœåŠ¡å™¨çš„ç›‘å¬ç«¯â¼
        shutdownï¼šå…³é—­æœåŠ¡å™¨çš„æŒ‡ä»¤å­—ç¬¦ä¸²
--&amp;gt;
&amp;lt;Server port=&quot;8005&quot; shutdown=&quot;SHUTDOWN&quot;&amp;gt;
     &amp;lt;!-- ä»¥â½‡å¿—å½¢å¼è¾“å‡ºæœåŠ¡å™¨ ã€æ“ä½œç³»ç»Ÿã€JVMçš„ç‰ˆæœ¬ä¿¡æ¯ --&amp;gt;
     &amp;lt;Listener className=&quot;org.apache.catalina.startup.VersionLoggerListener&quot; /&amp;gt;
     &amp;lt;!-- Security listener. Documentation at /docs/config/listeners.html
     &amp;lt;Listener className=&quot;org.apache.catalina.security.SecurityListener&quot; /&amp;gt;
     --&amp;gt;
     &amp;lt;!--APR library loader. Documentation at /docs/apr.html --&amp;gt;
     &amp;lt;!-- åŠ è½½ï¼ˆæœåŠ¡å™¨å¯åŠ¨ï¼‰ å’Œ é”€æ¯ ï¼ˆæœåŠ¡å™¨åœâ½Œï¼‰ APRã€‚ å¦‚æœæ‰¾ä¸åˆ°APRåº“ï¼Œ åˆ™ä¼šè¾“å‡ºâ½‡å¿—ï¼Œ å¹¶ä¸å½±å“ Tomcatå¯åŠ¨ --&amp;gt;
     &amp;lt;Listener className=&quot;org.apache.catalina.core.AprLifecycleListener&quot; SSLEngine=&quot;on&quot; /&amp;gt;
     &amp;lt;!-- Prevent memory leaks due to use of particular java/javax APIs--&amp;gt;
     &amp;lt;!-- é¿å…JREå†…å­˜æ³„æ¼é—®é¢˜ --&amp;gt;
     &amp;lt;Listener className=&quot;org.apache.catalina.core.JreMemoryLeakPreventionListener&quot; /&amp;gt;
     &amp;lt;!-- åŠ è½½ï¼ˆæœåŠ¡å™¨å¯åŠ¨ï¼‰ å’Œ é”€æ¯ï¼ˆæœåŠ¡å™¨åœâ½Œï¼‰ å…¨å±€å‘½åæœåŠ¡ --&amp;gt;
     &amp;lt;Listener className=&quot;org.apache.catalina.mbeans.GlobalResourcesLifecycleListener&quot; /&amp;gt;
     &amp;lt;!-- åœ¨Contextåœâ½Œæ—¶é‡å»º Executor æ± ä¸­çš„çº¿ç¨‹ï¼Œ ä»¥é¿å…ThreadLocal ç›¸å…³çš„å†…å­˜æ³„æ¼ --&amp;gt;
     &amp;lt;Listener className=&quot;org.apache.catalina.core.ThreadLocalLeakPreventionListener&quot; /&amp;gt;


     &amp;lt;!-- Global JNDI resources Documentation at /docs/jndi-resources-howto.html 
        GlobalNamingResources ä¸­å®šä¹‰äº†å…¨å±€å‘½åæœåŠ¡
     --&amp;gt;
     &amp;lt;GlobalNamingResources&amp;gt;
     &amp;lt;!-- Editable user database that can also be used by
     UserDatabaseRealm to authenticate users
     --&amp;gt;
     &amp;lt;Resource name=&quot;UserDatabase&quot; auth=&quot;Container&quot;
         type=&quot;org.apache.catalina.UserDatabase&quot;
         description=&quot;User database that can be updated and saved&quot;
         factory=&quot;org.apache.catalina.users.MemoryUserDatabaseFactory&quot;
         pathname=&quot;conf/tomcat-users.xml&quot; /&amp;gt;
     &amp;lt;/GlobalNamingResources&amp;gt;
     &amp;lt;!-- A &quot;Service&quot; is a collection of one or more &quot;Connectors&quot; that share
         a single &quot;Container&quot; Note: A &quot;Service&quot; is not itself a &quot;Container&quot;,
         so you may not define subcomponents such as &quot;Valves&quot; at this level.
         Documentation at /docs/config/service.html
     --&amp;gt;
     &amp;lt;Service name=&quot;Catalina&quot;&amp;gt;
         ...
     &amp;lt;/Service&amp;gt;
&amp;lt;/Server&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;å­æ ‡ç­¾ï¼š&quot;&gt;å­æ ‡ç­¾ï¼š&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸Šæ ‡ç­¾&lt;code&gt;Listener&lt;/code&gt;ã€&lt;code&gt;GlobalNamingResources&lt;/code&gt;ä¸€èˆ¬æƒ…å†µä¸‹ä¿æŒé»˜è®¤å³å¯ï¼Œä¸éœ€è¦è€Œå¤–æ“ä½œï¼Œé‡ç‚¹åœ¨äº&lt;strong&gt;Service&lt;/strong&gt; æ ‡ç­¾&lt;/p&gt;
&lt;h2 id=&quot;ä¸‰ï¼Œservice-æ ‡ç­¾&quot;&gt;ä¸‰ï¼ŒService æ ‡ç­¾&lt;/h2&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;Service name=&quot;Catalina&quot;&amp;gt;
 ...
&amp;lt;/Service&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¯¥æ ‡ç­¾â½¤äºåˆ›å»º Service å®ä¾‹ï¼Œé»˜è®¤ä½¿â½¤ &lt;code&gt;org.apache.catalina.core.StandardService&lt;/code&gt;ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒTomcat ä»…æŒ‡å®šäº†Service çš„åç§°ï¼Œ å€¼ä¸º &quot;&lt;strong&gt;Catalina&lt;/strong&gt;&quot;ã€‚&lt;/p&gt;
&lt;h3 id=&quot;å­æ ‡ç­¾ï¼š-1&quot;&gt;å­æ ‡ç­¾ï¼š&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Listener&lt;/strong&gt; (Listener â½¤äºä¸ºServiceæ·»åŠ â½£å‘½å‘¨æœŸç›‘å¬å™¨)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Executor&lt;/strong&gt; (â½¤äºé…ç½®Service å…±äº«çº¿ç¨‹æ± ï¼Œç»™Connectorä½¿ç”¨)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Connector&lt;/strong&gt; ï¼ˆâ½¤äºé…ç½®Service åŒ…å«çš„é“¾æ¥å™¨ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Engine&lt;/strong&gt; ï¼ˆâ½¤äºé…ç½®Serviceä¸­é“¾æ¥å™¨å¯¹åº”çš„Servlet å®¹å™¨å¼•æ“ï¼‰&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;å››ï¼Œexecutor-æ ‡ç­¾&quot;&gt;å››ï¼ŒExecutor æ ‡ç­¾&lt;/h2&gt;
&lt;p&gt;ç”¨æ¥å®šä¹‰å…±äº«çº¿ç¨‹æ± çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://typora-files.oss-cn-beijing.aliyuncs.com/file/image-20201224233733864.png&quot; alt=&quot;image-20201224233733864&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;é»˜è®¤æ˜¯è¢«æ³¨é‡Šæ‰çš„ï¼Œä¸”å±æ€§ä¸å…¨ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•ä½¿ç”¨å‘¢?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒService å¹¶æœªæ·»åŠ å…±äº«çº¿ç¨‹æ± é…ç½®ã€‚ å¦‚æœæˆ‘ä»¬æƒ³æ·»åŠ â¼€ä¸ªçº¿ç¨‹æ± ï¼Œ å¯ä»¥åœ¨ä¸‹æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;Executor name=&quot;commonThreadPool&quot;
        namePrefix=&quot;thread-exec-&quot;
        maxThreads=&quot;200&quot;
        minSpareThreads=&quot;100&quot;
        maxIdleTime=&quot;60000&quot;
        maxQueueSize=&quot;Integer.MAX_VALUE&quot;
        prestartminSpareThreads=&quot;false&quot;
        threadPriority=&quot;5&quot;
        className=&quot;org.apache.catalina.core.StandardThreadExecutor&quot;/&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;å±æ€§ï¼š&quot;&gt;å±æ€§ï¼š&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;name&lt;/strong&gt;ï¼šçº¿ç¨‹æ± åç§°ï¼Œ&lt;strong&gt;â½¤äº Connectorä¸­æŒ‡å®š&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;namePrefix&lt;/strong&gt;ï¼šæ‰€åˆ›å»ºçš„æ¯ä¸ªçº¿ç¨‹çš„åç§°å‰ç¼€ï¼Œâ¼€ä¸ªå•ç‹¬çš„çº¿ç¨‹åç§°ä¸º namePrefix+threadNumber&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;maxThreads&lt;/strong&gt;ï¼šæ± ä¸­æœ€â¼¤çº¿ç¨‹æ•°&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;minSpareThreads&lt;/strong&gt;ï¼šæ´»è·ƒçº¿ç¨‹æ•°ï¼Œä¹Ÿå°±æ˜¯æ ¸â¼¼æ± çº¿ç¨‹æ•°ï¼Œè¿™äº›çº¿ç¨‹ä¸ä¼šè¢«é”€æ¯ï¼Œä¼šâ¼€ç›´å­˜åœ¨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;maxIdleTime&lt;/strong&gt;ï¼šçº¿ç¨‹ç©ºé—²æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´åï¼Œç©ºé—²çº¿ç¨‹ä¼šè¢«é”€æ¯ï¼Œé»˜è®¤å€¼ä¸º6000ï¼ˆ1åˆ†é’Ÿï¼‰ï¼Œå•ä½ æ¯«ç§’&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;maxQueueSize&lt;/strong&gt;ï¼šåœ¨è¢«æ‰§â¾å‰æœ€â¼¤çº¿ç¨‹æ’é˜Ÿæ•°â½¬ï¼Œé»˜è®¤ä¸ºIntçš„æœ€â¼¤å€¼ï¼Œä¹Ÿå°±æ˜¯â¼´ä¹‰çš„â½†é™ã€‚é™¤â¾®ç‰¹æ®Šæƒ…å†µï¼Œè¿™ä¸ªå€¼ä¸éœ€è¦æ›´æ”¹ï¼Œå¦åˆ™ä¼šæœ‰è¯·æ±‚ä¸ä¼šè¢«å¤„ç†çš„æƒ…å†µå‘â½£&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;prestartminSpareThreads&lt;/strong&gt;ï¼šå¯åŠ¨çº¿ç¨‹æ± æ—¶æ˜¯å¦å¯åŠ¨ &lt;strong&gt;minSpareThreads&lt;/strong&gt;éƒ¨åˆ†çº¿ç¨‹ã€‚é»˜è®¤å€¼ä¸º &lt;strong&gt;false&lt;/strong&gt;ï¼Œå³ä¸å¯åŠ¨&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;threadPriority&lt;/strong&gt;ï¼šçº¿ç¨‹æ± ä¸­çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œé»˜è®¤å€¼ä¸º5ï¼Œå€¼ä»1åˆ°10&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;className&lt;/strong&gt;ï¼šçº¿ç¨‹æ± å®ç°ç±»ï¼ŒæœªæŒ‡å®šæƒ…å†µä¸‹ï¼Œé»˜è®¤å®ç°ç±»ä¸ºï¼š&lt;br/&gt;&lt;code&gt;org.apache.catalina.core.StandardThreadExecutor&lt;/code&gt;ã€‚å¦‚æœæƒ³ä½¿â½¤â¾ƒå®šä¹‰çº¿ç¨‹æ± â¾¸å…ˆéœ€è¦å®ç° &lt;code&gt;org.apache.catalina.Executor&lt;/code&gt;æ¥â¼&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;äº”ï¼Œconnectoræ ‡ç­¾&quot;&gt;äº”ï¼ŒConnectoræ ‡ç­¾&lt;/h2&gt;
&lt;p&gt;Connector æ ‡ç­¾â½¤äºåˆ›å»ºé“¾æ¥å™¨å®ä¾‹é»˜è®¤æƒ…å†µä¸‹ï¼Œ&lt;code&gt;server.xml&lt;/code&gt;é…ç½®äº†ä¸¤ä¸ªé“¾æ¥å™¨ï¼Œâ¼€ä¸ªâ½€æŒ&lt;strong&gt;HTTPåè®®&lt;/strong&gt;ï¼Œâ¼€ä¸ªâ½€æŒ&lt;strong&gt;AJPåè®®&lt;/strong&gt;ï¼Œâ¼¤å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦æ–°å¢é“¾æ¥å™¨é…ç½®ï¼Œåªæ˜¯æ ¹æ®éœ€è¦å¯¹å·²æœ‰é“¾æ¥å™¨è¿›â¾ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;!--org.apache.coyote.http11.Http11NioProtocol ï¼Œ â¾®é˜»å¡å¼ Java NIO é“¾æ¥å™¨--&amp;gt;
&amp;lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; /&amp;gt;
&amp;lt;Connector port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;å±æ€§ï¼š-1&quot;&gt;å±æ€§ï¼š&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;port&lt;/strong&gt;ï¼šç«¯â¼å·ï¼ŒConnector â½¤äºåˆ›å»ºæœåŠ¡ç«¯Socket å¹¶è¿›â¾ç›‘å¬ï¼Œ ä»¥ç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚é“¾æ¥ã€‚å¦‚æœè¯¥å±æ€§è®¾ç½® ä¸º0ï¼Œ Tomcatå°†ä¼šéšæœºé€‰æ‹©â¼€ä¸ªå¯â½¤çš„ç«¯â¼å·ç»™å½“å‰Connector ä½¿â½¤&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;protocol&lt;/strong&gt;ï¼šå½“å‰Connector â½€æŒçš„è®¿é—®åè®®ã€‚ é»˜è®¤ä¸º HTTP/1.1 ï¼Œ å¹¶é‡‡â½¤â¾ƒåŠ¨åˆ‡æ¢æœºåˆ¶é€‰æ‹©â¼€ä¸ªåŸºäº JAVA NIO çš„é“¾æ¥å™¨æˆ–è€…åŸºäºæœ¬åœ°APRçš„é“¾æ¥å™¨ï¼ˆæ ¹æ®æœ¬åœ°æ˜¯å¦å«æœ‰Tomcatçš„æœ¬åœ°åº“åˆ¤å®šï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;connectionTimeOut&lt;/strong&gt;: Connectoræ¥æ”¶é“¾æ¥åçš„ç­‰å¾…è¶…æ—¶æ—¶é—´ï¼Œ å•ä½ä¸ºæ¯«ç§’ã€‚ -1 è¡¨ç¤ºä¸è¶…æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;redirectPort&lt;/strong&gt;ï¼š å½“å‰Connector ä¸â½€æŒSSLè¯·æ±‚ï¼Œ æ¥æ”¶åˆ°äº†â¼€ä¸ªè¯·æ±‚ï¼Œ å¹¶ä¸”ä¹Ÿç¬¦åˆsecurity-constraint çº¦æŸï¼Œ éœ€è¦SSLä¼ è¾“ï¼ŒCatalinaâ¾ƒåŠ¨å°†è¯·æ±‚é‡å®šå‘åˆ°æŒ‡å®šçš„ç«¯â¼ã€‚&lt;strong&gt;æ¯”å¦‚è¯´ï¼šå¦‚æœè®¿é—®çš„æ˜¯8080ç«¯å£ï¼Œç„¶åå®ƒå‘ç°æ˜¯ä¸€ä¸ªhttpsçš„è¯·æ±‚ï¼Œé‚£ä¹ˆä»–å°±ä¼šè½¬å‘åˆ°8443ç«¯å£&lt;/strong&gt;ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®8443ç«¯å£&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;executor&lt;/strong&gt;ï¼š æŒ‡å®šå…±äº«çº¿ç¨‹æ± çš„åç§°(&lt;strong&gt;å°±æ˜¯Executoræ ‡ç­¾çš„nameå±æ€§&lt;/strong&gt;)ï¼Œ ä¹Ÿå¯ä»¥é€šè¿‡&lt;code&gt;maxThreads&lt;/code&gt;ã€&lt;code&gt;minSpareThreads&lt;/code&gt;ç­‰å±æ€§é…ç½®å†…éƒ¨çº¿ç¨‹æ± ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;URIEncoding&lt;/strong&gt;: â½¤äºæŒ‡å®šç¼–ç URIçš„å­—ç¬¦ç¼–ç ï¼Œ &lt;strong&gt;Tomcat8.xç‰ˆæœ¬é»˜è®¤çš„ç¼–ç ä¸º UTF-8&lt;/strong&gt; , &lt;strong&gt;Tomcat7.xç‰ˆæœ¬é»˜è®¤ä¸ºISO8859-1&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;å¯ä»¥ä½¿ç”¨å…±äº«çº¿ç¨‹æ± ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;Connector port=&quot;8080&quot;
     protocol=&quot;HTTP/1.1&quot;
     executor=&quot;commonThreadPool&quot;
     maxThreads=&quot;1000&quot;          
     minSpareThreads=&quot;100&quot;
     acceptCount=&quot;1000&quot; //å¾€å¾€å’ŒmaxThreadsä¿æŒä¸€è‡´
     maxConnections=&quot;1000&quot; //å¾€å¾€å’ŒmaxThreadsä¿æŒä¸€è‡´
     connectionTimeout=&quot;20000&quot;
     compression=&quot;on&quot;   //è¦ä¸è¦å¯åŠ¨gzipå‹ç¼©
     compressionMinSize=&quot;2048&quot; //å‹ç¼©å¤„ç†çš„æœ€å°å¤§å°ï¼Œè¶…è¿‡æ­¤å¤§å°æ‰å‹ç¼©
     disableUploadTimeout=&quot;true&quot; //å•ç‹¬çš„ç»™servletæ”¾å®½è¶…æ—¶æ—¶é—´
     redirectPort=&quot;8443&quot;
     URIEncoding=&quot;UTF-8&quot; /&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;blockquote readability=&quot;9&quot;&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°&lt;code&gt;Connector&lt;/code&gt;æ ‡ç­¾å’Œ&lt;code&gt;Executor&lt;/code&gt;éƒ½æœ‰&lt;code&gt;maxThreads&lt;/code&gt;å’Œ&lt;code&gt;minSpareThreads&lt;/code&gt;æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¯ä¸€ä¸ªConnectoréƒ½å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå¦‚æœæ¯ä¸ªConnectoréƒ½è‡ªå·±å®šä¹‰çº¿ç¨‹æ± å°±æµªè´¹äº†ã€‚æ‰€ä»¥ä¸ºä»€ä¹ˆä¸ç”¨ä¸€ä¸ªå‘¢ï¼Ÿäºæ˜¯å°±æœ‰äº†Executoræ ‡ç­¾æ¥å®šä¹‰ä¸€ä¸ªå…±äº«çº¿ç¨‹æ± ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;å…­ï¼Œengineæ ‡ç­¾&quot;&gt;å…­ï¼ŒEngineæ ‡ç­¾&lt;/h2&gt;
&lt;p&gt;Engine è¡¨ç¤º Servlet å¼•æ“&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot;&amp;gt;
 ...
&amp;lt;/Engine&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;å±æ€§ï¼š-2&quot;&gt;å±æ€§ï¼š&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;name&lt;/strong&gt;ï¼šâ½¤äºæŒ‡å®šEngine çš„åç§°ï¼Œ é»˜è®¤ä¸ºCatalina&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;defaultHost&lt;/strong&gt;ï¼šé»˜è®¤ä½¿â½¤çš„è™šæ‹Ÿä¸»æœºåç§°ï¼Œ å½“å®¢æˆ·ç«¯è¯·æ±‚æŒ‡å‘çš„ä¸»æœºâ½†æ•ˆæ—¶ï¼Œ å°†äº¤ç”±é»˜è®¤çš„è™šæ‹Ÿä¸»æœºå¤„ç†ï¼Œ é»˜è®¤ä¸ºlocalhost&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://typora-files.oss-cn-beijing.aliyuncs.com/file/image-20201225005456558.png&quot; alt=&quot;image-20201225005456558&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;å­æ ‡ç­¾ï¼š-2&quot;&gt;å­æ ‡ç­¾ï¼š&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Cluster&lt;/strong&gt;ï¼šé›†ç¾¤æ–¹é¢çš„æ ‡ç­¾&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Realm&lt;/strong&gt;ï¼šéªŒè¯å®‰å…¨çš„æ ‡ç­¾&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Host&lt;/strong&gt;ï¼šâ½¤äºé…ç½®â¼€ä¸ªè™šæ‹Ÿä¸»æœº&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;ä¸ƒï¼Œhostæ ‡ç­¾&quot;&gt;ä¸ƒï¼ŒHostæ ‡ç­¾&lt;/h2&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;Host name=&quot;localhost&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&amp;gt;
 ...
&amp;lt;/Host&amp;gt; 
&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;æ ‡ç­¾å±æ€§ï¼š-1&quot;&gt;æ ‡ç­¾å±æ€§ï¼š&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;appBase&lt;/strong&gt;ï¼šè¿™ä¸ªç½‘ç«™çš„ç¨‹åºå­˜æ”¾çš„ä½ç½®ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ã€‚webappså°±æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œåœ¨tomcatçš„æ ¹ç›®å½•ä¸‹&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;unpackWARs&lt;/strong&gt;ï¼šé»˜è®¤ä¸ºtrueï¼ŒæŠŠwaråŒ…è§£å‹æˆæ–‡ä»¶å¤¹&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;autoDeploy&lt;/strong&gt;ï¼šè‡ªåŠ¨éƒ¨ç½²ï¼Œå½“èµ„æºå˜æ›´æ—¶è‡ªåŠ¨éƒ¨ç½²ï¼Œç±»ä¼¼äºçƒ­éƒ¨ç½²&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;å­æ ‡ç­¾ï¼š-3&quot;&gt;å­æ ‡ç­¾ï¼š&lt;/h3&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot; directory=&quot;logs&quot;
               prefix=&quot;localhost_access_log&quot; suffix=&quot;.txt&quot;
               pattern=&quot;%h %l %u %t &amp;amp;quot;%r&amp;amp;quot; %s %b&quot; /&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å½“è¯·æ±‚æ¥ä¸´æ—¶ï¼Œæ—¥å¿—å­˜æ”¾èµ·æ¥ï¼Œ&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å­˜æ”¾åœ¨&lt;code&gt;directory&lt;/code&gt;å€¼çš„ç›®å½•&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;prefix&lt;/strong&gt;ï¼šæ—¥å¿—æ–‡ä»¶å‰ç¼€&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;suffix&lt;/strong&gt;ï¼šæ—¥å¿—æ–‡ä»¶åç¼€&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;pattern&lt;/strong&gt;ï¼šæ‰“å°çš„æ—¥å¿—æ ¼å¼&lt;/li&gt;
&lt;/ul&gt;&lt;h3 id=&quot;å¯åŠ¨tomcat-æµè§ˆå™¨è¾“å…¥ï¼šhttplocalhost8080&quot;&gt;å¯åŠ¨Tomcat æµè§ˆå™¨è¾“å…¥ï¼š&lt;a href=&quot;http://localhost:8080&quot; target=&quot;_blank&quot;&gt;http://localhost:8080&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://typora-files.oss-cn-beijing.aliyuncs.com/file/image-20201225011255980.png&quot; alt=&quot;image-20201225011255980&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://typora-files.oss-cn-beijing.aliyuncs.com/file/image-20201225011309987.png&quot; alt=&quot;image-20201225011309987&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;Host name=&quot;localhost&quot;  appBase=&quot;webapps&quot;
            unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;hostnameæ˜¯&lt;strong&gt;localhost&lt;/strong&gt;ï¼ŒappBaseæ˜¯&lt;strong&gt;webapps&lt;/strong&gt;ï¼Œå»&lt;strong&gt;webapps&lt;/strong&gt;æ–‡ä»¶å¤¹ä¸‹æ‰¾åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹ï¼Œæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤å°±å»ROOTæ–‡ä»¶å¤¹ä¸‹ï¼š&lt;br/&gt;&lt;img src=&quot;https://typora-files.oss-cn-beijing.aliyuncs.com/file/image-20201225011532363.png&quot; alt=&quot;image-20201225011532363&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;æˆ‘ä»¬æ¥åšä¸ªå®éªŒï¼š&quot;&gt;æˆ‘ä»¬æ¥åšä¸ªå®éªŒï¼š&lt;/h3&gt;
&lt;ol&gt;&lt;li&gt;æŠŠhostæ ‡ç­¾å¤åˆ¶ä¸€ä»½ï¼Œä¸¤ä¸ªhostæ ‡ç­¾çš„nameåˆ†åˆ«ä¸º&lt;code&gt;www.abc.com&lt;/code&gt;ï¼Œ&lt;code&gt;www.def.com&lt;/code&gt;ã€‚appBaseåˆ†åˆ«ä¸º&lt;code&gt;webapps&lt;/code&gt;ã€&lt;code&gt;webapps2&lt;/code&gt;&lt;br/&gt;&lt;img src=&quot;https://typora-files.oss-cn-beijing.aliyuncs.com/file/image-20201225012119802.png&quot; alt=&quot;image-20201225012119802&quot; loading=&quot;lazy&quot;/&gt;&lt;/li&gt;
&lt;li&gt;è¿›å…¥Tomcatæ ¹ç›®å½•ï¼ŒæŠŠwebappsæ‹·è´ä¸€ä»½åˆ°æ ¹ç›®å½•ï¼Œå‘½åä¸ºwebapps2&lt;br/&gt;&lt;img src=&quot;https://typora-files.oss-cn-beijing.aliyuncs.com/file/image-20201225012241881.png&quot; alt=&quot;image-20201225012241881&quot; loading=&quot;lazy&quot;/&gt;&lt;/li&gt;
&lt;li&gt;ä¸ºäº†æ–¹ä¾¿åŒºåˆ†ï¼ŒæŠŠwebapps2/ROOT/index.jsp ä¸­çš„&lt;strong&gt;Home&lt;/strong&gt;æ”¹ä¸º&lt;strong&gt;Home-webapps2&lt;/strong&gt;&lt;br/&gt;&lt;img src=&quot;https://typora-files.oss-cn-beijing.aliyuncs.com/file/image-20201225012344132.png&quot; alt=&quot;image-20201225012344132&quot; loading=&quot;lazy&quot;/&gt;&lt;/li&gt;
&lt;li&gt;é‡æ–°å¯åŠ¨Tomcat&lt;/li&gt;
&lt;li&gt;é…ç½®hostsæ–‡ä»¶&lt;br/&gt;&lt;img src=&quot;https://typora-files.oss-cn-beijing.aliyuncs.com/file/image-20201225012858171.png&quot; alt=&quot;image-20201225012858171&quot; loading=&quot;lazy&quot;/&gt;&lt;/li&gt;
&lt;li&gt;è®¿é—®æµè§ˆå™¨http://localhost:8080ã€ &lt;a href=&quot;http://www.abc.xn--comhttp-bs4l&quot; target=&quot;_blank&quot;&gt;http://www.abc.comå’Œhttp&lt;/a&gt;ğŸ˜•/www.def.com&lt;/li&gt;
&lt;li&gt;å¯ä»¥çœ‹åˆ°ï¼š&lt;br/&gt;&lt;img src=&quot;https://typora-files.oss-cn-beijing.aliyuncs.com/file/image-20201225013221920.png&quot; alt=&quot;image-20201225013221920&quot; loading=&quot;lazy&quot;/&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°localhost:8080è®¿é—®ä¸åˆ°äº†ï¼Œå› ä¸ºè¿™ä¸ªè™šæ‹Ÿä¸»æœºè¢«æˆ‘ä»¬ä¿®æ”¹äº†&lt;/p&gt;
&lt;p&gt;è€Œabcå’Œdefå‡å¯ä»¥æ‰¾åˆ°ã€‚åŒæ—¶def.comçš„Homeä¹Ÿè¢«ä¿®æ”¹ä¸ºHome-webapps2äº†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å…«ï¼Œcontextæ ‡ç­¾&quot;&gt;å…«ï¼ŒContextæ ‡ç­¾&lt;/h2&gt;
&lt;p&gt;ç”¨äºé…ç½®ä¸€ä¸ªWebåº”ç”¨â€”â€”&lt;strong&gt;ä¸€ä¸ªè™šæ‹Ÿä¸»æœºä¸‹å¯ä»¥é…ç½®å¤šä¸ªåº”ç”¨&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-xml&quot;&gt;&amp;lt;Host name=&quot;www.abc.com&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot;
autoDeploy=&quot;true&quot;&amp;gt;
&amp;lt;!--
 docBaseï¼šWebåº”â½¤â½¬å½•æˆ–è€…WaråŒ…çš„éƒ¨ç½²è·¯å¾„ã€‚å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹äº Host appBaseçš„
ç›¸å¯¹è·¯å¾„ã€‚
 pathï¼šWebåº”â½¤çš„Context è·¯å¾„ã€‚å¦‚æœæˆ‘ä»¬Hoståä¸ºlocalhostï¼Œ åˆ™è¯¥webåº”â½¤è®¿é—®çš„æ ¹è·¯å¾„ä¸ºï¼š
 http://localhost:8080/web_demoã€‚
--&amp;gt;
 &amp;lt;Context docBase=&quot;E://dengxhh&quot; path=&quot;/dengxh&quot;&amp;gt;&amp;lt;/Context&amp;gt;

 &amp;lt;Valve className=&quot;org.apache.catalina.valves.AccessLogValve&quot;
directory=&quot;logs&quot;
 prefix=&quot;localhost_access_log&quot; suffix=&quot;.txt&quot;
 pattern=&quot;%h %l %u %t &amp;amp;quot;%r&amp;amp;quot; %s %b&quot; /&amp;gt;
&amp;lt;/Host&amp;gt;
&lt;/code&gt;
&lt;/pre&gt;
&lt;blockquote readability=&quot;7&quot;&gt;
&lt;p&gt;åˆšæ‰æˆ‘ä»¬è®¿é—®çš„æ˜¯&lt;code&gt;http://www.abc.com:8080&lt;/code&gt;ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘æƒ³è¾“å…¥&lt;code&gt;http://www.abc.com:8080/dengxh&lt;/code&gt;ï¼Œ&lt;strong&gt;dengxh&lt;/strong&gt;æ‰€ä»£è¡¨çš„ä½ç½®æ˜¯æˆ‘çš„ç£ç›˜ä¸Šçš„æŸä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹é‡Œæ”¾çš„æˆ‘çš„ç¨‹åºèµ„æºã€‚å¦‚ä½•åšï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol readability=&quot;0.5&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä»¬å°±æ‹¿ROOTä¸­çš„ç¨‹åºåšä¾‹å­ï¼ŒæŠŠ&lt;strong&gt;webappsä¸­çš„ROOTæ–‡ä»¶å¤¹å¤åˆ¶åˆ°Eç›˜æ ¹ç›®å½•&lt;/strong&gt;ï¼Œ&lt;strong&gt;å–åä¸ºdengxhh&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;åœ¨Hostæ ‡ç­¾ä¸­ï¼Œå¢åŠ  &lt;code&gt;&amp;lt;Context docBase=&quot;E://dengxhh&quot; path=&quot;/dengxh&quot;&amp;gt;&amp;lt;/Context&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;é‡å¯Tomcatï¼Œè®¿é—®www.abc.com/dengxh/ ï¼ŒæˆåŠŸè·³è½¬äº†ã€‚&lt;br/&gt;&lt;img src=&quot;https://typora-files.oss-cn-beijing.aliyuncs.com/file/image-20201225014648017.png&quot; alt=&quot;image-20201225014648017&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;å¦‚æ­¤æ“ä½œå°±å¯ä»¥åœ¨ä¸€ä¸ªè™šæ‹Ÿä¸»æœºä¸­ï¼Œé…ç½®å¤šä¸ªåº”ç”¨ï¼Œåªéœ€è¦åœ¨hostæ ‡ç­¾ä¸­é…ç½®å¤šä¸ªContextæ ‡ç­¾ï¼ŒåŒºåˆ†çš„æ—¶å€™åªéœ€è¦åœ¨è™šæ‹Ÿä¸»æœºåè·Ÿä¸ŠContextçš„pathå±æ€§çš„å€¼å³å¯æ‰¾åˆ°å¯¹åº”çš„èµ„æºã€‚&lt;br/&gt;ä¾‹å¦‚ï¼šHost name=&quot;www.abc.com&quot; ï¼ŒContext path =&quot;dengxh&quot; ï¼Œé‚£ä¹ˆæµè§ˆå™¨ä¸­è¾“å…¥ &lt;code&gt;www.abc.com/dengxh&lt;/code&gt;å³å¯ã€‚&lt;/p&gt;
&lt;hr/&gt;&lt;h2 id=&quot;æ€»ç»“ï¼š&quot;&gt;æ€»ç»“ï¼š&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;https://typora-files.oss-cn-beijing.aliyuncs.com/file/image-20201225021451534.png&quot; alt=&quot;image-20201225021451534&quot; loading=&quot;lazy&quot;/&gt;&lt;br/&gt;&lt;img src=&quot;https://typora-files.oss-cn-beijing.aliyuncs.com/file/image-20201225021557645.png&quot; alt=&quot;image-20201225021557645&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ€ç»´å¯¼å›¾åœ¨çº¿è§‚çœ‹åœ°å€ï¼š&lt;/strong&gt;&lt;a href=&quot;https://www.processon.com/view/link/5fe4da565653bb054783ca6e&quot; target=&quot;_blank&quot;&gt;https://www.processon.com/view/link/5fe4da565653bb054783ca6e&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Thu, 24 Dec 2020 18:19:00 +0000</pubDate>
<dc:creator>é‚“æ™“æ™–</dc:creator>
<og:description>é¦–å…ˆå¸¦ç€ç–‘é—® é—®é¢˜ä¸€ï¼šå»å“ªé…ç½®? æ ¸å¿ƒé…ç½®åœ¨Tomcatç›®å½•ä¸‹ conf/ç›®å½•ä¸‹çš„server.xmlæ–‡ä»¶ä¸­ é—®é¢˜äºŒï¼šæ€ä¹ˆé…ç½®ï¼Ÿ å¦‚ä¸‹ Tomcat ä½œä¸ºæœåŠ¡å™¨çš„é…ç½®ï¼Œä¸»è¦æ˜¯ server.xml â½‚</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/isdxh/p/14187129.html</dc:identifier>
</item>
<item>
<title>SpringCloud æºç ç³»åˆ—ï¼ˆ5ï¼‰â€”â€” è´Ÿè½½å‡è¡¡ Ribbonï¼ˆä¸‹ï¼‰ - bojiangzhou</title>
<link>http://www.cnblogs.com/chiangchou/p/ribbon-2.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/chiangchou/p/ribbon-2.html</guid>
<description>&lt;p&gt;Ribbon è´Ÿè½½å‡è¡¡æ ¸å¿ƒæ¥å£ã€Ribbon HTTPå®¢æˆ·ç«¯ç»„ä»¶ï¼Œå®šåˆ¶åŒ–ä½¿å¾— RestTemplate å¯ä»¥ä½¿ç”¨ Apache httpclient æˆ– Okhttpï¼Œè¿˜ä»‹ç»äº† Ribbon çš„è¯·æ±‚é‡è¯•å’Œ RetryTemplate çš„è¯·æ±‚é‡è¯•ã€‚&lt;/p&gt;&lt;div id=&quot;cnblogs_post_body&quot; readability=&quot;660.76399635867&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/chiangchou/p/ribbon-1.html&quot; target=&quot;_blank&quot;&gt;SpringCloud æºç ç³»åˆ—ï¼ˆ4ï¼‰â€”â€” è´Ÿè½½å‡è¡¡ Ribbonï¼ˆä¸Šï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/chiangchou/p/ribbon-2.html&quot; target=&quot;_blank&quot;&gt;SpringCloud æºç ç³»åˆ—ï¼ˆ5ï¼‰â€”â€” è´Ÿè½½å‡è¡¡ Ribbonï¼ˆä¸‹ï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;äº”ã€Ribbon æ ¸å¿ƒæ¥å£&lt;/h2&gt;
&lt;p&gt;å‰é¢å·²ç»äº†è§£åˆ° Ribbon æ ¸å¿ƒæ¥å£ä»¥åŠé»˜è®¤å®ç°å¦‚ä½•åä½œæ¥æŸ¥æ‰¾è¦è°ƒç”¨çš„ä¸€ä¸ªå®ä¾‹ï¼Œè¿™èŠ‚å†æ¥çœ‹ä¸‹å„ä¸ªæ ¸å¿ƒæ¥å£çš„ä¸€äº›ç‰¹æ€§åŠå…¶å®ƒå®ç°ç±»ã€‚&lt;/p&gt;
&lt;h3&gt;1ã€å®¢æˆ·ç«¯é…ç½® â€” IClientConfig&lt;/h3&gt;
&lt;p&gt;IClientConfig å°±æ˜¯ç®¡ç†å®¢æˆ·ç«¯é…ç½®çš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒçš„é»˜è®¤å®ç°ç±»æ˜¯Â DefaultClientConfigImplã€‚å¯ä»¥çœ‹åˆ°åœ¨åˆ›å»ºÂ IClientConfig æ—¶ï¼Œè®¾ç½®äº† Ribbon å®¢æˆ·ç«¯é»˜è®¤çš„è¿æ¥å’Œè¯»å–è¶…æ—¶æ—¶é—´ä¸º 1 ç§’ï¼Œä¾‹å¦‚è¯»å–å¦‚æœè¶…è¿‡1ç§’ï¼Œå°±ä¼šè¿”å›è¶…æ—¶ï¼Œè¿™ä¸¤ä¸ªä¸€èˆ¬éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥è°ƒæ•´ã€‚ã€&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;@Bean
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;@ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;public&lt;/span&gt;&lt;span&gt; IClientConfig ribbonClientConfig() {
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;     DefaultClientConfigImpl config = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; DefaultClientConfigImpl();
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åŠ è½½é…ç½®&lt;/span&gt;
&lt;span&gt; 6&lt;/span&gt;     config.loadProperties(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.name);
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è¿æ¥è¶…æ—¶é»˜è®¤ 1 ç§’&lt;/span&gt;
&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;    config.set(CommonClientConfigKey.ConnectTimeout, DEFAULT_CONNECT_TIMEOUT);
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è¯»å–è¶…æ—¶é»˜è®¤ 1 ç§’&lt;/span&gt;
&lt;span&gt;10&lt;/span&gt; &lt;span&gt;    config.set(CommonClientConfigKey.ReadTimeout, DEFAULT_READ_TIMEOUT);
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;    config.set(CommonClientConfigKey.GZipPayload, DEFAULT_GZIP_PAYLOAD);
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; config;
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;CommonClientConfigKey è¿™ä¸ªç±»å®šä¹‰äº† Ribbon å®¢æˆ·ç«¯ç›¸å…³çš„æ‰€æœ‰é…ç½®çš„é”®å¸¸é‡ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªç±»æ¥çœ‹æœ‰å“ªäº›é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_17526302-0291-42be-9704-594e414fbe35&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_17526302-0291-42be-9704-594e414fbe35&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_17526302-0291-42be-9704-594e414fbe35&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;61&quot;&gt;
&lt;pre&gt;
&lt;span&gt;  1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;abstract&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; CommonClientConfigKey&amp;lt;T&amp;gt; &lt;span&gt;implements&lt;/span&gt; IClientConfigKey&amp;lt;T&amp;gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;  2&lt;/span&gt; 
&lt;span&gt;  3&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; AppName = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;AppName&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;  4&lt;/span&gt; 
&lt;span&gt;  5&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; Version = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;Version&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;  6&lt;/span&gt; 
&lt;span&gt;  7&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; Port = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;Port&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;  8&lt;/span&gt; 
&lt;span&gt;  9&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; SecurePort = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;SecurePort&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 10&lt;/span&gt; 
&lt;span&gt; 11&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; VipAddress = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;VipAddress&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 12&lt;/span&gt; 
&lt;span&gt; 13&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; ForceClientPortConfiguration = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;ForceClientPortConfiguration&quot;){}; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; use client defined port regardless of server advert&lt;/span&gt;
&lt;span&gt; 14&lt;/span&gt; 
&lt;span&gt; 15&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; DeploymentContextBasedVipAddresses = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;DeploymentContextBasedVipAddresses&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 16&lt;/span&gt; 
&lt;span&gt; 17&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; MaxAutoRetries = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;MaxAutoRetries&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 18&lt;/span&gt; 
&lt;span&gt; 19&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; MaxAutoRetriesNextServer = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;MaxAutoRetriesNextServer&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 20&lt;/span&gt; 
&lt;span&gt; 21&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; OkToRetryOnAllOperations = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;OkToRetryOnAllOperations&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 22&lt;/span&gt; 
&lt;span&gt; 23&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; RequestSpecificRetryOn = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;RequestSpecificRetryOn&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 24&lt;/span&gt; 
&lt;span&gt; 25&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; ReceiveBufferSize = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;ReceiveBufferSize&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 26&lt;/span&gt; 
&lt;span&gt; 27&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; EnablePrimeConnections = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;EnablePrimeConnections&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 28&lt;/span&gt; 
&lt;span&gt; 29&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; PrimeConnectionsClassName = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;PrimeConnectionsClassName&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 30&lt;/span&gt; 
&lt;span&gt; 31&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; MaxRetriesPerServerPrimeConnection = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;MaxRetriesPerServerPrimeConnection&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 32&lt;/span&gt; 
&lt;span&gt; 33&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; MaxTotalTimeToPrimeConnections = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;MaxTotalTimeToPrimeConnections&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 34&lt;/span&gt; 
&lt;span&gt; 35&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Float&amp;gt; MinPrimeConnectionsRatio = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Float&amp;gt;(&quot;MinPrimeConnectionsRatio&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 36&lt;/span&gt; 
&lt;span&gt; 37&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; PrimeConnectionsURI = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;PrimeConnectionsURI&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 38&lt;/span&gt; 
&lt;span&gt; 39&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; PoolMaxThreads = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;PoolMaxThreads&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 40&lt;/span&gt; 
&lt;span&gt; 41&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; PoolMinThreads = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;PoolMinThreads&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 42&lt;/span&gt; 
&lt;span&gt; 43&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; PoolKeepAliveTime = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;PoolKeepAliveTime&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 44&lt;/span&gt; 
&lt;span&gt; 45&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; PoolKeepAliveTimeUnits = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;PoolKeepAliveTimeUnits&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 46&lt;/span&gt; 
&lt;span&gt; 47&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; EnableConnectionPool = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;EnableConnectionPool&quot;&lt;span&gt;) {};
&lt;/span&gt;&lt;span&gt; 48&lt;/span&gt; 
&lt;span&gt; 49&lt;/span&gt;     &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt; 50&lt;/span&gt; &lt;span&gt;     * Use {&lt;/span&gt;&lt;span&gt;@link&lt;/span&gt;&lt;span&gt; #MaxConnectionsPerHost}
&lt;/span&gt;&lt;span&gt; 51&lt;/span&gt;      &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt; 52&lt;/span&gt; &lt;span&gt;    @Deprecated
&lt;/span&gt;&lt;span&gt; 53&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; MaxHttpConnectionsPerHost = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;MaxHttpConnectionsPerHost&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 54&lt;/span&gt; 
&lt;span&gt; 55&lt;/span&gt;     &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt; 56&lt;/span&gt; &lt;span&gt;     * Use {&lt;/span&gt;&lt;span&gt;@link&lt;/span&gt;&lt;span&gt; #MaxTotalConnections}
&lt;/span&gt;&lt;span&gt; 57&lt;/span&gt;      &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt; 58&lt;/span&gt; &lt;span&gt;    @Deprecated
&lt;/span&gt;&lt;span&gt; 59&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; MaxTotalHttpConnections = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;MaxTotalHttpConnections&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 60&lt;/span&gt; 
&lt;span&gt; 61&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; MaxConnectionsPerHost = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;MaxConnectionsPerHost&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 62&lt;/span&gt; 
&lt;span&gt; 63&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; MaxTotalConnections = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;MaxTotalConnections&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 64&lt;/span&gt; 
&lt;span&gt; 65&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; IsSecure = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;IsSecure&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 66&lt;/span&gt; 
&lt;span&gt; 67&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; GZipPayload = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;GZipPayload&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 68&lt;/span&gt; 
&lt;span&gt; 69&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; ConnectTimeout = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;ConnectTimeout&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 70&lt;/span&gt; 
&lt;span&gt; 71&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; BackoffInterval = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;BackoffTimeout&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 72&lt;/span&gt; 
&lt;span&gt; 73&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; ReadTimeout = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;ReadTimeout&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 74&lt;/span&gt; 
&lt;span&gt; 75&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; SendBufferSize = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;SendBufferSize&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 76&lt;/span&gt; 
&lt;span&gt; 77&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; StaleCheckingEnabled = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;StaleCheckingEnabled&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 78&lt;/span&gt; 
&lt;span&gt; 79&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; Linger = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;Linger&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 80&lt;/span&gt; 
&lt;span&gt; 81&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; ConnectionManagerTimeout = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;ConnectionManagerTimeout&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 82&lt;/span&gt; 
&lt;span&gt; 83&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; FollowRedirects = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;FollowRedirects&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 84&lt;/span&gt; 
&lt;span&gt; 85&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; ConnectionPoolCleanerTaskEnabled = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;ConnectionPoolCleanerTaskEnabled&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 86&lt;/span&gt; 
&lt;span&gt; 87&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; ConnIdleEvictTimeMilliSeconds = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;ConnIdleEvictTimeMilliSeconds&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 88&lt;/span&gt; 
&lt;span&gt; 89&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; ConnectionCleanerRepeatInterval = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;ConnectionCleanerRepeatInterval&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 90&lt;/span&gt; 
&lt;span&gt; 91&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; EnableGZIPContentEncodingFilter = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;EnableGZIPContentEncodingFilter&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 92&lt;/span&gt; 
&lt;span&gt; 93&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; ProxyHost = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;ProxyHost&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 94&lt;/span&gt; 
&lt;span&gt; 95&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; ProxyPort = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;ProxyPort&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 96&lt;/span&gt; 
&lt;span&gt; 97&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; KeyStore = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;KeyStore&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt; 98&lt;/span&gt; 
&lt;span&gt; 99&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; KeyStorePassword = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;KeyStorePassword&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;100&lt;/span&gt; 
&lt;span&gt;101&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; TrustStore = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;TrustStore&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;102&lt;/span&gt; 
&lt;span&gt;103&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; TrustStorePassword = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;TrustStorePassword&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;104&lt;/span&gt; 
&lt;span&gt;105&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; if this is a secure rest client, must we use client auth too?&lt;/span&gt;
&lt;span&gt;106&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; IsClientAuthRequired = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;IsClientAuthRequired&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;107&lt;/span&gt; 
&lt;span&gt;108&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; CustomSSLSocketFactoryClassName = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;CustomSSLSocketFactoryClassName&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;109&lt;/span&gt;      &lt;span&gt;//&lt;/span&gt;&lt;span&gt; must host name match name in certificate?&lt;/span&gt;
&lt;span&gt;110&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; IsHostnameValidationRequired = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;IsHostnameValidationRequired&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;111&lt;/span&gt; 
&lt;span&gt;112&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; see also &lt;/span&gt;&lt;span&gt;http://hc.apache.org/httpcomponents-client-ga/tutorial/html/advanced.html&lt;/span&gt;
&lt;span&gt;113&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; IgnoreUserTokenInConnectionPoolForSecureClient = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;IgnoreUserTokenInConnectionPoolForSecureClient&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;114&lt;/span&gt; 
&lt;span&gt;115&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; Client implementation&lt;/span&gt;
&lt;span&gt;116&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; ClientClassName = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;ClientClassName&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;117&lt;/span&gt; 
&lt;span&gt;118&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;LoadBalancer Related&lt;/span&gt;
&lt;span&gt;119&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; InitializeNFLoadBalancer = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;InitializeNFLoadBalancer&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;120&lt;/span&gt; 
&lt;span&gt;121&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; NFLoadBalancerClassName = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;NFLoadBalancerClassName&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;122&lt;/span&gt; 
&lt;span&gt;123&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; NFLoadBalancerRuleClassName = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;NFLoadBalancerRuleClassName&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;124&lt;/span&gt; 
&lt;span&gt;125&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; NFLoadBalancerPingClassName = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;NFLoadBalancerPingClassName&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;126&lt;/span&gt; 
&lt;span&gt;127&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; NFLoadBalancerPingInterval = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;NFLoadBalancerPingInterval&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;128&lt;/span&gt; 
&lt;span&gt;129&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; NFLoadBalancerMaxTotalPingTime = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;NFLoadBalancerMaxTotalPingTime&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;130&lt;/span&gt; 
&lt;span&gt;131&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; NFLoadBalancerStatsClassName = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;NFLoadBalancerStatsClassName&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;132&lt;/span&gt; 
&lt;span&gt;133&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; NIWSServerListClassName = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;NIWSServerListClassName&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;134&lt;/span&gt; 
&lt;span&gt;135&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; ServerListUpdaterClassName = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;ServerListUpdaterClassName&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;136&lt;/span&gt; 
&lt;span&gt;137&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; NIWSServerListFilterClassName = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;NIWSServerListFilterClassName&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;138&lt;/span&gt; 
&lt;span&gt;139&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; ServerListRefreshInterval = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;ServerListRefreshInterval&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;140&lt;/span&gt; 
&lt;span&gt;141&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; EnableMarkingServerDownOnReachingFailureLimit = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;EnableMarkingServerDownOnReachingFailureLimit&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;142&lt;/span&gt; 
&lt;span&gt;143&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; ServerDownFailureLimit = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;ServerDownFailureLimit&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;144&lt;/span&gt; 
&lt;span&gt;145&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Integer&amp;gt; ServerDownStatWindowInMillis = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Integer&amp;gt;(&quot;ServerDownStatWindowInMillis&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;146&lt;/span&gt; 
&lt;span&gt;147&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; EnableZoneAffinity = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;EnableZoneAffinity&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;148&lt;/span&gt; 
&lt;span&gt;149&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; EnableZoneExclusivity = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;EnableZoneExclusivity&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;150&lt;/span&gt; 
&lt;span&gt;151&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; PrioritizeVipAddressBasedServers = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;PrioritizeVipAddressBasedServers&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;152&lt;/span&gt; 
&lt;span&gt;153&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; VipAddressResolverClassName = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;VipAddressResolverClassName&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;154&lt;/span&gt; 
&lt;span&gt;155&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; TargetRegion = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;TargetRegion&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;156&lt;/span&gt; 
&lt;span&gt;157&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; RulePredicateClasses = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;RulePredicateClasses&quot;&lt;span&gt;){};
&lt;/span&gt;&lt;span&gt;158&lt;/span&gt; 
&lt;span&gt;159&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; RequestIdHeaderName = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;RequestIdHeaderName&quot;&lt;span&gt;) {};
&lt;/span&gt;&lt;span&gt;160&lt;/span&gt; 
&lt;span&gt;161&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;Boolean&amp;gt; UseIPAddrForServer = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;Boolean&amp;gt;(&quot;UseIPAddrForServer&quot;&lt;span&gt;) {};
&lt;/span&gt;&lt;span&gt;162&lt;/span&gt; 
&lt;span&gt;163&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; IClientConfigKey&amp;lt;String&amp;gt; ListOfServers = &lt;span&gt;new&lt;/span&gt; CommonClientConfigKey&amp;lt;String&amp;gt;(&quot;listOfServers&quot;&lt;span&gt;) {};
&lt;/span&gt;&lt;span&gt;164&lt;/span&gt; 
&lt;span&gt;165&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Set&amp;lt;IClientConfigKey&amp;gt; keys = &lt;span&gt;new&lt;/span&gt; HashSet&amp;lt;IClientConfigKey&amp;gt;&lt;span&gt;();
&lt;/span&gt;&lt;span&gt;166&lt;/span&gt; 
&lt;span&gt;167&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ...&lt;/span&gt;
&lt;span&gt;168&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;è¿›å…¥åˆ°Â DefaultClientConfigImplï¼Œå¯ä»¥çœ‹åˆ°Â CommonClientConfigKey ä¸­çš„æ¯ä¸ªé…ç½®éƒ½å¯¹åº”äº†ä¸€ä¸ªé»˜è®¤å€¼ã€‚åœ¨åŠ è½½é…ç½®çš„æ—¶å€™ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰å®šåˆ¶é…ç½®ï¼Œå°±ä¼šä½¿ç”¨é»˜è®¤çš„é…ç½®ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;57&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_941afa48-85fe-4606-8815-aa208d54b410&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_941afa48-85fe-4606-8815-aa208d54b410&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_941afa48-85fe-4606-8815-aa208d54b410&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;109&quot;&gt;
&lt;pre&gt;
&lt;span&gt;  1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; DefaultClientConfigImpl &lt;span&gt;implements&lt;/span&gt;&lt;span&gt; IClientConfig {
&lt;/span&gt;&lt;span&gt;  2&lt;/span&gt; 
&lt;span&gt;  3&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Boolean DEFAULT_PRIORITIZE_VIP_ADDRESS_BASED_SERVERS =&lt;span&gt; Boolean.TRUE;
&lt;/span&gt;&lt;span&gt;  4&lt;/span&gt; 
&lt;span&gt;  5&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String DEFAULT_NFLOADBALANCER_PING_CLASSNAME = &quot;com.netflix.loadbalancer.DummyPing&quot;; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; DummyPing.class.getName();&lt;/span&gt;
&lt;span&gt;  6&lt;/span&gt; 
&lt;span&gt;  7&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String DEFAULT_NFLOADBALANCER_RULE_CLASSNAME = &quot;com.netflix.loadbalancer.AvailabilityFilteringRule&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;  8&lt;/span&gt; 
&lt;span&gt;  9&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String DEFAULT_NFLOADBALANCER_CLASSNAME = &quot;com.netflix.loadbalancer.ZoneAwareLoadBalancer&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 10&lt;/span&gt; 
&lt;span&gt; 11&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; DEFAULT_USEIPADDRESS_FOR_SERVER =&lt;span&gt; Boolean.FALSE;
&lt;/span&gt;&lt;span&gt; 12&lt;/span&gt; 
&lt;span&gt; 13&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String DEFAULT_CLIENT_CLASSNAME = &quot;com.netflix.niws.client.http.RestClient&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 14&lt;/span&gt; 
&lt;span&gt; 15&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String DEFAULT_VIPADDRESS_RESOLVER_CLASSNAME = &quot;com.netflix.client.SimpleVipAddressResolver&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 16&lt;/span&gt; 
&lt;span&gt; 17&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String DEFAULT_PRIME_CONNECTIONS_URI = &quot;/&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 18&lt;/span&gt; 
&lt;span&gt; 19&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_MAX_TOTAL_TIME_TO_PRIME_CONNECTIONS = 30000&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 20&lt;/span&gt; 
&lt;span&gt; 21&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_MAX_RETRIES_PER_SERVER_PRIME_CONNECTION = 9&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 22&lt;/span&gt; 
&lt;span&gt; 23&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Boolean DEFAULT_ENABLE_PRIME_CONNECTIONS =&lt;span&gt; Boolean.FALSE;
&lt;/span&gt;&lt;span&gt; 24&lt;/span&gt; 
&lt;span&gt; 25&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_MAX_REQUESTS_ALLOWED_PER_WINDOW =&lt;span&gt; Integer.MAX_VALUE;
&lt;/span&gt;&lt;span&gt; 26&lt;/span&gt; 
&lt;span&gt; 27&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_REQUEST_THROTTLING_WINDOW_IN_MILLIS = 60000&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 28&lt;/span&gt; 
&lt;span&gt; 29&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Boolean DEFAULT_ENABLE_REQUEST_THROTTLING =&lt;span&gt; Boolean.FALSE;
&lt;/span&gt;&lt;span&gt; 30&lt;/span&gt; 
&lt;span&gt; 31&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Boolean DEFAULT_ENABLE_GZIP_CONTENT_ENCODING_FILTER =&lt;span&gt; Boolean.FALSE;
&lt;/span&gt;&lt;span&gt; 32&lt;/span&gt; 
&lt;span&gt; 33&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Boolean DEFAULT_CONNECTION_POOL_CLEANER_TASK_ENABLED =&lt;span&gt; Boolean.TRUE;
&lt;/span&gt;&lt;span&gt; 34&lt;/span&gt; 
&lt;span&gt; 35&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Boolean DEFAULT_FOLLOW_REDIRECTS =&lt;span&gt; Boolean.FALSE;
&lt;/span&gt;&lt;span&gt; 36&lt;/span&gt; 
&lt;span&gt; 37&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;float&lt;/span&gt; DEFAULT_PERCENTAGE_NIWS_EVENT_LOGGED = 0.0f&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 38&lt;/span&gt; 
&lt;span&gt; 39&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_MAX_AUTO_RETRIES_NEXT_SERVER = 1&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 40&lt;/span&gt; 
&lt;span&gt; 41&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_MAX_AUTO_RETRIES = 0&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 42&lt;/span&gt; 
&lt;span&gt; 43&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_BACKOFF_INTERVAL = 0&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 44&lt;/span&gt; 
&lt;span&gt; 45&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_READ_TIMEOUT = 5000&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 46&lt;/span&gt; 
&lt;span&gt; 47&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_CONNECTION_MANAGER_TIMEOUT = 2000&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 48&lt;/span&gt; 
&lt;span&gt; 49&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_CONNECT_TIMEOUT = 2000&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 50&lt;/span&gt; 
&lt;span&gt; 51&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Boolean DEFAULT_ENABLE_CONNECTION_POOL =&lt;span&gt; Boolean.TRUE;
&lt;/span&gt;&lt;span&gt; 52&lt;/span&gt; 
&lt;span&gt; 53&lt;/span&gt; &lt;span&gt;    @Deprecated
&lt;/span&gt;&lt;span&gt; 54&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_MAX_HTTP_CONNECTIONS_PER_HOST = 50&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 55&lt;/span&gt; 
&lt;span&gt; 56&lt;/span&gt; &lt;span&gt;    @Deprecated
&lt;/span&gt;&lt;span&gt; 57&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_MAX_TOTAL_HTTP_CONNECTIONS = 200&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 58&lt;/span&gt; 
&lt;span&gt; 59&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_MAX_CONNECTIONS_PER_HOST = 50&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 60&lt;/span&gt; 
&lt;span&gt; 61&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_MAX_TOTAL_CONNECTIONS = 200&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 62&lt;/span&gt; 
&lt;span&gt; 63&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;float&lt;/span&gt; DEFAULT_MIN_PRIME_CONNECTIONS_RATIO = 1.0f&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 64&lt;/span&gt; 
&lt;span&gt; 65&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String DEFAULT_PRIME_CONNECTIONS_CLASS = &quot;com.netflix.niws.client.http.HttpPrimeConnection&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 66&lt;/span&gt; 
&lt;span&gt; 67&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String DEFAULT_SEVER_LIST_CLASS = &quot;com.netflix.loadbalancer.ConfigurationBasedServerList&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 68&lt;/span&gt; 
&lt;span&gt; 69&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String DEFAULT_SERVER_LIST_UPDATER_CLASS = &quot;com.netflix.loadbalancer.PollingServerListUpdater&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 70&lt;/span&gt; 
&lt;span&gt; 71&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_CONNECTION_IDLE_TIMERTASK_REPEAT_IN_MSECS = 30000; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; every half minute (30 secs)&lt;/span&gt;
&lt;span&gt; 72&lt;/span&gt; 
&lt;span&gt; 73&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_CONNECTIONIDLE_TIME_IN_MSECS = 30000; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; all connections idle for 30 secs&lt;/span&gt;
&lt;span&gt; 74&lt;/span&gt; 
&lt;span&gt; 75&lt;/span&gt;     &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;volatile&lt;/span&gt; Map&amp;lt;String, Object&amp;gt; properties = &lt;span&gt;new&lt;/span&gt; ConcurrentHashMap&amp;lt;String, Object&amp;gt;&lt;span&gt;();
&lt;/span&gt;&lt;span&gt; 76&lt;/span&gt; 
&lt;span&gt; 77&lt;/span&gt;     &lt;span&gt;protected&lt;/span&gt; Map&amp;lt;IClientConfigKey&amp;lt;?&amp;gt;, Object&amp;gt; typedProperties = &lt;span&gt;new&lt;/span&gt; ConcurrentHashMap&amp;lt;IClientConfigKey&amp;lt;?&amp;gt;, Object&amp;gt;&lt;span&gt;();
&lt;/span&gt;&lt;span&gt; 78&lt;/span&gt; 
&lt;span&gt; 79&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Logger LOG = LoggerFactory.getLogger(DefaultClientConfigImpl.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 80&lt;/span&gt; 
&lt;span&gt; 81&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; String clientName = &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 82&lt;/span&gt; 
&lt;span&gt; 83&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; VipAddressResolver resolver = &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 84&lt;/span&gt; 
&lt;span&gt; 85&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; enableDynamicProperties = &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 86&lt;/span&gt;     &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt; 87&lt;/span&gt; &lt;span&gt;     * Defaults for the parameters for the thread pool used by batchParallel
&lt;/span&gt;&lt;span&gt; 88&lt;/span&gt; &lt;span&gt;     * calls
&lt;/span&gt;&lt;span&gt; 89&lt;/span&gt;      &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt; 90&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_POOL_MAX_THREADS =&lt;span&gt; DEFAULT_MAX_TOTAL_HTTP_CONNECTIONS;
&lt;/span&gt;&lt;span&gt; 91&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_POOL_MIN_THREADS = 1&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 92&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;long&lt;/span&gt; DEFAULT_POOL_KEEP_ALIVE_TIME = 15 * 60L&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 93&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; TimeUnit DEFAULT_POOL_KEEP_ALIVE_TIME_UNITS =&lt;span&gt; TimeUnit.SECONDS;
&lt;/span&gt;&lt;span&gt; 94&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Boolean DEFAULT_ENABLE_ZONE_AFFINITY =&lt;span&gt; Boolean.FALSE;
&lt;/span&gt;&lt;span&gt; 95&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Boolean DEFAULT_ENABLE_ZONE_EXCLUSIVITY =&lt;span&gt; Boolean.FALSE;
&lt;/span&gt;&lt;span&gt; 96&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_PORT = 7001&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 97&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Boolean DEFAULT_ENABLE_LOADBALANCER =&lt;span&gt; Boolean.TRUE;
&lt;/span&gt;&lt;span&gt; 98&lt;/span&gt; 
&lt;span&gt; 99&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; String DEFAULT_PROPERTY_NAME_SPACE = &quot;ribbon&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;100&lt;/span&gt; 
&lt;span&gt;101&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; String propertyNameSpace =&lt;span&gt; DEFAULT_PROPERTY_NAME_SPACE;
&lt;/span&gt;&lt;span&gt;102&lt;/span&gt; 
&lt;span&gt;103&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Boolean DEFAULT_OK_TO_RETRY_ON_ALL_OPERATIONS =&lt;span&gt; Boolean.FALSE;
&lt;/span&gt;&lt;span&gt;104&lt;/span&gt; 
&lt;span&gt;105&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Boolean DEFAULT_ENABLE_NIWS_EVENT_LOGGING =&lt;span&gt; Boolean.TRUE;
&lt;/span&gt;&lt;span&gt;106&lt;/span&gt; 
&lt;span&gt;107&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Boolean DEFAULT_IS_CLIENT_AUTH_REQUIRED =&lt;span&gt; Boolean.FALSE;
&lt;/span&gt;&lt;span&gt;108&lt;/span&gt; 
&lt;span&gt;109&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Map&amp;lt;String, DynamicStringProperty&amp;gt; dynamicProperties = &lt;span&gt;new&lt;/span&gt; ConcurrentHashMap&amp;lt;String, DynamicStringProperty&amp;gt;&lt;span&gt;();
&lt;/span&gt;&lt;span&gt;110&lt;/span&gt; 
&lt;span&gt;111&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; Boolean getDefaultPrioritizeVipAddressBasedServers() {
&lt;/span&gt;&lt;span&gt;112&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_PRIORITIZE_VIP_ADDRESS_BASED_SERVERS;
&lt;/span&gt;&lt;span&gt;113&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;114&lt;/span&gt; 
&lt;span&gt;115&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; String getDefaultNfloadbalancerPingClassname() {
&lt;/span&gt;&lt;span&gt;116&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_NFLOADBALANCER_PING_CLASSNAME;
&lt;/span&gt;&lt;span&gt;117&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;118&lt;/span&gt; 
&lt;span&gt;119&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; String getDefaultNfloadbalancerRuleClassname() {
&lt;/span&gt;&lt;span&gt;120&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_NFLOADBALANCER_RULE_CLASSNAME;
&lt;/span&gt;&lt;span&gt;121&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;122&lt;/span&gt; 
&lt;span&gt;123&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; String getDefaultNfloadbalancerClassname() {
&lt;/span&gt;&lt;span&gt;124&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_NFLOADBALANCER_CLASSNAME;
&lt;/span&gt;&lt;span&gt;125&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;126&lt;/span&gt; 
&lt;span&gt;127&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; getDefaultUseIpAddressForServer() {
&lt;/span&gt;&lt;span&gt;128&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_USEIPADDRESS_FOR_SERVER;
&lt;/span&gt;&lt;span&gt;129&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;130&lt;/span&gt; 
&lt;span&gt;131&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; String getDefaultClientClassname() {
&lt;/span&gt;&lt;span&gt;132&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_CLIENT_CLASSNAME;
&lt;/span&gt;&lt;span&gt;133&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;134&lt;/span&gt; 
&lt;span&gt;135&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; String getDefaultVipaddressResolverClassname() {
&lt;/span&gt;&lt;span&gt;136&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_VIPADDRESS_RESOLVER_CLASSNAME;
&lt;/span&gt;&lt;span&gt;137&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;138&lt;/span&gt; 
&lt;span&gt;139&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; String getDefaultPrimeConnectionsUri() {
&lt;/span&gt;&lt;span&gt;140&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_PRIME_CONNECTIONS_URI;
&lt;/span&gt;&lt;span&gt;141&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;142&lt;/span&gt; 
&lt;span&gt;143&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultMaxTotalTimeToPrimeConnections() {
&lt;/span&gt;&lt;span&gt;144&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_MAX_TOTAL_TIME_TO_PRIME_CONNECTIONS;
&lt;/span&gt;&lt;span&gt;145&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;146&lt;/span&gt; 
&lt;span&gt;147&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultMaxRetriesPerServerPrimeConnection() {
&lt;/span&gt;&lt;span&gt;148&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_MAX_RETRIES_PER_SERVER_PRIME_CONNECTION;
&lt;/span&gt;&lt;span&gt;149&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;150&lt;/span&gt; 
&lt;span&gt;151&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; Boolean getDefaultEnablePrimeConnections() {
&lt;/span&gt;&lt;span&gt;152&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_ENABLE_PRIME_CONNECTIONS;
&lt;/span&gt;&lt;span&gt;153&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;154&lt;/span&gt; 
&lt;span&gt;155&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultMaxRequestsAllowedPerWindow() {
&lt;/span&gt;&lt;span&gt;156&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_MAX_REQUESTS_ALLOWED_PER_WINDOW;
&lt;/span&gt;&lt;span&gt;157&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;158&lt;/span&gt; 
&lt;span&gt;159&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultRequestThrottlingWindowInMillis() {
&lt;/span&gt;&lt;span&gt;160&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_REQUEST_THROTTLING_WINDOW_IN_MILLIS;
&lt;/span&gt;&lt;span&gt;161&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;162&lt;/span&gt; 
&lt;span&gt;163&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; Boolean getDefaultEnableRequestThrottling() {
&lt;/span&gt;&lt;span&gt;164&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_ENABLE_REQUEST_THROTTLING;
&lt;/span&gt;&lt;span&gt;165&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;166&lt;/span&gt; 
&lt;span&gt;167&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; Boolean getDefaultEnableGzipContentEncodingFilter() {
&lt;/span&gt;&lt;span&gt;168&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_ENABLE_GZIP_CONTENT_ENCODING_FILTER;
&lt;/span&gt;&lt;span&gt;169&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;170&lt;/span&gt; 
&lt;span&gt;171&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; Boolean getDefaultConnectionPoolCleanerTaskEnabled() {
&lt;/span&gt;&lt;span&gt;172&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_CONNECTION_POOL_CLEANER_TASK_ENABLED;
&lt;/span&gt;&lt;span&gt;173&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;174&lt;/span&gt; 
&lt;span&gt;175&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; Boolean getDefaultFollowRedirects() {
&lt;/span&gt;&lt;span&gt;176&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_FOLLOW_REDIRECTS;
&lt;/span&gt;&lt;span&gt;177&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;178&lt;/span&gt; 
&lt;span&gt;179&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;float&lt;/span&gt;&lt;span&gt; getDefaultPercentageNiwsEventLogged() {
&lt;/span&gt;&lt;span&gt;180&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_PERCENTAGE_NIWS_EVENT_LOGGED;
&lt;/span&gt;&lt;span&gt;181&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;182&lt;/span&gt; 
&lt;span&gt;183&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultMaxAutoRetriesNextServer() {
&lt;/span&gt;&lt;span&gt;184&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_MAX_AUTO_RETRIES_NEXT_SERVER;
&lt;/span&gt;&lt;span&gt;185&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;186&lt;/span&gt; 
&lt;span&gt;187&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultMaxAutoRetries() {
&lt;/span&gt;&lt;span&gt;188&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_MAX_AUTO_RETRIES;
&lt;/span&gt;&lt;span&gt;189&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;190&lt;/span&gt; 
&lt;span&gt;191&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultReadTimeout() {
&lt;/span&gt;&lt;span&gt;192&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_READ_TIMEOUT;
&lt;/span&gt;&lt;span&gt;193&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;194&lt;/span&gt; 
&lt;span&gt;195&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultConnectionManagerTimeout() {
&lt;/span&gt;&lt;span&gt;196&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_CONNECTION_MANAGER_TIMEOUT;
&lt;/span&gt;&lt;span&gt;197&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;198&lt;/span&gt; 
&lt;span&gt;199&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultConnectTimeout() {
&lt;/span&gt;&lt;span&gt;200&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_CONNECT_TIMEOUT;
&lt;/span&gt;&lt;span&gt;201&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;202&lt;/span&gt; 
&lt;span&gt;203&lt;/span&gt; &lt;span&gt;    @Deprecated
&lt;/span&gt;&lt;span&gt;204&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultMaxHttpConnectionsPerHost() {
&lt;/span&gt;&lt;span&gt;205&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_MAX_HTTP_CONNECTIONS_PER_HOST;
&lt;/span&gt;&lt;span&gt;206&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;207&lt;/span&gt; 
&lt;span&gt;208&lt;/span&gt; &lt;span&gt;    @Deprecated
&lt;/span&gt;&lt;span&gt;209&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultMaxTotalHttpConnections() {
&lt;/span&gt;&lt;span&gt;210&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_MAX_TOTAL_HTTP_CONNECTIONS;
&lt;/span&gt;&lt;span&gt;211&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;212&lt;/span&gt; 
&lt;span&gt;213&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultMaxConnectionsPerHost() {
&lt;/span&gt;&lt;span&gt;214&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_MAX_CONNECTIONS_PER_HOST;
&lt;/span&gt;&lt;span&gt;215&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;216&lt;/span&gt; 
&lt;span&gt;217&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultMaxTotalConnections() {
&lt;/span&gt;&lt;span&gt;218&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_MAX_TOTAL_CONNECTIONS;
&lt;/span&gt;&lt;span&gt;219&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;220&lt;/span&gt; 
&lt;span&gt;221&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;float&lt;/span&gt;&lt;span&gt; getDefaultMinPrimeConnectionsRatio() {
&lt;/span&gt;&lt;span&gt;222&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_MIN_PRIME_CONNECTIONS_RATIO;
&lt;/span&gt;&lt;span&gt;223&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;224&lt;/span&gt; 
&lt;span&gt;225&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; String getDefaultPrimeConnectionsClass() {
&lt;/span&gt;&lt;span&gt;226&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_PRIME_CONNECTIONS_CLASS;
&lt;/span&gt;&lt;span&gt;227&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;228&lt;/span&gt; 
&lt;span&gt;229&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; String getDefaultSeverListClass() {
&lt;/span&gt;&lt;span&gt;230&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_SEVER_LIST_CLASS;
&lt;/span&gt;&lt;span&gt;231&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;232&lt;/span&gt; 
&lt;span&gt;233&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultConnectionIdleTimertaskRepeatInMsecs() {
&lt;/span&gt;&lt;span&gt;234&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_CONNECTION_IDLE_TIMERTASK_REPEAT_IN_MSECS;
&lt;/span&gt;&lt;span&gt;235&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;236&lt;/span&gt; 
&lt;span&gt;237&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultConnectionidleTimeInMsecs() {
&lt;/span&gt;&lt;span&gt;238&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_CONNECTIONIDLE_TIME_IN_MSECS;
&lt;/span&gt;&lt;span&gt;239&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;240&lt;/span&gt; 
&lt;span&gt;241&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; VipAddressResolver getResolver() {
&lt;/span&gt;&lt;span&gt;242&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; resolver;
&lt;/span&gt;&lt;span&gt;243&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;244&lt;/span&gt; 
&lt;span&gt;245&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; isEnableDynamicProperties() {
&lt;/span&gt;&lt;span&gt;246&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; enableDynamicProperties;
&lt;/span&gt;&lt;span&gt;247&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;248&lt;/span&gt; 
&lt;span&gt;249&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultPoolMaxThreads() {
&lt;/span&gt;&lt;span&gt;250&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_POOL_MAX_THREADS;
&lt;/span&gt;&lt;span&gt;251&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;252&lt;/span&gt; 
&lt;span&gt;253&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultPoolMinThreads() {
&lt;/span&gt;&lt;span&gt;254&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_POOL_MIN_THREADS;
&lt;/span&gt;&lt;span&gt;255&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;256&lt;/span&gt; 
&lt;span&gt;257&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;long&lt;/span&gt;&lt;span&gt; getDefaultPoolKeepAliveTime() {
&lt;/span&gt;&lt;span&gt;258&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_POOL_KEEP_ALIVE_TIME;
&lt;/span&gt;&lt;span&gt;259&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;260&lt;/span&gt; 
&lt;span&gt;261&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; TimeUnit getDefaultPoolKeepAliveTimeUnits() {
&lt;/span&gt;&lt;span&gt;262&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_POOL_KEEP_ALIVE_TIME_UNITS;
&lt;/span&gt;&lt;span&gt;263&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;264&lt;/span&gt; 
&lt;span&gt;265&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; Boolean getDefaultEnableZoneAffinity() {
&lt;/span&gt;&lt;span&gt;266&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_ENABLE_ZONE_AFFINITY;
&lt;/span&gt;&lt;span&gt;267&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;268&lt;/span&gt; 
&lt;span&gt;269&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; Boolean getDefaultEnableZoneExclusivity() {
&lt;/span&gt;&lt;span&gt;270&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_ENABLE_ZONE_EXCLUSIVITY;
&lt;/span&gt;&lt;span&gt;271&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;272&lt;/span&gt; 
&lt;span&gt;273&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; getDefaultPort() {
&lt;/span&gt;&lt;span&gt;274&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_PORT;
&lt;/span&gt;&lt;span&gt;275&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;276&lt;/span&gt; 
&lt;span&gt;277&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; Boolean getDefaultEnableLoadbalancer() {
&lt;/span&gt;&lt;span&gt;278&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_ENABLE_LOADBALANCER;
&lt;/span&gt;&lt;span&gt;279&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;280&lt;/span&gt; 
&lt;span&gt;281&lt;/span&gt; 
&lt;span&gt;282&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; Boolean getDefaultOkToRetryOnAllOperations() {
&lt;/span&gt;&lt;span&gt;283&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_OK_TO_RETRY_ON_ALL_OPERATIONS;
&lt;/span&gt;&lt;span&gt;284&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;285&lt;/span&gt; 
&lt;span&gt;286&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; Boolean getDefaultIsClientAuthRequired(){
&lt;/span&gt;&lt;span&gt;287&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; DEFAULT_IS_CLIENT_AUTH_REQUIRED;
&lt;/span&gt;&lt;span&gt;288&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;289&lt;/span&gt; 
&lt;span&gt;290&lt;/span&gt; 
&lt;span&gt;291&lt;/span&gt;     &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;292&lt;/span&gt; &lt;span&gt;     * Create instance with no properties in default name space {&lt;/span&gt;&lt;span&gt;@link&lt;/span&gt;&lt;span&gt; #DEFAULT_PROPERTY_NAME_SPACE}
&lt;/span&gt;&lt;span&gt;293&lt;/span&gt;      &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;294&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; DefaultClientConfigImpl() {
&lt;/span&gt;&lt;span&gt;295&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.dynamicProperties.clear();
&lt;/span&gt;&lt;span&gt;296&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.enableDynamicProperties = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;297&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;298&lt;/span&gt; 
&lt;span&gt;299&lt;/span&gt;     &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;300&lt;/span&gt; &lt;span&gt;     * Create instance with no properties in the specified name space
&lt;/span&gt;&lt;span&gt;301&lt;/span&gt;      &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;302&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; DefaultClientConfigImpl(String nameSpace) {
&lt;/span&gt;&lt;span&gt;303&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;&lt;span&gt;();
&lt;/span&gt;&lt;span&gt;304&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.propertyNameSpace =&lt;span&gt; nameSpace;
&lt;/span&gt;&lt;span&gt;305&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;306&lt;/span&gt; 
&lt;span&gt;307&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; loadDefaultValues() {
&lt;/span&gt;&lt;span&gt;308&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.MaxHttpConnectionsPerHost, getDefaultMaxHttpConnectionsPerHost());
&lt;/span&gt;&lt;span&gt;309&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.MaxTotalHttpConnections, getDefaultMaxTotalHttpConnections());
&lt;/span&gt;&lt;span&gt;310&lt;/span&gt; &lt;span&gt;        putDefaultBooleanProperty(CommonClientConfigKey.EnableConnectionPool, getDefaultEnableConnectionPool());
&lt;/span&gt;&lt;span&gt;311&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.MaxConnectionsPerHost, getDefaultMaxConnectionsPerHost());
&lt;/span&gt;&lt;span&gt;312&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.MaxTotalConnections, getDefaultMaxTotalConnections());
&lt;/span&gt;&lt;span&gt;313&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.ConnectTimeout, getDefaultConnectTimeout());
&lt;/span&gt;&lt;span&gt;314&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.ConnectionManagerTimeout, getDefaultConnectionManagerTimeout());
&lt;/span&gt;&lt;span&gt;315&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.ReadTimeout, getDefaultReadTimeout());
&lt;/span&gt;&lt;span&gt;316&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.MaxAutoRetries, getDefaultMaxAutoRetries());
&lt;/span&gt;&lt;span&gt;317&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.MaxAutoRetriesNextServer, getDefaultMaxAutoRetriesNextServer());
&lt;/span&gt;&lt;span&gt;318&lt;/span&gt; &lt;span&gt;        putDefaultBooleanProperty(CommonClientConfigKey.OkToRetryOnAllOperations, getDefaultOkToRetryOnAllOperations());
&lt;/span&gt;&lt;span&gt;319&lt;/span&gt; &lt;span&gt;        putDefaultBooleanProperty(CommonClientConfigKey.FollowRedirects, getDefaultFollowRedirects());
&lt;/span&gt;&lt;span&gt;320&lt;/span&gt; &lt;span&gt;        putDefaultBooleanProperty(CommonClientConfigKey.ConnectionPoolCleanerTaskEnabled, getDefaultConnectionPoolCleanerTaskEnabled());
&lt;/span&gt;&lt;span&gt;321&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.ConnIdleEvictTimeMilliSeconds, getDefaultConnectionidleTimeInMsecs());
&lt;/span&gt;&lt;span&gt;322&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.ConnectionCleanerRepeatInterval, getDefaultConnectionIdleTimertaskRepeatInMsecs());
&lt;/span&gt;&lt;span&gt;323&lt;/span&gt; &lt;span&gt;        putDefaultBooleanProperty(CommonClientConfigKey.EnableGZIPContentEncodingFilter, getDefaultEnableGzipContentEncodingFilter());
&lt;/span&gt;&lt;span&gt;324&lt;/span&gt;         String proxyHost =&lt;span&gt; ConfigurationManager.getConfigInstance().getString(getDefaultPropName(CommonClientConfigKey.ProxyHost.key()));
&lt;/span&gt;&lt;span&gt;325&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (proxyHost != &lt;span&gt;null&lt;/span&gt; &amp;amp;&amp;amp; proxyHost.length() &amp;gt; 0&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;326&lt;/span&gt; &lt;span&gt;            setProperty(CommonClientConfigKey.ProxyHost, proxyHost);
&lt;/span&gt;&lt;span&gt;327&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;328&lt;/span&gt;         Integer proxyPort =&lt;span&gt; ConfigurationManager
&lt;/span&gt;&lt;span&gt;329&lt;/span&gt; &lt;span&gt;                .getConfigInstance()
&lt;/span&gt;&lt;span&gt;330&lt;/span&gt; &lt;span&gt;                .getInteger(
&lt;/span&gt;&lt;span&gt;331&lt;/span&gt; &lt;span&gt;                        getDefaultPropName(CommonClientConfigKey.ProxyPort),
&lt;/span&gt;&lt;span&gt;332&lt;/span&gt;                         (Integer.MIN_VALUE + 1)); &lt;span&gt;//&lt;/span&gt;&lt;span&gt; + 1 just to avoid potential clash with user setting&lt;/span&gt;
&lt;span&gt;333&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (proxyPort != (Integer.MIN_VALUE + 1&lt;span&gt;)) {
&lt;/span&gt;&lt;span&gt;334&lt;/span&gt; &lt;span&gt;            setProperty(CommonClientConfigKey.ProxyPort, proxyPort);
&lt;/span&gt;&lt;span&gt;335&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;336&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.Port, getDefaultPort());
&lt;/span&gt;&lt;span&gt;337&lt;/span&gt; &lt;span&gt;        putDefaultBooleanProperty(CommonClientConfigKey.EnablePrimeConnections, getDefaultEnablePrimeConnections());
&lt;/span&gt;&lt;span&gt;338&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.MaxRetriesPerServerPrimeConnection, getDefaultMaxRetriesPerServerPrimeConnection());
&lt;/span&gt;&lt;span&gt;339&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.MaxTotalTimeToPrimeConnections, getDefaultMaxTotalTimeToPrimeConnections());
&lt;/span&gt;&lt;span&gt;340&lt;/span&gt; &lt;span&gt;        putDefaultStringProperty(CommonClientConfigKey.PrimeConnectionsURI, getDefaultPrimeConnectionsUri());
&lt;/span&gt;&lt;span&gt;341&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.PoolMinThreads, getDefaultPoolMinThreads());
&lt;/span&gt;&lt;span&gt;342&lt;/span&gt; &lt;span&gt;        putDefaultIntegerProperty(CommonClientConfigKey.PoolMaxThreads, getDefaultPoolMaxThreads());
&lt;/span&gt;&lt;span&gt;343&lt;/span&gt; &lt;span&gt;        putDefaultLongProperty(CommonClientConfigKey.PoolKeepAliveTime, getDefaultPoolKeepAliveTime());
&lt;/span&gt;&lt;span&gt;344&lt;/span&gt; &lt;span&gt;        putDefaultTimeUnitProperty(CommonClientConfigKey.PoolKeepAliveTimeUnits, getDefaultPoolKeepAliveTimeUnits());
&lt;/span&gt;&lt;span&gt;345&lt;/span&gt; &lt;span&gt;        putDefaultBooleanProperty(CommonClientConfigKey.EnableZoneAffinity, getDefaultEnableZoneAffinity());
&lt;/span&gt;&lt;span&gt;346&lt;/span&gt; &lt;span&gt;        putDefaultBooleanProperty(CommonClientConfigKey.EnableZoneExclusivity, getDefaultEnableZoneExclusivity());
&lt;/span&gt;&lt;span&gt;347&lt;/span&gt; &lt;span&gt;        putDefaultStringProperty(CommonClientConfigKey.ClientClassName, getDefaultClientClassname());
&lt;/span&gt;&lt;span&gt;348&lt;/span&gt; &lt;span&gt;        putDefaultStringProperty(CommonClientConfigKey.NFLoadBalancerClassName, getDefaultNfloadbalancerClassname());
&lt;/span&gt;&lt;span&gt;349&lt;/span&gt; &lt;span&gt;        putDefaultStringProperty(CommonClientConfigKey.NFLoadBalancerRuleClassName, getDefaultNfloadbalancerRuleClassname());
&lt;/span&gt;&lt;span&gt;350&lt;/span&gt; &lt;span&gt;        putDefaultStringProperty(CommonClientConfigKey.NFLoadBalancerPingClassName, getDefaultNfloadbalancerPingClassname());
&lt;/span&gt;&lt;span&gt;351&lt;/span&gt; &lt;span&gt;        putDefaultBooleanProperty(CommonClientConfigKey.PrioritizeVipAddressBasedServers, getDefaultPrioritizeVipAddressBasedServers());
&lt;/span&gt;&lt;span&gt;352&lt;/span&gt; &lt;span&gt;        putDefaultFloatProperty(CommonClientConfigKey.MinPrimeConnectionsRatio, getDefaultMinPrimeConnectionsRatio());
&lt;/span&gt;&lt;span&gt;353&lt;/span&gt; &lt;span&gt;        putDefaultStringProperty(CommonClientConfigKey.PrimeConnectionsClassName, getDefaultPrimeConnectionsClass());
&lt;/span&gt;&lt;span&gt;354&lt;/span&gt; &lt;span&gt;        putDefaultStringProperty(CommonClientConfigKey.NIWSServerListClassName, getDefaultSeverListClass());
&lt;/span&gt;&lt;span&gt;355&lt;/span&gt; &lt;span&gt;        putDefaultStringProperty(CommonClientConfigKey.VipAddressResolverClassName, getDefaultVipaddressResolverClassname());
&lt;/span&gt;&lt;span&gt;356&lt;/span&gt; &lt;span&gt;        putDefaultBooleanProperty(CommonClientConfigKey.IsClientAuthRequired, getDefaultIsClientAuthRequired());
&lt;/span&gt;&lt;span&gt;357&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; putDefaultStringProperty(CommonClientConfigKey.RequestIdHeaderName, getDefaultRequestIdHeaderName());&lt;/span&gt;
&lt;span&gt;358&lt;/span&gt; &lt;span&gt;        putDefaultBooleanProperty(CommonClientConfigKey.UseIPAddrForServer, getDefaultUseIpAddressForServer());
&lt;/span&gt;&lt;span&gt;359&lt;/span&gt;         putDefaultStringProperty(CommonClientConfigKey.ListOfServers, &quot;&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;360&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;361&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å®šåˆ¶é…ç½®ï¼Œä¾‹å¦‚é…ç½®è¶…æ—¶å’Œé‡è¯•ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;# å…¨å±€é…ç½®
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;ribbon:
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;  # å®¢æˆ·ç«¯è¯»å–è¶…æ—¶æ—¶é—´
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;   ReadTimeout: 3000
&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;  # å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶æ—¶é—´
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;   ConnectTimeout: 3000
&lt;span&gt; 7&lt;/span&gt;   # é»˜è®¤åªé‡è¯• GETï¼Œè®¾ç½®ä¸º &lt;span&gt;true&lt;/span&gt;&lt;span&gt; æ—¶å°†é‡è¯•æ‰€æœ‰ç±»å‹ï¼Œå¦‚ POSTã€PUTã€DELETE
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;   OkToRetryOnAllOperations: &lt;span&gt;false&lt;/span&gt;
&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;  # é‡è¯•æ¬¡æ•°
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;   MaxAutoRetries: 1
&lt;span&gt;11&lt;/span&gt; &lt;span&gt;  # æœ€å¤šé‡è¯•å‡ ä¸ªå®ä¾‹
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;   MaxAutoRetriesNextServer: 1
&lt;span&gt;13&lt;/span&gt; 
&lt;span&gt;14&lt;/span&gt; # åªé’ˆå¯¹ demo-&lt;span&gt;producer å®¢æˆ·ç«¯
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; demo-&lt;span&gt;producer:
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;  ribbon:
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt;    # å®¢æˆ·ç«¯è¯»å–è¶…æ—¶æ—¶é—´
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;     ReadTimeout: 5000
&lt;span&gt;19&lt;/span&gt; &lt;span&gt;    # å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶æ—¶é—´
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;     ConnectTimeout: 3000
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2ã€å‡è¡¡ç­–ç•¥ â€” IRule&lt;/h3&gt;
&lt;p&gt;IRule æ˜¯æœ€ç»ˆé€‰æ‹© Server çš„ç­–ç•¥è§„åˆ™ç±»ï¼Œæ ¸å¿ƒçš„æ¥å£å°±æ˜¯ chooseã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;interface&lt;/span&gt;&lt;span&gt; IRule{
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; é€‰æ‹© Server&lt;/span&gt;
&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; Server choose(Object key);
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; 
&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è®¾ç½® ILoadBalancer&lt;/span&gt;
&lt;span&gt; 7&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; setLoadBalancer(ILoadBalancer lb);
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; 
&lt;span&gt; 9&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å– ILoadBalancer&lt;/span&gt;
&lt;span&gt;10&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; ILoadBalancer getLoadBalancer();
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ribbon æä¾›äº†ä¸°å¯Œçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æŒ‡å®šä½¿ç”¨æŸä¸ªå‡è¡¡ç­–ç•¥ã€‚ä¸‹é¢æ˜¯æ•´ä¸ªRibbonæä¾›çš„ IRule å‡è¡¡ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201216141424713-1149639373.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201216141550724-1761844405.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h3&gt;3ã€æœåŠ¡æ£€æŸ¥ â€” IPing&lt;/h3&gt;
&lt;p&gt;IPing æ˜¯ç”¨äºå®šæœŸæ£€æŸ¥ Server çš„å¯ç”¨æ€§çš„ï¼Œå®ƒåªæä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œç”¨æ¥åˆ¤æ–­ Server æ˜¯å¦å­˜æ´»ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1 &lt;span&gt;public &lt;span&gt;interface&lt;span&gt; IPing {
&lt;span&gt;2     
&lt;span&gt;3     &lt;span&gt;public &lt;span&gt;boolean&lt;span&gt; isAlive(Server server);
&lt;span&gt;4 }&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;IPing ä¹Ÿæä¾›äº†å¤šç§ç­–ç•¥å¯é€‰ï¼Œä¸‹é¢æ˜¯æ•´ä¸ª IPing ä½“ç³»ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201216143650669-1089978409.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201216155204028-959715095.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h3&gt;4ã€è·å–æœåŠ¡åˆ—è¡¨ â€” ServerList&lt;/h3&gt;
&lt;p&gt;ServerList æä¾›äº†ä¸¤ä¸ªæ¥å£ï¼Œä¸€ä¸ªæ˜¯ç¬¬ä¸€æ¬¡è·å– Server åˆ—è¡¨ï¼Œä¸€ä¸ªæ˜¯æ›´æ–° Server åˆ—è¡¨ï¼Œå…¶ä¸­ getUpdatedListOfServers ä¼šæ¯è¢« Loadbalancer éš” 30 ç§’è°ƒä¸€æ¬¡æ¥æ›´æ–° allServerListã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1 &lt;span&gt;public &lt;span&gt;interface ServerList&amp;lt;T &lt;span&gt;extends Server&amp;gt;&lt;span&gt; {
&lt;span&gt; 2 
&lt;span&gt; 3     &lt;span&gt;public List&amp;lt;T&amp;gt;&lt;span&gt; getInitialListOfServers();
&lt;span&gt; 4     
&lt;span&gt; 5     &lt;span&gt;/**
&lt;span&gt; 6 &lt;span&gt;     * Return updated list of servers. This is called say every 30 secs
&lt;span&gt; 7 &lt;span&gt;     * (configurable) by the Loadbalancer's Ping cycle
&lt;span&gt; 8      &lt;span&gt;*/
&lt;span&gt; 9     &lt;span&gt;public List&amp;lt;T&amp;gt;&lt;span&gt; getUpdatedListOfServers();   
&lt;span&gt;10 }&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ServerList ä¹Ÿæä¾›äº†å¤šç§å®ç°ï¼ŒServerList ä½“ç³»ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201216153448922-1665417546.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201216155415765-1116927601.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h3&gt;5ã€è¿‡æ»¤æœåŠ¡ â€” ServerListFilter&lt;/h3&gt;
&lt;p&gt;ServerListFilter æä¾›äº†ä¸€ä¸ªæ¥å£ç”¨æ¥è¿‡æ»¤å‡ºå¯ç”¨çš„ Serverã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;interface&lt;/span&gt; ServerListFilter&amp;lt;T &lt;span&gt;extends&lt;/span&gt; Server&amp;gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt; 
&lt;span&gt;3&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; List&amp;lt;T&amp;gt; getFilteredListOfServers(List&amp;lt;T&amp;gt;&lt;span&gt; servers);
&lt;/span&gt;&lt;span&gt;4&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ServerListFilter ä½“ç³»ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201216155723158-899384324.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h3&gt;6ã€æœåŠ¡åˆ—è¡¨æ›´æ–° â€” ServerListUpdater&lt;/h3&gt;
&lt;p&gt;ServerListUpdater æœ‰å¤šä¸ªæ¥å£ï¼Œæœ€æ ¸å¿ƒçš„å°±æ˜¯ start å¼€å¯å®šæ—¶ä»»åŠ¡è°ƒç”¨ updateAction æ¥æ›´æ–° allServerListã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1 &lt;span&gt;public &lt;span&gt;interface&lt;span&gt; ServerListUpdater {
&lt;span&gt; 2 
&lt;span&gt; 3     &lt;span&gt;/**
&lt;span&gt; 4 &lt;span&gt;     * an interface for the updateAction that actually executes a server list update
&lt;span&gt; 5      &lt;span&gt;*/
&lt;span&gt; 6     &lt;span&gt;public &lt;span&gt;interface&lt;span&gt; UpdateAction {
&lt;span&gt; 7         &lt;span&gt;void&lt;span&gt; doUpdate();
&lt;span&gt; 8 &lt;span&gt;    }
&lt;span&gt; 9 
&lt;span&gt;10     &lt;span&gt;/**
&lt;span&gt;11 &lt;span&gt;     * start the serverList updater with the given update action
&lt;span&gt;12 &lt;span&gt;     * This call should be idempotent.
&lt;span&gt;13      &lt;span&gt;*/
&lt;span&gt;14     &lt;span&gt;void&lt;span&gt; start(UpdateAction updateAction);
&lt;span&gt;15 }&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é»˜è®¤æœ‰ä¸¤ä¸ªå®ç°ç±»ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201216160325559-919949316.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h3&gt;7ã€è´Ÿè½½å‡è¡¡å™¨ â€” ILoadBalancer&lt;/h3&gt;
&lt;p&gt;ILoadBalancer æ˜¯è´Ÿè½½å‡è¡¡é€‰æ‹©æœåŠ¡çš„æ ¸å¿ƒæ¥å£ï¼Œä¸»è¦æä¾›äº†å¦‚ä¸‹çš„è·å–Serveråˆ—è¡¨å’Œæ ¹æ®å®¢æˆ·ç«¯åç§°é€‰æ‹©Serverçš„æ¥å£ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1 &lt;span&gt;public &lt;span&gt;interface&lt;span&gt; ILoadBalancer {
&lt;span&gt; 2 
&lt;span&gt; 3     &lt;span&gt;//&lt;span&gt; æ·»åŠ Server
&lt;span&gt; 4     &lt;span&gt;public &lt;span&gt;void addServers(List&amp;lt;Server&amp;gt;&lt;span&gt; newServers);
&lt;span&gt; 5     
&lt;span&gt; 6     &lt;span&gt;//&lt;span&gt; æ ¹æ®keyé€‰æ‹©ä¸€ä¸ªServer
&lt;span&gt; 7     &lt;span&gt;public&lt;span&gt; Server chooseServer(Object key);
&lt;span&gt; 8     
&lt;span&gt; 9     &lt;span&gt;//&lt;span&gt; è·å–å­˜æ´»çš„Serveråˆ—è¡¨ï¼Œè¿”å› upServerList
&lt;span&gt;10     &lt;span&gt;public List&amp;lt;Server&amp;gt;&lt;span&gt; getReachableServers();
&lt;span&gt;11 
&lt;span&gt;12     &lt;span&gt;//&lt;span&gt; è·å–æ‰€æœ‰Serveråˆ—è¡¨ï¼Œè¿”å› allServerList
&lt;span&gt;13     &lt;span&gt;public List&amp;lt;Server&amp;gt;&lt;span&gt; getAllServers();
&lt;span&gt;14 }&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ILoadBalancer çš„ä½“ç³»ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201216160719383-1823772896.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;h3&gt;8ã€Ribbon ç›¸å…³é…ç½®ç±»&lt;/h3&gt;
&lt;p&gt;ä»å‰é¢ä¸€ç›´çœ‹ä¸‹æ¥ï¼Œå¯ä»¥å‘ç°æœ‰å¾ˆå¤šä¸ Ribbon ç›¸å…³çš„é…ç½®ç±»ï¼Œè¿™é‡Œæ€»ç»“ä¸‹ä¸ Ribbon ç›¸å…³çš„é…ç½®ç±»ï¼Œçœ‹æ¯ä¸ªé…ç½®ç±»çš„é…ç½®é¡ºåºï¼Œä»¥åŠéƒ½ä¸»è¦é…ç½®äº†å“ªäº›ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;p&gt;â‘  é¦–å…ˆæ˜¯Eurekaå®¢æˆ·ç«¯é…ç½®ç±» EurekaClientAutoConfigurationï¼Œè¿™ä¸ªè‡ªåŠ¨åŒ–é…ç½®ç±»ä¸»è¦é…ç½®äº† Ribbon æ‰€éœ€çš„ EurekaClientã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35.5&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_01cd9278-96c5-4bb1-88f1-5005f4d1eff3&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_01cd9278-96c5-4bb1-88f1-5005f4d1eff3&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_01cd9278-96c5-4bb1-88f1-5005f4d1eff3&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;66&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;@EnableConfigurationProperties
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; @ConditionalOnClass(EurekaClientConfig.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; @ConditionalOnProperty(value = &quot;eureka.client.enabled&quot;, matchIfMissing = &lt;span&gt;true&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;@ConditionalOnDiscoveryEnabled
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; @AutoConfigureBefore({ NoopDiscoveryClientAutoConfiguration.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;         CommonsClientAutoConfiguration.&lt;span&gt;class&lt;/span&gt;, ServiceRegistryAutoConfiguration.&lt;span&gt;class&lt;/span&gt;&lt;span&gt; })
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; @AutoConfigureAfter(name =&lt;span&gt; {
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;         &quot;org.springframework.cloud.netflix.eureka.config.DiscoveryClientOptionalArgsConfiguration&quot;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;         &quot;org.springframework.cloud.autoconfigure.RefreshAutoConfiguration&quot;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         &quot;org.springframework.cloud.netflix.eureka.EurekaDiscoveryClientConfiguration&quot;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;         &quot;org.springframework.cloud.client.serviceregistry.AutoServiceRegistrationAutoConfiguration&quot;&lt;span&gt; })
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; EurekaClientAutoConfiguration {
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ....&lt;/span&gt;
&lt;span&gt;15&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;â‘¡ æ¥ç€æ˜¯Ribbonè‡ªåŠ¨åŒ–é…ç½®ç±» RibbonAutoConfigurationï¼Œè¿™ä¸ªç±»ä¸»è¦é…ç½®äº†å¦‚ä¸‹ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;SpringClientFactoryï¼šç®¡ç† Ribbon å®¢æˆ·ç«¯ä¸Šä¸‹æ–‡ã€‚&lt;/li&gt;
&lt;li&gt;LoadBalancerClientï¼šè´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ï¼Œé»˜è®¤å®ç°ç±»ä¸º RibbonLoadBalancerClientï¼ˆå®é™…æ˜¯åœ¨ RibbonClientConfiguration ä¸­é…ç½®çš„ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;PropertiesFactoryï¼šç”¨äºåˆ¤æ–­é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦è‡ªå®šä¹‰äº†æ ¸å¿ƒæ¥å£çš„å®ç°ç±»ï¼Œå¦‚Â NFLoadBalancerClassNameã€NFLoadBalancerPingClassName ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;RibbonApplicationContextInitializerï¼šå¼€å¯é¥¥é¥¿é…ç½®çš„æ—¶å€™ï¼Œç”¨è¿™ä¸ªç±»æ¥åœ¨å¯åŠ¨æ—¶åˆå§‹åŒ– Ribbon å®¢æˆ·ç«¯ä¸Šä¸‹æ–‡ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34.5&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_30a3e041-598e-4ce9-b976-2229d15e075e&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_30a3e041-598e-4ce9-b976-2229d15e075e&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_30a3e041-598e-4ce9-b976-2229d15e075e&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;64&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;package&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon;
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;@Configuration
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; @Conditional(RibbonAutoConfiguration.RibbonClassesConditions.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;@RibbonClients
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åœ¨ EurekaClientAutoConfiguration ä¹‹åé…ç½®&lt;/span&gt;
&lt;span&gt; 7&lt;/span&gt; @AutoConfigureAfter(name = &quot;org.springframework.cloud.netflix.eureka.EurekaClientAutoConfiguration&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åœ¨ LoadBalancerAutoConfigurationã€AsyncLoadBalancerAutoConfiguration ä¹‹å‰é…ç½®&lt;/span&gt;
&lt;span&gt; 9&lt;/span&gt; @AutoConfigureBefore({ LoadBalancerAutoConfiguration.&lt;span&gt;class&lt;/span&gt;, AsyncLoadBalancerAutoConfiguration.&lt;span&gt;class&lt;/span&gt;&lt;span&gt; })
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; @EnableConfigurationProperties({ RibbonEagerLoadProperties.&lt;span&gt;class&lt;/span&gt;, ServerIntrospectorProperties.&lt;span&gt;class&lt;/span&gt;&lt;span&gt; })
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; RibbonAutoConfiguration {
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; 
&lt;span&gt;13&lt;/span&gt;     @Autowired(required = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; List&amp;lt;RibbonClientSpecification&amp;gt; configurations = &lt;span&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;&lt;span&gt;();
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; 
&lt;span&gt;16&lt;/span&gt; &lt;span&gt;    @Autowired
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt;&lt;span&gt; RibbonEagerLoadProperties ribbonEagerLoadProperties;
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt; 
&lt;span&gt;19&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; HasFeatures ribbonFeature() {
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; HasFeatures.namedFeature(&quot;Ribbon&quot;, Ribbon.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; 
&lt;span&gt;24&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; SpringClientFactory springClientFactory() {
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;         SpringClientFactory factory = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; SpringClientFactory();
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;         factory.setConfigurations(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.configurations);
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; factory;
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt; 
&lt;span&gt;32&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;     @ConditionalOnMissingBean(LoadBalancerClient.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; LoadBalancerClient loadBalancerClient() {
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RibbonLoadBalancerClient(springClientFactory());
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt; 
&lt;span&gt;38&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt;     @ConditionalOnClass(name = &quot;org.springframework.retry.support.RetryTemplate&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; LoadBalancedRetryFactory loadBalancedRetryPolicyFactory(&lt;span&gt;final&lt;/span&gt;&lt;span&gt; SpringClientFactory clientFactory) {
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RibbonLoadBalancedRetryFactory(clientFactory);
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt; 
&lt;span&gt;45&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; PropertiesFactory propertiesFactory() {
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; PropertiesFactory();
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt; 
&lt;span&gt;51&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt;     @ConditionalOnProperty(&quot;ribbon.eager-load.enabled&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RibbonApplicationContextInitializer ribbonApplicationContextInitializer() {
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RibbonApplicationContextInitializer(springClientFactory(), ribbonEagerLoadProperties.getClients());
&lt;/span&gt;&lt;span&gt;55&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;56&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;â‘¢ æ¥ç€æ˜¯è´Ÿè½½å‡è¡¡å™¨é…ç½®ç±» LoadBalancerAutoConfigurationï¼Œè¿™ä¸ªç±»ä¸»è¦æ˜¯åˆ›å»ºäº†è´Ÿè½½å‡è¡¡æ‹¦æˆªå™¨ LoadBalancerInterceptorï¼Œå¹¶æ·»åŠ åˆ° RestTemplae çš„æ‹¦æˆªå™¨ä¸­ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_b5e3c0b5-9134-4165-921c-487b7e84d49c&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_b5e3c0b5-9134-4165-921c-487b7e84d49c&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_b5e3c0b5-9134-4165-921c-487b7e84d49c&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;63&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;package&lt;/span&gt;&lt;span&gt; org.springframework.cloud.client.loadbalancer;
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; @ConditionalOnClass(RestTemplate.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; @ConditionalOnBean(LoadBalancerClient.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; @EnableConfigurationProperties(LoadBalancerRetryProperties.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; LoadBalancerAutoConfiguration {
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; 
&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;    @LoadBalanced
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;     @Autowired(required = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; List&amp;lt;RestTemplate&amp;gt; restTemplates =&lt;span&gt; Collections.emptyList();
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; 
&lt;span&gt;13&lt;/span&gt;     @Autowired(required = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; List&amp;lt;LoadBalancerRequestTransformer&amp;gt; transformers =&lt;span&gt; Collections.emptyList();
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; 
&lt;span&gt;16&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¯¹ RestTemplate å®šåˆ¶åŒ–&lt;/span&gt;
&lt;span&gt;17&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; SmartInitializingSingleton loadBalancedRestTemplateInitializerDeprecated(
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;             &lt;span&gt;final&lt;/span&gt; ObjectProvider&amp;lt;List&amp;lt;RestTemplateCustomizer&amp;gt;&amp;gt;&lt;span&gt; restTemplateCustomizers) {
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; () -&amp;gt; restTemplateCustomizers.ifAvailable(customizers -&amp;gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt;             &lt;span&gt;for&lt;/span&gt; (RestTemplate restTemplate : LoadBalancerAutoConfiguration.&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.restTemplates) {
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;                 &lt;span&gt;for&lt;/span&gt;&lt;span&gt; (RestTemplateCustomizer customizer : customizers) {
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; &lt;span&gt;                    customizer.customize(restTemplate);
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt; &lt;span&gt;        });
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; 
&lt;span&gt;29&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; LoadBalancerRequestFactory loadBalancerRequestFactory(LoadBalancerClient loadBalancerClient) {
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; LoadBalancerRequestFactory(loadBalancerClient, &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.transformers);
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt; 
&lt;span&gt;35&lt;/span&gt;     @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;     @ConditionalOnMissingClass(&quot;org.springframework.retry.support.RetryTemplate&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;     &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; LoadBalancerInterceptorConfig {
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt; 
&lt;span&gt;39&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆ›å»º RestTemplate æ‹¦æˆªå™¨&lt;/span&gt;
&lt;span&gt;40&lt;/span&gt; &lt;span&gt;        @Bean
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt;&lt;span&gt; LoadBalancerInterceptor ribbonInterceptor(LoadBalancerClient loadBalancerClient,
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt; &lt;span&gt;                                                         LoadBalancerRequestFactory requestFactory) {
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; LoadBalancerInterceptor(loadBalancerClient, requestFactory);
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt; 
&lt;span&gt;46&lt;/span&gt; &lt;span&gt;        @Bean
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt; &lt;span&gt;        @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt; RestTemplateCustomizer restTemplateCustomizer(&lt;span&gt;final&lt;/span&gt;&lt;span&gt; LoadBalancerInterceptor loadBalancerInterceptor) {
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; restTemplate -&amp;gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt;                 List&amp;lt;ClientHttpRequestInterceptor&amp;gt; list = &lt;span&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;&lt;span&gt;(
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt; &lt;span&gt;                        restTemplate.getInterceptors());
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt; &lt;span&gt;                list.add(loadBalancerInterceptor);
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt; &lt;span&gt;                restTemplate.setInterceptors(list);
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt; &lt;span&gt;            };
&lt;/span&gt;&lt;span&gt;55&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;56&lt;/span&gt; 
&lt;span&gt;57&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;58&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;â‘£ ä¹‹åæ˜¯é»˜è®¤çš„ Ribbon å®¢æˆ·ç«¯é…ç½®ç±» RibbonClientConfigurationï¼Œè¿™ä¸ªç±»ä¸»è¦é…ç½®äº† Ribbon æ ¸å¿ƒæ¥å£çš„é»˜è®¤å®ç°ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;IClientConfigï¼šRibbon å®¢æˆ·ç«¯é…ç½®ç±»ï¼Œé»˜è®¤å®ç°æ˜¯ DefaultClientConfigImplã€‚&lt;/li&gt;
&lt;li&gt;IRuleï¼šè´Ÿè½½å‡è¡¡ç­–ç•¥è§„åˆ™ç»„ä»¶ï¼Œé»˜è®¤å®ç°æ˜¯ ZoneAvoidanceRuleã€‚&lt;/li&gt;
&lt;li&gt;IPingï¼šåˆ¤æ–­ Server æ˜¯å¦å­˜æ´»ï¼Œé»˜è®¤å®ç°æ˜¯ DummyPingï¼Œæ°¸è¿œéƒ½æ˜¯è¿”å› trueã€‚&lt;/li&gt;
&lt;li&gt;ServerListï¼šè·å– Server çš„ç»„ä»¶ï¼Œé»˜è®¤å®ç°ç±»ä¸º ConfigurationBasedServerListï¼Œä»é…ç½®æ–‡ä»¶è·å–ã€‚&lt;/li&gt;
&lt;li&gt;ServerListUpdaterï¼šServer åˆ—è¡¨æ›´æ–°ç»„ä»¶ï¼Œé»˜è®¤å®ç°ç±»ä¸º PollingServerListUpdaterã€‚&lt;/li&gt;
&lt;li&gt;ServerListFilterï¼šè¿‡æ»¤å¯ç”¨çš„ Server åˆ—è¡¨ï¼Œé»˜è®¤å®ç°ç±»ä¸º ZonePreferenceServerListFilterã€‚&lt;/li&gt;
&lt;li&gt;RibbonLoadBalancerContextï¼šè´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;RetryHandlerï¼šé‡è¯•å¤„ç†å™¨ï¼Œé»˜è®¤å®ç°ç±»ä¸º DefaultLoadBalancerRetryHandlerã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;div class=&quot;cnblogs_code&quot; readability=&quot;50&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_c3c407f0-5d30-4ec3-85ad-3c7e12d24085&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_c3c407f0-5d30-4ec3-85ad-3c7e12d24085&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_c3c407f0-5d30-4ec3-85ad-3c7e12d24085&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;95&quot;&gt;
&lt;pre&gt;
&lt;span&gt;  1&lt;/span&gt; &lt;span&gt;package&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon;
&lt;/span&gt;&lt;span&gt;  2&lt;/span&gt; 
&lt;span&gt;  3&lt;/span&gt; @SuppressWarnings(&quot;deprecation&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;  4&lt;/span&gt; @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;  5&lt;/span&gt; &lt;span&gt;@EnableConfigurationProperties
&lt;/span&gt;&lt;span&gt;  6&lt;/span&gt; @Import({ HttpClientConfiguration.&lt;span&gt;class&lt;/span&gt;, OkHttpRibbonConfiguration.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;  7&lt;/span&gt;         RestClientRibbonConfiguration.&lt;span&gt;class&lt;/span&gt;, HttpClientRibbonConfiguration.&lt;span&gt;class&lt;/span&gt;&lt;span&gt; })
&lt;/span&gt;&lt;span&gt;  8&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; RibbonClientConfiguration {
&lt;/span&gt;&lt;span&gt;  9&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_CONNECT_TIMEOUT = 1000&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 10&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; DEFAULT_READ_TIMEOUT = 1000&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 11&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; DEFAULT_GZIP_PAYLOAD = &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 12&lt;/span&gt; 
&lt;span&gt; 13&lt;/span&gt; &lt;span&gt;    @RibbonClientName
&lt;/span&gt;&lt;span&gt; 14&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; String name = &quot;client&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 15&lt;/span&gt; 
&lt;span&gt; 16&lt;/span&gt; &lt;span&gt;    @Autowired
&lt;/span&gt;&lt;span&gt; 17&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt;&lt;span&gt; PropertiesFactory propertiesFactory;
&lt;/span&gt;&lt;span&gt; 18&lt;/span&gt; 
&lt;span&gt; 19&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt; 20&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt; 21&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; IClientConfig ribbonClientConfig() {
&lt;/span&gt;&lt;span&gt; 22&lt;/span&gt;         DefaultClientConfigImpl config = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; DefaultClientConfigImpl();
&lt;/span&gt;&lt;span&gt; 23&lt;/span&gt;         config.loadProperties(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.name);
&lt;/span&gt;&lt;span&gt; 24&lt;/span&gt; &lt;span&gt;        config.set(CommonClientConfigKey.ConnectTimeout, DEFAULT_CONNECT_TIMEOUT);
&lt;/span&gt;&lt;span&gt; 25&lt;/span&gt; &lt;span&gt;        config.set(CommonClientConfigKey.ReadTimeout, DEFAULT_READ_TIMEOUT);
&lt;/span&gt;&lt;span&gt; 26&lt;/span&gt; &lt;span&gt;        config.set(CommonClientConfigKey.GZipPayload, DEFAULT_GZIP_PAYLOAD);
&lt;/span&gt;&lt;span&gt; 27&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; config;
&lt;/span&gt;&lt;span&gt; 28&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 29&lt;/span&gt; 
&lt;span&gt; 30&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt; 31&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt; 32&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; IRule ribbonRule(IClientConfig config) {
&lt;/span&gt;&lt;span&gt; 33&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;this&lt;/span&gt;.propertiesFactory.isSet(IRule.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, name)) {
&lt;/span&gt;&lt;span&gt; 34&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.propertiesFactory.get(IRule.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, config, name);
&lt;/span&gt;&lt;span&gt; 35&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 36&lt;/span&gt;         ZoneAvoidanceRule rule = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ZoneAvoidanceRule();
&lt;/span&gt;&lt;span&gt; 37&lt;/span&gt; &lt;span&gt;        rule.initWithNiwsConfig(config);
&lt;/span&gt;&lt;span&gt; 38&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; rule;
&lt;/span&gt;&lt;span&gt; 39&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 40&lt;/span&gt; 
&lt;span&gt; 41&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt; 42&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt; 43&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; IPing ribbonPing(IClientConfig config) {
&lt;/span&gt;&lt;span&gt; 44&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;this&lt;/span&gt;.propertiesFactory.isSet(IPing.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, name)) {
&lt;/span&gt;&lt;span&gt; 45&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.propertiesFactory.get(IPing.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, config, name);
&lt;/span&gt;&lt;span&gt; 46&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 47&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; DummyPing();
&lt;/span&gt;&lt;span&gt; 48&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 49&lt;/span&gt; 
&lt;span&gt; 50&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt; 51&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt; 52&lt;/span&gt;     @SuppressWarnings(&quot;unchecked&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 53&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; ServerList&amp;lt;Server&amp;gt;&lt;span&gt; ribbonServerList(IClientConfig config) {
&lt;/span&gt;&lt;span&gt; 54&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;this&lt;/span&gt;.propertiesFactory.isSet(ServerList.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, name)) {
&lt;/span&gt;&lt;span&gt; 55&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.propertiesFactory.get(ServerList.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, config, name);
&lt;/span&gt;&lt;span&gt; 56&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 57&lt;/span&gt;         ConfigurationBasedServerList serverList = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ConfigurationBasedServerList();
&lt;/span&gt;&lt;span&gt; 58&lt;/span&gt; &lt;span&gt;        serverList.initWithNiwsConfig(config);
&lt;/span&gt;&lt;span&gt; 59&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; serverList;
&lt;/span&gt;&lt;span&gt; 60&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 61&lt;/span&gt; 
&lt;span&gt; 62&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt; 63&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt; 64&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; ServerListUpdater ribbonServerListUpdater(IClientConfig config) {
&lt;/span&gt;&lt;span&gt; 65&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; PollingServerListUpdater(config);
&lt;/span&gt;&lt;span&gt; 66&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 67&lt;/span&gt; 
&lt;span&gt; 68&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt; 69&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt; 70&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; ILoadBalancer ribbonLoadBalancer(IClientConfig config,
&lt;/span&gt;&lt;span&gt; 71&lt;/span&gt;             ServerList&amp;lt;Server&amp;gt; serverList, ServerListFilter&amp;lt;Server&amp;gt;&lt;span&gt; serverListFilter,
&lt;/span&gt;&lt;span&gt; 72&lt;/span&gt; &lt;span&gt;            IRule rule, IPing ping, ServerListUpdater serverListUpdater) {
&lt;/span&gt;&lt;span&gt; 73&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;this&lt;/span&gt;.propertiesFactory.isSet(ILoadBalancer.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, name)) {
&lt;/span&gt;&lt;span&gt; 74&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.propertiesFactory.get(ILoadBalancer.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, config, name);
&lt;/span&gt;&lt;span&gt; 75&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 76&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; ZoneAwareLoadBalancer&amp;lt;&amp;gt;&lt;span&gt;(config, rule, ping, serverList,
&lt;/span&gt;&lt;span&gt; 77&lt;/span&gt; &lt;span&gt;                serverListFilter, serverListUpdater);
&lt;/span&gt;&lt;span&gt; 78&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 79&lt;/span&gt; 
&lt;span&gt; 80&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt; 81&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt; 82&lt;/span&gt;     @SuppressWarnings(&quot;unchecked&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 83&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; ServerListFilter&amp;lt;Server&amp;gt;&lt;span&gt; ribbonServerListFilter(IClientConfig config) {
&lt;/span&gt;&lt;span&gt; 84&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;this&lt;/span&gt;.propertiesFactory.isSet(ServerListFilter.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, name)) {
&lt;/span&gt;&lt;span&gt; 85&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.propertiesFactory.get(ServerListFilter.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, config, name);
&lt;/span&gt;&lt;span&gt; 86&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt; 87&lt;/span&gt;         ZonePreferenceServerListFilter filter = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ZonePreferenceServerListFilter();
&lt;/span&gt;&lt;span&gt; 88&lt;/span&gt; &lt;span&gt;        filter.initWithNiwsConfig(config);
&lt;/span&gt;&lt;span&gt; 89&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; filter;
&lt;/span&gt;&lt;span&gt; 90&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 91&lt;/span&gt; 
&lt;span&gt; 92&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt; 93&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt; 94&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RibbonLoadBalancerContext ribbonLoadBalancerContext(ILoadBalancer loadBalancer,
&lt;/span&gt;&lt;span&gt; 95&lt;/span&gt; &lt;span&gt;            IClientConfig config, RetryHandler retryHandler) {
&lt;/span&gt;&lt;span&gt; 96&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RibbonLoadBalancerContext(loadBalancer, config, retryHandler);
&lt;/span&gt;&lt;span&gt; 97&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 98&lt;/span&gt; 
&lt;span&gt; 99&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;100&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt;101&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RetryHandler retryHandler(IClientConfig config) {
&lt;/span&gt;&lt;span&gt;102&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; DefaultLoadBalancerRetryHandler(config);
&lt;/span&gt;&lt;span&gt;103&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;104&lt;/span&gt; 
&lt;span&gt;105&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;106&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt;107&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; ServerIntrospector serverIntrospector() {
&lt;/span&gt;&lt;span&gt;108&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; DefaultServerIntrospector();
&lt;/span&gt;&lt;span&gt;109&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;110&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;â‘¤ Ribbon Eureka è‡ªåŠ¨åŒ–é…ç½®ç±» RibbonEurekaAutoConfigurationï¼Œåˆ¤æ–­æ˜¯å¦å¯ç”¨ Ribbon Eurekaï¼Œå¹¶è§¦å‘ EurekaRibbonClientConfiguration é…ç½®ç±»ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32.5&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_c2c17ad6-b7fc-4b08-80b7-caa6a40b6df3&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_c2c17ad6-b7fc-4b08-80b7-caa6a40b6df3&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_c2c17ad6-b7fc-4b08-80b7-caa6a40b6df3&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;60&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;package&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.eureka;
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;@EnableConfigurationProperties
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;@ConditionalOnRibbonAndEurekaEnabled
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; @AutoConfigureAfter(RibbonAutoConfiguration.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; @RibbonClients(defaultConfiguration = EurekaRibbonClientConfiguration.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; RibbonEurekaAutoConfiguration {
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; 
&lt;span&gt;10&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;â‘¥ é»˜è®¤å¯ç”¨ Ribbon Eureka çš„æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ Ribbon Eureka å®¢æˆ·ç«¯é…ç½®ç±» EurekaRibbonClientConfigurationï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;IPingï¼šæ›¿æ¢äº†é»˜è®¤å®ç°ç±» DummyPingï¼Œæ”¹ä¸º NIWSDiscoveryPingï¼Œé€šè¿‡åˆ¤æ–­ InstanceInfo çš„çŠ¶æ€æ˜¯å¦ä¸º UP æ¥åˆ¤æ–­ Server æ˜¯å¦å­˜æ´»ã€‚&lt;/li&gt;
&lt;li&gt;ServerListï¼šæ›¿æ¢äº†é»˜è®¤çš„å®ç°ç±» ConfigurationBasedServerListï¼Œæ”¹ä¸º DomainExtractingServerListï¼Œå®é™…æ˜¯ DiscoveryEnabledNIWSServerListï¼Œä» EurekaClient è·å– Server åˆ—è¡¨ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_90bf4e3f-4946-48b7-8296-6690ad6a4679&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_90bf4e3f-4946-48b7-8296-6690ad6a4679&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_90bf4e3f-4946-48b7-8296-6690ad6a4679&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;73&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;package&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.eureka;
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; EurekaRibbonClientConfiguration {
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; 
&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Log log = LogFactory.getLog(EurekaRibbonClientConfiguration.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; 
&lt;span&gt; 8&lt;/span&gt;     @Value(&quot;${ribbon.eureka.approximateZoneFromHostname:false}&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; approximateZoneFromHostname = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;    @RibbonClientName
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; String serviceId = &quot;client&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;     @Autowired(required = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt;&lt;span&gt; EurekaClientConfig clientConfig;
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;     @Autowired(required = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt;&lt;span&gt; EurekaInstanceConfig eurekaConfig;
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;    @Autowired
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt;&lt;span&gt; PropertiesFactory propertiesFactory;
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt; 
&lt;span&gt;19&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; EurekaRibbonClientConfiguration() {
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; 
&lt;span&gt;22&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; EurekaRibbonClientConfiguration(EurekaClientConfig clientConfig,
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; &lt;span&gt;            String serviceId, EurekaInstanceConfig eurekaConfig,
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt;             &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; approximateZoneFromHostname) {
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.clientConfig =&lt;span&gt; clientConfig;
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.serviceId =&lt;span&gt; serviceId;
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.eurekaConfig =&lt;span&gt; eurekaConfig;
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.approximateZoneFromHostname =&lt;span&gt; approximateZoneFromHostname;
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; 
&lt;span&gt;31&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; IPing ribbonPing(IClientConfig config) {
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;this&lt;/span&gt;.propertiesFactory.isSet(IPing.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, serviceId)) {
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.propertiesFactory.get(IPing.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, config, serviceId);
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;         NIWSDiscoveryPing ping = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; NIWSDiscoveryPing();
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt; &lt;span&gt;        ping.initWithNiwsConfig(config);
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; ping;
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt; 
&lt;span&gt;42&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; ServerList&amp;lt;?&amp;gt; ribbonServerList(IClientConfig config, Provider&amp;lt;EurekaClient&amp;gt;&lt;span&gt; eurekaClientProvider) {
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;this&lt;/span&gt;.propertiesFactory.isSet(ServerList.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, serviceId)) {
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;.propertiesFactory.get(ServerList.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, config, serviceId);
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;         DiscoveryEnabledNIWSServerList discoveryServerList = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; DiscoveryEnabledNIWSServerList(
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt; &lt;span&gt;                config, eurekaClientProvider);
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt;         DomainExtractingServerList serverList = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; DomainExtractingServerList(
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt;                 discoveryServerList, config, &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.approximateZoneFromHostname);
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; serverList;
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;â‘¦ å„ä¸ªé…ç½®ç±»æ‰€å±æ¨¡å—&lt;/p&gt;
&lt;p&gt;spring-cloud-netflix-eureka-clientï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;org.springframework.cloud.netflix.eureka.EurekaClientAutoConfiguration&lt;/li&gt;
&lt;li&gt;org.springframework.cloud.netflix.ribbon.eureka.RibbonEurekaAutoConfiguration&lt;/li&gt;
&lt;li&gt;org.springframework.cloud.netflix.ribbon.eureka.EurekaRibbonClientConfiguration&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;spring-cloud-netflix-ribbonï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;org.springframework.cloud.netflix.ribbon.RibbonAutoConfiguration&lt;/li&gt;
&lt;li&gt;org.springframework.cloud.netflix.ribbon.RibbonClientConfiguration&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;spring-cloud-commonsï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;org.springframework.cloud.client.loadbalancer.LoadBalancerAutoConfiguration&lt;/li&gt;
&lt;/ul&gt;&lt;h2&gt;å…­ã€Ribbon HTTPå®¢æˆ·ç«¯ç»„ä»¶&lt;/h2&gt;
&lt;h3&gt;1ã€Java HTTP ç»„ä»¶åº“&lt;/h3&gt;
&lt;p&gt;â‘  HTTP ç»„ä»¶åº“&lt;/p&gt;
&lt;p&gt;é¦–å…ˆç®€å•äº†è§£ä¸‹å¸¸ç”¨çš„ Java HTTP ç»„ä»¶åº“ï¼ŒRibbon ä¸­é€šè¿‡ä¸åŒçš„é…ç½®ä¾¿å¯ä»¥å¯ç”¨æŸä¸ª HTTP ç»„ä»¶æ¥è¿›è¡ŒæœåŠ¡é—´çš„é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;Java ä¸­çš„ HTTP ç»„ä»¶åº“ï¼Œå¤§ä½“å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;JDK è‡ªå¸¦çš„æ ‡å‡†åº“ HttpURLConnection&lt;/li&gt;
&lt;li&gt;Apache HttpComponents HttpClient&lt;/li&gt;
&lt;li&gt;OkHttp&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;HttpURLConnection å‘èµ· HTTP è¯·æ±‚æœ€å¤§çš„ä¼˜ç‚¹æ˜¯ä¸éœ€è¦å¼•å…¥é¢å¤–çš„ä¾èµ–ï¼Œä½†æ˜¯ HttpURLConnection å°è£…å±‚æ¬¡å¤ªä½ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç¹çã€‚æ”¯æŒçš„ç‰¹æ€§å¤ªå°‘ï¼Œç¼ºä¹è¿æ¥æ± ç®¡ç†ã€åŸŸåæœºæ¢°æ§åˆ¶ï¼Œæ— æ³•æ”¯æŒ HTTP/2ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;Apache HttpComponents HttpClient å’Œ OkHttp éƒ½æ”¯æŒè¿æ¥æ± ç®¡ç†ã€è¶…æ—¶ã€ç©ºé—²è¿æ¥æ•°æ§åˆ¶ç­‰ç‰¹æ€§ã€‚OkHttp æ¥å£è®¾è®¡æ›´å‹å¥½ï¼Œä¸”æ”¯æŒ HTTP/2ï¼ŒAndroid å¼€å‘ä¸­ç”¨å¾—æ›´å¤šã€‚&lt;/p&gt;
&lt;p&gt;â‘¡ è¶…æ—¶é‡è¯•é…ç½®&lt;/p&gt;
&lt;p&gt;å…ˆç»™ demo-consumer ä¸­æ·»åŠ å¦‚ä¸‹é»˜è®¤é…ç½®ï¼Œå³è¯»å–ã€è¿æ¥è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 1 ç§’ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤å€¼ã€‚ç„¶åé‡è¯•æ¬¡æ•°ä¸º1ï¼Œé‡è¯•ä¸€ä¸ªServerã€‚åé¢åŸºäºè¿™äº›é…ç½®æ¥éªŒè¯Ribbon HTTPå®¢æˆ·ç«¯çš„è¶…æ—¶å’Œé‡è¯•ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;ribbon:
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;  # å®¢æˆ·ç«¯è¯»å–è¶…æ—¶æ—¶é—´
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;   ReadTimeout: 1000
&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;  # å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶æ—¶é—´
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;   ConnectTimeout: 1000
&lt;span&gt; 6&lt;/span&gt;   # é»˜è®¤åªé‡è¯• GETï¼Œè®¾ç½®ä¸º &lt;span&gt;true&lt;/span&gt;&lt;span&gt; æ—¶å°†é‡è¯•æ‰€æœ‰ç±»å‹ï¼Œå¦‚ POSTã€PUTã€DELETE
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;   OkToRetryOnAllOperations: &lt;span&gt;false&lt;/span&gt;
&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;  # é‡è¯•æ¬¡æ•°
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;   MaxAutoRetries: 1
&lt;span&gt;10&lt;/span&gt; &lt;span&gt;  # æœ€å¤šé‡è¯•å‡ ä¸ªå®ä¾‹
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;   MaxAutoRetriesNextServer: 1
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç„¶å demo-producer çš„æ¥å£ä¼‘çœ 3ç§’ï¼Œé€ æˆç½‘ç»œå»¶è¿Ÿçš„ç°è±¡ï¼Œå¹¶ä¸” demo-producer å¯ä¸¤ä¸ªå®ä¾‹ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; @GetMapping(&quot;/v1/uuid&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; ResponseEntity&amp;lt;String&amp;gt; getUUID() &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; InterruptedException {
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;     String uuid =&lt;span&gt; UUID.randomUUID().toString();
&lt;/span&gt;&lt;span&gt;4&lt;/span&gt;     logger.info(&quot;generate uuid: {}&quot;&lt;span&gt;, uuid);
&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;     Thread.sleep(3000&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;6&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; ResponseEntity.ok(uuid);
&lt;/span&gt;&lt;span&gt;7&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2ã€Ribbon é»˜è®¤ä½¿ç”¨ HttpURLConnection&lt;/h3&gt;
&lt;p&gt;â‘  Ribbon é»˜è®¤çš„ HTTP ç»„ä»¶&lt;/p&gt;
&lt;p&gt;åœ¨ä¸æ·»åŠ å…¶å®ƒé…ç½®çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ Ribbon é»˜è®¤ä½¿ç”¨çš„ HTTP ç»„ä»¶æ˜¯ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆé€šè¿‡ä¹‹å‰çš„åˆ†æå¯ä»¥çŸ¥é“ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒLoadBalancerAutoConfiguration é…ç½®ç±»ä¼šå‘ RestTemplate æ·»åŠ  LoadBalancerInterceptor æ‹¦æˆªå™¨ã€‚ç„¶ååœ¨ RestTemplate è°ƒç”¨æ—¶ï¼Œå³åœ¨ doExecute æ–¹æ³•ä¸­ï¼Œåˆ›å»º ClientHttpRequest æ—¶ï¼Œå› ä¸ºé…ç½®äº†æ‹¦æˆªå™¨ï¼Œæ‰€ä»¥ ClientHttpRequestFactory å°±æ˜¯ InterceptingClientHttpRequestFactoryï¼Œè€Œä¸”åˆ›å»º InterceptingClientHttpRequestFactory ä¼ å…¥çš„ ClientHttpRequestFactory é»˜è®¤æ˜¯çˆ¶ç±»çš„ SimpleClientHttpRequestFactoryã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_fbee5c7e-a5d4-44ce-ab7d-70c1a2fac850&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_fbee5c7e-a5d4-44ce-ab7d-70c1a2fac850&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_fbee5c7e-a5d4-44ce-ab7d-70c1a2fac850&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;69&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;protected&lt;/span&gt; &amp;lt;T&amp;gt;&lt;span&gt; T doExecute(URI url, @Nullable HttpMethod method, @Nullable RequestCallback requestCallback,
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;         @Nullable ResponseExtractor&amp;lt;T&amp;gt; responseExtractor) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; RestClientException {
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;...&lt;/span&gt;
&lt;span&gt; 4&lt;/span&gt;     ClientHttpResponse response = &lt;span&gt;null&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;     &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆ›å»º ClientHttpRequest&lt;/span&gt;
&lt;span&gt; 7&lt;/span&gt;         ClientHttpRequest request =&lt;span&gt; createRequest(url, method);
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (requestCallback != &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;            requestCallback.doWithRequest(request);
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ClientHttpRequest å‘èµ·è¯·æ±‚&lt;/span&gt;
&lt;span&gt;12&lt;/span&gt;         response =&lt;span&gt; request.execute();
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; &lt;span&gt;        handleResponse(url, method, response);
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; (responseExtractor != &lt;span&gt;null&lt;/span&gt; ? responseExtractor.extractData(response) : &lt;span&gt;null&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;     &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (IOException ex) {
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ...&lt;/span&gt;
&lt;span&gt;18&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;     &lt;span&gt;finally&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (response != &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; &lt;span&gt;            response.close();
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; 
&lt;span&gt;26&lt;/span&gt; &lt;span&gt;protected&lt;/span&gt; ClientHttpRequest createRequest(URI url, HttpMethod method) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; IOException {
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; getRequestFactory è·å– ClientHttpRequestFactory&lt;/span&gt;
&lt;span&gt;28&lt;/span&gt;     ClientHttpRequest request =&lt;span&gt; getRequestFactory().createRequest(url, method);
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt; &lt;span&gt;    initialize(request);
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt;&lt;span&gt; (logger.isDebugEnabled()) {
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;         logger.debug(&quot;HTTP &quot; + method.name() + &quot; &quot; +&lt;span&gt; url);
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; request;
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt; 
&lt;span&gt;36&lt;/span&gt; &lt;span&gt;public&lt;/span&gt;&lt;span&gt; ClientHttpRequestFactory getRequestFactory() {
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;     List&amp;lt;ClientHttpRequestInterceptor&amp;gt; interceptors =&lt;span&gt; getInterceptors();
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!&lt;span&gt;CollectionUtils.isEmpty(interceptors)) {
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt;         ClientHttpRequestFactory factory = &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.interceptingRequestFactory;
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (factory == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; æœ‰æ‹¦æˆªå™¨çš„æƒ…å†µï¼Œsuper.getRequestFactory() é»˜è®¤è¿”å›çš„æ˜¯ SimpleClientHttpRequestFactory&lt;/span&gt;
&lt;span&gt;42&lt;/span&gt;             factory = &lt;span&gt;new&lt;/span&gt; InterceptingClientHttpRequestFactory(&lt;span&gt;super&lt;/span&gt;&lt;span&gt;.getRequestFactory(), interceptors);
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt;             &lt;span&gt;this&lt;/span&gt;.interceptingRequestFactory =&lt;span&gt; factory;
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; factory;
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt;     &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ— æ‹¦æˆªå™¨çš„æƒ…å†µ&lt;/span&gt;
&lt;span&gt;49&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;super&lt;/span&gt;&lt;span&gt;.getRequestFactory();
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;InterceptingClientHttpRequestFactory è¿™ä¸ªå·¥å‚ç±»åˆ›å»ºçš„ ClientHttpRequest ç±»å‹æ˜¯ InterceptingClientHttpRequestã€‚æœ€ç»ˆ RestTemplate çš„ doExecute æ–¹æ³•ä¸­è°ƒç”¨ ClientHttpRequest çš„ execute æ–¹æ³•æ—¶ï¼Œå°±è°ƒç”¨åˆ°äº† InterceptingClientHttpRequest ä¸­çš„å†…éƒ¨ç±» InterceptingRequestExecution ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ InterceptingRequestExecution çš„ execute æ–¹æ³•ä¸­ï¼Œé¦–å…ˆæ˜¯éå†æ‰€æœ‰æ‹¦æˆªå™¨å¯¹ RestTemplate å®šåˆ¶åŒ–ï¼Œæœ€ååˆ™é€šè¿‡ requestFactory åˆ›å»º ClientHttpRequest æ¥å‘èµ·æœ€ç»ˆçš„ HTTP è°ƒç”¨ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œæ— è®ºæœ‰æ²¡æœ‰æ‹¦æˆªå™¨ï¼Œå…¶å®æœ€ç»ˆéƒ½ä¼šä½¿ç”¨ requestFactory æ¥åˆ›å»º ClientHttpRequestã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;private&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; InterceptingRequestExecution &lt;span&gt;implements&lt;/span&gt;&lt;span&gt; ClientHttpRequestExecution {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Iterator&amp;lt;ClientHttpRequestInterceptor&amp;gt;&lt;span&gt; iterator;
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; 
&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; ClientHttpResponse execute(HttpRequest request, &lt;span&gt;byte&lt;/span&gt;[] body) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; IOException {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.iterator.hasNext()) {
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ‹¦æˆªå™¨å®šåˆ¶åŒ– RestTemplate&lt;/span&gt;
&lt;span&gt; 8&lt;/span&gt;             ClientHttpRequestInterceptor nextInterceptor = &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.iterator.next();
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; nextInterceptor.intercept(request, body, &lt;span&gt;this&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;             HttpMethod method =&lt;span&gt; request.getMethod();
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; delegate =&amp;gt; SimpleBufferingClientHttpRequest&lt;/span&gt;
&lt;span&gt;14&lt;/span&gt;             ClientHttpRequest delegate =&lt;span&gt; requestFactory.createRequest(request.getURI(), method);
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt;...&lt;/span&gt;
&lt;span&gt;16&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt;&lt;span&gt; delegate.execute();
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™é‡Œçš„ requestFactory å°±æ˜¯å‰é¢ä¼ è¿›æ¥çš„ SimpleClientHttpRequestFactoryï¼Œä»å®ƒçš„ createRequest æ–¹æ³•å¯ä»¥çœ‹å‡ºï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå°±æ˜¯ç”¨çš„ JDK æ ‡å‡† HTTP åº“ç»„ä»¶ HttpURLConnection æ¥è¿›è¡ŒæœåŠ¡é—´çš„è¯·æ±‚é€šä¿¡ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; ClientHttpRequest createRequest(URI uri, HttpMethod httpMethod) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; IOException {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; JDK æ ‡å‡†HTTPåº“ HttpURLConnection&lt;/span&gt;
&lt;span&gt; 3&lt;/span&gt;     HttpURLConnection connection = openConnection(uri.toURL(), &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.proxy);
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;    prepareConnection(connection, httpMethod.name());
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; 
&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.bufferRequestBody) {
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; SimpleBufferingClientHttpRequest(connection, &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.outputStreaming);
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;     &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; SimpleStreamingClientHttpRequest(connection, &lt;span&gt;this&lt;/span&gt;.chunkSize, &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.outputStreaming);
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ€»ç»“ï¼š&lt;/p&gt;
&lt;p&gt;ä»å‰é¢çš„æºç åˆ†æå¯ä»¥çœ‹å‡ºï¼ŒRibbon é»˜è®¤çš„ HTTP å®¢æˆ·ç«¯æ˜¯ HttpURLConnectionã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å‰é¢é»˜è®¤çš„è¶…æ—¶é…ç½®ä¸‹ï¼Œå¯ä»¥éªŒè¯å‡ºè¶…æ—¶é…ç½®å¹¶æœªç”Ÿæ•ˆï¼Œä¸€ç›´é˜»å¡3ç§’åæ‰è¿”å›äº†ç»“æœï¼Œè¯´æ˜ Ribbon é»˜è®¤æƒ…å†µä¸‹å°±ä¸æ”¯æŒè¶…æ—¶é‡è¯•ã€‚&lt;/p&gt;
&lt;p&gt;è€Œä¸” HttpURLConnection æ¯æ¬¡éƒ½æ˜¯æ–°åˆ›å»ºçš„ï¼Œè¯·æ±‚è¿”å›æ¥ä¹‹åå°±å…³é—­è¿æ¥ï¼Œæ²¡æœ‰è¿æ¥æ± ç®¡ç†æœºåˆ¶ï¼Œç½‘ç»œè¿æ¥çš„å»ºç«‹å’Œå…³é—­æœ¬èº«å°±ä¼šæŸè€—ä¸€å®šçš„æ€§èƒ½ï¼Œæ‰€ä»¥æ­£å¼ç¯å¢ƒä¸‹ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨é»˜è®¤çš„é…ç½®ã€‚&lt;/p&gt;
&lt;p&gt;â‘¡ HttpClient é…ç½®ç±»&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œæˆ‘ä»¬ä» RibbonClientConfiguration é…ç½®ç±»çš„å®šä¹‰å¯ä»¥çœ‹åˆ°ï¼Œå…¶å¯¼å…¥äº† HttpClientConfigurationã€OkHttpRibbonConfigurationã€RestClientRibbonConfigurationã€HttpClientRibbonConfiguration å››ä¸ª HttpClient çš„é…ç½®ç±»ï¼Œé€šè¿‡æ³¨é‡Šä¹Ÿå¯ä»¥äº†è§£åˆ°ï¼Œæœ€åä¸€ä¸ªæ˜¯é»˜è®¤é…ç½®ç±»ï¼Œå‰é¢ä¸‰ä¸ªåœ¨æŸäº›é…ç½®å¯ç”¨çš„æƒ…å†µä¸‹æ‰ä¼šç”Ÿæ•ˆã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt; &lt;span&gt;@EnableConfigurationProperties
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; Order is important here, last should be the default, first should be optional&lt;/span&gt;
&lt;span&gt;4&lt;/span&gt; @Import({ HttpClientConfiguration.&lt;span&gt;class&lt;/span&gt;, OkHttpRibbonConfiguration.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;,
&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;         RestClientRibbonConfiguration.&lt;span&gt;class&lt;/span&gt;, HttpClientRibbonConfiguration.&lt;span&gt;class&lt;/span&gt;&lt;span&gt; })
&lt;/span&gt;&lt;span&gt;6&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; RibbonClientConfiguration {
&lt;/span&gt;&lt;span&gt;7&lt;/span&gt; 
&lt;span&gt;8&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿›å…¥ HttpClientRibbonConfigurationï¼Œè¿™ä¸ªé…ç½®ç±»åœ¨ ribbon.httpclient.enabled=true æ—¶æ‰ç”Ÿæ•ˆï¼Œè€Œä¸”é»˜è®¤ä¸º trueã€‚åœ¨ä» SpringClientFactory ä¸­è·å– ILoadBalancer æ—¶ï¼Œä¼šé€šè¿‡è¿™ä¸ªé…ç½®ç±»åˆå§‹åŒ– HttpClientï¼ŒæŒ‰å…ˆåé¡ºåºä¼šåˆå§‹åŒ– HttpClientConnectionManagerã€CloseableHttpClientã€RibbonLoadBalancingHttpClientã€‚CloseableHttpClient æ˜¯Â Apache HttpComponents HttpClient ä¸­çš„ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤æƒ…å†µä¸‹åº”è¯¥æ˜¯ä½¿ç”¨ apacheÂ HttpComponents ä½œä¸º HTTP ç»„ä»¶åº“ã€‚&lt;/p&gt;
&lt;p&gt;ä½†ç»è¿‡å‰é¢æºç çš„åˆ†æï¼Œä»¥åŠæµ‹è¯•å‘ç°ï¼Œæœ€ç»ˆå…¶å®èµ°çš„çš„Â HttpURLConnectionï¼Œå¹¶æ²¡æœ‰ç”¨åˆ° CloseableHttpClientã€‚æŠŠ ribbon.httpclient.enabled è®¾ç½®ä¸º falseï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆå½±å“ï¼Œè¿˜æ˜¯é»˜è®¤èµ° HttpURLConnectionã€‚æˆ‘ä»¬åé¢å†æ¥åˆ†æè¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;47&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_aaddf497-1cbb-4bb7-921e-2d76f8f9dc7d&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_aaddf497-1cbb-4bb7-921e-2d76f8f9dc7d&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_aaddf497-1cbb-4bb7-921e-2d76f8f9dc7d&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;89&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; @ConditionalOnClass(name = &quot;org.apache.http.client.HttpClient&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ribbon.httpclient.enabled moreæ–‡ä¸º true&lt;/span&gt;
&lt;span&gt; 4&lt;/span&gt; @ConditionalOnProperty(name = &quot;ribbon.httpclient.enabled&quot;, matchIfMissing = &lt;span&gt;true&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; HttpClientRibbonConfiguration {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; 
&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;    @RibbonClientName
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; String name = &quot;client&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; 
&lt;span&gt;10&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; RibbonLoadBalancingHttpClient&lt;/span&gt;
&lt;span&gt;11&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;     @ConditionalOnMissingBean(AbstractLoadBalancerAwareClient.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;     @ConditionalOnMissingClass(&quot;org.springframework.retry.support.RetryTemplate&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RibbonLoadBalancingHttpClient ribbonLoadBalancingHttpClient(
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;            IClientConfig config, ServerIntrospector serverIntrospector,
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;            ILoadBalancer loadBalancer, RetryHandler retryHandler,
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt;            CloseableHttpClient httpClient) {
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;         RibbonLoadBalancingHttpClient client = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RibbonLoadBalancingHttpClient(
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;                httpClient, config, serverIntrospector);
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;        client.setLoadBalancer(loadBalancer);
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; &lt;span&gt;        client.setRetryHandler(retryHandler);
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;         Monitors.registerObject(&quot;Client_&quot; + &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.name, client);
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; client;
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; 
&lt;span&gt;26&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åœ¨å¼•å…¥äº† spring-retry æ—¶ï¼Œå³å¯ä»¥é‡è¯•çš„ RetryTemplate æ—¶ï¼Œå°±åˆ›å»º RetryableRibbonLoadBalancingHttpClient&lt;/span&gt;
&lt;span&gt;27&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;     @ConditionalOnMissingBean(AbstractLoadBalancerAwareClient.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt;     @ConditionalOnClass(name = &quot;org.springframework.retry.support.RetryTemplate&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RetryableRibbonLoadBalancingHttpClient retryableRibbonLoadBalancingHttpClient(
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt; &lt;span&gt;            IClientConfig config, ServerIntrospector serverIntrospector,
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; &lt;span&gt;            ILoadBalancer loadBalancer, RetryHandler retryHandler,
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; &lt;span&gt;            LoadBalancedRetryFactory loadBalancedRetryFactory,
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt; &lt;span&gt;            CloseableHttpClient httpClient,
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt; &lt;span&gt;            RibbonLoadBalancerContext ribbonLoadBalancerContext) {
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;         RetryableRibbonLoadBalancingHttpClient client = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RetryableRibbonLoadBalancingHttpClient(
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt; &lt;span&gt;                httpClient, config, serverIntrospector, loadBalancedRetryFactory);
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt; &lt;span&gt;        client.setLoadBalancer(loadBalancer);
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt; &lt;span&gt;        client.setRetryHandler(retryHandler);
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt; &lt;span&gt;        client.setRibbonLoadBalancerContext(ribbonLoadBalancerContext);
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt;         Monitors.registerObject(&quot;Client_&quot; + &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.name, client);
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; client;
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt; 
&lt;span&gt;45&lt;/span&gt;     @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt;     &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; ApacheHttpClientConfiguration {
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt; 
&lt;span&gt;48&lt;/span&gt;         &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; Timer connectionManagerTimer = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; Timer(
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt;                 &quot;RibbonApacheHttpClientConfiguration.connectionManagerTimer&quot;, &lt;span&gt;true&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt; 
&lt;span&gt;51&lt;/span&gt;         &lt;span&gt;private&lt;/span&gt;&lt;span&gt; CloseableHttpClient httpClient;
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt; 
&lt;span&gt;53&lt;/span&gt;         @Autowired(required = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt;         &lt;span&gt;private&lt;/span&gt;&lt;span&gt; RegistryBuilder registryBuilder;
&lt;/span&gt;&lt;span&gt;55&lt;/span&gt; 
&lt;span&gt;56&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; HttpClient è¿æ¥æ± ç®¡ç†å™¨&lt;/span&gt;
&lt;span&gt;57&lt;/span&gt; &lt;span&gt;        @Bean
&lt;/span&gt;&lt;span&gt;58&lt;/span&gt;         @ConditionalOnMissingBean(HttpClientConnectionManager.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;59&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt;&lt;span&gt; HttpClientConnectionManager httpClientConnectionManager(
&lt;/span&gt;&lt;span&gt;60&lt;/span&gt; &lt;span&gt;                IClientConfig config,
&lt;/span&gt;&lt;span&gt;61&lt;/span&gt; &lt;span&gt;                ApacheHttpClientConnectionManagerFactory connectionManagerFactory) {
&lt;/span&gt;&lt;span&gt;62&lt;/span&gt;             RibbonProperties ribbon =&lt;span&gt; RibbonProperties.from(config);
&lt;/span&gt;&lt;span&gt;63&lt;/span&gt;             &lt;span&gt;int&lt;/span&gt; maxTotalConnections =&lt;span&gt; ribbon.maxTotalConnections();
&lt;/span&gt;&lt;span&gt;64&lt;/span&gt;             &lt;span&gt;int&lt;/span&gt; maxConnectionsPerHost =&lt;span&gt; ribbon.maxConnectionsPerHost();
&lt;/span&gt;&lt;span&gt;65&lt;/span&gt;             &lt;span&gt;int&lt;/span&gt; timerRepeat =&lt;span&gt; ribbon.connectionCleanerRepeatInterval();
&lt;/span&gt;&lt;span&gt;66&lt;/span&gt;             &lt;span&gt;long&lt;/span&gt; timeToLive =&lt;span&gt; ribbon.poolKeepAliveTime();
&lt;/span&gt;&lt;span&gt;67&lt;/span&gt;             TimeUnit ttlUnit =&lt;span&gt; ribbon.getPoolKeepAliveTimeUnits();
&lt;/span&gt;&lt;span&gt;68&lt;/span&gt;             &lt;span&gt;final&lt;/span&gt; HttpClientConnectionManager connectionManager =&lt;span&gt; connectionManagerFactory
&lt;/span&gt;&lt;span&gt;69&lt;/span&gt;                     .newConnectionManager(&lt;span&gt;false&lt;/span&gt;&lt;span&gt;, maxTotalConnections,
&lt;/span&gt;&lt;span&gt;70&lt;/span&gt; &lt;span&gt;                            maxConnectionsPerHost, timeToLive, ttlUnit, registryBuilder);
&lt;/span&gt;&lt;span&gt;71&lt;/span&gt;             &lt;span&gt;this&lt;/span&gt;.connectionManagerTimer.schedule(&lt;span&gt;new&lt;/span&gt;&lt;span&gt; TimerTask() {
&lt;/span&gt;&lt;span&gt;72&lt;/span&gt; &lt;span&gt;                @Override
&lt;/span&gt;&lt;span&gt;73&lt;/span&gt;                 &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; run() {
&lt;/span&gt;&lt;span&gt;74&lt;/span&gt; &lt;span&gt;                    connectionManager.closeExpiredConnections();
&lt;/span&gt;&lt;span&gt;75&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;76&lt;/span&gt;             }, 30000&lt;span&gt;, timerRepeat);
&lt;/span&gt;&lt;span&gt;77&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt;&lt;span&gt; connectionManager;
&lt;/span&gt;&lt;span&gt;78&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;79&lt;/span&gt; 
&lt;span&gt;80&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; HttpClient =&amp;gt; CloseableHttpClient&lt;/span&gt;
&lt;span&gt;81&lt;/span&gt; &lt;span&gt;        @Bean
&lt;/span&gt;&lt;span&gt;82&lt;/span&gt;         @ConditionalOnMissingBean(CloseableHttpClient.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;83&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt;&lt;span&gt; CloseableHttpClient httpClient(ApacheHttpClientFactory httpClientFactory,
&lt;/span&gt;&lt;span&gt;84&lt;/span&gt; &lt;span&gt;                HttpClientConnectionManager connectionManager, IClientConfig config) {
&lt;/span&gt;&lt;span&gt;85&lt;/span&gt;             RibbonProperties ribbon =&lt;span&gt; RibbonProperties.from(config);
&lt;/span&gt;&lt;span&gt;86&lt;/span&gt;             Boolean followRedirects =&lt;span&gt; ribbon.isFollowRedirects();
&lt;/span&gt;&lt;span&gt;87&lt;/span&gt;             Integer connectTimeout =&lt;span&gt; ribbon.connectTimeout();
&lt;/span&gt;&lt;span&gt;88&lt;/span&gt;             RequestConfig defaultRequestConfig =&lt;span&gt; RequestConfig.custom()
&lt;/span&gt;&lt;span&gt;89&lt;/span&gt; &lt;span&gt;                    .setConnectTimeout(connectTimeout)
&lt;/span&gt;&lt;span&gt;90&lt;/span&gt; &lt;span&gt;                    .setRedirectsEnabled(followRedirects).build();
&lt;/span&gt;&lt;span&gt;91&lt;/span&gt;             &lt;span&gt;this&lt;/span&gt;.httpClient =&lt;span&gt; httpClientFactory.createBuilder()
&lt;/span&gt;&lt;span&gt;92&lt;/span&gt; &lt;span&gt;                    .setDefaultRequestConfig(defaultRequestConfig)
&lt;/span&gt;&lt;span&gt;93&lt;/span&gt; &lt;span&gt;                    .setConnectionManager(connectionManager).build();
&lt;/span&gt;&lt;span&gt;94&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt;&lt;span&gt; httpClient;
&lt;/span&gt;&lt;span&gt;95&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;96&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;97&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;â‘¢ é»˜è®¤é…ç½®ä¸‹çš„ RestTemplate çš„è°ƒç”¨è¿‡ç¨‹å¤§è‡´å¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201223223322089-1060203106.png&quot; width=&quot;1000&quot;/&gt;&lt;/p&gt;
&lt;h3&gt;3ã€å¯ç”¨ RestClient&lt;/h3&gt;
&lt;p&gt;â‘  å¯ç”¨ RestClient&lt;/p&gt;
&lt;p&gt;å¯ä»¥æ·»åŠ å¦‚ä¸‹é…ç½®å¯ç”¨ RestClientï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;ribbon:
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;  # å…³é—­ httpclient
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;  httpclient:
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;     enabled: &lt;span&gt;false&lt;/span&gt;
&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;  # å¯ç”¨ RestClient
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;  restclient:
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     enabled: &lt;span&gt;true&lt;/span&gt;
&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;  # å¯ç”¨ RestClient
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;  http:
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;    client:
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;       enabled: &lt;span&gt;true&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿›å…¥ RestClientRibbonConfigurationÂ  å¯ä»¥çœ‹åˆ°ï¼Œåªè¦ ribbon.http.client.enabledã€ribbon.restclient.enabled å…¶ä¸­ä¸€ä¸ªé…ç½®äº†å¯ç”¨ï¼Œå°±å¯ä»¥å¯ç”¨ RestClientã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; @SuppressWarnings(&quot;deprecation&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¯ç”¨æ¡ä»¶ ConditionalOnRibbonRestClient&lt;/span&gt;
&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;@RibbonAutoConfiguration.ConditionalOnRibbonRestClient
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; RestClientRibbonConfiguration {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;    @RibbonClientName
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; String name = &quot;client&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; 
&lt;span&gt; 9&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; RestClient å·²è¿‡æœŸ&lt;/span&gt;
&lt;span&gt;10&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;    @Lazy
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;     @ConditionalOnMissingBean(AbstractLoadBalancerAwareClient.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RestClient ribbonRestClient(IClientConfig config, ILoadBalancer loadBalancer,
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;            ServerIntrospector serverIntrospector, RetryHandler retryHandler) {
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;         RestClient client = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RibbonClientConfiguration.OverrideRestClient(config, serverIntrospector);
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;        client.setLoadBalancer(loadBalancer);
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt;        client.setRetryHandler(retryHandler);
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; client;
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; 
&lt;span&gt;21&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; 
&lt;span&gt;23&lt;/span&gt; &lt;span&gt;@Target({ ElementType.TYPE, ElementType.METHOD })
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;@Retention(RetentionPolicy.RUNTIME)
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; &lt;span&gt;@Documented
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt; @Conditional(OnRibbonRestClientCondition.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt; @&lt;span&gt;interface&lt;/span&gt;&lt;span&gt; ConditionalOnRibbonRestClient {
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt; 
&lt;span&gt;30&lt;/span&gt; &lt;span&gt;private&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; OnRibbonRestClientCondition &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; AnyNestedCondition {
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;     @Deprecated &lt;span&gt;//&lt;/span&gt;&lt;span&gt; remove in Edgware&quot;&lt;/span&gt;
&lt;span&gt;32&lt;/span&gt;     @ConditionalOnProperty(&quot;ribbon.http.client.enabled&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;     &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; ZuulProperty {
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt; 
&lt;span&gt;36&lt;/span&gt;     @ConditionalOnProperty(&quot;ribbon.restclient.enabled&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;     &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; RibbonProperty {
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;RestClient ç»§æ‰¿è‡ª AbstractLoadBalancerAwareClientã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRestClient å·²ç»è¿‡æœŸï¼Œæ‰€ä»¥ç”Ÿäº§ç¯å¢ƒä¸­æˆ‘ä»¬å°±ä¸è¦å¯ç”¨ RestTemplate äº†ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;@Deprecated
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; RestClient &lt;span&gt;extends&lt;/span&gt; AbstractLoadBalancerAwareClient&amp;lt;HttpRequest, HttpResponse&amp;gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt; 
&lt;span&gt;4&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â‘¡ LoadBalancerContext ç±»ä½“ç³»ç»“æ„&lt;/p&gt;
&lt;p&gt;è´Ÿè½½å‡è¡¡ä¸Šä¸‹æ–‡ LoadBalancerContext ä½“ç³»çš„ç±»ç»“æ„å¦‚ä¸‹ã€‚å¯ä»¥çœ‹å‡ºï¼ŒRibbon æ˜¯æ”¯æŒ Feignã€OkHttpã€HttpClientã€RestClient çš„ã€‚é»˜è®¤é…ç½®ä¸‹ä½¿ç”¨çš„å®ç°ç±»æ˜¯ RibbonLoadBalancerContextã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201223212456447-1178386001.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;â‘¢ RestTemplate çš„ ClientHttpRequest å·¥å‚ç±»é…ç½®&lt;/p&gt;
&lt;p&gt;æ¥ç€çœ‹ RibbonAutoConfiguration ä¸­æœ‰å¦‚ä¸‹çš„é…ç½®ï¼Œè·Ÿå‰é¢ RestClientRibbonConfiguration ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæ»¡è¶³ @ConditionalOnRibbonRestClient çš„æ¡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä¼šåˆ›å»º RibbonClientHttpRequestFactory å¹¶è®¾ç½®åˆ° RestTemplate ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ—¶ RestTemplate ä¸­çš„ requestFactory å°±ä¸æ˜¯é»˜è®¤çš„ SimpleClientHttpRequestFactory äº†ï¼Œè€Œæ˜¯ RibbonClientHttpRequestFactoryã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; @ConditionalOnClass(HttpRequest.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;@ConditionalOnRibbonRestClient
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; RibbonClientHttpRequestFactoryConfiguration {
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;    @Autowired
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt;&lt;span&gt; SpringClientFactory springClientFactory;
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; 
&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RestTemplateCustomizer restTemplateCustomizer(
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;             &lt;span&gt;final&lt;/span&gt;&lt;span&gt; RibbonClientHttpRequestFactory ribbonClientHttpRequestFactory) {
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; RestTemplate è®¾ç½® requestFactory ä¸º RibbonClientHttpRequestFactory&lt;/span&gt;
&lt;span&gt;12&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; restTemplate -&amp;gt;&lt;span&gt; restTemplate
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; &lt;span&gt;                .setRequestFactory(ribbonClientHttpRequestFactory);
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; 
&lt;span&gt;16&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ClientHttpRequest å·¥å‚ç±» =&amp;gt; RibbonClientHttpRequestFactory&lt;/span&gt;
&lt;span&gt;17&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RibbonClientHttpRequestFactory ribbonClientHttpRequestFactory() {
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RibbonClientHttpRequestFactory(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.springClientFactory);
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è€Œä¸”ï¼Œç”±äºè¿™é‡Œé…ç½®äº† RestTemplateCustomizerï¼ŒåŸæœ¬é»˜è®¤é…ç½®ä¸‹ï¼Œåœ¨ LoadBalancerAutoConfiguration ä¸­åˆ›å»º RestTemplateCustomizer çš„æ–¹æ³•å°±ä¸ä¼šç”Ÿæ•ˆäº†ã€‚&lt;/p&gt;
&lt;p&gt;LoadBalancerAutoConfiguration ä¸­çš„ RestTemplateCustomizer æ˜¯å‘ RestTemplate ä¸­æ·»åŠ  LoadBalancerInterceptor æ‹¦æˆªå™¨ï¼Œæ‰€ä»¥åœ¨å¯ç”¨äº† RestClient çš„æƒ…å†µä¸‹ï¼ŒåŸæœ¬çš„ LoadBalancerInterceptor å°±ä¸ä¼šç”Ÿæ•ˆäº†ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33.5&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_938f15c9-3b3b-432f-8392-f9e987155915&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_938f15c9-3b3b-432f-8392-f9e987155915&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_938f15c9-3b3b-432f-8392-f9e987155915&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;62&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; @ConditionalOnMissingClass(&quot;org.springframework.retry.support.RetryTemplate&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; LoadBalancerInterceptorConfig {
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; 
&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; LoadBalancerInterceptor ribbonInterceptor(
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;            LoadBalancerClient loadBalancerClient,
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;            LoadBalancerRequestFactory requestFactory) {
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; LoadBalancerInterceptor(loadBalancerClient, requestFactory);
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; 
&lt;span&gt;12&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; &lt;span&gt;    @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RestTemplateCustomizer restTemplateCustomizer(
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;             &lt;span&gt;final&lt;/span&gt;&lt;span&gt; LoadBalancerInterceptor loadBalancerInterceptor) {
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; restTemplate -&amp;gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;             List&amp;lt;ClientHttpRequestInterceptor&amp;gt; list = &lt;span&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;&lt;span&gt;(
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt; &lt;span&gt;                    restTemplate.getInterceptors());
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;            list.add(loadBalancerInterceptor);
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;            restTemplate.setInterceptors(list);
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; &lt;span&gt;        };
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;é‚£ä¹ˆ RestTemplate çš„ doExecute æ–¹æ³•ä¸­ï¼Œåœ¨è°ƒç”¨ createRequest æ–¹æ³•åˆ›å»º ClientHttpRequest æ—¶ï¼Œå°±ä¼šç”¨ RibbonClientHttpRequestFactory æ¥åˆ›å»ºï¼Œè¿›å»å¯ä»¥çœ‹åˆ° ClientHttpRequest çš„å®é™…ç±»å‹å°±æ˜¯ RibbonHttpRequestã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; ClientHttpRequest createRequest(URI originalUri, HttpMethod httpMethod) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; IOException {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;     String serviceId =&lt;span&gt; originalUri.getHost();
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (serviceId == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;         &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; IOException(&quot;Invalid hostname in the URI [&quot; + originalUri.toASCIIString() + &quot;]&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;     IClientConfig clientConfig = &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.clientFactory.getClientConfig(serviceId);
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     RestClient client = &lt;span&gt;this&lt;/span&gt;.clientFactory.getClient(serviceId, RestClient.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;     HttpRequest.Verb verb =&lt;span&gt; HttpRequest.Verb.valueOf(httpMethod.name());
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; 
&lt;span&gt;10&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RibbonHttpRequest(originalUri, verb, client, clientConfig);
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è°ƒç”¨ RibbonHttpRequest çš„ execute æ–¹æ³•ï¼Œå®é™…ç»„ä¸­æ˜¯è°ƒç”¨äº†å®ƒçš„ executeInternal æ–¹æ³•ï¼Œç„¶åæœ€åæ˜¯ä½¿ç”¨ RestClient æ¥å‘èµ·è´Ÿè½½å‡è¡¡çš„è°ƒç”¨ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;protected&lt;/span&gt; ClientHttpResponse executeInternal(HttpHeaders headers) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; IOException {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;     &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ...&lt;/span&gt;
&lt;span&gt; 4&lt;/span&gt;         HttpRequest request =&lt;span&gt; builder.build();
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; client =&amp;gt; RestClient&lt;/span&gt;
&lt;span&gt; 6&lt;/span&gt;         HttpResponse response =&lt;span&gt; client.executeWithLoadBalancer(request, config);
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RibbonHttpResponse(response);
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;     &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;         &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; IOException(e);
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â‘£ RestClient HTTP è°ƒç”¨&lt;/p&gt;
&lt;p&gt;RestClient çš„ executeWithLoadBalancer å®é™…æ˜¯è¿›å…¥åˆ°çˆ¶ç±» AbstractLoadBalancerAwareClient çš„ executeWithLoadBalancer Â æ–¹æ³•ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä»è¿™ä¸ªæ–¹æ³•å¯ä»¥çŸ¥é“ï¼Œä¸»è¦çš„è´Ÿè½½å‡è¡¡è¯·æ±‚æ˜¯åœ¨ LoadBalancerCommand ä¸­çš„ï¼ŒLoadBalancerCommand å¿…å®šä¼šé€šè¿‡è´Ÿè½½å‡è¡¡å™¨ ILoadBalancer å¾—åˆ°ä¸€ä¸ª Serverï¼Œç„¶åé€šè¿‡ submit çš„è¿™ä¸ª ServerOperation å¯¹åŸå§‹URIè¿›è¡Œé‡æ„ï¼Œé‡æ„ä¹‹åè°ƒç”¨ RestClient çš„ execute å‘èµ·HTTPè¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; T executeWithLoadBalancer(&lt;span&gt;final&lt;/span&gt; S request, &lt;span&gt;final&lt;/span&gt; IClientConfig requestConfig) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; ClientException {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è´Ÿè½½å‡è¡¡å‘½ä»¤&lt;/span&gt;
&lt;span&gt; 3&lt;/span&gt;     LoadBalancerCommand&amp;lt;T&amp;gt; command =&lt;span&gt; buildLoadBalancerCommand(request, requestConfig);
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; 
&lt;span&gt; 5&lt;/span&gt;     &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; å‘èµ·è´Ÿè½½å‡è¡¡è¯·æ±‚&lt;/span&gt;
&lt;span&gt; 7&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; command.submit(
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;             &lt;span&gt;new&lt;/span&gt; ServerOperation&amp;lt;T&amp;gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;                @Override
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;                 &lt;span&gt;public&lt;/span&gt; Observable&amp;lt;T&amp;gt;&lt;span&gt; call(Server server) {
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;                     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; é‡æ„ URIï¼Œå°†æœåŠ¡åç”¨ Server çš„ IP å’Œç«¯å£æ›¿æ¢&lt;/span&gt;
&lt;span&gt;12&lt;/span&gt;                     URI finalUri =&lt;span&gt; reconstructURIWithServer(server, request.getUri());
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;                     S requestForServer =&lt;span&gt; (S) request.replaceUri(finalUri);
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;                     &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;                         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; execute å‘èµ·è°ƒç”¨ï¼Œå®é™…è°ƒç”¨çš„æ˜¯ RestClient ä¸­çš„ execute&lt;/span&gt;
&lt;span&gt;16&lt;/span&gt;                         &lt;span&gt;return&lt;/span&gt; Observable.just(AbstractLoadBalancerAwareClient.&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.execute(requestForServer, requestConfig));
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;                     &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;                         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; Observable.error(e);
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt;            })
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; &lt;span&gt;            .toBlocking()
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;            .single();
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;     } &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt;....&lt;/span&gt;
&lt;span&gt;27&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å†çœ‹ RestClient çš„ execute æ–¹æ³•ï¼Œæœ€ç»ˆå¯ä»¥å‘ç°ï¼ŒRestClient å…¶å®æ˜¯ä½¿ç”¨åŸºäº jersey çš„ WebResource æ¥å‘èµ· HTTP è¯·æ±‚çš„ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_6c1c3320-b899-45b3-a40c-46e1b3a0b48e&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_6c1c3320-b899-45b3-a40c-46e1b3a0b48e&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_6c1c3320-b899-45b3-a40c-46e1b3a0b48e&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;73&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;private&lt;/span&gt;&lt;span&gt; HttpResponse execute(HttpRequest.Verb verb, URI uri,
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;         Map&amp;lt;String, Collection&amp;lt;String&amp;gt;&amp;gt; headers, Map&amp;lt;String, Collection&amp;lt;String&amp;gt;&amp;gt;&lt;span&gt; params,
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;         IClientConfig overriddenClientConfig, Object requestEntity) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Exception {
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ...
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; WebResource æ˜¯åŸºäº jersey å°è£…çš„ HTTP å®¢æˆ·ç«¯ç»„ä»¶&lt;/span&gt;
&lt;span&gt; 6&lt;/span&gt;     WebResource xResource =&lt;span&gt; restClient.resource(uri.toString());
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;    ClientResponse jerseyResponse;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;     Builder b =&lt;span&gt; xResource.getRequestBuilder();
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;     Object entity =&lt;span&gt; requestEntity;
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; 
&lt;span&gt;11&lt;/span&gt;     &lt;span&gt;switch&lt;/span&gt;&lt;span&gt; (verb) {
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;     &lt;span&gt;case&lt;/span&gt;&lt;span&gt; GET:
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;         jerseyResponse = b.get(ClientResponse.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;         &lt;span&gt;break&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;     &lt;span&gt;case&lt;/span&gt;&lt;span&gt; POST:
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;         jerseyResponse = b.post(ClientResponse.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, entity);
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;         &lt;span&gt;break&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;     &lt;span&gt;case&lt;/span&gt;&lt;span&gt; PUT:
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;         jerseyResponse = b.put(ClientResponse.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;, entity);
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;         &lt;span&gt;break&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt;     &lt;span&gt;case&lt;/span&gt;&lt;span&gt; DELETE:
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;         jerseyResponse = b.delete(ClientResponse.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;         &lt;span&gt;break&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt;     &lt;span&gt;case&lt;/span&gt;&lt;span&gt; HEAD:
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;         jerseyResponse =&lt;span&gt; b.head();
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;         &lt;span&gt;break&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;     &lt;span&gt;case&lt;/span&gt;&lt;span&gt; OPTIONS:
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;         jerseyResponse = b.options(ClientResponse.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt;         &lt;span&gt;break&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt;     &lt;span&gt;default&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;         &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ClientException(
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; &lt;span&gt;                ClientException.ErrorType.GENERAL,
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;                 &quot;You have to one of the REST verbs such as GET, POST etc.&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt; 
&lt;span&gt;36&lt;/span&gt;     thisResponse = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; HttpClientResponse(jerseyResponse, uri, overriddenClientConfig);
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (thisResponse.getStatus() == 503&lt;span&gt;){
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt; &lt;span&gt;        thisResponse.close();
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt;         &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ClientException(ClientException.ErrorType.SERVER_THROTTLED);
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; thisResponse;
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;â‘¤ æœ€åï¼ŒRestTemplate åŸºäº RestClient çš„è¯·æ±‚æµç¨‹å¯ä»¥ç”¨ä¸‹å›¾æ¥åšä¸ªæ€»ç»“ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201223230954406-1358305609.png&quot; width=&quot;1000&quot;/&gt;&lt;/p&gt;
&lt;h3&gt;4ã€Apache HttpClient æˆ– OkHttp å¯¹ RestTemplate ä¸ç”Ÿæ•ˆï¼ˆBUGï¼Ÿï¼‰&lt;/h3&gt;
&lt;p&gt;â‘  Apache HttpClient&lt;/p&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œribbon.httpclient.enabled=trueï¼Œåœ¨Â HttpClientRibbonConfiguration ä¸­ä¼šåˆå§‹åŒ– apache httpcomponents ç›¸å…³çš„ç»„ä»¶ï¼Œå‰å·²ç»åˆ†æè¿‡äº†ï¼Œä½†æ˜¯åœ¨ RestTemplate ä¸­å¹¶æœªä½¿ç”¨ç›¸å…³çš„ç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ç”¨äº† apacheÂ httpcomponentsï¼Œä½†æ˜¯ RestTemplate æœ€åæ˜¯ä½¿ç”¨ HttpURLConnection æ¥å‘èµ· HTTP è¯·æ±‚çš„ï¼Œè€Œä¸æ˜¯é…ç½®çš„ CloseableHttpClientã€‚&lt;/p&gt;
&lt;p&gt;â‘¡ OkHttp&lt;/p&gt;
&lt;p&gt;é¦–å…ˆéœ€è¦åŠ å…¥ OkHttp çš„ä¾èµ–ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;2&lt;/span&gt;     &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;com.squareup.okhttp3&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;3&lt;/span&gt;     &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;okhttp&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;4&lt;/span&gt; &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ç„¶åæ·»åŠ å¦‚ä¸‹é…ç½®å°±å¯ä»¥å¯ç”¨ OkHttpï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1 &lt;span&gt;ribbon:
&lt;span&gt;2 &lt;span&gt;  httpclient:
&lt;span&gt;3     enabled: &lt;span&gt;false
&lt;span&gt;4 &lt;span&gt;  # å¯ç”¨ okhttp
&lt;span&gt;5 &lt;span&gt;  okhttp:
&lt;span&gt;6     enabled: &lt;span&gt;true&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é…ç½® ribbon.okhttp.enabled=true åï¼Œåœ¨ OkHttpRibbonConfiguration ä¸­ä¼šåˆå§‹åŒ– OkHttp ç›¸å…³çš„ç»„ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è°ƒè¯•ä¹‹åä¼šå‘ç°ï¼Œå…¶å®å®ƒè¿˜æ˜¯èµ°çš„é»˜è®¤çš„æµç¨‹ï¼Œå°±æ˜¯æœ€ç»ˆç”¨ HttpURLConnection å‘èµ· HTTP è¯·æ±‚ï¼Œè·Ÿ httpcomponents æ˜¯ä¸€æ ·çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;44.5&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_494a5d64-ed44-416e-9cb3-29d72de17650&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_494a5d64-ed44-416e-9cb3-29d72de17650&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_494a5d64-ed44-416e-9cb3-29d72de17650&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;84&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; @ConditionalOnProperty(&quot;ribbon.okhttp.enabled&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; @ConditionalOnClass(name = &quot;okhttp3.OkHttpClient&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; OkHttpRibbonConfiguration {
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; 
&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;    @RibbonClientName
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; String name = &quot;client&quot;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; 
&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;     @ConditionalOnMissingBean(AbstractLoadBalancerAwareClient.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;     @ConditionalOnClass(name = &quot;org.springframework.retry.support.RetryTemplate&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RetryableOkHttpLoadBalancingClient retryableOkHttpLoadBalancingClient(
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; &lt;span&gt;            IClientConfig config, ServerIntrospector serverIntrospector,
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;            ILoadBalancer loadBalancer, RetryHandler retryHandler,
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;            LoadBalancedRetryFactory loadBalancedRetryFactory, OkHttpClient delegate,
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;            RibbonLoadBalancerContext ribbonLoadBalancerContext) {
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;         RetryableOkHttpLoadBalancingClient client = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RetryableOkHttpLoadBalancingClient(
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt; &lt;span&gt;                delegate, config, serverIntrospector, loadBalancedRetryFactory);
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;        client.setLoadBalancer(loadBalancer);
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;        client.setRetryHandler(retryHandler);
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; &lt;span&gt;        client.setRibbonLoadBalancerContext(ribbonLoadBalancerContext);
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;         Monitors.registerObject(&quot;Client_&quot; + &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.name, client);
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; client;
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; 
&lt;span&gt;26&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;     @ConditionalOnMissingBean(AbstractLoadBalancerAwareClient.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;     @ConditionalOnMissingClass(&quot;org.springframework.retry.support.RetryTemplate&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; OkHttpLoadBalancingClient okHttpLoadBalancingClient(IClientConfig config,
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; &lt;span&gt;            ServerIntrospector serverIntrospector, ILoadBalancer loadBalancer,
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt; &lt;span&gt;            RetryHandler retryHandler, OkHttpClient delegate) {
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt;         OkHttpLoadBalancingClient client = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; OkHttpLoadBalancingClient(delegate, config,
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; &lt;span&gt;                serverIntrospector);
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt; &lt;span&gt;        client.setLoadBalancer(loadBalancer);
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt; &lt;span&gt;        client.setRetryHandler(retryHandler);
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;         Monitors.registerObject(&quot;Client_&quot; + &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.name, client);
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; client;
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt; 
&lt;span&gt;40&lt;/span&gt;     @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt;     &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; OkHttpClientConfiguration {
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt; 
&lt;span&gt;43&lt;/span&gt;         &lt;span&gt;private&lt;/span&gt;&lt;span&gt; OkHttpClient httpClient;
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt; 
&lt;span&gt;45&lt;/span&gt; &lt;span&gt;        @Bean
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt;         @ConditionalOnMissingBean(ConnectionPool.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt;&lt;span&gt; ConnectionPool httpClientConnectionPool(IClientConfig config,
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt; &lt;span&gt;                OkHttpClientConnectionPoolFactory connectionPoolFactory) {
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt;             RibbonProperties ribbon =&lt;span&gt; RibbonProperties.from(config);
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt;             &lt;span&gt;int&lt;/span&gt; maxTotalConnections =&lt;span&gt; ribbon.maxTotalConnections();
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt;             &lt;span&gt;long&lt;/span&gt; timeToLive =&lt;span&gt; ribbon.poolKeepAliveTime();
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt;             TimeUnit ttlUnit =&lt;span&gt; ribbon.getPoolKeepAliveTimeUnits();
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt;&lt;span&gt; connectionPoolFactory.create(maxTotalConnections, timeToLive, ttlUnit);
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;55&lt;/span&gt; 
&lt;span&gt;56&lt;/span&gt; &lt;span&gt;        @Bean
&lt;/span&gt;&lt;span&gt;57&lt;/span&gt;         @ConditionalOnMissingBean(OkHttpClient.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;58&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt;&lt;span&gt; OkHttpClient client(OkHttpClientFactory httpClientFactory,
&lt;/span&gt;&lt;span&gt;59&lt;/span&gt; &lt;span&gt;                ConnectionPool connectionPool, IClientConfig config) {
&lt;/span&gt;&lt;span&gt;60&lt;/span&gt;             RibbonProperties ribbon =&lt;span&gt; RibbonProperties.from(config);
&lt;/span&gt;&lt;span&gt;61&lt;/span&gt;             &lt;span&gt;this&lt;/span&gt;.httpClient = httpClientFactory.createBuilder(&lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;62&lt;/span&gt; &lt;span&gt;                    .connectTimeout(ribbon.connectTimeout(), TimeUnit.MILLISECONDS)
&lt;/span&gt;&lt;span&gt;63&lt;/span&gt; &lt;span&gt;                    .readTimeout(ribbon.readTimeout(), TimeUnit.MILLISECONDS)
&lt;/span&gt;&lt;span&gt;64&lt;/span&gt; &lt;span&gt;                    .followRedirects(ribbon.isFollowRedirects())
&lt;/span&gt;&lt;span&gt;65&lt;/span&gt; &lt;span&gt;                    .connectionPool(connectionPool).build();
&lt;/span&gt;&lt;span&gt;66&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.httpClient;
&lt;/span&gt;&lt;span&gt;67&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;68&lt;/span&gt; 
&lt;span&gt;69&lt;/span&gt; &lt;span&gt;        @PreDestroy
&lt;/span&gt;&lt;span&gt;70&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; destroy() {
&lt;/span&gt;&lt;span&gt;71&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (httpClient != &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;72&lt;/span&gt; &lt;span&gt;                httpClient.dispatcher().executorService().shutdown();
&lt;/span&gt;&lt;span&gt;73&lt;/span&gt; &lt;span&gt;                httpClient.connectionPool().evictAll();
&lt;/span&gt;&lt;span&gt;74&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;75&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;76&lt;/span&gt; 
&lt;span&gt;77&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;78&lt;/span&gt; 
&lt;span&gt;79&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Cod&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;â‘¢ å¯ç”¨ HttpClient æˆ– OkHttp ä¸ç”Ÿæ•ˆçš„åŸå› &lt;/p&gt;
&lt;p&gt;ç»è¿‡å‰é¢çš„åˆ†æï¼Œå¯ä»¥çŸ¥é“å¯ç”¨ apache httpcomponents æˆ–è€… OkHttpï¼Œå¯¹ RestTemplate éƒ½æ²¡æœ‰èµ·ä½œç”¨ï¼Œæœ€ç»ˆè¿˜æ˜¯ç”¨ HttpURLConnection å‘èµ· HTTP è¯·æ±‚ã€‚é‚£ä¸ºä»€ä¹ˆä¸ºå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ RestTemplateÂ  çš„ setRequestFactory æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ RestTemplate çš„ setRequestFactory æ–¹æ³•çš„æ³¨é‡Šä¹Ÿå¯ä»¥äº†è§£åˆ°ï¼Œé»˜è®¤çš„ requestFactory æ˜¯ SimpleClientHttpRequestFactoryï¼Œå®ƒæ˜¯åŸºäº JDK æ ‡å‡† HTTP åº“çš„ HttpURLConnectionã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤çš„ HttpURLConnection ä¸æ”¯æŒ PATCHï¼Œå¦‚æœæƒ³æ”¯æŒï¼Œéœ€è®¾ç½®ä¸º Apache HttpComponents æˆ– OkHttp çš„ request factoryã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt; * Set the request factory that this accessor uses for obtaining client request handles.
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt; * &amp;lt;p&amp;gt;The default is a {&lt;/span&gt;&lt;span&gt;@link&lt;/span&gt;&lt;span&gt; SimpleClientHttpRequestFactory} based on the JDK's own
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt; * HTTP libraries ({&lt;/span&gt;&lt;span&gt;@link&lt;/span&gt;&lt;span&gt; java.net.HttpURLConnection}).
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt; * &amp;lt;p&amp;gt;&amp;lt;b&amp;gt;Note that the standard JDK HTTP library does not support the HTTP PATCH method.
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; &lt;span&gt; * Configure the Apache HttpComponents or OkHttp request factory to enable PATCH.&amp;lt;/b&amp;gt;
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@see&lt;/span&gt;&lt;span&gt; #createRequest(URI, HttpMethod)
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@see&lt;/span&gt;&lt;span&gt; SimpleClientHttpRequestFactory
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@see&lt;/span&gt;&lt;span&gt; org.springframework.http.client.HttpComponentsAsyncClientHttpRequestFactory
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@see&lt;/span&gt;&lt;span&gt; org.springframework.http.client.OkHttp3ClientHttpRequestFactory
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;12&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; setRequestFactory(ClientHttpRequestFactory requestFactory) {
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;     Assert.notNull(requestFactory, &quot;ClientHttpRequestFactory must not be null&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;     &lt;span&gt;this&lt;/span&gt;.requestFactory =&lt;span&gt; requestFactory;
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ClientHttpRequestFactory ä½“ç³»ç±»ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201223235414070-2083193738.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;é‚£ RestClient åˆæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„å‘¢ï¼Ÿé€šè¿‡ä¸Šä¸€èŠ‚çš„åˆ†æå¯ä»¥çŸ¥é“ï¼Œåœ¨ RibbonAutoConfiguration ä¸­æœ‰å¦‚ä¸‹çš„é…ç½®ï¼Œè¿™ä¸ª RibbonClientHttpRequestFactoryConfiguration é€šè¿‡è‡ªå®šä¹‰ RestTemplateCustomizer å‘ RestTemplate è®¾ç½®äº† requestFactory ä¸º RibbonClientHttpRequestFactoryã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; @ConditionalOnClass(HttpRequest.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;@ConditionalOnRibbonRestClient
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; RibbonClientHttpRequestFactoryConfiguration {
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;    @Autowired
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt;&lt;span&gt; SpringClientFactory springClientFactory;
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; 
&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; RestTemplateCustomizer restTemplateCustomizer(&lt;span&gt;final&lt;/span&gt;&lt;span&gt; RibbonClientHttpRequestFactory ribbonClientHttpRequestFactory) {
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; restTemplate -&amp;gt;&lt;span&gt; restTemplate.setRequestFactory(ribbonClientHttpRequestFactory);
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; 
&lt;span&gt;13&lt;/span&gt; &lt;span&gt;    @Bean
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RibbonClientHttpRequestFactory ribbonClientHttpRequestFactory() {
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RibbonClientHttpRequestFactory(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.springClientFactory);
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;RibbonClientHttpRequestFactory æ˜¯å¯¹åº” RestClient çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¦å¯ç”¨ OkHttp æˆ– HttpClientï¼Œè¿˜éœ€è‡ªå·±åˆ›å»ºå¯¹åº”çš„ ClientHttpRequestFactoryï¼Œå¹¶è®¾ç½®ç»™ RestTemplateã€‚ä»ä¸Šé¢çš„ç±»ç»“æ„å¯ä»¥çœ‹å‡ºï¼Œæ˜¯æä¾›äº† HttpComponentsClientHttpRequestFactory å’Œ OkHttp3ClientHttpRequestFactory å·¥å‚ç±»äº†çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œå…¶å®ä¹Ÿæ¯”è¾ƒå¥‡æ€ªï¼Œæ—¢ç„¶å¯ç”¨äº† apache httpcomponents æˆ–è€… OkHttpï¼Œå´æ²¡æœ‰åˆ›å»ºé»˜è®¤çš„ ClientHttpRequestFactory å®ç°ç±»è®¾ç½®ç»™ RestTemplateï¼Œæ„Ÿè§‰è¿™æ˜¯ spring-cloud-netflix-ribbon çš„ä¸€ä¸ª BUGã€‚&lt;/p&gt;
&lt;h3&gt;5ã€å®šåˆ¶ RestTemplate ä½¿ç”¨ Apache httpcomponents&lt;/h3&gt;
&lt;p&gt;å¦‚æœæƒ³è®© RestTemplate ä½¿ç”¨ httpcomponentsÂ  çš„ç»„ä»¶ï¼Œå°±éœ€è¦è‡ªå·±åˆ›å»ºä¸€ä¸ª ClientHttpRequestFactoryï¼Œå¹¶è®¾ç½®ç»™ RestTemplateã€‚ä¸‹é¢æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥çœ‹çœ‹å¦‚ä½•ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;â‘  è®¾ç½® HttpComponentsClientHttpRequestFactory&lt;/p&gt;
&lt;p&gt;httpcomponentsÂ  ä¸­æä¾›çš„ ClientHttpRequestFactory å®ç°ç±»æ˜¯ HttpComponentsClientHttpRequestFactoryï¼Œä½†æ˜¯å¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™ä¸ªå·¥å‚ç±»ï¼Œå› ä¸ºå®ƒåˆ›å»ºçš„ HttpComponentsClientHttpRequest ä¸å…·å¤‡é‡è¯•çš„èƒ½åŠ›ï¼Œå®ƒç›´æ¥ä½¿ç”¨ CloseableHttpClient æ‰§è¡Œè¯·æ±‚ï¼Œè™½ç„¶æœ‰è¶…æ—¶çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½é‡è¯•ã€‚è€Œä¸”ï¼Œå®ƒæœ¬è´¨ä¸Šä¹Ÿæ²¡æœ‰è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ï¼Œéœ€è¦å€ŸåŠ© LoadBalancerInterceptor æ‹¦æˆªå™¨æ¥é‡æ„ URIã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; HttpComponentsClientHttpRequest &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; AbstractBufferingClientHttpRequest {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; HttpClient httpClient;
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; HttpUriRequest httpRequest;
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; HttpContext httpContext;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; 
&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     &lt;span&gt;protected&lt;/span&gt; ClientHttpResponse executeInternal(HttpHeaders headers, &lt;span&gt;byte&lt;/span&gt;[] bufferedOutput) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; IOException {
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ...
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; httpClient =&amp;gt; CloseableHttpClient&lt;/span&gt;
&lt;span&gt;10&lt;/span&gt;         HttpResponse httpResponse = &lt;span&gt;this&lt;/span&gt;.httpClient.execute(&lt;span&gt;this&lt;/span&gt;.httpRequest, &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.httpContext);
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; HttpComponentsClientHttpResponse(httpResponse);
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œå¦‚æœä¸éœ€è¦é‡è¯•çš„åŠŸèƒ½ï¼Œå¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ª HttpComponentsClientHttpRequestï¼Œå¹¶è®¾ç½®ç»™ RestTemplate å³å¯ã€‚è¿™æ ·å°±ä¼šä½¿ç”¨ LoadBalancerInterceptor æ¥åšè´Ÿè½½å‡è¡¡ï¼Œé‡æ„ URIï¼Œç„¶åç”¨ HttpComponentsClientHttpRequest æ¥æ‰§è¡Œè¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;@Bean
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt; &lt;span&gt;@LoadBalanced
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt; &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RestTemplate restTemplate() {
&lt;/span&gt;&lt;span&gt;4&lt;/span&gt;     HttpComponentsClientHttpRequestFactory requestFactory = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; HttpComponentsClientHttpRequestFactory();
&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;     RestTemplate restTemplate = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RestTemplate();
&lt;/span&gt;&lt;span&gt;6&lt;/span&gt; &lt;span&gt;    restTemplate.setRequestFactory(requestFactory);
&lt;/span&gt;&lt;span&gt;7&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; restTemplate;
&lt;/span&gt;&lt;span&gt;8&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â‘¡ å®šåˆ¶ apache ClientHttpRequestFactory&lt;/p&gt;
&lt;p&gt;å¦‚æœæƒ³è®© RestTemplate å³æœ‰è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›ï¼Œåˆèƒ½ä½¿ç”¨ apache HttpComponents ç»„ä»¶ï¼Œä¸”å…·å¤‡é‡è¯•çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å°±éœ€è¦è‡ªå·±å®šåˆ¶ ClientHttpRequestFactory äº†ã€‚å…³äºé‡è¯•åé¢å†å•ç‹¬æ¥è®²ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹æ¯” RestClient å¯ä»¥å‘ç°ï¼ŒRibbonClientHttpRequestFactory åˆ›å»ºçš„ RibbonHttpRequest å…¶å®æ˜¯ä½¿ç”¨ RestClient æ‰§è¡Œè¯·æ±‚ï¼Œè€Œ RestClientÂ  å†…éƒ¨ä½¿ç”¨ LoadBalancerCommand æ¥è¿›è¡Œé‡è¯•ã€‚&lt;/p&gt;
&lt;p&gt;ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬è‡³å°‘è¦ç”¨ä¸Šå·²ç»é…ç½®å¥½çš„ RibbonLoadBalancingHttpClient æ¥æ‰§è¡Œè¯·æ±‚ï¼Œæ‰€ä»¥éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªç±»ä¼¼çš„ RibbonHttpRequest ã€‚&lt;/p&gt;
&lt;p&gt;1ï¼‰å®šåˆ¶ apache ClientHttpRequest&lt;/p&gt;
&lt;p&gt;åˆ›å»º ApacheClientHttpRequest ç»§æ‰¿è‡ª RibbonHttpRequestï¼Œæ ¸å¿ƒçš„ç‚¹åœ¨äºè¦æ³¨å…¥ RibbonLoadBalancingHttpClientï¼Œå¦‚æœè¦æ”¯æŒé‡è¯•ï¼Œéœ€æ³¨å…¥ RetryableRibbonLoadBalancingHttpClientã€‚RetryableRibbonLoadBalancingHttpClient åœ¨å¼•å…¥ spring-retry åæ‰ä¼šåˆ›å»ºï¼Œè¿™ä¸ªåé¢åˆ†æé‡è¯•æ—¶å†çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶ååœ¨ executeInternal æ ¹æ® retryable åˆ¤æ–­ï¼Œå¦‚æœè¦é‡è¯•ï¼Œå°±è°ƒç”¨ execute æ–¹æ³•ï¼Œçœ‹ RetryableRibbonLoadBalancingHttpClient çš„æºç å¯ä»¥å‘ç°ï¼Œå®ƒæœ¬èº«æ˜¯æ”¯æŒè´Ÿè½½å‡è¡¡çš„ï¼Œä¼šè‡ªåŠ¨é€‰æ‹© Serverã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸éœ€è¦é‡è¯•ï¼Œå°±éœ€è¦è°ƒç”¨ executeWithLoadBalancerï¼Œå®ƒæ˜¯åˆ©ç”¨ LoadBalancerCommand æ¥æäº¤è¯·æ±‚ï¼Œå°±è·Ÿ RestClient æ˜¯ä¸€æ ·çš„äº†ã€‚ä½†æ˜¯ä¸ä¸€æ ·çš„åœ°æ–¹æ˜¯ RibbonLoadBalancingHttpClient çš„ executeWithLoadBalancer æ˜¯ä¸ä¼šè¿›è¡Œé‡è¯•çš„ï¼Œè¿™ä¸ªä¹Ÿæ”¾åˆ°åé¢åˆ†æã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_378e88a5-0c8e-4ca7-97b2-1a5f162fcc85&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_378e88a5-0c8e-4ca7-97b2-1a5f162fcc85&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_378e88a5-0c8e-4ca7-97b2-1a5f162fcc85&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;77&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;package&lt;/span&gt;&lt;span&gt; com.lyyzoo.sunny.register.ribbon.apache;
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.io.IOException;
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.net.URI;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.ArrayList;
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; 
&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; com.netflix.client.config.IClientConfig;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; com.netflix.client.http.HttpResponse;
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.RibbonHttpRequest;
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.RibbonHttpResponse;
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.apache.RetryableRibbonLoadBalancingHttpClient;
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.apache.RibbonApacheHttpRequest;
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.apache.RibbonLoadBalancingHttpClient;
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.support.RibbonCommandContext;
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.http.HttpHeaders;
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.http.HttpMethod;
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.http.client.ClientHttpResponse;
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.util.LinkedMultiValueMap;
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; 
&lt;span&gt;20&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;21&lt;/span&gt; &lt;span&gt; * Apache ClientHttpRequest
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt; *
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@author&lt;/span&gt;&lt;span&gt; bojiangzhou
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;25&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; ApacheClientHttpRequest &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; RibbonHttpRequest {
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt; 
&lt;span&gt;27&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; URI uri;
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; 
&lt;span&gt;29&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; HttpMethod httpMethod;
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; 
&lt;span&gt;31&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; String serviceId;
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; 
&lt;span&gt;33&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; RibbonLoadBalancingHttpClient client;
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt; 
&lt;span&gt;35&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; IClientConfig config;
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;     &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;37&lt;/span&gt; &lt;span&gt;     * æ˜¯å¦é‡è¯•
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt;      &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;39&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; retryable;
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt; 
&lt;span&gt;41&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; ApacheClientHttpRequest(URI uri,
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt; &lt;span&gt;                                   HttpMethod httpMethod,
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt; &lt;span&gt;                                   String serviceId,
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt; &lt;span&gt;                                   RibbonLoadBalancingHttpClient client,
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt; &lt;span&gt;                                   IClientConfig config,
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt;                                    &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; retryable) {
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt;         &lt;span&gt;super&lt;/span&gt;(uri, &lt;span&gt;null&lt;/span&gt;, &lt;span&gt;null&lt;/span&gt;&lt;span&gt;, config);
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.uri =&lt;span&gt; uri;
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.httpMethod =&lt;span&gt; httpMethod;
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.serviceId =&lt;span&gt; serviceId;
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.client =&lt;span&gt; client;
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.config =&lt;span&gt; config;
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.retryable =&lt;span&gt; retryable;
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (retryable &amp;amp;&amp;amp; !(client &lt;span&gt;instanceof&lt;/span&gt;&lt;span&gt; RetryableRibbonLoadBalancingHttpClient)) {
&lt;/span&gt;&lt;span&gt;55&lt;/span&gt;             &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; IllegalArgumentException(&quot;Retryable client must be RetryableRibbonLoadBalancingHttpClient&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;56&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;57&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;58&lt;/span&gt; 
&lt;span&gt;59&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt;60&lt;/span&gt;     &lt;span&gt;protected&lt;/span&gt; ClientHttpResponse executeInternal(HttpHeaders headers) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; IOException {
&lt;/span&gt;&lt;span&gt;61&lt;/span&gt;         &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;62&lt;/span&gt;             RibbonCommandContext ribbonCommandContext = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RibbonCommandContext(serviceId, httpMethod.name(),
&lt;/span&gt;&lt;span&gt;63&lt;/span&gt;                     uri.toString(), retryable, headers, &lt;span&gt;new&lt;/span&gt; LinkedMultiValueMap&amp;lt;&amp;gt;(), &lt;span&gt;null&lt;/span&gt;, &lt;span&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;&lt;span&gt;());
&lt;/span&gt;&lt;span&gt;64&lt;/span&gt; 
&lt;span&gt;65&lt;/span&gt;             RibbonApacheHttpRequest request = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RibbonApacheHttpRequest(ribbonCommandContext);
&lt;/span&gt;&lt;span&gt;66&lt;/span&gt; 
&lt;span&gt;67&lt;/span&gt; &lt;span&gt;            HttpResponse response;
&lt;/span&gt;&lt;span&gt;68&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt;&lt;span&gt; (retryable) {
&lt;/span&gt;&lt;span&gt;69&lt;/span&gt;                 &lt;span&gt;//&lt;/span&gt;&lt;span&gt; RetryableRibbonLoadBalancingHttpClient æœ¬èº«å…·å¤‡è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›&lt;/span&gt;
&lt;span&gt;70&lt;/span&gt;                 response =&lt;span&gt; client.execute(request, config);
&lt;/span&gt;&lt;span&gt;71&lt;/span&gt;             } &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;72&lt;/span&gt;                 &lt;span&gt;//&lt;/span&gt;&lt;span&gt; RibbonLoadBalancingHttpClient éœ€è°ƒç”¨ executeWithLoadBalancer æ‰å…·å¤‡è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›&lt;/span&gt;
&lt;span&gt;73&lt;/span&gt;                 response =&lt;span&gt; client.executeWithLoadBalancer(request, config);
&lt;/span&gt;&lt;span&gt;74&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;75&lt;/span&gt; 
&lt;span&gt;76&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RibbonHttpResponse(response);
&lt;/span&gt;&lt;span&gt;77&lt;/span&gt;         } &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
&lt;/span&gt;&lt;span&gt;78&lt;/span&gt;             &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; IOException(e);
&lt;/span&gt;&lt;span&gt;79&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;80&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;81&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;2ï¼‰å®šåˆ¶ apache ClientHttpRequestFactory&lt;/p&gt;
&lt;p&gt;åˆ›å»º ApacheClientHttpRequestFactory ç»§æ‰¿è‡ª HttpComponentsClientHttpRequestFactoryï¼Œä¸»è¦æ˜¯åœ¨ createRequest æ–¹æ³•ä¸­åˆ›å»ºè‡ªå®šä¹‰çš„ ApacheClientHttpRequestã€‚RibbonLoadBalancingHttpClient å¯ä»¥ä» SpringClientFactory ä¸­è·å–ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36.5&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_8742c3d2-9b38-433d-a71b-261e8e9721bd&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_8742c3d2-9b38-433d-a71b-261e8e9721bd&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_8742c3d2-9b38-433d-a71b-261e8e9721bd&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;68&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;package&lt;/span&gt;&lt;span&gt; com.lyyzoo.sunny.register.ribbon.apache;
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.io.IOException;
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.net.URI;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; 
&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; com.netflix.client.config.IClientConfig;
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.SpringClientFactory;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.apache.RibbonLoadBalancingHttpClient;
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.http.HttpMethod;
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.http.client.ClientHttpRequest;
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.http.client.HttpComponentsClientHttpRequestFactory;
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.lang.NonNull;
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; 
&lt;span&gt;14&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;15&lt;/span&gt; &lt;span&gt; * Apache HttpComponents ClientHttpRequest factory
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt; *
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@author&lt;/span&gt;&lt;span&gt; bojiangzhou
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;19&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; ApacheClientHttpRequestFactory &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; HttpComponentsClientHttpRequestFactory {
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; 
&lt;span&gt;21&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; SpringClientFactory clientFactory;
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; retryable;
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; 
&lt;span&gt;24&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; ApacheClientHttpRequestFactory(SpringClientFactory clientFactory, &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; retryable) {
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.clientFactory =&lt;span&gt; clientFactory;
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.retryable =&lt;span&gt; retryable;
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; 
&lt;span&gt;29&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; &lt;span&gt;    @NonNull
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; ClientHttpRequest createRequest(URI originalUri, HttpMethod httpMethod) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; IOException {
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt;         String serviceId =&lt;span&gt; originalUri.getHost();
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (serviceId == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt;             &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; IOException(
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;                     &quot;Invalid hostname in the URI [&quot; + originalUri.toASCIIString() + &quot;]&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;         IClientConfig clientConfig = &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.clientFactory.getClientConfig(serviceId);
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt;         RibbonLoadBalancingHttpClient httpClient = &lt;span&gt;this&lt;/span&gt;.clientFactory.getClient(serviceId, RibbonLoadBalancingHttpClient.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt; 
&lt;span&gt;40&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ApacheClientHttpRequest(originalUri, httpMethod, serviceId, httpClient, clientConfig, retryable);
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;3ï¼‰å®šåˆ¶ apache ClientHttpRequestFactory é…ç½®ç±»&lt;/p&gt;
&lt;p&gt;è·Ÿ RestClient çš„é…ç½®ç±»ç±»ä¼¼ï¼Œå®šåˆ¶ ApacheClientHttpRequestFactory çš„é…ç½®ç±»ï¼ŒåŒæ ·çš„ï¼Œé»˜è®¤å¯ç”¨ httpclientã€‚åœ¨å­˜åœ¨ RetryTemplate æ—¶ï¼Œå°±è®¾ç½® ApacheClientHttpRequestFactory çš„ retryable å‚æ•°ä¸º trueï¼Œå¦åˆ™ä¸º falseã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åè‡ªå®šä¹‰ RestTemplateCustomizerï¼Œå°† ApacheClientHttpRequestFactory è®¾ç½®åˆ° RestTemplate ä¸­ï¼Œæ³¨æ„è¿™æ—¶ LoadBalancerInterceptor å°±ä¸ä¼šæ·»åŠ åˆ° RestTemplate ä¸­äº†ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_91d2f15b-f58c-483f-84eb-f09447d63736&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_91d2f15b-f58c-483f-84eb-f09447d63736&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_91d2f15b-f58c-483f-84eb-f09447d63736&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;65&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;package&lt;/span&gt;&lt;span&gt; com.lyyzoo.sunny.register.ribbon.apache;
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.apache.http.client.HttpClient;
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.beans.factory.annotation.Autowired;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.boot.autoconfigure.AutoConfigureAfter;
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.boot.autoconfigure.AutoConfigureBefore;
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.boot.autoconfigure.condition.ConditionalOnMissingClass;
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.client.loadbalancer.AsyncLoadBalancerAutoConfiguration;
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.client.loadbalancer.LoadBalancerAutoConfiguration;
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.client.loadbalancer.RestTemplateCustomizer;
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.SpringClientFactory;
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.context.annotation.Bean;
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.context.annotation.Configuration;
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.web.client.RestTemplate;
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt; 
&lt;span&gt;19&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;20&lt;/span&gt; &lt;span&gt; *
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@author&lt;/span&gt;&lt;span&gt; bojiangzhou
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;23&lt;/span&gt; &lt;span&gt;@Configuration
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; @ConditionalOnClass(RestTemplate.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; @AutoConfigureAfter(name = &quot;org.springframework.cloud.netflix.eureka.EurekaClientAutoConfiguration&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt; @AutoConfigureBefore({LoadBalancerAutoConfiguration.&lt;span&gt;class&lt;/span&gt;, AsyncLoadBalancerAutoConfiguration.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;})
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt; @ConditionalOnProperty(name = &quot;ribbon.httpclient.restTemplate.enabled&quot;, matchIfMissing = &lt;span&gt;true&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; ApacheClientHttpRequestFactoryConfiguration {
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt; 
&lt;span&gt;30&lt;/span&gt;     @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;     @ConditionalOnClass(HttpClient.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt;     @ConditionalOnProperty(name = &quot;ribbon.httpclient.enabled&quot;, matchIfMissing = &lt;span&gt;true&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;     &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; HttpComponentsClientHttpRequestFactoryConfiguration {
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt; 
&lt;span&gt;35&lt;/span&gt; &lt;span&gt;        @Autowired
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;         &lt;span&gt;private&lt;/span&gt;&lt;span&gt; SpringClientFactory springClientFactory;
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt; 
&lt;span&gt;38&lt;/span&gt; &lt;span&gt;        @Bean
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt; &lt;span&gt;        @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RestTemplateCustomizer restTemplateCustomizer(
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt;                 &lt;span&gt;final&lt;/span&gt;&lt;span&gt; ApacheClientHttpRequestFactory apacheClientHttpRequestFactory) {
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; restTemplate -&amp;gt;&lt;span&gt; restTemplate
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt; &lt;span&gt;                    .setRequestFactory(apacheClientHttpRequestFactory);
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt; 
&lt;span&gt;46&lt;/span&gt; &lt;span&gt;        @Bean
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt;         @ConditionalOnMissingClass(&quot;org.springframework.retry.support.RetryTemplate&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt;&lt;span&gt; ApacheClientHttpRequestFactory apacheClientHttpRequestFactory() {
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; ApacheClientHttpRequestFactory(springClientFactory, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt; 
&lt;span&gt;52&lt;/span&gt; &lt;span&gt;        @Bean
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt;         @ConditionalOnClass(name = &quot;org.springframework.retry.support.RetryTemplate&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt;&lt;span&gt; ApacheClientHttpRequestFactory retryableApacheClientHttpRequestFactory() {
&lt;/span&gt;&lt;span&gt;55&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; ApacheClientHttpRequestFactory(springClientFactory, &lt;span&gt;true&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;56&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;57&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;58&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;4ï¼‰ç®€å•è°ƒè¯•ä¸‹&lt;/p&gt;
&lt;p&gt;é…ç½®å¥½ä¹‹åï¼ŒæŠŠ demo-consumer æœåŠ¡å¯åŠ¨èµ·æ¥ï¼Œç®€å•æµ‹è¯•ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;a) é¦–å…ˆè¯·æ±‚ä¼šè¿›å…¥åˆ° RestTemplate çš„ doExecute ä¸­ï¼Œç„¶åé€šè¿‡ createRequestï¼Œè°ƒç”¨ ApacheClientHttpRequestFactory åˆ›å»º ApacheClientHttpRequestã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201224174545170-2139762452.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;b) æ¥ç€è°ƒç”¨ ApacheClientHttpRequest çš„ execute æ–¹æ³•ï¼Œåœ¨ ApacheClientHttpRequestÂ  çš„ executeInternal ä¸­ï¼Œå°±ä¼šè°ƒç”¨ RibbonLoadBalancingHttpClient çš„ executeWithLoadBalancer æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201224175046310-2090861344.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;c) æœ€åï¼Œè¿›å…¥ RibbonLoadBalancingHttpClient çš„ execute æ–¹æ³•ä¸­ï¼Œå®ƒåˆå°†è¯·æ±‚è½¬ç»™äº†ä»£ç†å¯¹è±¡ delegate æ¥æ‰§è¡Œï¼Œdelegate å°±æ˜¯åœ¨ HttpClientRibbonConfiguration ä¸­é…ç½®çš„ CloseableHttpClient å¯¹è±¡ï¼Œå®é™…ç±»å‹æ˜¯ InternalHttpClientã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201224175332007-889954901.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ç»è¿‡éªŒè¯ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„é…ç½®ï¼Œæœ€ç»ˆä½¿å¾— RestTemplate å¯ä»¥ä½¿ç”¨ apache httpcomponents ç»„ä»¶æ¥æ‰§è¡Œ HTTP è¯·æ±‚ã€‚é‡è¯•é‚£å—åé¢å†æ¥ç ”ç©¶ã€‚&lt;/p&gt;
&lt;p&gt;â‘¢ è¿˜æ˜¯ç”¨ä¸€å¼ å›¾æ¥æ€»ç»“ä¸‹ RestTemplate åŸºäº apache HttpClient åçš„æ‰§è¡Œæµç¨‹&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201224194200569-4872653.png&quot; width=&quot;1000&quot;/&gt;&lt;/p&gt;
&lt;h3&gt;6ã€å®šåˆ¶ RestTemplate ä½¿ç”¨ OkHttp&lt;/h3&gt;
&lt;p&gt;â‘  è®¾ç½® OkHttp3ClientHttpRequestFactory&lt;/p&gt;
&lt;p&gt;ç±»ä¼¼çš„ï¼Œå¯ä»¥ç»™ RestTemplate ç›´æ¥è®¾ç½® OkHttp3ClientHttpRequestFactoryï¼Œä½†å®ƒåŒæ ·ä¹Ÿä¸å…·å¤‡é‡è¯•çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;@Bean
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt; &lt;span&gt;@LoadBalanced
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt; &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RestTemplate restTemplate() {
&lt;/span&gt;&lt;span&gt;4&lt;/span&gt;     OkHttp3ClientHttpRequestFactory requestFactory = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; OkHttp3ClientHttpRequestFactory();
&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;     RestTemplate restTemplate = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RestTemplate();
&lt;/span&gt;&lt;span&gt;6&lt;/span&gt; &lt;span&gt;    restTemplate.setRequestFactory(requestFactory);
&lt;/span&gt;&lt;span&gt;7&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; restTemplate;
&lt;/span&gt;&lt;span&gt;8&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â‘¡ å®šåˆ¶ OkHttp ClientHttpRequestFactory&lt;/p&gt;
&lt;p&gt;ä¸å®šåˆ¶ apache httpcomponentsÂ  ç±»ä¼¼ï¼Œæˆ‘è¿™é‡Œå°±ç›´æ¥æŠŠä¸‰ä¸ªç±»çš„ä»£ç æ”¾å‡ºæ¥äº†ã€‚&lt;/p&gt;
&lt;p&gt;a) OkHttpClientHttpRequestï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_787c2791-fd32-49b3-9525-a00c995f2b51&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_787c2791-fd32-49b3-9525-a00c995f2b51&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_787c2791-fd32-49b3-9525-a00c995f2b51&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;77&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;package&lt;/span&gt;&lt;span&gt; com.lyyzoo.sunny.register.ribbon.okhttp;
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.io.IOException;
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.net.URI;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.util.ArrayList;
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; 
&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; com.netflix.client.config.IClientConfig;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; com.netflix.client.http.HttpResponse;
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.RibbonHttpRequest;
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.RibbonHttpResponse;
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.okhttp.OkHttpLoadBalancingClient;
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.okhttp.OkHttpRibbonRequest;
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.okhttp.RetryableOkHttpLoadBalancingClient;
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.support.RibbonCommandContext;
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.http.HttpHeaders;
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.http.HttpMethod;
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.http.client.ClientHttpResponse;
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.util.LinkedMultiValueMap;
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; 
&lt;span&gt;20&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;21&lt;/span&gt; &lt;span&gt; * OkHttp ClientHttpRequest
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt; *
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@author&lt;/span&gt;&lt;span&gt; bojiangzhou
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;25&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; OkHttpClientHttpRequest &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; RibbonHttpRequest {
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt; 
&lt;span&gt;27&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; URI uri;
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; 
&lt;span&gt;29&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; HttpMethod httpMethod;
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; 
&lt;span&gt;31&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; String serviceId;
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; 
&lt;span&gt;33&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; OkHttpLoadBalancingClient client;
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt; 
&lt;span&gt;35&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; IClientConfig config;
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;     &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;37&lt;/span&gt; &lt;span&gt;     * æ˜¯å¦é‡è¯•
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt;      &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;39&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; retryable;
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt; 
&lt;span&gt;41&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt;&lt;span&gt; OkHttpClientHttpRequest(URI uri,
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt; &lt;span&gt;                                   HttpMethod httpMethod,
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt; &lt;span&gt;                                   String serviceId,
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt; &lt;span&gt;                                   OkHttpLoadBalancingClient client,
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt; &lt;span&gt;                                   IClientConfig config,
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt;                                    &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; retryable) {
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt;         &lt;span&gt;super&lt;/span&gt;(uri, &lt;span&gt;null&lt;/span&gt;, &lt;span&gt;null&lt;/span&gt;&lt;span&gt;, config);
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.uri =&lt;span&gt; uri;
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.httpMethod =&lt;span&gt; httpMethod;
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.serviceId =&lt;span&gt; serviceId;
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.client =&lt;span&gt; client;
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.config =&lt;span&gt; config;
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.retryable =&lt;span&gt; retryable;
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (retryable &amp;amp;&amp;amp; !(client &lt;span&gt;instanceof&lt;/span&gt;&lt;span&gt; RetryableOkHttpLoadBalancingClient)) {
&lt;/span&gt;&lt;span&gt;55&lt;/span&gt;             &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; IllegalArgumentException(&quot;Retryable client must be RetryableOkHttpLoadBalancingClient&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;56&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;57&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;58&lt;/span&gt; 
&lt;span&gt;59&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt;60&lt;/span&gt;     &lt;span&gt;protected&lt;/span&gt; ClientHttpResponse executeInternal(HttpHeaders headers) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; IOException {
&lt;/span&gt;&lt;span&gt;61&lt;/span&gt;         &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;62&lt;/span&gt;             RibbonCommandContext ribbonCommandContext = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RibbonCommandContext(serviceId, httpMethod.name(),
&lt;/span&gt;&lt;span&gt;63&lt;/span&gt;                     uri.toString(), retryable, headers, &lt;span&gt;new&lt;/span&gt; LinkedMultiValueMap&amp;lt;&amp;gt;(), &lt;span&gt;null&lt;/span&gt;, &lt;span&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;&lt;span&gt;());
&lt;/span&gt;&lt;span&gt;64&lt;/span&gt; 
&lt;span&gt;65&lt;/span&gt;             OkHttpRibbonRequest request = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; OkHttpRibbonRequest(ribbonCommandContext);
&lt;/span&gt;&lt;span&gt;66&lt;/span&gt; 
&lt;span&gt;67&lt;/span&gt; &lt;span&gt;            HttpResponse response;
&lt;/span&gt;&lt;span&gt;68&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt;&lt;span&gt; (retryable) {
&lt;/span&gt;&lt;span&gt;69&lt;/span&gt;                 &lt;span&gt;//&lt;/span&gt;&lt;span&gt; RetryableRibbonLoadBalancingHttpClient æœ¬èº«å…·å¤‡è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›&lt;/span&gt;
&lt;span&gt;70&lt;/span&gt;                 response =&lt;span&gt; client.execute(request, config);
&lt;/span&gt;&lt;span&gt;71&lt;/span&gt;             } &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;72&lt;/span&gt;                 &lt;span&gt;//&lt;/span&gt;&lt;span&gt; RibbonLoadBalancingHttpClient éœ€è°ƒç”¨ executeWithLoadBalancer æ‰å…·å¤‡è´Ÿè½½å‡è¡¡çš„èƒ½åŠ›&lt;/span&gt;
&lt;span&gt;73&lt;/span&gt;                 response =&lt;span&gt; client.executeWithLoadBalancer(request, config);
&lt;/span&gt;&lt;span&gt;74&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;75&lt;/span&gt; 
&lt;span&gt;76&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RibbonHttpResponse(response);
&lt;/span&gt;&lt;span&gt;77&lt;/span&gt;         } &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
&lt;/span&gt;&lt;span&gt;78&lt;/span&gt;             &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; IOException(e);
&lt;/span&gt;&lt;span&gt;79&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;80&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;81&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;b) OkHttpClientHttpRequestFactory&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36.5&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_3ed7ca81-b07b-49fb-a365-e27447c34a08&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_3ed7ca81-b07b-49fb-a365-e27447c34a08&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_3ed7ca81-b07b-49fb-a365-e27447c34a08&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;68&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;package&lt;/span&gt;&lt;span&gt; com.lyyzoo.sunny.register.ribbon.okhttp;
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.io.IOException;
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; java.net.URI;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; 
&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; com.netflix.client.config.IClientConfig;
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.SpringClientFactory;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.okhttp.OkHttpLoadBalancingClient;
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.http.HttpMethod;
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.http.client.ClientHttpRequest;
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.http.client.HttpComponentsClientHttpRequestFactory;
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.lang.NonNull;
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; 
&lt;span&gt;14&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;15&lt;/span&gt; &lt;span&gt; * OkHttp ClientHttpRequest factory
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt; *
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@author&lt;/span&gt;&lt;span&gt; bojiangzhou
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;19&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt; OkHttpClientHttpRequestFactory &lt;span&gt;extends&lt;/span&gt;&lt;span&gt; HttpComponentsClientHttpRequestFactory {
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; 
&lt;span&gt;21&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; SpringClientFactory clientFactory;
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;     &lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; retryable;
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; 
&lt;span&gt;24&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; OkHttpClientHttpRequestFactory(SpringClientFactory clientFactory, &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; retryable) {
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.clientFactory =&lt;span&gt; clientFactory;
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;         &lt;span&gt;this&lt;/span&gt;.retryable =&lt;span&gt; retryable;
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; 
&lt;span&gt;29&lt;/span&gt; &lt;span&gt;    @Override
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt; &lt;span&gt;    @NonNull
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;     &lt;span&gt;public&lt;/span&gt; ClientHttpRequest createRequest(URI originalUri, HttpMethod httpMethod) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; IOException {
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt;         String serviceId =&lt;span&gt; originalUri.getHost();
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (serviceId == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt;             &lt;span&gt;throw&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; IOException(
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;                     &quot;Invalid hostname in the URI [&quot; + originalUri.toASCIIString() + &quot;]&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;         IClientConfig clientConfig = &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.clientFactory.getClientConfig(serviceId);
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt;         OkHttpLoadBalancingClient httpClient = &lt;span&gt;this&lt;/span&gt;.clientFactory.getClient(serviceId, OkHttpLoadBalancingClient.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt; 
&lt;span&gt;40&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; OkHttpClientHttpRequest(originalUri, httpMethod, serviceId, httpClient, clientConfig, retryable);
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;c) OkHttpClientHttpRequestFactoryConfiguration&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34.5&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_2b88852b-fe43-4ec8-96fe-cc592d096ec6&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_2b88852b-fe43-4ec8-96fe-cc592d096ec6&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_2b88852b-fe43-4ec8-96fe-cc592d096ec6&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;64&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;package&lt;/span&gt;&lt;span&gt; com.lyyzoo.sunny.register.ribbon.okhttp;
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.beans.factory.annotation.Autowired;
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.boot.autoconfigure.AutoConfigureAfter;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.boot.autoconfigure.AutoConfigureBefore;
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.boot.autoconfigure.condition.ConditionalOnClass;
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.boot.autoconfigure.condition.ConditionalOnMissingClass;
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.client.loadbalancer.AsyncLoadBalancerAutoConfiguration;
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.client.loadbalancer.LoadBalancerAutoConfiguration;
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.client.loadbalancer.RestTemplateCustomizer;
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.cloud.netflix.ribbon.SpringClientFactory;
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.context.annotation.Bean;
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.context.annotation.Configuration;
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; org.springframework.web.client.RestTemplate;
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; 
&lt;span&gt;18&lt;/span&gt; &lt;span&gt;/**&lt;/span&gt;
&lt;span&gt;19&lt;/span&gt; &lt;span&gt; *
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt; * &lt;/span&gt;&lt;span&gt;@author&lt;/span&gt;&lt;span&gt; bojiangzhou
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt;  &lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;22&lt;/span&gt; &lt;span&gt;@Configuration
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; @ConditionalOnClass(RestTemplate.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; @AutoConfigureAfter(name = &quot;org.springframework.cloud.netflix.eureka.EurekaClientAutoConfiguration&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; @AutoConfigureBefore({LoadBalancerAutoConfiguration.&lt;span&gt;class&lt;/span&gt;, AsyncLoadBalancerAutoConfiguration.&lt;span&gt;class&lt;/span&gt;&lt;span&gt;})
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt; @ConditionalOnProperty(name = &quot;ribbon.okhttp.restTemplate.enabled&quot;, matchIfMissing = &lt;span&gt;true&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; OkHttpClientHttpRequestFactoryConfiguration {
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; 
&lt;span&gt;29&lt;/span&gt;     @Configuration(proxyBeanMethods = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt;     @ConditionalOnProperty(&quot;ribbon.okhttp.enabled&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;     @ConditionalOnClass(name = &quot;okhttp3.OkHttpClient&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt;     &lt;span&gt;static&lt;/span&gt; &lt;span&gt;class&lt;/span&gt;&lt;span&gt; ClientHttpRequestFactoryConfiguration {
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; 
&lt;span&gt;34&lt;/span&gt; &lt;span&gt;        @Autowired
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;         &lt;span&gt;private&lt;/span&gt;&lt;span&gt; SpringClientFactory springClientFactory;
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt; 
&lt;span&gt;37&lt;/span&gt; &lt;span&gt;        @Bean
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt; &lt;span&gt;        @ConditionalOnMissingBean
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RestTemplateCustomizer restTemplateCustomizer(
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt;                 &lt;span&gt;final&lt;/span&gt;&lt;span&gt; OkHttpClientHttpRequestFactory okHttpClientHttpRequestFactory) {
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; restTemplate -&amp;gt;&lt;span&gt; restTemplate
&lt;/span&gt;&lt;span&gt;42&lt;/span&gt; &lt;span&gt;                    .setRequestFactory(okHttpClientHttpRequestFactory);
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt; 
&lt;span&gt;45&lt;/span&gt; &lt;span&gt;        @Bean
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt;         @ConditionalOnMissingClass(&quot;org.springframework.retry.support.RetryTemplate&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt;&lt;span&gt; OkHttpClientHttpRequestFactory okHttpClientHttpRequestFactory() {
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; OkHttpClientHttpRequestFactory(springClientFactory, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt; 
&lt;span&gt;51&lt;/span&gt; &lt;span&gt;        @Bean
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt;         @ConditionalOnClass(name = &quot;org.springframework.retry.support.RetryTemplate&quot;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt;&lt;span&gt; OkHttpClientHttpRequestFactory retryableOkHttpClientHttpRequestFactory() {
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; OkHttpClientHttpRequestFactory(springClientFactory, &lt;span&gt;true&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;55&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;56&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;57&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;h2&gt;ä¸ƒã€RestTemplate è¶…æ—¶é‡è¯•&lt;/h2&gt;
&lt;h3&gt;1ã€AbstractLoadBalancerAwareClient&lt;/h3&gt;
&lt;p&gt;â‘  AbstractLoadBalancerAwareClient&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¸Šä¸€èŠ‚çš„åˆ†æï¼Œå¯ä»¥çŸ¥é“æœ‰é‡è¯•åŠŸèƒ½çš„å…¶å®æœ‰ä¸¤ä¸ªç»„ä»¶ï¼Œä¸€ä¸ªæ˜¯ Ribbon çš„ LoadBalancerCommandï¼Œä¸€ä¸ªæ˜¯ spring-retry çš„ RetryTemplateã€‚RetryableRibbonLoadBalancingHttpClient å’Œ RetryableOkHttpLoadBalancingClient éƒ½è¦ä¾èµ– RetryTemplateï¼Œæ‰€ä»¥å¿…é¡»å…ˆå¼•å…¥ spring-retry ä¾èµ–ï¼Œå®ƒä»¬æœ€ç»ˆéƒ½æ˜¯ä½¿ç”¨ RetryTemplate å®ç°è¯·æ±‚é‡è¯•çš„èƒ½åŠ›çš„ã€‚é™¤äº† RetryTemplateï¼Œå…¶å®ƒå®¢æˆ·ç«¯æƒ³è¦è·å–é‡è¯•çš„åŠŸèƒ½ï¼Œå°±è¦ç”¨ ribbon ä¸­çš„Â AbstractLoadBalancerAwareClient ç›¸å…³çš„ç»„ä»¶ï¼Œå¹¶è°ƒç”¨ executeWithLoadBalancer æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å†çœ‹ä¸‹ AbstractLoadBalancerAwareClient çš„ä½“ç³»ï¼Œé€šè¿‡æºç å¯ä»¥äº†è§£åˆ°ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;RetryableFeignLoadBalancerã€RetryableRibbonLoadBalancingHttpClientã€RetryableOkHttpLoadBalancingClient éƒ½æ˜¯ä½¿ç”¨ RetryTemplate å®ç°é‡è¯•åŠŸèƒ½çš„ï¼Œä¹Ÿå°±æ˜¯ spring-retry çš„é‡è¯•ã€‚&lt;/li&gt;
&lt;li&gt;RestClientã€FeignLoadBalancerã€RibbonLoadBalancingHttpClientã€OkHttpLoadBalancingClient æ˜¯åœ¨ AbstractLoadBalancerAwareClient ä¸­ä½¿ç”¨ LoadBalancerCommand å®ç°é‡è¯•åŠŸèƒ½çš„ï¼Œå°±æ˜¯æ˜¯ Ribbon çš„é‡è¯•ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;img src=&quot;https://img2020.cnblogs.com/blog/856154/202012/856154-20201223212456447-1178386001.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;â‘¡ executeWithLoadBalancer&lt;/p&gt;
&lt;p&gt;å…·ä½“çš„ AbstractLoadBalancerAwareClient å®¢æˆ·ç«¯æƒ³è¦è´Ÿè½½å‡è¡¡è°ƒç”¨ä»¥åŠèƒ½è¿›è¡Œé‡è¯•ï¼Œéœ€è°ƒç”¨ AbstractLoadBalancerAwareClient çš„ executeWithLoadBalancer æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ï¼Œå®ƒå…ˆæ„å»ºäº† LoadBalancerCommandï¼Œç„¶åç”¨ command æäº¤äº†ä¸€ä¸ª ServerOperationï¼Œè¿™ä¸ª ServerOperation ä¸­å¯¹ URI è¿›è¡Œäº† é‡æ„ï¼Œè½¬åˆ°å…·ä½“çš„ LoadBalancerContext å»æ‰§è¡Œè¯·æ±‚ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; T executeWithLoadBalancer(&lt;span&gt;final&lt;/span&gt; S request, &lt;span&gt;final&lt;/span&gt; IClientConfig requestConfig) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; ClientException {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è´Ÿè½½å‡è¡¡å‘½ä»¤&lt;/span&gt;
&lt;span&gt; 3&lt;/span&gt;     LoadBalancerCommand&amp;lt;T&amp;gt; command =&lt;span&gt; buildLoadBalancerCommand(request, requestConfig);
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; 
&lt;span&gt; 5&lt;/span&gt;     &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; command.submit(
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;             &lt;span&gt;new&lt;/span&gt; ServerOperation&amp;lt;T&amp;gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;                @Override
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;                 &lt;span&gt;public&lt;/span&gt; Observable&amp;lt;T&amp;gt;&lt;span&gt; call(Server server) {
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;                     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; é‡æ„URI&lt;/span&gt;
&lt;span&gt;11&lt;/span&gt;                     URI finalUri =&lt;span&gt; reconstructURIWithServer(server, request.getUri());
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;                     S requestForServer =&lt;span&gt; (S) request.replaceUri(finalUri);
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;                     &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;                         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä½¿ç”¨å…·ä½“çš„ AbstractLoadBalancerAwareClient å®¢æˆ·ç«¯æ‰§è¡Œè¯·æ±‚&lt;/span&gt;
&lt;span&gt;15&lt;/span&gt;                         &lt;span&gt;return&lt;/span&gt; Observable.just(AbstractLoadBalancerAwareClient.&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.execute(requestForServer, requestConfig));
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;                     &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Exception e) {
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;                         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; Observable.error(e);
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;                    }
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; &lt;span&gt;            })
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt;            .toBlocking()
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; &lt;span&gt;            .single();
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å†çœ‹ buildLoadBalancerCommand æ–¹æ³•ï¼Œå®ƒé¦–å…ˆä¼šé€šè¿‡ getRequestSpecificRetryHandler æ–¹æ³•è·å–è¯·æ±‚é‡è¯•å¤„ç†å™¨ RequestSpecificRetryHandlerï¼Œè€Œ getRequestSpecificRetryHandler æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚è¿™é‡Œå°±è¦é‡ç‚¹æ³¨æ„äº†ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; æŠ½è±¡æ–¹æ³•ï¼Œè·å–è¯·æ±‚é‡è¯•å¤„ç†å™¨&lt;/span&gt;
&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;abstract&lt;/span&gt;&lt;span&gt; RequestSpecificRetryHandler getRequestSpecificRetryHandler(S request, IClientConfig requestConfig);
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; 
&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;protected&lt;/span&gt; LoadBalancerCommand&amp;lt;T&amp;gt; buildLoadBalancerCommand(&lt;span&gt;final&lt;/span&gt; S request, &lt;span&gt;final&lt;/span&gt;&lt;span&gt; IClientConfig config) {
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å–è¯·æ±‚é‡è¯•å¤„ç†å™¨&lt;/span&gt;
&lt;span&gt; 6&lt;/span&gt;     RequestSpecificRetryHandler handler =&lt;span&gt; getRequestSpecificRetryHandler(request, config);
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     LoadBalancerCommand.Builder&amp;lt;T&amp;gt; builder = LoadBalancerCommand.&amp;lt;T&amp;gt;&lt;span&gt;builder()
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;             .withLoadBalancerContext(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;            .withRetryHandler(handler)
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;            .withLoadBalancerURI(request.getUri());
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt; &lt;span&gt;    customizeLoadBalancerCommandBuilder(request, config, builder);
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; builder.build();
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2ã€è¯·æ±‚é‡è¯•å¤„ç†å™¨ RequestSpecificRetryHandler&lt;/h3&gt;
&lt;p&gt;â‘  å…ˆäº†è§£ä¸‹ RequestSpecificRetryHandlerï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;é¦–å…ˆçœ‹å®ƒçš„æ„é€ æ–¹æ³•ï¼Œæ³¨æ„ç¬¬ä¸€ä¸ªå‚æ•°å’Œç¬¬äºŒä¸ªå‚æ•°ï¼Œå› ä¸ºä¸åŒçš„ getRequestSpecificRetryHandler æ–¹æ³•å®ç°ï¼Œä¸»è¦å·®å¼‚å°±åœ¨äºè¿™ä¸¤ä¸ªå‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åçœ‹ isRetriableExceptionï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯ LoadBalancerCommand ç”¨æ¥åˆ¤æ–­å¼‚å¸¸åæ˜¯å¦éœ€è¦é‡è¯•çš„æ–¹æ³•ï¼Œå¯ä»¥äº†è§£åˆ° okToRetryOnAllErrors=true æ—¶å°±å¯ä»¥é‡è¯•ï¼Œå¦åˆ™ okToRetryOnConnectErrors=true æ‰å¯èƒ½é‡è¯•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å°±ç®—è¿™ä¸ªæ–¹æ³•è¿”å› true ä¹Ÿä¸ä¸€å®šä¼šé‡è¯•ï¼Œè¿™è·Ÿé‡è¯•æ¬¡æ•°ä¹Ÿæ˜¯æœ‰ä¸€å®šå…³ç³»çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; RequestSpecificRetryHandler(&lt;span&gt;boolean&lt;/span&gt; okToRetryOnConnectErrors, &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; okToRetryOnAllErrors, RetryHandler baseRetryHandler, @Nullable IClientConfig requestConfig) {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;    Preconditions.checkNotNull(baseRetryHandler);
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;     &lt;span&gt;this&lt;/span&gt;.okToRetryOnConnectErrors =&lt;span&gt; okToRetryOnConnectErrors;
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;this&lt;/span&gt;.okToRetryOnAllErrors =&lt;span&gt; okToRetryOnAllErrors;
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;     &lt;span&gt;this&lt;/span&gt;.fallback =&lt;span&gt; baseRetryHandler;
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (requestConfig != &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åœ¨åŒä¸€ä¸ªServerä¸Šé‡è¯•çš„æ¬¡æ•°&lt;/span&gt;
&lt;span&gt; 8&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt;&lt;span&gt; (requestConfig.containsProperty(CommonClientConfigKey.MaxAutoRetries)) {
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;             retrySameServer =&lt;span&gt; requestConfig.get(CommonClientConfigKey.MaxAutoRetries);
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; é‡è¯•ä¸‹ä¸€ä¸ªServerçš„æ¬¡æ•°&lt;/span&gt;
&lt;span&gt;12&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt;&lt;span&gt; (requestConfig.containsProperty(CommonClientConfigKey.MaxAutoRetriesNextServer)) {
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;             retryNextServer =&lt;span&gt; requestConfig.get(CommonClientConfigKey.MaxAutoRetriesNextServer);
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; 
&lt;span&gt;18&lt;/span&gt; &lt;span&gt;@Override
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt; isRetriableException(Throwable e, &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; sameServer) {
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ‰€æœ‰é”™è¯¯éƒ½é‡è¯•&lt;/span&gt;
&lt;span&gt;21&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt;&lt;span&gt; (okToRetryOnAllErrors) {
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ClientException æ‰å¯èƒ½é‡è¯•&lt;/span&gt;
&lt;span&gt;25&lt;/span&gt;     &lt;span&gt;else&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; (e &lt;span&gt;instanceof&lt;/span&gt;&lt;span&gt; ClientException) {
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;         ClientException ce =&lt;span&gt; (ClientException) e;
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (ce.getErrorType() ==&lt;span&gt; ClientException.ErrorType.SERVER_THROTTLED) {
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; !&lt;span&gt;sameServer;
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt;         } &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt;     &lt;span&gt;else&lt;/span&gt;&lt;span&gt;  {
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è¿æ¥é”™è¯¯æ‰é‡è¯•ï¼Œå°±æ˜¯æŠ›å‡º SocketException å¼‚å¸¸æ—¶æ‰é‡è¯•&lt;/span&gt;
&lt;span&gt;35&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; okToRetryOnConnectErrors &amp;amp;&amp;amp;&lt;span&gt; isConnectionException(e);
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â‘¡ ä¸åŒ LoadBalancerCommand çš„ getRequestSpecificRetryHandler å®ç°&lt;/p&gt;
&lt;p&gt;aï¼‰RestClient&lt;/p&gt;
&lt;p&gt;é»˜è®¤é…ç½®ä¸‹ï¼ŒRestClient çš„ getRequestSpecificRetryHandler ä¼šèµ°åˆ°æœ€åä¸€æ­¥ï¼ŒokToRetryOnConnectErrorsã€okToRetryOnAllErrors éƒ½ä¸º trueï¼Œä¹Ÿå°±æ˜¯è¯´ isRetriableException å§‹ç»ˆè¿”å› trueï¼Œä¹Ÿå°±æ˜¯è¯´æŠ›å‡ºå¼‚å¸¸éƒ½ä¼šé‡è¯•ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;49&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;@Override
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RequestSpecificRetryHandler getRequestSpecificRetryHandler(
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;        HttpRequest request, IClientConfig requestConfig) {
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!&lt;span&gt;request.isRetriable()) {
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RequestSpecificRetryHandler(&lt;span&gt;false&lt;/span&gt;, &lt;span&gt;false&lt;/span&gt;, &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.getRetryHandler(), requestConfig);
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;this&lt;/span&gt;.ncc.get(CommonClientConfigKey.OkToRetryOnAllOperations, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;)) {
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RequestSpecificRetryHandler(&lt;span&gt;true&lt;/span&gt;, &lt;span&gt;true&lt;/span&gt;, &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.getRetryHandler(), requestConfig);
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (request.getVerb() !=&lt;span&gt; HttpRequest.Verb.GET) {
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RequestSpecificRetryHandler(&lt;span&gt;true&lt;/span&gt;, &lt;span&gt;false&lt;/span&gt;, &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.getRetryHandler(), requestConfig);
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;     } &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; okToRetryOnConnectErrorsã€okToRetryOnAllErrors éƒ½ä¸º true&lt;/span&gt;
&lt;span&gt;14&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RequestSpecificRetryHandler(&lt;span&gt;true&lt;/span&gt;, &lt;span&gt;true&lt;/span&gt;, &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.getRetryHandler(), requestConfig);
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;bï¼‰AbstractLoadBalancingClient&lt;/p&gt;
&lt;p&gt;AbstractLoadBalancingClient ä¸­çš„ getRequestSpecificRetryHandler ç›¸å½“äºä¸€ä¸ªé»˜è®¤å®ç°ï¼Œé»˜è®¤æƒ…å†µä¸‹ okToRetryOnAllOperations ä¸º falseï¼Œæœ€åä¹Ÿä¼šåˆ°æœ€åä¸€æ­¥ï¼Œå³ okToRetryOnConnectErrorsã€okToRetryOnAllErrors éƒ½ä¸º trueï¼ŒisRetriableException å§‹ç»ˆè¿”å› trueã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;45&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;@Override
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; RequestSpecificRetryHandler getRequestSpecificRetryHandler(&lt;span&gt;final&lt;/span&gt; S request, &lt;span&gt;final&lt;/span&gt;&lt;span&gt; IClientConfig requestConfig) {
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; okToRetryOnAllOperationsï¼šæ˜¯å¦æ‰€æœ‰æ“ä½œéƒ½é‡è¯•ï¼Œé»˜è®¤ false&lt;/span&gt;
&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.okToRetryOnAllOperations) {
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RequestSpecificRetryHandler(&lt;span&gt;true&lt;/span&gt;, &lt;span&gt;true&lt;/span&gt;, &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.getRetryHandler(), requestConfig);
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!request.getContext().getMethod().equals(&quot;GET&quot;&lt;span&gt;)) {
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RequestSpecificRetryHandler(&lt;span&gt;true&lt;/span&gt;, &lt;span&gt;false&lt;/span&gt;, &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.getRetryHandler(), requestConfig);
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;     &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RequestSpecificRetryHandler(&lt;span&gt;true&lt;/span&gt;, &lt;span&gt;true&lt;/span&gt;, &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.getRetryHandler(), requestConfig);
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;cï¼‰RibbonLoadBalancingHttpClient&lt;/p&gt;
&lt;p&gt;RibbonLoadBalancingHttpClient ä¹Ÿé‡è½½äº† getRequestSpecificRetryHandlerï¼Œä½†æ˜¯å®ƒè®¾ç½®äº† okToRetryOnConnectErrorsã€okToRetryOnAllErrors éƒ½ä¸º falseï¼ŒisRetriableException å§‹ç»ˆè¿”å› falseã€‚&lt;/p&gt;
&lt;p&gt;è‡³æ­¤æˆ‘ä»¬åº”è¯¥å°±çŸ¥é“ä¸ºä»€ä¹ˆè°ƒç”¨ RibbonLoadBalancingHttpClient çš„ executeWithLoadBalancer ä¸å…·å¤‡é‡è¯•çš„åŠŸèƒ½çš„åŸå› äº†ã€‚æ‰€ä»¥å¯ç”¨ apache httpclient æ—¶ï¼ŒRibbonLoadBalancingHttpClient è°ƒç”¨æ˜¯ä¸æ”¯æŒé‡è¯•çš„ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;@Override
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt; &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RequestSpecificRetryHandler getRequestSpecificRetryHandler(RibbonApacheHttpRequest request, IClientConfig requestConfig) {
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; okToRetryOnConnectErrorsã€okToRetryOnAllErrors éƒ½ä¸º false&lt;/span&gt;
&lt;span&gt;4&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RequestSpecificRetryHandler(&lt;span&gt;false&lt;/span&gt;, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;, RetryHandler.DEFAULT, requestConfig);
&lt;/span&gt;&lt;span&gt;5&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;RetryableRibbonLoadBalancingHttpClient ä¸­ä¹Ÿé‡å†™äº† getRequestSpecificRetryHandlerï¼ŒåŒæ ·ä¹Ÿæ˜¯è®¾ç½® okToRetryOnConnectErrorsã€okToRetryOnAllErrors éƒ½ä¸º falseã€‚ä½†æ˜¯åœ¨å¼•å…¥ spring-retry åï¼Œå®ƒä¼šä½¿ç”¨ RetryTemplate å®ç°é‡è¯•çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;@Override
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt; &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RequestSpecificRetryHandler getRequestSpecificRetryHandler(RibbonApacheHttpRequest request, IClientConfig requestConfig) {
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; okToRetryOnConnectErrorsã€okToRetryOnAllErrors éƒ½ä¸º false&lt;/span&gt;
&lt;span&gt;4&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RequestSpecificRetryHandler(&lt;span&gt;false&lt;/span&gt;, &lt;span&gt;false&lt;/span&gt;, RetryHandler.DEFAULT, &lt;span&gt;null&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;5&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;dï¼‰OkHttpLoadBalancingClient&lt;/p&gt;
&lt;p&gt;OkHttpLoadBalancingClient å¹¶æ²¡æœ‰é‡å†™ getRequestSpecificRetryHandlerï¼Œæ‰€ä»¥å®ƒæ˜¯ä½¿ç”¨çˆ¶ç±» AbstractLoadBalancingClient ä¸­çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ okToRetryOnConnectErrorsã€okToRetryOnAllErrors éƒ½ä¸º trueã€‚æ‰€ä»¥ï¼Œå¯ç”¨ okhttp æ—¶ï¼ŒOkHttpLoadBalancingClient æ˜¯æ”¯æŒé‡è¯•çš„ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ã€‚&lt;/p&gt;
&lt;p&gt;è€Œ RetryableOkHttpLoadBalancingClient è·Ÿ RetryableRibbonLoadBalancingHttpClient ä¸€æ ·çš„é‡å†™æ–¹å¼ï¼Œä½¿ç”¨ RetryTemplate å®ç°é‡è¯•ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;@Override
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt; &lt;span&gt;public&lt;/span&gt;&lt;span&gt; RequestSpecificRetryHandler getRequestSpecificRetryHandler(RibbonApacheHttpRequest request, IClientConfig requestConfig) {
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; okToRetryOnConnectErrorsã€okToRetryOnAllErrors éƒ½ä¸º false&lt;/span&gt;
&lt;span&gt;4&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; RequestSpecificRetryHandler(&lt;span&gt;false&lt;/span&gt;, &lt;span&gt;false&lt;/span&gt;, RetryHandler.DEFAULT, &lt;span&gt;null&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt;5&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;3ã€LoadBalancerCommand&lt;/h3&gt;
&lt;p&gt;çœ‹ LoadBalancerCommand çš„ submit æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯é‡è¯•çš„æ ¸å¿ƒä»£ç ã€‚&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;é¦–å…ˆè·å–äº†åŒä¸€ä¸ªServeré‡è¯•æ¬¡æ•° maxRetrysSame å’Œ é‡è¯•ä¸‹ä¸€ä¸ªServerçš„æ¬¡æ•° maxRetrysNextï¼Œå…¶å®å°±æ˜¯å‰é¢é…ç½®çš„ ribbon.MaxAutoRetries å’Œ ribbon.MaxAutoRetriesNextServerï¼Œæˆ‘è®¾ç½®çš„æ˜¯ 1ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶ååˆ›å»ºäº†ä¸€ä¸ª Observableï¼Œå®ƒçš„ç¬¬ä¸€å±‚ä¼šå…ˆé€šè¿‡ loadBalancerContext è·å– Serverã€‚åœ¨é‡è¯•ä¸‹ä¸€ä¸ª Server æ—¶ï¼Œè¿™é‡Œå°±ä¼šè·å–ä¸‹ä¸€ä¸ª Serverã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ç¬¬äºŒå±‚ï¼Œåˆåˆ›å»ºäº†ä¸€ä¸ª Observableï¼Œè¿™ä¸ª Observable å°±æ˜¯è°ƒç”¨ ServerOperation çš„ï¼Œå°±æ˜¯é‡æ„ URIï¼Œè°ƒç”¨å…·ä½“çš„ AbstractLoadBalancerAwareClient æ‰§è¡Œè¯·æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ç¬¬äºŒå±‚é‡Œï¼Œä¼šæ ¹æ® maxRetrysSame é‡è¯•åŒä¸€ä¸ª Serverï¼Œä» retryPolicy ä¸­å¯ä»¥äº†è§£åˆ°ï¼Œå½“é‡è¯•æ¬¡æ•°å¤§äº maxRetrysSame åï¼ŒåŒä¸€ä¸ª Server é‡è¯•å°±ç»“æŸäº†ï¼Œå¦åˆ™å°±ç”¨ retryHandler.isRetriableException åˆ¤æ–­æ˜¯å¦é‡è¯•ï¼Œè¿™ä¸ªå‰é¢å·²ç»åˆ†æè¿‡äº†ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨å¤–å±‚ï¼Œåˆ™æ ¹æ® maxRetrysNext é‡è¯•ä¸åŒçš„ Serverï¼Œä» retryPolicy ä¸­å¯ä»¥äº†è§£åˆ°ï¼Œå½“ä¸åŒServeré‡è¯•æ¬¡æ•°å¤§äº maxRetrysNext åï¼Œå°±é‡è¯•ç»“æŸäº†ï¼Œæ•´ä¸ªé‡è¯•ä¹Ÿå°±ç»“æŸäº†ï¼Œå¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œå°±ä¼šè¿›å…¥ onErrorResumeNext è¿›è¡Œæœ€åçš„å¤±è´¥å¤„ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;æœ€åæ¥æ€»ç»“ä¸€ä¸‹ LoadBalancerCommand é‡è¯•ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;é‡è¯•åˆ†ä¸ºåŒä¸€ä¸ª Server é‡è¯•å’Œé‡è¯•ä¸‹ä¸€ä¸ªServerï¼Œå½“é‡è¯•æ¬¡æ•°å¤§äºè®¾ç½®çš„é‡è¯•å€¼æ—¶ï¼Œå°±åœæ­¢é‡è¯•ã€‚å¦åˆ™é€šè¿‡ retryHandler.isRetriableException åˆ¤æ–­æ˜¯å¦é‡è¯•ã€‚&lt;/li&gt;
&lt;li&gt;é‚£è¿™é‡Œä¸€å…±è¯·æ±‚äº†å¤šå°‘æ¬¡å‘¢ï¼Ÿå¯ä»¥æ€»ç»“å‡ºå¦‚ä¸‹å…¬å¼ï¼šè¯·æ±‚æ¬¡æ•° = ï¼ˆmaxRetrysSame + 1ï¼‰ * ï¼ˆmaxRetrysNext + 1ï¼‰ï¼Œæ‰€ä»¥æŒ‰ ribbon.MaxAutoRetries = 1ã€ribbon.MaxAutoRetriesNextServer = 1 çš„é…ç½®ï¼Œå¦‚æœæ¯æ¬¡è¯·æ±‚éƒ½è¶…æ—¶ï¼Œå°±ä¼šå‘èµ· 4 æ¬¡è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;div class=&quot;cnblogs_code&quot; readability=&quot;47&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; Observable&amp;lt;T&amp;gt; submit(&lt;span&gt;final&lt;/span&gt; ServerOperation&amp;lt;T&amp;gt;&lt;span&gt; operation) {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;     &lt;span&gt;final&lt;/span&gt; ExecutionInfoContext context = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; ExecutionInfoContext();
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; 
&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åŒä¸€ä¸ªServeré‡è¯•æ¬¡æ•°&lt;/span&gt;
&lt;span&gt; 5&lt;/span&gt;     &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; maxRetrysSame =&lt;span&gt; retryHandler.getMaxRetriesOnSameServer();
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; é‡è¯•ä¸‹ä¸€ä¸ªServerçš„æ¬¡æ•°&lt;/span&gt;
&lt;span&gt; 7&lt;/span&gt;     &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; maxRetrysNext =&lt;span&gt; retryHandler.getMaxRetriesOnNextServer();
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt; 
&lt;span&gt; 9&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆ›å»ºä¸€ä¸ª Observable&lt;/span&gt;
&lt;span&gt;10&lt;/span&gt;     Observable&amp;lt;T&amp;gt; o =
&lt;span&gt;11&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä½¿ç”¨ loadBalancerContext è·å– Server&lt;/span&gt;
&lt;span&gt;12&lt;/span&gt;             (server == &lt;span&gt;null&lt;/span&gt; ?&lt;span&gt; selectServer() : Observable.just(server))
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;             .concatMap(&lt;span&gt;new&lt;/span&gt; Func1&amp;lt;Server, Observable&amp;lt;T&amp;gt;&amp;gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;                @Override
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt;                 &lt;span&gt;public&lt;/span&gt; Observable&amp;lt;T&amp;gt;&lt;span&gt; call(Server server) {
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;                     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è®¾ç½®Server&lt;/span&gt;
&lt;span&gt;17&lt;/span&gt; &lt;span&gt;                    context.setServer(server);
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;                     &lt;span&gt;final&lt;/span&gt; ServerStats stats =&lt;span&gt; loadBalancerContext.getServerStats(server);
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; 
&lt;span&gt;20&lt;/span&gt;                     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆ›å»º Observable&lt;/span&gt;
&lt;span&gt;21&lt;/span&gt;                     Observable&amp;lt;T&amp;gt; o =&lt;span&gt; Observable
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt;                            .just(server)
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;                             .concatMap(&lt;span&gt;new&lt;/span&gt; Func1&amp;lt;Server, Observable&amp;lt;T&amp;gt;&amp;gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt; &lt;span&gt;                                @Override
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;                                 &lt;span&gt;public&lt;/span&gt; Observable&amp;lt;T&amp;gt; call(&lt;span&gt;final&lt;/span&gt;&lt;span&gt; Server server) {
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;                                     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¢åŠ å°è¯•æ¬¡æ•°&lt;/span&gt;
&lt;span&gt;27&lt;/span&gt; &lt;span&gt;                                    context.incAttemptCount();
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;                                     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ...
&lt;/span&gt;&lt;span&gt;29&lt;/span&gt;                                     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è°ƒç”¨ ServerOperation&lt;/span&gt;
&lt;span&gt;30&lt;/span&gt;                                     &lt;span&gt;return&lt;/span&gt; operation.call(server).doOnEach(&lt;span&gt;new&lt;/span&gt; Observer&amp;lt;T&amp;gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;                                         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¸€äº›å›è°ƒæ–¹æ³•&lt;/span&gt;
&lt;span&gt;32&lt;/span&gt; &lt;span&gt;                                    });
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; &lt;span&gt;                                }
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt; &lt;span&gt;                            });
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;                     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; é‡è¯•åŒä¸€ä¸ªServer&lt;/span&gt;
&lt;span&gt;36&lt;/span&gt;                     &lt;span&gt;if&lt;/span&gt; (maxRetrysSame &amp;gt; 0&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;37&lt;/span&gt;                         o = o.retry(retryPolicy(maxRetrysSame, &lt;span&gt;true&lt;/span&gt;&lt;span&gt;));
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt;                     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; o;
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt; &lt;span&gt;                }
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt; &lt;span&gt;            });
&lt;/span&gt;&lt;span&gt;41&lt;/span&gt; 
&lt;span&gt;42&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (maxRetrysNext &amp;gt; 0 &amp;amp;&amp;amp; server == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; é‡è¯•ä¸åŒServer&lt;/span&gt;
&lt;span&gt;44&lt;/span&gt;         o = o.retry(retryPolicy(maxRetrysNext, &lt;span&gt;false&lt;/span&gt;&lt;span&gt;));
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt; 
&lt;span&gt;46&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; o.onErrorResumeNext(&lt;span&gt;new&lt;/span&gt; Func1&amp;lt;Throwable, Observable&amp;lt;T&amp;gt;&amp;gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;47&lt;/span&gt; &lt;span&gt;        @Override
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt; Observable&amp;lt;T&amp;gt;&lt;span&gt; call(Throwable e) {
&lt;/span&gt;&lt;span&gt;49&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¼‚å¸¸å¤„ç†&lt;/span&gt;
&lt;span&gt;50&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt;&lt;span&gt; Observable.error(e);
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;52&lt;/span&gt; &lt;span&gt;    });
&lt;/span&gt;&lt;span&gt;53&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;54&lt;/span&gt; 
&lt;span&gt;55&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; retryPolicy è¿”å›ä¸€ä¸ªæ˜¯å¦é‡è¯•çš„æ–­è¨€&lt;/span&gt;
&lt;span&gt;56&lt;/span&gt; &lt;span&gt;private&lt;/span&gt; Func2&amp;lt;Integer, Throwable, Boolean&amp;gt; retryPolicy(&lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; maxRetrys, &lt;span&gt;final&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; same) {
&lt;/span&gt;&lt;span&gt;57&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt; Func2&amp;lt;Integer, Throwable, Boolean&amp;gt;&lt;span&gt;() {
&lt;/span&gt;&lt;span&gt;58&lt;/span&gt; &lt;span&gt;        @Override
&lt;/span&gt;&lt;span&gt;59&lt;/span&gt;         &lt;span&gt;public&lt;/span&gt;&lt;span&gt; Boolean call(Integer tryCount, Throwable e) {
&lt;/span&gt;&lt;span&gt;60&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è¯·æ±‚æ‹’ç»å¼‚å¸¸å°±ä¸å…è®¸é‡è¯•&lt;/span&gt;
&lt;span&gt;61&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (e &lt;span&gt;instanceof&lt;/span&gt;&lt;span&gt; AbortExecutionException) {
&lt;/span&gt;&lt;span&gt;62&lt;/span&gt;                 &lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;63&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;64&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; å°è¯•æ¬¡æ•°æ˜¯å¦å¤§äºæœ€å¤§é‡è¯•æ¬¡æ•°&lt;/span&gt;
&lt;span&gt;65&lt;/span&gt;             &lt;span&gt;if&lt;/span&gt; (tryCount &amp;gt;&lt;span&gt; maxRetrys) {
&lt;/span&gt;&lt;span&gt;66&lt;/span&gt;                 &lt;span&gt;return&lt;/span&gt; &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;67&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;68&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä½¿ç”¨ RequestSpecificRetryHandler åˆ¤æ–­æ˜¯å¦é‡è¯•&lt;/span&gt;
&lt;span&gt;69&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt;&lt;span&gt; retryHandler.isRetriableException(e, same);
&lt;/span&gt;&lt;span&gt;70&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;71&lt;/span&gt; &lt;span&gt;    };
&lt;/span&gt;&lt;span&gt;72&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;4ã€RetryTemplate&lt;/h3&gt;
&lt;p&gt;â‘  spring-retry&lt;/p&gt;
&lt;p&gt;è¦å¯ç”¨ RetryTemplate éœ€å…ˆå¼•å…¥ spring-retryï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;2&lt;/span&gt;     &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;org.springframework.retry&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;groupId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;3&lt;/span&gt;     &lt;span&gt;&amp;lt;&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;spring-retry&lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;artifactId&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;span&gt;4&lt;/span&gt; &lt;span&gt;&amp;lt;/&lt;/span&gt;&lt;span&gt;dependency&lt;/span&gt;&lt;span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä»¥ RetryableRibbonLoadBalancingHttpClient ä¸ºä¾‹ï¼Œå…ˆçœ‹çœ‹å®ƒçš„ execute æ–¹æ³•ï¼Œå®ƒå…ˆåˆ›å»ºäº†è´Ÿè½½å‡è¡¡é‡è¯•ç­–ç•¥ç±» LoadBalancedRetryPolicyï¼Œç„¶åå°†è¯·æ±‚è°ƒç”¨çš„é€»è¾‘å°è£…åˆ° RetryCallback ä¸­ï¼Œæœ€åå…¶å®å°±æ˜¯ç”¨ RetryTemplate æ‰§è¡Œè¿™ä¸ª RetryCallbackï¼Œä¹Ÿå°±æ˜¯è¯´è¯·æ±‚é‡è¯•çš„é€»è¾‘éƒ½åœ¨ RetryTemplate ä¸­ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;52&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; RibbonApacheHttpResponse execute(&lt;span&gt;final&lt;/span&gt; RibbonApacheHttpRequest request, &lt;span&gt;final&lt;/span&gt; IClientConfig configOverride) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Exception {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;...
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; 
&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è´Ÿè½½å‡è¡¡é‡è¯•ç­–ç•¥ RibbonLoadBalancedRetryPolicy&lt;/span&gt;
&lt;span&gt; 5&lt;/span&gt;     &lt;span&gt;final&lt;/span&gt; LoadBalancedRetryPolicy retryPolicy = loadBalancedRetryFactory.createRetryPolicy(&lt;span&gt;this&lt;/span&gt;.getClientName(), &lt;span&gt;this&lt;/span&gt;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; 
&lt;span&gt; 7&lt;/span&gt;     RetryCallback&amp;lt;RibbonApacheHttpResponse, Exception&amp;gt; retryCallback = context -&amp;gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ...
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; delegate =&amp;gt; CloseableHttpClient&lt;/span&gt;
&lt;span&gt;10&lt;/span&gt;         &lt;span&gt;final&lt;/span&gt; HttpResponse httpResponse = RetryableRibbonLoadBalancingHttpClient.&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.delegate.execute(httpUriRequest);
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ...
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; æˆåŠŸ è¿”å›ç»“æœ&lt;/span&gt;
&lt;span&gt;13&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RibbonApacheHttpResponse(httpResponse, httpUriRequest.getURI());
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; &lt;span&gt;    };
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; 
&lt;span&gt;16&lt;/span&gt;     LoadBalancedRecoveryCallback&amp;lt;RibbonApacheHttpResponse, HttpResponse&amp;gt; recoveryCallback = &lt;span&gt;new&lt;/span&gt; LoadBalancedRecoveryCallback&amp;lt;RibbonApacheHttpResponse, HttpResponse&amp;gt;()&lt;span&gt;//&lt;/span&gt;&lt;span&gt;...&lt;/span&gt;
&lt;span&gt;17&lt;/span&gt; 
&lt;span&gt;18&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.executeWithRetry(request, retryPolicy, retryCallback, recoveryCallback);
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; 
&lt;span&gt;21&lt;/span&gt; &lt;span&gt;private&lt;/span&gt;&lt;span&gt; RibbonApacheHttpResponse executeWithRetry(RibbonApacheHttpRequest request,
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt;        LoadBalancedRetryPolicy retryPolicy,
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;         RetryCallback&amp;lt;RibbonApacheHttpResponse, Exception&amp;gt;&lt;span&gt; callback,
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt;         RecoveryCallback&amp;lt;RibbonApacheHttpResponse&amp;gt;&lt;span&gt; recoveryCallback)
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;         &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; Exception {
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;     RetryTemplate retryTemplate = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; RetryTemplate();
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt; 
&lt;span&gt;28&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; retryable =&amp;gt; å–è‡ª RibbonCommandContext è®¾ç½®çš„ retryable å‚æ•°&lt;/span&gt;
&lt;span&gt;29&lt;/span&gt;     &lt;span&gt;boolean&lt;/span&gt; retryable =&lt;span&gt; isRequestRetryable(request);
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è®¾ç½®é‡è¯•ç­–ç•¥&lt;/span&gt;
&lt;span&gt;31&lt;/span&gt;     retryTemplate.setRetryPolicy(retryPolicy == &lt;span&gt;null&lt;/span&gt; || !&lt;span&gt;retryable
&lt;/span&gt;&lt;span&gt;32&lt;/span&gt;             ? &lt;span&gt;new&lt;/span&gt; NeverRetryPolicy() : &lt;span&gt;new&lt;/span&gt; RetryPolicy(request, retryPolicy, &lt;span&gt;this&lt;/span&gt;, &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.getClientName()));
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; 
&lt;span&gt;34&lt;/span&gt;     BackOffPolicy backOffPolicy = loadBalancedRetryFactory.createBackOffPolicy(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.getClientName());
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;     retryTemplate.setBackOffPolicy(backOffPolicy == &lt;span&gt;null&lt;/span&gt; ? &lt;span&gt;new&lt;/span&gt;&lt;span&gt; NoBackOffPolicy() : backOffPolicy);
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt; 
&lt;span&gt;37&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆ©ç”¨ retryTemplate æ‰§è¡Œè¯·æ±‚ callback&lt;/span&gt;
&lt;span&gt;38&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; retryTemplate.execute(callback, recoveryCallback);
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ executeWithRetry ä¸­ï¼Œä¼šåˆ¤æ–­æ˜¯å¦è¦é‡è¯•ï¼Œåˆ¤æ–­çš„é€»è¾‘ä¸­ getRetryable å…¶å®å°±æ˜¯å–çš„ ApacheClientHttpRequest ä¸­ executeInternal æ–¹æ³•é‡Œåˆ›å»ºçš„ RibbonCommandContext è®¾ç½®çš„ retryable å‚æ•°ï¼Œè¿™å°±å’Œå‰é¢å®šåˆ¶åŒ–çš„é€»è¾‘è¡”æ¥ä¸Šäº†ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;1&lt;/span&gt; &lt;span&gt;private&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; isRequestRetryable(ContextAwareRequest request) {
&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (request.getContext() == &lt;span&gt;null&lt;/span&gt; || request.getContext().getRetryable() == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt;3&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;4&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;5&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; request.getContext().getRetryable();
&lt;/span&gt;&lt;span&gt;6&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â‘¡ RetryTemplate&lt;/p&gt;
&lt;p&gt;è¿›å…¥ RetryTemplate çš„ execute æ–¹æ³•ï¼Œæ ¸å¿ƒçš„é€»è¾‘æˆ‘ç²¾ç®€æˆå¦‚ä¸‹ä»£ç ï¼Œä¸»è¦å°±æ˜¯ä¸€ä¸ª while å¾ªç¯åˆ¤æ–­æ˜¯å¦å¯ä»¥é‡è¯•ï¼Œç„¶åè°ƒç”¨ retryCallback æ‰§è¡Œè¯·æ±‚ã€‚è¯·æ±‚å¤±è´¥åï¼Œæ¯”å¦‚è¶…æ—¶ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œå°±ä¼š registerThrowable æ¥æ³¨å†Œå¼‚å¸¸ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;46&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;protected&lt;/span&gt; &amp;lt;T, E &lt;span&gt;extends&lt;/span&gt; Throwable&amp;gt; T doExecute(RetryCallback&amp;lt;T, E&amp;gt;&lt;span&gt; retryCallback,
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;         RecoveryCallback&amp;lt;T&amp;gt; recoveryCallback, RetryState state) &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; E, ExhaustedRetryException {
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; 
&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; retryPolicy =&amp;gt; InterceptorRetryPolicy&lt;/span&gt;
&lt;span&gt; 5&lt;/span&gt;     RetryPolicy retryPolicy = &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.retryPolicy;
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt;     BackOffPolicy backOffPolicy = &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.backOffPolicy;
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;....&lt;/span&gt;
&lt;span&gt; 8&lt;/span&gt;     &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ...
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; canRetry åˆ¤æ–­æ˜¯å¦é‡è¯•&lt;/span&gt;
&lt;span&gt;11&lt;/span&gt;         &lt;span&gt;while&lt;/span&gt; (canRetry(retryPolicy, context) &amp;amp;&amp;amp; !&lt;span&gt;context.isExhaustedOnly()) {
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt;             &lt;span&gt;try&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;                 &lt;span&gt;//&lt;/span&gt;&lt;span&gt; retryCallback è°ƒç”¨&lt;/span&gt;
&lt;span&gt;14&lt;/span&gt;                 &lt;span&gt;return&lt;/span&gt;&lt;span&gt; retryCallback.doWithRetry(context);
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt;             &lt;span&gt;catch&lt;/span&gt;&lt;span&gt; (Throwable e) {
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;                 &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ...
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;                 &lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ³¨å†Œå¼‚å¸¸&lt;/span&gt;
&lt;span&gt;19&lt;/span&gt; &lt;span&gt;                registerThrowable(retryPolicy, state, context, e);
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;                 &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ...&lt;/span&gt;
&lt;span&gt;21&lt;/span&gt; &lt;span&gt;            }
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt;         exhausted = &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;24&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; handleRetryExhausted(recoveryCallback, context, state);
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;...&lt;/span&gt;
&lt;span&gt;27&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;çœ‹ canRetry æ–¹æ³•ï¼Œå®ƒå®é™…æ˜¯è°ƒç”¨äº† InterceptorRetryPolicy çš„ canRetryã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼Œä¼šå»è·å– Serverï¼›å¦åˆ™å°±ç”¨ RibbonLoadBalancedRetryPolicy åˆ¤æ–­æ˜¯å¦é‡è¯•ä¸‹ä¸€ä¸ª Serverï¼Œæ³¨æ„å®ƒåˆ¤æ–­çš„é€»è¾‘æ˜¯ GET è¯·æ±‚æˆ–è€…å…è®¸æ‰€æœ‰æ“ä½œæ“ä½œé‡è¯•ï¼Œä¸” Server é‡è¯•æ¬¡æ•° nextServerCountÂ  å°äºç­‰äºé…ç½®çš„ MaxAutoRetriesNextServer ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œwhile å¾ªç¯åˆ¤æ–­çš„ canRetry æ˜¯é‡è¯•ä¸‹ä¸€ä¸ª Server çš„ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; canRetry(RetryPolicy retryPolicy, RetryContext context) {
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; retryPolicy.canRetry(context);
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; 
&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;////////////&lt;/span&gt;&lt;span&gt; InterceptorRetryPolicy&lt;/span&gt;
&lt;span&gt; 6&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; canRetry(RetryContext context) {
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     LoadBalancedRetryContext lbContext =&lt;span&gt; (LoadBalancedRetryContext) context;
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (lbContext.getRetryCount() == 0 &amp;amp;&amp;amp; lbContext.getServiceInstance() == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å– Server&lt;/span&gt;
&lt;span&gt;10&lt;/span&gt;         lbContext.setServiceInstance(&lt;span&gt;this&lt;/span&gt;.serviceInstanceChooser.choose(&lt;span&gt;this&lt;/span&gt;&lt;span&gt;.serviceName));
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt; &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; RibbonLoadBalancedRetryPolicy =&amp;gt; é‡è¯•ä¸‹ä¸€ä¸ªServer&lt;/span&gt;
&lt;span&gt;14&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.policy.canRetryNextServer(lbContext);
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; 
&lt;span&gt;17&lt;/span&gt; &lt;span&gt;////////&lt;/span&gt;&lt;span&gt;/ RibbonLoadBalancedRetryPolicy&lt;/span&gt;
&lt;span&gt;18&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; canRetryNextServer(LoadBalancedRetryContext context) {
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆ¤æ–­é‡è¯•ä¸‹ä¸€ä¸ªServer&lt;/span&gt;
&lt;span&gt;20&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; nextServerCount &amp;lt;=&lt;span&gt; lbContext.getRetryHandler().getMaxRetriesOnNextServer()
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt;             &amp;amp;&amp;amp;&lt;span&gt; canRetry(context);
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;23&lt;/span&gt; 
&lt;span&gt;24&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; canRetry(LoadBalancedRetryContext context) {
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; GET è¯·æ±‚æˆ–è€…å…è®¸æ‰€æœ‰æ“ä½œé‡è¯•æ—¶ï¼Œå°±å…è®¸é‡è¯•&lt;/span&gt;
&lt;span&gt;26&lt;/span&gt;     HttpMethod method =&lt;span&gt; context.getRequest().getMethod();
&lt;/span&gt;&lt;span&gt;27&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; HttpMethod.GET == method ||&lt;span&gt; lbContext.isOkToRetryOnAllOperations();
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æ¥ç€çœ‹è¯·æ±‚å¤±è´¥åçš„æ³¨å†Œå¼‚å¸¸ registerThrowableï¼Œå®ƒæœ€åä¼šå‘ RibbonLoadBalancedRetryPolicy æ³¨å†Œå¼‚å¸¸ã€‚åœ¨ RibbonLoadBalancedRetryPolicy çš„ registerThrowable æ–¹æ³•ä¸­ï¼Œå¦‚æœä¸é‡è¯•åŒä¸€ä¸ªServerä¸”å¯ä»¥é‡è¯•ä¸‹ä¸€ä¸ªServerï¼Œå°±ä¼šè½®è¯¢è·å–ä¸‹ä¸€ä¸ªServerã€‚å¦‚æœå¯ä»¥åœ¨åŒä¸€ä¸ªServerä¸Šé‡è¯•ï¼ŒsameServerCount è®¡æ•°å™¨å°±+1ï¼Œå¦åˆ™é‡ç½® sameServerCountï¼Œç„¶å nextServerCount +1ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;43&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;protected&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; registerThrowable(RetryPolicy retryPolicy, RetryState state,
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;        RetryContext context, Throwable e) {
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;    retryPolicy.registerThrowable(context, e);
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;    registerContext(context, state);
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt; 6&lt;/span&gt; 
&lt;span&gt; 7&lt;/span&gt; &lt;span&gt;////////&lt;/span&gt;&lt;span&gt;/ InterceptorRetryPolicy &lt;/span&gt;&lt;span&gt;////////&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;
&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; registerThrowable(RetryContext context, Throwable throwable) {
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;     LoadBalancedRetryContext lbContext =&lt;span&gt; (LoadBalancedRetryContext) context;
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt; &lt;span&gt;    lbContext.registerThrowable(throwable);
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; RibbonLoadBalancedRetryPolicy&lt;/span&gt;
&lt;span&gt;12&lt;/span&gt;     &lt;span&gt;this&lt;/span&gt;&lt;span&gt;.policy.registerThrowable(lbContext, throwable);
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt; 
&lt;span&gt;15&lt;/span&gt; &lt;span&gt;////////&lt;/span&gt;&lt;span&gt;/ RibbonLoadBalancedRetryPolicy &lt;/span&gt;&lt;span&gt;////////&lt;/span&gt;&lt;span&gt;/&lt;/span&gt;
&lt;span&gt;16&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; registerThrowable(LoadBalancedRetryContext context, Throwable throwable) {
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt;...
&lt;/span&gt;&lt;span&gt;18&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¦‚æœä¸åœ¨åœ¨åŒä¸€ä¸ªServer ä¸Šé‡è¯•ä¸”å¯ä»¥é‡è¯•ä¸‹ä¸€ä¸ªServerï¼Œåˆ™é‡æ–°é€‰æ‹©ä¸€ä¸ª Server&lt;/span&gt;
&lt;span&gt;19&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (!canRetrySameServer(context) &amp;amp;&amp;amp;&lt;span&gt; canRetryNextServer(context)) {
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; &lt;span&gt;        context.setServiceInstance(loadBalanceChooser.choose(serviceId));
&lt;/span&gt;&lt;span&gt;21&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt; 
&lt;span&gt;23&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åŒä¸€ä¸ªServeré‡è¯•è¶…è¿‡è®¾ç½®çš„å€¼åï¼Œå°±é‡ç½® sameServerCount&lt;/span&gt;
&lt;span&gt;24&lt;/span&gt;     &lt;span&gt;if&lt;/span&gt; (sameServerCount &amp;gt;=&lt;span&gt; lbContext.getRetryHandler().getMaxRetriesOnSameServer()
&lt;/span&gt;&lt;span&gt;25&lt;/span&gt;             &amp;amp;&amp;amp;&lt;span&gt; canRetry(context)) {
&lt;/span&gt;&lt;span&gt;26&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; é‡ç½® nextServerCount&lt;/span&gt;
&lt;span&gt;27&lt;/span&gt;         sameServerCount = 0&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;28&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¸‹ä¸€ä¸ªServeré‡è¯•æ¬¡æ•°+1&lt;/span&gt;
&lt;span&gt;29&lt;/span&gt;         nextServerCount++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;30&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; (!&lt;span&gt;canRetryNextServer(context)) {
&lt;/span&gt;&lt;span&gt;31&lt;/span&gt;             &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¸èƒ½é‡è¯•ä¸‹ä¸€ä¸ªServeräº†&lt;/span&gt;
&lt;span&gt;32&lt;/span&gt; &lt;span&gt;            context.setExhaustedOnly();
&lt;/span&gt;&lt;span&gt;33&lt;/span&gt; &lt;span&gt;        }
&lt;/span&gt;&lt;span&gt;34&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;35&lt;/span&gt;     &lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;&lt;span&gt;36&lt;/span&gt;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åŒä¸€ä¸ªServeré‡è¯•æ¬¡æ•°+1&lt;/span&gt;
&lt;span&gt;37&lt;/span&gt;         sameServerCount++&lt;span&gt;;
&lt;/span&gt;&lt;span&gt;38&lt;/span&gt; &lt;span&gt;    }
&lt;/span&gt;&lt;span&gt;39&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;40&lt;/span&gt; 
&lt;span&gt;41&lt;/span&gt; &lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆ¤æ–­æ˜¯å¦é‡è¯•åŒä¸€ä¸ªServer&lt;/span&gt;
&lt;span&gt;42&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; canRetrySameServer(LoadBalancedRetryContext context) {
&lt;/span&gt;&lt;span&gt;43&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; sameServerCount &amp;lt;&lt;span&gt; lbContext.getRetryHandler().getMaxRetriesOnSameServer()
&lt;/span&gt;&lt;span&gt;44&lt;/span&gt;             &amp;amp;&amp;amp;&lt;span&gt; canRetry(context);
&lt;/span&gt;&lt;span&gt;45&lt;/span&gt; &lt;span&gt;}
&lt;/span&gt;&lt;span&gt;46&lt;/span&gt; 
&lt;span&gt;47&lt;/span&gt; &lt;span&gt;public&lt;/span&gt; &lt;span&gt;boolean&lt;/span&gt;&lt;span&gt; canRetry(LoadBalancedRetryContext context) {
&lt;/span&gt;&lt;span&gt;48&lt;/span&gt;     &lt;span&gt;//&lt;/span&gt;&lt;span&gt; GET è¯·æ±‚æˆ–è€…å…è®¸æ‰€æœ‰æ“ä½œé‡è¯•æ—¶ï¼Œå°±å…è®¸é‡è¯•&lt;/span&gt;
&lt;span&gt;49&lt;/span&gt;     HttpMethod method =&lt;span&gt; context.getRequest().getMethod();
&lt;/span&gt;&lt;span&gt;50&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt; HttpMethod.GET == method ||&lt;span&gt; lbContext.isOkToRetryOnAllOperations();
&lt;/span&gt;&lt;span&gt;51&lt;/span&gt; }
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;5ã€Ribbon é‡è¯•æ€»ç»“&lt;/h3&gt;
&lt;p&gt;â‘  é¦–å…ˆï¼ŒRibbon å…³äºè¶…æ—¶å’Œé‡è¯•çš„é…ç½®å‚æ•°å¦‚ä¸‹ï¼Œè¿™äº›å‚æ•°ä¹Ÿå¯ä»¥é’ˆå¯¹æŸä¸ªå®¢æˆ·ç«¯é…ç½®ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;ribbon:
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;  # å®¢æˆ·ç«¯è¯»å–è¶…æ—¶æ—¶é—´
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;   ReadTimeout: 1000
&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;  # å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶æ—¶é—´
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;   ConnectTimeout: 1000
&lt;span&gt; 6&lt;/span&gt;   # é»˜è®¤åªé‡è¯• GETï¼Œè®¾ç½®ä¸º &lt;span&gt;true&lt;/span&gt;&lt;span&gt; æ—¶å°†é‡è¯•æ‰€æœ‰ç±»å‹ï¼Œå¦‚ POSTã€PUTã€DELETE
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;   OkToRetryOnAllOperations: &lt;span&gt;false&lt;/span&gt;
&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;  # åŒä¸€ä¸ªServeré‡è¯•æ¬¡æ•°
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;   MaxAutoRetries: 1
&lt;span&gt;10&lt;/span&gt; &lt;span&gt;  # æœ€å¤šé‡è¯•å‡ ä¸ªServer
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;   MaxAutoRetriesNextServer: 1
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;â‘¡ RetryTemplate æ˜¯ spring-retry çš„é‡è¯•ç»„ä»¶ï¼ŒLoadBalancerCommand æ˜¯ Ribbon çš„é‡è¯•ç»„ä»¶ã€‚å®ƒä»¬é‡è¯•çš„è¯·æ±‚æ¬¡æ•°æ˜¯ä¸€æ ·çš„ï¼Œé‡è¯•é€»è¾‘ä¹Ÿæ˜¯ç±»ä¼¼ï¼Œéƒ½æ˜¯å…ˆé‡è¯•å½“å‰ Serverï¼Œå†é‡è¯•ä¸‹ä¸€ä¸ªServerï¼Œæ€»çš„è¯·æ±‚æ¬¡æ•° = ï¼ˆMaxAutoRetries + 1ï¼‰ * ï¼ˆMaxAutoRetriesNextServer + 1ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;â‘¢ ä½†æ˜¯æœ‰ç‚¹å·®åˆ«çš„æ˜¯ï¼ŒRetryTemplate ä¼šåˆ¤æ–­è¯·æ±‚æ–¹æ³•ä¸º GET æˆ–è€… OkToRetryOnAllOperations=true æ—¶æ‰å…è®¸é‡è¯•ï¼Œè€Œ LoadBalancerCommandÂ  æ˜¯æ‰€æœ‰ http æ–¹æ³•éƒ½å¯ä»¥é‡è¯•ã€‚è¿™ä¸ªå…¶å®æ˜¯æœ‰é—®é¢˜çš„ï¼Œä¸€èˆ¬åªæœ‰GETæ‰å…è®¸é‡è¯•ï¼Œå› ä¸ºGETæ˜¯æŸ¥è¯¢æ“ä½œï¼Œæ¥å£æ˜¯å¹‚ç­‰çš„ï¼Œè€ŒPOSTã€PUTã€DELETEä¸€èˆ¬æ˜¯éå¹‚ç­‰çš„ã€‚æ‰€ä»¥ä¸€èˆ¬æ›´å»ºè®®ä½¿ç”¨ RetryTemplateï¼Œå¹¶ä¸”é…ç½® OkToRetryOnAllOperations=falseã€‚&lt;/p&gt;
&lt;p&gt;â‘£ ä¸ºäº†æå‡æœåŠ¡é—´é€šä¿¡æ€§èƒ½ï¼Œä¸€èˆ¬å¯ä»¥å¯ç”¨ apache httpclient æˆ–è€… OkHttpï¼Œå¦‚æœè¦å¯ç”¨é‡è¯•åŠŸèƒ½ï¼Œè¿˜éœ€è¦å¼•å…¥ spring-retry ä¾èµ–ã€‚é‡è¯•æ—¶ï¼Œå½“å‰Serverå°±ä¸è¦é‡è¯•äº†ï¼ˆMaxAutoRetries=0ï¼‰ï¼Œç›´æ¥é‡è¯•ä¸‹ä¸€ä¸ªServerã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;ribbon:
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; &lt;span&gt;  # å®¢æˆ·ç«¯è¯»å–è¶…æ—¶æ—¶é—´
&lt;/span&gt;&lt;span&gt; 3&lt;/span&gt;   ReadTimeout: 1000
&lt;span&gt; 4&lt;/span&gt; &lt;span&gt;  # å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶æ—¶é—´
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;   ConnectTimeout: 1000
&lt;span&gt; 6&lt;/span&gt;   # é»˜è®¤åªé‡è¯• GETï¼Œè®¾ç½®ä¸º &lt;span&gt;true&lt;/span&gt;&lt;span&gt; æ—¶å°†é‡è¯•æ‰€æœ‰ç±»å‹ï¼Œå¦‚ POSTã€PUTã€DELETE
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;   OkToRetryOnAllOperations: &lt;span&gt;false&lt;/span&gt;
&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;  # åŒä¸€ä¸ªServeré‡è¯•æ¬¡æ•°
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt;   MaxAutoRetries: 0
&lt;span&gt;10&lt;/span&gt; &lt;span&gt;  # æœ€å¤šé‡è¯•å‡ ä¸ªServer
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;   MaxAutoRetriesNextServer: 1
&lt;span&gt;12&lt;/span&gt; &lt;span&gt;  # å¯ç”¨ httpclient
&lt;/span&gt;&lt;span&gt;13&lt;/span&gt; &lt;span&gt;  httpclient:
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;     enabled: &lt;span&gt;false&lt;/span&gt;
&lt;span&gt;15&lt;/span&gt; &lt;span&gt;  # å¯ç”¨ RestClient
&lt;/span&gt;&lt;span&gt;16&lt;/span&gt; &lt;span&gt;  restclient:
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt;     enabled: &lt;span&gt;false&lt;/span&gt;
&lt;span&gt;18&lt;/span&gt; &lt;span&gt;  # å¯ç”¨ okhttp
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;  okhttp:
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt;     enabled: &lt;span&gt;true&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/div&gt;</description>
<pubDate>Thu, 24 Dec 2020 16:39:00 +0000</pubDate>
<dc:creator>bojiangzhou</dc:creator>
<og:description>Ribbon è´Ÿè½½å‡è¡¡æ ¸å¿ƒæ¥å£ã€Ribbon HTTPå®¢æˆ·ç«¯ç»„ä»¶ï¼Œå®šåˆ¶åŒ–ä½¿å¾— RestTemplate å¯ä»¥ä½¿ç”¨ Apache httpclient æˆ– Okhttpï¼Œè¿˜ä»‹ç»äº† Ribbon çš„è¯·æ±‚</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/chiangchou/p/ribbon-2.html</dc:identifier>
</item>
<item>
<title>å‡½æ•°è¿›é˜¶Â· ç¬¬3ç¯‡ã€Šå¸¸ç”¨å†…ç½®å‡½æ•°filter()ã€map()ã€zip()ï¼Œæ€ä¹ˆç”¨çš„å‘¢ï¼Ÿã€‹ - æ¸…è¡</title>
<link>http://www.cnblogs.com/qinghan123/p/14187006.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/qinghan123/p/14187006.html</guid>
<description>&lt;h3 id=&quot;åšæŒåŸåˆ›è¾“å‡ºï¼Œç‚¹å‡»è“å­—å…³æ³¨æˆ‘å§&quot;&gt;åšæŒåŸåˆ›è¾“å‡ºï¼Œç‚¹å‡»è“å­—å…³æ³¨æˆ‘å§&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224165601.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä½œè€…ï¼šæ¸…è¡&lt;br/&gt;åšå®¢ï¼šoschinaã€äº‘+ç¤¾åŒºã€çŸ¥ä¹ç­‰å„å¤§å¹³å°éƒ½æœ‰ã€‚&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;ç”±äºå¾®ä¿¡å…¬ä¼—å·æ¨é€æ”¹ä¸ºäº†ä¿¡æ¯æµçš„å½¢å¼ï¼Œé˜²æ­¢èµ°ä¸¢ï¼Œè¯·ç»™åŠ ä¸ªæ˜Ÿæ ‡ â­ï¼Œä½ å°±å¯ä»¥ç¬¬ä¸€æ—¶é—´æ¥æ”¶åˆ°æœ¬å…¬ä¼—å·çš„æ¨é€ï¼&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;&lt;li&gt;ä¸€ã€filter()å‡½æ•°
&lt;ul&gt;&lt;li&gt;1.filter()è¿‡æ»¤åºåˆ—&lt;/li&gt;
&lt;li&gt;2.ç”Ÿæˆå™¨ã€è¿­ä»£å™¨éƒ½æ˜¯å¯è¿­ä»£å¯¹è±¡&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;äºŒã€map()å‡½æ•°&lt;/li&gt;
&lt;li&gt;ä¸‰ã€zip()å‡½æ•°
&lt;ul&gt;&lt;li&gt;1.ä»€ä¹ˆæ˜¯ zip()å‡½æ•°&lt;/li&gt;
&lt;li&gt;2.zip()å¯ä»¥å¿«é€Ÿåˆ›å»ºå­—å…¸&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;å¸¸ç”¨çš„å†…ç½®å‡½æ•°ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;map()å‡½æ•°ï¼šä¼šæ ¹æ®æä¾›çš„å‡½æ•°å¯¹æŒ‡å®šåºåˆ—åšæ˜ å°„ã€‚&lt;/li&gt;
&lt;li&gt;filter()å‡½æ•°ï¼šå‡½æ•°ç”¨äºè¿‡æ»¤åºåˆ—ã€‚&lt;/li&gt;
&lt;li&gt;zip()å‡½æ•°ï¼šå‡½æ•°ç”¨äºå°†å¯è¿­ä»£çš„å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå°†å¯¹è±¡ä¸­å¯¹åº”çš„å…ƒç´ æ‰“åŒ…æˆä¸€ä¸ªä¸ªå…ƒç»„ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;ä¸€ã€filterå‡½æ•°&quot;&gt;ä¸€ã€filter()å‡½æ•°&lt;/h2&gt;
&lt;h3 id=&quot;1filterè¿‡æ»¤åºåˆ—&quot;&gt;1.filter()è¿‡æ»¤åºåˆ—&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;filter:è¿‡æ»¤åºåˆ—ã€‚ç¬¬ä¸€å‚æ•°æ˜¯å‡½æ•°ï¼›ç¬¬äºŒå‚æ•°æ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;çœ‹çœ‹&lt;code&gt;filter()&lt;/code&gt;è¿™ä¸ªå†…ç½®å‡½æ•°çš„æºç ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-PYTHON&quot;&gt;class filter(object):
    &quot;&quot;&quot;
    filter(function or None, iterable) --&amp;gt; filter object

    Return an iterator yielding those items of iterable for which function(item)
    is true. If function is None, return the items that are true.
    &quot;&quot;&quot;
    def __getattribute__(self, *args, **kwargs): # real signature unknown
        &quot;&quot;&quot; Return getattr(self, name). &quot;&quot;&quot;
        pass

    def __init__(self, function_or_None, iterable): # real signature unknown; restored from __doc__
        pass

    def __iter__(self, *args, **kwargs): # real signature unknown
        &quot;&quot;&quot; Implement iter(self). &quot;&quot;&quot;
        pass

    @staticmethod # known case of __new__
    def __new__(*args, **kwargs): # real signature unknown
        &quot;&quot;&quot; Create and return a new object.  See help(type) for accurate signature. &quot;&quot;&quot;
        pass

    def __next__(self, *args, **kwargs): # real signature unknown
        &quot;&quot;&quot; Implement next(self). &quot;&quot;&quot;
        pass

    def __reduce__(self, *args, **kwargs): # real signature unknown
        &quot;&quot;&quot; Return state information for pickling. &quot;&quot;&quot;
        pass
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;çœ‹æºç å‘ç°å±…ç„¶æ˜¯ä¸ªç±»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;å®ƒæ¥æ”¶åˆ°çš„æ˜¯2ä¸ªå‚æ•°ï¼Œ2ä¸ªå‚æ•°åœ¨å“ªé‡Œçœ‹å‘¢ï¼Ÿ&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;__init__&lt;/code&gt;æ–¹æ³•é‡Œé¢çœ‹ã€‚æ—¢ç„¶æ˜¯ä¸ªç±»ï¼Œè°ƒç”¨çš„æ—¶å€™åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201222135731.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;Python ä¸­çš„å¯è¿­ä»£å¯¹è±¡åœ¨ä¸€ä¸ªæ¨¡å—é‡Œé¢ã€‚è¿­ä»£å™¨ã€ç”Ÿæˆå™¨ã€å¯è¿­ä»£å¯¹è±¡éƒ½åœ¨è¿™ä¸ªæ¨¡å—é‡Œé¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;from collections import Iterator,Iterable,Generator&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ç”Ÿæˆå™¨å±äºè¿­ä»£å™¨ï¼Œç”Ÿæˆå™¨æ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;åˆ—è¡¨æ˜¯ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚&lt;code&gt;filter()&lt;/code&gt;è¿™ä¸ªå†…ç½®å‡½æ•°ä¼  2 ä¸ªå‚æ•°åï¼Œä¼šè¿”å›å‡ºä¸€ä¸ªå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹&lt;code&gt;filter()&lt;/code&gt;æºç å¯ä»¥çœ‹å‡ºå®ƒæ˜¯ä¸ªç±»ï¼Œè°ƒç”¨å®ƒç»™å®ƒä¼ å‚ï¼Œç±»è¿”å›çš„ç»“æœè‚¯å®šæ˜¯ä¸ªå¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;filter()&lt;/code&gt;çš„ä½œç”¨æ˜¯è¿‡æ»¤ï¼Œå®ƒä¼šè¿›è¡Œè¿­ä»£æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å®ƒä¼šæŠŠåé¢ä¼ å…¥çš„å¯è¿­ä»£å¯¹è±¡ï¼Œé‡Œé¢çš„å…ƒç´ å…¨éƒ¨éå†ä¸€éã€‚ç„¶åæŠŠéå†å‡ºæ¥çš„å…ƒç´ å½“ä½œå‚æ•°ä¼ åˆ°è¿™ä¸ª&lt;code&gt;fun&lt;/code&gt;å‡½æ•°é‡Œé¢ã€‚&lt;/p&gt;
&lt;p&gt;å½“å‰è¿™ä¸ª&lt;code&gt;fun()&lt;/code&gt;å‡½æ•°æ²¡æœ‰å®šä¹‰å‚æ•°ï¼Œè¿™ä¸ªæ—¶å€™è¿è¡Œçœ‹çœ‹ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-PYTHON&quot;&gt;# å†…ç½®å‡½æ•°
def fun():
    pass

li = [1,2,122,331,11,22,33,4,6,7,2,88,31]

res=filter(fun,li)
print(list(res))
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿”å›åˆ—è¡¨çš„æ—¶å€™æŠ¥é”™äº†ï¼Œ&lt;code&gt;fun()&lt;/code&gt;éœ€è¦ 0 ä¸ªå‚æ•°ï¼Œä½†æ˜¯è¿™é‡Œç»™äº†ä¸€ä¸ªå‚æ•°ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224130742.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬æŠŠå®ƒè½¬æ¢æˆåˆ—è¡¨çš„æ—¶å€™ï¼Œåœ¨è¿™é‡Œä¼ è¿›å»ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œæœ‰ä¸€ä¸ªå‡½æ•°ï¼Œè¿˜æœ‰ä¸ªå¯è¿­ä»£å¯¹è±¡&lt;code&gt;filter(fun,li)&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;filter()&lt;/code&gt;ä¼ å‡ºæ¥çš„æ•°æ®ä¹Ÿæ˜¯ä¸ªè¿­ä»£å™¨ã€‚å®ƒä¹Ÿæ˜¯ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œå°±å¯ä»¥é€šè¿‡&lt;code&gt;list&lt;/code&gt;æŠŠå®ƒè½¬æ¢æˆåˆ—è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä½ è½¬æ¢çš„æ—¶å€™ï¼Œå®ƒä¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°æ‹¿åˆ°ï¼Œä¼ åˆ°&lt;code&gt;fun()&lt;/code&gt;é‡Œé¢å»ï¼Œä¼šè‡ªåŠ¨ä¼ å‚çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224131730.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;åŠ ä¸ªå‚æ•°ï¼Œå†è¿è¡Œï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-PYTHON&quot;&gt;# å†…ç½®å‡½æ•°
def fun(n):
    pass

li = [1,2,122,331,11,22,33,4,6,7,2,88,31]

res=filter(fun,li)
print(list(res))
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224132059.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªåˆ—è¡¨æ˜¯ç©ºçš„ã€‚å› ä¸ºå‡½æ•°&lt;code&gt;pass&lt;/code&gt;æ‰äº†ã€‚åªå†™ä¸ª&lt;code&gt;pass&lt;/code&gt;ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œè¿”å›çš„å€¼æ˜¯æ²¡æœ‰ç»“æœçš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;filter()&lt;/code&gt;ä¼šæ ¹æ®ä¼ è¿›å»çš„å‚æ•°ï¼Œè°ƒç”¨&lt;code&gt;func()&lt;/code&gt;å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ ¹æ®è¿”å›å€¼&lt;code&gt;pass&lt;/code&gt;ï¼Œæ¥ç¡®å®šå‡½æ•°&lt;code&gt;li&lt;/code&gt;è¦ä¸è¦æ·»åŠ åˆ°æ–°çš„åˆ—è¡¨é‡Œé¢ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå°†ä»£ç ä¿®æ”¹æˆè¿™æ ·&lt;code&gt;return True&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-python&quot;&gt;def fun(n):
    return True

li = [1,2,122,331,11,22,33,4,6,7,2,88,31]

res=filter(fun,li)
print(list(res))
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿”å›ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224133607.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è¿”å›ä¸€ä¸ª False:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224133723.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è¾“å‡ºç»“æœæ˜¯ä¸€ä¸ªéƒ½æ²¡æœ‰äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;filter()&lt;/code&gt;å‡½æ•°å¯ä»¥è¿‡æ»¤ï¼Œå¯ä»¥å†™è¿‡æ»¤æ¡ä»¶ã€‚æ¯”å¦‚è¦ä¿ç•™&lt;code&gt;n&amp;lt;10&lt;/code&gt;çš„æ•°æ®è¦ä¿ç•™ä¸‹æ¥ï¼Œ&lt;code&gt;n&amp;lt;10&lt;/code&gt;æ˜¯ä¸ªæ¯”è¾ƒè¯­å¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;n&amp;lt;10&lt;/code&gt;è¿”å›çš„æ˜¯ä¸ª Trueï¼ˆå½“å‰ä¼ å…¥çš„å‚æ•°ä¿ç•™ï¼Œæ·»åŠ åˆ°æ–°çš„åˆ—è¡¨é‡Œé¢ï¼‰ï¼Œ&lt;code&gt;n&amp;gt;10&lt;/code&gt;è¿”å›çš„æ˜¯ä¸ª Falseï¼ˆå°±æŠŠæ•°æ®å»æ‰ä¸è¦äº†ï¼‰ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-PYTHON&quot;&gt;def fun(n):
    return n&amp;lt;10

li = [1,2,122,331,11,22,33,4,6,7,2,88,31]

res=filter(fun,li)
print(list(res))
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224134818.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å…¶å®å’Œè¿™æ®µä»£ç çš„æ“ä½œæ˜¯ä¸€æ ·ä¸€æ ·çš„ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-PYTHON&quot;&gt;li1 = []
for i in li:
    if i &amp;gt; 10:
        li1.append(i)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;å†…éƒ¨æ“ä½œæ˜¯è¿™æ ·çš„ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å®šä¹‰äº†ä¸ªæ–°çš„åˆ—è¡¨&lt;code&gt;li1&lt;/code&gt;ï¼Œåœ¨è¿™é‡Œé¢æ¥äº†ä¸€ä¸ª&lt;code&gt;for&lt;/code&gt;å¾ªç¯ï¼Œåˆ¤æ–­&lt;code&gt;i&lt;/code&gt;æ˜¯ä¸æ˜¯å¤§äº 10ï¼Œå¦‚æœå¤§äº 10ï¼Œå°±æŠŠå®ƒæ·»åŠ åˆ°æ–°çš„åˆ—è¡¨é‡Œé¢ã€‚&lt;/p&gt;
&lt;p&gt;ä¼šæ ¹æ®ä½ ä¼ å…¥çš„å‚æ•°&lt;code&gt;fun(n)&lt;/code&gt;è¿›è¡Œç›¸åº”çš„åˆ¤æ–­å’Œæ¯”è¾ƒã€‚æ ¹æ®å‡½æ•°è¿”å›çš„æ˜¯&lt;code&gt;True&lt;/code&gt;è¿˜æ˜¯&lt;code&gt;None&lt;/code&gt;ï¼Œæ¥å†³å®šè¿™ä¸ªæ•°æ®è¦ä¸è¦ä¿ç•™èµ·æ¥ã€‚&lt;/p&gt;
&lt;h3 id=&quot;2ç”Ÿæˆå™¨ã€è¿­ä»£å™¨éƒ½æ˜¯å¯è¿­ä»£å¯¹è±¡&quot;&gt;2.ç”Ÿæˆå™¨ã€è¿­ä»£å™¨éƒ½æ˜¯å¯è¿­ä»£å¯¹è±¡&lt;/h3&gt;
&lt;p&gt;å®šä¹‰ä¸ªç”Ÿæˆå™¨ã€å¯è¿­ä»£å¯¹è±¡ã€è¿­ä»£å™¨ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-PYTHON&quot;&gt;from collections import Iterator,Iterable,Generator
def fun(n):
    return n &amp;lt; 10

# åˆ—è¡¨å°±æ˜¯å¯è¿­ä»£å¯¹è±¡
li = [1, 2, 122, 331, 11, 22, 33, 4, 6, 7, 2, 88, 31]
res = filter(fun, li)

# å®šä¹‰ä¸ªè¿­ä»£å™¨
# å¯ä»¥æŠŠä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡è½¬æ¢æˆä¸€ä¸ªè¿­ä»£å™¨
li2 = iter(li)

# å®šä¹‰ä¸ªç”Ÿæˆå™¨
li3 = (i for i in range(5))

# ç”¨isinstance åˆ¤æ–­ä¸‹åˆ—è¡¨æ˜¯ä¸æ˜¯ä¸ªå¯è¿­ä»£å¯¹è±¡
print(isinstance(li,Iterable))
print(isinstance(li2,Iterable))
print(isinstance(li3,Iterable))
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;code&gt;isinstance()&lt;/code&gt; å‡½æ•°æ¥åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªå·²çŸ¥çš„ç±»å‹ï¼Œç±»ä¼¼ &lt;code&gt;type()&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224143240.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è¿”å›éƒ½æ˜¯&lt;code&gt;True&lt;/code&gt;ï¼Œæ‰€ä»¥å®ƒä»¬ 3 ä¸ªéƒ½æ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;ç”Ÿæˆå™¨å±äºè¿­ä»£å™¨ï¼Œé‚£ä¹ˆç”Ÿæˆå™¨ä¹Ÿæ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚è¿­ä»£å™¨æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œä½†æ˜¯è¿­ä»£å™¨ä¸æ˜¯ç”Ÿæˆå™¨ã€‚&lt;/p&gt;
&lt;h2 id=&quot;äºŒã€mapå‡½æ•°&quot;&gt;äºŒã€map()å‡½æ•°&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;map()&lt;/code&gt;çš„æœºåˆ¶å’Œ&lt;code&gt;filter()&lt;/code&gt;æ˜¯ä¸€æ ·çš„ã€‚å®ƒä¹Ÿä¼šå°†åé¢çš„å¯è¿­ä»£å¯¹è±¡é‡Œé¢çš„æ•°æ®è¿­ä»£å‡ºæ¥ï¼Œæ”¾åˆ°ç¬¬ä¸€ä¸ªå‡½æ•°é‡Œé¢ã€‚&lt;/p&gt;
&lt;p&gt;å®ƒæ¥æ”¶çš„ä¹Ÿæ˜¯ 2 ä¸ªå‚æ•°ã€‚&lt;strong&gt;ç¬¬ä¸€ä¸ªå‚æ•°ï¼š&lt;code&gt;func&lt;/code&gt; ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼šå¯è¿­ä»£å¯¹è±¡ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-PYTHON&quot;&gt;def fun(n):
    return n &amp;lt; 10

# åˆ—è¡¨å°±æ˜¯å¯è¿­ä»£å¯¹è±¡
li = [1, 2, 122, 331, 11, 22, 33, 4, 6, 7, 2, 88, 31]
res = filter(fun, li)

# map:å°†å¯è¿­ä»£å¯¹è±¡ä¸­çš„æ•°æ®è¿­ä»£å‡ºæ¥ï¼Œä¸€ä¸ªä¸€ä¸ªä¼ åˆ°å‡½æ•°ä¸­å»è°ƒç”¨ï¼Œå°†è¿”å›ç»“æœæ”¾åˆ°æ–°çš„å¯¹è±¡ä¸­ã€‚
res2=map(fun,li)
print(list(res2))
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224144608.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å®ƒè¿”å›çš„ç»“æœå…¨æ˜¯&lt;code&gt;True&lt;/code&gt;å’Œ&lt;code&gt;False&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;map()å‡½æ•°å¯ä»¥ç”¨æ¥åšï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;1.æŠŠè¿™äº›æ•°æ®åšç»Ÿä¸€çš„å¤„ç†ï¼Œæ¯”å¦‚ç®—è¿™äº›æ•°æ®çš„é˜¶ä¹˜ï¼Œæœ‰ä¸€æ‰¹æ•°æ®è¦ç®—é˜¶ä¹˜ï¼Œå¯ä»¥ä¸€èµ·æ‹¿è¿‡å»ã€‚&lt;/p&gt;
&lt;p&gt;2.å®ƒä¼šæŠŠæ•°æ®å½“ä½œä¸ªå‚æ•°ï¼Œæ”¾åˆ°å‡½æ•°é‡Œå»è°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;3.ç„¶åæŠŠå‡½æ•°çš„è¿”å›å€¼æ”¾åˆ°ä¸€ä¸ªåˆ—è¡¨é‡Œé¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224145551.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å®ƒè¿”å›ä»€ä¹ˆå°±æ”¾ä»€ä¹ˆï¼Œæ”¹æˆè¿”å› 1000ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224150209.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ”¹æˆ&lt;code&gt;n*2&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224150453.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;map()&lt;/code&gt;å°†å¯è¿­ä»£å¯¹è±¡é‡Œé¢çš„å…ƒç´ è¿­ä»£å‡ºæ¥ï¼Œæ¯ä¸ªå…ƒç´ å½“ä½œä¸€ä¸ªå‚æ•°ï¼Œä¼ åˆ°å‰é¢è¿™ä¸ªå‡½æ•°&lt;code&gt;fun&lt;/code&gt;é‡Œé¢ï¼Œç„¶åæŠŠå‡½æ•°çš„è¿”å›å€¼æ·»åŠ åˆ°æ–°çš„åˆ—è¡¨é‡Œé¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224150903.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;è¦ç»Ÿä¸€å¤„ç†ä¸€æ‰¹æ•°æ®çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡å®ƒæ¥åšã€‚&lt;/p&gt;
&lt;h2 id=&quot;ä¸‰ã€zipå‡½æ•°&quot;&gt;ä¸‰ã€zip()å‡½æ•°&lt;/h2&gt;
&lt;h3 id=&quot;1ä»€ä¹ˆæ˜¯-zipå‡½æ•°&quot;&gt;1.ä»€ä¹ˆæ˜¯ zip()å‡½æ•°&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;zip()å‡½æ•°åé¢æ¥æ”¶çš„æ˜¯ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œåé¢å¯æ¥æ”¶å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224151656.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¥çœ‹çœ‹ zip çš„æºç ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å®ƒçš„å†…éƒ¨å…¶å®ä¹Ÿæ˜¯ä¸ªç±»ï¼Œé‚£ä¹ˆå®ƒè¿”å›çš„å°±æ˜¯ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224151929.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å‡†ç¡®å¾—æ¥è¯´ï¼Œå®ƒæ˜¯ä¸ªè¿­ä»£å™¨ï¼Œè¿­ä»£å™¨ä¹Ÿå±äºå¯è¿­ä»£å¯¹è±¡ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-PYTHON&quot;&gt;# zip # æ‰“åŒ…
res3 = zip([1, 2, 3], [11, 22, 33])
print(res3)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨ Python2 çš„æ—¶å€™ï¼Œ&lt;code&gt;filter()&lt;/code&gt;ã€&lt;code&gt;map()&lt;/code&gt;ã€&lt;code&gt;zip()&lt;/code&gt;å‡½æ•°è¿”å›å‡ºæ¥çš„ç›´æ¥æ˜¯åˆ—è¡¨ã€‚Python3 åšäº†ä¸ªæ€§èƒ½çš„ä¼˜åŒ–ï¼Œè¿”å›çš„æ˜¯ä¸ªè¿­ä»£å™¨ï¼Œå¯ä»¥èŠ‚çº¦å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224152817.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡&lt;code&gt;next()&lt;/code&gt;å»å–å€¼ï¼Œèƒ½è·å–å‡ºæ¥å†…å®¹çš„è¯ï¼Œè¯´æ˜å®ƒå°±æ˜¯ä¸ªè¿­ä»£å™¨ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224152948.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ç›´æ¥ä¸€æ¬¡æ€§æŠŠå®ƒè½¬æ¢æˆåˆ—è¡¨ï¼Œæ–¹ä¾¿çœ‹ç»“æœï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-PYTHON&quot;&gt;# zip # æ‰“åŒ…
res3 = zip([1, 2, 3], [11, 22, 33])
print(list(res3))
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;å®ƒæ˜¯è¿™æ ·æ‰“åŒ…çš„ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;zip()&lt;/code&gt;å‡½æ•°ä¼ å…¥ 2 ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ŒæŠŠç¬¬ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡çš„ç¬¬ä¸€ä¸ªå…ƒç´ å’Œç¬¬äºŒä¸ªå¯è¿­ä»£å¯¹è±¡çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ‹¿å‡ºæ¥æ‰“åŒ…æˆä¸€ä¸ªå…ƒç»„ï¼Œåé¢ä»¥æ­¤ç±»æ¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224153650.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224154015.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ä¸ºä»€ä¹ˆé‡Œé¢æ”¾çš„æ˜¯å…ƒç»„ï¼Ÿ&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å…ƒç»„çœå†…å­˜å•Šã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;å¦‚æœå¯è¿­ä»£å¯¹è±¡é‡Œé¢å…ƒç´ å¤šå°‘ä¸ä¸€æ ·ï¼ˆé•¿çŸ­ä¸ä¸€ï¼‰æ€ä¹ˆåŠï¼Ÿ&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-PYTHON&quot;&gt;# zip # æ‰“åŒ…
res3 = zip([1, 2, 3], [11, 22, 33,44,55],[111,222,333],[111,222,333])
print(list(res3))
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å®ƒä¼šåªä¼šä¿ç•™æœ€çŸ­çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224154916.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä»£ç ä¸­æœ€çŸ­çš„ä¸€ç»„ï¼šè¿™é‡Œåªæœ‰ 3 ä¸ªå…ƒç´ ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆè¿™é‡Œçš„è¯ï¼Œåªä¼šåˆ†æˆ 3 ç»„ã€‚å°±ç®—ç¬¬äºŒç»„æœ‰ 5 ä¸ªå…ƒç´ ï¼Œåªä¼šæ‹¿ç¬¬ä¸€ä¸ªã€ç¬¬äºŒä¸ªã€ç¬¬ä¸‰ä¸ªã€‚å¤šä½™çš„æ•°æ®æ¸…é™¤æ‰äº†ï¼Œä¸è¦äº†ã€‚&lt;/p&gt;
&lt;h3 id=&quot;2zipå¯ä»¥å¿«é€Ÿåˆ›å»ºå­—å…¸&quot;&gt;2.zip()å¯ä»¥å¿«é€Ÿåˆ›å»ºå­—å…¸&lt;/h3&gt;
&lt;p&gt;ä½ çœ‹ï¼Œå’Œå­—å…¸&lt;code&gt;items()&lt;/code&gt;å–å€¼å‡ºæ¥çš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224161106.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡&lt;code&gt;dict&lt;/code&gt;è½¬æ¢ä¸‹ï¼Œä½ çœ‹ï¼Œå®ƒå˜æˆäº†ä¸€ä¸ªå­—å…¸ï¼š&lt;/p&gt;
&lt;pre&gt;
&lt;code class=&quot;language-PYTHON&quot;&gt;# zip # æ‰“åŒ…
res3 = zip([1, 2, 3], [11, 22, 33])
print(dict(list(res3)))

dict1={&quot;key1&quot;:1,&quot;key2&quot;:2,&quot;key3&quot;:3}
print(list(dict1.items()))
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;https://gitee.com/qinghanstudy/qinghan/raw/master/img/20201224161248.png&quot; alt=&quot;&quot; loading=&quot;lazy&quot;/&gt;&lt;/p&gt;
&lt;p&gt;åˆ›å»ºå­—å…¸çš„æ—¶å€™ï¼Œå¯é€šè¿‡è¿™ç§æ–¹å¼å¿«é€Ÿåˆ›å»ºå­—å…¸ã€‚&lt;/p&gt;
&lt;p&gt;æŠŠé”®æ”¾åœ¨ä¸€ä¸ªåˆ—è¡¨é‡Œï¼ŒæŠŠå€¼æ”¾åœ¨ä¸€ä¸ªåˆ—è¡¨é‡Œï¼Œé€šè¿‡&lt;code&gt;zip()&lt;/code&gt;æ‰“åŒ…ä¸€ä¸‹ï¼Œé€šè¿‡&lt;code&gt;dit()&lt;/code&gt;å°±èƒ½æŠŠå®ƒè½¬æ¢æˆä¸€ä¸ªå­—å…¸ã€‚&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;å…¬ä¼—å·&lt;strong&gt;æ¸…è¡è½¯ä»¶æµ‹è¯•&lt;/strong&gt;é¦–å‘ï¼Œæ›´å¤šåŸåˆ›æ–‡ç« ï¼š&lt;strong&gt;æ¸…è¡è½¯ä»¶æµ‹è¯• 112+åŸåˆ›æ–‡ç« &lt;/strong&gt;ï¼Œæ¬¢è¿å…³æ³¨ã€äº¤æµï¼Œç¦æ­¢ç¬¬ä¸‰æ–¹æ“…è‡ªè½¬è½½ã€‚&lt;/p&gt;
</description>
<pubDate>Thu, 24 Dec 2020 16:10:00 +0000</pubDate>
<dc:creator>æ¸…è¡</dc:creator>
<og:description>åšæŒåŸåˆ›è¾“å‡ºï¼Œç‚¹å‡»è“å­—å…³æ³¨æˆ‘å§ ä½œè€…ï¼šæ¸…è¡ åšå®¢ï¼šoschinaã€äº‘+ç¤¾åŒºã€çŸ¥ä¹ç­‰å„å¤§å¹³å°éƒ½æœ‰ã€‚ ç”±äºå¾®ä¿¡å…¬ä¼—å·æ¨é€æ”¹ä¸ºäº†ä¿¡æ¯æµçš„å½¢å¼ï¼Œé˜²æ­¢èµ°ä¸¢ï¼Œè¯·ç»™åŠ ä¸ªæ˜Ÿæ ‡ â­ï¼Œä½ å°±å¯ä»¥ç¬¬ä¸€æ—¶é—´æ¥æ”¶åˆ°æœ¬å…¬ä¼—å·çš„æ¨é€</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/qinghan123/p/14187006.html</dc:identifier>
</item>
<item>
<title>ucoreæ“ä½œç³»ç»Ÿå­¦ä¹ (ä¸ƒ) ucore lab7åŒæ­¥äº’æ–¥ - å°ç†Šé¤é¦†</title>
<link>http://www.cnblogs.com/xiaoxiongcanguan/p/14152830.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/xiaoxiongcanguan/p/14152830.html</guid>
<description>&lt;p&gt;ã€€ã€€ucoreåœ¨å‰é¢çš„å®éªŒä¸­å®ç°äº†è¿›ç¨‹/çº¿ç¨‹æœºåˆ¶ï¼Œå¹¶åœ¨lab6ä¸­å®ç°äº†æŠ¢å å¼çš„çº¿ç¨‹è°ƒåº¦æœºåˆ¶ã€‚åŸºäºä¸­æ–­çš„æŠ¢å å¼çº¿ç¨‹è°ƒåº¦æœºåˆ¶ä½¿å¾—çº¿ç¨‹åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­éšæ—¶å¯èƒ½è¢«æ“ä½œç³»ç»Ÿæ‰“æ–­ï¼Œè¢«é˜»å¡æŒ‚èµ·è€Œä»¤å…¶å®ƒçš„çº¿ç¨‹è·å¾—CPUã€‚å¤šä¸ªçº¿ç¨‹å¹¶å‘çš„æ‰§è¡Œï¼Œå¤§å¤§æå‡äº†écpuå¯†é›†å‹åº”ç”¨ç¨‹åºçš„cpuååé‡ï¼Œä½¿å¾—è®¡ç®—æœºç³»ç»Ÿä¸­å®è´µçš„cpuç¡¬ä»¶èµ„æºå¾—åˆ°äº†å……åˆ†åˆ©ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€æ“ä½œç³»ç»Ÿæä¾›çš„å†…æ ¸çº¿ç¨‹å¹¶å‘æœºåˆ¶çš„ä¼˜ç‚¹æ˜¯æ˜æ˜¾çš„ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼Œå…¶ä¸­é¦–å½“å…¶å†²çš„ä¾¿æ˜¯çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;å¹¶å‘å¸¦æ¥çš„çº¿ç¨‹å®‰å…¨é—®é¢˜&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€çº¿ç¨‹å®‰å…¨æŒ‡çš„æ˜¯åœ¨æ‹¥æœ‰å…±äº«æ•°æ®çš„å¤šæ¡çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œçš„ç¨‹åºä¸­ï¼Œçº¿ç¨‹å®‰å…¨çš„ä»£ç ä¼šé€šè¿‡åŒæ­¥æœºåˆ¶ä¿è¯å„ä¸ªçº¿ç¨‹éƒ½å¯ä»¥æ­£å¸¸ä¸”æ­£ç¡®çš„æ‰§è¡Œï¼Œä¸ä¼šå‡ºç°æ•°æ®æ±¡æŸ“ç­‰æ„å¤–æƒ…å†µã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€ä¸¾ä¸€ä¸ªç»å…¸çš„ä¾‹å­ï¼šåœ¨é«˜çº§è¯­è¨€ä¸­å¯¹äºæŸä¸€å…±äº«æ•´å‹å˜é‡iï¼ˆå‡è®¾i=5ï¼‰è¿›è¡Œçš„i++æ“ä½œï¼Œåœ¨æœ€ç»ˆçš„æœºå™¨ä»£ç ä¸­ä¼šè¢«åˆ†è§£ä¸ºå‡ ä¸ªæ›´ç»†è‡´çš„æœºå™¨æŒ‡ä»¤ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€1. ä»å†…å­˜çš„å¯¹åº”åœ°å€ä¸­è¯»å–å‡ºå˜é‡içš„å€¼ï¼ˆé«˜çº§è¯­è¨€çš„å˜é‡åœ¨æœºå™¨å±‚é¢è¡¨ç°ä¸ºä¸€ä¸ªå†…å­˜åœ°å€ï¼‰ï¼Œå†™å…¥cpuçš„å¯„å­˜å™¨ä¸­ï¼ˆå‡è®¾æ˜¯edxï¼‰&lt;/p&gt;
&lt;p&gt;ã€€ã€€2. å¯¹å¯„å­˜å™¨edxè¿›è¡Œ+1è¿ç®—ï¼ˆè¿ç®—åedxå¯„å­˜å™¨ä¸­çš„å€¼ä¸º5+1=6ï¼‰&lt;/p&gt;
&lt;p&gt;ã€€ã€€3. å°†edxçš„å€¼å†™å…¥å˜é‡iå¯¹åº”çš„å†…å­˜ç©ºé—´ä¸­ï¼ˆåœ¨é«˜çº§è¯­è¨€å±‚é¢çœ‹ï¼Œå†™å…¥edxä¸­çš„æ–°å€¼åiå˜æˆäº†6ï¼‰&lt;/p&gt;
&lt;p&gt;ã€€ã€€é€šè¿‡ä¹‹å‰lab5/lab6çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨i++å…·ä½“çš„æœºå™¨æŒ‡ä»¤åºåˆ—æ‰§è¡Œçš„æ¯ä¸€æ­¥è¿‡ç¨‹ä¸­ï¼Œæ“ä½œç³»ç»Ÿéƒ½å¯èƒ½é€šè¿‡æ—¶é’Ÿä¸­æ–­æ‰“æ–­å¯¹åº”çº¿ç¨‹çš„æ‰§è¡Œï¼Œè¿›è¡Œçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚æœºå™¨æŒ‡ä»¤æ˜¯åŸå­æ€§çš„ï¼Œä½†é«˜çº§è¯­è¨€ä¸­çš„ä¸€æ¡æŒ‡ä»¤åº•å±‚å¯èƒ½å¯¹åº”å¤šä¸ªæœºå™¨æŒ‡ä»¤ï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å¯èƒ½è¢«ä¸­æ–­ä»‹å…¥ï¼Œæ— æ³•ä¿è¯æ‰§è¡Œçš„è¿è´¯æ€§ã€‚&lt;/p&gt;
&lt;h2&gt;çº¿ç¨‹å®‰å…¨é—®é¢˜ä¸¾ä¾‹&lt;/h2&gt;
&lt;p&gt;ã€€ã€€ä¾‹å¦‚ï¼Œå­˜åœ¨ä¸¤ä¸ªå¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹aã€çº¿ç¨‹bï¼Œéƒ½å¯¹çº¿ç¨‹é—´çš„å…±äº«å˜é‡iï¼ˆi=5ï¼‰è¿›è¡Œäº†i++æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸¤ä¸ªçº¿ç¨‹çš„æ‰§è¡Œi++æ—¶çš„æœºå™¨æŒ‡ä»¤æµæŒ‰ç…§æ—¶é—´é¡ºåºä¾æ¬¡ä¸ºï¼šã€€ã€€&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€1. çº¿ç¨‹aè¯»å–å†…å­˜ä¸­å˜é‡içš„å€¼ï¼Œå†™å…¥å¯„å­˜å™¨edxï¼ˆæ­¤æ—¶å†…å­˜ä¸­içš„å€¼ä¸º5ï¼Œedxçš„å€¼ä¸º5ï¼‰ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€2. çº¿ç¨‹aä»¤edxè¿›è¡Œ+1è¿ç®—ï¼Œæ­¤æ—¶å¯„å­˜å™¨edxçš„å€¼ä¸º6ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€3. æ“ä½œç³»ç»Ÿå¤„ç†æ—¶é’Ÿä¸­æ–­ï¼Œå‘ç°çº¿ç¨‹açš„æ—¶é—´ç‰‡å·²ç»ç”¨å®Œï¼Œå°†å…¶æŒ‚èµ·ï¼Œä¿å­˜çº¿ç¨‹açš„ä¸Šä¸‹æ–‡ï¼ˆæ­¤æ—¶çº¿ç¨‹açš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡ä¸­edx=6ï¼‰ï¼›å¹¶è°ƒåº¦çº¿ç¨‹bå¼€å§‹è·å–cpuæ‰§è¡Œã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€4. çº¿ç¨‹bè¯»å–å†…å­˜ä¸­å˜é‡içš„å€¼ï¼Œå†™å…¥å¯„å­˜å™¨edxï¼ˆæ­¤æ—¶å†…å­˜ä¸­içš„å€¼ä¸º5ï¼Œedxçš„å€¼ä¸º5ï¼‰ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€5. çº¿ç¨‹bä»¤edxè¿›è¡Œ+1è¿ç®—ï¼Œæ­¤æ—¶å¯„å­˜å™¨edxçš„å€¼ä¸º6ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€6. æ“ä½œç³»ç»Ÿå¤„ç†æ—¶é’Ÿä¸­æ–­ï¼Œå‘ç°çº¿ç¨‹bçš„æ—¶é—´ç‰‡å·²ç»ç”¨å®Œï¼Œå°†å…¶æŒ‚èµ·ï¼Œä¿å­˜çº¿ç¨‹bçš„ä¸Šä¸‹æ–‡ï¼ˆæ­¤æ—¶çº¿ç¨‹bçš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡ä¸­edx=6ï¼‰ï¼›å¹¶è°ƒåº¦çº¿ç¨‹aå¼€å§‹è·å–cpuæ‰§è¡Œã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€7. çº¿ç¨‹aæ¢å¤ç°åœºç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå°†ç°åœºæ¢å¤åedxçš„å€¼å†™å›å†…å­˜ä¸­å˜é‡iå¯¹åº”çš„å†…å­˜åœ°å€ä¸­ï¼Œå†™å›åå˜é‡i=6ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€8. æ“ä½œç³»ç»Ÿå¤„ç†æ—¶é’Ÿä¸­æ–­ï¼Œå‘ç°çº¿ç¨‹açš„æ—¶é—´ç‰‡å·²ç»ç”¨å®Œï¼Œå°†å…¶æŒ‚èµ·ï¼›å¹¶è°ƒåº¦çº¿ç¨‹aå¼€å§‹è·å–cpuæ‰§è¡Œã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€9. çº¿ç¨‹bæ¢å¤ç°åœºç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå°†ç°åœºæ¢å¤åedxçš„å€¼å†™ä¼šå†…å­˜ä¸­å˜é‡iå¯¹åº”çš„å†…å­˜åœ°å€ä¸­ï¼Œå†™å›åå˜é‡i=6ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œç”±äºæ“ä½œç³»ç»Ÿçš„æŠ¢å å¼è°ƒåº¦ä»¥åŠé«˜çº§è¯­è¨€ä¸­i++æ“ä½œçš„éåŸå­æ€§ï¼Œä½¿å¾—åŸæœ¬åˆå§‹å€¼ä¸º5çš„å˜é‡iï¼Œåœ¨æ‰§è¡Œä¸¤æ¬¡i++ä¹‹åå¾—åˆ°çš„å¹¶ä¸æ˜¯é¢„æœŸçš„7ï¼Œè€Œæ˜¯é”™è¯¯çš„6ã€‚è¿™è¿˜ä»…ä»…æ˜¯ä¸¤ä¸ªå¹¶å‘çº¿ç¨‹å¯¹äºä¸€ä¸ªå…±äº«å˜é‡çš„æ“ä½œé—®é¢˜ï¼Œå®é™…çš„ç¨‹åºä¸­ä¼šæ¶‰åŠåˆ°æ›´å¤šçš„å¹¶å‘çº¿ç¨‹å’Œå…±äº«å˜é‡ï¼Œä½¿å¾—æ‰€ç¼–å†™çš„å¤šçº¿ç¨‹å¹¶å‘ç¨‹åºæ­£ç¡®æ€§æ— æ³•å¾—åˆ°ä¿è¯ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;æ“ä½œç³»ç»Ÿè§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ‰‹æ®µ&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€&lt;/strong&gt;åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¨‹åºçš„æ­£ç¡®æ€§éƒ½æ¯”æ€§èƒ½é‡è¦çš„å¤šã€‚æ“ä½œç³»ç»Ÿåœ¨å¼•å…¥æŠ¢å å¼è°ƒåº¦çš„çº¿ç¨‹å¹¶å‘æœºåˆ¶çš„åŒæ—¶ï¼Œä¹Ÿéœ€è¦æä¾›ç›¸åº”çš„æ‰‹æ®µæ¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€&lt;strong&gt;è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ€è·¯ï¼šä¸€æ˜¯æ¶ˆé™¤ç¨‹åºçš„å¹¶å‘æ€§ï¼›äºŒæ˜¯é˜»æ­¢å¤šä¸ªçº¿ç¨‹å¹¶å‘çš„è®¿é—®å…±äº«èµ„æº(å…±äº«å†…å­˜ã€å…±äº«æ–‡ä»¶ã€å…±äº«å¤–è®¾ç­‰ç­‰)çš„è®¿é—®ï¼Œå³äº’æ–¥ï¼šä½¿å¾—ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®æŸä¸€å…±äº«èµ„æºæ—¶ï¼Œå…¶å®ƒçš„çº¿ç¨‹ä¸èƒ½è¿›è¡ŒåŒæ ·çš„æ“ä½œã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€ç¬¬ä¸€ç§æ€è·¯è¢«ä¸€äº›I/Oå¯†é›†å‹çš„åº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨ï¼Œå³æ•´ä¸ªç¨‹åº(è¿›ç¨‹)ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å·¥ä½œï¼Œé€šè¿‡æ“ä½œç³»ç»Ÿåº•å±‚æä¾›çš„i/oå¤šè·¯å¤ç”¨æœºåˆ¶è¿›è¡Œå·¥ä½œï¼Œæ—©æœŸçš„redisä»¥åŠnodeJSå°±æ˜¯å·¥ä½œåœ¨å•çº¿ç¨‹æ¨¡å‹ä¸‹çš„ã€‚å•çº¿ç¨‹å·¥ä½œçš„åº”ç”¨ç¨‹åºç”±äºä¸å­˜åœ¨å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„åœºæ™¯ï¼Œæ¶ˆé™¤äº†çº¿ç¨‹çš„å¹¶å‘æ€§ï¼Œè‡ªç„¶ä¹Ÿä¸éœ€è¦å¤„ç†çº¿ç¨‹å®‰å…¨é—®é¢˜äº†ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€è€Œæ“ä½œç³»ç»Ÿè§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„æ–¹å¼é‡‡ç”¨çš„æ˜¯ç¬¬äºŒç§æ€è·¯(é€šç”¨æ“ä½œç³»ç»Ÿæ˜¯ç”¨äºåŒæ—¶ä¸ºå¤§é‡è¿›ç¨‹ã€çº¿ç¨‹æœåŠ¡çš„ï¼Œå› æ­¤ä¸èƒ½å†å›è¿‡å¤´æ¥ç¦æ­¢å¹¶å‘)ï¼Œé€šè¿‡ä¸€äº›æœºåˆ¶é™åˆ¶å¹¶å‘çº¿ç¨‹åŒæ—¶è®¿é—®ä¼šå¼•èµ·çº¿ç¨‹å®‰å…¨é—®é¢˜çš„å…±äº«å˜é‡ï¼Œä¿è¯è®¿é—®çš„äº’æ–¥æ€§ã€‚&lt;/p&gt;
&lt;h3&gt;&lt;strong&gt;ã€€ã€€åœ¨å…³äºæ“ä½œç³»ç»ŸåŸç†çš„ç†è®ºä¹¦ç±ä¸­ä»‹ç»äº†å¾ˆå¤šç”¨äºå®ç°äº’æ–¥æœºåˆ¶çš„åŠæ³•ï¼Œè€Œucoreåœ¨lab7ä¸­ä¸»è¦å®ç°äº†â€œä¿¡å·é‡â€å’Œâ€œæ¡ä»¶å˜é‡â€è¿™ä¸¤ç§æ•ˆç‡è¾ƒé«˜çš„ã€ä¸»æµçš„ã€åŸºäºä¼‘çœ /å”¤é†’æœºåˆ¶çš„åŒæ­¥äº’æ–¥æœºåˆ¶ã€‚lab7ä¸­ä¹Ÿä»¥å“²å­¦å®¶å°±é¤é—®é¢˜ä¸ºä¾‹ï¼Œé€šè¿‡ä¿¡å·é‡Semaphoreä»¥åŠç®¡ç¨‹Monitorè§£å†³å¹¶å‘é¢†åŸŸä¸­å¾ˆç»å…¸çš„çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚&lt;/strong&gt;&lt;strong&gt;&lt;br/&gt;&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€é€šè¿‡lab7çš„å­¦ä¹ ï¼Œå°†èƒ½å¤Ÿæ·±å…¥å­¦ä¹ æ“ä½œç³»ç»Ÿåº•å±‚å®ç°çº¿ç¨‹åŒæ­¥ã€äº’æ–¥æœºåˆ¶ï¼Œç†è§£ä¿¡å·é‡ã€æ¡ä»¶å˜é‡ã€ç®¡ç¨‹ç­‰åŒæ­¥äº’æ–¥æœºåˆ¶çš„å·¥ä½œåŸç†ï¼›ä¹Ÿå¯ä»¥å¯¹æ›´ä¸Šå±‚çš„å¦‚javaä¸­çš„synchronizedã€AQSæ‚²è§‚é”ã€ç®¡ç¨‹monitorã€notify/waitç­‰çº¿ç¨‹å¹¶å‘åŒæ­¥æœºåˆ¶æœ‰æ›´æ·±çš„ç†è§£ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€lab7æ˜¯å»ºç«‹åœ¨ä¹‹å‰å®éªŒçš„åŸºç¡€ä¹‹ä¸Šçš„ï¼Œéœ€è¦å…ˆç†è§£ä¹‹å‰çš„å®éªŒæ‰èƒ½æ›´å¥½çš„ç†è§£lab7ä¸­çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯ä»¥å‚è€ƒä¸€ä¸‹æˆ‘å…³äºå‰é¢å®éªŒçš„åšå®¢ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€1.Â &lt;a id=&quot;cb_post_title_url&quot; class=&quot;postTitle2 vertical-middle&quot; href=&quot;https://www.cnblogs.com/xiaoxiongcanguan/p/13714587.html&quot;&gt;ucoreæ“ä½œç³»ç»Ÿå­¦ä¹ (ä¸€) ucore lab1ç³»ç»Ÿå¯åŠ¨æµç¨‹åˆ†æ&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€2.Â &lt;a id=&quot;cb_post_title_url&quot; class=&quot;postTitle2 vertical-middle&quot; href=&quot;https://www.cnblogs.com/xiaoxiongcanguan/p/13756389.html&quot;&gt;ucoreæ“ä½œç³»ç»Ÿå­¦ä¹ (äºŒ) ucore lab2ç‰©ç†å†…å­˜ç®¡ç†åˆ†æ&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€3.Â &lt;a id=&quot;cb_post_title_url&quot; class=&quot;postTitle2 vertical-middle&quot; href=&quot;https://www.cnblogs.com/xiaoxiongcanguan/p/13854711.html&quot;&gt;ucoreæ“ä½œç³»ç»Ÿå­¦ä¹ (ä¸‰) ucore lab3è™šæ‹Ÿå†…å­˜ç®¡ç†åˆ†æ&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€4.Â &lt;a id=&quot;cb_post_title_url&quot; class=&quot;postTitle2 vertical-middle&quot; href=&quot;https://www.cnblogs.com/xiaoxiongcanguan/p/13904233.html&quot;&gt;ucoreæ“ä½œç³»ç»Ÿå­¦ä¹ (å››) ucore lab4å†…æ ¸çº¿ç¨‹ç®¡ç†&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€5.Â &lt;a id=&quot;cb_post_title_url&quot; class=&quot;postTitle2 vertical-middle&quot; href=&quot;https://www.cnblogs.com/xiaoxiongcanguan/p/14007886.html&quot;&gt;ucoreæ“ä½œç³»ç»Ÿå­¦ä¹ (äº”) ucore lab5ç”¨æˆ·è¿›ç¨‹ç®¡ç†&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€6.Â &lt;a id=&quot;cb_post_title_url&quot; class=&quot;postTitle2 vertical-middle&quot; href=&quot;https://www.cnblogs.com/xiaoxiongcanguan/p/14087833.html&quot;&gt;ucoreæ“ä½œç³»ç»Ÿå­¦ä¹ (å…­) ucore lab6çº¿ç¨‹è°ƒåº¦å™¨&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ã€€ã€€ucoreåœ¨lab7ä¸­çš„å†…å®¹å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;p&gt;ã€€ã€€&lt;strong&gt;1.Â  å®ç°ç­‰å¾…é˜Ÿåˆ—&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€2.Â  å®ç°ä¿¡å·é‡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€3.Â  ä½¿ç”¨ä¿¡å·é‡è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€4.Â  åŸºäºä¿¡å·é‡å®ç°æ¡ä»¶å˜é‡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€5.Â  åŸºäºä¿¡å·é‡å’Œæ¡ä»¶å˜é‡å®ç°ç®¡ç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€6.Â  ä½¿ç”¨ç®¡ç¨‹è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;2.1 å®ç°ç­‰å¾…é˜Ÿåˆ—&lt;/h2&gt;
&lt;h3&gt;ç­‰å¾…é˜Ÿåˆ—ä»‹ç»&lt;/h3&gt;
&lt;p&gt;ã€€ã€€å‰é¢æåˆ°ï¼Œucoreåœ¨lab7ä¸­å®ç°çš„åŒæ­¥æœºåˆ¶æ˜¯åŸºäºä¼‘çœ /å”¤é†’æœºåˆ¶çš„ã€‚ä¸ºäº†ä¿è¯çº¿ç¨‹å¯¹äºä¸´ç•ŒåŒºè®¿é—®çš„äº’æ–¥æ€§ï¼Œåœ¨å‰ä¸€ä¸ªçº¿ç¨‹å·²ç»è¿›å…¥äº†ä¸´ç•ŒåŒºåï¼Œåç»­è¦è®¿é—®ä¸´ç•ŒåŒºçš„çº¿ç¨‹ä¼šè¢«é˜»å¡ä»¥ç­‰å¾…å‰ä¸€ä¸ªçº¿ç¨‹ç¦»å¼€ä¸´ç•ŒåŒºï¼Œåœ¨ä¹‹å‰è¿›å…¥ä¸´ç•ŒåŒºçš„çº¿ç¨‹ç¦»å¼€ä¸´ç•ŒåŒºåè¢«é˜»å¡çš„çº¿ç¨‹ä¼šè¢«å†æ¬¡å”¤é†’è·å¾—è¿›å…¥ä¸´ç•ŒåŒºçš„èµ„æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€åœ¨æœ‰è®¸å¤šçº¿ç¨‹å¹¶å‘æ—¶ï¼Œå¯èƒ½ä¼šæœ‰ä¸æ­¢ä¸€ä¸ªçº¿ç¨‹è¢«é˜»å¡åœ¨å¯¹åº”çš„ä¸´ç•ŒåŒºï¼Œä¸ºæ­¤æŠ½è±¡å‡ºäº†ç­‰å¾…é˜Ÿåˆ—ç»“æ„(&lt;strong&gt;wait_queue&lt;/strong&gt;)ç”¨äºç»´æŠ¤è¿™ä¸€è¢«é˜»å¡çº¿ç¨‹çš„é›†åˆã€‚å½“çº¿ç¨‹ç”±äºäº’æ–¥è€Œè¢«é˜»å¡åœ¨ä¸´ç•ŒåŒºæ—¶ï¼Œå°†å…¶åŠ å…¥ç­‰å¾…é˜Ÿåˆ—å¹¶æ”¾å¼ƒcpuè¿›å…¥é˜»å¡æ€ï¼›å½“ä¹‹å‰è·å¾—ä¸´ç•ŒåŒºè®¿é—®æƒé™çš„çº¿ç¨‹ç¦»å¼€åï¼Œå†ä»å¯¹åº”çš„ç­‰å¾…é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªè¢«é˜»å¡ã€å¤„äºç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹å”¤é†’ï¼Œè¢«å”¤é†’çš„çº¿ç¨‹èƒ½æ¥ç€è¿›å…¥ä¸´ç•ŒåŒºã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€åˆ©ç”¨ç­‰å¾…é˜Ÿåˆ—ï¼Œä½¿å¾—è‡ªå§‹è‡³ç»ˆéƒ½åªæœ‰æœ€å¤šä¸€ä¸ªçº¿ç¨‹åœ¨ä¸´ç•ŒåŒºä¸­ï¼Œä¿è¯äº†äº’æ–¥æ€§ï¼›è€Œçº¿ç¨‹åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¼‘çœ (é˜»å¡)/å”¤é†’åŠ¨ä½œï¼Œåˆ™å®ç°äº†çº¿ç¨‹ä¹‹é—´å¯¹äºä¸´ç•ŒåŒºè®¿é—®çš„åŒæ­¥ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€ç­‰å¾…é˜Ÿåˆ—å½“ç„¶å¹¶ä¸åªé€‚ç”¨äºçº¿ç¨‹å¹¶å‘åŒæ­¥ï¼Œå½“çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ä»¥ç­‰å¾…æŸä¸€ç‰¹å®šå®Œæˆäº‹ä»¶æ—¶(å®šæ—¶ä¼‘çœ ä¸€æ®µæ—¶é—´ã€ç­‰å¾…é˜»å¡IOè¯»å†™å®Œæˆç­‰ç­‰äº‹ä»¶)ï¼Œåº•å±‚éƒ½å¯ä»¥ä½¿ç”¨ç­‰å¾…é˜Ÿåˆ—æ¥å®ç°ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h3&gt;&lt;strong&gt;ç­‰å¾…é˜Ÿåˆ—å®ç°&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€ucoreåœ¨/kern/syncç›®å½•ä¸‹çš„wait.cã€wait.hä¸­å®ç°äº†ç­‰å¾…é˜Ÿåˆ—wait_queueã€ç­‰å¾…é˜Ÿåˆ—èŠ‚ç‚¹é¡¹wait_tä»¥åŠç›¸å…³çš„å‡½æ•°ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€ucoreçš„ç­‰å¾…é˜Ÿåˆ—åº•å±‚æ˜¯é€šè¿‡åŒå‘é“¾è¡¨ç»“æ„å®ç°çš„ã€‚å’Œå‰é¢çš„å®éªŒç±»ä¼¼çš„ï¼Œæä¾›äº†ä¸€ä¸ªå®å®šä¹‰le2waitç”¨äºè®¿é—®wait_linkèŠ‚ç‚¹é¡¹å¯¹åº”çš„wait_tç»“æ„ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç­‰å¾…é˜Ÿåˆ—ç»“æ„ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * ç­‰å¾…é˜Ÿåˆ—
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
typedef &lt;/span&gt;&lt;span&gt;struct&lt;/span&gt;&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç­‰å¾…é˜Ÿåˆ—çš„å¤´ç»“ç‚¹(å“¨å…µèŠ‚ç‚¹)&lt;/span&gt;
&lt;span&gt;    list_entry_t wait_head;
} wait_queue_t;

&lt;/span&gt;&lt;span&gt;struct&lt;/span&gt;&lt;span&gt; proc_struct;

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * ç­‰å¾…é˜Ÿåˆ—èŠ‚ç‚¹é¡¹
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
typedef &lt;/span&gt;&lt;span&gt;struct&lt;/span&gt;&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å…³è”çš„çº¿ç¨‹&lt;/span&gt;
    &lt;span&gt;struct&lt;/span&gt; proc_struct *&lt;span&gt;proc;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å”¤é†’æ ‡è¯†&lt;/span&gt;
&lt;span&gt;    uint32_t wakeup_flags;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è¯¥èŠ‚ç‚¹æ‰€å±çš„ç­‰å¾…é˜Ÿåˆ—&lt;/span&gt;
    wait_queue_t *&lt;span&gt;wait_queue;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç­‰å¾…é˜Ÿåˆ—èŠ‚ç‚¹&lt;/span&gt;
&lt;span&gt;    list_entry_t wait_link;
} wait_t;

&lt;/span&gt;&lt;span&gt;#define&lt;/span&gt; le2wait(le, member)         \&lt;span&gt;
    to_struct((le), wait_t, member)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;ç­‰å¾…é˜Ÿåˆ—ç»“æ„åº•å±‚æ“ä½œï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;42&quot;&gt;
&lt;pre&gt;
&lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆå§‹åŒ–wait_tç­‰å¾…é˜Ÿåˆ—é¡¹&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt; wait_init(wait_t *wait, &lt;span&gt;struct&lt;/span&gt; proc_struct *&lt;span&gt;proc);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆå§‹åŒ–ç­‰å¾…é˜Ÿåˆ—&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt; wait_queue_init(wait_queue_t *&lt;span&gt;queue);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å°†waitèŠ‚ç‚¹é¡¹æ’å…¥ç­‰å¾…é˜Ÿåˆ—&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt; wait_queue_add(wait_queue_t *queue, wait_t *&lt;span&gt;wait);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å°†waité¡¹ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt; wait_queue_del(wait_queue_t *queue, wait_t *&lt;span&gt;wait);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å–ç­‰å¾…é˜Ÿåˆ—ä¸­waitèŠ‚ç‚¹çš„ä¸‹ä¸€é¡¹&lt;/span&gt;
wait_t *wait_queue_next(wait_queue_t *queue, wait_t *&lt;span&gt;wait);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å–ç­‰å¾…é˜Ÿåˆ—ä¸­waitèŠ‚ç‚¹çš„å‰ä¸€é¡¹&lt;/span&gt;
wait_t *wait_queue_prev(wait_queue_t *queue, wait_t *&lt;span&gt;wait);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å–ç­‰å¾…é˜Ÿåˆ—çš„ç¬¬ä¸€é¡¹&lt;/span&gt;
wait_t *wait_queue_first(wait_queue_t *&lt;span&gt;queue);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å–ç­‰å¾…é˜Ÿåˆ—çš„æœ€åä¸€é¡¹&lt;/span&gt;
wait_t *wait_queue_last(wait_queue_t *&lt;span&gt;queue);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç­‰å¾…é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º&lt;/span&gt;
&lt;span&gt;bool&lt;/span&gt; wait_queue_empty(wait_queue_t *&lt;span&gt;queue);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; waité¡¹æ˜¯å¦åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­&lt;/span&gt;
&lt;span&gt;bool&lt;/span&gt; wait_in_queue(wait_t *&lt;span&gt;wait);&lt;br/&gt;&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å°†waité¡¹ä»ç­‰å¾…é˜Ÿåˆ—ä¸­åˆ é™¤ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰&lt;/span&gt;
&lt;span&gt;#define&lt;/span&gt; wait_current_del(queue, wait)                                       \
    &lt;span&gt;do&lt;/span&gt;&lt;span&gt; {                                                                    \
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; (wait_in_queue(wait)) {                                          \
            wait_queue_del(queue, wait);                                    \
        }                                                                   \
    } &lt;/span&gt;&lt;span&gt;while&lt;/span&gt; (&lt;span&gt;0&lt;/span&gt;&lt;span&gt;)

&lt;/span&gt;&lt;span&gt;#endif&lt;/span&gt; /* !__KERN_SYNC_WAIT_H__ */
&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37.5&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_8ee5c62f-ab3f-4d9a-a4aa-7c1481cdaf59&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_8ee5c62f-ab3f-4d9a-a4aa-7c1481cdaf59&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_8ee5c62f-ab3f-4d9a-a4aa-7c1481cdaf59&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;70&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * åˆå§‹åŒ–wait_tç­‰å¾…é˜Ÿåˆ—é¡¹
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt;&lt;span&gt;
wait_init(wait_t &lt;/span&gt;*wait, &lt;span&gt;struct&lt;/span&gt; proc_struct *&lt;span&gt;proc) {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; waité¡¹ä¸procå»ºç«‹å…³è”&lt;/span&gt;
    wait-&amp;gt;proc =&lt;span&gt; proc;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç­‰å¾…çš„çŠ¶æ€&lt;/span&gt;
    wait-&amp;gt;wakeup_flags =&lt;span&gt; WT_INTERRUPTED;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; åŠ å…¥ç­‰å¾…é˜Ÿåˆ—&lt;/span&gt;
    list_init(&amp;amp;(wait-&amp;gt;&lt;span&gt;wait_link));
}

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * åˆå§‹åŒ–ç­‰å¾…é˜Ÿåˆ—
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt;&lt;span&gt;
wait_queue_init(wait_queue_t &lt;/span&gt;*&lt;span&gt;queue) {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç­‰å¾…é˜Ÿåˆ—å¤´ç»“ç‚¹åˆå§‹åŒ–&lt;/span&gt;
    list_init(&amp;amp;(queue-&amp;gt;&lt;span&gt;wait_head));
}

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * å°†waitèŠ‚ç‚¹é¡¹æ’å…¥ç­‰å¾…é˜Ÿåˆ—
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt;&lt;span&gt;
wait_queue_add(wait_queue_t &lt;/span&gt;*queue, wait_t *&lt;span&gt;wait) {
    assert(list_empty(&lt;/span&gt;&amp;amp;(wait-&amp;gt;wait_link)) &amp;amp;&amp;amp; wait-&amp;gt;proc !=&lt;span&gt; NULL);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; waité¡¹ä¸ç­‰å¾…é˜Ÿåˆ—å»ºç«‹å…³è”&lt;/span&gt;
    wait-&amp;gt;wait_queue =&lt;span&gt; queue;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å°†waité¡¹æ’å…¥å¤´ç»“ç‚¹å‰&lt;/span&gt;
    list_add_before(&amp;amp;(queue-&amp;gt;wait_head), &amp;amp;(wait-&amp;gt;&lt;span&gt;wait_link));
}

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * å°†waité¡¹ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt;&lt;span&gt;
wait_queue_del(wait_queue_t &lt;/span&gt;*queue, wait_t *&lt;span&gt;wait) {
    assert(&lt;/span&gt;!list_empty(&amp;amp;(wait-&amp;gt;wait_link)) &amp;amp;&amp;amp; wait-&amp;gt;wait_queue ==&lt;span&gt; queue);
    list_del_init(&lt;/span&gt;&amp;amp;(wait-&amp;gt;&lt;span&gt;wait_link));
}

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * è·å–ç­‰å¾…é˜Ÿåˆ—ä¸­waitèŠ‚ç‚¹çš„ä¸‹ä¸€é¡¹
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
wait_t &lt;/span&gt;*&lt;span&gt;
wait_queue_next(wait_queue_t &lt;/span&gt;*queue, wait_t *&lt;span&gt;wait) {
    assert(&lt;/span&gt;!list_empty(&amp;amp;(wait-&amp;gt;wait_link)) &amp;amp;&amp;amp; wait-&amp;gt;wait_queue ==&lt;span&gt; queue);
    list_entry_t &lt;/span&gt;*le = list_next(&amp;amp;(wait-&amp;gt;&lt;span&gt;wait_link));
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (le != &amp;amp;(queue-&amp;gt;&lt;span&gt;wait_head)) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; *waitçš„ä¸‹ä¸€é¡¹ä¸æ˜¯å¤´ç»“ç‚¹ï¼Œå°†å…¶è¿”å›&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt;&lt;span&gt; le2wait(le, wait_link);
    }
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; NULL;
}

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * è·å–ç­‰å¾…é˜Ÿåˆ—ä¸­waitèŠ‚ç‚¹çš„å‰ä¸€é¡¹
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
wait_t &lt;/span&gt;*&lt;span&gt;
wait_queue_prev(wait_queue_t &lt;/span&gt;*queue, wait_t *&lt;span&gt;wait) {
    assert(&lt;/span&gt;!list_empty(&amp;amp;(wait-&amp;gt;wait_link)) &amp;amp;&amp;amp; wait-&amp;gt;wait_queue ==&lt;span&gt; queue);
    list_entry_t &lt;/span&gt;*le = list_prev(&amp;amp;(wait-&amp;gt;&lt;span&gt;wait_link));
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (le != &amp;amp;(queue-&amp;gt;&lt;span&gt;wait_head)) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; *waitçš„å‰ä¸€é¡¹ä¸æ˜¯å¤´ç»“ç‚¹ï¼Œå°†å…¶è¿”å›&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt;&lt;span&gt; le2wait(le, wait_link);
    }
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; NULL;
}

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * è·å–ç­‰å¾…é˜Ÿåˆ—çš„ç¬¬ä¸€é¡¹
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
wait_t &lt;/span&gt;*&lt;span&gt;
wait_queue_first(wait_queue_t &lt;/span&gt;*&lt;span&gt;queue) {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å–å¤´ç»“ç‚¹çš„ä¸‹ä¸€é¡¹&lt;/span&gt;
    list_entry_t *le = list_next(&amp;amp;(queue-&amp;gt;&lt;span&gt;wait_head));
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (le != &amp;amp;(queue-&amp;gt;&lt;span&gt;wait_head)) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¤´ç»“ç‚¹çš„ä¸‹ä¸€é¡¹ä¸æ˜¯å¤´ç»“ç‚¹ï¼Œå°†å…¶è¿”å›&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt;&lt;span&gt; le2wait(le, wait_link);
    }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¤´ç»“ç‚¹çš„ä¸‹ä¸€é¡¹è¿˜æ˜¯å¤´ç»“ç‚¹ï¼Œè¯´æ˜ç­‰å¾…é˜Ÿåˆ—ä¸ºç©º(åªæœ‰ä¸€ä¸ªwait_headå“¨å…µèŠ‚ç‚¹)&lt;/span&gt;
    &lt;span&gt;return&lt;/span&gt;&lt;span&gt; NULL;
}

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * è·å–ç­‰å¾…é˜Ÿåˆ—çš„æœ€åä¸€é¡¹
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
wait_t &lt;/span&gt;*&lt;span&gt;
wait_queue_last(wait_queue_t &lt;/span&gt;*&lt;span&gt;queue) {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è·å–å¤´ç»“ç‚¹çš„å‰ä¸€é¡¹&lt;/span&gt;
    list_entry_t *le = list_prev(&amp;amp;(queue-&amp;gt;&lt;span&gt;wait_head));
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (le != &amp;amp;(queue-&amp;gt;&lt;span&gt;wait_head)) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¤´ç»“ç‚¹çš„å‰ä¸€é¡¹ä¸æ˜¯å¤´ç»“ç‚¹ï¼Œå°†å…¶è¿”å›&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt;&lt;span&gt; le2wait(le, wait_link);
    }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¤´ç»“ç‚¹çš„å‰ä¸€é¡¹è¿˜æ˜¯å¤´ç»“ç‚¹ï¼Œè¯´æ˜ç­‰å¾…é˜Ÿåˆ—ä¸ºç©º(åªæœ‰ä¸€ä¸ªwait_headå“¨å…µèŠ‚ç‚¹)&lt;/span&gt;
    &lt;span&gt;return&lt;/span&gt;&lt;span&gt; NULL;
}

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * ç­‰å¾…é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;bool&lt;/span&gt;&lt;span&gt;
wait_queue_empty(wait_queue_t &lt;/span&gt;*&lt;span&gt;queue) {
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; list_empty(&amp;amp;(queue-&amp;gt;&lt;span&gt;wait_head));
}

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * waité¡¹æ˜¯å¦åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;bool&lt;/span&gt;&lt;span&gt;
wait_in_queue(wait_t &lt;/span&gt;*&lt;span&gt;wait) {
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; !list_empty(&amp;amp;(wait-&amp;gt;&lt;span&gt;wait_link));
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;ç­‰å¾…é˜Ÿåˆ—ä¼‘çœ /å”¤é†’ç­‰é«˜å±‚æ“ä½œï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€ç­‰å¾…é˜Ÿåˆ—å¯¹äºçº¿ç¨‹çš„ä¼‘çœ ã€å”¤é†’å¯¹åº”çš„é«˜çº§æ“ä½œä¾èµ–äºä¸Šé¢ä»‹ç»çš„ã€åº•å±‚çš„ç­‰å¾…é˜Ÿåˆ—å¢åˆ æ”¹æŸ¥æ“ä½œã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;44&quot;&gt;
&lt;pre&gt;
&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„waité¡¹å¯¹åº”çš„çº¿ç¨‹å”¤é†’&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt; wakeup_wait(wait_queue_t *queue, wait_t *wait, uint32_t wakeup_flags, &lt;span&gt;bool&lt;/span&gt;&lt;span&gt; del);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€é¡¹å¯¹åº”çš„çº¿ç¨‹å”¤é†’&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt; wakeup_first(wait_queue_t *queue, uint32_t wakeup_flags, &lt;span&gt;bool&lt;/span&gt;&lt;span&gt; del);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰é¡¹å¯¹åº”çš„çº¿ç¨‹å…¨éƒ¨å”¤é†’&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt; wakeup_queue(wait_queue_t *queue, uint32_t wakeup_flags, &lt;span&gt;bool&lt;/span&gt;&lt;span&gt; del);
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä»¤å¯¹åº”waité¡¹åŠ å…¥å½“å‰ç­‰å¾…é˜Ÿåˆ—;ä»¤å½“å‰çº¿ç¨‹é˜»å¡ä¼‘çœ ï¼ŒæŒ‚è½½åœ¨è¯¥ç­‰å¾…é˜Ÿåˆ—ä¸­&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt; wait_current_set(wait_queue_t *queue, wait_t *&lt;span&gt;wait, uint32_t wait_state);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;43.5&quot;&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif&quot; id=&quot;code_img_closed_78d5cedd-9167-40ec-b4cf-b69861be48f3&quot; class=&quot;code_img_closed&quot;/&gt;&lt;img src=&quot;https://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif&quot; id=&quot;code_img_opened_78d5cedd-9167-40ec-b4cf-b69861be48f3&quot; class=&quot;code_img_opened&quot;/&gt;&lt;div id=&quot;cnblogs_code_open_78d5cedd-9167-40ec-b4cf-b69861be48f3&quot; class=&quot;cnblogs_code_hide&quot; readability=&quot;82&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„waité¡¹å¯¹åº”çš„çº¿ç¨‹å”¤é†’
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt;&lt;span&gt;
wakeup_wait(wait_queue_t &lt;/span&gt;*queue, wait_t *wait, uint32_t wakeup_flags, &lt;span&gt;bool&lt;/span&gt;&lt;span&gt; del) {
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; (del) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å°†waité¡¹ä»ç­‰å¾…é˜Ÿåˆ—ä¸­åˆ é™¤&lt;/span&gt;
&lt;span&gt;        wait_queue_del(queue, wait);
    }
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è®¾ç½®å”¤é†’çš„åŸå› æ ‡è¯†&lt;/span&gt;
    wait-&amp;gt;wakeup_flags =&lt;span&gt; wakeup_flags;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å”¤é†’å¯¹åº”çº¿ç¨‹&lt;/span&gt;
    wakeup_proc(wait-&amp;gt;&lt;span&gt;proc);
}

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€é¡¹å¯¹åº”çš„çº¿ç¨‹å”¤é†’
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt;&lt;span&gt;
wakeup_first(wait_queue_t &lt;/span&gt;*queue, uint32_t wakeup_flags, &lt;span&gt;bool&lt;/span&gt;&lt;span&gt; del) {
    wait_t &lt;/span&gt;*&lt;span&gt;wait;
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; ((wait = wait_queue_first(queue)) !=&lt;span&gt; NULL) {
        wakeup_wait(queue, wait, wakeup_flags, del);
    }
}

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰é¡¹å¯¹åº”çš„çº¿ç¨‹å…¨éƒ¨å”¤é†’
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt;&lt;span&gt;
wakeup_queue(wait_queue_t &lt;/span&gt;*queue, uint32_t wakeup_flags, &lt;span&gt;bool&lt;/span&gt;&lt;span&gt; del) {
    wait_t &lt;/span&gt;*&lt;span&gt;wait;
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; ((wait = wait_queue_first(queue)) !=&lt;span&gt; NULL) {
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;&lt;span&gt; (del) {
            &lt;/span&gt;&lt;span&gt;do&lt;/span&gt;&lt;span&gt; {
                wakeup_wait(queue, wait, wakeup_flags, &lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
            } &lt;/span&gt;&lt;span&gt;while&lt;/span&gt; ((wait = wait_queue_first(queue)) !=&lt;span&gt; NULL);
        }
        &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
            &lt;/span&gt;&lt;span&gt;do&lt;/span&gt;&lt;span&gt; {
                wakeup_wait(queue, wait, wakeup_flags, &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
            } &lt;/span&gt;&lt;span&gt;while&lt;/span&gt; ((wait = wait_queue_next(queue, wait)) !=&lt;span&gt; NULL);
        }
    }
}

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * ä»¤å¯¹åº”waité¡¹åŠ å…¥å½“å‰ç­‰å¾…é˜Ÿåˆ—;ä»¤å½“å‰çº¿ç¨‹é˜»å¡ä¼‘çœ ï¼ŒæŒ‚è½½åœ¨è¯¥ç­‰å¾…é˜Ÿåˆ—ä¸­
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt;&lt;span&gt;
wait_current_set(wait_queue_t &lt;/span&gt;*queue, wait_t *&lt;span&gt;wait, uint32_t wait_state) {
    assert(current &lt;/span&gt;!=&lt;span&gt; NULL);
    wait_init(wait, current);
    current&lt;/span&gt;-&amp;gt;state =&lt;span&gt; PROC_SLEEPING;
    current&lt;/span&gt;-&amp;gt;wait_state =&lt;span&gt; wait_state;
    wait_queue_add(queue, wait);
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;span class=&quot;cnblogs_code_collapse&quot;&gt;View Code&lt;/span&gt;&lt;/div&gt;
&lt;h2&gt;2.2 å®ç°ä¿¡å·é‡&lt;/h2&gt;
&lt;p&gt;ã€€ã€€ä¿¡å·é‡æ˜¯ä¸€ç§åŒæ­¥äº’æ–¥æœºåˆ¶çš„å®ç°ï¼Œæ™®éå­˜åœ¨äºç°åœ¨çš„å„ç§æ“ä½œç³»ç»Ÿå†…æ ¸é‡Œï¼Œæœ€æ—©æ˜¯ç”±è‘—åè®¡ç®—æœºç§‘å­¦å®¶Dijkstraæå‡ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ucoreä¿¡å·é‡å®šä¹‰ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€ä¿¡å·é‡çš„å®šä¹‰å’Œä½¿ç”¨éå¸¸ç®€å•å’ŒåŸºç¡€ï¼ŒåŒ…å«äº†ä¸€ä¸ªä¿¡å·é‡çš„å€¼valueä»¥åŠç”¨äºçº¿ç¨‹åŒæ­¥çš„ç­‰å¾…é˜Ÿåˆ—ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * ä¿¡å·é‡
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
typedef &lt;/span&gt;&lt;span&gt;struct&lt;/span&gt;&lt;span&gt; {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¿¡å·é‡å€¼&lt;/span&gt;
    &lt;span&gt;int&lt;/span&gt;&lt;span&gt; value;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¿¡å·é‡å¯¹åº”çš„ç­‰å¾…é˜Ÿåˆ—&lt;/span&gt;
&lt;span&gt;    wait_queue_t wait_queue;
} semaphore_t;

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * åˆå§‹åŒ–ä¿¡å·é‡
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt;&lt;span&gt;
sem_init(semaphore_t &lt;/span&gt;*sem, &lt;span&gt;int&lt;/span&gt;&lt;span&gt; value) {
    sem&lt;/span&gt;-&amp;gt;value =&lt;span&gt; value;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; åˆå§‹åŒ–ç­‰å¾…é˜Ÿåˆ—&lt;/span&gt;
    wait_queue_init(&amp;amp;(sem-&amp;gt;&lt;span&gt;wait_queue));
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€ä¿¡å·é‡çš„ä¸»è¦æ“ä½œåˆ†åˆ«æ˜¯downå’Œupï¼Œå¯¹åº”äºDijkstraæå‡ºä¿¡å·é‡æ—¶æå‡ºçš„P/Væ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€&lt;strong&gt;ä¿¡å·é‡ä½œä¸ºåŒæ­¥äº’æ–¥çš„åŸºæœ¬ç»“æ„ï¼Œå…¶down/upæ“ä½œå¿…é¡»æ˜¯åŸå­æ€§çš„ï¼Œæ— æ³•è¢«æ‰“æ–­å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ä»¤è½¯ä»¶ç¨‹åºè¡¨ç°å‡ºåŸå­æ€§çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œç”±äºucoreæ˜¯è¿è¡Œåœ¨å•æ ¸çš„80386cpuä¸Šçš„ï¼Œç®€å•èµ·è§ä¾¿ç›´æ¥ä½¿ç”¨å…³é—­ä¸­æ–­çš„æ–¹å¼æ¥å®ç°ä¿¡å·é‡æ“ä½œçš„åŸå­æ€§(å¤šæ ¸cpuçš„æƒ…å†µä¸‹ï¼Œå…³é—­å•æ ¸çš„ä¸­æ–­æ˜¯ä¸å¤Ÿçš„ï¼Œè€Œå…³é—­æ‰€æœ‰æ ¸å¿ƒçš„ä¸­æ–­åˆ™æ€§èƒ½æŸå¤±å¤ªå¤§ï¼Œéœ€è¦é‡‡å–é”æ€»çº¿ç­‰å…¶å®ƒæ‰‹æ®µæ¥å®ç°è½¯ä»¶åŸå­æ€§)ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¿¡å·é‡çš„downæ“ä½œï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€&lt;/strong&gt;ä¿¡å·é‡çš„&lt;strong&gt;down&lt;/strong&gt;æ“ä½œï¼Œæ˜¯è¯·æ±‚è·å–ä¸€ä¸ªä¿¡å·é‡ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€å½“ä¿¡å·é‡çš„valueå€¼å¤§äº0æ—¶ï¼Œè¯´æ˜è¿˜èƒ½å®¹çº³å½“å‰çº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒºã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€å½“ä¿¡å·é‡çš„valueå€¼ç­‰äº0æ—¶ï¼Œè¯´æ˜å·²ç»æ— æ³•å®¹çº³æ›´å¤šçš„çº¿ç¨‹äº†ï¼Œæ­¤æ—¶éœ€è¦å°†å½“å‰çº¿ç¨‹é˜»å¡åœ¨ä¿¡å·é‡çš„ç­‰å¾…é˜Ÿåˆ—ä¸Šï¼Œç­‰å¾…ä¿¡å·é‡çš„upæ“ä½œå°†å…¶å”¤é†’ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * ä¿¡å·é‡downæ“ä½œ æ‰£å‡ä¿¡å·é‡
 * å½“ä¿¡å·é‡valueä¸è¶³æ—¶å°†å½“å‰çº¿ç¨‹é˜»å¡åœ¨ä¿¡å·é‡ä¸Šï¼Œç­‰å¾…å…¶å®ƒçº¿ç¨‹upæ“ä½œæ—¶å°†å…¶å”¤é†’
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;static&lt;/span&gt; __noinline uint32_t __down(semaphore_t *&lt;span&gt;sem, uint32_t wait_state) {
    &lt;/span&gt;&lt;span&gt;bool&lt;/span&gt;&lt;span&gt; intr_flag;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; æš‚æ—¶å…³é—­ä¸­æ–­ï¼Œä¿è¯ä¿¡å·é‡çš„downæ“ä½œæ˜¯åŸå­æ“ä½œ&lt;/span&gt;
&lt;span&gt;    local_intr_save(intr_flag);
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (sem-&amp;gt;value &amp;gt; &lt;span&gt;0&lt;/span&gt;&lt;span&gt;) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¿¡å·é‡å¯¹åº”çš„valueå¤§äº0ï¼Œè¿˜æœ‰æƒä½¿ç”¨&lt;/span&gt;
        sem-&amp;gt;value --&lt;span&gt;;
        local_intr_restore(intr_flag);
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
    }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¿¡å·é‡å¯¹åº”çš„valueå°äºç­‰äº0ï¼Œéœ€è¦é˜»å¡å½“å‰çº¿ç¨‹&lt;/span&gt;
    wait_t __wait, *wait = &amp;amp;&lt;span&gt;__wait;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä»¤å½“å‰çº¿ç¨‹æŒ‚åœ¨ä¿¡å·é‡çš„é˜»å¡é˜Ÿåˆ—ä¸­&lt;/span&gt;
    wait_current_set(&amp;amp;(sem-&amp;gt;&lt;span&gt;wait_queue), wait, wait_state);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ¢å¤ä¸­æ–­ï¼ŒåŸå­æ“ä½œç»“æŸ&lt;/span&gt;
&lt;span&gt;    local_intr_restore(intr_flag);

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å½“å‰çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€äº†ï¼Œè¿›è¡Œä¸€æ¬¡è°ƒåº¦&lt;/span&gt;
&lt;span&gt;    schedule();

    local_intr_save(intr_flag);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å”¤é†’åï¼ŒåŸå­æ“ä½œå°†å½“å‰é¡¹ä»ä¿¡å·é‡çš„ç­‰å¾…é˜Ÿåˆ—ä¸­åˆ é™¤&lt;/span&gt;
    wait_current_del(&amp;amp;(sem-&amp;gt;&lt;span&gt;wait_queue), wait);
    local_intr_restore(intr_flag);

    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (wait-&amp;gt;wakeup_flags !=&lt;span&gt; wait_state) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¦‚æœç­‰å¾…çº¿ç¨‹å”¤é†’çš„æ ‡è¯†ä¸ä¹‹å‰è®¾ç½®çš„å‚æ•°wait_stateä¸ä¸€è‡´ï¼Œå°†å…¶çŠ¶æ€è¿”å›ç»™è°ƒç”¨æ–¹åšè¿›ä¸€æ­¥åˆ¤æ–­&lt;/span&gt;
        &lt;span&gt;return&lt;/span&gt; wait-&amp;gt;&lt;span&gt;wakeup_flags;
    }
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
}
&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;ä¿¡å·é‡çš„upæ“ä½œï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä¿¡å·é‡çš„upæ“ä½œï¼Œæ˜¯å¢åŠ ä¸€ä¸ªä¿¡å·é‡ä¸­çš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€å½“å¢åŠ ä¿¡å·é‡å€¼æ—¶å‘ç°å½“å‰ä¿¡å·é‡çš„ç­‰å¾…é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œåˆ™è¯´æ˜å½“å‰æ²¡æœ‰çº¿ç¨‹è¢«é˜»å¡ã€éœ€è¦è¿›å…¥ä¿¡å·é‡ç®¡åˆ¶çš„ä¸´ç•ŒåŒºä¸­ï¼Œç®€å•çš„å°†ä¿¡å·é‡å€¼åŠ 1ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€å½“å¢åŠ ä¿¡å·é‡æ—¶å‘ç°ç­‰å¾…é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œåˆ™è¯´æ˜å­˜åœ¨çº¿ç¨‹æƒ³è¦è¿›å…¥ä¸´ç•ŒåŒºä¸­ï¼Œå´ç”±äºæ²¡æœ‰æ»¡è¶³ä¿¡å·é‡çš„æ¡ä»¶ï¼Œè¢«é˜»å¡åœ¨äº†ä¸´ç•ŒåŒºå¤–ã€‚æ­¤æ—¶ä¾¿ä»ä¿¡å·é‡çš„ç­‰å¾…é˜Ÿåˆ—ä¸­æŒ‘é€‰å‡ºæœ€æ—©è¢«é˜»å¡çš„çº¿ç¨‹ï¼Œå°†å…¶å”¤é†’ï¼Œä½¿å¾—å…¶å¾—ä»¥è¿›å…¥ä¸´ç•ŒåŒºã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * ä¿¡å·é‡upæ“ä½œ å¢åŠ ä¿¡å·é‡æˆ–å”¤é†’è¢«é˜»å¡åœ¨ä¿¡å·é‡ä¸Šçš„ä¸€ä¸ªçº¿ç¨‹ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;static&lt;/span&gt; __noinline &lt;span&gt;void&lt;/span&gt; __up(semaphore_t *&lt;span&gt;sem, uint32_t wait_state) {
    &lt;/span&gt;&lt;span&gt;bool&lt;/span&gt;&lt;span&gt; intr_flag;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; æš‚æ—¶å…³é—­ä¸­æ–­ï¼Œä¿è¯ä¿¡å·é‡çš„upæ“ä½œæ˜¯åŸå­æ“ä½œ&lt;/span&gt;
&lt;span&gt;    local_intr_save(intr_flag);
    {
        wait_t &lt;/span&gt;*&lt;span&gt;wait;
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; ((wait = wait_queue_first(&amp;amp;(sem-&amp;gt;wait_queue))) ==&lt;span&gt; NULL) {
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¿¡å·é‡çš„ç­‰å¾…é˜Ÿåˆ—ä¸ºç©ºï¼Œè¯´æ˜æ²¡æœ‰çº¿ç¨‹ç­‰å¾…åœ¨è¯¥ä¿¡å·é‡ä¸Š
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¿¡å·é‡valueåŠ 1&lt;/span&gt;
            sem-&amp;gt;value ++&lt;span&gt;;
        }
        &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt; {
&lt;/span&gt;            assert(wait-&amp;gt;proc-&amp;gt;wait_state ==&lt;span&gt; wait_state);
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„å¯¹åº”ç­‰å¾…çº¿ç¨‹å”¤é†’&lt;/span&gt;
            wakeup_wait(&amp;amp;(sem-&amp;gt;wait_queue), wait, wait_state, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
        }
    }
    local_intr_restore(intr_flag);
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ã€€ã€€ä¿¡å·é‡çš„downä¸upæ“ä½œå…³ç³»ååˆ†ç´§å¯†ï¼Œäº’ç›¸å¯¹ç…§ç€çœ‹å¯ä»¥æ›´å¥½çš„ç†è§£å…¶å·¥ä½œåŸç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;äº’æ–¥ä¿¡å·é‡ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€valueå€¼è¢«åˆå§‹åŒ–ä¸º1çš„ä¿¡å·é‡æ¯”è¾ƒç‰¹æ®Šï¼Œç§°ä¸ºäºŒå…ƒä¿¡å·é‡ï¼Œä¹Ÿè¢«å«åšäº’æ–¥ä¿¡å·é‡ã€‚äº’æ–¥ä¿¡å·é‡èƒ½å¤Ÿä½œä¸ºmutexäº’æ–¥é”ï¼Œç”¨äºä¿è¯ä¸´ç•ŒåŒºä¸­æ•°æ®ä¸ä¼šè¢«çº¿ç¨‹å¹¶å‘çš„è®¿é—®ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;&lt;strong&gt;2.3Â ä½¿ç”¨ä¿¡å·é‡è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜&lt;/strong&gt;&lt;/h2&gt;
&lt;h3&gt;&lt;strong&gt;å“²å­¦å®¶å°±é¤é—®é¢˜ä»‹ç»&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;ã€€ã€€å“²å­¦å®¶å°±é¤é—®é¢˜æ˜¯Dijkstraæå‡ºçš„ä¸€ä¸ªç»å…¸çš„å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚&lt;strong&gt;å¤§æ¦‚åœºæ™¯æ˜¯åœ¨ä¸€ä¸ªç¯å½¢çš„åœ†æ¡Œä¸Šï¼Œåç€äº”ä¸ªå“²å­¦å®¶ï¼Œè€Œæ¡Œä¸Šæœ‰äº”æŠŠå‰å­å’Œäº”ä¸ªç¢—ã€‚ä¸€ä¸ªå“²å­¦å®¶å¹³æ—¶è¿›è¡Œæ€è€ƒï¼Œé¥¥é¥¿æ—¶ä¾¿è¯•å›¾å–ç”¨å…¶å·¦å³æœ€é è¿‘ä»–çš„å‰å­ï¼Œåªæœ‰åœ¨ä»–æ‹¿åˆ°ä¸¤åªå‰å­æ—¶æ‰èƒ½è¿›é¤ã€‚è¿›é¤å®Œæ¯•ï¼Œæ”¾ä¸‹å‰å­ç»§ç»­æ€è€ƒã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜çš„åŸºæœ¬æ€è·¯æ˜¯ä½¿ç”¨çº¿ç¨‹æ¨¡æ‹Ÿå“²å­¦å®¶ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªæ´»åŠ¨ç€çš„å“²å­¦å®¶ã€‚ä½†æ˜¯ç”±äº5ä¸ªå¹¶å‘æ´»åŠ¨çš„å“²å­¦å®¶çº¿ç¨‹äº‰æŠ¢ä»…æœ‰çš„5æŠŠå‰å­ï¼Œä¸”å“²å­¦å®¶åªæœ‰åœ¨åŒæ—¶æ‹¿åˆ°ä¸¤æ ¹å‰å­æ—¶æ‰èƒ½è¿›é¤ï¼Œå¦‚æœæ²¡æœ‰è‰¯å¥½çš„åŒæ­¥æœºåˆ¶å¯¹è¿™5ä¸ªå“²å­¦å®¶çº¿ç¨‹è¿›è¡Œåè°ƒï¼Œé‚£ä¹ˆå“²å­¦å®¶çº¿ç¨‹äº’ç›¸ä¹‹é—´å®¹æ˜“å‘ç”Ÿæ­»é”(ä¾‹å¦‚ï¼Œäº”ä¸ªå“²å­¦å®¶çº¿ç¨‹åŒæ—¶æ‹¿èµ·äº†è‡ªå·±å·¦æ‰‹è¾¹çš„å‰å­ï¼Œéƒ½æ— æ³•æ‹¿èµ·è‡ªå·±å³è¾¹çš„å‰å­ï¼Œäº’ç›¸ç­‰å¾…ç€ã€‚å“²å­¦å®¶ä¹‹é—´å°†æ°¸è¿œæ— æ³•è¿›é¤ï¼Œçº·çº·é¥¿æ­»)ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä½¿ç”¨Dijkstraæå‡ºçš„ä¿¡å·é‡æœºåˆ¶å¯ä»¥å¾ˆå¥½çš„è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜ï¼Œä¸‹é¢çœ‹çœ‹ucoreä¸­æ˜¯å¦‚ä½•ä½¿ç”¨ä¿¡å·é‡è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å“²å­¦å®¶çº¿ç¨‹ä¸»ä½“æ‰§è¡Œé€»è¾‘ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€ucoreçš„lab7ä¸­çš„check_syncå‡½æ•°æ˜¯æ•´ä¸ªlab7å®éªŒçš„æ€»æ§å‡½æ•°ã€‚åœ¨check_syncçš„å‰åŠéƒ¨åˆ†ä½¿ç”¨kern_threadå‡½æ•°åˆ›å»ºäº†N(N=5)ä¸ªå“²å­¦å®¶å†…æ ¸çº¿ç¨‹ï¼Œç”¨äºæ‰§è¡Œphilosopher_using_semaphoreï¼Œæ¨¡æ‹Ÿå“²å­¦å®¶å°±é¤é—®é¢˜ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€&lt;/strong&gt;philosopher_using_semaphoreä¸­å“²å­¦å®¶å¾ªç¯å¾€å¤çš„è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;strong&gt;ã€€ã€€1. å“²å­¦å®¶è¿›è¡Œæ€è€ƒ(é€šè¿‡do_sleepç³»ç»Ÿè°ƒç”¨è¿›è¡Œä¼‘çœ é˜»å¡ï¼Œæ¨¡æ‹Ÿå“²å­¦å®¶æ€è€ƒ)&lt;/strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;strong&gt;ã€€ã€€2. é€šè¿‡phi_take_forks_semaå‡½æ•°å°è¯•ç€åŒæ—¶æ‹¿èµ·å·¦å³ä¸¤ä¸ªå‰å­ï¼ˆå¦‚æœæ— æ³•æ‹¿åˆ°å·¦å³å‰å­ï¼Œåˆ™ä¼šé™·å…¥é˜»å¡çŠ¶æ€ï¼‰&lt;/strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;strong&gt;ã€€ã€€3. å“²å­¦å®¶è¿›è¡Œå°±é¤(&lt;/strong&gt;&lt;strong&gt;é€šè¿‡do_sleepç³»ç»Ÿè°ƒç”¨è¿›è¡Œä¼‘çœ é˜»å¡ï¼Œæ¨¡æ‹Ÿå“²å­¦å®¶å°±é¤&lt;/strong&gt;&lt;/strong&gt;)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;strong&gt;ã€€ã€€4. é€šè¿‡phi_put_forks_semaå‡½æ•°åŒæ—¶æ”¾ä¸‹å·¦å³ä¸¤ä¸ªå‰å­&lt;/strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;strong&gt;ã€€ã€€æ‹¿èµ·å‰å­çš„&lt;/strong&gt;&lt;strong&gt;phi_take_forks_semaå‡½æ•°å’Œæ”¾ä¸‹å‰å­&lt;/strong&gt;&lt;strong&gt;phi_put_forks_semaçš„å‡½æ•°å†…éƒ¨éƒ½æ˜¯é€šè¿‡ä¿¡å·é‡è¿›è¡ŒåŒæ­¥çš„ï¼Œåœ¨ä¸‹é¢è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„åˆ†æã€‚&lt;/strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;49&quot;&gt;
&lt;pre&gt;
&lt;span&gt;#define&lt;/span&gt; N 5 /* å“²å­¦å®¶æ•°ç›® */
&lt;span&gt;#define&lt;/span&gt; LEFT (i-1+N)%N /* içš„å·¦é‚»å·ç  */
&lt;span&gt;#define&lt;/span&gt; RIGHT (i+1)%N /* içš„å³é‚»å·ç  */
&lt;span&gt;#define&lt;/span&gt; THINKING 0 /* å“²å­¦å®¶æ­£åœ¨æ€è€ƒ */
&lt;span&gt;#define&lt;/span&gt; HUNGRY 1 /* å“²å­¦å®¶æƒ³å–å¾—å‰å­ */
&lt;span&gt;#define&lt;/span&gt; EATING 2 /* å“²å­¦å®¶æ­£åœ¨åƒé¢ */
&lt;span&gt;#define&lt;/span&gt; TIMES  4 /* åƒ4æ¬¡é¥­ */
&lt;span&gt;#define&lt;/span&gt; SLEEP_TIME 10

&lt;span&gt;void&lt;/span&gt; check_sync(&lt;span&gt;void&lt;/span&gt;&lt;span&gt;){
    &lt;/span&gt;&lt;span&gt;int&lt;/span&gt;&lt;span&gt; i;

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;check semaphore ä¿¡å·é‡è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜&lt;/span&gt;
    sem_init(&amp;amp;mutex, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;0&lt;/span&gt;;i&amp;lt;N;i++&lt;span&gt;){
        sem_init(&lt;/span&gt;&amp;amp;s[i], &lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; pid = kernel_thread(philosopher_using_semaphore, (&lt;span&gt;void&lt;/span&gt; *)i, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (pid &amp;lt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;) {
            panic(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;create No.%d philosopher_using_semaphore failed.\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        }
        philosopher_proc_sema[i] &lt;/span&gt;=&lt;span&gt; find_proc(pid);
        set_proc_name(philosopher_proc_sema[i], &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;philosopher_sema_proc&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
    }

    ã€‚ã€‚ã€‚ æ¡ä»¶å˜é‡(ç®¡ç¨‹)è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜(æš‚æ—¶å¿½ç•¥)
}


&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;---------- philosophers problem using semaphore ----------------------&lt;/span&gt;
&lt;span&gt;int&lt;/span&gt; state_sema[N]; &lt;span&gt;/*&lt;/span&gt;&lt;span&gt; è®°å½•æ¯ä¸ªäººçŠ¶æ€çš„æ•°ç»„ &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;/*&lt;/span&gt;&lt;span&gt; ä¿¡å·é‡æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ•´å‹å˜é‡ &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
semaphore_t mutex; &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt; ä¸´ç•ŒåŒºäº’æ–¥ &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
semaphore_t s[N]; &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt; æ¯ä¸ªå“²å­¦å®¶ä¸€ä¸ªä¿¡å·é‡ &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;

&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * å“²å­¦å®¶çº¿ç¨‹ä¸»ä½“æ‰§è¡Œé€»è¾‘
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;int&lt;/span&gt; philosopher_using_semaphore(&lt;span&gt;void&lt;/span&gt; * arg) &lt;span&gt;/*&lt;/span&gt;&lt;span&gt; iï¼šå“²å­¦å®¶å·ç ï¼Œä»0åˆ°N-1 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
{
    &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; i, iter=&lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
    i&lt;/span&gt;=(&lt;span&gt;int&lt;/span&gt;&lt;span&gt;)arg;
    cprintf(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;I am No.%d philosopher_sema\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,i);
    &lt;/span&gt;&lt;span&gt;while&lt;/span&gt;(iter++&amp;lt;&lt;span&gt;TIMES)
    { &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt; æ— é™å¾ªç¯ &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
        cprintf(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Iter %d, No.%d philosopher_sema is thinking\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,iter,i); &lt;span&gt;/*&lt;/span&gt;&lt;span&gt; å“²å­¦å®¶æ­£åœ¨æ€è€ƒ &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
        &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä½¿ç”¨ä¼‘çœ é˜»å¡æ¥æ¨¡æ‹Ÿæ€è€ƒ(å“²å­¦å®¶çº¿ç¨‹é˜»å¡Nç§’)&lt;/span&gt;
&lt;span&gt;        do_sleep(SLEEP_TIME);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å“²å­¦å®¶å°è¯•ç€å»æ‹¿å·¦å³ä¸¤è¾¹çš„å‰å­(å¦‚æœæ²¡æ‹¿åˆ°ä¼šé˜»å¡)&lt;/span&gt;
&lt;span&gt;        phi_take_forks_sema(i); 
        &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt; éœ€è¦ä¸¤åªå‰å­ï¼Œæˆ–è€…é˜»å¡ &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
        cprintf(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Iter %d, No.%d philosopher_sema is eating\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;,iter,i); &lt;span&gt;/*&lt;/span&gt;&lt;span&gt; è¿›é¤ &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
        &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä½¿ç”¨ä¼‘çœ é˜»å¡æ¥æ¨¡æ‹Ÿè¿›é¤(å“²å­¦å®¶çº¿ç¨‹é˜»å¡Nç§’)&lt;/span&gt;
&lt;span&gt;        do_sleep(SLEEP_TIME);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å“²å­¦å®¶å°±é¤ç»“æŸï¼Œå°†å‰å­æ”¾å›æ¡Œå­ã€‚
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å½“å‘ç°ä¹‹å‰æœ‰ä¸´è¿‘çš„å“²å­¦å®¶å°è¯•ç€æ‹¿å·¦å³å‰å­å°±é¤æ—¶å´æ²¡æœ‰æˆåŠŸæ‹¿åˆ°ï¼Œå°è¯•ç€å”¤é†’å¯¹åº”çš„å“²å­¦å®¶&lt;/span&gt;
&lt;span&gt;        phi_put_forks_sema(i); 
        &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt; æŠŠä¸¤æŠŠå‰å­åŒæ—¶æ”¾å›æ¡Œå­ &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    }
    cprintf(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;No.%d philosopher_sema quit\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,i);
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;    
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;&lt;strong&gt;æ‹¿èµ·å‰å­/æ”¾ä¸‹å‰å­å‡½æ•°åˆ†æï¼š&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;ã€€ã€€&lt;strong&gt;phi_take_forks_sema&lt;/strong&gt;å‡½æ•°è¡¨ç¤º&lt;strong&gt;å“²å­¦å®¶å°è¯•ç€æ‹¿èµ·å·¦å³å‰å­æƒ³è¦å°±é¤&lt;/strong&gt;ï¼›è€Œ&lt;strong&gt;phi_put_forks_sema&lt;/strong&gt;å‡½æ•°è¡¨ç¤º&lt;strong&gt;å“²å­¦å®¶è¿›é¤ç»“æŸåæ”¾ä¸‹å·¦å³å‰å­&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä¸¤è€…éƒ½æ˜¯é€šè¿‡å…¨å±€çš„äº’æ–¥ä¿¡å·é‡&lt;strong&gt;mutex&lt;/strong&gt;çš„&lt;strong&gt;down&lt;/strong&gt;æ“ä½œè¿›è¡Œå…¨å±€çš„äº’æ–¥ï¼Œä¿è¯åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå“²å­¦å®¶çº¿ç¨‹èƒ½å¤Ÿè¿›å…¥ä¸´ç•ŒåŒºï¼Œå¯¹ä¸´ç•ŒåŒºçš„èµ„æºå‰å­è¿›è¡Œæ‹¿èµ·/æ”¾ä¸‹æ“ä½œã€‚å¯¹ä¸åŒçš„å“²å­¦å®¶çº¿ç¨‹è¿›è¡Œäº’æ–¥ï¼Œä¿è¯æŸ¥çœ‹å·¦å³å‰å­çš„çŠ¶æ€æ—¶ä¸ä¼šå‡ºç°å¹¶å‘é—®é¢˜ã€‚åœ¨åé¢å¯¹&lt;strong&gt;mutex&lt;/strong&gt;çš„&lt;strong&gt;up&lt;/strong&gt;æ“ä½œç”¨äºé‡Šæ”¾&lt;strong&gt;mutex&lt;/strong&gt;äº’æ–¥ä¿¡å·é‡ï¼Œä»¥ç¦»å¼€ä¸´ç•ŒåŒºï¼Œå”¤é†’å¯èƒ½é˜»å¡åœ¨mutexä¿¡å·é‡ä¸­çš„å…¶å®ƒå“²å­¦å®¶çº¿ç¨‹ï¼Œè®©é˜»å¡åœ¨&lt;strong&gt;mutex&lt;/strong&gt;ä¿¡å·é‡ä¸­çš„å¦ä¸€ä¸ªçº¿ç¨‹å¾—ä»¥è¿›å…¥ä¸´ç•ŒåŒºã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;phi_take_forks_semaå‡½æ•°åˆ†æï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€åœ¨æ‰§è¡Œ&lt;strong&gt;phi_take_forks_sema&lt;/strong&gt;æ‹¿å‰å­æ—¶ï¼Œé€šè¿‡å…³é”®çš„&lt;strong&gt;phi_test_sema&lt;/strong&gt;å‡½æ•°è¿›è¡Œæ¡ä»¶çš„åˆ¤æ–­ï¼Œåˆ¤æ–­å½“å‰å“²å­¦å®¶çº¿ç¨‹içš„å·¦å³å“²å­¦å®¶çº¿ç¨‹æ˜¯å¦éƒ½æœªå°±é¤ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€å¦‚æœæ¡ä»¶æ»¡è¶³(åœ¨æ‹¿å‰å­æ—¶ï¼Œ&lt;strong&gt;phi_test_sema&lt;/strong&gt;å‰å“²å­¦å®¶iå·²ç»è¢«é¢„å…ˆè®¾ç½®ä¸º&lt;strong&gt;HUNGRY&lt;/strong&gt;é¥¥é¥¿çŠ¶æ€äº†)ï¼Œåˆ™ä»£è¡¨å½“å‰å“²å­¦å®¶iå¯ä»¥è¿›é¤(å…¶æ‹¿èµ·äº†å·¦å³å‰å­ï¼Œä¹Ÿä»£è¡¨ç€å…¶ç›¸é‚»çš„å·¦å³å“²å­¦å®¶æ— æ³•å°±é¤)ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€è€Œå¦‚æœæ¡ä»¶ä¸æ»¡è¶³åˆ™ä¼šåœ¨&lt;strong&gt;phi_take_forks_sema&lt;/strong&gt;çš„æœ€åï¼Œè¢«&lt;strong&gt;down(&amp;amp;s[i])&lt;/strong&gt;é˜»å¡åœ¨ä¿¡å·é‡&lt;strong&gt;s[i]&lt;/strong&gt;ä¸Šï¼Œç­‰å¾…å…¶è¢«å·¦å³ä¸¤æ—å°±é¤å®Œæ¯•çš„å“²å­¦å®¶å°†å…¶å”¤é†’ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;phi_put_forks_semaå‡½æ•°åˆ†æï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Â ã€€ã€€åœ¨æ‰§è¡Œ&lt;strong&gt;phi_put_forks_sema&lt;/strong&gt;æ”¾ä¸‹å‰å­æ—¶ï¼Œé¦–å…ˆé€šè¿‡è®¾ç½®&lt;strong&gt;state_sema[i]&lt;/strong&gt;çš„çŠ¶æ€ä¸º&lt;strong&gt;Thinking&lt;/strong&gt;ï¼Œä»£è¡¨å“²å­¦å®¶iå·²ç»å°±é¤å®Œæ¯•é‡æ–°è¿›å…¥æ€è€ƒçŠ¶æ€ã€‚åŒæ—¶å“²å­¦å®¶iåœ¨æ”¾ä¸‹å‰å­åï¼Œé€šè¿‡&lt;strong&gt;phi_test_sema(LEFT)&lt;/strong&gt;å’Œ&lt;strong&gt;phi_test_sema(RIGHT)&lt;/strong&gt;æ¥åˆ¤æ–­ç›¸é‚»çš„å“²å­¦å®¶åœ¨è‡ªå·±å°±é¤çš„è¿™æ®µæ—¶é—´æ˜¯å¦ä¹Ÿé™·å…¥äº†é¥¥é¥¿çŠ¶æ€ï¼Œå´ç”±äºæš‚æ—¶æ‹¿ä¸åˆ°å‰å­è€Œè¢«é˜»å¡äº†(LEFTå’ŒRIGHTå®åˆ©ç”¨å–æ¨¡ï¼Œè§£å†³ä¸‹æ ‡å›ç¯è®¡ç®—çš„é—®é¢˜)ã€‚å¦‚æœç¡®å®å­˜åœ¨è¿™ç§æƒ…å†µï¼Œé€šè¿‡&lt;strong&gt;phi_test_sema&lt;/strong&gt;å‡½æ•°&lt;strong&gt;å°è¯•&lt;/strong&gt;ç€ä»¤ç›¸é‚»çš„å“²å­¦å®¶è¿›è¡Œå°±é¤(ä¹Ÿè®¸è¢«é˜»å¡å“²å­¦å®¶çš„éš”å£å¦ä¸€è¾¹çš„å“²å­¦å®¶ä¾ç„¶åœ¨å°±é¤ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¾ç„¶æ— æ³•å°†å…¶å”¤é†’å°±é¤ï¼›è€Œéœ€è¦ç­‰åˆ°å¦ä¸€è¾¹çš„å“²å­¦å®¶å°±é¤å®Œæ¯•æ¥&lt;strong&gt;å°è¯•&lt;/strong&gt;å°†å…¶å”¤é†’)ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€é€šè¿‡äº’æ–¥ä¿¡å·é‡mutexå®ç°å“²å­¦å®¶çº¿ç¨‹å°±é¤å¯¹ä¸´ç•ŒåŒºèµ„æº-å‰å­è®¿é—®çš„äº’æ–¥æ€§ï¼Œé¿å…äº†å¹¶å‘æ—¶å¯¹å‰å­çŠ¶æ€åˆ¤æ–­ä¸å‡†ç¡®çš„æƒ…å†µäº§ç”Ÿï¼›åŒæ—¶åˆ©ç”¨ä¿¡å·é‡æ•°ç»„semaphore_t s[N]å¯¹å“²å­¦å®¶æ‹¿å–ã€æ”¾ä¸‹å‰å­çš„æ“ä½œè¿›è¡ŒåŒæ­¥ï¼Œä½¿å¾—å“²å­¦å®¶ä»¬åœ¨å‰å­èµ„æºæœ‰é™ã€å†²çªçš„æƒ…å†µä¸‹æœ‰åºçš„å°±é¤ï¼Œä¸ä¼šå‡ºæ­»é”ã€é¥¥é¥¿ç­‰ç°è±¡ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * å“²å­¦å®¶iæ‹¿èµ·å·¦å³å‰å­
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt; phi_take_forks_sema(&lt;span&gt;int&lt;/span&gt; i) &lt;span&gt;/*&lt;/span&gt;&lt;span&gt; iï¼šå“²å­¦å®¶å·ç ä»0åˆ°N-1 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
{ 
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ‹¿å‰å­æ—¶éœ€è¦é€šè¿‡mutexä¿¡å·é‡è¿›è¡Œäº’æ–¥ï¼Œé˜²æ­¢å¹¶å‘é—®é¢˜(è¿›å…¥ä¸´ç•ŒåŒº)&lt;/span&gt;
    down(&amp;amp;&lt;span&gt;mutex);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è®°å½•ä¸‹å“²å­¦å®¶ié¥¥é¥¿çš„äº‹å®(æ‰§è¡Œphi_take_forks_semaå°è¯•æ‹¿å‰å­ï¼Œè¯´æ˜å“²å­¦å®¶iè¿›å…¥äº†HUNGRYé¥¥é¥¿çŠ¶æ€)&lt;/span&gt;
    state_sema[i]=&lt;span&gt;HUNGRY;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è¯•å›¾åŒæ—¶å¾—åˆ°å·¦å³ä¸¤åªå‰å­&lt;/span&gt;
&lt;span&gt;    phi_test_sema(i);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç¦»å¼€ä¸´ç•ŒåŒº(å”¤é†’å¯èƒ½é˜»å¡åœ¨mutexä¸Šçš„å…¶å®ƒçº¿ç¨‹)&lt;/span&gt;
    up(&amp;amp;&lt;span&gt;mutex);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; phi_test_semaä¸­å¦‚æœæˆåŠŸæ‹¿åˆ°å‰å­è¿›å…¥äº†å°±é¤çŠ¶æ€ï¼Œä¼šå…ˆæ‰§è¡Œup(&amp;amp;s[i])ï¼Œå†æ‰§è¡Œdown(&amp;amp;s[i])æ—¶ä¾¿ä¸ä¼šé˜»å¡
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; åä¹‹ï¼Œå¦‚æœphi_test_semaä¸­æ²¡æœ‰æ‹¿åˆ°å‰å­ï¼Œåˆ™down(&amp;amp;s[i])å°†ä¼šä»¤å“²å­¦å®¶ié˜»å¡åœ¨ä¿¡å·é‡s[i]ä¸Š&lt;/span&gt;
    down(&amp;amp;&lt;span&gt;s[i]);
}
&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * å“²å­¦å®¶iæ”¾ä¸‹å·¦å³å‰å­
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt; phi_put_forks_sema(&lt;span&gt;int&lt;/span&gt; i) &lt;span&gt;/*&lt;/span&gt;&lt;span&gt; iï¼šå“²å­¦å®¶å·ç ä»0åˆ°N-1 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
{ 
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ”¾å‰å­æ—¶éœ€è¦é€šè¿‡mutexä¿¡å·é‡è¿›è¡Œäº’æ–¥ï¼Œé˜²æ­¢å¹¶å‘é—®é¢˜(è¿›å…¥ä¸´ç•ŒåŒº)&lt;/span&gt;
    down(&amp;amp;mutex); &lt;span&gt;/*&lt;/span&gt;&lt;span&gt; è¿›å…¥ä¸´ç•ŒåŒº &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
    &lt;span&gt;//&lt;/span&gt;&lt;span&gt; å“²å­¦å®¶è¿›é¤ç»“æŸ(æ‰§è¡Œphi_put_forks_semaæ”¾ä¸‹å‰å­ï¼Œè¯´æ˜å“²å­¦å®¶å·²ç»å°±é¤å®Œæ¯•ï¼Œé‡æ–°è¿›å…¥THINKINGæ€è€ƒçŠ¶æ€)&lt;/span&gt;
    state_sema[i]=&lt;span&gt;THINKING;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å½“å“²å­¦å®¶iå°±é¤ç»“æŸï¼Œæ”¾ä¸‹å‰å­æ—¶ã€‚éœ€è¦åˆ¤æ–­å·¦ã€å³ä¸´è¿‘çš„å“²å­¦å®¶åœ¨è‡ªå·±å°±é¤çš„è¿™æ®µæ—¶é—´å†…æ˜¯å¦ä¹Ÿè¿›å…¥äº†é¥¥é¥¿çŠ¶æ€ï¼Œå´å› ä¸ºè‡ªå·±å°±é¤æ‹¿èµ°äº†å‰å­è€Œæ— æ³•åŒæ—¶è·å¾—å·¦å³ä¸¤ä¸ªå‰å­ã€‚
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¸ºæ­¤å“²å­¦å®¶iåœ¨æ”¾ä¸‹å‰å­åéœ€è¦å°è¯•ç€åˆ¤æ–­åœ¨è‡ªå·±æ”¾ä¸‹å‰å­åï¼Œå·¦/å³ä¸´è¿‘çš„ã€å¤„äºé¥¥é¥¿çš„å“²å­¦å®¶èƒ½å¦è¿›è¡Œå°±é¤,å¦‚æœå¯ä»¥å°±å”¤é†’é˜»å¡çš„å“²å­¦å®¶çº¿ç¨‹ï¼Œå¹¶ä»¤å…¶è¿›å…¥å°±é¤çŠ¶æ€(EATING)&lt;/span&gt;
    phi_test_sema(LEFT); &lt;span&gt;/*&lt;/span&gt;&lt;span&gt; çœ‹ä¸€ä¸‹å·¦é‚»å±…ç°åœ¨æ˜¯å¦èƒ½è¿›é¤ &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    phi_test_sema(RIGHT); &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt; çœ‹ä¸€ä¸‹å³é‚»å±…ç°åœ¨æ˜¯å¦èƒ½è¿›é¤ &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
    up(&lt;/span&gt;&amp;amp;mutex); &lt;span&gt;/*&lt;/span&gt;&lt;span&gt; ç¦»å¼€ä¸´ç•ŒåŒºq(å”¤é†’å¯èƒ½é˜»å¡åœ¨mutexä¸Šçš„å…¶å®ƒçº¿ç¨‹) &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
}

&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * åˆ¤æ–­å“²å­¦å®¶iæ˜¯å¦å¯ä»¥æ‹¿èµ·å·¦å³å‰å­
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt; phi_test_sema(i) &lt;span&gt;/*&lt;/span&gt;&lt;span&gt; iï¼šå“²å­¦å®¶å·ç ä»0åˆ°N-1 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
{ 
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å½“å“²å­¦å®¶iå¤„äºé¥¥é¥¿çŠ¶æ€(HUNGRY),ä¸”å…¶å·¦å³ä¸´è¿‘çš„å“²å­¦å®¶éƒ½æ²¡æœ‰åœ¨å°±é¤çŠ¶æ€(EATING)&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt;(state_sema[i]==HUNGRY&amp;amp;&amp;amp;state_sema[LEFT]!=&lt;span&gt;EATING
            &lt;/span&gt;&amp;amp;&amp;amp;state_sema[RIGHT]!=&lt;span&gt;EATING)
    {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å“²å­¦å®¶ié¥¿äº†(HUNGRY)ï¼Œä¸”å·¦å³ä¸¤è¾¹çš„å‰å­éƒ½æ²¡äººç”¨ã€‚
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä»¤å“²å­¦å®¶è¿›å…¥å°±é¤çŠ¶æ€ï¼ˆEATINGï¼‰&lt;/span&gt;
        state_sema[i]=&lt;span&gt;EATING;
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å”¤é†’é˜»å¡åœ¨å¯¹åº”ä¿¡å·é‡ä¸Šçš„å“²å­¦å®¶çº¿ç¨‹(å½“æ˜¯å“²å­¦å®¶çº¿ç¨‹iè‡ªå·±æ‰§è¡Œphi_test_sema(i)æ—¶ï¼Œåˆ™ä¿¡å·é‡ç›´æ¥åŠ 1ï¼ŒæŠµæ¶ˆæ‰phi_take_forks_semaä¸­çš„downæ“ä½œï¼Œä»£è¡¨ç›´æ¥æ‹¿èµ·å‰å­å°±é¤æˆåŠŸè€Œä¸ç”¨è¿›å…¥é˜»å¡æ€)&lt;/span&gt;
        up(&amp;amp;&lt;span&gt;s[i]);
    }
}&lt;/span&gt; 
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;2.4 å®ç°æ¡ä»¶å˜é‡å’Œç®¡ç¨‹&lt;/h2&gt;
&lt;h2&gt;&lt;span&gt;ã€€ã€€æ¡ä»¶å˜é‡å’Œä¿¡å·é‡çš„åŠŸèƒ½å¾ˆç›¸ä¼¼ï¼Œæ¡ä»¶å˜é‡ä¹Ÿæä¾›äº†ç±»ä¼¼çš„çº¿ç¨‹åŒæ­¥æœºåˆ¶ï¼Œå’Œä¿¡å·é‡çš„down/upæ“ä½œå¯¹åº”çš„æ˜¯waitå’Œsignalæ“ä½œã€‚åœ¨åŸå§‹çš„å®šä¹‰ä¸­æ¡ä»¶å˜é‡å¯ä»¥ç”¨ä¿¡å·é‡ä½œä¸ºåŸºç¡€å®ç°ï¼›åè¿‡æ¥ä¿¡å·é‡ä¹Ÿèƒ½ç”¨å·²ç»å®ç°çš„æ¡ä»¶å˜é‡æ¥å®ç°ã€‚&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;ã€€ã€€ucoreä¸­çš„æ¡ä»¶å˜é‡æ˜¯åŸºäºä¿¡å·é‡å®ç°çš„ï¼ŒåŒæ—¶æ¡ä»¶å˜é‡ä¹Ÿä½œä¸ºç®¡ç¨‹Monitorç»“æ„çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¡ä»¶å˜é‡condvarç»“æ„å®šä¹‰ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * æ¡ä»¶å˜é‡
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
typedef &lt;/span&gt;&lt;span&gt;struct&lt;/span&gt;&lt;span&gt; condvar{
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ¡ä»¶å˜é‡ç›¸å…³çš„ä¿¡å·é‡ï¼Œç”¨äºé˜»å¡/å”¤é†’çº¿ç¨‹&lt;/span&gt;
    semaphore_t sem;        &lt;span&gt;//&lt;/span&gt;&lt;span&gt; the sem semaphore  is used to down the waiting proc, and the signaling proc should up the waiting proc
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç­‰å¾…åœ¨æ¡ä»¶å˜é‡ä¹‹ä¸Šçš„çº¿ç¨‹æ•°&lt;/span&gt;
    &lt;span&gt;int&lt;/span&gt; count;              &lt;span&gt;//&lt;/span&gt;&lt;span&gt; the number of waiters on condvar
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ‹¥æœ‰è¯¥æ¡ä»¶å˜é‡çš„monitorç®¡ç¨‹&lt;/span&gt;
    monitor_t * owner;      &lt;span&gt;//&lt;/span&gt;&lt;span&gt; the owner(monitor) of this condvar&lt;/span&gt;
} condvar_t;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;ç®¡ç¨‹monitorç»“æ„å®šä¹‰ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;41&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * ç®¡ç¨‹
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;&lt;span&gt;
typedef &lt;/span&gt;&lt;span&gt;struct&lt;/span&gt;&lt;span&gt; monitor{
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç®¡ç¨‹æ§åˆ¶å¹¶å‘çš„äº’æ–¥é”ï¼ˆåº”è¯¥è¢«åˆå§‹åŒ–ä¸º1çš„äº’æ–¥ä¿¡å·é‡ï¼‰&lt;/span&gt;
    semaphore_t mutex;      &lt;span&gt;//&lt;/span&gt;&lt;span&gt; the mutex lock for going into the routines in monitor, should be initialized to 1
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç®¡ç¨‹å†…éƒ¨åè°ƒå„å¹¶å‘çº¿ç¨‹çš„ä¿¡å·é‡ï¼ˆçº¿ç¨‹å¯ä»¥é€šè¿‡è¯¥ä¿¡å·é‡æŒ‚èµ·è‡ªå·±ï¼Œå…¶å®ƒå¹¶å‘çº¿ç¨‹æˆ–è€…è¢«å”¤é†’çš„çº¿ç¨‹å¯ä»¥åè¿‡æ¥å”¤é†’å®ƒï¼‰&lt;/span&gt;
    semaphore_t next;       &lt;span&gt;//&lt;/span&gt;&lt;span&gt; the next semaphore is used to down the signaling proc itself, and the other OR wakeuped waiting proc should wake up the sleeped signaling proc.
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¼‘çœ åœ¨nextä¿¡å·é‡ä¸­çš„çº¿ç¨‹ä¸ªæ•°&lt;/span&gt;
    &lt;span&gt;int&lt;/span&gt; next_count;         &lt;span&gt;//&lt;/span&gt;&lt;span&gt; the number of of sleeped signaling proc
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç®¡ç¨‹æ‰€å±çš„æ¡ä»¶å˜é‡ï¼ˆå¯ä»¥æ˜¯æ•°ç»„ï¼Œå¯¹åº”nä¸ªæ¡ä»¶å˜é‡ï¼‰&lt;/span&gt;
    condvar_t *cv;          &lt;span&gt;//&lt;/span&gt;&lt;span&gt; the condvars in monitor&lt;/span&gt;
&lt;span&gt;} monitor_t;&lt;br/&gt;&lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;*
 * åˆå§‹åŒ–ç®¡ç¨‹
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt;&lt;span&gt;     
monitor_init (monitor_t &lt;/span&gt;*&lt;span&gt; mtp, size_t num_cv) {
    &lt;/span&gt;&lt;span&gt;int&lt;/span&gt;&lt;span&gt; i;
    assert(num_cv&lt;/span&gt;&amp;gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
    mtp&lt;/span&gt;-&amp;gt;next_count = &lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
    mtp&lt;/span&gt;-&amp;gt;cv =&lt;span&gt; NULL;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç®¡ç¨‹çš„äº’æ–¥ä¿¡å·é‡å€¼è®¾ä¸º1ï¼ˆåˆå§‹åŒ–æ—¶æœªè¢«é”ä½ï¼‰&lt;/span&gt;
    sem_init(&amp;amp;(mtp-&amp;gt;mutex), &lt;span&gt;1&lt;/span&gt;); &lt;span&gt;//&lt;/span&gt;&lt;span&gt;unlocked
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç®¡ç¨‹çš„åè°ƒä¿¡å·é‡è®¾ä¸º0ï¼Œå½“ä»»ä½•ä¸€ä¸ªçº¿ç¨‹å‘ç°ä¸æ»¡è¶³æ¡ä»¶æ—¶ï¼Œç«‹å³é˜»å¡åœ¨è¯¥ä¿¡å·é‡ä¸Š&lt;/span&gt;
    sem_init(&amp;amp;(mtp-&amp;gt;next), &lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¸ºæ¡ä»¶å˜é‡åˆ†é…å†…å­˜ç©ºé—´ï¼ˆå‚æ•°num_cvæŒ‡å®šç®¡ç¨‹æ‰€æ‹¥æœ‰çš„æ¡ä»¶å˜é‡çš„ä¸ªæ•°ï¼‰&lt;/span&gt;
    mtp-&amp;gt;cv =(condvar_t *) kmalloc(&lt;span&gt;sizeof&lt;/span&gt;(condvar_t)*&lt;span&gt;num_cv);
    assert(mtp&lt;/span&gt;-&amp;gt;cv!=&lt;span&gt;NULL);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ„é€ å¯¹åº”ä¸ªæ•°çš„æ¡ä»¶å˜é‡&lt;/span&gt;
    &lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;0&lt;/span&gt;; i&amp;lt;num_cv; i++&lt;span&gt;){
        mtp&lt;/span&gt;-&amp;gt;cv[i].count=&lt;span&gt;0&lt;/span&gt;&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ¡ä»¶å˜é‡ä¿¡å·é‡åˆå§‹åŒ–æ—¶è®¾ç½®ä¸º0ï¼Œå½“ä»»ä½•ä¸€ä¸ªçº¿ç¨‹å‘ç°ä¸æ»¡è¶³æ¡ä»¶æ—¶ï¼Œç«‹å³é˜»å¡åœ¨è¯¥ä¿¡å·é‡ä¸Š&lt;/span&gt;
        sem_init(&amp;amp;(mtp-&amp;gt;cv[i].sem),&lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
        mtp&lt;/span&gt;-&amp;gt;cv[i].owner=&lt;span&gt;mtp;
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;æ¡ä»¶å˜é‡çš„ç­‰å¾…æ“ä½œå®ç°ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€cond_waitå‡½æ•°å®ç°æ¡ä»¶å˜é‡çš„waitæ“ä½œã€‚æ¡ä»¶å˜é‡çš„waitæ“ä½œå’Œä¿¡å·é‡çš„downåŠŸèƒ½ç±»ä¼¼ã€‚å½“æ¡ä»¶å˜é‡å¯¹åº”çš„æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œé€šè¿‡ä¿¡å·é‡çš„downæ“ä½œï¼Œä»¤å½“å‰çº¿ç¨‹é˜»å¡ã€ç­‰å¾…åœ¨æ¡ä»¶å˜é‡æ‰€å±çš„ä¿¡å·é‡ä¸Šã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;45&quot;&gt;
&lt;pre&gt;
&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Suspend calling thread on a condition variable waiting for condition Atomically unlocks 
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; mutex and suspends calling thread on conditional variable after waking up locks mutex. Notice: mp is mutex semaphore for monitor's procedures&lt;/span&gt;&lt;span&gt;
/*&lt;/span&gt;&lt;span&gt;*
 * æ¡ä»¶å˜é‡é˜»å¡ç­‰å¾…æ“ä½œ
 * ä»¤å½“å‰çº¿ç¨‹é˜»å¡åœ¨è¯¥æ¡ä»¶å˜é‡ä¸Šï¼Œç­‰å¾…å…¶å®ƒçº¿ç¨‹å°†å…¶é€šè¿‡cond_signalå°†å…¶å”¤é†’ã€‚
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt;&lt;span&gt;
cond_wait (condvar_t &lt;/span&gt;*&lt;span&gt;cvp) {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;LAB7 EXERCISE1: YOUR CODE&lt;/span&gt;
    cprintf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cond_wait begin:  cvp %x, cvp-&amp;gt;count %d, cvp-&amp;gt;owner-&amp;gt;next_count %d\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, cvp, cvp-&amp;gt;count, cvp-&amp;gt;owner-&amp;gt;&lt;span&gt;next_count);
    &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;
     *         cv.count ++;
     *         if(mt.next_count&amp;gt;0)
     *            signal(mt.next)
     *         else
     *            signal(mt.mutex);
     *         wait(cv.sem);
     *         cv.count --;
     &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;

    &lt;span&gt;//&lt;/span&gt;&lt;span&gt; é˜»å¡åœ¨å½“å‰æ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹æ•°åŠ 1&lt;/span&gt;
    cvp-&amp;gt;count++&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(cvp-&amp;gt;owner-&amp;gt;next_count &amp;gt; &lt;span&gt;0&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¯¹åº”ç®¡ç¨‹ä¸­å­˜åœ¨è¢«é˜»å¡çš„å…¶å®ƒçº¿ç¨‹
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å”¤é†’é˜»å¡åœ¨å¯¹åº”ç®¡ç¨‹åè°ƒä¿¡å·é‡nextä¸­çš„çº¿ç¨‹&lt;/span&gt;
        up(&amp;amp;(cvp-&amp;gt;owner-&amp;gt;&lt;span&gt;next));
    &lt;/span&gt;&lt;span&gt;else&lt;/span&gt;
        &lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¦‚æœå¯¹åº”ç®¡ç¨‹ä¸­ä¸å­˜åœ¨è¢«é˜»å¡çš„å…¶å®ƒçº¿ç¨‹
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; é‡Šæ”¾å¯¹åº”ç®¡ç¨‹çš„mutexäºŒå…ƒä¿¡å·é‡&lt;/span&gt;
        up(&amp;amp;(cvp-&amp;gt;owner-&amp;gt;&lt;span&gt;mutex));
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä»¤å½“å‰çº¿ç¨‹é˜»å¡åœ¨æ¡ä»¶å˜é‡ä¸Š&lt;/span&gt;
    down(&amp;amp;(cvp-&amp;gt;&lt;span&gt;sem));
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; downè¿”å›ï¼Œè¯´æ˜å·²ç»è¢«å†æ¬¡å”¤é†’ï¼Œæ¡ä»¶å˜é‡countå‡1&lt;/span&gt;
    cvp-&amp;gt;count --&lt;span&gt;;
    cprintf(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cond_wait end:  cvp %x, cvp-&amp;gt;count %d, cvp-&amp;gt;owner-&amp;gt;next_count %d\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, cvp, cvp-&amp;gt;count, cvp-&amp;gt;owner-&amp;gt;&lt;span&gt;next_count);
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;æ¡ä»¶å˜é‡çš„å”¤é†’æ“ä½œå®ç°ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€cond_signalå‡½æ•°ç”¨äºå®ç°æ¡ä»¶å˜é‡çš„signalæ“ä½œã€‚æ¡ä»¶å˜é‡çš„signalæ“ä½œå’Œä¿¡å·é‡çš„upåŠŸèƒ½ç±»ä¼¼ã€‚å½“æ¡ä»¶å˜é‡å¯¹åº”çš„æ¡ä»¶æ»¡è¶³æ—¶ï¼Œé€šè¿‡ä¿¡å·é‡çš„upæ“ä½œï¼Œå”¤é†’é˜»å¡åœ¨å¯¹åº”æ¡ä»¶å˜é‡ä¸­çš„çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;45&quot;&gt;
&lt;pre&gt;
&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Unlock one of threads waiting on the condition variable. &lt;/span&gt;&lt;span&gt;
/*&lt;/span&gt;&lt;span&gt;*
 * æ¡ä»¶å˜é‡å”¤é†’æ“ä½œ
 * è§£é”ï¼ˆå”¤é†’ï¼‰ä¸€ä¸ªç­‰å¾…åœ¨å½“å‰æ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹
 * &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;void&lt;/span&gt;&lt;span&gt; 
cond_signal (condvar_t &lt;/span&gt;*&lt;span&gt;cvp) {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;LAB7 EXERCISE1: YOUR CODE&lt;/span&gt;
    cprintf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cond_signal begin: cvp %x, cvp-&amp;gt;count %d, cvp-&amp;gt;owner-&amp;gt;next_count %d\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, cvp, cvp-&amp;gt;count, cvp-&amp;gt;owner-&amp;gt;&lt;span&gt;next_count);
    &lt;/span&gt;&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;
     *      cond_signal(cv) {
     *          if(cv.count&amp;gt;0) {
     *             mt.next_count ++;
     *             signal(cv.sem);
     *             wait(mt.next);
     *             mt.next_count--;
     *          }
     *       }
     &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
    &lt;span&gt;//&lt;/span&gt;&lt;span&gt; å¦‚æœç­‰å¾…åœ¨æ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹æ•°å¤§äº0&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt;(cvp-&amp;gt;count&amp;gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; éœ€è¦å°†å½“å‰çº¿ç¨‹é˜»å¡åœ¨ç®¡ç¨‹çš„åè°ƒä¿¡å·é‡nextä¸Šï¼Œnext_countåŠ 1&lt;/span&gt;
        cvp-&amp;gt;owner-&amp;gt;next_count ++&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä»¤é˜»å¡åœ¨æ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹è¿›è¡Œupæ“ä½œï¼Œå”¤é†’çº¿ç¨‹&lt;/span&gt;
        up(&amp;amp;(cvp-&amp;gt;&lt;span&gt;sem));
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä»¤å½“å‰çº¿ç¨‹é˜»å¡åœ¨ç®¡ç¨‹çš„åè°ƒä¿¡å·é‡nextä¸Š
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¿è¯ç®¡ç¨‹ä¸´ç•ŒåŒºä¸­åªæœ‰ä¸€ä¸ªæ´»åŠ¨çº¿ç¨‹ï¼Œå…ˆä»¤è‡ªå·±é˜»å¡åœ¨nextä¿¡å·é‡ä¸Šï¼›ç­‰å¾…è¢«å”¤é†’çš„çº¿ç¨‹åœ¨ç¦»å¼€ä¸´ç•ŒåŒºåæ¥åè¿‡æ¥å°†è‡ªå·±ä»nextä¿¡å·é‡ä¸Šå”¤é†’&lt;/span&gt;
        down(&amp;amp;(cvp-&amp;gt;owner-&amp;gt;&lt;span&gt;next));
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å½“å‰çº¿ç¨‹è¢«å…¶å®ƒçº¿ç¨‹å”¤é†’ä»downå‡½æ•°ä¸­è¿”å›ï¼Œnext_countå‡1&lt;/span&gt;
        cvp-&amp;gt;owner-&amp;gt;next_count --&lt;span&gt;;
    }
    cprintf(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;cond_signal end: cvp %x, cvp-&amp;gt;count %d, cvp-&amp;gt;owner-&amp;gt;next_count %d\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;, cvp, cvp-&amp;gt;count, cvp-&amp;gt;owner-&amp;gt;&lt;span&gt;next_count);
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;æ¡ä»¶å˜é‡ä¸ç®¡ç¨‹çš„äº¤äº’ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä»”ç»†æ¯”å¯¹æ¡ä»¶å˜é‡ä¸ä¿¡å·é‡çš„å®ç°ï¼Œä¼šå‘ç°å¤§è‡´çš„å®ç°æ€è·¯æ˜¯ä¸€è‡´çš„ã€‚ä½†ucoreä¸­å®ç°çš„æ¡ä»¶å˜é‡æ˜¯ä½œä¸ºç®¡ç¨‹çš„ä¸€éƒ¨åˆ†å·¥ä½œçš„ï¼Œå› æ­¤åœ¨waitå’Œsignalæ“ä½œä¸­éƒ½é¢å¤–è€¦åˆäº†ä¸å¯¹åº”ç®¡ç¨‹owneräº¤äº’çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;ã€€&lt;strong&gt;ã€€åœ¨ç®¡ç¨‹ä¸­è¿›å…¥ä¸´ç•ŒåŒºçš„çº¿ç¨‹å‘ç°æ¡ä»¶ä¸æ»¡è¶³è€Œè¿›è¡Œæ¡ä»¶å˜é‡çš„waitæ“ä½œæ—¶ï¼Œéœ€è¦é‡Šæ”¾ç®¡ç¨‹ä¸­ä¸´ç•ŒåŒºçš„é”ï¼Œåœ¨waitæ“ä½œæŒ‚èµ·è‡ªèº«æ—¶ä»¤å…¶å®ƒæƒ³è¦è¿›å…¥ç®¡ç¨‹å†…çš„çº¿ç¨‹è·å¾—ä¸´ç•ŒåŒºçš„è®¿é—®æƒé™ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€åœ¨ç®¡ç¨‹ä¸­ä¸´ç•ŒåŒºçš„çº¿ç¨‹å‘ç°æŸä¸€æ¡ä»¶å¾—åˆ°æ»¡è¶³æ—¶ï¼Œå°†æ‰§è¡Œå¯¹åº”æ¡ä»¶å˜é‡çš„signalæ“ä½œä»¥å”¤é†’ç­‰å¾…åœ¨å…¶ä¸Šçš„æŸä¸€ä¸ªçº¿ç¨‹ã€‚ä½†æ˜¯ç”±äºç®¡ç¨‹ä¸´ç•ŒåŒºçš„äº’æ–¥æ€§ï¼Œä¸èƒ½å…è®¸ä¸´ç•ŒåŒºå†…æœ‰è¶…è¿‡ä¸€ä¸ªçš„çº¿ç¨‹åœ¨å…¶ä¸­è¿è¡Œï¼Œå› æ­¤æ‰§è¡Œsignalæ“ä½œçš„çº¿ç¨‹éœ€è¦é¦–å…ˆå°†è‡ªå·±é˜»å¡æŒ‚èµ·åœ¨ç®¡ç¨‹çš„nextä¿¡å·é‡ä¸Šï¼Œä½¿å¾—è¢«å”¤é†’çš„é‚£ä¸€ä¸ªçº¿ç¨‹ç‹¬å ä¸´ç•ŒåŒºèµ„æºã€‚å½“è¢«å”¤é†’çš„çº¿ç¨‹ç¦»å¼€ä¸´ç•ŒåŒºæ—¶ï¼Œä¹Ÿä¼šåŠæ—¶çš„å”¤é†’æŒ‚èµ·åœ¨ç®¡ç¨‹nextä¿¡å·é‡ä¸Šçš„å¯¹åº”çº¿ç¨‹ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;2.5Â ä½¿ç”¨ç®¡ç¨‹è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜&lt;/h2&gt;
&lt;p&gt;ã€€ã€€ç”±äºå¹¶å‘ç¯å¢ƒä¸‹å¤šä¸ªçº¿ç¨‹é€šè¿‡æ¡ä»¶å˜é‡ç­‰åŒæ­¥æœºåˆ¶äº¤æ›¿çš„ä¼‘çœ /å”¤é†’ï¼Œé€»è¾‘æ‰§è¡Œæµå¹¶ä¸æ˜¯è¿è´¯çš„ï¼Œå› æ­¤æ¡ä»¶å˜é‡å’Œç®¡ç¨‹çš„å®ç°æ˜¾å¾—æ¯”è¾ƒç»•ï¼Œä»¤äººè´¹è§£ã€‚é€šè¿‡å­¦ä¹ å¦‚ä½•ç”¨ç®¡ç¨‹è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜ï¼Œçœ‹çœ‹ä½¿ç”¨ç®¡ç¨‹/æ¡ä»¶å˜é‡æ˜¯å¦‚ä½•è¿›è¡Œçº¿ç¨‹åŒæ­¥äº’æ–¥çš„ï¼ŒåŠ æ·±å¯¹æ¡ä»¶å˜é‡ã€ç®¡ç¨‹å·¥ä½œæœºåˆ¶çš„ç†è§£ã€‚Â &lt;/p&gt;
&lt;p&gt;ã€€ã€€åœ¨&lt;strong&gt;checkSync&lt;/strong&gt;å‡½æ•°çš„ååŠéƒ¨åˆ†ï¼Œæ˜¯å…³äºå¦‚ä½•ä½¿ç”¨ç®¡ç¨‹è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜ã€‚&lt;strong&gt;åœ¨check_syncçš„ååŠéƒ¨åˆ†åˆ›å»ºäº†N(N=5)ä¸ªå“²å­¦å®¶å†…æ ¸çº¿ç¨‹ï¼Œç”¨äºæ‰§è¡Œ&lt;/strong&gt;&lt;strong&gt;philosopher_using_condvar&lt;/strong&gt;&lt;strong&gt;å‡½æ•°ï¼Œæ¨¡æ‹Ÿå“²å­¦å®¶å°±é¤é—®é¢˜ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;strong&gt;philosopher_using_condvar&lt;/strong&gt;ä¸­å“²å­¦å®¶å¾ªç¯å¾€å¤çš„è¿›è¡Œå¦‚ä¸‹æ“ä½œ(æ•´ä½“æµç¨‹å’Œä¿¡å·é‡çš„å®ç°å¤§ä½“ä¸€è‡´)ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€1. å“²å­¦å®¶è¿›è¡Œæ€è€ƒ(é€šè¿‡do_sleepç³»ç»Ÿè°ƒç”¨è¿›è¡Œä¼‘çœ é˜»å¡ï¼Œæ¨¡æ‹Ÿå“²å­¦å®¶æ€è€ƒ)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€2. é€šè¿‡phi_take_forks_condvar&lt;/strong&gt;&lt;strong&gt;å‡½æ•°å°è¯•ç€åŒæ—¶æ‹¿èµ·å·¦å³ä¸¤ä¸ªå‰å­ï¼ˆå¦‚æœæ²¡æœ‰æ‹¿åˆ°å·¦å³å‰å­ï¼Œé™·å…¥é˜»å¡ï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€3. å“²å­¦å®¶è¿›è¡Œå°±é¤(&lt;/strong&gt;&lt;strong&gt;é€šè¿‡do_sleepç³»ç»Ÿè°ƒç”¨è¿›è¡Œä¼‘çœ é˜»å¡ï¼Œæ¨¡æ‹Ÿå“²å­¦å®¶å°±é¤&lt;/strong&gt;)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€4. é€šè¿‡phi_put_forks_condvarå‡½æ•°åŒæ—¶æ”¾ä¸‹å·¦å³ä¸¤ä¸ªå‰å­ï¼Œå›åˆ°æ€è€ƒçŠ¶æ€&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;strong&gt;ã€€ã€€æ‹¿èµ·å‰å­çš„phi_take_forks_condvar&lt;/strong&gt;&lt;strong&gt;å‡½æ•°å’Œæ”¾ä¸‹å‰å­phi_put_forks_condvar&lt;/strong&gt;&lt;strong&gt;çš„å‡½æ•°å†…éƒ¨éƒ½æ˜¯é€šè¿‡æ¡ä»¶å˜é‡è¿›è¡ŒåŒæ­¥çš„ï¼Œåœ¨ä¸‹é¢è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„åˆ†æã€‚&lt;/strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;checkSyncå‡½æ•°ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;44&quot;&gt;
&lt;pre&gt;
&lt;span&gt;void&lt;/span&gt; check_sync(&lt;span&gt;void&lt;/span&gt;&lt;span&gt;){
    &lt;/span&gt;&lt;span&gt;int&lt;/span&gt;&lt;span&gt; i;

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;check semaphore&lt;/span&gt;
    sem_init(&amp;amp;mutex, &lt;span&gt;1&lt;/span&gt;&lt;span&gt;);
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;0&lt;/span&gt;;i&amp;lt;N;i++&lt;span&gt;){
        sem_init(&lt;/span&gt;&amp;amp;s[i], &lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; pid = kernel_thread(philosopher_using_semaphore, (&lt;span&gt;void&lt;/span&gt; *)i, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (pid &amp;lt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;) {
            panic(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;create No.%d philosopher_using_semaphore failed.\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        }
        philosopher_proc_sema[i] &lt;/span&gt;=&lt;span&gt; find_proc(pid);
        set_proc_name(philosopher_proc_sema[i], &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;philosopher_sema_proc&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
    }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;check condition variable&lt;/span&gt;
    monitor_init(&amp;amp;&lt;span&gt;mt, N);
    &lt;/span&gt;&lt;span&gt;for&lt;/span&gt;(i=&lt;span&gt;0&lt;/span&gt;;i&amp;lt;N;i++&lt;span&gt;){
        state_condvar[i]&lt;/span&gt;=&lt;span&gt;THINKING;
        &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; pid = kernel_thread(philosopher_using_condvar, (&lt;span&gt;void&lt;/span&gt; *)i, &lt;span&gt;0&lt;/span&gt;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (pid &amp;lt;= &lt;span&gt;0&lt;/span&gt;&lt;span&gt;) {
            panic(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;create No.%d philosopher_using_condvar failed.\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        }
        philosopher_proc_condvar[i] &lt;/span&gt;=&lt;span&gt; find_proc(pid);
        set_proc_name(philosopher_proc_condvar[i], &lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;philosopher_condvar_proc&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;ç®¡ç¨‹å®ç°ä¸­æ‹¿èµ·å‰å­/æ”¾ä¸‹å‰å­å‡½æ•°åˆ†æï¼š&lt;/h3&gt;
&lt;p&gt;Â ã€€ã€€&lt;strong&gt;phi_take_forks_condvar&lt;/strong&gt;å‡½æ•°è¡¨è¾¾å“²å­¦å®¶å°è¯•ç€æ‹¿èµ·å·¦å³å‰å­æƒ³è¦å°±é¤ï¼›è€Œ&lt;strong&gt;phi_put_forks_condvar&lt;/strong&gt;å‡½æ•°è¡¨è¾¾å“²å­¦å®¶è¿›é¤ç»“æŸåæ”¾ä¸‹å·¦å³å‰å­ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€ä¸¤è€…é€šè¿‡&lt;strong&gt;ç®¡ç¨‹ä¸­çš„äº’æ–¥ä¿¡å·é‡mutex&lt;/strong&gt;çš„&lt;strong&gt;down&lt;/strong&gt;æ“ä½œè¿›è¡Œå…¨å±€çš„äº’æ–¥ï¼Œä¿è¯åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå“²å­¦å®¶çº¿ç¨‹èƒ½å¤Ÿè¿›å…¥ä¸´ç•ŒåŒºï¼Œå¯¹ä¸´ç•ŒåŒºçš„èµ„æºå‰å­è¿›è¡Œæ‹¿èµ·/æ”¾ä¸‹æ“ä½œï¼Œå¯¹ä¸åŒçš„å“²å­¦å®¶çº¿ç¨‹è¿›è¡Œäº’æ–¥ï¼Œä¿è¯æŸ¥çœ‹å·¦å³å‰å­çš„çŠ¶æ€æ—¶ä¸ä¼šå‡ºç°å¹¶å‘é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€åœ¨ç¦»å¼€ç®¡ç¨‹çš„ä¸´ç•ŒåŒºæ—¶(æ³¨é‡Šinto routine in monitorå’Œleave routine in monitorä¹‹é—´ä¸ºç®¡ç¨‹çš„ä¸´ç•ŒåŒºä»£ç )ï¼Œå½“å‰çº¿ç¨‹ä¼šæ ¹æ®ç®¡ç¨‹å†…æ˜¯å¦å­˜åœ¨å…¶å®ƒçº¿ç¨‹(mtp-&amp;gt;next_count&amp;gt;0)è€Œæœ‰ä¸åŒçš„æ“ä½œã€‚å½“å‘ç°ç®¡ç¨‹ä¸­çš„nextä¿¡å·é‡ä¸Šå­˜åœ¨å…¶å®ƒçº¿ç¨‹é˜»å¡åœ¨ä¸Šé¢æ—¶ï¼Œä¼˜å…ˆå”¤é†’nextä¿¡å·é‡ä¸Šçš„çº¿ç¨‹(é˜»å¡åœ¨nextä¸Šçš„çº¿ç¨‹æ˜¯ç”±äºè¦å”¤é†’ç­‰å¾…åœ¨æŸä¸€æ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹ï¼Œä¸ºäº†ä¿è¯ä¸´ç•ŒåŒºäº’æ–¥è‡ªæ„¿è¢«é˜»å¡çš„ï¼Œå› æ­¤è¢«å”¤é†’çš„çº¿ç¨‹åœ¨ç¦»å¼€ä¸´ç•ŒåŒºåéœ€è¦ç¬¬ä¸€æ—¶é—´å°†å…¶å”¤é†’)ï¼›è€Œå¦‚æœnextä¿¡å·é‡ä¸­ä¸å­˜åœ¨ä¼‘çœ çš„çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±å’Œä¿¡å·é‡çš„å®ç°ç±»ä¼¼ï¼Œé‡Šæ”¾mutexäº’æ–¥é”ï¼Œå”¤é†’å¯èƒ½ç­‰å¾…åœ¨å…¶ä¸Šçš„æŸä¸€çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€ä¸Šè¿°ucoreå®ç°çš„ç®¡ç¨‹å…¶çº¿ç¨‹äº¤äº’çš„é€»è¾‘æ˜¯åŸºäºHoareè¯­ä¹‰çš„ï¼Œæ­¤å¤–è¿˜å­˜åœ¨MESAè¯­ä¹‰çš„ç®¡ç¨‹å’ŒHansenè¯­ä¹‰çš„ç®¡ç¨‹(MESAç®¡ç¨‹å’ŒHansenç®¡ç¨‹å®ç°ç±»ä¼¼å‰é¢çš„ä¿¡å·é‡å®ç°å“²å­¦å®¶å°±é¤)ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€Hoareç®¡ç¨‹åœ¨signalå”¤é†’å…¶å®ƒçº¿ç¨‹æ—¶ä¼šä»¤è‡ªå·±é™·å…¥ä¼‘çœ ï¼Œä¸¥æ ¼çš„ä¿è¯äº†ä¸´ç•ŒåŒºçº¿ç¨‹çš„äº’æ–¥ï¼Œç†è®ºä¸Šæ›´åŠ å¯é ï¼Œå¸¸è§äºæ•™ç§‘ä¹¦çš„ç†è®ºä¸­ã€‚ç”±äºHoareè¯­ä¹‰çš„ç®¡ç¨‹éœ€è¦é¢å¤–å¼•å…¥ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—(nextä¿¡å·é‡)ï¼Œå› æ­¤å…¶æ€§èƒ½å¹¶ä¸å¦‚å…¶å®ƒä¸¤ç§è¯­ä¹‰çš„ç®¡ç¨‹ï¼Œç°å®ä¸­è¢«ä½¿ç”¨çš„åœ°æ–¹å¾ˆå°‘ã€‚&lt;/strong&gt;&lt;br/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;phi_take_forks_condvarå‡½æ•°(åŒæ—¶æ‹¿èµ·å·¦å³å‰å­)ï¼š&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;void&lt;/span&gt; phi_take_forks_condvar(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; i) {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ‹¿å‰å­æ—¶éœ€è¦é€šè¿‡mutexä¿¡å·é‡è¿›è¡Œäº’æ–¥ï¼Œé˜²æ­¢å¹¶å‘é—®é¢˜(è¿›å…¥ä¸´ç•ŒåŒº)&lt;/span&gt;
    down(&amp;amp;(mtp-&amp;gt;&lt;span&gt;mutex));
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;--------into routine in monitor--------------
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; LAB7 EXERCISE1: YOUR CODE
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; I am hungry
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; try to get fork
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; I am hungry
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è®°å½•ä¸‹å“²å­¦å®¶ié¥¥é¥¿çš„äº‹å®(æ‰§è¡Œphi_take_forks_condvarå°è¯•æ‹¿å‰å­ï¼Œè¯´æ˜å“²å­¦å®¶iè¿›å…¥äº†HUNGRYé¥¥é¥¿çŠ¶æ€)&lt;/span&gt;
    state_condvar[i]=&lt;span&gt;HUNGRY;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è¯•å›¾åŒæ—¶å¾—åˆ°å·¦å³ä¸¤åªå‰å­&lt;/span&gt;
&lt;span&gt;    phi_test_condvar(i);
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (state_condvar[i] !=&lt;span&gt; EATING) {
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; state_condvar[i]çŠ¶æ€ä¸ä¸ºEATINGï¼Œè¯´æ˜phi_test_condvarå°è¯•æ‹¿å·¦å³å‰å­è¿›é¤å¤±è´¥&lt;/span&gt;
        cprintf(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;phi_take_forks_condvar: %d didn't get fork and will wait\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,i);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç­‰å¾…é˜»å¡åœ¨ç®¡ç¨‹çš„æ¡ä»¶å˜é‡cv[i]ä¸Š&lt;/span&gt;
        cond_wait(&amp;amp;mtp-&amp;gt;&lt;span&gt;cv[i]);
    }
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;--------leave routine in monitor--------------&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt;(mtp-&amp;gt;next_count&amp;gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;){
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å½“ç¦»å¼€ç®¡ç¨‹ä¸´ç•ŒåŒºæ—¶ï¼Œå¦‚æœå‘ç°å­˜åœ¨çº¿ç¨‹ç­‰å¾…åœ¨mtp-&amp;gt;nextä¸Š
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; åœ¨å½“å‰å®éªŒä¸­ï¼Œæ‰§è¡Œåˆ°è¿™é‡Œçš„å½“å‰çº¿ç¨‹å¯èƒ½æ˜¯é˜»å¡åœ¨cond_waitä¸­è¢«å…¶å®ƒçº¿ç¨‹å”¤é†’çš„ï¼Œå¯¹åº”çº¿ç¨‹æ˜¯é€šè¿‡phi_test_condvarçš„cond_signalæ“ä½œå”¤é†’å½“å‰çº¿ç¨‹çš„
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ‰§è¡Œcond_signalæ—¶ä¸ºäº†ä¿è¯ç®¡ç¨‹ä¸´ç•ŒåŒºå†…ä¸å­˜åœ¨å¹¶å‘çš„çº¿ç¨‹è®¿é—®ï¼Œåœ¨å”¤é†’å…¶å®ƒçº¿ç¨‹æ—¶ï¼Œä¼šæŠŠè‡ªå·±é˜»å¡åœ¨ç®¡ç¨‹çš„nextä¿¡å·é‡ä¸Šï¼Œç­‰å¾…æ­¤æ—¶ç¦»å¼€ä¸´ç•ŒåŒºçš„çº¿ç¨‹å°†å…¶å”¤é†’&lt;/span&gt;
        up(&amp;amp;(mtp-&amp;gt;&lt;span&gt;next));
    }&lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;{
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å½“ç¦»å¼€ç®¡ç¨‹ä¸´ç•ŒåŒºæ—¶,æ²¡æœ‰å…¶å®ƒçº¿ç¨‹ç­‰å¾…åœ¨mtp-&amp;gt;nextä¸Šï¼Œç›´æ¥é‡Šæ”¾ç®¡ç¨‹çš„äº’æ–¥é”mutexå³å¯(å”¤é†’å¯èƒ½é˜»å¡åœ¨mutexä¸Šçš„å…¶å®ƒçº¿ç¨‹)&lt;/span&gt;
        up(&amp;amp;(mtp-&amp;gt;&lt;span&gt;mutex));
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;phi_put_forks_condvarå‡½æ•°(åŒæ—¶æ”¾ä¸‹å·¦å³å‰å­)ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;void&lt;/span&gt; phi_put_forks_condvar(&lt;span&gt;int&lt;/span&gt;&lt;span&gt; i) {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; æ”¾å‰å­æ—¶éœ€è¦é€šè¿‡mutexä¿¡å·é‡è¿›è¡Œäº’æ–¥ï¼Œé˜²æ­¢å¹¶å‘é—®é¢˜(è¿›å…¥ä¸´ç•ŒåŒº)&lt;/span&gt;
    down(&amp;amp;(mtp-&amp;gt;&lt;span&gt;mutex));

&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;--------into routine in monitor--------------
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; LAB7 EXERCISE1: YOUR CODE
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; I ate over
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; test left and right neighbors
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; I ate over
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å“²å­¦å®¶è¿›é¤ç»“æŸ(æ‰§è¡Œphi_put_forks_condvaræ”¾ä¸‹å‰å­ï¼Œè¯´æ˜å“²å­¦å®¶å·²ç»å°±é¤å®Œæ¯•ï¼Œé‡æ–°è¿›å…¥THINKINGæ€è€ƒçŠ¶æ€)&lt;/span&gt;
    state_condvar[i]=&lt;span&gt;THINKING;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; test left and right neighbors
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å½“å“²å­¦å®¶iå°±é¤ç»“æŸï¼Œæ”¾ä¸‹å‰å­æ—¶ã€‚éœ€è¦åˆ¤æ–­å·¦ã€å³ä¸´è¿‘çš„å“²å­¦å®¶åœ¨è‡ªå·±å°±é¤çš„è¿™æ®µæ—¶é—´å†…æ˜¯å¦ä¹Ÿè¿›å…¥äº†é¥¥é¥¿çŠ¶æ€ï¼Œå´å› ä¸ºè‡ªå·±å°±é¤æ‹¿èµ°äº†å‰å­è€Œæ— æ³•åŒæ—¶è·å¾—å·¦å³ä¸¤ä¸ªå‰å­ã€‚
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¸ºæ­¤å“²å­¦å®¶iåœ¨æ”¾ä¸‹å‰å­åéœ€è¦å°è¯•ç€åˆ¤æ–­åœ¨è‡ªå·±æ”¾ä¸‹å‰å­åï¼Œå·¦/å³ä¸´è¿‘çš„ã€å¤„äºé¥¥é¥¿çš„å“²å­¦å®¶èƒ½å¦è¿›è¡Œå°±é¤,å¦‚æœå¯ä»¥å°±å”¤é†’é˜»å¡çš„å“²å­¦å®¶çº¿ç¨‹ï¼Œå¹¶ä»¤å…¶è¿›å…¥å°±é¤çŠ¶æ€(EATING)&lt;/span&gt;
    phi_test_condvar(LEFT); &lt;span&gt;//&lt;/span&gt;&lt;span&gt; çœ‹ä¸€ä¸‹å·¦é‚»å±…ç°åœ¨æ˜¯å¦èƒ½è¿›é¤&lt;/span&gt;
    phi_test_condvar(RIGHT); &lt;span&gt;//&lt;/span&gt;&lt;span&gt; çœ‹ä¸€ä¸‹å³é‚»å±…ç°åœ¨æ˜¯å¦èƒ½è¿›é¤
&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;--------leave routine in monitor--------------
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; lab7çš„å‚è€ƒç­”æ¡ˆ&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt;(mtp-&amp;gt;next_count&amp;gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;){
        cprintf(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;execute here mtp-&amp;gt;next_count&amp;gt;0 \n\n\n\n\n\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        up(&lt;/span&gt;&amp;amp;(mtp-&amp;gt;&lt;span&gt;next));
    }&lt;/span&gt;&lt;span&gt;else&lt;/span&gt;&lt;span&gt;{
        cprintf(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;execute here mtp-&amp;gt;next_count=0 \n\n\n\n\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;);
        up(&lt;/span&gt;&amp;amp;(mtp-&amp;gt;&lt;span&gt;mutex));
    }

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä¸ªäººè®¤ä¸ºæ”¾å‰å­å’Œå–å‰å­çš„æƒ…å†µå¹¶ä¸ä¸€æ ·ï¼Œä¸ä¼šå‡ºç°mtp-&amp;gt;next_count&amp;gt;0çš„æƒ…å†µï¼Œè¿™é‡Œåªéœ€è¦é‡Šæ”¾äº’æ–¥é”å³å¯ï¼ˆå¦‚æœè¿™é‡Œç†è§£çš„æœ‰é—®é¢˜ï¼Œè¿˜è¯·æŒ‡æ­£ï¼‰
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å½“æ”¾å‰å­çš„çº¿ç¨‹åœ¨phi_put_forks_condvarä¸­ç¦»å¼€ç®¡ç¨‹ä¸´ç•ŒåŒºæ—¶ï¼Œåªæœ‰ä¸¤ç§æƒ…å†µ
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 1. æ²¡æœ‰å‘ç°é‚»å±…å¯ä»¥è¿›é¤ï¼Œè‡ªèº«ä¸ä¼šè¢«é˜»å¡
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; 2. å‘ç°æœ‰é‚»å±…ä¹‹å‰è¢«æ‹¿ä¸åˆ°å‰å­é˜»å¡äº†ï¼Œç°åœ¨å¯ä»¥è¿›é¤äº†ï¼Œphi_test_condvarä¸­çš„cond_signalä¼šæš‚æ—¶ä»¤è‡ªå·±é˜»å¡åœ¨nextä¿¡å·é‡ä¸Š
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä½†æ˜¯å¾ˆå¿«è¢«è‡ªå·±å«é†’çš„ç›¸é‚»çš„å“²å­¦å®¶çº¿ç¨‹åœ¨è¢«å”¤é†’åä¸€ç¦»å¼€ä¸´ç•ŒåŒºå°±ä¼šå°†è‡ªå·±å”¤é†’ï¼Œåœ¨cond_signalè¢«å”¤é†’åçš„æ“ä½œä¸­mtp-&amp;gt;next_countä¼šè‡ªå‡ï¼Œè€Œå˜ä¸º0
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;
    &lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä»¥ä¸Šä¸¤ç§æƒ…å†µä¸‹ï¼Œç”±äºç®¡ç¨‹æœ¬èº«æœ€å¤–é¢æœ‰ä¸€ä¸ªmutexäº’æ–¥ä¿¡å·é‡ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶é˜»å¡åœ¨nextä¿¡å·é‡ä¸­ï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šå‡ºç°å‚è€ƒç­”æ¡ˆä¸­mtp-&amp;gt;next_count&amp;gt;0çš„æƒ…å†µ
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; up(&amp;amp;(mtp-&amp;gt;mutex));&lt;/span&gt;
} 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;phi_test_condvarå‡½æ•°(åˆ¤æ–­å“²å­¦å®¶iæ˜¯å¦èƒ½æ‹¿èµ·å·¦å³å‰å­å¼€å§‹å°±é¤)ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt;void&lt;/span&gt;&lt;span&gt; phi_test_condvar (i) {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å½“å“²å­¦å®¶iå¤„äºé¥¥é¥¿çŠ¶æ€(HUNGRY),ä¸”å…¶å·¦å³ä¸´è¿‘çš„å“²å­¦å®¶éƒ½æ²¡æœ‰åœ¨å°±é¤çŠ¶æ€(EATING)&lt;/span&gt;
    &lt;span&gt;if&lt;/span&gt;(state_condvar[i]==HUNGRY&amp;amp;&amp;amp;state_condvar[LEFT]!=&lt;span&gt;EATING
            &lt;/span&gt;&amp;amp;&amp;amp;state_condvar[RIGHT]!=&lt;span&gt;EATING) {
        cprintf(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;phi_test_condvar: state_condvar[%d] will eating\n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,i);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å“²å­¦å®¶ié¥¿äº†(HUNGRY)ï¼Œä¸”å·¦å³ä¸¤è¾¹çš„å‰å­éƒ½æ²¡äººç”¨ã€‚
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä»¤å“²å­¦å®¶è¿›å…¥å°±é¤çŠ¶æ€ï¼ˆEATINGï¼‰&lt;/span&gt;
        state_condvar[i] =&lt;span&gt; EATING ;
        cprintf(&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;phi_test_condvar: signal self_cv[%d] \n&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;,i);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; å”¤é†’é˜»å¡åœ¨å¯¹åº”ä¿¡å·é‡ä¸Šçš„å“²å­¦å®¶çº¿ç¨‹&lt;/span&gt;
        cond_signal(&amp;amp;mtp-&amp;gt;&lt;span&gt;cv[i]) ;
    }
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;2.6 ä¿¡å·é‡å’Œç®¡ç¨‹çš„åŒºåˆ«&lt;/h2&gt;
&lt;p&gt;ã€€ã€€ä¿¡å·é‡æ˜¯ä¸€ä¸ªç®€å•ã€é«˜æ•ˆçš„åŒæ­¥äº’æ–¥æœºåˆ¶ï¼Œä½†ä¹Ÿæ­£æ˜¯ç”±äºå…¶è¿‡äºåº•å±‚ï¼Œæ‰€ä»¥åœ¨ç¼–å†™çº¿ç¨‹åŒæ­¥ä»£ç æ—¶éœ€è¦ååˆ†å°å¿ƒè°¨æ…ï¼Œå¯¹æ¯ä¸€å¤„ä¿¡å·é‡çš„ä½¿ç”¨ä»”ç»†æ–Ÿé…Œæ‰èƒ½ä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§ï¼Œå¯¹å¼€å‘äººå‘˜çš„å¿ƒæ™ºæ˜¯ä¸€ä¸ªå·¨å¤§çš„è´Ÿæ‹…ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€è€Œå°†ç®¡ç¨‹ä½œä¸ºä¸€ä¸ªæ•´ä½“çš„ç»“æ„æ¥çœ‹çš„è¯ï¼Œä¼šå‘ç°ç®¡ç¨‹è™½ç„¶å°†æ§åˆ¶åŒæ­¥çš„ä»£ç é€»è¾‘æŠ½è±¡ä¸ºäº†ä¸€ä¸ªå›ºå®šçš„æ¨¡æ¿å˜å¾—å®¹æ˜“ä½¿ç”¨ï¼Œä½†å´ä¸è¦ä¿æŠ¤çš„ä¸´ç•ŒåŒºä¸šåŠ¡é€»è¾‘ä»£ç è€¦åˆçš„å¾ˆä¸¥é‡ï¼Œæ“ä½œç³»ç»Ÿçš„å¼€å‘è€…å¾ˆéš¾å°†ç®¡ç¨‹æ§åˆ¶åŒæ­¥çš„ä»£ç æ¤å…¥è¿›å¯¹åº”çš„åº”ç”¨ç¨‹åºå†…éƒ¨ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€å› æ­¤æ“ä½œç³»ç»Ÿé€šå¸¸åªæä¾›äº†ä¿¡å·é‡ä»¥åŠæ¡ä»¶å˜é‡è¿™ç§ååº•å±‚ã€è€¦åˆæ€§ä½çš„åŒæ­¥äº’æ–¥æœºåˆ¶ï¼›è€Œç®¡ç¨‹æœºåˆ¶åˆ™æ›´å¤šçš„ç”±é«˜çº§è¯­è¨€çš„ç¼–è¯‘å™¨åœ¨è¯­è¨€å±‚é¢å®ç°ï¼Œä»¥ç®€åŒ–ç¨‹åºå‘˜å¼€å‘å¤æ‚å¹¶å‘åŒæ­¥ç¨‹åºçš„å¤æ‚åº¦ã€‚&lt;/strong&gt;&lt;strong&gt;é«˜çº§è¯­è¨€ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœ¬åœ°æœºå™¨ä»£ç æ—¶ï¼Œå¯ä»¥åœ¨éœ€è¦è¿›è¡ŒåŒæ­¥çš„ä»£ç é€»è¾‘å—ä¸­åˆ©ç”¨æ“ä½œç³»ç»Ÿåº•å±‚æä¾›çš„ä¿¡å·é‡æˆ–æ˜¯æ¡ä»¶å˜é‡æœºåˆ¶æ¥å®ç°ç®¡ç¨‹ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€€ã€€&lt;/strong&gt;ä¾‹å¦‚javaä¸­å¦‚æœåœ¨æ–¹æ³•å®šä¹‰æ—¶ç®€å•çš„åŠ ä¸Šsynchronizedå…³é”®å­—å°±èƒ½æ§åˆ¶å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸ä¼šå¹¶å‘çš„æ‰§è¡Œè¯¥æ–¹æ³•ã€‚è¿™æ˜¯å› ä¸ºåœ¨ç¼–è¯‘æˆå­—èŠ‚ç æ—¶ï¼Œç›¸æ¯”äºæ™®é€šæ–¹æ³•é¢å¤–æ’å…¥äº†ä¸€äº›ç®¡ç¨‹Monitorç›¸å…³çš„åŒæ­¥æ§åˆ¶ä»£ç (ç®¡ç¨‹åº•å±‚ä¾èµ–çš„ä¿¡å·é‡ã€æ¡ä»¶å˜é‡æœºåˆ¶è¿˜æ˜¯å–å†³äºå¯¹åº”çš„æ“ä½œç³»ç»Ÿå¹³å°ï¼Œåªä¸è¿‡è¢«jvmå±è”½æ‰äº†å·®å¼‚ï¼Œè®©javaç¨‹åºå‘˜æ„ŸçŸ¥ä¸åˆ°)ã€‚&lt;/p&gt;

&lt;p&gt;ã€€ã€€é€šè¿‡ucoreçš„lab7çš„å­¦ä¹ ï¼Œè®©æˆ‘ç†è§£äº†ç­‰å¾…é˜Ÿåˆ—ã€ä¿¡å·é‡ã€æ¡ä»¶å˜é‡ä»¥åŠç®¡ç¨‹çš„å¤§è‡´å·¥ä½œåŸç†ï¼Œä¹Ÿå¯¹å¹³å¸¸ä¼šæ¥è§¦åˆ°çš„javaä¸­çš„synchronizedã€AQSã€Reentrantlockå…¶åº•å±‚æœºåˆ¶æœ‰äº†è¿›ä¸€æ­¥çš„è®¤è¯†ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€lab7çš„å­¦ä¹ ä½¿æˆ‘æ”¶è·é¢‡ä¸°ï¼Œä½†è¿™å¯¹äºçº¿ç¨‹åŒæ­¥ç›¸å…³é¢†åŸŸçš„å­¦ä¹ è¿˜æ˜¯è¿œè¿œä¸å¤Ÿã€‚åŒå±äºè¿›ç¨‹é—´é€šä¿¡IPCé¢†åŸŸçš„ç»å…¸é—®é¢˜é™¤äº†å“²å­¦å®¶å°±é¤é—®é¢˜å¤–ï¼Œè¿˜æœ‰è¯»è€…/å†™è€…é—®é¢˜ç­‰ï¼›å¯¹äºçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œé™¤äº†ä½¿ç”¨ä¼‘çœ /å”¤é†’è¿›è¡Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„é˜»å¡çš„æ–¹å¼ä¹‹å¤–ï¼Œè¿˜æœ‰ä½¿ç”¨CASç­‰é‡è¯•çš„æ–¹æ³•ï¼›é™¤äº†ä¿¡å·é‡ã€æ¡ä»¶å˜é‡ç­‰åŸºäºå•æœºç³»ç»Ÿå†…çš„çº¿ç¨‹åŒæ­¥æ–¹å¼å¤–ï¼Œè¿˜æœ‰åŸºäºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œé€šè¿‡ç½‘ç»œè¿›è¡Œå¤šæœºå™¨çº¿ç¨‹åŒæ­¥çš„æœºåˆ¶ç­‰ç­‰ã€‚è™½ç„¶ä¸å¤Ÿäº†è§£çš„çŸ¥è¯†è¿˜æœ‰å¾ˆå¤šï¼Œä½†é€šè¿‡ucoreæ“ä½œç³»ç»Ÿçš„å­¦ä¹ ï¼Œä¸ºæˆ‘å­¦ä¹ ç›¸å…³çš„é¢†åŸŸçŸ¥è¯†æ‰“ä¸‹äº†åŸºç¡€ï¼Œä¹Ÿç»™äº†æˆ‘ç›¸ä¿¡æœ€ç»ˆèƒ½èä¼šè´¯é€šè¿™äº›çŸ¥è¯†çš„ä¿¡å¿ƒã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€è¿™ç¯‡åšå®¢çš„å®Œæ•´ä»£ç æ³¨é‡Šåœ¨æˆ‘çš„githubä¸Šï¼š&lt;a href=&quot;https://github.com/1399852153/ucore_os_lab&quot; target=&quot;_blank&quot;&gt;https://github.com/1399852153/ucore_os_lab&lt;/a&gt;Â (forkè‡ªå®˜æ–¹ä»“åº“)ä¸­çš„&lt;strong&gt;lab7_answer&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ã€€ã€€å¸Œæœ›æˆ‘çš„åšå®¢èƒ½å¸®åŠ©åˆ°å¯¹æ“ä½œç³»ç»Ÿã€ucore osæ„Ÿå…´è¶£çš„äººã€‚å­˜åœ¨è®¸å¤šä¸è¶³ä¹‹å¤„ï¼Œè¿˜è¯·å¤šå¤šæŒ‡æ•™ã€‚&lt;/p&gt;
</description>
<pubDate>Thu, 24 Dec 2020 15:58:00 +0000</pubDate>
<dc:creator>å°ç†Šé¤é¦†</dc:creator>
<og:description>1. ucore lab7ä»‹ç» ucoreåœ¨å‰é¢çš„å®éªŒä¸­å®ç°äº†è¿›ç¨‹/çº¿ç¨‹æœºåˆ¶ï¼Œå¹¶åœ¨lab6ä¸­å®ç°äº†æŠ¢å å¼çš„çº¿ç¨‹è°ƒåº¦æœºåˆ¶ã€‚åŸºäºä¸­æ–­çš„æŠ¢å å¼çº¿ç¨‹è°ƒåº¦æœºåˆ¶ä½¿å¾—çº¿ç¨‹åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­éšæ—¶å¯èƒ½è¢«æ“ä½œç³»ç»Ÿæ‰“æ–­ï¼Œè¢«é˜»å¡</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/xiaoxiongcanguan/p/14152830.html</dc:identifier>
</item>
<item>
<title>æµ…æPythonè£…é¥°å™¨ - hcs_learn</title>
<link>http://www.cnblogs.com/053179hu/p/14183348.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/053179hu/p/14183348.html</guid>
<description>&lt;p&gt;&lt;strong&gt;&lt;span&gt;1ã€ä»€ä¹ˆæ˜¯è£…é¥°å™¨&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;åœ¨ä»‹ç»è£…é¥°å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šä½¿ç”¨Pythonè¯­è¨€è¿›è¡Œç¨‹åºè®¾è®¡æ—¶ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ‰©å±•ä¸€ä¸ªå‡½æ•°çš„åŠŸèƒ½ï¼Œä¸€èˆ¬ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªåä¸ºprint_infoå‡½æ•°ï¼Œå½“å‰è¯¥å‡½æ•°å†…åªåšä¸€äº›ç®€å•çš„æ‰“å°æ“ä½œï¼Œç°åœ¨æˆ‘ä»¬æƒ³æ‰©å±•è¿™ä¸ªå‡½æ•°åŠŸèƒ½ï¼Œå¦‚åœ¨å‘ç”Ÿé”™è¯¯æ—¶ï¼Œæˆ‘ä»¬å°†é”™è¯¯è¡Œå·ä¼ å…¥åˆ°è¯¥å‡½æ•°æ‰“å°å‡ºæ¥ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
&lt;span&gt;def&lt;/span&gt;&lt;span&gt; print_info():
    &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Hello World&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;çœ‹åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ååº”è‚¯å®šæ˜¯é‡æ–°ä¿®æ”¹è¿™ä¸ªå‡½æ•°ã€‚åœ¨print_infoå‡½æ•°å¢åŠ ä¸€ä¸ªå‚æ•°ï¼Œç”¨äºæ¥æ”¶å¤–éƒ¨ä¼ å…¥çš„é”™è¯¯è¡Œå·ï¼Œåœ¨å‡½æ•°å†…éƒ¨å¢åŠ æ‰“å°è¡Œå·ä¿¡æ¯è¯­å¥ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
&lt;span&gt;def&lt;/span&gt;&lt;span&gt; print_info(err_line):
    &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Hello World&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
    &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The Error Occurred Line Number: %d&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %(err_line))
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;ä¼¼ä¹ï¼Œé€šè¿‡ä¿®æ”¹å‡½æ•°å†…å®¹ï¼Œä¹Ÿèƒ½å®ç°æˆ‘ä»¬çš„éœ€æ±‚ã€‚ä½†æœ‰æ²¡æœ‰è¿™ç§å¯èƒ½å‘¢ï¼Œä¸ç›´æ¥è¿›è¡Œä¿®æ”¹print_infoå‡½æ•°å†…å®¹ï¼Œé€šè¿‡å…¶ä»–çš„æ–¹å¼å¢åŠ print_infoå‡½æ•°çš„é¢å¤–åŠŸèƒ½ã€‚ç­”æ¡ˆè‚¯å®šæ˜¯æœ‰çš„ï¼Œèƒ½å®ç°è¿™ç§åŠŸèƒ½çš„å°±æ˜¯æˆ‘ä»¬è¦è®²çš„è£…é¥°å™¨ã€‚&lt;br/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;è£…é¥°å™¨åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä½¿ç”¨æ¯”è¾ƒä¸¥è°¨çš„è¯­è¨€æ¥æè¿°ï¼š&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;strong&gt;&lt;span&gt;&lt;span&gt;è£…é¥°å™¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªPythonå‡½æ•°ï¼Œå®ƒå¯ä»¥è®©å…¶ä»–å‡½æ•°åœ¨ä¸éœ€è¦åšä»»ä½•ä»£ç å˜åŠ¨çš„å‰æä¸‹å¢åŠ é¢å¤–åŠŸèƒ½ï¼Œè£…é¥°å™¨çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ã€‚å®ƒç»å¸¸ç”¨äºæœ‰åˆ‡é¢éœ€æ±‚çš„åœºæ™¯ï¼Œæ¯”å¦‚ï¼šæ’å…¥æ—¥å¿—ã€æ€§èƒ½æµ‹è¯•ã€äº‹åŠ¡å¤„ç†ã€ç¼“å­˜ã€æƒé™æ ¡éªŒç­‰åœºæ™¯ã€‚è£…é¥°å™¨æ˜¯è§£å†³è¿™ç±»&lt;/span&gt;&lt;span&gt;é—®é¢˜çš„ç»ä½³è®¾è®¡ï¼Œæœ‰äº†è£…é¥°å™¨ï¼Œ&lt;br/&gt;æˆ‘ä»¬å°±å¯ä»¥æŠ½ç¦»å‡ºå¤§é‡ä¸å‡½æ•°åŠŸèƒ½æœ¬èº«æ— å…³çš„é›·åŒä»£ç å¹¶ç»§ç»­é‡ç”¨ã€‚&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Â &lt;span&gt;æ¦‚æ‹¬çš„è®²ï¼Œè£…é¥°å™¨çš„ä½œç”¨å°±æ˜¯&lt;strong&gt;ä¸ºå·²ç»å­˜åœ¨çš„å‡½æ•°æˆ–å¯¹è±¡æ·»åŠ é¢å¤–çš„åŠŸèƒ½&lt;/strong&gt;ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;2ã€æ€ä¹ˆå†™ä¸€ä¸ªè£…é¥°å™¨&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µè¿™æ ·çš„ä»£ç &lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &lt;span&gt;import&lt;/span&gt;&lt;span&gt; sys
&lt;/span&gt;&lt;span&gt; 2&lt;/span&gt; 
&lt;span&gt; 3&lt;/span&gt; &lt;span&gt;def&lt;/span&gt;&lt;span&gt; log(fcn):
&lt;/span&gt;&lt;span&gt; 4&lt;/span&gt;     &lt;span&gt;def&lt;/span&gt; wrapper(*argc, **&lt;span&gt;kw):
&lt;/span&gt;&lt;span&gt; 5&lt;/span&gt;         &lt;span&gt;#&lt;/span&gt;&lt;span&gt;New Operations Are Added Here&lt;/span&gt;
&lt;span&gt; 6&lt;/span&gt;         &lt;span&gt;if&lt;/span&gt; len(argc) != 1&lt;span&gt;:
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;             &lt;span&gt;print&lt;/span&gt;(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Illegal parameter&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;             &lt;span&gt;return&lt;/span&gt; -1
&lt;span&gt; 9&lt;/span&gt;         &lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The Error Occurred Line Number: %d&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %&lt;span&gt;(argc[0]))
&lt;/span&gt;&lt;span&gt;10&lt;/span&gt;         &lt;span&gt;return&lt;/span&gt;&lt;span&gt; fcn()
&lt;/span&gt;&lt;span&gt;11&lt;/span&gt;     &lt;span&gt;return&lt;/span&gt;&lt;span&gt; wrapper      
&lt;/span&gt;&lt;span&gt;12&lt;/span&gt; 
&lt;span&gt;13&lt;/span&gt; &lt;span&gt;def&lt;/span&gt;&lt;span&gt; print_info():
&lt;/span&gt;&lt;span&gt;14&lt;/span&gt;     &lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Hello World&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;15&lt;/span&gt; 
&lt;span&gt;16&lt;/span&gt; print_info =&lt;span&gt; log(print_info) &lt;code class=&quot;language-python hljs&quot;/&gt;
&lt;/span&gt;&lt;span&gt;17&lt;/span&gt; 
&lt;span&gt;18&lt;/span&gt; &lt;span&gt;def&lt;/span&gt;&lt;span&gt; main():
&lt;/span&gt;&lt;span&gt;19&lt;/span&gt; &lt;span&gt;    print_info(sys._getframe().f_lineno) # &lt;span&gt;sys._getframe().f_linenoä»£è¡¨å½“å‰çš„è¡Œå·&lt;/span&gt;
&lt;/span&gt;&lt;span&gt;20&lt;/span&gt; 
&lt;span&gt;21&lt;/span&gt; &lt;span&gt;if&lt;/span&gt; &lt;span&gt;__name__&lt;/span&gt; == &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;__main__&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;:
&lt;/span&gt;&lt;span&gt;22&lt;/span&gt;     main()
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;logå‡½æ•°æ˜¯ä¸€ä¸ªâ€œ&lt;span&gt;é—­åŒ…&lt;/span&gt;â€ï¼ˆå…³äºä»€ä¹ˆæ˜¯â€œé—­åŒ…â€å¯å‚è€ƒ&lt;strong&gt;&lt;a href=&quot;https://www.cnblogs.com/053179hu/p/14180479.html&quot; target=&quot;_blank&quot;&gt;â€œæµ…æPythoné—­åŒ…â€&lt;/a&gt;&lt;/strong&gt;ï¼‰ï¼Œè¯¥å‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°fcnï¼Œè¿”å›å€¼æ˜¯å†…éƒ¨å®ç°çš„wrapperå‡½æ•°ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;æ¯”è¾ƒé‡è¦çš„ä¸€æ¡è¯­å¥&lt;strong&gt;print_info = log(print_info)&lt;/strong&gt;ï¼Œè¿™é‡Œé€šè¿‡å¯¹print_infoå˜é‡èµ‹å€¼æ”¹å˜å®ƒåŸæ¥æŒ‡å‘çš„ç±»å‹ï¼Œèµ·åˆ°äº†å¯¹print_infoå‡½æ•°èµ‹äºˆäº†æ–°åŠŸèƒ½ã€‚æ‰§è¡Œè¿™å¥è¯­å¥ä¹‹åprint_infoå˜é‡ä¸å†è¡¨ç¤ºå‰é¢å®šä¹‰çš„print_infoå‡½æ•°ï¼Œ&lt;span&gt;è€Œæ˜¯è¡¨ç¤ºlogå‡½æ•°å†…å®ç°çš„&lt;span&gt;wrapperå‡½æ•°ï¼Œ&lt;/span&gt;&lt;/span&gt;ä½†åŸæ¥å®šä¹‰çš„print_infoå‡½æ•°ä»ç„¶å­˜åœ¨ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;æœ€ç»ˆè°ƒç”¨çš„print_infoå‡½æ•°ï¼Œå…¶å®è°ƒç”¨çš„æ˜¯logä¸­çš„&lt;span&gt;&lt;span&gt;wrapperå‡½æ•°&lt;/span&gt;&lt;/span&gt;ã€‚ç”±äºâ€œé—­åŒ…â€ç‰¹æ€§ï¼Œè™½ç„¶wrapperå‡½æ•°å·²ç»ç¦»å¼€äº†åˆ›é€ å®ƒçš„ç¯å¢ƒlogå‡½æ•°ï¼Œä½†å®ƒä»ç„¶å¯ä»¥ä½¿ç”¨logå‡½æ•°ä¸­çš„è‡ªç”±å˜é‡ã€‚&lt;/span&gt;&lt;span&gt;&lt;span&gt;wrapperå‡½æ•°ä¸­ï¼Œæ‰“å°äº†ä¼ å…¥çš„é”™è¯¯è¡Œå·ï¼Œå¹¶è°ƒç”¨äº†ä¼ å…¥çš„åŸå®šä¹‰çš„print_infoå‡½æ•°ï¼Œè¿™æ ·ä¾¿åšåˆ°äº†å¯¹å®šä¹‰çš„print_infoå‡½æ•°å†…å®¹åšä¿®æ”¹ï¼Œè°ƒç”¨print_infoå¢åŠ äº†é¢å¤–åŠŸèƒ½ã€‚&lt;br/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;è¿è¡Œç»“æœ&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;33&quot;&gt;
&lt;pre&gt;
The Error Occurred Line Number: 19 # æ‰“å°å‡ºæ–°å¢çš„å¯¹åº”è¡Œå·ä¿¡æ¯ï¼Œåœ¨19è¡Œè¢«è°ƒç”¨ï¼Œæ‰€ä»¥ä¼ å…¥è¡Œå·æ˜¯19&lt;span&gt;
Hello World #åŸprint_infoå‡½æ•°æ‰§è¡Œå†…å®¹&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;ä¸Šé¢çš„logå‡½æ•°å…¶å®å·²ç»æ˜¯ä¸€ä¸ªè£…é¥°å™¨äº†ï¼Œå®ƒå¯¹åŸå‡½æ•°åšäº†åŒ…è£…å¹¶è¿”å›äº†å¦å¤–ä¸€ä¸ªå‡½æ•°ï¼Œé¢å¤–æ·»åŠ äº†ä¸€äº›åŠŸèƒ½ã€‚å› ä¸ºè¿™æ ·å†™å®åœ¨ä¸å¤ªä¼˜é›…ï¼Œæ–°ç‰ˆæœ¬Pythonä¸­æ”¯æŒäº†@è¯­æ³•ç³–ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä½¿ç”¨èµ·æ¥ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;ä¸‹é¢ä»£ç ç­‰åŒäºä¸Šé¢çš„å†™æ³•ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;import&lt;/span&gt;&lt;span&gt; sys

&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; log(fcn):
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; wrapper(*argc, **&lt;span&gt;kw):
        &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;New Operations Are Added Here&lt;/span&gt;
        &lt;span&gt;if&lt;/span&gt; len(argc) != 1&lt;span&gt;:
            &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Illegal parameter&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; -1
        &lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The Error Occurred Line Number: %d&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %&lt;span&gt;(argc[0]))
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; fcn()
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; wrapper    
    
@log                      
&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; print_info():
    &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Hello World&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;print_info = log(print_info)&lt;/span&gt;

&lt;span&gt;def&lt;/span&gt;&lt;span&gt; main():
    print_info(sys._getframe().f_lineno)

&lt;/span&gt;&lt;span&gt;if&lt;/span&gt; &lt;span&gt;__name__&lt;/span&gt; == &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;__main__&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;:
    main()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;æŠŠ@logæ”¾åˆ°print_infoå‡½æ•°å®šä¹‰å¤„ï¼Œç›¸å½“äºæ‰§è¡Œäº†print_info = log(print_info)è¯­å¥&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;3ã€å®Œæ•´è£…é¥°å™¨çš„å†™æ³•&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;å‰é¢å†™çš„è£…é¥°å™¨éƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯è¿˜å·®æœ€åä¸€æ­¥ï¼Œè™½ç„¶è£…é¥°å™¨è£…é¥°è¿‡çš„å‡½æ•°çœ‹ä¸Šå»åå­—æ²¡å˜ï¼Œå…¶å®å·²ç»å˜äº†ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt;def&lt;/span&gt;&lt;span&gt; log(fcn):
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; wrapper(*args, **&lt;span&gt;kw):
        &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(fcn.&lt;span&gt;__name__&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; fcn()
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; wrapper  

@log
&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; print_info():
    &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Hello World&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
    
&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; main():
    print_info()
    &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(print_info.&lt;span&gt;__name__&lt;/span&gt;&lt;span&gt;)
    
&lt;/span&gt;&lt;span&gt;if&lt;/span&gt; &lt;span&gt;__name__&lt;/span&gt; == &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;__main__&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;:
    main()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;è¿è¡Œç»“æœ&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
print_info&lt;br/&gt;Hello World&lt;br/&gt;wrapper&lt;br/&gt;&amp;gt;&amp;gt;&amp;gt; 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;ä¸Šé¢print_infoå‡½æ•°ç»logè£…é¥°å™¨è£…é¥°åï¼Œå®ƒçš„__name__å±æ€§å·²ç»ä»åŸæ¥çš„â€˜print_infoâ€™å˜æˆäº†â€˜wrapperâ€™&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;å› ä¸ºè¿”å›çš„é‚£ä¸ªwrapper()å‡½æ•°åå­—å°±æ˜¯'wrapper'ï¼Œæ‰€ä»¥ï¼Œéœ€è¦æŠŠåŸå§‹å‡½æ•°çš„__name__ç­‰å±æ€§å¤åˆ¶åˆ°wrapper()å‡½æ•°ä¸­ï¼Œå¦åˆ™ï¼Œæœ‰äº›ä¾èµ–å‡½æ•°ç­¾åçš„ä»£ç æ‰§è¡Œå°±ä¼šå‡ºé”™ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;ä¸éœ€è¦åœ¨å†…éƒ¨æ·»åŠ wrapper.__name__=fcn.__name__è¿™æ ·çš„ä»£ç ï¼ŒPythonå†…ç½®çš„functools.wrapså°±æ˜¯å¹²è¿™ä¸ªäº‹çš„ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªå®Œæ•´çš„decoratorçš„å†™æ³•å¦‚ä¸‹ï¼š&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt;import&lt;/span&gt;&lt;span&gt; functools

&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; log(fcn):
    @functools.wraps(fcn)
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; wrapper(*args, **&lt;span&gt;kw):
        &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(fcn.&lt;span&gt;__name__&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; fcn()
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; wrapper
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;&lt;span&gt;&lt;span&gt;&lt;strong&gt;&lt;span&gt;4ã€é«˜é˜¶ä¸€ç‚¹è£…é¥°å™¨&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;4.1 å¸¦å‚æ•°è£…é¥°å™¨&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;å¦‚æœè£…é¥°å™¨å‡½æ•°æœ¬èº«è¦ä¼ å…¥å‚æ•°ï¼Œé‚£ä¹ˆè£…é¥°å™¨å°±ä¼šæ˜¯è¿™æ ·çš„&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
&lt;span&gt;import&lt;/span&gt;&lt;span&gt; sys

&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; log(text):
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; wrapper(fcn)
        &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; inner_wrapper(*argc, **&lt;span&gt;kw):
            &lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;New Operations Are Added Here&lt;/span&gt;
            &lt;span&gt;print&lt;/span&gt;&lt;span&gt;(text)
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; len(argc) != 1&lt;span&gt;:
                &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Illegal parameter&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
                &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; -1
            &lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;The Error Occurred Line Number: %d&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt; %&lt;span&gt;(argc[0]))
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; fcn()
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; inner_wrapper
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; wrapper    
    
@log('With Parameter Decorator')
&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; print_info():
    &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Hello World&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;)

&lt;/span&gt;&lt;span&gt;#&lt;/span&gt;&lt;span&gt;print_info = log(print_info)&lt;/span&gt;

&lt;span&gt;def&lt;/span&gt;&lt;span&gt; main():
    print_info(sys._getframe().f_lineno)

&lt;/span&gt;&lt;span&gt;if&lt;/span&gt; &lt;span&gt;__name__&lt;/span&gt; == &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;__main__&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;:
    main()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;å¯¹äºå¸¦å‚æ•°è£…é¥°å™¨ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œå½“å¸¦å‚æ•°çš„è£…é¥°å™¨è¢«è£…é¥°åœ¨æŸä¸ªå‡½æ•°ä¸Šæ—¶ï¼Œæ¯”å¦‚ä¸Šè¿°ä»£ç @log('With Parameter Decorator')&lt;/span&gt;&lt;span&gt;&lt;code&gt;ï¼Œ&lt;/code&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt;log('With Parameter Decorator')&lt;/span&gt;å…¶å®æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¼šé©¬ä¸Šè¢«æ‰§è¡Œï¼Œå®ƒè¿”å›çš„ç»“æœä»»æ˜¯ä¸€ä¸ªè£…é¥°å™¨wrapperã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;ä¹Ÿå°±æ˜¯ä¸‹é¢ä»£ç å…¶å®ç­‰ä»·äºprint_info = wrapper(print_info)&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
@log(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;With Parameter Decorator&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; print_info():
    &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;Hello World&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span&gt;&lt;strong&gt;4.2 è£…é¥°å™¨è£…é¥°ç±»æ–¹æ³•&lt;/strong&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;å‰é¢æˆ‘ä»¬ä»‹ç»çš„éƒ½æ˜¯ç”¨è£…é¥°å™¨è£…é¥°å‡½æ•°ï¼Œè£…é¥°å™¨åŒæ—¶ä¹Ÿå¯ä»¥è£…é¥°ç±»æ–¹æ³•ï¼Œä¸‹é¢æ¥çœ‹å¦‚ä½•ç”¨è£…é¥°å™¨è£…é¥°ç±»çš„æ–¹æ³•&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;æˆ‘ä»¬å®šä¹‰äº†åä¸ºsimple_testçš„ç±»ï¼Œè¿™ä¸ªç±»æœ‰ä¸€ä¸ªdataå±æ€§å’Œget_dataæ–¹æ³•ã€‚ç±»é‡Œçš„å®ç°éå¸¸ç®€å•ï¼Œget_dataæ–¹æ³•åªè¿”å›dataå±æ€§å€¼ï¼Œå¹¶ä¸è¿›è¡Œå…¶ä»–æ“ä½œã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€å®šä¹‰äº†ä¸€ä¸ªè£…é¥°å™¨è£…é¥°ç±»çš„get_dataæ–¹æ³•ï¼Œè£…é¥°å™¨ä¸­æ ¹æ®æ•°æ®è·å–æºæ¥ç¼–å†™å…¶ä¸­åŠŸèƒ½ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œé€‰æ‹©ä»ä¸²å£ç»ˆç«¯è·å–æ•°æ®ï¼Œç›´æ¥ä¿®æ”¹è£…é¥°å™¨çš„å†…å®¹è®©å…¶è·å–ç»ˆç«¯è¾“å…¥æ•°æ®ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;è¿™æ ·åœ¨è®¾è®¡ä¸€ä¸ªç±»æ—¶ï¼Œåšåˆ°äº†å°†ç±»ä¸­ç¨³å®šçš„éƒ¨åˆ†å’Œç»å¸¸è¦ä¿®æ”¹çš„éƒ¨åˆ†ç‹¬ç«‹å¼€ã€‚ç±»è®¾è®¡å®Œæˆåï¼Œæˆ‘ä»¬ä¸éœ€è¦æ›´æ”¹ç±»çš„æºç ï¼Œåœ¨ä½¿ç”¨æ—¶åªéœ€è¦æ ¹æ®éœ€æ±‚ä¿®æ”¹ç±»æ–¹æ³•çš„è£…é¥°å™¨å°±èƒ½å®ç°æˆ‘ä»¬çš„éœ€æ±‚ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
&lt;span&gt;def&lt;/span&gt;&lt;span&gt; serial_data(fcn):
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; wrapper(self, *args, **&lt;span&gt;kw):
        str &lt;/span&gt;= input(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Please enter an integer: &lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
        &lt;/span&gt;&lt;span&gt;try&lt;/span&gt;&lt;span&gt;:
            tmp &lt;/span&gt;=&lt;span&gt; int(str)
        &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;&lt;span&gt; ValueError:
            &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;Invalid Value&lt;/span&gt;&lt;span&gt;'&lt;/span&gt;&lt;span&gt;)
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; None
        self.data &lt;/span&gt;=&lt;span&gt; tmp
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; fcn(self)
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; wrapper

&lt;/span&gt;&lt;span&gt;class&lt;/span&gt;&lt;span&gt; simple_test(object):
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt; &lt;span&gt;__init__&lt;/span&gt;(self, _val =&lt;span&gt; 0):
        self.data &lt;/span&gt;=&lt;span&gt; _val
    
    @serial_data
    &lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; get_data(self):
        &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; self.data
    
&lt;/span&gt;&lt;span&gt;def&lt;/span&gt;&lt;span&gt; main():
    obj &lt;/span&gt;=&lt;span&gt; simple_test()
    val &lt;/span&gt;=&lt;span&gt; obj.get_data()
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; val &lt;span&gt;is&lt;/span&gt; &lt;span&gt;not&lt;/span&gt;&lt;span&gt; None:
        &lt;/span&gt;&lt;span&gt;print&lt;/span&gt;(&lt;span&gt;'&lt;/span&gt;&lt;span&gt;get Data: %d&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; %&lt;span&gt;(val))
    
&lt;/span&gt;&lt;span&gt;if&lt;/span&gt; &lt;span&gt;__name__&lt;/span&gt; == &lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;__main__&lt;/span&gt;&lt;span&gt;&quot;&lt;/span&gt;&lt;span&gt;:
    main()&lt;/span&gt; 
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;span&gt;è¿è¡Œç»“æœï¼š&lt;/span&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;32&quot;&gt;
&lt;pre&gt;
Please enter an integer: 100&lt;span&gt;
get Data: &lt;/span&gt;100
&amp;gt;&amp;gt;&amp;gt; 
&lt;/pre&gt;&lt;/div&gt;
</description>
<pubDate>Thu, 24 Dec 2020 15:15:00 +0000</pubDate>
<dc:creator>hcs_learn</dc:creator>
<og:description>1ã€ä»€ä¹ˆæ˜¯è£…é¥°å™¨ åœ¨ä»‹ç»è£…é¥°å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šä½¿ç”¨Pythonè¯­è¨€è¿›è¡Œç¨‹åºè®¾è®¡æ—¶ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ‰©å±•ä¸€ä¸ªå‡½æ•°çš„åŠŸèƒ½ï¼Œä¸€èˆ¬ä¼šæ€ä¹ˆåšå‘¢ï¼Ÿ æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ªåä¸ºprint_infoå‡½æ•°ï¼Œå½“å‰è¯¥å‡½æ•°å†…åªåš</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/053179hu/p/14183348.html</dc:identifier>
</item>
<item>
<title>å¦‚ä½•åšå¥½Code Review - éº¦æœºé•¿</title>
<link>http://www.cnblogs.com/Autumoon/p/14186629.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/Autumoon/p/14186629.html</guid>
<description>&lt;div id=&quot;cnblogs_post_description&quot; readability=&quot;32&quot;&gt;&lt;img src=&quot;https://captnotes.com/wp-content/uploads/2020/12/featured_effective_code_review.jpg&quot; class=&quot;desc_img&quot;/&gt;å¾ˆå¤šå›¢é˜Ÿéƒ½ä¼šåšï¼Œæ•ˆæœå¦‚ä½•ä¸å¥½è¯´ã€‚&lt;/div&gt;&lt;div id=&quot;cnblogs_post_body&quot; readability=&quot;131.11377506539&quot;&gt;
&lt;p&gt;Code Reviewï¼ˆä»£ç å®¡æŸ¥ï¼‰å¾ˆå¤šå›¢é˜Ÿéƒ½ä¼šåšï¼Œæ•ˆæœå¦‚ä½•ä¸å¥½è¯´ã€‚å¦‚æœä½ èƒ½è½»æ˜“åœ°ä»ä¸€å †å‡ºè‡ªæ­£ç»å›¢é˜Ÿä¹‹æ‰‹çš„ä»£ç é‡Œæ‰¾å‡ºå‡ ä¸ªä½çº§é”™è¯¯ï¼Œå¾€å¾€æ„å‘³ç€å›¢é˜Ÿç®¡ç†è€…é•¿æœŸå¿½è§†äº†Code Reviewçš„é‡è¦æ€§ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®ç»éªŒï¼ŒåŒ†åŒ†åº”ä»˜åŠŸèƒ½å®ç°å’Œæ¼æ´ä¿®å¤è€Œå°†Code Reviewæµäºå½¢å¼çš„å›¢é˜Ÿä¸åœ¨å°‘æ•°ã€‚å½“ç„¶ï¼Œæ¯ä¸ªäººéƒ½èƒ½åˆ—ä¸¾ä¸€å¤§å †â€œå®¢è§‚åŸå› â€ï¼Œè€Œä¸”æ¯ä¸€æ¡ç†ç”±å¬èµ·æ¥éƒ½æ˜¯é‚£ä¹ˆçš„æœ‰è¯´æœåŠ›ã€‚ç„¶è€Œï¼Œæ²¡åšå¥½å°±æ˜¯æ²¡åšå¥½ï¼Œç‹¡è¾©åªä¼šè®©åœºé¢å˜å¾—æ›´åŠ æ¶å¿ƒã€‚&lt;/p&gt;

&lt;blockquote readability=&quot;5.568345323741&quot;&gt;
&lt;p&gt;A code review is the process of examining written code with the purpose of highlighting mistakes in order to learn from them.&lt;/p&gt;
&lt;p&gt;-- &lt;a href=&quot;https://www.techopedia.com/definition/14299/code-review&quot; target=&quot;_blank&quot;&gt;Techopedia&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æ˜¯ç›®å‰æˆ‘è§è¿‡å¯¹Code Reviewæœ€è¨€ç®€æ„èµ…çš„å®šä¹‰ã€‚å…¶å®æ€ä¹ˆæè¿°å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯æˆ‘ä»¬è¦è¾¾åˆ°ä»€ä¹ˆæ ·çš„ç›®çš„ã€‚&lt;/p&gt;

&lt;p&gt;æé«˜ä»£ç è´¨é‡æ˜¯ç¨‹åºå‘˜ç«¯ç¨³é¥­ç¢—ã€å°‘æŒ¨ç‚¹å„¿éª‚çš„æœ€æœ‰æ•ˆé€”å¾„ã€‚å…¶å®Code Reviewå°±æ˜¯å¾ˆå¥½çš„ç›¸äº’åˆ‡ç£‹ã€å…±åŒè¿›æ­¥çš„æœºä¼šï¼Œæ•ˆæœè¦æ¯”ç‹¬è‡ªåŸ‹å¤´å¹²å•ƒã€Š21å¤©ç²¾é€šÃ—Ã—Ã—ã€‹ä¹‹ç±»çš„â€œå®å…¸â€å¥½å¾—å¤šã€‚å½“ç„¶ï¼Œå‰ææ˜¯ç›®çš„æ˜ç¡®ã€æ€åº¦ç«¯æ­£ã€‚&lt;/p&gt;
&lt;p&gt;Code Reviewä¸»è¦ç›®çš„å°±ä¸¤ä¸ªï¼š&lt;/p&gt;
&lt;h2 id=&quot;æŸ¥é”™&quot;&gt;æŸ¥é”™&lt;/h2&gt;
&lt;p&gt;Code Reviewä¸æ˜¯ç”¨æ¥æŸ¥æ‰¾ä½çº§é”™è¯¯çš„ï¼Œè€Œæ˜¯å‚ä¸è€…ä»¥æäº¤è€…ä»¥å¤–çš„è§†è§’é˜…è¯»å’Œå®¡è§†ä»£ç ï¼Œå°½å¯èƒ½åœ°æ‰¾åˆ°é€»è¾‘ä¸Šçš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å­¦ä¹ &quot;&gt;å­¦ä¹ &lt;/h2&gt;
&lt;p&gt;ä¸å…¶è¯´Code Reviewé‡åœ¨æ‰¾åˆ°é—®é¢˜ï¼Œä¸å¦‚è¯´å…¶æ ¸å¿ƒç›®çš„åœ¨äºè¥é€ å›¢é˜Ÿå­¦ä¹ æ°›å›´ã€æå‡æˆå‘˜å¯¹è½¯ä»¶å“è´¨çš„è¿½æ±‚ã€‚æˆ‘ç»å†è¿‡ä¸å°‘å›¢é˜Ÿï¼Œä¸ºäº†è¥é€ å­¦ä¹ æ°›å›´ï¼Œç”Ÿæ‹‰ç¡¬æ‹½åœ°è¦æ±‚æˆå‘˜å®šæœŸä¸¾è¡ŒæŠ€æœ¯åˆ†äº«ä¼šï¼Œç»“æœå¾€å¾€æ•·è¡äº†äº‹ã€ä¸äº†äº†ä¹‹ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢æ ¹æ®Code Reviewä¸­æ¶‰åŠçš„ä¸»è¦äººç‰©è§’è‰²æ¥è®²è®²æˆ‘æ¨èçš„æ–¹å¼ã€‚æ³¨æ„ï¼Œè¿™ä¸æ˜¯æ ‡å‡†ç­”æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“åˆ’åˆ†è§’è‰²è´£ä»»ä¹‹å‰ï¼Œæˆ‘å»ºè®®æ¯ä¸ªæŠ€æœ¯å›¢é˜Ÿéƒ½è¦æ‰¾åˆ°å¹¶ä¸¥æ ¼æ‰§è¡Œé€‚åˆæœ¬å›¢é˜ŸæŠ€æœ¯æ ˆçš„ç¼–ç è§„èŒƒï¼Œç”šè‡³åŒ…æ‹¬IDEé…ç½®å’Œå¼€å‘ç¯å¢ƒå‚æ•°è®¾å®šç­‰ï¼Œä»¥ç¡®ä¿æ¯ä½æˆå‘˜éƒ½â€œè¯´ç€åŒæ ·çš„è¯­è¨€â€ï¼Œå¹¶å‡å°‘åœ¨å‘½åè§„åˆ™ã€æ’ç‰ˆæ ·å¼ç­‰æ–¹é¢çš„äº‰è®ºï¼Œå°†æ—¶é—´å’Œç²¾åŠ›èšç„¦åˆ°å¯¹åŠŸèƒ½å®ç°å’Œä¸šåŠ¡ä¼˜åŒ–è¿™äº›å®è´¨æ€§çš„é—®é¢˜ä¸Šæ¥ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å¼€å‘å°ç»„æŠ€æœ¯è´Ÿè´£äºº&quot;&gt;å¼€å‘å°ç»„æŠ€æœ¯è´Ÿè´£äºº&lt;/h2&gt;
&lt;p&gt;æ¯ä¸€ä½å¼€å‘å°ç»„æŠ€æœ¯è´Ÿè´£äººéƒ½åº”è¯¥ç§¯æå®æ–½å¹¶ç»´æŠ¤Code Reviewæœºåˆ¶ï¼Œè¦æ±‚æ¯ä½æˆå‘˜åœ¨æäº¤ä»£ç çš„æ—¶å€™ï¼Œéƒ½å¿…é¡»ç»è¿‡äº¤å‰Reviewï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€æ¬¡ä»£ç æäº¤åˆ°ä¸»å¹²æ—¶ï¼Œéƒ½å¿…é¡»ç»è¿‡å¦ä¸€ä½ç›¸åŒæŠ€æœ¯é¢†åŸŸåŒäº‹çš„Reviewï¼Œå¦åˆ™å°†è¢«è§†ä¸ºæäº¤äº†ä¸å­˜åœ¨ç¼–è¯‘æ—¶é”™è¯¯çš„ä»£ç åŒç­‰çš„ä¸¥é‡è¿‡å¤±ã€‚&lt;/p&gt;
&lt;p&gt;æ¯æ¬¡ä»£ç æäº¤çš„äº¤å‰Reviewï¼Œå¼€å‘å°ç»„æŠ€æœ¯è´Ÿè´£äººåº”å½“éšæœºæŠ½å–åŒ…æ‹¬è‡ªå·±åœ¨å†…çš„ä»»ä½•ä¸€ä½æŠ€æœ¯äººå‘˜è¿›è¡Œï¼Œä¸è¦è®©æäº¤è€…èƒ½å¤Ÿå¾ˆè½»æ˜“åœ°é¢„çŸ¥å°†ä¼šæ˜¯è°æ¥åšè‡ªå·±è¿™ä¸€æ¬¡çš„Reviewerï¼Œå¦åˆ™å¾ˆå®¹æ˜“å˜æˆå½¢å¼ä¸»ä¹‰ã€‚&lt;/p&gt;
&lt;p&gt;å¹¶ä¸”ï¼Œå¯¹äºFeatureå®ç°çš„Code Reviewï¼Œå¼€å‘å°ç»„æŠ€æœ¯è´Ÿè´£äººåº”è¯¥è¾ƒä¸ºé¢‘ç¹ä½†ä¸å®šæœŸåœ°è¿›è¡Œå…¬å¼€Reviewã€‚ç»„ç»‡ä¸€åœºä¼šè®®ï¼Œå¬é›†æ•´ä¸ªå¼€å‘å°ç»„çš„æˆå‘˜ä¸€èµ·å¯¹æ­¤æ¬¡æäº¤çš„ä»£ç è¿›è¡Œå®¡æŸ¥ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æäº¤è€…&quot;&gt;æäº¤è€…&lt;/h2&gt;
&lt;p&gt;ä¸è®ºCode Reviewæ˜¯ç§ä¸‹çš„è¿˜æ˜¯å…¬å¼€çš„ï¼Œæäº¤è€…éƒ½ä¸èƒ½æäº¤ä»»ä½•å­˜åœ¨ç¼–è¯‘æ—¶é”™è¯¯çš„ä»£ç ï¼Œè¿™æ˜¯éå¸¸ä½çº§çš„é”™è¯¯ã€‚é¦–å…ˆåœ¨æäº¤ä»£ç ä¹‹å‰å†æ¬¡è¿›è¡Œç¼–è¯‘ï¼Œæ˜¯ç¡®ä¿å³å°†æäº¤çš„ä»£ç ä¸å­˜åœ¨ç¼–è¯‘æ—¶é”™è¯¯çš„å¿…è¦æ­¥éª¤ã€‚å…¶æ¬¡ï¼Œä¹Ÿæ˜¯å¾ˆå¤šäººå®¹æ˜“ç–å¿½çš„ï¼Œç¡®ä¿æœ¬æ¬¡æ–°å¢çš„æœ¬åœ°èµ„æºæ–‡ä»¶éƒ½è¢«åŠ å…¥äº†æºä»£ç ç®¡ç†ï¼Œå¦åˆ™å³ä½¿æœ¬åœ°èƒ½ç¼–è¯‘é€šè¿‡ï¼Œåˆ«äººæ‹¿åˆ°ä½ çš„ä»£ç ä¹Ÿä¾ç„¶å­˜åœ¨ç¼–è¯‘æ—¶é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;æäº¤ä»£ç ä¹‹å‰ï¼Œè‡ªå·±å…ˆ&lt;code&gt;diff&lt;/code&gt;ä¸€ä¸‹ï¼Œé¦–å…ˆç¡®ä¿ä»£ç ä¸å­˜åœ¨å‰é¢æåˆ°çš„è¯¸å¦‚å‘½åã€æ ¼å¼ç­‰æ–¹é¢çš„ä½çº§é”™è¯¯ï¼›ç„¶åç¡®å®šè‡ªå·±å¯¹æ¯ä¸€å¤„ä»£ç å˜åŠ¨çš„ç†è§£éƒ½éå¸¸æ˜ç¡®ï¼Œå¹¶ä¸”è‡ªå·±å·²ç»æ‰¾ä¸å‡ºæ”¹è¿›æ–¹æ¡ˆï¼›æœ€åç¡®ä¿æ‰€æœ‰Hard Codeéƒ½å·²ç»è¢«ç§»é™¤ï¼Œè¿™ä¸€ç‚¹å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„&lt;a href=&quot;https://captnotes.com/remove_before_flight&quot; target=&quot;_blank&quot;&gt;ã€Šæ²¡ä»€ä¹ˆæŠ€æœ¯å«é‡çš„Remove Before Flightã€‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æäº¤è€…åœ¨ä»£ç è¢«Reviewä¹‹å‰ï¼Œè¿˜åº”è¯¥è°ƒæ•´å¥½å¿ƒæ€ï¼ŒæŠŠåˆ«äººçš„è¯¢é—®ã€è´¨ç–‘ã€å»ºè®®ã€æ‰¹è¯„ï¼Œé€šé€šè§†ä½œå¯èƒ½çš„æå‡æœºä¼šï¼Œè€Œä¸è¦ä¸»è§‚ä¸Šè®¤å®šè‡ªå·±ç»™å‡ºçš„å°±æ˜¯æœ€ä¼˜è§£ï¼Œè€Œåˆ«äººéƒ½æ˜¯â€œä¸æ˜çœŸç›¸çš„å›´è§‚ç¾¤ä¼—â€ã€‚ä¹Ÿè®¸åˆ«äººåœ¨ä¸äº†è§£èƒŒæ™¯ä¿¡æ¯æˆ–ä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹ï¼Œç»™å‡ºäº†é”™è¯¯çš„å»ºè®®ï¼Œæäº¤è€…ä¹Ÿåº”å½“å°†æ­¤ä½œä¸ºé”»ç‚¼æ€ç»´å’Œå£æ‰çš„å‹å¥½è¾©è®ºï¼Œè€Œä¸æ˜¯ç»ç’ƒå¿ƒå—åˆ°äº†ä¾µçŠ¯ä¼¼çš„ç›´æ¥æ€¼å›å»ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‚ä¸è€…&quot;&gt;å‚ä¸è€…&lt;/h2&gt;
&lt;p&gt;å‚ä¸è€…åº”è¯¥å¯¹ç¼–ç è§„èŒƒäº†ç„¶äºå¿ƒï¼Œå¯¹äºä»£ç ä¸­æ¯ä¸€å¤„ä¸ç¬¦åˆå›¢é˜Ÿç°è¡Œç¼–ç è§„èŒƒçš„åœ°æ–¹éƒ½è¦ä¸åŒå…¶çƒ¦åœ°æ ‡æ³¨å‡ºæ¥ã€‚å¾ˆå¤šäººè®¤ä¸ºè¿™ä¸ªæ— æ‰€è°“ï¼Œåæ­£æœºå™¨æœ€åè¯»çš„éƒ½æ˜¯0å’Œ1â€”â€”å¯¹ï¼Œæœºå™¨åªè®¤è¯†0å’Œ1ï¼Œæ‰€ä»¥æºä»£ç å…¶å®æ˜¯å†™ç»™äººçœ‹çš„ã€‚ä¸ç®¡ä»£ç ç”±å¤šå°‘äººå†™å°±ï¼Œæœ€ç»ˆçœ‹ä¸Šå»å¦‚åŒå‡ºè‡ªåŒä¸€äººä¹‹æ‰‹ï¼Œè¿™ç§ä»£ç çš„é˜…è¯»ä½“éªŒå’Œæ•ˆç‡ç»å¯¹è¦æ¯”é‚£ç§ç™¾å®¶äº‰é¸£å¼çš„å¥½å¾—å¤šã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œå‚ä¸è€…åº”å½“è€ƒå¯Ÿæäº¤è€…å¯¹æŠ½è±¡çš„ç†è§£å’Œå®è·µï¼Œæ˜¯å¦å‡†ç¡®ä»¥åŠæ˜¯å¦è¿‡æµ…æˆ–è¿‡æ·±ã€‚æŠ½è±¡è¿‡æµ…ï¼Œçœ‹ä¸Šå»å¾€å¾€æ˜¯å¤§æ‚çƒ©ï¼›æŠ½è±¡è¿‡æ·±ï¼Œè¯»èµ·æ¥æ˜¾å¾—åƒåŠ›ã€‚å¯¹äºè¿™ä¸¤ç§æƒ…å†µï¼Œå‚ä¸è€…éƒ½å¯ä»¥æå‡ºè‡ªå·±çš„çœ‹æ³•å’Œå»ºè®®ï¼Œä¸è¦æŠ±ç€â€œä½ è¿™ä¸è¡Œï¼Œå¬æˆ‘çš„â€çš„æ€åº¦ï¼Œå¦åˆ™å¾ˆå®¹æ˜“å½¢æˆå¯¹ç«‹çš„æƒ…ç»ªï¼Œè¿›è€Œå½±å“å›¢é˜Ÿå¯¹Code Reviewçš„ç§¯ææ€§ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºä»£ç å®ç°æ˜¯å¦å­˜åœ¨æ”¹è¿›ç©ºé—´è¿™ä¸ªé—®é¢˜ï¼Œå‚ä¸è€…åº”è¯¥åœ¨é˜…è¯»æ–°ä»£ç æ—¶ï¼Œå°½å¯èƒ½å…¨é¢åœ°å»ç†è§£é—®é¢˜åŸŸã€äº†è§£éœ€æ±‚çš„å…·ä½“ç»†èŠ‚ï¼Œè€Œä¸æ˜¯æƒ³å½“ç„¶åœ°æŠ›å‡ºè´¨ç–‘å’Œæ„è§ï¼Œç»™äººä»¥æµ®èºçš„å°è±¡ã€‚å¦‚æœå‚ä¸è€…ç¡®å®šè‡ªå·±æ¸…æ¥šåœ°ç†è§£äº†éœ€æ±‚å’Œé—®é¢˜ï¼Œä¾ç„¶å¯¹å½“å‰çš„ä»£ç å®ç°æœ‰æ”¹è¿›å»ºè®®ï¼Œé‚£ä¹ˆå°±å¤§èƒ†åœ°æå‡ºæ¥ï¼Œè¿™å°±æ˜¯Code Reviewçš„æ ¸å¿ƒç›®çš„ï¼&lt;/p&gt;
&lt;/div&gt;</description>
<pubDate>Thu, 24 Dec 2020 14:05:00 +0000</pubDate>
<dc:creator>éº¦æœºé•¿</dc:creator>
<og:description>Code Reviewï¼ˆä»£ç å®¡æŸ¥ï¼‰å¾ˆå¤šå›¢é˜Ÿéƒ½ä¼šåšï¼Œæ•ˆæœå¦‚ä½•ä¸å¥½è¯´ã€‚å¦‚æœä½ èƒ½è½»æ˜“åœ°ä»ä¸€å †å‡ºè‡ªæ­£ç»å›¢é˜Ÿä¹‹æ‰‹çš„ä»£ç é‡Œæ‰¾å‡ºå‡ ä¸ªä½çº§é”™è¯¯ï¼Œå¾€å¾€æ„å‘³ç€å›¢é˜Ÿç®¡ç†è€…é•¿æœŸå¿½è§†äº†Code Reviewçš„é‡è¦æ€§ã€‚ æ ¹æ®ç»éªŒ</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/Autumoon/p/14186629.html</dc:identifier>
</item>
</channel>
</rss>