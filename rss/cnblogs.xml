<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=feed.cnblogs.com%2Fblog%2Fsitehome%2Frss&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://feed.cnblogs.com/blog/sitehome/rss" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dfeed.cnblogs.com%252Fblog%252Fsitehome%252Frss%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>åšå®¢å›­_é¦–é¡µ</title>
<link></link>
<description>ä»£ç æ”¹å˜ä¸–ç•Œ</description>
<item>
<title>äº†ä¸å¾—ï¼Œæˆ‘å¯èƒ½å‘ç°äº†Jar åŒ…å†²çªçš„ç§˜å¯† - ä¸‰å›½æ¢¦å›</title>
<link>http://www.cnblogs.com/grey-wolf/p/11028975.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/grey-wolf/p/11028975.html</guid>
<description>&lt;p&gt;è¿™ç¯‡æ˜¯ç±»åŠ è½½å™¨ç›¸å…³çš„ç¬¬ä¸‰ç¯‡ï¼š&lt;/p&gt;
&lt;p class=&quot;postTitle&quot;&gt;&lt;a id=&quot;cb_post_title_url&quot; class=&quot;postTitle2&quot; href=&quot;https://www.cnblogs.com/grey-wolf/p/10992671.html&quot;&gt;å®æˆ˜åˆ†æTomcatçš„ç±»åŠ è½½å™¨ç»“æ„ï¼ˆä½¿ç”¨Eclipse MATéªŒè¯ï¼‰&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;postTitle&quot;&gt;&lt;a id=&quot;cb_post_title_url&quot; class=&quot;postTitle2&quot; href=&quot;https://www.cnblogs.com/grey-wolf/p/11017253.html&quot;&gt;è¿˜æ˜¯Tomcatï¼Œå…³äºç±»åŠ è½½å™¨çš„è¶£å‘³å®éªŒ&lt;/a&gt;&lt;/p&gt;
&lt;p class=&quot;postTitle&quot;&gt;Â &lt;/p&gt;
&lt;p&gt;&lt;span&gt;æ˜¨å¤©ä¸‹åˆåˆšå†™äº†ç¯‡ ç±»åŠ è½½å™¨ç›¸å…³çš„ï¼Œæ™šä¸Šæƒ³ç€éªŒè¯ä¸ªé—®é¢˜ï¼šTomcat è·‘äº†å¤šä¸ªspring webé¡¹ç›®ï¼Œé‚£ä¹ˆorg.springframework.web.servlet.DispatcherServlet è¿™ç§ç±»æ˜¯æ€ä¹ˆä¸ªæƒ…å†µå‘¢ï¼Ÿå¤šä¸ªä¸åŒç±»åŠ è½½å™¨åŠ è½½çš„ï¼ŒåŒæ—¶å­˜åœ¨çš„åŒåç±»ï¼Ÿ&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;æˆ‘æ˜¯æ‰“ç®—åˆ©ç”¨é˜¿é‡Œå¼€æºçš„arthaså·¥å…·æ¥æŸ¥çœ‹çš„ï¼Œä½†æ˜¯è¿™ä¸ªå·¥å…·åªæ”¯æŒ linuxã€‚è¯´æ¥ä¹Ÿä¸æ€•è®©äººç¬‘è¯ï¼Œå…¬å¸çš„åç«¯æœåŠ¡ï¼Œå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒç”¨çš„windowsçš„ï¼Œä»¥åäº¤ä»˜ç»™å®¢æˆ·ä¸çŸ¥é“æ˜¯ç”¨å•¥ã€‚å…ˆä¸è¯´è¿™ä¸ªå§ï¼Œåæ­£æˆ‘ä»¬æ‰“çš„waråŒ…ï¼Œåœ¨windowsæœåŠ¡å™¨çš„tomcat ä¸Šæ²¡ä»€ä¹ˆé—®é¢˜ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;ä½†æ˜¯å½“æˆ‘æŠŠåŒæ ·çš„waråŒ…ä¸¢åˆ° linux ä¸Šæ—¶ï¼Œå‘ç°æŠ¥é”™äº†ï¼Œæ²¡å¯åŠ¨æˆåŠŸã€‚ã€‚ã€‚ã€‚hahhahã€‚ã€‚ã€‚å°´å°¬ã€‚ã€‚ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;é”™è¯¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
Caused by: &lt;span&gt;java.lang.NoSuchMethodError: javax.persistence.Table.indexes()&lt;/span&gt;[Ljavax/persistence/Index;
        at org.hibernate.cfg.annotations.EntityBinder.processComplementaryTableDefinitions(EntityBinder.java:936)
        at org.hibernate.cfg.AnnotationBinder.bindClass(AnnotationBinder.java:824)
        at org.hibernate.cfg.Configuration$MetadataSourceQueue.processAnnotatedClassesQueue(Configuration.java:3790)
        at org.hibernate.cfg.Configuration$MetadataSourceQueue.processMetadata(Configuration.java:3744)
        at org.hibernate.cfg.Configuration.secondPassCompile(Configuration.java:1410)
        at org.hibernate.cfg.Configuration.buildSessionFactory(Configuration.java:1844)
        at org.hibernate.cfg.Configuration.buildSessionFactory(Configuration.java:1928)
        at org.springframework.orm.hibernate4.LocalSessionFactoryBuilder.buildSessionFactory(LocalSessionFactoryBuilder.java:372)
        at org.springframework.orm.hibernate4.LocalSessionFactoryBean.buildSessionFactory(LocalSessionFactoryBean.java:454)
        at org.springframework.orm.hibernate4.LocalSessionFactoryBean.afterPropertiesSet(LocalSessionFactoryBean.java:439)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1687)
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1624)
        ... 38 common frames omitted
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¤§æ¦‚æ„æ€æ˜¯ï¼ŒÂ javax.persistence.Table çš„ indexesï¼ˆï¼‰æ–¹æ³•ä¸å­˜åœ¨ã€‚&lt;/p&gt;


&lt;p&gt;&lt;span&gt;é¦–å…ˆï¼Œæˆ‘åœ¨idea ä¸­æœäº†ä¸€æŠŠ â€œjavax.persistence.Tableâ€ï¼Œæœåˆ°çš„ç»“æœæ˜¯ï¼Œhibernate-jpa-2.1-api-1.0.0.Final.jar è¿™é‡Œé¢æœ‰ä¸ªåŒåçš„ç±»ï¼Œçœ‹äº†ä¸‹ï¼Œindexesï¼ˆï¼‰æ–¹æ³•æ˜¯å­˜åœ¨çš„ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;å¥½å§ï¼Œå­¦äº†ä¸€é˜µå­ç±»åŠ è½½å™¨äº†ï¼Œæˆ‘è§‰å¾—ï¼Œé¦–å…ˆè¿˜æ˜¯çœ‹çœ‹ï¼Œè¿™ä¸ªç±»æ˜¯ä»å“ªåŠ è½½çš„å§ã€‚ æ‡’å¾—å»åŠ Â -XX:+TraceClassLoadingå‚æ•°äº†ï¼Œç›´æ¥ ç”¨é˜¿é‡Œçš„ç¥å™¨ï¼Œgreysï¼ˆç”¨arthasä¹Ÿå¯ä»¥ï¼Œarthasæ˜¯åŸºäºgreysæçš„ï¼‰ æŒ‚è½½ä¸Šå»ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤æœç´¢äº†ä¸€ä¸‹ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;38&quot;&gt;
&lt;pre&gt;
ga?&amp;gt;&lt;span&gt;sc -df&lt;/span&gt;&lt;span&gt;&lt;span&gt; javax.persistence.Table   &lt;/span&gt; 
&lt;/span&gt;+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                         class-&lt;span&gt;info&lt;/span&gt; | javax.persistence.Table                                                          |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                        code-source | &lt;span&gt;/home/upload/apache-tomcat-8.5.28/webapps/CAD-WebService/WEB-INF/lib/persistence-api |
|                                                    | -1.0.jar&lt;/span&gt;                                                                         |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                               name | javax.persistence.Table                                                          |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                        isInterface | &lt;span&gt;true&lt;/span&gt;                                                                             |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                       isAnnotation | &lt;span&gt;true&lt;/span&gt;                                                                             |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                             isEnum | &lt;span&gt;false&lt;/span&gt;                                                                            |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                   isAnonymousClass | &lt;span&gt;false&lt;/span&gt;                                                                            |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                            isArray | &lt;span&gt;false&lt;/span&gt;                                                                            |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                       isLocalClass | &lt;span&gt;false&lt;/span&gt;                                                                            |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                      isMemberClass | &lt;span&gt;false&lt;/span&gt;                                                                            |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                        isPrimitive | &lt;span&gt;false&lt;/span&gt;                                                                            |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                        isSynthetic | &lt;span&gt;false&lt;/span&gt;                                                                            |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                        simple-name | Table                                                                            |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                           modifier | abstract,interface,public                                                        |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                         annotation | java.lang.annotation.Target,java.lang.annotation.Retention                       |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                         interfaces | java.lang.annotation.Annotation                                                  |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                        super-class |                                                                                  |
+----------------------------------------------------+----------------------------------------------------------------------------------+
|                                       class-loader | &lt;span&gt;ParallelWebappClassLoader&lt;/span&gt;                                                        |
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;span&gt;ä»ä¸Šå›¾çœ‹å‡ºæ¥ï¼Œjavax.persistence.Table è¿™ä¸ªç±»å•Šï¼Œæ˜¯ webappclassloader ä»Â webapps/CAD-WebService/WEB-INF/lib/persistence-api -1.0.jar åŠ è½½çš„ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;äºæ˜¯æˆ‘æ‰“å¼€ è¿™ä¸ªjaråŒ…çœ‹äº†ä¸‹ï¼Œé‡Œé¢ç¡®å®æœ‰javax.persistence.Table ï¼Œè¿™ä¸ªç±»ä¹Ÿç¡®å®æ²¡æœ‰indexesï¼ˆï¼‰æ–¹æ³•ï¼š&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/519126/201906/519126-20190615211614751-840498677.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;Â çœ‹æ¥é—®é¢˜å°±åœ¨è¿™é‡Œï¼Œæ˜¯åŠ è½½åˆ°äº†é”™è¯¯çš„jaråŒ…ã€‚ æ¥ä¸‹æ¥çš„å¤„ç†ï¼Œå°±è¦ç»“åˆä¸šåŠ¡ä»£ç ï¼Œçœ‹çœ‹åˆ°åº•æ˜¯ä»å“ªå¼•å…¥äº†è¿™ä¸ªåŒ…ï¼Œè¿™ä¸ªåŒ…æ˜¯å¦éœ€è¦ï¼Œä¸éœ€è¦çš„è¯ï¼Œç›´æ¥æ’é™¤æ‰å³å¯ã€‚ï¼ˆå¯ä½¿ç”¨idea æ’ä»¶ maven helperï¼‰ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Â å¦‚æœåªæ˜¯ å°½å¿«è§£å†³é—®é¢˜ï¼Œä¸€èˆ¬åˆ°è¿™æ­¥å°±å¯ä»¥äº†ã€‚ä½†æˆ‘å¥‡æ€ªçš„æ˜¯ï¼Œwindowsä¸Šä¸ºå•¥æ²¡é—®é¢˜å‘¢ï¼Ÿï¼Ÿï¼Ÿï¼ˆé»‘äººé—®å·ï¼‰&lt;/p&gt;
&lt;p&gt;Â åè¾¹åœ¨windows çš„ tomcat å¯åŠ¨è„šæœ¬åŠ äº†Â -XX:+TraceClassLoadingï¼Œå‘ç°ï¼Œè¯¥ç±»æ˜¯ä»hibernate é‚£ä¸ªjaråŒ…åŠ è½½çš„ï¼Œæ‰€ä»¥æ²¡é—®é¢˜ã€‚ï¼ˆè¦è®©windowsä¸Šè¾“å‡ºç±»åŠ è½½æ—¥å¿—ï¼Œè¦ä¿®æ”¹ç‚¹ä¸œè¥¿ã€‚https://www.cnblogs.com/welcomer/p/5068340.htmlï¼‰&lt;/p&gt;


&lt;p&gt;æˆ‘çœ‹äº†ä¸‹ä»£ç ï¼Œè¿™ä¸ªjaråŒ…ï¼Œç¡®å®éœ€è¦ï¼Œä¸èƒ½æ’é™¤æ‰ã€‚ã€‚ã€‚åªæ˜¯æ¯”è¾ƒå¥‡æ€ªï¼Œ åœ¨linuxä¸Šï¼Œä¸ºå•¥ä¼šä¼˜å…ˆåŠ è½½äº† persitance-api.jarï¼Œéš¾é“åœ¨windowsæ²¡æœ‰å…ˆåŠ è½½ persistence-api.jarï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¸¦ç€è¿™äº›ç–‘é—®ï¼Œæˆ‘æ¶å‘èƒ†è¾¹ç”Ÿï¼Œç›´æ¥dumpäº†windowsä¸‹å’Œlinuxçš„å †å†…å­˜ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre readability=&quot;5&quot;&gt;
jmap -dump:live,format=b,&lt;span&gt;file&lt;/span&gt;=heap3.bin &lt;span readability=&quot;4&quot;&gt;123072  -----linuxçš„&lt;p&gt;jmap -dump:live,format=b,file=heap-windows.bin 11640 --windowsçš„ &lt;br/&gt;&lt;/p&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;eclipse mat ä¸€æŠŠæ‰“å¼€ linuxçš„å †dumpåï¼Œç”¨ oql è¯­å¥ï¼ŒæŸ¥è¯¢äº†ä¸€ä¸‹æ‰€æœ‰çš„Â ParallelWebappClassLoaderï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/519126/201906/519126-20190615212637250-962284419.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;


&lt;p&gt;å¥½ï¼Œå†çœ‹çœ‹ windows çš„ï¼Œæ“ä½œå’Œä¸Šé¢å·®ä¸å¤šï¼Œç›´æ¥çœ‹ç»“æœï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/519126/201906/519126-20190615212836858-2067961786.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Â &lt;img src=&quot;https://img2018.cnblogs.com/blog/519126/201906/519126-20190615212908770-121306804.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾å¯è§ï¼Œwindowsä¸Šï¼Œæ˜¯æŒ‰å­—æ¯åºæ¥çš„ï¼Œ hibernateé‚£ä¸ªåŒ…ï¼Œå¦¥å¦¥åœ°æ’åœ¨ persistence-api.jar çš„å‰é¢ã€‚ã€‚ã€‚ è¿™è®©äººä¸å¾—ä¸åæ§½ä¸‹ï¼Œè¿™ä¸ªé¡ºåºæ€ä¹ˆæçš„ï¼Œlinuxä¸Šæ–‡ä»¶æ„Ÿè§‰è·Ÿä¹±åºä¸€æ ·ã€‚ã€‚ã€‚&lt;/p&gt;

&lt;p&gt;ç”±äº tomcat 8 æ‰æœ‰localRepositories è¿™ä¸ªå­—æ®µï¼Œæˆ‘è¿™é‡Œæ²¡æœ‰å¯è¿è¡Œçš„æºç ï¼Œæ‰€ä»¥åªèƒ½å¤§æ¦‚çœ‹çœ‹ spring-boot å†…åµŒçš„tomcat jaråŒ…çš„æºç äº†ï¼Œå¤§æ¦‚æ˜¯è¿™ä¹ˆä¸ªæ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;org.apache.catalina.loader.WebappClassLoaderBase#start&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;36&quot;&gt;
&lt;pre&gt;
 &lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt; start() &lt;span&gt;throws&lt;/span&gt;&lt;span&gt; LifecycleException {

        state &lt;/span&gt;=&lt;span&gt; LifecycleState.STARTING_PREP;

        WebResource classes &lt;/span&gt;= resources.getResource(&quot;/WEB-INF/classes&quot;&lt;span&gt;);
        &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (classes.isDirectory() &amp;amp;&amp;amp;&lt;span&gt; classes.canRead()) {
            localRepositories.add(classes.getURL());
        }
&lt;span&gt;        WebResource[] jars &lt;/span&gt;&lt;/span&gt;&lt;span&gt;= resources.listResources(&quot;/WEB-INF/lib&quot;);
        &lt;/span&gt;&lt;span&gt;for&lt;/span&gt;&lt;span&gt; (WebResource jar : jars) {
            &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (jar.getName().endsWith(&quot;.jar&quot;) &amp;amp;&amp;amp; jar.isFile() &amp;amp;&amp;amp;&lt;span&gt; jar.canRead()) {
&lt;span&gt;                localRepositories.add(jar.getURL());
&lt;/span&gt;                jarModificationTimes.put(
                        jar.getName(), Long.valueOf(jar.getLastModified()));
            }
        }

        state &lt;/span&gt;=&lt;span&gt; LifecycleState.STARTED;
    }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;span&gt;ä¸Šé¢æ ‡çº¢å¤„ï¼Œå°±æ˜¯ å»Â /WEB-INF/lib ä¸‹é¢è·å–æ‰€æœ‰çš„ jar åŒ…ï¼Œç„¶åéå†ï¼ŒåŠ å…¥åˆ°localRepositoriesã€‚ è¿™é‡Œçœ‹æ¥ï¼Œå»è¯»æ–‡ä»¶ç³»ç»Ÿåï¼Œæ²¡æœ‰æ ¹æ®æ–‡ä»¶åæ’åºå§ã€‚ã€‚ã€‚è€Œæ­£å¥½å‘¢ï¼Œwindowsä¸‹å’Œlinux ä¸‹è¿”å›çš„æ–‡ä»¶åˆ—è¡¨ï¼Œé¡ºåºä¸åŒã€‚&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;&lt;span&gt;ç»¼ä¸Šï¼Œå¯ä»¥å¤§æ¦‚æ€»ç»“ä¸‹ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¸åŒæ“ä½œç³»ç»Ÿè¿”å›çš„æ–‡ä»¶ï¼Œé¡ºåºéƒ½æ˜¯ä¸å¤ªä¸€è‡´çš„ï¼Œå¦‚æœä»£ç é‡Œï¼Œç›´æ¥ä¾èµ–äº†è¿™ç§é¡ºåºï¼Œå°±ä¼šå‡ºç°è¿™ç±»ï¼š&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;æµ‹è¯•ï¼šå°å“¥å“¥ï¼Œä½ ç¨‹åºæœ‰bugã€‚ã€‚ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;ä½ ï¼šä¸å¯èƒ½ï¼Œæˆ‘è¿™å¥½å¥½çš„ã€‚ã€‚ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;æµ‹è¯•ï¼šå°å“¥å“¥ï¼Œä¸éª—ä½ ï¼Œä½ è¿‡æ¥çœ‹å˜›ã€‚ã€‚ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;ä½ ï¼šä¸çœ‹ä¸çœ‹ï¼Œçƒ¦ä¸çƒ¦ï¼Ÿï¼Ÿ&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;æƒ³åˆ°ä»¥å‰é‡åˆ°çš„ä¸€ä¸ª spring å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼ˆlinuxä¸Šä¸è¡Œï¼Œwindowsä¸Šå¯ä»¥ï¼‰ï¼Œåº”è¯¥ä¹Ÿæ˜¯è¿™ä¸ªåŸå› ã€‚ã€‚ã€‚å“ã€‚ã€‚æ¼ç«&lt;/span&gt;&lt;/p&gt;

</description>
<pubDate>Sun, 16 Jun 2019 00:35:00 +0000</pubDate>
<dc:creator>ä¸‰å›½æ¢¦å›</dc:creator>
<og:description>ä¸€ã€å‰è¨€ è¿™ç¯‡æ˜¯ç±»åŠ è½½å™¨ç›¸å…³çš„ç¬¬ä¸‰ç¯‡ï¼š å®æˆ˜åˆ†æTomcatçš„ç±»åŠ è½½å™¨ç»“æ„ï¼ˆä½¿ç”¨Eclipse MATéªŒè¯ï¼‰ è¿˜æ˜¯Tomcatï¼Œå…³äºç±»åŠ è½½å™¨çš„è¶£å‘³å®éªŒ æ˜¨å¤©ä¸‹åˆåˆšå†™äº†ç¯‡ ç±»åŠ è½½å™¨ç›¸å…³çš„ï¼Œæ™šä¸Šæƒ³ç€éªŒè¯ä¸ª</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/grey-wolf/p/11028975.html</dc:identifier>
</item>
<item>
<title>Goè¯­è¨€å…¥é—¨â€”â€”å‡½æ•° - JackieZheng</title>
<link>http://www.cnblogs.com/bigdataZJ/p/go-function.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/bigdataZJ/p/go-function.html</guid>
<description>&lt;p&gt;å†™äº†å¿«ä¸€ä¸ªæœˆçš„Goï¼Œå·²ç»æ²¡æœ‰ä»€ä¹ˆé™Œç”Ÿæ„Ÿäº†ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€è¡Œä»£ç å†™å®Œï¼Œä¸ä¼šåœ¨è¡Œå°¾æœ¬èƒ½çš„æ•²ä¸Šâ€œï¼›â€ï¼Œç›´æ¥Enteré”®æ¢è¡Œï¼›&lt;/p&gt;
&lt;p&gt;å®šä¹‰å˜é‡æŠŠå˜é‡åæ”¾åœ¨å‰é¢ï¼Œç±»å‹æ”¾åœ¨åé¢ï¼›&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨structå»å®šä¹‰è‡ªå·±æƒ³è¦çš„æ•°æ®æ¨¡å‹å°±å¥½æ¯”å®šä¹‰ä¸€ä¸ªJavaä¸­çš„modelä¸€æ ·â€¦â€¦&lt;/p&gt;

&lt;p&gt;è¿™äº›ä¸ç”¨å¯ä»¥ç»è¿‡å¤§è„‘åŠ å·¥æ€è€ƒï¼Œå°±æƒ³è‡ªå·±è¿˜åœ¨å†™Javaä¸€æ ·ã€‚&lt;/p&gt;

&lt;p&gt;è¿˜è®°å¾—å½“æ—¶åœ¨çœ‹ã€ŠGoå®æˆ˜ã€‹çš„æ—¶å€™çœ‹åˆ°å˜é‡ç±»å‹åç½®çš„å£°æ˜æ–¹å¼ï¼Œæˆ‘è¿˜åœ¨æåŠ›åæ§½è¿™ç§ä¸äººæ€§çš„è¯­æ³•ï¼Œå¦‚æœæˆ‘å·²ç»ç«™åœ¨äº†çœŸé¦™çš„é˜Ÿä¼é‡Œï¼Œå’Œå…¶ä»–çš„çœŸé¦™åŒå­¦åˆ«æ— äºŒè‡´ã€‚&lt;/p&gt;
&lt;p&gt;æ„Ÿæ…¨ï¼Œäººçš„é€‚åº”èƒ½åŠ›çœŸçš„å¼ºğŸ‘&lt;/p&gt;
&lt;p&gt;ä½œä¸ºä¸€ä¸ªJavaé‡åº¦çˆ±å¥½è€…ï¼Œå…¶å®åœ¨æ¯æ¬¡å†™Goçš„æ—¶å€™éƒ½ä¼šæƒ…ä¸è‡ªç¦çš„æŠŠä¸¤è€…è¿›è¡Œå¯¹æ¯”ï¼Œåœ¨å†™æ–‡ç« çš„æ—¶å€™ä¹Ÿä¼šç»å¸¸æåˆ°ã€‚å½“ç„¶äº†ï¼Œä»Šå¤©ä¸»è¦è¯´çš„è¿˜æ˜¯Goçš„å‡½æ•°ã€‚&lt;/p&gt;

&lt;h3 id=&quot;go&quot;&gt;&lt;span&gt;1ã€Goè¯­è¨€ä¸­çš„å‡½æ•°é•¿å•¥æ ·&lt;/span&gt;&lt;/h3&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;34&quot;&gt;
&lt;pre class=&quot;brush:go;gutter:true;&quot;&gt;
func f(a int, b int) (ret int, err error) {
    fmt.Println(&quot;This is function&quot;)
    return
}
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ²¡é”™ï¼Œè¿™å¤§æ¦‚å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„Goé£æ ¼çš„å‡½æ•°ï¼Œé‚£ä¹ˆå®ƒæœ‰å“ªäº›ç‰¹è‰²&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å…¥å‚&lt;/li&gt;
&lt;li&gt;è¿”å›å€¼&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;&quot;&gt;&lt;span&gt;2ã€å…¥å‚&lt;/span&gt;&lt;/h3&gt;
&lt;h4 id=&quot;-1&quot;&gt;&lt;span&gt;2.1 å‚æ•°åˆå¹¶å£°æ˜&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;å…¥å‚çš„å˜é‡ä¹Ÿæ˜¯å˜é‡åç½®çš„ï¼Œè¿™é‡Œaå˜é‡å’Œbå˜é‡æ˜¯ç›¸åŒç±»å‹çš„ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥å†™æˆ&lt;/p&gt;

&lt;p&gt;å¯¹äºä¸åŒç±»å‹çš„å‚æ•°éœ€è¦åˆ†å¼€å®šä¹‰ã€‚&lt;/p&gt;

&lt;h4 id=&quot;-2&quot;&gt;&lt;span&gt;2.2 ä¸å®šå‚æ•°&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;é™¤æ­¤ä»¥å¤–ï¼Œå…¥å‚è¿˜æ”¯æŒä¸å®šå‚æ•°&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚å¯ä»¥è¿™æ ·å®šä¹‰&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;33&quot;&gt;
&lt;pre class=&quot;brush:go;gutter:true;&quot;&gt;
func f(args ...int) {
    for _, arg := range args {
        fmt.Println(arg)
    }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;é’ˆå¯¹ä¸å®šå‚æ•°çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è°ƒç”¨&lt;/p&gt;
&lt;p&gt;f(1)&lt;/p&gt;
&lt;p&gt;f(1, 2)&lt;/p&gt;
&lt;p&gt;f(1, 2, 3)&lt;/p&gt;
&lt;p&gt;é¿å…äº†æˆ‘ä»¬åœ¨å‡½æ•°é‡Œå®šä¹‰ä¸€é•¿ä¸²å˜é‡çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šé¢çš„ä¸å®šå‚æ•°æ˜¯intç±»å‹çš„ï¼Œé‚£ä¹ˆæ˜¯å¦æ”¯æŒå¤šç§ç±»å‹æ··ç”¨çš„ä¸å®šå‚æ•°å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ˜¯å¯ä»¥çš„ï¼Œä½¿ç”¨...interface{}è¿™ç§å½¢å¼&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;35&quot;&gt;
&lt;pre class=&quot;brush:go;gutter:true;&quot;&gt;
func f(args ...interface{}) {
    for _, arg := range args {
        switch arg.(type) {
            case int:
                fmt.Println(&quot;It is int type&quot;)
            case string:
                fmt.Println(&quot;It is string type&quot;)
            case int64:
                fmt.Println(&quot;It is int64 type&quot;)
        }
    }
}
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ³¨æ„ï¼Œè¿™é‡Œçš„i.(T)å½¢å¼ä¸æ˜¯å¼ºåˆ¶è½¬æ¢æˆ–è€…éšå¼ç±»å‹è½¬æ¢ï¼Œè¿™æ˜¯ç±»å‹æ–­è¨€ï¼Œè¡¨ç¤ºåˆ¤å®šç±»å‹çš„ã€‚&lt;/p&gt;
&lt;p&gt;Goé‡Œé¢æ˜¯æ²¡æœ‰éšå¼ç±»å‹è½¬æ¢çš„ï¼Œä¸ä»…æ²¡æœ‰ï¼Œè€Œä¸”å¼ºåˆ¶ç±»å‹è½¬æ¢ä¹Ÿå¾ˆä¸¥æ ¼ã€‚&lt;/p&gt;
&lt;h4&gt;Â &lt;/h4&gt;
&lt;h4 id=&quot;-3&quot;&gt;&lt;span&gt;3ã€è¿”å›å€¼&lt;/span&gt;&lt;/h4&gt;
&lt;h4 id=&quot;-4&quot;&gt;&lt;span&gt;3.1 è¿”å›å‚æ•°&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;ä¸åŒäºJavaï¼ŒGoå‡½æ•°æ˜¯å¯ä»¥æ”¯æŒå¤šè¿”å›å€¼çš„ï¼Œæ¯”å¦‚è¿™é‡Œè¿”å›äº†retå’Œerrä¸¤ä¸ªå‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;è¿”å›å€¼çš„å®šä¹‰æ–¹å¼ä¹Ÿå¾ˆçµæ´»ï¼Œå¯ä»¥å†™æˆ&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;34&quot;&gt;
&lt;pre class=&quot;brush:go;gutter:true;&quot;&gt;
func f(a int, b int) (int, error) {
    fmt.Println(&quot;This is function&quot;)
    return
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æœè¿”å›åªæœ‰ä¸€ä¸ªå‚æ•°å¯ä»¥å†™æˆ&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;33&quot;&gt;
&lt;pre class=&quot;brush:go;gutter:true;&quot;&gt;
func f(a int, b int) (ret int) {
    fmt.Println(&quot;This is function&quot;)
    return
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æˆ–è€…&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;33&quot;&gt;
&lt;pre class=&quot;brush:go;gutter:true;&quot;&gt;
func f(a int, b int) int {
    fmt.Println(&quot;This is function&quot;)
    return
}
&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;_&quot;&gt;&lt;span&gt;3.2 â€œ_â€çš„ç”¨æ³•&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;åœ¨å‰é¢çš„æ–‡ç« ï¼Œæˆ‘ä»¬ä¹Ÿé¡ºå¸¦æè¿‡ï¼Œå¯¹äºå‡½æ•°è¿”å›çš„å€¼ï¼Œæœ‰äº›æˆ‘ä»¬ä¸å…³å¿ƒæˆ–è€…ä¸éœ€è¦çš„è¯ï¼Œæˆ‘ä»¬ä¸èƒ½æŠ¹æ‰ä»–çš„ä½ç½®ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨&quot;_&quot;æ¥è¡¨ç¤ºè¿™ä¸ªå‚æ•°çš„å­˜åœ¨ï¼Œåªæ˜¯ä¸ç”¨è€Œå·²ï¼Œæ¯”å¦‚è¿™æ ·è°ƒç”¨ä¸Šé¢çš„å‡½æ•°æ˜¯ä¸è¡Œçš„&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;33&quot;&gt;
&lt;pre class=&quot;brush:go;gutter:true;&quot;&gt;
ret := f(1, 2)       // ç¼ºå°‘errè¿”å›å€¼
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä½†æ˜¯è¿™æ ·æ˜¯OKçš„&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot;&gt;
&lt;pre class=&quot;brush:go;gutter:true;&quot;&gt;
ret, _ := f(1, 2)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æˆ–è€…è¿™æ ·&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot;&gt;
&lt;pre class=&quot;brush:go;gutter:true;&quot;&gt;
_, err := f(1, 2)    
&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;error&quot;&gt;&lt;span&gt;3.3 error&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;erroræ¥å£æ˜¯Goæ ‡å‡†åº“ä¸ºäº†é”™è¯¯å¤„ç†æä¾›çš„æ¥å£ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬åœ¨ä¸šåŠ¡ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨æŸä¸ªæ–¹æ³•åï¼Œåˆ¤å®šæ–¹æ³•å¯¹åº”çš„å€¼æ˜¯å¦ä¸ºnilåˆ¤å®šæ–¹æ³•æ˜¯å¦è¢«æ­£å¸¸æ‰§è¡Œ&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:go;gutter:true;&quot;&gt;
if err != nil {
    // æ²¡æœ‰æ­£å¸¸æ‰§è¡Œ
} else {
    // æ­£å¸¸æ‰§è¡Œ
}
&lt;/pre&gt;&lt;/div&gt;

&lt;h4 id=&quot;panicrecoverdefer&quot;&gt;&lt;span&gt;3.4 panicå’Œrecoverå’Œdefer&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;è¯´åˆ°errorï¼Œæ­£å¥½è¯´è¯´panic()å’Œrecover()ä¸¤ä¸ªå‡½æ•°&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬é‡åˆ°ä¸€äº›errçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½å°±ä¼šç›´æ¥æŠ›å‡ºpanicï¼Œè¿™é‡Œçš„panicå¯ä»¥è¿‘ä¼¼ç†è§£ä¸ºJavaé‡Œé¢çš„Exceptionï¼Œå³æŠ›å‡ºå¼‚å¸¸ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:go;gutter:true;&quot;&gt;
if err != nil {
    panic(err)
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä¸€æ—¦æŠ›å‡ºpanicï¼Œåˆ™ç¨‹åºå°†ä¼šç»ˆæ­¢ï¼Œé™¤éé‡åˆ°ä¸€ç§æƒ…å†µï¼Œå³æœ‰recoverçš„å­˜åœ¨ã€‚&lt;/p&gt;
&lt;p&gt;è¯´åˆ°recoveråˆ™ä¸å¾—ä¸ædefer&lt;/p&gt;
&lt;p&gt;deferæ˜¯Goé‡Œé¢çš„æ–°ç‰¹æ€§ï¼Œæœ‰ç‚¹ç±»å‹Javaé‡Œé¢çš„finallyï¼Œæ‰¿æ‹…å›æ”¶èµ„æºæˆ–è€…è§£é”è¿™ç±»çš„æ”¶å°¾å·¥ä½œï¼Œä½†æ˜¯æ¯”finallyè¦çµæ´»ï¼ŒGoå‡½æ•°çš„deferå¯ä»¥æ”¾åœ¨å‡½æ•°çš„ä»»æ„ä½ç½®ï¼Œä¸ç®¡å‡½æ•°æ˜¯å¦æ­£å¸¸æ‰§è¡Œï¼Œåœ¨è·³å‡ºå‡½æ•°å‰éƒ½ä¼šæ‰§è¡Œdeferå®šä¹‰çš„å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ç€è¯´recoverï¼Œå¦‚æœåœ¨å‡½æ•°æŠ›å‡ºpanicï¼Œåªè¦åœ¨æœ€åé‡åˆ°recoverä¹Ÿæ˜¯å¯ä»¥æ¢å¤æ­£å¸¸çš„ï¼Œå½¢å¼å¦‚ä¸‹&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;32&quot;&gt;
&lt;pre class=&quot;brush:go;gutter:true;&quot;&gt;
defer func() {
    if ret := recover(); ret != nil {
        fmt.Println(&quot;Catch Runtime Error:)
    }
}
&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&quot;-5&quot;&gt;&lt;span&gt;4ã€å…¶ä»–&lt;/span&gt;&lt;/h3&gt;
&lt;h4 id=&quot;func&quot;&gt;&lt;span&gt;4.1 è¯´è¯´func&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;æ¯ä¸ªå‡½æ•°éƒ½ä»¥funcå¼€å§‹ï¼Œæ¥è¡¨æ˜è‡ªå·±æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå­¦è¿‡Javaçš„è‚¯å®šä¼šé—®ï¼Œæ²¡æœ‰åƒpublicã€privateè¿™æ ·çš„è®¿é—®ä¿®é¥°ç¬¦å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ²¡æœ‰ï¼Œä½†æ˜¯Goé€šè¿‡å¦å¤–ä¸€ç§è§„åˆ™å®ç°äº†è®¿é—®èŒƒå›´å³å¯è§æ€§ã€‚å¯¹äºå‡½æ•°åä½¿ç”¨å¤§å†™å­—æ¯å¼€å¤´ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥è¢«å…¶ä»–åŒ…ä½¿ç”¨ï¼Œå¦‚æœä½¿ç”¨å°å†™å­—æ¯å¼€å¤´ï¼Œåˆ™åªèƒ½æœ¬åŒ…å†…ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œè¿™ä¸ªè§„åˆ™ï¼Œä¹Ÿé€‚ç”¨äºå˜é‡çš„å£°æ˜ã€‚&lt;/p&gt;

&lt;h4 id=&quot;-6&quot;&gt;&lt;span&gt;4.2 åŒ¿åå‡½æ•°&lt;/span&gt;&lt;/h4&gt;
&lt;p&gt;å’ŒJavaç­‰å…¶ä»–è¯­è¨€ä¸€æ ·ï¼ŒGoå‡½æ•°ä¹Ÿæœ‰åŒ¿åå‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;34&quot;&gt;
&lt;pre class=&quot;brush:go;gutter:true;&quot;&gt;
func (a, b int, s string) int {
    ...
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡ç›´æ¥åœ¨åé¢èµ‹å€¼çš„æ–¹å¼ç›´æ¥æ‰§è¡Œ&lt;/p&gt;
&lt;div class=&quot;cnblogs_Highlighter&quot; readability=&quot;36&quot;&gt;
&lt;pre class=&quot;brush:go;gutter:true;&quot;&gt;
func (a, b int, s string) int {
    ...
}(1, 2, &quot;test&quot;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¿™é‡Œä¸»è¦ä»Goè¯­è¨€çš„å‡½æ•°æ„æˆåŒ…æ‹¬å…³é”®å­—funcï¼Œå…¥å‚å’Œè¿”å›å€¼ä»‹ç»Goå‡½æ•°çš„ä¸€äº›ç‰¹æ€§ã€‚å½“ç„¶äº†ï¼ŒGoå‡½æ•°è¿˜æœ‰å¾ˆå¤šçµæ´»æ€§å°±ä¸å†ä¸€ä¸€é˜è¿°äº†ï¼Œæœ‰å¾…ä½ æˆ‘åœ¨ä¸šåŠ¡é¡¹ç›®ä¸­æ…¢æ…¢å®è·µä½“ä¼šäº†ã€‚&lt;/p&gt;

&lt;h3 id=&quot;-7&quot;&gt;&lt;span&gt;5ã€æŠ€æœ¯æ²™é¾™&lt;/span&gt;&lt;/h3&gt;
&lt;p&gt;ä»Šå¤©å»å‚åŠ äº†ä¸€ä¸ªæŠ€æœ¯æ²™é¾™ï¼Œä¸»é¢˜æ˜¯æ•°æ®å­˜å‚¨ä¸å¾®æœåŠ¡æ¶æ„å®è·µæ–¹é¢çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯è‡ªå·±ç¬¬ä¸€æ¬¡é™¤äº†å‚åŠ å…¬å¸ç»„ç»‡çš„å„ç§ä¼šè®®ä»¥å¤–ï¼Œè‡ªå·±ä¸»åŠ¨æŠ¥åçš„çº¿ä¸‹æŠ€æœ¯æ²™é¾™ã€‚&lt;/p&gt;
&lt;p&gt;ä¼šä¸Šå¬åˆ°äº†é˜¿é‡Œã€ç™¾åº¦çš„å¤§ä½¬åˆ†äº«å…³äºè¿‡å»çš„æŠ€æœ¯æ²‰æ·€å’Œå¯¹æœªæ¥æŠ€æœ¯æ–¹å‘çš„å±•æœ›ï¼Œæ•´ä½“è¿˜æ˜¯è›®æœ‰æ”¶è·çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ‹“å®½äº†è‡ªå·±çš„çŸ¥è¯†é¢ï¼Œä¹ŸåŠ æ·±äº†å¯¹ä¸€äº›æ¡†æ¶æˆ–è€…å·¥å…·çš„ç†è§£ï¼Œæ¯”å¦‚ServiceMeshã€‚ä¹‹å‰å¯¹äºServiceMeshçš„ç†è§£ä»…é™äºé˜…è¯»å„ç§æ–‡ç« ï¼Œè‡ªå·±çš„ç†è§£ä¹Ÿæ¯”è¾ƒæœ‰é™ï¼Œè¿™æ¬¡é€šè¿‡é˜¿é‡Œå¤§ä½¬çš„è§£é‡Šï¼Œæ›´åŠ æ¸…æ™°çš„äº†è§£äº†ServiceMeshä»¥åŠå®ƒçš„ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åæ™’ä¸€ä¸‹åœ¨å›ç­”é—®é¢˜ç¯èŠ‚ï¼Œä¸»åŠæ–¹é€çš„é©¬å…‹æ¯ï¼Œå¥½è¯„&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/619240/201906/619240-20190615234404728-2134591643.jpg&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœæ‚¨è§‰å¾—é˜…è¯»æœ¬æ–‡å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹ä¸€ä¸‹â€œ&lt;strong&gt;æ¨è&lt;/strong&gt;â€æŒ‰é’®ï¼Œæ‚¨çš„&lt;strong&gt;â€œæ¨èâ€&lt;/strong&gt;å°†æ˜¯æˆ‘æœ€å¤§çš„å†™ä½œåŠ¨åŠ›ï¼å¦‚æœæ‚¨æƒ³æŒç»­å…³æ³¨æˆ‘çš„æ–‡ç« ï¼Œè¯·æ‰«æäºŒç»´ç ï¼Œå…³æ³¨JackieZhengçš„å¾®ä¿¡å…¬ä¼—å·ï¼Œæˆ‘ä¼šå°†æˆ‘çš„æ–‡ç« æ¨é€ç»™æ‚¨ï¼Œå¹¶å’Œæ‚¨ä¸€èµ·åˆ†äº«æˆ‘æ—¥å¸¸é˜…è¯»è¿‡çš„ä¼˜è´¨æ–‡ç« ã€‚&lt;/p&gt;
&lt;pre&gt;
&lt;em&gt;&lt;img src=&quot;https://images0.cnblogs.com/blog2015/619240/201505/162205410643708.jpg&quot; alt=&quot;&quot;/&gt;&lt;/em&gt;
&lt;/pre&gt;</description>
<pubDate>Sat, 15 Jun 2019 15:54:00 +0000</pubDate>
<dc:creator>JackieZheng</dc:creator>
<og:description>ä»Goè¯­è¨€çš„å‡½æ•°æ„æˆåŒ…æ‹¬å…³é”®å­—funcï¼Œå…¥å‚å’Œè¿”å›å€¼ä»‹ç»Goå‡½æ•°çš„ä¸€äº›ç‰¹æ€§</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/bigdataZJ/p/go-function.html</dc:identifier>
</item>
<item>
<title>å•†åŠ¡ç³»ç»Ÿçš„æ„é€ æ€è·¯ï¼ˆæ— æºç ï¼ï¼‰+å¦‚ä½•ç”¨jspå®ç°ç‚¹å‡»å•é€‰æ¡†å†…å®¹æ˜¾ç¤ºåœ¨å¦ä¸€ä¸ªjspé¡µé¢ - ç¼–ç¨‹å˜ç°</title>
<link>http://www.cnblogs.com/dyxi/p/11029365.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/dyxi/p/11029365.html</guid>
<description>&lt;p&gt;æ•²ç ç»éªŒæ€»ç»“ï¼š&lt;/p&gt;
&lt;p&gt;ä¹‹å‰çŠ¯äº†ä¸€ä¸ªé”™è¯¯å°±æ˜¯ï¼Œæ²¡æœ‰ä»åº•å±‚å¼€å§‹å­¦èµ·ï¼Œæœ‰å•¥é—®é¢˜ï¼Œå°±ç›´æ¥åšå®¢å›­æ‰¾æºç ï¼Œå»CSDNæ‰¾æºä»£ç ï¼Œçœ‹åˆ°ä»£ç å°±å¤åˆ¶ç²˜è´´ï¼Œç»“æœä»æ–°æ¢³ç†çŸ¥è¯†ç‚¹çš„æ—¶å€™ï¼Œè²Œä¼¼é™¤äº†å¤åˆ¶ç²˜è´´ï¼Œå°è±¡æ·±åˆ»çš„çŸ¥è¯†å•¥ä¹Ÿæ²¡å­¦åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹æ¥ä»£ç è¿™äº›ä¸œè¥¿è¿˜æ˜¯å¾—å¤šæ•²å¤šæ€»ç»“æ‰æœ‰æ•ˆï¼Œä¸è¦å®³æ€•ä»åº•å±‚å¼€å§‹å­¦èµ·ï¼Œå› ä¸ºæ²¡æœ‰åº•å±‚çš„çŸ¥è¯†ä½œä¸ºæ”¯æ’‘ï¼Œå³ä½¿ä½ èƒ½åšå‡ºæ•ˆæœä¹Ÿä¸çŸ¥é“å¦‚ä½•åšå‡ºæ¥ï¼Œä¸‡ä¸å¯çŸ¥å…¶ç„¶è€Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚&lt;/p&gt;

&lt;p&gt;å¥½äº†ï¼Œæ•²ç ç»éªŒæ€»ç»“ç»“æŸäº†ï¼Œç°åœ¨åˆ°äº†çŸ¥è¯†ç‚¹å›é¡¾ï¼š&lt;/p&gt;
&lt;p&gt;æ€»çº²åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;p&gt;ä¸€ã€æ€»ä½“å•†åŠ¡å¹³å°çš„æ„æ€&lt;/p&gt;
&lt;p&gt;äºŒã€å®ç°JSPç‚¹å‡»å•é€‰æŒ‰é’®ï¼Œå†…å®¹æ˜¾ç¤ºåˆ°JSPé‡Œ&lt;/p&gt;

&lt;p&gt;ç»†èŠ‚ï¼š&lt;/p&gt;
&lt;p&gt;æ€»ä½“å•†åŠ¡å¹³å°çš„æ„æ¶éœ€è¦ä¸€ä¸ªæ¡†æ¶ï¼Œæ¯”å¦‚è¯´MVCï¼ŒMæŒ‡çš„æ˜¯Modelæ¨¡å‹ï¼ŒVæŒ‡çš„æ˜¯Visonè§†å›¾ï¼ŒCæŒ‡çš„æ˜¯Cotrol&lt;/p&gt;
&lt;p&gt;ä¸‰ä¸ªå±‚æ¬¡å„å¸å…¶èŒï¼Œä»–ä»¬çš„ç»“æ„å‘ˆç°ä¸Šä¸­ä¸‹ï¼Œ&lt;/p&gt;
&lt;p&gt;æœ€é¡¶å±‚æ˜¯Visonã€‚ä¸»è¦åŠŸèƒ½æ˜¯æ˜¾ç¤ºç”¨æˆ·è¾“å…¥çš„æ•°æ®å’Œå‘ˆç°ç”¨æˆ·éœ€è¦çš„æ•°æ®&lt;/p&gt;
&lt;p&gt;ä¸­é—´å±‚æ˜¯Modelã€‚ä¸»è¦åŠŸèƒ½æ˜¯ä¼ é€’ä½œç”¨ï¼Œå½“ç”¨æˆ·è¾“å…¥æ•°æ®åï¼Œå®ƒä¾¿æ¥å—æ•°æ®ä¼ é€’ç»™Modelï¼Œè®©ä»–å¯»æ‰¾ç›¸åº”çš„æ•°æ®å¤„ç† æ–¹å¼&lt;/p&gt;
&lt;p&gt;æœ€åº•å±‚æ˜¯Modelã€‚ä¸»è¦åŠŸèƒ½æ˜¯å¤„ç†ç”¨æˆ·çš„æ•°æ®ï¼Œå…¶ä¸­æœ‰ä¸ªæ¨¡å‹ç§°ä¸ºæ•°æ®æ¨¡å‹ï¼Œå®ƒå’Œæ•°æ®åº“æœ‰ç€åƒä¸ä¸‡ç¼•çš„è”ç³»&lt;/p&gt;
&lt;p&gt;ä¸‰è€…ä¹‹é—´ä½ å¯ä»¥è¿‘ä¼¼çœ‹æˆæ˜¯é¡¾å®¢ï¼Œä¸­é—´å•†ï¼Œä¾›åº”å•†çš„å…³ç³»ï¼Œé¡¾å®¢æœ‰éœ€æ±‚ï¼Œä¸­é—´å•†æ¥å—é¡¾å®¢éœ€æ±‚å‘ŠçŸ¥ä¾›åº”å•†ï¼Œä¾›åº”å•†å¯»æ‰¾ç”¨æˆ·éœ€è¦çš„äº§å“ç»™ä¸­é—´å•†ï¼Œä¸­é—´å•†å†å‘ˆç°ç»™é¡¾å®¢ï¼Œæ»¡è¶³é¡¾å®¢çš„éœ€è¦ã€‚&lt;/p&gt;

&lt;p&gt;é‡ç‚¹ï¼šMVCåªæ˜¯ä¸ªå¤æ‚çš„ç³»ç»Ÿï¼Œå¹¶ä¸æ˜¯æ‹¿æ‰‹å°±å¯ç”¨çš„æ¡†æ¶&lt;/p&gt;
&lt;p&gt;ä½†MVCç³»ç»Ÿæœ‰å¤šä¸ªå°å¼Ÿï¼Œå…¶ä¸­æœ‰ä¸ªå°å¼Ÿç‰¹åˆ«çªå‡ºï¼Œä»–å°±æ˜¯SSHï¼ŒSSHæ˜¯èƒ½åŠ›æå¼ºçš„æ¡†æ¶ï¼Œæˆ‘è¦ä»‹ç»çš„å•†åŠ¡ç³»ç»Ÿå°±æ˜¯å»ºç«‹åœ¨å®ƒçš„åŸºç¡€ä¸Š&lt;/p&gt;

&lt;p&gt;SSHï¼ŒSæŒ‡çš„æ˜¯Strutsï¼ŒSæŒ‡çš„æ˜¯Springï¼ŒHæŒ‡çš„æ˜¯Hibernate&lt;/p&gt;
&lt;p&gt;ä»–ä»¬ç»§æ‰¿äº†è€å¤§çš„æ€ç»´æ¨¡å¼ï¼Œä¸‰ä¸ªå±‚æ¬¡ä¹Ÿæ˜¯å„å¸å…¶èŒï¼Œä»–ä»¬çš„ç»“æ„ä¹Ÿæ˜¯å‘ˆç°ä¸Šä¸­ä¸‹&lt;/p&gt;
&lt;p&gt;æœ€é¡¶å±‚æ˜¯Strutsã€‚ä¸»è¦åŠŸèƒ½æ˜¯æäº¤æ•°æ®ï¼Œé€šè¿‡Actionå¤„ç†ï¼Œä»forwardåˆ°å¯¹åº”çš„ç½‘é¡µã€‚é‡‡ç”¨çš„æŠ€æœ¯æ˜¯Servletã€JSP&lt;/p&gt;
&lt;p&gt;ä¸­é—´å±‚æ˜¯Springã€‚ä¸»è¦çš„åŠŸèƒ½æ˜¯æä¾›ç®¡ç†ä¸šåŠ¡å¯¹è±¡çš„è°ƒç”¨æ¥å£ã€‚ã€Springä¹Ÿç§°ä¸ºServiceã€Managerã€‘&lt;/p&gt;
&lt;p&gt;åº•å±‚æ˜¯Hibernateã€‚ä¸»è¦çš„åŠŸèƒ½æ˜¯ä¸æ•°æ®åº“æ‰“äº¤é“&lt;/p&gt;

&lt;p&gt;å› æ­¤&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘çš„å•†åŠ¡ç³»ç»Ÿçš„SSHçš„æ„é€ æ˜¯ã€ä»ååˆ°å‰é¡ºåºã€‘ï¼š&lt;/p&gt;
&lt;p&gt;å®ä½“å±‚ï¼ˆæ•°æ®åº“çš„æ•°æ®ï¼‰&lt;/p&gt;
&lt;p&gt;Daoå±‚ï¼ˆæœåŠ¡æ–¹æ³•çš„æ¥å£ï¼‰&lt;/p&gt;
&lt;p&gt;æœåŠ¡å±‚ï¼ˆè°ƒç”¨Daoå±‚å®ç°å„ç§æœåŠ¡æ–¹æ³•çš„ç¼–å†™ï¼‰&lt;/p&gt;
&lt;p&gt;Webå±‚ï¼ˆç¼–å†™Actionå’Œformã€ä¸»è¦æ˜¯å¯¹æ•°æ®è¿›è¡Œå¿…è¦çš„éªŒè¯å’Œè½¬æ¢ã€‘ã€JSPé¡µé¢å¯¹ä¸šåŠ¡æ•°æ®çš„æ“ä½œï¼‰&lt;/p&gt;
&lt;p&gt;å¯¹åº”SSHçš„æ¡†æ¶å°±æ˜¯&lt;/p&gt;
&lt;p&gt;Hibernateï¼šè´Ÿè´£å®ä½“å±‚&lt;/p&gt;
&lt;p&gt;Springï¼šè´Ÿè´£Daoå±‚å’ŒæœåŠ¡å±‚&lt;/p&gt;
&lt;p&gt;Strutsï¼šè´Ÿè´£Webå±‚&lt;/p&gt;

&lt;p&gt;æŒ‰ç…§è¿™æ ·æ€è·¯ï¼š&lt;/p&gt;
&lt;p&gt;å¯¹è±¡çš„è°ƒç”¨æµç¨‹å°±æ˜¯ï¼šJSPé¡µé¢--&amp;gt;é€šè¿‡Acrionç­‰æ–¹æ³•--&amp;gt;åæ˜ åˆ°Service--&amp;gt;å¯»æ‰¾ç›¸åº”çš„DAOæ¥å£--&amp;gt;åˆ°Hibernateå¯»æ‰¾&lt;/p&gt;
&lt;p&gt;æ•°æ®çš„æµå‘ï¼šActionFormBeanæ¥å—ç”¨æˆ·æ•°æ®--&amp;gt;Actionå°†æ•°æ®ä»ä¸­æå–å‡ºæ¥--&amp;gt;å°è£…æˆVOæˆ–PO--&amp;gt;è°ƒç”¨ä¸šåŠ¡å±‚çš„Beanç±»ï¼Œæ¥å—è¿™ä¸ªPOå¯¹è±¡ï¼Œè°ƒç”¨DAOæ¥å£æ–¹æ³•--&amp;gt;åˆ°å®ä½“å±‚è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ&lt;/p&gt;

&lt;p&gt;è¿™å°±æ˜¯æˆ‘çš„å•†åŠ¡å¹³å°çš„æ„å»ºæ€è·¯ï¼Œå½“ç„¶è¿™åªæ˜¯ä¸‡é‡Œé•¿å¾çš„ç¬¬ä¸€æ­¥ï¼Œæºç ä»€ä¹ˆçš„è¿˜æ²¡æ‘†å‡ºæ¥ï¼Œä¸è¿‡æˆ‘ä¼šäº‰å–æŒä¹…æ›´æ–°çš„ï¼ˆæ¯•ç«Ÿæœ‰æ—¶å€™æä¸€ä¸ªæ–¹æ³•å°±èŠ±å»æˆ‘ä¸€å¤©æˆ–è€…ä»¥ä¸Šï¼‰ï¼Œä½†æ˜¯è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ï¼&lt;/p&gt;

&lt;p&gt;äºŒã€å®ç°JSPç‚¹å‡»å•é€‰æŒ‰é’®ï¼Œå†…å®¹æ˜¾ç¤ºåˆ°JSPä¸Š&lt;/p&gt;
&lt;p&gt;æ•ˆæœå›¾å…ˆæ‘†ä¸Šï¼š&lt;/p&gt;
&lt;p&gt;ã€é€‰æ‹©å‰ï¼šã€‘&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1696579/201906/1696579-20190615231823622-430734272.jpg&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ã€é€‰æ‹©åï¼šã€‘&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1696579/201906/1696579-20190615231902133-1103042950.jpg&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;æœ‰ä¸¤ä¸ªJSPæºç ï¼Œ&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯å•é€‰å‰çš„æºç ï¼ˆselect.jspï¼‰ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;35&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &amp;lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&amp;gt;
&lt;span&gt; 2&lt;/span&gt; &amp;lt;html&amp;gt;
&lt;span&gt; 3&lt;/span&gt; &amp;lt;head&amp;gt;
&lt;span&gt; 4&lt;/span&gt;     &amp;lt;title&amp;gt;é€‰æ‹©&amp;lt;/title&amp;gt;
&lt;span&gt; 5&lt;/span&gt; &amp;lt;/head&amp;gt;
&lt;span&gt; 6&lt;/span&gt; &amp;lt;body&amp;gt;
&lt;span&gt; 7&lt;/span&gt; 
&lt;span&gt; 8&lt;/span&gt; &lt;span&gt;é€‰æ‹©è‡ªå·±çš„åŸå¸‚ä¿¡æ¯
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; &amp;lt;form action=&quot;selec_result.jsp&quot; method=&quot;post&quot;&amp;gt;&amp;lt;!--å¼€å§‹è·³è½¬æ–°çš„jsp--&amp;gt;
&lt;span&gt;10&lt;/span&gt;     é€‰æ‹©ä½ æ‰€åœ¨çš„åŸå¸‚&amp;lt;select name=&quot;home&quot;&amp;gt;&amp;lt;!--ç›¸å½“äºå¼•ç”¨å˜é‡--&amp;gt;
&lt;span&gt;11&lt;/span&gt;     &amp;lt;option value=&quot;beijing&quot;&amp;gt;åŒ—äº¬&amp;lt;/option&amp;gt;&amp;lt;!--valueåé¢æ˜¯æ˜¾ç¤ºçš„å€¼ï¼Œå†åé¢çš„æ˜¯ç•Œé¢é€‰æ‹©é¡¹--&amp;gt;
&lt;span&gt;12&lt;/span&gt;     &amp;lt;option value=&quot;shanghai&quot;&amp;gt;ä¸Šæµ·&amp;lt;/option&amp;gt;
&lt;span&gt;13&lt;/span&gt;     &amp;lt;option value=&quot;guangzhou&quot;&amp;gt;å¹¿å·&amp;lt;/option&amp;gt;
&lt;span&gt;14&lt;/span&gt; &amp;lt;/select&amp;gt;
&lt;span&gt;15&lt;/span&gt;     &amp;lt;input type=&quot;submit&quot; value=&quot;æäº¤&quot;&amp;gt;&amp;lt;!--typeæ˜¯æäº¤æ“ä½œï¼Œvalueæ˜¯æŒ‰é’®åå­—--&amp;gt;
&lt;span&gt;16&lt;/span&gt; &amp;lt;/form&amp;gt;
&lt;span&gt;17&lt;/span&gt; &amp;lt;/body&amp;gt;
&lt;span&gt;18&lt;/span&gt; &amp;lt;/html&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯å•é€‰åçš„æºç ï¼ˆselec_result.jspï¼‰ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;34&quot;&gt;
&lt;pre&gt;
&lt;span&gt; 1&lt;/span&gt; &amp;lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&amp;gt;
&lt;span&gt; 2&lt;/span&gt; &amp;lt;%@ page import=&quot;java.io.PrintWriter&quot; %&amp;gt;
&lt;span&gt; 3&lt;/span&gt; &amp;lt;html&amp;gt;
&lt;span&gt; 4&lt;/span&gt; &amp;lt;body&amp;gt;
&lt;span&gt; 5&lt;/span&gt; &amp;lt;%
&lt;span&gt; 6&lt;/span&gt;     String home=request.getParameter(&quot;home&quot;&lt;span&gt;);
&lt;/span&gt;&lt;span&gt; 7&lt;/span&gt;     PrintWriter out1=&lt;span&gt;response.getWriter();
&lt;/span&gt;&lt;span&gt; 8&lt;/span&gt;     out1.print(&quot;ä½ æ‰€åœ¨çš„åŸå¸‚æ˜¯ï¼š&quot;+&lt;span&gt;home);
&lt;/span&gt;&lt;span&gt; 9&lt;/span&gt; %&amp;gt;
&lt;span&gt;10&lt;/span&gt; &amp;lt;/body&amp;gt;
&lt;span&gt;11&lt;/span&gt; &amp;lt;/html&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;æºç å·²ç»æœ‰äº†ï¼Œæˆ‘å°±è®²è®²åœ¨å…¶ä¸­è¦æ³¨æ„ä»€ä¹ˆï¼Œæœ‰ä¸¤ç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;ä¸€ã€è¦å¯¼å…¥servlet-api.jaråŒ…ï¼Œåªæœ‰å¯¼å…¥æ‰èƒ½å“åº”responeçš„æ“ä½œï¼Œã€åœ¨ä¸‹è½½çš„Tomcatçš„libæ–‡ä»¶é‡Œå¯ä»¥æ‰¾åˆ°ï¼Œè¦æ˜¯æ‡’å¾—æ‰¾ï¼Œç¬”è€…è¿™é‡Œæœ‰é“¾æ¥ï¼šhttps://pan.baidu.com/s/16C1GF9cPvo08MC3rxPGmSwï¼›æå–ç ï¼šq4tqï¼›ç¬”è€…ä½¿ç”¨çš„æ˜¯Tomcat 8.5ã€‘&lt;/p&gt;
&lt;p&gt;äºŒã€æ¯æ¬¡ä¿®æ”¹å…¶ä¸­jspæºç ï¼Œéœ€è¦å°†ç«¯å£é‡æ–°å¯åŠ¨æ‰èƒ½æ˜¾ç¤ºæœ€æ–°ä¿®æ”¹çš„ä¿¡æ¯ã€è¿™æ˜¯ç¼ºç‚¹ï¼Œç›®å‰ç¬”è€…æ²¡æœ‰æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‘&lt;/p&gt;

&lt;p&gt;ä»Šå¤©çš„åˆ†äº«åˆ°è¿™é‡Œç»“æŸäº†ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ã€‚&lt;/p&gt;
</description>
<pubDate>Sat, 15 Jun 2019 15:52:00 +0000</pubDate>
<dc:creator>ç¼–ç¨‹&amp;lt;--&amp;gt;å˜ç°</dc:creator>
<og:description>ä¸»è¦è®²è§£å•†åŠ¡ç³»ç»Ÿçš„æ„é€ æ€è·¯ï¼ˆæ— æºç ï¼ï¼‰ï¼Œå’Œå¦‚ä½•ç”¨jspå®ç°ç‚¹å‡»å•é€‰æ¡†å†…å®¹æ˜¾ç¤ºåœ¨å¦ä¸€ä¸ªjspé¡µé¢ä¸­</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/dyxi/p/11029365.html</dc:identifier>
</item>
<item>
<title>é©¬ä¸Šè¦åˆ°30å²ï¼Œä½ ä¹Ÿè¢«å‚¬å©šäº†å— - Refain</title>
<link>http://www.cnblogs.com/longronglang/p/11029355.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/longronglang/p/11029355.html</guid>
<description>
&lt;p&gt;å¦‚æœå¹´è¿‘30å²ï¼Œå¯¹äºæ¯ä¸ªå•èº«çš„ç”·ã€å¥³åŒå­¦æ¥è¯´ï¼Œéƒ½æ˜¯ä¸ªæå…¶å…·æœ‰å‹åŠ›çš„äº‹æƒ…ã€‚&lt;/p&gt;

&lt;p&gt;ç®€å•æ¥è¯´ï¼Œæœ‰ä¸¤æ–¹é¢ï¼š&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å®¶åº­æ–¹é¢&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é¦–å…ˆçˆ¶æ¯å±‚é¢æœ€å¤§ï¼Œæ¯å¤©è¦é¢å¯¹çˆ¶æ¯çš„â€œå˜´éâ€ï¼Œè¿™æ—¶å€™ä¸æƒ³è¯´è¯ã€‚å…¶æ¬¡å°±æ˜¯é‚»å±…å°åŒºæ–¹é¢ã€äº²æˆšé€¢å¹´è¿‡èŠ‚æ—¶å€™ï¼Œäº²æˆšçš„â€œç‰¹åˆ«å…³å¿ƒâ€ï¼Œä¼šè§‰å¾—ä»–ä»¬å¥½å¤šç®¡é—²äº‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è‡ªèº«æ–¹é¢&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¯æ¯çœ‹åˆ°æœ‹å‹åœˆæ™’ç»“å©šç…§ï¼Œå¿ƒé‡Œæ€»ä¼šæœ‰ç§è¯´ä¸å‡ºçš„ç¾¡æ…•å’Œæ„Ÿå¹ã€‚é«˜å…´è‡ªç„¶æ˜¯å› ä¸ºçœŸå¿ƒç¥ç¦ï¼Œæ„Ÿå¹æ˜¯å› ä¸ºè‡ªå·±ä½•æ—¶èƒ½é‡è§å¹¸ç¦ï¼Œä¹Ÿå¯ä»¥äº«å—å±äºè‡ªå·±çš„é‚£ä»½â€œä¹…é•¿æ—¶â€å’Œâ€œæœæœå¹•å¹•â€ï¼Œå†…å¿ƒæ˜¯æ— æ¯”çš„ç¾¡æ…•å’Œæ†§æ†¬ã€‚å†æœ‰ä¸€ä¸ªé‡è¦çš„åŸå› å°±æ˜¯è‡ªå·±ä¸æƒ³å°†å°±ï¼Œæ€»è§‰å¾—ä¼šæœ‰é‚£ä¹ˆä¸€ä¸ªâ€œç†æƒ³çš„ä»–/å¥¹â€åœ¨ç­‰å¾…ä½ ã€‚&lt;/p&gt;

&lt;p&gt;äºæ˜¯å°±æœ‰äº†ç›¸äº²ï¼Œä»å¤åˆ°ä»Šæœ€ä¸ºæµè¡Œçš„æ–¹å¼ï¼Œè®¤è¯†æœªæ¥çš„å¦ä¸€åŠçš„é€”å¾„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;1&lt;/strong&gt;&lt;strong&gt;å‡ºç°çŸ›ç›¾ï¼Œä¸æ˜¯ç›¸äº’æŒ‡è´£ï¼Œè€Œæ˜¯èƒ½å¤Ÿä¸€èµ·é¢å¯¹&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å’Œå¾ˆå¤šäººä¸€æ ·ï¼Œåœ¨å¤§å­¦æ—¶ï¼Œéƒ½æœ‰ä¸€æ®µåˆ»éª¨é“­å¿ƒçš„çˆ±æƒ…ï¼Œä½†ä¹Ÿæœ‰ç€ç±»ä¼¼çš„ç»“å±€ï¼Œé‚£å°±æ˜¯æ¯•ä¸šå°±åˆ†æ‰‹ã€‚&lt;/p&gt;

&lt;p&gt;å¤§å­¦è¯»çš„æ˜¯æœºæ¢°ä¸“ä¸šï¼Œæ¯•ä¸šå»æŸæœºæ„åŸ¹è®­äº†ä¸‰ä¸ªæœˆï¼Œå’Œå¾ˆå¤šå¹´è½»äººä¸€æ ·ï¼Œå¸¦ç€è‡ªå·±çš„æ¢¦æƒ³æŠ•èº«äºåŒ—äº¬ã€‚æˆ‘å¯èƒ½æ˜¯æ„Ÿæƒ…æ–¹é¢æ¯”å…¶ä»–äººå·®äº†å¥½å¤šå§ï¼Œæ¯å¤©çš„ç”Ÿæ´»å’Œä¸Šäº†å‘æ¡ä¸€æ ·ï¼Œæ›´å¤šæ—¶é—´æŠŠç²¾åŠ›æ”¾åœ¨å·¥ä½œå’Œå­¦ä¹ ä¸­ï¼ŒçŠ¶æ€å¥½çš„æ—¶å€™ï¼Œ5å¤©åˆ©ç”¨ååœ°é“æ—¶é—´å¯ä»¥çœ‹å®Œä¸€æœ¬ä¹¦ï¼Œä¹Ÿä¼šå› ä¸ºå†™ä»£ç å…´å¥‹åˆ°ä¸¤å¤©ä¸ç¡è§‰ï¼Œä¸çŸ¥é“é¥¿ã€å›°ã€‚&lt;/p&gt;

&lt;p&gt;å°±è¿™æ ·ä¸€ä¸ªçœ‹ä¼¼å¾ˆåŠ±å¿—çš„çŠ¶æ€ï¼Œåœ¨åŒ—äº¬å¿«æ»¡5å¹´çš„æ—¶å€™ï¼Œå’Œä¸€ä¸ªæ ¡å‹çªç„¶è”ç³»ä¸Šäº†ï¼Œè«åå…¶å¦™çš„ç›¸äº’å–œæ¬¢ï¼Œå’Œå¥¹ç›¸å¤„è¿‘åŠå¹´å§ã€‚&lt;/p&gt;

&lt;p&gt;ç”±äºå¼‚åœ°çš„å…³ç³»ï¼Œä¹Ÿæ€»æœ‰çŸ›ç›¾ï¼Œå› ä¸ºè§é¢çš„æœºä¼šå¤ªå°‘ï¼Œè€Œä¸”å³ä½¿è§é¢å¾…åœ¨ä¸€èµ·çš„æ—¶é—´å¤ªå°‘ï¼Œæˆ‘æ€»ç©¿æ¢­äºè€å®¶å’ŒåŒ—äº¬ä¸¤åº§åŸå¸‚ï¼Œé‚£æ—¶æ„Ÿè§‰å’Œå–œæ¬¢çš„äººå¤šå‘†ä¸€ä¼šéƒ½æ„Ÿè§‰å¥½å¥¢ä¾ˆã€‚&lt;/p&gt;

&lt;p&gt;å½“æ—¶ï¼Œæˆ‘åšäº†äººç”Ÿä¸­ç¬¬ä¸€æ¬¡é‡å¤§é€‰æ‹©ï¼Œ&lt;strong&gt;æˆ‘æƒ³å›è€å®¶ä¸Šç­ï¼Œæˆ‘æƒ³è§å¥¹ï¼&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å½“æ—¶å†…å¿ƒååˆ†å¤æ‚ï¼Œè¦é¢ä¸´çš„ç°å®é—®é¢˜æœ‰ï¼š&lt;/p&gt;
&lt;ul class=&quot;list-paddingleft-2&quot; readability=&quot;0&quot;&gt;&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;èƒ½æ¥å—å›è€å®¶è–ªèµ„æ¯”åŒ—äº¬ä½çš„ç°å®å—ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;è€å®¶çš„è½¯ä»¶å…¬å¸å¤šå—ï¼Œæˆ‘ä¼šä¸ä¼šå¤±ä¸šï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;æˆ‘å’Œå¥¹ä¼šæœ‰ç»“æœå—ï¼Ÿè¿™æ— ç–‘æ˜¯ä¸€æ¬¡èµŒæ³¨ï¼Œè¿™ä¸€åˆ‡éƒ½å€¼å¾—å—ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¹¦ä¸Šè¯´ï¼Œæ¯ä¸ªæƒ…ä¾£é€‚ä¸é€‚åˆåœ¨ä¸€èµ·ï¼Œå‡ºå»æ—…è¡Œä¸€æ¬¡å°±çŸ¥é“äº†ã€‚å›åˆ°è€å®¶åï¼Œæˆ‘æ²¡æœ‰ç€æ€¥å»æ‰¾å·¥ä½œï¼Œè€Œæ˜¯å¸¦ç€å¥¹å‡ºå»æ—…æ¸¸äº†ã€‚&lt;/p&gt;

&lt;p&gt;Â &lt;img src=&quot;https://img2018.cnblogs.com/blog/718867/201906/718867-20190616084418563-1801542381.gif&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;ä¸€èµ·å‡ºå»çš„ç¬¬ä¸€å¤©ç©çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°å¾ˆå¤šé—®é¢˜æ¸æ¸æš´éœ²ï¼Œé‡åˆ°é—®é¢˜åªä¼šæŒ‡è´£ï¼Œä½†ä½œä¸ºç”·å­©æ¥è¯´ï¼Œ&lt;strong&gt;è·¯ç—´ç¡®å®æ˜¯è‡´å‘½çš„ç¡¬ä¼¤&lt;/strong&gt;ï¼Œæˆ‘å‚»å‚»çš„ç«™åœ¨åŸåœ°ï¼Œä»»å‡­å¥¹è¯´ï¼Œä»€ä¹ˆéƒ½æ²¡è¯´ã€‚é»˜é»˜æ‹¿ç€æ‰‹æœºç»™å½“åœ°çš„æœ‹å‹æ‰“ç”µè¯ï¼Œåœ¨æœ‹å‹çš„å¸®å¿™ä¸‹ï¼Œæ‰¾åˆ°äº†æ™¯ç‚¹çš„ä½ç½®ã€‚&lt;/p&gt;

&lt;p&gt;æ¥ä¸‹çš„äº‹å°±ä¸ä¸€ä¸€åˆ—ä¸¾ï¼Œ&lt;strong&gt;å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä¸éœ€è¦ä½ çš„æŒ‡è´£ï¼Œæ›´å¸Œæœ›ä½ èƒ½ç†è§£æˆ‘ï¼Œå’Œæˆ‘ä¸€èµ·é¢å¯¹é—®é¢˜ï¼Œè€Œä¸æ˜¯ä½ çš„æŒ‡è´£å’Œå˜²è®½ï¼&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åŸå®šæ—…è¡Œä¸€å‘¨çš„è¡Œç¨‹ï¼Œç¬¬ä¸‰å¤©æ—©ä¸Šå°±å…¨éƒ¨å–æ¶ˆï¼Œæˆ‘å’Œå¥¹è¯´äº†åˆ†æ‰‹çš„äº‹ã€‚è™½ç„¶å¥¹å“­çš„å¾ˆä¼¤å¿ƒï¼Œä½†æ˜¯æˆ‘ä¹Ÿå¾ˆæ¸…æ¥šå¥¹å¹¶ä¸æ˜¯æƒ³å’Œæˆ‘ä¸€èµ·èƒ½èµ°åˆ°æœ€åçš„äººï¼ŒæŠŠå¥¹å®‰é¡¿åœ¨æˆ‘åŒå­¦é‚£åï¼Œä¸€ä¸ªäººåç€é«˜é“å›åˆ°äº†è€å®¶ï¼Œä¸€è·¯ä¸Šåœ¨æƒ³ï¼Œä¸ºäº†ä¸€ä¸ªäººï¼Œæ”¾å¼ƒäº†è‡ªå·±çš„äº‹ä¸šï¼Œå€¼å¾—å—ï¼Ÿ&lt;strong&gt;ç­”æ¡ˆï¼Œå¾ˆæ¸…æ™°ï¼Œåªå› ä¸ºå–œæ¬¢ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;2&lt;/strong&gt;&lt;strong&gt;ä¸‰è§‚ä¸€è‡´å¾ˆé‡è¦å—&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;â€œä¸‰è§‚â€æŒ‡çš„æ˜¯åŒæ–¹å„è‡ªçš„äººç”Ÿè§‚ã€ä»·å€¼è§‚å’Œä¸–ç•Œè§‚ã€‚&lt;/p&gt;

&lt;p&gt;ä»€ä¹ˆæ˜¯çœŸæ­£çš„ä¸‰è§‚ä¸åˆï¼Ÿ&lt;/p&gt;

&lt;p&gt;åœ¨çŸ¥ä¹ä¸Šçœ‹è¿‡ä¸€æ®µè§£é‡Šï¼Œæ·±ä»¥ä¸ºç„¶ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å–œæ¬¢çœ‹ä¹¦ï¼Œä»–å–œæ¬¢ç©æ¸¸æˆã€‚è¿™ä¸å«ä¸‰è§‚ä¸åˆã€‚ä½ å–œæ¬¢çœ‹ä¹¦ï¼Œä»–è¯´çœ‹ä¹¦æœ‰ä»€ä¹ˆç”¨ï¼Œä¸å°±æ˜¯è£…æ–‡è‰ºå˜›ã€‚è¿™æ‰æ˜¯ä¸‰è§‚ä¸åˆã€‚ä½ å–œæ¬¢å»è¥¿é¤å…åƒç‰›æ’ï¼Œä»–å–œæ¬¢åœ¨å¤§æ’æ¡£æ’¸ä¸²ã€‚è¿™ä¸å«ä¸‰è§‚ä¸åˆã€‚ä½†æ˜¯ä»–è¯´é‚£ç©æ„æ­»è´µï¼Œè¿˜ä¸å¥½åƒï¼Œè¯´ä½ çœŸæ˜¯åšä½œã€‚è¿™å°±æ˜¯ä¸‰è§‚ä¸åˆã€‚ä½ å–œæ¬¢å‡æœŸå»å„åœ°æ—…æ¸¸ï¼Œä»–å°±å–œæ¬¢å®…åœ¨å®¶é‡Œã€‚è¿™ä¸æ˜¯ä¸‰è§‚ä¸åˆã€‚ä½†æ˜¯ä»–è¯´æ—…æ¸¸æœ‰ä»€ä¹ˆå¥½ç©çš„ï¼Œä¸å°±æ˜¯èŠ±é’±é­ç½ªå˜›ï¼Œèººåœ¨å®¶é‡Œå¤šèˆ’æœã€‚&lt;/p&gt;

&lt;p&gt;è¿™å°±æ˜¯å…¸å‹ä¸‰è§‚ä¸åˆã€‚&lt;/p&gt;

&lt;p&gt;ç®€å•ç‚¹æ¥è¯´ï¼Œä¸èƒ½æ¥å—å¹¶å°Šé‡å¯¹æ–¹ä¸€äº›è¡Œä¸ºå’Œä¹ æƒ¯ã€‚&lt;/p&gt;

&lt;p&gt;ä¹‹å‰åœ¨ç½‘ä¸Šçœ‹åˆ°ä¸€ä¸ªæ®µå­è¯´ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/718867/201906/718867-20190616084204210-168986191.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;

&lt;p&gt;è™½ç„¶ç®—æ˜¯æ’’äº†ä¸€æ³¢ç‹—ç²®ï¼Œä½†æ˜¯è„‘è¡¥ä¸‹è¿™ä¸ªç”»é¢è¿˜æ˜¯è§‰å¾—å¾ˆæ¸©é¦¨ã€æµªæ¼«ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/718867/201906/718867-20190616084233479-2053306026.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;


&lt;p&gt;è™½ç„¶ä¸¤äººä¸‰è§‚ä¸åŒï¼Œç”Ÿæ´»ä¹ æƒ¯ä¹Ÿä¸åŒï¼Œå´å¹¶ä¸å½±å“äº¤å¾€å’Œæ¥è§¦ã€‚&lt;/p&gt;

&lt;p&gt;éƒ½è¯´ä¸‰è§‚ä¸€è‡´å¾ˆé‡è¦ï¼Œå…¶å®å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œå°±æ˜¯å’Œå¦ä¸€ä¸ªäººåœ¨ä¸€èµ·å‘†ç€å¾ˆèˆ’æœï¼Œæ›´æ˜¯ä¸ºä¸€ç§é™ªä¼´å§ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æœ€å¥½çš„å…³ç³»ï¼Œå¯ä»¥æ˜¯æˆ‘åœ¨åºŠå‰å®‰é™çš„çœ‹ä¹¦ï¼Œä½ åœ¨æ‰‹æœºä¸Šå¿˜æˆ‘çš„äº”æ€ï¼Œæˆ‘ä¸ä¼šé„™è§†ä½ çš„æ¸¸æˆï¼Œä½ ä¹Ÿå¶å°”ä¼šæ¥çœ‹çœ‹æˆ‘æœ€è¿‘åœ¨çœ‹ä»€ä¹ˆä¹¦ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;3&lt;/strong&gt;&lt;strong&gt;ä½ ä»æ¥éƒ½ä¸ä¼šä¸»åŠ¨æ‰¾æˆ‘&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç°åœ¨ç›¸äº²ä¸æ¯”ä»¥å‰äº†ï¼Œè€Œæ˜¯ä¸¤äººå…ˆåŠ å¾®ä¿¡èŠå¤©ï¼Œç„¶åè‡ªå·±å»äº†è§£ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ªäººæ„Ÿè§‰å¾®ä¿¡å½¢å¼ç›¸äº²ï¼Œä»æŸç§è§’åº¦çœ‹ï¼Œå¥½åƒåœ¨å‰¥å¤ºç€æˆ‘ä»¬çš„â€œå¹¸ç¦â€ï¼Œä¸ºä»€ä¹ˆè¿™æ ·è¯´ã€‚æˆ‘ç›¸ä¿¡å¾ˆå¤šæœ‹å‹éƒ½é‡åˆ°è¿‡ç±»ä¼¼çš„æƒ…å†µï¼š&lt;/p&gt;




&lt;p&gt;å½“ä½ å‘é€çš„å¾®ä¿¡ä¸€ç›´æ²¡æœ‰å›å¤ï¼Œé‚£ä¸€åˆ»æ˜¯å¤šä¹ˆçš„æ‚²ä¼¤å’Œæ— å¥ˆï¼Œå¯¹æ–¹ä¼šå¦‚æ­¤å¿™ç¢Œï¼Œç”šè‡³å¾®ä¿¡ä¹Ÿæ— æ³•å›å¤ï¼&lt;/p&gt;

&lt;p&gt;äº‹å®ä¸Šï¼Œé‚£äº›ç»å¸¸ä»¥æ²¡çœ‹è§ä¸ºå€Ÿå£çš„äººåªæ˜¯å‡è£…æ²¡çœ‹è§ï¼Œæˆ‘ä»¬ç”šè‡³å»å•æ‰€éƒ½ä¼šçœ‹ç”µè¯ï¼Œæ€ä¹ˆå¯èƒ½å¾ˆä¹…æ²¡çœ‹è§ï¼&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;éƒ½ä¸æ²Ÿé€šï¼Œè¯•é—®æ€ä¹ˆçŸ¥é“æ˜¯å¦åˆé€‚å‘¢ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;äº‹å®ä¸Šï¼Œæˆ‘æœ€æƒ³è¯´çš„å€Ÿå£æ˜¯å‡çš„ï¼Œæ²¡æ„Ÿè§‰æ˜¯çœŸçš„ï¼Œæ‰€ä»¥è¦æ‰¾é‚£äº›æ„¿æ„èŠ±æ—¶é—´é™ªä½ çš„äººï¼ŒçœŸçˆ±åº”è¯¥æ˜¯æµªè´¹å½¼æ­¤çš„æ—¶é—´ä¸€èµ·èŠå¤©å’Œå¤§ç¬‘ï¼Œè¿‡ç€æ— èŠçš„ç”Ÿæ´»ï¼Œæ†§æ†¬æµªæ¼«çš„æœªæ¥ï¼&lt;/p&gt;

&lt;p&gt;å¦‚æœå½¼æ­¤éƒ½æœ‰æ„Ÿè§‰ï¼Œé‚£å°±å¤šäº›èŠå¤©äº’åŠ¨ï¼Œäº’åŠ¨å¤šäº†ï¼Œå°±è‡ªç„¶è€Œè¨€çš„å¯ä»¥å‡ºæ¥çº¦ä¼šäº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;4&lt;/strong&gt;&lt;strong&gt;å…³äºç›¸äº²çš„ä¸€äº›çœ‹æ³•&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ç°åœ¨çš„ç›¸äº²å¯¹è±¡ï¼Œå¹¶ä¸ç€æ€¥ç»“å©šï¼Œäº«å—ç›¸å¤„çš„è¿‡ç¨‹ï¼Œä¸€æç»“å©šï¼Œå°±åµæ¶ï¼Œè¿™æ˜¯ç§ä»€ä¹ˆæ ·çš„æƒ³æ³•å‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;å…ˆèŠå¾®ä¿¡èƒ½èŠå‡ºæ¥å•¥ï¼Œä¸å¦‚å…ˆè§ï¼Œæ²¡çœ¼ç¼˜ä¹Ÿä¸åŠ å¾®ä¿¡ï¼Œè¦ä¸åˆ äº†è¿˜éº»çƒ¦ã€‚&lt;/p&gt;

&lt;p&gt;æ¥è§¦è¿‡ç¨‹ä¸­ï¼Œéƒ½ä¸æƒ³ä»˜å‡ºï¼Œç”šè‡³è¿è¯éƒ½ä¸æƒ³è¯´ï¼Œæ€»ä¼šè¯´æˆ‘è§‰å¾—æˆ‘ä»¬æ²¡æœ‰ä»€ä¹ˆè¯é¢˜ï¼Œæˆ–è€…æˆ‘ä»¬ä¸åˆé€‚å‘Šç»ˆã€‚&lt;/p&gt;

&lt;p&gt;è¯´å¥½æ¥è§¦ï¼Œå¯æ˜¯ï¼Œå½“ä½ å‘å‡ºå»å¾®ä¿¡åï¼Œè¿™ä¸ªä¿¡æ¯å°±å‡ºå»äº†ï¼Œç„¶åå°±æ²¡ç„¶åäº†ï¼Œè¿è¯éƒ½ä¸è¯´ï¼Œæ€ä¹ˆæ¥è§¦ç†Ÿæ‚‰ï¼Œæœ€åä¹Ÿæ˜¯ä»¥æˆ‘ä»¬ä¸åˆé€‚å‘Šç»ˆã€‚&lt;/p&gt;

&lt;p&gt;ç°åœ¨çš„ç›¸äº²ï¼Œä¸å•å•æ˜¯å¿…é¡»æœ‰è½¦å­ã€æˆ¿å­ã€ä½ æœ‰å¤šå°‘å­˜æ¬¾äº†ï¼Œé‡è¦çš„ä¸€ç‚¹æ˜¯ä½ å¿…é¡»å¾—æœ‰ç‚¹é¢œå€¼ï¼Œæ›´æœ‰ç”šè€…é™„åŠ çˆ¶æ¯å¿…é¡»æœ‰åŠ³ä¿ï¼Œæ˜¯å¦æ— ç—…ã€‚&lt;/p&gt;

&lt;p&gt;éƒ½è¯´ä½ è‹¥ä¸»åŠ¨ï¼Œæˆ‘ä»¬å°±æœ‰æ•…äº‹äº†ï¼Œéƒ½ä¸ä¸»åŠ¨ï¼Œæˆ–è€…åªç­‰å¯¹æ–¹ä¸»åŠ¨ï¼Œæ‹çˆ±æ˜¯ä¸¤ä¸ªäººçš„äº‹ï¼Œä¸€ä¸ªäººé‚£ä¾¿æ˜¯è‡ªä½œå¤šæƒ…äº†ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/718867/201906/718867-20190616084305522-281644652.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;


&lt;p&gt;&lt;strong&gt;ç’çè¯´ï¼šâ€œè‡ªç„¶ï¼Œæˆ‘ä»˜å‡ºä¸‰åˆ†ï¼Œå¾—è®©ä»–è§äº”åˆ†ã€‚ä»˜å‡ºäº”åˆ†ï¼Œå¾—è®©ä»–è¿˜ååˆ†ã€‚åªæœ‰è¿™æ ·æ‰æ˜¯å…¬å¹³å…¬æ­£ï¼Œè‹¥ä¸€ç›´èƒŒåœ°ä»˜å‡ºï¼Œæ ¹æœ¬æ²¡äººæ‡‚å¾—çæƒœã€‚â€&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸æ„¿æ„å°±æ—©æ—©è¯´ï¼Œä½•å¿…è€—ç€åœ°æ–¹ï¼Œè®©ç­‰å¾…çš„ä¸€æ–¹æå‡ºä¸åˆé€‚ä¹‹ç±»çš„è¯ï¼Œè¿™æ ·çœŸçš„å¾ˆæŠ˜ç£¨äººå¿ƒï¼Œæ—¶é—´å®è´µï¼Œæ¯•ç«Ÿå¤§å®¶éƒ½æŒºå¿™çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;éƒ½è¯´åœ¨çˆ±æƒ…é‡Œæœ€æ£’çš„çŠ¶æ€æ˜¯ç›¸çˆ±çš„æ—¶å€™ï¼Œæˆ‘ä»˜å‡ºçš„ä¸€åˆ‡éƒ½æ˜¯å¿ƒç”˜æƒ…æ„¿ã€‚ä½ è‹¥æŠ•æ¡ƒæŠ¥æï¼Œæˆ‘å¿…å¿ƒç”Ÿæ¬¢å–œã€‚ç›´åˆ°æœ‰ä¸€å¤©ï¼Œæˆ‘ä¸æ„¿å†è¿™èˆ¬çˆ±ä½ ï¼Œé‚£å°±è®©æˆ‘ä»¬ï¼Œä¸€åˆ«ä¸¤å®½ï¼Œå„ç”Ÿæ¬¢å–œã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;çˆ±æƒ…ï¼Œæ˜¯éœ€è¦ä½ ä¸»åŠ¨ï¼Œä¸ä¸»åŠ¨ï¼Œå“ªé‡Œä¼šæœ‰æ•…äº‹å‘ç”Ÿï¼&lt;/p&gt;

</description>
<pubDate>Sat, 15 Jun 2019 15:48:00 +0000</pubDate>
<dc:creator>Refain</dc:creator>
<og:description>å¦‚æœå¹´è¿‘30å²ï¼Œå¯¹äºæ¯ä¸ªå•èº«çš„ç”·ã€å¥³åŒå­¦æ¥è¯´ï¼Œéƒ½æ˜¯ä¸ªæå…¶å…·æœ‰å‹åŠ›çš„äº‹æƒ…ã€‚ ç®€å•æ¥è¯´ï¼Œæœ‰ä¸¤æ–¹é¢ï¼š å®¶åº­æ–¹é¢ é¦–å…ˆçˆ¶æ¯å±‚é¢æœ€å¤§ï¼Œæ¯å¤©è¦é¢å¯¹çˆ¶æ¯çš„â€œå˜´éâ€ï¼Œè¿™æ—¶å€™ä¸æƒ³è¯´è¯ã€‚å…¶æ¬¡å°±æ˜¯é‚»å±…å°åŒºæ–¹é¢ã€äº²æˆšé€¢å¹´è¿‡èŠ‚</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/longronglang/p/11029355.html</dc:identifier>
</item>
<item>
<title>ä»æå‡æ ‘åˆ° XGBoost, åŸç†ç®€ä»‹ - resolvent</title>
<link>http://www.cnblogs.com/shiina922/p/11029340.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/shiina922/p/11029340.html</guid>
<description>&lt;h2 id=&quot;æå‡æ ‘-boosting-trees&quot;&gt;æå‡æ ‘ (Boosting Trees)&lt;/h2&gt;
&lt;p&gt;æå‡æ ‘æ˜¯ä»¥åˆ†ç±»æ ‘æˆ–å›å½’æ ‘ä¸ºåŸºæœ¬åˆ†ç±»å™¨çš„æå‡æ–¹æ³•, æ¨¡å‹è¡¨ç¤ºä¸ºå†³ç­–æ ‘çš„åŠ æ³•æ¨¡å‹:&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ F_M(x) = \sum_{m=0}^M f(x;\Theta_m), \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ &lt;span class=&quot;math inline&quot;&gt;\(M\)&lt;/span&gt; ä¸ºæ ‘çš„ä¸ªæ•°, &lt;span class=&quot;math inline&quot;&gt;\(f(x;\Theta_m)\)&lt;/span&gt; è¡¨ç¤ºå†³ç­–æ ‘, &lt;span class=&quot;math inline&quot;&gt;\(\Theta_m\)&lt;/span&gt; ä¸ºå…¶å‚æ•°.&lt;/p&gt;
&lt;h3 id=&quot;æå‡æ ‘ç®—æ³•&quot;&gt;1. æå‡æ ‘ç®—æ³•&lt;/h3&gt;
&lt;p&gt;æå‡æ ‘ç®—æ³•é‡‡ç”¨å‘å‰åˆ†æ­¥ (forward stagewise) ç®—æ³• (æœ¬è´¨ä¸Šæ˜¯ä¸€ç§è´ªå¿ƒç®—æ³•). å¯¹äºè®­ç»ƒæ•°æ®é›† &lt;span class=&quot;math inline&quot;&gt;\(D = \{(x_i, y_i) \}_{i=1}^Nâ€‹\)&lt;/span&gt;, é¦–å…ˆç¡®å®šåˆå§‹æå‡æ ‘ &lt;span class=&quot;math inline&quot;&gt;\(F_0(x)=0â€‹\)&lt;/span&gt;, ç„¶åç¬¬ &lt;span class=&quot;math inline&quot;&gt;\(mâ€‹\)&lt;/span&gt; æ­¥çš„æ¨¡å‹æ˜¯&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ F_m(x) = F_{m-1}(x) + f(x;\Theta_m), \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ &lt;span class=&quot;math inline&quot;&gt;\(F_{m-1}\)&lt;/span&gt; ä¸ºå½“å‰æ¨¡å‹, é€šè¿‡ç»éªŒé£é™©æœ€å°åŒ–ç¡®å®šä¸‹ä¸€é¢—å†³ç­–æ ‘çš„å‚æ•°,&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ \hat\Theta_m = \operatorname*{argmin}_{\Theta_m}\sum_{i=1}^N l(y_i, F_{m-1}(x_i) + f(x_i;\Theta_m)), \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ &lt;span class=&quot;math inline&quot;&gt;\(l\)&lt;/span&gt; ä¸ºæŸå¤±å‡½æ•°.&lt;/p&gt;
&lt;p&gt;å›å½’é—®é¢˜çš„æå‡æ ‘å¯ä»¥è¡¨ç¤ºä¸ºç®€å•å‡½æ•°&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ f(x;\Theta) = \sum_{j=1}^T c_j 1_{R_j}(x), \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ &lt;span class=&quot;math inline&quot;&gt;\(R_j\)&lt;/span&gt; äº’ä¸ç›¸äº¤, &lt;span class=&quot;math inline&quot;&gt;\(1_{R_j}(x)\)&lt;/span&gt; ä¸ºç¤ºæ€§å‡½æ•°, &lt;span class=&quot;math inline&quot;&gt;\(c_j\)&lt;/span&gt; ä¸ºå¸¸æ•°, å‚æ•° &lt;span class=&quot;math inline&quot;&gt;\(\Theta=\{(R_j,c_j)\}_{j=1}^T\)&lt;/span&gt;, &lt;span class=&quot;math inline&quot;&gt;\(T\)&lt;/span&gt; ä¸ºå¶èŠ‚ç‚¹ä¸ªæ•°.&lt;/p&gt;
&lt;p&gt;ç»¼ä¸Š,&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;å›å½’é—®é¢˜çš„æå‡æ ‘ç®—æ³•&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;åˆå§‹åŒ– &lt;span class=&quot;math inline&quot;&gt;\(F_0(x) = 0\)&lt;/span&gt;.&lt;/li&gt;
&lt;li&gt;å¯¹ &lt;span class=&quot;math inline&quot;&gt;\(m = 1,\dots,M\)&lt;/span&gt;: (a) é€šè¿‡ç»éªŒé£é™©æœ€å°åŒ–å­¦ä¹ ä¸€ä¸ªå›å½’æ ‘ &lt;span class=&quot;math inline&quot;&gt;\(f(x;\Theta_m)\)&lt;/span&gt;. (b) æ›´æ–° &lt;span class=&quot;math inline&quot;&gt;\(F_m(x) = F_{m-1}(x) + f(x;\Theta_m)\)&lt;/span&gt;.&lt;/li&gt;
&lt;li&gt;è¾“å‡ºå›å½’é—®é¢˜æå‡æ ‘ &lt;span class=&quot;math inline&quot;&gt;\(F_M(x) = \sum_{m=1}^M f(x;\Theta_m)\)&lt;/span&gt;.&lt;/li&gt;
&lt;/ol&gt;&lt;/blockquote&gt;
&lt;h3 id=&quot;æ¢¯åº¦æå‡æ ‘-gradient-boosting-decision-trees&quot;&gt;2. æ¢¯åº¦æå‡æ ‘ (Gradient Boosting Decision Trees)&lt;/h3&gt;
&lt;p&gt;å¯¹äºä¸€èˆ¬çš„æŸå¤±å‡½æ•°, æ¯ä¸€æ­¥ç»éªŒé£é™©æœ€å°åŒ–éƒ½ä¸å®¹æ˜“. GBDT æ˜¯ä¸ºäº†ä¾¿äºè®¡ç®—è€Œæå‡ºçš„æ–¹æ³•, å®ƒçš„ä¸»è¦æƒ³æ³•æ¥è‡ªäºæ¢¯åº¦ä¸‹é™æ³•.&lt;/p&gt;
&lt;p&gt;è®°æŸå¤±å‡½æ•°çš„æ¢¯åº¦åœ¨å½“å‰æ¨¡å‹çš„å€¼ä¸º&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ g_{im} = \left(\frac{\partial l(y_i,F(x_i))}{\partial F(x_i)}\right)_{F = F_{m-1}}. \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;åˆ™ç”±æ¢¯åº¦ä¸‹é™æ³•,&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ F_m(x_i) = F_{m-1}(x_i) -\rho_m g_{im}, \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­æ­¥é•¿ &lt;span class=&quot;math inline&quot;&gt;\(\rho_m\)&lt;/span&gt; å¯ä»¥é€šè¿‡çº¿æœç´¢è·å¾—, å³&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ \rho_m = \operatorname*{argmin}_{\rho} \sum_{i=1}^Nl(y_i, F_{m-1}(x_i)-\rho g_{im}). \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;æ¢¯åº¦ä¸‹é™æ³•æ˜¯ä¸€ä¸ªå¾ˆè´ªå¿ƒçš„ç®—æ³•, å³åœ¨å½“å‰ç‚¹å–å‡½æ•°ä¸‹é™æœ€å¿«çš„æ–¹å‘. ä½†å¦‚ä¸Šè¿™æ ·åšçš„è¯æˆ‘ä»¬åªè·å¾—äº†åœ¨è®­ç»ƒæ•°æ®ç‚¹ä¸Šçš„é¢„æµ‹, ä¸ºäº†å¾—åˆ°å¯ä»¥é¢„æµ‹æ–°æ•°æ®çš„å†³ç­–æ ‘, ä¸€ç§å¯è¡Œçš„åšæ³•æ˜¯, ç”¨ &lt;span class=&quot;math inline&quot;&gt;\(f\)&lt;/span&gt; é€¼è¿‘è´Ÿæ¢¯åº¦æ–¹å‘, ESL [2] p. 321 ä½¿ç”¨äº†å¹³æ–¹è¯¯å·®æ¥åº¦é‡ &lt;span class=&quot;math inline&quot;&gt;\(f\)&lt;/span&gt; ä¸è´Ÿæ¢¯åº¦çš„è·ç¦», å³&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ \tilde\Theta_m = \operatorname*{argmin}_{\Theta}\sum_{i=1}^N (-g_{im} - f(x_i;\Theta))^2. \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;æ³¨æ„åˆ°å¯¹äº &lt;span class=&quot;math inline&quot;&gt;\(l(x,y) = \frac12(x-y)^2\)&lt;/span&gt; çš„æƒ…å½¢, &lt;span class=&quot;math inline&quot;&gt;\(\tilde\Theta_m\)&lt;/span&gt; ä¸ &lt;span class=&quot;math inline&quot;&gt;\(\hat\Theta_m\)&lt;/span&gt; ç›¸ç­‰.&lt;/p&gt;
&lt;p&gt;å…¶ä½™æ“ä½œåŒæå‡æ ‘ç®—æ³•, ä»ç•¥.&lt;/p&gt;
&lt;h3 id=&quot;xgboost&quot;&gt;3. XGBoost&lt;/h3&gt;
&lt;h4 id=&quot;æ€»ä½“æ¡†æ¶&quot;&gt;3.1. æ€»ä½“æ¡†æ¶&lt;/h4&gt;
&lt;p&gt;XGBoost çš„ä¸»è¦æƒ³æ³•æ˜¯, é™¤äº†åŸæœ‰çš„æŸå¤±å‡½æ•°, åœ¨ç›®æ ‡å‡½æ•°ä¸­åŠ å…¥æ­£åˆ™é¡¹, åˆ©ç”¨äºŒé˜¶ Taylor è¿‘ä¼¼ä»£æ›¿ç›®æ ‡å‡½æ•°å†æ±‚æå€¼ (å›å¿†ä¹‹å‰çš„æ¢¯åº¦æå‡æ ‘åªç”¨äº†ä¸€é˜¶å¯¼æ•°), å…¶ä½™æ“ä½œåŒæå‡æ ‘ç®—æ³•.&lt;/p&gt;
&lt;p&gt;è®° &lt;span class=&quot;math inline&quot;&gt;\(F_m(x_i) = \hat y_i^{(m)}\)&lt;/span&gt;,&lt;br/&gt;&lt;span class=&quot;math inline&quot;&gt;\(\hat y_i^{(0)}=0\)&lt;/span&gt;,&lt;br/&gt;&lt;span class=&quot;math inline&quot;&gt;\(\hat y_i^{(m)} = \hat y_i^{(m-1)} + f_m(x_i)\)&lt;/span&gt;, &lt;span class=&quot;math inline&quot;&gt;\(m=1,\dots,M\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math inline&quot;&gt;\(f_m\)&lt;/span&gt; è¡¨ç¤ºç¬¬ &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; è½®æ—¶æ‰€å¾—çš„æ ‘, æ˜¯ç”±æœ€å°åŒ–ç›®æ ‡å‡½æ•°è€Œå¾—; &lt;span class=&quot;math inline&quot;&gt;\(\hat y_i^{(m)}\)&lt;/span&gt; è¡¨ç¤ºç¬¬ &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; è½®æ—¶ &lt;span class=&quot;math inline&quot;&gt;\(y_i\)&lt;/span&gt; çš„é¢„æµ‹å€¼.&lt;/p&gt;
&lt;p&gt;ç¬¬ &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; è½®ç›®æ ‡å‡½æ•°ä¸º&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ \mathrm{Obj}^{(m)} = \sum_{i=1}^N l\left(y_i, \hat y_i^{(m-1)} + f_m(x_i)\right) + \Omega(f_m), \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ &lt;span class=&quot;math inline&quot;&gt;\(l\)&lt;/span&gt; ä¸ºæŸå¤±å‡½æ•°; &lt;span class=&quot;math inline&quot;&gt;\(\Omega\)&lt;/span&gt; ä¸ºæ­£åˆ™é¡¹, æ˜¯äººä¸ºå®šä¹‰çš„å¤æ‚åº¦, å¯ä»¥é™ä½æ¨¡å‹å¤æ‚åº¦, å‡å°è¿‡æ‹Ÿåˆçš„é£é™©, åœ¨åŸè®ºæ–‡ [3] ä¸­å®šä¹‰ä¸º&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ \Omega(f) = \gamma T + \frac12 \lambda\sum_{j=1}^T w_j^2, \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ &lt;span class=&quot;math inline&quot;&gt;\(\gamma\)&lt;/span&gt;, &lt;span class=&quot;math inline&quot;&gt;\(\lambda\)&lt;/span&gt; ä¸ºå‚æ•°, &lt;span class=&quot;math inline&quot;&gt;\(T\)&lt;/span&gt; ä¸º &lt;span class=&quot;math inline&quot;&gt;\(f\)&lt;/span&gt; è¡¨ç¤ºçš„æ•°çš„å¶èŠ‚ç‚¹æ•°, &lt;span class=&quot;math inline&quot;&gt;\(w_j\)&lt;/span&gt; ä¸ºç¬¬ &lt;span class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt; ä¸ªå¶èŠ‚ç‚¹çš„é¢„æµ‹å€¼ (æƒé‡).&lt;/p&gt;
&lt;p&gt;é™¤äº†åŠ å…¥æ­£åˆ™é¡¹å¤–, è¿˜å¯ä»¥é€šè¿‡ shrinkage æ¥é™ä½è¿‡æ‹Ÿåˆé£é™©, å³ &lt;span class=&quot;math inline&quot;&gt;\(F_m = F_{m-1} + \nu f_m\)&lt;/span&gt;, å…¶ä¸­ &lt;span class=&quot;math inline&quot;&gt;\(0&amp;lt;\nu&amp;lt;1\)&lt;/span&gt;, å¯ä»¥çœ‹ä¸ºå­¦ä¹ ç‡, åŸæ¥çš„åšæ³•ç›¸å½“äºå– &lt;span class=&quot;math inline&quot;&gt;\(\nu=1\)&lt;/span&gt;. è¿™ä¹ˆåšä¸»è¦çš„ç†ç”±æ˜¯å‡å°‘æ¯é¢—æ ‘å¯¹æ€»æ¨¡å‹çš„å½±å“, é˜²æ­¢å‰å‡ é¢—æ ‘æ‹Ÿåˆåœ°å¤ªå¥½ (è¿‡æ‹Ÿåˆ) ä»¥è‡³äºåé¢çš„æ ‘æ²¡æœ‰äº†å­¦ä¹ ç©ºé—´.&lt;/p&gt;
&lt;h4 id=&quot;å¯»æ‰¾åˆ†è£‚ç‚¹&quot;&gt;3.2. å¯»æ‰¾åˆ†è£‚ç‚¹&lt;/h4&gt;
&lt;p&gt;å¯¹ç›®æ ‡å‡½æ•°åšäºŒé˜¶ Taylor å±•å¼€, ç•¥å»æ›´é«˜é˜¶çš„æ— ç©·å°é‡. è®°&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ g_i = \frac{\partial l(y_i, \hat y_i^{(m-1)})}{\partial{\hat y^{(m-1)}}},\quad h_i = \frac{\partial^2 l(y_i, \hat y_i^{(m-1)})}{\partial{\left(\hat y^{(m-1)}\right)^2}}. \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚å¯¹äºå¹³æ–¹æŸå¤±å‡½æ•° &lt;span class=&quot;math inline&quot;&gt;\((y_i - \hat y_i^{(m-1)})^2\)&lt;/span&gt; æ¥è¯´, &lt;span class=&quot;math inline&quot;&gt;\(g_i = 2(\hat y_i^{(m-1)} - y_i)\)&lt;/span&gt;, &lt;span class=&quot;math inline&quot;&gt;\(h_i = 2\)&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;ç»è¿‡ç®€å•çš„æ¨å¯¼å¯å¾—æœ€ä¼˜æƒé‡ä¸º&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ w_j^* = -\frac{\sum_{i\in I_j}g_i}{\sum_{i\in I_j} h_i + \lambda}, \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ &lt;span class=&quot;math inline&quot;&gt;\(I_j\)&lt;/span&gt; è¡¨ç¤ºè¢«å½’åˆ°ç¬¬ &lt;span class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt; ä¸ªå¶èŠ‚ç‚¹çš„å…¨ä½“å®ä¾‹ (çš„è„šæ ‡) é›†åˆ.&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬è€Œè¨€, ç©·ä¸¾æ‰€æœ‰å¯èƒ½çš„æ ‘ç»“æ„æ˜¯ä¸å¯èƒ½çš„, ä½œä¸ºä»£æ›¿, æˆ‘ä»¬è€ƒè™‘è´ªå¿ƒç®—æ³•. ä»ä¸€ä¸ªå¶èŠ‚ç‚¹å¼€å§‹äºŒåˆ†, å‡è®¾ &lt;span class=&quot;math inline&quot;&gt;\(I_L\)&lt;/span&gt; å’Œ &lt;span class=&quot;math inline&quot;&gt;\(I_R\)&lt;/span&gt; åˆ†åˆ«è¡¨ç¤ºåˆ†è£‚åå½’ä¸ºå·¦èŠ‚ç‚¹å’Œå³èŠ‚ç‚¹çš„å®ä¾‹é›†åˆ, è®° &lt;span class=&quot;math inline&quot;&gt;\(I = I_L \cup I_R\)&lt;/span&gt;, åˆ™æ˜“å¾—åˆ†è£‚åçš„ç›®æ ‡å‡½æ•°å‡å°‘å€¼ (loss reduction) ä¸º&lt;/p&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[ \frac12\left[\frac{(\sum_{i\in I_L}g_i)^2}{\sum_{i\in I_L} h_i + \lambda} + \frac{(\sum_{i\in I_R}g_i)^2}{\sum_{i\in I_R} h_i + \lambda} - \frac{(\sum_{i\in I}g_i)^2}{\sum_{i\in I} h_i + \lambda}\right] - \gamma \]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;æŠŠä¸Šå¼ç¬¬ä¸€é¡¹è§†ä¸º gain, åˆ™ &lt;span class=&quot;math inline&quot;&gt;\(\gamma\)&lt;/span&gt; ç›¸å½“äºè®¾ç½®äº†åˆ†è£‚æ‰€éœ€çš„æœ€å°çš„ gain, èµ·åˆ°äº†å‰ªæçš„ä½œç”¨.&lt;/p&gt;
&lt;blockquote readability=&quot;16&quot;&gt;
&lt;p&gt;å¯»æ‰¾åˆ†è£‚ç‚¹çš„ç²¾ç¡®è´ªå¿ƒç®—æ³• (åŸæ–‡ [3] ä¸­æœ¬æ®µæœ‰ä¸€äº› typo)&lt;br/&gt;è¾“å…¥: &lt;span class=&quot;math inline&quot;&gt;\(I\)&lt;/span&gt;, å½“å‰èŠ‚ç‚¹çš„å®ä¾‹é›†; &lt;span class=&quot;math inline&quot;&gt;\(d\)&lt;/span&gt;, ç‰¹å¾ç»´æ•° (ä¸ªæ•°).&lt;br/&gt;åˆå§‹åŒ– &lt;span class=&quot;math inline&quot;&gt;\(\mathrm{gain} \leftarrow 0\)&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;math inline&quot;&gt;\(G \leftarrow \sum_{i\in I}g_i\)&lt;/span&gt;, &lt;span class=&quot;math inline&quot;&gt;\(H \leftarrow \sum_{i\in I}h_i\)&lt;/span&gt;&lt;br/&gt;for &lt;span class=&quot;math inline&quot;&gt;\(k=1\)&lt;/span&gt; to &lt;span class=&quot;math inline&quot;&gt;\(d\)&lt;/span&gt; do&lt;br/&gt;Â Â Â Â  &lt;span class=&quot;math inline&quot;&gt;\(G_L \leftarrow 0\)&lt;/span&gt;, &lt;span class=&quot;math inline&quot;&gt;\(H_L \leftarrow 0\)&lt;/span&gt;&lt;br/&gt;Â Â Â Â  for &lt;span class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt; in sorted (&lt;span class=&quot;math inline&quot;&gt;\(I\)&lt;/span&gt;, by &lt;span class=&quot;math inline&quot;&gt;\(x_{jk}\)&lt;/span&gt;) do&lt;br/&gt;Â Â Â Â Â Â Â Â  &lt;span class=&quot;math inline&quot;&gt;\(G_L\leftarrow G_L + g_j\)&lt;/span&gt;, &lt;span class=&quot;math inline&quot;&gt;\(H_L\leftarrow H_L + h_j\)&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â  &lt;span class=&quot;math inline&quot;&gt;\(G_R \leftarrow G-G_L\)&lt;/span&gt;, &lt;span class=&quot;math inline&quot;&gt;\(H_R \leftarrow H- H_L\)&lt;/span&gt;&lt;br/&gt;Â Â Â Â Â Â Â Â  &lt;span class=&quot;math inline&quot;&gt;\(\mathrm{gain} \leftarrow \max(\mathrm{gain}, \frac{G_L^2}{H_L + \lambda} + \frac{G_R^2}{H_R + \lambda} - \frac{G^2}{H + \lambda})\)&lt;/span&gt;&lt;br/&gt;è¾“å‡º: æœ€å¤§ gain çš„åˆ†è£‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç²¾ç¡®è´ªå¿ƒæ³•æ˜¯åœ¨æ‰€æœ‰ç‰¹å¾ä¸Š, å¯¹æ‰€æœ‰å¯èƒ½çš„åˆ†è£‚ç‚¹éƒ½è¿›è¡Œéå†, åœ¨æ•°æ®é‡å¤§çš„æ—¶å€™æ˜¯ä¸ç°å®çš„. ä¸€ä¸ªç®€å•çš„è¿‘ä¼¼æ–¹æ³•æ˜¯, æ’åºå (for &lt;span class=&quot;math inline&quot;&gt;\(j\)&lt;/span&gt; in sorted (&lt;span class=&quot;math inline&quot;&gt;\(I\)&lt;/span&gt;, by &lt;span class=&quot;math inline&quot;&gt;\(x_{jk}\)&lt;/span&gt;) é‚£æ­¥), å–é€‚å½“çš„åˆ†ä½æ•°ä½œä¸ºåˆ†è£‚å€™é€‰ç‚¹è¿›è¡Œè´ªå¿ƒç®—æ³•.&lt;/p&gt;
&lt;h4 id=&quot;ç¨€ç–æ•°æ®çš„åˆ†è£‚ç‚¹å¯»æ‰¾-sparsity-aware&quot;&gt;3.3. ç¨€ç–æ•°æ®çš„åˆ†è£‚ç‚¹å¯»æ‰¾ (sparsity-aware)&lt;/h4&gt;
&lt;p&gt;ä¸»è¦åˆ†ä¸ºä¸¤ç§æƒ…å†µ:&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;è‹¥æ•°æ®æœ‰ç¼ºå¤±å€¼, åˆ™æŠŠç¼ºå¤±å€¼éƒ½å½’åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹. è¿™æ˜¯å¤„ç†ç¼ºå¤±å€¼çš„å¸¸ç”¨æ–¹æ³•ä¹‹ä¸€ (å¦ä¸€ç§å¸¸ç”¨æ–¹æ³•æ˜¯ç”¨é€‚å½“çš„æ–¹æ³•å¡«è¡¥ç¼ºå¤±å€¼), è¿™ä½¿å¾— XGB å¯ä»¥ç›´æ¥è®­ç»ƒå’Œé¢„æµ‹å¸¦æœ‰ç¼ºå¤±å€¼çš„æ•°æ®.&lt;/li&gt;
&lt;li&gt;è‹¥æ•°æ®ç¨€ç– (æ¯”å¦‚ one-hot ç¼–ç , ä½¿å¾—æ•°æ®åŒ…å«å¤§é‡çš„ 0), åˆ™æŠŠ 0 å½“åšç¼ºå¤±å€¼å¤„ç†. è¿™ä¸ªåšæ³•çš„å…³é”®ç‚¹åœ¨äºéå†æ—¶åªå¯¹éç¼ºå¤± (éé›¶) æ•°æ®éå†, åœ¨ç¨€ç–æ•°æ®çš„æƒ…å†µä¸‹ä¼šå¤§å¤§æé«˜è®­ç»ƒé€Ÿç‡.&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;æ³¨: æŒ‰ç…§åŸè®ºæ–‡ [3] çš„è¯´æ³•, ä½œè€…ä¼¼ä¹æŠŠç¼ºå¤±å’Œç¨€ç–æ—¶çš„ 0 éƒ½ç»Ÿç§°ä¸º &quot;ç¨€ç–/ç¼ºå¤±&quot;, ç”¨åŒæ ·çš„æ–¹å¼å¤„ç†, [5] ä¹Ÿè¯å®äº†è¿™ä¸€ç‚¹.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://upload-images.jianshu.io/upload_images/6127196-6d65d0c25f3853d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å›¾ä¸­ &lt;span class=&quot;math inline&quot;&gt;\(m\)&lt;/span&gt; åº”è¯¥ä¸º &lt;span class=&quot;math inline&quot;&gt;\(d\)&lt;/span&gt;, score åº”è¯¥ä¸º gain.&lt;/p&gt;
&lt;h4 id=&quot;xgb-çš„ä¼˜ç‚¹&quot;&gt;3.4. XGB çš„ä¼˜ç‚¹&lt;/h4&gt;
&lt;p&gt;XGB æŠŠå†³ç­–æ ‘çš„è®¸å¤šå¯å‘å¼çš„æƒ³æ³•é€šè¿‡æœ€å°åŒ–ç›®æ ‡å‡½æ•°ç»Ÿä¸€èµ·æ¥å¤„ç†. é™¤äº†ä½¿ç”¨è¿‘ä¼¼ç®—æ³•, åœ¨ç³»ç»Ÿè®¾è®¡ä¸Š, é€šè¿‡å¹¶è¡Œå¤„ç†, ä¼˜åŒ–ç¼“å­˜ç­‰å·¥ç¨‹å±‚é¢ä¸Šçš„ä¼˜åŒ–å¤§å¹…æé«˜äº†è¿è¡Œé€Ÿåº¦, å‡å°äº†å†…å­˜ä½¿ç”¨.&lt;/p&gt;
&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;
&lt;p&gt;[1] æèˆª. (2012). ç»Ÿè®¡å­¦ä¹ æ–¹æ³• (pp. 55-74, 137-153). åŒ—äº¬: æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾.&lt;br/&gt;[2] Friedman, J., Hastie, T., &amp;amp; Tibshirani, R. (2001). &lt;em&gt;The elements of statistical learning&lt;/em&gt; (pp. 299-344). New York: Springer series in statistics.&lt;br/&gt;[3] Chen, T., &amp;amp; Guestrin, C. (2016). Xgboost: A scalable tree boosting system. &lt;em&gt;Proceedings of the 22nd acm sigkdd international conference on knowledge discovery and data mining&lt;/em&gt; (pp. 785-794). ACM.&lt;br/&gt;[4] Introduction to Boosted Trees. (n.d.). Retrieved from &lt;a href=&quot;https://xgboost.readthedocs.io/en/latest/tutorials/model.html#&quot; class=&quot;uri&quot;&gt;https://xgboost.readthedocs.io/en/latest/tutorials/model.html#&lt;/a&gt;&lt;br/&gt;[5] Kodi Arfer. XGBoost, missing values, and sparsity. (2018). Retrieved from &lt;a href=&quot;http://arfer.net/w/xgboost-sparsity&quot; class=&quot;uri&quot;&gt;http://arfer.net/w/xgboost-sparsity&lt;/a&gt;&lt;/p&gt;
</description>
<pubDate>Sat, 15 Jun 2019 15:42:00 +0000</pubDate>
<dc:creator>resolvent</dc:creator>
<og:description>æå‡æ ‘ (Boosting Trees) æå‡æ ‘æ˜¯ä»¥åˆ†ç±»æ ‘æˆ–å›å½’æ ‘ä¸ºåŸºæœ¬åˆ†ç±»å™¨çš„æå‡æ–¹æ³•, æ¨¡å‹è¡¨ç¤ºä¸ºå†³ç­–æ ‘çš„åŠ æ³•æ¨¡å‹: $$ F_M(x) = \sum_{m=0}^M f(x;\Theta_m),</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/shiina922/p/11029340.html</dc:identifier>
</item>
<item>
<title>èŠèŠæ•°æ®åº“~6.SQLè¿ç»´ä¸­ç¯‡ - é²²é€¸é¹</title>
<link>http://www.cnblogs.com/dotnetcrazy/p/11029323.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/dotnetcrazy/p/11029323.html</guid>
<description>&lt;p&gt;ä¸Šç¯‡å›é¡¾ï¼š&lt;a href=&quot;https://www.cnblogs.com/dotnetcrazy/p/10810798.html#top&quot; class=&quot;uri&quot;&gt;https://www.cnblogs.com/dotnetcrazy/p/10810798.html#top&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;mysqlæ—¥å¿—ç›¸å…³&quot;&gt;1.6.5.MySQLæ—¥å¿—ç›¸å…³&lt;/h3&gt;
&lt;p&gt;æœ¬æ–‡çš„æµ‹è¯•ç¯å¢ƒï¼š&lt;code&gt;MySQL5.7.26&lt;/code&gt;ã€&lt;code&gt;MariaDB5.5.60&lt;/code&gt;ã€&lt;code&gt;MySQL8.0.16&lt;/code&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;PSï¼šç‰ˆæœ¬æŸ¥è¯¢&lt;code&gt;select version();&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;mysqlå¸¸ç”¨æ—¥å¿—&quot;&gt;1.MySQLå¸¸ç”¨æ—¥å¿—&lt;/h4&gt;
&lt;p&gt;æœåŠ¡å™¨å±‚æ—¥å¿—ï¼ˆå­˜å‚¨å¼•æ“å±‚æœ‰è‡ªå·±çš„æ—¥å¿—ï¼‰&lt;/p&gt;
&lt;table&gt;&lt;thead/&gt;&lt;tbody readability=&quot;8&quot;&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;&lt;code&gt;error_log&lt;/code&gt;(é”™è¯¯æ—¥å¿—)&lt;/td&gt;
&lt;td&gt;è®°å½•MySQLå¯åŠ¨ã€è¿è¡Œæˆ–åœæ­¢æ—¶å‡ºç°çš„é—®é¢˜&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;4&quot;&gt;&lt;td&gt;&lt;code&gt;general_log&lt;/code&gt;(å¸¸è§„æ—¥å¿—)&lt;/td&gt;
&lt;td&gt;è®°å½•æ‰€æœ‰å‘é€ç»™MySQLçš„è¯·æ±‚ï¼ˆè€—æ€§èƒ½ï¼‰&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;4&quot;&gt;&lt;td&gt;&lt;strong&gt;&lt;code&gt;slow_query_log&lt;/code&gt;&lt;/strong&gt;(æ…¢æŸ¥æ—¥å¿—)&lt;/td&gt;
&lt;td&gt;è®°å½•ç¬¦åˆæ¡ä»¶çš„æŸ¥è¯¢ï¼ˆegï¼šè¶…è¿‡10sã€æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ç­‰ï¼‰&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;4&quot;&gt;&lt;td&gt;&lt;strong&gt;&lt;code&gt;binary_log&lt;/code&gt;&lt;/strong&gt;(äºŒè¿›åˆ¶æ—¥å¿—)&lt;/td&gt;
&lt;td&gt;è®°å½•å…¨éƒ¨æœ‰æ•ˆçš„æ•°æ®ä¿®æ”¹æ—¥å¿—ï¼ˆè€ç‰ˆæœ¬æ•°æ®åº“ä¸ä¼šå¼€å¯ï¼‰&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;&lt;code&gt;relay_log&lt;/code&gt;(ä¸­ç»§æ—¥å¿—)&lt;/td&gt;
&lt;td&gt;ç”¨äºä¸»ä»å¤åˆ¶ï¼Œä¸´æ—¶å­˜å‚¨ä¸»ä»åŒæ­¥çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆå¢é‡å¤åˆ¶ï¼‰&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;çŸ¥è¯†æ‰©å±•ï¼š&lt;a href=&quot;https://blog.csdn.net/zhang123456456/article/details/72811875&quot; class=&quot;uri&quot;&gt;https://blog.csdn.net/zhang123456456/article/details/72811875&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®æ—¶æŸ¥çœ‹æ–‡ä»¶ï¼š&lt;code&gt;tail -f /var/log/mysqld.log&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;tail -f ç”¨äºç›‘è§†æ–‡ä»¶å¢é•¿ï¼ˆé»˜è®¤æ˜¯æœ«å°¾10è¡Œï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;error_logé”™è¯¯æ—¥å¿—&quot;&gt;2.error_logï¼ˆé”™è¯¯æ—¥å¿—ï¼‰&lt;/h4&gt;
&lt;p&gt;ä¸€èˆ¬è®°å½•MySQL&lt;code&gt;è¿è¡Œé”™è¯¯&lt;/code&gt;å’Œå’Œ&lt;code&gt;æœªæˆæƒçš„è®¿é—®&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;è€ç‰ˆï¼š&lt;code&gt;log_error&lt;/code&gt; + &lt;code&gt;log_warnings&lt;/code&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¸¸ç”¨ï¼š&lt;code&gt;log_error&lt;/code&gt; + &lt;code&gt;log_error_verbosity&lt;/code&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;æ–°ç‰ˆï¼š&lt;code&gt;log_error&lt;/code&gt; + &lt;code&gt;log_error_verbosity&lt;/code&gt; + &lt;code&gt;log_error_services&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/blockquote&gt;
&lt;p&gt;æŸ¥è¯¢MySQLé…ç½®ï¼š&lt;code&gt;show variables like '%log_error%';&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;SQLæŸ¥è¯¢å¯ä»¥è¿™ä¹ˆå¹²ï¼š&lt;/p&gt;
&lt;pre class=&quot;sql&quot;&gt;
&lt;code&gt;-- Ubuntuä¸‹é»˜è®¤æ˜¯ï¼š`/var/log/mysql/error.log`
-- CentOSä¸‹é»˜è®¤æ˜¯ï¼š`/var/log/mysqld.log` | `/var/log/mariadb/mariadb.log`
select @@log_error; -- å°½å¯èƒ½å’ŒDataåˆ†å¼€å­˜å‚¨

-- 0ï¼šä¸è®°å½•è­¦å‘Šä¿¡æ¯ï¼Œ1ï¼šå‘Šè­¦ä¿¡æ¯å†™å…¥é”™è¯¯æ—¥å¿—ï¼Œ2ï¼šå„ç±»å‘Šè­¦ä¿¡æ¯éƒ½å†™å…¥ï¼ˆeg:ç½‘ç»œæ•…éšœå’Œé‡è¿ä¿¡æ¯ï¼‰
select @@log_warnings; -- MySQL8ä¸­å·²ç»ç§»é™¤ï¼ˆMySQL5.7é»˜è®¤æ˜¯2ï¼ŒMariaDB5.5.60é»˜è®¤æ˜¯1ï¼‰

-- é”™è¯¯çº§åˆ«ï¼ˆ1ï¼šErrorï¼Œ2ï¼šErrorã€Warningï¼Œ3ï¼šErrorã€Warningã€Info
select @@log_error_verbosity; -- MySQL8é»˜è®¤æ˜¯2ï¼ŒMySQL5.7é»˜è®¤æ˜¯3
-- PSï¼šä»MySQL 5.7.2å¼€å§‹ï¼Œé¦–é€‰`log_error_verbosity`ç³»ç»Ÿå˜é‡

-- é»˜è®¤æ˜¯`log_filter_internal; log_sink_internal`
select @@log_error_services; -- MySQL8.0ä¸­æ–°å¢&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;PSï¼šå…¶å®MySQLåœ¨å¸‚é¢ä¸Šæœ‰å¾ˆå¤šæˆç†Ÿè§£å†³æ–¹æ¡ˆï¼ˆåŸºæœ¬ä¸Šéƒ½æ˜¯åŸºäº5.6ã€5.7çš„ï¼‰&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘å¼€ç¯‡ä¸»æ¨&lt;code&gt;MySQL5.7&lt;/code&gt;ç³»åˆ—å’Œ&lt;code&gt;MariaDB5.5.60&lt;/code&gt;ï¼ˆå¾ˆå¤šæ—¶å€™ä¸æ˜¯ä¸ç”¨æœ€æ–°DBï¼Œè€Œæ˜¯æ¶æ„ä¾èµ–åšä¸åˆ°å•Šï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;çŸ¥è¯†æ‹“å±•ï¼š&lt;a href=&quot;https://www.cnblogs.com/kerrycode/p/8973285.html&quot; class=&quot;uri&quot;&gt;https://www.cnblogs.com/kerrycode/p/8973285.html&lt;/a&gt;&lt;/p&gt;
&lt;h5 id=&quot;mysql8.0æ–°å¢å‚æ•°log_error_services&quot;&gt;MySQL8.0æ–°å¢å‚æ•°ï¼šlog_error_services&lt;/h5&gt;
&lt;p&gt;&lt;strong&gt;æ—¥å¿—æœåŠ¡ç»„ä»¶&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;table&gt;&lt;thead/&gt;&lt;tbody readability=&quot;4&quot;&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;&lt;code&gt;log_sink_internal&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;é»˜è®¤çš„æ—¥å¿—è¾“å‡ºç»„ä»¶ï¼ˆä¾èµ–&lt;code&gt;log_error&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;&lt;strong&gt;&lt;code&gt;log_filter_internal&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;é»˜è®¤çš„æ—¥å¿—è¿‡æ»¤ç»„ä»¶ï¼ˆä¾èµ–&lt;code&gt;log_error_verbosity&lt;/code&gt;ï¼‰&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;&lt;strong&gt;&lt;code&gt;log_sink_json&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;å°†é”™è¯¯æ—¥å¿—è¾“å‡ºåˆ°&lt;code&gt;json&lt;/code&gt;æ–‡ä»¶&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;2&quot;&gt;&lt;td&gt;&lt;code&gt;log_sink_syseventlog&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;å°†é”™è¯¯æ—¥å¿—è¾“å‡ºåˆ°ç³»ç»Ÿæ—¥å¿—æ–‡ä»¶&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;PSï¼š&lt;code&gt;log_filter_internal&lt;/code&gt;ï¼šè¿‡æ»¤é”™è¯¯ä¿¡æ¯ï¼ˆ&lt;strong&gt;è¾¾ä¸åˆ°çº§åˆ«çš„ä¸è®°å½•&lt;/strong&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ—¥è®°æ ¼å¼ä¸€èˆ¬æ˜¯è¿™æ ·çš„&lt;/strong&gt;ï¼š&lt;code&gt;UTCæ—¶é—´æˆ³ è¿›ç¨‹id [æ—¥å¿—çº§åˆ«] [é”™è¯¯ä»£ç ] [ç”±ä»€ä¹ˆäº§ç”Ÿçš„æ—¥å¿—ï¼ˆServer or Clientï¼‰] è¯¦ç»†ä¿¡æ¯&lt;/code&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;egï¼š&lt;code&gt;2019-05-19T09:54:11.590474Z 8 [Warning] [MY-010055] [Server] IP address '192.168.36.144' could not be resolved: Name or service not known&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;ä¸€èˆ¬&lt;code&gt;log_sink_json&lt;/code&gt;ç”¨çš„æ¯”è¾ƒå¤š&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;1.3125&quot;&gt;
&lt;p&gt;å®˜æ–¹æ–‡æ¡£å‚è€ƒï¼š&lt;a href=&quot;https://dev.mysql.com/doc/refman/8.0/en/error-log-json.html&quot; class=&quot;uri&quot;&gt;https://dev.mysql.com/doc/refman/8.0/en/error-log-json.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;PSï¼šç¬¬ä¸€æ¬¡ä½¿ç”¨éœ€è¦å®‰è£…ä¸€ä¸‹jsonç»„ä»¶ï¼š&lt;code&gt;install component 'file://component_log_sink_json';&lt;/code&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;strong&gt;å¸¸ç”¨è®¾ç½®ï¼š&lt;code&gt;set persist log_error_services='log_filter_internal;log_sink_json';&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&quot;æ—¶é—´æˆ³ç›¸å…³çš„å°çŸ¥è¯†ç‚¹&quot;&gt;æ—¶é—´æˆ³ç›¸å…³çš„å°çŸ¥è¯†ç‚¹&lt;/h5&gt;
&lt;p&gt;ä¸Šé¢çš„æ—¶é—´é»˜è®¤æ˜¯UTCçš„æ—¶é—´æˆ³ï¼Œå’Œæˆ‘ä»¬æ˜¯æœ‰æ—¶å·®çš„ï¼Œè¿™ä¸ªæ—¶é—´æˆ³å¯ä»¥é€šè¿‡è®¾ç½®&lt;code&gt;log_timestamps&lt;/code&gt;æ¥æœ¬åœ°åŒ–ï¼š&lt;/p&gt;
&lt;pre class=&quot;sql&quot;&gt;
&lt;code&gt;-- æŸ¥è¯¢
select @@log_timestamps; -- MySQL5.7æ–°å¢

-- ä»8å¼€å§‹,å¯é€šè¿‡SET PERSISTå‘½ä»¤å°†å…¨å±€å˜é‡çš„ä¿®æ”¹æŒä¹…åŒ–åˆ°é…ç½®æ–‡ä»¶ä¸­
set persist log_timestamps='SYSTEM'; -- éœ€è¦rootæƒé™&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;PSï¼š&lt;code&gt;set persist&lt;/code&gt;ç”Ÿæˆçš„é…ç½®æ–‡ä»¶è·¯å¾„åœ¨ï¼š&lt;code&gt;/var/lib/mysql/mysqld-auto.cnf&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&quot;general_logå¸¸è§„æ—¥å¿—&quot;&gt;3.general_logï¼ˆå¸¸è§„æ—¥å¿—ï¼‰&lt;/h4&gt;
&lt;p&gt;ä»¥å‰å¼€å‘è°ƒè¯•çš„æ—¶å€™åŸºæœ¬ä¸Šéƒ½æ˜¯ä¼šå¼€å¯çš„ï¼Œä¸Šçº¿åå…³é—­ï¼ˆç³»ç»ŸV1åˆæœŸçš„æ—¶å€™ä¹Ÿä¼šå¼€å¯ä¸€æ®µæ—¶é—´ï¼‰&lt;/p&gt;
&lt;blockquote readability=&quot;4.2857142857143&quot;&gt;
&lt;p&gt;&lt;strong&gt;ç°åœ¨å¼€å‘å¯ä»¥ä½¿ç”¨&lt;a href=&quot;https://www.cnblogs.com/dotnetcrazy/p/10443522.html&quot;&gt;go-sniffer&lt;/a&gt;æ¥æŠ“åŒ…æŸ¥çœ‹å®¢æˆ·ç«¯æ‰§è¡Œçš„SQL&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre class=&quot;sql&quot;&gt;
&lt;code&gt;-- æ˜¯å¦æ‰“å¼€å¸¸è§„æ—¥å¿—ï¼ˆ0ä¸æ‰“å¼€ï¼Œ1æ‰“å¼€ï¼‰
-- ä¸€èˆ¬ä¸æ‰“å¼€ï¼ˆæ€§èƒ½ï¼‰
select @@general_log; -- é»˜è®¤ä¸º0

-- Ubuntué»˜è®¤ï¼š/var/lib/mysql/ubuntuserver.log
-- CentOSé»˜è®¤ï¼š/var/lib/mysql/localhost.log
select @@general_log_file; -- å¸¸è§„æ—¥å¿—çš„è·¯å¾„

-- æ—¥å¿—çš„å­˜å‚¨æ–¹å¼ï¼ˆFILE | TABLE | NONEï¼‰
select @@log_output; -- é»˜è®¤æ˜¯æ–‡ä»¶å­˜å‚¨&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç®€å•çœ‹ä¸€ä¸‹å¸¸è§„æ—¥å¿—åœ¨æ•°æ®åº“ä¸­çš„ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201905/1127869-20190522182213738-70856259.png&quot; alt=&quot;2.å¸¸è§„æ—¥å¿—.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸´æ—¶å¼€å¯å‚è€ƒ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;
&lt;code&gt;# å¼€å¯
set global general_log = 1;

# set [global | persist] general_log_file = 'æ—¥å¿—è·¯å¾„';

set global log_output = 'TABLE';&lt;/code&gt;
&lt;/pre&gt;
&lt;h4 id=&quot;slow_query_logæ…¢æŸ¥è¯¢æ—¥å¿—&quot;&gt;4.&lt;code&gt;slow_query_log&lt;/code&gt;ï¼ˆæ…¢æŸ¥è¯¢æ—¥å¿—ï¼‰&lt;/h4&gt;
&lt;p&gt;è¿™ä¸ªæ˜¯&lt;code&gt;æœ€å¸¸ç”¨&lt;/code&gt;çš„ï¼ŒæŠŠç¬¦åˆæ¡ä»¶çš„æŸ¥è¯¢è¯­å¥è®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œ&lt;strong&gt;ä¸€èˆ¬éƒ½æ˜¯äº›éœ€è¦ä¼˜åŒ–çš„SQL&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;PSï¼šå‡ºç°æ€§èƒ½ç“¶é¢ˆçš„æ—¶å€™ï¼Œæˆ–è€…ä¸ºäº†ä¼˜åŒ–SQLä¼šå¼€å¯ä¸€æ®µæ—¶é—´ï¼ˆå°é¡¹ç›®æ¨èç›´æ¥å¼€å¯ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…ˆçœ‹ä¸‹é»˜è®¤å€¼ï¼š&lt;strong&gt;&lt;code&gt;show variables like '%slow%';&lt;/code&gt;ã€&lt;code&gt;show variables like 'long%';&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201905/1127869-20190522192146261-1133467961.png&quot; alt=&quot;2.æ…¢æŸ¥è¯¢.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SQLæŸ¥è¯¢&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;pre class=&quot;sql&quot;&gt;
&lt;code&gt;-- æ˜¯å¦å¼€å¯
select @@slow_query_log; -- é»˜è®¤æ˜¯å…³é—­

-- CentOSï¼š/var/lib/mysql/localhost-slow.log
-- Ubuntuï¼š/var/lib/mysql/ubuntuserver-slow.log
select @@slow_query_log_file;

-- æ¡ä»¶ï¼šè®¾ç½®è¶…è¿‡å¤šå°‘ç§’ä¸ºæ…¢æŸ¥è¯¢ï¼ˆä¸€èˆ¬è®¾ç½®1sï¼‰
select @@long_query_time; -- é»˜è®¤æ˜¯10sï¼ˆæ”¯æŒå°æ•°ï¼š0.003)

-- PSï¼šè®¾ç½®ä¸º0å°±ä¼šè®°å½•æ‰€æœ‰SQLï¼ˆä¸æ¨èè¿™ä¹ˆå¹²ï¼‰

-- æ¡ä»¶ï¼šæ²¡æœ‰ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢è®°å½•åˆ°æ—¥å¿—ä¸­
select @@log_queries_not_using_indexes; -- é»˜è®¤æ˜¯0ï¼ˆä¸å¼€å¯ï¼‰

-- è®°å½•optimize tableã€analyze tableå’Œalter tableçš„ç®¡ç†è¯­å¥
select @@log_slow_admin_statements; -- é»˜è®¤æ˜¯0ï¼ˆä¸å¼€å¯ï¼‰

-- è®°å½•ç”±Slaveæ‰€äº§ç”Ÿçš„æ…¢æŸ¥è¯¢
select @@log_slow_slave_statements;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;å¸¸ç”¨è®¾ç½®&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;PSï¼šé«˜å¹¶å‘ä¸‹çš„äº’è”ç½‘é¡¹ç›®ï¼Œå¯¹SQLæ‰§è¡Œæ—¶é—´çš„å®¹å¿åº¦ä¸€èˆ¬éƒ½æ˜¯&lt;strong&gt;ä½äº&lt;code&gt;300~500ms&lt;/code&gt;&lt;/strong&gt;çš„ï¼ˆ&lt;code&gt;long_query_time=0.05&lt;/code&gt;ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre class=&quot;shell&quot;&gt;
&lt;code&gt;# å¸¸ç”¨å¦‚ä¸‹ï¼šï¼ˆéœ€è¦MySQLçš„rootæƒé™ï¼‰
set global slow_query_log = 1; # å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
set global long_query_time = 1; # è®°å½•å¤§äº1sçš„SQL
set global log_slow_admin_statements = 1; # è®°å½•ç®¡ç†è¯­å¥
set global log_queries_not_using_indexes = 1; # è®°å½•æ²¡æœ‰ä½¿ç”¨ç´¢å¼•çš„SQL
# set [global | persist] slow_query_log_file = 'è·¯å¾„'; # è®¾ç½®logè·¯å¾„&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;è®¾ç½®&lt;code&gt;long_query_time&lt;/code&gt;æ—¶ï¼Œéœ€è¦é‡æ–°è¿æ¥æ‰èƒ½ç”Ÿæ•ˆï¼ˆä¸éœ€è¦é‡å¯DBï¼‰&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;PSï¼šå½“å‰ä¼šè¯ä¸ç”Ÿæ•ˆï¼Œä¹‹åçš„ä¼šè¯å°±ç”Ÿæ•ˆäº†ï¼ˆä¸æƒ³é‡è¿å¯ä»¥å†è®¾ç½®ä¸‹å½“å‰ä¼šè¯çš„&lt;code&gt;long_query_time&lt;/code&gt;ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;çŸ¥è¯†æ‹“å±•ï¼šï¼ˆ&lt;code&gt;chown mysql:mysql /work/log/xxx.log&lt;/code&gt;ï¼‰&lt;/p&gt;
&lt;h4 id=&quot;æ‰©å±•æ…¢æŸ¥è¯¢å·¥å…·&quot;&gt;æ‰©å±•ï¼šæ…¢æŸ¥è¯¢å·¥å…·&lt;/h4&gt;
&lt;p&gt;å…ˆç®€å•åˆ†æä¸‹æ…¢æŸ¥è¯¢æ—¥å¿—ï¼š&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;
&lt;code&gt;# Time: 2019-05-22T21:16:28.759491+08:00
# User@Host: root[root] @ localhost []  Id:    11
# Query_time: 0.000818  Lock_time: 0.000449 Rows_sent: 5  Rows_examined: 5
SET timestamp=1558530988;
select * from mysql.user order by host; # SQLè¯­å¥&lt;/code&gt;
&lt;/pre&gt;
&lt;ol&gt;&lt;li&gt;&lt;code&gt;Time&lt;/code&gt;ï¼šæŸ¥è¯¢çš„&lt;strong&gt;æ‰§è¡Œæ—¶é—´&lt;/strong&gt;ï¼ˆ&lt;code&gt;start_time&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;User@Host: root[root] @ localhost [] Id:11&lt;/code&gt;ï¼šæ‰§è¡Œ sql çš„&lt;strong&gt;ä¸»æœºä¿¡æ¯&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Query_time&lt;/code&gt;ï¼šSQL&lt;strong&gt;&lt;code&gt;æŸ¥è¯¢&lt;/code&gt;&lt;/strong&gt;æ‰€&lt;strong&gt;è€—&lt;/strong&gt;çš„&lt;strong&gt;æ—¶&lt;/strong&gt;é—´&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Lock_time&lt;/code&gt;ï¼š&lt;strong&gt;é”å®šæ—¶é—´&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Rows_sent&lt;/code&gt;ï¼šæ‰€&lt;strong&gt;å‘é€çš„è¡Œæ•°&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Rows_examined&lt;/code&gt;ï¼š&lt;strong&gt;é”æ‰«æçš„è¡Œæ•°&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SET timestamp=1558530988;&lt;/code&gt;ï¼šSQL&lt;strong&gt;æ‰§è¡Œæ—¶é—´&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;ç°åœ¨å¯ä»¥è¯´è¯´å·¥å…·äº†ï¼Œæ¨èä¸¤æ¬¾ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;è‡ªå¸¦çš„æ…¢æ—¥å¿—åˆ†æå·¥å…·ï¼š&lt;code&gt;mysqldumpslow&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;MySQLå·¥å…·ç®±ï¼ˆ&lt;code&gt;percona-toolkit&lt;/code&gt;ï¼‰ä¸­çš„&lt;code&gt;pt-query-digest&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;h5 id=&quot;mysqldumpslowç²¾ç®€&quot;&gt;mysqldumpslowï¼ˆç²¾ç®€ï¼‰&lt;/h5&gt;
&lt;p&gt;&lt;strong&gt;æŸ¥è¯¢æœ€æ…¢çš„10æ¡SQLï¼š&lt;code&gt;mysqldumpslow -s t -t 10 /var/lib/mysql/localhost-slow.log&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;
&lt;code&gt;-s æŒ‰ç…§é‚£ç§æ–¹å¼æ’åº
    t: æŸ¥è¯¢æ—¶é—´
    cï¼šè®¿é—®è®¡æ•°
    lï¼šé”å®šæ—¶é—´
    r:è¿”å›è®°å½•
    alï¼šå¹³å‡é”å®šæ—¶é—´
    arï¼šå¹³å‡è®¿é—®è®°å½•æ•°
    atï¼šå¹³å‡æŸ¥è¯¢æ—¶é—´
-t è¿”å›å¤šå°‘æ¡æ•°æ®ï¼ˆå¯ä»¥ç†è§£ä¸ºtop nï¼‰
-g å¯ä»¥è·Ÿä¸Šæ­£åˆ™åŒ¹é…æ¨¡å¼ï¼Œå¤§å°å†™ä¸æ•æ„Ÿã€‚&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;PSï¼šä½¿ç”¨mysqldumpslowçš„åˆ†æç»“æœä¸ä¼šæ˜¾ç¤ºå…·ä½“å®Œæ•´çš„sqlè¯­å¥ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;&lt;strong&gt;ç¿»é¡µsqlä¸ä¸€æ ·ï¼Œæ€§èƒ½ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œè¶Šå¾€åçš„é¡µæ•°è¶Šå®¹æ˜“å‡ºç°æ…¢æŸ¥è¯¢ï¼Œè€ŒmysqldumpslowæŠŠæ‰€æœ‰ç¿»é¡µsqlå½“æˆä¸€ä¸ªsqläº†&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;egï¼š&lt;code&gt;select * from tb_table where uid=20 group by createtime limit 10000, 1000;&lt;/code&gt; ==&amp;gt; &lt;code&gt;select * from tb_table where uid=N group by createtime limit N, N;&lt;/code&gt;
&lt;ul&gt;&lt;li&gt;ä¸ç®¡ä½ uidå’Œlimitæ€ä¹ˆå˜ï¼Œmysqldumpslowè®¤ä¸ºæ˜¯ä¸€æ ·çš„&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;h5 id=&quot;pt-query-digestæ¨è&quot;&gt;pt-query-digestï¼ˆæ¨èï¼‰&lt;/h5&gt;
&lt;p&gt;å®˜æ–¹æ–‡æ¡£ï¼š&lt;a href=&quot;https://www.percona.com/doc/percona-toolkit/3.0/pt-query-digest.html&quot; class=&quot;uri&quot;&gt;https://www.percona.com/doc/percona-toolkit/3.0/pt-query-digest.html&lt;/a&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;strong&gt;åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼š&lt;code&gt;pt-query-digest /var/lib/mysql/localhost-slow.log&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;&lt;li&gt;ä½¿ç”¨tcppdumpæ•è·MySQLåè®®æ•°æ®ï¼Œç„¶åæŠ¥å‘Šæœ€æ…¢çš„æŸ¥è¯¢ï¼š
&lt;ul&gt;&lt;li&gt;&lt;code&gt;tcpdump -s 65535 -x -nn -q -tttt -i any -c 1000 port 3306 &amp;gt; mysql.tcp.txt&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;pt-query-digest --type tcpdump mysql.tcp.txt&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹æ¥è‡ªè¿œç¨‹è¿›ç¨‹åˆ—è¡¨ä¸Šæœ€æ…¢çš„æŸ¥è¯¢ï¼š
&lt;ul&gt;&lt;li&gt;&lt;code&gt;pt-query-digest --processlist h=ip&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;å®‰è£…å¯ä»¥å‚è€ƒï¼š&lt;a href=&quot;https://github.com/lotapp/awesome-tools/blob/master/README.md#4%E8%BF%90%E7%BB%B4&quot;&gt;https://github.com/lotapp/awesome-tools/blob/master/README.md#4%E8%BF%90%E7%BB%B4&lt;/a&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;PSï¼špercona-toolkitçš„å¸¸ç”¨å·¥å…·æˆ‘ä¹Ÿåœ¨é‡Œé¢ç®€å•è¯´äº†ä¸‹ï¼Œå¯¹åº”æ–‡æ¡£ä¹Ÿè´´äº†&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h5 id=&quot;other&quot;&gt;other&lt;/h5&gt;
&lt;p&gt;PSï¼šè¿˜æœ‰ä¸€æ¬¾&lt;strong&gt;&lt;code&gt;mysqlsla&lt;/code&gt;&lt;/strong&gt;æˆ‘æ²¡ç”¨è¿‡ï¼Œæ‰€ä»¥è´´ä¸ªå‚è€ƒæ–‡ç« ï¼Œæ„Ÿå…´è¶£çš„åŒå¿—è‡ªå·±ç ”ç©¶ä¸‹&lt;/p&gt;
&lt;blockquote readability=&quot;0&quot;&gt;
&lt;p&gt;&lt;a href=&quot;https://www.cnblogs.com/fengchi/p/6187099.html&quot; class=&quot;uri&quot;&gt;https://www.cnblogs.com/fengchi/p/6187099.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;çŸ¥è¯†æ‹“å±•ï¼š&lt;a href=&quot;https://www.cnblogs.com/fengchi/p/6187099.html&quot; class=&quot;uri&quot;&gt;https://www.cnblogs.com/fengchi/p/6187099.html&lt;/a&gt;&lt;/p&gt;
&lt;hr/&gt;&lt;h4 id=&quot;binary_logäºŒè¿›åˆ¶æ—¥å¿—&quot;&gt;5.binary_logï¼ˆäºŒè¿›åˆ¶æ—¥å¿—ï¼‰&lt;/h4&gt;
&lt;p&gt;ä¸ŠèŠ‚ä¸»è¦è¯´äº†é€šç”¨æ—¥å¿—å’Œæ…¢æŸ¥æ—¥å¿—ï¼Œä»Šå¤©è¯´ä¸‹äºŒè¿›åˆ¶æ—¥å¿—ï¼š&lt;/p&gt;
&lt;p&gt;äºŒè¿›åˆ¶æ—¥å¿—ç®—æ˜¯æœ€å¸¸ç”¨çš„äº†ï¼Œä¸»è¦å°±æ˜¯&lt;strong&gt;&lt;code&gt;è®°å½•å¯¹æ•°æ®åº“çš„ä¿®æ”¹&lt;/code&gt;&lt;/strong&gt;ï¼Œç„¶åå°±æ˜¯&lt;strong&gt;&lt;code&gt;ä¸»ä»å¤åˆ¶&lt;/code&gt;&lt;/strong&gt;ç”¨çš„æ¯”è¾ƒå¤šï¼ˆæ¯”å¦‚å¢é‡å¤‡ä»½ï¼‰&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;PSï¼šè®°å½•äº†ä¿®æ”¹æ“ä½œï¼Œé‚£ä¹ˆè¡ç”Ÿå‡ºçš„åœºæ™¯å°±æ˜¯ï¼š&lt;code&gt;å¢é‡å¤‡ä»½å’Œæ¢å¤&lt;/code&gt;ï¼ˆåŸºäºæ—¶é—´ç‚¹çš„å¤‡ä»½å’Œæ¢å¤ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;PSï¼šMySQLæ—¥å¿—ä¸»è¦åˆ†ä¸ºè¿™ä¸¤ç±»ï¼šï¼ˆäº’ä¸å¹²æ‰°ï¼‰&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;&lt;code&gt;æœåŠ¡å±‚&lt;/code&gt;æ—¥å¿—ï¼ˆå’Œä½¿ç”¨å­˜å‚¨å¼•æ“æ— å…³ï¼‰
&lt;ul&gt;&lt;li&gt;é€šç”¨æ—¥å¿—ã€æ…¢æŸ¥è¯¢æ—¥å¿—ã€äºŒè¿›åˆ¶æ—¥å¿—&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;å­˜å‚¨å¼•æ“å±‚&lt;/code&gt;æ—¥å¿—
&lt;ul&gt;&lt;li&gt;egï¼šinnodbçš„é‡åšæ—¥å¿—(&lt;code&gt;redo log&lt;/code&gt;)å’Œå›æ»šæ—¥å¿—(&lt;code&gt;undo log&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;Qï¼šé‚£ä»€ä¹ˆæ ·çš„ä¿®æ”¹ä¼šè®°å½•ä¸‹æ¥å‘¢ï¼Ÿ&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;Aï¼šè®°å½•æ‰€æœ‰å¯¹MySQLæ•°æ®åº“çš„ä¿®æ”¹äº‹ä»¶ï¼ˆåŒ…æ‹¬å¢åˆ æ”¹æŸ¥äº‹ä»¶å’Œå¯¹è¡¨ç»“æ„ä¿®æ”¹çš„äº‹ä»¶ï¼‰ï¼Œè€Œä¸”&lt;strong&gt;åªè®°å½•å·²ç»æˆåŠŸæ‰§è¡Œçš„äº‹ä»¶&lt;/strong&gt;ï¼ˆå¤±è´¥çš„ä¸ä¼šè®°å½•ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™ä¹ˆè¯´å¯èƒ½æœ‰ç‚¹æŠ½è±¡ï¼Œç†Ÿæ‚‰SQLServerçš„åŒå¿—çœ‹ä¸ªå›¾å°±ç§’æ‡‚ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615114306346-1188080944.png&quot; alt=&quot;3.äºŒè¿›åˆ¶æ—¥å¿—.png&quot;/&gt;&lt;/p&gt;
&lt;h5 id=&quot;äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼&quot;&gt;5.1.äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼&lt;/h5&gt;
&lt;table&gt;&lt;thead/&gt;&lt;tbody readability=&quot;4&quot;&gt;&lt;tr class=&quot;odd&quot; readability=&quot;2&quot;&gt;&lt;td&gt;&lt;code&gt;STATEMENT&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;åŸºäºæ®µçš„æ ¼å¼ï¼Œè®°å½•æ‰§è¡Œæ•°æ®ä¿®æ”¹æ—¶å€™æ‰€æ‰§è¡Œçš„SQLè¯­å¥&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;even&quot; readability=&quot;3&quot;&gt;&lt;td&gt;&lt;strong&gt;&lt;code&gt;ROW&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸºäºè¡Œçš„æ ¼å¼ï¼Œè®°å½•å¢åˆ æ”¹æŸ¥æ“ä½œæ‰€ä¿®æ”¹è¡Œçš„ä¿¡æ¯ï¼ˆæ¯ä¿®æ”¹ä¸€è¡Œå°±ä¼šæœ‰ä¸€æ¡ä¿¡æ¯ï¼‰&lt;/td&gt;
&lt;/tr&gt;&lt;tr class=&quot;odd&quot; readability=&quot;3&quot;&gt;&lt;td&gt;&lt;strong&gt;&lt;code&gt;MIXED&lt;/code&gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;åŸºäºè¡Œå’Œç«¯çš„æ··åˆæ ¼å¼ï¼Œæ ¹æ®SQLè¯­å¥ç”±ç³»ç»Ÿå†³å®šæ˜¯åŸºäºæ®µè¿˜æ˜¯åŸºäºè¡Œçš„æ—¥å¿—æ ¼å¼è®°å½•&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;æŸ¥çœ‹æ–¹å¼ï¼š&lt;strong&gt;&lt;code&gt;show variables like 'binlog_format';&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;&lt;strong&gt;binlog_format=&lt;code&gt;statement&lt;/code&gt;&lt;/strong&gt;ï¼šåŸºäºæ®µçš„è®°å½•æ ¼å¼ï¼ˆè€ç‰ˆæœ¬çš„é»˜è®¤å€¼ï¼‰
&lt;ol&gt;&lt;li&gt;ä¼˜ç‚¹ï¼šè®°å½•é‡è¾ƒå°ï¼ŒèŠ‚çº¦ç£ç›˜å’Œç½‘ç»œIOï¼ˆå•æ¡æ“ä½œRowæ›´èŠ‚çº¦ï¼‰&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼šå¿…é¡»è®°å½•ä¸Šä¸‹æ–‡ä¿¡æ¯æ¥ä¿è¯è¯­å¥åœ¨ä»æœåŠ¡å™¨ä¸Šæ‰§è¡Œç»“æœä¸ä¸»æœåŠ¡å™¨ç›¸åŒ
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;ä½†æ˜¯å¦‚æœä½¿ç”¨äº†&lt;code&gt;uuid()&lt;/code&gt;ã€&lt;code&gt;user()&lt;/code&gt;ç­‰ç»“æœéç¡®å®šçš„å‡½æ•°ï¼Œå¯èƒ½ä¼šé€ æˆMySQLä¸»ä»ä¸ä¸€è‡´&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—æŸ¥çœ‹&lt;/strong&gt;ï¼š&lt;code&gt;mysqlbinlog /var/lib/mysql/binlog.0000xx | more&lt;/code&gt;ï¼ˆä¸ç”¨æŒ‡å®šå‚æ•°ï¼‰&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;binlog_format=&lt;code&gt;row&lt;/code&gt;&lt;/strong&gt;ï¼šåŸºäºè¡Œçš„è®°å½•æ ¼å¼ï¼ˆ5.7ä»¥åçš„é»˜è®¤å€¼ï¼‰
&lt;ol&gt;&lt;li&gt;ä¼˜ç‚¹ï¼šå¯ä»¥é¿å…MySQLå¤åˆ¶ä¸­å‡ºç°çš„ä¸»ä»ä¸ä¸€è‡´çš„é—®é¢˜ï¼ˆä¸»ä»æ›´å®‰å…¨ï¼‰
&lt;ul&gt;&lt;li&gt;PSï¼šæ²¡æœ‰å¤‡ä»½çš„æ—¶å€™å¯ä»¥é€šè¿‡åˆ†ærowæ ¼å¼çš„äºŒè¿›åˆ¶æ—¥å¿—æ¥åå‘æ¢å¤&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼šè®°å½•æ—¥å¿—é‡è¾ƒå¤§ï¼ˆé¡ºåºå†™å…¥ï¼‰
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;ç°åœ¨å¢åŠ äº†æ–°å‚æ•°æ¥ä¼˜åŒ–&lt;/strong&gt;ï¼š&lt;code&gt;binlog_row_image=[full|minimal|noblob]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ—¥å¿—æŸ¥çœ‹&lt;/strong&gt;ï¼š&lt;code&gt;mysqlbinlog -vv /var/lib/mysql/binlog.0000xx | more&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;binlog_format=&lt;code&gt;mixed&lt;/code&gt;&lt;/strong&gt;ï¼šåŸºäºè¡Œå’Œç«¯çš„æ··åˆæ ¼å¼ï¼ˆ&lt;code&gt;æ¨è&lt;/code&gt;ï¼‰
&lt;ul&gt;&lt;li&gt;PSï¼šæ•°æ®é‡å¤§å°ç”±æ‰€æ‰§è¡Œçš„SQLå†³å®šï¼ˆéç¡®å®šæ€§å‡½æ•°è¶Šå¤šï¼Œè¡Œæ•°è¶Šå¤šï¼‰&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;PSï¼š&lt;strong&gt;DDLæ“ä½œï¼ˆcreateã€dropã€alterï¼‰çš„æ—¶å€™éƒ½æ˜¯åŸºäºæ®µæ–¹å¼æ¥è®°å½•log&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;å¦‚æœä¸€æ¡ä¸€æ¡è®°å½•ï¼Œè¡¨æœ‰ä¸Šäº¿æ•°æ®ï¼Œæˆ‘å°±ä¿®æ”¹æŸåˆ—çš„çŠ¶æ€å€¼ï¼Œé‚£ä¸å¾—ç–¯ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;å¯¹&lt;code&gt;binlog_row_image=[FULL|MINIMAL|NOBLOB]&lt;/code&gt;çš„è¡¥å……è¯´æ˜&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;PSï¼š&lt;strong&gt;æŸ¥çœ‹æ–¹å¼ï¼š&lt;code&gt;show variables like 'binlog_row_image'&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;&lt;li&gt;é»˜è®¤æ˜¯&lt;code&gt;full&lt;/code&gt;ï¼šå®Œæ•´
&lt;ul&gt;&lt;li&gt;è®°å½•ä¿®æ”¹è¡Œçš„å…¨éƒ¨å†…å®¹&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;noblob&lt;/code&gt;ï¼šå°±æ˜¯åœ¨fullè®°å½•çš„åŸºç¡€ä¸Šå¯¹å¤§æ–‡æœ¬åˆ—çš„ä¼˜åŒ–
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;æ²¡æœ‰å¯¹textæˆ–è€…blobåˆ—ä¿®æ”¹å°±ä¸è®°å½•è¯¥åˆ—&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;minimal&lt;/code&gt;ï¼šç®€å•è®°å½•ï¼Œ&lt;strong&gt;åªè®°å½•ä¿®æ”¹çš„é‚£ä¸€åˆ—&lt;/strong&gt;
&lt;ul&gt;&lt;li&gt;PSï¼š&lt;strong&gt;è¿™ä¸ªè¦ç‰¹åˆ«æ³¨æ„ä¸€ç‚¹ï¼Œè™½ç„¶å®¹é‡å°äº†ï¼Œä½†æ˜¯ä¸€æ—¦è¯¯æ“ä½œï¼Œå¾ˆéš¾æ¢å¤çš„&lt;/strong&gt;ï¼ˆä¸çŸ¥é“åŸæ¥å†…å®¹ï¼‰&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;h5 id=&quot;æ¨èä½¿ç”¨&quot;&gt;æ¨èä½¿ç”¨&lt;/h5&gt;
&lt;p&gt;&lt;strong&gt;ä¸€èˆ¬ä½¿ç”¨&lt;code&gt;binlog_format=mixed&lt;/code&gt;æ··åˆæ ¼å¼&lt;/strong&gt; or &lt;strong&gt;&lt;code&gt;binlog_format=row&lt;/code&gt;&lt;/strong&gt; + &lt;strong&gt;&lt;code&gt;binlog_row_image=minimal&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;PSï¼šå¦‚æœå¯¹å®‰å…¨æ€§è¦æ±‚ç‰¹åˆ«é«˜ï¼Œæ¨èä½¿ç”¨&lt;code&gt;binlog_format=row&lt;/code&gt; + &lt;code&gt;binlog_row_image=full&lt;/code&gt;ï¼ˆä¸æ€•è¯¯æ“ä½œï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™ä¸ªå’ŒSQLServerçš„æ—¥å¿—æ¢å¤æ¨¡å¼æœ‰ç‚¹ç±»ä¼¼ï¼Œæˆ‘è´´ä¸‹å›¾ä½ ä»¬å¯ä»¥å¯¹æ¯”å‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615114311864-1704843102.png&quot; alt=&quot;3.å®¹é‡.png&quot;/&gt;&lt;/p&gt;
&lt;h5 id=&quot;äºŒè¿›åˆ¶æ—¥å¿—é…ç½®&quot;&gt;5.2.äºŒè¿›åˆ¶æ—¥å¿—é…ç½®&lt;/h5&gt;
&lt;p&gt;ä¸Šé¢è™½ç„¶è¯´å®Œäº†äºŒè¿›åˆ¶æ—¥å¿—çš„å¸¸ç”¨3ç§æ ¼å¼ï¼Œä½†è€ç‰ˆæœ¬é»˜è®¤éƒ½æ˜¯ä¸å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—çš„ï¼Œå’‹åŠï¼Ÿ&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;PSï¼šå¦‚æœæ˜¯MariaDBå¯ä»¥å»ç¤ºä¾‹é…ç½®ä¸­æŸ¥çœ‹ï¼š&lt;code&gt;ls /usr/share/mysql/ |grep .cnf&lt;/code&gt;ï¼ˆCentOSï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;éªŒè¯ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;MySQL8ä¹‹å‰ï¼š&lt;code&gt;cat /etc/mysql/mysql.conf.d/mysqld.cnf&lt;/code&gt;ï¼ˆUbuntuServerï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615105438869-1854139695.png&quot; alt=&quot;3.binlog.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;MySQL8ï¼š&lt;code&gt;cat /etc/my.cnf |grep log&lt;/code&gt;ï¼ˆCentOSï¼‰&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615105953261-70366363.png&quot; alt=&quot;3.binlog2.png&quot;/&gt;&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;Qï¼šæœ‰äº›äººå¯èƒ½ç–‘æƒ‘äº†ï¼Œä¸ºä»€ä¹ˆç”¨&lt;strong&gt;&lt;code&gt;show variables like 'log_bin';&lt;/code&gt;&lt;/strong&gt;æŸ¥è¯¢å‡ºæ¥çš„ç»“æœå’Œé…ç½®æ–‡ä»¶ä¸­ä¸å¤§ä¸€æ ·å•Šï¼Ÿ&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;PSï¼šä¸€èˆ¬é…ç½®é¡¹ä¸­çš„å‚æ•°éƒ½å¯ä»¥ä½¿ç”¨&lt;code&gt;show variables like 'xx'&lt;/code&gt;æ¥æŸ¥è¯¢å¯¹åº”çš„å€¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615112651069-338309897.png&quot; alt=&quot;3.log_bin.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;Aï¼šé‚£æ˜¯å› ä¸º5.7ä¹‹åç‰ˆæœ¬åˆ†æˆäº†ä¸¤ä¸ªå‚æ•°ï¼š&lt;strong&gt;&lt;code&gt;log_bin&lt;/code&gt;å’Œ&lt;code&gt;log_bin_basename&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;PSï¼š&lt;strong&gt;é…ç½®æ–‡ä»¶çš„&lt;code&gt;log_bin=xxx&lt;/code&gt;ç›¸å½“äºå‘½ä»¤ä¸­çš„&lt;code&gt;log_bin&lt;/code&gt;å’Œ&lt;code&gt;log_bin_basename&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;pre&gt;
&lt;code&gt;mysql&amp;gt; show variables like 'log_bin%';
+---------------------------------+-----------------------------+
| Variable_name                   | Value                       |
+---------------------------------+-----------------------------+
| log_bin                         | ON                          |
| log_bin_basename                | /var/lib/mysql/binlog       |
| log_bin_index                   | /var/lib/mysql/binlog.index |
| log_bin_trust_function_creators | OFF                         |
| log_bin_use_v1_row_events       | OFF                         |
+---------------------------------+-----------------------------+
5 rows in set (0.00 sec)&lt;/code&gt;
&lt;/pre&gt;
&lt;h5 id=&quot;å¼€å¯æ¼”ç¤º&quot;&gt;å¼€å¯æ¼”ç¤º&lt;/h5&gt;
&lt;p&gt;&lt;strong&gt;MariaDBå¼€å¯binlogå›¾ç¤º&lt;/strong&gt;ï¼šï¼ˆCentOSï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615215014750-902512611.jpg&quot; alt=&quot;4.MariaDBå¼€å¯binlog.jpg&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MySQL5.7æ¼”ç¤º&lt;/strong&gt;ï¼šï¼ˆUbuntuServerï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615215118756-1227225512.jpg&quot; alt=&quot;4.UbuntuServerä¸‹MySQL5.7æ¼”ç¤º.jpg&quot;/&gt;&lt;/p&gt;
&lt;p&gt;é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ï¼šï¼ˆ&lt;strong&gt;&lt;code&gt;show variables like 'binlog_format';&lt;/code&gt;ï¼šæŸ¥çœ‹å½“å‰binlogåŸºäºä»€ä¹ˆæ ¼å¼&lt;/strong&gt;ï¼‰&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;
&lt;code&gt;# æœåŠ¡å™¨æ ‡è¯†
server-id=1 # å•æœºMariaDBå¯ä¸å¼€å¯

# å¼€å¯binlogå¹¶è®¾ç½®è·¯å¾„
# ä¸æŒ‡å®šè·¯å¾„åˆ™é»˜è®¤åœ¨æ•°æ®ç›®å½•ä¸‹
log_bin=binlog # è¿™ä¸ªä»£è¡¨ä»¥binlogå¼€å¤´çš„æ–‡ä»¶

# binlogé‡‡ç”¨ROW|MIXEDæ ¼å¼
# binlog_format=MIXED # 5.7é»˜è®¤æ˜¯ROW&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å…ˆçœ‹ä¸‹æ–‡ä»¶å‰ç¼€ï¼ˆ&lt;code&gt;log_bin=binlog&lt;/code&gt;ï¼‰çš„æ¦‚å¿µï¼Œä¸€å¼ å›¾å°±æ‡‚ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615223600204-780006208.png&quot; alt=&quot;4.æ–‡ä»¶å‰ç¼€.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;PSï¼š&lt;strong&gt;å¦‚æœlog_binåªæ˜¯æŒ‡å®šä¸€ä¸ªåå­—ï¼Œé‚£ä¹ˆé»˜è®¤è·¯å¾„ä¸€èˆ¬éƒ½æ˜¯åœ¨æ•°æ®æ–‡ä»¶çš„æ–‡ä»¶å¤¹ä¸­&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;6&quot;&gt;
&lt;p&gt;é…ç½®æ–‡ä»¶ä¸€èˆ¬éƒ½ä¼šå†™ï¼Œeg:&lt;code&gt;datadir=/var/lib/mysql&lt;/code&gt;ï¼Œæˆ–è€…é€šè¿‡&lt;strong&gt;&lt;code&gt;show variables like 'datadir';&lt;/code&gt;&lt;/strong&gt;ä¹Ÿå¯ä»¥æŸ¥è¯¢åˆ°&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è™½ç„¶å’ŒSQLServeræ–‡ä»¶ç»„ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œä½†æœ‰äº›ç›¸ä¼¼ ==&amp;gt; &lt;code&gt;logå¯ä»¥å¤šä¸ªä¹Ÿå¯ä»¥åŠ¨æ€è°ƒæ•´&lt;/code&gt;&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615114910706-1077844738.png&quot; alt=&quot;3.å¤šæ—¥å¿—æ–‡ä»¶.png&quot;/&gt;&lt;/p&gt;
&lt;h5 id=&quot;rowæ¨¡å¼ä¸‹è®°å½•sql&quot;&gt;5.3.ROWæ¨¡å¼ä¸‹è®°å½•SQL&lt;/h5&gt;
&lt;p&gt;Qï¼šè™½ç„¶ROWè®°å½•èƒ½ä¿è¯ä¸»ä»æ•°æ®å®‰å…¨ï¼Œä½†æˆ‘ä»¬æ’æŸ¥é—®é¢˜çš„æ—¶å€™å¾€å¾€éœ€è¦çŸ¥é“SQLï¼Œè€Œç”¨æ®µçš„è®°å½•æ–¹å¼åˆä¸åˆé€‚ï¼Œå’‹åŠï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼šæœ‰ä¸ªæ–°å‚æ•°å¯ä»¥è§£å†³ï¼š&lt;strong&gt;&lt;code&gt;binlog_rows_query_log_events&lt;/code&gt;&lt;/strong&gt;ï¼Œå¼€å¯åå°±å¯ä»¥è®°å½•sqläº†&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹æ–¹å¼ï¼š&lt;strong&gt;&lt;code&gt;show variables like 'binlog_row%';&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;shell&quot;&gt;
&lt;code&gt;mysql&amp;gt; show variables like 'binlog_row%';
+------------------------------+-------+
| Variable_name                | Value |
+------------------------------+-------+
| binlog_row_image             | FULL  |
| binlog_rows_query_log_events | OFF   |
+------------------------------+-------+
2 rows in set (0.01 sec)&lt;/code&gt;
&lt;/pre&gt;
&lt;h5 id=&quot;binlogæ¼”ç¤º&quot;&gt;binlogæ¼”ç¤º&lt;/h5&gt;
&lt;p&gt;&lt;strong&gt;æ˜¾ç¤ºbinlogåˆ—è¡¨ï¼š&lt;code&gt;show binary logs;&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åˆ·æ–°ä¸€ä»½æ–°çš„binlogï¼š&lt;code&gt;flush logs;&lt;/code&gt;&lt;/strong&gt;ï¼ˆç°åœ¨å¼€å§‹çš„äºŒè¿›åˆ¶æ—¥å¿—å°±è®°å½•åœ¨è¿™ä¸ªæ–°æ–‡ä»¶ä¸­ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615230123267-704005638.jpg&quot; alt=&quot;5.æ–°å»ºbinlog.jpg&quot;/&gt;&lt;/p&gt;
&lt;p&gt;binlogç°åœ¨æ˜¯ç©ºçš„ï¼š(&lt;code&gt;-vv&lt;/code&gt;ï¼šæŠŠäºŒè¿›åˆ¶æ ¼å¼çš„æ—¥å¿—æ˜¾ç¤ºä¸ºèƒ½è¯»æ‡‚çš„å­—ç¬¦ä¸²)&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;mysqlbinlog --no-defaults -vv --base64-output=DECODE-ROWS /var/lib/mysql/binlog.000006&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615230220876-63662242.png&quot; alt=&quot;5.æ–°å»ºbinlog2.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ç°åœ¨ç®€å•æ‘¸æ‹Ÿå‡ ä¸ªSQLæ“ä½œï¼Œç„¶åçœ‹çœ‹binlogï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615230537927-1686327416.png&quot; alt=&quot;6.sql.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹ä¸‹binlogæ—¥å¿—ï¼š(çº¿ä¸Šå¼€å‘ä¸€èˆ¬éƒ½æ˜¯FULLæ¨¡å¼ï¼Œä¸»è¦æ˜¯é˜²æ­¢ç¨‹åºå‘˜ä¿®æ”¹SQLçš„æ—¶å€™ä¸åŠ æ¡ä»¶ç­‰è¯¯æ“ä½œ)&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;FULLæ¨¡å¼å°±æ˜¯è¿™æ ·ï¼Œè¯¥è¡Œæ•°æ®å…¨éƒ¨è®°å½•ï¼ˆä¿®æ”¹éƒ¨åˆ†å…¶å®å°±ç»¿è‰²æ¡†çš„åœ°æ–¹ï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615231013171-515634847.jpg&quot; alt=&quot;6.binlog.jpg&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æƒ³è¦binlogä¸­è®°å½•SQLå°±å¼€å¯&lt;code&gt;binlog_rows_query_log_events&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;PSï¼šåƒè¿™ç§æ“ä½œï¼Œå¦‚æœæ¨¡å¼é€‰æ··åˆæ¨¡å¼ï¼Œbinlogä¸­ä¼šè®°å½•SQLçš„&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸´æ—¶å¼€å¯ä¸‹&lt;code&gt;binlog_rows_query_log_events&lt;/code&gt;ï¼ˆå¦‚æœä½ æœ‰éœ€è¦å¯ä»¥é…ç½®æ–‡ä»¶è®¾ç½®ä¸€ä¸‹ï¼‰&lt;/p&gt;
&lt;blockquote readability=&quot;5&quot;&gt;
&lt;p&gt;PSï¼šMySQL8å¯é€šè¿‡&lt;code&gt;set persist&lt;/code&gt;å‘½ä»¤å°†å…¨å±€å˜é‡çš„ä¿®æ”¹æŒä¹…åŒ–åˆ°é…ç½®æ–‡ä»¶ä¸­&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615231626834-759896379.png&quot; alt=&quot;6.sql2.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ•ˆæœå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615231542008-1771345221.png&quot; alt=&quot;6.binlog2.png&quot;/&gt;&lt;/p&gt;
&lt;h5 id=&quot;äºŒè¿›åˆ¶æ—¥å¿—çš„æ¸…é™¤&quot;&gt;5.4.äºŒè¿›åˆ¶æ—¥å¿—çš„æ¸…é™¤&lt;/h5&gt;
&lt;ol&gt;&lt;li&gt;è‡ªåŠ¨æ¸…é™¤
&lt;ul&gt;&lt;li&gt;é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æ—¶é—´ï¼š&lt;code&gt;expire_logs_days = 30&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;æ‰‹åŠ¨æ¸…é™¤
&lt;ul&gt;&lt;li&gt;åˆ é™¤æŒ‡å®šç¼–å·ä¹‹å‰çš„æ—¥å¿—ï¼š&lt;code&gt;purge binary logs to 'binlog.000006';&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ é™¤æŒ‡å®šæ—¶é—´ä¹‹å‰çš„æ—¥å¿—ï¼š&lt;code&gt;purge binary logs before '2019-06-15 14:14:00';&lt;/code&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;å·²ç»23:23äº†ï¼Œæˆ‘ä»¬å¿«é€Ÿæ¼”ç¤ºä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;MySQLå‘½ä»¤è¡Œä¸­æ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615232721720-252354903.png&quot; alt=&quot;7.åˆ é™¤.png&quot;/&gt;&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶åˆ—è¡¨ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1127869/201906/1127869-20190615232749442-1177374128.png&quot; alt=&quot;7.æ–‡ä»¶.png&quot;/&gt;&lt;/p&gt;
&lt;h5 id=&quot;äºŒè¿›åˆ¶æ—¥å¿—ä¸ä¸»ä»&quot;&gt;5.5.äºŒè¿›åˆ¶æ—¥å¿—ä¸ä¸»ä»&lt;/h5&gt;
&lt;p&gt;è¿™ä¸ªæŠŠè¿ç»´ç¯‡è®²å®Œä¼šç»§ç»­è¯´ï¼Œè¿ç»´ç¯‡ç»“æŸåä¼šæœ‰ä¸ªé«˜çº§ç¯‡ï¼ˆæ¶æ„ï¼‰ï¼Œè¿™è¾¹å°±ç®€å•æä¸‹&lt;code&gt;äºŒè¿›åˆ¶æ ¼å¼å¯¹ä¸»ä»å¤åˆ¶çš„å½±å“&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;åŸºäºSQLè¯­å¥çš„å¤åˆ¶ï¼ˆSBRï¼‰
&lt;ul&gt;&lt;li&gt;äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ä½¿ç”¨çš„æ˜¯&lt;code&gt;statement&lt;/code&gt;æ ¼å¼ï¼ˆ5.7å‰çš„é»˜è®¤ï¼‰&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;åŸºäºè¡Œçš„å¤åˆ¶ï¼ˆRBRï¼‰
&lt;ul&gt;&lt;li&gt;äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ä½¿ç”¨çš„æ˜¯åŸºäºè¡Œçš„æ—¥å¿—æ ¼å¼&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;æ··åˆæ¨¡å¼
&lt;ul&gt;&lt;li&gt;æ ¹æ®å®é™…åœ¨ä¸Šé¢ä¸¤è€…ä¸­åˆ‡æ¢&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;è´´ä¸ªè¯¾åæ‹“å±•æ–‡ç« ï¼š&lt;a href=&quot;https://www.cnblogs.com/gujianzhe/p/9371682.html&quot; class=&quot;uri&quot;&gt;https://www.cnblogs.com/gujianzhe/p/9371682.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸‹çº§é¢„ä¼°ï¼šå¤‡ä»½ä¸æ¢å¤ã€ç›‘æ§&lt;/strong&gt;&lt;/p&gt;
</description>
<pubDate>Sat, 15 Jun 2019 15:34:00 +0000</pubDate>
<dc:creator>é²²é€¸é¹</dc:creator>
<og:description>ä¸Šç¯‡å›é¡¾ï¼š 1.6.5.MySQLæ—¥å¿—ç›¸å…³ æœ¬æ–‡çš„æµ‹è¯•ç¯å¢ƒï¼š ã€`MariaDB5.5.60 MySQL8.0.16` PSï¼šç‰ˆæœ¬æŸ¥è¯¢ 1.MySQLå¸¸ç”¨æ—¥å¿— æœåŠ¡å™¨å±‚æ—¥å¿—ï¼ˆå­˜å‚¨å¼•æ“å±‚æœ‰è‡ªå·±çš„æ—¥å¿—ï¼‰</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/dotnetcrazy/p/11029323.html</dc:identifier>
</item>
<item>
<title>Android Bitmapï¼ˆä½å›¾ï¼‰è¯¦è§£ - æ‘‡å¤´è€¶ç¨£</title>
<link>http://www.cnblogs.com/shakinghead/p/11025805.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/shakinghead/p/11025805.html</guid>
<description>&lt;p&gt;WebP æ˜¯ Google åœ¨ 2010 å¹´å‘å¸ƒçš„å›¾ç‰‡æ ¼å¼ï¼Œå¸Œæœ›ä»¥æ›´é«˜çš„å‹ç¼©ç‡æ›¿ä»£ JPEGã€‚å®ƒç”¨ VP8 è§†é¢‘å¸§å†…ç¼–ç ä½œä¸ºå…¶ç®—æ³•åŸºç¡€ï¼Œå–å¾—äº†ä¸é”™çš„å‹ç¼©æ•ˆæœã€‚WebPæ”¯æŒæœ‰æŸå’Œæ— æŸå‹ç¼©ã€æ”¯æŒå®Œæ•´çš„é€æ˜é€šé“ã€ä¹Ÿæ”¯æŒå¤šå¸§åŠ¨ç”»ï¼Œå¹¶ä¸”æ²¡æœ‰ç‰ˆæƒé—®é¢˜ï¼Œæ˜¯ä¸€ç§éå¸¸ç†æƒ³çš„å›¾ç‰‡æ ¼å¼ã€‚WebPæ”¯æŒåŠ¨å›¾ï¼ŒåŸºæœ¬å–ä»£gifã€‚&lt;/p&gt;&lt;p&gt;WebPä¸ä»…é›†æˆäº†PNGã€JPEGå’ŒGifçš„æ‰€æœ‰åŠŸèƒ½ï¼Œè€Œä¸”ç›¸åŒè´¨é‡çš„æ— æŸå‹ç¼©WebPå›¾ç‰‡ä½“ç§¯æ¯”PNGå°å¤§çº¦26%ï¼›å¦‚æœæ˜¯æœ‰æŸå‹ç¼©ï¼Œç›¸åŒè´¨é‡çš„WebPå›¾ç‰‡ä½“ç§¯æ¯”JPEGå°25%-34%ã€‚&lt;/p&gt;&lt;p&gt;å¾ˆå¤šäººä¼šè®¤ä¸ºï¼Œæ—¢ç„¶WebPåŠŸèƒ½å®Œå–„ã€å‹ç¼©ç‡æ›´é«˜ï¼Œé‚£ç›´æ¥ç”¨WebPå–ä»£ä¸Šè¿°æ‰€æœ‰çš„å›¾ç‰‡å‹ç¼©æ ¼å¼ä¸å°±è¡Œäº†å—ï¼Ÿå…¶å®ä¸ç„¶ï¼ŒWebPä¹Ÿæœ‰å…¶ç¼ºç‚¹ï¼šæˆ‘ä»¬çŸ¥é“JPEGæ˜¯æœ‰æŸå‹ç¼©è€ŒPNGæ˜¯æ— æŸå‹ç¼©ï¼Œæ‰€ä»¥JPEGçš„å‹ç¼©ç‡é«˜äºPNGï¼›ä½†æ˜¯æœ‰æŸå‹ç¼©çš„ç®—æ³•å†³å®šäº†å…¶å‹ç¼©æ—¶é—´ä¸€å®šæ˜¯é«˜äºæ— æŸå‹ç¼©çš„ï¼Œä¹Ÿå°±æ˜¯è¯´JPEGçš„å‹ç¼©æ—¶é—´é«˜äºPNGã€‚è€ŒWebPæ— è®ºæ˜¯æ— æŸè¿˜æ˜¯æœ‰æŸå‹ç¼©ï¼Œå‹ç¼©ç‡éƒ½åˆ†åˆ«é«˜äºPNGå’ŒJPEGï¼›ä¸å…¶ç›¸å¯¹åº”çš„æ˜¯å…¶å‹ç¼©æ—¶é—´ä¹Ÿæ¯”å®ƒä»¬é•¿çš„å¤šã€‚ç»æµ‹è¯•ï¼ŒWebPå›¾ç‰‡çš„ç¼–ç æ—¶é—´æ¯”JPEGé•¿8å€ã€‚å¯ä»¥çœ‹å‡ºï¼Œæ—¶é—´å’Œç©ºé—´æ˜¯ä¸€å¯¹çŸ›ç›¾ï¼›å¦‚æœæƒ³è¦èŠ‚çœæ›´å¤šçš„ç©ºé—´ï¼Œå¿…ç„¶è¦ä»˜å‡ºé¢å¤–çš„æ—¶é—´ï¼›å¦‚æœæƒ³è¦èŠ‚çœæ—¶é—´ï¼Œé‚£ä¹ˆå¿…ç„¶è¦ä»˜å‡ºç©ºé—´çš„ä»£ä»·ã€‚è¿™å–å†³äºæˆ‘ä»¬åœ¨å®é™…ä¸­å¯¹äºæ—¶ç©ºä¸åŒçš„éœ€æ±‚ç¨‹åº¦æ¥åšå‡ºé€‰æ‹©ã€‚&lt;/p&gt;&lt;p&gt;ä¸ç®¡æ€ä¹ˆè¯´ï¼ŒWebPè¿˜æ˜¯ä¸€ç§å¼ºå¤§çš„ã€ç†æƒ³çš„å›¾ç‰‡å‹ç¼©æ ¼å¼ï¼Œå¹¶ä¸”å€Ÿç”± Google åœ¨ç½‘ç»œä¸–ç•Œçš„å½±å“åŠ›ï¼ŒWebP åœ¨å‡ å¹´çš„æ—¶é—´å†…å·²ç»å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚çœ‹çœ‹ä½ æ‰‹æœºé‡Œçš„ Appï¼šå¾®åšã€å¾®ä¿¡ã€QQã€æ·˜å®ç­‰ç­‰ï¼Œæ¯ä¸ª App é‡Œéƒ½æœ‰ WebP çš„èº«å½±ã€‚&lt;/p&gt;&lt;p&gt;ç›®å‰æ¥è¯´ï¼Œä»¥ä¸Šæ‰€è¿°çš„äº”ç§å‹ç¼©æ ¼å¼ï¼ŒAndroidæ“ä½œç³»ç»Ÿéƒ½æä¾›äº†åŸç”Ÿæ”¯æŒï¼›ä½†æ˜¯åœ¨ä¸Šå±‚èƒ½ç›´æ¥è°ƒç”¨çš„ç¼–ç æ–¹å¼åªæœ‰ JPEGã€PNGã€WebP è¿™ä¸‰ç§ã€‚å…·ä½“çš„ï¼Œå¯ä»¥æŸ¥çœ‹Bitmapç±»çš„æšä¸¾å†…éƒ¨ç±»CompressFormatç±»çš„æšä¸¾å€¼æ¥è·å–ä¸Šå±‚èƒ½è°ƒç”¨çš„å›¾ç‰‡ç¼–ç æ–¹å¼ã€‚ä½ ä¼šå‘ç°æšä¸¾å€¼ä¹Ÿæ˜¯JPEGã€PNGå’ŒWEBPä¸‰ç§ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨åº”ç”¨å±‚ä½¿ç”¨Gifæ ¼å¼å›¾ç‰‡ï¼Œéœ€è¦è‡ªè¡Œå¼•å…¥ç¬¬ä¸‰æ–¹å‡½æ•°åº“æ¥æä¾›å¯¹Gifæ ¼å¼å›¾ç‰‡çš„æ”¯æŒã€‚ä¸è¿‡ä¸€èˆ¬æˆ‘ä»¬ç”¨WebPå–ä»£Gifã€‚&lt;/p&gt;&lt;p&gt;å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦æ¯”è¾ƒåˆ†æPNGã€JPEGã€WebPè¿™ä¸‰ç§å‹ç¼©æ ¼å¼å³å¯ã€‚&lt;/p&gt;&lt;p&gt;â‘ å¯¹äºæ‘„å½±ç±»ç­‰çœŸå½©å›¾ç‰‡ï¼šå› ä¸ºæˆ‘ä»¬å¯¹è¿™ç±»è‰²å½©ä¸°å¯Œçš„å›¾ç‰‡çš„é€æ˜åº¦æ²¡æœ‰è¦æ±‚ï¼ˆä¸€èˆ¬é»˜è®¤ä¸ºä¸é€æ˜ï¼‰ï¼Œå¯ä»¥é‡‡ç”¨JPEGæœ‰æŸå‹ç¼©æ ¼å¼ï¼Œå› ä¸ºJPEGæœ¬èº«å°±ä¸æ”¯æŒé€æ˜åº¦ï¼Œè€Œä¸”å› ä¸ºæ˜¯æœ‰æŸå‹ç¼©ï¼Œæ‰€ä»¥å°½ç®¡ä¼šç‰ºç‰²ä¸€ä¸¢ä¸¢ç…§ç‰‡çš„è´¨é‡ä½†æ˜¯å¯ä»¥å¤§å¤§å‡å°‘ä½“ç§¯ã€‚å¦‚æœéè¦é‡‡ç”¨PNGæ ¼å¼ï¼Œé‚£ä¹ˆé¦–å…ˆå› ä¸ºPNGæ”¯æŒé€æ˜åº¦é€šé“ï¼Œæ‰€ä»¥æ˜æ˜ä¸å¿…è¦çš„é€æ˜åº¦å€¼å´ä¼šè¢«å­˜å‚¨ï¼›å…¶æ¬¡å› ä¸ºæ˜¯æ— æŸå‹ç¼©ï¼Œæ‰€ä»¥å‹ç¼©ç‡ä¸ä¼šå¾ˆé«˜ä»è€Œå¯¼è‡´ä¿å­˜çš„å›¾ç‰‡éå¸¸å¤§ï¼ç»¼ä¸Šæ¯”è¾ƒï¼Œå»ºè®®é‡‡ç”¨JPEGæ ¼å¼ï¼Œä¸è¦ç”¨PNGæ ¼å¼ã€‚&lt;/p&gt;&lt;p&gt;JPEGæ ¼å¼å¯ä»¥ä¸Bitmap.Configå‚æ•°å€¼ä¸ºRGB_565æ­é…ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªç†æƒ³çš„è®¾ç½®ã€‚&lt;/p&gt;&lt;p&gt;â‘¡å¯¹äºlogoå›¾æ ‡ã€èƒŒæ™¯å›¾ç­‰å›¾ç‰‡ï¼šè¿™ç±»å›¾ç‰‡çš„ç‰¹ç‚¹æ˜¯å¾€å¾€æ˜¯æœ‰å¤§å—çš„é¢œè‰²ç›¸åŒçš„åŒºåŸŸï¼Œè¿™ä¸æ— æŸå‹ç¼©çš„æ€è·¯ä¸è°‹è€Œåˆï¼ˆå³åˆ é™¤é‡å¤æ•°æ®ï¼‰ã€‚è€Œä¸”è¿™ç±»å›¾ç‰‡å¯¹é€æ˜åº¦æ˜¯æœ‰è¦æ±‚çš„ï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨PNGæ— æŸå‹ç¼©æ ¼å¼ï¼›å°½ç®¡ä½¿ç”¨PNGæ ¼å¼ä¼šè®©å›¾ç‰‡æœ‰ç‚¹å¤§ï¼Œä½†æ˜¯å¯ä»¥åœ¨åç»­è¿›è¡ŒPNGå›¾ç‰‡ä¼˜åŒ–ä»¥å¯¹APPä½“ç§¯è¿›è¡Œç˜¦èº«ã€‚å¦‚æœéè¦é‡‡ç”¨JPEGæ ¼å¼ï¼Œé‚£ä¹ˆç”±äºæœ‰æŸå‹ç¼©çš„åŸç†ï¼ˆåˆ©ç”¨äººè„‘çš„è‡ªåŠ¨è¡¥å…¨æœºåˆ¶ï¼‰ï¼Œå¯èƒ½ä¼šéšæœºåœ°ä¸¢å¤±ä¸€äº›çº¿æ¡å¯¼è‡´æœ€ç»ˆçš„å›¾ç‰‡å®Œå…¨ä¸æ˜¯æƒ³è¦çš„æ•ˆæœã€‚ç»¼ä¸Šæ¯”è¾ƒï¼Œå»ºè®®ä½¿ç”¨PNGæ ¼å¼ï¼Œä¸è¦ç”¨JPEGæ ¼å¼ã€‚&lt;/p&gt;&lt;p&gt;PNGæ ¼å¼å¯ä»¥ä¸Bitmap.Configå‚æ•°å€¼ä¸ºARGB_8888æ­é…ä½¿ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªç†æƒ³çš„è®¾ç½®ã€‚&lt;/p&gt;&lt;p&gt;å½“ç„¶ï¼Œä»¥ä¸Šä¸¤ç§æƒ…å†µï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨WebPå–ä»£PNGæˆ–JPEGï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è¿™ä¹ˆåšçš„è¯ã€‚å¦‚æœä½ çš„é¡¹ç›®ä¸­å¯¹ç©ºé—´çš„éœ€æ±‚ç¨‹åº¦æ›´é«˜ï¼Œä½ å®Œå…¨æœ‰ç†ç”±è¿™ä¹ˆåšã€‚ä½†æ˜¯å¦‚æœä½ å¯¹ç©ºé—´éœ€æ±‚ç¨‹åº¦è¿˜OKï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©åˆ†æƒ…å†µä½¿ç”¨PNGæˆ–JPEGæ ¼å¼ã€‚&lt;/p&gt;&lt;p&gt;å›¾ç‰‡ä¼˜åŒ–å±äºAndroidæ€§èƒ½ä¼˜åŒ–çš„ä¸€ç§ï¼Œè¿™é‡Œä¸»è¦æ˜¯é’ˆå¯¹PNGå›¾ç‰‡çš„å¤§å°è¿›è¡Œä¼˜åŒ–ï¼Œæ¯•ç«ŸPNGè¿™ç§æ— æŸå‹ç¼©æ ¼å¼å¾€å¾€ä¼šå¯¼è‡´å›¾ç‰‡éƒ½æ¯”è¾ƒå¤§ã€‚é™¤éä½ çš„é¡¹ç›®å·²ç»å…¨é¢æ”¯æŒäº†WebPæ ¼å¼ï¼Œå¦åˆ™å¯¹PNGæ ¼å¼å›¾ç‰‡çš„ä¼˜åŒ–éƒ½ä¼šæ˜¯ä½ å¿…é¡»è€ƒè™‘çš„ä¸€ç‚¹ï¼Œè¿™æœ‰åˆ©äºå‡å°‘APPçš„ä½“ç§¯å¤§å°ã€‚&lt;/p&gt;&lt;p&gt;å¯¹PNGå›¾ç‰‡è¿›è¡Œä¼˜åŒ–çš„æ€æƒ³æ˜¯ï¼šå‡å°‘PNGå›¾ç‰‡çš„ä½“ç§¯ï¼Œå¸¸ç”¨æ–¹å¼æœ‰ï¼š&lt;/p&gt;&lt;p&gt;ImageOptimæ˜¯ä¸€ç§æ— æŸå‹ç¼©å·¥å…·ï¼Œæ‰€ä»¥ä½ ä¸ç”¨æ‹…å¿ƒåˆ©ç”¨è¯¥å·¥å…·å¯¹PNGå›¾ç‰‡è¿›è¡Œå‹ç¼©åå›¾ç‰‡è´¨é‡ä¼šå—å½±å“ã€‚å®ƒçš„å‹ç¼©åŸç†æ˜¯ï¼šä¼˜åŒ–PNGå‹ç¼©å‚æ•°ï¼Œç§»é™¤å†—ä½™å…ƒæ•°æ®ä»¥åŠéå¿…éœ€çš„é¢œè‰²é…ç½®æ–‡ä»¶ç­‰ï¼Œåœ¨ä¸ç‰ºç‰²å›¾ç‰‡è´¨é‡çš„å‰æä¸‹ï¼Œæ—¢å‡å°‘äº†PNGå›¾ç‰‡çš„å¤§å°ï¼Œåˆæé«˜äº†å…¶åŠ è½½çš„é€Ÿåº¦ã€‚&lt;/p&gt;&lt;p&gt;ImageAlphaä¸ImageOptimæ˜¯åŒä¸€ä¸ªä½œè€…ï¼Œä¸è¿‡ImageAlphaå±äºæœ‰æŸå‹ç¼©ï¼Œå› æ­¤å›¾ç‰‡è´¨é‡ä¼šå—åˆ°å½±å“ã€‚æ‰€ä»¥ä½¿ç”¨ImageAlphaå¯¹PNGå›¾ç‰‡è¿›è¡Œå‹ç¼©åï¼Œå¿…é¡»è®©è®¾è®¡å¸ˆæ£€è§†ä¸€ä¸‹ä¼˜åŒ–åçš„PNGå›¾ç‰‡ï¼Œä»¥å…å½±å“APPçš„è§†è§‰æ•ˆæœã€‚ä½†æ˜¯ImageAlphaçš„ä¼˜ç‚¹æ˜¯å¯ä»¥æå¤§å‡å°‘PNGå›¾ç‰‡çš„ä½“ç§¯å¤§å°ã€‚&lt;/p&gt;&lt;p&gt;å‰é¢ä¸¤ä¸ªå·¥å…·æ˜¯åº”ç”¨ç¨‹åºï¼ŒTinyPNGæ˜¯ä¸€ä¸ªWebç«™ç‚¹ã€‚ä½ å¯ä»¥ä¸Šä¼ åŸPNGå›¾ç‰‡ï¼Œå®ƒå¯¹PNGå›¾ç‰‡å‹ç¼©åä½ å°±å¯ä»¥ä¸‹è½½ä¼˜åŒ–åçš„ç»“æœäº†ã€‚å› ä¸ºTinyPNGä¹Ÿæ˜¯æœ‰æŸå‹ç¼©ï¼Œæ‰€ä»¥ä¼˜ç¼ºç‚¹åŒâ‘¡&lt;/p&gt;&lt;p&gt;ä»¥ä¸Šæ–¹æ¡ˆéƒ½å±äºå¯¹PNGå›¾ç‰‡è¿›è¡ŒäºŒæ¬¡å‹ç¼©ï¼ˆæœ‰çš„æ˜¯æœ‰æŸæœ‰çš„æ˜¯æ— æŸï¼‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å›¾ç‰‡è´¨é‡å’Œå›¾ç‰‡å¤§å°è¿™å¯¹çŸ›ç›¾ä¸­æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œé€‰æ‹©ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœä¸æƒ³å¯¹PNGå›¾ç‰‡è¿›è¡ŒäºŒæ¬¡å‹ç¼©ï¼Œå¯ä»¥è€ƒè™‘ç›´æ¥å°†å…¶æ›¿æ¢ä¸ºWebPæ ¼å¼çš„å›¾ç‰‡ã€‚å¦å¤–ï¼Œæˆ‘ä»¬å¯¹JPEGæ ¼å¼çš„å›¾ç‰‡ä¹Ÿå¯ä»¥è¿™ä¹ˆæ›¿æ¢ã€‚æ¯•ç«ŸWebPæ— è®ºæ˜¯ä¸PNGè¿˜æ˜¯ä¸JPEGæ ¼å¼æƒ³æ¯”ï¼Œå‹ç¼©åä½“ç§¯å¤§å°éƒ½å°å¾ˆå¤šã€‚WebPè½¬æ¢å·¥å…·æœ‰ï¼š&lt;/p&gt;&lt;p&gt;.9.pngå›¾ç‰‡æ ¼å¼ç®€ç§°ä¸ºNinaPatchå›¾ï¼Œæœ¬è´¨ä¸Šä»ç„¶æ˜¯PNGæ ¼å¼å›¾ç‰‡ã€‚ä¸è¿‡å®ƒçš„ä¼˜ç‚¹æ˜¯ä½“ç§¯å°ã€æ‹‰ä¼¸ä¸å˜å½¢ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°é€‚é…Androidå„ç§æœºå‹ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Android Studioæä¾›çš„åŠŸèƒ½ï¼Œå³é”®ä¸€å¼ PNGå›¾ç‰‡ç‚¹å‡»â€œcreate 9=Patch Fileâ€å³å¯å®Œæˆè½¬æ¢ã€‚&lt;/p&gt;&lt;p&gt;æ€»ç»“ï¼šæ— è®ºæ˜¯äºŒæ¬¡å‹ç¼©è¿˜æ˜¯æ ¼å¼è½¬æ¢ï¼Œæ— è®ºæ˜¯æœ‰æŸäºŒæ¬¡å‹ç¼©è¿˜æ˜¯æ— æŸäºŒæ¬¡å‹ç¼©ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œæ–¹æ¡ˆå’Œå·¥å…·çš„é€‰æ‹©ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬å·²ç»çŸ¥é“äº†Androidä¸­å›¾ç‰‡å†…å­˜ä¸­çš„è¡¨ç¤ºå½¢å¼ï¼ˆBitmapï¼‰å’Œç£ç›˜ä¸Šçš„è¡¨ç¤ºå½¢å¼ï¼ˆå„ç§å‹ç¼©æ ¼å¼ï¼‰ï¼Œä»¥åŠäºŒè€…çš„å…³ç³»ï¼ˆå‹ç¼©å’Œè§£å‹ç¼©çš„è¿‡ç¨‹ï¼‰ã€‚ä¸‹é¢å…·ä½“çœ‹çœ‹Bitmapçš„ä½¿ç”¨æ–¹å¼å’Œæ³¨æ„äº‹é¡¹ï¼Œæ¯•ç«Ÿç£ç›˜ä¸Šå­˜å‚¨çš„å›¾ç‰‡ç»ˆç©¶è¿˜æ˜¯è¦åŠ è½½åˆ°å†…å­˜ä¸­ä»¥Bitmapçš„å½¢å¼è¿›è¡Œå±•ç¤ºçš„ã€‚&lt;/p&gt;&lt;p&gt;Bitmapçš„å·¥å‚ç±»BitmapFactoryæä¾›äº†å››ç±»é™æ€æ–¹æ³•ç”¨äºåŠ è½½Bitmapå¯¹è±¡ï¼šdecodeFileã€decodeResourceã€decodeStreamã€decodeByteArrayã€‚&lt;/p&gt;&lt;p&gt;åˆ†åˆ«ä»£è¡¨ä»æœ¬åœ°å›¾ç‰‡æ–‡ä»¶ã€é¡¹ç›®èµ„æºæ–‡ä»¶ã€æµå¯¹è±¡ï¼ˆå¯ä»¥æ˜¯ç½‘ç»œè¾“å…¥æµå¯¹è±¡æˆ–æœ¬åœ°æ–‡ä»¶è¾“å…¥æµå¯¹è±¡ï¼‰ã€å­—èŠ‚åºåˆ—ä¸­åŠ è½½ä¸€ä¸ªBitmapå¯¹è±¡ã€‚&lt;/p&gt;&lt;p&gt;ä¹‹å‰è®²çš„å›¾ç‰‡çš„ä¸‰ä¸ªæ¥æºï¼Œéƒ½å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„decodeXXXXæ–¹æ³•æ¥è·å–è¯¥å›¾ç‰‡å¯¹åº”çš„Bitmapå¯¹è±¡ã€‚&lt;/p&gt;&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾éœ€è¦é€šè¿‡ç½‘ç»œè¯·æ±‚ä¸€å¼ å›¾ç‰‡èµ„æºå¹¶å±•ç¤ºï¼šå…ˆå¤„ç†è¯¥ç½‘ç»œè¯·æ±‚å¹¶å¾—åˆ°è¿”å›ç»“æœçš„è¾“å…¥æµå¯¹è±¡ï¼›ä¾æ®è¯¥æµå¯¹è±¡è°ƒç”¨decodeStreamæ–¹æ³•å¾—åˆ°ä¸€ä¸ªBitmapå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å³è¡¨ç¤ºè¿™å¼ å›¾ç‰‡çš„å†…å®¹ï¼›æœ€åé€šè¿‡ImageViewçš„setImageBitmap()æ–¹æ³•æ˜¾ç¤ºè¯¥å›¾ç‰‡å³å¯ã€‚&lt;/p&gt;&lt;p&gt;Bitmapçš„å‹ç¼©å­˜å‚¨ä¸Bitmapçš„åŠ è½½æ˜¯ç›¸åçš„è¿‡ç¨‹ï¼Œé€šè¿‡compress()æ–¹æ³•æ¥å®ç°ï¼Œè¯¥æ–¹æ³•åŸå‹ä¸ºï¼š&lt;/p&gt;&lt;p&gt;formatå‚æ•°è¡¨ç¤ºå‹ç¼©å­˜å‚¨çš„æ ¼å¼ï¼Œå¯é€‰ä¸ºPNGã€JPEGå’ŒWEBPï¼›qualityè¡¨ç¤ºå‹ç¼©ç‡ï¼Œå–å€¼åœ¨0~100ä¹‹é—´ï¼Œ100è¡¨ç¤ºæœªå‹ç¼©ï¼Œ30è¡¨ç¤ºå‹ç¼©ä¸ºåŸå¤§å°çš„30%ï¼Œä½†æ˜¯è¯¥å‚æ•°åœ¨formatå€¼ä¸ºPNGæ—¶æ— æ•ˆï¼Œå› ä¸ºPNGå±äºæ— æŸå‹ç¼©æ— æ³•è®¾ç½®å‹ç¼©ç‡ï¼›streamå°±æ˜¯å¸Œæœ›è¾“å‡ºåˆ°æŸä¸ªä½ç½®çš„è¾“å‡ºæµå¯¹è±¡ï¼Œæ¯”å¦‚æŸä¸ªæ–‡ä»¶çš„è¾“å‡ºæµå¯¹è±¡ã€‚&lt;/p&gt;&lt;p&gt;é€šè¿‡compress()æ–¹æ³•å¯ä»¥å°†BitmapæŒ‰ç…§æŒ‡å®šçš„æ ¼å¼å’Œå‹ç¼©ç‡ï¼ˆéPNGæ ¼å¼æ—¶ï¼‰å‹ç¼©å­˜å‚¨åˆ°æŒ‡å®šçš„ä½ç½®ã€‚&lt;/p&gt;&lt;p&gt;BitmapFactoryæ˜¯Bitmapçš„å·¥å‚ç±»ï¼Œé€šè¿‡BitmapFactoryçš„é™æ€æ–¹æ³•æ¥åˆ›å»ºBitmapå¯¹è±¡ï¼›BitmapFactory.Optionsç±»ä»£è¡¨å¯¹Bitmapå¯¹è±¡çš„å±æ€§è®¾ç½®ï¼ˆé…ç½®ï¼‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è°ƒç”¨decodeXXXXæ–¹æ³•æ—¶ä¸éœ€è¦ä¼ é€’ä¸€ä¸ªBitmapFactory.Optionså¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå› æ­¤æ­¤æ—¶æ˜¯åˆ©ç”¨é»˜è®¤çš„é…ç½®ä¿¡æ¯æ¥åˆ›å»ºBitmapå¯¹è±¡ã€‚å¦‚æœéœ€è¦å¯¹åˆ›å»ºçš„Bitmapå¯¹è±¡è¿›è¡Œè‡ªå®šä¹‰çš„é…ç½®ï¼Œé‚£ä¹ˆå°±éœ€è¦ç»™decodeXXXXæ–¹æ³•ä¼ é€’ä¸€ä¸ªBitmapFactory.Optionså¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«äº†å¯¹Bitmapå¯¹è±¡çš„é…ç½®ä¿¡æ¯ã€‚&lt;/p&gt;&lt;p&gt;é€šè¿‡BitmapFactory.Optionsç±»çš„æ„é€ å™¨åˆ›å»ºBitmapFactory.Optionså¯¹è±¡ã€‚è¯¥å¯¹è±¡åŒ…å«çš„Bitmapé…ç½®ä¿¡æ¯å³ä¸ºè¯¥å¯¹è±¡çš„å„å±æ€§å€¼ï¼Œä¸»è¦æœ‰ï¼š&lt;/p&gt;&lt;div readability=&quot;236.69208150985&quot;&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1218256/201906/1218256-20190615162345712-1901971754.png&quot; alt=&quot;&quot;/&gt;&lt;p&gt;ä»‹ç»ä¸€ä¸‹æ¯”è¾ƒä¸å¥½ç†è§£çš„å±æ€§ï¼š&lt;/p&gt;
&lt;p&gt;â‘ inJustDecodeBoundsï¼šè¿™ä¸ªå±æ€§è¡¨ç¤ºæ˜¯å¦åªæ‰«æè½®å»“ï¼Œé»˜è®¤ä¸ºfalseã€‚å¦‚æœè¯¥å±æ€§ä¸ºtrueï¼ŒdecodeXXXXæ–¹æ³•ä¸ä¼šè¿”å›ä¸€ä¸ªBitmapå¯¹è±¡ï¼ˆå³ä¸ä¼šä¸ºBitmapåˆ†é…å†…å­˜ï¼‰è€Œæ˜¯è¿”å›nullã€‚é‚£å¦‚æœdecodeXXXXæ–¹æ³•ä¸å†åˆ†é…å†…å­˜ä»¥åˆ›å»ºä¸€ä¸ªBitmapå¯¹è±¡ï¼Œé‚£ä¹ˆè¿˜æœ‰ä»€ä¹ˆç”¨å‘¢?ç­”æ¡ˆå°±æ˜¯ï¼šæ‰«æè½®å»“ã€‚&lt;/p&gt;
&lt;p&gt;BitmapFactory.Optionså¯¹è±¡çš„outWidthå’ŒoutHeightå±æ€§åˆ†åˆ«ä»£è¡¨Bitmapå¯¹è±¡çš„å®½å’Œé«˜ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå±æ€§åœ¨Bitmapå¯¹è±¡æœªåˆ›å»ºä¹‹å‰æ˜¾ç„¶é»˜è®¤ä¸º0ï¼Œé»˜è®¤åªæœ‰åœ¨Bitmapå¯¹è±¡åˆ›å»ºåæ‰èƒ½è¢«èµ‹äºˆæ­£ç¡®çš„å€¼ã€‚è€Œå½“inJustDecodeBoundså±æ€§ä¸ºtrueï¼Œè™½ç„¶ä¸ä¼šåˆ†é…å†…å­˜åˆ›å»ºBitmapå¯¹è±¡ï¼Œä½†æ˜¯ä¼šæ‰«æè½®å»“æ¥ç»™outWidthå’ŒoutHeightå±æ€§èµ‹å€¼ï¼Œå°±ç›¸å½“äºç»•è¿‡äº†Bitmapå¯¹è±¡åˆ›å»ºçš„è¿™ä¸€æ­¥æå‰è·å–åˆ°Bitmapå¯¹è±¡çš„å®½é«˜å€¼ã€‚é‚£è¿™ä¸ªå±æ€§åˆ°åº•æœ‰å•¥ç”¨å‘¢ï¼Ÿå…·ä½“ç”¨å¤„ä½“ç°åœ¨Bitmapçš„é‡‡æ ·ç‡è®¡ç®—ä¸­ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚&lt;/p&gt;
&lt;p&gt;â‘¡inSampleï¼šè¿™ä¸ªè¡¨ç¤ºBitmapçš„é‡‡æ ·ç‡ï¼Œé»˜è®¤ä¸º1ã€‚æ¯”å¦‚è¯´æœ‰ä¸€å¼ å›¾ç‰‡æ˜¯2048åƒç´ X1024åƒç´ ï¼Œé‚£ä¹ˆé»˜è®¤æƒ…å†µä¸‹è¯¥å›¾ç‰‡åŠ è½½åˆ°å†…å­˜ä¸­çš„Bitmapå¯¹è±¡å°ºå¯¸ä¹Ÿæ˜¯2048åƒç´ X1024åƒç´ ã€‚å¦‚æœé‡‡ç”¨çš„æ˜¯ARGB_8888æ–¹å¼ï¼Œé‚£ä¹ˆè¯¥Bitmapå¯¹è±¡åŠ è½½æ‰€æ¶ˆè€—çš„å†…å­˜ä¸º2048X1024X4/1024/1024=8Mã€‚è¿™åªæ˜¯ä¸€å¼ å›¾ç‰‡æ¶ˆè€—çš„å†…å­˜ï¼Œå¦‚æœå½“å‰æ´»åŠ¨éœ€è¦åŠ è½½å‡ å¼ ç”šè‡³å‡ åå¼ å›¾ç‰‡ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ä¸¥é‡çš„OOMé”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;OOMé”™è¯¯ï¼šå°½ç®¡Androidè®¾å¤‡å†…å­˜å¤§å°å¯èƒ½è¾¾åˆ°å¥½å‡ ä¸ªGï¼ˆæ¯”å¦‚4Gï¼‰ï¼Œä½†æ˜¯Andoridä¸­æ¯ä¸ªåº”ç”¨å…¶è¿è¡Œå†…å­˜éƒ½æœ‰ä¸€ä¸ªé˜ˆå€¼ï¼Œè¶…è¿‡è¿™ä¸ªé˜ˆå€¼å°±ä¼šå¼•å‘out of memoryå³OOMé”™è¯¯ï¼ˆå†…å­˜æº¢å‡ºé”™è¯¯ï¼‰ã€‚å› ä¸ºç°åœ¨å¸‚åœºä¸Šæµè¡Œçš„æ‰‹æœºè®¾å¤‡å…¶æ“ä½œç³»ç»Ÿéƒ½æ˜¯åœ¨AndoriåŸç”Ÿæ“ä½œç³»ç»ŸåŸºç¡€ä¸Šçš„æ‹“å±•ï¼Œæ‰€ä»¥ä¸åŒçš„è®¾å¤‡ç¯å¢ƒä¸­è¿™ä¸ªå†…å­˜é˜ˆå€¼ä¸ä¸€æ ·ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•è·å–åˆ°å½“å‰åº”ç”¨æ‰€åˆ†é…çš„å†…å­˜é˜ˆå€¼å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚ï¼š Runtime.getRuntime().maxMemory()ï¼›&lt;/p&gt;
&lt;p&gt;å°½ç®¡æˆ‘ä»¬ç¡®å®å¯ä»¥é€šè¿‡è®¾ç½®æ¥ä¿®æ”¹è¿™ä¸ªé˜ˆå€¼å¤§å°ä»¥æé«˜åº”ç”¨çš„æœ€å¤§åˆ†é…å†…å­˜ï¼ˆå…·ä½“æ–¹å¼æ˜¯åœ¨åœ¨Manifestä¸­è®¾ç½®android.largeHeap=&quot;true&quot;ï¼‰ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå†…å­˜æ˜¯ä¸€ç§å¾ˆå®è´µçš„èµ„æºï¼Œä¸åŠ è€ƒè™‘åœ°æ— è„‘ç»™æ¯ä¸ªåº”ç”¨æé«˜æœ€å¤§åˆ†é…å†…å­˜æ˜¯ä¸€ä¸ªç³Ÿç³•çš„é€‰æ‹©ã€‚å› ä¸ºæ‰‹æœºæ€»å†…å­˜ç›¸æ¯”è¾ƒæ¯ä¸ªåº”ç”¨é»˜è®¤çš„æœ€å¤§åˆ†é…å†…å­˜è™½ç„¶é«˜å¾ˆå¤šï¼Œä½†æ˜¯æ‰‹æœºä¸­çš„åº”ç”¨æ•°é‡æ˜¯éå¸¸å¤šçš„ï¼Œæ¯ä¸ªåº”ç”¨éƒ½ä¿®æ”¹å…¶è¿è¡Œå†…å­˜é˜ˆå€¼ä¸ºå‡ ç™¾MBç”šè‡³ä¸€ä¸ªGï¼Œè¿™å¾ˆä¸¥é‡å½±å“æ‰‹æœºæ€§èƒ½ï¼å¦å¤–ï¼Œå¦‚æœåº”ç”¨çš„æœ€å¤§åˆ†é…å†…å­˜å¾ˆé«˜ï¼Œè¿™æ„å‘³ç€å…¶åƒåœ¾å›æ”¶å·¥ä½œä¹Ÿä¼šå˜å¾—æ›´åŠ è€—æ—¶ï¼Œè¿™ä¹Ÿä¼šå½±å“åº”ç”¨å’Œæ‰‹æœºçš„æ€§èƒ½ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªæ–¹æ¡ˆéœ€è¦æ…é‡è€ƒè™‘ä¸èƒ½æ»¥ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºè¿™ä¸ªæ–¹æ¡ˆçš„ç†è§£å¯ä»¥å‚è€ƒä¸€ä½å¤§ç¥çš„è§£é‡Šï¼šâ€œåœ¨ä¸€äº›ç‰¹æ®Šçš„æƒ…æ™¯ä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨manifestçš„applicationæ ‡ç­¾ä¸‹æ·»åŠ largeHeap=trueçš„å±æ€§æ¥ä¸ºåº”ç”¨å£°æ˜ä¸€ä¸ªæ›´å¤§çš„heapç©ºé—´ã€‚ç„¶åï¼Œä½ å¯ä»¥é€šè¿‡getLargeMemoryClass()æ¥è·å–åˆ°è¿™ä¸ªæ›´å¤§çš„heap sizeé˜ˆå€¼ã€‚ç„¶è€Œï¼Œå£°æ˜å¾—åˆ°æ›´å¤§Heapé˜ˆå€¼çš„æœ¬æ„æ˜¯ä¸ºäº†ä¸€å°éƒ¨åˆ†ä¼šæ¶ˆè€—å¤§é‡RAMçš„åº”ç”¨(ä¾‹å¦‚ä¸€ä¸ªå¤§å›¾ç‰‡çš„ç¼–è¾‘åº”ç”¨)ã€‚ä¸è¦è½»æ˜“çš„å› ä¸ºä½ éœ€è¦ä½¿ç”¨æ›´å¤šçš„å†…å­˜è€Œå»è¯·æ±‚ä¸€ä¸ªå¤§çš„Heap Sizeã€‚åªæœ‰å½“ä½ æ¸…æ¥šçš„çŸ¥é“å“ªé‡Œä¼šä½¿ç”¨å¤§é‡çš„å†…å­˜å¹¶ä¸”çŸ¥é“ä¸ºä»€ä¹ˆè¿™äº›å†…å­˜å¿…é¡»è¢«ä¿ç•™æ—¶æ‰å»ä½¿ç”¨large heapã€‚å› æ­¤è¯·è°¨æ…ä½¿ç”¨large heapå±æ€§ã€‚ä½¿ç”¨é¢å¤–çš„å†…å­˜ç©ºé—´ä¼šå½±å“ç³»ç»Ÿæ•´ä½“çš„ç”¨æˆ·ä½“éªŒï¼Œå¹¶ä¸”ä¼šä½¿å¾—æ¯æ¬¡gcçš„è¿è¡Œæ—¶é—´æ›´é•¿ã€‚åœ¨ä»»åŠ¡åˆ‡æ¢æ—¶ï¼Œç³»ç»Ÿçš„æ€§èƒ½ä¼šå¤§æ‰“æŠ˜æ‰£ã€‚å¦å¤–, large heapå¹¶ä¸ä¸€å®šèƒ½å¤Ÿè·å–åˆ°æ›´å¤§çš„heapã€‚åœ¨æŸäº›æœ‰ä¸¥æ ¼é™åˆ¶çš„æœºå™¨ä¸Šï¼Œlarge heapçš„å¤§å°å’Œé€šå¸¸çš„heap sizeæ˜¯ä¸€æ ·çš„ã€‚å› æ­¤å³ä½¿ä½ ç”³è¯·äº†large heapï¼Œä½ è¿˜æ˜¯åº”è¯¥é€šè¿‡æ‰§è¡ŒgetMemoryClass()æ¥æ£€æŸ¥å®é™…è·å–åˆ°çš„heapå¤§å°ã€‚â€&lt;/p&gt;
&lt;p&gt;ç»¼ä¸Šï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†Bitmapçš„åŠ è½½æ˜¯ä¸€ä¸ªå¾ˆè€—å†…å­˜çš„æ“ä½œï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§ä½å›¾çš„æƒ…å†µä¸‹ã€‚è¿™å¾ˆå®¹æ˜“å¼•å‘OOMé”™è¯¯ï¼Œè€Œæˆ‘ä»¬åˆä¸èƒ½è½»æ˜“åœ°é€šè¿‡ä¿®æ”¹æˆ–æä¾›åº”ç”¨çš„å†…å­˜é˜ˆå€¼æ¥é¿å…è¿™ä¸ªé”™è¯¯ã€‚é‚£ä¹ˆæˆ‘ä»¬è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ï¼šåˆ©ç”¨è¿™é‡Œæ‰€è¯´çš„é‡‡æ ·ç‡å±æ€§æ¥åˆ›å»ºä¸€ä¸ªåŸBitmapçš„å­é‡‡æ ·ç‰ˆæœ¬ã€‚è¿™ä¹Ÿæ˜¯å®˜æ–¹æ¨èçš„å¯¹äºå¤§ä½å›¾åŠ è½½çš„OOMé—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚å…¶å…·ä½“æ€æƒ³ä¸ºï¼šæ¯”å¦‚è¿˜æ˜¯é‚£å¼ å°ºå¯¸ä¸º2048åƒç´ X1024åƒç´ å›¾ç‰‡ï¼Œåœ¨inSampleå€¼é»˜è®¤ä¸º1çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»çŸ¥é“å®ƒåŠ è½½åˆ°å†…å­˜ä¸­é»˜è®¤æ˜¯ä¸€ä¸ª2048åƒç´ X1024åƒç´ å¤§ä½å›¾äº†ã€‚æˆ‘ä»¬å¯ä»¥å°†inSampleè®¾ç½®ä¸º2ï¼Œé‚£ä¹ˆè¯¥å›¾ç‰‡åŠ è½½åˆ°å†…å­˜ä¸­çš„ä½å›¾å®½é«˜éƒ½ä¼šå˜æˆåŸå®½é«˜çš„1/2ï¼Œå³1024åƒç´ X512åƒç´ ã€‚è¿›ä¸€æ­¥ï¼Œå¦‚æœinSampleå€¼è®¾ç½®ä¸º4ï¼Œé‚£ä¹ˆä½å›¾å°ºå¯¸ä¼šå˜æˆ512åƒç´ X256åƒç´ ï¼Œè¿™ä¸ªæ—¶å€™è¯¥ä½å›¾æ‰€æ¶ˆè€—çš„å†…å­˜ï¼ˆå‡è®¾è¿˜æ˜¯ARGB_8888æ–¹å¼ï¼‰ä¸º512X256X4/1024/1024=0.5Mï¼Œå¯ä»¥çœ‹å‡ºä»8Måˆ°0.5Mï¼Œè¿™æå¤§çš„èŠ‚çœäº†å†…å­˜èµ„æºä»è€Œé¿å…äº†OOMé”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;åˆ‡è®°ï¼šå®˜æ–¹å¯¹äºinSampleå€¼çš„è¦æ±‚æ˜¯ï¼Œå¿…é¡»ä¸º2çš„å¹‚ï¼Œæ¯”å¦‚2ã€4ã€8...ç­‰æ•´æ•°å€¼ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä¼šæœ‰ä¸¤ä¸ªç–‘é—®ï¼šç¬¬ä¸€ï¼šé€šè¿‡è®¾ç½®inSampleå±æ€§å€¼æ¥åˆ›å»ºä¸€ä¸ªåŸå¤§ä½å›¾çš„å­é‡‡æ ·ç‰ˆæœ¬çš„æ–¹å¼æ¥é™ä½å†…å­˜æ¶ˆè€—ï¼Œå¬ä¸ä¸Šç¡®å®å¾ˆä¸é”™ã€‚ä½†æ˜¯è¿™ä¸ä¼šå¯¼è‡´å›¾ç‰‡ä¸¥é‡å¤±çœŸå—ï¼Ÿæ¯•ç«Ÿä½ ä¸¢å¤±äº†é‚£ä¹ˆå¤šåƒç´ ç‚¹ï¼Œè¿™æ„å‘³ç€ä½ ä¸¢å¤±äº†å¾ˆå¤šé¢œè‰²ä¿¡æ¯ã€‚å¯¹è¿™ä¸ªç–‘é—®çš„è§£é‡Šæ˜¯ï¼šå°½ç®¡åœ¨é‡‡æ ·çš„è¿‡ç¨‹ç¡®å®ä¼šä¸¢å¤±å¾ˆå¤šåƒç´ ç‚¹ï¼Œä½†æ˜¯åŸä½å›¾çš„å°ºå¯¸ä¹Ÿåœ¨å‡å°ï¼Œå…¶åƒç´ å¯†åº¦æ˜¯ä¸å˜çš„ã€‚æ¯”å¦‚è¯´å¦‚æœinSampleå€¼ä¸º2ï¼Œé‚£ä¹ˆå­é‡‡æ ·ç‰ˆæœ¬çš„åƒç´ ç‚¹æ•°é‡æ˜¯åŸæ¥çš„1/4ï¼Œä½†æ˜¯å­é‡‡æ ·ç‰ˆæœ¬çš„æ˜¾ç¤ºå°ºå¯¸ï¼ˆåŒºåŸŸé¢ç§¯ï¼‰ä¹Ÿä¼šå˜æˆåŸæ¥çš„1/4ï¼Œè¿™æ ·çš„è¯åƒç´ å¯†ç æ˜¯ä¸å˜çš„å› æ­¤å›¾ç‰‡ä¸ç”¨æ‹…å¿ƒä¸¥é‡å¤±çœŸé—®é¢˜ã€‚ç¬¬äºŒï¼šinSampleå€¼å¦‚ä½•é€‰å–æ‰æ˜¯æœ€ä½³ï¼Ÿè¿™å…¶å®å–å†³äºImageViewçš„å°ºå¯¸ï¼Œå…·ä½“é‡‡æ ·ç‡çš„è®¡ç®—æ–¹å¼åé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚&lt;/p&gt;
&lt;p&gt;â‘¢inPreferredConfigï¼šè¯¥å±æ€§æŒ‡å®šBitmapçš„è‰²æ·±å€¼ï¼Œè¯¥å±æ€§ç±»å‹ä¸ºBitmap.Configå€¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ä½ å¯ä»¥æŒ‡å®šæŸå›¾ç‰‡åŠ è½½ä¸ºBitmapå¯¹è±¡çš„è‰²æ·±æ¨¡å¼ä¸ºARGB_8888ï¼Œå³ï¼šoptions.inPreferredConfig=Bitmap.Config.ARGB_8888ï¼›&lt;/p&gt;
&lt;p&gt;â‘£isMutableï¼šè¯¥å±æ€§è¡¨ç¤ºé€šè¿‡decodeXXXXæ–¹æ³•åˆ›å»ºçš„Bitmapå¯¹è±¡å…¶ä»£è¡¨çš„å›¾ç‰‡å†…å®¹æ˜¯å¦å…è®¸è¢«å¤–éƒ¨ä¿®æ”¹ï¼Œæ¯”å¦‚åˆ©ç”¨Canvasé‡æ–°ç»˜åˆ¶å…¶å†…å®¹ç­‰ã€‚é»˜è®¤ä¸ºfalseï¼Œå³ä¸å…è®¸è¢«å¤–éƒ¨æ“ä½œä¿®æ”¹ã€‚&lt;/p&gt;
&lt;p&gt;åˆ©ç”¨è¿™äº›å±æ€§å®šåˆ¶BitmapFactory.Optionså¯¹è±¡ï¼Œä»è€Œçµæ´»åœ°æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚é…ç½®åˆ›å»ºçš„Bitmapå¯¹è±¡ã€‚&lt;/p&gt;

&lt;p&gt;äº”ã€Bitmapçš„è¿›é˜¶ä½¿ç”¨&lt;/p&gt;
&lt;p&gt;1ã€é«˜æ•ˆåœ°åŠ è½½å¤§ä½å›¾&lt;/p&gt;
&lt;p&gt;ä¸Šé¢åˆšè¯´äº†å¤§ä½å›¾åŠ è½½æ—¶çš„OOMé—®é¢˜ï¼Œè§£å†³æ–¹å¼æ˜¯é€šè¿‡inSampleå±æ€§åˆ›å»ºä¸€ä¸ªåŸä½å›¾çš„å­é‡‡æ ·ç‰ˆæœ¬ä»¥å‡ä½å†…å­˜ã€‚é‚£ä¹ˆè¿™é‡Œçš„é‡‡æ ·ç‡inSampleå€¼å¦‚ä½•é€‰å–æœ€å¥½å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬åˆ©ç”¨å®˜æ–¹æ¨èçš„é‡‡æ ·ç‡æœ€ä½³è®¡ç®—æ–¹å¼ï¼šåŸºæœ¬æ­¥éª¤å°±æ˜¯ï¼šâ‘ è·å–ä½å›¾åŸå°ºå¯¸ â‘¡è·å–ImageViewå³æœ€ç»ˆå›¾ç‰‡æ˜¾ç¤ºçš„å°ºå¯¸ Â â‘¢ä¾æ®ä¸¤ç§å°ºå¯¸è®¡ç®—é‡‡æ ·ç‡ï¼ˆæˆ–ç¼©æ”¾æ¯”ä¾‹ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;37&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; calculateInSampleSize(
            BitmapFactory.Options options, &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; reqWidth, &lt;span&gt;int&lt;/span&gt;&lt;span&gt; reqHeight) {
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ä½å›¾çš„åŸå®½é«˜é€šè¿‡optionså¯¹è±¡è·å–&lt;/span&gt;
    &lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; height =&lt;span&gt; options.outHeight;
    &lt;/span&gt;&lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; width =&lt;span&gt; options.outWidth;
    &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; inSampleSize = 1&lt;span&gt;;

    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (height &amp;gt; reqHeight || width &amp;gt;&lt;span&gt; reqWidth) {

        &lt;/span&gt;&lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; halfHeight = height / 2&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;final&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; halfWidth = width / 2&lt;span&gt;;
     &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“è¦æ˜¾ç¤ºçš„ç›®æ ‡å¤§å°å’Œå›¾åƒçš„å®é™…å¤§å°æ¯”è¾ƒæ¥è¿‘æ—¶ï¼Œä¼šäº§ç”Ÿæ²¡å¿…è¦çš„é‡‡æ ·ï¼Œå…ˆé™¤ä»¥2å†åˆ¤æ–­ä»¥é˜²æ­¢è¿‡åº¦é‡‡æ ·&lt;/span&gt;
        &lt;span&gt;while&lt;/span&gt; ((halfHeight / inSampleSize) &amp;gt;=&lt;span&gt; reqHeight
                &lt;/span&gt;&amp;amp;&amp;amp; (halfWidth / inSampleSize) &amp;gt;=&lt;span&gt; reqWidth) {
            inSampleSize &lt;/span&gt;*= 2&lt;span&gt;;
        }
    }

    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; inSampleSize;
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¾æ®ä¸Šé¢çš„æœ€ä½³é‡‡æ ·ç‡è®¡ç®—æ–¹æ³•ï¼Œè¿›ä¸€æ­¥å¯ä»¥å°è£…å‡ºåˆ©ç”¨æœ€ä½³é‡‡æ ·ç‡åˆ›å»ºå­é‡‡æ ·ç‰ˆæœ¬å†åˆ›å»ºä½å›¾å¯¹è±¡çš„æ–¹æ³•ï¼Œè¿™é‡Œä»¥ä»é¡¹ç›®å›¾ç‰‡èµ„æºæ–‡ä»¶åŠ è½½Bitmapå¯¹è±¡ä¸ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;44&quot;&gt;
&lt;pre&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;static&lt;/span&gt; Bitmap decodeSampledBitmapFromResource(Resources res, &lt;span&gt;int&lt;/span&gt;&lt;span&gt; resId,
        &lt;/span&gt;&lt;span&gt;int&lt;/span&gt; reqWidth, &lt;span&gt;int&lt;/span&gt;&lt;span&gt; reqHeight) {

    &lt;/span&gt;&lt;span&gt;final&lt;/span&gt; BitmapFactory.Options options = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; BitmapFactory.Options();
    options.inJustDecodeBounds &lt;/span&gt;= &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
   &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å› ä¸ºinJustDecodeBoundsä¸ºtrueï¼Œæ‰€ä»¥ä¸ä¼šåˆ›å»ºBitmapå¯¹è±¡åªä¼šæ‰«æè½®å»“ä»è€Œç»™optionså¯¹è±¡çš„å®½é«˜å±æ€§èµ‹å€¼&lt;/span&gt;
&lt;span&gt;    BitmapFactory.decodeResource(res, resId, options);

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è®¡ç®—æœ€ä½³é‡‡æ ·ç‡&lt;/span&gt;
    options.inSampleSize =&lt;span&gt; calculateInSampleSize(options, reqWidth, reqHeight);

    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; è®°å¾—å°†inJustDecodeBoundså±æ€§è®¾ç½®å›falseå€¼&lt;/span&gt;
    options.inJustDecodeBounds = &lt;span&gt;false&lt;/span&gt;&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; BitmapFactory.decodeResource(res, resId, options);
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;2ã€BitmapåŠ è½½æ—¶çš„å¼‚æ­¥é—®é¢˜&lt;/p&gt;
&lt;p&gt;ç”±äºå›¾ç‰‡çš„æ¥æºæœ‰ä¸‰ç§ï¼Œå¦‚æœæ˜¯é¡¹ç›®å›¾ç‰‡èµ„æºæ–‡ä»¶çš„åŠ è½½ï¼Œä¸€èˆ¬é‡‡å–äº†å­é‡‡æ ·ç‰ˆæœ¬åŠ è½½æ–¹æ¡ˆåä¸ä¼šå¯¼è‡´ANRé—®é¢˜ï¼Œæ¯•ç«Ÿæ¯å¼ å›¾åŠ è½½æ¶ˆè€—çš„å†…å­˜ä¸ä¼šå¾ˆå¤§äº†ã€‚ä½†æ˜¯å¯¹äºæœ¬åœ°å›¾ç‰‡æ–‡ä»¶å’Œç½‘ç»œå›¾ç‰‡èµ„æºï¼Œç”±äºåˆ†åˆ«æ¶‰åŠåˆ°æ–‡ä»¶è¯»å–å’Œç½‘ç»œè¯·æ±‚ï¼Œæ‰€ä»¥å±äºè€—æ—¶æ“ä½œã€‚ä¸ºäº†é¿å…ANRçš„äº§ç”Ÿï¼Œå¿…é¡»å°†å›¾ç‰‡åŠ è½½ä¸ºBitmapå¯¹è±¡çš„è¿‡ç¨‹æ”¾å…¥å·¥ä½œçº¿ç¨‹ä¸­ï¼›è·å–åˆ°Bitmapå¯¹è±¡åå†å›åˆ°UIçº¿ç¨‹è®¾ç½®ImageViewçš„æ˜¾ç¤ºã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœé‡‡ç”¨AsyncTaskä½œä¸ºæˆ‘ä»¬çš„å¼‚æ­¥å¤„ç†æ–¹æ¡ˆï¼Œé‚£ä¹ˆä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt;class&lt;/span&gt; BitmapWorkerTask &lt;span&gt;extends&lt;/span&gt; AsyncTask&amp;lt;Integer, Void, Bitmap&amp;gt;&lt;span&gt; {
         &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt;&lt;span&gt; ImageView iv;
         &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; id = 0&lt;span&gt;;
 
         &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; BitmapWorkerTask(ImageView imageView) {
             iv &lt;/span&gt;=&lt;span&gt; imageView;
          }
 
         &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Decode image in background.&lt;/span&gt;
&lt;span&gt;         @Override
         &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt;&lt;span&gt; Bitmap doInBackground(Integer... params) {
             id &lt;/span&gt;= params[0&lt;span&gt;];
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å‡è®¾ImageViewå°ºå¯¸ä¸º500X500ï¼Œä¸ºäº†æ–¹ä¾¿è¿˜æ˜¯ä»¥é¡¹ç›®èµ„æºæ–‡ä»¶çš„åŠ è½½æ–¹å¼ä¸ºä¾‹ï¼Œå› ä¸ºè¿™å¯ä»¥å¤ç”¨ä¸Šé¢å°è£…çš„æ–¹æ³•&lt;/span&gt;
             &lt;span&gt;return&lt;/span&gt; decodeSampledBitmapFromResource(getResources(), id, 500, 500&lt;span&gt;);
        }
 
         @Override
         &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; onPostExecute(Bitmap bitmap) {
             iv.setImageBitmap(bitmap);
         }
     }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;è¯¥æ–¹æ¡ˆä¸­ï¼ŒdoInBackgroundæ–¹æ³•æ‰§è¡Œåœ¨å­çº¿ç¨‹ï¼Œç”¨æ¥å¤„ç† â€å›¾ç‰‡æ–‡ä»¶è¯»å–æ“ä½œ+Bitmapå¯¹è±¡çš„é«˜æ•ˆåŠ è½½æ“ä½œâ€ æˆ– â€ç½‘ç»œè¯·æ±‚å›¾ç‰‡èµ„æºæ“ä½œ+Bimapå¯¹è±¡çš„é«˜æ•ˆåŠ è½½æ“ä½œâ€ç­‰ä¸¤ç§æƒ…å½¢ä¸‹çš„è€—æ—¶æ“ä½œã€‚onPostExecuteæ–¹æ³•æ‰§è¡Œåœ¨UIçº¿ç¨‹ï¼Œç”¨äºè®¾ç½®ImageViewçš„æ˜¾ç¤ºå†…å®¹ã€‚çœ‹ä¸Šå»è¿™ä¸ªæ–¹æ¡ˆå¾ˆå®Œç¾ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆéšæ™¦çš„ä¸¥é‡é—®é¢˜ï¼š&lt;/p&gt;
&lt;p&gt;ç”±å½“å‰æ´»åŠ¨å¯åŠ¨äº†BitmapWorkerTaskä»»åŠ¡åï¼šå½“æˆ‘ä»¬é€€å‡ºå½“å‰æ´»åŠ¨æ—¶ï¼Œç”±äºå¼‚æ­¥ä»»åŠ¡åªä¾èµ–äºUIçº¿ç¨‹æ‰€ä»¥BitmapWorkerTaskä»»åŠ¡ä¼šç»§ç»­æ‰§è¡Œã€‚æ­£å¸¸çš„æ“ä½œæ˜¯éå†å½“å‰æ´»åŠ¨å®ä¾‹çš„å¯¹è±¡å›¾æ¥é‡Šæ”¾å„å¯¹è±¡çš„å†…å­˜ä»¥é”€æ¯è¯¥æ´»åŠ¨ï¼Œä½†æ˜¯ç”±äºå½“å‰æ´»åŠ¨å®ä¾‹çš„ImageViewå¼•ç”¨è¢«BitmapWorkerTaskå¯¹è±¡æŒæœ‰ï¼Œè€Œä¸”è¿˜æ˜¯å¼ºå¼•ç”¨å…³ç³»ã€‚è¿™ä¼šå¯¼è‡´Activityå®ä¾‹æ— æ³•è¢«é”€æ¯ï¼Œå¼•å‘å†…å­˜æ³„éœ²é—®é¢˜ã€‚å†…å­˜æ³„éœ²é—®é¢˜ä¼šè¿›ä¸€æ­¥å¯¼è‡´å†…å­˜æº¢å‡ºé”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åªéœ€è¦è®©BitmapWorkerTaskç±»æŒæœ‰ImageViewçš„å¼±å¼•ç”¨å³å¯ã€‚è¿™æ ·å½“æ´»åŠ¨é€€å‡ºæ—¶ï¼ŒBitmapWorkerTaskå¯¹è±¡ç”±äºæŒæœ‰çš„æ˜¯ImageViewçš„å¼±å¼•ç”¨ï¼Œæ‰€ä»¥ImageViewå¯¹è±¡ä¼šè¢«å›æ”¶ï¼Œç»§è€ŒActivityå®ä¾‹å¾—åˆ°é”€æ¯ï¼Œä»è€Œé¿å…äº†å†…å­˜æ³„éœ²é—®é¢˜ã€‚å…·ä½“ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;40&quot;&gt;
&lt;pre&gt;
&lt;span&gt;class&lt;/span&gt; BitmapWorkerTask &lt;span&gt;extends&lt;/span&gt; AsyncTask&amp;lt;Integer, Void, Bitmap&amp;gt;&lt;span&gt; {
        &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;final&lt;/span&gt; WeakReference&amp;lt;ImageView&amp;gt;&lt;span&gt; imageViewReference;
        &lt;/span&gt;&lt;span&gt;private&lt;/span&gt; &lt;span&gt;int&lt;/span&gt; data = 0&lt;span&gt;;

        &lt;/span&gt;&lt;span&gt;public&lt;/span&gt;&lt;span&gt; BitmapWorkerTask(ImageView imageView) {
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; ç”¨å¼±å¼•ç”¨æ¥å…³è”è¿™ä¸ªimageviewï¼å¼±å¼•ç”¨æ˜¯é¿å…android åœ¨å„ç§callbackå›è°ƒé‡Œå‘ç”Ÿå†…å­˜æ³„éœ²çš„æœ€ä½³æ–¹æ³•ï¼
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è€Œè½¯å¼•ç”¨åˆ™æ˜¯åšç¼“å­˜çš„æœ€ä½³æ–¹æ³• ä¸¤è€…ä¸è¦ææ··äº†ï¼&lt;/span&gt;
            imageViewReference = &lt;span&gt;new&lt;/span&gt; WeakReference&amp;lt;ImageView&amp;gt;&lt;span&gt;(imageView);
        }

        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; Decode image in background.&lt;/span&gt;
&lt;span&gt;        @Override
        &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt;&lt;span&gt; Bitmap doInBackground(Integer... params) {
            data &lt;/span&gt;= params[0&lt;span&gt;];
            &lt;/span&gt;&lt;span&gt;return&lt;/span&gt; decodeSampledBitmapFromResource(getResources(), data, 100, 100&lt;span&gt;);
        }

        @Override
        &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; onPostExecute(Bitmap bitmap) {
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å½“åå°çº¿ç¨‹ç»“æŸå å…ˆçœ‹çœ‹ImageViewå¯¹è±¡æ˜¯å¦è¢«å›æ”¶ï¼šå¦‚æœè¢«å›æ”¶å°±ä»€ä¹ˆä¹Ÿä¸åšï¼Œç­‰ç€ç³»ç»Ÿå›æ”¶ä»–çš„èµ„æº
            &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å¦‚æœImageViewå¯¹è±¡æ²¡è¢«å›æ”¶çš„è¯ï¼Œè®¾ç½®å…¶æ˜¾ç¤ºå†…å®¹å³å¯&lt;/span&gt;
            &lt;span&gt;if&lt;/span&gt; (imageViewReference != &lt;span&gt;null&lt;/span&gt; &amp;amp;&amp;amp; bitmap != &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
                &lt;/span&gt;&lt;span&gt;final&lt;/span&gt; ImageView imageView =&lt;span&gt; imageViewReference.get();
                &lt;/span&gt;&lt;span&gt;if&lt;/span&gt; (imageView != &lt;span&gt;null&lt;/span&gt;&lt;span&gt;) {
                    imageView.setImageBitmap(bitmap);
                }
            }
        }
    }&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ‹“å±•ï¼šâ‘ WeakReferenceæ˜¯å¼±å¼•ç”¨ï¼Œå…¶ä¸­ä¿å­˜çš„å¯¹è±¡å®ä¾‹å¯ä»¥è¢«GCå›æ”¶æ‰ã€‚è¿™ä¸ªç±»é€šå¸¸ç”¨äºåœ¨æŸå¤„ä¿å­˜å¯¹è±¡å¼•ç”¨ï¼Œè€Œåˆä¸å¹²æ‰°è¯¥å¯¹è±¡è¢«GCå›æ”¶ï¼Œå¯ä»¥ç”¨äºé¿å…å†…å­˜æ³„éœ²ã€‚â‘¡SoftReferenceæ˜¯è½¯å¼•ç”¨ï¼Œå®ƒä¿å­˜çš„å¯¹è±¡å®ä¾‹ï¼Œä¸ä¼šè¢«GCè½»æ˜“å›æ”¶ï¼Œé™¤éJVMå³å°†OutOfMemoryï¼Œå¦åˆ™ä¸ä¼šè¢«GCå›æ”¶ã€‚è¿™ä¸ªç‰¹æ€§ä½¿å¾—å®ƒéå¸¸é€‚åˆç”¨äºè®¾è®¡Cacheç¼“å­˜ã€‚ç¼“å­˜å¯ä»¥çœå»é‡å¤åŠ è½½çš„æ“ä½œï¼Œè€Œä¸”ç¼“å­˜å±äºå†…å­˜å› æ­¤è¯»å–æ•°æ®éå¸¸å¿«ï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªç„¶ä¸å¸Œæœ›ç¼“å­˜å†…å®¹è¢«GCè½»æ˜“åœ°å›æ”¶æ‰ï¼›ä½†æ˜¯å› ä¸ºç¼“å­˜æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§å†…å­˜èµ„æºï¼Œæ‰€ä»¥åœ¨å†…å­˜ç´§å¼ æ—¶æˆ‘ä»¬éœ€è¦èƒ½é‡Šæ”¾ä¸€éƒ¨åˆ†ç¼“å­˜ç©ºé—´æ¥é¿å…OOMé”™è¯¯ã€‚ç»¼ä¸Šï¼Œè½¯å¼•ç”¨éå¸¸é€‚åˆç”¨äºè®¾è®¡ç¼“å­˜Cacheã€‚ä½†æ˜¯ï¼Œè¿™åªæ˜¯æ—©äº›æ—¶å€™çš„ç¼“å­˜è®¾è®¡æ€æƒ³ï¼Œæ¯”å¦‚åœ¨Android2.3ç‰ˆæœ¬ä¹‹å‰ã€‚åœ¨Android2.3ç‰ˆæœ¬ä¹‹åï¼ŒJVMçš„åƒåœ¾æ”¶é›†å™¨å¼€å§‹æ›´ç§¯æåœ°å›æ”¶è½¯å¼•ç”¨å¯¹è±¡ï¼Œè¿™ä½¿å¾—åŸæœ¬çš„ç¼“å­˜è®¾è®¡æ€æƒ³å¤±æ•ˆäº†ã€‚å› ä¸ºå¦‚æœä½¿ç”¨è½¯å¼•ç”¨æ¥å®ç°ç¼“å­˜ï¼Œé‚£ä¹ˆåŠ¨ä¸åŠ¨ç¼“å­˜å¯¹è±¡å°±è¢«GCå›æ”¶æ‰å®åœ¨æ˜¯æ— æ³•æ¥å—ã€‚æ‰€ä»¥ï¼ŒAndroid2.3ä¹‹åå¯¹äºç¼“å­˜çš„è®¾è®¡ä½¿ç”¨çš„æ˜¯å¼ºå¼•ç”¨å…³ç³»ï¼ˆä¹Ÿå°±æ˜¯æ™®é€šå¯¹è±¡å¼•ç”¨å…³ç³»ï¼‰ã€‚å¾ˆå¤šäººä¼šé—®è¿™æ ·ä¸ä¼šç”±äºå¼ºå¼•ç”¨çš„ç¼“å­˜å¯¹è±¡æ— æ³•è¢«å›æ”¶ä»è€Œå¯¼è‡´OOMé”™è¯¯å—ï¼Ÿç¡®å®ä¼šè¿™æ ·ï¼Œä½†æ˜¯æˆ‘ä»¬åªéœ€è¦ç»™ç¼“å­˜è®¾ç½®ä¸€ä¸ªåˆç†çš„é˜ˆå€¼å°±å¥½äº†ã€‚å°†ç¼“å­˜å¤§å°æ§åˆ¶åœ¨è¿™ä¸ªé˜ˆå€¼èŒƒå›´å†…ï¼Œå°±ä¸ä¼šå¼•å‘OOMé”™è¯¯äº†ã€‚&lt;/p&gt;

&lt;p&gt;3ã€åˆ—è¡¨åŠ è½½Bitmapæ—¶çš„å›¾ç‰‡æ˜¾ç¤ºé”™ä¹±é—®é¢˜&lt;/p&gt;
&lt;p&gt;Â æˆ‘ä»¬å·²ç»çŸ¥é“äº†å¦‚ä½•é«˜æ•ˆåœ°åŠ è½½ä½å›¾ä»¥é¿å…OOMé”™è¯¯ï¼Œè¿˜çŸ¥é“äº†å¦‚ä½•åˆç†åœ°åˆ©ç”¨å¼‚æ­¥æœºåˆ¶æ¥é¿å…BitmapåŠ è½½æ—¶çš„ANRé—®é¢˜å’Œå†…å­˜æ³„éœ²é—®é¢˜ã€‚ç°åœ¨è€ƒè™‘å¦ä¸€ç§å¸¸è§çš„BitmapåŠ è½½é—®é¢˜ï¼šå½“æˆ‘ä»¬ä½¿ç”¨åˆ—è¡¨ï¼Œå¦‚ListViewã€GridViewå’ŒRecyclerViewç­‰æ¥åŠ è½½å¤šä¸ªBitmapæ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿå›¾ç‰‡æ˜¾ç¤ºé”™ä¹±çš„é—®é¢˜ã€‚å…ˆçœ‹ä¸€ä¸‹è¯¥é—®é¢˜äº§ç”Ÿçš„åŸå› ã€‚ä»¥ListViewä¸ºä¾‹ï¼š&lt;/p&gt;
&lt;p&gt;â‘ ListViewä¸ºäº†æé«˜åˆ—è¡¨å±•ç¤ºå†…å®¹åœ¨æ»šåŠ¨æ—¶çš„æµç•…æ€§ï¼Œä½¿ç”¨äº†ä¸€ç§itemå¤ç”¨æœºåˆ¶ï¼Œå³ï¼šåœ¨å±å¹•ä¸­æ˜¾ç¤ºçš„æ¯ä¸ªListViewçš„itemå¯¹åº”çš„å¸ƒå±€åªæœ‰åœ¨ç¬¬ä¸€æ¬¡çš„æ—¶å€™è¢«åŠ è½½ï¼Œç„¶åç¼“å­˜åœ¨convertViewé‡Œé¢ï¼Œä¹‹åæ»‘åŠ¨æ”¹å˜ListViewæ—¶è°ƒç”¨çš„getViewå°±ä¼šå¤ç”¨ç¼“å­˜åœ¨converViewä¸­çš„å¸ƒå±€å’Œæ§ä»¶ï¼Œæ‰€ä»¥å¯ä»¥ä½¿å¾—ListViewå˜å¾—æµç•…ï¼ˆå› ä¸ºä¸ç”¨é‡å¤åŠ è½½å¸ƒå±€ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;â‘¡æ¯ä¸ªItemä¸­çš„ImageViewåŠ è½½å›¾ç‰‡æ—¶å¾€å¾€éƒ½æ˜¯å¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚åœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œå›¾ç‰‡èµ„æºçš„ç½‘ç»œè¯·æ±‚å†åŠ è½½ä¸ºä¸€ä¸ªBitmapå¯¹è±¡æœ€åå›åˆ°UIçº¿ç¨‹è®¾ç½®è¯¥itemçš„ImageViewçš„æ˜¾ç¤ºå†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;â‘¢ å¬ä¸Šå»â‘ æ˜¯ä¸€ç§éå¸¸åˆç†æœ‰æ•ˆçš„æé«˜åˆ—è¡¨å±•ç¤ºæµç•…æ€§çš„æœºåˆ¶ï¼Œâ‘¡çœ‹èµ·æ¥ä¹Ÿæ˜¯å›¾ç‰‡åŠ è½½æ—¶å¾ˆå¸¸è§çš„ä¸€ä¸ªå¼‚æ­¥æ“ä½œå•Šã€‚å…¶å®â‘ å’Œâ‘¡æœ¬èº«éƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯â‘ +â‘¡+ç”¨æˆ·æ»‘åŠ¨åˆ—è¡¨=å›¾ç‰‡æ˜¾ç¤ºé”™ä¹±ï¼å…·ä½“è€Œè¨€ï¼šå½“æˆ‘ä»¬åœ¨å…¶ä¸­ä¸€ä¸ªitemAåŠ è½½å›¾ç‰‡Açš„æ—¶å€™ï¼Œç”±äºåŠ è½½è¿‡ç¨‹æ˜¯å¼‚æ­¥æ“ä½œéœ€è¦è€—è´¹ä¸€å®šçš„æ—¶é—´ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½å›¾ç‰‡Aæœªè¢«åŠ è½½å®Œè¯¥itemAå°±â€œæ»šå‡ºå»äº†â€ï¼Œè¿™ä¸ªitemAå¯èƒ½è¢«å½“åšç¼“å­˜åº”ç”¨åˆ°å¦ä¸€ä¸ªåˆ—è¡¨é¡¹itemBä¸­ï¼Œè¿™ä¸ªæ—¶å€™åˆšå¥½å›¾ç‰‡AåŠ è½½å®Œæˆæ˜¾ç¤ºåœ¨itemBä¸­ï¼ˆå› ä¸ºImageViewå¯¹è±¡åœ¨ç¼“å­˜ä¸­è¢«å¤ç”¨äº†ï¼‰ï¼ŒåŸæœ¬itemBè¯¥æ˜¾ç¤ºå›¾ç‰‡Bï¼Œç°åœ¨æ˜¾ç¤ºå›¾ç‰‡Aã€‚è¿™åªæ˜¯æœ€ç®€å•çš„ä¸€ç§æƒ…å†µï¼Œå½“æ»‘åŠ¨é¢‘ç¹æ—¶è¿™ç§å›¾ç‰‡æ˜¾ç¤ºé”™ä¹±é—®é¢˜ä¼šæ„ˆåŠ ä¸¥é‡ï¼Œç”šè‡³è®©äººæ¯«æ— å¤´ç»ªã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ç§å›¾ç‰‡æ˜¾ç¤ºé”™ä¹±é—®é¢˜å‘¢ï¼Ÿè§£å†³æ€è·¯å…¶å®éå¸¸ç®€å•ï¼šåœ¨å›¾ç‰‡Aè¢«åŠ è½½åˆ°ImageViewä¹‹å‰åšä¸€ä¸ªåˆ¤æ–­ï¼Œåˆ¤æ–­è¯¥ImageViewå¯¹è±¡æ˜¯å¦è¿˜æ˜¯å¯¹åº”çš„æ˜¯itemAï¼Œå¦‚æœæ˜¯åˆ™å°†å›¾ç‰‡åŠ è½½åˆ°ImageViewå½“ä¸­ï¼›å¦‚æœä¸æ˜¯åˆ™æ”¾å¼ƒåŠ è½½ï¼ˆå› ä¸ºitemBå·²ç»å¯åŠ¨äº†å›¾ç‰‡Bçš„åŠ è½½ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒæ§ä»¶å‡ºç°ç©ºç™½çš„æƒ…å†µï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆæ–°çš„é—®é¢˜å‡ºç°äº†ï¼Œå¦‚ä½•åˆ¤æ–­ImageViewå¯¹è±¡å¯¹åº”çš„itemå·²ç»æ”¹å˜äº†ï¼Ÿæˆ‘ä»¬å¯ä»¥é‡‡å–ä¸‹é¢çš„æ–¹å¼ï¼š&lt;/p&gt;
&lt;p&gt;â‘ åœ¨æ¯æ¬¡getViewçš„å¤ç”¨å¸ƒå±€æ§ä»¶æ—¶ï¼Œå¯¹ä¼šè¢«å¤ç”¨çš„æ§ä»¶è®¾ç½®ä¸€ä¸ªæ ‡ç­¾ï¼ˆåœ¨è¿™é‡Œå°±æ˜¯å¯¹ImageViewè®¾ç½®æ ‡ç­¾ï¼‰ã€‚æ ‡ç­¾å†…å®¹å¿…é¡»å¯ä»¥æ ‡è¯†ä¸åŒçš„itemï¼è¿™é‡Œä½¿ç”¨å›¾ç‰‡çš„urlä½œä¸ºæ ‡ç­¾å†…å®¹ï¼Œç„¶åå†å¼‚æ­¥åŠ è½½å›¾ç‰‡ã€‚&lt;/p&gt;
&lt;p&gt;â‘¡åœ¨å›¾ç‰‡ä¸‹è½½å®Œæˆåè¦åŠ è½½åˆ°ImageViewä¹‹å‰åšåˆ¤æ–­ï¼Œåˆ¤æ–­è¯¥ImageViewçš„æ ‡ç­¾å†…å®¹æ˜¯å¦å’Œå›¾ç‰‡çš„urlä¸€æ ·ï¼šå¦‚æœä¸€æ ·è¯´æ˜ImageViewæ²¡æœ‰è¢«å¤ç”¨ï¼Œå¯ä»¥å°†å›¾ç‰‡åŠ è½½åˆ°ImageViewå½“ä¸­ï¼›å¦‚æœä¸ä¸€æ ·ï¼Œè¯´æ˜ListViewå‘ç”Ÿäº†æ»‘åŠ¨ï¼Œå¯¼è‡´å…¶ä»–itemè°ƒç”¨äº†getViewä»è€Œå°†è¯¥ImageViewçš„æ ‡ç­¾æ”¹å˜ï¼Œæ­¤æ—¶æ”¾å¼ƒå›¾ç‰‡çš„åŠ è½½ï¼ˆå°½ç®¡å›¾ç‰‡å·²ç»è¢«ä¸‹è½½æˆåŠŸäº†ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ç»“ï¼šè§£å†³ListViewå¼‚æ­¥åŠ è½½Bitmapæ—¶çš„å›¾ç‰‡é”™ä¹±é—®é¢˜çš„æ–¹å¼æ˜¯ï¼šä¸ºè¢«å¤ç”¨çš„æ§ä»¶å¯¹è±¡ï¼ˆå³ImageViewå¯¹è±¡ï¼‰è®¾ç½®æ ‡ç­¾æ¥æ ‡è¯†itemï¼Œå¼‚æ­¥ä»»åŠ¡ç»“æŸåè¦å°†å›¾ç‰‡åŠ è½½åˆ°ImageViewæ—¶å–å‡ºæ ‡ç­¾å€¼è¿›è¡Œæ¯”å¯¹æ˜¯å¦ä¸€è‡´ï¼šå¦‚æœä¸€è‡´æ„å‘³ç€æ²¡æœ‰å‘ç”Ÿæ»‘åŠ¨ï¼Œæ­£å¸¸åŠ è½½å›¾ç‰‡ï¼›å¦‚æœä¸ä¸€æ ·æ„å‘³ç€å‘ç”Ÿäº†æ»‘åŠ¨ï¼Œå–æ¶ˆåŠ è½½ã€‚&lt;/p&gt;

&lt;p&gt;4ã€Androidä¸­çš„Bitmapç¼“å­˜ç­–ç•¥&lt;/p&gt;
&lt;p&gt;å¦‚æœåªæ˜¯åŠ è½½è‹¥å¹²å¼ å›¾ç‰‡ï¼Œä¸Šè¿°çš„Bitmapä½¿ç”¨æ–¹å¼å·²ç»ç»å¯¹å¤Ÿç”¨äº†ï¼›ä½†æ˜¯å¦‚æœåœ¨åº”ç”¨ä¸­éœ€è¦é¢‘ç¹åœ°åŠ è½½å¤§é‡çš„å›¾ç‰‡ï¼Œç‰¹åˆ«æ˜¯æœ‰äº›å›¾ç‰‡ä¼šè¢«é‡å¤åŠ è½½æ—¶ï¼Œè¿™ä¸ªæ—¶å€™åˆ©ç”¨ç¼“å­˜ç­–ç•¥å¯ä»¥å¾ˆå¥½åœ°æé«˜å›¾ç‰‡çš„åŠ è½½é€Ÿåº¦ã€‚æ¯”å¦‚è¯´æœ‰å‡ å¼ å›¾ç‰‡è¢«é‡å¤åŠ è½½çš„é¢‘ç‡å¾ˆé«˜ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ç¼“å­˜ä¸­ä¿ç•™è¿™å‡ å¼ å›¾ç‰‡çš„Bitmapå¯¹è±¡ï¼›åç»­å¦‚æœéœ€è¦åŠ è½½è¿™äº›å›¾ç‰‡ï¼Œåˆ™ä¸éœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´å»é‡æ–°åœ¨ç½‘ç»œä¸Šè·å–å¹¶åŠ è½½è¿™äº›å›¾ç‰‡çš„Bitmapå¯¹è±¡ï¼Œåªéœ€è¦ç›´æ¥å‘ç¼“å­˜ä¸­è·å–ä¹‹å‰ä¿ç•™ä¸‹æ¥çš„Bitmapå¯¹è±¡å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;Androidä¸­å¯¹Bitmapçš„ç¼“å­˜ç­–ç•¥åˆ†ä¸ºä¸¤ç§ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;å†…å­˜ç¼“å­˜ï¼šå›¾åƒå­˜å‚¨åœ¨è®¾å¤‡å†…å­˜ä¸­ï¼Œå› æ­¤è®¿é—®é€Ÿåº¦éå¸¸å¿«ã€‚äº‹å®ä¸Šï¼Œæ¯”å›¾åƒè§£ç è¿‡ç¨‹è¦å¿«å¾—å¤šï¼Œæ‰€ä»¥å°†å›¾åƒå­˜å‚¨åœ¨è¿™é‡Œæ˜¯è®©appæ›´å¿«æ›´ç¨³å®šçš„ä¸€ä¸ªå¥½ä¸»æ„ã€‚å†…å­˜ç¼“å­˜çš„å”¯ä¸€ç¼ºç‚¹æ˜¯ï¼šå®ƒåªå­˜æ´»äºappçš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿™æ„å‘³ç€ä¸€æ—¦appè¢«Androidæ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†å™¨å…³é—­æˆ–æ€æ­»ï¼ˆå…¨éƒ¨æˆ–éƒ¨åˆ†ï¼‰ï¼Œé‚£ä¹ˆå‚¨å­˜åœ¨é‚£é‡Œçš„æ‰€æœ‰å›¾åƒéƒ½å°†ä¸¢å¤±ã€‚ç”±äºå†…å­˜ç¼“å­˜æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§å†…å­˜èµ„æºï¼Œæ‰€ä»¥åˆ‡è®°ï¼šå†…å­˜ç¼“å­˜å¿…é¡»è®¾ç½®ä¸€ä¸ªæœ€å¤§å¯ç”¨çš„å†…å­˜é‡ã€‚å¦åˆ™å¯èƒ½ä¼šå¯¼è‡´è‡­åæ˜­è‘—çš„outOfMemoryErrorã€‚&lt;/li&gt;
&lt;li&gt;ç£ç›˜ç¼“å­˜ï¼šå›¾åƒå­˜å‚¨åœ¨è®¾å¤‡çš„ç‰©ç†å­˜å‚¨å™¨ä¸Šï¼ˆç£ç›˜ï¼‰ã€‚ç£ç›˜ç¼“å­˜æœ¬è´¨ä¸Šå°±æ˜¯è®¾å¤‡SDå¡ä¸Šçš„æŸä¸ªç›®å½•ã€‚åªè¦appä¸è¢«å¸è½½ï¼Œå…¶ç£ç›˜ç¼“å­˜å¯ä»¥ä¸€ç›´å®‰å…¨åœ°å­˜å‚¨å›¾ç‰‡ï¼Œåªè¦æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´å³å¯ã€‚ç¼ºç‚¹æ˜¯ï¼Œç£ç›˜è¯»å–å’Œå†™å…¥æ“ä½œå¯èƒ½ä¼šå¾ˆæ…¢ï¼Œè€Œä¸”æ€»æ˜¯æ¯”è®¿é—®å†…å­˜ç¼“å­˜æ…¢ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œå› æ­¤æ‰€æœ‰çš„ç£ç›˜æ“ä½œå¿…é¡»åœ¨å·¥ä½œçº¿ç¨‹æ‰§è¡Œï¼ŒUIçº¿ç¨‹ä¹‹å¤–ã€‚å¦åˆ™ï¼Œappä¼šå†»ç»“ï¼Œå¹¶å¯¼è‡´ANRè­¦æŠ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦å¼ºè¡ŒäºŒé€‰ä¸€ï¼Œå¯ä»¥äºŒè€…éƒ½ä½¿ç”¨ï¼Œæ¯•ç«Ÿå„æœ‰ä¼˜åŠ¿ã€‚æ‰€ä»¥Androidä¸­å®Œæ•´çš„å›¾ç‰‡ç¼“å­˜ç­–ç•¥ä¸ºï¼šå…ˆå°è¯•åœ¨å†…å­˜ç¼“å­˜ä¸­æŸ¥æ‰¾Bitmapå¯¹è±¡ï¼Œå¦‚æœæœ‰ç›´æ¥åŠ è½½ä½¿ç”¨ï¼›å¦‚æœæ²¡æœ‰ï¼Œå†å°è¯•åœ¨ç£ç›˜ç¼“å­˜ä¸­æŸ¥æ‰¾å›¾ç‰‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæœ‰å°†å…¶åŠ è½½è‡³å†…å­˜ä½¿ç”¨ï¼›å¦‚æœè¿˜æ˜¯æ²¡æœ‰ï¼Œåˆ™è€è€å®å®å‘é€ç½‘ç»œè¯·æ±‚è·å–å›¾ç‰‡èµ„æºå¹¶åŠ è½½ä½¿ç”¨ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåé¢ä¸¤ç§æƒ…å†µä¸‹çš„æ“ä½œéƒ½å¿…é¡»ä½¿ç”¨å¼‚æ­¥æœºåˆ¶ä»¥é¿å…ANRçš„å‘ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;Androidä¸­é€šè¿‡LruCacheå®ç°å†…å­˜ç¼“å­˜ï¼Œé€šè¿‡DiskLruCacheå®ç°ç£ç›˜ç¼“å­˜ï¼Œå®ƒä»¬é‡‡ç”¨çš„éƒ½æ˜¯LRU(Least Recently Used)æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•æ¥ç§»é™¤ç¼“å­˜ä¸­çš„æœ€è¿‘ä¸å¸¸è®¿é—®çš„å†…å®¹ï¼ˆå˜ç›¸åœ°ä¿ç•™äº†æœ€è¿‘ç»å¸¸è®¿é—®çš„å†…å®¹ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;â‘ å†…å­˜ç¼“å­˜LruCache&lt;/p&gt;
&lt;p&gt;LruCacheåŸç†ï¼šLruCacheåº•å±‚æ˜¯ä½¿ç”¨LinkedHashMapæ¥å®ç°çš„ï¼Œæ‰€ä»¥LruCacheä¹Ÿæ˜¯ä¸€ä¸ªæ³›å‹ç±»ã€‚åœ¨å›¾ç‰‡ç¼“å­˜ä¸­ï¼Œå…¶é”®ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œå€¼ç±»å‹ä¸ºBitmapã€‚åˆ©ç”¨LinkedHashMapçš„accessOrderå±æ€§å¯ä»¥å®ç°LRUç®—æ³•ã€‚accessOrderå±æ€§å†³å®šäº†LinkedHashMapçš„é“¾è¡¨é¡ºåºï¼šaccessOrderä¸ºtrueåˆ™ä»¥è®¿é—®é¡ºåºç»´æŠ¤é“¾è¡¨ï¼Œå³è¢«è®¿é—®è¿‡çš„å…ƒç´ ä¼šå®‰æ’åˆ°é“¾è¡¨çš„å°¾éƒ¨ï¼›accessorderä¸ºfalseåˆ™ä»¥æ’å…¥çš„é¡ºåºç»´æŠ¤é“¾è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;è€ŒLruCacheåˆ©ç”¨çš„æ­£æ˜¯accessOrderä¸ºtrueçš„LinkedHashMapæ¥å®ç°LRUç®—æ³•çš„ã€‚å…·ä½“è¡¨ç°ä¸ºï¼š&lt;/p&gt;
&lt;div readability=&quot;22&quot;&gt;
&lt;p&gt;1Â° putï¼šé€šè¿‡LinkedHashMapçš„putæ–¹æ³•æ¥å®ç°å…ƒç´ çš„æ’å…¥ï¼Œæ’å…¥çš„è¿‡ç¨‹è¿˜æ˜¯è¦å…ˆå¯»æ‰¾æœ‰æ²¡æœ‰ç›¸åŒçš„keyçš„æ•°æ®ï¼Œå¦‚æœæœ‰åˆ™æ›¿æ¢æ‰æ—§å€¼ï¼Œå¹¶ä¸”å°†è¯¥èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨çš„å°¾éƒ¨ã€‚è¿™å¯ä»¥ä¿è¯æœ€è¿‘ç»å¸¸è®¿é—®çš„å†…å®¹é›†ä¸­ä¿å­˜åœ¨é“¾è¡¨å°¾éƒ¨ï¼Œæœ€è¿‘ä¸å¸¸è®¿é—®çš„å†…å­˜é›†ä¸­ä¿å­˜åœ¨é“¾è¡¨å¤´éƒ¨ä½ç½®ã€‚åœ¨æ’å…¥åå¦‚æœç¼“å­˜å¤§å°è¶…è¿‡äº†è®¾å®šçš„æœ€å¤§ç¼“å­˜å¤§å°ï¼ˆé˜ˆå€¼ï¼‰ï¼Œåˆ™å°†LinkedHashMapå¤´éƒ¨çš„èŠ‚ç‚¹ï¼ˆæœ€è¿‘ä¸å¸¸è®¿é—®çš„å†…å®¹ï¼‰åˆ é™¤ï¼Œç›´åˆ°sizeå°äºmaxSizeã€‚&lt;/p&gt;
&lt;p&gt;2Â° getï¼šé€šè¿‡LinkedHashMapçš„getæ–¹æ³•æ¥å®ç°å…ƒç´ çš„è®¿é—®ï¼Œç”±äºaccessOrderä¸ºtrueï¼Œå› æ­¤è¢«è®¿é—®åˆ°çš„å…ƒç´ ä¼šè¢«è°ƒæ•´åˆ°é“¾è¡¨çš„å°¾éƒ¨ï¼Œå› æ­¤ä¸å¸¸è¢«è®¿é—®çš„å…ƒç´ å°±ä¼šç•™åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼Œå½“è§¦å‘æ¸…ç†ç¼“å­˜æ—¶ä¸å¸¸è¢«è®¿é—®çš„å…ƒç´ å°±ä¼šè¢«åˆ é™¤ï¼Œè¿™é‡Œæ˜¯å®ç°LRUæœ€å…³é”®çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;3Â° removeï¼šé€šè¿‡LinkedHashMapçš„removeæ–¹æ³•æ¥å®ç°å…ƒç´ çš„ç§»é™¤ã€‚&lt;/p&gt;
&lt;p&gt;3Â° sizeï¼šLruCacheä¸­å¾ˆé‡è¦çš„ä¸¤ä¸ªæˆå‘˜å˜é‡sizeå’ŒmaxSizeï¼Œå› ä¸ºæ¸…ç†ç¼“å­˜çš„æ˜¯åœ¨size&amp;gt;maxSizeæ—¶è§¦å‘çš„ï¼Œå› æ­¤åœ¨åˆå§‹åŒ–çš„æ—¶å€™è¦ä¼ å…¥maxSizeå®šä¹‰ç¼“å­˜çš„å¤§å°ï¼Œç„¶åé‡å†™sizeOfæ–¹æ³•ï¼Œå› ä¸ºLruCacheæ˜¯é€šè¿‡sizeOfæ–¹æ³•æ¥è®¡ç®—æ¯ä¸ªå…ƒç´ çš„å¤§å°ã€‚è¿™é‡Œæˆ‘ä»¬æ˜¯ä½¿ç”¨LruCacheæ¥ç¼“å­˜å›¾ç‰‡ï¼Œæ‰€ä»¥sizeOfæ–¹æ³•éœ€è¦è®¡ç®—Bitmapçš„å¤§å°å¹¶è¿”å›ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;LruCacheå¯¹å…¶ç¼“å­˜å¯¹è±¡é‡‡ç”¨çš„æ˜¯å¼ºå¼•ç”¨å…³ç³»ï¼Œé‡‡ç”¨maxSizeæ¥æ§åˆ¶ç¼“å­˜ç©ºé—´å¤§å°ä»¥é¿å…OOMé”™è¯¯ã€‚è€Œä¸”LruCacheç±»åœ¨Android SDKä¸­å·²ç»æä¾›äº†ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­æˆ‘ä»¬åªéœ€è¦å®Œæˆä»¥ä¸‹å‡ æ­¥å³å¯ï¼š&lt;/p&gt;
&lt;div readability=&quot;79.600840336134&quot;&gt;
&lt;ul&gt;&lt;li&gt;è®¾è®¡LruCacheçš„æœ€å¤§ç¼“å­˜å¤§å°ï¼šä¸€èˆ¬æ˜¯é€šè¿‡è®¡ç®—å½“å‰å¯ç”¨çš„å†…å­˜å¤§å°ç»§è€Œæ¥è·å–åˆ°åº”è¯¥è®¾ç½®çš„ç¼“å­˜å¤§å°&lt;/li&gt;
&lt;li&gt;åˆ›å»ºLruCacheå¯¹è±¡ï¼šä¼ å…¥æœ€å¤§ç¼“å­˜å¤§å°çš„å‚æ•°ï¼ŒåŒæ—¶é‡å†™sizeOfæ–¹æ³•æ¥è®¾ç½®å­˜åœ¨LruCacheé‡Œçš„æ¯ä¸ªå¯¹è±¡çš„å¤§å°&lt;/li&gt;
&lt;li&gt;å°è£…å¯¹LruCacheçš„æ•°æ®è®¿é—®å’Œæ·»åŠ æ“ä½œå¹¶å¯¹å¤–æä¾›æ¥å£ä»¥ä¾›è°ƒç”¨&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;å…·ä½“ä»£ç å‚è€ƒå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt;//&lt;/span&gt;&lt;span&gt;åˆå§‹åŒ–LruCacheå¯¹è±¡&lt;/span&gt;
&lt;span&gt;public&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; initLruCache()
{
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è·å–å½“å‰è¿›ç¨‹çš„å¯ç”¨å†…å­˜ï¼Œè½¬æ¢æˆKBå•ä½&lt;/span&gt;
    &lt;span&gt;int&lt;/span&gt; maxMemory = (&lt;span&gt;int&lt;/span&gt;) (Runtime.getRuntime().maxMemory() / 1024&lt;span&gt;);
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;åˆ†é…ç¼“å­˜çš„å¤§å°&lt;/span&gt;
    &lt;span&gt;int&lt;/span&gt; maxSize = maxMemory / 8&lt;span&gt;;
    &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;åˆ›å»ºLruCacheå¯¹è±¡å¹¶é‡å†™sizeOfæ–¹æ³•&lt;/span&gt;
    lruCache = &lt;span&gt;new&lt;/span&gt; LruCache&amp;lt;String, Bitmap&amp;gt;&lt;span&gt;(maxSize)
        {
            @Override
            &lt;/span&gt;&lt;span&gt;protected&lt;/span&gt; &lt;span&gt;int&lt;/span&gt;&lt;span&gt; sizeOf(String key, Bitmap value) {
                &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt; TODO Auto-generated method stub&lt;/span&gt;
                &lt;span&gt;return&lt;/span&gt; value.getWidth() * value.getHeight() / 1024&lt;span&gt;;
            }
        };
}

&lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
 * å°è£…å°†å›¾ç‰‡å­˜å…¥ç¼“å­˜çš„æ–¹æ³•
 * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; key å›¾ç‰‡çš„urlè½¬åŒ–æˆçš„key
 * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; bitmapå¯¹è±¡
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;private&lt;/span&gt; &lt;span&gt;void&lt;/span&gt;&lt;span&gt; addBitmapToMemoryCache(String key, Bitmap bitmap)
{
    &lt;/span&gt;&lt;span&gt;if&lt;/span&gt;(getBitmapFromMemoryCache(key) == &lt;span&gt;null&lt;/span&gt;&lt;span&gt;)
    {
        mLruCache.put(key, bitmap);
    }
}

&lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°è£…ä»LruCacheä¸­è®¿é—®æ•°æ®çš„æ–¹æ³•&lt;/span&gt;
&lt;span&gt;private&lt;/span&gt;&lt;span&gt; Bitmap getBitmapFromMemoryCache(String key)
{
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; mLruCache.get(key);
}

&lt;/span&gt;&lt;span&gt;/**&lt;/span&gt;&lt;span&gt;
 * å› ä¸ºå¤–ç•Œä¸€èˆ¬è·å–åˆ°çš„æ˜¯urlè€Œä¸æ˜¯keyï¼Œå› æ­¤ä¸ºäº†æ–¹ä¾¿å†åšä¸€å±‚å°è£…
 * &lt;/span&gt;&lt;span&gt;@param&lt;/span&gt;&lt;span&gt; url http url
 * &lt;/span&gt;&lt;span&gt;@return&lt;/span&gt;&lt;span&gt; bitmap
 &lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;
&lt;span&gt;private&lt;/span&gt;&lt;span&gt; Bitmap loadBitmapFromMemoryCache(String url)
{
    &lt;/span&gt;&lt;span&gt;final&lt;/span&gt; String key =&lt;span&gt; hashKeyFromUrl(url);
    &lt;/span&gt;&lt;span&gt;return&lt;/span&gt;&lt;span&gt; getBitmapFromMemoryCache(key);
}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;â‘¡ç£ç›˜ç¼“å­˜DiskLruCache&lt;/p&gt;
&lt;p&gt;ç”±äºDiskLruCacheå¹¶ä¸å±äºAndroid SDKçš„ä¸€éƒ¨åˆ†ï¼Œéœ€è¦è‡ªè¡Œè®¾è®¡ã€‚ä¸LruCacheå®ç°LRUç®—æ³•çš„æ€è·¯åŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šä¸ä¸€æ ·çš„åœ°æ–¹ï¼šLruCacheæ˜¯å†…å­˜ç¼“å­˜ï¼Œå…¶é”®å¯¹åº”çš„å€¼ç±»å‹ç›´æ¥ä¸ºBitmapï¼›è€ŒDiskLruCacheæ˜¯ç£ç›˜ç¼“å­˜ï¼Œæ‰€ä»¥å…¶é”®å¯¹åº”çš„å€¼ç±»å‹åº”è¯¥æ˜¯ä¸€ä¸ªä»£è¡¨å›¾ç‰‡æ–‡ä»¶çš„ç±»ã€‚å…¶æ¬¡ï¼Œå‰è€…è®¿é—®æˆ–æ·»åŠ å…ƒç´ æ—¶ï¼ŒæŸ¥æ‰¾æˆåŠŸå¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥Bitmapå¯¹è±¡ï¼›åè€…è®¿é—®æˆ–æ·»åŠ å…ƒç´ æ—¶ï¼ŒæŸ¥æ‰¾åˆ°æŒ‡å®šå›¾ç‰‡æ–‡ä»¶åè¿˜éœ€è¦é€šè¿‡æ–‡ä»¶çš„è¯»å–å’ŒBitmapçš„åŠ è½½è¿‡ç¨‹æ‰èƒ½ä½¿ç”¨ã€‚å¦å¤–ï¼Œå‰è€…æ˜¯åœ¨å†…å­˜ä¸­çš„æ•°æ®è¯»å†™æ“ä½œæ‰€ä»¥ä¸éœ€è¦å¼‚æ­¥ï¼›åè€…æ¶‰åŠåˆ°æ–‡ä»¶æ“ä½œå¿…é¡»å¼€å¯å­çº¿ç¨‹å®ç°å¼‚æ­¥å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“DiskLruCacheçš„è®¾è®¡æ–¹æ¡ˆå’Œä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢ï¼š&lt;a href=&quot;https://www.jianshu.com/p/765640fe474a&quot; target=&quot;_blank&quot;&gt;https://www.jianshu.com/p/765640fe474a&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ‰äº†LruCacheç±»å’ŒDiskLruCacheç±»ï¼Œå¯ä»¥å®ç°å®Œæ•´çš„Androidå›¾ç‰‡äºŒçº§ç¼“å­˜ç­–ç•¥ï¼šåœ¨å…·ä½“çš„å›¾ç‰‡åŠ è½½æ—¶ï¼šå…ˆå°è¯•åœ¨LruCacheä¸­æŸ¥æ‰¾Bitmapå¯¹è±¡ï¼Œå¦‚æœæœ‰ç›´æ¥æ‹¿æ¥ä½¿ç”¨ã€‚å¦‚æœæ²¡æœ‰å†å°è¯•åœ¨DiskLruCacheä¸­æŸ¥æ‰¾å›¾ç‰‡æ–‡ä»¶ï¼Œå¦‚æœæœ‰å°†å…¶åŠ è½½ä¸ºBitmapå¯¹è±¡å†ä½¿ç”¨ï¼Œå¹¶å°†å…¶æ·»åŠ è‡³LruCacheä¸­ï¼›å¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°æŒ‡å®šçš„å›¾ç‰‡æ–‡ä»¶ï¼Œåˆ™å‘é€ç½‘ç»œè¯·æ±‚è·å–å›¾ç‰‡èµ„æºå¹¶åŠ è½½ä¸ºBitmapå¯¹è±¡å†ä½¿ç”¨ï¼Œå¹¶å°†å…¶æ·»åŠ DiskLruCacheä¸­ã€‚&lt;/p&gt;

&lt;p&gt;5ã€Bitmapå†…å­˜ç®¡ç†&lt;/p&gt;
&lt;p&gt;&lt;span&gt;Androidè®¾å¤‡çš„å†…å­˜åŒ…æ‹¬æœ¬æœºNativeå†…å­˜å’ŒDalvikï¼ˆç±»ä¼¼äºJVMè™šæ‹Ÿæœºï¼‰å †å†…å­˜ä¸¤éƒ¨åˆ†ã€‚åœ¨Android 2.3.3ï¼ˆAPIçº§åˆ«10ï¼‰åŠæ›´ä½ç‰ˆæœ¬ä¸­ï¼Œä½å›¾çš„æ”¯æŒåƒç´ æ•°æ®å­˜å‚¨åœ¨Nativeå†…å­˜ä¸­ã€‚&lt;/span&gt;&lt;span&gt;å®ƒä¸ä½å›¾æœ¬èº«æ˜¯åˆ†å¼€çš„ï¼ŒBitmapå¯¹è±¡æœ¬èº«å­˜å‚¨åœ¨Dalvikå †ä¸­ã€‚&lt;/span&gt;&lt;span&gt;Nativeå†…å­˜ä¸­çš„åƒç´ æ•°æ®ä¸ä¼šä»¥å¯é¢„æµ‹çš„æ–¹å¼é‡Šæ”¾ï¼Œå¯èƒ½å¯¼è‡´åº”ç”¨ç¨‹åºçŸ­æš‚è¶…å‡ºå…¶å†…å­˜é™åˆ¶å¹¶å´©æºƒã€‚&lt;/span&gt;&lt;span&gt;ä»Android 3.0ï¼ˆAPIçº§åˆ«11ï¼‰åˆ°Android 7.1ï¼ˆAPIçº§åˆ«25ï¼‰ï¼Œåƒç´ æ•°æ®ä¸ç›¸å…³Bitmapå¯¹è±¡ä¸€èµ·å­˜å‚¨åœ¨Dalvikå †ä¸Šï¼Œä¸€èµ·äº¤ç”±Dalvikè™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†å™¨æ¥è¿›è¡Œå›æ”¶ï¼Œå› æ­¤æ¯”è¾ƒå®‰å…¨ã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;â‘ åœ¨Android2.3.3ç‰ˆæœ¬ä¹‹å‰ï¼š&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;åœ¨Bitmapå¯¹è±¡ä¸å†ä½¿ç”¨å¹¶å¸Œæœ›å°†å…¶é”€æ¯æ—¶ï¼ŒBitmapå¯¹è±¡è‡ªèº«ç”±äºä¿å­˜åœ¨Dalvikå †ä¸­ï¼Œæ‰€ä»¥å…¶è‡ªèº«ä¼šç”±GCè‡ªåŠ¨å›æ”¶ï¼›ä½†æ˜¯ç”±äºBitmapçš„åƒç´ æ•°æ®ä¿å­˜åœ¨nativeå†…å­˜ä¸­ï¼Œæ‰€ä»¥å¿…é¡»ç”±å¼€å‘è€…æ‰‹åŠ¨è°ƒç”¨Bitmapçš„recycle()æ–¹æ³•æ¥å›æ”¶è¿™äº›åƒç´ æ•°æ®å ç”¨çš„å†…å­˜ç©ºé—´ã€‚&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;â‘¡åœ¨Android2.3.3ç‰ˆæœ¬ä¹‹åï¼š&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;ç”±äºBitmapå¯¹è±¡å’Œå…¶åƒç´ æ•°æ®ä¸€èµ·ä¿å­˜åœ¨Dalvikå †ä¸Šï¼Œæ‰€ä»¥åœ¨å…¶éœ€è¦å›æ”¶æ—¶åªè¦å°†Bitmapå¼•ç”¨ç½®ä¸ºnull å°±è¡Œäº†ï¼Œä¸éœ€è¦å¦‚æ­¤éº»çƒ¦çš„æ‰‹åŠ¨é‡Šæ”¾å†…å­˜æ“ä½œã€‚&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span&gt;å½“ç„¶ï¼Œä¸€èˆ¬æˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­å¾€å¾€å‘ä¸‹å…¼å®¹åˆ°Android4.0ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä½ æ‡‚å¾—ã€‚&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span&gt;â‘¢åœ¨Android&lt;/span&gt;3.0ä»¥åçš„ç‰ˆæœ¬ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªå¾ˆå¥½ç”¨çš„å‚æ•°ï¼Œå«options.inBitmapã€‚å¦‚æœä½ ä½¿ç”¨äº†è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨decodeXXXXæ–¹æ³•æ—¶ä¼šç›´æ¥å¤ç”¨ inBitmap æ‰€å¼•ç”¨çš„é‚£å—å†…å­˜ã€‚å¤§å®¶éƒ½çŸ¥é“ï¼Œå¾ˆå¤šæ—¶å€™uiå¡é¡¿æ˜¯å› ä¸ºgc æ“ä½œè¿‡å¤šè€Œé€ æˆçš„ã€‚ä½¿ç”¨è¿™ä¸ªå±æ€§èƒ½é¿å…é¢‘ç¹çš„å†…å­˜çš„ç”³è¯·å’Œé‡Šæ”¾ã€‚å¸¦æ¥çš„å¥½å¤„å°±æ˜¯gcæ“ä½œçš„æ•°é‡å‡å°‘ï¼Œè¿™æ ·cpuä¼šæœ‰æ›´å¤šçš„æ—¶é—´æ‰§è¡Œuiçº¿ç¨‹ï¼Œç•Œé¢ä¼šæµç•…å¾ˆå¤šï¼ŒåŒæ—¶è¿˜èƒ½èŠ‚çœå¤§é‡å†…å­˜ã€‚ç®€å•åœ°è¯´ï¼Œå°±æ˜¯å†…å­˜ç©ºé—´è¢«å„ä¸ªBitmapå¯¹è±¡å¤ç”¨ä»¥é¿å…é¢‘ç¹çš„å†…å­˜ç”³è¯·å’Œé‡Šæ”¾æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¦ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œå¿…é¡»å°†BitmapFactory.Optionsçš„isMutableå±æ€§å€¼è®¾ç½®ä¸ºtrueï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨è¿™ä¸ªå±æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“ä½¿ç”¨æ–¹å¼å‚è€ƒå¦‚ä¸‹ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;39&quot;&gt;
&lt;pre&gt;
&lt;span&gt;final&lt;/span&gt; BitmapFactory.Options options = &lt;span&gt;new&lt;/span&gt;&lt;span&gt; BitmapFactory.Options();
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;sizeå¿…é¡»ä¸º1 å¦åˆ™æ˜¯ä½¿ç”¨inBitmapå±æ€§ä¼šæŠ¥å¼‚å¸¸&lt;/span&gt;
        options.inSampleSize = 1&lt;span&gt;;
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;è¿™ä¸ªå±æ€§ä¸€å®šè¦åœ¨ç”¨åœ¨src Bitmap decodeçš„æ—¶å€™ ä¸ç„¶ä½ å†ä½¿ç”¨å“ªä¸ªinBitmapå±æ€§å»decodeæ—¶å€™ä¼šåœ¨c++å±‚é¢æŠ¥å¼‚å¸¸
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;BitmapFactory: Unable to reuse an immutable bitmap as an image decoder target.&lt;/span&gt;
        options.inMutable = &lt;span&gt;true&lt;/span&gt;&lt;span&gt;;
        inBitmap2 &lt;/span&gt;=&lt;span&gt; BitmapFactory.decodeFile(path1,options);
        iv.setImageBitmap(inBitmap2);
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;å°†inBitmapå±æ€§ä»£è¡¨çš„å¼•ç”¨æŒ‡å‘inBitmap2å¯¹è±¡æ‰€åœ¨çš„å†…å­˜ç©ºé—´ï¼Œå³å¯å¤ç”¨è¿™å—å†…å­˜åŒºåŸŸ&lt;/span&gt;
        options.inBitmap =&lt;span&gt; inBitmap2;
        &lt;/span&gt;&lt;span&gt;//&lt;/span&gt;&lt;span&gt;ç”±äºå¯ç”¨äº†inBitmapå±æ€§ï¼Œæ‰€ä»¥åç»­çš„BitmapåŠ è½½ä¸ä¼šç”³è¯·æ–°çš„å†…å­˜ç©ºé—´è€Œæ˜¯ç›´æ¥å¤ç”¨inBitmapå±æ€§å€¼æŒ‡å‘çš„å†…å­˜ç©ºé—´&lt;/span&gt;
&lt;span&gt;        iv2.setImageBitmap(BitmapFactory.decodeFile(path2,options));
        iv3.setImageBitmap(BitmapFactory.decodeFile(path3,options));
        iv4.setImageBitmap(BitmapFactory.decodeFile(path4,options));&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¡¥å……ï¼šAndroid4.4ä»¥å‰ï¼Œä½ è¦ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆè¦æ±‚å¤ç”¨å†…å­˜ç©ºé—´çš„Bitmapå¯¹è±¡å¤§å°å¿…é¡»ä¸€æ ·ï¼›ä½†æ˜¯Android4.4 ä»¥ååªè¦æ±‚åç»­å¤ç”¨å†…å­˜ç©ºé—´çš„Bitmapå¯¹è±¡å¤§å°æ¯”inBitmapæŒ‡å‘çš„å†…å­˜ç©ºé—´è¦å°å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå±æ€§äº†ã€‚å¦å¤–ï¼Œå¦‚æœä½ ä¸åŒçš„imageview ä½¿ç”¨çš„scaletype ä¸åŒï¼Œä½†æ˜¯ä½ è¿™äº›ä¸åŒçš„imageviewçš„bitmapåœ¨åŠ è½½æ˜¯å¦‚æœéƒ½æ˜¯å¼•ç”¨çš„åŒä¸€ä¸ªinBitmapçš„è¯ï¼Œ&lt;/p&gt;
&lt;p&gt;è¿™äº›å›¾ç‰‡ä¼šç›¸äº’å½±å“ã€‚ç»¼ä¸Šï¼Œä½¿ç”¨inBitmapè¿™ä¸ªå±æ€§çš„æ—¶å€™ ä¸€å®šè¦å°å¿ƒå°å¿ƒå†å°å¿ƒã€‚&lt;/p&gt;

&lt;p&gt;å…­ã€å¼€æºæ¡†æ¶&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ç°åœ¨å·²ç»çŸ¥é“äº†ï¼ŒAndroidå›¾ç‰‡åŠ è½½çš„çŸ¥è¯†ç‚¹å’Œæ³¨æ„äº‹é¡¹å®åœ¨å¤ªå¤šäº†ï¼šå•ä¸ªçš„ä½å›¾åŠ è½½æˆ‘ä»¬è¦è€ƒè™‘BitmapåŠ è½½çš„OOMé—®é¢˜ã€å¼‚æ­¥å¤„ç†é—®é¢˜å’Œå†…å­˜æ³„éœ²é—®é¢˜ï¼›åˆ—è¡¨åŠ è½½ä½å›¾è¦è€ƒè™‘æ˜¾ç¤ºé”™ä¹±é—®é¢˜ï¼›é¢‘ç¹å¤§é‡çš„ä½å›¾åŠ è½½æ—¶æˆ‘ä»¬è¦è€ƒè™‘äºŒçº§ç¼“å­˜ç­–ç•¥ï¼›æˆ‘ä»¬è¿˜æœ‰è€ƒè™‘ä¸åŒç‰ˆæœ¬ä¸‹çš„Bitmapå†…å­˜ç®¡ç†é—®é¢˜ï¼Œåœ¨è¿™éƒ¨åˆ†æœ€åæˆ‘ä»¬ä»‹ç»äº†Bitmapå†…å­˜å¤ç”¨æ–¹å¼ï¼Œæˆ‘ä»¬éœ€è¦å°å¿ƒä½¿ç”¨è¿™ç§æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;é‚£ä¹ˆï¼Œèƒ½ä¸èƒ½æœ‰ä¸€ç§æ–¹å¼è®©æˆ‘ä»¬çœå»è¿™ä¹ˆå¤šç¹ççš„ç»†èŠ‚ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹å›¾ç‰‡è¿›è¡ŒåŠ è½½å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ï¼šåˆ©ç”¨å·²æœ‰çš„æˆç†Ÿçš„å›¾ç‰‡åŠ è½½å’Œç¼“å­˜å¼€æºæ¡†æ¶ï¼æ¯”å¦‚squareå…¬å¸çš„Picassoæ¡†æ¶ã€Googleå…¬å¸çš„Glideæ¡†æ¶å’ŒFacebookå…¬å¸çš„Frescoæ¡†æ¶ç­‰ã€‚ç‰¹åˆ«æ˜¯Frescoæ¡†æ¶ï¼Œæä¾›äº†ä¸‰çº§ç¼“å­˜ç­–ç•¥ï¼Œéå¸¸çš„ä¸“ä¸šã€‚æ ¹æ®APPå¯¹å›¾ç‰‡æ˜¾ç¤ºå’Œç¼“å­˜çš„éœ€æ±‚ä»ä½åˆ°é«˜æ’åºï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨çš„æ–¹æ¡ˆä¾æ¬¡ä¸ºï¼šBitmapfunã€Picassoã€Android-Universal-Image-Loaderã€Glideã€Frescoã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æ¡†æ¶å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬å®ç°å¯¹ç½‘ç»œå›¾ç‰‡çš„åŠ è½½å’Œç¼“å­˜æ“ä½œã€‚å…·ä½“ä¸å†èµ˜è¿°ã€‚&lt;/p&gt;

&lt;/div&gt;

&lt;/div&gt;</description>
<pubDate>Sat, 15 Jun 2019 15:04:00 +0000</pubDate>
<dc:creator>æ‘‡å¤´è€¶ç¨£</dc:creator>
<og:description>ä¸€ã€èƒŒæ™¯ åœ¨Androidå¼€å‘ä¸­ï¼Œä»»ä½•ä¸€ä¸ªAPPéƒ½ç¦»ä¸å¼€å›¾ç‰‡çš„åŠ è½½å’Œæ˜¾ç¤ºé—®é¢˜ã€‚è¿™é‡Œçš„å›¾ç‰‡æ¥æºåˆ†ä¸ºä¸‰ç§ï¼šé¡¹ç›®å›¾ç‰‡èµ„æºæ–‡ä»¶ï¼ˆä¸€èˆ¬ä¸ºres/drawableç›®å½•ä¸‹çš„å›¾ç‰‡æ–‡ä»¶ï¼‰ã€æ‰‹æœºæœ¬åœ°å›¾ç‰‡æ–‡ä»¶ã€ç½‘ç»œå›¾ç‰‡èµ„æº</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/shakinghead/p/11025805.html</dc:identifier>
</item>
<item>
<title>nginxä¸­å…±äº«å†…å­˜çš„ä½¿ç”¨ - atskyline</title>
<link>http://www.cnblogs.com/atskyline/p/11029068.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/atskyline/p/11029068.html</guid>
<description>&lt;p&gt;åœ¨nginxçš„è¿›ç¨‹æ¨¡å‹ä¸‹ï¼Œç±»ä¼¼æµé‡ç»Ÿè®¡ã€æµé‡æ§åˆ¶ã€æ•°æ®å…±äº«ã€ç­‰éœ€è¦å¤šä¸ªå·¥ä½œè¿›ç¨‹å…±åŒé…åˆå®Œæˆä»»åŠ¡ï¼Œå…±äº«å†…å­˜æ˜¯ä¸€ä¸ªé‡è¦çš„è¿›ç¨‹é€šè®¯çš„æ–¹æ¡ˆã€‚æœ¬æ–‡ä»‹ç»åœ¨nginxçš„ä»£ç ä¸­ä¸å…±äº«å†…å­˜ç›¸å…³çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ngx_shmemä¸ngx_slabçš„ä½¿ç”¨ä¸æ³¨æ„äº‹é¡¹ï¼Œä½†ä¸åŒ…æ‹¬ngx_slabä¸­å®ç°çš„å†…å­˜ç®¡ç†ç®—æ³•ã€‚&lt;/p&gt;

&lt;p&gt;ngx_shmem.c/hæ–‡ä»¶åªæ˜¯å¯¹mmap()/munmap()ç³»ç»Ÿè°ƒç”¨æˆ–è€…shmget()/shmdt()çš„ä¸€ä¸ªå¾ˆç®€å•çš„å°è£…ã€‚å®ç°äº†ngxé£æ ¼çš„åŸºç¡€åº“ï¼Œå¯ä»¥ç”³è¯·å’Œé‡Šæ”¾ä¸€æ®µè¿ç»­çš„å…±äº«å†…å­˜ç©ºé—´ã€‚ä¸€èˆ¬ç”¨äºå›ºå®šé•¿åº¦çš„å…±äº«æ•°æ®ä½¿ç”¨ï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­æ•°æ®é•¿åº¦å›ºå®šä¸ä¼šä¼¸ç¼©ã€‚&lt;/p&gt;
&lt;pre class=&quot;c&quot;&gt;
&lt;code&gt;typedef struct {
    u_char      *addr;
    size_t       size;
    ...
} ngx_shm_t;
ngx_int_t ngx_shm_alloc(ngx_shm_t *shm);
void ngx_shm_free(ngx_shm_t *shm);&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;åœ¨ngxinä¸­å…±äº«å†…å­˜çš„ä½¿ç”¨æµç¨‹ï¼Œä¸€èˆ¬æ˜¯ç”±masterè¿›ç¨‹åˆ›å»ºï¼Œworkerè¿›ç¨‹é€šè¿‡ç»§æ‰¿çš„æ–¹å¼è·å¾—å†…å­˜æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;p&gt;å…³äºngx_shmemçš„ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒngx_event_module_init()ä¸­éƒ¨åˆ†ç‰‡æ®µï¼Œè¿™éƒ¨åˆ†ä»£ç åœ¨å…±äº«å†…å­˜ä¸­åˆ›å»ºäº†è‹¥å¹²ä¸ªå˜é‡ï¼Œç”¨äºè®°å½•å„ä¸ªçŠ¶æ€(accepted/reading/writing...)çš„è¯·æ±‚æ•°é‡ï¼Œå¹¶åœ¨ngx_event_moduleä¸­çš„å‡ ä¸ªå…³é”®äº‹ä»¶å…¥å£å¯¹è¿™å‡ ä¸ªå˜é‡è¿›è¡ŒåŠ å‡ç»Ÿè®¡æ“ä½œã€‚å®ç°ç»Ÿè®¡æ‰€æœ‰workerè¿›ç¨‹å½“å‰çš„è¯·æ±‚çŠ¶æ€ã€‚&lt;/p&gt;
&lt;pre class=&quot;c&quot;&gt;
&lt;code&gt;shm.size = size;
ngx_str_set(&amp;amp;shm.name, &quot;nginx_shared_zone&quot;);
shm.log = cycle-&amp;gt;log;

if (ngx_shm_alloc(&amp;amp;shm) != NGX_OK) {
    return NGX_ERROR;
}

shared = shm.addr;
...
ngx_stat_accepted = (ngx_atomic_t *) (shared + 3 * cl);
ngx_stat_handled = (ngx_atomic_t *) (shared + 4 * cl);
ngx_stat_requests = (ngx_atomic_t *) (shared + 5 * cl);
ngx_stat_active = (ngx_atomic_t *) (shared + 6 * cl);
ngx_stat_reading = (ngx_atomic_t *) (shared + 7 * cl);
ngx_stat_writing = (ngx_atomic_t *) (shared + 8 * cl);
ngx_stat_waiting = (ngx_atomic_t *) (shared + 9 * cl);&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å…³äºè¿™ä¸ªåŠŸèƒ½çš„æ›´å¤šç»†èŠ‚ï¼Œå¯ä»¥æŸ¥çœ‹ä»£ç ä¸­çš„NGX_STAT_STUBå®å®šä¹‰ç›¸å…³ä»£ç ä¸ngx_http_stub_status_moduleã€‚&lt;/p&gt;

&lt;p&gt;ngx_shmemæ˜¯ä¸€å±‚æç®€çš„å°è£…ï¼Œå®ç°äº†å…±äº«å†…å­˜çš„åŸºæœ¬åŠŸèƒ½ã€‚ä½†æˆ‘ä»¬ç¨‹åºä¸­å¤§éƒ¨åˆ†çš„åœºæ™¯å…±äº«æ•°æ®å¹¶ä¸ä¼šä¸€ä¸ªå›ºå®šå¤§å°çš„ç»“æ„ï¼Œè€Œæ›´å¤šæ˜¯åƒngx_arrayã€ngx_listã€ngx_queueã€ngx_rbtreeè¿™ç±»å¤§å°å¯ä»¥å˜åŒ–çš„æ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æœŸæœ›èƒ½æœ‰åƒngx_pool_tä¸€æ ·å¯ä»¥åŠ¨æ€ç”³è¯·é‡Šæ”¾ç©ºé—´ä¸€ä¸ªå†…å­˜æ± ã€‚ngx_slabæ­£æ˜¯ä¸€ä¸ªè¿™æ ·çš„ç»“æ„ä½“ï¼ŒåŸç†ä¸Šä¸ç³»ç»Ÿçš„malloc()æœ‰ç›¸è¯†ä¹‹å¤„éƒ½æ˜¯é€šè¿‡ä¸€ç³»åˆ—ç®—æ³•å®ç°å¯¹ä¸€æ®µæ®µå†…å­˜ç‰‡æ®µçš„ç”³è¯·ä¸é‡Šæ”¾ã€‚åªä¸è¿‡ngx_slabæ“ä½œçš„å¯¹è±¡æ˜¯åŸºäºngx_shmemçš„å…±äº«å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆçœ‹ä¸€ä¸‹ngx_slabçš„æ¥å£&lt;/p&gt;
&lt;pre class=&quot;c&quot;&gt;
&lt;code&gt;typedef struct {
    ngx_shmtx_t       mutex;
    ...
    void             *data; /* ä¸€èˆ¬å­˜æ”¾ä»poolä¸­ç”³è¯·è·å¾—çš„æ ¹æ•°æ®åœ°å€ï¼ˆpoolä¸­ç¬¬ä¸€ä¸ªç”³è¯·çš„æ•°æ®æ¥å£ï¼‰ */
    void             *addr; /* ä½¿ç”¨ngx_shmemç”³è¯·è·å¾—çš„å…±äº«å†…å­˜åŸºåœ°å€ */
} ngx_slab_pool_t;

void ngx_slab_init(ngx_slab_pool_t *pool);
void *ngx_slab_alloc(ngx_slab_pool_t *pool, size_t size);
void *ngx_slab_alloc_locked(ngx_slab_pool_t *pool, size_t size);
void *ngx_slab_calloc(ngx_slab_pool_t *pool, size_t size);
void *ngx_slab_calloc_locked(ngx_slab_pool_t *pool, size_t size);
void ngx_slab_free(ngx_slab_pool_t *pool, void *p);
void ngx_slab_free_locked(ngx_slab_pool_t *pool, void *p);&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°æ¥å£å¹¶ä¸å¤æ‚ï¼Œallocä¸callocçš„åŒºåˆ«åœ¨äºæ˜¯å¦å¯¹ç”³è¯·è·å¾—çš„å†…å­˜æ®µæ¸…é›¶ï¼Œ_lockedç»“å°¾çš„æ¥å£è¡¨ç¤ºæ“ä½œçš„poolå·²ç»æ˜¯è·å–åˆ°é”çš„ã€‚åœ¨ngx_slab_pool_tçš„ç»“æ„ä½“æœ‰ä¸€ä¸ªngx_shmtx_tçš„äº’æ–¥é”ç”¨äºåŒæ­¥å¤šè¿›ç¨‹åŒæ—¶è®¿é—®poolçš„å¹¶å‘åœºæ™¯ã€‚æ³¨æ„ngx_slab_alloc()ä¼šå…ˆè·å–é”ã€ç„¶åç”³è¯·ç©ºé—´ã€æœ€åé‡Šæ”¾é”ã€‚è€Œngx_slab_alloc_locked()åˆ™ç›´æ¥ç”³è¯·ç©ºé—´ï¼Œè®¤ä¸ºç¨‹åºå·²ç»åœ¨å…¶ä»–é€»è¾‘ä¸­è·å¾—é”äº†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨nginxçš„å¼€å‘ä¸­ä½¿ç”¨ngx_shmemä¸€èˆ¬éœ€è¦éµå¾ªä»¥ä¸‹åˆå§‹åŒ–æµç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;æ¨¡å—åœ¨é…ç½®è§£æè¿‡ç¨‹ä¸­è°ƒç”¨ngx_shared_memory_add()æ¥å£ï¼Œæ³¨å†Œä¸€æ®µå…±äº«å†…å­˜ã€‚æä¾›å…±äº«å†…å­˜å¤§å°ä¸å†…å­˜åˆå§‹åŒ–çš„å›è°ƒå‡½æ•°ã€‚&lt;/li&gt;
&lt;li&gt;æ¡†æ¶åœ¨ngx_init_cycle()ä¸­ä½¿ç”¨ngx_shmemç”³è¯·å†…å­˜ï¼Œå¹¶åˆå§‹åŒ–ngx_slabï¼Œç„¶åå›è°ƒæ¨¡å—æ³¨å†Œçš„åˆå§‹åŒ–å‡½æ•°&lt;/li&gt;
&lt;li&gt;æ¨¡å—ä½¿ç”¨ngx_slabçš„ç”³è¯·/æ˜¯å¦æ¥å£&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;åœ¨è¿™ä¸ªæµç¨‹ä¸­ï¼Œæ¶‰åŠåˆ°ngx_shared_memory_add()æ¥å£ä¸å¯¹åº”çš„ngx_shm_zone_tç»“æ„ä½“ã€‚&lt;/p&gt;
&lt;pre class=&quot;c&quot;&gt;
&lt;code&gt;struct ngx_shm_zone_s {
    void                     *data;
    ngx_shm_t                 shm;
    ngx_shm_zone_init_pt      init;
    void                     *tag;
    void                     *sync;
    ngx_uint_t                noreuse;  /* unsigned  noreuse:1; */
};
ngx_shm_zone_t *ngx_shared_memory_add(ngx_conf_t *cf, ngx_str_t *name,
    size_t size, void *tag);&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å…¶ä¸­å€¼å¾—ä¸€æçš„æ˜¯noreuseå±æ€§ï¼Œè¿™ä¸ªå±æ€§æ§åˆ¶äº†åœ¨nginxçš„reloadè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šé‡æ–°ç”³è¯·å…±äº«å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºå…³äºngx_init_cycle()å‡½æ•°è¾ƒé•¿ï¼Œè¿™ä¸ªæµç¨‹å¯ä»¥é€šè¿‡æŸ¥æ‰¾/* create shared memory */è¿™ä¸ªæ³¨é‡Šæˆ–è€…cycle-&amp;gt;shared_memoryè¿™ä¸ªå¯¹è±¡æŸ¥çœ‹ç›¸å…³ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºngx_slabæ›´å¤šç»†èŠ‚çš„ä½¿ç”¨ï¼Œå»ºè®®å¯ä»¥å‚è€ƒngx_http_limit_conn_moduleï¼Œè¿™æ˜¯é€šè¿‡å…±äº«å†…å­˜å®ç°è¿æ¥æ•°é™åˆ¶çš„æ¨¡å—ï¼Œæ¨¡å—å¤æ‚åº¦åº•ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å‚è€ƒèŒƒä¾‹ã€‚&lt;/p&gt;

&lt;p&gt;åŒæ—¶å®‰åˆ©ä¸€æ³¢ã€Šæ·±å…¥ç†è§£Nginxã€‹ä½œè€… é™¶è¾‰ åœ¨æå®¢æ—¶é—´å‡ºç‰ˆçš„ã€ŠNginxæ ¸å¿ƒçŸ¥è¯†100è®²ã€‹ï¼Œè¿‘æœŸ618ä¼¼ä¹æœ‰æ‰“æŠ˜æ´»åŠ¨ï¼Œé€šè¿‡æˆ‘åˆ†äº«çš„é“¾æ¥è¿›è¡Œè´­ä¹°ï¼Œæˆ‘ä¹Ÿå°†è·å¾—éƒ¨åˆ†è¿”ç°ï¼Œæ„Ÿè°¢æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/271120/201906/271120-20190615221247740-236102145.png&quot;/&gt;&lt;/p&gt;
</description>
<pubDate>Sat, 15 Jun 2019 14:14:00 +0000</pubDate>
<dc:creator>atskyline</dc:creator>
<og:description>åœ¨nginxçš„è¿›ç¨‹æ¨¡å‹ä¸‹ï¼Œç±»ä¼¼æµé‡ç»Ÿè®¡ã€æµé‡æ§åˆ¶ã€æ•°æ®å…±äº«ã€ç­‰éœ€è¦å¤šä¸ªå·¥ä½œè¿›ç¨‹å…±åŒé…åˆå®Œæˆä»»åŠ¡ï¼Œå…±äº«å†…å­˜æ˜¯ä¸€ä¸ªé‡è¦çš„è¿›ç¨‹é€šè®¯çš„æ–¹æ¡ˆã€‚æœ¬æ–‡ä»‹ç»åœ¨nginxçš„ä»£ç ä¸­ä¸å…±äº«å†…å­˜ç›¸å…³çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ngx_shm</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/atskyline/p/11029068.html</dc:identifier>
</item>
<item>
<title>sql serverç¼–å†™é€šç”¨è„šæœ¬è‡ªåŠ¨æ£€æŸ¥ä¸¤ä¸ªä¸åŒæœåŠ¡å™¨çš„æ–°æ—§æ•°æ®åº“çš„è¡¨ç»“æ„å·®å¼‚ - å¼ å·¥502219048</title>
<link>http://www.cnblogs.com/zhang502219048/p/11028767.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/zhang502219048/p/11028767.html</guid>
<description>&lt;p&gt;&lt;strong&gt;é—®é¢˜ï¼š&lt;/strong&gt;&lt;br/&gt;å·¥ä½œè¿‡ç¨‹ä¸­ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆé¡¹ç›®ï¼Œä¼´éšç€é¡¹ç›®ä¸æ–­å‡çº§ç‰ˆæœ¬ï¼Œå¯¹åº”çš„é¡¹ç›®æ•°æ®åº“ä¸šåŠ¡ç‰ˆæœ¬ä¹Ÿä¸æ–­å‡çº§ï¼Œæ•°æ®åº“å‡ºç°æ–°å¢è¡¨ã€ä¿®æ”¹è¡¨ã€åˆ é™¤è¡¨ã€æ–°å¢å­—æ®µã€ä¿®æ”¹å­—æ®µã€åˆ é™¤å­—æ®µç­‰å˜åŒ–ï¼Œå¦‚æœäººå·¥æ£€æŸ¥ï¼Œæ•°æ®åº“è¡¨å’Œå­—æ®µæ¯”è¾ƒå¤šçš„è¯ï¼Œå·¥ä½œé‡å°±éå¸¸å¤§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆï¼š&lt;/strong&gt;&lt;br/&gt;è¿™é‡Œåšä¸»ä¸ºå¤§å®¶åˆ†äº«ä¸€ä¸ªåœ¨å·¥ä½œè¿‡ç¨‹ä¸­ç¼–å†™çš„è‡ªåŠ¨æ£€æŸ¥æ•°æ®åº“è¡¨ç»“æ„ç‰ˆæœ¬å·®å¼‚çš„é€šç”¨è„šæœ¬ï¼Œ&lt;span&gt;åªéœ€è¦æŠŠæ–°æ—§æ•°æ®åº“åç§°æ‰¹é‡æ›¿æ¢æˆå®é™…çš„åç§°&lt;/span&gt;å°±å¯ä»¥ï¼Œæ”¯æŒé€šè¿‡é“¾æ¥æœåŠ¡å™¨è·¨æœåŠ¡å™¨æ£€æŸ¥ä¸åŒæœåŠ¡å™¨çš„ä¸¤ä¸ªæ•°æ®åº“è¡¨ç»“æ„å·®å¼‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è„šæœ¬ï¼š&lt;br/&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;cnblogs_code&quot; readability=&quot;48&quot;&gt;
&lt;pre&gt;
&lt;span&gt;/*&lt;/span&gt;&lt;span&gt;
    ä½¿ç”¨è¯´æ˜ï¼šOldæ•°æ®åº“ä¸ºDB_V1ï¼ŒNewæ•°æ®åº“ä¸º[localhost].DB_V2ã€‚æ ¹æ®å®é™…éœ€è¦æ‰¹é‡æ›¿æ¢æ•°æ®åº“åç§°
    è„šæœ¬æ¥æºï¼šhttps://www.cnblogs.com/zhang502219048/p/11028767.html
&lt;/span&gt;&lt;span&gt;*/&lt;/span&gt;

&lt;span&gt;--&lt;/span&gt;&lt;span&gt; sysobjectsæ’å…¥ä¸´æ—¶è¡¨&lt;/span&gt;
&lt;span&gt;select&lt;/span&gt; s.name &lt;span&gt;+&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; &lt;span&gt;+&lt;/span&gt; t.name &lt;span&gt;as&lt;/span&gt; TableName, t.&lt;span&gt;*&lt;/span&gt; &lt;span&gt;into&lt;/span&gt;&lt;span&gt; #tempTA 
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt;&lt;span&gt; DB_V1.sys.tables t
&lt;/span&gt;&lt;span&gt;inner&lt;/span&gt; &lt;span&gt;join&lt;/span&gt; DB_V1.sys.schemas s &lt;span&gt;on&lt;/span&gt; s.schema_id &lt;span&gt;=&lt;/span&gt;&lt;span&gt; t.schema_id

&lt;/span&gt;&lt;span&gt;select&lt;/span&gt; s.name &lt;span&gt;+&lt;/span&gt; &lt;span&gt;'&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;'&lt;/span&gt; &lt;span&gt;+&lt;/span&gt; t.name &lt;span&gt;as&lt;/span&gt; TableName, t.&lt;span&gt;*&lt;/span&gt; &lt;span&gt;into&lt;/span&gt;&lt;span&gt; #tempTB 
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt; &lt;span&gt;[&lt;/span&gt;&lt;span&gt;localhost&lt;/span&gt;&lt;span&gt;]&lt;/span&gt;&lt;span&gt;.DB_V2.sys.tables t
&lt;/span&gt;&lt;span&gt;inner&lt;/span&gt; &lt;span&gt;join&lt;/span&gt; &lt;span&gt;[&lt;/span&gt;&lt;span&gt;localhost&lt;/span&gt;&lt;span&gt;]&lt;/span&gt;.DB_V2.sys.schemas s &lt;span&gt;on&lt;/span&gt; s.schema_id &lt;span&gt;=&lt;/span&gt;&lt;span&gt; t.schema_id

&lt;/span&gt;&lt;span&gt;--&lt;/span&gt;&lt;span&gt; syscolumnsæ’å…¥ä¸´æ—¶è¡¨&lt;/span&gt;
&lt;span&gt;select&lt;/span&gt; &lt;span&gt;*&lt;/span&gt; &lt;span&gt;into&lt;/span&gt; #tempCA &lt;span&gt;from&lt;/span&gt;&lt;span&gt; DB_V1.dbo.syscolumns 
&lt;/span&gt;&lt;span&gt;select&lt;/span&gt; &lt;span&gt;*&lt;/span&gt; &lt;span&gt;into&lt;/span&gt; #tempCB &lt;span&gt;from&lt;/span&gt; &lt;span&gt;[&lt;/span&gt;&lt;span&gt;localhost&lt;/span&gt;&lt;span&gt;]&lt;/span&gt;&lt;span&gt;.DB_V2.dbo.syscolumns

&lt;/span&gt;&lt;span&gt;--&lt;/span&gt;&lt;span&gt; ç¬¬ä¸€ä¸ªæ•°æ®åº“è¡¨å’Œå­—æ®µ &lt;/span&gt;
&lt;span&gt;select&lt;/span&gt; b.TableName &lt;span&gt;as&lt;/span&gt; è¡¨å, a.name &lt;span&gt;as&lt;/span&gt; å­—æ®µå, a.length &lt;span&gt;as&lt;/span&gt; é•¿åº¦, c.name &lt;span&gt;as&lt;/span&gt;&lt;span&gt; ç±»å‹
&lt;/span&gt;&lt;span&gt;into&lt;/span&gt;&lt;span&gt; #tempA
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt;&lt;span&gt; #tempCA a
&lt;/span&gt;&lt;span&gt;inner&lt;/span&gt; &lt;span&gt;join&lt;/span&gt; #tempTA b &lt;span&gt;on&lt;/span&gt; b.&lt;span&gt;object_id&lt;/span&gt; &lt;span&gt;=&lt;/span&gt;&lt;span&gt; a.id
&lt;/span&gt;&lt;span&gt;inner&lt;/span&gt; &lt;span&gt;join&lt;/span&gt; systypes c &lt;span&gt;on&lt;/span&gt; c.xusertype &lt;span&gt;=&lt;/span&gt;&lt;span&gt; a.xusertype
&lt;/span&gt;&lt;span&gt;order&lt;/span&gt; &lt;span&gt;by&lt;/span&gt;&lt;span&gt; b.name 
&lt;/span&gt;&lt;span&gt;--&lt;/span&gt;&lt;span&gt; ç¬¬äºŒä¸ªæ•°æ®åº“è¡¨å’Œå­—æ®µ &lt;/span&gt;
&lt;span&gt;select&lt;/span&gt; b.TableName &lt;span&gt;as&lt;/span&gt; è¡¨å, a.name &lt;span&gt;as&lt;/span&gt; å­—æ®µå, a.length &lt;span&gt;as&lt;/span&gt; é•¿åº¦, c.name &lt;span&gt;as&lt;/span&gt;&lt;span&gt; ç±»å‹
&lt;/span&gt;&lt;span&gt;into&lt;/span&gt;&lt;span&gt; #tempB
&lt;/span&gt;&lt;span&gt;from&lt;/span&gt;&lt;span&gt; #tempCB a
&lt;/span&gt;&lt;span&gt;inner&lt;/span&gt; &lt;span&gt;join&lt;/span&gt; #tempTB b &lt;span&gt;on&lt;/span&gt; b.&lt;span&gt;object_id&lt;/span&gt; &lt;span&gt;=&lt;/span&gt;&lt;span&gt; a.id
&lt;/span&gt;&lt;span&gt;inner&lt;/span&gt; &lt;span&gt;join&lt;/span&gt; systypes c &lt;span&gt;on&lt;/span&gt; c.xusertype &lt;span&gt;=&lt;/span&gt;&lt;span&gt; a.xusertype
&lt;/span&gt;&lt;span&gt;order&lt;/span&gt; &lt;span&gt;by&lt;/span&gt;&lt;span&gt; b.name

&lt;/span&gt;&lt;span&gt;--&lt;/span&gt;&lt;span&gt;åˆ æ‰çš„å­—æ®µ&lt;/span&gt;
&lt;span&gt;select&lt;/span&gt; &lt;span&gt;*&lt;/span&gt; &lt;span&gt;from&lt;/span&gt;&lt;span&gt;    
( 
    &lt;/span&gt;&lt;span&gt;select&lt;/span&gt; &lt;span&gt;*&lt;/span&gt; &lt;span&gt;from&lt;/span&gt;&lt;span&gt; #tempA
    &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;
    &lt;span&gt;select&lt;/span&gt; &lt;span&gt;*&lt;/span&gt; &lt;span&gt;from&lt;/span&gt;&lt;span&gt; #tempB
) a;

&lt;/span&gt;&lt;span&gt;--&lt;/span&gt;&lt;span&gt;å¢åŠ çš„å­—æ®µ&lt;/span&gt;
&lt;span&gt;select&lt;/span&gt; &lt;span&gt;*&lt;/span&gt; &lt;span&gt;from&lt;/span&gt;&lt;span&gt;    
( 
    &lt;/span&gt;&lt;span&gt;select&lt;/span&gt; &lt;span&gt;*&lt;/span&gt; &lt;span&gt;from&lt;/span&gt;&lt;span&gt; #tempB
    &lt;/span&gt;&lt;span&gt;except&lt;/span&gt;
    &lt;span&gt;select&lt;/span&gt; &lt;span&gt;*&lt;/span&gt; &lt;span&gt;from&lt;/span&gt;&lt;span&gt; #tempA
) a;

&lt;/span&gt;&lt;span&gt;--&lt;/span&gt;&lt;span&gt;select * from #tempA&lt;/span&gt;&lt;span&gt;
--&lt;/span&gt;&lt;span&gt;select * from #tempB&lt;/span&gt;

&lt;span&gt;drop&lt;/span&gt; &lt;span&gt;table&lt;/span&gt; #tempTA, #tempTB, #tempCA, #tempCB, #tempA, #tempB
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹æ—§æ•°æ®åº“DB_V1ï¼š&lt;br/&gt;&lt;/strong&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1703141/201906/1703141-20190615203228961-840775818.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹æ–°æ•°æ®åº“DB_V2ï¼š&lt;/strong&gt;&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1703141/201906/1703141-20190615203305147-668282207.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è„šæœ¬è¿è¡Œç»“æœï¼š&lt;/strong&gt;&lt;br/&gt;&lt;img src=&quot;https://img2018.cnblogs.com/blog/1703141/201906/1703141-20190615203357483-611951059.png&quot; alt=&quot;&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®ºï¼š&lt;br/&gt;&lt;/strong&gt;ä»ä¸Šé¢å‡ ä¸ªå›¾å¯ä»¥çœ‹åˆ°ï¼Œè¡¨å’Œå­—æ®µçš„å·®å¼‚éƒ¨åˆ†å°±è¢«è‡ªåŠ¨æ£€æµ‹åˆ°äº†ã€‚&lt;/p&gt;
&lt;p&gt;ã€è½¬è½½è¯·æ³¨æ˜åšæ–‡æ¥æºï¼š&lt;a href=&quot;https://www.cnblogs.com/zhang502219048/p/11028767.html&quot; target=&quot;_blank&quot;&gt;https://www.cnblogs.com/zhang502219048/p/11028767.html&lt;/a&gt;ã€‘&lt;/p&gt;
</description>
<pubDate>Sat, 15 Jun 2019 12:39:00 +0000</pubDate>
<dc:creator>å¼ å·¥502219048</dc:creator>
<og:description>é—®é¢˜ï¼šå·¥ä½œè¿‡ç¨‹ä¸­ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆé¡¹ç›®ï¼Œä¼´éšç€é¡¹ç›®ä¸æ–­å‡çº§ç‰ˆæœ¬ï¼Œå¯¹åº”çš„é¡¹ç›®æ•°æ®åº“ä¸šåŠ¡ç‰ˆæœ¬ä¹Ÿä¸æ–­å‡çº§ï¼Œæ•°æ®åº“å‡ºç°æ–°å¢è¡¨ã€ä¿®æ”¹è¡¨ã€åˆ é™¤è¡¨ã€æ–°å¢å­—æ®µã€ä¿®æ”¹å­—æ®µã€åˆ é™¤å­—æ®µç­‰å˜åŒ–ï¼Œå¦‚æœäººå·¥æ£€æŸ¥ï¼Œæ•°æ®åº“è¡¨å’Œå­—æ®µæ¯”è¾ƒå¤šçš„</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/zhang502219048/p/11028767.html</dc:identifier>
</item>
<item>
<title>MyBatis æºç åˆ†æ - å½“å¹´æ˜æœˆ123</title>
<link>http://www.cnblogs.com/paulwang92115/p/11028715.html</link>
<guid isPermaLink="true" >http://www.cnblogs.com/paulwang92115/p/11028715.html</guid>
<description>&lt;h3 id=&quot;mybatis-è¿è¡Œè¿‡ç¨‹&quot;&gt;MyBatis è¿è¡Œè¿‡ç¨‹&lt;/h3&gt;
&lt;p&gt;ä¼ ç»Ÿçš„ JDBC ç¼–ç¨‹æŸ¥è¯¢æ•°æ®åº“çš„ä»£ç å’Œè¿‡ç¨‹æ€»ç»“ã€‚&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;åŠ è½½é©±åŠ¨ã€‚&lt;/li&gt;
&lt;li&gt;åˆ›å»ºè¿æ¥ï¼ŒConnection å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;æ ¹æ® Connection åˆ›å»º Statement æˆ–è€… PreparedStatement æ¥æ‰§è¡Œ sql è¯­å¥ã€‚&lt;/li&gt;
&lt;li&gt;è¿”å›ç»“æœé›†åˆ° ResultSet ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;æ‰‹åŠ¨å°† ResultSet æ˜ å°„åˆ° JavaBean ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;        public static void main(String[] args) {
            //å£°æ˜Connectionå¯¹è±¡
            Connection con = null;
            //éå†æŸ¥è¯¢ç»“æœé›†
            try {
                //åŠ è½½é©±åŠ¨ç¨‹åº
                Class.forName(&quot;com.mysql.jdbc.Driver&quot;);
                //åˆ›å»º connection å¯¹è±¡
                con = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/db&quot;,&quot;username&quot;,&quot;password&quot;);

                //ä½¿ç”¨ connection å¯¹è±¡åˆ›å»ºstatement æˆ–è€… PreparedStatement ç±»å¯¹è±¡ï¼Œç”¨æ¥æ‰§è¡ŒSQLè¯­å¥
                Statement statement = con.createStatement();
                //è¦æ‰§è¡Œçš„SQLè¯­å¥
                String sql = &quot;select * from emp&quot;;
                //3.ResultSetç±»ï¼Œç”¨æ¥å­˜æ”¾è·å–çš„ç»“æœé›†ï¼ï¼
                ResultSet rs = statement.executeQuery(sql);
   
                String job = &quot;&quot;;
                String id = &quot;&quot;;
                while(rs.next()){
                    //è·å–stunameè¿™åˆ—æ•°æ®
                    job = rs.getString(&quot;job&quot;);
                    //è·å–stuidè¿™åˆ—æ•°æ®
                    id = rs.getString(&quot;ename&quot;);

                    //è¾“å‡ºç»“æœ
                    System.out.println(id + &quot;\t&quot; + job);
                }
            } catch(ClassNotFoundException e) {
                e.printStackTrace();
            } catch(SQLException e) {
                //æ•°æ®åº“è¿æ¥å¤±è´¥å¼‚å¸¸å¤„ç†
                e.printStackTrace();
            }catch (Exception e) {
                e.printStackTrace();
            }finally{
                rs.close();
                con.close();
            }
        }&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;ç¼–ç æ–¹å¼å®ç° MyBatis æŸ¥è¯¢æ•°æ®åº“ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œä¸ä½¿ç”¨ SpringMybatisï¼ŒåŠ å…¥ Spring åæ•´ä½“æµç¨‹ä¼šå¤æ‚å¾ˆå¤šã€‚ä½¿ç”¨ MyBatis åèƒ½å°†åŸæ¥çš„ä¼ ç»Ÿçš„ JDBC ç¼–ç¨‹ç¼–çš„å¦‚æ­¤ç®€å•ã€‚å…·ä½“æµç¨‹æ€»ç»“ã€‚&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;ä½¿ç”¨é…ç½®æ–‡ä»¶æ„å»º SqlSessionFactoryã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ SqlSessionFactory è·å¾— SqlSessionï¼ŒSqlSession ç›¸å½“äºä¼ ç»Ÿ JDBC çš„ Conectionã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ SqlSession å¾—åˆ° Mapperã€‚&lt;/li&gt;
&lt;li&gt;ç”¨ Mapper æ¥æ‰§è¡Œ sql è¯­å¥ï¼Œå¹¶è¿”å›ç»“æœç›´æ¥å°è£…åˆ° JavaBean ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;//è·å– sqlSessionï¼ŒsqlSession ç›¸å½“äºä¼ ç»Ÿ JDBC çš„ Conection
public static SqlSession getSqlSession(){
        InputStream configFile = new FileInputStream(filePath);
    SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder.build(configFile);
    return sqlSessionFactory.openSession();
}

//ä½¿ç”¨ sqlSession è·å¾—å¯¹åº”çš„ mapperï¼Œmapper ç”¨æ¥æ‰§è¡Œ sql è¯­å¥ã€‚
public static User get(SqlSession sqlSession, int id){
    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
    return userMapper.selectByPrimaryKey(id);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2019/6/15/16b5af6a6614ccea?w=796&amp;amp;h=422&amp;amp;f=png&amp;amp;s=32535&quot;/&gt;&lt;/p&gt;
&lt;h3 id=&quot;mybatis-æºç åˆ†æ&quot;&gt;MyBatis æºç åˆ†æ&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢æ¥å…·ä½“åˆ†æ MyBatis ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹**&lt;/p&gt;
&lt;p&gt;æ•´ä½“æ¶æ„&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2019/6/15/16b5af70f47fa37f?w=866&amp;amp;h=720&amp;amp;f=png&amp;amp;s=19802&quot;/&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æºç åˆ†æ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å…ˆè¯´ä¸€ä¸‹å¤§éƒ¨åˆ†æ¡†æ¶çš„ä»£ç æµç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2019/6/15/16b5af7706ce94e8?w=515&amp;amp;h=454&amp;amp;f=png&amp;amp;s=15407&quot;/&gt;&lt;/p&gt;
&lt;p&gt;å†çœ‹æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;&amp;lt;configuration&amp;gt;
    &amp;lt;environments default=&quot;development&quot;&amp;gt;
    &amp;lt;environment id=&quot;development&quot;&amp;gt;
        &amp;lt;transactionManager type=&quot;JDBC&quot;&amp;gt;
        &amp;lt;dataSource type=&quot;POOLED&quot;&amp;gt;
          &amp;lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&amp;gt;
          &amp;lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/db&quot;/&amp;gt;
          &amp;lt;property name=&quot;username&quot; value=&quot;root&quot;/&amp;gt;
          &amp;lt;property name=&quot;password&quot; value=&quot;123456&quot;/&amp;gt;
        &amp;lt;/dataSource&amp;gt;
      &amp;lt;/transactionManager&amp;gt;
    &amp;lt;/environment&amp;gt;
  &amp;lt;/environments&amp;gt;
&amp;lt;/configuration&amp;gt;
&amp;lt;mappers&amp;gt;
  &amp;lt;mapper resource=&quot;xml/UserMapper.xml&quot;/&amp;gt;
&amp;lt;/mappers&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public static SqlSession getSqlSession(){
    //è¯»å–ä¸Šé¢çš„é…ç½®æ–‡ä»¶
        InputStream configFile = new FileInputStream(filePath);
    //æ ¹æ®ä¸Šé¢é…ç½®çš„ dataSource é…ç½® SqlSessionFactoryï¼Œå¹¶ä¸”å»ºç«‹ Mapper æ¥å£å’Œ xml ä¹‹é—´çš„å…³ç³»ã€‚
    SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder.build(configFile);
    //å·¥å‚æ–¹æ³•è¿”å›ä¸€ä¸ª sqlSession
    return sqlSessionFactory.openSession();
}

//æˆ‘ä»¬æ¥é‡ç‚¹çœ‹çœ‹ openSession åšäº†ä»€ä¹ˆæ“ä½œ, DefaultSqlSessionFactory.java
@Override
public SqlSession openSession() {
  return this.openSessionFromDataSource(this.configuration.getDefaultExecutorType(), (TransactionIsolationLevel)null, false);
}

public Configuration getConfiguration() {
  return this.configuration;
}
//è¿™ä¸ªå‡½æ•°é‡Œé¢æœ‰ç€äº‹åŠ¡æ§åˆ¶ç›¸å…³çš„ä»£ç ã€‚
private SqlSession openSessionFromDataSource(ExecutorType execType, TransactionIsolationLevel level, boolean autoCommit) {
  Transaction tx = null;

  DefaultSqlSession var8;
  try {
    Environment environment = this.configuration.getEnvironment();
    TransactionFactory transactionFactory = this.getTransactionFactoryFromEnvironment(environment);
    //æ ¹æ®ä¸Šé¢çš„å‚æ•°å¾—åˆ° TransactionFactoryï¼Œé€šè¿‡ TransactionFactory ç”Ÿæˆä¸€ä¸ª Transactionï¼Œå¯ä»¥ç†è§£ä¸ºè¿™ä¸ª SqlSession çš„äº‹åŠ¡æ§åˆ¶å™¨
    tx = transactionFactory.newTransaction(environment.getDataSource(), level, autoCommit);
    // å°†è¿™ä¸ªäº‹åŠ¡æ§åˆ¶å™¨å°è£…åœ¨ Executor é‡Œ
    Executor executor = this.configuration.newExecutor(tx, execType);
    // ä½¿ç”¨ configuration é…ç½®ç±»ï¼ŒExecutorï¼Œå’Œ configuration(æ˜¯å¦è‡ªåŠ¨æäº¤) æ¥æ„å»ºä¸€ä¸ª DefaultSqlSessionã€‚
    var8 = new DefaultSqlSession(this.configuration, executor, autoCommit);
  } catch (Exception var12) {
    this.closeTransaction(tx);
    throw ExceptionFactory.wrapException(&quot;Error opening session.  Cause: &quot; + var12, var12);
  } finally {
    ErrorContext.instance().reset();
  }

  return var8;
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;SqlSession çš„å®ç°æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2019/6/15/16b5af7d534916be?w=583&amp;amp;h=442&amp;amp;f=png&amp;amp;s=16160&quot;/&gt;&lt;/p&gt;
&lt;p&gt;SqlSession çš„æ¥å£å®šä¹‰ï¼šé‡Œé¢å®šä¹‰äº†å¢åˆ æ”¹æŸ¥å’Œæäº¤å›æ»šç­‰æ–¹æ³•ã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public interface SqlSession extends Closeable {
    &amp;lt;T&amp;gt; T selectOne(String var1);

    &amp;lt;T&amp;gt; T selectOne(String var1, Object var2);

    &amp;lt;E&amp;gt; List&amp;lt;E&amp;gt; selectList(String var1);

    &amp;lt;E&amp;gt; List&amp;lt;E&amp;gt; selectList(String var1, Object var2);

    &amp;lt;E&amp;gt; List&amp;lt;E&amp;gt; selectList(String var1, Object var2, RowBounds var3);

    &amp;lt;K, V&amp;gt; Map&amp;lt;K, V&amp;gt; selectMap(String var1, String var2);

    &amp;lt;K, V&amp;gt; Map&amp;lt;K, V&amp;gt; selectMap(String var1, Object var2, String var3);

    &amp;lt;K, V&amp;gt; Map&amp;lt;K, V&amp;gt; selectMap(String var1, Object var2, String var3, RowBounds var4);

    &amp;lt;T&amp;gt; Cursor&amp;lt;T&amp;gt; selectCursor(String var1);

    &amp;lt;T&amp;gt; Cursor&amp;lt;T&amp;gt; selectCursor(String var1, Object var2);

    &amp;lt;T&amp;gt; Cursor&amp;lt;T&amp;gt; selectCursor(String var1, Object var2, RowBounds var3);

    void select(String var1, Object var2, ResultHandler var3);

    void select(String var1, ResultHandler var2);

    void select(String var1, Object var2, RowBounds var3, ResultHandler var4);

    int insert(String var1);

    int insert(String var1, Object var2);

    int update(String var1);

    int update(String var1, Object var2);

    int delete(String var1);

    int delete(String var1, Object var2);

    void commit();

    void commit(boolean var1);

    void rollback();

    void rollback(boolean var1);

    List&amp;lt;BatchResult&amp;gt; flushStatements();

    void close();

    void clearCache();

    Configuration getConfiguration();

    &amp;lt;T&amp;gt; T getMapper(Class&amp;lt;T&amp;gt; var1);

    Connection getConnection();
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ¥ä¸‹æ¥ç”¨ sqlSession è·å–å¯¹åº”çš„ Mapperï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;//ä½¿ç”¨ sqlSession è·å¾—å¯¹åº”çš„ mapperï¼Œmapper ç”¨æ¥æ‰§è¡Œ sql è¯­å¥ã€‚
public static User get(SqlSession sqlSession, int id){
    UserMapper userMapper = sqlSession.getMapper(UserMapper.class);
    return userMapper.selectByPrimaryKey(id);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;DefaultSqlSession çš„ getMapper å®ç°ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public &amp;lt;T&amp;gt; T getMapper(Class&amp;lt;T&amp;gt; type) {
  return this.configuration.getMapper(type, this);
}

//ä» configuration é‡Œé¢ getMapperï¼ŒMapper å°±åœ¨ Configuration é‡Œ
public &amp;lt;T&amp;gt; T getMapper(Class&amp;lt;T&amp;gt; type, SqlSession sqlSession) {
  return this.mapperRegistry.getMapper(type, sqlSession);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;MapperRegistry é‡Œ getMapper çš„æœ€ç»ˆå®ç°ï¼š&lt;/p&gt;
&lt;p&gt;è¿™é‡Œå°±è¦è¯´æ˜ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„æ¥å£é‡Œé¢åªå®šä¹‰äº†æŠ½è±¡çš„å¢åˆ æ”¹æŸ¥ï¼Œè€Œè¿™ä¸ªæ¥å£å¹¶æ²¡æœ‰ä»»ä½•å®ç°ç±»ï¼Œé‚£ä¹ˆè¿™ä¸ª xml åˆ°åº•æ˜¯å¦‚ä½•ä¸æ¥å£å…³è”èµ·æ¥å¹¶ç”Ÿæˆå®ç°ç±»é‚£ï¼Ÿ&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public class MapperRegistry {
    private final Configuration config;
    // ç”¨ä¸€ä¸ª Map æ¥å­˜å‚¨æ¥å£å’Œ xml æ–‡ä»¶ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œkey åº”è¯¥æ˜¯æ¥å£ï¼Œä½†æ˜¯ value æ˜¯ MapperProxyFactory
    private final Map&amp;lt;Class&amp;lt;?&amp;gt;, MapperProxyFactory&amp;lt;?&amp;gt;&amp;gt; knownMappers = new HashMap();

    public MapperRegistry(Configuration config) {
        this.config = config;
    }

    public &amp;lt;T&amp;gt; T getMapper(Class&amp;lt;T&amp;gt; type, SqlSession sqlSession) {
      //è·å–åˆ°è¿™ä¸ªæ¥å£å¯¹åº”çš„ MapperProxyFactoryã€‚
        MapperProxyFactory&amp;lt;T&amp;gt; mapperProxyFactory = (MapperProxyFactory)this.knownMappers.get(type);
        if (mapperProxyFactory == null) {
            throw new BindingException(&quot;Type &quot; + type + &quot; is not known to the MapperRegistry.&quot;);
        } else {
            try {
                //ç”¨ä¸Šä¸€æ­¥è·å–çš„ MapperProxyFactory å’Œ sqlSession æ„å»ºå¯¹åº”çš„ Class
                return mapperProxyFactory.newInstance(sqlSession);
            } catch (Exception var5) {
                throw new BindingException(&quot;Error getting mapper instance. Cause: &quot; + var5, var5);
            }
        }
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ newInstance çš„å…·ä½“å®ç°ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public T newInstance(SqlSession sqlSession) {
  // mapperInterface å°±æ˜¯æ¥å£
  MapperProxy&amp;lt;T&amp;gt; mapperProxy = new MapperProxy(sqlSession, this.mapperInterface, this.methodCache);
  return this.newInstance(mapperProxy);
}

protected T newInstance(MapperProxy&amp;lt;T&amp;gt; mapperProxy) {
  //åŠ¨æ€ä»£ç†ï¼Œè¿™é‡Œçš„åŠ¨æ€ä»£ç†æœ‰ä¸€äº›ä¸ä¸€æ ·
  return Proxy.newProxyInstance(this.mapperInterface.getClassLoader(), new Class[]{this.mapperInterface}, mapperProxy);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ­£å¸¸æµç¨‹çš„åŠ¨æ€ä»£ç†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2019/6/15/16b5af89a5c31f0f?w=502&amp;amp;h=332&amp;amp;f=png&amp;amp;s=12301&quot;/&gt;&lt;/p&gt;
&lt;p&gt;ä¸ä¼ ç»Ÿçš„åŠ¨æ€ä»£ç†ç›¸æ¯”ï¼ŒMyBatis çš„æ¥å£æ˜¯æ²¡æœ‰å®ç°ç±»çš„ï¼Œé‚£ä¹ˆå®ƒåˆæ˜¯æ€ä¹ˆå®ç°åŠ¨æ€ä»£ç†çš„é‚£ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ MapperProxy çš„æºç ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public class MapperProxy&amp;lt;T&amp;gt; implements InvocationHandler, Serializable {
    private static final long serialVersionUID = -6424540398559729838L;
    private final SqlSession sqlSession;
    private final Class&amp;lt;T&amp;gt; mapperInterface;
    private final Map&amp;lt;Method, MapperMethod&amp;gt; methodCache;

    public MapperProxy(SqlSession sqlSession, Class&amp;lt;T&amp;gt; mapperInterface, Map&amp;lt;Method, MapperMethod&amp;gt; methodCache) {
        this.sqlSession = sqlSession;
        this.mapperInterface = mapperInterface;
        this.methodCache = methodCache;
    }
        // æ­£å¸¸çš„åŠ¨æ€ä»£ç†ä¸­ Object proxy è¿™ä¸ªå‚æ•°åº”è¯¥æ˜¯æ¥å£çš„å®ç°ç±»
    // com.paul.pkg.UserMapper@5a123uf
    // ç°åœ¨é‡Œé¢æ˜¯ org.apache.ibatis.binding.MapperProxy@6y213kn, è¿™ä¿©é¢
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        try {
            if (Object.class.equals(method.getDeclaringClass())) {
                return method.invoke(this, args);
            }

            if (this.isDefaultMethod(method)) {
                return this.invokeDefaultMethod(proxy, method, args);
            }
        } catch (Throwable var5) {
            throw ExceptionUtil.unwrapThrowable(var5);
        }
        // Mapper èµ°è¿™ä¸ªæµç¨‹ï¼Œå…ˆå°è¯•åœ¨ç¼“å­˜é‡Œè·å– method
        MapperMethod mapperMethod = this.cachedMapperMethod(method);
        return mapperMethod.execute(this.sqlSession, args);
    }

    private MapperMethod cachedMapperMethod(Method method) {
        MapperMethod mapperMethod = (MapperMethod)this.methodCache.get(method);
        if (mapperMethod == null) {
            // mapperMethod çš„æ„å»ºï¼Œé€šè¿‡æ¥å£åï¼Œæ–¹æ³•ï¼Œå’Œ xml é…ç½®ï¼ˆé€šè¿‡ sqlSession çš„ Configuration è·å¾—ï¼‰
            mapperMethod = new MapperMethod(this.mapperInterface, method, this.sqlSession.getConfiguration());
          //é€šè¿‡ execute æ‰§è¡Œæ–¹æ³•ï¼Œå› ä¸º sqlSession å°è£…äº† Executorï¼Œæ‰€ä»¥è¿˜è¦ä¼ è¿›æ¥ï¼Œexecute æ–¹æ³•ä½¿ç”¨
          //sqlSession é‡Œé¢çš„æ–¹æ³•ã€‚
            this.methodCache.put(method, mapperMethod);
        }

        return mapperMethod;
    }

}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ¥çœ‹ MapperMethod çš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;// command é‡Œé¢åŒ…å«äº†æ–¹æ³•åï¼Œæ¯”å¦‚ com.paul.pkg.selectByPrimaryKey
// type, è¡¨ç¤ºæ˜¯ SELECTï¼ŒUPDATEï¼ŒINSERTï¼Œæˆ–è€… DELETE
// method æ˜¯æ–¹æ³•çš„ç­¾å
public class MapperMethod {
    private final MapperMethod.SqlCommand command;
    private final MapperMethod.MethodSignature method;

    public MapperMethod(Class&amp;lt;?&amp;gt; mapperInterface, Method method, Configuration config) {
        this.command = new MapperMethod.SqlCommand(config, mapperInterface, method);
        this.method = new MapperMethod.MethodSignature(config, mapperInterface, method);
    }
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;è¿›å…¥ DefaultSqlSession æ‰§è¡Œå¯¹åº”çš„ sql è¯­å¥ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public &amp;lt;T&amp;gt; T selectOne(String statement, Object parameter) {
  List&amp;lt;T&amp;gt; list = this.selectList(statement, parameter);
  if (list.size() == 1) {
    return list.get(0);
  } else if (list.size() &amp;gt; 1) {
    throw new TooManyResultsException(&quot;Expected one result (or null) to be returned by selectOne(), but found: &quot; + list.size());
  } else {
    return null;
  }
}

public &amp;lt;E&amp;gt; List&amp;lt;E&amp;gt; selectList(String statement, Object parameter, RowBounds rowBounds) {
  List var5;
  try {
    // è¿™é‡Œåˆéœ€è¦ configuration æ¥è·å–å¯¹åº”çš„ statement
    // MappedStatement é‡Œé¢æœ‰ xml æ–‡ä»¶ï¼Œå’Œè¦æ‰§è¡Œçš„æ–¹æ³•ï¼Œå°±æ˜¯ xml é‡Œé¢çš„ idï¼ŒstatementTypeï¼Œä»¥åŠ sql è¯­å¥ã€‚
    MappedStatement ms = this.configuration.getMappedStatement(statement);
    // ç”¨ executor æ‰§è¡Œ queryï¼Œexecutor é‡Œé¢åº”è¯¥æ˜¯åŒ…è£…äº† JDBCã€‚
    var5 = this.executor.query(ms, this.wrapCollection(parameter), rowBounds, Executor.NO_RESULT_HANDLER);
  } catch (Exception var9) {
    throw ExceptionFactory.wrapException(&quot;Error querying database.  Cause: &quot; + var9, var9);
  } finally {
    ErrorContext.instance().reset();
  }

  return var5;
}&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Executor çš„å®ç°ç±»é‡Œé¢æ‰§è¡Œ query æ–¹æ³•ï¼š&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;public &amp;lt;E&amp;gt; List&amp;lt;E&amp;gt; query(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler) throws SQLException {
  BoundSql boundSql = ms.getBoundSql(parameterObject);
  CacheKey key = this.createCacheKey(ms, parameterObject, rowBounds, boundSql);
  return this.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);
}
public &amp;lt;E&amp;gt; List&amp;lt;E&amp;gt; query(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql) throws SQLException {
  Cache cache = ms.getCache();
  if (cache != null) {
    this.flushCacheIfRequired(ms);
    if (ms.isUseCache() &amp;amp;&amp;amp; resultHandler == null) {
      this.ensureNoOutParams(ms, boundSql);
      List&amp;lt;E&amp;gt; list = (List)this.tcm.getObject(cache, key);
      if (list == null) {
        list = this.delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);
        this.tcm.putObject(cache, key, list);
      }

      return list;
    }
  }
  // ä½¿ç”¨ delegate å» queryï¼Œdelegate æ˜¯ SimpleExecutorã€‚é‡Œé¢ä½¿ç”¨ JDBC è¿›è¡Œæ•°æ®åº“æ“ä½œã€‚
  return this.delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);
}&lt;/code&gt;
&lt;/pre&gt;
&lt;h3 id=&quot;æ‰‹åŠ¨å®ç°ä¸€ä¸ªç®€å•çš„-mybatis&quot;&gt;æ‰‹åŠ¨å®ç°ä¸€ä¸ªç®€å•çš„ MyBatis&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2019/6/15/16b5af919c30d430?w=813&amp;amp;h=454&amp;amp;f=png&amp;amp;s=16522&quot;/&gt;&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;åˆ›å»º SqlSessionFactory å®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;å®ä¾‹åŒ–è¿‡ç¨‹ï¼ŒåŠ è½½é…ç½®æ–‡ä»¶åˆ›å»º Configuration å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ factory åˆ›å»º SqlSessionã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ SqlSession è·å– mapper æ¥å£åŠ¨æ€ä»£ç†ã€‚&lt;/li&gt;
&lt;li&gt;åŠ¨æ€ä»£ç†å›è°ƒ SqlSession ä¸­æŸæŸ¥è¯¢æ–¹æ³•ã€‚&lt;/li&gt;
&lt;li&gt;SqlSession å°†æŸ¥è¯¢æ–¹æ³•è½¬å‘ç»™ Executorã€‚&lt;/li&gt;
&lt;li&gt;Executor åŸºäº JDBC è®¿é—®æ•°æ®åº“è·å–æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;Executor é€šè¿‡åå°„å°†æ•°æ®è½¬æ¢æˆ POJOå¹¶è¿”å›ç»™ SqlSessionã€‚&lt;/li&gt;
&lt;li&gt;å°†æ•°æ®è¿”å›ç»™è°ƒç”¨è€…ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;é¡¹ç›®æ•´ä½“ä½¿ç”¨ Maven æ„å»ºï¼Œmybatis-demo æ˜¯è„±ç¦» Spring çš„ MyBatis ä½¿ç”¨çš„ä¾‹å­ã€‚paul-mybatis æ˜¯æˆ‘ä»¬è‡ªå·±å®ç°çš„ mybatis æ¡†æ¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://user-gold-cdn.xitu.io/2019/6/15/16b5afb9e8fc79de?w=688&amp;amp;h=1208&amp;amp;f=png&amp;amp;s=133402&quot;/&gt;&lt;/p&gt;
&lt;ul readability=&quot;49.5&quot;&gt;&lt;li readability=&quot;21&quot;&gt;
&lt;p&gt;é¦–å…ˆæŒ‰ç…§æˆ‘ä»¬ä»¥å‰çš„ä½¿ç”¨ mybatis ä»£ç æ—¶çš„æµç¨‹ï¼Œåˆ›å»º mapper æ¥å£ï¼Œxml æ–‡ä»¶ï¼Œå’Œ POJOä»¥åŠé›†ä¸€äº›é…ç½®æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;æ¥å£ï¼šTUserMapper&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;  package com.paul.mybatis.mapper;

  import com.paul.mybatis.entity.TUser;

  import java.util.List;

  public interface TUserMapper {

      TUser selectByPrimaryKey(Integer id);

      List&amp;lt;TUser&amp;gt; selectAll();
  }&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;xml æ–‡ä»¶&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;  &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&amp;gt;
  &amp;lt;!DOCTYPE mapper
          PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
          &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&amp;gt;
  &amp;lt;mapper namespace=&quot;com.paul.mybatis.mapper.TUserMapper&quot;&amp;gt;

      &amp;lt;select id=&quot;selectByPrimaryKey&quot; resultType=&quot;TUser&quot;&amp;gt;
          select *
          from t_user
          where id = #{id,jdbcType=INTEGER}
      &amp;lt;/select&amp;gt;

      &amp;lt;select id=&quot;selectAll&quot; resultType=&quot;TUser&quot;&amp;gt;
          select *
          from t_user
      &amp;lt;/select&amp;gt;

  &amp;lt;/mapper&amp;gt;&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;å®ä½“ç±»ï¼Œå±æ€§åº”è¯¥ä¸æ•°æ®åº“æƒ³åŒ¹é…&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;  package com.paul.mybatis.entity;

  public class TUser {

  private Integer id;

  private String userName;

  private String realName;

  private Byte sex;

  private String mobile;

  public Integer getId() {
      return id;
  }

  public void setId(Integer id) {
      this.id = id;
  }

  public String getUserName() {
      return userName;
  }

  public void setUserName(String userName) {
      this.userName = userName;
  }

  public String getRealName() {
      return realName;
  }

  public void setRealName(String realName) {
      this.realName = realName;
  }

  public Byte getSex() {
      return sex;
  }

  public void setSex(Byte sex) {
      this.sex = sex;
  }

  public String getMobile() {
      return mobile;
  }

  public void setMobile(String mobile) {
      this.mobile = mobile;
  }
  }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;æ•°æ®åº“è¿æ¥é…ç½®æ–‡ä»¶ï¼Œdb.properties&lt;/p&gt;
&lt;pre class=&quot;xml&quot;&gt;
&lt;code&gt;  jdbc.driver=com.mysql.jdbc.Driver
  jdbc.url=jdbc:mysql://localhost:3306/mybatis?useUnicode=true&amp;amp;characterEncoding=utf8
  jdbc.username=root
  jdbc.password=root&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;5&quot;&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬æ¥å…³æ³¨ xml æ–‡ä»¶ï¼Œmapper æ–‡ä»¶é‡Œçš„ namespaceï¼Œidï¼ŒresultType å’Œ sql è¯­å¥éƒ½è¦å­˜å‚¨èµ·æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª POJO æ¥å­˜å‚¨è¿™äº›ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;  package com.paul.mybatis.confiuration;


  /**
  *
  * XML ä¸­çš„ sql é…ç½®ä¿¡æ¯åŠ è½½åˆ°è¿™ä¸ªç±»ä¸­
  *
  */
  public class MappedStatement {

  private String namespace;

  private String id;

  private String resultType;

  private String sql;

  public String getNamespace() {
      return namespace;
  }

  public void setNamespace(String namespace) {
      this.namespace = namespace;
  }

  public String getId() {
      return id;
  }

  public void setId(String id) {
      this.id = id;
  }

  public String getResultType() {
      return resultType;
  }

  public void setResultType(String resultType) {
      this.resultType = resultType;
  }

  public String getSql() {
      return sql;
  }

  public void setSql(String sql) {
      this.sql = sql;
  }
  }
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;8&quot;&gt;
&lt;p&gt;ä¸‹é¢æ¥åˆ›å»ºä¸€ä¸ª Configuration ç±»ï¼Œç”¨æ¥ä¿å­˜æ‰€æœ‰é…ç½®æ–‡ä»¶å’Œ xml æ–‡ä»¶é‡Œçš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;  package com.paul.mybatis.confiuration;

  import java.util.HashMap;
  import java.util.List;
  import java.util.Map;

  /**
  *
  * æ‰€æœ‰çš„é…ç½®ä¿¡æ¯
  *
  */
  public class Configuration {

  private String jdbcDriver;

  private String jdbcUrl;

  private String jdbcPassword;

  private String jdbcUsername;

  private Map&amp;lt;String,MappedStatement&amp;gt; mappedStatement = new HashMap&amp;lt;&amp;gt;();

  public Map&amp;lt;String, MappedStatement&amp;gt; getMappedStatement() {
      return mappedStatement;
  }

  public void setMappedStatement(Map&amp;lt;String, MappedStatement&amp;gt; mappedStatement) {
      this.mappedStatement = mappedStatement;
  }

  public String getJdbcDriver() {
      return jdbcDriver;
  }

  public void setJdbcDriver(String jdbcDriver) {
      this.jdbcDriver = jdbcDriver;
  }

  public String getJdbcUrl() {
      return jdbcUrl;
  }

  public void setJdbcUrl(String jdbcUrl) {
      this.jdbcUrl = jdbcUrl;
  }

  public String getJdbcPassword() {
      return jdbcPassword;
  }

  public void setJdbcPassword(String jdbcPassword) {
      this.jdbcPassword = jdbcPassword;
  }

  public String getJdbcUsername() {
      return jdbcUsername;
  }

  public void setJdbcUsername(String jdbcUsername) {
      this.jdbcUsername = jdbcUsername;
  }
  }
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;15&quot;&gt;
&lt;p&gt;æœ‰äº†é…ç½®ç±»ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªé…ç½®ç±»æ„å»ºä¸€ä¸ª SqlSessionFactory äº†ã€‚&lt;br/&gt;SqlSessionFactory æŠ½è±¡æ¨¡ç‰ˆ&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;  package com.paul.mybatis.factory;

  import com.paul.mybatis.sqlsession.SqlSession;

  public interface SqlSessionFactory {

      SqlSession openSession();
  }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Default å®ç°ç±»ä¸»è¦å®Œæˆäº†ä¸¤ä¸ªåŠŸèƒ½ï¼ŒåŠ è½½é…ç½®ä¿¡æ¯åˆ° Configuration å¯¹è±¡é‡Œï¼Œå®ç°åˆ›å»º SqlSession çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;  package com.paul.mybatis.factory;

  import com.paul.mybatis.confiuration.Configuration;
  import com.paul.mybatis.confiuration.MappedStatement;
  import com.paul.mybatis.sqlsession.DefaultSqlSession;
  import com.paul.mybatis.sqlsession.SqlSession;
  import org.dom4j.Document;
  import org.dom4j.DocumentException;
  import org.dom4j.Element;
  import org.dom4j.io.SAXReader;

  import java.io.File;
  import java.io.IOException;
  import java.io.InputStream;
  import java.net.URL;
  import java.util.ArrayList;
  import java.util.List;
  import java.util.Properties;

  /**
   *
   * 1.åˆå§‹åŒ–æ—¶å°±å®Œæˆäº† configuration çš„å®ä¾‹åŒ–
   * 2.å·¥å‚ç±»ï¼Œç”Ÿæˆ sqlSession
   *
   */
  public class DefaultSqlSessionFactory implements SqlSessionFactory{

      //å¸Œæœ›Configuration æ˜¯å•ä¾‹å­å¹¶ä¸”å”¯ä¸€çš„
      private final Configuration configuration = new Configuration();

      // xml æ–‡ä»¶å­˜æ”¾çš„ä½ç½®
      private static final String MAPPER_CONFIG_LOCATION = &quot;mappers&quot;;

      // æ•°æ®åº“ä¿¡æ¯å­˜æ”¾çš„ä½ç½®
      private static final String DB_CONFIG_FILE = &quot;db.properties&quot;;


      public DefaultSqlSessionFactory() {
          loadDBInfo();
          loadMapperInfo();
      }

      private void loadDBInfo() {
          InputStream db = this.getClass().getClassLoader().getResourceAsStream(DB_CONFIG_FILE);
          Properties p = new Properties();

          try {
              p.load(db);
          } catch (IOException e) {
              e.printStackTrace();
          }
          //å°†é…ç½®ä¿¡æ¯å†™å…¥Configuration å¯¹è±¡
          configuration.setJdbcDriver(p.get(&quot;jdbc.driver&quot;).toString());
          configuration.setJdbcUrl(p.get(&quot;jdbc.url&quot;).toString());
          configuration.setJdbcUsername(p.get(&quot;jdbc.username&quot;).toString());
          configuration.setJdbcPassword(p.get(&quot;jdbc.password&quot;).toString());

      }

      //è§£æå¹¶åŠ è½½xmlæ–‡ä»¶
      private void loadMapperInfo(){
          URL resources = null;
          resources = this.getClass().getClassLoader().getResource(MAPPER_CONFIG_LOCATION);
          File mappers = new File(resources.getFile());
          //è¯»å–æ–‡ä»¶å¤¹ä¸‹é¢çš„æ–‡ä»¶ä¿¡æ¯
          if(mappers.isDirectory()){
              File[] files = mappers.listFiles();
              for(File file:files){
                  loadMapperInfo(file);
              }
          }
      }

      private void loadMapperInfo(File file){
          SAXReader reader = new SAXReader();
          //é€šè¿‡readæ–¹æ³•è¯»å–ä¸€ä¸ªæ–‡ä»¶è½¬æ¢æˆDocument å¯¹è±¡
          Document document = null;
          try {
              document = reader.read(file);
          } catch (DocumentException e) {
              e.printStackTrace();
          }
          //è·å–æ ¹ç»“ç‚¹å…ƒç´ å¯¹è±¡&amp;lt;mapper&amp;gt;
          Element e = document.getRootElement();
          //è·å–å‘½åç©ºé—´namespace
          String namespace = e.attribute(&quot;namespace&quot;).getData().toString();
          //è·å–select,insert,update,deleteå­èŠ‚ç‚¹åˆ—è¡¨
          List&amp;lt;Element&amp;gt; selects = e.elements(&quot;select&quot;);
          List&amp;lt;Element&amp;gt; inserts = e.elements(&quot;select&quot;);
          List&amp;lt;Element&amp;gt; updates = e.elements(&quot;select&quot;);
          List&amp;lt;Element&amp;gt; deletes = e.elements(&quot;select&quot;);

          List&amp;lt;Element&amp;gt; all = new ArrayList&amp;lt;&amp;gt;();
          all.addAll(selects);
          all.addAll(inserts);
          all.addAll(updates);
          all.addAll(deletes);

          //éå†èŠ‚ç‚¹ï¼Œç»„è£…æˆ MappedStatement ç„¶åæ”¾å…¥åˆ°configuration å¯¹è±¡ä¸­
          for(Element ele:all){
              MappedStatement mappedStatement = new MappedStatement();
              String id = ele.attribute(&quot;id&quot;).getData().toString();
              String resultType = ele.attribute(&quot;resultType&quot;).getData().toString();
              String sql = ele.getData().toString();

              mappedStatement.setId(namespace+&quot;.&quot;+id);
              mappedStatement.setResultType(resultType);
              mappedStatement.setNamespace(namespace);
              mappedStatement.setSql(sql);

              configuration.getMappedStatement().put(namespace+&quot;.&quot;+id,mappedStatement);
          }
      }

      @Override
      public SqlSession openSession() {
          return new DefaultSqlSession(configuration);
      }
  }
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;23&quot;&gt;
&lt;p&gt;åœ¨ SqlSessionFactory é‡Œåˆ›å»ºäº† DefaultSqlSessionï¼Œæˆ‘ä»¬çœ‹çœ‹å®ƒçš„å…·ä½“å®ç°ã€‚SqlSessioné‡Œé¢åº”è¯¥å°è£…äº†æ‰€æœ‰æ•°æ®åº“çš„å…·ä½“æ“ä½œå’Œä¸€äº›è·å– mapper å®ç°ç±»çš„æ–¹æ³•ã€‚ä½¿ç”¨åŠ¨æ€ä»£ç†ç”Ÿæˆä¸€ä¸ªåŠ å¼ºç±»ã€‚è¿™é‡Œé¢æœ€ç»ˆè¿˜æ˜¯æŠŠæ•°æ®åº“çš„ç›¸å…³æ“ä½œè½¬ç»™ SqlSessionï¼Œä½¿ç”¨ mapper èƒ½ä½¿ç¼–ç¨‹æ›´åŠ ä¼˜é›…ã€‚&lt;br/&gt;SqlSession æ¥å£ï¼Œå®šä¹‰æ¨¡ç‰ˆæ–¹æ³•&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;  package com.paul.mybatis.sqlsession;

  import java.util.List;

  /**
   *
   * å°è£…äº†æ‰€æœ‰æ•°æ®åº“çš„æ“ä½œ
   * æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯åŸºäº Excutor æ¥å®ç°çš„ï¼ŒExecutor å°è£…äº† JDBC æ“ä½œ
   *
   *
   */
  public interface SqlSession {

      /**
       * æ ¹æ®ä¼ å…¥çš„æ¡ä»¶æŸ¥è¯¢å•ä¸€ç»“æœ
       * @param statement  æ–¹æ³•å¯¹åº” sql è¯­å¥ï¼Œnamespace+id
       * @param parameter  è¦ä¼ å…¥ sql è¯­å¥ä¸­çš„æŸ¥è¯¢å‚æ•°
       * @param &amp;lt;T&amp;gt; è¿”å›æŒ‡å®šçš„ç»“æœå¯¹è±¡
       * @return
       */
      &amp;lt;T&amp;gt; T selectOne(String statement, Object parameter);

      &amp;lt;T&amp;gt; List&amp;lt;T&amp;gt; selectList(String statement, Object parameter);

      &amp;lt;T&amp;gt; T getMapper(Class&amp;lt;T&amp;gt; type);
  }
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Default çš„ SqlSession å®ç°ç±»ã€‚é‡Œé¢éœ€è¦ä¼ å…¥ Executorï¼Œè¿™ä¸ª Executor é‡Œé¢å°è£…äº† JDBC æ“ä½œæ•°æ®åº“çš„æµç¨‹ã€‚æˆ‘ä»¬é‡ç‚¹å…³æ³¨ getMapper æ–¹æ³•ã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;  package com.paul.mybatis.sqlsession;

  import com.paul.mybatis.bind.MapperProxy;
  import com.paul.mybatis.confiuration.Configuration;
  import com.paul.mybatis.confiuration.MappedStatement;
  import com.paul.mybatis.executor.Executor;
  import com.paul.mybatis.executor.SimpleExecutor;

  import java.lang.reflect.Proxy;
  import java.util.List;

  public class DefaultSqlSession implements  SqlSession {

      private final Configuration configuration;

      private Executor executor;

      public DefaultSqlSession(Configuration configuration) {
          super();
          this.configuration = configuration;
          executor = new SimpleExecutor(configuration);
      }

      @Override
      public &amp;lt;T&amp;gt; T selectOne(String statement, Object parameter) {
          List&amp;lt;T&amp;gt; selectList = this.selectList(statement,parameter);
          if(selectList == null || selectList.size() == 0){
              return null;
          }
          if(selectList.size() == 1){
              return (T) selectList.get(0);
          }else{
              throw new RuntimeException(&quot;too many result&quot;);
          }
      }

      @Override
      public &amp;lt;T&amp;gt; List&amp;lt;T&amp;gt; selectList(String statement, Object parameter) {
          MappedStatement ms = configuration.getMappedStatement().get(statement);
          return executor.query(ms,parameter);
      }

      @Override
      public &amp;lt;T&amp;gt; T getMapper(Class&amp;lt;T&amp;gt; type) {
          MapperProxy mp = new MapperProxy(this);
          //ç»™æˆ‘ä¸€ä¸ªæ¥å£ï¼Œè¿˜ä½ ä¸€ä¸ªå®ç°ç±»
          return (T)Proxy.newProxyInstance(type.getClassLoader(),new Class[]{type},mp);
      }
  }
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;8&quot;&gt;
&lt;p&gt;åŠ¨æ€ä»£ç†çš„ InvocationHandlerã€‚&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt;  package com.paul.mybatis.bind;

  import com.paul.mybatis.sqlsession.SqlSession;

  import java.lang.reflect.InvocationHandler;
  import java.lang.reflect.Method;
  import java.util.Collection;
  import java.util.Collections;

  /**
   *
   * å°†è¯·æ±‚è½¬å‘ç»™ sqlSession
   *
   */
  public class MapperProxy implements InvocationHandler {

      private SqlSession sqlSession;

      public MapperProxy(SqlSession sqlSession) {
          this.sqlSession = sqlSession;
      }

      @Override
      public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
          System.out.println(method.getDeclaringClass().getName()+&quot;.&quot;+method.getName());
          if(Collection.class.isAssignableFrom(method.getReturnType())){
              return sqlSession.selectList(method.getDeclaringClass().getName()+&quot;.&quot;+method.getName(),args==null?null:args[0]);
          }else{
              return sqlSession.selectOne(method.getDeclaringClass().getName()+&quot;.&quot;+method.getName(),args==null?null:args[0]);
          }
      }
  }
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;li readability=&quot;4&quot;&gt;
&lt;p&gt;æœ€åæ¥çœ‹æˆ‘ä»¬çš„æµ‹è¯•ç±»&lt;/p&gt;
&lt;pre class=&quot;java&quot;&gt;
&lt;code&gt; package com.paul.mybatis;

 import com.paul.mybatis.entity.TUser;
 import com.paul.mybatis.factory.DefaultSqlSessionFactory;
 import com.paul.mybatis.factory.SqlSessionFactory;
 import com.paul.mybatis.mapper.TUserMapper;
 import com.paul.mybatis.sqlsession.SqlSession;

 public class TestDemo {

     public static void main(String[] args) {
         SqlSessionFactory sqlSessionFactory = new DefaultSqlSessionFactory();

         SqlSession sqlSession = sqlSessionFactory.openSession();

         TUserMapper mapper = sqlSession.getMapper(TUserMapper.class);

         TUser user = mapper.selectByPrimaryKey(1);

         System.out.println(user.toString());
     }
 }
&lt;/code&gt;
&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;æ•´ä¸ªé¡¹ç›®çš„æºç åœ¨&lt;a href=&quot;https://github.com/PaulWang92115/Paul-MyBatis&quot;&gt;é¡¹ç›®æºç &lt;/a&gt;ï¼Œå¸Œæœ›å¤§å®¶ mark ä¸€ä¸‹ï¼Œä¸€èµ·æ”¹è¿›ã€‚&lt;/p&gt;
</description>
<pubDate>Sat, 15 Jun 2019 12:18:00 +0000</pubDate>
<dc:creator>å½“å¹´æ˜æœˆ123</dc:creator>
<og:description>MyBatis è¿è¡Œè¿‡ç¨‹ ä¼ ç»Ÿçš„ JDBC ç¼–ç¨‹æŸ¥è¯¢æ•°æ®åº“çš„ä»£ç å’Œè¿‡ç¨‹æ€»ç»“ã€‚ 1. åŠ è½½é©±åŠ¨ã€‚ 2. åˆ›å»ºè¿æ¥ï¼ŒConnection å¯¹è±¡ã€‚ 3. æ ¹æ® Connection åˆ›å»º Statement</og:description>
<dc:language>zh-cn</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.cnblogs.com/paulwang92115/p/11028715.html</dc:identifier>
</item>
</channel>
</rss>