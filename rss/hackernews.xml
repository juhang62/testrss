<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=hnrss.org%2Fnewest%3Fpoints%3D200&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://hnrss.org/newest?points=200" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dhnrss.org%252Fnewest%253Fpoints%253D200%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dhnrss.org%252Fnewest%253Fpoints%253D200%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>Hacker News: Newest</title>
<link>https://news.ycombinator.com/newest</link>
<description>Hacker News RSS</description>
<item>
<title>Help users in Iran reconnect to Signal</title>
<link>https://signal.org/blog/help-iran-reconnect/</link>
<guid isPermaLink="true" >https://signal.org/blog/help-iran-reconnect/</guid>
<description>&lt;p&gt;Just over a week ago, &lt;a href=&quot;https://twitter.com/signalapp/status/1353839763388649473&quot;&gt;we announced&lt;/a&gt; that Iranian censors had started blocking all Signal traffic in the country. As an interim solution to help people in Iran get connected again, we’ve added support in Signal for a &lt;a href=&quot;https://github.com/signalapp/Signal-TLS-Proxy&quot;&gt;simple TLS proxy&lt;/a&gt; that is easy to set up, can be used to bypass the network block, and will securely route traffic to the Signal service.&lt;/p&gt;
&lt;p&gt;This new connection method is supported in the latest Signal Android beta release, and will be rolling out to production users in a few days. Our hope is that this will help many people in Iran start sending and receiving messages again while we continue to explore additional censorship circumvention techniques that will work there.&lt;/p&gt;
&lt;h2 id=&quot;act-as-a-proxy&quot;&gt;Act as a proxy&lt;/h2&gt;
&lt;p&gt;If you want to help by running a proxy, to get started you only need the following:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;A server with ports 80 and 443 available.&lt;/li&gt;
&lt;li&gt;A domain name (or subdomain) that points to the server’s IP address.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;The proxy is extremely lightweight. An inexpensive and tiny VPS can easily handle hundreds of concurrent users. Here’s how to make it work:&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;SSH into the server.&lt;/li&gt;
&lt;li&gt;Install Docker, Docker Compose, and git:
&lt;ul&gt;&lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo apt update &amp;amp;&amp;amp; sudo apt install docker docker-compose git&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Clone the Signal TLS Proxy repository:
&lt;ul&gt;&lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;git clone https://github.com/signalapp/Signal-TLS-Proxy.git&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Enter the repo directory:
&lt;ul&gt;&lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;cd Signal-TLS-Proxy&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Run the helper script that configures and provisions a TLS certificate from &lt;a href=&quot;https://letsencrypt.org/&quot;&gt;Let’s Encrypt&lt;/a&gt;:
&lt;ul&gt;&lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo ./init-certificate.sh&lt;/code&gt;
&lt;ul&gt;&lt;li&gt;You will be prompted to enter the domain or subdomain that is pointing to this server’s IP address.&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Use Docker Compose to launch the proxy:
&lt;ul&gt;&lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sudo docker-compose up --detach&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;Your proxy is now running! You can share your proxy with friends and family using this URL format: &lt;code class=&quot;highlighter-rouge&quot;&gt;https://signal.tube/#&amp;lt;your_domain_name&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The latest beta release of the Android app is registered to handle links from &lt;code class=&quot;highlighter-rouge&quot;&gt;signal.tube&lt;/code&gt;. The app can automatically configure proxy support when you tap on a link from any other app. This step happens before any web request is made, so even if a censor tries to block that domain it won’t accomplish anything.&lt;/p&gt;
&lt;p&gt;You can also manually configure proxy information in your Signal Settings too.&lt;/p&gt;
&lt;h2 id=&quot;an-unorthodox-y-proxy&quot;&gt;An unorthodox-y proxy&lt;/h2&gt;
&lt;p&gt;Unlike a standard HTTP proxy, connections to the Signal TLS Proxy look just like regular encrypted web traffic. There’s no &lt;code class=&quot;highlighter-rouge&quot;&gt;CONNECT&lt;/code&gt; method in a plaintext request to reveal to censors that a proxy is being used. Valid TLS certificates are provisioned for every proxy server, making it more difficult for censors to fingerprint the traffic than it would be if static self-signed certificates were used instead. In short, everything is designed to blend into the background as much as possible.&lt;/p&gt;
&lt;p&gt;The Signal client establishes a normal TLS connection with the proxy, and the proxy simply forwards any bytes it receives to the actual Signal service. Any non-Signal traffic is blocked. Additionally, the Signal client still negotiates its standard TLS connection with the Signal endpoints through the tunnel.&lt;/p&gt;
&lt;p&gt;This means that in addition to the end-to-end encryption that protects everything in Signal, all traffic remains opaque to the proxy operator.&lt;/p&gt;
&lt;h2 id=&quot;iranasignalproxy&quot;&gt;#IRanASignalProxy&lt;/h2&gt;
&lt;p&gt;If you set up a Signal Proxy and you want to let the world know, you can use the hashtag #IRanASignalProxy.&lt;/p&gt;
&lt;p&gt;When you publicly post a &lt;code class=&quot;highlighter-rouge&quot;&gt;signal.tube&lt;/code&gt; link, or if a particular server becomes too popular, it increases the chance that Iranian censors will simply add those IPs to their block list.&lt;/p&gt;
&lt;p&gt;A more discreet approach would be to only send the link via a DM or a non-public message. You can post something like this on your favorite social network:&lt;/p&gt;
&lt;p&gt;&lt;em&gt;#IRanASignalProxy Reply to this thread if you want the connection details, and follow me so I can DM you the link.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Although it’s easy to launch new proxies if one gets blocked, we want to do everything we can to make things as difficult for Iranian censors as possible. As long as there are servers in the world, there is no limit to the number of Signal TLS Proxies that people can run.&lt;/p&gt;
&lt;h2 id=&quot;only-the-start-of-the-proxy-battle&quot;&gt;Only the start of the proxy battle&lt;/h2&gt;
&lt;p&gt;We hope that organizations and individuals will step up to run Signal TLS Proxy servers for Iranian users and help coordinate their distribution. We’re also continuing to investigate other techniques that are more automated and convenient.&lt;/p&gt;
&lt;p&gt;Iranian people deserve privacy. We hope this helps.&lt;/p&gt;
&lt;div class=&quot;social-sharing has-text-centered&quot;&gt;

&lt;p&gt;&lt;a href=&quot;https://twitter.com/intent/tweet?text=Help%20users%20in%20Iran%20reconnect%20to%20Signal&amp;amp;url=https://signal.org/blog/help-iran-reconnect/&amp;amp;via=signalapp&amp;amp;related=signalapp&quot; title=&quot;Share on Twitter&quot; target=&quot;_blank&quot; class=&quot;btn btn-twitter&quot;&gt;Tweet&lt;/a&gt; &lt;a href=&quot;https://facebook.com/sharer.php?u=https://signal.org/blog/help-iran-reconnect/&quot; rel=&quot;nofollow&quot; title=&quot;Share on Facebook&quot; target=&quot;_blank&quot; class=&quot;btn btn-facebook&quot;&gt; Facebook&lt;/a&gt;&lt;/p&gt;
&lt;h3 class=&quot;semibold&quot;&gt;Want to get involved with Signal? &lt;a href=&quot;https://signal.org/workworkwork/&quot;&gt;We're hiring!&lt;/a&gt;&lt;/h3&gt;
&lt;/div&gt;
</description>
<pubDate>Thu, 04 Feb 2021 16:42:19 +0000</pubDate>
<dc:creator>arkadiyt</dc:creator>
<og:title>Help users in Iran reconnect to Signal</og:title>
<og:type>website</og:type>
<og:description>Just over a week ago, we announced that Iranian censors had started blocking all Signal traffic in the country. As an interim solution to help people in Iran get connected again, we’ve added support in Signal for a simple TLS proxy that is easy to set up, can be used to bypass the network block, ...</og:description>
<og:url>https://signal.org/blog/help-iran-reconnect/</og:url>
<og:image>https://signal.org/assets/og/og-image-ff2096df535eee499356de64b19fa8cebb9681ab1e78cca7330e7f8b8d5ec6d5.png</og:image>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://signal.org/blog/help-iran-reconnect/</dc:identifier>
</item>
<item>
<title>Native Mac APIs for Go</title>
<link>https://github.com/progrium/macdriver</link>
<guid isPermaLink="true" >https://github.com/progrium/macdriver</guid>
<description>&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://github.com/progrium/macdriver/raw/main/macdriver.gif&quot;&gt;&lt;img src=&quot;https://github.com/progrium/macdriver/raw/main/macdriver.gif&quot; alt=&quot;MacDriver Logo&quot;/&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;Native Mac APIs for Golang!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://godoc.org/github.com/progrium/macdriver&quot; rel=&quot;nofollow&quot;&gt;&lt;img src=&quot;https://camo.githubusercontent.com/7a3e5f0a6e08d3de18e6866fb59fa2f28482a77f91667d8ab9496205b34a1a40/68747470733a2f2f676f646f632e6f72672f6769746875622e636f6d2f70726f677269756d2f6d61636472697665723f7374617475732e737667&quot; alt=&quot;GoDoc&quot; data-canonical-src=&quot;https://godoc.org/github.com/progrium/macdriver?status.svg&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://github.com/progrium/macdriver/actions?workflow=test&quot;&gt;&lt;img alt=&quot;Test workflow&quot; src=&quot;https://camo.githubusercontent.com/e8791ef0aeff81645688368a60490e0a981d7a80348d2068b876687778730848/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f776f726b666c6f772f7374617475732f70726f677269756d2f6d61636472697665722f546573743f6c6162656c3d74657374266c6f676f3d676974687562267374796c653d666c61742d737175617265&quot; data-canonical-src=&quot;https://img.shields.io/github/workflow/status/progrium/macdriver/Test?label=test&amp;amp;logo=github&amp;amp;style=flat-square&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://goreportcard.com/report/github.com/progrium/macdriver&quot; rel=&quot;nofollow&quot;&gt;&lt;img src=&quot;https://camo.githubusercontent.com/521175bd21fb3448bdef265c7e50f8451ca2e30bf9af5ae79fcde9e77bd1c851/68747470733a2f2f676f7265706f7274636172642e636f6d2f62616467652f6769746875622e636f6d2f70726f677269756d2f6d6163647269766572&quot; alt=&quot;Go Report Card&quot; data-canonical-src=&quot;https://goreportcard.com/badge/github.com/progrium/macdriver&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://twitter.com/progriumHQ&quot; title=&quot;@progriumHQ on Twitter&quot; rel=&quot;nofollow&quot;&gt;&lt;img src=&quot;https://camo.githubusercontent.com/de69da2efaa1834c6a01715678b4c28036ed7d61fa96cb1400b0b7986e548d44/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f747769747465722d4070726f677269756d48512d3535616365652e737667&quot; alt=&quot;@progriumHQ on Twitter&quot; data-canonical-src=&quot;https://img.shields.io/badge/twitter-@progriumHQ-55acee.svg&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://github.com/progrium/macdriver/discussions&quot; title=&quot;Project Forum&quot;&gt;&lt;img src=&quot;https://camo.githubusercontent.com/59768d01719f82c5bba89a6b5909aaf59dc15b5d9eda1bee654c43f04f04dbb9/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f636f6d6d756e6974792d666f72756d2d6666363962342e737667&quot; alt=&quot;Project Forum&quot; data-canonical-src=&quot;https://img.shields.io/badge/community-forum-ff69b4.svg&quot;/&gt;&lt;/a&gt; &lt;a href=&quot;https://github.com/sponsors/progrium&quot; title=&quot;Sponsor Project&quot;&gt;&lt;img src=&quot;https://camo.githubusercontent.com/79f3a13908a59c060535f6be0a092fe8f295d07df126c7484e2bea045d830745/68747470733a2f2f696d672e736869656c64732e696f2f7374617469632f76313f6c6162656c3d73706f6e736f72266d6573736167653d254532253944254134266c6f676f3d476974487562&quot; alt=&quot;Sponsor Project&quot; data-canonical-src=&quot;https://img.shields.io/static/v1?label=sponsor&amp;amp;message=%E2%9D%A4&amp;amp;logo=GitHub&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;hr/&gt;&lt;p&gt;MacDriver is a toolkit for working with Apple/Mac APIs and frameworks in Go. It currently has 3 &quot;layers&quot;:&lt;/p&gt;
&lt;h2&gt;1. Bindings for Objective-C&lt;/h2&gt;
&lt;p&gt;The &lt;code&gt;objc&lt;/code&gt; package wraps the &lt;a href=&quot;https://developer.apple.com/documentation/objectivec/objective-c_runtime?language=objc&quot; rel=&quot;nofollow&quot;&gt;Objective-C runtime&lt;/a&gt; to dynamically interact with Objective-C objects and classes:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-go&quot; readability=&quot;13&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-s1&quot;&gt;cls&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;pl-s1&quot;&gt;objc&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;NewClass&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&quot;AppDelegate&quot;&lt;/span&gt;, &lt;span class=&quot;pl-s&quot;&gt;&quot;NSObject&quot;&lt;/span&gt;)
&lt;span class=&quot;pl-s1&quot;&gt;cls&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;AddMethod&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&quot;applicationDidFinishLaunching:&quot;&lt;/span&gt;, &lt;span class=&quot;pl-k&quot;&gt;func&lt;/span&gt;(&lt;span class=&quot;pl-s1&quot;&gt;app&lt;/span&gt; objc.&lt;span class=&quot;pl-smi&quot;&gt;Object&lt;/span&gt;) {
        &lt;span class=&quot;pl-s1&quot;&gt;fmt&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Println&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&quot;Launched!&quot;&lt;/span&gt;)
})
&lt;span class=&quot;pl-s1&quot;&gt;objc&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;RegisterClass&lt;/span&gt;(&lt;span class=&quot;pl-s1&quot;&gt;cls&lt;/span&gt;)

&lt;span class=&quot;pl-s1&quot;&gt;delegate&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;pl-s1&quot;&gt;objc&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Get&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&quot;AppDelegate&quot;&lt;/span&gt;).&lt;span class=&quot;pl-en&quot;&gt;Alloc&lt;/span&gt;().&lt;span class=&quot;pl-en&quot;&gt;Init&lt;/span&gt;()
&lt;span class=&quot;pl-s1&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;pl-s1&quot;&gt;objc&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Get&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&quot;NSApplication&quot;&lt;/span&gt;).&lt;span class=&quot;pl-en&quot;&gt;Get&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&quot;sharedApplication&quot;&lt;/span&gt;)
&lt;span class=&quot;pl-s1&quot;&gt;app&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Set&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&quot;delegate:&quot;&lt;/span&gt;, &lt;span class=&quot;pl-s1&quot;&gt;delegate&lt;/span&gt;)
&lt;span class=&quot;pl-s1&quot;&gt;app&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Send&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&quot;run&quot;&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;&lt;li&gt;Access any class or method you can access in Objective-C&lt;/li&gt;
&lt;li&gt;Common object convenience methods: Get, Set, Alloc, Init, ...&lt;/li&gt;
&lt;li&gt;Create and extend classes at runtime that can be used by Objective-C code&lt;/li&gt;
&lt;li&gt;Retain and Release methods for working with Objective-C memory management&lt;/li&gt;
&lt;/ul&gt;&lt;h2&gt;2. Framework Packages&lt;/h2&gt;
&lt;p&gt;The &lt;code&gt;cocoa&lt;/code&gt;, &lt;code&gt;webkit&lt;/code&gt;, and &lt;code&gt;core&lt;/code&gt; packages wrap &lt;code&gt;objc&lt;/code&gt; with wrapper types for parts of the Apple/Mac APIs. They're being added to as needed by hand until we can automate this process with schema data. These packages effectively let you use Apple APIs as if they were native Go libraries, letting you write Mac applications (potentially also iOS, watchOS, etc) as Go applications:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-go&quot; readability=&quot;20&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;main&lt;/span&gt;() {
        &lt;span class=&quot;pl-s1&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;pl-s1&quot;&gt;cocoa&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;NSApp_WithDidLaunch&lt;/span&gt;(&lt;span class=&quot;pl-k&quot;&gt;func&lt;/span&gt;(&lt;span class=&quot;pl-s1&quot;&gt;notification&lt;/span&gt; objc.&lt;span class=&quot;pl-smi&quot;&gt;Object&lt;/span&gt;) {
                &lt;span class=&quot;pl-s1&quot;&gt;config&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;pl-s1&quot;&gt;webkit&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;WKWebViewConfiguration_New&lt;/span&gt;()
                &lt;span class=&quot;pl-s1&quot;&gt;wv&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;pl-s1&quot;&gt;webkit&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;WKWebView_Init&lt;/span&gt;(&lt;span class=&quot;pl-s1&quot;&gt;core&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Rect&lt;/span&gt;(&lt;span class=&quot;pl-c1&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;1440&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;900&lt;/span&gt;), &lt;span class=&quot;pl-s1&quot;&gt;config&lt;/span&gt;)
                &lt;span class=&quot;pl-s1&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;pl-s1&quot;&gt;core&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;URL&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&quot;http://progrium.com&quot;&lt;/span&gt;)
                &lt;span class=&quot;pl-s1&quot;&gt;req&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;pl-s1&quot;&gt;core&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;NSURLRequest_Init&lt;/span&gt;(&lt;span class=&quot;pl-s1&quot;&gt;url&lt;/span&gt;)
                &lt;span class=&quot;pl-s1&quot;&gt;wv&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;LoadRequest&lt;/span&gt;(&lt;span class=&quot;pl-s1&quot;&gt;req&lt;/span&gt;)

                &lt;span class=&quot;pl-s1&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;pl-s1&quot;&gt;cocoa&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;NSWindow_Init&lt;/span&gt;(&lt;span class=&quot;pl-s1&quot;&gt;core&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Rect&lt;/span&gt;(&lt;span class=&quot;pl-c1&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;1440&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;900&lt;/span&gt;),
                        &lt;span class=&quot;pl-s1&quot;&gt;cocoa&lt;/span&gt;.&lt;span class=&quot;pl-c1&quot;&gt;NSClosableWindowMask&lt;/span&gt;&lt;span class=&quot;pl-c1&quot;&gt;|&lt;/span&gt;
                                &lt;span class=&quot;pl-s1&quot;&gt;cocoa&lt;/span&gt;.&lt;span class=&quot;pl-c1&quot;&gt;NSTitledWindowMask&lt;/span&gt;,
                        &lt;span class=&quot;pl-s1&quot;&gt;cocoa&lt;/span&gt;.&lt;span class=&quot;pl-c1&quot;&gt;NSBackingStoreBuffered&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;false&lt;/span&gt;)
                &lt;span class=&quot;pl-s1&quot;&gt;w&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;SetContentView&lt;/span&gt;(&lt;span class=&quot;pl-s1&quot;&gt;wv&lt;/span&gt;)
                &lt;span class=&quot;pl-s1&quot;&gt;w&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;MakeKeyAndOrderFront&lt;/span&gt;(&lt;span class=&quot;pl-s1&quot;&gt;w&lt;/span&gt;)
                &lt;span class=&quot;pl-s1&quot;&gt;w&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Center&lt;/span&gt;()
        })
        &lt;span class=&quot;pl-s1&quot;&gt;app&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;SetActivationPolicy&lt;/span&gt;(&lt;span class=&quot;pl-s1&quot;&gt;cocoa&lt;/span&gt;.&lt;span class=&quot;pl-c1&quot;&gt;NSApplicationActivationPolicyRegular&lt;/span&gt;)
        &lt;span class=&quot;pl-s1&quot;&gt;app&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;ActivateIgnoringOtherApps&lt;/span&gt;(&lt;span class=&quot;pl-c1&quot;&gt;true&lt;/span&gt;)
        &lt;span class=&quot;pl-s1&quot;&gt;app&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Run&lt;/span&gt;()
}
&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;&lt;li&gt;1:1 mapping of API names with Objective-C APIs&lt;/li&gt;
&lt;li&gt;Cocoa types: NSApplication, NSImage, NSMenu, NSWindow, more ...&lt;/li&gt;
&lt;li&gt;Webkit types: WKWebView and configuration classes&lt;/li&gt;
&lt;li&gt;Core types: NSData, NSDictionary, NSNumber, NSPoint, NSRect, NSSize, NSString, NSURL, more ...&lt;/li&gt;
&lt;li&gt;Core also allows dispatching Go functions in the Cocoa run loop&lt;/li&gt;
&lt;li&gt;Many constants/enums are defined&lt;/li&gt;
&lt;/ul&gt;&lt;h3&gt;Examples&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/progrium/macdriver/blob/main/examples/largetype/main.go#L1&quot;&gt;examples/largetype&lt;/a&gt; - A Contacts/Quicksilver-style Large Type utility in under 80 lines: &lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://camo.githubusercontent.com/707db8e6d47c31ed90f0a65aeea1b805c718b1c18a2cd61b94e1ebb932b091af/68747470733a2f2f7062732e7477696d672e636f6d2f6d656469612f4571616f4f324d584941454a4e4b323f666f726d61743d6a7067266e616d653d6c61726765&quot;&gt;&lt;img src=&quot;https://camo.githubusercontent.com/707db8e6d47c31ed90f0a65aeea1b805c718b1c18a2cd61b94e1ebb932b091af/68747470733a2f2f7062732e7477696d672e636f6d2f6d656469612f4571616f4f324d584941454a4e4b323f666f726d61743d6a7067266e616d653d6c61726765&quot; alt=&quot;largetype screenshot&quot; data-canonical-src=&quot;https://pbs.twimg.com/media/EqaoO2MXIAEJNK2?format=jpg&amp;amp;name=large&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/progrium/macdriver/blob/main/examples/pomodoro/main.go#L1&quot;&gt;examples/pomodoro&lt;/a&gt; - A menu bar pomodoro timer in under 80 lines: &lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://github.com/progrium/macdriver/blob/main/examples/pomodoro/pomodoro.gif?raw=true&quot;&gt;&lt;img src=&quot;https://github.com/progrium/macdriver/raw/main/examples/pomodoro/pomodoro.gif?raw=true&quot; alt=&quot;pomodoro gif&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/progrium/macdriver/blob/main/examples/_topframe/main.go#L1&quot;&gt;examples/topframe&lt;/a&gt; - A non-interactive, always-on-top webview with transparent background in 120 lines so you can draw on your screen with HTML/JS: &lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://camo.githubusercontent.com/dd24a8e100964d5f9241e6be5a21cd9469bbc5fbbf26af691ea5f0f71dbb1d6d/68747470733a2f2f7062732e7477696d672e636f6d2f6d656469612f45716859446d6c573841454243362d3f666f726d61743d6a7067266e616d653d6c61726765&quot;&gt;&lt;img src=&quot;https://camo.githubusercontent.com/dd24a8e100964d5f9241e6be5a21cd9469bbc5fbbf26af691ea5f0f71dbb1d6d/68747470733a2f2f7062732e7477696d672e636f6d2f6d656469612f45716859446d6c573841454243362d3f666f726d61743d6a7067266e616d653d6c61726765&quot; alt=&quot;topframe screenshot&quot; data-canonical-src=&quot;https://pbs.twimg.com/media/EqhYDmlW8AEBC6-?format=jpg&amp;amp;name=large&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;blockquote readability=&quot;4.1333333333333&quot;&gt;
&lt;p&gt;Note: topframe currently relies on &lt;a href=&quot;https://github.com/golang/go/issues/41191&quot;&gt;embed&lt;/a&gt; which you can use with go &lt;a href=&quot;https://golang.org/dl/#unstable&quot; rel=&quot;nofollow&quot;&gt;1.16beta&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;3. Bridge System&lt;/h2&gt;
&lt;p&gt;Lastly, a common case for this toolkit is not just building full native apps, but integrating Go applications with Mac systems, like windows, native menus, status icons (systray), etc. One-off libraries for some of these exist, but besides often limiting what you can do, they're also just not composable. They all want to own the main thread!&lt;/p&gt;
&lt;p&gt;For this and other reasons, we often run the above kind of code in a separate process altogether from our Go application. This might seem like a step backwards, but it is safer and more robust in a way.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;bridge&lt;/code&gt; package takes advantage of this situation to create a higher-level abstraction more aligned with a potential cross-platform toolkit. You can declaratively describe and modify structs that can be copied to the bridge process and applied to the Objective-C objects in a manner similar to configuration management:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-go&quot; readability=&quot;24&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;package&lt;/span&gt; main 

&lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; (
        &lt;span class=&quot;pl-s&quot;&gt;&quot;os&quot;&lt;/span&gt;

        &lt;span class=&quot;pl-s&quot;&gt;&quot;github.com/progrium/macdriver/bridge&quot;&lt;/span&gt;
)

&lt;span class=&quot;pl-k&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;main&lt;/span&gt;() {
        &lt;span class=&quot;pl-c&quot;&gt;// start a bridge subprocess&lt;/span&gt;
        &lt;span class=&quot;pl-s1&quot;&gt;host&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;pl-s1&quot;&gt;bridge&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;NewHost&lt;/span&gt;(&lt;span class=&quot;pl-s1&quot;&gt;os&lt;/span&gt;.&lt;span class=&quot;pl-c1&quot;&gt;Stderr&lt;/span&gt;)
        &lt;span class=&quot;pl-k&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;pl-s1&quot;&gt;host&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Run&lt;/span&gt;()

        &lt;span class=&quot;pl-c&quot;&gt;// create a window&lt;/span&gt;
        &lt;span class=&quot;pl-s1&quot;&gt;window&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;:=&lt;/span&gt; bridge.&lt;span class=&quot;pl-smi&quot;&gt;Window&lt;/span&gt;{
                &lt;span class=&quot;pl-c1&quot;&gt;Title&lt;/span&gt;:       &lt;span class=&quot;pl-s&quot;&gt;&quot;My Title&quot;&lt;/span&gt;,
                &lt;span class=&quot;pl-c1&quot;&gt;Size&lt;/span&gt;:        bridge.&lt;span class=&quot;pl-smi&quot;&gt;Size&lt;/span&gt;{&lt;span class=&quot;pl-c1&quot;&gt;W&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;480&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;H&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;240&lt;/span&gt;},
                &lt;span class=&quot;pl-c1&quot;&gt;Position&lt;/span&gt;:    bridge.&lt;span class=&quot;pl-smi&quot;&gt;Point&lt;/span&gt;{&lt;span class=&quot;pl-c1&quot;&gt;X&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;200&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;Y&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;200&lt;/span&gt;},
                &lt;span class=&quot;pl-c1&quot;&gt;Closable&lt;/span&gt;:    &lt;span class=&quot;pl-c1&quot;&gt;true&lt;/span&gt;,
                &lt;span class=&quot;pl-c1&quot;&gt;Minimizable&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;false&lt;/span&gt;,
                &lt;span class=&quot;pl-c1&quot;&gt;Resizable&lt;/span&gt;:   &lt;span class=&quot;pl-c1&quot;&gt;false&lt;/span&gt;,
                &lt;span class=&quot;pl-c1&quot;&gt;Borderless&lt;/span&gt;:  &lt;span class=&quot;pl-c1&quot;&gt;false&lt;/span&gt;,
                &lt;span class=&quot;pl-c1&quot;&gt;AlwaysOnTop&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;true&lt;/span&gt;,
                &lt;span class=&quot;pl-c1&quot;&gt;Background&lt;/span&gt;:   &lt;span class=&quot;pl-c1&quot;&gt;&amp;amp;&lt;/span&gt;bridge.&lt;span class=&quot;pl-smi&quot;&gt;Color&lt;/span&gt;{&lt;span class=&quot;pl-c1&quot;&gt;R&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;G&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;B&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;A&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;0.5&lt;/span&gt;},
        }
        &lt;span class=&quot;pl-s1&quot;&gt;host&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Sync&lt;/span&gt;(&lt;span class=&quot;pl-c1&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;pl-s1&quot;&gt;window&lt;/span&gt;)

        &lt;span class=&quot;pl-c&quot;&gt;// change its title&lt;/span&gt;
        &lt;span class=&quot;pl-s1&quot;&gt;window&lt;/span&gt;.&lt;span class=&quot;pl-c1&quot;&gt;Title&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&quot;My New Title&quot;&lt;/span&gt;
        &lt;span class=&quot;pl-s1&quot;&gt;host&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Sync&lt;/span&gt;(&lt;span class=&quot;pl-c1&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;pl-s1&quot;&gt;window&lt;/span&gt;)

        &lt;span class=&quot;pl-c&quot;&gt;// destroy the window&lt;/span&gt;
        &lt;span class=&quot;pl-s1&quot;&gt;host&lt;/span&gt;.&lt;span class=&quot;pl-en&quot;&gt;Release&lt;/span&gt;(&lt;span class=&quot;pl-c1&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;pl-s1&quot;&gt;window&lt;/span&gt;)
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is the most WIP part of the project, but once developed further we can take this API and build a bridge system with the same resources for Windows and Linux, making a cross-platform OS &quot;driver&quot;. We'll see.&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Current bridge types available:
&lt;ul&gt;&lt;li&gt;Window&lt;/li&gt;
&lt;li&gt;StatusItem (systray)&lt;/li&gt;
&lt;li&gt;Menu&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;h2&gt;Development Notes&lt;/h2&gt;
&lt;p&gt;As far as we know, due to limitations of Go modules, we often need to add &lt;code&gt;replace&lt;/code&gt; directives to our &lt;code&gt;go.mod&lt;/code&gt; during development to work against a local checkout of some dependency (like qtalk). However, these should not be versioned, so for now we encourage you to use &lt;code&gt;git update-index --skip-worktree go.mod&lt;/code&gt; on your checkout if you need to add &lt;code&gt;replace&lt;/code&gt; directives. When updates need to be checked in, &lt;code&gt;git update-index --no-skip-worktree go.mod&lt;/code&gt; can be used to reverse this on your local repo to commit changes and then re-enable.&lt;/p&gt;
&lt;h4&gt;Generating wrappers&lt;/h4&gt;
&lt;p&gt;Eventually we can generate most of the wrapper APIs using bridgesupport and/or doc schemas. However, the number of APIs is pretty ridiculous so there are lots of edge cases I wouldn't know how to automate yet. We can just continue to create them by hand as needed until we have enough coverage/confidence to know how we'd generate wrappers.&lt;/p&gt;
&lt;h2&gt;Thanks&lt;/h2&gt;
&lt;p&gt;The original &lt;code&gt;objc&lt;/code&gt; and &lt;code&gt;variadic&lt;/code&gt; packages were written by &lt;a href=&quot;https://github.com/mkrautz&quot;&gt;Mikkel Krautz&lt;/a&gt;. The &lt;code&gt;variadic&lt;/code&gt; package is some assembly magic to make everything possible since libobjc relies heavily on variadic function calls, which aren't possible out of the box in Cgo.&lt;/p&gt;
&lt;h2&gt;License&lt;/h2&gt;
&lt;p&gt;MIT&lt;/p&gt;
</description>
<pubDate>Thu, 04 Feb 2021 16:33:29 +0000</pubDate>
<dc:creator>maydemir</dc:creator>
<og:image>https://avatars.githubusercontent.com/u/647?s=400&amp;v=4</og:image>
<og:type>object</og:type>
<og:title>progrium/macdriver</og:title>
<og:url>https://github.com/progrium/macdriver</og:url>
<og:description>Native Mac APIs for Go. Contribute to progrium/macdriver development by creating an account on GitHub.</og:description>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://github.com/progrium/macdriver</dc:identifier>
</item>
<item>
<title>Rust-Analyzer Architecture</title>
<link>https://github.com/rust-analyzer/rust-analyzer/blob/master/docs/dev/architecture.md</link>
<guid isPermaLink="true" >https://github.com/rust-analyzer/rust-analyzer/blob/master/docs/dev/architecture.md</guid>
<description>&lt;p&gt;This document describes the high-level architecture of rust-analyzer. If you want to familiarize yourself with the code base, you are just in the right place!&lt;/p&gt;
&lt;p&gt;See also the &lt;a href=&quot;https://github.com/rust-analyzer/rust-analyzer/blob/master/docs/dev/guide.md&quot;&gt;guide&lt;/a&gt;, which walks through a particular snapshot of rust-analyzer code base.&lt;/p&gt;
&lt;p&gt;Yet another resource is this playlist with videos about various parts of the analyzer:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.youtube.com/playlist?list=PL85XCvVPmGQho7MZkdW-wtPtuJcFpzycE&quot; rel=&quot;nofollow&quot;&gt;https://www.youtube.com/playlist?list=PL85XCvVPmGQho7MZkdW-wtPtuJcFpzycE&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Note that the guide and videos are pretty dated, this document should be, in general, fresher.&lt;/p&gt;
&lt;p&gt;See also these implementation-related blog posts:&lt;/p&gt;
&lt;h2&gt;Bird's Eye View&lt;/h2&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://user-images.githubusercontent.com/1711539/50114578-e8a34280-0255-11e9-902c-7cfc70747966.png&quot;&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/1711539/50114578-e8a34280-0255-11e9-902c-7cfc70747966.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;On the highest level, rust-analyzer is a thing which accepts input source code from the client and produces a structured semantic model of the code.&lt;/p&gt;
&lt;p&gt;More specifically, input data consists of a set of test files (&lt;code&gt;(PathBuf, String)&lt;/code&gt; pairs) and information about project structure, captured in the so called &lt;code&gt;CrateGraph&lt;/code&gt;. The crate graph specifies which files are crate roots, which cfg flags are specified for each crate and what dependencies exist between the crates. This is the input (ground) state. The analyzer keeps all this input data in memory and never does any IO. Because the input data is source code, which typically measures in tens of megabytes at most, keeping everything in memory is OK.&lt;/p&gt;
&lt;p&gt;A &quot;structured semantic model&quot; is basically an object-oriented representation of modules, functions and types which appear in the source code. This representation is fully &quot;resolved&quot;: all expressions have types, all references are bound to declarations, etc. This is derived state.&lt;/p&gt;
&lt;p&gt;The client can submit a small delta of input data (typically, a change to a single file) and get a fresh code model which accounts for changes.&lt;/p&gt;
&lt;p&gt;The underlying engine makes sure that model is computed lazily (on-demand) and can be quickly updated for small modifications.&lt;/p&gt;
&lt;h2&gt;Code Map&lt;/h2&gt;
&lt;p&gt;This section talks briefly about various important directories and data structures. Pay attention to the &lt;strong&gt;Architecture Invariant&lt;/strong&gt; sections. They often talk about things which are deliberately absent in the source code.&lt;/p&gt;
&lt;p&gt;Note also which crates are &lt;strong&gt;API Boundaries&lt;/strong&gt;. Remember, &lt;a href=&quot;https://www.tedinski.com/2018/02/06/system-boundaries.html&quot; rel=&quot;nofollow&quot;&gt;rules at the boundary are different&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;xtask&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;This is rust-analyzer's &quot;build system&quot;. We use cargo to compile rust code, but there are also various other tasks, like release management or local installation. They are handled by Rust code in the xtask directory.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;editors/code&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;VS Code plugin.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;libs/&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;rust-analyzer independent libraries which we publish to crates.io. It's not heavily utilized at the moment.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;crates/parser&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;It is a hand-written recursive descent parser, which produces a sequence of events like &quot;start node X&quot;, &quot;finish node Y&quot;. It works similarly to &lt;a href=&quot;https://github.com/JetBrains/kotlin/blob/4d951de616b20feca92f3e9cc9679b2de9e65195/compiler/frontend/src/org/jetbrains/kotlin/parsing/KotlinParsing.java&quot;&gt;kotlin's parser&lt;/a&gt;, which is a good source of inspiration for dealing with syntax errors and incomplete input. Original &lt;a href=&quot;https://github.com/rust-lang/rust/blob/6b99adeb11313197f409b4f7c4083c2ceca8a4fe/src/libsyntax/parse/parser.rs&quot;&gt;libsyntax parser&lt;/a&gt; is what we use for the definition of the Rust language. &lt;code&gt;TreeSink&lt;/code&gt; and &lt;code&gt;TokenSource&lt;/code&gt; traits bridge the tree-agnostic parser from &lt;code&gt;grammar&lt;/code&gt; with &lt;code&gt;rowan&lt;/code&gt; trees.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; the parser is independent of the particular tree structure and particular representation of the tokens. It transforms one flat stream of events into another flat stream of events. Token independence allows us to pares out both text-based source code and &lt;code&gt;tt&lt;/code&gt;-based macro input. Tree independence allows us to more easily vary the syntax tree implementation. It should also unlock efficient light-parsing approaches. For example, you can extract the set of names defined in a file (for typo correction) without building a syntax tree.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; parsing never fails, the parser produces &lt;code&gt;(T, Vec&amp;lt;Error&amp;gt;)&lt;/code&gt; rather than &lt;code&gt;Result&amp;lt;T, Error&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;crates/syntax&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;Rust syntax tree structure and parser. See &lt;a href=&quot;https://github.com/rust-lang/rfcs/pull/2256&quot;&gt;RFC&lt;/a&gt; and &lt;a href=&quot;https://github.com/rust-analyzer/rust-analyzer/blob/master/docs/dev/syntax.md&quot;&gt;./syntax.md&lt;/a&gt; for some design notes.&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/rust-analyzer/rowan&quot;&gt;rowan&lt;/a&gt; library is used for constructing syntax trees.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ast&lt;/code&gt; provides a type safe API on top of the raw &lt;code&gt;rowan&lt;/code&gt; tree.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ungrammar&lt;/code&gt; description of the grammar, which is used to generate &lt;code&gt;syntax_kinds&lt;/code&gt; and &lt;code&gt;ast&lt;/code&gt; modules, using &lt;code&gt;cargo xtask codegen&lt;/code&gt; command.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;Tests for ra_syntax are mostly data-driven. &lt;code&gt;test_data/parser&lt;/code&gt; contains subdirectories with a bunch of &lt;code&gt;.rs&lt;/code&gt; (test vectors) and &lt;code&gt;.txt&lt;/code&gt; files with corresponding syntax trees. During testing, we check &lt;code&gt;.rs&lt;/code&gt; against &lt;code&gt;.txt&lt;/code&gt;. If the &lt;code&gt;.txt&lt;/code&gt; file is missing, it is created (this is how you update tests). Additionally, running &lt;code&gt;cargo xtask codegen&lt;/code&gt; will walk the grammar module and collect all &lt;code&gt;// test test_name&lt;/code&gt; comments into files inside &lt;code&gt;test_data/parser/inline&lt;/code&gt; directory.&lt;/p&gt;
&lt;p&gt;To update test data, run with &lt;code&gt;UPDATE_EXPECT&lt;/code&gt; variable:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot; readability=&quot;7&quot;&gt;
&lt;pre&gt;
env UPDATE_EXPECT=1 cargo qt
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After adding a new inline test you need to run &lt;code&gt;cargo xtest codegen&lt;/code&gt; and also update the test data as described above.&lt;/p&gt;
&lt;p&gt;Note &lt;a href=&quot;https://github.com/rust-analyzer/rust-analyzer/blob/2fb6af89eb794f775de60b82afe56b6f986c2a40/crates/ra_syntax/src/lib.rs#L190-L348&quot;&gt;&lt;code&gt;api_walkthrough&lt;/code&gt;&lt;/a&gt; in particular: it shows off various methods of working with syntax tree.&lt;/p&gt;
&lt;p&gt;See &lt;a href=&quot;https://github.com/rust-analyzer/rust-analyzer/pull/93&quot;&gt;#93&lt;/a&gt; for an example PR which fixes a bug in the grammar.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; &lt;code&gt;syntax&lt;/code&gt; crate is completely independent from the rest of rust-analyzer. It knows nothing about salsa or LSP. This is important because it is possible to make useful tooling using only the syntax tree. Without semantic information, you don't need to be able to &lt;em&gt;build&lt;/em&gt; code, which makes the tooling more robust. See also &lt;a href=&quot;https://web.stanford.edu/~mlfbrown/paper.pdf&quot; rel=&quot;nofollow&quot;&gt;https://web.stanford.edu/~mlfbrown/paper.pdf&lt;/a&gt;. You can view the &lt;code&gt;syntax&lt;/code&gt; crate as an entry point to rust-analyzer. &lt;code&gt;syntax&lt;/code&gt; crate is an &lt;strong&gt;API Boundary&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; syntax tree is a value type. The tree is fully determined by the contents of its syntax nodes, it doesn't need global context (like an interner) and doesn't store semantic info. Using the tree as a store for semantic info is convenient in traditional compilers, but doesn't work nicely in the IDE. Specifically, assists and refactors require transforming syntax trees, and that becomes awkward if you need to do something with the semantic info.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; syntax tree is built for a single file. This is to enable parallel parsing of all files.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; Syntax trees are by design incomplete and do not enforce well-formedness. If an AST method returns an &lt;code&gt;Option&lt;/code&gt;, it &lt;em&gt;can&lt;/em&gt; be &lt;code&gt;None&lt;/code&gt; at runtime, even if this is forbidden by the grammar.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;crates/base_db&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;We use the &lt;a href=&quot;https://github.com/salsa-rs/salsa&quot;&gt;salsa&lt;/a&gt; crate for incremental and on-demand computation. Roughly, you can think of salsa as a key-value store, but it can also compute derived values using specified functions. The &lt;code&gt;base_db&lt;/code&gt; crate provides basic infrastructure for interacting with salsa. Crucially, it defines most of the &quot;input&quot; queries: facts supplied by the client of the analyzer. Reading the docs of the &lt;code&gt;base_db::input&lt;/code&gt; module should be useful: everything else is strictly derived from those inputs.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; particularities of the build system are &lt;em&gt;not&lt;/em&gt; the part of the ground state. In particular, &lt;code&gt;base_db&lt;/code&gt; knows nothing about cargo. The &lt;code&gt;CrateGraph&lt;/code&gt; structure is used to represent the dependencies between the crates abstractly.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; &lt;code&gt;base_db&lt;/code&gt; doesn't know about file system and file paths. Files are represented with opaque &lt;code&gt;FileId&lt;/code&gt;, there's no operation to get an &lt;code&gt;std::path::Path&lt;/code&gt; out of the &lt;code&gt;FileId&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;crates/hir_expand&lt;/code&gt;, &lt;code&gt;crates/hir_def&lt;/code&gt;, &lt;code&gt;crates/hir_ty&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;These crates are the &lt;em&gt;brain&lt;/em&gt; of rust-analyzer. This is the compiler part of the IDE.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;hir_xxx&lt;/code&gt; crates have a strong ECS flavor, in that they work with raw ids and directly query the database. There's little abstraction here. These crates integrate deeply with salsa and chalk.&lt;/p&gt;
&lt;p&gt;Name resolution, macro expansion and type inference all happen here. These crates also define various intermediate representations of the core.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ItemTree&lt;/code&gt; condenses a single &lt;code&gt;SyntaxTree&lt;/code&gt; into a &quot;summary&quot; data structure, which is stable over modifications to function bodies.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;DefMap&lt;/code&gt; contains the module tree of a crate and stores module scopes.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Body&lt;/code&gt; stores information about expressions.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; these crates are not, and will never be, an api boundary.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; these crates explicitly care about being incremental. The core invariant we maintain is &quot;typing inside a function's body never invalidates global derived data&quot;. i.e., if you change the body of &lt;code&gt;foo&lt;/code&gt;, all facts about &lt;code&gt;bar&lt;/code&gt; should remain intact.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; hir exists only in context of particular crate instance with specific CFG flags. The same syntax may produce several instances of HIR if the crate participates in the crate graph more than once.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;crates/hir&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;The top-level &lt;code&gt;hir&lt;/code&gt; crate is an &lt;strong&gt;API Boundary&lt;/strong&gt;. If you think about &quot;using rust-analyzer as a library&quot;, &lt;code&gt;hir&lt;/code&gt; crate is most likely the façade you'll be talking to.&lt;/p&gt;
&lt;p&gt;It wraps ECS-style internal API into a more OO-flavored API (with an extra &lt;code&gt;db&lt;/code&gt; argument for each call).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; &lt;code&gt;hir&lt;/code&gt; provides a static, fully resolved view of the code. While internal &lt;code&gt;hir_*&lt;/code&gt; crates &lt;em&gt;compute&lt;/em&gt; things, &lt;code&gt;hir&lt;/code&gt;, from the outside, looks like an inert data structure.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;hir&lt;/code&gt; also handles the delicate task of going from syntax to the corresponding &lt;code&gt;hir&lt;/code&gt;. Remember that the mapping here is one-to-many. See &lt;code&gt;Semantics&lt;/code&gt; type and &lt;code&gt;source_to_def&lt;/code&gt; module.&lt;/p&gt;
&lt;p&gt;Note in particular a curious recursive structure in &lt;code&gt;source_to_def&lt;/code&gt;. We first resolve the parent &lt;em&gt;syntax&lt;/em&gt; node to the parent &lt;em&gt;hir&lt;/em&gt; element. Then we ask the &lt;em&gt;hir&lt;/em&gt; parent what &lt;em&gt;syntax&lt;/em&gt; children does it have. Then we look for our node in the set of children.&lt;/p&gt;
&lt;p&gt;This is the heart of many IDE features, like goto definition, which start with figuring out the hir node at the cursor. This is some kind of (yet unnamed) uber-IDE pattern, as it is present in Roslyn and Kotlin as well.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;crates/ide&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;The &lt;code&gt;ide&lt;/code&gt; crate builds on top of &lt;code&gt;hir&lt;/code&gt; semantic model to provide high-level IDE features like completion or goto definition. It is an &lt;strong&gt;API Boundary&lt;/strong&gt;. If you want to use IDE parts of rust-analyzer via LSP, custom flatbuffers-based protocol or just as a library in your text editor, this is the right API.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; &lt;code&gt;ide&lt;/code&gt; crate's API is build out of POD types with public fields. The API uses editor's terminology, it talks about offsets and string labels rather than in terms of definitions or types. It is effectively the view in MVC and viewmodel in &lt;a href=&quot;https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93viewmodel&quot; rel=&quot;nofollow&quot;&gt;MVVM&lt;/a&gt;. All arguments and return types are conceptually serializable. In particular, syntax tress and and hir types are generally absent from the API (but are used heavily in the implementation). Shout outs to LSP developers for popularizing the idea that &quot;UI&quot; is a good place to draw a boundary at.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ide&lt;/code&gt; is also the first crate which has the notion of change over time. &lt;code&gt;AnalysisHost&lt;/code&gt; is a state to which you can transactionally &lt;code&gt;apply_change&lt;/code&gt;. &lt;code&gt;Analysis&lt;/code&gt; is an immutable snapshot of the state.&lt;/p&gt;
&lt;p&gt;Internally, &lt;code&gt;ide&lt;/code&gt; is split across several crates. &lt;code&gt;ide_assists&lt;/code&gt;, &lt;code&gt;ide_completion&lt;/code&gt; and &lt;code&gt;ide_ssr&lt;/code&gt; implement large isolated features. &lt;code&gt;ide_db&lt;/code&gt; implements common IDE functionality (notably, reference search is implemented here). The &lt;code&gt;ide&lt;/code&gt; contains a public API/façade, as well as implementation for a plethora of smaller features.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; &lt;code&gt;ide&lt;/code&gt; crate strives to provide a &lt;em&gt;perfect&lt;/em&gt; API. Although at the moment it has only one consumer, the LSP server, LSP &lt;em&gt;does not&lt;/em&gt; influence it's API design. Instead, we keep in mind a hypothetical &lt;em&gt;ideal&lt;/em&gt; client -- an IDE tailored specifically for rust, every nook and cranny of which is packed with Rust-specific goodies.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;crates/rust-analyzer&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;This crate defines the &lt;code&gt;rust-analyzer&lt;/code&gt; binary, so it is the &lt;strong&gt;entry point&lt;/strong&gt;. It implements the language server.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; &lt;code&gt;rust-analyzer&lt;/code&gt; is the only crate that knows about LSP and JSON serialization. If you want to expose a datastructure &lt;code&gt;X&lt;/code&gt; from ide to LSP, don't make it serializable. Instead, create a serializable counterpart in &lt;code&gt;rust-analyzer&lt;/code&gt; crate and manually convert between the two.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;GlobalState&lt;/code&gt; is the state of the server. The &lt;code&gt;main_loop&lt;/code&gt; defines the server event loop which accepts requests and sends responses. Requests that modify the state or might block user's typing are handled on the main thread. All other requests are processed in background.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; the server is stateless, a-la HTTP. Sometimes state needs to be preserved between requests. For example, &quot;what is the &lt;code&gt;edit&lt;/code&gt; for the fifth completion item of the last completion edit?&quot;. For this, the second request should include enough info to re-create the context from scratch. This generally means including all the parameters of the original request.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;reload&lt;/code&gt; module contains the code that handles configuration and Cargo.toml changes. This is a tricky business.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; &lt;code&gt;rust-analyzer&lt;/code&gt; should be partially available even when the build is broken. Reloading process should not prevent IDE features from working.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;crates/toolchain&lt;/code&gt;, &lt;code&gt;crates/project_model&lt;/code&gt;, &lt;code&gt;crates/flycheck&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;These crates deal with invoking &lt;code&gt;cargo&lt;/code&gt; to learn about project structure and get compiler errors for the &quot;check on save&quot; feature.&lt;/p&gt;
&lt;p&gt;They use &lt;code&gt;crates/path&lt;/code&gt; heavily instead of &lt;code&gt;std::path&lt;/code&gt;. A single &lt;code&gt;rust-analyzer&lt;/code&gt; process can serve many projects, so it is important that server's current directory does not leak.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;crates/mbe&lt;/code&gt;, &lt;code&gt;crates/tt&lt;/code&gt;, &lt;code&gt;crates/proc_macro_api&lt;/code&gt;, &lt;code&gt;crates/proc_macro_srv&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;These crates implement macros as token tree -&amp;gt; token tree transforms. They are independent from the rest of the code.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;crates/cfg&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;This crate is responsible for parsing, evaluation and general definition of &lt;code&gt;cfg&lt;/code&gt; attributes.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;crates/vfs&lt;/code&gt;, &lt;code&gt;crates/vfs-notify&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;These crates implement a virtual file system. They provide consistent snapshots of the underlying file system and insulate messy OS paths.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; vfs doesn't assume a single unified file system. i.e., a single rust-analyzer process can act as a remote server for two different machines, where the same &lt;code&gt;/tmp/foo.rs&lt;/code&gt; path points to different files. For this reason, all path APIs generally take some existing path as a &quot;file system witness&quot;.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;crates/stdx&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;This crate contains various non-rust-analyzer specific utils, which could have been in std, as well as copies of unstable std items we would like to make use of already, like &lt;code&gt;std::str::split_once&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;crates/profile&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;This crate contains utilities for CPU and memory profiling.&lt;/p&gt;
&lt;h2&gt;Cross-Cutting Concerns&lt;/h2&gt;
&lt;p&gt;This sections talks about the things which are everywhere and nowhere in particular.&lt;/p&gt;
&lt;h3&gt;Code generation&lt;/h3&gt;
&lt;p&gt;Some of the components of this repository are generated through automatic processes. &lt;code&gt;cargo xtask codegen&lt;/code&gt; runs all generation tasks. Generated code is generally committed to the git repository. There are tests to check that the generated code is fresh.&lt;/p&gt;
&lt;p&gt;In particular, we generate:&lt;/p&gt;
&lt;ul readability=&quot;0.47133757961783&quot;&gt;&lt;li readability=&quot;0&quot;&gt;
&lt;p&gt;API for working with syntax trees (&lt;code&gt;syntax::ast&lt;/code&gt;, the &lt;a href=&quot;https://github.com/rust-analyzer/ungrammar&quot;&gt;&lt;code&gt;ungrammar&lt;/code&gt;&lt;/a&gt; crate).&lt;/p&gt;
&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;Various sections of the manual:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;features&lt;/li&gt;
&lt;li&gt;assists&lt;/li&gt;
&lt;li&gt;config&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li readability=&quot;-1&quot;&gt;
&lt;p&gt;Documentation tests for assists&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; we avoid bootstrapping. For codegen we need to parse Rust code. Using rust-analyzer for that would work and would be fun, but it would also complicate the build process a lot. For that reason, we use syn and manual string parsing.&lt;/p&gt;
&lt;h3&gt;Cancellation&lt;/h3&gt;
&lt;p&gt;Let's say that the IDE is in the process of computing syntax highlighting, when the user types &lt;code&gt;foo&lt;/code&gt;. What should happen? &lt;code&gt;rust-analyzer&lt;/code&gt;s answer is that the highlighting process should be cancelled -- its results are now stale, and it also blocks modification of the inputs.&lt;/p&gt;
&lt;p&gt;The salsa database maintains a global revision counter. When applying a change, salsa bumps this counter and waits until all other threads using salsa finish. If a thread does salsa-based computation and notices that the counter is incremented, it panics with a special value (see &lt;code&gt;Canceled::throw&lt;/code&gt;). That is, rust-analyzer requires unwinding.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ide&lt;/code&gt; is the boundary where the panic is caught and transformed into a &lt;code&gt;Result&amp;lt;T, Cancelled&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Testing&lt;/h3&gt;
&lt;p&gt;Rust Analyzer has three interesting &lt;a href=&quot;https://www.tedinski.com/2018/04/10/making-tests-a-positive-influence-on-design.html&quot; rel=&quot;nofollow&quot;&gt;system boundaries&lt;/a&gt; to concentrate tests on.&lt;/p&gt;
&lt;p&gt;The outermost boundary is the &lt;code&gt;rust-analyzer&lt;/code&gt; crate, which defines an LSP interface in terms of stdio. We do integration testing of this component, by feeding it with a stream of LSP requests and checking responses. These tests are known as &quot;heavy&quot;, because they interact with Cargo and read real files from disk. For this reason, we try to avoid writing too many tests on this boundary: in a statically typed language, it's hard to make an error in the protocol itself if messages are themselves typed. Heavy tests are only run when &lt;code&gt;RUN_SLOW_TESTS&lt;/code&gt; env var is set.&lt;/p&gt;
&lt;p&gt;The middle, and most important, boundary is &lt;code&gt;ide&lt;/code&gt;. Unlike &lt;code&gt;rust-analyzer&lt;/code&gt;, which exposes API, &lt;code&gt;ide&lt;/code&gt; uses Rust API and is intended for use by various tools. A typical test creates an &lt;code&gt;AnalysisHost&lt;/code&gt;, calls some &lt;code&gt;Analysis&lt;/code&gt; functions and compares the results against expectation.&lt;/p&gt;
&lt;p&gt;The innermost and most elaborate boundary is &lt;code&gt;hir&lt;/code&gt;. It has a much richer vocabulary of types than &lt;code&gt;ide&lt;/code&gt;, but the basic testing setup is the same: we create a database, run some queries, assert result.&lt;/p&gt;
&lt;p&gt;For comparisons, we use the &lt;code&gt;expect&lt;/code&gt; crate for snapshot testing.&lt;/p&gt;
&lt;p&gt;To test various analysis corner cases and avoid forgetting about old tests, we use so-called marks. See the &lt;code&gt;marks&lt;/code&gt; module in the &lt;code&gt;test_utils&lt;/code&gt; crate for more.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; rust-analyzer tests do not use libcore or libstd. All required library code must be a part of the tests. This ensures fast test execution.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; tests are data driven and do not test the API. Tests which directly call various API functions are a liability, because they make refactoring the API significantly more complicated. So most of the tests look like this:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-rust&quot; readability=&quot;13&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;check&lt;/span&gt;(input: &lt;span class=&quot;pl-k&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;str&lt;/span&gt;, expect: expect_test::Expect) {
    &lt;span class=&quot;pl-c&quot;&gt;// The single place that actually exercises a particular API&lt;/span&gt;
}


#[test]
&lt;span class=&quot;pl-k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;foo&lt;/span&gt;() {
    &lt;span class=&quot;pl-en&quot;&gt;check&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&quot;foo&quot;&lt;/span&gt;, &lt;span class=&quot;pl-en&quot;&gt;expect!&lt;/span&gt;[[&lt;span class=&quot;pl-s&quot;&gt;&quot;bar&quot;&lt;/span&gt;]]);
}

#[test]
&lt;span class=&quot;pl-k&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;spam&lt;/span&gt;() {
    &lt;span class=&quot;pl-en&quot;&gt;check&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&quot;spam&quot;&lt;/span&gt;, &lt;span class=&quot;pl-en&quot;&gt;expect!&lt;/span&gt;[[&lt;span class=&quot;pl-s&quot;&gt;&quot;eggs&quot;&lt;/span&gt;]]);
}
&lt;span class=&quot;pl-c&quot;&gt;// ...and a hundred more tests that don't care about the specific API at all.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To specify input data, we use a single string literal in a special format, which can describe a set of rust files. See the &lt;code&gt;Fixture&lt;/code&gt; type.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; all code invariants are tested by &lt;code&gt;#[test]&lt;/code&gt; tests. There's no additional checks in CI, formatting and tidy tests are run with &lt;code&gt;cargo test&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; tests do not depend on any kind of external resources, they are perfectly reproducible.&lt;/p&gt;
&lt;h3&gt;Error Handling&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Architecture Invariant:&lt;/strong&gt; core parts of rust-analyzer (&lt;code&gt;ide&lt;/code&gt;/&lt;code&gt;hir&lt;/code&gt;) don't interact with the outside world and thus can't fail. Only parts touching LSP are allowed to do IO.&lt;/p&gt;
&lt;p&gt;Internals of rust-analyzer need to deal with broken code, but this is not an error condition. rust-analyzer is robust: various analysis compute &lt;code&gt;(T, Vec&amp;lt;Error&amp;gt;)&lt;/code&gt; rather than &lt;code&gt;Result&amp;lt;T, Error&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;rust-analyzer is a complex long-running process. It will always have bugs and panics. But a panic in an isolated feature should not bring down the whole process. Each LSP-request is protected by a &lt;code&gt;catch_unwind&lt;/code&gt;. We use &lt;code&gt;always&lt;/code&gt; and &lt;code&gt;never&lt;/code&gt; macros instead of &lt;code&gt;assert&lt;/code&gt; to gracefully recover from impossible conditions.&lt;/p&gt;
&lt;h3&gt;Observability&lt;/h3&gt;
&lt;p&gt;rust-analyzer is a long-running process, so its important to understand what's going on inside. We have several instruments for that.&lt;/p&gt;
&lt;p&gt;The event loop that runs rust-analyzer is very explicit. Rather than spawning futures or scheduling callbacks (open), the event loop accepts an &lt;code&gt;enum&lt;/code&gt; of possible events (closed). It's easy to see all the things that trigger rust-analyzer processing, together with their performance&lt;/p&gt;
&lt;p&gt;rust-analyzer includes a simple hierarchical profiler (&lt;code&gt;hprof&lt;/code&gt;). It is enabled with &lt;code&gt;RA_PROFILE='*&amp;gt;50&lt;/code&gt; env var (log all (&lt;code&gt;*&lt;/code&gt;) actions which take more than &lt;code&gt;50&lt;/code&gt; ms) and produces output like:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;85ms - handle_completion
    68ms - import_on_the_fly
        67ms - import_assets::search_for_relative_paths
             0ms - crate_def_map:wait (804 calls)
             0ms - find_path (16 calls)
             2ms - find_similar_imports (1 calls)
             0ms - generic_params_query (334 calls)
            59ms - trait_solve_query (186 calls)
         0ms - Semantics::analyze_impl (1 calls)
         1ms - render_resolution (8 calls)
     0ms - Semantics::analyze_impl (5 calls)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;This is cheap enough to enable in production.&lt;/p&gt;
&lt;p&gt;Similarly, we save live object counting (&lt;code&gt;RA_COUNT=1&lt;/code&gt;). It is not cheap enough to enable in prod, and this is a bug which should be fixed.&lt;/p&gt;
</description>
<pubDate>Thu, 04 Feb 2021 15:46:16 +0000</pubDate>
<dc:creator>ibraheemdev</dc:creator>
<og:image>https://avatars.githubusercontent.com/u/43985197?s=400&amp;v=4</og:image>
<og:type>object</og:type>
<og:title>rust-analyzer/rust-analyzer</og:title>
<og:url>https://github.com/rust-analyzer/rust-analyzer</og:url>
<og:description>An experimental Rust compiler front-end for IDEs. Contribute to rust-analyzer/rust-analyzer development by creating an account on GitHub.</og:description>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://github.com/rust-analyzer/rust-analyzer/blob/master/docs/dev/architecture.md</dc:identifier>
</item>
<item>
<title>The Dunant subsea cable</title>
<link>https://cloud.google.com/blog/products/infrastructure/googles-dunant-subsea-cable-is-now-ready-for-service</link>
<guid isPermaLink="true" >https://cloud.google.com/blog/products/infrastructure/googles-dunant-subsea-cable-is-now-ready-for-service</guid>
<description>[unable to retrieve full-text content]
&lt;p&gt;Article URL: &lt;a href=&quot;https://cloud.google.com/blog/products/infrastructure/googles-dunant-subsea-cable-is-now-ready-for-service&quot;&gt;https://cloud.google.com/blog/products/infrastructure/googles-dunant-subsea-cable-is-now-ready-for-service&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Comments URL: &lt;a href=&quot;https://news.ycombinator.com/item?id=26024917&quot;&gt;https://news.ycombinator.com/item?id=26024917&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Points: 246&lt;/p&gt;
&lt;p&gt;# Comments: 233&lt;/p&gt;
</description>
<pubDate>Thu, 04 Feb 2021 12:55:58 +0000</pubDate>
<dc:creator>johannesboyne</dc:creator>
<og:type>website</og:type>
<og:title>The Dunant subsea cable, connecting the US and mainland Europe, is ready for service</og:title>
<og:description>The Dunant submarine cable system, crossing the Atlantic Ocean between Virginia Beach in the U.S. and Saint-Hilaire-de-Riez on the French Atlantic coast, has been deployed and tested and is now ready for service.</og:description>
<og:image>https://storage.googleapis.com/gweb-cloudblog-publish/original_images/world_map1.jpg</og:image>
<og:url>https://cloud.google.com/blog/</og:url>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://cloud.google.com/blog/products/infrastructure/googles-dunant-subsea-cable-is-now-ready-for-service</dc:identifier>
</item>
<item>
<title>McKinsey to pay $573M to settle claims over opioid crisis role: source</title>
<link>https://www.reuters.com/article/us-usa-mckinsey-idUSKBN2A405Q</link>
<guid isPermaLink="true" >https://www.reuters.com/article/us-usa-mckinsey-idUSKBN2A405Q</guid>
<description>&lt;div class=&quot;ArticleBody-byline-container-3H6dy&quot;&gt;
&lt;p class=&quot;Byline-byline-1sVmo ArticleBody-byline-10B7D&quot;&gt;By &lt;a class=&quot;TextLabel__text-label___3oCVw TextLabel__black-to-orange___23uc0 TextLabel__serif___3lOpX Byline-author-2BSir&quot; href=&quot;https://www.reuters.com/journalists/nate-raymond&quot; target=&quot;_blank&quot;&gt;Nate Raymond&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;ArticleBody-read-time-and-social-2VOIr&quot;&gt;
&lt;p class=&quot;TextLabel__text-label___3oCVw TextLabel__gray___1V4fk TextLabel__small-all-caps-spaced-out___3O9H4 ReadTime-read-time-1s3CG ArticleBody-read-time-29pGN&quot;&gt;2 Min Read&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;(Reuters) - Consulting firm McKinsey &amp;amp; Co has agreed to pay at least $573 million to resolve claims by 40-plus U.S. states related to its role in the opioid epidemic and advice it gave to OxyContin maker Purdue Pharma, according to a person familiar with the matter.&lt;/p&gt;
&lt;div&gt;&lt;button type=&quot;button&quot; class=&quot;FullscreenOverlay-button-1FTU6 Slideshow-inline-image-container-1dktB&quot; aria-label=&quot;slideshow&quot;&gt;


&lt;/button&gt;Slideshow &lt;span&gt;( 2 images )&lt;/span&gt;&lt;/div&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;The settlement is with 43 states, the District of Columbia and three territories, the person said on Wednesday. Several attorneys general said they planned announcements on the opioid epidemic on Thursday.&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;They included Vermont’s attorney general, T.J. Donovan, whose office said it would announce its participation in the first multi-state opioid settlement “to result in substantial payment to the states to address the epidemic.”&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;Washington Attorney General Bob Ferguson said he had reached a separate, $13 million settlement with McKinsey that was on top of the reported multi-state agreement.&lt;/p&gt;

&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;McKinsey did not respond to requests for comment.&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;McKinsey previously came under scrutiny for its role advising Purdue Pharma and the wealth Sackler family that owns the drugmaker.&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;A lawsuit by Massachusetts Attorney General Maura Healey alleged McKinsey advised the Sacklers on how to “turbocharge” opioid sales.&lt;/p&gt;

&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;Purdue filed for bankruptcy in 2019 as part of a proposed settlement it valued at $10 billion to resolve lawsuits alleging its painkiller marketing helped fuel the epidemic.&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;More than 3,200 lawsuits are pending, seeking to hold drug makers, distributors and pharmacies responsible for an opioid addiction epidemic that according to U.S. government data resulted in 450,000 overdose deaths from 1999 to 2018.&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;The lawsuits accuse drugmakers of deceptively marketing opioids and distributors of ignoring red flags indicating the prescription painkillers were being diverted for improper uses. They deny wrongdoing.&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;The states and local governments have been also in negotiations for settlements with drug distributors Cardinal Health Inc, McKesson Corp and Amerisourcebergen Corp and drugmaker Johnson &amp;amp; Johnson.&lt;/p&gt;
&lt;div readability=&quot;6.0903225806452&quot;&gt;
&lt;div class=&quot;Attribution-attribution-Y5JpY&quot; readability=&quot;9&quot;&gt;
&lt;p&gt;Reporting by Nate Raymond, Rama Venkat and Eric Beech; Editing by Leslie Adler and Raju Gopalakrishnan&lt;/p&gt;
&lt;/div&gt;

&lt;/div&gt;
</description>
<pubDate>Thu, 04 Feb 2021 12:25:54 +0000</pubDate>
<dc:creator>onetimemanytime</dc:creator>
<og:title>McKinsey to pay $573 million to settle claims over opioid crisis role: source</og:title>
<og:description>Consulting firm McKinsey &amp; Co has agreed to pay at least $573 million to resolve claims by 40-plus U.S. states related to its role in the opioid epidemic and advice it gave to OxyContin maker Purdue Pharma, according to a person familiar with the matter.</og:description>
<og:image>https://static.reuters.com/resources/r/?m=02&amp;d=20210204&amp;t=2&amp;i=1550301215&amp;r=LYNXMPEH1303A&amp;w=800</og:image>
<og:url>https://www.reuters.com/article/us-usa-mckinsey-idUSKBN2A405Q</og:url>
<og:type>article</og:type>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.reuters.com/article/us-usa-mckinsey-idUSKBN2A405Q</dc:identifier>
</item>
<item>
<title>Waiting for PostgreSQL 14 – SEARCH and CYCLE clauses</title>
<link>https://www.depesz.com/2021/02/04/waiting-for-postgresql-14-search-and-cycle-clauses/</link>
<guid isPermaLink="true" >https://www.depesz.com/2021/02/04/waiting-for-postgresql-14-search-and-cycle-clauses/</guid>
<description>&lt;p&gt;On 1st of February 2021, Peter Eisentraut &lt;a href=&quot;https://git.postgresql.org/pg/commitdiff/3696a600e2292d43c00949ddf0352e4ebb487e5b&quot;&gt;committed&lt;/a&gt; patch:&lt;/p&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap5&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap4&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap3&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap2&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight&quot;&gt;
&lt;div class=&quot;text&quot;&gt;
&lt;pre class=&quot;de1&quot;&gt;
SEARCH and CYCLE clauses 
 
This adds the SQL standard feature that adds the SEARCH and CYCLE
clauses to recursive queries to be able to do produce breadth- or
depth-first search orders and detect cycles.  These clauses can be
rewritten into queries using existing syntax, and that is what this
patch does in the rewriter.
 
Reviewed-by: Vik Fearing &amp;lt;vik@postgresfriends.org&amp;gt;
Reviewed-by: Pavel Stehule &amp;lt;pavel.stehule@gmail.com&amp;gt;
Discussion: https://www.postgresql.org/message-id/flat/db80ceee-6f97-9b4a-8ee8-3ba0c58e5be2@2ndquadrant.com
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Just as message suggests this change is related to recursive queries.&lt;/p&gt;
&lt;p&gt;Which means, that to test it, we need some data for recursive queries. This time I took directory listing of my /etc, and loaded it to db:&lt;/p&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap5&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap4&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap3&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap2&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight&quot;&gt;
&lt;div class=&quot;sql&quot;&gt;
&lt;pre class=&quot;de1&quot;&gt;
$ &lt;span class=&quot;kw1&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;TABLE&lt;/span&gt; dirs &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;
    id        &lt;span class=&quot;kw1&quot;&gt;INT&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;NOT&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    parent_id &lt;span class=&quot;kw1&quot;&gt;INT&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;REFERENCES&lt;/span&gt; dirs &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    dirname   text&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;;
&lt;span class=&quot;kw1&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;TABLE&lt;/span&gt;
 
$ copy dirs &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'/tmp/dirs.data'&lt;/span&gt;;
COPY &lt;span class=&quot;nu0&quot;&gt;434&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Great, we can now see full paths to each dir:&lt;/p&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap5&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap4&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap3&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap2&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight&quot;&gt;
&lt;div class=&quot;sql&quot;&gt;
&lt;pre class=&quot;de1&quot;&gt;
$ &lt;span class=&quot;kw1&quot;&gt;WITH&lt;/span&gt; RECURSIVE c &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; dirname &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; dirs &lt;span class=&quot;kw1&quot;&gt;WHERE&lt;/span&gt; parent_id &lt;span class=&quot;kw1&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;NULL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ALL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;path &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'/'&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;dirname &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; dirs &lt;span class=&quot;kw1&quot;&gt;JOIN&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ON&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;parent_id &lt;span class=&quot;sy0&quot;&gt;=&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;BY&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;nu0&quot;&gt;15&lt;/span&gt;;
 id &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt;            path             
&lt;span class=&quot;co1&quot;&gt;----+-----------------------------&lt;/span&gt;
  &lt;span class=&quot;nu0&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc
 &lt;span class=&quot;nu0&quot;&gt;42&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;acpi
 &lt;span class=&quot;nu0&quot;&gt;43&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;acpi&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;events
 &lt;span class=&quot;nu0&quot;&gt;44&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;alsa
 &lt;span class=&quot;nu0&quot;&gt;45&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;alsa&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;conf&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
 &lt;span class=&quot;nu0&quot;&gt;46&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;alternatives
 &lt;span class=&quot;nu0&quot;&gt;47&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apache2
 &lt;span class=&quot;nu0&quot;&gt;48&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apache2&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;conf&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;available
 &lt;span class=&quot;nu0&quot;&gt;49&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm
 &lt;span class=&quot;nu0&quot;&gt;50&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;resume&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
 &lt;span class=&quot;nu0&quot;&gt;51&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;scripts&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
 &lt;span class=&quot;nu0&quot;&gt;52&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;suspend&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
 &lt;span class=&quot;nu0&quot;&gt;53&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apparmor
 &lt;span class=&quot;nu0&quot;&gt;54&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
 &lt;span class=&quot;nu0&quot;&gt;55&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;abstractions
&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nu0&quot;&gt;15&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ROWS&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Cool. Now let's see what these new changes get us.&lt;/p&gt;
&lt;p&gt;First thing is:&lt;/p&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap5&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap4&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap3&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap2&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight&quot;&gt;
&lt;div class=&quot;sql&quot;&gt;
&lt;pre class=&quot;de1&quot;&gt;
$ &lt;span class=&quot;kw1&quot;&gt;WITH&lt;/span&gt; RECURSIVE c &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; dirname &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; dirs &lt;span class=&quot;kw1&quot;&gt;WHERE&lt;/span&gt; parent_id &lt;span class=&quot;kw1&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;NULL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ALL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;path &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'/'&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;dirname &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; dirs &lt;span class=&quot;kw1&quot;&gt;JOIN&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ON&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;parent_id &lt;span class=&quot;sy0&quot;&gt;=&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;SEARCH&lt;/span&gt; DEPTH &lt;span class=&quot;kw1&quot;&gt;FIRST&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;BY&lt;/span&gt; id &lt;span class=&quot;kw1&quot;&gt;SET&lt;/span&gt; ordercol
&lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;BY&lt;/span&gt; ordercol &lt;span class=&quot;kw1&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;nu0&quot;&gt;15&lt;/span&gt;;
 id  &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt;                    path                    
&lt;span class=&quot;co1&quot;&gt;-----+--------------------------------------------&lt;/span&gt;
   &lt;span class=&quot;nu0&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc
   &lt;span class=&quot;nu0&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/.&lt;/span&gt;java
 &lt;span class=&quot;nu0&quot;&gt;434&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/.&lt;/span&gt;java&lt;span class=&quot;sy0&quot;&gt;/.&lt;/span&gt;systemPrefs
   &lt;span class=&quot;nu0&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;GNUstep
   &lt;span class=&quot;nu0&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;ImageMagick&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nu0&quot;&gt;6&lt;/span&gt;
   &lt;span class=&quot;nu0&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;Muttrc&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
   &lt;span class=&quot;nu0&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager
   &lt;span class=&quot;nu0&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;conf&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
   &lt;span class=&quot;nu0&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;dispatcher&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
   &lt;span class=&quot;nu0&quot;&gt;9&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;dispatcher&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;no&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;wait&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
  &lt;span class=&quot;nu0&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;dispatcher&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;pre&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;down&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
  &lt;span class=&quot;nu0&quot;&gt;11&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;dispatcher&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;pre&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;up&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
  &lt;span class=&quot;nu0&quot;&gt;12&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;dnsmasq&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
  &lt;span class=&quot;nu0&quot;&gt;13&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;dnsmasq&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;shared&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
  &lt;span class=&quot;nu0&quot;&gt;14&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;system&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;connections
&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nu0&quot;&gt;15&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ROWS&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;OK. So this returns the dirs, depth first, but ordered by id.&lt;/p&gt;
&lt;p&gt;Let's try to get the previous output, ascii-betical order, using this new approach, but also, let's see what ordercol really is:&lt;/p&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap5&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap4&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap3&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap2&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight&quot;&gt;
&lt;div class=&quot;sql&quot;&gt;
&lt;pre class=&quot;de1&quot;&gt;
$ &lt;span class=&quot;kw1&quot;&gt;WITH&lt;/span&gt; RECURSIVE c &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; dirname &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; dirs &lt;span class=&quot;kw1&quot;&gt;WHERE&lt;/span&gt; parent_id &lt;span class=&quot;kw1&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;NULL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ALL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;path &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'/'&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;dirname &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; dirs &lt;span class=&quot;kw1&quot;&gt;JOIN&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ON&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;parent_id &lt;span class=&quot;sy0&quot;&gt;=&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;SEARCH&lt;/span&gt; DEPTH &lt;span class=&quot;kw1&quot;&gt;FIRST&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;BY&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;SET&lt;/span&gt; ordercol
&lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; path&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; ordercol &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;BY&lt;/span&gt; ordercol &lt;span class=&quot;kw1&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;nu0&quot;&gt;15&lt;/span&gt;;
 id &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt;                     path                     &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt;                                         ordercol                                          
&lt;span class=&quot;co1&quot;&gt;----+----------------------------------------------+-------------------------------------------------------------------------------------------&lt;/span&gt;
  &lt;span class=&quot;nu0&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc                                          &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;42&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;acpi                                     &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;acpi&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;43&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;acpi&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;events                              &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;acpi&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;acpi&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;events&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;44&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;alsa                                     &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;alsa&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;45&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;alsa&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;conf&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d                              &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;alsa&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;alsa&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;conf&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;46&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;alternatives                             &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;alternatives&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;47&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apache2                                  &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apache2&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;48&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apache2&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;conf&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;available                   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apache2&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apache2&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;conf&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;available&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;49&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm                                      &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;50&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;resume&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d                             &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;resume&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;51&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;scripts&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d                            &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;scripts&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;52&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;suspend&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d                            &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apm&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;suspend&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;53&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apparmor                                 &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apparmor&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;67&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apparmor&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;init                            &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apparmor&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apparmor&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;init&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;68&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apparmor&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;init&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;network&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;interface&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;security &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apparmor&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apparmor&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;init&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apparmor&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;init&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;network&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;interface&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;security&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nu0&quot;&gt;15&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ROWS&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;So, I can see now, that in this sort – etc/apparmor/X is actually before /etc/apparmor.d/X. Which kinda makes sense. Let's compare the two orders on their own:&lt;/p&gt;
&lt;p&gt;Old approach:&lt;/p&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap5&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap4&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap3&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap2&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight&quot;&gt;
&lt;div class=&quot;sql&quot;&gt;
&lt;pre class=&quot;de1&quot;&gt;
$ &lt;span class=&quot;kw1&quot;&gt;WITH&lt;/span&gt; RECURSIVE c &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; dirname &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; dirs &lt;span class=&quot;kw1&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;kw1&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nu0&quot;&gt;53&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nu0&quot;&gt;54&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ALL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;path &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'/'&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;dirname &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; dirs &lt;span class=&quot;kw1&quot;&gt;JOIN&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ON&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;parent_id &lt;span class=&quot;sy0&quot;&gt;=&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;BY&lt;/span&gt; path;
 id &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt;                   path                    
&lt;span class=&quot;co1&quot;&gt;----+-------------------------------------------&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;53&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor
 &lt;span class=&quot;nu0&quot;&gt;54&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
 &lt;span class=&quot;nu0&quot;&gt;55&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;abstractions
 &lt;span class=&quot;nu0&quot;&gt;56&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;abstractions&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apparmor_api
 &lt;span class=&quot;nu0&quot;&gt;57&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;abstractions&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;ubuntu&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;browsers&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
 &lt;span class=&quot;nu0&quot;&gt;58&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;disable
 &lt;span class=&quot;nu0&quot;&gt;59&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;force&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;complain
 &lt;span class=&quot;nu0&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;libvirt
 &lt;span class=&quot;nu0&quot;&gt;61&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;kw1&quot;&gt;LOCAL&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;62&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;kw1&quot;&gt;LOCAL&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;abstractions
 &lt;span class=&quot;nu0&quot;&gt;63&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;tunables
 &lt;span class=&quot;nu0&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;tunables&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;home&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
 &lt;span class=&quot;nu0&quot;&gt;65&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;tunables&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;multiarch&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
 &lt;span class=&quot;nu0&quot;&gt;66&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;tunables&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;xdg&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;user&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
 &lt;span class=&quot;nu0&quot;&gt;67&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;init
 &lt;span class=&quot;nu0&quot;&gt;68&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;init&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;network&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;interface&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;security
&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nu0&quot;&gt;16&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ROWS&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;and the new one:&lt;/p&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap5&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap4&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap3&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap2&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight&quot;&gt;
&lt;div class=&quot;sql&quot;&gt;
&lt;pre class=&quot;de1&quot;&gt;
$ &lt;span class=&quot;kw1&quot;&gt;WITH&lt;/span&gt; RECURSIVE c &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; dirname &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; dirs &lt;span class=&quot;kw1&quot;&gt;WHERE&lt;/span&gt; id &lt;span class=&quot;kw1&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nu0&quot;&gt;53&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nu0&quot;&gt;54&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ALL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;path &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'/'&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;dirname &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; dirs &lt;span class=&quot;kw1&quot;&gt;JOIN&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ON&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;parent_id &lt;span class=&quot;sy0&quot;&gt;=&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;SEARCH&lt;/span&gt; DEPTH &lt;span class=&quot;kw1&quot;&gt;FIRST&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;BY&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;SET&lt;/span&gt; ordercol
&lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;BY&lt;/span&gt; ordercol;
 id &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt;                   path                    
&lt;span class=&quot;co1&quot;&gt;----+-------------------------------------------&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;53&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor
 &lt;span class=&quot;nu0&quot;&gt;67&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;init
 &lt;span class=&quot;nu0&quot;&gt;68&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;init&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;network&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;interface&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;security
 &lt;span class=&quot;nu0&quot;&gt;54&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
 &lt;span class=&quot;nu0&quot;&gt;55&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;abstractions
 &lt;span class=&quot;nu0&quot;&gt;56&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;abstractions&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apparmor_api
 &lt;span class=&quot;nu0&quot;&gt;57&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;abstractions&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;ubuntu&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;browsers&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
 &lt;span class=&quot;nu0&quot;&gt;58&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;disable
 &lt;span class=&quot;nu0&quot;&gt;59&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;force&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;complain
 &lt;span class=&quot;nu0&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;libvirt
 &lt;span class=&quot;nu0&quot;&gt;61&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;kw1&quot;&gt;LOCAL&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;62&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;kw1&quot;&gt;LOCAL&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;abstractions
 &lt;span class=&quot;nu0&quot;&gt;63&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;tunables
 &lt;span class=&quot;nu0&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;tunables&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;home&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
 &lt;span class=&quot;nu0&quot;&gt;65&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;tunables&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;multiarch&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
 &lt;span class=&quot;nu0&quot;&gt;66&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; apparmor&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;tunables&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;xdg&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;user&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nu0&quot;&gt;16&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ROWS&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Please note that apparmor/init and apparmor/init/network-interface-security are in much better place now – immediately after apparmor/, and not apparmor.d. Nice!&lt;/p&gt;
&lt;p&gt;What's cool, we can also now also have order by breadth first:&lt;/p&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap5&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap4&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap3&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap2&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight&quot;&gt;
&lt;div class=&quot;sql&quot;&gt;
&lt;pre class=&quot;de1&quot;&gt;
$ &lt;span class=&quot;kw1&quot;&gt;WITH&lt;/span&gt; RECURSIVE c &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; dirname &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; dirs &lt;span class=&quot;kw1&quot;&gt;WHERE&lt;/span&gt; parent_id &lt;span class=&quot;kw1&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;NULL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ALL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;path &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'/'&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;dirname &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; dirs &lt;span class=&quot;kw1&quot;&gt;JOIN&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ON&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;parent_id &lt;span class=&quot;sy0&quot;&gt;=&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;SEARCH&lt;/span&gt; BREADTH &lt;span class=&quot;kw1&quot;&gt;FIRST&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;BY&lt;/span&gt; id &lt;span class=&quot;kw1&quot;&gt;SET&lt;/span&gt; ordercol
&lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;BY&lt;/span&gt; ordercol &lt;span class=&quot;kw1&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;nu0&quot;&gt;15&lt;/span&gt;;
 id &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt;        path         
&lt;span class=&quot;co1&quot;&gt;----+---------------------&lt;/span&gt;
  &lt;span class=&quot;nu0&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc
  &lt;span class=&quot;nu0&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/.&lt;/span&gt;java
  &lt;span class=&quot;nu0&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;GNUstep
  &lt;span class=&quot;nu0&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;ImageMagick&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nu0&quot;&gt;6&lt;/span&gt;
  &lt;span class=&quot;nu0&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;Muttrc&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
  &lt;span class=&quot;nu0&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager
 &lt;span class=&quot;nu0&quot;&gt;15&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;ODBCDataSources
 &lt;span class=&quot;nu0&quot;&gt;16&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;OpenCL
 &lt;span class=&quot;nu0&quot;&gt;18&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;PackageKit
 &lt;span class=&quot;nu0&quot;&gt;19&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;UPower
 &lt;span class=&quot;nu0&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;X11
 &lt;span class=&quot;nu0&quot;&gt;42&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;acpi
 &lt;span class=&quot;nu0&quot;&gt;44&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;alsa
 &lt;span class=&quot;nu0&quot;&gt;46&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;alternatives
 &lt;span class=&quot;nu0&quot;&gt;47&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;apache2
&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nu0&quot;&gt;15&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ROWS&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;yeah – There are many dirs in /etc, so to see some dirs deeper I will have to offset quite a lot:&lt;/p&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap5&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap4&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap3&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap2&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight&quot;&gt;
&lt;div class=&quot;sql&quot;&gt;
&lt;pre class=&quot;de1&quot;&gt;
$ &lt;span class=&quot;kw1&quot;&gt;WITH&lt;/span&gt; RECURSIVE c &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; dirname &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; dirs &lt;span class=&quot;kw1&quot;&gt;WHERE&lt;/span&gt; parent_id &lt;span class=&quot;kw1&quot;&gt;IS&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;NULL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ALL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;path &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'/'&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;dirname &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; dirs &lt;span class=&quot;kw1&quot;&gt;JOIN&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ON&lt;/span&gt; dirs&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;parent_id &lt;span class=&quot;sy0&quot;&gt;=&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;id
&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;SEARCH&lt;/span&gt; BREADTH &lt;span class=&quot;kw1&quot;&gt;FIRST&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;BY&lt;/span&gt; id &lt;span class=&quot;kw1&quot;&gt;SET&lt;/span&gt; ordercol
&lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; id&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; path &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;BY&lt;/span&gt; ordercol &lt;span class=&quot;kw1&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;nu0&quot;&gt;15&lt;/span&gt; offset &lt;span class=&quot;nu0&quot;&gt;170&lt;/span&gt;;
 id  &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt;                 path                  
&lt;span class=&quot;co1&quot;&gt;-----+---------------------------------------&lt;/span&gt;
 &lt;span class=&quot;nu0&quot;&gt;420&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;vulkan
 &lt;span class=&quot;nu0&quot;&gt;424&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;wpa_supplicant
 &lt;span class=&quot;nu0&quot;&gt;425&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;xdg
 &lt;span class=&quot;nu0&quot;&gt;433&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;xml
   &lt;span class=&quot;nu0&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;conf&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
   &lt;span class=&quot;nu0&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;dispatcher&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
  &lt;span class=&quot;nu0&quot;&gt;12&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;dnsmasq&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
  &lt;span class=&quot;nu0&quot;&gt;13&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;dnsmasq&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;shared&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
  &lt;span class=&quot;nu0&quot;&gt;14&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;NetworkManager&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;system&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;connections
  &lt;span class=&quot;nu0&quot;&gt;17&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;OpenCL&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;vendors
  &lt;span class=&quot;nu0&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;X11&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;Xreset&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
  &lt;span class=&quot;nu0&quot;&gt;22&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;X11&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;Xresources
  &lt;span class=&quot;nu0&quot;&gt;23&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;X11&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;Xsession&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;d
  &lt;span class=&quot;nu0&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;X11&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;app&lt;span class=&quot;sy0&quot;&gt;-&lt;/span&gt;defaults
  &lt;span class=&quot;nu0&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; etc&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;X11&lt;span class=&quot;sy0&quot;&gt;/&lt;/span&gt;cursors
&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nu0&quot;&gt;15&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ROWS&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This is awesome.&lt;/p&gt;
&lt;p&gt;For the second part of the change – cycles, I will need different dataset.&lt;/p&gt;
&lt;p&gt;So I took a small bit of &lt;a href=&quot;https://www.daysofwonder.com/tickettoride/en/&quot;&gt;Ticket to Ride&lt;/a&gt; map:&lt;/p&gt;
&lt;p&gt;&lt;img loading=&quot;lazy&quot; src=&quot;https://www.depesz.com/wp-content/uploads/2021/02/ttr-map.png&quot; width=&quot;450&quot; height=&quot;205&quot;/&gt;&lt;/p&gt;
&lt;p&gt;and converted it to table:&lt;/p&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap5&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap4&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap3&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap2&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight&quot;&gt;
&lt;div class=&quot;sql&quot;&gt;
&lt;pre class=&quot;de1&quot;&gt;
$ &lt;span class=&quot;kw1&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;TABLE&lt;/span&gt; conns &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;
    c_from text&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    c_to   text&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;c_from&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; c_to&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;;
&lt;span class=&quot;kw1&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;TABLE&lt;/span&gt;
 
$ &lt;span class=&quot;kw1&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;INTO&lt;/span&gt; conns &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;c_from&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; c_to&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kw1&quot;&gt;VALUES&lt;/span&gt;
    &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Chicago'&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;st0&quot;&gt;'Duluth'&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Duluth'&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;st0&quot;&gt;'Chicago'&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Chicago'&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;st0&quot;&gt;'Toronto'&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Toronto'&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;st0&quot;&gt;'Chicago'&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Chicago'&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;st0&quot;&gt;'Pittsburg'&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Pittsburg'&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;st0&quot;&gt;'Chicago'&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Pittsburg'&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;st0&quot;&gt;'Toronto'&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Toronto'&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;st0&quot;&gt;'Pittsburg'&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Duluth'&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;st0&quot;&gt;'Toronto'&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Toronto'&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;st0&quot;&gt;'Duluth'&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Chicago'&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;st0&quot;&gt;'Omaha'&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Omaha'&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;st0&quot;&gt;'Chicago'&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;;
&lt;span class=&quot;kw1&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;nu0&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;nu0&quot;&gt;12&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Now, let's print all possible routes we can go through, starting from Chicago. Simplistic approach:&lt;/p&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap5&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap4&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap3&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap2&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight&quot;&gt;
&lt;div class=&quot;sql&quot;&gt;
&lt;pre class=&quot;de1&quot;&gt;
$ &lt;span class=&quot;kw1&quot;&gt;WITH&lt;/span&gt; RECURSIVE c &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; c_from&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; c_to&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; array&lt;span class=&quot;br0&quot;&gt;[&lt;/span&gt; c_from&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; c_to &lt;span class=&quot;br0&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; track &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; conns &lt;span class=&quot;kw1&quot;&gt;WHERE&lt;/span&gt; c_from &lt;span class=&quot;sy0&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Chicago'&lt;/span&gt;
  &lt;span class=&quot;kw1&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ALL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; n&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_from&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; n&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_to&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;track &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; n&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_to
    &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; conns n &lt;span class=&quot;kw1&quot;&gt;JOIN&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ON&lt;/span&gt; n&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_from &lt;span class=&quot;sy0&quot;&gt;=&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_to
&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; c;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;will, of course, never end, because there are cycles in here.&lt;/p&gt;
&lt;p&gt;But now, we can have cycle detection! So let's try it:&lt;/p&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap5&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap4&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap3&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap2&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight&quot;&gt;
&lt;div class=&quot;sql&quot;&gt;
&lt;pre class=&quot;de1&quot;&gt;
$ &lt;span class=&quot;kw1&quot;&gt;WITH&lt;/span&gt; RECURSIVE c &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; c_from&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Chicago'&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; c_to&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; ARRAY&lt;span class=&quot;br0&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Chicago'&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; track
  &lt;span class=&quot;kw1&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ALL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; n&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_from&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; n&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_to&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;track &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; n&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_to
    &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; conns n &lt;span class=&quot;kw1&quot;&gt;JOIN&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ON&lt;/span&gt; n&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_from &lt;span class=&quot;sy0&quot;&gt;=&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_to
&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt; CYCLE c_to &lt;span class=&quot;kw1&quot;&gt;SET&lt;/span&gt; is_cycle &lt;span class=&quot;kw1&quot;&gt;TO&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;TRUE&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;FALSE&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;USING&lt;/span&gt; cycle_path
&lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; c;
  c_from   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt;   c_to    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt;                   track                    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; is_cycle &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt;                      cycle_path                      
&lt;span class=&quot;co1&quot;&gt;-----------+-----------+--------------------------------------------+----------+------------------------------------------------------&lt;/span&gt;
           &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                                  &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Duluth    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                           &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                          &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Pittsburg &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Omaha     &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Omaha&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                            &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Omaha&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Duluth    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                  &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Pittsburg &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Pittsburg &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Pittsburg &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Duluth    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Duluth    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Omaha     &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Omaha&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Omaha&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Duluth    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;           &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;           &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Pittsburg &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Pittsburg &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Pittsburg &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;         &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Pittsburg &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;      &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Duluth    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;           &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Duluth    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;            &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Duluth    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;         &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Duluth    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Pittsburg &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Pittsburg &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Duluth    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; t        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nu0&quot;&gt;27&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ROWS&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This is as really cool. What's more – I didn't even had to add any condition on the is_cycle, it was sufficient that it's calculated, and processing stopped. And I can still add “WHERE is_cycle = false&quot; to weed out the connections that cycle back to city that was already visited:&lt;/p&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap5&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap4&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap3&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap2&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight-wrap&quot;&gt;
&lt;div class=&quot;wp-geshi-highlight&quot;&gt;
&lt;div class=&quot;sql&quot;&gt;
&lt;pre class=&quot;de1&quot;&gt;
$ &lt;span class=&quot;kw1&quot;&gt;WITH&lt;/span&gt; RECURSIVE c &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;NULL&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; c_from&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Chicago'&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; c_to&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; ARRAY&lt;span class=&quot;br0&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;st0&quot;&gt;'Chicago'&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;AS&lt;/span&gt; track
  &lt;span class=&quot;kw1&quot;&gt;UNION&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ALL&lt;/span&gt;
    &lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; n&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_from&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; n&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_to&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;track &lt;span class=&quot;sy0&quot;&gt;||&lt;/span&gt; n&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_to
    &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; conns n &lt;span class=&quot;kw1&quot;&gt;JOIN&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;ON&lt;/span&gt; n&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_from &lt;span class=&quot;sy0&quot;&gt;=&lt;/span&gt; c&lt;span class=&quot;sy0&quot;&gt;.&lt;/span&gt;c_to
&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt; CYCLE c_to &lt;span class=&quot;kw1&quot;&gt;SET&lt;/span&gt; is_cycle &lt;span class=&quot;kw1&quot;&gt;TO&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;TRUE&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;DEFAULT&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;FALSE&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;USING&lt;/span&gt; cycle_path
&lt;span class=&quot;kw1&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;FROM&lt;/span&gt; c &lt;span class=&quot;kw1&quot;&gt;WHERE&lt;/span&gt; is_cycle &lt;span class=&quot;sy0&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;FALSE&lt;/span&gt;;
  c_from   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt;   c_to    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt;               track                &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; is_cycle &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt;                 cycle_path                 
&lt;span class=&quot;co1&quot;&gt;-----------+-----------+------------------------------------+----------+--------------------------------------------&lt;/span&gt;
           &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                          &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Duluth    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                  &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Pittsburg &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Chicago   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Omaha     &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Omaha&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;                    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Omaha&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Pittsburg &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Pittsburg &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Duluth    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;           &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Duluth    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;           &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Pittsburg &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
 Toronto   &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; Duluth    &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;Chicago&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Pittsburg&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Toronto&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; f        &lt;span class=&quot;sy0&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;br0&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Chicago&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Pittsburg&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Toronto&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sy0&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;Duluth&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;br0&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nu0&quot;&gt;11&lt;/span&gt; &lt;span class=&quot;kw1&quot;&gt;ROWS&lt;/span&gt;&lt;span class=&quot;br0&quot;&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;All in all – both these things look amazing, and will greatly help writing queries for hierarchical data.&lt;/p&gt;
&lt;p&gt;Huge thanks to all involved 🙂&lt;/p&gt;
</description>
<pubDate>Thu, 04 Feb 2021 12:17:10 +0000</pubDate>
<dc:creator>todsacerdoti</dc:creator>
<dc:language>en-US</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.depesz.com/2021/02/04/waiting-for-postgresql-14-search-and-cycle-clauses/</dc:identifier>
</item>
<item>
<title>An open-source AirPlay mirroring server for the Raspberry Pi</title>
<link>https://github.com/FD-/RPiPlay</link>
<guid isPermaLink="true" >https://github.com/FD-/RPiPlay</guid>
<description>&lt;p&gt;An open-source implementation of an AirPlay mirroring server for the Raspberry Pi. The goal is to make it run smoothly even on a Raspberry Pi Zero.&lt;/p&gt;

&lt;p&gt;Screen mirroring and audio works for iOS 9 or newer. Recent macOS versions also seem to be compatible. The GPU is used for decoding the h264 video stream. The Pi has no hardware acceleration for audio (AirPlay mirroring uses AAC), so the FDK-AAC decoder is used for that.&lt;/p&gt;
&lt;p&gt;Both audio and video work fine on a Raspberry Pi 3B+ and a Raspberry Pi Zero, though playback is a bit smoother on the 3B+.&lt;/p&gt;
&lt;p&gt;For best performance:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Use a wired network connection&lt;/li&gt;
&lt;li&gt;Compile with -O3 (cmake --DCMAKE_CXX_FLAGS=&quot;-O3&quot; --DCMAKE_C_FLAGS=&quot;-O3&quot; ..)&lt;/li&gt;
&lt;li&gt;Make sure the DUMP flags are &lt;em&gt;not&lt;/em&gt; active&lt;/li&gt;
&lt;li&gt;Make sure you &lt;em&gt;don't&lt;/em&gt; use the -d debug log flag&lt;/li&gt;
&lt;li&gt;Make sure no other demanding tasks are running (this is particularly important for audio on the Pi Zero)&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;By using OpenSSL for AES decryption, I was able to speed up the decryption of video packets from up to 0.2 seconds to up to 0.007 seconds for large packets (On the Pi Zero). Average is now more like 0.002 seconds.&lt;/p&gt;
&lt;p&gt;There still are some minor issues. Have a look at the TODO list below.&lt;/p&gt;
&lt;p&gt;RPiPlay might not be suitable for remote video playback, as it lacks a dedicated component for that: It seems like AirPlay on an AppleTV effectively runs a web server on the device and sends the URL to the AppleTV, thus avoiding the re-encoding of the video. For rough details, refer to the (mostly obsolete) &lt;a href=&quot;https://nto.github.io/AirPlay.html#screenmirroring&quot; rel=&quot;nofollow&quot;&gt;inofficial AirPlay specification&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The following packages are required for building on Raspbian:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;cmake&lt;/strong&gt; (for the build system)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;libavahi-compat-libdnssd-dev&lt;/strong&gt; (for the bonjour registration)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;libplist-dev&lt;/strong&gt; (for plist handling)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;libssl-dev&lt;/strong&gt; (for crypto primitives)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ilclient&lt;/strong&gt; and Broadcom's OpenMAX stack as present in &lt;code&gt;/opt/vc&lt;/code&gt; in Raspbian.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;For downloading the code, use these commands:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot; readability=&quot;7&quot;&gt;
&lt;pre&gt;
git clone https://github.com/FD-/RPiPlay.git
&lt;span class=&quot;pl-c1&quot;&gt;cd&lt;/span&gt; RPiPlay
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For building on a fresh Raspbian Stretch or Buster install, these steps should be run:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot; readability=&quot;8&quot;&gt;
&lt;pre&gt;
sudo apt-get install cmake
sudo apt-get install libavahi-compat-libdnssd-dev
sudo apt-get install libplist-dev
sudo apt-get install libssl-dev
mkdir build
&lt;span class=&quot;pl-c1&quot;&gt;cd&lt;/span&gt; build
cmake ..
make
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;GCC 5 or later is required.&lt;/p&gt;

&lt;p&gt;For building on desktop linux, follow these steps as per your distribution:&lt;/p&gt;
&lt;h2&gt;Ubuntu 18.04 or 20.04&lt;/h2&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot; readability=&quot;9&quot;&gt;
&lt;pre&gt;
sudo apt-get install cmake libavahi-compat-libdnssd-dev libplist-dev libssl-dev \
    libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev gstreamer1.0-libav \
    gstreamer1.0-vaapi gstreamer1.0-plugins-bad
mkdir build
&lt;span class=&quot;pl-c1&quot;&gt;cd&lt;/span&gt; build
cmake ..
make
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Fedora 33&lt;/h2&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot; readability=&quot;9&quot;&gt;
&lt;pre&gt;
sudo dnf install cmake avahi-compat-libdns_sd-devel libplist-devel openssl-devel \
    gstreamer1-plugins-base-devel gstreamer1-libav gstreamer1-vaapi \
    gstreamer1-plugins-bad-free
mkdir build
&lt;span class=&quot;pl-c1&quot;&gt;cd&lt;/span&gt; build
cmake ..
make
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note: The -b, -r, -l, and -a options are not supported with the gstreamer renderer.&lt;/p&gt;

&lt;p&gt;After building, to install the executable on the system permanently (so it can be run from anywhere), simply run the following command:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
sudo make install
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Start the rpiplay executable and an AirPlay mirror target device will appear in the network. At the moment, these options are implemented:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;-n name&lt;/strong&gt;: Specify the network name of the AirPlay server.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;-b (on|auto|off)&lt;/strong&gt;: Show black background always, only during active connection, or never.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;-r (90|180|270)&lt;/strong&gt;: Specify image rotation in multiples of 90 degrees.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;-f (horiz|vert|both)&lt;/strong&gt;: Specify image flipping.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;-l&lt;/strong&gt;: Enables low-latency mode. Low-latency mode reduces latency by effectively rendering audio and video frames as soon as they are received, ignoring the associated timestamps. As a side effect, playback will be choppy and audio-video sync will be noticably off.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;-a (hdmi|analog|off)&lt;/strong&gt;: Set audio output device&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;-vr renderer&lt;/strong&gt;: Select a video renderer to use (rpi, gstreamer, or dummy)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;-ar renderer&lt;/strong&gt;: Select an audio renderer to use (rpi, gstreamer, or dummy)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;-d&lt;/strong&gt;: Enables debug logging. Will lead to choppy playback due to heavy console output.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;-v/-h&lt;/strong&gt;: Displays short help and version information.&lt;/p&gt;

&lt;p&gt;All the resources in this repository are written using only freely available information from the internet. The code and related resources are meant for educational purposes only. It is the responsibility of the user to make sure all local laws are adhered to.&lt;/p&gt;
&lt;p&gt;This project makes use of a third-party GPL library for handling FairPlay. The legal status of that library is unclear. Should you be a representative of Apple and have any objections against the legality of the library and its use in this project, please contact me and I'll take the appropriate steps.&lt;/p&gt;
&lt;p&gt;Given the large number of third-party AirPlay receivers (mostly closed-source) available for purchase, it is my understanding that an open source implementation of the same functionality wouldn't violate any of Apple's rights either.&lt;/p&gt;

&lt;p&gt;The code in this repository accumulated from various sources over time. Here is my attempt at listing the various authors and the components they created:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;strong&gt;dsafa22&lt;/strong&gt;: Created an &lt;a href=&quot;https://github.com/dsafa22/AirplayServer&quot;&gt;AirPlay 2 mirroring server&lt;/a&gt;(seems gone now) for Android based on ShairPlay. This project is basically a port of dsafa22's code to the Raspberry Pi, utilizing OpenMAX and OpenSSL for better performance on the Pi. All code in &lt;code&gt;lib/&lt;/code&gt; concerning mirroring is dsafa22's work. License: GNU LGPLv2.1+&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Juho Vähä-Herttua&lt;/strong&gt; and contributors: Created an AirPlay audio server called &lt;a href=&quot;https://github.com/juhovh/shairplay&quot;&gt;ShairPlay&lt;/a&gt;, including support for Fairplay based on PlayFair. Most of the code in &lt;code&gt;lib/&lt;/code&gt; originally stems from this project. License: GNU LGPLv2.1+&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;EstebanKubata&lt;/strong&gt;: Created a FairPlay library called &lt;a href=&quot;https://github.com/EstebanKubata/playfair&quot;&gt;PlayFair&lt;/a&gt;. Located in the &lt;code&gt;lib/playfair&lt;/code&gt; folder. License: GNU GPL&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Joyent, Inc and contributors&lt;/strong&gt;: Created an http library called &lt;a href=&quot;https://github.com/nodejs/llhttp&quot;&gt;llhttp&lt;/a&gt;. Located at &lt;code&gt;lib/llhttp/&lt;/code&gt;. License: MIT&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Team XBMC&lt;/strong&gt;: Managed to show a black background for OpenMAX video rendering. This code is used in the video renderer. License: GNU GPL&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Alex Izvorski and contributors&lt;/strong&gt;: Wrote &lt;a href=&quot;https://github.com/aizvorski/h264bitstream&quot;&gt;h264bitstream&lt;/a&gt;, a library for manipulation h264 streams. Used for reducing delay in the Raspberry Pi video pipeline. Located in the &lt;code&gt;renderers/h264-bitstream&lt;/code&gt; folder. License: GNU LGPLv2.1&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I'm afraid I won't have time to regularly maintain this project. Instead, I'm hoping this project can be improved in a community effort. I'll fix and add as much as I need for personal use, and I count on you to do the same!&lt;/p&gt;
&lt;p&gt;Your contributions are more than welcome!&lt;/p&gt;

&lt;ul&gt;&lt;li&gt;Bug: Sometimes cannot be stopped?&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Version 1.2&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;Blank screen after connection stopped&lt;/li&gt;
&lt;/ul&gt;&lt;h3&gt;Version 1.1&lt;/h3&gt;
&lt;ul&gt;&lt;li&gt;Now audio and video work on Raspberry Pi Zero. I don't know what exactly did the trick, but static compilation seems to have helped.&lt;/li&gt;
&lt;li&gt;Smoother video due to clock syncing&lt;/li&gt;
&lt;li&gt;Correct lip-sync due to clock syncing&lt;/li&gt;
&lt;li&gt;Lower latency due to injecting max_dec_frame_buffering into SPS NAL&lt;/li&gt;
&lt;li&gt;Disabled debug logging by default&lt;/li&gt;
&lt;li&gt;Added command line flag for debug logging&lt;/li&gt;
&lt;li&gt;Added command line flag for unsynchronized low-latency mode&lt;/li&gt;
&lt;li&gt;Bug fixes&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For multiple reasons, it's very difficult to clearly define the protocol names and versions of the components that make up the AirPlay streaming system. In fact, it seems like the AirPlay version number used for marketing differs from that used in the actual implementation. In order to tidy up this whole mess a bit, I did a little research that I'd like to summarize here:&lt;/p&gt;
&lt;p&gt;The very origin of the AirPlay protocol suite was launched as AirTunes sometime around 2004. It allowed to stream audio from iTunes to an AirPort Express station. Internally, the name of the protocol that was used was RAOP, or Remote Audio Output Protocol. It seems already back then, the protocol involved AES encryption. A public key was needed for encrypting the audio sent to an AirPort Express, and the private key was needed for receiving the protocol (ie used in the AirPort Express to decrypt the stream). Already in 2004, the public key was reverse-engineered, so that &lt;a href=&quot;http://nanocr.eu/2004/08/11/reversing-airtunes/&quot; rel=&quot;nofollow&quot;&gt;third-party sender applications&lt;/a&gt; were developed.&lt;/p&gt;
&lt;p&gt;Some time &lt;a href=&quot;https://weblog.rogueamoeba.com/2008/01/10/a-tour-of-airfoil-3/&quot; rel=&quot;nofollow&quot;&gt;around 2008&lt;/a&gt;, the protocol was revised and named AirTunes 2. It seems the changes primarily concerned timing. By 2009, the new protocol was &lt;a href=&quot;https://git.zx2c4.com/Airtunes2/about/&quot; rel=&quot;nofollow&quot;&gt;reverse-engineered and documented&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;When the Apple TV 2nd generation was introduced in 2010, it received support for the AirTunes protocol. However, because this device allowed playback of visual content, the protocol was extended and renamed AirPlay. It was now possible to stream photo slideshows and videos. Shortly after the release of the Apple TV 2nd generation, AirPlay support for iOS was included in the iOS 4.2 update. It seems like at that point, the audio stream was still actually using the same AirTunes 2 protocol as described above. The video and photo streams were added as a whole new protocol based on HTTP, pretty much independent from the audio stream. Soon, the first curious developers began to &lt;a href=&quot;https://web.archive.org/web/20101211213705/http://www.tuaw.com/2010/12/08/dear-aunt-tuaw-can-i-airplay-to-my-mac/&quot; rel=&quot;nofollow&quot;&gt;investigate how it worked&lt;/a&gt;. Their conclusion was that visual content is streamed unencrypted.&lt;/p&gt;
&lt;p&gt;In April 2011, a talented hacker &lt;a href=&quot;http://www.macrumors.com/2011/04/11/apple-airplay-private-key-exposed-opening-door-to-airport-express-emulators/&quot; rel=&quot;nofollow&quot;&gt;extracted the AirPlay private key&lt;/a&gt; from an AirPort Express. This meant that finally, third-party developers were able to also build AirPlay reveiver (server) programs.&lt;/p&gt;
&lt;p&gt;For iOS 5, released in 2011, Apple added a new protocol to the AirPlay suite: AirPlay mirroring. &lt;a href=&quot;https://www.aorensoftware.com/blog/2011/08/20/exploring-airplay-mirroring-internals/&quot; rel=&quot;nofollow&quot;&gt;Initial investigators&lt;/a&gt; found this new protocol used encryption in order to protect the transferred video data.&lt;/p&gt;
&lt;p&gt;By 2012, most of AirPlay's protocols had been reverse-engineered and &lt;a href=&quot;https://nto.github.io/AirPlay.html&quot; rel=&quot;nofollow&quot;&gt;documented&lt;/a&gt;. At this point, audio still used the AirTunes 2 protocol from around 2008, video, photos and mirroring still used their respective protocols in an unmodified form, so you could still speak of AirPlay 1 (building upon AirTunes 2). The Airplay server running on the Apple TV reported as version 130. The setup of AirPlay mirroring used the xml format, in particular a stream.xml file. Additionally, it seems like the actual audio data is using the ALAC codec for audio-only (AirTunes 2) streaming and AAC for mirror audio. At least these different formats were used in &lt;a href=&quot;https://github.com/espes/Slave-in-the-Magic-Mirror/issues/12#issuecomment-372380451&quot;&gt;later iOS versions&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Sometime before iOS 9, the protocol for mirroring was slightly modified: Instead of the &quot;stream.xml&quot; API endpoint, the same information could also be querried in binary plist form, just by changing the API endpoint to &quot;stream&quot;, without any extension. I wasn't able to figure out which of these was actually used by what specific client / server versions.&lt;/p&gt;
&lt;p&gt;For iOS 9, Apple made &lt;a href=&quot;https://9to5mac.com/2015/09/11/apple-ios-9-airplay-improvements-screen-mirroring/&quot; rel=&quot;nofollow&quot;&gt;considerable changes&lt;/a&gt; to the AirPlay protocol in 2015, including audio and mirroring. Apparently, the audio protocol was only slightly modified, and a &lt;a href=&quot;https://github.com/juhovh/shairplay/issues/43&quot;&gt;minor change&lt;/a&gt; restored compatibility. For mirroring, an &lt;a href=&quot;https://github.com/juhovh/shairplay/issues/43#issuecomment-142115959&quot;&gt;additional pairing phase&lt;/a&gt; was added to the connection establishment procedure, consisting of pair-setup and pair-verify calls. Seemingly, these were added in order to simplify usage with devices that are connected frequently. Pair-setup is used only the first time an iOS device connects to an AirPlay receiver. The generated cryptographic binding can be used for pair-verify in later sessions. Additionally, the stream / stream.xml endpoint was replaced with the info endpoint (only available as binary plist AFAICT). As of iOS 12, the protocol introduced with iOS 9 was still supported with only slight modifications, albeit as a legacy mode. While iOS 9 used two SETUP calls (one for general connection and mirroring video, and one for audio), iOS 12 legacy mode uses 3 SETUP calls (one for general connection (timing and events), one for mirroring video, one for audio).&lt;/p&gt;
&lt;p&gt;The release of tvOS 10.2 broke many third-party AirPlay sender (client) programs in 2017. The reason was that it was now mandatory to perform device verification via a pin in order to stream content to an Apple TV. The functionality had been in the protocol before, but was not mandatory. Some discussion about the new scheme can be found &lt;a href=&quot;https://github.com/postlund/pyatv/issues/79&quot;&gt;here&lt;/a&gt;. A full specification of the pairing and authentication protocol was made available on &lt;a href=&quot;https://htmlpreview.github.io/?https://github.com/philippe44/RAOP-Player/blob/master/doc/auth_protocol.html&quot; rel=&quot;nofollow&quot;&gt;GitHub&lt;/a&gt;. At that point, tvOS 10.2 reported as AirTunes/320.20.&lt;/p&gt;
&lt;p&gt;In tvOS 11, the reported server version was &lt;a href=&quot;https://github.com/ejurgensen/forked-daapd/issues/377#issuecomment-309213273&quot;&gt;increased to 350.92.4&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;iOS 11.4 added AirPlay 2 in 2018. Although extensively covered by the media, it's not entirely clear what changes specifically Apple has made protocol-wise.&lt;/p&gt;
&lt;p&gt;From captures of the traffic between an iOS device running iOS 12.2 and an AppleTV running tvOS 12.2.1, one can see that the communication on the main mirroring HTTP connection is encrypted after the initial handshake. This could theoretically be part of the new AirPlay 2 protocol. The AppleTV running tvOS 12.2.1 identifies as AirTunes/380.20.1. When connecting from the same iOS device to an AppleTV 3rd generation (reporting as AirTunes/220.68), the communication is still visible in plain. From the log messages that the iOS device produces when connected to an AppleTV 3rd generation, it becomes apparent that the iOS device is treating this plain protocol as the legacy protocol (as originally introduced with iOS 9). Further research showed that at the moment, all available third-party AirPlay mirroring receivers (servers) are using this legacy protocol, including the open source implementation of dsafa22, which is the base for RPiPlay. Given Apple considers this a legacy protocol, it can be expected to be removed entirely in the future. This means that all third-party AirPlay receivers will have to be updated to the new (fully encrypted) protocol at some point.&lt;/p&gt;
&lt;p&gt;More specifically, the encryption starts after the pair-verify handshake completed, so the fp-setup handshake is already happening encrypted. Judging from the encryption scheme for AirPlay video (aka HLS Relay), likely two AES GCM 128 ciphers are used on the socket communication (one for sending, one for receiving). However, I have no idea how the keys are derived from the handshake data.&lt;/p&gt;
</description>
<pubDate>Thu, 04 Feb 2021 10:45:44 +0000</pubDate>
<dc:creator>chetangoti</dc:creator>
<og:image>https://avatars.githubusercontent.com/u/3320822?s=400&amp;v=4</og:image>
<og:type>object</og:type>
<og:title>FD-/RPiPlay</og:title>
<og:url>https://github.com/FD-/RPiPlay</og:url>
<og:description>An open-source AirPlay mirroring server for the Raspberry Pi. Supports iOS 9 and up. - FD-/RPiPlay</og:description>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://github.com/FD-/RPiPlay</dc:identifier>
</item>
<item>
<title>Localize your cat at home with BLE beacon, ESP32s, and Machine Learning</title>
<link>https://github.com/filipsPL/cat-localizer</link>
<guid isPermaLink="true" >https://github.com/filipsPL/cat-localizer</guid>
<description>&lt;p&gt;&lt;strong&gt;tl;dr / abstract&lt;/strong&gt;. System which can be used for localization the position of a cat in a building using bluetooth low energy (BLE) beacons attached to the object, a set of cheap ESP32 detectors, and Machine Learning models.&lt;/p&gt;

&lt;p&gt;This is an overwiev of a pipeline for creating an inhouse cat localizator. Actually, it can be applied to any animal (including humans) or object, and any building. The system works as follows:&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://github.com/filipsPL/cat-localizer/blob/main/obrazki/README-8d01da21.png&quot;&gt;&lt;img src=&quot;https://github.com/filipsPL/cat-localizer/raw/main/obrazki/README-8d01da21.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;The cat with a small BLE beacon, is emiting BLE signals&lt;/li&gt;
&lt;li&gt;BLE signal is detected by ESP32s located here and there; they are measuring he signal strength of the BLE beacon.&lt;/li&gt;
&lt;li&gt;Each ESP32 sends data to the server (database)&lt;/li&gt;
&lt;li&gt;The python program is fetching the last measurements from all ESP32 detectors (i.e., signal strenght values)&lt;/li&gt;
&lt;li&gt;Using trained machine learning models it predicts the location of the cat&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;💡 The challenge here is to use a number of detectors which is significantly lower than the number of rooms and make ML do the rest.&lt;/p&gt;
&lt;p&gt;💡 This is &lt;em&gt;not a ready-to-use&lt;/em&gt; set of programs. As each situation is different (i.e, hardware setup, house size, number of rooms etc), please treat this repo as a framework to build and customize your own system.&lt;/p&gt;

&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Moving object to track.&lt;/strong&gt; A cat. A dog is also fine. Be careful with fishes. Can be more than one. I used two cats. 💰 ~ 0 $&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BLE Transmitters&lt;/strong&gt;. &lt;a href=&quot;https://en.wikipedia.org/wiki/Bluetooth_low_energy_beacon&quot; rel=&quot;nofollow&quot;&gt;A BLE beacon&lt;/a&gt;. Anything will be good. I used &lt;a href=&quot;https://notione.com/&quot; rel=&quot;nofollow&quot;&gt;NotiOne&lt;/a&gt; buttons, they work well and has an additional functionality (not used here). But something cheaper will work too. 💰 n x 10-20 $&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BLE detectors&lt;/strong&gt;. I used four ESP32. I guess 4-6 for moderate house/flat should be enough. One can use also modern raspberry pi with BLE. 💰 n x 4 $&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Data processing&lt;/strong&gt;. A server/computer. I worked with amd64 Debian, but any Raspberry Pi should be also good. Can be remote.&lt;/li&gt;
&lt;li&gt;WiFi Connectivity (ESPs to the server)&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;Optional:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;LCD display showing the current location of the cat. I'm using TTGO1&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;BLE beacon&lt;/h2&gt;
&lt;p&gt;Nothing to configure nor code here :-)&lt;/p&gt;
&lt;h2&gt;Detectors&lt;/h2&gt;
&lt;h3&gt;ESP32&lt;/h3&gt;
&lt;p&gt;I provide a simple C/Arduino code for the detector. Of course it can do much more (my ESPs also measure temperature, humidity and other parameters):&lt;/p&gt;
&lt;p&gt;Many things can be tuned and optimized (eg array of MAC addreses instead of single variables, reading MAC addresses from the server etc).&lt;/p&gt;
&lt;h3&gt;Raspberry Pi&lt;/h3&gt;
&lt;p&gt;(this solution was not thoroughly tested!)&lt;/p&gt;
&lt;p&gt;Raspberry Pi with a BLE capability can be included in the set of detectors. The commands here are:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot; readability=&quot;7&quot;&gt;
&lt;pre&gt;
btmon &lt;span class=&quot;pl-k&quot;&gt;&amp;amp;&lt;/span&gt;
hcitool lescan --duplicates &lt;span class=&quot;pl-k&quot;&gt;|&lt;/span&gt; grep MAC
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and next sending to the database.&lt;/p&gt;
&lt;h2&gt;On the server&lt;/h2&gt;
&lt;h3&gt;0. Data source&lt;/h3&gt;
&lt;p&gt;We need a server with a database. I use influx, but any will be good (MySQL or even text files!)&lt;/p&gt;
&lt;h3&gt;1. Python environment&lt;/h3&gt;
&lt;p&gt;I used Python 3.8.&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;libraries: scikit and pandas, and whatever is needed to fetch data from the database&lt;/li&gt;
&lt;li&gt;please see a sample conda environment file to see what is my setup&lt;/li&gt;
&lt;li&gt;remember that the trained ML models must be next used in the same environment (the same scikit and numpy version!); this can be guaranteed by using the dedicated cond environment&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;Sample conda environment can be impotred by issuing (this is a single time procedure):&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;conda env create -f cat-localizer.yml
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;and activated by:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;conda activate cat-localizer
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Training of ML models can be done on any computer (eg laptop) and next models transfered to the main server. Remember to keep the same modules version (use conda environment). See the next section on model training.&lt;/p&gt;
&lt;h3&gt;2. Program for cat localization prediction&lt;/h3&gt;
&lt;p&gt;When models are trained and ready (see the next section), we use python program to fetch last BLE signal strength data and - basing on this - predict localization of the cat. Please see the section &lt;a href=&quot;https://github.com/filipsPL/cat-localizer#detecting&quot;&gt;Detecting&lt;/a&gt; for more info and code samples.&lt;/p&gt;

&lt;h2&gt;Data collection&lt;/h2&gt;
&lt;p&gt;Here we collect data for training ML algorithms. This means we have to collect signal strength data from all sensors WITH associated localization of the beacon. I.e, lets assume we have four ESP32 sensors, we need to create table like this one:&lt;/p&gt;
&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;measurement id&lt;/th&gt;
&lt;th&gt;time&lt;/th&gt;
&lt;th&gt;target&lt;/th&gt;
&lt;th&gt;esp32-attic&lt;/th&gt;
&lt;th&gt;esp32-room_k&lt;/th&gt;
&lt;th&gt;esp32-office&lt;/th&gt;
&lt;th&gt;esp32-doors&lt;/th&gt;
&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;2021-01-03 15:32&lt;/td&gt;
&lt;td&gt;office&lt;/td&gt;
&lt;td&gt;-71.0&lt;/td&gt;
&lt;td&gt;-110.0&lt;/td&gt;
&lt;td&gt;-71.5&lt;/td&gt;
&lt;td&gt;-83.0&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;2021-01-03 15:33&lt;/td&gt;
&lt;td&gt;office&lt;/td&gt;
&lt;td&gt;-73.0&lt;/td&gt;
&lt;td&gt;-110.0&lt;/td&gt;
&lt;td&gt;-82.5&lt;/td&gt;
&lt;td&gt;-82.5&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;2021-01-03 15:34&lt;/td&gt;
&lt;td&gt;office&lt;/td&gt;
&lt;td&gt;-81.0&lt;/td&gt;
&lt;td&gt;-110.0&lt;/td&gt;
&lt;td&gt;-80.0&lt;/td&gt;
&lt;td&gt;-87.5&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;2021-01-03 15:35&lt;/td&gt;
&lt;td&gt;office&lt;/td&gt;
&lt;td&gt;-75.0&lt;/td&gt;
&lt;td&gt;-110.0&lt;/td&gt;
&lt;td&gt;-86.5&lt;/td&gt;
&lt;td&gt;-86.5&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;2021-01-03 15:36&lt;/td&gt;
&lt;td&gt;office&lt;/td&gt;
&lt;td&gt;-72.5&lt;/td&gt;
&lt;td&gt;-110.0&lt;/td&gt;
&lt;td&gt;-78.5&lt;/td&gt;
&lt;td&gt;-81.0&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;...&lt;/td&gt;
&lt;td&gt;...&lt;/td&gt;
&lt;td&gt;...&lt;/td&gt;
&lt;td&gt;...&lt;/td&gt;
&lt;td&gt;...&lt;/td&gt;
&lt;td&gt;...&lt;/td&gt;
&lt;td&gt;...&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;236&lt;/td&gt;
&lt;td&gt;2021-01-03 21:56&lt;/td&gt;
&lt;td&gt;room_k&lt;/td&gt;
&lt;td&gt;-100.5&lt;/td&gt;
&lt;td&gt;-67.5&lt;/td&gt;
&lt;td&gt;-110.0&lt;/td&gt;
&lt;td&gt;-91.5&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;237&lt;/td&gt;
&lt;td&gt;2021-01-03 21:57&lt;/td&gt;
&lt;td&gt;room_k&lt;/td&gt;
&lt;td&gt;-86.0&lt;/td&gt;
&lt;td&gt;-60.0&lt;/td&gt;
&lt;td&gt;-110.0&lt;/td&gt;
&lt;td&gt;-91.5&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;238&lt;/td&gt;
&lt;td&gt;2021-01-03 21:58&lt;/td&gt;
&lt;td&gt;room_k&lt;/td&gt;
&lt;td&gt;-88.5&lt;/td&gt;
&lt;td&gt;-93.5&lt;/td&gt;
&lt;td&gt;-110.0&lt;/td&gt;
&lt;td&gt;-91.5&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;239&lt;/td&gt;
&lt;td&gt;2021-01-03 21:59&lt;/td&gt;
&lt;td&gt;room_k&lt;/td&gt;
&lt;td&gt;-86.0&lt;/td&gt;
&lt;td&gt;-75.0&lt;/td&gt;
&lt;td&gt;-110.0&lt;/td&gt;
&lt;td&gt;-91.5&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;240&lt;/td&gt;
&lt;td&gt;2021-01-03 22:00&lt;/td&gt;
&lt;td&gt;room_k&lt;/td&gt;
&lt;td&gt;-87.0&lt;/td&gt;
&lt;td&gt;-72.0&lt;/td&gt;
&lt;td&gt;-110.0&lt;/td&gt;
&lt;td&gt;-84.5&lt;/td&gt;
&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;where each row (measurement) represent RSSI values read from beacon at a given location &lt;strong&gt;at the same time&lt;/strong&gt;. Please see &lt;a href=&quot;https://github.com/filipsPL/cat-localizer/blob/main/4-ML/1-process_data.ipynb&quot;&gt;jupyter notebook&lt;/a&gt; for the data preprocessing.&lt;/p&gt;
&lt;p&gt;When this table is ready, we can go further and train ML models.&lt;/p&gt;
&lt;p&gt;The number of data points (i.e, different locations of BLE beacon) for each room is variable and depends on the room size. In my case it was like here:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;room           no of measurements
bathroom_d      11
bathroom_g      30
living_room    101
office          38
room_k          32
room_m          28
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Remember to sample space available for your cats, so not only flors, but also tables, wardrobes, or chandelier etc ;-)&lt;/p&gt;
&lt;h2&gt;Algorithms evaluation and models training&lt;/h2&gt;
&lt;p&gt;Now we will probe several preprocessing algorithms together with several Machine Learning methods. We don't know which one will be the best in our case, so we will probe them all in a cross-validation experiment.&lt;/p&gt;
&lt;p&gt;Please see &lt;a href=&quot;https://github.com/filipsPL/cat-localizer/blob/main/4-ML/1-process_data.ipynb&quot;&gt;jupyter notebook&lt;/a&gt; for the exact pipeline.&lt;/p&gt;
&lt;p&gt;The final models will be build with at 75% of the dataset (training), while 25% will seve as a testing dataset.&lt;/p&gt;
&lt;h2&gt;Conclusions&lt;/h2&gt;
&lt;p&gt;The ML algos cv results is shown here (balanced accuracy values are shown):&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://github.com/filipsPL/cat-localizer/blob/main/obrazki/README-a7db4c56.png&quot;&gt;&lt;img src=&quot;https://github.com/filipsPL/cat-localizer/raw/main/obrazki/README-a7db4c56.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;we can see that in our case, the MLP Classifier with Min-Max Scaler gives the best results.&lt;/p&gt;
&lt;p&gt;Let's see if we can go any further with some features engeneering:&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://github.com/filipsPL/cat-localizer/blob/main/obrazki/README-ef170c08.png&quot;&gt;&lt;img src=&quot;https://github.com/filipsPL/cat-localizer/raw/main/obrazki/README-ef170c08.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The nswer is no. The best accuracy here is the same as an initial setup (0.83), so we will stay with the MLP Classifier with Min-Max Scaler.&lt;/p&gt;
&lt;p&gt;The final models build with MLP Classifier with Min-Max Scaler gives the balanced accuracy equal 0.88. Very good! If we look at the confusion matrix:&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://github.com/filipsPL/cat-localizer/blob/main/obrazki/README-456edd00.png&quot;&gt;&lt;img src=&quot;https://github.com/filipsPL/cat-localizer/raw/main/obrazki/README-456edd00.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;we will see that (believe me or not) all miss-labelled predictions are for locations which are close to each other (eg. room_m is close in space to the office etc.). So this makes a perfect sense.&lt;/p&gt;

&lt;p&gt;For the detection you can use the code snippet in the section 6 of &lt;a href=&quot;https://github.com/filipsPL/cat-localizer/blob/main/4-ML/1-process_data.ipynb#Reuse-saved-models-for-new-predictions&quot;&gt;jupyter notebook&lt;/a&gt; or the code of the &lt;a href=&quot;https://github.com/filipsPL/cat-localizer/blob/main/3-server/localize-cat.py&quot;&gt;simple program&lt;/a&gt;. The program uses numpy array as a data source, but it can be read from the file or fetched from the database.&lt;/p&gt;

&lt;ul&gt;&lt;li&gt;gathering data for training ML. I used 1-minutes interval of collecting data. This gave me time to change the position of beacons in the room. Measurements were automatically stored in the database (influx). I noted the time span of collectiong data in a given room and then fetched data from db for this time period, assigned a room label, and saved in a csv file.&lt;/li&gt;
&lt;li&gt;for collection of data for a flat surfaces (floors) you can use devices such as roomba with beacons attached at the top of it. Works fine!&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;&lt;li&gt;Optimization of the position of ESP32 detectors, to cover whole space and give unique signal patterns for each rooms&lt;/li&gt;
&lt;li&gt;Optimization of ML algorithms and parameters&lt;/li&gt;
&lt;li&gt;Increasing number of ESP32 detectors (but this is not a chalenge :))&lt;/li&gt;
&lt;li&gt;(?) Take into account the battery level of the BLE beacon, as this could have impact on the transmitting power. I'm not sure.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;&lt;li&gt;after some time of collecting the localization data for objects, we may create another ML model for predicting the localization of object in time (i.e., if it is Monday morning, the cat is near the fridge, if it is Saturday afternoon, the cat is sleeping in the bathroom, etc). This could involve another variables, like room temperature, humidity etc.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;&lt;li&gt;wikimedia commons and openclipart library for cool graphics (especially the cat!)&lt;/li&gt;
&lt;/ul&gt;</description>
<pubDate>Thu, 04 Feb 2021 09:39:57 +0000</pubDate>
<dc:creator>lormayna</dc:creator>
<og:image>https://avatars.githubusercontent.com/u/11406606?s=400&amp;v=4</og:image>
<og:type>object</og:type>
<og:title>filipsPL/cat-localizer</og:title>
<og:url>https://github.com/filipsPL/cat-localizer</og:url>
<og:description>Localize your cat at home with BLE beacon, ESP32s, and Machine Learning - filipsPL/cat-localizer</og:description>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://github.com/filipsPL/cat-localizer</dc:identifier>
</item>
<item>
<title>Amazon shortchanged drivers $61.7M in tips</title>
<link>https://www.washingtonpost.com/technology/2021/02/02/amazon-ftc-tip-settlement/</link>
<guid isPermaLink="true" >https://www.washingtonpost.com/technology/2021/02/02/amazon-ftc-tip-settlement/</guid>
<description>&lt;div readability=&quot;14&quot;&gt;
&lt;p data-el=&quot;text&quot; class=&quot;font--body font-copy gray-darkest ma-0 pb-md&quot;&gt;“Rather than passing along 100 percent of customers’ tips to drivers, as it had promised to do, Amazon used the money itself,” Daniel Kaufman, acting director of the FTC’s Bureau of Consumer Protection, said in a statement.&lt;/p&gt;
&lt;/div&gt;
&lt;div readability=&quot;8&quot;&gt;
&lt;p data-el=&quot;text&quot; class=&quot;font--body font-copy gray-darkest ma-0 pb-md&quot;&gt;Amazon’s tip-reimbursement policy was not vague, spokeswoman Rena Lunak said in a statement.&lt;/p&gt;
&lt;/div&gt;

&lt;div readability=&quot;10&quot;&gt;
&lt;p data-el=&quot;text&quot; class=&quot;font--body font-copy gray-darkest ma-0 pb-md&quot;&gt;“While we disagree that the historical way we reported pay to drivers was unclear, we added additional clarity in 2019 and are pleased to put this matter behind us,” Lunak said.&lt;/p&gt;
&lt;/div&gt;


&lt;div readability=&quot;7&quot;&gt;
&lt;p data-el=&quot;text&quot; class=&quot;font--body font-copy gray-darkest ma-0 pb-md&quot;&gt;(Amazon chief executive Jeff Bezos owns The Washington Post.)&lt;/p&gt;
&lt;/div&gt;
&lt;div readability=&quot;12&quot;&gt;
&lt;p data-el=&quot;text&quot; class=&quot;font--body font-copy gray-darkest ma-0 pb-md&quot;&gt;Internally, Amazon employees worried that disclosure of the company’s handling of driver tips could ignite an “Amazon reputation tinderbox,” and turn into “a huge PR risk to Amazon,” the FTC disclosed in announcing the fine.&lt;/p&gt;
&lt;/div&gt;
&lt;div readability=&quot;12&quot;&gt;
&lt;p data-el=&quot;text&quot; class=&quot;font--body font-copy gray-darkest ma-0 pb-md&quot;&gt;The agency alleged Amazon advertised that contract drivers in its Flex program, which delivers goods for its Prime Now and AmazonFresh services, would receive $18 to $25 an hour and keep 100 percent of the tips, which customers pay through the Amazon app.&lt;/p&gt;
&lt;/div&gt;

&lt;div readability=&quot;12&quot;&gt;
&lt;p data-el=&quot;text&quot; class=&quot;font--body font-copy gray-darkest ma-0 pb-md&quot;&gt;The FTC alleges Amazon changed the way it paid drivers in late 2016, lowering the hourly rate and then used customer tips to make up the difference. Amazon continued to tell drivers they were receiving all of their tips, even after receiving hundreds of complaints from drivers, the agency said.&lt;/p&gt;
&lt;/div&gt;
&lt;div readability=&quot;11&quot;&gt;
&lt;p data-el=&quot;text&quot; class=&quot;font--body font-copy gray-darkest ma-0 pb-md&quot;&gt;The FTC said it will refund all of the payments to drivers who were shorted. Law precludes the agency from additionally fining the company, FTC Commissioner Noah Joshua Phillips said during a news conference Tuesday. But the settlement opens Amazon to monetary fines if it engages in skimming tips again.&lt;/p&gt;
&lt;/div&gt;
</description>
<pubDate>Thu, 04 Feb 2021 03:10:42 +0000</pubDate>
<dc:creator>ummonk</dc:creator>
<og:type>article</og:type>
<og:url>https://www.washingtonpost.com/technology/2021/02/02/amazon-ftc-tip-settlement/</og:url>
<og:image>https://www.washingtonpost.com/wp-apps/imrs.php?src=https://arc-anglerfish-washpost-prod-washpost.s3.amazonaws.com/public/GE7LJNCQ7AI6XIPV7WXSRT6KSA.jpg&amp;w=1440</og:image>
<og:title>Amazon shortchanged drivers $61.7 million in tips. Now it has settled with the FTC to pay up.</og:title>
<og:description>The e-commerce giant internally feared that disclosure that it was stiffing its drivers would ignite an “Amazon reputation tinderbox.&quot;</og:description>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.washingtonpost.com/technology/2021/02/02/amazon-ftc-tip-settlement/</dc:identifier>
</item>
<item>
<title>Parler CEO says he was fired by board</title>
<link>https://www.reuters.com/article/ctech-us-parler-ceo-idCAKBN2A33B0-OCATC</link>
<guid isPermaLink="true" >https://www.reuters.com/article/ctech-us-parler-ceo-idCAKBN2A33B0-OCATC</guid>
<description>&lt;div class=&quot;ArticleBody-byline-container-3H6dy&quot; readability=&quot;33&quot;&gt;
&lt;p class=&quot;Byline-byline-1sVmo ArticleBody-byline-10B7D&quot;&gt;By &lt;span class=&quot;TextLabel__text-label___3oCVw TextLabel__black___2FN-Z TextLabel__serif___3lOpX Byline-author-2BSir&quot; target=&quot;_blank&quot;&gt;Elizabeth Culliford&lt;/span&gt;, &lt;span class=&quot;TextLabel__text-label___3oCVw TextLabel__black___2FN-Z TextLabel__serif___3lOpX Byline-author-2BSir&quot; target=&quot;_blank&quot;&gt;Katie Paul&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;ArticleBody-read-time-and-social-2VOIr&quot;&gt;
&lt;p class=&quot;TextLabel__text-label___3oCVw TextLabel__gray___1V4fk TextLabel__small-all-caps-spaced-out___3O9H4 ReadTime-read-time-1s3CG ArticleBody-read-time-29pGN&quot;&gt;2 Min Read&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;(Reuters) - The board of Parler, a social media platform backed by Republican Party donor Rebekah Mercer and favored by U.S conservatives, has fired its CEO John Matze, he said on Wednesday.&lt;/p&gt;

&lt;p&gt;FILE PHOTO: A screengrab of Parler.com website and Parler CEO John Matze's message on January 16, 2021, reading &quot;Hello world, is this thing on?&quot;, seen in this picture obtained on January 17, 2021 from social media. PARLER.COM WEBSITE /via REUTERS T&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;Matze confirmed the move to Reuters, after it was originally reported by Fox News, and said that he had not been given a settlement.&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;“On January 29, 2021, the Parler board controlled by Rebekah Mercer decided to immediately terminate my position as CEO of Parler. I did not participate in this decision,” Matze said in a memo sent to Parler staff.&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;“Over the past few months, I’ve met constant resistance to my product vision, my strong belief in free speech and my view of how the Parler site should be managed.”&lt;/p&gt;

&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;He told Reuters that Parler now has an “executive committee” consisting of Matthew Richardson and Mark Meckler.&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;Mercer, Richardson, Meckler and Parler did not immediately respond to requests for comment.&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;Parler remains largely offline after being dropped by Seattle-based Amazon’s cloud-hosting division and the app stores of Apple Inc and Alphabet Inc’s Google following the Jan. 6 siege of the U.S. Capitol.&lt;/p&gt;

&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;The companies cited Parler’s record of policing violent content, after far-right groups spread violent rhetoric on the platform ahead of the unrest in Washington.&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;Parler, which was founded in 2018 and has claimed it has over 12 million users, has styled itself as a “free speech-driven” space.&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;The app has largely attracted U.S. conservatives who disagree with rules around content on social media sites like Facebook Inc and Twitter Inc.&lt;/p&gt;
&lt;p class=&quot;Paragraph-paragraph-2Bgue ArticleBody-para-TD_9x&quot;&gt;Matze told Reuters on Jan. 13 that Parler may be offline for good, but later pledged it would return stronger.&lt;/p&gt;
&lt;div readability=&quot;7.0094786729858&quot;&gt;
&lt;div class=&quot;Attribution-attribution-Y5JpY&quot; readability=&quot;10&quot;&gt;
&lt;p&gt;Reporting by Kanishka Singh in Bengaluru, Elizabeth Culliford in New York and Katie Paul in Palo Alto; Editing by Chris Reese, Cynthia Osterman and Sam Holmes&lt;/p&gt;
&lt;/div&gt;

&lt;/div&gt;
</description>
<pubDate>Thu, 04 Feb 2021 00:41:46 +0000</pubDate>
<dc:creator>mrzimmerman</dc:creator>
<og:title>Parler CEO John Matze says he was fired by board</og:title>
<og:description>The board of Parler, a social media platform backed by Republican Party donor Rebekah Mercer and favored by U.S conservatives, has fired its CEO John Matze, he said on Wednesday.</og:description>
<og:image>https://static.reuters.com/resources/r/?m=02&amp;d=20210204&amp;t=2&amp;i=1550258318&amp;r=LYNXMPEH1300X-OCATC&amp;w=800</og:image>
<og:url>https://www.reuters.com/article/ctech-us-parler-ceo-idCAKBN2A33B0-OCATC</og:url>
<og:type>article</og:type>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.reuters.com/article/ctech-us-parler-ceo-idCAKBN2A33B0-OCATC</dc:identifier>
</item>
</channel>
</rss>