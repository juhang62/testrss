<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="css/feed.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:media="http://search.yahoo.com/mrss/" xmlns:og="http://ogp.me/ns#">
<channel>
<atom:link rel="self" href="http://192.168.1.4/fivefilters/makefulltextfeed.php?url=hnrss.org%2Fnewest%3Fpoints%3D200&amp;max=10&amp;links=preserve&amp;exc=" />
<atom:link rel="alternate" title="Source URL" href="http://hnrss.org/newest?points=200" />
<atom:link rel="related" title="Subscribe to feed" href="http://www.subtome.com/#/subscribe?feeds=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dhnrss.org%252Fnewest%253Fpoints%253D200%26max%3D10%26links%3Dpreserve%26exc%3D&amp;back=http%3A%2F%2F192.168.1.4%2Ffivefilters%2Fmakefulltextfeed.php%3Furl%3Dhnrss.org%252Fnewest%253Fpoints%253D200%26max%3D10%26links%3Dpreserve%26exc%3D" />
<title>Hacker News: Newest</title>
<link>https://news.ycombinator.com/newest</link>
<description>Hacker News RSS</description>
<item>
<title>What ORMs have taught me: just learn SQL (2014)</title>
<link>https://wozniak.ca/blog/2014/08/03/What-ORMs-have-taught-me-just-learn-SQL/</link>
<guid isPermaLink="true" >https://wozniak.ca/blog/2014/08/03/What-ORMs-have-taught-me-just-learn-SQL/</guid>
<description>&lt;p&gt;Perhaps the most subversive issue I’ve had with ORMs is “attribute creep” or “wide tables”, that is, tables that just keep accruing attributes. As much as I’d like to avoid it, sometimes it becomes necessary (although things like &lt;a href=&quot;http://www.postgresql.org/docs/9.3/interactive/hstore.html&quot;&gt;Postgres’ hstore&lt;/a&gt; can help). For example, a client may be providing you with lots of data that they want attached to reports based on various business logic. Furthermore, you don’t have much insight into this data; you’re just schlepping it around.&lt;/p&gt;
&lt;p&gt;This in and of itself isn’t a terrible thing in a database. It becomes a real pain point with an ORM. Specifically, the problem starts to show up in any query that uses the entity directly to create the query. You may have a Hibernate query like so early on in the project.&lt;/p&gt;
&lt;pre class=&quot;example&quot;&gt;
query(Foo.class).add(Restriction.eq(&quot;x&quot;, value))
&lt;/pre&gt;
&lt;p&gt;This may be fine when Foo has five attributes, but becomes a data fire hose when it has a hundred. This is the equivalent of using &lt;code&gt;SELECT *&lt;/code&gt;, which is usually saying more than what is intended. ORMs, however, encourage this use and often make writing precise projections as tedious as they are in SQL. (I have optimized such queries by adding the appropriate projection and reduced the run time from minutes to seconds; all the time was spent translating the database row into a Java object.)&lt;/p&gt;
&lt;p&gt;Which leads to another bad experience: the pernicious use of foreign keys. In the ORMs I’ve used, links between classes are represented in the data model as foreign keys which, if not configured carefully, result in a large number of joins when retrieving the object. (A recent count of one such table in my work resulted in over 600 attributes and 14 joins to access a single object, using the preferred query methodology.)&lt;/p&gt;
&lt;p&gt;Attribute creep and excessive use of foreign keys shows me is that in order to use ORMs effectively, you still need to know SQL. My contention with ORMs is that, if you need to know SQL, just use SQL since it prevents the need to know how non-SQL gets translated to SQL.&lt;/p&gt;
</description>
<pubDate>Fri, 20 Sep 2019 20:54:23 +0000</pubDate>
<dc:creator>BerislavLopac</dc:creator>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://wozniak.ca/blog/2014/08/03/What-ORMs-have-taught-me-just-learn-SQL/</dc:identifier>
</item>
<item>
<title>AMD Ryzen Threadripper 3000 32-core CPU is more bad news for Intel</title>
<link>https://www.zdnet.com/article/amd-ryzen-threadripper-3000-32-core-cpu-is-more-bad-news-for-intel/</link>
<guid isPermaLink="true" >https://www.zdnet.com/article/amd-ryzen-threadripper-3000-32-core-cpu-is-more-bad-news-for-intel/</guid>
<description>&lt;p&gt;While there's been little official word on AMD's 3rd-generation Threadripper chips, the chip has made an appearance over on &lt;a href=&quot;https://browser.geekbench.com/v5/cpu/170821&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Geekbench&lt;/a&gt;. And while the results suggest that this chip may not deliver the stratospheric improvements that the 2nd-gen chip did compared to the original silicon, it's more than enough to stay ahead of Intel's flagship chip.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Must read&lt;/strong&gt;: &lt;a href=&quot;https://www.zdnet.com/article/iphone-11-iphone-11-pro-and-iphone-11-pro-max-what-are-the-differences/&quot;&gt;&lt;strong&gt;iPhone 11, iPhone 11 Pro, and iPhone 11 Pro Max: What are the differences?&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The results, which allegedly are for the 32-core Threadripper 3000, were spotted over on Twitter by &lt;a href=&quot;https://twitter.com/momomo_us/status/1174142925699051520&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;momomo-us&lt;/a&gt; over on Twitter.&lt;/p&gt;

&lt;p&gt;This fits in well with &lt;a href=&quot;https://www.userbenchmark.com/UserRun/19698768&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;a benchmark spotted back in August&lt;/a&gt;. This showed the Threadripper 3000 as having a 3.6GHz base clock and 4.2GHz boost.&lt;/p&gt;
&lt;p&gt;The single-core score of 1,275 is pretty much the same as for the current flagship Threadripper 2990WX, and is actually slightly lower than the 1,334 that the Intel i9-9900K scores.&lt;/p&gt;

&lt;p&gt;But when it comes to multi-core, the Threadripper 3000's score of 23,015 absolutely destroys the Threadripper 2990WX's score of 13,400, and leaves the i9-9900K with its score of 8,726 in its dust.&lt;/p&gt;
&lt;p&gt;Some back-of-the-envelope calculations suggest that based on this benchmark that the Threadripper 3000 is some 70% faster than the Threadripper 2990WX. However, as usual, caution is needed when trying to extrapolate benchmark results and translate them into real-world performance.&lt;/p&gt;

&lt;section class=&quot;sharethrough-top&quot; data-component=&quot;medusaContentRecommendation&quot; data-medusa-content-recommendation-options=&quot;{&amp;quot;promo&amp;quot;:&amp;quot;promo_ZD_recommendation_sharethrough_top_in_article_desktop&amp;quot;,&amp;quot;spot&amp;quot;:&amp;quot;dfp-in-article&amp;quot;}&quot;&gt;
&lt;/section&gt;&lt;p&gt;&lt;strong&gt;See also:&lt;/strong&gt;&lt;/p&gt;
</description>
<pubDate>Fri, 20 Sep 2019 17:15:22 +0000</pubDate>
<dc:creator>rbanffy</dc:creator>
<og:type>article</og:type>
<og:url>https://www.zdnet.com/article/amd-ryzen-threadripper-3000-32-core-cpu-is-more-bad-news-for-intel/</og:url>
<og:title>AMD Ryzen Threadripper 3000 32-core CPU is more bad news for Intel | ZDNet</og:title>
<og:description>You want more performance? AMD will give you more performance. A lot more.</og:description>
<og:image>https://zdnet2.cbsistatic.com/hub/i/r/2018/08/05/76937723-923f-4839-a730-62390675a67f/thumbnail/770x578/cd5deb8d25597173896b89e8f24200c9/000.jpg</og:image>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.zdnet.com/article/amd-ryzen-threadripper-3000-32-core-cpu-is-more-bad-news-for-intel/</dc:identifier>
</item>
<item>
<title>ColorBox by Lyft Design</title>
<link>https://www.colorbox.io</link>
<guid isPermaLink="true" >https://www.colorbox.io</guid>
<description>&lt;div class=&quot;sidePanelBlock&quot;&gt;

&lt;div&gt;
&lt;div&gt;
&lt;h4 class=&quot;sidePanelLabel&quot;&gt;Add step after&lt;/h4&gt;
&lt;p/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;sidePanelBlock&quot; readability=&quot;10&quot;&gt;

&lt;h4 class=&quot;sidePanelLabel&quot;&gt;Start&lt;/h4&gt;

&lt;h4 class=&quot;sidePanelLabel&quot;&gt;End&lt;/h4&gt;

&lt;h4 class=&quot;sidePanelLabel&quot;&gt;Curve&lt;/h4&gt;
&lt;p/&gt;
&lt;/div&gt;
&lt;div class=&quot;sidePanelBlock&quot; readability=&quot;10&quot;&gt;

&lt;h4 class=&quot;sidePanelLabel&quot;&gt;Start&lt;/h4&gt;

&lt;h4 class=&quot;sidePanelLabel&quot;&gt;End&lt;/h4&gt;

&lt;h4 class=&quot;sidePanelLabel&quot;&gt;Curve&lt;/h4&gt;
&lt;p/&gt;
&lt;h4 class=&quot;sidePanelLabel&quot;&gt;Rate&lt;/h4&gt;

&lt;/div&gt;
&lt;div class=&quot;sidePanelBlock&quot; readability=&quot;10&quot;&gt;

&lt;h4 class=&quot;sidePanelLabel&quot;&gt;Start&lt;/h4&gt;

&lt;h4 class=&quot;sidePanelLabel&quot;&gt;End&lt;/h4&gt;

&lt;h4 class=&quot;sidePanelLabel&quot;&gt;Curve&lt;/h4&gt;
&lt;p/&gt;
&lt;/div&gt;

</description>
<pubDate>Fri, 20 Sep 2019 16:20:52 +0000</pubDate>
<dc:creator>Brajeshwar</dc:creator>
<og:title>ColorBox by Lyft Design</og:title>
<og:description>Colorbox is a color tool to produce color sets.</og:description>
<og:type>post</og:type>
<og:url>https://colorbox.io</og:url>
<og:image>https://res.cloudinary.com/dnqsoufy0/image/upload/v1537266227/favicon.ico</og:image>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.colorbox.io/</dc:identifier>
</item>
<item>
<title>Common Systems Programming Optimizations and Tricks</title>
<link>https://paulcavallaro.com/blog/common-systems-programming-optimizations-tricks/</link>
<guid isPermaLink="true" >https://paulcavallaro.com/blog/common-systems-programming-optimizations-tricks/</guid>
<description>&lt;p&gt;Today’s blog post is an overview of some common optimization techniques and neat tricks for doing “systems programming” – whatever that means today. We’ll walk through some methods to make your code run faster, be more efficient, and to squeeze just a little more juice from whatever you got.&lt;/p&gt;
&lt;p&gt;All of the examples we’ll go over are also on github at &lt;a href=&quot;https://github.com/paulcavallaro/systems-programming&quot;&gt;paulcavallaro/systems-programming&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;cache-lines-false-sharing&quot;&gt;Cache Lines &amp;amp; False Sharing&lt;/h2&gt;
&lt;p&gt;False sharing is a fairly well-understood problem in optimizing multi-threaded code on modern SMP systems. The problem has been &lt;a href=&quot;https://software.intel.com/en-us/articles/avoiding-and-identifying-false-sharing-among-threads&quot;&gt;written&lt;/a&gt; &lt;a href=&quot;https://mechanical-sympathy.blogspot.com/2011/07/false-sharing.html&quot;&gt;about&lt;/a&gt; &lt;a href=&quot;https://dzone.com/articles/false-sharing&quot;&gt;fairly&lt;/a&gt; &lt;a href=&quot;https://herbsutter.com/2009/05/15/effective-concurrency-eliminate-false-sharing/&quot;&gt;extensively&lt;/a&gt;, but the basic idea is that physical memory on a machine isn’t infinitely granular, i.e. you can’t just read a byte. Instead, when you want to read a single byte of memory, the processor will pull in and cache not just that byte, but the surrounding data as well, on the assumption that it will likely be used too. This unit of data that gets read and cached is called a “cache line”, and is essentially the smallest piece of memory that can be accessed.&lt;/p&gt;
&lt;p&gt;As of 2019 cache lines are powers of 2, usually in the range of 32 to 256 bytes, with 64 bytes being the most common.&lt;/p&gt;
&lt;p&gt;Now, to support multiple processors on a single machine reading and writing from the same memory in a coherent way, only one processor on a machine can have exclusive access to a given cache line.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;False sharing&lt;/em&gt; is when you accidentally put two unrelated pieces of data in the same cache line. Now having two processors update separate chunks of data, say counters, will interfere with one another, as each processor attempts to gain exclusive access to the cache line that houses both fields.&lt;/p&gt;
&lt;p&gt;The explanation for the name &lt;em&gt;false sharing&lt;/em&gt; is that even though these two counters shouldn’t be affecting one another from a correctness standpoint, they are – big air quotes incoming – “falsely sharing” a cache line for no good reason.&lt;/p&gt;
&lt;p&gt;One solution is to force the data onto separate cache lines, which you can do in C/C++ by forcing the alignment of the members of a struct/class. In &lt;a href=&quot;https://github.com/paulcavallaro/systems-programming/blob/master/examples/cache-lines.cc&quot;&gt;examples/cache-lines.cc&lt;/a&gt; we use absl’s &lt;a href=&quot;https://github.com/abseil/abseil-cpp/blob/fa00c321073c7ea40a4fc3dfc8a06309eae3d025/absl/base/optimization.h#L99-L148&quot;&gt;&lt;code&gt;ABSL_CACHELINE_ALIGNED&lt;/code&gt;&lt;/a&gt; macro to achieve this.&lt;/p&gt;
&lt;p&gt;To show the effect in practice, we benchmark two different structs of &lt;code&gt;std::atomic&amp;lt;int64&amp;gt;&lt;/code&gt; counters, &lt;code&gt;NormalCounters&lt;/code&gt; and &lt;code&gt;CacheLineAwareCounters&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;15&quot;&gt;
&lt;pre class=&quot;chroma&quot;&gt;
&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// NormalCounters is straight forward naive implementation of a struct of
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// counters.
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Note: We also use ABSL_CACHELINE_ALIGNED on the NormalCounters struct, but
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// not its members, so that the entire struct will be aligned to a cache line.
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Otherwise the struct might be placed towards the end of a cache line,
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// accidentally straddling two cache lines, thereby improving its performance.
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ABSL_CACHELINE_ALIGNED&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NormalCounters&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;atomic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;success&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;atomic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;failure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;atomic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;okay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;atomic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;meh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// CacheLineAwareCounters forces each counter onto a separate cache line to
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// avoid any false sharing between the counters.
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Note: We must use ABSL_CACHELINE_ALIGNED for each member, since we want to
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// pad every single counter so it will be forced onto its own separate cache
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// line.
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ABSL_CACHELINE_ALIGNED&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CacheLineAwareCounters&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ABSL_CACHELINE_ALIGNED&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;atomic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;success&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ABSL_CACHELINE_ALIGNED&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;atomic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;failure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ABSL_CACHELINE_ALIGNED&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;atomic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;okay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ABSL_CACHELINE_ALIGNED&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;atomic&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;meh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The benchmark uses either 1, 2, 3, or 4 threads, each bumping a separate atomic counter inside the struct 64K times. Here are the results on a 2013 MacBook Pro with a Haswell processor:&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;10&quot;&gt;
&lt;pre class=&quot;chroma&quot;&gt;
&lt;code class=&quot;language-perl&quot; data-lang=&quot;perl&quot;&gt;&lt;span class=&quot;n&quot;&gt;Executing&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tests&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;examples:cache&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lines&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;-----------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Cache&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Line&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Size:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NormalCounters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CacheLineAwareCounters&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;256&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;2019&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;08&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;01&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;18&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Run&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2800&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MHz&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CPU&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;CPU&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Caches:&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;L1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Data&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;L1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Instruction&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;L2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Unified&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;262&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;L3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Unified&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4194&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Benchmark&lt;/span&gt;                                    &lt;span class=&quot;n&quot;&gt;Time&lt;/span&gt;           &lt;span class=&quot;n&quot;&gt;CPU&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Iterations&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_NormalCounters&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:1&lt;/span&gt;                &lt;span class=&quot;mi&quot;&gt;389&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;387&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;1812&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_NormalCounters&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:2&lt;/span&gt;               &lt;span class=&quot;mi&quot;&gt;1264&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;2517&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;234&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_NormalCounters&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:3&lt;/span&gt;               &lt;span class=&quot;mi&quot;&gt;1286&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;3718&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;225&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_NormalCounters&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:4&lt;/span&gt;               &lt;span class=&quot;mi&quot;&gt;1073&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;3660&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;204&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_CacheLineAwareCounters&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:1&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;386&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;385&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;1799&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_CacheLineAwareCounters&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:2&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;1658&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_CacheLineAwareCounters&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:3&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;208&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;581&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;1152&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_CacheLineAwareCounters&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:4&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;193&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;721&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;1008&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A note on these results: &lt;code&gt;Time&lt;/code&gt; measures wall clock time per-thread and &lt;code&gt;CPU&lt;/code&gt; measures cpu time per-thread.&lt;/p&gt;
&lt;p&gt;We can see that the sizes of the two structs are different, where &lt;code&gt;sizeof(NormalCounters) = 64&lt;/code&gt; and &lt;code&gt;sizeof(CacheLineAwareCounters) = 256&lt;/code&gt;. This is because the alignment constraint we put on the individual fields, such that each member is on its own cache line. So instead of an &lt;code&gt;int64&lt;/code&gt; taking up 8 bytes like usual, it’s taking up a full cache line, which is 64 bytes on my machine.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://paulcavallaro.com/images/sysprog-false-sharing.png&quot; title=&quot;Graph of CPU Time vs. # of Threads&quot;/&gt;&lt;/p&gt;
&lt;p&gt;We also see that for the single threaded case, the &lt;code&gt;NormalCounters&lt;/code&gt; vs. &lt;code&gt;CacheLineAwareCounters&lt;/code&gt; perform indistinguishably. But as we add more threads, the &lt;code&gt;CacheLineAwareCounters&lt;/code&gt; perform much better than the naive normal counters that suffer from the false sharing.&lt;/p&gt;
&lt;p&gt;Interestingly the wall clock time spent for &lt;code&gt;CacheLineAwareCounters&lt;/code&gt; is higher for one thread than multiple threads, which could point to perhaps some subtle benchmarking problem, or maybe a fixed amount of delay that’s getting attributed across more threads now, and so is smaller per-thread.&lt;/p&gt;
&lt;h2 id=&quot;the-magic-power-of-2-division-is-slowaloo&quot;&gt;The Magic Power of 2: Division Is Slowaloo&lt;/h2&gt;
&lt;p&gt;In current hardware, division is one of the most expensive operations, where expensive here means “longest latency”. &lt;a href=&quot;https://www.agner.org/optimize/instruction_tables.pdf&quot;&gt;Agner Fog’s listing of instruction latencies&lt;/a&gt; lists Intel Skylake’s &lt;code&gt;DIV&lt;/code&gt; instruction operating on two 64 bit registers having a latency of 35-88 cycles, compared to an &lt;code&gt;ADD&lt;/code&gt; instruction operating on the same two 64 bit registers having a latency of 1 cycle. So it would behoove us to avoid division where some other set of operations would work.&lt;/p&gt;
&lt;p&gt;One place where division is commonly used besides for actually doing division, is in the modulo &lt;code&gt;%&lt;/code&gt; operator. And a common place for the modulo operator is in hash tables: to go from a hash to a bucket we compute &lt;code&gt;HASH % TABLE_SIZE&lt;/code&gt;. Modulo is used even more heavily in &lt;a href=&quot;https://en.wikipedia.org/wiki/Open_addressing&quot;&gt;open-addressing&lt;/a&gt; schemes since we’re constantly remapping values back into the hash table bucket space.&lt;/p&gt;
&lt;p&gt;So how do we go from using modulo to something else? Bit twiddling and the Magic Power of 2!&lt;/p&gt;
&lt;p&gt;First, let me give away the answer: We’re going to force all of our hash tables to be a size that’s a power of 2.&lt;/p&gt;
&lt;p&gt;We’ll be able to take advantage of this property for replacing division with faster bit twiddling. Also, this property is easy to maintain since we double the size of our hash table whenever we grow to amoritize the cost of rehashing, so the size will stay a power of 2 as we grow.&lt;/p&gt;
&lt;p&gt;Now, we were using division – or modulo – for the purpose of mapping any hash value to a bucket index in our hash table. Bucket indices must be strictly less than our size, and this mapping should not lose any entropy from the hash value.&lt;/p&gt;
&lt;p&gt;Instead of using division to do this, we’ll use a bitmask that will “mask” away all set bits except those that are strictly less than our power of 2. This way we keep all the entropy in the least significant bits, just like modulo, but it’s much faster – Agner Fog lists it at 1 cycle latency on the same Intel Skylake architecture.&lt;/p&gt;
&lt;p&gt;As a quick refresher on bit twiddling and to explain how we’ll choose our bitmask, let’s look at some bit patterns.&lt;/p&gt;
&lt;p&gt;Since numbers are represented in binary, we know that every power of 2 number &lt;code&gt;N&lt;/code&gt; only has one bit set. For example:&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;7&quot;&gt;
&lt;pre class=&quot;chroma&quot;&gt;
&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;n&quot;&gt;Decimal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;Binary&lt;/span&gt;
    &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
    &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt;
   &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;128&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And that means all &lt;code&gt;N - 1&lt;/code&gt;’s have every less significant bit than &lt;code&gt;log2(N)&lt;/code&gt; set. For example:&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;7&quot;&gt;
&lt;pre class=&quot;chroma&quot;&gt;
&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;n&quot;&gt;Decimal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;Binary&lt;/span&gt;
    &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;01&lt;/span&gt;
    &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;01&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;
   &lt;span class=&quot;mi&quot;&gt;31&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;01&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;127&lt;/span&gt;   &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;01&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So in order to replace our modulo operator in the &lt;code&gt;HASH % N&lt;/code&gt; calculation, we instead calculate &lt;code&gt;HASH &amp;amp; (N - 1)&lt;/code&gt; using bitwise AND. This will only keep the set bits that are less significant than our &lt;code&gt;log_2(N)&lt;/code&gt; bit, mapping any &lt;code&gt;HASH&lt;/code&gt; value onto a number in the interval &lt;code&gt;[0, N)&lt;/code&gt;. We can even cache this bitmask if we want so we don’t have to recompute it in the future.&lt;/p&gt;
&lt;p&gt;To show how much faster this bitmask trick is than using normal modulo operator, I’ve written a &lt;a href=&quot;https://github.com/paulcavallaro/systems-programming/blob/master/examples/power-of-two.cc&quot;&gt;small benchmark&lt;/a&gt; to measure executing 1M modulo operations, versus executing 1M bitmasks.&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;10&quot;&gt;
&lt;pre class=&quot;chroma&quot;&gt;
&lt;code class=&quot;language-perl&quot; data-lang=&quot;perl&quot;&gt;&lt;span class=&quot;n&quot;&gt;Executing&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tests&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;examples:power&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;two&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;-----------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;2019&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;08&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;02&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;24&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;03&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Run&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2800&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MHz&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CPU&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;CPU&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Caches:&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;L1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Data&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;L1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Instruction&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;L2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Unified&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;262&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;L3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Unified&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4194&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;--------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Benchmark&lt;/span&gt;                 &lt;span class=&quot;n&quot;&gt;Time&lt;/span&gt;           &lt;span class=&quot;n&quot;&gt;CPU&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Iterations&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;--------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_Mod&lt;/span&gt;                 &lt;span class=&quot;mi&quot;&gt;9261&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;9234&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;         &lt;span class=&quot;mi&quot;&gt;75&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_BitMask&lt;/span&gt;              &lt;span class=&quot;mi&quot;&gt;325&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;324&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;us&lt;/span&gt;       &lt;span class=&quot;mi&quot;&gt;1984&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here we can see how the &lt;code&gt;DIV&lt;/code&gt; instruction used by the modulo operator is on the order of 28x slower, near the 35x slow down predicted by Agner Fog’s latency numbers.&lt;/p&gt;
&lt;p&gt;Since this trick is easy to do, and provides a nice win, it’s used by many high-performance hash-tables, like absl’s “Swiss Tables” &lt;a href=&quot;https://github.com/abseil/abseil-cpp/blob/c6c3c1b498e4ee939b24be59cae29d59c3863be8/absl/container/internal/raw_hash_set.h#L471-L474&quot;&gt;flat_hash_set and flat_hash_map&lt;/a&gt; and &lt;a href=&quot;https://github.com/concurrencykit/ck/blob/master/src/ck_ht.c#L145-L172&quot;&gt;ConcurrencyKit’s ck_ht_map&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;repurposing-top-bits&quot;&gt;Repurposing Top Bits&lt;/h2&gt;
&lt;p&gt;Oftentimes you want to store a bit or two of extra information along with a pointer – in fact it’s so common &lt;a href=&quot;https://en.wikipedia.org/wiki/Tagged_pointer&quot;&gt;Wikipedia has an article about it&lt;/a&gt;. One way to do this is to take advantage that on many 64-bit systems, such as linux, virtual memory addresses are only 48 bits wide, even though we use 8 bytes to store them.&lt;/p&gt;
&lt;p&gt;This means, we can just store any old crap we want to in the top 16 bits by just masking it out whenever we want to actually dereference it. Here’s some &lt;a href=&quot;https://github.com/paulcavallaro/systems-programming/blob/master/examples/pointer-tagging.cc&quot;&gt;example C++ code&lt;/a&gt; of using the top bit of a pointer to store whether the underlying data is “dirty” or not.&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;11&quot;&gt;
&lt;pre class=&quot;chroma&quot;&gt;
&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span class=&quot;k&quot;&gt;constexpr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uintptr_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kDirtyBit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x8000000000000000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;constexpr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uintptr_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kPtrMask&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x7fffffffffffffff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;static_assert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uintptr_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Only works on 64-bit systems&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;template&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;uintptr_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MarkDirty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;reinterpret_cast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uintptr_t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kDirtyBit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;template&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GetPointer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uintptr_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;reinterpret_cast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kPtrMask&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Interestingly though, since this is a feature of Linux’s memory management/virtual address space, it is subject to change – and it actually has!&lt;/p&gt;
&lt;p&gt;LWN &lt;a href=&quot;https://lwn.net/Articles/717293/&quot;&gt;reported on the patchset in 2017&lt;/a&gt; implementing five-level page tables in order to support larger amounts of addressable memory. The change, if enabled, would move Linux from 48-bit virtual addresses to 57-bit virtual addresses, increasing virtual address space from 256 TiB to 128 PiB – which ought to be enough for everyone 😀.&lt;/p&gt;
&lt;p&gt;Part of why the change couldn’t be enabled by default is because various high performance programs, notably various JavaScript engines and &lt;a href=&quot;http://luajit.org/&quot;&gt;LuaJIT&lt;/a&gt;, use this repurposing trick to pack some extra data into pointers.&lt;/p&gt;
&lt;h2 id=&quot;lock-striping&quot;&gt;Lock Striping&lt;/h2&gt;
&lt;p&gt;Locks can be used for mutual exclusion when you want to have multiple threads access shared data exclusively. The downside though is if the shared data is frequently accessed and the critical section is non-trivial, your threads could spend most of their time contending on the lock, instead of actually doing work.&lt;/p&gt;
&lt;p&gt;One common way of solving this problem, is introducing more locks. Wait – what?&lt;/p&gt;
&lt;p&gt;Well, instead of one lock that guards all of the data, instead you have many locks responsible for just a piece of the data. In this way we shard the data into separate independent buckets that don’t contend with each other. Assuming the data access is uniform-ish, increasing sharding of the data reduces the number of threads contending on a lock proportionally.&lt;/p&gt;
&lt;p&gt;Below is a &lt;a href=&quot;https://github.com/paulcavallaro/systems-programming/blob/master/examples/lock-striping.cc&quot;&gt;small C++ example&lt;/a&gt; of two implementations of thread-safe hash set. The first implementation, &lt;code&gt;ThreadSafeHashSet&lt;/code&gt;, just uses a single lock to guard a single underlying &lt;code&gt;absl::flat_hash_set&lt;/code&gt;. The second implementation &lt;code&gt;LockStripedHashSet&lt;/code&gt; has &lt;code&gt;N&lt;/code&gt; separate locks, guarding &lt;code&gt;N&lt;/code&gt; separate &lt;code&gt;abs::flat_hash_sets&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;13&quot;&gt;
&lt;pre class=&quot;chroma&quot;&gt;
&lt;code class=&quot;language-cpp&quot; data-lang=&quot;cpp&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// Simple thread-safe single-lock hash set
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;ThreadSafeHashSet&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uint64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;absl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MutexLock&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mu_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;hash_set_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Contains&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uint64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;absl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MutexLock&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mu_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hash_set_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

 &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;absl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mutex&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mu_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;absl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flat_hash_set&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uint64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hash_set_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// Chunk the data into `kNumChunks` separate hash sets, guarded by separate
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// locks.
&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;template&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kNumChunks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;err&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;LockStripedHashSet&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;public&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uint64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// Mod the data to calculate which hash_set/lock to use
&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kNumChunks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;absl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MutexLock&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mu_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;hash_set_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Contains&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uint64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kNumChunks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;absl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MutexLock&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mu_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hash_set_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

 &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;absl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mutex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kNumChunks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mu_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;absl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flat_hash_set&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uint64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kNumChunks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hash_set_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To illustrate the benefits of lock striping, we benchmark the performance of the two thread-safe hash sets in the presence of many threads, each inserting 1M items. For the &lt;code&gt;LockStripedHashSet&lt;/code&gt; we try with 4 chunks and with 8 chunks. The results are below:&lt;/p&gt;
&lt;div class=&quot;highlight&quot; readability=&quot;10&quot;&gt;
&lt;pre class=&quot;chroma&quot;&gt;
&lt;code class=&quot;language-perl&quot; data-lang=&quot;perl&quot;&gt;&lt;span class=&quot;n&quot;&gt;Executing&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tests&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;examples:lock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;striping&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;-----------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;2019&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;08&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;24&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;37&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Run&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2800&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MHz&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CPU&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;CPU&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Caches:&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;L1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Data&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;L1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Instruction&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;L2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Unified&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;262&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;L3&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Unified&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4194&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;K&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;--------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Benchmark&lt;/span&gt;                                   &lt;span class=&quot;n&quot;&gt;Time&lt;/span&gt;           &lt;span class=&quot;n&quot;&gt;CPU&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Iterations&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;--------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_SingleLock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:1&lt;/span&gt;                    &lt;span class=&quot;mi&quot;&gt;65&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;         &lt;span class=&quot;mi&quot;&gt;65&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;         &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_SingleLock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:2&lt;/span&gt;                   &lt;span class=&quot;mi&quot;&gt;140&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;254&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;          &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_SingleLock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:3&lt;/span&gt;                   &lt;span class=&quot;mi&quot;&gt;140&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;332&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;          &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_SingleLock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:4&lt;/span&gt;                   &lt;span class=&quot;mi&quot;&gt;142&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;405&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;          &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_LockStriping_4_Chunks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:1&lt;/span&gt;         &lt;span class=&quot;mi&quot;&gt;71&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;         &lt;span class=&quot;mi&quot;&gt;69&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;          &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_LockStriping_4_Chunks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:2&lt;/span&gt;         &lt;span class=&quot;mi&quot;&gt;90&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;178&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;          &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_LockStriping_4_Chunks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:3&lt;/span&gt;         &lt;span class=&quot;mi&quot;&gt;89&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;248&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;          &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_LockStriping_4_Chunks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:4&lt;/span&gt;         &lt;span class=&quot;mi&quot;&gt;82&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;299&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;          &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_LockStriping_8_Chunks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:1&lt;/span&gt;         &lt;span class=&quot;mi&quot;&gt;70&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;         &lt;span class=&quot;mi&quot;&gt;69&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;         &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_LockStriping_8_Chunks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:2&lt;/span&gt;         &lt;span class=&quot;mi&quot;&gt;74&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;143&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;          &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_LockStriping_8_Chunks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:3&lt;/span&gt;         &lt;span class=&quot;mi&quot;&gt;71&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;198&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;          &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;BM_LockStriping_8_Chunks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;threads:4&lt;/span&gt;         &lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ms&lt;/span&gt;          &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;/code&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Again, &lt;code&gt;Time&lt;/code&gt; measures wall clock time per-thread and &lt;code&gt;CPU&lt;/code&gt; measures cpu time per-thread. Also note that since my machine only has 4 logical cores, this test only goes up to 4 threads, since anything beyond that doesn’t actually introduce any extra contention.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://paulcavallaro.com/images/sysprog-lock-striping.png&quot; title=&quot;Graph of CPU Time vs. # of Threads&quot;/&gt;&lt;/p&gt;
&lt;p&gt;We can see that in the single-threaded case the &lt;code&gt;LockStripedHashSet&lt;/code&gt;, no matter the chunking, performs slightly worse on both wall clock and CPU time than the simple &lt;code&gt;ThreadSafeHashSet&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;However, as more threads are added, increasing the contention on the locks, the &lt;code&gt;LockStripedHashSet&lt;/code&gt; performs much better, and the 8 chunk version outperforms the 4 chunk version at higher thread counts.&lt;/p&gt;
&lt;p&gt;While lock-striping can help alleviate contention on locks, it does have the downside of increasing storage overhead for the locks. In our example the overhead of 7 extra locks and extra &lt;code&gt;absl::flat_hash_set&lt;/code&gt; bookkeeping is miniscule for a single instance in our benchmark, but if you replaced all the hash sets in an application with an 8-way striped thread-safe hash set, you could bloat its memory footprint by a significant amount.&lt;/p&gt;
&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;While this is nowhere near an exhaustive list of the most common systems programming tricks, hopefully it whets your appetite to learn more, provides some tools for improving performance in your own applications, or at least make it easier to understand why performance sensitive code is doing what it’s doing.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Thanks to Mason Simon and Ray Yang for reviewing drafts of this post.&lt;/em&gt;&lt;/p&gt;

&lt;br/&gt;&lt;div class=&quot;navi-blog&quot;&gt;&lt;a href=&quot;https://paulcavallaro.com/blog/a-practical-multi-word-compare-and-swap-operation/&quot; class=&quot;button big previous&quot;&gt;← A Practical Multi-Word Compare-and-Swap Operation&lt;/a&gt;&lt;/div&gt;

</description>
<pubDate>Fri, 20 Sep 2019 13:38:35 +0000</pubDate>
<dc:creator>wheresvic3</dc:creator>
<dc:language>en-us</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://paulcavallaro.com/blog/common-systems-programming-optimizations-tricks/</dc:identifier>
</item>
<item>
<title>Google is investing $3.3B to build clean data centers in Europe</title>
<link>https://techcrunch.com/2019/09/20/google-is-investing-3-3b-to-build-clean-data-centers-in-europe/</link>
<guid isPermaLink="true" >https://techcrunch.com/2019/09/20/google-is-investing-3-3b-to-build-clean-data-centers-in-europe/</guid>
<description>&lt;p id=&quot;speakable-summary&quot;&gt;&lt;a href=&quot;http://google.com&quot;&gt;Google&lt;/a&gt; announced today that it &lt;a href=&quot;https://www.blog.google/around-the-globe/google-europe/unleashing-digital-opportunities-europe/&quot;&gt;was investing €3 billion&lt;/a&gt; (approximately US$3.3 billion) to expand its data center presence in Europe. What’s more, the company pledged the data centers would be environmentally friendly.&lt;/p&gt;
&lt;p&gt;This new investment is in addition to the $7 billion the company has invested since 2007 in the EU, but today’s announcement was focused on &lt;a class=&quot;crunchbase-link&quot; href=&quot;https://crunchbase.com/organization/google&quot; target=&quot;_blank&quot; data-type=&quot;organization&quot; data-entity=&quot;google&quot;&gt;Google’s&lt;/a&gt; commitment to building data centers running on clean energy as much as the data centers themselves.&lt;/p&gt;
&lt;p&gt;In a blog post &lt;a href=&quot;https://www.blog.google/around-the-globe/google-europe/unleashing-digital-opportunities-europe/&quot;&gt;announcing the new investment&lt;/a&gt;, CEO Sundar Pichai made it clear that the company was focusing on running these data centers on carbon-free fuels, pointing out that he was in Finland today to discuss with prime minister Antti Rinne building sustainable economic development in conjunction with a carbon-free future.&lt;/p&gt;
&lt;p&gt;Of the €3 billion the company plans to spend, it will invest €600 million to expand its presence in Hamina, Finland, which he wrote “serves as a model of sustainability and energy efficiency for all of our data centers.” Further, the company already announced &lt;a href=&quot;https://techcrunch.com/2019/09/19/google-announces-18-new-renewable-energy-deals/&quot;&gt;18 new renewable energy deals&lt;/a&gt; earlier this week, which encompass a total of 1,600-megawatts in the U.S., South America and Europe.&lt;/p&gt;
&lt;p&gt;In the blog post, Pichai outlined how the new data center projects in Europe would include some of these previously announced projects:&lt;/p&gt;
&lt;blockquote readability=&quot;15&quot;&gt;
&lt;p&gt;Today I’m announcing that nearly half of the megawatts produced will be here in Europe, through the launch of 10 renewable energy projects. These agreements will spur the construction of more than 1 billion euros in new energy infrastructure in the EU, ranging from a new offshore wind project in Belgium, to five solar energy projects in Denmark, and two wind energy projects in Sweden. In Finland, we are committing to two new wind energy projects that will more than double our renewable energy capacity in the country, and ensure we continue to match almost all of the electricity consumption at our Finnish data center with local carbon-free sources, even as we grow our operations.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The company is also helping by investing in new skills training, so people can have the tools to be able to handle the new types of jobs these data centers and other high-tech jobs will require. The company claims it has previously trained 5 million people in Europe for free in crucial digital skills, and recently opened a &lt;a href=&quot;https://learndigital.withgoogle.com/digitalgarage-fi&quot;&gt;Google skills hub&lt;/a&gt; in Helsinki.&lt;/p&gt;
&lt;p&gt;It’s obviously not a coincidence that the company is making an announcement related to clean energy on &lt;a href=&quot;https://globalclimatestrike.net/&quot;&gt;Global Climate Strike Day&lt;/a&gt;, a day when people from around the world are walking out of schools and off their jobs to encourage world leaders and businesses to take action on the climate crisis. Google is attempting to answer the call with these announcements.&lt;/p&gt;

</description>
<pubDate>Fri, 20 Sep 2019 13:07:15 +0000</pubDate>
<dc:creator>yibllesqueak</dc:creator>
<og:title>Google is investing $3.3B to build clean data centers in Europe – TechCrunch</og:title>
<og:description>Google announced today that it was investing €3 billion (approximately US$3.3 billion) to expand its data center presence in Europe. What’s more, the company pledged the data centers would be environmentally friendly. This new investment is in addition to the $7 billion the company has invest…</og:description>
<og:image>https://techcrunch.com/wp-content/uploads/2019/09/GettyImages-97400418.jpg?w=607</og:image>
<og:url>http://social.techcrunch.com/2019/09/20/google-is-investing-3-3b-to-build-clean-data-centers-in-europe/</og:url>
<og:type>article</og:type>
<dc:language>en-US</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://techcrunch.com/2019/09/20/google-is-investing-3-3b-to-build-clean-data-centers-in-europe/</dc:identifier>
</item>
<item>
<title>Secret FBI Subpoenas Scoop Up Personal Data from Scores of Companies</title>
<link>https://www.nytimes.com/2019/09/20/us/data-privacy-fbi.html</link>
<guid isPermaLink="true" >https://www.nytimes.com/2019/09/20/us/data-privacy-fbi.html</guid>
<description>&lt;div class=&quot;css-1fanzo5 StoryBodyCompanionColumn&quot;&gt;
&lt;div class=&quot;css-53u6y8&quot;&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;The F.B.I. has used secret subpoenas to obtain personal data from far more companies than previously disclosed, newly released &lt;a class=&quot;css-1g7m0tk&quot; href=&quot;https://www.documentcloud.org/search/projectid:45842-Termination-Letters&quot; title=&quot;&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;documents&lt;/a&gt; show.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;The requests, which the F.B.I. says are critical to its counterterrorism efforts, have raised privacy concerns for years but have been associated mainly with tech companies. Now, records show how far beyond Silicon Valley the practice extends — encompassing scores of banks, credit agencies, cellphone carriers and even universities.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;The demands can scoop up a variety of information, including usernames, locations, IP addresses and records of purchases. They don’t require a judge’s approval and usually come with a gag order, leaving them shrouded in secrecy. Fewer than 20 entities, most of them tech companies, have ever revealed that they’ve received the subpoenas, known as national security letters.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;The documents, obtained by the Electronic Frontier Foundation through a Freedom of Information Act &lt;a class=&quot;css-1g7m0tk&quot; href=&quot;https://www.eff.org/deeplinks/2019/05/victory-eff-wins-national-security-letter-transparency-lawsuit&quot; title=&quot;&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;lawsuit&lt;/a&gt; and shared with The New York Times, shed light on the scope of the demands — more than 120 companies and other entities were included in the filing — and raise questions about the effectiveness of a 2015 law that was intended to increase transparency around them.&lt;/p&gt;
&lt;/div&gt;
&lt;aside class=&quot;css-o6xoe7&quot;/&gt;&lt;/div&gt;&lt;div class=&quot;css-1fanzo5 StoryBodyCompanionColumn&quot;&gt;
&lt;div class=&quot;css-53u6y8&quot;&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;“This is a pretty potent authority for the government,” said Stephen Vladeck, a law professor at the University of Texas who specializes in national security. “The question is: Do we have a right to know when the government is collecting information on us?”&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;The documents provide information on about 750 of the subpoenas — representing a small but telling fraction of the half-million issued since 2001, when the Patriot Act expanded their powers.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;The credit agencies Equifax, Experian and TransUnion received a large number of the letters in the filing. So did financial institutions like Bank of America, Western Union and even the Federal Reserve Bank of New York. All declined to explain how they handle the letters. An array of other entities received smaller numbers of requests — including Kansas State University and the University of Alabama at Birmingham, probably because of their role in providing internet service.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;Other companies included major cellular providers such as AT&amp;amp;T and Verizon, as well as tech giants like Google and Facebook, which have &lt;a class=&quot;css-1g7m0tk&quot; href=&quot;https://www.verizon.com/about/portal/transparency-report/us-report/&quot; title=&quot;&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;acknowledged&lt;/a&gt; &lt;a class=&quot;css-1g7m0tk&quot; href=&quot;https://www.blog.google/outreach-initiatives/public-policy/sharing-national-security-letters-public/&quot; title=&quot;&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;receiving&lt;/a&gt; &lt;a class=&quot;css-1g7m0tk&quot; href=&quot;https://newsroom.fb.com/news/2017/12/reinforcing-our-commitment-to-transparency/&quot; title=&quot;&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;the letters&lt;/a&gt; in the past.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;Albert Gidari, a lawyer who long represented tech and telecommunications companies and is now the privacy director at Stanford’s Center for Internet and Society, said Silicon Valley had been associated with the subpoenas because it was more willing than other industries to fight the gag orders. “Telecoms and financial institutions get little attention,” he said, even though the law specifically says they are fair game.&lt;/p&gt;
&lt;/div&gt;
&lt;aside class=&quot;css-o6xoe7&quot;/&gt;&lt;/div&gt;
&lt;div class=&quot;css-1fanzo5 StoryBodyCompanionColumn&quot;&gt;
&lt;div class=&quot;css-53u6y8&quot;&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;The Federal Bureau of Investigation determined that information on the roughly 750 letters could be disclosed under a 2015 law, the USA Freedom Act, that requires the government to review the secrecy orders “at appropriate intervals.”&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;The Justice Department’s interpretation of those instructions has left many letters secret indefinitely. Department &lt;a class=&quot;css-1g7m0tk&quot; href=&quot;https://www.fbi.gov/file-repository/nsl-ndp-procedures.pdf/view&quot; title=&quot;&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;guidelines&lt;/a&gt; say the gag orders must be evaluated three years after an investigation starts and also when an investigation is closed. But &lt;a class=&quot;css-1g7m0tk&quot; href=&quot;https://www.washingtonpost.com/world/national-security/judge-criticizes-secrecy-rules-surrounding-fbi-requests-for-companies-data/2016/08/05/37f80ba6-5b2b-11e6-831d-0324760ca856_story.html&quot; title=&quot;&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;a federal judge&lt;/a&gt; &lt;a class=&quot;css-1g7m0tk&quot; href=&quot;https://www.dcd.uscourts.gov/sites/dcd/files/16-518Opinion_Redacted.pdf&quot; title=&quot;&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;noted&lt;/a&gt; “several large loopholes,” suggesting that “a large swath” of gag orders might never be reviewed.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;According to the new documents, the F.B.I. evaluated 11,874 orders between early 2016, when the rules went into effect, and September 2017, when the Electronic Frontier Foundation, a digital rights group, requested the information.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;“We are not sure the F.B.I. is taking its obligations under USA Freedom seriously,” said Andrew Crocker, a lawyer with the foundation. “There still is a huge problem with permanent gag orders.”&lt;/p&gt;
&lt;/div&gt;
&lt;aside class=&quot;css-o6xoe7&quot;/&gt;&lt;/div&gt;
&lt;div class=&quot;css-79elbk&quot; data-testid=&quot;photoviewer-wrapper&quot;&gt;

&lt;div data-testid=&quot;photoviewer-children&quot; class=&quot;css-1a48zt4 ehw59r15&quot;&gt;
&lt;div class=&quot;css-1xdhyk6 erfvjey0&quot;&gt;&lt;span class=&quot;css-1ly73wi e1tej78p0&quot;&gt;Image&lt;/span&gt;&lt;img alt=&quot;Richard Salgado, Google’s director of law enforcement and information security. The company has been public about the secret subpoenas it has received from the F.B.I.&quot; class=&quot;css-1m50asq&quot; src=&quot;https://static01.nyt.com/images/2019/09/20/multimedia/20NSLs-02/merlin_161091351_4febfb63-cfee-4950-8433-3645e630b508-articleLarge.jpg?quality=75&amp;amp;auto=webp&amp;amp;disable=upscale&quot; srcset=&quot;https://static01.nyt.com/images/2019/09/20/multimedia/20NSLs-02/merlin_161091351_4febfb63-cfee-4950-8433-3645e630b508-articleLarge.jpg?quality=90&amp;amp;auto=webp 600w,https://static01.nyt.com/images/2019/09/20/multimedia/20NSLs-02/merlin_161091351_4febfb63-cfee-4950-8433-3645e630b508-jumbo.jpg?quality=90&amp;amp;auto=webp 1024w,https://static01.nyt.com/images/2019/09/20/multimedia/20NSLs-02/merlin_161091351_4febfb63-cfee-4950-8433-3645e630b508-superJumbo.jpg?quality=90&amp;amp;auto=webp 2048w&quot; sizes=&quot;((min-width: 600px) and (max-width: 1004px)) 84vw, (min-width: 1005px) 60vw, 100vw&quot; itemprop=&quot;url&quot; itemid=&quot;https://static01.nyt.com/images/2019/09/20/multimedia/20NSLs-02/merlin_161091351_4febfb63-cfee-4950-8433-3645e630b508-articleLarge.jpg?quality=75&amp;amp;auto=webp&amp;amp;disable=upscale&quot;/&gt;&lt;/div&gt;
&lt;span aria-hidden=&quot;true&quot; class=&quot;css-8i9d0s e13ogyst0&quot;&gt;Richard Salgado, Google’s director of law enforcement and information security. The company has been public about the secret subpoenas it has received from the F.B.I.&lt;/span&gt;&lt;span itemprop=&quot;copyrightHolder&quot; class=&quot;css-vuqh7u e1z0qqy90&quot;&gt;&lt;span class=&quot;css-1ly73wi e1tej78p0&quot;&gt;Credit&lt;/span&gt;&lt;span&gt;Tom Williams/CQ Roll Call, via Getty Images&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;css-1fanzo5 StoryBodyCompanionColumn&quot;&gt;
&lt;div class=&quot;css-53u6y8&quot;&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;The Justice Department declined to comment.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;National security letters, which the F.B.I. has issued since the 1980s, have long been a point of contention in the debate over privacy and security. Initially, the bureau had to show “specific and articulable facts” indicating that the target was an agent of a foreign power. Now, the F.B.I. must certify that the information is “relevant” to a terrorism, counterintelligence or leak investigation.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;“NSLs are an indispensable investigative tool,” the Justice Department argued in the Freedom of Information Act case. The department has said in &lt;a class=&quot;css-1g7m0tk&quot; href=&quot;https://www.eff.org/files/2017/01/10/redacted_opposition_brief.pdf&quot; title=&quot;&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;legal documents&lt;/a&gt; that the information gleaned from the letters is important to identifying subjects and their associates, while helping to clear the innocent of suspicion.&lt;/p&gt;
&lt;/div&gt;
&lt;aside class=&quot;css-o6xoe7&quot;/&gt;&lt;/div&gt;
&lt;div class=&quot;css-1fanzo5 StoryBodyCompanionColumn&quot;&gt;
&lt;div class=&quot;css-53u6y8&quot;&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;According to &lt;a class=&quot;css-1g7m0tk&quot; href=&quot;https://oig.justice.gov/special/s0703b/final.pdf&quot; title=&quot;&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;a 2007 report&lt;/a&gt; from the Justice Department inspector general, the F.B.I. didn’t track how often information from the letters was used in criminal proceedings. But the report also said the letters had led to guilty pleas for arms trading, at least one conviction for material support of terrorism, and multiple charges of fraud and money laundering. The tool was &lt;a class=&quot;css-1g7m0tk&quot; href=&quot;https://www.nytimes.com/2018/05/16/us/politics/crossfire-hurricane-trump-russia-fbi-mueller-investigation.html?module=inline&quot; title=&quot;&quot;&gt;also cited&lt;/a&gt; in efforts to investigate Russian meddling in the 2016 election.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;Much of the concern about the letters has focused on the gag orders, which accompany nearly every request and prevent the recipient — typically indefinitely — from disclosing even the existence of the letter. The federal government has argued that the secrecy is necessary to avoid alerting targets, giving would-be terrorists clues about how the government conducts its surveillance or hurting diplomatic relations.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;After a series of court rulings found that the gag orders violated First Amendment protections, Congress enacted the review requirements.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;The documents obtained through the lawsuit include the number of orders reviewed, as well as redacted copies of 751 letters from the F.B.I. informing companies and organizations their gag orders had been lifted. These so-called termination letters do not reveal the contents of the original national security letters, but indicate which entities received them.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;Because so few gag orders have been reviewed and rescinded, it isn’t possible to say whether the companies that received the most termination letters also received the most national security letters. But given the overall secrecy around the program, the termination letters offer a rare glimpse into these subpoenas.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;Equifax, Experian and AT&amp;amp;T received the most termination letters: more than 50 each. TransUnion, T-Mobile and Verizon each received more than 40. Yahoo, Google and &lt;a class=&quot;css-1g7m0tk&quot; href=&quot;https://blogs.microsoft.com/on-the-issues/2014/05/22/new-success-in-protecting-customer-rights-unsealed-today/&quot; title=&quot;&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;Microsoft&lt;/a&gt; got more than 20 apiece. Over 60 companies received just one.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;The underlying national security letters were not included in the documents, and it is unclear when most of them were issued and who the individual targets were.&lt;/p&gt;
&lt;/div&gt;
&lt;aside class=&quot;css-o6xoe7&quot;/&gt;&lt;/div&gt;
&lt;div class=&quot;css-1fanzo5 StoryBodyCompanionColumn&quot;&gt;
&lt;div class=&quot;css-53u6y8&quot;&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;Tech companies have disclosed more information about the letters they received than the major phone providers, which included general information about them in transparency reports.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;“We have fought for the right to be transparent about our receipt” of national security letters, Richard Salgado, Google’s director of law enforcement and information security, said in a &lt;a class=&quot;css-1g7m0tk&quot; href=&quot;https://www.blog.google/outreach-initiatives/public-policy/sharing-national-security-letters-public/&quot; title=&quot;&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;2016 statement&lt;/a&gt; explaining why the company was releasing &lt;a class=&quot;css-1g7m0tk&quot; href=&quot;https://transparencyreport.google.com/user-data/us-national-security&quot; title=&quot;&quot; rel=&quot;noopener noreferrer&quot; target=&quot;_blank&quot;&gt;the subpoenas&lt;/a&gt;. “Our goal in doing so is to shed more light on the nature and scope” of the requests, he added.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;Other companies have generally remained mum. In response to inquiries, a TransUnion spokesman would say only that the company “has not disclosed the receipt of any national security letters.” A spokesman for Equifax said it was “compliant with the national security letters process.”&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;Mr. Gidari, the former tech lawyer, attributed some of that lack of reporting to differences in company culture, noting that tech firms were more predisposed to openness, and financial institutions less likely to discuss any outside access to customer data. And most small companies, he said, don’t have the resources to keep long-term track of or challenge the subpoenas.&lt;/p&gt;
&lt;p class=&quot;css-exrw3m evys1bk0&quot;&gt;“That’s the problem with the Freedom Act: It procedurally pretended to solve the problem,” he said. “But the whole structure of this involves presumption in favor of the government for perpetual sealing.”&lt;/p&gt;
&lt;/div&gt;
&lt;aside class=&quot;css-o6xoe7&quot;/&gt;&lt;/div&gt;
</description>
<pubDate>Fri, 20 Sep 2019 11:02:21 +0000</pubDate>
<dc:creator>tysone</dc:creator>
<og:url>https://www.nytimes.com/2019/09/20/us/data-privacy-fbi.html</og:url>
<og:type>article</og:type>
<og:title>Secret F.B.I. Subpoenas Scoop Up Personal Data From Scores of Companies</og:title>
<og:image>https://static01.nyt.com/images/2019/09/20/multimedia/20NSLs-02/20NSLs-02-facebookJumbo.jpg</og:image>
<og:description>The practice, which the bureau says is vital to counterterrorism efforts, casts a much wider net than previously disclosed, newly released documents show.</og:description>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://www.nytimes.com/2019/09/20/us/data-privacy-fbi.html</dc:identifier>
</item>
<item>
<title>Explanation of the state of uBlock Origin and other blockers for Safari</title>
<link>https://github.com/el1t/uBlock-Safari/issues/158</link>
<guid isPermaLink="true" >https://github.com/el1t/uBlock-Safari/issues/158</guid>
<description>
&lt;p&gt;Very quick tl;dr: uBO will no longer with Safari, use Firefox or a new &quot;content blocker&quot; app (see below for good replacements).&lt;/p&gt;
&lt;p&gt;In the past few months, and especially in the past week, there have been a lot of posts and comments questioning the status of &lt;a href=&quot;https://github.com/el1t/uBlock-Safari&quot;&gt;uBlock Origin for Safari&lt;/a&gt;. This should answer all questions on the status of uBO for safari.&lt;/p&gt;
&lt;p&gt;uBlock Origin was ported for Safari in 2016, and was updated regulary (mostly changes from the main project) until 2018 when development completley stopped. Since then Apple has begun phasing out Safari extensions as extensions, and has instead been implenting a new extensions framework which is extremley limited in adblocking functions, only allowing &quot;content blockers&quot;, which are just links bundled as an app which Safari enforces. From Safari 12 / macOS Mojave, old legacy Safari extensions were still allowed, but came with warnings saying that they will slow down your browsing (they infact won't, or at least not noticably). Safari also recently shut their Extension Gallery, instead redirecting it to the mac app store. Though it is still curently possible to install uBlock Origin &lt;a href=&quot;https://github.com/el1t/uBlock-Safari/releases/download/1.16.0/uBlock0.safariextz&quot;&gt;by downloading the extension from Github&lt;/a&gt; (edit: must follow &lt;a href=&quot;http://osxdaily.com/2019/02/08/bypass-safari-no-longer-supports-unsafe-extension-error-mac/&quot; rel=&quot;nofollow&quot;&gt;these instructions&lt;/a&gt;, it will not be starting from Safari 13 / macOS Catalina, when the legacy entension API will be fully deprecated.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;It will not possible for uBlock Origin to work with the upcoming Safari 13 / macOS Catalina release&lt;/strong&gt;&lt;br/&gt;If you are a current user of uBlock Origin for Safari here are the options to continue blocking ads:&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;For the moment continue to use uBlockOrigin. Anybody with uBO currently installed, it won't be removed until the next release. If you don't have uBO installed, and wish to install on a pre-Catalina version of Safari, &lt;a href=&quot;https://github.com/el1t/uBlock-Safari/releases/download/1.16.0/uBlock0.safariextz&quot;&gt;Download the latest (and final) release here&lt;/a&gt; and follow &lt;a href=&quot;http://osxdaily.com/2019/02/08/bypass-safari-no-longer-supports-unsafe-extension-error-mac/&quot; rel=&quot;nofollow&quot;&gt;these instructions&lt;/a&gt; to install it. Unfortunately it's a bit complicated. This will stop working with macOS Catalina (coming &quot;this fall&quot;). &lt;strong&gt;Update:&lt;/strong&gt; It appears that it is not possible to install uBO permanently, it will always uninstall on a restart of Safari. If you have it, it &lt;em&gt;should&lt;/em&gt; stay.&lt;/li&gt;
&lt;li&gt;Switch to a different browser. If you choose this, I strongly recomend Firefox. Chrome will itself be ending support for uBlockOrigin soon. If battery life is an issue for you get &lt;a href=&quot;https://www.mozilla.org/en-US/firefox/channel/desktop/&quot; rel=&quot;nofollow&quot;&gt;Firefox Beta, Nightly or Developer&lt;/a&gt; which has &lt;a href=&quot;https://appleinsider.com/articles/19/09/03/firefox-macos-test-build-is-far-better-for-your-battery-life&quot; rel=&quot;nofollow&quot;&gt;massive battery life improvements to bring it on par with Safari / Chrome&lt;/a&gt; being tested (note: somewhat unstable). This will come to the stable version, hopefully in time for uBO-Safari's eol.&lt;/li&gt;
&lt;li&gt;Get a content blocker. Not nearly as powerful as uBO, but the best option if you want to stay with Safari. &lt;strong&gt;Do not get the app called &quot;uBlock&quot;&lt;/strong&gt;, this is unassociated with uBlockOrigin (&lt;a href=&quot;https://en.wikipedia.org/wiki/UBlock_Origin#History&quot; rel=&quot;nofollow&quot;&gt;read about the split here&lt;/a&gt;), and is simply a content blocker with a big negative feature of having acceptable ads built in (which is AdBlockPlus's pay-to-play ad and tracker unblocking program). It shares no code with uBO and has no advantages over any other content blocking app. Here are some recomendations of content blockers:&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;&lt;strong&gt;Top picks&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Other Good Options&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://apps.apple.com/us/app/ghostery-lite/id1436953057&quot; rel=&quot;nofollow&quot;&gt;Ghostery Lite&lt;/a&gt;. Free. Ghostery. Some advanced options for whitelisting. Good lists for ad and tracker blocking.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://adguard.com/en/adguard-mac/overview.html&quot; rel=&quot;nofollow&quot;&gt;Adguard for Mac&lt;/a&gt;. Fully featured system wide adblocker, contains custom lists and element picker. Does cost after a trial, &lt;a href=&quot;https://adguard.com/en/license.html&quot; rel=&quot;nofollow&quot;&gt;see here for prices&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://apps.apple.com/us/app/wipr/id1320666476&quot; rel=&quot;nofollow&quot;&gt;Wipr&lt;/a&gt;. $1.99, simple featureless and popular. Don't see any advantage in this over Ka-block (see above) for an extra $1.99.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;Do Not Reccomend&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;AdBlock Plus for Safari - Supports acceptable ads, a pay-to-play ad allowing system which allows certain ads and trackers which meet guidelines and pay AdBlock Plus. Some of these ads, imo, are not acceptable, and I don't consider any trackers acceptable. Uses Easylist so otherwise is identical to Ka-Block!.&lt;/li&gt;
&lt;li&gt;uBlock - Don't at all associated with uBO or the code which uBO contains. Is instead identical to AdBlock Plus in all but name including acceptable ads.&lt;/li&gt;
&lt;li&gt;AdBlock for Safari (made by BETAFISH INC) - Yet another acceptable ads-supporting blocker which just uses easylist. Avoid.&lt;/li&gt;
&lt;li&gt;There are plenty more on the mac app store, have a look if none of these suit. No new content blockers can spy on you as they send lists though Safari's built in system, so they are all pretty safe. If you find a good one comment and I'll add it to this list.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;Update:&lt;/strong&gt; &lt;a href=&quot;https://github.com/gorhill/uBlock/blob/master/platform/safari/README.md#safari-platform&quot;&gt;Here is a statement from gorhill (uBO developer) on the state of Safari&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Edit:&lt;/strong&gt; a lot people are asking about uBlock Origin not working in the future on Chrome. If you'd like more information on this, &lt;a href=&quot;https://www.ghacks.net/2019/01/22/chrome-extension-manifest-v3-could-end-ublock-origin-for-chrome/&quot; rel=&quot;nofollow&quot;&gt;here is an article from ghacks from january&lt;/a&gt;, and a &lt;a href=&quot;https://bugs.chromium.org/p/chromium/issues/detail?id=896897&amp;amp;desc=2#c23&quot; rel=&quot;nofollow&quot;&gt;statement from gorhill, developer of uBlock&lt;/a&gt;.**&lt;/p&gt;
&lt;p&gt;There has been discussion of this on &lt;a href=&quot;https://old.reddit.com/r/uBlockOrigin/comments/d18cpi/explanation_of_the_state_of_ublock_origin_and/&quot; rel=&quot;nofollow&quot;&gt;Reddit&lt;/a&gt; &lt;a href=&quot;https://github.com/el1t/uBlock-Safari/issues/158&quot; data-hovercard-type=&quot;issue&quot; data-hovercard-url=&quot;/el1t/uBlock-Safari/issues/158/hovercard&quot;&gt;Github&lt;/a&gt; and &lt;a href=&quot;https://github.com/el1t/uBlock-Safari/issues/158&quot; data-hovercard-type=&quot;issue&quot; data-hovercard-url=&quot;/el1t/uBlock-Safari/issues/158/hovercard&quot;&gt;Hacker News&lt;/a&gt;.&lt;/p&gt;
</description>
<pubDate>Fri, 20 Sep 2019 11:00:45 +0000</pubDate>
<dc:creator>n1000</dc:creator>
<og:image>https://avatars0.githubusercontent.com/u/5885378?s=400&amp;v=4</og:image>
<og:type>object</og:type>
<og:title>Explanation of the state of uBlock Origin (and other blockers) for Safari · Issue #158 · el1t/uBlock-Safari</og:title>
<og:url>https://github.com/el1t/uBlock-Safari/issues/158</og:url>
<og:description>Very quick tl;dr: uBO will no longer with Safari, use Firefox or a new &amp;quot;content blocker&amp;quot; app (see below for good replacements). In the past few months, and especially in the past week, th...</og:description>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://github.com/el1t/uBlock-Safari/issues/158</dc:identifier>
</item>
<item>
<title>Ask HN: How to keep yourself accountable?</title>
<link>https://news.ycombinator.com/item?id=21024941</link>
<guid isPermaLink="true" >https://news.ycombinator.com/item?id=21024941</guid>
<description>&lt;tr readability=&quot;0.58823529411765&quot;&gt;&lt;td bgcolor=&quot;#FF6600&quot;&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr id=&quot;pagespace&quot; title=&quot;Ask HN: How to keep yourself accountable?&quot;&gt;&lt;td/&gt;
&lt;/tr&gt;&lt;tr readability=&quot;9.4161392405063&quot;&gt;&lt;td&gt;
&lt;table class=&quot;fatitem&quot; border=&quot;0&quot; readability=&quot;6.4200949367089&quot;&gt;&lt;tr class=&quot;athing&quot; id=&quot;21024941&quot; readability=&quot;0&quot;&gt;&lt;td align=&quot;right&quot; valign=&quot;top&quot; class=&quot;title&quot;/&gt;
&lt;td valign=&quot;top&quot; class=&quot;votelinks&quot;&gt;
&lt;center&gt;

&lt;/center&gt;
&lt;/td&gt;
&lt;td class=&quot;title&quot;&gt;&lt;a href=&quot;https://news.ycombinator.com/item?id=21024941&quot; class=&quot;storylink&quot;&gt;Ask HN: How to keep yourself accountable?&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;0.75&quot;&gt;&lt;td colspan=&quot;2&quot;/&gt;
&lt;td class=&quot;subtext&quot;&gt;&lt;span class=&quot;score&quot; id=&quot;score_21024941&quot;&gt;207 points&lt;/span&gt; by &lt;a href=&quot;https://news.ycombinator.com/user?id=lamchob&quot; class=&quot;hnuser&quot;&gt;lamchob&lt;/a&gt; &lt;span class=&quot;age&quot;&gt;&lt;a href=&quot;https://news.ycombinator.com/item?id=21024941&quot;&gt;15 hours ago&lt;/a&gt;&lt;/span&gt; &lt;span id=&quot;unv_21024941&quot;/&gt; | &lt;a href=&quot;https://news.ycombinator.com/hide?id=21024941&amp;amp;goto=item%3Fid%3D21024941&quot;&gt;hide&lt;/a&gt; | &lt;a href=&quot;https://hn.algolia.com/?query=Ask%20HN%3A%20How%20to%20keep%20yourself%20accountable%3F&amp;amp;sort=byDate&amp;amp;dateRange=all&amp;amp;type=story&amp;amp;storyText=false&amp;amp;prefix&amp;amp;page=0&quot; class=&quot;hnpast&quot;&gt;past&lt;/a&gt; | &lt;a href=&quot;https://www.google.com/search?q=Ask%20HN%3A%20How%20to%20keep%20yourself%20accountable%3F&quot;&gt;web&lt;/a&gt; | &lt;a href=&quot;https://news.ycombinator.com/fave?id=21024941&amp;amp;auth=0deb502cd706359a3b685599204533d55d660664&quot;&gt;favorite&lt;/a&gt; | &lt;a href=&quot;https://news.ycombinator.com/item?id=21024941&quot;&gt;96 comments&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td/&gt;
&lt;/tr&gt;&lt;tr readability=&quot;18.5&quot;&gt;&lt;td colspan=&quot;2&quot;/&gt;
&lt;td readability=&quot;18&quot;&gt;Hi HN,
&lt;p&gt;lately I realized I'm struggeling to keep myself accountable, mainly for work I am the main stakeholder in.&lt;/p&gt;
&lt;p&gt;When working &quot;after spec&quot; or together with someone else on the same code, I can to stick to it and deliver quality I'm satisfied with. But as soon as I work for myself my standards, quality and even goals start going down hill. Short term I'm okay with less and sloppy work, and after a while I regrett no doing a better job.&lt;/p&gt;
&lt;p&gt;Do you guys have ideas, techniques etc. to deal with this behaviour?&lt;/p&gt;
&lt;/td&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td/&gt;
&lt;/tr&gt;&lt;tr&gt;&lt;td colspan=&quot;2&quot;/&gt;
&lt;td&gt;

&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;
&lt;/tr&gt;&lt;tr readability=&quot;0.73972602739726&quot;&gt;&lt;td&gt;&lt;img src=&quot;https://news.ycombinator.com/s.gif&quot; height=&quot;10&quot; width=&quot;0&quot;/&gt;&lt;br/&gt;&lt;center&gt;&lt;a href=&quot;https://www.ycombinator.com/apply/&quot;&gt;Applications are open for YC Winter 2020&lt;/a&gt;&lt;/center&gt;
&lt;br/&gt;&lt;center&gt;&lt;span class=&quot;yclinks&quot;&gt;&lt;a href=&quot;https://news.ycombinator.com/newsguidelines.html&quot;&gt;Guidelines&lt;/a&gt; | &lt;a href=&quot;https://news.ycombinator.com/newsfaq.html&quot;&gt;FAQ&lt;/a&gt; | &lt;a href=&quot;mailto:hn@ycombinator.com&quot;&gt;Support&lt;/a&gt; | &lt;a href=&quot;https://github.com/HackerNews/API&quot;&gt;API&lt;/a&gt; | &lt;a href=&quot;https://news.ycombinator.com/security.html&quot;&gt;Security&lt;/a&gt; | &lt;a href=&quot;https://news.ycombinator.com/lists&quot;&gt;Lists&lt;/a&gt; | &lt;a href=&quot;https://news.ycombinator.com/bookmarklet.html&quot; rel=&quot;nofollow&quot;&gt;Bookmarklet&lt;/a&gt; | &lt;a href=&quot;http://www.ycombinator.com/legal/&quot;&gt;Legal&lt;/a&gt; | &lt;a href=&quot;http://www.ycombinator.com/apply/&quot;&gt;Apply to YC&lt;/a&gt; | &lt;a href=&quot;mailto:hn@ycombinator.com&quot;&gt;Contact&lt;/a&gt;&lt;/span&gt;
&lt;/center&gt;
&lt;/td&gt;
&lt;/tr&gt;</description>
<pubDate>Fri, 20 Sep 2019 09:55:37 +0000</pubDate>
<dc:creator>lamchob</dc:creator>
<dc:format>text/html</dc:format>
<dc:identifier>https://news.ycombinator.com/item?id=21024941</dc:identifier>
</item>
<item>
<title>Lectures in Quantitative Economics with Python [pdf]</title>
<link>https://lectures.quantecon.org/_downloads/pdf/py/Quantitative%20Economics%20with%20Python.pdf</link>
<guid isPermaLink="true" >https://lectures.quantecon.org/_downloads/pdf/py/Quantitative%20Economics%20with%20Python.pdf</guid>
<description>&lt;a href=&quot;https://lectures.quantecon.org/_downloads/pdf/py/Quantitative%20Economics%20with%20Python.pdf&quot;&gt;Download PDF&lt;/a&gt;</description>
<pubDate>Fri, 20 Sep 2019 01:52:26 +0000</pubDate>
<dc:creator>carlcarrie</dc:creator>
<dc:format>application/pdf</dc:format>
<dc:identifier>https://lectures.quantecon.org/_downloads/pdf/py/Quantitative%20Economics%20with%20Python.pdf</dc:identifier>
</item>
<item>
<title>A Gentle introduction to Kubernetes with more than just the basics</title>
<link>https://github.com/eon01/kubernetes-workshop</link>
<guid isPermaLink="true" >https://github.com/eon01/kubernetes-workshop</guid>
<description>&lt;div class=&quot;Box-body&quot;&gt;
&lt;article class=&quot;markdown-body entry-content p-5&quot; itemprop=&quot;text&quot;&gt;&lt;p&gt;&lt;a href=&quot;https://faun.dev/join?utm_source=faun&amp;amp;utm_medium=github&amp;amp;utm_campaign=kubernetes-workshop&quot; rel=&quot;nofollow&quot;&gt;&lt;img src=&quot;https://github.com/eon01/kubernetes-workshop/raw/master/images/join.png&quot; alt=&quot;Join us&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Slides available &lt;a href=&quot;https://slides.com/eon01/kubernetes-workshop#/&quot; rel=&quot;nofollow&quot;&gt;here&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Original article posted &lt;a href=&quot;https://medium.com/faun/a-gentle-introduction-to-kubernetes-4961e443ba26&quot; rel=&quot;nofollow&quot;&gt;here&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Source code &lt;a href=&quot;https://github.com/eon01/kubernetes-workshop&quot;&gt;here&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In this workshop, we're going to:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Deploy Kubernetes services and an Ambassador API gateway.&lt;/li&gt;
&lt;li&gt;Examine the difference between Kubernetes proxies and service mesh like Istio.&lt;/li&gt;
&lt;li&gt;Access the Kubernetes API from the outside and from a Pod.&lt;/li&gt;
&lt;li&gt;Understand what API to choose.&lt;/li&gt;
&lt;li&gt;See how Service Accounts and RBAC works&lt;/li&gt;
&lt;li&gt;Discover some security pitfalls when building Docker images and many interesting things.&lt;/li&gt;
&lt;li&gt;Other things :-)&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;We will start by developing then deploying a simple Python application (a Flask API that returns the list of trending repositories by programming language).&lt;/p&gt;
&lt;h2&gt;Development Environment&lt;/h2&gt;
&lt;p&gt;We are going to use Python 3.6.7&lt;/p&gt;
&lt;p&gt;We are using Ubuntu 18.04 that comes with Python 3.6 by default. You should be able to invoke it with the command python3. (Ubuntu 17.10 and above also come with Python 3.6.7)&lt;/p&gt;
&lt;p&gt;If you use Ubuntu 16.10 and 17.04, you should be able to install it with the following commands:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
sudo apt-get update
sudo apt-get install python3.6
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you are using Ubuntu 14.04 or 16.04, you need to get Python 3 from a Personal Package Archive (PPA):&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
sudo add-apt-repository ppa:deadsnakes/ppa
sudo apt-get update
sudo apt-get install python3.6
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For the other operating systems, visit &lt;a href=&quot;https://realpython.com/installing-python/&quot; rel=&quot;nofollow&quot;&gt;this guide&lt;/a&gt;, follow the instructions and install Python3.&lt;/p&gt;
&lt;p&gt;Now install PIP, the package manager:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
sudo apt-get install python3-pip
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Follow this by the installation of Virtualenvwrapper, which is a virtual environment manager:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
sudo pip3 install virtualenvwrapper
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Create a folder for your virtualenvs (I use ~/dev/PYTHON_ENVS) and set it as WORKON_HOME:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
mkdir  &lt;span class=&quot;pl-k&quot;&gt;~&lt;/span&gt;/dev/PYTHON_ENVS
&lt;span class=&quot;pl-k&quot;&gt;export&lt;/span&gt; WORKON_HOME=&lt;span class=&quot;pl-k&quot;&gt;~&lt;/span&gt;/dev/PYTHON_ENVS
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In order to source the environment details when the user login, add the following lines to ~/.bashrc:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-c1&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;/usr/local/bin/virtualenvwrapper.sh&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;pl-k&quot;&gt;export&lt;/span&gt; WORKON_HOME=&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;~/dev/PYTHON_ENVS&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Make sure to adapt the WORKON_HOME to your real WORKON_HOME. Now we need to create then activate the new environment:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
mkvirtualenv --python=/usr/bin/python3 trendinggitrepositories
workon trendinggitrepositories
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let's create the application directories:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
mkdir trendinggitrepositories
&lt;span class=&quot;pl-c1&quot;&gt;cd&lt;/span&gt; trendinggitrepositories
mkdir api
&lt;span class=&quot;pl-c1&quot;&gt;cd&lt;/span&gt; api
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Once the virtual environment is activated, we can install Flask:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
pip install flask
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Developing a Trending Git Repositories API (Flask)&lt;/h2&gt;
&lt;p&gt;Inside the API folder &lt;code&gt;api&lt;/code&gt;, create a file called &lt;code&gt;app.py&lt;/code&gt; and add the following code:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-python&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; flask &lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; Flask

app &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; Flask(&lt;span class=&quot;pl-c1&quot;&gt;__name__&lt;/span&gt;)

&lt;span class=&quot;pl-en&quot;&gt;@app.route&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;/&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;)
&lt;span class=&quot;pl-k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;index&lt;/span&gt;():
    &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;Hello, World!&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;pl-k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;__main__&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;:
    app.run(&lt;span class=&quot;pl-v&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-c1&quot;&gt;True&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This will return a hello world message when a user requests the &quot;/&quot; route.&lt;/p&gt;
&lt;p&gt;Now run it using: &lt;code&gt;python app.py&lt;/code&gt; and you will see a similar output to the following one:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;* Serving Flask app &quot;api&quot; (lazy loading)
* Environment: production
  WARNING: This is a development server. Do not use it in a production deployment.
  Use a production WSGI server instead.
* Debug mode: on
* Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
* Restarting with stat
* Debugger is active!
* Debugger PIN: 465-052-587
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://github.com/eon01/kubernetes-workshop/blob/master/images/ghtokens.png&quot;&gt;&lt;img src=&quot;https://github.com/eon01/kubernetes-workshop/raw/master/images/ghtokens.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;We now need to install PyGithub since we need it to communicate with Github API v3.&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
pip install PyGithub
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Go to Github and &lt;a href=&quot;https://github.com/settings/applications/new&quot;&gt;create a new app&lt;/a&gt;. We will need the application &quot;Client ID&quot; and &quot;Client Secret&quot;:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-python&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; github &lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; Github
g &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; Github(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;xxxxxxxxxxxxx&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;, &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is how the mini API looks like:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-python&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; flask &lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; Flask, jsonify, abort
&lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; urllib.request, json
&lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; flask &lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; request

app &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; Flask(&lt;span class=&quot;pl-c1&quot;&gt;__name__&lt;/span&gt;)

&lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; github &lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; Github
g &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; Github(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;xxxxxx&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;, &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;xxxxxxxxxxxxx&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;)

&lt;span class=&quot;pl-en&quot;&gt;@app.route&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;/&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;)
&lt;span class=&quot;pl-k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;get_repos&lt;/span&gt;():
    r &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; []

    &lt;span class=&quot;pl-k&quot;&gt;try&lt;/span&gt;:
        args &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; request.args
        n &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;int&lt;/span&gt;(args[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;n&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;])
    &lt;span class=&quot;pl-k&quot;&gt;except&lt;/span&gt; (&lt;span class=&quot;pl-c1&quot;&gt;ValueError&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;LookupError&lt;/span&gt;) &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; e:
        abort(jsonify(&lt;span class=&quot;pl-v&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;No integer provided for argument 'n' in the URL&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;))

    repositories &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; g.search_repositories(&lt;span class=&quot;pl-v&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;language:python&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;)[:n]

    &lt;span class=&quot;pl-k&quot;&gt;for&lt;/span&gt; repo &lt;span class=&quot;pl-k&quot;&gt;in&lt;/span&gt; repositories:
        &lt;span class=&quot;pl-k&quot;&gt;with&lt;/span&gt; urllib.request.urlopen(repo.url) &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; url:
            data &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; json.loads(url.read().decode())
        r.append(data)

    &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt; jsonify({&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;repos&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;:r })

&lt;span class=&quot;pl-k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;__main__&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;:
    app.run(&lt;span class=&quot;pl-v&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-c1&quot;&gt;True&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let's hide the Github token and secret as well as other variables in the environment.&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-python&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; flask &lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; Flask, jsonify, abort, request
&lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; urllib.request, json, os
&lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; github &lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; Github

app &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; Flask(&lt;span class=&quot;pl-c1&quot;&gt;__name__&lt;/span&gt;)

&lt;span class=&quot;pl-c1&quot;&gt;CLIENT_ID&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; os.environ[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;CLIENT_ID&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]
&lt;span class=&quot;pl-c1&quot;&gt;CLIENT_SECRET&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; os.environ[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;CLIENT_SECRET&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]
&lt;span class=&quot;pl-c1&quot;&gt;DEBUG&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; os.environ[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;DEBUG&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]

g &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; Github(&lt;span class=&quot;pl-c1&quot;&gt;CLIENT_ID&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;CLIENT_SECRET&lt;/span&gt;)


&lt;span class=&quot;pl-en&quot;&gt;@app.route&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;/&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;)
&lt;span class=&quot;pl-k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;get_repos&lt;/span&gt;():
    r &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; []

    &lt;span class=&quot;pl-k&quot;&gt;try&lt;/span&gt;:
        args &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; request.args
        n &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;int&lt;/span&gt;(args[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;n&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;])
    &lt;span class=&quot;pl-k&quot;&gt;except&lt;/span&gt; (&lt;span class=&quot;pl-c1&quot;&gt;ValueError&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;LookupError&lt;/span&gt;) &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; e:
        abort(jsonify(&lt;span class=&quot;pl-v&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;No integer provided for argument 'n' in the URL&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;))

    repositories &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; g.search_repositories(&lt;span class=&quot;pl-v&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;language:python&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;)[:n]

    &lt;span class=&quot;pl-k&quot;&gt;for&lt;/span&gt; repo &lt;span class=&quot;pl-k&quot;&gt;in&lt;/span&gt; repositories:
        &lt;span class=&quot;pl-k&quot;&gt;with&lt;/span&gt; urllib.request.urlopen(repo.url) &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; url:
            data &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; json.loads(url.read().decode())
        r.append(data)

    &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt; jsonify({&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;repos&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;:r })

&lt;span class=&quot;pl-k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;__main__&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;:
    app.run(&lt;span class=&quot;pl-v&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-c1&quot;&gt;DEBUG&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The code above will return the top &quot;n&quot; repositories using Python as a programming language. We can use other languages too:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-python&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; flask &lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; Flask, jsonify, abort, request
&lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; urllib.request, json, os
&lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; github &lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; Github

app &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; Flask(&lt;span class=&quot;pl-c1&quot;&gt;__name__&lt;/span&gt;)

&lt;span class=&quot;pl-c1&quot;&gt;CLIENT_ID&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; os.environ[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;CLIENT_ID&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]
&lt;span class=&quot;pl-c1&quot;&gt;CLIENT_SECRET&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; os.environ[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;CLIENT_SECRET&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]
&lt;span class=&quot;pl-c1&quot;&gt;DEBUG&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; os.environ[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;DEBUG&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]

g &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; Github(&lt;span class=&quot;pl-c1&quot;&gt;CLIENT_ID&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;CLIENT_SECRET&lt;/span&gt;)


&lt;span class=&quot;pl-en&quot;&gt;@app.route&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;/&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;)
&lt;span class=&quot;pl-k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;get_repos&lt;/span&gt;():
    r &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; []

    &lt;span class=&quot;pl-k&quot;&gt;try&lt;/span&gt;:
        args &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; request.args
        n &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;int&lt;/span&gt;(args[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;n&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;])
        l &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; args[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;l&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]
    &lt;span class=&quot;pl-k&quot;&gt;except&lt;/span&gt; (&lt;span class=&quot;pl-c1&quot;&gt;ValueError&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;LookupError&lt;/span&gt;) &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; e:
        abort(jsonify(&lt;span class=&quot;pl-v&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;Please provide 'n' and 'l' parameters&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;))

    repositories &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; g.search_repositories(&lt;span class=&quot;pl-v&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;language:&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;+&lt;/span&gt; l)[:n]


    &lt;span class=&quot;pl-k&quot;&gt;try&lt;/span&gt;:
        &lt;span class=&quot;pl-k&quot;&gt;for&lt;/span&gt; repo &lt;span class=&quot;pl-k&quot;&gt;in&lt;/span&gt; repositories:
            &lt;span class=&quot;pl-k&quot;&gt;with&lt;/span&gt; urllib.request.urlopen(repo.url) &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; url:
                data &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; json.loads(url.read().decode())
            r.append(data)
        &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt; jsonify({
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;repos&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;:r,
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;status&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;ok&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
            })
    &lt;span class=&quot;pl-k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;IndexError&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; e:
        &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt; jsonify({
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;repos&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;:r,
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;status&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;ko&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
            })

&lt;span class=&quot;pl-k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;__main__&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;:
    app.run(&lt;span class=&quot;pl-v&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-c1&quot;&gt;DEBUG&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In a .env file, add the variables you want to use:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;CLIENT_ID=&quot;xxxxx&quot;
CLIENT_SECRET=&quot;xxxxxx&quot;
ENV=&quot;dev&quot;
DEBUG=&quot;True&quot;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Before running the Flask application, you need to source these variables:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-c1&quot;&gt;source&lt;/span&gt; .env
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, you can go to &lt;code&gt;http://0.0.0.0:5000/?n=1&amp;amp;l=python&lt;/code&gt; to get the trendiest Python repository or &lt;code&gt;http://0.0.0.0:5000/?n=1&amp;amp;l=c&lt;/code&gt; for C programming language. Here is a list of other programming languages you can test your code with:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;C++
Assembly
Objective
Makefile
Shell
Perl
Python
Roff
Yacc
Lex
Awk
UnrealScript
Gherkin
M4
Clojure
XS
Perl
sed
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The list is long, but our mini API is working fine. Now, let's freeze the dependencies:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
pip freeze &lt;span class=&quot;pl-k&quot;&gt;&amp;gt;&lt;/span&gt; requirements.txt
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Before running the API on Kubernetes, let's create a Dockerfile. This is a typical Dockerfile for a Python app:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;FROM python:3
ENV PYTHONUNBUFFERED 1
RUN mkdir /app
WORKDIR /app
COPY requirements.txt /app
RUN pip install --upgrade pip
RUN pip install -r requirements.txt
COPY . /app
EXPOSE 5000
CMD [ &quot;python&quot;, &quot;app.py&quot; ]
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Now you can build it:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
docker build --no-cache -t tgr &lt;span class=&quot;pl-c1&quot;&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then run it:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
docker rm -f tgr
docker run --it  --name tgr -p 5000:5000 -e CLIENT_ID=&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;xxxxxxx&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; -e CLIENT_SECRET=&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;xxxxxxxxxxxxxxx&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; -e DEBUG=&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;True&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; tgr
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let's include some other variables as environment variables:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-python&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; flask &lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; Flask, jsonify, abort, request
&lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; urllib.request, json, os
&lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; github &lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; Github

app &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; Flask(&lt;span class=&quot;pl-c1&quot;&gt;__name__&lt;/span&gt;)

&lt;span class=&quot;pl-c1&quot;&gt;CLIENT_ID&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; os.environ[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;CLIENT_ID&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]
&lt;span class=&quot;pl-c1&quot;&gt;CLIENT_SECRET&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; os.environ[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;CLIENT_SECRET&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]
&lt;span class=&quot;pl-c1&quot;&gt;DEBUG&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; os.environ[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;DEBUG&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]
&lt;span class=&quot;pl-c1&quot;&gt;HOST&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; os.environ[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;HOST&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]
&lt;span class=&quot;pl-c1&quot;&gt;PORT&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; os.environ[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;PORT&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]

g &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; Github(&lt;span class=&quot;pl-c1&quot;&gt;CLIENT_ID&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;CLIENT_SECRET&lt;/span&gt;)


&lt;span class=&quot;pl-en&quot;&gt;@app.route&lt;/span&gt;(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;/&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;)
&lt;span class=&quot;pl-k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;pl-en&quot;&gt;get_repos&lt;/span&gt;():
    r &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; []

    &lt;span class=&quot;pl-k&quot;&gt;try&lt;/span&gt;:
        args &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; request.args
        n &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;int&lt;/span&gt;(args[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;n&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;])
        l &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; args[&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;l&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;]
    &lt;span class=&quot;pl-k&quot;&gt;except&lt;/span&gt; (&lt;span class=&quot;pl-c1&quot;&gt;ValueError&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;LookupError&lt;/span&gt;) &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; e:
        abort(jsonify(&lt;span class=&quot;pl-v&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;Please provide 'n' and 'l' parameters&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;))

    repositories &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; g.search_repositories(&lt;span class=&quot;pl-v&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;language:&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;+&lt;/span&gt; l)[:n]


    &lt;span class=&quot;pl-k&quot;&gt;try&lt;/span&gt;:
        &lt;span class=&quot;pl-k&quot;&gt;for&lt;/span&gt; repo &lt;span class=&quot;pl-k&quot;&gt;in&lt;/span&gt; repositories:
            &lt;span class=&quot;pl-k&quot;&gt;with&lt;/span&gt; urllib.request.urlopen(repo.url) &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; url:
                data &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; json.loads(url.read().decode())
            r.append(data)
        &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt; jsonify({
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;repos&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;:r,
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;status&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;ok&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
            })
    &lt;span class=&quot;pl-k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;IndexError&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; e:
        &lt;span class=&quot;pl-k&quot;&gt;return&lt;/span&gt; jsonify({
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;repos&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;:r,
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;status&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;ko&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
            })

&lt;span class=&quot;pl-k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;__main__&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;:
    app.run(&lt;span class=&quot;pl-v&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-c1&quot;&gt;DEBUG&lt;/span&gt;, &lt;span class=&quot;pl-v&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-c1&quot;&gt;HOST&lt;/span&gt;, &lt;span class=&quot;pl-v&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;pl-c1&quot;&gt;PORT&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For security reasons, let's change the user inside the container from root to a user with less rights that we create:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;FROM python:3
ENV PYTHONUNBUFFERED 1
RUN adduser pyuser

RUN mkdir /app
WORKDIR /app
COPY requirements.txt /app
RUN pip install --upgrade pip
RUN pip install -r requirements.txt
COPY . .
RUN chmod +x app.py

RUN chown -R pyuser:pyuser /app
USER pyuser


EXPOSE 5000
CMD [&quot;python&quot;,&quot;./app.py&quot;]
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Now if we want to run the container, we need to add many environment variables to the docker run command. An easier solution is using &lt;code&gt;--env-file&lt;/code&gt; with Docker run:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
docker run -it --env-file .env my_container
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our .env file looks like the following one:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;CLIENT_ID=&quot;xxxx&quot;
CLIENT_SECRET=&quot;xxxx&quot;
ENV=&quot;dev&quot;
DEBUG=&quot;True&quot;
HOST=&quot;0.0.0.0&quot;
PORT=5000
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;After this modification, rebuild the image &lt;code&gt;docker build -t tgr .&lt;/code&gt; and run it using:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
docker rm -f tgr&lt;span class=&quot;pl-k&quot;&gt;;&lt;/span&gt;
docker run -it  --name tgr -p 5000:5000 --env-file .env  tgr
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our application runs using &lt;code&gt;python app.py&lt;/code&gt; which is the webserver that ships with Flask and t's great for development and local execution of your program, however, it's not designed to run in a production mode, whether it's a monolithic app or a microservice.&lt;/p&gt;
&lt;p&gt;A production server typically receives abuse from spammers, script kiddies, and should be able to handle high traffic. In our case, a good solution is using a WSGI HTTP server like Gunicorn (or uWsgi).&lt;/p&gt;
&lt;p&gt;First, let's install &lt;code&gt;gunicorn&lt;/code&gt; with the following command: &lt;code&gt;pip install gunicorn&lt;/code&gt;. This will require us to update our &lt;code&gt;requirements.txt&lt;/code&gt; with &lt;code&gt;pip freeze &amp;gt; requirements.txt&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This is why we are going to change our Docker file:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;FROM python:3
ENV PYTHONUNBUFFERED 1
RUN adduser pyuser

RUN mkdir /app
WORKDIR /app
COPY requirements.txt /app
RUN pip install --upgrade pip
RUN pip install -r requirements.txt
COPY . .
RUN chmod +x app.py

RUN chown -R pyuser:pyuser /app
USER pyuser


EXPOSE 5000
CMD [&quot;gunicorn&quot;, &quot;app:app&quot;, &quot;-b&quot;, &quot;0.0.0.0:5000&quot;]
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;In order to optimize the Wsgi server, we need to set the number of its workers and threads to:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;workers = multiprocessing.cpu_count() * 2 + 1
threads = 2 * multiprocessing.cpu_count()
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;This is why we are going to create another Python configuration file (&lt;code&gt;config.py&lt;/code&gt;):&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-python&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; multiprocessing
workers &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; multiprocessing.cpu_count() &lt;span class=&quot;pl-k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;
threads &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;*&lt;/span&gt; multiprocessing.cpu_count()
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the same file, we are going to include other configurations of Gunicorn:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-python&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; os &lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; environ &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; env
bind &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; env.get(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;HOST&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;0.0.0.0&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;) &lt;span class=&quot;pl-k&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;:&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;+&lt;/span&gt; env.get(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;PORT&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;5000&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is the final &lt;code&gt;config.py&lt;/code&gt; file:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-python&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; multiprocessing
workers &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; multiprocessing.cpu_count() &lt;span class=&quot;pl-k&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;
threads &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;pl-c1&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;*&lt;/span&gt; multiprocessing.cpu_count()

&lt;span class=&quot;pl-k&quot;&gt;from&lt;/span&gt; os &lt;span class=&quot;pl-k&quot;&gt;import&lt;/span&gt; environ &lt;span class=&quot;pl-k&quot;&gt;as&lt;/span&gt; env
bind &lt;span class=&quot;pl-k&quot;&gt;=&lt;/span&gt; env.get(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;HOST&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;0.0.0.0&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;) &lt;span class=&quot;pl-k&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;:&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;pl-k&quot;&gt;+&lt;/span&gt; env.get(&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;PORT&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;, &lt;span class=&quot;pl-c1&quot;&gt;5000&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In consequence, we should adapt the Dockerfile to the new Gunicorn configuration by changing the last line to :&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;CMD [&quot;gunicorn&quot;, &quot;app:app&quot;, &quot;--config=config.py&quot;]
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Now, build &lt;code&gt;docker build -t tgr .&lt;/code&gt; and run &lt;code&gt;docker run -it --env-file .env -p 5000:5000 tgr&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;A Docker registry is a storage and distribution system for named Docker images.&lt;/p&gt;
&lt;p&gt;The images we built are stored in our local environment and can only be used if you deploy locally. However, if you choose to deploy a Kubernetes cluster in a cloud or any different environment, these images will be not found. This is why we need to push the build images to a remote registry.&lt;/p&gt;
&lt;p&gt;Think of container registries as a git system for Docker images.&lt;/p&gt;
&lt;p&gt;There are plenty of containers registries:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;Dockerhub&lt;/li&gt;
&lt;li&gt;Amazon Elastic Registry (ECR)&lt;/li&gt;
&lt;li&gt;Azure Container Registry (ACR)&lt;/li&gt;
&lt;li&gt;Google Container Registry (GCR)&lt;/li&gt;
&lt;li&gt;CoreOS Quay&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;You can also host your private container registry that supports OAuth, LDAP and Active Directory authentication using the registry provided by Docker:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
docker run -d -p 5000:5000 --restart=always --name registry registry:2
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;More about self-hosting a registry can be found in &lt;a href=&quot;https://docs.docker.com/registry/deploying/&quot; rel=&quot;nofollow&quot;&gt;the official Docker documentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We are going to use Dockerhub; this is why you need to create an account on &lt;a href=&quot;https://hub.docker.com/&quot; rel=&quot;nofollow&quot;&gt;hub.docker.com&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Now, using Docker CLI, login:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
docker login
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now rebuild the image using the new tag:&lt;/p&gt;
&lt;pre lang=&quot;&amp;lt;username&amp;gt;/&amp;lt;image_name&amp;gt;:&amp;lt;tag_version&amp;gt;&quot;&gt;
&lt;code&gt; docker build -t &amp;lt;username&amp;gt;/&amp;lt;image_name&amp;gt;:&amp;lt;tag_version&amp;gt; .
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Example:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
docker build -t eon01/tgr:1 &lt;span class=&quot;pl-c1&quot;&gt;.&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally, push the image:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
docker push eon01/tgr:1
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;A Security Notice&lt;/h2&gt;
&lt;p&gt;Many of the publicly (and even private Docker images) seems to be secure, but it's not the case. When we built our image, we told Docker to copy all the images from the application folder to the image and we push it to an external public registry.&lt;/p&gt;

&lt;p&gt;Or&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;ADD . .
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;The above commands will even copy the &lt;code&gt;.env&lt;/code&gt; file containing our secrets.&lt;/p&gt;
&lt;p&gt;A good solution is to tell Docker to ignore these files during the build using a .dockeringore file:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;**.git
**.gitignore
**README.md
**env.*
**Dockerfile*
**docker-compose*
**.env
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;At this stage, you should remove any image that you pushed to a distant registry, reset the Github tokens, build the new image without any cache:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
docker build -t eon01/tgr:1 &lt;span class=&quot;pl-c1&quot;&gt;.&lt;/span&gt; --no-cache
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Push it again:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
docker push eon01/tgr:1
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;One of the fastest ways to try Kubernetes is using Minkube, which will create a virtual machine for you and deploy a ready-to-use Kubernetes cluster.&lt;/p&gt;
&lt;p&gt;Before you begin the installation, you need to make sure that your laptop supports virtualization:&lt;/p&gt;
&lt;p&gt;If your using Linux, run the following command and make sure that the output is not empty:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
grep -E --color &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;vmx|svm&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt; /proc/cpuinfo
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Mac users should execute:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
sysctl -a &lt;span class=&quot;pl-k&quot;&gt;|&lt;/span&gt; grep -E --color &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;machdep.cpu.features|VMX&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you see &lt;code&gt;VMX&lt;/code&gt; in the output, the VT-x feature is enabled in your machine.&lt;/p&gt;
&lt;p&gt;Windows users should use &lt;code&gt;systeminfo&lt;/code&gt; and you should see the following output:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;Hyper-V Requirements:     VM Monitor Mode Extensions: Yes
                          Virtualization Enabled In Firmware: Yes
                          Second Level Address Translation: Yes
                          Data Execution Prevention Available: Yes
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;If everything is okay, you need to install a hypervisor. You have a list of possibilities here:&lt;/p&gt;
&lt;p&gt;Some of these hypervisors are only compatible with some OSs like Hyper-V (formerly known as Windows Server Virtualization) for windows.&lt;/p&gt;
&lt;p&gt;VirtualBox is however cross-platform, and this is why we are going to use it here. Make sure to &lt;a href=&quot;https://www.virtualbox.org/wiki/Downloads&quot; rel=&quot;nofollow&quot;&gt;follow the instructions&lt;/a&gt; to install it.&lt;/p&gt;
&lt;p&gt;Now, install Minikube.&lt;/p&gt;
&lt;p&gt;Linux systems:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 &lt;span class=&quot;pl-k&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; chmod +x minikube
sudo install minikube /usr/local/bin
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;MacOs:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
brew cask install minikube
curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64 &lt;span class=&quot;pl-k&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; chmod +x minikube
sudo mv minikube /usr/local/bin
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Windows:&lt;/p&gt;
&lt;p&gt;Use Chocolatey as an administrator:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
choco install minikube
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Or use &lt;a href=&quot;https://github.com/kubernetes/minikube/releases/latest/download/minikube-installer.exe&quot;&gt;the installer binary&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Minikube does not support all Kubernetes features (like load balancing for example), however, you can find the most important features there:&lt;/p&gt;
&lt;p&gt;Minikube supports the following Kubernetes features:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;DNS&lt;/li&gt;
&lt;li&gt;NodePorts&lt;/li&gt;
&lt;li&gt;ConfigMaps and Secrets&lt;/li&gt;
&lt;li&gt;Dashboards&lt;/li&gt;
&lt;li&gt;Container Runtime: Docker, &lt;a href=&quot;https://github.com/rkt/rkt&quot;&gt;rkt&lt;/a&gt;, &lt;a href=&quot;https://github.com/kubernetes-incubator/cri-o&quot;&gt;CRI-O&lt;/a&gt;, and &lt;a href=&quot;https://github.com/containerd/containerd&quot;&gt;containerd&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Enabling CNI (Container Network Interface)&lt;/li&gt;
&lt;li&gt;Ingress&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;You can also add different addons like:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;addon-manager&lt;/li&gt;
&lt;li&gt;dashboard&lt;/li&gt;
&lt;li&gt;default-storageclass&lt;/li&gt;
&lt;li&gt;efk&lt;/li&gt;
&lt;li&gt;freshpod&lt;/li&gt;
&lt;li&gt;gvisor&lt;/li&gt;
&lt;li&gt;heapster&lt;/li&gt;
&lt;li&gt;ingress&lt;/li&gt;
&lt;li&gt;logviewer&lt;/li&gt;
&lt;li&gt;metrics-server&lt;/li&gt;
&lt;li&gt;nvidia-driver-installer&lt;/li&gt;
&lt;li&gt;nvidia-gpu-device-plugin&lt;/li&gt;
&lt;li&gt;registry&lt;/li&gt;
&lt;li&gt;registry-creds&lt;/li&gt;
&lt;li&gt;storage-provisioner&lt;/li&gt;
&lt;li&gt;storage-provisioner-gluster&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;If you run &lt;code&gt;minikube start&lt;/code&gt; a cluster called minikube will be created; however, you have other choices rather than just creating a regular Minikube cluster. In this example, we are going to create a cluster called &quot;workshop&quot;, enable a UI to browse the API and activate tailing logs:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
minikube start -p workshop --extra-config=apiserver.enable-swagger-ui=true --alsologtostderr
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You have plenty of other options to start a Minikube cluster; you can, for instance, choose the Kubernetes version and the VM driver:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
minikube start --kubernetes-version=&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;v1.12.0&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; --vm-driver=&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;virtualbox&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;  
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Start the new cluster:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
minikube start -p workshop --extra-config=apiserver.enable-swagger-ui=true --alsologtostderr
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can get detailed information about the cluster using:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl cluster-info
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you didn't install kubectl, &lt;a href=&quot;https://kubernetes.io/docs/tasks/tools/install-kubectl&quot; rel=&quot;nofollow&quot;&gt;follow the official instructions&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;You can open the dashboard using &lt;code&gt;minikube -p workshop dashboard&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;We have three main ways to deploy our container to Kubernetes and scale it to N replica.&lt;/p&gt;
&lt;p&gt;The first one is the original form of replication in Kubernetes, and it's called &lt;strong&gt;Replication Controller&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Even if Replica Sets replace it, it's still used in some codes.&lt;/p&gt;
&lt;p&gt;This is a typical example:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-yaml&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-ent&quot;&gt;apiVersion&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;kind&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;ReplicationController&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;metadata&lt;/span&gt;:
  &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;app&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;spec&lt;/span&gt;:
  &lt;span class=&quot;pl-ent&quot;&gt;replicas&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;selector&lt;/span&gt;:
    &lt;span class=&quot;pl-ent&quot;&gt;app&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;app&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;template&lt;/span&gt;:
    &lt;span class=&quot;pl-ent&quot;&gt;metadata&lt;/span&gt;:
      &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;app&lt;/span&gt;
      &lt;span class=&quot;pl-ent&quot;&gt;labels&lt;/span&gt;:
        &lt;span class=&quot;pl-ent&quot;&gt;app&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;app&lt;/span&gt;
    &lt;span class=&quot;pl-ent&quot;&gt;spec&lt;/span&gt;:
      &lt;span class=&quot;pl-ent&quot;&gt;containers&lt;/span&gt;:
      - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;tgr&lt;/span&gt;
        &lt;span class=&quot;pl-ent&quot;&gt;image&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;reg/app:v1&lt;/span&gt;
        &lt;span class=&quot;pl-ent&quot;&gt;ports&lt;/span&gt;:
        - &lt;span class=&quot;pl-ent&quot;&gt;containerPort&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;80&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can also use Replica Sets, another way to deploy an app and replicate it:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-yaml&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-ent&quot;&gt;apiVersion&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;extensions/v1beta1&lt;/span&gt;
 &lt;span class=&quot;pl-ent&quot;&gt;kind&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;ReplicaSet&lt;/span&gt;
 &lt;span class=&quot;pl-ent&quot;&gt;metadata&lt;/span&gt;:
   &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;app&lt;/span&gt;
 &lt;span class=&quot;pl-ent&quot;&gt;spec&lt;/span&gt;:
   &lt;span class=&quot;pl-ent&quot;&gt;replicas&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;3&lt;/span&gt;
   &lt;span class=&quot;pl-ent&quot;&gt;selector&lt;/span&gt;:
     &lt;span class=&quot;pl-ent&quot;&gt;matchLabels&lt;/span&gt;:
       &lt;span class=&quot;pl-ent&quot;&gt;app&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;app&lt;/span&gt;
   &lt;span class=&quot;pl-ent&quot;&gt;template&lt;/span&gt;:
     &lt;span class=&quot;pl-ent&quot;&gt;metadata&lt;/span&gt;:
       &lt;span class=&quot;pl-ent&quot;&gt;labels&lt;/span&gt;:
         &lt;span class=&quot;pl-ent&quot;&gt;app&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;app&lt;/span&gt;
         &lt;span class=&quot;pl-ent&quot;&gt;environment&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;dev&lt;/span&gt;
     &lt;span class=&quot;pl-ent&quot;&gt;spec&lt;/span&gt;:
       &lt;span class=&quot;pl-ent&quot;&gt;containers&lt;/span&gt;:
       - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;app&lt;/span&gt;
         &lt;span class=&quot;pl-ent&quot;&gt;image&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;reg/app:v1&lt;/span&gt;
         &lt;span class=&quot;pl-ent&quot;&gt;ports&lt;/span&gt;:
         - &lt;span class=&quot;pl-ent&quot;&gt;containerPort&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;80&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Replica Set and Replication Controller do almost the same thing.&lt;/p&gt;
&lt;p&gt;They ensure that you have a specified number of pod replicas running at any given time in your cluster.&lt;/p&gt;
&lt;p&gt;There are however, some differences.&lt;/p&gt;
&lt;p&gt;As you may notice, we are using &lt;code&gt;matchLabels&lt;/code&gt; instead of &lt;code&gt;label&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Replica Set use Set-Based selectors while replication controllers use Equity-Based selectors.&lt;/p&gt;
&lt;p&gt;Selectors match Kubernetes objects (like pods) using the constraints of the specified label, and we are going to see an example in a Deployment specification file.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Label selectors&lt;/strong&gt; with &lt;strong&gt;equality-based requirements&lt;/strong&gt; use three operators:&lt;code&gt;=&lt;/code&gt;,&lt;code&gt;==&lt;/code&gt; and &lt;code&gt;!=&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;environment = production
tier != frontend
app == my_app (similar to app = my_app)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;In the last example, we used this notation:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt; ...
 spec:
   replicas: 3
   selector:
     matchLabels:
       app: app
   template:
     metadata:
...     
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;We could have used &lt;strong&gt;set-based requirements&lt;/strong&gt;:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;...
spec:
   replicas: 3
   selector:
     matchExpressions:
      - {key: app, operator: In, values: [app]}     
  template:
     metadata:
...
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;If we have more than 1 value for the app key, we can use:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;...
spec:
   replicas: 3
   selector:
     matchExpressions:
      - {key: app, operator: In, values: [app, my_app, myapp, application]}     
  template:
     metadata:
...
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;And if we have other keys, we can use them like in the following example:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;...
spec:
  replicas: 3
  selector:
    matchExpressions:
     - {key: app, operator: In, values: [app]}
     - {key: tier, operator: NotIn, values: [frontend]}
     - {key: environment, operator: NotIn, values: [production]}
template:
    metadata:
...
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Newer Kubernetes resources such as Jobs, Deployments, ReplicaSets, and DaemonSets all support set-based requirements as well.&lt;/p&gt;
&lt;p&gt;This is an example of how we use Kubectl with selectors :&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl delete pods -l &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;env in (production, staging, testing)&lt;span class=&quot;pl-pds&quot;&gt;'&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Until now, we have seen that the Replication Controller and Replica Set are two ways to deploy our container and manage it in a Kubernetes cluster. However, the recommended approach is using a Deployment that configures a ReplicaSet.&lt;/p&gt;
&lt;p&gt;It is rather unlikely that we will ever need to create Pods directly for a production use-case since Deployments manages to create Pods for us through ReplicaSets.&lt;/p&gt;
&lt;p&gt;This is a simple Pod definition:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-yaml&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-ent&quot;&gt;apiVersion&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;kind&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;Pod&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;metadata&lt;/span&gt;:
  &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;infinite&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;labels&lt;/span&gt;:
    &lt;span class=&quot;pl-ent&quot;&gt;env&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;production&lt;/span&gt;
    &lt;span class=&quot;pl-ent&quot;&gt;owner&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;eon01&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;spec&lt;/span&gt;:
  &lt;span class=&quot;pl-ent&quot;&gt;containers&lt;/span&gt;:
  - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;infinite&lt;/span&gt;
    &lt;span class=&quot;pl-ent&quot;&gt;image&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;eon01/infinite&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In practice, we need:&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;&lt;strong&gt;A Deployment object&lt;/strong&gt; : Containers are specified here.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;A Service object&lt;/strong&gt;: An abstract way to expose an application running on a set of Pods as a network service.&lt;/li&gt;
&lt;/ol&gt;&lt;p&gt;This is a Deployment object that creates three replicas of the container app running the image &quot;reg/app:v1&quot;. These containers can be reached using port 80:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-yaml&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-ent&quot;&gt;apiVersion&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;extensions/v1beta1&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;kind&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;Deployment&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;metadata&lt;/span&gt;:
  &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;app&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;spec&lt;/span&gt;:
  &lt;span class=&quot;pl-ent&quot;&gt;replicas&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;template&lt;/span&gt;:
    &lt;span class=&quot;pl-ent&quot;&gt;metadata&lt;/span&gt;:
      &lt;span class=&quot;pl-ent&quot;&gt;labels&lt;/span&gt;:
        &lt;span class=&quot;pl-ent&quot;&gt;app&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;app&lt;/span&gt;
    &lt;span class=&quot;pl-ent&quot;&gt;spec&lt;/span&gt;:
      &lt;span class=&quot;pl-ent&quot;&gt;containers&lt;/span&gt;:
      - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;app&lt;/span&gt;
        &lt;span class=&quot;pl-ent&quot;&gt;image&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;reg/app:v1&lt;/span&gt;
        &lt;span class=&quot;pl-ent&quot;&gt;ports&lt;/span&gt;:
        - &lt;span class=&quot;pl-ent&quot;&gt;containerPort&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;80&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This is the Deployment file we will use (save it to &lt;code&gt;kubernetes/api-deployment.yaml&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-yaml&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-ent&quot;&gt;apiVersion&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;apps/v1&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;kind&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;Deployment&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;metadata&lt;/span&gt;:
  &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;tgr&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;labels&lt;/span&gt;:
    &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;tgr&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;spec&lt;/span&gt;:
  &lt;span class=&quot;pl-ent&quot;&gt;replicas&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;selector&lt;/span&gt;:
    &lt;span class=&quot;pl-ent&quot;&gt;matchLabels&lt;/span&gt;:
      &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;tgr&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;template&lt;/span&gt;:
    &lt;span class=&quot;pl-ent&quot;&gt;metadata&lt;/span&gt;:
      &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;tgr&lt;/span&gt;
      &lt;span class=&quot;pl-ent&quot;&gt;labels&lt;/span&gt;:
        &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;tgr&lt;/span&gt;
    &lt;span class=&quot;pl-ent&quot;&gt;spec&lt;/span&gt;:
      &lt;span class=&quot;pl-ent&quot;&gt;containers&lt;/span&gt;:
        - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;tgr&lt;/span&gt;
          &lt;span class=&quot;pl-ent&quot;&gt;image&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;eon01/tgr:1&lt;/span&gt;
          &lt;span class=&quot;pl-ent&quot;&gt;ports&lt;/span&gt;:
            - &lt;span class=&quot;pl-ent&quot;&gt;containerPort&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;5000&lt;/span&gt;
          &lt;span class=&quot;pl-ent&quot;&gt;resources&lt;/span&gt;:
            &lt;span class=&quot;pl-ent&quot;&gt;requests&lt;/span&gt;:
              &lt;span class=&quot;pl-ent&quot;&gt;memory&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;128Mi&lt;/span&gt;
            &lt;span class=&quot;pl-ent&quot;&gt;limits&lt;/span&gt;:
              &lt;span class=&quot;pl-ent&quot;&gt;memory&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;256Mi&lt;/span&gt;
          &lt;span class=&quot;pl-ent&quot;&gt;env&lt;/span&gt;:
            - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;CLIENT_ID&lt;/span&gt;
              &lt;span class=&quot;pl-ent&quot;&gt;value&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;xxxx&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;CLIENT_SECRET&lt;/span&gt;
              &lt;span class=&quot;pl-ent&quot;&gt;value&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;xxxxxxxxxxxxxxxxxxxxx&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;ENV&lt;/span&gt;
              &lt;span class=&quot;pl-ent&quot;&gt;value&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;prod&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;DEBUG&lt;/span&gt;
              &lt;span class=&quot;pl-ent&quot;&gt;value&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;False&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;HOST&lt;/span&gt;
              &lt;span class=&quot;pl-ent&quot;&gt;value&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;0.0.0.0&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;PORT&lt;/span&gt;
              &lt;span class=&quot;pl-ent&quot;&gt;value&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;5000&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let's first talk about the API version; in the first example, we used the &lt;code&gt;extensions/v1beta1&lt;/code&gt; and in the second one, we used &lt;code&gt;apps/v1&lt;/code&gt;. You may know that Kubernetes project development is very active, and it may be confusing sometimes to follow all the software updates.&lt;/p&gt;
&lt;p&gt;In Kubernetes version 1.9, &lt;code&gt;apps/v1&lt;/code&gt; is introduced, and &lt;code&gt;extensions/v1beta1&lt;/code&gt;, &lt;code&gt;apps/v1beta1&lt;/code&gt; and &lt;code&gt;apps/v1beta2&lt;/code&gt; are deprecated.&lt;/p&gt;
&lt;p&gt;To make things simpler, to know which version of the API you need to use, use the command:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl api-versions
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This above command will give you the API versions compatible with your cluster.&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;
&lt;p&gt;&lt;strong&gt;v1&lt;/strong&gt; was the first stable release of the Kubernetes API. It contains many core objects.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;apps/v1&lt;/strong&gt; is the most popular API group in Kubernetes, and it includes functionality related to running applications on Kubernetes, like Deployments, RollingUpdates, and ReplicaSets.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;**autoscaling/v1 **allows pods to be autoscaled based on different resource usage metrics.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;batch/v1&lt;/strong&gt; is related to batch processing and and jobs&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;batch/v1beta1&lt;/strong&gt; is the beta release of batch/v1&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;certificates.k8s.io/v1beta1&lt;/strong&gt; validates network certificates for secure communication in your cluster.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;extensions/v1beta1&lt;/strong&gt; includes many new, commonly used features. In Kubernetes 1.6, some of these features were relocated from &lt;code&gt;extensions&lt;/code&gt; to specific API groups like &lt;code&gt;apps&lt;/code&gt; .&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;policy/v1beta1&lt;/strong&gt; enables setting a pod disruption budget and new pod security rules&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;rbac.authorization.k8s.io/v1&lt;/strong&gt; includes extra functionality for Kubernetes RBAC (role-based access control)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;..etc&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;Let's deploy the pod now using the Deployment file we created.&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl apply -f kubernetes/api-deployment.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that you can use &lt;code&gt;kubectl create -f kubernetes/api-deployment.yaml&lt;/code&gt; command. However, there's a difference, between &lt;code&gt;apply&lt;/code&gt; and &lt;code&gt;create&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kubectl create&lt;/code&gt; is what we call &lt;a href=&quot;https://kubernetes.io/docs/tutorials/object-management-kubectl/imperative-object-management-configuration/&quot; rel=&quot;nofollow&quot;&gt;Imperative Management of Kubernetes Objects Using Configuration Files&lt;/a&gt;. &lt;code&gt;kubectl create&lt;/code&gt; overwrites all changes, and if a resource is having the same id already exists, it will encounter an error.&lt;/p&gt;
&lt;p&gt;Using this approach, you tell the Kubernetes API what you want to create, replace, or delete, not how you want your K8s cluster world to look like.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;kubectl apply&lt;/code&gt; is what we call &lt;a href=&quot;https://kubernetes.io/docs/tutorials/object-management-kubectl/declarative-object-management-configuration/&quot; rel=&quot;nofollow&quot;&gt;Declarative Management of Kubernetes Objects Using Configuration Files&lt;/a&gt; approach. &lt;code&gt;kubectl apply&lt;/code&gt; makes incremental changes. If an object already exists and you want to apply a new value for replica without deleting and recreating the object again, then &lt;code&gt;kubectl apply&lt;/code&gt; is what you need. &lt;code&gt;kubectl apply&lt;/code&gt; can also be used even if the object (e.g deployment) does not exist yet.&lt;/p&gt;
&lt;p&gt;In the Deployment configuration, we also defined our container. We will run a single container here since the replica is set to &lt;code&gt;1&lt;/code&gt;. In the same time, our container will use the image &lt;code&gt;eon01/tgr:1&lt;/code&gt;. Since our container will need some environment variables, the best way is to provide them using the Kubernetes deployment definition file.&lt;/p&gt;
&lt;p&gt;Also, we can add many other configurations, like the requested memory and its limit. The goal here is not using all that Kubernetes allows is to use in a Deployment file, but to see some of the essential features.&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-yaml&quot;&gt;
&lt;pre&gt;
    &lt;span class=&quot;pl-ent&quot;&gt;spec&lt;/span&gt;:
      &lt;span class=&quot;pl-ent&quot;&gt;containers&lt;/span&gt;:
        - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;tgr&lt;/span&gt;
          &lt;span class=&quot;pl-ent&quot;&gt;image&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;eon01/tgr:1&lt;/span&gt;
          &lt;span class=&quot;pl-ent&quot;&gt;ports&lt;/span&gt;:
            - &lt;span class=&quot;pl-ent&quot;&gt;containerPort&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;5000&lt;/span&gt;
          &lt;span class=&quot;pl-ent&quot;&gt;resources&lt;/span&gt;:
            &lt;span class=&quot;pl-ent&quot;&gt;requests&lt;/span&gt;:
              &lt;span class=&quot;pl-ent&quot;&gt;memory&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;128Mi&lt;/span&gt;
            &lt;span class=&quot;pl-ent&quot;&gt;limits&lt;/span&gt;:
              &lt;span class=&quot;pl-ent&quot;&gt;memory&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;256Mi&lt;/span&gt;
          &lt;span class=&quot;pl-ent&quot;&gt;env&lt;/span&gt;:
            - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;CLIENT_ID&lt;/span&gt;
              &lt;span class=&quot;pl-ent&quot;&gt;value&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;xxxx&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;CLIENT_SECRET&lt;/span&gt;
              &lt;span class=&quot;pl-ent&quot;&gt;value&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;xxxxxxxxxxxxxxxxxxxxx&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;ENV&lt;/span&gt;
              &lt;span class=&quot;pl-ent&quot;&gt;value&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;prod&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;DEBUG&lt;/span&gt;
              &lt;span class=&quot;pl-ent&quot;&gt;value&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;False&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;HOST&lt;/span&gt;
              &lt;span class=&quot;pl-ent&quot;&gt;value&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;0.0.0.0&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
            - &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;PORT&lt;/span&gt;
              &lt;span class=&quot;pl-ent&quot;&gt;value&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;5000&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In some cases, the Docker registry can be private, and in this case, pulling the image needs authentication. In this case, we need to add the &lt;code&gt;imagePullSecrets&lt;/code&gt; configuration:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;...
  containers:
  - name: private-reg-container
    image: &amp;lt;your-private-image&amp;gt;
  imagePullSecrets:
  - name: registry-credentials
  ...
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;This is how the &lt;code&gt;registry-credentials&lt;/code&gt; secret is created:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl create secret docker-registry registry-credentials --docker-server=&lt;span class=&quot;pl-k&quot;&gt;&amp;lt;&lt;/span&gt;your-registry-server&lt;span class=&quot;pl-k&quot;&gt;&amp;gt;&lt;/span&gt; --docker-username=&lt;span class=&quot;pl-k&quot;&gt;&amp;lt;&lt;/span&gt;your-name&lt;span class=&quot;pl-k&quot;&gt;&amp;gt;&lt;/span&gt; --docker-password=&lt;span class=&quot;pl-k&quot;&gt;&amp;lt;&lt;/span&gt;your-pword&lt;span class=&quot;pl-k&quot;&gt;&amp;gt;&lt;/span&gt; --docker-email=&lt;span class=&quot;pl-k&quot;&gt;&amp;lt;&lt;/span&gt;your-email&lt;span class=&quot;pl-k&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can also apply/create the &lt;code&gt;registry-credentials&lt;/code&gt; using a YAML file. This is an example:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-yaml&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-ent&quot;&gt;apiVersion&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;kind&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;Secret&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;metadata&lt;/span&gt;:
  &lt;span class=&quot;pl-s&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;registry-credentials&lt;/span&gt;
  &lt;span class=&quot;pl-s&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;data&lt;/span&gt;:
  &lt;span class=&quot;pl-ent&quot;&gt;.dockerconfigjson&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;adjAalkazArrA ... JHJH1QUIIAAX0=&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;type&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;kubernetes.io/dockerconfigjson&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you decode the .dockerconfigjson file using &lt;code&gt;base64 --decode&lt;/code&gt; command, you will understand that it's a simple file storing the configuration to access a registry:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl get secret regcred --output=&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;jsonpath={.data.\.dockerconfigjson}&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;pl-k&quot;&gt;|&lt;/span&gt; base64 --decode
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You will get a similar output to the following one:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-json&quot;&gt;
&lt;pre&gt;
{&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;auths&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;:{&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;your.private.registry.domain.com&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;:{&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;username&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;:&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;eon01&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;password&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;:&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;xxxxxxxxxxx&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;email&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;:&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;aymen@eralabs.io&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;auth&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;:&lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;dE3xxxxxxxxx&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;}}}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Again, let's decode the &quot;auth&quot; value using &lt;code&gt;echo &quot;dE3xxxxxxxxx&quot;|base64 --decode&lt;/code&gt; and it will give you something like &lt;code&gt;eon01:xxxxxxxx&lt;/code&gt; which has the format &lt;code&gt;username:password&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now let's see if the deployment is done, let's see how many pods we have:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl get pods
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This command will show all the pods within a cluster.&lt;/p&gt;
&lt;p&gt;We can scale our deployment using a command similar to the following one:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl scale --replicas=&lt;span class=&quot;pl-k&quot;&gt;&amp;lt;&lt;/span&gt;expected_replica_num&lt;span class=&quot;pl-k&quot;&gt;&amp;gt;&lt;/span&gt; deployment &lt;span class=&quot;pl-k&quot;&gt;&amp;lt;&lt;/span&gt;deployment_name&lt;span class=&quot;pl-k&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Our deployment is called &lt;code&gt;tgr&lt;/code&gt; since it's the name we gave to it in the Deployment configuration. You can also make verification by typing &lt;code&gt;kubeclt get deployment&lt;/code&gt;. Let's scale it:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl scale --replicas=2 deployment tgr
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Each of these containers will be accessible on port 500 from outside the container but not from outside the cluster.&lt;/p&gt;
&lt;p&gt;The number of pods/containers running for our API can be variable and may change dynamically.&lt;/p&gt;
&lt;p&gt;We can set up a load balancer that will balance traffic between the two pods we created, but since each pod can disappear to be recreated, its hostname and address will change.&lt;/p&gt;
&lt;p&gt;In all cases, pods are not meant to receive traffic directly, but they need to be exposed to traffic using a Service. In other words, the set of Pods running in one moment in time could be different from the set of Pods running that application a moment later.&lt;/p&gt;
&lt;p&gt;At the moment, the only service running is the cluster IP (which is related to Minikube and give us access to the cluster we created):&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl get services
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Services&lt;/h2&gt;
&lt;p&gt;In Kubernetes, since Pods are mortals, we should create an abstraction that defines a logical set of Pods and how to access them. This is the role of Services.&lt;/p&gt;
&lt;p&gt;In our case, creating a load balancer is a suitable solution. This is the configuration file of a Service object that will listen on the port 80 and load-balance traffic to the Pod with the label &lt;code&gt;name&lt;/code&gt;equals to &lt;code&gt;app&lt;/code&gt; . The latter is accessible internally using the port 5000 like it's defined in the Deployment configuration:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;...
          ports:
            - containerPort: 5000
...            
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;This is how the Service looks like:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-yaml&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-ent&quot;&gt;apiVersion&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;v1&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;kind&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;Service&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;metadata&lt;/span&gt;:
  &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;lb&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;labels&lt;/span&gt;:
    &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;lb&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;spec&lt;/span&gt;:
  &lt;span class=&quot;pl-ent&quot;&gt;ports&lt;/span&gt;:
  - &lt;span class=&quot;pl-ent&quot;&gt;port&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;80&lt;/span&gt;
    &lt;span class=&quot;pl-ent&quot;&gt;targetPort&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;5000&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;selector&lt;/span&gt;:
    &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;tgr&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;type&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;LoadBalancer&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Save this file to &lt;code&gt;kubernetes/api-service.yaml&lt;/code&gt; and deploy it using &lt;code&gt;kubectl apply -f kubernetes/api-service.yaml&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;If you type &lt;code&gt;kubectl get service&lt;/code&gt;, you will get the list of Services running in our local cluster:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;NAME         TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
kubernetes   ClusterIP      10.96.0.1       &amp;lt;none&amp;gt;        443/TCP        51m
lb           LoadBalancer   10.99.147.117   &amp;lt;pending&amp;gt;     80:30546/TCP   21s
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Not that the ClusterIP does not have an external IP while the app Service external IP is pending. No need to wait for the external IP of the created service, since Minikube does not really deploy a load balancer and this feature will only work if you configure a Load Balancer provider.&lt;/p&gt;
&lt;p&gt;If you are using a Cloud provider, say AWS, an AWS load balancer will be set up for you, GKE will provide a Cloud Load Balancer..etc You may also configure other types of load balancers.&lt;/p&gt;
&lt;p&gt;There are different types of Services that we can use to expose access to the API publicly:&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;code&gt;ClusterIP&lt;/code&gt;: is the default Kubernetes service. It exposes the Service on a cluster-internal IP. You can access it using the Kubernetes proxy.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://github.com/eon01/kubernetes-workshop/blob/master/images/clusterip.png&quot;&gt;&lt;img src=&quot;https://github.com/eon01/kubernetes-workshop/raw/master/images/clusterip.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Illustration by &lt;a href=&quot;https://twitter.com/ahmetb&quot; rel=&quot;nofollow&quot;&gt;Ahmet Alp Balkan&lt;/a&gt; via &lt;a href=&quot;https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0&quot; rel=&quot;nofollow&quot;&gt;Medium&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://kubernetes.io/docs/concepts/services-networking/#nodeport&quot; rel=&quot;nofollow&quot;&gt;&lt;code&gt;NodePort&lt;/code&gt;&lt;/a&gt;: Exposes the Service on each Node’s (VM's) IP at a static port called the &lt;code&gt;NodePort&lt;/code&gt;. (In our example, we have a single node). This is a primitive way to make an application accessible from outside the cluster and is not suitable for many use cases since your nodes (VMs) IP addresses may change at any time. The service is accessible using &lt;code&gt;&amp;lt;NodeIP&amp;gt;:&amp;lt;NodePort&amp;gt;&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://github.com/eon01/kubernetes-workshop/blob/master/images/nodeport.png&quot;&gt;&lt;img src=&quot;https://github.com/eon01/kubernetes-workshop/raw/master/images/nodeport.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Illustration by &lt;a href=&quot;https://twitter.com/ahmetb&quot; rel=&quot;nofollow&quot;&gt;Ahmet Alp Balkan&lt;/a&gt; via &lt;a href=&quot;https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0&quot; rel=&quot;nofollow&quot;&gt;Medium&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://kubernetes.io/docs/concepts/services-networking/#loadbalancer&quot; rel=&quot;nofollow&quot;&gt;&lt;code&gt;LoadBalancer&lt;/code&gt;&lt;/a&gt;: This is more advanced than a &lt;code&gt;NodePort&lt;/code&gt; Service. Usually, a Load Balancer exposes a Service externally using a cloud provider’s load balancer. &lt;code&gt;NodePort&lt;/code&gt; and &lt;code&gt;ClusterIP&lt;/code&gt; Services, to which the external load balancer routes, are automatically created.&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://github.com/eon01/kubernetes-workshop/blob/master/images/loadbalancer.png&quot;&gt;&lt;img src=&quot;https://github.com/eon01/kubernetes-workshop/raw/master/images/loadbalancer.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Illustration by &lt;a href=&quot;https://twitter.com/ahmetb&quot; rel=&quot;nofollow&quot;&gt;Ahmet Alp Balkan&lt;/a&gt; via &lt;a href=&quot;https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0&quot; rel=&quot;nofollow&quot;&gt;Medium&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We created a Load Balancer using a Service on our Minikube cluster, but since we don't have a Load Balancer to run, we can access the API service using the Cluster IP followed by the Service internal Port:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
minikube -p workshop ip
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Output:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;192.168.99.100
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Now execute &lt;code&gt;kubectl get services&lt;/code&gt; :&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;NAME         TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
kubernetes   ClusterIP      10.96.0.1       &amp;lt;none&amp;gt;        443/TCP        51m
lb           LoadBalancer   10.99.147.117   &amp;lt;pending&amp;gt;     80:30546/TCP   21s
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Use the IP &lt;code&gt;192.168.99.199&lt;/code&gt; followed by the port &lt;code&gt;30546&lt;/code&gt; to access the API.&lt;/p&gt;
&lt;p&gt;You can test this using a &lt;code&gt;curl&lt;/code&gt; command:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
curl &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;http://192.168.99.100:30546/?l=python&amp;amp;n=1&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;

---
{&quot;repos&quot;:[{&quot;archive_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/{archive_format}{/ref}&quot;,&quot;archived&quot;:false,&quot;assignees_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/assignees{/user}&quot;,&quot;blobs_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/git/blobs{/sha}&quot;,&quot;branches_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/branches{/branch}&quot;,&quot;clone_url&quot;:&quot;https://github.com/vinta/awesome-python.git&quot;,&quot;collaborators_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/collaborators{/collaborator}&quot;,&quot;comments_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/comments{/number}&quot;,&quot;commits_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/commits{/sha}&quot;,&quot;compare_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/compare/{base}...{head}&quot;,&quot;contents_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/contents/{+path}&quot;,&quot;contributors_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/contributors&quot;,&quot;created_at&quot;:&quot;2014-06-27T21:00:06Z&quot;,&quot;default_branch&quot;:&quot;master&quot;,&quot;deployments_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/deployments&quot;,&quot;description&quot;:&quot;A curated list of awesome Python frameworks, libraries, software and resources&quot;,&quot;disabled&quot;:false,&quot;downloads_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/downloads&quot;,&quot;events_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/events&quot;,&quot;fork&quot;:false,&quot;forks&quot;:13929,&quot;forks_count&quot;:13929,&quot;forks_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/forks&quot;,&quot;full_name&quot;:&quot;vinta/awesome-python&quot;,&quot;git_commits_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/git/commits{/sha}&quot;,&quot;git_refs_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/git/refs{/sha}&quot;,&quot;git_tags_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/git/tags{/sha}&quot;,&quot;git_url&quot;:&quot;git://github.com/vinta/awesome-python.git&quot;,&quot;has_downloads&quot;:true,&quot;has_issues&quot;:true,&quot;has_pages&quot;:true,&quot;has_projects&quot;:false,&quot;has_wiki&quot;:false,&quot;homepage&quot;:&quot;https://awesome-python.com/&quot;,&quot;hooks_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/hooks&quot;,&quot;html_url&quot;:&quot;https://github.com/vinta/awesome-python&quot;,&quot;id&quot;:21289110,&quot;issue_comment_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/issues/comments{/number}&quot;,&quot;issue_events_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/issues/events{/number}&quot;,&quot;issues_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/issues{/number}&quot;,&quot;keys_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/keys{/key_id}&quot;,&quot;labels_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/labels{/name}&quot;,&quot;language&quot;:&quot;Python&quot;,&quot;languages_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/languages&quot;,&quot;license&quot;:{&quot;key&quot;:&quot;other&quot;,&quot;name&quot;:&quot;Other&quot;,&quot;node_id&quot;:&quot;MDc6TGljZW5zZTA=&quot;,&quot;spdx_id&quot;:&quot;NOASSERTION&quot;,&quot;url&quot;:null},&quot;merges_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/merges&quot;,&quot;milestones_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/milestones{/number}&quot;,&quot;mirror_url&quot;:null,&quot;name&quot;:&quot;awesome-python&quot;,&quot;network_count&quot;:13929,&quot;node_id&quot;:&quot;MDEwOlJlcG9zaXRvcnkyMTI4OTExMA==&quot;,&quot;notifications_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/notifications{?since,all,participating}&quot;,&quot;open_issues&quot;:482,&quot;open_issues_count&quot;:482,&quot;owner&quot;:{&quot;avatar_url&quot;:&quot;https://avatars2.githubusercontent.com/u/652070?v=4&quot;,&quot;events_url&quot;:&quot;https://api.github.com/users/vinta/events{/privacy}&quot;,&quot;followers_url&quot;:&quot;https://api.github.com/users/vinta/followers&quot;,&quot;following_url&quot;:&quot;https://api.github.com/users/vinta/following{/other_user}&quot;,&quot;gists_url&quot;:&quot;https://api.github.com/users/vinta/gists{/gist_id}&quot;,&quot;gravatar_id&quot;:&quot;&quot;,&quot;html_url&quot;:&quot;https://github.com/vinta&quot;,&quot;id&quot;:652070,&quot;login&quot;:&quot;vinta&quot;,&quot;node_id&quot;:&quot;MDQ6VXNlcjY1MjA3MA==&quot;,&quot;organizations_url&quot;:&quot;https://api.github.com/users/vinta/orgs&quot;,&quot;received_events_url&quot;:&quot;https://api.github.com/users/vinta/received_events&quot;,&quot;repos_url&quot;:&quot;https://api.github.com/users/vinta/repos&quot;,&quot;site_admin&quot;:false,&quot;starred_url&quot;:&quot;https://api.github.com/users/vinta/starred{/owner}{/repo}&quot;,&quot;subscriptions_url&quot;:&quot;https://api.github.com/users/vinta/subscriptions&quot;,&quot;type&quot;:&quot;User&quot;,&quot;url&quot;:&quot;https://api.github.com/users/vinta&quot;},&quot;private&quot;:false,&quot;pulls_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/pulls{/number}&quot;,&quot;pushed_at&quot;:&quot;2019-08-16T15:21:42Z&quot;,&quot;releases_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/releases{/id}&quot;,&quot;size&quot;:4994,&quot;ssh_url&quot;:&quot;git@github.com:vinta/awesome-python.git&quot;,&quot;stargazers_count&quot;:71222,&quot;stargazers_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/stargazers&quot;,&quot;statuses_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/statuses/{sha}&quot;,&quot;subscribers_count&quot;:5251,&quot;subscribers_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/subscribers&quot;,&quot;subscription_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/subscription&quot;,&quot;svn_url&quot;:&quot;https://github.com/vinta/awesome-python&quot;,&quot;tags_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/tags&quot;,&quot;teams_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/teams&quot;,&quot;trees_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/git/trees{/sha}&quot;,&quot;updated_at&quot;:&quot;2019-08-17T16:11:44Z&quot;,&quot;url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python&quot;,&quot;watchers&quot;:71222,&quot;watchers_count&quot;:71222}],&quot;status&quot;:&quot;ok&quot;}
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Inconvenient of Load Balancer Service&lt;/h2&gt;
&lt;p&gt;Typically, load balancers are provisioned by the Cloud provider you're using.&lt;/p&gt;
&lt;p&gt;A load balancer can handle one service but imagine if you have ten services, each one will need a load balancer; this is when it becomes costly.&lt;/p&gt;
&lt;p&gt;The best solution, in this case, is set up an Ingress controller that acts as a smart router and can be deployed at the edge of the cluster, therefore in the front of all the services you deploy.&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://github.com/eon01/kubernetes-workshop/blob/master/images/ingress.png&quot;&gt;&lt;img src=&quot;https://github.com/eon01/kubernetes-workshop/raw/master/images/ingress.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Illustration by &lt;a href=&quot;https://twitter.com/ahmetb&quot; rel=&quot;nofollow&quot;&gt;Ahmet Alp Balkan&lt;/a&gt; via &lt;a href=&quot;https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0&quot; rel=&quot;nofollow&quot;&gt;Medium&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Ambassador is an Open Source Kubernetes-Native API Gateway built on the Envoy Proxy. It provides a solution for traffic management and application security. It's described as is a specialized control plane that translates Kubernetes annotations to Envoy configuration.&lt;/p&gt;
&lt;p&gt;All traffic is directly handled by the high-performance Envoy Proxy.&lt;/p&gt;
&lt;p&gt;&lt;a target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot; href=&quot;https://github.com/eon01/kubernetes-workshop/blob/master/images/ambassador-arch.png&quot;&gt;&lt;img src=&quot;https://github.com/eon01/kubernetes-workshop/raw/master/images/ambassador-arch.png&quot; alt=&quot;&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Photo credit: &lt;a href=&quot;https://www.getambassador.io/concepts/architecture&quot; rel=&quot;nofollow&quot;&gt;https://www.getambassador.io/concepts/architecture&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;As it's described in &lt;a href=&quot;https://www.envoyproxy.io/&quot; rel=&quot;nofollow&quot;&gt;Envoy official website&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Originally built at &lt;strong&gt;Lyft&lt;/strong&gt;, Envoy is a high-performance C++ distributed proxy designed for single services and applications, as well as a communication bus and “universal data plane” designed for large microservice “service mesh” architectures. Built on the learnings of solutions such as NGINX, HAProxy, hardware load balancers, and cloud load balancers, Envoy runs alongside every application and abstracts the network by providing common features in a platform-agnostic manner. When all service traffic in an infrastructure flows via an Envoy mesh, it becomes easy to visualize problem areas via consistent observability, tune overall performance, and add substrate features in a single place.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We are going to use Ambassador as an API Gateway; we no longer need the load balancer service we created in the first part. Let's remove it:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl delete -f kubernetes/api-service.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To deploy Ambassador in your &lt;strong&gt;default&lt;/strong&gt; namespace, first, you need to check if Kubernetes has RBAC enabled:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl cluster-info dump --namespace kube-system &lt;span class=&quot;pl-k&quot;&gt;|&lt;/span&gt; grep authorization-mode
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If RBAC is enabled:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl apply -f https://getambassador.io/yaml/ambassador/ambassador-rbac.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Without RBAC, you can use:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl apply -f https://getambassador.io/yaml/ambassador/ambassador-no-rbac.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ambassador is deployed as a Kubernetes Service that references the ambassador Deployment you deployed previously. Create the following YAML and put it in a file called &lt;code&gt;kubernetes/ambassador-service.yaml&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;---
apiVersion: v1
kind: Service
metadata:
  name: ambassador
spec:
  type: LoadBalancer
  externalTrafficPolicy: Local
  ports:
   - port: 80
     targetPort: 8080
  selector:
    service: ambassador
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Deploy the service:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl apply -f ambassador-service.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now let's use this file containing the Deployment configuration for our API as well as the Ambassador Service configuration relative to the same Deployment. Call this file &lt;code&gt;kubernetes/api-deployment-with-ambassador.yaml&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;---
apiVersion: v1
kind: Service
metadata:
  name: tgr
  annotations:
    getambassador.io/config: |
      ---
      apiVersion: ambassador/v1
      kind: Mapping
      name: tgr_mapping
      prefix: /
      service: tgr:5000

spec:
  ports:
  - name: tgr
    port: 5000
    targetPort: 5000
  selector:
    app: tgr
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tgr
spec:
  replicas: 1
  selector:
    matchLabels:
      app: tgr
  strategy:
    type: RollingUpdate
  template:
    metadata:
      labels:
        app: tgr
    spec:
      containers:
      - name: tgr
        image: eon01/tgr:1
        ports:
          - containerPort: 5000
        env:
          - name: CLIENT_ID
            value: &quot;453486b9225e0e26c525&quot;
          - name: CLIENT_SECRET
            value: &quot;a63e841d5c18f41b9264a1a2ac0675a1f903ee8c&quot;
          - name: ENV
            value: &quot;prod&quot;
          - name: DEBUG
            value: &quot;False&quot;
          - name: HOST
            value: &quot;0.0.0.0&quot;
          - name: PORT
            value: &quot;5000&quot;
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Deploy the previously created configuration:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl apply -f kubernetes/api-deployment-with-ambassador.yaml
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Let's test things out: We need the external IP for Ambassador:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl get svc -o wide ambassador
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You should see something like:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;NAME         TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE    SELECTOR
ambassador   LoadBalancer   10.103.201.130   &amp;lt;pending&amp;gt;     80:30283/TCP   9m2s   service=ambassador
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;If you are using Minikube, it is normal to see the external IP in the &lt;code&gt;pending&lt;/code&gt; state.&lt;/p&gt;
&lt;p&gt;We can use &lt;code&gt;minikube -p workshop service list&lt;/code&gt; to get the Ambassador IP. You will get an output similar to the following:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;|-------------|------------------|-----------------------------|
|  NAMESPACE  |       NAME       |             URL             |
|-------------|------------------|-----------------------------|
| default     | ambassador       | http://192.168.99.100:30283 |
| default     | ambassador-admin | http://192.168.99.100:30084 |
| default     | kubernetes       | No node port                |
| default     | tgr              | No node port                |
| kube-system | kube-dns         | No node port                |
|-------------|------------------|-----------------------------|

&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Now you can use the API using the IP &lt;code&gt;http://192.168.99.100:30283&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
curl &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;http://192.168.99.100:30283/?l=python&amp;amp;n=1&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
---
{&quot;repos&quot;:[{&quot;archive_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/{archive_format}{/ref}&quot;,&quot;archived&quot;:false,&quot;assignees_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/assignees{/user}&quot;,&quot;blobs_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/git/blobs{/sha}&quot;,&quot;branches_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/branches{/branch}&quot;,&quot;clone_url&quot;:&quot;https://github.com/vinta/awesome-python.git&quot;,&quot;collaborators_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/collaborators{/collaborator}&quot;,&quot;comments_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/comments{/number}&quot;,&quot;commits_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/commits{/sha}&quot;,&quot;compare_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/compare/{base}...{head}&quot;,&quot;contents_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/contents/{+path}&quot;,&quot;contributors_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/contributors&quot;,&quot;created_at&quot;:&quot;2014-06-27T21:00:06Z&quot;,&quot;default_branch&quot;:&quot;master&quot;,&quot;deployments_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/deployments&quot;,&quot;description&quot;:&quot;A curated list of awesome Python frameworks, libraries, software and resources&quot;,&quot;disabled&quot;:false,&quot;downloads_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/downloads&quot;,&quot;events_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/events&quot;,&quot;fork&quot;:false,&quot;forks&quot;:13933,&quot;forks_count&quot;:13933,&quot;forks_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/forks&quot;,&quot;full_name&quot;:&quot;vinta/awesome-python&quot;,&quot;git_commits_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/git/commits{/sha}&quot;,&quot;git_refs_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/git/refs{/sha}&quot;,&quot;git_tags_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/git/tags{/sha}&quot;,&quot;git_url&quot;:&quot;git://github.com/vinta/awesome-python.git&quot;,&quot;has_downloads&quot;:true,&quot;has_issues&quot;:true,&quot;has_pages&quot;:true,&quot;has_projects&quot;:false,&quot;has_wiki&quot;:false,&quot;homepage&quot;:&quot;https://awesome-python.com/&quot;,&quot;hooks_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/hooks&quot;,&quot;html_url&quot;:&quot;https://github.com/vinta/awesome-python&quot;,&quot;id&quot;:21289110,&quot;issue_comment_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/issues/comments{/number}&quot;,&quot;issue_events_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/issues/events{/number}&quot;,&quot;issues_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/issues{/number}&quot;,&quot;keys_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/keys{/key_id}&quot;,&quot;labels_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/labels{/name}&quot;,&quot;language&quot;:&quot;Python&quot;,&quot;languages_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/languages&quot;,&quot;license&quot;:{&quot;key&quot;:&quot;other&quot;,&quot;name&quot;:&quot;Other&quot;,&quot;node_id&quot;:&quot;MDc6TGljZW5zZTA=&quot;,&quot;spdx_id&quot;:&quot;NOASSERTION&quot;,&quot;url&quot;:null},&quot;merges_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/merges&quot;,&quot;milestones_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/milestones{/number}&quot;,&quot;mirror_url&quot;:null,&quot;name&quot;:&quot;awesome-python&quot;,&quot;network_count&quot;:13933,&quot;node_id&quot;:&quot;MDEwOlJlcG9zaXRvcnkyMTI4OTExMA==&quot;,&quot;notifications_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/notifications{?since,all,participating}&quot;,&quot;open_issues&quot;:482,&quot;open_issues_count&quot;:482,&quot;owner&quot;:{&quot;avatar_url&quot;:&quot;https://avatars2.githubusercontent.com/u/652070?v=4&quot;,&quot;events_url&quot;:&quot;https://api.github.com/users/vinta/events{/privacy}&quot;,&quot;followers_url&quot;:&quot;https://api.github.com/users/vinta/followers&quot;,&quot;following_url&quot;:&quot;https://api.github.com/users/vinta/following{/other_user}&quot;,&quot;gists_url&quot;:&quot;https://api.github.com/users/vinta/gists{/gist_id}&quot;,&quot;gravatar_id&quot;:&quot;&quot;,&quot;html_url&quot;:&quot;https://github.com/vinta&quot;,&quot;id&quot;:652070,&quot;login&quot;:&quot;vinta&quot;,&quot;node_id&quot;:&quot;MDQ6VXNlcjY1MjA3MA==&quot;,&quot;organizations_url&quot;:&quot;https://api.github.com/users/vinta/orgs&quot;,&quot;received_events_url&quot;:&quot;https://api.github.com/users/vinta/received_events&quot;,&quot;repos_url&quot;:&quot;https://api.github.com/users/vinta/repos&quot;,&quot;site_admin&quot;:false,&quot;starred_url&quot;:&quot;https://api.github.com/users/vinta/starred{/owner}{/repo}&quot;,&quot;subscriptions_url&quot;:&quot;https://api.github.com/users/vinta/subscriptions&quot;,&quot;type&quot;:&quot;User&quot;,&quot;url&quot;:&quot;https://api.github.com/users/vinta&quot;},&quot;private&quot;:false,&quot;pulls_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/pulls{/number}&quot;,&quot;pushed_at&quot;:&quot;2019-08-16T15:21:42Z&quot;,&quot;releases_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/releases{/id}&quot;,&quot;size&quot;:4994,&quot;ssh_url&quot;:&quot;git@github.com:vinta/awesome-python.git&quot;,&quot;stargazers_count&quot;:71269,&quot;stargazers_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/stargazers&quot;,&quot;statuses_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/statuses/{sha}&quot;,&quot;subscribers_count&quot;:5254,&quot;subscribers_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/subscribers&quot;,&quot;subscription_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/subscription&quot;,&quot;svn_url&quot;:&quot;https://github.com/vinta/awesome-python&quot;,&quot;tags_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/tags&quot;,&quot;teams_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/teams&quot;,&quot;trees_url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python/git/trees{/sha}&quot;,&quot;updated_at&quot;:&quot;2019-08-19T08:21:51Z&quot;,&quot;url&quot;:&quot;https://api.github.com/repos/vinta/awesome-python&quot;,&quot;watchers&quot;:71269,&quot;watchers_count&quot;:71269}],&quot;status&quot;:&quot;ok&quot;}
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Edge Proxy vs Service Mesh&lt;/h2&gt;
&lt;p&gt;You may have heard of tools like Istio and Linkerd and it may be confusing to compare Ambassador or Envoy to these tools. We are going to understand the differences here.&lt;/p&gt;
&lt;p&gt;Istio is described as a tool to connect, secure, control, and observe services.The same features are implemented by its alternatives like Linkerd or Consul. These tools are called Service Mesh.&lt;/p&gt;
&lt;p&gt;Ambassador is a, API gateway for services (or microservices) and it's deployed at the edge of your network. It routes incoming traffic to a cluster internal services and this what we call &quot;north-south&quot; traffic.&lt;/p&gt;
&lt;p&gt;Istio, in the other hand, is a service mesh for Kubernetes services (or microservices). It's designed to add application-level Layer (L7) observability, routing, and resilience to service-to-service traffic and this is what we call &quot;east-west&quot; traffic.&lt;/p&gt;
&lt;p&gt;The fact that both Istio and Ambassador are built using Envoy, does not mean they have the same features or usability. Therefore, they can be deployed together in the same cluster.&lt;/p&gt;

&lt;p&gt;If you remember, when we created our Minikube cluster we used &lt;code&gt;--extra-config=apiserver.enable-swagger-ui=true&lt;/code&gt;. This configuration makes the Kubernetes API &quot;browsable&quot; via a web browser.&lt;/p&gt;
&lt;p&gt;When using Minikube, in order to access the Kubernetes API using a browser, we need to create a proxy:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl proxy --port=8080 &lt;span class=&quot;pl-k&quot;&gt;&amp;amp;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we can test this out using Curl:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
curl http://localhost:8080/api/
---
{
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;kind&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;APIVersions&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;versions&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: [
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;v1&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
  ],
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;serverAddressByClientCIDRs&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: [
    {
      &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;clientCIDR&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;0.0.0.0/0&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
      &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;serverAddress&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;192.168.99.100:8443&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
    }
  ]
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can get a list of the APIs and resources we can access by visiting: &lt;code&gt;http://localhost:8080/&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;For instance, we can get a list of metrics here &lt;code&gt;http://localhost:8080/metrics&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Using an API Client&lt;/h2&gt;
&lt;p&gt;We are going to use the Kubernetes client:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
pip install kubernetes
&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;highlight highlight-source-python&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;#&lt;/span&gt; import json&lt;/span&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;#&lt;/span&gt; import requests&lt;/span&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;#&lt;/span&gt; @app.route('/pods')&lt;/span&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;#&lt;/span&gt; def monitor():&lt;/span&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;#&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;#&lt;/span&gt;     api_url = &quot;http://kubernetes.default.svc/api/v1/pods/&quot;&lt;/span&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;#&lt;/span&gt;     response = requests.get(api_url)&lt;/span&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;#&lt;/span&gt;     if response.status_code == 200:&lt;/span&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;#&lt;/span&gt;         return json.loads(response.content.decode('utf-8'))&lt;/span&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;#&lt;/span&gt;     else:&lt;/span&gt;
&lt;span class=&quot;pl-c&quot;&gt;&lt;span class=&quot;pl-c&quot;&gt;#&lt;/span&gt;         return None&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Accessing the API from inside a POD&lt;/h2&gt;
&lt;p&gt;By default, a Pod is associated with a service account, and a credential (token) for that service account is placed into the filesystem tree of each container in that Pod, at &lt;code&gt;/var/run/secrets/kubernetes.io/serviceaccount/token&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Let's try to go inside a Pod and access the API. Use &lt;code&gt;kubectl get pods&lt;/code&gt; to get a list of pods&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;NAME                          READY   STATUS    RESTARTS   AGE
ambassador-64d8b877f9-4bzvn   1/1     Running   0          103m
ambassador-64d8b877f9-b68w6   1/1     Running   0          103m
ambassador-64d8b877f9-vw9mm   1/1     Running   0          103m
tgr-8d78d599f-pt5xx           1/1     Running   0          4m17s
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Now log inside the API Pod:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
kubectl &lt;span class=&quot;pl-c1&quot;&gt;exec&lt;/span&gt; -it tgr-8d78d599f-pt5xx bash
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Assign the token to a variable:&lt;/p&gt;
&lt;pre&gt;
&lt;code&gt;KUBE_TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)
&lt;/code&gt;
&lt;/pre&gt;
&lt;p&gt;Notice that the token file is added automatically by Kubernetes.&lt;/p&gt;
&lt;p&gt;We also have other variables already set like:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-c1&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;$KUBERNETES_SERVICE_HOST&lt;/span&gt;
10.96.0.1

&lt;span class=&quot;pl-c1&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;$KUBERNETES_PORT_443_TCP_PORT&lt;/span&gt;
443

&lt;span class=&quot;pl-c1&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;pl-smi&quot;&gt;$HOSTNAME&lt;/span&gt;
tgr-8d78d599f-pt5xx
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We are going to use these variables to access the list of Pods using this Curl command:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-shell&quot;&gt;
&lt;pre&gt;
curl -sSk -H &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;Authorization: Bearer &lt;span class=&quot;pl-smi&quot;&gt;$KUBE_TOKEN&lt;/span&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; https://&lt;span class=&quot;pl-smi&quot;&gt;$KUBERNETES_SERVICE_HOST&lt;/span&gt;:&lt;span class=&quot;pl-smi&quot;&gt;$KUBERNETES_PORT_443_TCP_PORT&lt;/span&gt;/api/v1/namespaces/default/pods/&lt;span class=&quot;pl-smi&quot;&gt;$HOSTNAME&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;At this stage, you should have an error output saying that you don't have the rights to access this API endpoint, which is normal:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-json&quot;&gt;
&lt;pre&gt;
{
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;kind&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;Status&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;apiVersion&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;v1&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;metadata&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: {

  },
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;status&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;Failure&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;message&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;pods &lt;span class=&quot;pl-cce&quot;&gt;\&quot;&lt;/span&gt;tgr-8d78d599f-pt5xx&lt;span class=&quot;pl-cce&quot;&gt;\&quot;&lt;/span&gt; is forbidden: User &lt;span class=&quot;pl-cce&quot;&gt;\&quot;&lt;/span&gt;system:serviceaccount:default:default&lt;span class=&quot;pl-cce&quot;&gt;\&quot;&lt;/span&gt; cannot get resource &lt;span class=&quot;pl-cce&quot;&gt;\&quot;&lt;/span&gt;pods&lt;span class=&quot;pl-cce&quot;&gt;\&quot;&lt;/span&gt; in API group &lt;span class=&quot;pl-cce&quot;&gt;\&quot;\&quot;&lt;/span&gt; in the namespace &lt;span class=&quot;pl-cce&quot;&gt;\&quot;&lt;/span&gt;default&lt;span class=&quot;pl-cce&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;reason&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;Forbidden&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;details&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: {
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;name&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;tgr-8d78d599f-pt5xx&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;kind&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;pods&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
  },
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;code&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;403&lt;/span&gt;
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The Pod is using the default Service Account and it does not have the right to list the Pods.&lt;/p&gt;
&lt;p&gt;In order to fix this, exit the container and create a file called &lt;code&gt;kubernetes/service-account.yaml&lt;/code&gt;, add the following lines:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-yaml&quot;&gt;
&lt;pre&gt;
&lt;span class=&quot;pl-ent&quot;&gt;kind&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;ClusterRole&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;apiVersion&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;metadata&lt;/span&gt;:
  &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;pods-list&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;rules&lt;/span&gt;:
- &lt;span class=&quot;pl-ent&quot;&gt;apiGroups&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;[&quot;&quot;]&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;resources&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;[&quot;pods&quot;]&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;verbs&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;[&quot;list&quot;]&lt;/span&gt;
---
&lt;span class=&quot;pl-ent&quot;&gt;kind&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;ClusterRoleBinding&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;apiVersion&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;rbac.authorization.k8s.io/v1&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;metadata&lt;/span&gt;:
  &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;pods-list&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;subjects&lt;/span&gt;:
- &lt;span class=&quot;pl-ent&quot;&gt;kind&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;ServiceAccount&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;default&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;namespace&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;default&lt;/span&gt;
&lt;span class=&quot;pl-ent&quot;&gt;roleRef&lt;/span&gt;:
  &lt;span class=&quot;pl-ent&quot;&gt;kind&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;ClusterRole&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;name&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;pods-list&lt;/span&gt;
  &lt;span class=&quot;pl-ent&quot;&gt;apiGroup&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;rbac.authorization.k8s.io&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then apply the new configuration using &lt;code&gt;kubectl apply -f kubernetes/service-account.yaml&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Now you can access the list of Pods:&lt;/p&gt;
&lt;div class=&quot;highlight highlight-source-json&quot;&gt;
&lt;pre&gt;
{
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;kind&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;PodList&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;apiVersion&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;v1&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;metadata&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: {
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;selfLink&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;/api/v1/namespaces/default/pods/&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
    &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;resourceVersion&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;19589&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
  },
  &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;items&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: [
    {
      &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;metadata&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: {
        &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;name&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;ambassador-64d8b877f9-4bzvn&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
        &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;generateName&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;ambassador-64d8b877f9-&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
        &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;namespace&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;default&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
        &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;selfLink&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;/api/v1/namespaces/default/pods/ambassador-64d8b877f9-4bzvn&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
        &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;uid&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;63f62ede-de77-441d-85f7-daf9cbc7040f&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
        &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;resourceVersion&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;1047&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
        &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;creationTimestamp&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;2019-08-19T08:12:47Z&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
        &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;labels&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: {
          &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;pod-template-hash&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;64d8b877f9&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
          &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;service&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;ambassador&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
        },
        &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;annotations&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: {
          &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;consul.hashicorp.com/connect-inject&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;false&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
          &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;sidecar.istio.io/inject&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;false&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
        },
        &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;ownerReferences&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: [
          {
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;apiVersion&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;apps/v1&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;kind&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;ReplicaSet&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;name&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;ambassador-64d8b877f9&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;uid&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;383c2e4b-7179-4806-b7bf-3682c7873a10&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;controller&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;true&lt;/span&gt;,
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;blockOwnerDeletion&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;true&lt;/span&gt;
          }
        ]
      },
      &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;spec&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: {
        &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;volumes&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: [
          {
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;name&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;ambassador-token-rdqq6&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;secret&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: {
              &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;secretName&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;ambassador-token-rdqq6&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
              &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;defaultMode&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;420&lt;/span&gt;
            }
          }
        ],
        &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;containers&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: [
          {
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;name&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;ambassador&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;image&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;quay.io/datawire/ambassador:0.75.0&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
            &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;ports&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: [
              {
                &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;name&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;http&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;,
                &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;containerPort&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-c1&quot;&gt;8080&lt;/span&gt;,
                &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;protocol&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;pl-s&quot;&gt;&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;TCP&lt;span class=&quot;pl-pds&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
              },
&lt;span class=&quot;pl-ii&quot;&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;What about creating your own monitoring/observability solution using Python (or any other programming language) and the Kubernetes API ? This could be probably the subject of the upcoming workshop.&lt;/p&gt;
&lt;hr/&gt;
&lt;hr/&gt;&lt;p&gt;If this workshop solved some of your problems, please consider giving it a star and/or buying me a coffee:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://www.buymeacoffee.com/eon01&quot; rel=&quot;nofollow&quot;&gt;&lt;img src=&quot;https://github.com/eon01/kubernetes-workshop/raw/master/images/bmc.png&quot; alt=&quot;Buy Me A Coffee&quot;/&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Use only for educational purposes. We don't provide any guarantee.&lt;/em&gt;&lt;/p&gt;
&lt;/article&gt;&lt;/div&gt;
</description>
<pubDate>Thu, 19 Sep 2019 22:04:14 +0000</pubDate>
<dc:creator>feross</dc:creator>
<og:image>https://avatars2.githubusercontent.com/u/5774128?s=400&amp;v=4</og:image>
<og:type>object</og:type>
<og:title>eon01/kubernetes-workshop</og:title>
<og:url>https://github.com/eon01/kubernetes-workshop</og:url>
<og:description>⚙️ A Gentle introduction to Kubernetes with more than just the basics. 🌟 Give it a star if you like it. - eon01/kubernetes-workshop</og:description>
<dc:language>en</dc:language>
<dc:format>text/html</dc:format>
<dc:identifier>https://github.com/eon01/kubernetes-workshop</dc:identifier>
</item>
</channel>
</rss>